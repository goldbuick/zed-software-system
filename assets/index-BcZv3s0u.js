var _oe=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var yYe=_oe((Rf,Cf)=>{function voe(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var yd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Dl(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function j$(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var i=!1;try{i=this instanceof r}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var T3={exports:{}},CT={};var OB;function yoe(){if(OB)return CT;OB=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var a in i)a!=="key"&&(s[a]=i[a])}else s=i;return i=s.ref,{$$typeof:n,type:r,key:o,ref:i!==void 0?i:null,props:s}}return CT.Fragment=e,CT.jsx=t,CT.jsxs=t,CT}var IB;function boe(){return IB||(IB=1,T3.exports=yoe()),T3.exports}var xe=boe();function Soe(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var z$={exports:{}},Ha=z$.exports={},km,Om;function hD(){throw new Error("setTimeout has not been defined")}function fD(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?km=setTimeout:km=hD}catch{km=hD}try{typeof clearTimeout=="function"?Om=clearTimeout:Om=fD}catch{Om=fD}})();function H$(n){if(km===setTimeout)return setTimeout(n,0);if((km===hD||!km)&&setTimeout)return km=setTimeout,setTimeout(n,0);try{return km(n,0)}catch{try{return km.call(null,n,0)}catch{return km.call(this,n,0)}}}function Eoe(n){if(Om===clearTimeout)return clearTimeout(n);if((Om===fD||!Om)&&clearTimeout)return Om=clearTimeout,clearTimeout(n);try{return Om(n)}catch{try{return Om.call(null,n)}catch{return Om.call(this,n)}}}var zg=[],BE=!1,P1,hC=-1;function xoe(){!BE||!P1||(BE=!1,P1.length?zg=P1.concat(zg):hC=-1,zg.length&&V$())}function V$(){if(!BE){var n=H$(xoe);BE=!0;for(var e=zg.length;e;){for(P1=zg,zg=[];++hC<e;)P1&&P1[hC].run();hC=-1,e=zg.length}P1=null,BE=!1,Eoe(n)}}Ha.nextTick=function(n){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];zg.push(new G$(n,e)),zg.length===1&&!BE&&H$(V$)};function G$(n,e){this.fun=n,this.array=e}G$.prototype.run=function(){this.fun.apply(null,this.array)};Ha.title="browser";Ha.browser=!0;Ha.env={};Ha.argv=[];Ha.version="";Ha.versions={};function a_(){}Ha.on=a_;Ha.addListener=a_;Ha.once=a_;Ha.off=a_;Ha.removeListener=a_;Ha.removeAllListeners=a_;Ha.emit=a_;Ha.prependListener=a_;Ha.prependOnceListener=a_;Ha.listeners=function(n){return[]};Ha.binding=function(n){throw new Error("process.binding is not supported")};Ha.cwd=function(){return"/"};Ha.chdir=function(n){throw new Error("process.chdir is not supported")};Ha.umask=function(){return 0};var Toe=z$.exports;const oc=Soe(Toe);var w3={exports:{}},li={},NB;function woe(){if(NB)return li;NB=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function f(q){return q===null||typeof q!="object"?null:(q=h&&q[h]||q["@@iterator"],typeof q=="function"?q:null)}var d={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,_={};function g(q,V,K){this.props=q,this.context=V,this.refs=_,this.updater=K||d}g.prototype.isReactComponent={},g.prototype.setState=function(q,V){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,V,"setState")},g.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function m(){}m.prototype=g.prototype;function b(q,V,K){this.props=q,this.context=V,this.refs=_,this.updater=K||d}var y=b.prototype=new m;y.constructor=b,p(y,g.prototype),y.isPureReactComponent=!0;var x=Array.isArray,T={H:null,A:null,T:null,S:null,V:null},k=Object.prototype.hasOwnProperty;function R(q,V,K,ne,ie,ae){return K=ae.ref,{$$typeof:n,type:q,key:V,ref:K!==void 0?K:null,props:ae}}function P(q,V){return R(q.type,V,void 0,void 0,void 0,q.props)}function B(q){return typeof q=="object"&&q!==null&&q.$$typeof===n}function U(q){var V={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(K){return V[K]})}var z=/\/+/g;function I(q,V){return typeof q=="object"&&q!==null&&q.key!=null?U(""+q.key):V.toString(36)}function L(){}function M(q){switch(q.status){case"fulfilled":return q.value;case"rejected":throw q.reason;default:switch(typeof q.status=="string"?q.then(L,L):(q.status="pending",q.then(function(V){q.status==="pending"&&(q.status="fulfilled",q.value=V)},function(V){q.status==="pending"&&(q.status="rejected",q.reason=V)})),q.status){case"fulfilled":return q.value;case"rejected":throw q.reason}}throw q}function F(q,V,K,ne,ie){var ae=typeof q;(ae==="undefined"||ae==="boolean")&&(q=null);var Te=!1;if(q===null)Te=!0;else switch(ae){case"bigint":case"string":case"number":Te=!0;break;case"object":switch(q.$$typeof){case n:case e:Te=!0;break;case u:return Te=q._init,F(Te(q._payload),V,K,ne,ie)}}if(Te)return ie=ie(q),Te=ne===""?"."+I(q,0):ne,x(ie)?(K="",Te!=null&&(K=Te.replace(z,"$&/")+"/"),F(ie,V,K,"",function(Pe){return Pe})):ie!=null&&(B(ie)&&(ie=P(ie,K+(ie.key==null||q&&q.key===ie.key?"":(""+ie.key).replace(z,"$&/")+"/")+Te)),V.push(ie)),1;Te=0;var Ie=ne===""?".":ne+":";if(x(q))for(var be=0;be<q.length;be++)ne=q[be],ae=Ie+I(ne,be),Te+=F(ne,V,K,ae,ie);else if(be=f(q),typeof be=="function")for(q=be.call(q),be=0;!(ne=q.next()).done;)ne=ne.value,ae=Ie+I(ne,be++),Te+=F(ne,V,K,ae,ie);else if(ae==="object"){if(typeof q.then=="function")return F(M(q),V,K,ne,ie);throw V=String(q),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.")}return Te}function Z(q,V,K){if(q==null)return q;var ne=[],ie=0;return F(q,ne,"","",function(ae){return V.call(K,ae,ie++)}),ne}function $(q){if(q._status===-1){var V=q._result;V=V(),V.then(function(K){(q._status===0||q._status===-1)&&(q._status=1,q._result=K)},function(K){(q._status===0||q._status===-1)&&(q._status=2,q._result=K)}),q._status===-1&&(q._status=0,q._result=V)}if(q._status===1)return q._result.default;throw q._result}var Y=typeof reportError=="function"?reportError:function(q){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var V=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof q=="object"&&q!==null&&typeof q.message=="string"?String(q.message):String(q),error:q});if(!window.dispatchEvent(V))return}else if(typeof oc=="object"&&typeof oc.emit=="function"){oc.emit("uncaughtException",q);return}console.error(q)};function Q(){}return li.Children={map:Z,forEach:function(q,V,K){Z(q,function(){V.apply(this,arguments)},K)},count:function(q){var V=0;return Z(q,function(){V++}),V},toArray:function(q){return Z(q,function(V){return V})||[]},only:function(q){if(!B(q))throw Error("React.Children.only expected to receive a single React element child.");return q}},li.Component=g,li.Fragment=t,li.Profiler=i,li.PureComponent=b,li.StrictMode=r,li.Suspense=c,li.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=T,li.__COMPILER_RUNTIME={__proto__:null,c:function(q){return T.H.useMemoCache(q)}},li.cache=function(q){return function(){return q.apply(null,arguments)}},li.cloneElement=function(q,V,K){if(q==null)throw Error("The argument must be a React element, but you passed "+q+".");var ne=p({},q.props),ie=q.key,ae=void 0;if(V!=null)for(Te in V.ref!==void 0&&(ae=void 0),V.key!==void 0&&(ie=""+V.key),V)!k.call(V,Te)||Te==="key"||Te==="__self"||Te==="__source"||Te==="ref"&&V.ref===void 0||(ne[Te]=V[Te]);var Te=arguments.length-2;if(Te===1)ne.children=K;else if(1<Te){for(var Ie=Array(Te),be=0;be<Te;be++)Ie[be]=arguments[be+2];ne.children=Ie}return R(q.type,ie,void 0,void 0,ae,ne)},li.createContext=function(q){return q={$$typeof:o,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null},q.Provider=q,q.Consumer={$$typeof:s,_context:q},q},li.createElement=function(q,V,K){var ne,ie={},ae=null;if(V!=null)for(ne in V.key!==void 0&&(ae=""+V.key),V)k.call(V,ne)&&ne!=="key"&&ne!=="__self"&&ne!=="__source"&&(ie[ne]=V[ne]);var Te=arguments.length-2;if(Te===1)ie.children=K;else if(1<Te){for(var Ie=Array(Te),be=0;be<Te;be++)Ie[be]=arguments[be+2];ie.children=Ie}if(q&&q.defaultProps)for(ne in Te=q.defaultProps,Te)ie[ne]===void 0&&(ie[ne]=Te[ne]);return R(q,ae,void 0,void 0,null,ie)},li.createRef=function(){return{current:null}},li.forwardRef=function(q){return{$$typeof:a,render:q}},li.isValidElement=B,li.lazy=function(q){return{$$typeof:u,_payload:{_status:-1,_result:q},_init:$}},li.memo=function(q,V){return{$$typeof:l,type:q,compare:V===void 0?null:V}},li.startTransition=function(q){var V=T.T,K={};T.T=K;try{var ne=q(),ie=T.S;ie!==null&&ie(K,ne),typeof ne=="object"&&ne!==null&&typeof ne.then=="function"&&ne.then(Q,Y)}catch(ae){Y(ae)}finally{T.T=V}},li.unstable_useCacheRefresh=function(){return T.H.useCacheRefresh()},li.use=function(q){return T.H.use(q)},li.useActionState=function(q,V,K){return T.H.useActionState(q,V,K)},li.useCallback=function(q,V){return T.H.useCallback(q,V)},li.useContext=function(q){return T.H.useContext(q)},li.useDebugValue=function(){},li.useDeferredValue=function(q,V){return T.H.useDeferredValue(q,V)},li.useEffect=function(q,V,K){var ne=T.H;if(typeof K=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ne.useEffect(q,V)},li.useId=function(){return T.H.useId()},li.useImperativeHandle=function(q,V,K){return T.H.useImperativeHandle(q,V,K)},li.useInsertionEffect=function(q,V){return T.H.useInsertionEffect(q,V)},li.useLayoutEffect=function(q,V){return T.H.useLayoutEffect(q,V)},li.useMemo=function(q,V){return T.H.useMemo(q,V)},li.useOptimistic=function(q,V){return T.H.useOptimistic(q,V)},li.useReducer=function(q,V,K){return T.H.useReducer(q,V,K)},li.useRef=function(q){return T.H.useRef(q)},li.useState=function(q){return T.H.useState(q)},li.useSyncExternalStore=function(q,V,K){return T.H.useSyncExternalStore(q,V,K)},li.useTransition=function(){return T.H.useTransition()},li.version="19.1.1",li}var PB;function Fk(){return PB||(PB=1,w3.exports=woe()),w3.exports}var Qe=Fk();const Tf=Dl(Qe);var A3={exports:{}},Sg={};var DB;function Aoe(){return DB||(DB=1,Sg.ConcurrentRoot=1,Sg.ContinuousEventPriority=8,Sg.DefaultEventPriority=32,Sg.DiscreteEventPriority=2,Sg.IdleEventPriority=268435456,Sg.LegacyRoot=0,Sg.NoEventPriority=0),Sg}var LB;function Roe(){return LB||(LB=1,A3.exports=Aoe()),A3.exports}var fC=Roe();const FA="176",Coe=0,UB=1,Moe=2,koe=0,K4=1,dC=2,Cm=3,e_=0,ol=1,Ba=2,Il=0,FE=1,BB=2,FB=3,jB=4,Ooe=5,k1=100,Ioe=101,Noe=102,Poe=103,Doe=104,Loe=200,Uoe=201,Boe=202,Foe=203,dD=204,pD=205,joe=206,zoe=207,Hoe=208,Voe=209,Goe=210,$oe=211,Woe=212,qoe=213,Yoe=214,mD=0,gD=1,_D=2,ZE=3,vD=4,yD=5,bD=6,SD=7,$$=0,Koe=1,Xoe=2,Wg=0,Zoe=1,Joe=2,Qoe=3,W$=4,eae=5,tae=6,nae=7,q$=300,JE=301,QE=302,ED=303,xD=304,jk=306,aM=1e3,D1=1001,TD=1002,cu=1003,rae=1004,VR=1005,ou=1006,R3=1007,L1=1008,Do=1009,Y$=1010,K$=1011,Hw=1012,X4=1013,jv=1014,mp=1015,Jv=1016,Z4=1017,J4=1018,ex=1020,X$=35902,Z$=1021,J$=1022,Du=1023,Vw=1026,tx=1027,jA=1028,Q4=1029,e5=1030,t5=1031,zk=1033,pC=33776,mC=33777,gC=33778,_C=33779,wD=35840,AD=35841,RD=35842,CD=35843,MD=36196,kD=37492,OD=37496,ID=37808,ND=37809,PD=37810,DD=37811,LD=37812,UD=37813,BD=37814,FD=37815,jD=37816,zD=37817,HD=37818,VD=37819,GD=37820,$D=37821,vC=36492,WD=36494,qD=36495,Q$=36283,YD=36284,KD=36285,XD=36286,wb=3200,iae=3201,sae=0,oae=1,Bm="",Oi="srgb",t_="srgb-linear",cM="linear",Cs="srgb",kS=7680,zB=519,aae=512,cae=513,lae=514,eW=515,uae=516,hae=517,fae=518,dae=519,HB=35044,Bg=35048,VB="300 es",Hg=2e3,lM=2001;class c_{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){const r=this._listeners;return r===void 0?!1:r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners;if(r===void 0)return;const i=r[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const r=t[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}}const Jl=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let GB=1234567;const Aw=Math.PI/180,Gw=180/Math.PI;function Lx(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Jl[n&255]+Jl[n>>8&255]+Jl[n>>16&255]+Jl[n>>24&255]+"-"+Jl[e&255]+Jl[e>>8&255]+"-"+Jl[e>>16&15|64]+Jl[e>>24&255]+"-"+Jl[t&63|128]+Jl[t>>8&255]+"-"+Jl[t>>16&255]+Jl[t>>24&255]+Jl[r&255]+Jl[r>>8&255]+Jl[r>>16&255]+Jl[r>>24&255]).toLowerCase()}function Ai(n,e,t){return Math.max(e,Math.min(t,n))}function n5(n,e){return(n%e+e)%e}function pae(n,e,t,r,i){return r+(n-e)*(i-r)/(t-e)}function mae(n,e,t){return n!==e?(t-n)/(e-n):0}function Rw(n,e,t){return(1-t)*n+t*e}function gae(n,e,t,r){return Rw(n,e,1-Math.exp(-t*r))}function _ae(n,e=1){return e-Math.abs(n5(n,e*2)-e)}function vae(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function yae(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function bae(n,e){return n+Math.floor(Math.random()*(e-n+1))}function Sae(n,e){return n+Math.random()*(e-n)}function Eae(n){return n*(.5-Math.random())}function xae(n){n!==void 0&&(GB=n);let e=GB+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Tae(n){return n*Aw}function wae(n){return n*Gw}function Aae(n){return(n&n-1)===0&&n!==0}function Rae(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Cae(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function Mae(n,e,t,r,i){const s=Math.cos,o=Math.sin,a=s(t/2),c=o(t/2),l=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),f=o((e-r)/2),d=s((r-e)/2),p=o((r-e)/2);switch(i){case"XYX":n.set(a*u,c*h,c*f,a*l);break;case"YZY":n.set(c*f,a*u,c*h,a*l);break;case"ZXZ":n.set(c*h,c*f,a*u,a*l);break;case"XZX":n.set(a*u,c*p,c*d,a*l);break;case"YXY":n.set(c*d,a*u,c*p,a*l);break;case"ZYZ":n.set(c*p,c*d,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function dE(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Au(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const tW={DEG2RAD:Aw,RAD2DEG:Gw,generateUUID:Lx,clamp:Ai,euclideanModulo:n5,mapLinear:pae,inverseLerp:mae,lerp:Rw,damp:gae,pingpong:_ae,smoothstep:vae,smootherstep:yae,randInt:bae,randFloat:Sae,randFloatSpread:Eae,seededRandom:xae,degToRad:Tae,radToDeg:wae,isPowerOfTwo:Aae,ceilPowerOfTwo:Rae,floorPowerOfTwo:Cae,setQuaternionFromProperEuler:Mae,normalize:Au,denormalize:dE};class Nn{constructor(e=0,t=0){Nn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Ai(this.x,e.x,t.x),this.y=Ai(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Ai(this.x,e,t),this.y=Ai(this.y,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Ai(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Ai(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class hi{constructor(e,t,r,i,s,o,a,c,l){hi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,s,o,a,c,l)}set(e,t,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],h=r[7],f=r[2],d=r[5],p=r[8],_=i[0],g=i[3],m=i[6],b=i[1],y=i[4],x=i[7],T=i[2],k=i[5],R=i[8];return s[0]=o*_+a*b+c*T,s[3]=o*g+a*y+c*k,s[6]=o*m+a*x+c*R,s[1]=l*_+u*b+h*T,s[4]=l*g+u*y+h*k,s[7]=l*m+u*x+h*R,s[2]=f*_+d*b+p*T,s[5]=f*g+d*y+p*k,s[8]=f*m+d*x+p*R,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,f=a*c-u*s,d=l*s-o*c,p=t*h+r*f+i*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/p;return e[0]=h*_,e[1]=(i*l-u*r)*_,e[2]=(a*r-i*o)*_,e[3]=f*_,e[4]=(u*t-i*c)*_,e[5]=(i*s-a*t)*_,e[6]=d*_,e[7]=(r*c-l*t)*_,e[8]=(o*t-r*s)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(C3.makeScale(e,t)),this}rotate(e){return this.premultiply(C3.makeRotation(-e)),this}translate(e,t){return this.premultiply(C3.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const C3=new hi;function nW(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function $w(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function kae(){const n=$w("canvas");return n.style.display="block",n}const $B={};function yC(n){n in $B||($B[n]=!0,console.warn(n))}function Oae(n,e,t){return new Promise(function(r,i){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:i();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:r()}}setTimeout(s,t)})}function Iae(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function Nae(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const WB=new hi().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),qB=new hi().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Pae(){const n={enabled:!0,workingColorSpace:t_,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===Cs&&(i.r=qg(i.r),i.g=qg(i.g),i.b=qg(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Cs&&(i.r=jE(i.r),i.g=jE(i.g),i.b=jE(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===Bm?cM:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],r=[.3127,.329];return n.define({[t_]:{primaries:e,whitePoint:r,transfer:cM,toXYZ:WB,fromXYZ:qB,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Oi},outputColorSpaceConfig:{drawingBufferColorSpace:Oi}},[Oi]:{primaries:e,whitePoint:r,transfer:Cs,toXYZ:WB,fromXYZ:qB,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Oi}}}),n}const zi=Pae();function qg(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function jE(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let OS;class Dae{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let r;if(e instanceof HTMLCanvasElement)r=e;else{OS===void 0&&(OS=$w("canvas")),OS.width=e.width,OS.height=e.height;const i=OS.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),r=OS}return r.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=$w("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=qg(s[o]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(qg(t[r]/255)*255):t[r]=qg(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Lae=0,r5=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Lae++}),this.uuid=Lx(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?s.push(M3(i[o].image)):s.push(M3(i[o]))}else s=M3(i);r.url=s}return t||(e.images[this.uuid]=r),r}};function M3(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?Dae.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Uae=0;class kc extends c_{constructor(e=kc.DEFAULT_IMAGE,t=kc.DEFAULT_MAPPING,r=D1,i=D1,s=ou,o=L1,a=Du,c=Do,l=kc.DEFAULT_ANISOTROPY,u=Bm){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Uae++}),this.uuid=Lx(),this.name="",this.source=new r5(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=c,this.offset=new Nn(0,0),this.repeat=new Nn(1,1),this.center=new Nn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new hi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isTextureArray=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isTextureArray=e.isTextureArray,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==q$)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case aM:e.x=e.x-Math.floor(e.x);break;case D1:e.x=e.x<0?0:1;break;case TD:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case aM:e.y=e.y-Math.floor(e.y);break;case D1:e.y=e.y<0?0:1;break;case TD:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}kc.DEFAULT_IMAGE=null;kc.DEFAULT_MAPPING=q$;kc.DEFAULT_ANISOTROPY=1;class Zo{constructor(e=0,t=0,r=0,i=1){Zo.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*s,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*s,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*s,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,s;const c=e.elements,l=c[0],u=c[4],h=c[8],f=c[1],d=c[5],p=c[9],_=c[2],g=c[6],m=c[10];if(Math.abs(u-f)<.01&&Math.abs(h-_)<.01&&Math.abs(p-g)<.01){if(Math.abs(u+f)<.1&&Math.abs(h+_)<.1&&Math.abs(p+g)<.1&&Math.abs(l+d+m-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(l+1)/2,x=(d+1)/2,T=(m+1)/2,k=(u+f)/4,R=(h+_)/4,P=(p+g)/4;return y>x&&y>T?y<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(y),i=k/r,s=R/r):x>T?x<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(x),r=k/i,s=P/i):T<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(T),r=R/s,i=P/s),this.set(r,i,s,t),this}let b=Math.sqrt((g-p)*(g-p)+(h-_)*(h-_)+(f-u)*(f-u));return Math.abs(b)<.001&&(b=1),this.x=(g-p)/b,this.y=(h-_)/b,this.z=(f-u)/b,this.w=Math.acos((l+d+m-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Ai(this.x,e.x,t.x),this.y=Ai(this.y,e.y,t.y),this.z=Ai(this.z,e.z,t.z),this.w=Ai(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Ai(this.x,e,t),this.y=Ai(this.y,e,t),this.z=Ai(this.z,e,t),this.w=Ai(this.w,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Ai(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Bae extends c_{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=r.depth?r.depth:1,this.scissor=new Zo(0,0,e,t),this.scissorTest=!1,this.viewport=new Zo(0,0,e,t);const i={width:e,height:t,depth:this.depth};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ou,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,multiview:!1},r);const s=new kc(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);s.flipY=!1,s.generateMipmaps=r.generateMipmaps,s.internalFormat=r.internalFormat,this.textures=[];const o=r.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples,this.multiview=r.multiview}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,r=e.textures.length;t<r;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new r5(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Nl extends Bae{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class rW extends kc{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=cu,this.minFilter=cu,this.wrapR=D1,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Fae extends kc{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=cu,this.minFilter=cu,this.wrapR=D1,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class zA{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,s,o,a){let c=r[i+0],l=r[i+1],u=r[i+2],h=r[i+3];const f=s[o+0],d=s[o+1],p=s[o+2],_=s[o+3];if(a===0){e[t+0]=c,e[t+1]=l,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=f,e[t+1]=d,e[t+2]=p,e[t+3]=_;return}if(h!==_||c!==f||l!==d||u!==p){let g=1-a;const m=c*f+l*d+u*p+h*_,b=m>=0?1:-1,y=1-m*m;if(y>Number.EPSILON){const T=Math.sqrt(y),k=Math.atan2(T,m*b);g=Math.sin(g*k)/T,a=Math.sin(a*k)/T}const x=a*b;if(c=c*g+f*x,l=l*g+d*x,u=u*g+p*x,h=h*g+_*x,g===1-a){const T=1/Math.sqrt(c*c+l*l+u*u+h*h);c*=T,l*=T,u*=T,h*=T}}e[t]=c,e[t+1]=l,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,r,i,s,o){const a=r[i],c=r[i+1],l=r[i+2],u=r[i+3],h=s[o],f=s[o+1],d=s[o+2],p=s[o+3];return e[t]=a*p+u*h+c*d-l*f,e[t+1]=c*p+u*f+l*h-a*d,e[t+2]=l*p+u*d+a*f-c*h,e[t+3]=u*p-a*h-c*f-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,i=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(r/2),u=a(i/2),h=a(s/2),f=c(r/2),d=c(i/2),p=c(s/2);switch(o){case"XYZ":this._x=f*u*h+l*d*p,this._y=l*d*h-f*u*p,this._z=l*u*p+f*d*h,this._w=l*u*h-f*d*p;break;case"YXZ":this._x=f*u*h+l*d*p,this._y=l*d*h-f*u*p,this._z=l*u*p-f*d*h,this._w=l*u*h+f*d*p;break;case"ZXY":this._x=f*u*h-l*d*p,this._y=l*d*h+f*u*p,this._z=l*u*p+f*d*h,this._w=l*u*h-f*d*p;break;case"ZYX":this._x=f*u*h-l*d*p,this._y=l*d*h+f*u*p,this._z=l*u*p-f*d*h,this._w=l*u*h+f*d*p;break;case"YZX":this._x=f*u*h+l*d*p,this._y=l*d*h+f*u*p,this._z=l*u*p-f*d*h,this._w=l*u*h-f*d*p;break;case"XZY":this._x=f*u*h-l*d*p,this._y=l*d*h-f*u*p,this._z=l*u*p+f*d*h,this._w=l*u*h+f*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],s=t[8],o=t[1],a=t[5],c=t[9],l=t[2],u=t[6],h=t[10],f=r+a+h;if(f>0){const d=.5/Math.sqrt(f+1);this._w=.25/d,this._x=(u-c)*d,this._y=(s-l)*d,this._z=(o-i)*d}else if(r>a&&r>h){const d=2*Math.sqrt(1+r-a-h);this._w=(u-c)/d,this._x=.25*d,this._y=(i+o)/d,this._z=(s+l)/d}else if(a>h){const d=2*Math.sqrt(1+a-r-h);this._w=(s-l)/d,this._x=(i+o)/d,this._y=.25*d,this._z=(c+u)/d}else{const d=2*Math.sqrt(1+h-r-a);this._w=(o-i)/d,this._x=(s+l)/d,this._y=(c+u)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ai(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,s=e._z,o=e._w,a=t._x,c=t._y,l=t._z,u=t._w;return this._x=r*u+o*a+i*l-s*c,this._y=i*u+o*c+s*a-r*l,this._z=s*u+o*l+r*c-i*a,this._w=o*u-r*a-i*c-s*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,s=this._z,o=this._w;let a=o*e._w+r*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const d=1-t;return this._w=d*o+t*this._w,this._x=d*r+t*this._x,this._y=d*i+t*this._y,this._z=d*s+t*this._z,this.normalize(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),h=Math.sin((1-t)*u)/l,f=Math.sin(t*u)/l;return this._w=o*h+this._w*f,this._x=r*h+this._x*f,this._y=i*h+this._y*f,this._z=s*h+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Lt{constructor(e=0,t=0,r=0){Lt.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(YB.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(YB.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*r+s[6]*i,this.y=s[1]*t+s[4]*r+s[7]*i,this.z=s[2]*t+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=e.elements,o=1/(s[3]*t+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*r+s[8]*i+s[12])*o,this.y=(s[1]*t+s[5]*r+s[9]*i+s[13])*o,this.z=(s[2]*t+s[6]*r+s[10]*i+s[14])*o,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,s=e.x,o=e.y,a=e.z,c=e.w,l=2*(o*i-a*r),u=2*(a*t-s*i),h=2*(s*r-o*t);return this.x=t+c*l+o*h-a*u,this.y=r+c*u+a*l-s*h,this.z=i+c*h+s*u-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i,this.y=s[1]*t+s[5]*r+s[9]*i,this.z=s[2]*t+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Ai(this.x,e.x,t.x),this.y=Ai(this.y,e.y,t.y),this.z=Ai(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Ai(this.x,e,t),this.y=Ai(this.y,e,t),this.z=Ai(this.z,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Ai(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,s=e.z,o=t.x,a=t.y,c=t.z;return this.x=i*c-s*a,this.y=s*o-r*c,this.z=r*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return k3.copy(this).projectOnVector(e),this.sub(k3)}reflect(e){return this.sub(k3.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Ai(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const k3=new Lt,YB=new zA;class Ab{constructor(e=new Lt(1/0,1/0,1/0),t=new Lt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(ep.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(ep.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=ep.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const s=r.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,ep):ep.fromBufferAttribute(s,o),ep.applyMatrix4(e.matrixWorld),this.expandByPoint(ep);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),GR.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),GR.copy(r.boundingBox)),GR.applyMatrix4(e.matrixWorld),this.union(GR)}const i=e.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,ep),ep.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(MT),$R.subVectors(this.max,MT),IS.subVectors(e.a,MT),NS.subVectors(e.b,MT),PS.subVectors(e.c,MT),ov.subVectors(NS,IS),av.subVectors(PS,NS),i1.subVectors(IS,PS);let t=[0,-ov.z,ov.y,0,-av.z,av.y,0,-i1.z,i1.y,ov.z,0,-ov.x,av.z,0,-av.x,i1.z,0,-i1.x,-ov.y,ov.x,0,-av.y,av.x,0,-i1.y,i1.x,0];return!O3(t,IS,NS,PS,$R)||(t=[1,0,0,0,1,0,0,0,1],!O3(t,IS,NS,PS,$R))?!1:(WR.crossVectors(ov,av),t=[WR.x,WR.y,WR.z],O3(t,IS,NS,PS,$R))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ep).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(ep).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Eg[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Eg[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Eg[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Eg[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Eg[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Eg[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Eg[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Eg[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Eg),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Eg=[new Lt,new Lt,new Lt,new Lt,new Lt,new Lt,new Lt,new Lt],ep=new Lt,GR=new Ab,IS=new Lt,NS=new Lt,PS=new Lt,ov=new Lt,av=new Lt,i1=new Lt,MT=new Lt,$R=new Lt,WR=new Lt,s1=new Lt;function O3(n,e,t,r,i){for(let s=0,o=n.length-3;s<=o;s+=3){s1.fromArray(n,s);const a=i.x*Math.abs(s1.x)+i.y*Math.abs(s1.y)+i.z*Math.abs(s1.z),c=e.dot(s1),l=t.dot(s1),u=r.dot(s1);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const jae=new Ab,kT=new Lt,I3=new Lt;class Ux{constructor(e=new Lt,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):jae.setFromPoints(e).getCenter(r);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;kT.subVectors(e,this.center);const t=kT.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(kT,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(I3.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(kT.copy(e.center).add(I3)),this.expandByPoint(kT.copy(e.center).sub(I3))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const xg=new Lt,N3=new Lt,qR=new Lt,cv=new Lt,P3=new Lt,YR=new Lt,D3=new Lt;class i5{constructor(e=new Lt,t=new Lt(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,xg)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=xg.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(xg.copy(this.origin).addScaledVector(this.direction,t),xg.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){N3.copy(e).add(t).multiplyScalar(.5),qR.copy(t).sub(e).normalize(),cv.copy(this.origin).sub(N3);const s=e.distanceTo(t)*.5,o=-this.direction.dot(qR),a=cv.dot(this.direction),c=-cv.dot(qR),l=cv.lengthSq(),u=Math.abs(1-o*o);let h,f,d,p;if(u>0)if(h=o*c-a,f=o*a-c,p=s*u,h>=0)if(f>=-p)if(f<=p){const _=1/u;h*=_,f*=_,d=h*(h+o*f+2*a)+f*(o*h+f+2*c)+l}else f=s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*c)+l;else f=-s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*c)+l;else f<=-p?(h=Math.max(0,-(-o*s+a)),f=h>0?-s:Math.min(Math.max(-s,-c),s),d=-h*h+f*(f+2*c)+l):f<=p?(h=0,f=Math.min(Math.max(-s,-c),s),d=f*(f+2*c)+l):(h=Math.max(0,-(o*s+a)),f=h>0?s:Math.min(Math.max(-s,-c),s),d=-h*h+f*(f+2*c)+l);else f=o>0?-s:s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*c)+l;return r&&r.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(N3).addScaledVector(qR,f),d}intersectSphere(e,t){xg.subVectors(e.center,this.origin);const r=xg.dot(this.direction),i=xg.dot(xg)-r*r,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),a=r-o,c=r+o;return c<0?null:a<0?this.at(c,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,s,o,a,c;const l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,f=this.origin;return l>=0?(r=(e.min.x-f.x)*l,i=(e.max.x-f.x)*l):(r=(e.max.x-f.x)*l,i=(e.min.x-f.x)*l),u>=0?(s=(e.min.y-f.y)*u,o=(e.max.y-f.y)*u):(s=(e.max.y-f.y)*u,o=(e.min.y-f.y)*u),r>o||s>i||((s>r||isNaN(r))&&(r=s),(o<i||isNaN(i))&&(i=o),h>=0?(a=(e.min.z-f.z)*h,c=(e.max.z-f.z)*h):(a=(e.max.z-f.z)*h,c=(e.min.z-f.z)*h),r>c||a>i)||((a>r||r!==r)&&(r=a),(c<i||i!==i)&&(i=c),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,xg)!==null}intersectTriangle(e,t,r,i,s){P3.subVectors(t,e),YR.subVectors(r,e),D3.crossVectors(P3,YR);let o=this.direction.dot(D3),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;cv.subVectors(this.origin,e);const c=a*this.direction.dot(YR.crossVectors(cv,YR));if(c<0)return null;const l=a*this.direction.dot(P3.cross(cv));if(l<0||c+l>o)return null;const u=-a*cv.dot(D3);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class vo{constructor(e,t,r,i,s,o,a,c,l,u,h,f,d,p,_,g){vo.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,s,o,a,c,l,u,h,f,d,p,_,g)}set(e,t,r,i,s,o,a,c,l,u,h,f,d,p,_,g){const m=this.elements;return m[0]=e,m[4]=t,m[8]=r,m[12]=i,m[1]=s,m[5]=o,m[9]=a,m[13]=c,m[2]=l,m[6]=u,m[10]=h,m[14]=f,m[3]=d,m[7]=p,m[11]=_,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new vo().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/DS.setFromMatrixColumn(e,0).length(),s=1/DS.setFromMatrixColumn(e,1).length(),o=1/DS.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*s,t[5]=r[5]*s,t[6]=r[6]*s,t[7]=0,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),a=Math.sin(r),c=Math.cos(i),l=Math.sin(i),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const f=o*u,d=o*h,p=a*u,_=a*h;t[0]=c*u,t[4]=-c*h,t[8]=l,t[1]=d+p*l,t[5]=f-_*l,t[9]=-a*c,t[2]=_-f*l,t[6]=p+d*l,t[10]=o*c}else if(e.order==="YXZ"){const f=c*u,d=c*h,p=l*u,_=l*h;t[0]=f+_*a,t[4]=p*a-d,t[8]=o*l,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=d*a-p,t[6]=_+f*a,t[10]=o*c}else if(e.order==="ZXY"){const f=c*u,d=c*h,p=l*u,_=l*h;t[0]=f-_*a,t[4]=-o*h,t[8]=p+d*a,t[1]=d+p*a,t[5]=o*u,t[9]=_-f*a,t[2]=-o*l,t[6]=a,t[10]=o*c}else if(e.order==="ZYX"){const f=o*u,d=o*h,p=a*u,_=a*h;t[0]=c*u,t[4]=p*l-d,t[8]=f*l+_,t[1]=c*h,t[5]=_*l+f,t[9]=d*l-p,t[2]=-l,t[6]=a*c,t[10]=o*c}else if(e.order==="YZX"){const f=o*c,d=o*l,p=a*c,_=a*l;t[0]=c*u,t[4]=_-f*h,t[8]=p*h+d,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=d*h+p,t[10]=f-_*h}else if(e.order==="XZY"){const f=o*c,d=o*l,p=a*c,_=a*l;t[0]=c*u,t[4]=-h,t[8]=l*u,t[1]=f*h+_,t[5]=o*u,t[9]=d*h-p,t[2]=p*h-d,t[6]=a*u,t[10]=_*h+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(zae,e,Hae)}lookAt(e,t,r){const i=this.elements;return mf.subVectors(e,t),mf.lengthSq()===0&&(mf.z=1),mf.normalize(),lv.crossVectors(r,mf),lv.lengthSq()===0&&(Math.abs(r.z)===1?mf.x+=1e-4:mf.z+=1e-4,mf.normalize(),lv.crossVectors(r,mf)),lv.normalize(),KR.crossVectors(mf,lv),i[0]=lv.x,i[4]=KR.x,i[8]=mf.x,i[1]=lv.y,i[5]=KR.y,i[9]=mf.y,i[2]=lv.z,i[6]=KR.z,i[10]=mf.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,o=r[0],a=r[4],c=r[8],l=r[12],u=r[1],h=r[5],f=r[9],d=r[13],p=r[2],_=r[6],g=r[10],m=r[14],b=r[3],y=r[7],x=r[11],T=r[15],k=i[0],R=i[4],P=i[8],B=i[12],U=i[1],z=i[5],I=i[9],L=i[13],M=i[2],F=i[6],Z=i[10],$=i[14],Y=i[3],Q=i[7],q=i[11],V=i[15];return s[0]=o*k+a*U+c*M+l*Y,s[4]=o*R+a*z+c*F+l*Q,s[8]=o*P+a*I+c*Z+l*q,s[12]=o*B+a*L+c*$+l*V,s[1]=u*k+h*U+f*M+d*Y,s[5]=u*R+h*z+f*F+d*Q,s[9]=u*P+h*I+f*Z+d*q,s[13]=u*B+h*L+f*$+d*V,s[2]=p*k+_*U+g*M+m*Y,s[6]=p*R+_*z+g*F+m*Q,s[10]=p*P+_*I+g*Z+m*q,s[14]=p*B+_*L+g*$+m*V,s[3]=b*k+y*U+x*M+T*Y,s[7]=b*R+y*z+x*F+T*Q,s[11]=b*P+y*I+x*Z+T*q,s[15]=b*B+y*L+x*$+T*V,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],s=e[12],o=e[1],a=e[5],c=e[9],l=e[13],u=e[2],h=e[6],f=e[10],d=e[14],p=e[3],_=e[7],g=e[11],m=e[15];return p*(+s*c*h-i*l*h-s*a*f+r*l*f+i*a*d-r*c*d)+_*(+t*c*d-t*l*f+s*o*f-i*o*d+i*l*u-s*c*u)+g*(+t*l*h-t*a*d-s*o*h+r*o*d+s*a*u-r*l*u)+m*(-i*a*u-t*c*h+t*a*f+i*o*h-r*o*f+r*c*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],f=e[10],d=e[11],p=e[12],_=e[13],g=e[14],m=e[15],b=h*g*l-_*f*l+_*c*d-a*g*d-h*c*m+a*f*m,y=p*f*l-u*g*l-p*c*d+o*g*d+u*c*m-o*f*m,x=u*_*l-p*h*l+p*a*d-o*_*d-u*a*m+o*h*m,T=p*h*c-u*_*c-p*a*f+o*_*f+u*a*g-o*h*g,k=t*b+r*y+i*x+s*T;if(k===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const R=1/k;return e[0]=b*R,e[1]=(_*f*s-h*g*s-_*i*d+r*g*d+h*i*m-r*f*m)*R,e[2]=(a*g*s-_*c*s+_*i*l-r*g*l-a*i*m+r*c*m)*R,e[3]=(h*c*s-a*f*s-h*i*l+r*f*l+a*i*d-r*c*d)*R,e[4]=y*R,e[5]=(u*g*s-p*f*s+p*i*d-t*g*d-u*i*m+t*f*m)*R,e[6]=(p*c*s-o*g*s-p*i*l+t*g*l+o*i*m-t*c*m)*R,e[7]=(o*f*s-u*c*s+u*i*l-t*f*l-o*i*d+t*c*d)*R,e[8]=x*R,e[9]=(p*h*s-u*_*s-p*r*d+t*_*d+u*r*m-t*h*m)*R,e[10]=(o*_*s-p*a*s+p*r*l-t*_*l-o*r*m+t*a*m)*R,e[11]=(u*a*s-o*h*s-u*r*l+t*h*l+o*r*d-t*a*d)*R,e[12]=T*R,e[13]=(u*_*i-p*h*i+p*r*f-t*_*f-u*r*g+t*h*g)*R,e[14]=(p*a*i-o*_*i-p*r*c+t*_*c+o*r*g-t*a*g)*R,e[15]=(o*h*i-u*a*i+u*r*c-t*h*c-o*r*f+t*a*f)*R,this}scale(e){const t=this.elements,r=e.x,i=e.y,s=e.z;return t[0]*=r,t[4]*=i,t[8]*=s,t[1]*=r,t[5]*=i,t[9]*=s,t[2]*=r,t[6]*=i,t[10]*=s,t[3]*=r,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),s=1-r,o=e.x,a=e.y,c=e.z,l=s*o,u=s*a;return this.set(l*o+r,l*a-i*c,l*c+i*a,0,l*a+i*c,u*a+r,u*c-i*o,0,l*c-i*a,u*c+i*o,s*c*c+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,s,o){return this.set(1,r,s,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,s=t._x,o=t._y,a=t._z,c=t._w,l=s+s,u=o+o,h=a+a,f=s*l,d=s*u,p=s*h,_=o*u,g=o*h,m=a*h,b=c*l,y=c*u,x=c*h,T=r.x,k=r.y,R=r.z;return i[0]=(1-(_+m))*T,i[1]=(d+x)*T,i[2]=(p-y)*T,i[3]=0,i[4]=(d-x)*k,i[5]=(1-(f+m))*k,i[6]=(g+b)*k,i[7]=0,i[8]=(p+y)*R,i[9]=(g-b)*R,i[10]=(1-(f+_))*R,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let s=DS.set(i[0],i[1],i[2]).length();const o=DS.set(i[4],i[5],i[6]).length(),a=DS.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],tp.copy(this);const l=1/s,u=1/o,h=1/a;return tp.elements[0]*=l,tp.elements[1]*=l,tp.elements[2]*=l,tp.elements[4]*=u,tp.elements[5]*=u,tp.elements[6]*=u,tp.elements[8]*=h,tp.elements[9]*=h,tp.elements[10]*=h,t.setFromRotationMatrix(tp),r.x=s,r.y=o,r.z=a,this}makePerspective(e,t,r,i,s,o,a=Hg){const c=this.elements,l=2*s/(t-e),u=2*s/(r-i),h=(t+e)/(t-e),f=(r+i)/(r-i);let d,p;if(a===Hg)d=-(o+s)/(o-s),p=-2*o*s/(o-s);else if(a===lM)d=-o/(o-s),p=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=l,c[4]=0,c[8]=h,c[12]=0,c[1]=0,c[5]=u,c[9]=f,c[13]=0,c[2]=0,c[6]=0,c[10]=d,c[14]=p,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,r,i,s,o,a=Hg){const c=this.elements,l=1/(t-e),u=1/(r-i),h=1/(o-s),f=(t+e)*l,d=(r+i)*u;let p,_;if(a===Hg)p=(o+s)*h,_=-2*h;else if(a===lM)p=s*h,_=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-f,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-d,c[2]=0,c[6]=0,c[10]=_,c[14]=-p,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const DS=new Lt,tp=new vo,zae=new Lt(0,0,0),Hae=new Lt(1,1,1),lv=new Lt,KR=new Lt,mf=new Lt,KB=new vo,XB=new zA;class t0{constructor(e=0,t=0,r=0,i=t0.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,s=i[0],o=i[4],a=i[8],c=i[1],l=i[5],u=i[9],h=i[2],f=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(Ai(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(f,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Ai(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Ai(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-Ai(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Ai(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Ai(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return KB.makeRotationFromQuaternion(e),this.setFromRotationMatrix(KB,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return XB.setFromEuler(this),this.setFromQuaternion(XB,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}t0.DEFAULT_ORDER="XYZ";class Ww{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Vae=0;const ZB=new Lt,LS=new zA,Tg=new vo,XR=new Lt,OT=new Lt,Gae=new Lt,$ae=new zA,JB=new Lt(1,0,0),QB=new Lt(0,1,0),eF=new Lt(0,0,1),tF={type:"added"},Wae={type:"removed"},US={type:"childadded",child:null},L3={type:"childremoved",child:null};class al extends c_{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Vae++}),this.uuid=Lx(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=al.DEFAULT_UP.clone();const e=new Lt,t=new t0,r=new zA,i=new Lt(1,1,1);function s(){r.setFromEuler(t,!1)}function o(){t.setFromQuaternion(r,void 0,!1)}t._onChange(s),r._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new vo},normalMatrix:{value:new hi}}),this.matrix=new vo,this.matrixWorld=new vo,this.matrixAutoUpdate=al.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=al.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Ww,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return LS.setFromAxisAngle(e,t),this.quaternion.multiply(LS),this}rotateOnWorldAxis(e,t){return LS.setFromAxisAngle(e,t),this.quaternion.premultiply(LS),this}rotateX(e){return this.rotateOnAxis(JB,e)}rotateY(e){return this.rotateOnAxis(QB,e)}rotateZ(e){return this.rotateOnAxis(eF,e)}translateOnAxis(e,t){return ZB.copy(e).applyQuaternion(this.quaternion),this.position.add(ZB.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(JB,e)}translateY(e){return this.translateOnAxis(QB,e)}translateZ(e){return this.translateOnAxis(eF,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Tg.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?XR.copy(e):XR.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),OT.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Tg.lookAt(OT,XR,this.up):Tg.lookAt(XR,OT,this.up),this.quaternion.setFromRotationMatrix(Tg),i&&(Tg.extractRotation(i.matrixWorld),LS.setFromRotationMatrix(Tg),this.quaternion.premultiply(LS.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(tF),US.child=e,this.dispatchEvent(US),US.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Wae),L3.child=e,this.dispatchEvent(L3),L3.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Tg.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Tg.multiply(e.parent.matrixWorld)),e.applyMatrix4(Tg),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(tF),US.child=e,this.dispatchEvent(US),US.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const o=this.children[r].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(OT,e,Gae),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(OT,$ae,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(a=>({...a,boundingBox:a.boundingBox?{min:a.boundingBox.min.toArray(),max:a.boundingBox.max.toArray()}:void 0,boundingSphere:a.boundingSphere?{radius:a.boundingSphere.radius,center:a.boundingSphere.center.toArray()}:void 0})),i.instanceInfo=this._instanceInfo.map(a=>({...a})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere={center:this.boundingSphere.center.toArray(),radius:this.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:this.boundingBox.min.toArray(),max:this.boundingBox.max.toArray()}));function s(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let l=0,u=c.length;l<u;l++){const h=c[l];s(e.shapes,h)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,l=this.material.length;c<l;c++)a.push(s(e.materials,this.material[c]));i.material=a}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];i.animations.push(s(e.animations,c))}}if(t){const a=o(e.geometries),c=o(e.materials),l=o(e.textures),u=o(e.images),h=o(e.shapes),f=o(e.skeletons),d=o(e.animations),p=o(e.nodes);a.length>0&&(r.geometries=a),c.length>0&&(r.materials=c),l.length>0&&(r.textures=l),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),f.length>0&&(r.skeletons=f),d.length>0&&(r.animations=d),p.length>0&&(r.nodes=p)}return r.object=i,r;function o(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}al.DEFAULT_UP=new Lt(0,1,0);al.DEFAULT_MATRIX_AUTO_UPDATE=!0;al.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const np=new Lt,wg=new Lt,U3=new Lt,Ag=new Lt,BS=new Lt,FS=new Lt,nF=new Lt,B3=new Lt,F3=new Lt,j3=new Lt,z3=new Zo,H3=new Zo,V3=new Zo;class pp{constructor(e=new Lt,t=new Lt,r=new Lt){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),np.subVectors(e,t),i.cross(np);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,r,i,s){np.subVectors(i,t),wg.subVectors(r,t),U3.subVectors(e,t);const o=np.dot(np),a=np.dot(wg),c=np.dot(U3),l=wg.dot(wg),u=wg.dot(U3),h=o*l-a*a;if(h===0)return s.set(0,0,0),null;const f=1/h,d=(l*c-a*u)*f,p=(o*u-a*c)*f;return s.set(1-d-p,p,d)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,Ag)===null?!1:Ag.x>=0&&Ag.y>=0&&Ag.x+Ag.y<=1}static getInterpolation(e,t,r,i,s,o,a,c){return this.getBarycoord(e,t,r,i,Ag)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,Ag.x),c.addScaledVector(o,Ag.y),c.addScaledVector(a,Ag.z),c)}static getInterpolatedAttribute(e,t,r,i,s,o){return z3.setScalar(0),H3.setScalar(0),V3.setScalar(0),z3.fromBufferAttribute(e,t),H3.fromBufferAttribute(e,r),V3.fromBufferAttribute(e,i),o.setScalar(0),o.addScaledVector(z3,s.x),o.addScaledVector(H3,s.y),o.addScaledVector(V3,s.z),o}static isFrontFacing(e,t,r,i){return np.subVectors(r,t),wg.subVectors(e,t),np.cross(wg).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return np.subVectors(this.c,this.b),wg.subVectors(this.a,this.b),np.cross(wg).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return pp.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return pp.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,i,s){return pp.getInterpolation(e,this.a,this.b,this.c,t,r,i,s)}containsPoint(e){return pp.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return pp.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,s=this.c;let o,a;BS.subVectors(i,r),FS.subVectors(s,r),B3.subVectors(e,r);const c=BS.dot(B3),l=FS.dot(B3);if(c<=0&&l<=0)return t.copy(r);F3.subVectors(e,i);const u=BS.dot(F3),h=FS.dot(F3);if(u>=0&&h<=u)return t.copy(i);const f=c*h-u*l;if(f<=0&&c>=0&&u<=0)return o=c/(c-u),t.copy(r).addScaledVector(BS,o);j3.subVectors(e,s);const d=BS.dot(j3),p=FS.dot(j3);if(p>=0&&d<=p)return t.copy(s);const _=d*l-c*p;if(_<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(r).addScaledVector(FS,a);const g=u*p-d*h;if(g<=0&&h-u>=0&&d-p>=0)return nF.subVectors(s,i),a=(h-u)/(h-u+(d-p)),t.copy(i).addScaledVector(nF,a);const m=1/(g+_+f);return o=_*m,a=f*m,t.copy(r).addScaledVector(BS,o).addScaledVector(FS,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const iW={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},uv={h:0,s:0,l:0},ZR={h:0,s:0,l:0};function G3(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class gi{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Oi){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,zi.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=zi.workingColorSpace){return this.r=e,this.g=t,this.b=r,zi.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=zi.workingColorSpace){if(e=n5(e,1),t=Ai(t,0,1),r=Ai(r,0,1),t===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+t):r+t-r*t,o=2*r-s;this.r=G3(o,s,e+1/3),this.g=G3(o,s,e),this.b=G3(o,s,e-1/3)}return zi.toWorkingColorSpace(this,i),this}setStyle(e,t=Oi){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Oi){const r=iW[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=qg(e.r),this.g=qg(e.g),this.b=qg(e.b),this}copyLinearToSRGB(e){return this.r=jE(e.r),this.g=jE(e.g),this.b=jE(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Oi){return zi.fromWorkingColorSpace(Ql.copy(this),e),Math.round(Ai(Ql.r*255,0,255))*65536+Math.round(Ai(Ql.g*255,0,255))*256+Math.round(Ai(Ql.b*255,0,255))}getHexString(e=Oi){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=zi.workingColorSpace){zi.fromWorkingColorSpace(Ql.copy(this),t);const r=Ql.r,i=Ql.g,s=Ql.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const h=o-a;switch(l=u<=.5?h/(o+a):h/(2-o-a),o){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,t=zi.workingColorSpace){return zi.fromWorkingColorSpace(Ql.copy(this),t),e.r=Ql.r,e.g=Ql.g,e.b=Ql.b,e}getStyle(e=Oi){zi.fromWorkingColorSpace(Ql.copy(this),e);const t=Ql.r,r=Ql.g,i=Ql.b;return e!==Oi?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,t,r){return this.getHSL(uv),this.setHSL(uv.h+e,uv.s+t,uv.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(uv),e.getHSL(ZR);const r=Rw(uv.h,ZR.h,t),i=Rw(uv.s,ZR.s,t),s=Rw(uv.l,ZR.l,t);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*r+s[6]*i,this.g=s[1]*t+s[4]*r+s[7]*i,this.b=s[2]*t+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ql=new gi;gi.NAMES=iW;let qae=0;class Rb extends c_{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:qae++}),this.uuid=Lx(),this.name="",this.type="Material",this.blending=FE,this.side=e_,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=dD,this.blendDst=pD,this.blendEquation=k1,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new gi(0,0,0),this.blendAlpha=0,this.depthFunc=ZE,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=zB,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=kS,this.stencilZFail=kS,this.stencilZPass=kS,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==FE&&(r.blending=this.blending),this.side!==e_&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==dD&&(r.blendSrc=this.blendSrc),this.blendDst!==pD&&(r.blendDst=this.blendDst),this.blendEquation!==k1&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==ZE&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==zB&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==kS&&(r.stencilFail=this.stencilFail),this.stencilZFail!==kS&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==kS&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(t){const s=i(e.textures),o=i(e.images);s.length>0&&(r.textures=s),o.length>0&&(r.images=o)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=t[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class s5 extends Rb{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new gi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new t0,this.combine=$$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Qa=new Lt,JR=new Nn;let Yae=0;class Dh{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Yae++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=HB,this.updateRanges=[],this.gpuType=mp,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)JR.fromBufferAttribute(this,t),JR.applyMatrix3(e),this.setXY(t,JR.x,JR.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)Qa.fromBufferAttribute(this,t),Qa.applyMatrix3(e),this.setXYZ(t,Qa.x,Qa.y,Qa.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)Qa.fromBufferAttribute(this,t),Qa.applyMatrix4(e),this.setXYZ(t,Qa.x,Qa.y,Qa.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)Qa.fromBufferAttribute(this,t),Qa.applyNormalMatrix(e),this.setXYZ(t,Qa.x,Qa.y,Qa.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)Qa.fromBufferAttribute(this,t),Qa.transformDirection(e),this.setXYZ(t,Qa.x,Qa.y,Qa.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=dE(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Au(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=dE(t,this.array)),t}setX(e,t){return this.normalized&&(t=Au(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=dE(t,this.array)),t}setY(e,t){return this.normalized&&(t=Au(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=dE(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Au(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=dE(t,this.array)),t}setW(e,t){return this.normalized&&(t=Au(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Au(t,this.array),r=Au(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=Au(t,this.array),r=Au(r,this.array),i=Au(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e*=this.itemSize,this.normalized&&(t=Au(t,this.array),r=Au(r,this.array),i=Au(i,this.array),s=Au(s,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==HB&&(e.usage=this.usage),e}}class sW extends Dh{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class oW extends Dh{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class V1 extends Dh{constructor(e,t,r){super(new Float32Array(e),t,r)}}let Kae=0;const sd=new vo,$3=new al,jS=new Lt,gf=new Ab,IT=new Ab,Jc=new Lt;class h0 extends c_{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Kae++}),this.uuid=Lx(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(nW(e)?oW:sW)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new hi().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return sd.makeRotationFromQuaternion(e),this.applyMatrix4(sd),this}rotateX(e){return sd.makeRotationX(e),this.applyMatrix4(sd),this}rotateY(e){return sd.makeRotationY(e),this.applyMatrix4(sd),this}rotateZ(e){return sd.makeRotationZ(e),this.applyMatrix4(sd),this}translate(e,t,r){return sd.makeTranslation(e,t,r),this.applyMatrix4(sd),this}scale(e,t,r){return sd.makeScale(e,t,r),this.applyMatrix4(sd),this}lookAt(e){return $3.lookAt(e),$3.updateMatrix(),this.applyMatrix4($3.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(jS).negate(),this.translate(jS.x,jS.y,jS.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const r=[];for(let i=0,s=e.length;i<s;i++){const o=e[i];r.push(o.x,o.y,o.z||0)}this.setAttribute("position",new V1(r,3))}else{const r=Math.min(e.length,t.count);for(let i=0;i<r;i++){const s=e[i];t.setXYZ(i,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ab);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Lt(-1/0,-1/0,-1/0),new Lt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const s=t[r];gf.setFromBufferAttribute(s),this.morphTargetsRelative?(Jc.addVectors(this.boundingBox.min,gf.min),this.boundingBox.expandByPoint(Jc),Jc.addVectors(this.boundingBox.max,gf.max),this.boundingBox.expandByPoint(Jc)):(this.boundingBox.expandByPoint(gf.min),this.boundingBox.expandByPoint(gf.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ux);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Lt,1/0);return}if(e){const r=this.boundingSphere.center;if(gf.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];IT.setFromBufferAttribute(a),this.morphTargetsRelative?(Jc.addVectors(gf.min,IT.min),gf.expandByPoint(Jc),Jc.addVectors(gf.max,IT.max),gf.expandByPoint(Jc)):(gf.expandByPoint(IT.min),gf.expandByPoint(IT.max))}gf.getCenter(r);let i=0;for(let s=0,o=e.count;s<o;s++)Jc.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(Jc));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)Jc.fromBufferAttribute(a,l),c&&(jS.fromBufferAttribute(e,l),Jc.add(jS)),i=Math.max(i,r.distanceToSquared(Jc))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.position,i=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Dh(new Float32Array(4*r.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let P=0;P<r.count;P++)a[P]=new Lt,c[P]=new Lt;const l=new Lt,u=new Lt,h=new Lt,f=new Nn,d=new Nn,p=new Nn,_=new Lt,g=new Lt;function m(P,B,U){l.fromBufferAttribute(r,P),u.fromBufferAttribute(r,B),h.fromBufferAttribute(r,U),f.fromBufferAttribute(s,P),d.fromBufferAttribute(s,B),p.fromBufferAttribute(s,U),u.sub(l),h.sub(l),d.sub(f),p.sub(f);const z=1/(d.x*p.y-p.x*d.y);isFinite(z)&&(_.copy(u).multiplyScalar(p.y).addScaledVector(h,-d.y).multiplyScalar(z),g.copy(h).multiplyScalar(d.x).addScaledVector(u,-p.x).multiplyScalar(z),a[P].add(_),a[B].add(_),a[U].add(_),c[P].add(g),c[B].add(g),c[U].add(g))}let b=this.groups;b.length===0&&(b=[{start:0,count:e.count}]);for(let P=0,B=b.length;P<B;++P){const U=b[P],z=U.start,I=U.count;for(let L=z,M=z+I;L<M;L+=3)m(e.getX(L+0),e.getX(L+1),e.getX(L+2))}const y=new Lt,x=new Lt,T=new Lt,k=new Lt;function R(P){T.fromBufferAttribute(i,P),k.copy(T);const B=a[P];y.copy(B),y.sub(T.multiplyScalar(T.dot(B))).normalize(),x.crossVectors(k,B);const z=x.dot(c[P])<0?-1:1;o.setXYZW(P,y.x,y.y,y.z,z)}for(let P=0,B=b.length;P<B;++P){const U=b[P],z=U.start,I=U.count;for(let L=z,M=z+I;L<M;L+=3)R(e.getX(L+0)),R(e.getX(L+1)),R(e.getX(L+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Dh(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let f=0,d=r.count;f<d;f++)r.setXYZ(f,0,0,0);const i=new Lt,s=new Lt,o=new Lt,a=new Lt,c=new Lt,l=new Lt,u=new Lt,h=new Lt;if(e)for(let f=0,d=e.count;f<d;f+=3){const p=e.getX(f+0),_=e.getX(f+1),g=e.getX(f+2);i.fromBufferAttribute(t,p),s.fromBufferAttribute(t,_),o.fromBufferAttribute(t,g),u.subVectors(o,s),h.subVectors(i,s),u.cross(h),a.fromBufferAttribute(r,p),c.fromBufferAttribute(r,_),l.fromBufferAttribute(r,g),a.add(u),c.add(u),l.add(u),r.setXYZ(p,a.x,a.y,a.z),r.setXYZ(_,c.x,c.y,c.z),r.setXYZ(g,l.x,l.y,l.z)}else for(let f=0,d=t.count;f<d;f+=3)i.fromBufferAttribute(t,f+0),s.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),u.subVectors(o,s),h.subVectors(i,s),u.cross(h),r.setXYZ(f+0,u.x,u.y,u.z),r.setXYZ(f+1,u.x,u.y,u.z),r.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)Jc.fromBufferAttribute(e,t),Jc.normalize(),e.setXYZ(t,Jc.x,Jc.y,Jc.z)}toNonIndexed(){function e(a,c){const l=a.array,u=a.itemSize,h=a.normalized,f=new l.constructor(c.length*u);let d=0,p=0;for(let _=0,g=c.length;_<g;_++){a.isInterleavedBufferAttribute?d=c[_]*a.data.stride+a.offset:d=c[_]*u;for(let m=0;m<u;m++)f[p++]=l[d++]}return new Dh(f,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new h0,r=this.index.array,i=this.attributes;for(const a in i){const c=i[a],l=e(c,r);t.setAttribute(a,l)}const s=this.morphAttributes;for(const a in s){const c=[],l=s[a];for(let u=0,h=l.length;u<h;u++){const f=l[u],d=e(f,r);c.push(d)}t.morphAttributes[a]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const l in c)c[l]!==void 0&&(e[l]=c[l]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const c in r){const l=r[c];e.data.attributes[c]=l.toJSON(e.data)}const i={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let h=0,f=l.length;h<f;h++){const d=l[h];u.push(d.toJSON(e.data))}u.length>0&&(i[c]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone());const i=e.attributes;for(const l in i){const u=i[l];this.setAttribute(l,u.clone(t))}const s=e.morphAttributes;for(const l in s){const u=[],h=s[l];for(let f=0,d=h.length;f<d;f++)u.push(h[f].clone(t));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,u=o.length;l<u;l++){const h=o[l];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const rF=new vo,o1=new i5,QR=new Ux,iF=new Lt,e2=new Lt,t2=new Lt,n2=new Lt,W3=new Lt,r2=new Lt,sF=new Lt,i2=new Lt;class wf extends al{constructor(e=new h0,t=new s5){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const r=this.geometry,i=r.attributes.position,s=r.morphAttributes.position,o=r.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(s&&a){r2.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const u=a[c],h=s[c];u!==0&&(W3.fromBufferAttribute(h,e),o?r2.addScaledVector(W3,u):r2.addScaledVector(W3.sub(t),u))}t.add(r2)}return t}raycast(e,t){const r=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),QR.copy(r.boundingSphere),QR.applyMatrix4(s),o1.copy(e.ray).recast(e.near),!(QR.containsPoint(o1.origin)===!1&&(o1.intersectSphere(QR,iF)===null||o1.origin.distanceToSquared(iF)>(e.far-e.near)**2))&&(rF.copy(s).invert(),o1.copy(e.ray).applyMatrix4(rF),!(r.boundingBox!==null&&o1.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,t,o1)))}_computeIntersections(e,t,r){let i;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,l=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,f=s.groups,d=s.drawRange;if(a!==null)if(Array.isArray(o))for(let p=0,_=f.length;p<_;p++){const g=f[p],m=o[g.materialIndex],b=Math.max(g.start,d.start),y=Math.min(a.count,Math.min(g.start+g.count,d.start+d.count));for(let x=b,T=y;x<T;x+=3){const k=a.getX(x),R=a.getX(x+1),P=a.getX(x+2);i=s2(this,m,e,r,l,u,h,k,R,P),i&&(i.faceIndex=Math.floor(x/3),i.face.materialIndex=g.materialIndex,t.push(i))}}else{const p=Math.max(0,d.start),_=Math.min(a.count,d.start+d.count);for(let g=p,m=_;g<m;g+=3){const b=a.getX(g),y=a.getX(g+1),x=a.getX(g+2);i=s2(this,o,e,r,l,u,h,b,y,x),i&&(i.faceIndex=Math.floor(g/3),t.push(i))}}else if(c!==void 0)if(Array.isArray(o))for(let p=0,_=f.length;p<_;p++){const g=f[p],m=o[g.materialIndex],b=Math.max(g.start,d.start),y=Math.min(c.count,Math.min(g.start+g.count,d.start+d.count));for(let x=b,T=y;x<T;x+=3){const k=x,R=x+1,P=x+2;i=s2(this,m,e,r,l,u,h,k,R,P),i&&(i.faceIndex=Math.floor(x/3),i.face.materialIndex=g.materialIndex,t.push(i))}}else{const p=Math.max(0,d.start),_=Math.min(c.count,d.start+d.count);for(let g=p,m=_;g<m;g+=3){const b=g,y=g+1,x=g+2;i=s2(this,o,e,r,l,u,h,b,y,x),i&&(i.faceIndex=Math.floor(g/3),t.push(i))}}}}function Xae(n,e,t,r,i,s,o,a){let c;if(e.side===ol?c=r.intersectTriangle(o,s,i,!0,a):c=r.intersectTriangle(i,s,o,e.side===e_,a),c===null)return null;i2.copy(a),i2.applyMatrix4(n.matrixWorld);const l=t.ray.origin.distanceTo(i2);return l<t.near||l>t.far?null:{distance:l,point:i2.clone(),object:n}}function s2(n,e,t,r,i,s,o,a,c,l){n.getVertexPosition(a,e2),n.getVertexPosition(c,t2),n.getVertexPosition(l,n2);const u=Xae(n,e,t,r,e2,t2,n2,sF);if(u){const h=new Lt;pp.getBarycoord(sF,e2,t2,n2,h),i&&(u.uv=pp.getInterpolatedAttribute(i,a,c,l,h,new Nn)),s&&(u.uv1=pp.getInterpolatedAttribute(s,a,c,l,h,new Nn)),o&&(u.normal=pp.getInterpolatedAttribute(o,a,c,l,h,new Lt),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const f={a,b:c,c:l,normal:new Lt,materialIndex:0};pp.getNormal(e2,t2,n2,f.normal),u.face=f,u.barycoord=h}return u}class Bx extends h0{constructor(e=1,t=1,r=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:s,depthSegments:o};const a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const c=[],l=[],u=[],h=[];let f=0,d=0;p("z","y","x",-1,-1,r,t,e,o,s,0),p("z","y","x",1,-1,r,t,-e,o,s,1),p("x","z","y",1,1,e,r,t,i,o,2),p("x","z","y",1,-1,e,r,-t,i,o,3),p("x","y","z",1,-1,e,t,r,i,s,4),p("x","y","z",-1,-1,e,t,-r,i,s,5),this.setIndex(c),this.setAttribute("position",new V1(l,3)),this.setAttribute("normal",new V1(u,3)),this.setAttribute("uv",new V1(h,2));function p(_,g,m,b,y,x,T,k,R,P,B){const U=x/R,z=T/P,I=x/2,L=T/2,M=k/2,F=R+1,Z=P+1;let $=0,Y=0;const Q=new Lt;for(let q=0;q<Z;q++){const V=q*z-L;for(let K=0;K<F;K++){const ne=K*U-I;Q[_]=ne*b,Q[g]=V*y,Q[m]=M,l.push(Q.x,Q.y,Q.z),Q[_]=0,Q[g]=0,Q[m]=k>0?1:-1,u.push(Q.x,Q.y,Q.z),h.push(K/R),h.push(1-q/P),$+=1}}for(let q=0;q<P;q++)for(let V=0;V<R;V++){const K=f+V+F*q,ne=f+V+F*(q+1),ie=f+(V+1)+F*(q+1),ae=f+(V+1)+F*q;c.push(K,ne,ae),c.push(ne,ie,ae),Y+=6}a.addGroup(d,Y,B),d+=Y,f+=$}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Bx(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function nx(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function Ru(n){const e={};for(let t=0;t<n.length;t++){const r=nx(n[t]);for(const i in r)e[i]=r[i]}return e}function Zae(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function aW(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:zi.workingColorSpace}const Jae={clone:nx,merge:Ru};var Qae=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,ece=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class io extends Rb{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Qae,this.fragmentShader=ece,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=nx(e.uniforms),this.uniformsGroups=Zae(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?t.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[i]={type:"m4",value:o.toArray()}:t.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class o5 extends al{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new vo,this.projectionMatrix=new vo,this.projectionMatrixInverse=new vo,this.coordinateSystem=Hg}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const hv=new Lt,oF=new Nn,aF=new Nn;class Ou extends o5{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Gw*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Aw*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Gw*2*Math.atan(Math.tan(Aw*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){hv.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(hv.x,hv.y).multiplyScalar(-e/hv.z),hv.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(hv.x,hv.y).multiplyScalar(-e/hv.z)}getViewSize(e,t){return this.getViewBounds(e,oF,aF),t.subVectors(aF,oF)}setViewOffset(e,t,r,i,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Aw*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,s=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*i/c,t-=o.offsetY*r/l,i*=o.width/c,r*=o.height/l}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const zS=-90,HS=1;class tce extends al{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Ou(zS,HS,e,t);i.layers=this.layers,this.add(i);const s=new Ou(zS,HS,e,t);s.layers=this.layers,this.add(s);const o=new Ou(zS,HS,e,t);o.layers=this.layers,this.add(o);const a=new Ou(zS,HS,e,t);a.layers=this.layers,this.add(a);const c=new Ou(zS,HS,e,t);c.layers=this.layers,this.add(c);const l=new Ou(zS,HS,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,s,o,a,c]=t;for(const l of t)this.remove(l);if(e===Hg)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===lM)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,l,u]=this.children,h=e.getRenderTarget(),f=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const _=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,s),e.setRenderTarget(r,1,i),e.render(t,o),e.setRenderTarget(r,2,i),e.render(t,a),e.setRenderTarget(r,3,i),e.render(t,c),e.setRenderTarget(r,4,i),e.render(t,l),r.texture.generateMipmaps=_,e.setRenderTarget(r,5,i),e.render(t,u),e.setRenderTarget(h,f,d),e.xr.enabled=p,r.texture.needsPMREMUpdate=!0}}class cW extends kc{constructor(e=[],t=JE,r,i,s,o,a,c,l,u){super(e,t,r,i,s,o,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class nce extends Nl{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new cW(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:ou}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Bx(5,5,5),s=new io({name:"CubemapFromEquirect",uniforms:nx(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:ol,blending:Il});s.uniforms.tEquirect.value=t;const o=new wf(i,s),a=t.minFilter;return t.minFilter===L1&&(t.minFilter=ou),new tce(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,r=!0,i=!0){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,r,i);e.setRenderTarget(s)}}class mw extends al{constructor(){super(),this.isGroup=!0,this.type="Group"}}const rce={type:"move"};class q3{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new mw,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new mw,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Lt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Lt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new mw,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Lt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Lt),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,s=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){o=!0;for(const _ of e.hand.values()){const g=t.getJointPose(_,r),m=this._getHandJoint(l,_);g!==null&&(m.matrix.fromArray(g.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,m.jointRadius=g.radius),m.visible=g!==null}const u=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],f=u.position.distanceTo(h.position),d=.02,p=.005;l.inputState.pinching&&f>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&f<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,r),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));a!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&s!==null&&(i=s),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(rce)))}return a!==null&&(a.visible=i!==null),c!==null&&(c.visible=s!==null),l!==null&&(l.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new mw;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class uM extends al{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new t0,this.environmentIntensity=1,this.environmentRotation=new t0,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Hk extends kc{constructor(e=null,t=1,r=1,i,s,o,a,c,l=cu,u=cu,h,f){super(null,o,a,c,l,u,i,s,h,f),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ZD extends Dh{constructor(e,t,r,i=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const VS=new vo,cF=new vo,o2=[],lF=new Ab,ice=new vo,NT=new wf,PT=new Ux;class sce extends wf{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new ZD(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<r;i++)this.setMatrixAt(i,ice)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Ab),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,VS),lF.copy(e.boundingBox).applyMatrix4(VS),this.boundingBox.union(lF)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ux),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,VS),PT.copy(e.boundingSphere).applyMatrix4(VS),this.boundingSphere.union(PT)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const r=t.morphTargetInfluences,i=this.morphTexture.source.data.data,s=r.length+1,o=e*s+1;for(let a=0;a<r.length;a++)r[a]=i[o+a]}raycast(e,t){const r=this.matrixWorld,i=this.count;if(NT.geometry=this.geometry,NT.material=this.material,NT.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),PT.copy(this.boundingSphere),PT.applyMatrix4(r),e.ray.intersectsSphere(PT)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,VS),cF.multiplyMatrices(r,VS),NT.matrixWorld=cF,NT.raycast(e,o2);for(let o=0,a=o2.length;o<a;o++){const c=o2[o];c.instanceId=s,c.object=this,t.push(c)}o2.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new ZD(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const r=t.morphTargetInfluences,i=r.length+1;this.morphTexture===null&&(this.morphTexture=new Hk(new Float32Array(i*this.count),i,this.count,jA,mp));const s=this.morphTexture.source.data.data;let o=0;for(let l=0;l<r.length;l++)o+=r[l];const a=this.geometry.morphTargetsRelative?1:1-o,c=i*e;s[c]=a,s.set(r,c+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const Y3=new Lt,oce=new Lt,ace=new hi;let x1=class{constructor(e=new Lt(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=Y3.subVectors(r,t).cross(oce.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(Y3),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||ace.getNormalMatrix(e),i=this.coplanarPoint(Y3).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const a1=new Ux,a2=new Lt;class lW{constructor(e=new x1,t=new x1,r=new x1,i=new x1,s=new x1,o=new x1){this.planes=[e,t,r,i,s,o]}set(e,t,r,i,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=Hg){const r=this.planes,i=e.elements,s=i[0],o=i[1],a=i[2],c=i[3],l=i[4],u=i[5],h=i[6],f=i[7],d=i[8],p=i[9],_=i[10],g=i[11],m=i[12],b=i[13],y=i[14],x=i[15];if(r[0].setComponents(c-s,f-l,g-d,x-m).normalize(),r[1].setComponents(c+s,f+l,g+d,x+m).normalize(),r[2].setComponents(c+o,f+u,g+p,x+b).normalize(),r[3].setComponents(c-o,f-u,g-p,x-b).normalize(),r[4].setComponents(c-a,f-h,g-_,x-y).normalize(),t===Hg)r[5].setComponents(c+a,f+h,g+_,x+y).normalize();else if(t===lM)r[5].setComponents(a,h,_,y).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),a1.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),a1.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(a1)}intersectsSprite(e){return a1.center.set(0,0,0),a1.radius=.7071067811865476,a1.applyMatrix4(e.matrixWorld),this.intersectsSphere(a1)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(a2.x=i.normal.x>0?e.max.x:e.min.x,a2.y=i.normal.y>0?e.max.y:e.min.y,a2.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(a2)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class cce extends Rb{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new gi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const uF=new vo,JD=new i5,c2=new Ux,l2=new Lt;class lce extends al{constructor(e=new h0,t=new cce){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,o=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),c2.copy(r.boundingSphere),c2.applyMatrix4(i),c2.radius+=s,e.ray.intersectsSphere(c2)===!1)return;uF.copy(i).invert(),JD.copy(e.ray).applyMatrix4(uF);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=r.index,h=r.attributes.position;if(l!==null){const f=Math.max(0,o.start),d=Math.min(l.count,o.start+o.count);for(let p=f,_=d;p<_;p++){const g=l.getX(p);l2.fromBufferAttribute(h,g),hF(l2,g,c,i,e,t,this)}}else{const f=Math.max(0,o.start),d=Math.min(h.count,o.start+o.count);for(let p=f,_=d;p<_;p++)l2.fromBufferAttribute(h,p),hF(l2,p,c,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function hF(n,e,t,r,i,s,o){const a=JD.distanceSqToPoint(n);if(a<t){const c=new Lt;JD.closestPointToPoint(n,c),c.applyMatrix4(r);const l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class uce extends kc{constructor(e,t,r,i,s,o,a,c,l){super(e,t,r,i,s,o,a,c,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Vk extends kc{constructor(e,t,r=jv,i,s,o,a=cu,c=cu,l,u=Vw){if(u!==Vw&&u!==tx)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,i,s,o,a,c,u,r,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new r5(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class HA extends h0{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const s=e/2,o=t/2,a=Math.floor(r),c=Math.floor(i),l=a+1,u=c+1,h=e/a,f=t/c,d=[],p=[],_=[],g=[];for(let m=0;m<u;m++){const b=m*f-o;for(let y=0;y<l;y++){const x=y*h-s;p.push(x,-b,0),_.push(0,0,1),g.push(y/a),g.push(1-m/c)}}for(let m=0;m<c;m++)for(let b=0;b<a;b++){const y=b+l*m,x=b+l*(m+1),T=b+1+l*(m+1),k=b+1+l*m;d.push(y,x,k),d.push(x,T,k)}this.setIndex(d),this.setAttribute("position",new V1(p,3)),this.setAttribute("normal",new V1(_,3)),this.setAttribute("uv",new V1(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new HA(e.width,e.height,e.widthSegments,e.heightSegments)}}class hce extends Rb{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=wb,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class fce extends Rb{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const fF={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class dce{constructor(e,t,r){const i=this;let s=!1,o=0,a=0,c;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(u){a++,s===!1&&i.onStart!==void 0&&i.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,i.onProgress!==void 0&&i.onProgress(u,o,a),o===a&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,h){return l.push(u,h),this},this.removeHandler=function(u){const h=l.indexOf(u);return h!==-1&&l.splice(h,2),this},this.getHandler=function(u){for(let h=0,f=l.length;h<f;h+=2){const d=l[h],p=l[h+1];if(d.global&&(d.lastIndex=0),d.test(u))return p}return null}}}const pce=new dce;class a5{constructor(e){this.manager=e!==void 0?e:pce,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(i,s){r.load(e,i,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}a5.DEFAULT_MATERIAL_NAME="__DEFAULT";class mce extends a5{constructor(e){super(e)}load(e,t,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=fF.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=$w("img");function c(){u(),fF.add(e,this),t&&t(this),s.manager.itemEnd(e)}function l(h){u(),i&&i(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class gce extends a5{constructor(e){super(e)}load(e,t,r,i){const s=new kc,o=new mce(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},r,i),s}}let c5=class extends o5{constructor(e=-1,t=1,r=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,o=r+e,a=i+t,c=i-t;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};class _ce extends Ou{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}let vce=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=dF(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=dF();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function dF(){return performance.now()}class on{constructor(e){this.value=e}clone(){return new on(this.value.clone===void 0?this.value:this.value.clone())}}const pF=new vo;class uW{constructor(e,t,r=0,i=1/0){this.ray=new i5(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new Ww,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return pF.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(pF),this}intersectObject(e,t=!0,r=[]){return QD(e,this,r,t),r.sort(mF),r}intersectObjects(e,t=!0,r=[]){for(let i=0,s=e.length;i<s;i++)QD(e[i],this,r,t);return r.sort(mF),r}}function mF(n,e){return n.distance-e.distance}function QD(n,e,t,r){let i=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(i=!1),i===!0&&r===!0){const s=n.children;for(let o=0,a=s.length;o<a;o++)QD(s[o],e,t,!0)}}const gF=new Nn;class yce{constructor(e=new Nn(1/0,1/0),t=new Nn(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=gF.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,gF).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}function _F(n,e,t,r){const i=bce(r);switch(t){case Z$:return n*e;case jA:return n*e/i.components*i.byteLength;case Q4:return n*e/i.components*i.byteLength;case e5:return n*e*2/i.components*i.byteLength;case t5:return n*e*2/i.components*i.byteLength;case J$:return n*e*3/i.components*i.byteLength;case Du:return n*e*4/i.components*i.byteLength;case zk:return n*e*4/i.components*i.byteLength;case pC:case mC:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case gC:case _C:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case AD:case CD:return Math.max(n,16)*Math.max(e,8)/4;case wD:case RD:return Math.max(n,8)*Math.max(e,8)/2;case MD:case kD:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case OD:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case ID:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case ND:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case PD:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case DD:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case LD:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case UD:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case BD:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case FD:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case jD:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case zD:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case HD:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case VD:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case GD:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case $D:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case vC:case WD:case qD:return Math.ceil(n/4)*Math.ceil(e/4)*16;case Q$:case YD:return Math.ceil(n/4)*Math.ceil(e/4)*8;case KD:case XD:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function bce(n){switch(n){case Do:case Y$:return{byteLength:1,components:1};case Hw:case K$:case Jv:return{byteLength:2,components:1};case Z4:case J4:return{byteLength:2,components:4};case jv:case X4:case mp:return{byteLength:4,components:1};case X$:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:FA}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=FA);function hW(){let n=null,e=!1,t=null,r=null;function i(s,o){t(s,o),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function Sce(n){const e=new WeakMap;function t(a,c){const l=a.array,u=a.usage,h=l.byteLength,f=n.createBuffer();n.bindBuffer(c,f),n.bufferData(c,l,u),a.onUploadCallback();let d;if(l instanceof Float32Array)d=n.FLOAT;else if(l instanceof Uint16Array)a.isFloat16BufferAttribute?d=n.HALF_FLOAT:d=n.UNSIGNED_SHORT;else if(l instanceof Int16Array)d=n.SHORT;else if(l instanceof Uint32Array)d=n.UNSIGNED_INT;else if(l instanceof Int32Array)d=n.INT;else if(l instanceof Int8Array)d=n.BYTE;else if(l instanceof Uint8Array)d=n.UNSIGNED_BYTE;else if(l instanceof Uint8ClampedArray)d=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);return{buffer:f,type:d,bytesPerElement:l.BYTES_PER_ELEMENT,version:a.version,size:h}}function r(a,c,l){const u=c.array,h=c.updateRanges;if(n.bindBuffer(l,a),h.length===0)n.bufferSubData(l,0,u);else{h.sort((d,p)=>d.start-p.start);let f=0;for(let d=1;d<h.length;d++){const p=h[f],_=h[d];_.start<=p.start+p.count+1?p.count=Math.max(p.count,_.start+_.count-p.start):(++f,h[f]=_)}h.length=f+1;for(let d=0,p=h.length;d<p;d++){const _=h[d];n.bufferSubData(l,_.start*u.BYTES_PER_ELEMENT,u,_.start,_.count)}c.clearUpdateRanges()}c.onUploadCallback()}function i(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const c=e.get(a);c&&(n.deleteBuffer(c.buffer),e.delete(a))}function o(a,c){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const l=e.get(a);if(l===void 0)e.set(a,t(a,c));else if(l.version<a.version){if(l.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(l.buffer,a,c),l.version=a.version}}return{get:i,remove:s,update:o}}var Ece=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,xce=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Tce=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,wce=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Ace=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,Rce=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Cce=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Mce=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,kce=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,Oce=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,Ice=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Nce=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Pce=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Dce=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Lce=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Uce=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Bce=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Fce=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,jce=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,zce=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Hce=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Vce=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,Gce=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,$ce=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Wce=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,qce=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Yce=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Kce=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Xce=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Zce=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Jce="gl_FragColor = linearToOutputTexel( gl_FragColor );",Qce=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,ele=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,tle=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,nle=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,rle=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,ile=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,sle=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,ole=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,ale=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,cle=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,lle=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,ule=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,hle=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,fle=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,dle=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,ple=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,mle=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,gle=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,_le=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,vle=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,yle=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,ble=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Sle=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Ele=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,xle=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,Tle=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,wle=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Ale=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Rle=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,Cle=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Mle=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,kle=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Ole=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Ile=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Nle=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Ple=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,Dle=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Lle=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Ule=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,Ble=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Fle=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,jle=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,zle=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Hle=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Vle=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Gle=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,$le=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Wle=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,qle=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Yle=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Kle=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Xle=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Zle=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Jle=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Qle=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,eue=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,tue=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,nue=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,rue=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,iue=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,sue=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,oue=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,aue=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,cue=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,lue=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,uue=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,hue=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,fue=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,due=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,pue=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,mue=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,gue=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,_ue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,vue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,yue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,bue=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Sue=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Eue=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,xue=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Tue=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,wue=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Aue=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Rue=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Cue=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,Mue=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,kue=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Oue=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Iue=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Nue=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Pue=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Due=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Lue=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Uue=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Bue=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Fue=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,jue=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zue=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Hue=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Vue=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Gue=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$ue=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Wue=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,que=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Yue=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Kue=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Xue=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Zue=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Jue=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Que=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ehe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,di={alphahash_fragment:Ece,alphahash_pars_fragment:xce,alphamap_fragment:Tce,alphamap_pars_fragment:wce,alphatest_fragment:Ace,alphatest_pars_fragment:Rce,aomap_fragment:Cce,aomap_pars_fragment:Mce,batching_pars_vertex:kce,batching_vertex:Oce,begin_vertex:Ice,beginnormal_vertex:Nce,bsdfs:Pce,iridescence_fragment:Dce,bumpmap_pars_fragment:Lce,clipping_planes_fragment:Uce,clipping_planes_pars_fragment:Bce,clipping_planes_pars_vertex:Fce,clipping_planes_vertex:jce,color_fragment:zce,color_pars_fragment:Hce,color_pars_vertex:Vce,color_vertex:Gce,common:$ce,cube_uv_reflection_fragment:Wce,defaultnormal_vertex:qce,displacementmap_pars_vertex:Yce,displacementmap_vertex:Kce,emissivemap_fragment:Xce,emissivemap_pars_fragment:Zce,colorspace_fragment:Jce,colorspace_pars_fragment:Qce,envmap_fragment:ele,envmap_common_pars_fragment:tle,envmap_pars_fragment:nle,envmap_pars_vertex:rle,envmap_physical_pars_fragment:ple,envmap_vertex:ile,fog_vertex:sle,fog_pars_vertex:ole,fog_fragment:ale,fog_pars_fragment:cle,gradientmap_pars_fragment:lle,lightmap_pars_fragment:ule,lights_lambert_fragment:hle,lights_lambert_pars_fragment:fle,lights_pars_begin:dle,lights_toon_fragment:mle,lights_toon_pars_fragment:gle,lights_phong_fragment:_le,lights_phong_pars_fragment:vle,lights_physical_fragment:yle,lights_physical_pars_fragment:ble,lights_fragment_begin:Sle,lights_fragment_maps:Ele,lights_fragment_end:xle,logdepthbuf_fragment:Tle,logdepthbuf_pars_fragment:wle,logdepthbuf_pars_vertex:Ale,logdepthbuf_vertex:Rle,map_fragment:Cle,map_pars_fragment:Mle,map_particle_fragment:kle,map_particle_pars_fragment:Ole,metalnessmap_fragment:Ile,metalnessmap_pars_fragment:Nle,morphinstance_vertex:Ple,morphcolor_vertex:Dle,morphnormal_vertex:Lle,morphtarget_pars_vertex:Ule,morphtarget_vertex:Ble,normal_fragment_begin:Fle,normal_fragment_maps:jle,normal_pars_fragment:zle,normal_pars_vertex:Hle,normal_vertex:Vle,normalmap_pars_fragment:Gle,clearcoat_normal_fragment_begin:$le,clearcoat_normal_fragment_maps:Wle,clearcoat_pars_fragment:qle,iridescence_pars_fragment:Yle,opaque_fragment:Kle,packing:Xle,premultiplied_alpha_fragment:Zle,project_vertex:Jle,dithering_fragment:Qle,dithering_pars_fragment:eue,roughnessmap_fragment:tue,roughnessmap_pars_fragment:nue,shadowmap_pars_fragment:rue,shadowmap_pars_vertex:iue,shadowmap_vertex:sue,shadowmask_pars_fragment:oue,skinbase_vertex:aue,skinning_pars_vertex:cue,skinning_vertex:lue,skinnormal_vertex:uue,specularmap_fragment:hue,specularmap_pars_fragment:fue,tonemapping_fragment:due,tonemapping_pars_fragment:pue,transmission_fragment:mue,transmission_pars_fragment:gue,uv_pars_fragment:_ue,uv_pars_vertex:vue,uv_vertex:yue,worldpos_vertex:bue,background_vert:Sue,background_frag:Eue,backgroundCube_vert:xue,backgroundCube_frag:Tue,cube_vert:wue,cube_frag:Aue,depth_vert:Rue,depth_frag:Cue,distanceRGBA_vert:Mue,distanceRGBA_frag:kue,equirect_vert:Oue,equirect_frag:Iue,linedashed_vert:Nue,linedashed_frag:Pue,meshbasic_vert:Due,meshbasic_frag:Lue,meshlambert_vert:Uue,meshlambert_frag:Bue,meshmatcap_vert:Fue,meshmatcap_frag:jue,meshnormal_vert:zue,meshnormal_frag:Hue,meshphong_vert:Vue,meshphong_frag:Gue,meshphysical_vert:$ue,meshphysical_frag:Wue,meshtoon_vert:que,meshtoon_frag:Yue,points_vert:Kue,points_frag:Xue,shadow_vert:Zue,shadow_frag:Jue,sprite_vert:Que,sprite_frag:ehe},Fn={common:{diffuse:{value:new gi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new hi},alphaMap:{value:null},alphaMapTransform:{value:new hi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new hi}},envmap:{envMap:{value:null},envMapRotation:{value:new hi},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new hi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new hi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new hi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new hi},normalScale:{value:new Nn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new hi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new hi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new hi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new hi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new gi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new gi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new hi},alphaTest:{value:0},uvTransform:{value:new hi}},sprite:{diffuse:{value:new gi(16777215)},opacity:{value:1},center:{value:new Nn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new hi},alphaMap:{value:null},alphaMapTransform:{value:new hi},alphaTest:{value:0}}},Im={basic:{uniforms:Ru([Fn.common,Fn.specularmap,Fn.envmap,Fn.aomap,Fn.lightmap,Fn.fog]),vertexShader:di.meshbasic_vert,fragmentShader:di.meshbasic_frag},lambert:{uniforms:Ru([Fn.common,Fn.specularmap,Fn.envmap,Fn.aomap,Fn.lightmap,Fn.emissivemap,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.fog,Fn.lights,{emissive:{value:new gi(0)}}]),vertexShader:di.meshlambert_vert,fragmentShader:di.meshlambert_frag},phong:{uniforms:Ru([Fn.common,Fn.specularmap,Fn.envmap,Fn.aomap,Fn.lightmap,Fn.emissivemap,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.fog,Fn.lights,{emissive:{value:new gi(0)},specular:{value:new gi(1118481)},shininess:{value:30}}]),vertexShader:di.meshphong_vert,fragmentShader:di.meshphong_frag},standard:{uniforms:Ru([Fn.common,Fn.envmap,Fn.aomap,Fn.lightmap,Fn.emissivemap,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.roughnessmap,Fn.metalnessmap,Fn.fog,Fn.lights,{emissive:{value:new gi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:di.meshphysical_vert,fragmentShader:di.meshphysical_frag},toon:{uniforms:Ru([Fn.common,Fn.aomap,Fn.lightmap,Fn.emissivemap,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.gradientmap,Fn.fog,Fn.lights,{emissive:{value:new gi(0)}}]),vertexShader:di.meshtoon_vert,fragmentShader:di.meshtoon_frag},matcap:{uniforms:Ru([Fn.common,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.fog,{matcap:{value:null}}]),vertexShader:di.meshmatcap_vert,fragmentShader:di.meshmatcap_frag},points:{uniforms:Ru([Fn.points,Fn.fog]),vertexShader:di.points_vert,fragmentShader:di.points_frag},dashed:{uniforms:Ru([Fn.common,Fn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:di.linedashed_vert,fragmentShader:di.linedashed_frag},depth:{uniforms:Ru([Fn.common,Fn.displacementmap]),vertexShader:di.depth_vert,fragmentShader:di.depth_frag},normal:{uniforms:Ru([Fn.common,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,{opacity:{value:1}}]),vertexShader:di.meshnormal_vert,fragmentShader:di.meshnormal_frag},sprite:{uniforms:Ru([Fn.sprite,Fn.fog]),vertexShader:di.sprite_vert,fragmentShader:di.sprite_frag},background:{uniforms:{uvTransform:{value:new hi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:di.background_vert,fragmentShader:di.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new hi}},vertexShader:di.backgroundCube_vert,fragmentShader:di.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:di.cube_vert,fragmentShader:di.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:di.equirect_vert,fragmentShader:di.equirect_frag},distanceRGBA:{uniforms:Ru([Fn.common,Fn.displacementmap,{referencePosition:{value:new Lt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:di.distanceRGBA_vert,fragmentShader:di.distanceRGBA_frag},shadow:{uniforms:Ru([Fn.lights,Fn.fog,{color:{value:new gi(0)},opacity:{value:1}}]),vertexShader:di.shadow_vert,fragmentShader:di.shadow_frag}};Im.physical={uniforms:Ru([Im.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new hi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new hi},clearcoatNormalScale:{value:new Nn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new hi},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new hi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new hi},sheen:{value:0},sheenColor:{value:new gi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new hi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new hi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new hi},transmissionSamplerSize:{value:new Nn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new hi},attenuationDistance:{value:0},attenuationColor:{value:new gi(0)},specularColor:{value:new gi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new hi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new hi},anisotropyVector:{value:new Nn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new hi}}]),vertexShader:di.meshphysical_vert,fragmentShader:di.meshphysical_frag};const u2={r:0,b:0,g:0},c1=new t0,the=new vo;function nhe(n,e,t,r,i,s,o){const a=new gi(0);let c=s===!0?0:1,l,u,h=null,f=0,d=null;function p(y){let x=y.isScene===!0?y.background:null;return x&&x.isTexture&&(x=(y.backgroundBlurriness>0?t:e).get(x)),x}function _(y){let x=!1;const T=p(y);T===null?m(a,c):T&&T.isColor&&(m(T,1),x=!0);const k=n.xr.getEnvironmentBlendMode();k==="additive"?r.buffers.color.setClear(0,0,0,1,o):k==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,o),(n.autoClear||x)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function g(y,x){const T=p(x);T&&(T.isCubeTexture||T.mapping===jk)?(u===void 0&&(u=new wf(new Bx(1,1,1),new io({name:"BackgroundCubeMaterial",uniforms:nx(Im.backgroundCube.uniforms),vertexShader:Im.backgroundCube.vertexShader,fragmentShader:Im.backgroundCube.fragmentShader,side:ol,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(k,R,P){this.matrixWorld.copyPosition(P.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),c1.copy(x.backgroundRotation),c1.x*=-1,c1.y*=-1,c1.z*=-1,T.isCubeTexture&&T.isRenderTargetTexture===!1&&(c1.y*=-1,c1.z*=-1),u.material.uniforms.envMap.value=T,u.material.uniforms.flipEnvMap.value=T.isCubeTexture&&T.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(the.makeRotationFromEuler(c1)),u.material.toneMapped=zi.getTransfer(T.colorSpace)!==Cs,(h!==T||f!==T.version||d!==n.toneMapping)&&(u.material.needsUpdate=!0,h=T,f=T.version,d=n.toneMapping),u.layers.enableAll(),y.unshift(u,u.geometry,u.material,0,0,null)):T&&T.isTexture&&(l===void 0&&(l=new wf(new HA(2,2),new io({name:"BackgroundMaterial",uniforms:nx(Im.background.uniforms),vertexShader:Im.background.vertexShader,fragmentShader:Im.background.fragmentShader,side:e_,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=T,l.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,l.material.toneMapped=zi.getTransfer(T.colorSpace)!==Cs,T.matrixAutoUpdate===!0&&T.updateMatrix(),l.material.uniforms.uvTransform.value.copy(T.matrix),(h!==T||f!==T.version||d!==n.toneMapping)&&(l.material.needsUpdate=!0,h=T,f=T.version,d=n.toneMapping),l.layers.enableAll(),y.unshift(l,l.geometry,l.material,0,0,null))}function m(y,x){y.getRGB(u2,aW(n)),r.buffers.color.setClear(u2.r,u2.g,u2.b,x,o)}function b(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),l!==void 0&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}return{getClearColor:function(){return a},setClearColor:function(y,x=1){a.set(y),c=x,m(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(y){c=y,m(a,c)},render:_,addToRenderList:g,dispose:b}}function rhe(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),r={},i=f(null);let s=i,o=!1;function a(U,z,I,L,M){let F=!1;const Z=h(L,I,z);s!==Z&&(s=Z,l(s.object)),F=d(U,L,I,M),F&&p(U,L,I,M),M!==null&&e.update(M,n.ELEMENT_ARRAY_BUFFER),(F||o)&&(o=!1,x(U,z,I,L),M!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(M).buffer))}function c(){return n.createVertexArray()}function l(U){return n.bindVertexArray(U)}function u(U){return n.deleteVertexArray(U)}function h(U,z,I){const L=I.wireframe===!0;let M=r[U.id];M===void 0&&(M={},r[U.id]=M);let F=M[z.id];F===void 0&&(F={},M[z.id]=F);let Z=F[L];return Z===void 0&&(Z=f(c()),F[L]=Z),Z}function f(U){const z=[],I=[],L=[];for(let M=0;M<t;M++)z[M]=0,I[M]=0,L[M]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:z,enabledAttributes:I,attributeDivisors:L,object:U,attributes:{},index:null}}function d(U,z,I,L){const M=s.attributes,F=z.attributes;let Z=0;const $=I.getAttributes();for(const Y in $)if($[Y].location>=0){const q=M[Y];let V=F[Y];if(V===void 0&&(Y==="instanceMatrix"&&U.instanceMatrix&&(V=U.instanceMatrix),Y==="instanceColor"&&U.instanceColor&&(V=U.instanceColor)),q===void 0||q.attribute!==V||V&&q.data!==V.data)return!0;Z++}return s.attributesNum!==Z||s.index!==L}function p(U,z,I,L){const M={},F=z.attributes;let Z=0;const $=I.getAttributes();for(const Y in $)if($[Y].location>=0){let q=F[Y];q===void 0&&(Y==="instanceMatrix"&&U.instanceMatrix&&(q=U.instanceMatrix),Y==="instanceColor"&&U.instanceColor&&(q=U.instanceColor));const V={};V.attribute=q,q&&q.data&&(V.data=q.data),M[Y]=V,Z++}s.attributes=M,s.attributesNum=Z,s.index=L}function _(){const U=s.newAttributes;for(let z=0,I=U.length;z<I;z++)U[z]=0}function g(U){m(U,0)}function m(U,z){const I=s.newAttributes,L=s.enabledAttributes,M=s.attributeDivisors;I[U]=1,L[U]===0&&(n.enableVertexAttribArray(U),L[U]=1),M[U]!==z&&(n.vertexAttribDivisor(U,z),M[U]=z)}function b(){const U=s.newAttributes,z=s.enabledAttributes;for(let I=0,L=z.length;I<L;I++)z[I]!==U[I]&&(n.disableVertexAttribArray(I),z[I]=0)}function y(U,z,I,L,M,F,Z){Z===!0?n.vertexAttribIPointer(U,z,I,M,F):n.vertexAttribPointer(U,z,I,L,M,F)}function x(U,z,I,L){_();const M=L.attributes,F=I.getAttributes(),Z=z.defaultAttributeValues;for(const $ in F){const Y=F[$];if(Y.location>=0){let Q=M[$];if(Q===void 0&&($==="instanceMatrix"&&U.instanceMatrix&&(Q=U.instanceMatrix),$==="instanceColor"&&U.instanceColor&&(Q=U.instanceColor)),Q!==void 0){const q=Q.normalized,V=Q.itemSize,K=e.get(Q);if(K===void 0)continue;const ne=K.buffer,ie=K.type,ae=K.bytesPerElement,Te=ie===n.INT||ie===n.UNSIGNED_INT||Q.gpuType===X4;if(Q.isInterleavedBufferAttribute){const Ie=Q.data,be=Ie.stride,Pe=Q.offset;if(Ie.isInstancedInterleavedBuffer){for(let $e=0;$e<Y.locationSize;$e++)m(Y.location+$e,Ie.meshPerAttribute);U.isInstancedMesh!==!0&&L._maxInstanceCount===void 0&&(L._maxInstanceCount=Ie.meshPerAttribute*Ie.count)}else for(let $e=0;$e<Y.locationSize;$e++)g(Y.location+$e);n.bindBuffer(n.ARRAY_BUFFER,ne);for(let $e=0;$e<Y.locationSize;$e++)y(Y.location+$e,V/Y.locationSize,ie,q,be*ae,(Pe+V/Y.locationSize*$e)*ae,Te)}else{if(Q.isInstancedBufferAttribute){for(let Ie=0;Ie<Y.locationSize;Ie++)m(Y.location+Ie,Q.meshPerAttribute);U.isInstancedMesh!==!0&&L._maxInstanceCount===void 0&&(L._maxInstanceCount=Q.meshPerAttribute*Q.count)}else for(let Ie=0;Ie<Y.locationSize;Ie++)g(Y.location+Ie);n.bindBuffer(n.ARRAY_BUFFER,ne);for(let Ie=0;Ie<Y.locationSize;Ie++)y(Y.location+Ie,V/Y.locationSize,ie,q,V*ae,V/Y.locationSize*Ie*ae,Te)}}else if(Z!==void 0){const q=Z[$];if(q!==void 0)switch(q.length){case 2:n.vertexAttrib2fv(Y.location,q);break;case 3:n.vertexAttrib3fv(Y.location,q);break;case 4:n.vertexAttrib4fv(Y.location,q);break;default:n.vertexAttrib1fv(Y.location,q)}}}}b()}function T(){P();for(const U in r){const z=r[U];for(const I in z){const L=z[I];for(const M in L)u(L[M].object),delete L[M];delete z[I]}delete r[U]}}function k(U){if(r[U.id]===void 0)return;const z=r[U.id];for(const I in z){const L=z[I];for(const M in L)u(L[M].object),delete L[M];delete z[I]}delete r[U.id]}function R(U){for(const z in r){const I=r[z];if(I[U.id]===void 0)continue;const L=I[U.id];for(const M in L)u(L[M].object),delete L[M];delete I[U.id]}}function P(){B(),o=!0,s!==i&&(s=i,l(s.object))}function B(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:a,reset:P,resetDefaultState:B,dispose:T,releaseStatesOfGeometry:k,releaseStatesOfProgram:R,initAttributes:_,enableAttribute:g,disableUnusedAttributes:b}}function ihe(n,e,t){let r;function i(l){r=l}function s(l,u){n.drawArrays(r,l,u),t.update(u,r,1)}function o(l,u,h){h!==0&&(n.drawArraysInstanced(r,l,u,h),t.update(u,r,h))}function a(l,u,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,l,0,u,0,h);let d=0;for(let p=0;p<h;p++)d+=u[p];t.update(d,r,1)}function c(l,u,h,f){if(h===0)return;const d=e.get("WEBGL_multi_draw");if(d===null)for(let p=0;p<l.length;p++)o(l[p],u[p],f[p]);else{d.multiDrawArraysInstancedWEBGL(r,l,0,u,0,f,0,h);let p=0;for(let _=0;_<h;_++)p+=u[_]*f[_];t.update(p,r,1)}}this.setMode=i,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=c}function she(n,e,t,r){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const R=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(R.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function o(R){return!(R!==Du&&r.convert(R)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(R){const P=R===Jv&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(R!==Do&&r.convert(R)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&R!==mp&&!P)}function c(R){if(R==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";R="mediump"}return R==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=t.precision!==void 0?t.precision:"highp";const u=c(l);u!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",u,"instead."),l=u);const h=t.logarithmicDepthBuffer===!0,f=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),d=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),p=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_=n.getParameter(n.MAX_TEXTURE_SIZE),g=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),m=n.getParameter(n.MAX_VERTEX_ATTRIBS),b=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),y=n.getParameter(n.MAX_VARYING_VECTORS),x=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),T=p>0,k=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:a,precision:l,logarithmicDepthBuffer:h,reverseDepthBuffer:f,maxTextures:d,maxVertexTextures:p,maxTextureSize:_,maxCubemapSize:g,maxAttributes:m,maxVertexUniforms:b,maxVaryings:y,maxFragmentUniforms:x,vertexTextures:T,maxSamples:k}}function ohe(n){const e=this;let t=null,r=0,i=!1,s=!1;const o=new x1,a=new hi,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(h,f){const d=h.length!==0||f||r!==0||i;return i=f,r=h.length,d},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,f){t=u(h,f,0)},this.setState=function(h,f,d){const p=h.clippingPlanes,_=h.clipIntersection,g=h.clipShadows,m=n.get(h);if(!i||p===null||p.length===0||s&&!g)s?u(null):l();else{const b=s?0:r,y=b*4;let x=m.clippingState||null;c.value=x,x=u(p,f,y,d);for(let T=0;T!==y;++T)x[T]=t[T];m.clippingState=x,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=b}};function l(){c.value!==t&&(c.value=t,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(h,f,d,p){const _=h!==null?h.length:0;let g=null;if(_!==0){if(g=c.value,p!==!0||g===null){const m=d+_*4,b=f.matrixWorldInverse;a.getNormalMatrix(b),(g===null||g.length<m)&&(g=new Float32Array(m));for(let y=0,x=d;y!==_;++y,x+=4)o.copy(h[y]).applyMatrix4(b,a),o.normal.toArray(g,x),g[x+3]=o.constant}c.value=g,c.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,g}}function ahe(n){let e=new WeakMap;function t(o,a){return a===ED?o.mapping=JE:a===xD&&(o.mapping=QE),o}function r(o){if(o&&o.isTexture){const a=o.mapping;if(a===ED||a===xD)if(e.has(o)){const c=e.get(o).texture;return t(c,o.mapping)}else{const c=o.image;if(c&&c.height>0){const l=new nce(c.height);return l.fromEquirectangularTexture(n,o),e.set(o,l),o.addEventListener("dispose",i),t(l.texture,o.mapping)}else return null}}return o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const c=e.get(a);c!==void 0&&(e.delete(a),c.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}const wE=4,vF=[.125,.215,.35,.446,.526,.582],O1=20,K3=new c5,yF=new gi;let X3=null,Z3=0,J3=0,Q3=!1;const T1=(1+Math.sqrt(5))/2,GS=1/T1,bF=[new Lt(-T1,GS,0),new Lt(T1,GS,0),new Lt(-GS,0,T1),new Lt(GS,0,T1),new Lt(0,T1,-GS),new Lt(0,T1,GS),new Lt(-1,1,-1),new Lt(1,1,-1),new Lt(-1,1,1),new Lt(1,1,1)],che=new Lt;class SF{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100,s={}){const{size:o=256,position:a=che}=s;X3=this._renderer.getRenderTarget(),Z3=this._renderer.getActiveCubeFace(),J3=this._renderer.getActiveMipmapLevel(),Q3=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,r,i,c,a),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=TF(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=xF(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(X3,Z3,J3),this._renderer.xr.enabled=Q3,e.scissorTest=!1,h2(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===JE||e.mapping===QE?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),X3=this._renderer.getRenderTarget(),Z3=this._renderer.getActiveCubeFace(),J3=this._renderer.getActiveMipmapLevel(),Q3=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:ou,minFilter:ou,generateMipmaps:!1,type:Jv,format:Du,colorSpace:t_,depthBuffer:!1},i=EF(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=EF(e,t,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=lhe(s)),this._blurMaterial=uhe(s,e,t)}return i}_compileMaterial(e){const t=new wf(this._lodPlanes[0],e);this._renderer.compile(t,K3)}_sceneToCubeUV(e,t,r,i,s){const c=new Ou(90,1,t,r),l=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],h=this._renderer,f=h.autoClear,d=h.toneMapping;h.getClearColor(yF),h.toneMapping=Wg,h.autoClear=!1;const p=new s5({name:"PMREM.Background",side:ol,depthWrite:!1,depthTest:!1}),_=new wf(new Bx,p);let g=!1;const m=e.background;m?m.isColor&&(p.color.copy(m),e.background=null,g=!0):(p.color.copy(yF),g=!0);for(let b=0;b<6;b++){const y=b%3;y===0?(c.up.set(0,l[b],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x+u[b],s.y,s.z)):y===1?(c.up.set(0,0,l[b]),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y+u[b],s.z)):(c.up.set(0,l[b],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y,s.z+u[b]));const x=this._cubeSize;h2(i,y*x,b>2?x:0,x,x),h.setRenderTarget(i),g&&h.render(_,c),h.render(e,c)}_.geometry.dispose(),_.material.dispose(),h.toneMapping=d,h.autoClear=f,e.background=m}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===JE||e.mapping===QE;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=TF()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=xF());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new wf(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const c=this._cubeSize;h2(t,0,0,3*c,2*c),r.setRenderTarget(t),r.render(o,K3)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=bF[(i-s-1)%bF.length];this._blur(e,s-1,s,o,a)}t.autoClear=r}_blur(e,t,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,o,a){const c=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new wf(this._lodPlanes[i],l),f=l.uniforms,d=this._sizeLods[r]-1,p=isFinite(s)?Math.PI/(2*d):2*Math.PI/(2*O1-1),_=s/p,g=isFinite(s)?1+Math.floor(u*_):O1;g>O1&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${O1}`);const m=[];let b=0;for(let R=0;R<O1;++R){const P=R/_,B=Math.exp(-P*P/2);m.push(B),R===0?b+=B:R<g&&(b+=2*B)}for(let R=0;R<m.length;R++)m[R]=m[R]/b;f.envMap.value=e.texture,f.samples.value=g,f.weights.value=m,f.latitudinal.value=o==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:y}=this;f.dTheta.value=p,f.mipInt.value=y-r;const x=this._sizeLods[i],T=3*x*(i>y-wE?i-y+wE:0),k=4*(this._cubeSize-x);h2(t,T,k,3*x,2*x),c.setRenderTarget(t),c.render(h,K3)}}function lhe(n){const e=[],t=[],r=[];let i=n;const s=n-wE+1+vF.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);t.push(a);let c=1/a;o>n-wE?c=vF[o-n+wE-1]:o===0&&(c=0),r.push(c);const l=1/(a-2),u=-l,h=1+l,f=[u,u,h,u,h,h,u,u,h,h,u,h],d=6,p=6,_=3,g=2,m=1,b=new Float32Array(_*p*d),y=new Float32Array(g*p*d),x=new Float32Array(m*p*d);for(let k=0;k<d;k++){const R=k%3*2/3-1,P=k>2?0:-1,B=[R,P,0,R+2/3,P,0,R+2/3,P+1,0,R,P,0,R+2/3,P+1,0,R,P+1,0];b.set(B,_*p*k),y.set(f,g*p*k);const U=[k,k,k,k,k,k];x.set(U,m*p*k)}const T=new h0;T.setAttribute("position",new Dh(b,_)),T.setAttribute("uv",new Dh(y,g)),T.setAttribute("faceIndex",new Dh(x,m)),e.push(T),i>wE&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}function EF(n,e,t){const r=new Nl(n,e,t);return r.texture.mapping=jk,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function h2(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function uhe(n,e,t){const r=new Float32Array(O1),i=new Lt(0,1,0);return new io({name:"SphericalGaussianBlur",defines:{n:O1,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:l5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Il,depthTest:!1,depthWrite:!1})}function xF(){return new io({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:l5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Il,depthTest:!1,depthWrite:!1})}function TF(){return new io({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:l5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Il,depthTest:!1,depthWrite:!1})}function l5(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function hhe(n){let e=new WeakMap,t=null;function r(a){if(a&&a.isTexture){const c=a.mapping,l=c===ED||c===xD,u=c===JE||c===QE;if(l||u){let h=e.get(a);const f=h!==void 0?h.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==f)return t===null&&(t=new SF(n)),h=l?t.fromEquirectangular(a,h):t.fromCubemap(a,h),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),h.texture;if(h!==void 0)return h.texture;{const d=a.image;return l&&d&&d.height>0||u&&d&&i(d)?(t===null&&(t=new SF(n)),h=l?t.fromEquirectangular(a):t.fromCubemap(a),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),a.addEventListener("dispose",s),h.texture):null}}}return a}function i(a){let c=0;const l=6;for(let u=0;u<l;u++)a[u]!==void 0&&c++;return c===l}function s(a){const c=a.target;c.removeEventListener("dispose",s);const l=e.get(c);l!==void 0&&(e.delete(c),l.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:o}}function fhe(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(r){const i=t(r);return i===null&&yC("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function dhe(n,e,t,r){const i={},s=new WeakMap;function o(h){const f=h.target;f.index!==null&&e.remove(f.index);for(const p in f.attributes)e.remove(f.attributes[p]);f.removeEventListener("dispose",o),delete i[f.id];const d=s.get(f);d&&(e.remove(d),s.delete(f)),r.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function a(h,f){return i[f.id]===!0||(f.addEventListener("dispose",o),i[f.id]=!0,t.memory.geometries++),f}function c(h){const f=h.attributes;for(const d in f)e.update(f[d],n.ARRAY_BUFFER)}function l(h){const f=[],d=h.index,p=h.attributes.position;let _=0;if(d!==null){const b=d.array;_=d.version;for(let y=0,x=b.length;y<x;y+=3){const T=b[y+0],k=b[y+1],R=b[y+2];f.push(T,k,k,R,R,T)}}else if(p!==void 0){const b=p.array;_=p.version;for(let y=0,x=b.length/3-1;y<x;y+=3){const T=y+0,k=y+1,R=y+2;f.push(T,k,k,R,R,T)}}else return;const g=new(nW(f)?oW:sW)(f,1);g.version=_;const m=s.get(h);m&&e.remove(m),s.set(h,g)}function u(h){const f=s.get(h);if(f){const d=h.index;d!==null&&f.version<d.version&&l(h)}else l(h);return s.get(h)}return{get:a,update:c,getWireframeAttribute:u}}function phe(n,e,t){let r;function i(f){r=f}let s,o;function a(f){s=f.type,o=f.bytesPerElement}function c(f,d){n.drawElements(r,d,s,f*o),t.update(d,r,1)}function l(f,d,p){p!==0&&(n.drawElementsInstanced(r,d,s,f*o,p),t.update(d,r,p))}function u(f,d,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,d,0,s,f,0,p);let g=0;for(let m=0;m<p;m++)g+=d[m];t.update(g,r,1)}function h(f,d,p,_){if(p===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let m=0;m<f.length;m++)l(f[m]/o,d[m],_[m]);else{g.multiDrawElementsInstancedWEBGL(r,d,0,s,f,0,_,0,p);let m=0;for(let b=0;b<p;b++)m+=d[b]*_[b];t.update(m,r,1)}}this.setMode=i,this.setIndex=a,this.render=c,this.renderInstances=l,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function mhe(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}function ghe(n,e,t){const r=new WeakMap,i=new Zo;function s(o,a,c){const l=o.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=u!==void 0?u.length:0;let f=r.get(a);if(f===void 0||f.count!==h){let U=function(){P.dispose(),r.delete(a),a.removeEventListener("dispose",U)};var d=U;f!==void 0&&f.texture.dispose();const p=a.morphAttributes.position!==void 0,_=a.morphAttributes.normal!==void 0,g=a.morphAttributes.color!==void 0,m=a.morphAttributes.position||[],b=a.morphAttributes.normal||[],y=a.morphAttributes.color||[];let x=0;p===!0&&(x=1),_===!0&&(x=2),g===!0&&(x=3);let T=a.attributes.position.count*x,k=1;T>e.maxTextureSize&&(k=Math.ceil(T/e.maxTextureSize),T=e.maxTextureSize);const R=new Float32Array(T*k*4*h),P=new rW(R,T,k,h);P.type=mp,P.needsUpdate=!0;const B=x*4;for(let z=0;z<h;z++){const I=m[z],L=b[z],M=y[z],F=T*k*4*z;for(let Z=0;Z<I.count;Z++){const $=Z*B;p===!0&&(i.fromBufferAttribute(I,Z),R[F+$+0]=i.x,R[F+$+1]=i.y,R[F+$+2]=i.z,R[F+$+3]=0),_===!0&&(i.fromBufferAttribute(L,Z),R[F+$+4]=i.x,R[F+$+5]=i.y,R[F+$+6]=i.z,R[F+$+7]=0),g===!0&&(i.fromBufferAttribute(M,Z),R[F+$+8]=i.x,R[F+$+9]=i.y,R[F+$+10]=i.z,R[F+$+11]=M.itemSize===4?i.w:1)}}f={count:h,texture:P,size:new Nn(T,k)},r.set(a,f),a.addEventListener("dispose",U)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(n,"morphTexture",o.morphTexture,t);else{let p=0;for(let g=0;g<l.length;g++)p+=l[g];const _=a.morphTargetsRelative?1:1-p;c.getUniforms().setValue(n,"morphTargetBaseInfluence",_),c.getUniforms().setValue(n,"morphTargetInfluences",l)}c.getUniforms().setValue(n,"morphTargetsTexture",f.texture,t),c.getUniforms().setValue(n,"morphTargetsTextureSize",f.size)}return{update:s}}function _he(n,e,t,r){let i=new WeakMap;function s(c){const l=r.render.frame,u=c.geometry,h=e.get(c,u);if(i.get(h)!==l&&(e.update(h),i.set(h,l)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),i.get(c)!==l&&(t.update(c.instanceMatrix,n.ARRAY_BUFFER),c.instanceColor!==null&&t.update(c.instanceColor,n.ARRAY_BUFFER),i.set(c,l))),c.isSkinnedMesh){const f=c.skeleton;i.get(f)!==l&&(f.update(),i.set(f,l))}return h}function o(){i=new WeakMap}function a(c){const l=c.target;l.removeEventListener("dispose",a),t.remove(l.instanceMatrix),l.instanceColor!==null&&t.remove(l.instanceColor)}return{update:s,dispose:o}}const fW=new kc,wF=new Vk(1,1),dW=new rW,pW=new Fae,mW=new cW,AF=[],RF=[],CF=new Float32Array(16),MF=new Float32Array(9),kF=new Float32Array(4);function Fx(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let s=AF[i];if(s===void 0&&(s=new Float32Array(i),AF[i]=s),e!==0){r.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function Nc(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function Pc(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function Gk(n,e){let t=RF[e];t===void 0&&(t=new Int32Array(e),RF[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function vhe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function yhe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Nc(t,e))return;n.uniform2fv(this.addr,e),Pc(t,e)}}function bhe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Nc(t,e))return;n.uniform3fv(this.addr,e),Pc(t,e)}}function She(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Nc(t,e))return;n.uniform4fv(this.addr,e),Pc(t,e)}}function Ehe(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Nc(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Pc(t,e)}else{if(Nc(t,r))return;kF.set(r),n.uniformMatrix2fv(this.addr,!1,kF),Pc(t,r)}}function xhe(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Nc(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Pc(t,e)}else{if(Nc(t,r))return;MF.set(r),n.uniformMatrix3fv(this.addr,!1,MF),Pc(t,r)}}function The(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Nc(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Pc(t,e)}else{if(Nc(t,r))return;CF.set(r),n.uniformMatrix4fv(this.addr,!1,CF),Pc(t,r)}}function whe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function Ahe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Nc(t,e))return;n.uniform2iv(this.addr,e),Pc(t,e)}}function Rhe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Nc(t,e))return;n.uniform3iv(this.addr,e),Pc(t,e)}}function Che(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Nc(t,e))return;n.uniform4iv(this.addr,e),Pc(t,e)}}function Mhe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function khe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Nc(t,e))return;n.uniform2uiv(this.addr,e),Pc(t,e)}}function Ohe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Nc(t,e))return;n.uniform3uiv(this.addr,e),Pc(t,e)}}function Ihe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Nc(t,e))return;n.uniform4uiv(this.addr,e),Pc(t,e)}}function Nhe(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i);let s;this.type===n.SAMPLER_2D_SHADOW?(wF.compareFunction=eW,s=wF):s=fW,t.setTexture2D(e||s,i)}function Phe(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||pW,i)}function Dhe(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||mW,i)}function Lhe(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||dW,i)}function Uhe(n){switch(n){case 5126:return vhe;case 35664:return yhe;case 35665:return bhe;case 35666:return She;case 35674:return Ehe;case 35675:return xhe;case 35676:return The;case 5124:case 35670:return whe;case 35667:case 35671:return Ahe;case 35668:case 35672:return Rhe;case 35669:case 35673:return Che;case 5125:return Mhe;case 36294:return khe;case 36295:return Ohe;case 36296:return Ihe;case 35678:case 36198:case 36298:case 36306:case 35682:return Nhe;case 35679:case 36299:case 36307:return Phe;case 35680:case 36300:case 36308:case 36293:return Dhe;case 36289:case 36303:case 36311:case 36292:return Lhe}}function Bhe(n,e){n.uniform1fv(this.addr,e)}function Fhe(n,e){const t=Fx(e,this.size,2);n.uniform2fv(this.addr,t)}function jhe(n,e){const t=Fx(e,this.size,3);n.uniform3fv(this.addr,t)}function zhe(n,e){const t=Fx(e,this.size,4);n.uniform4fv(this.addr,t)}function Hhe(n,e){const t=Fx(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function Vhe(n,e){const t=Fx(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function Ghe(n,e){const t=Fx(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function $he(n,e){n.uniform1iv(this.addr,e)}function Whe(n,e){n.uniform2iv(this.addr,e)}function qhe(n,e){n.uniform3iv(this.addr,e)}function Yhe(n,e){n.uniform4iv(this.addr,e)}function Khe(n,e){n.uniform1uiv(this.addr,e)}function Xhe(n,e){n.uniform2uiv(this.addr,e)}function Zhe(n,e){n.uniform3uiv(this.addr,e)}function Jhe(n,e){n.uniform4uiv(this.addr,e)}function Qhe(n,e,t){const r=this.cache,i=e.length,s=Gk(t,i);Nc(r,s)||(n.uniform1iv(this.addr,s),Pc(r,s));for(let o=0;o!==i;++o)t.setTexture2D(e[o]||fW,s[o])}function efe(n,e,t){const r=this.cache,i=e.length,s=Gk(t,i);Nc(r,s)||(n.uniform1iv(this.addr,s),Pc(r,s));for(let o=0;o!==i;++o)t.setTexture3D(e[o]||pW,s[o])}function tfe(n,e,t){const r=this.cache,i=e.length,s=Gk(t,i);Nc(r,s)||(n.uniform1iv(this.addr,s),Pc(r,s));for(let o=0;o!==i;++o)t.setTextureCube(e[o]||mW,s[o])}function nfe(n,e,t){const r=this.cache,i=e.length,s=Gk(t,i);Nc(r,s)||(n.uniform1iv(this.addr,s),Pc(r,s));for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||dW,s[o])}function rfe(n){switch(n){case 5126:return Bhe;case 35664:return Fhe;case 35665:return jhe;case 35666:return zhe;case 35674:return Hhe;case 35675:return Vhe;case 35676:return Ghe;case 5124:case 35670:return $he;case 35667:case 35671:return Whe;case 35668:case 35672:return qhe;case 35669:case 35673:return Yhe;case 5125:return Khe;case 36294:return Xhe;case 36295:return Zhe;case 36296:return Jhe;case 35678:case 36198:case 36298:case 36306:case 35682:return Qhe;case 35679:case 36299:case 36307:return efe;case 35680:case 36300:case 36308:case 36293:return tfe;case 36289:case 36303:case 36311:case 36292:return nfe}}class ife{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=Uhe(t.type)}}class sfe{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=rfe(t.type)}}class ofe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const a=i[s];a.setValue(e,t[a.id],r)}}}const eI=/(\w+)(\])?(\[|\.)?/g;function OF(n,e){n.seq.push(e),n.map[e.id]=e}function afe(n,e,t){const r=n.name,i=r.length;for(eI.lastIndex=0;;){const s=eI.exec(r),o=eI.lastIndex;let a=s[1];const c=s[2]==="]",l=s[3];if(c&&(a=a|0),l===void 0||l==="["&&o+2===i){OF(t,l===void 0?new ife(a,n,e):new sfe(a,n,e));break}else{let h=t.map[a];h===void 0&&(h=new ofe(a),OF(t,h)),t=h}}}class bC{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const s=e.getActiveUniform(t,i),o=e.getUniformLocation(t,s.name);afe(s,o,this)}}setValue(e,t,r,i){const s=this.map[t];s!==void 0&&s.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let s=0,o=t.length;s!==o;++s){const a=t[s],c=r[a.id];c.needsUpdate!==!1&&a.setValue(e,c.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,s=e.length;i!==s;++i){const o=e[i];o.id in t&&r.push(o)}return r}}function IF(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}const cfe=37297;let lfe=0;function ufe(n,e){const t=n.split(`
`),r=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=i;o<s;o++){const a=o+1;r.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return r.join(`
`)}const NF=new hi;function hfe(n){zi._getMatrix(NF,zi.workingColorSpace,n);const e=`mat3( ${NF.elements.map(t=>t.toFixed(4))} )`;switch(zi.getTransfer(n)){case cM:return[e,"LinearTransferOETF"];case Cs:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function PF(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),i=n.getShaderInfoLog(e).trim();if(r&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+i+`

`+ufe(n.getShaderSource(e),o)}else return i}function ffe(n,e){const t=hfe(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function dfe(n,e){let t;switch(e){case Zoe:t="Linear";break;case Joe:t="Reinhard";break;case Qoe:t="Cineon";break;case W$:t="ACESFilmic";break;case tae:t="AgX";break;case nae:t="Neutral";break;case eae:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const f2=new Lt;function pfe(){zi.getLuminanceCoefficients(f2);const n=f2.x.toFixed(4),e=f2.y.toFixed(4),t=f2.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function mfe(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(gw).join(`
`)}function gfe(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function _fe(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function gw(n){return n!==""}function DF(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function LF(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const vfe=/^[ \t]*#include +<([\w\d./]+)>/gm;function eL(n){return n.replace(vfe,bfe)}const yfe=new Map;function bfe(n,e){let t=di[e];if(t===void 0){const r=yfe.get(e);if(r!==void 0)t=di[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return eL(t)}const Sfe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function UF(n){return n.replace(Sfe,Efe)}function Efe(n,e,t,r){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function BF(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function xfe(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===K4?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===dC?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Cm&&(e="SHADOWMAP_TYPE_VSM"),e}function Tfe(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case JE:case QE:e="ENVMAP_TYPE_CUBE";break;case jk:e="ENVMAP_TYPE_CUBE_UV";break}return e}function wfe(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case QE:e="ENVMAP_MODE_REFRACTION";break}return e}function Afe(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case $$:e="ENVMAP_BLENDING_MULTIPLY";break;case Koe:e="ENVMAP_BLENDING_MIX";break;case Xoe:e="ENVMAP_BLENDING_ADD";break}return e}function Rfe(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:r,maxMip:t}}function Cfe(n,e,t,r){const i=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const c=xfe(t),l=Tfe(t),u=wfe(t),h=Afe(t),f=Rfe(t),d=mfe(t),p=gfe(s),_=i.createProgram();let g,m,b=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(gw).join(`
`),g.length>0&&(g+=`
`),m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(gw).join(`
`),m.length>0&&(m+=`
`)):(g=[BF(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(gw).join(`
`),m=[BF(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Wg?"#define TONE_MAPPING":"",t.toneMapping!==Wg?di.tonemapping_pars_fragment:"",t.toneMapping!==Wg?dfe("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",di.colorspace_pars_fragment,ffe("linearToOutputTexel",t.outputColorSpace),pfe(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(gw).join(`
`)),o=eL(o),o=DF(o,t),o=LF(o,t),a=eL(a),a=DF(a,t),a=LF(a,t),o=UF(o),a=UF(a),t.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,g=[d,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,m=["#define varying in",t.glslVersion===VB?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===VB?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+m);const y=b+g+o,x=b+m+a,T=IF(i,i.VERTEX_SHADER,y),k=IF(i,i.FRAGMENT_SHADER,x);i.attachShader(_,T),i.attachShader(_,k),t.index0AttributeName!==void 0?i.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(_,0,"position"),i.linkProgram(_);function R(z){if(n.debug.checkShaderErrors){const I=i.getProgramInfoLog(_).trim(),L=i.getShaderInfoLog(T).trim(),M=i.getShaderInfoLog(k).trim();let F=!0,Z=!0;if(i.getProgramParameter(_,i.LINK_STATUS)===!1)if(F=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(i,_,T,k);else{const $=PF(i,T,"vertex"),Y=PF(i,k,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(_,i.VALIDATE_STATUS)+`

Material Name: `+z.name+`
Material Type: `+z.type+`

Program Info Log: `+I+`
`+$+`
`+Y)}else I!==""?console.warn("THREE.WebGLProgram: Program Info Log:",I):(L===""||M==="")&&(Z=!1);Z&&(z.diagnostics={runnable:F,programLog:I,vertexShader:{log:L,prefix:g},fragmentShader:{log:M,prefix:m}})}i.deleteShader(T),i.deleteShader(k),P=new bC(i,_),B=_fe(i,_)}let P;this.getUniforms=function(){return P===void 0&&R(this),P};let B;this.getAttributes=function(){return B===void 0&&R(this),B};let U=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return U===!1&&(U=i.getProgramParameter(_,cfe)),U},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=lfe++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=T,this.fragmentShader=k,this}let Mfe=0;class kfe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(r),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new Ofe(e),t.set(e,r)),r}}class Ofe{constructor(e){this.id=Mfe++,this.code=e,this.usedTimes=0}}function Ife(n,e,t,r,i,s,o){const a=new Ww,c=new kfe,l=new Set,u=[],h=i.logarithmicDepthBuffer,f=i.vertexTextures;let d=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(B){return l.add(B),B===0?"uv":`uv${B}`}function g(B,U,z,I,L){const M=I.fog,F=L.geometry,Z=B.isMeshStandardMaterial?I.environment:null,$=(B.isMeshStandardMaterial?t:e).get(B.envMap||Z),Y=$&&$.mapping===jk?$.image.height:null,Q=p[B.type];B.precision!==null&&(d=i.getMaxPrecision(B.precision),d!==B.precision&&console.warn("THREE.WebGLProgram.getParameters:",B.precision,"not supported, using",d,"instead."));const q=F.morphAttributes.position||F.morphAttributes.normal||F.morphAttributes.color,V=q!==void 0?q.length:0;let K=0;F.morphAttributes.position!==void 0&&(K=1),F.morphAttributes.normal!==void 0&&(K=2),F.morphAttributes.color!==void 0&&(K=3);let ne,ie,ae,Te;if(Q){const at=Im[Q];ne=at.vertexShader,ie=at.fragmentShader}else ne=B.vertexShader,ie=B.fragmentShader,c.update(B),ae=c.getVertexShaderID(B),Te=c.getFragmentShaderID(B);const Ie=n.getRenderTarget(),be=n.state.buffers.depth.getReversed(),Pe=L.isInstancedMesh===!0,$e=L.isBatchedMesh===!0,tt=!!B.map,qe=!!B.matcap,ut=!!$,te=!!B.aoMap,Ne=!!B.lightMap,Be=!!B.bumpMap,De=!!B.normalMap,Oe=!!B.displacementMap,ue=!!B.emissiveMap,_e=!!B.metalnessMap,we=!!B.roughnessMap,pe=B.anisotropy>0,ze=B.clearcoat>0,Ze=B.dispersion>0,Je=B.iridescence>0,nt=B.sheen>0,Pt=B.transmission>0,vt=pe&&!!B.anisotropyMap,At=ze&&!!B.clearcoatMap,Re=ze&&!!B.clearcoatNormalMap,ce=ze&&!!B.clearcoatRoughnessMap,W=Je&&!!B.iridescenceMap,le=Je&&!!B.iridescenceThicknessMap,Se=nt&&!!B.sheenColorMap,Ae=nt&&!!B.sheenRoughnessMap,ye=!!B.specularMap,ve=!!B.specularColorMap,Xe=!!B.specularIntensityMap,Me=Pt&&!!B.transmissionMap,Ve=Pt&&!!B.thicknessMap,je=!!B.gradientMap,We=!!B.alphaMap,ct=B.alphaTest>0,Fe=!!B.alphaHash,rt=!!B.extensions;let it=Wg;B.toneMapped&&(Ie===null||Ie.isXRRenderTarget===!0)&&(it=n.toneMapping);const St={shaderID:Q,shaderType:B.type,shaderName:B.name,vertexShader:ne,fragmentShader:ie,defines:B.defines,customVertexShaderID:ae,customFragmentShaderID:Te,isRawShaderMaterial:B.isRawShaderMaterial===!0,glslVersion:B.glslVersion,precision:d,batching:$e,batchingColor:$e&&L._colorsTexture!==null,instancing:Pe,instancingColor:Pe&&L.instanceColor!==null,instancingMorph:Pe&&L.morphTexture!==null,supportsVertexTextures:f,outputColorSpace:Ie===null?n.outputColorSpace:Ie.isXRRenderTarget===!0?Ie.texture.colorSpace:t_,alphaToCoverage:!!B.alphaToCoverage,map:tt,matcap:qe,envMap:ut,envMapMode:ut&&$.mapping,envMapCubeUVHeight:Y,aoMap:te,lightMap:Ne,bumpMap:Be,normalMap:De,displacementMap:f&&Oe,emissiveMap:ue,normalMapObjectSpace:De&&B.normalMapType===oae,normalMapTangentSpace:De&&B.normalMapType===sae,metalnessMap:_e,roughnessMap:we,anisotropy:pe,anisotropyMap:vt,clearcoat:ze,clearcoatMap:At,clearcoatNormalMap:Re,clearcoatRoughnessMap:ce,dispersion:Ze,iridescence:Je,iridescenceMap:W,iridescenceThicknessMap:le,sheen:nt,sheenColorMap:Se,sheenRoughnessMap:Ae,specularMap:ye,specularColorMap:ve,specularIntensityMap:Xe,transmission:Pt,transmissionMap:Me,thicknessMap:Ve,gradientMap:je,opaque:B.transparent===!1&&B.blending===FE&&B.alphaToCoverage===!1,alphaMap:We,alphaTest:ct,alphaHash:Fe,combine:B.combine,mapUv:tt&&_(B.map.channel),aoMapUv:te&&_(B.aoMap.channel),lightMapUv:Ne&&_(B.lightMap.channel),bumpMapUv:Be&&_(B.bumpMap.channel),normalMapUv:De&&_(B.normalMap.channel),displacementMapUv:Oe&&_(B.displacementMap.channel),emissiveMapUv:ue&&_(B.emissiveMap.channel),metalnessMapUv:_e&&_(B.metalnessMap.channel),roughnessMapUv:we&&_(B.roughnessMap.channel),anisotropyMapUv:vt&&_(B.anisotropyMap.channel),clearcoatMapUv:At&&_(B.clearcoatMap.channel),clearcoatNormalMapUv:Re&&_(B.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ce&&_(B.clearcoatRoughnessMap.channel),iridescenceMapUv:W&&_(B.iridescenceMap.channel),iridescenceThicknessMapUv:le&&_(B.iridescenceThicknessMap.channel),sheenColorMapUv:Se&&_(B.sheenColorMap.channel),sheenRoughnessMapUv:Ae&&_(B.sheenRoughnessMap.channel),specularMapUv:ye&&_(B.specularMap.channel),specularColorMapUv:ve&&_(B.specularColorMap.channel),specularIntensityMapUv:Xe&&_(B.specularIntensityMap.channel),transmissionMapUv:Me&&_(B.transmissionMap.channel),thicknessMapUv:Ve&&_(B.thicknessMap.channel),alphaMapUv:We&&_(B.alphaMap.channel),vertexTangents:!!F.attributes.tangent&&(De||pe),vertexColors:B.vertexColors,vertexAlphas:B.vertexColors===!0&&!!F.attributes.color&&F.attributes.color.itemSize===4,pointsUvs:L.isPoints===!0&&!!F.attributes.uv&&(tt||We),fog:!!M,useFog:B.fog===!0,fogExp2:!!M&&M.isFogExp2,flatShading:B.flatShading===!0,sizeAttenuation:B.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:be,skinning:L.isSkinnedMesh===!0,morphTargets:F.morphAttributes.position!==void 0,morphNormals:F.morphAttributes.normal!==void 0,morphColors:F.morphAttributes.color!==void 0,morphTargetsCount:V,morphTextureStride:K,numDirLights:U.directional.length,numPointLights:U.point.length,numSpotLights:U.spot.length,numSpotLightMaps:U.spotLightMap.length,numRectAreaLights:U.rectArea.length,numHemiLights:U.hemi.length,numDirLightShadows:U.directionalShadowMap.length,numPointLightShadows:U.pointShadowMap.length,numSpotLightShadows:U.spotShadowMap.length,numSpotLightShadowsWithMaps:U.numSpotLightShadowsWithMaps,numLightProbes:U.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:B.dithering,shadowMapEnabled:n.shadowMap.enabled&&z.length>0,shadowMapType:n.shadowMap.type,toneMapping:it,decodeVideoTexture:tt&&B.map.isVideoTexture===!0&&zi.getTransfer(B.map.colorSpace)===Cs,decodeVideoTextureEmissive:ue&&B.emissiveMap.isVideoTexture===!0&&zi.getTransfer(B.emissiveMap.colorSpace)===Cs,premultipliedAlpha:B.premultipliedAlpha,doubleSided:B.side===Ba,flipSided:B.side===ol,useDepthPacking:B.depthPacking>=0,depthPacking:B.depthPacking||0,index0AttributeName:B.index0AttributeName,extensionClipCullDistance:rt&&B.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(rt&&B.extensions.multiDraw===!0||$e)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:B.customProgramCacheKey()};return St.vertexUv1s=l.has(1),St.vertexUv2s=l.has(2),St.vertexUv3s=l.has(3),l.clear(),St}function m(B){const U=[];if(B.shaderID?U.push(B.shaderID):(U.push(B.customVertexShaderID),U.push(B.customFragmentShaderID)),B.defines!==void 0)for(const z in B.defines)U.push(z),U.push(B.defines[z]);return B.isRawShaderMaterial===!1&&(b(U,B),y(U,B),U.push(n.outputColorSpace)),U.push(B.customProgramCacheKey),U.join()}function b(B,U){B.push(U.precision),B.push(U.outputColorSpace),B.push(U.envMapMode),B.push(U.envMapCubeUVHeight),B.push(U.mapUv),B.push(U.alphaMapUv),B.push(U.lightMapUv),B.push(U.aoMapUv),B.push(U.bumpMapUv),B.push(U.normalMapUv),B.push(U.displacementMapUv),B.push(U.emissiveMapUv),B.push(U.metalnessMapUv),B.push(U.roughnessMapUv),B.push(U.anisotropyMapUv),B.push(U.clearcoatMapUv),B.push(U.clearcoatNormalMapUv),B.push(U.clearcoatRoughnessMapUv),B.push(U.iridescenceMapUv),B.push(U.iridescenceThicknessMapUv),B.push(U.sheenColorMapUv),B.push(U.sheenRoughnessMapUv),B.push(U.specularMapUv),B.push(U.specularColorMapUv),B.push(U.specularIntensityMapUv),B.push(U.transmissionMapUv),B.push(U.thicknessMapUv),B.push(U.combine),B.push(U.fogExp2),B.push(U.sizeAttenuation),B.push(U.morphTargetsCount),B.push(U.morphAttributeCount),B.push(U.numDirLights),B.push(U.numPointLights),B.push(U.numSpotLights),B.push(U.numSpotLightMaps),B.push(U.numHemiLights),B.push(U.numRectAreaLights),B.push(U.numDirLightShadows),B.push(U.numPointLightShadows),B.push(U.numSpotLightShadows),B.push(U.numSpotLightShadowsWithMaps),B.push(U.numLightProbes),B.push(U.shadowMapType),B.push(U.toneMapping),B.push(U.numClippingPlanes),B.push(U.numClipIntersection),B.push(U.depthPacking)}function y(B,U){a.disableAll(),U.supportsVertexTextures&&a.enable(0),U.instancing&&a.enable(1),U.instancingColor&&a.enable(2),U.instancingMorph&&a.enable(3),U.matcap&&a.enable(4),U.envMap&&a.enable(5),U.normalMapObjectSpace&&a.enable(6),U.normalMapTangentSpace&&a.enable(7),U.clearcoat&&a.enable(8),U.iridescence&&a.enable(9),U.alphaTest&&a.enable(10),U.vertexColors&&a.enable(11),U.vertexAlphas&&a.enable(12),U.vertexUv1s&&a.enable(13),U.vertexUv2s&&a.enable(14),U.vertexUv3s&&a.enable(15),U.vertexTangents&&a.enable(16),U.anisotropy&&a.enable(17),U.alphaHash&&a.enable(18),U.batching&&a.enable(19),U.dispersion&&a.enable(20),U.batchingColor&&a.enable(21),B.push(a.mask),a.disableAll(),U.fog&&a.enable(0),U.useFog&&a.enable(1),U.flatShading&&a.enable(2),U.logarithmicDepthBuffer&&a.enable(3),U.reverseDepthBuffer&&a.enable(4),U.skinning&&a.enable(5),U.morphTargets&&a.enable(6),U.morphNormals&&a.enable(7),U.morphColors&&a.enable(8),U.premultipliedAlpha&&a.enable(9),U.shadowMapEnabled&&a.enable(10),U.doubleSided&&a.enable(11),U.flipSided&&a.enable(12),U.useDepthPacking&&a.enable(13),U.dithering&&a.enable(14),U.transmission&&a.enable(15),U.sheen&&a.enable(16),U.opaque&&a.enable(17),U.pointsUvs&&a.enable(18),U.decodeVideoTexture&&a.enable(19),U.decodeVideoTextureEmissive&&a.enable(20),U.alphaToCoverage&&a.enable(21),B.push(a.mask)}function x(B){const U=p[B.type];let z;if(U){const I=Im[U];z=Jae.clone(I.uniforms)}else z=B.uniforms;return z}function T(B,U){let z;for(let I=0,L=u.length;I<L;I++){const M=u[I];if(M.cacheKey===U){z=M,++z.usedTimes;break}}return z===void 0&&(z=new Cfe(n,U,B,s),u.push(z)),z}function k(B){if(--B.usedTimes===0){const U=u.indexOf(B);u[U]=u[u.length-1],u.pop(),B.destroy()}}function R(B){c.remove(B)}function P(){c.dispose()}return{getParameters:g,getProgramCacheKey:m,getUniforms:x,acquireProgram:T,releaseProgram:k,releaseShaderCache:R,programs:u,dispose:P}}function Nfe(){let n=new WeakMap;function e(o){return n.has(o)}function t(o){let a=n.get(o);return a===void 0&&(a={},n.set(o,a)),a}function r(o){n.delete(o)}function i(o,a,c){n.get(o)[a]=c}function s(){n=new WeakMap}return{has:e,get:t,remove:r,update:i,dispose:s}}function Pfe(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function FF(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function jF(){const n=[];let e=0;const t=[],r=[],i=[];function s(){e=0,t.length=0,r.length=0,i.length=0}function o(h,f,d,p,_,g){let m=n[e];return m===void 0?(m={id:h.id,object:h,geometry:f,material:d,groupOrder:p,renderOrder:h.renderOrder,z:_,group:g},n[e]=m):(m.id=h.id,m.object=h,m.geometry=f,m.material=d,m.groupOrder=p,m.renderOrder=h.renderOrder,m.z=_,m.group=g),e++,m}function a(h,f,d,p,_,g){const m=o(h,f,d,p,_,g);d.transmission>0?r.push(m):d.transparent===!0?i.push(m):t.push(m)}function c(h,f,d,p,_,g){const m=o(h,f,d,p,_,g);d.transmission>0?r.unshift(m):d.transparent===!0?i.unshift(m):t.unshift(m)}function l(h,f){t.length>1&&t.sort(h||Pfe),r.length>1&&r.sort(f||FF),i.length>1&&i.sort(f||FF)}function u(){for(let h=e,f=n.length;h<f;h++){const d=n[h];if(d.id===null)break;d.id=null,d.object=null,d.geometry=null,d.material=null,d.group=null}}return{opaque:t,transmissive:r,transparent:i,init:s,push:a,unshift:c,finish:u,sort:l}}function Dfe(){let n=new WeakMap;function e(r,i){const s=n.get(r);let o;return s===void 0?(o=new jF,n.set(r,[o])):i>=s.length?(o=new jF,s.push(o)):o=s[i],o}function t(){n=new WeakMap}return{get:e,dispose:t}}function Lfe(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Lt,color:new gi};break;case"SpotLight":t={position:new Lt,direction:new Lt,color:new gi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Lt,color:new gi,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Lt,skyColor:new gi,groundColor:new gi};break;case"RectAreaLight":t={color:new gi,position:new Lt,halfWidth:new Lt,halfHeight:new Lt};break}return n[e.id]=t,t}}}function Ufe(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Nn};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Nn};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Nn,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let Bfe=0;function Ffe(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function jfe(n){const e=new Lfe,t=Ufe(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)r.probe.push(new Lt);const i=new Lt,s=new vo,o=new vo;function a(l){let u=0,h=0,f=0;for(let B=0;B<9;B++)r.probe[B].set(0,0,0);let d=0,p=0,_=0,g=0,m=0,b=0,y=0,x=0,T=0,k=0,R=0;l.sort(Ffe);for(let B=0,U=l.length;B<U;B++){const z=l[B],I=z.color,L=z.intensity,M=z.distance,F=z.shadow&&z.shadow.map?z.shadow.map.texture:null;if(z.isAmbientLight)u+=I.r*L,h+=I.g*L,f+=I.b*L;else if(z.isLightProbe){for(let Z=0;Z<9;Z++)r.probe[Z].addScaledVector(z.sh.coefficients[Z],L);R++}else if(z.isDirectionalLight){const Z=e.get(z);if(Z.color.copy(z.color).multiplyScalar(z.intensity),z.castShadow){const $=z.shadow,Y=t.get(z);Y.shadowIntensity=$.intensity,Y.shadowBias=$.bias,Y.shadowNormalBias=$.normalBias,Y.shadowRadius=$.radius,Y.shadowMapSize=$.mapSize,r.directionalShadow[d]=Y,r.directionalShadowMap[d]=F,r.directionalShadowMatrix[d]=z.shadow.matrix,b++}r.directional[d]=Z,d++}else if(z.isSpotLight){const Z=e.get(z);Z.position.setFromMatrixPosition(z.matrixWorld),Z.color.copy(I).multiplyScalar(L),Z.distance=M,Z.coneCos=Math.cos(z.angle),Z.penumbraCos=Math.cos(z.angle*(1-z.penumbra)),Z.decay=z.decay,r.spot[_]=Z;const $=z.shadow;if(z.map&&(r.spotLightMap[T]=z.map,T++,$.updateMatrices(z),z.castShadow&&k++),r.spotLightMatrix[_]=$.matrix,z.castShadow){const Y=t.get(z);Y.shadowIntensity=$.intensity,Y.shadowBias=$.bias,Y.shadowNormalBias=$.normalBias,Y.shadowRadius=$.radius,Y.shadowMapSize=$.mapSize,r.spotShadow[_]=Y,r.spotShadowMap[_]=F,x++}_++}else if(z.isRectAreaLight){const Z=e.get(z);Z.color.copy(I).multiplyScalar(L),Z.halfWidth.set(z.width*.5,0,0),Z.halfHeight.set(0,z.height*.5,0),r.rectArea[g]=Z,g++}else if(z.isPointLight){const Z=e.get(z);if(Z.color.copy(z.color).multiplyScalar(z.intensity),Z.distance=z.distance,Z.decay=z.decay,z.castShadow){const $=z.shadow,Y=t.get(z);Y.shadowIntensity=$.intensity,Y.shadowBias=$.bias,Y.shadowNormalBias=$.normalBias,Y.shadowRadius=$.radius,Y.shadowMapSize=$.mapSize,Y.shadowCameraNear=$.camera.near,Y.shadowCameraFar=$.camera.far,r.pointShadow[p]=Y,r.pointShadowMap[p]=F,r.pointShadowMatrix[p]=z.shadow.matrix,y++}r.point[p]=Z,p++}else if(z.isHemisphereLight){const Z=e.get(z);Z.skyColor.copy(z.color).multiplyScalar(L),Z.groundColor.copy(z.groundColor).multiplyScalar(L),r.hemi[m]=Z,m++}}g>0&&(n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Fn.LTC_FLOAT_1,r.rectAreaLTC2=Fn.LTC_FLOAT_2):(r.rectAreaLTC1=Fn.LTC_HALF_1,r.rectAreaLTC2=Fn.LTC_HALF_2)),r.ambient[0]=u,r.ambient[1]=h,r.ambient[2]=f;const P=r.hash;(P.directionalLength!==d||P.pointLength!==p||P.spotLength!==_||P.rectAreaLength!==g||P.hemiLength!==m||P.numDirectionalShadows!==b||P.numPointShadows!==y||P.numSpotShadows!==x||P.numSpotMaps!==T||P.numLightProbes!==R)&&(r.directional.length=d,r.spot.length=_,r.rectArea.length=g,r.point.length=p,r.hemi.length=m,r.directionalShadow.length=b,r.directionalShadowMap.length=b,r.pointShadow.length=y,r.pointShadowMap.length=y,r.spotShadow.length=x,r.spotShadowMap.length=x,r.directionalShadowMatrix.length=b,r.pointShadowMatrix.length=y,r.spotLightMatrix.length=x+T-k,r.spotLightMap.length=T,r.numSpotLightShadowsWithMaps=k,r.numLightProbes=R,P.directionalLength=d,P.pointLength=p,P.spotLength=_,P.rectAreaLength=g,P.hemiLength=m,P.numDirectionalShadows=b,P.numPointShadows=y,P.numSpotShadows=x,P.numSpotMaps=T,P.numLightProbes=R,r.version=Bfe++)}function c(l,u){let h=0,f=0,d=0,p=0,_=0;const g=u.matrixWorldInverse;for(let m=0,b=l.length;m<b;m++){const y=l[m];if(y.isDirectionalLight){const x=r.directional[h];x.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),x.direction.sub(i),x.direction.transformDirection(g),h++}else if(y.isSpotLight){const x=r.spot[d];x.position.setFromMatrixPosition(y.matrixWorld),x.position.applyMatrix4(g),x.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),x.direction.sub(i),x.direction.transformDirection(g),d++}else if(y.isRectAreaLight){const x=r.rectArea[p];x.position.setFromMatrixPosition(y.matrixWorld),x.position.applyMatrix4(g),o.identity(),s.copy(y.matrixWorld),s.premultiply(g),o.extractRotation(s),x.halfWidth.set(y.width*.5,0,0),x.halfHeight.set(0,y.height*.5,0),x.halfWidth.applyMatrix4(o),x.halfHeight.applyMatrix4(o),p++}else if(y.isPointLight){const x=r.point[f];x.position.setFromMatrixPosition(y.matrixWorld),x.position.applyMatrix4(g),f++}else if(y.isHemisphereLight){const x=r.hemi[_];x.direction.setFromMatrixPosition(y.matrixWorld),x.direction.transformDirection(g),_++}}}return{setup:a,setupView:c,state:r}}function zF(n){const e=new jfe(n),t=[],r=[];function i(u){l.camera=u,t.length=0,r.length=0}function s(u){t.push(u)}function o(u){r.push(u)}function a(){e.setup(t)}function c(u){e.setupView(t,u)}const l={lightsArray:t,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:l,setupLights:a,setupLightsView:c,pushLight:s,pushShadow:o}}function zfe(n){let e=new WeakMap;function t(i,s=0){const o=e.get(i);let a;return o===void 0?(a=new zF(n),e.set(i,[a])):s>=o.length?(a=new zF(n),o.push(a)):a=o[s],a}function r(){e=new WeakMap}return{get:t,dispose:r}}const Hfe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Vfe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Gfe(n,e,t){let r=new lW;const i=new Nn,s=new Nn,o=new Zo,a=new hce({depthPacking:iae}),c=new fce,l={},u=t.maxTextureSize,h={[e_]:ol,[ol]:e_,[Ba]:Ba},f=new io({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Nn},radius:{value:4}},vertexShader:Hfe,fragmentShader:Vfe}),d=f.clone();d.defines.HORIZONTAL_PASS=1;const p=new h0;p.setAttribute("position",new Dh(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new wf(p,f),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=K4;let m=this.type;this.render=function(k,R,P){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||k.length===0)return;const B=n.getRenderTarget(),U=n.getActiveCubeFace(),z=n.getActiveMipmapLevel(),I=n.state;I.setBlending(Il),I.buffers.color.setClear(1,1,1,1),I.buffers.depth.setTest(!0),I.setScissorTest(!1);const L=m!==Cm&&this.type===Cm,M=m===Cm&&this.type!==Cm;for(let F=0,Z=k.length;F<Z;F++){const $=k[F],Y=$.shadow;if(Y===void 0){console.warn("THREE.WebGLShadowMap:",$,"has no shadow.");continue}if(Y.autoUpdate===!1&&Y.needsUpdate===!1)continue;i.copy(Y.mapSize);const Q=Y.getFrameExtents();if(i.multiply(Q),s.copy(Y.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/Q.x),i.x=s.x*Q.x,Y.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/Q.y),i.y=s.y*Q.y,Y.mapSize.y=s.y)),Y.map===null||L===!0||M===!0){const V=this.type!==Cm?{minFilter:cu,magFilter:cu}:{};Y.map!==null&&Y.map.dispose(),Y.map=new Nl(i.x,i.y,V),Y.map.texture.name=$.name+".shadowMap",Y.camera.updateProjectionMatrix()}n.setRenderTarget(Y.map),n.clear();const q=Y.getViewportCount();for(let V=0;V<q;V++){const K=Y.getViewport(V);o.set(s.x*K.x,s.y*K.y,s.x*K.z,s.y*K.w),I.viewport(o),Y.updateMatrices($,V),r=Y.getFrustum(),x(R,P,Y.camera,$,this.type)}Y.isPointLightShadow!==!0&&this.type===Cm&&b(Y,P),Y.needsUpdate=!1}m=this.type,g.needsUpdate=!1,n.setRenderTarget(B,U,z)};function b(k,R){const P=e.update(_);f.defines.VSM_SAMPLES!==k.blurSamples&&(f.defines.VSM_SAMPLES=k.blurSamples,d.defines.VSM_SAMPLES=k.blurSamples,f.needsUpdate=!0,d.needsUpdate=!0),k.mapPass===null&&(k.mapPass=new Nl(i.x,i.y)),f.uniforms.shadow_pass.value=k.map.texture,f.uniforms.resolution.value=k.mapSize,f.uniforms.radius.value=k.radius,n.setRenderTarget(k.mapPass),n.clear(),n.renderBufferDirect(R,null,P,f,_,null),d.uniforms.shadow_pass.value=k.mapPass.texture,d.uniforms.resolution.value=k.mapSize,d.uniforms.radius.value=k.radius,n.setRenderTarget(k.map),n.clear(),n.renderBufferDirect(R,null,P,d,_,null)}function y(k,R,P,B){let U=null;const z=P.isPointLight===!0?k.customDistanceMaterial:k.customDepthMaterial;if(z!==void 0)U=z;else if(U=P.isPointLight===!0?c:a,n.localClippingEnabled&&R.clipShadows===!0&&Array.isArray(R.clippingPlanes)&&R.clippingPlanes.length!==0||R.displacementMap&&R.displacementScale!==0||R.alphaMap&&R.alphaTest>0||R.map&&R.alphaTest>0||R.alphaToCoverage===!0){const I=U.uuid,L=R.uuid;let M=l[I];M===void 0&&(M={},l[I]=M);let F=M[L];F===void 0&&(F=U.clone(),M[L]=F,R.addEventListener("dispose",T)),U=F}if(U.visible=R.visible,U.wireframe=R.wireframe,B===Cm?U.side=R.shadowSide!==null?R.shadowSide:R.side:U.side=R.shadowSide!==null?R.shadowSide:h[R.side],U.alphaMap=R.alphaMap,U.alphaTest=R.alphaToCoverage===!0?.5:R.alphaTest,U.map=R.map,U.clipShadows=R.clipShadows,U.clippingPlanes=R.clippingPlanes,U.clipIntersection=R.clipIntersection,U.displacementMap=R.displacementMap,U.displacementScale=R.displacementScale,U.displacementBias=R.displacementBias,U.wireframeLinewidth=R.wireframeLinewidth,U.linewidth=R.linewidth,P.isPointLight===!0&&U.isMeshDistanceMaterial===!0){const I=n.properties.get(U);I.light=P}return U}function x(k,R,P,B,U){if(k.visible===!1)return;if(k.layers.test(R.layers)&&(k.isMesh||k.isLine||k.isPoints)&&(k.castShadow||k.receiveShadow&&U===Cm)&&(!k.frustumCulled||r.intersectsObject(k))){k.modelViewMatrix.multiplyMatrices(P.matrixWorldInverse,k.matrixWorld);const L=e.update(k),M=k.material;if(Array.isArray(M)){const F=L.groups;for(let Z=0,$=F.length;Z<$;Z++){const Y=F[Z],Q=M[Y.materialIndex];if(Q&&Q.visible){const q=y(k,Q,B,U);k.onBeforeShadow(n,k,R,P,L,q,Y),n.renderBufferDirect(P,null,L,q,k,Y),k.onAfterShadow(n,k,R,P,L,q,Y)}}}else if(M.visible){const F=y(k,M,B,U);k.onBeforeShadow(n,k,R,P,L,F,null),n.renderBufferDirect(P,null,L,F,k,null),k.onAfterShadow(n,k,R,P,L,F,null)}}const I=k.children;for(let L=0,M=I.length;L<M;L++)x(I[L],R,P,B,U)}function T(k){k.target.removeEventListener("dispose",T);for(const P in l){const B=l[P],U=k.target.uuid;U in B&&(B[U].dispose(),delete B[U])}}}const $fe={[mD]:gD,[_D]:bD,[vD]:SD,[ZE]:yD,[gD]:mD,[bD]:_D,[SD]:vD,[yD]:ZE};function Wfe(n,e){function t(){let Me=!1;const Ve=new Zo;let je=null;const We=new Zo(0,0,0,0);return{setMask:function(ct){je!==ct&&!Me&&(n.colorMask(ct,ct,ct,ct),je=ct)},setLocked:function(ct){Me=ct},setClear:function(ct,Fe,rt,it,St){St===!0&&(ct*=it,Fe*=it,rt*=it),Ve.set(ct,Fe,rt,it),We.equals(Ve)===!1&&(n.clearColor(ct,Fe,rt,it),We.copy(Ve))},reset:function(){Me=!1,je=null,We.set(-1,0,0,0)}}}function r(){let Me=!1,Ve=!1,je=null,We=null,ct=null;return{setReversed:function(Fe){if(Ve!==Fe){const rt=e.get("EXT_clip_control");Fe?rt.clipControlEXT(rt.LOWER_LEFT_EXT,rt.ZERO_TO_ONE_EXT):rt.clipControlEXT(rt.LOWER_LEFT_EXT,rt.NEGATIVE_ONE_TO_ONE_EXT),Ve=Fe;const it=ct;ct=null,this.setClear(it)}},getReversed:function(){return Ve},setTest:function(Fe){Fe?Ie(n.DEPTH_TEST):be(n.DEPTH_TEST)},setMask:function(Fe){je!==Fe&&!Me&&(n.depthMask(Fe),je=Fe)},setFunc:function(Fe){if(Ve&&(Fe=$fe[Fe]),We!==Fe){switch(Fe){case mD:n.depthFunc(n.NEVER);break;case gD:n.depthFunc(n.ALWAYS);break;case _D:n.depthFunc(n.LESS);break;case ZE:n.depthFunc(n.LEQUAL);break;case vD:n.depthFunc(n.EQUAL);break;case yD:n.depthFunc(n.GEQUAL);break;case bD:n.depthFunc(n.GREATER);break;case SD:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}We=Fe}},setLocked:function(Fe){Me=Fe},setClear:function(Fe){ct!==Fe&&(Ve&&(Fe=1-Fe),n.clearDepth(Fe),ct=Fe)},reset:function(){Me=!1,je=null,We=null,ct=null,Ve=!1}}}function i(){let Me=!1,Ve=null,je=null,We=null,ct=null,Fe=null,rt=null,it=null,St=null;return{setTest:function(at){Me||(at?Ie(n.STENCIL_TEST):be(n.STENCIL_TEST))},setMask:function(at){Ve!==at&&!Me&&(n.stencilMask(at),Ve=at)},setFunc:function(at,Yt,sn){(je!==at||We!==Yt||ct!==sn)&&(n.stencilFunc(at,Yt,sn),je=at,We=Yt,ct=sn)},setOp:function(at,Yt,sn){(Fe!==at||rt!==Yt||it!==sn)&&(n.stencilOp(at,Yt,sn),Fe=at,rt=Yt,it=sn)},setLocked:function(at){Me=at},setClear:function(at){St!==at&&(n.clearStencil(at),St=at)},reset:function(){Me=!1,Ve=null,je=null,We=null,ct=null,Fe=null,rt=null,it=null,St=null}}}const s=new t,o=new r,a=new i,c=new WeakMap,l=new WeakMap;let u={},h={},f=new WeakMap,d=[],p=null,_=!1,g=null,m=null,b=null,y=null,x=null,T=null,k=null,R=new gi(0,0,0),P=0,B=!1,U=null,z=null,I=null,L=null,M=null;const F=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Z=!1,$=0;const Y=n.getParameter(n.VERSION);Y.indexOf("WebGL")!==-1?($=parseFloat(/^WebGL (\d)/.exec(Y)[1]),Z=$>=1):Y.indexOf("OpenGL ES")!==-1&&($=parseFloat(/^OpenGL ES (\d)/.exec(Y)[1]),Z=$>=2);let Q=null,q={};const V=n.getParameter(n.SCISSOR_BOX),K=n.getParameter(n.VIEWPORT),ne=new Zo().fromArray(V),ie=new Zo().fromArray(K);function ae(Me,Ve,je,We){const ct=new Uint8Array(4),Fe=n.createTexture();n.bindTexture(Me,Fe),n.texParameteri(Me,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(Me,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let rt=0;rt<je;rt++)Me===n.TEXTURE_3D||Me===n.TEXTURE_2D_ARRAY?n.texImage3D(Ve,0,n.RGBA,1,1,We,0,n.RGBA,n.UNSIGNED_BYTE,ct):n.texImage2D(Ve+rt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,ct);return Fe}const Te={};Te[n.TEXTURE_2D]=ae(n.TEXTURE_2D,n.TEXTURE_2D,1),Te[n.TEXTURE_CUBE_MAP]=ae(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),Te[n.TEXTURE_2D_ARRAY]=ae(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Te[n.TEXTURE_3D]=ae(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),Ie(n.DEPTH_TEST),o.setFunc(ZE),Be(!1),De(UB),Ie(n.CULL_FACE),te(Il);function Ie(Me){u[Me]!==!0&&(n.enable(Me),u[Me]=!0)}function be(Me){u[Me]!==!1&&(n.disable(Me),u[Me]=!1)}function Pe(Me,Ve){return h[Me]!==Ve?(n.bindFramebuffer(Me,Ve),h[Me]=Ve,Me===n.DRAW_FRAMEBUFFER&&(h[n.FRAMEBUFFER]=Ve),Me===n.FRAMEBUFFER&&(h[n.DRAW_FRAMEBUFFER]=Ve),!0):!1}function $e(Me,Ve){let je=d,We=!1;if(Me){je=f.get(Ve),je===void 0&&(je=[],f.set(Ve,je));const ct=Me.textures;if(je.length!==ct.length||je[0]!==n.COLOR_ATTACHMENT0){for(let Fe=0,rt=ct.length;Fe<rt;Fe++)je[Fe]=n.COLOR_ATTACHMENT0+Fe;je.length=ct.length,We=!0}}else je[0]!==n.BACK&&(je[0]=n.BACK,We=!0);We&&n.drawBuffers(je)}function tt(Me){return p!==Me?(n.useProgram(Me),p=Me,!0):!1}const qe={[k1]:n.FUNC_ADD,[Ioe]:n.FUNC_SUBTRACT,[Noe]:n.FUNC_REVERSE_SUBTRACT};qe[Poe]=n.MIN,qe[Doe]=n.MAX;const ut={[Loe]:n.ZERO,[Uoe]:n.ONE,[Boe]:n.SRC_COLOR,[dD]:n.SRC_ALPHA,[Goe]:n.SRC_ALPHA_SATURATE,[Hoe]:n.DST_COLOR,[joe]:n.DST_ALPHA,[Foe]:n.ONE_MINUS_SRC_COLOR,[pD]:n.ONE_MINUS_SRC_ALPHA,[Voe]:n.ONE_MINUS_DST_COLOR,[zoe]:n.ONE_MINUS_DST_ALPHA,[$oe]:n.CONSTANT_COLOR,[Woe]:n.ONE_MINUS_CONSTANT_COLOR,[qoe]:n.CONSTANT_ALPHA,[Yoe]:n.ONE_MINUS_CONSTANT_ALPHA};function te(Me,Ve,je,We,ct,Fe,rt,it,St,at){if(Me===Il){_===!0&&(be(n.BLEND),_=!1);return}if(_===!1&&(Ie(n.BLEND),_=!0),Me!==Ooe){if(Me!==g||at!==B){if((m!==k1||x!==k1)&&(n.blendEquation(n.FUNC_ADD),m=k1,x=k1),at)switch(Me){case FE:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case BB:n.blendFunc(n.ONE,n.ONE);break;case FB:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case jB:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Me);break}else switch(Me){case FE:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case BB:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case FB:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case jB:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Me);break}b=null,y=null,T=null,k=null,R.set(0,0,0),P=0,g=Me,B=at}return}ct=ct||Ve,Fe=Fe||je,rt=rt||We,(Ve!==m||ct!==x)&&(n.blendEquationSeparate(qe[Ve],qe[ct]),m=Ve,x=ct),(je!==b||We!==y||Fe!==T||rt!==k)&&(n.blendFuncSeparate(ut[je],ut[We],ut[Fe],ut[rt]),b=je,y=We,T=Fe,k=rt),(it.equals(R)===!1||St!==P)&&(n.blendColor(it.r,it.g,it.b,St),R.copy(it),P=St),g=Me,B=!1}function Ne(Me,Ve){Me.side===Ba?be(n.CULL_FACE):Ie(n.CULL_FACE);let je=Me.side===ol;Ve&&(je=!je),Be(je),Me.blending===FE&&Me.transparent===!1?te(Il):te(Me.blending,Me.blendEquation,Me.blendSrc,Me.blendDst,Me.blendEquationAlpha,Me.blendSrcAlpha,Me.blendDstAlpha,Me.blendColor,Me.blendAlpha,Me.premultipliedAlpha),o.setFunc(Me.depthFunc),o.setTest(Me.depthTest),o.setMask(Me.depthWrite),s.setMask(Me.colorWrite);const We=Me.stencilWrite;a.setTest(We),We&&(a.setMask(Me.stencilWriteMask),a.setFunc(Me.stencilFunc,Me.stencilRef,Me.stencilFuncMask),a.setOp(Me.stencilFail,Me.stencilZFail,Me.stencilZPass)),ue(Me.polygonOffset,Me.polygonOffsetFactor,Me.polygonOffsetUnits),Me.alphaToCoverage===!0?Ie(n.SAMPLE_ALPHA_TO_COVERAGE):be(n.SAMPLE_ALPHA_TO_COVERAGE)}function Be(Me){U!==Me&&(Me?n.frontFace(n.CW):n.frontFace(n.CCW),U=Me)}function De(Me){Me!==Coe?(Ie(n.CULL_FACE),Me!==z&&(Me===UB?n.cullFace(n.BACK):Me===Moe?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):be(n.CULL_FACE),z=Me}function Oe(Me){Me!==I&&(Z&&n.lineWidth(Me),I=Me)}function ue(Me,Ve,je){Me?(Ie(n.POLYGON_OFFSET_FILL),(L!==Ve||M!==je)&&(n.polygonOffset(Ve,je),L=Ve,M=je)):be(n.POLYGON_OFFSET_FILL)}function _e(Me){Me?Ie(n.SCISSOR_TEST):be(n.SCISSOR_TEST)}function we(Me){Me===void 0&&(Me=n.TEXTURE0+F-1),Q!==Me&&(n.activeTexture(Me),Q=Me)}function pe(Me,Ve,je){je===void 0&&(Q===null?je=n.TEXTURE0+F-1:je=Q);let We=q[je];We===void 0&&(We={type:void 0,texture:void 0},q[je]=We),(We.type!==Me||We.texture!==Ve)&&(Q!==je&&(n.activeTexture(je),Q=je),n.bindTexture(Me,Ve||Te[Me]),We.type=Me,We.texture=Ve)}function ze(){const Me=q[Q];Me!==void 0&&Me.type!==void 0&&(n.bindTexture(Me.type,null),Me.type=void 0,Me.texture=void 0)}function Ze(){try{n.compressedTexImage2D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function Je(){try{n.compressedTexImage3D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function nt(){try{n.texSubImage2D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function Pt(){try{n.texSubImage3D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function vt(){try{n.compressedTexSubImage2D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function At(){try{n.compressedTexSubImage3D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function Re(){try{n.texStorage2D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function ce(){try{n.texStorage3D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function W(){try{n.texImage2D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function le(){try{n.texImage3D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function Se(Me){ne.equals(Me)===!1&&(n.scissor(Me.x,Me.y,Me.z,Me.w),ne.copy(Me))}function Ae(Me){ie.equals(Me)===!1&&(n.viewport(Me.x,Me.y,Me.z,Me.w),ie.copy(Me))}function ye(Me,Ve){let je=l.get(Ve);je===void 0&&(je=new WeakMap,l.set(Ve,je));let We=je.get(Me);We===void 0&&(We=n.getUniformBlockIndex(Ve,Me.name),je.set(Me,We))}function ve(Me,Ve){const We=l.get(Ve).get(Me);c.get(Ve)!==We&&(n.uniformBlockBinding(Ve,We,Me.__bindingPointIndex),c.set(Ve,We))}function Xe(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),o.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),u={},Q=null,q={},h={},f=new WeakMap,d=[],p=null,_=!1,g=null,m=null,b=null,y=null,x=null,T=null,k=null,R=new gi(0,0,0),P=0,B=!1,U=null,z=null,I=null,L=null,M=null,ne.set(0,0,n.canvas.width,n.canvas.height),ie.set(0,0,n.canvas.width,n.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:Ie,disable:be,bindFramebuffer:Pe,drawBuffers:$e,useProgram:tt,setBlending:te,setMaterial:Ne,setFlipSided:Be,setCullFace:De,setLineWidth:Oe,setPolygonOffset:ue,setScissorTest:_e,activeTexture:we,bindTexture:pe,unbindTexture:ze,compressedTexImage2D:Ze,compressedTexImage3D:Je,texImage2D:W,texImage3D:le,updateUBOMapping:ye,uniformBlockBinding:ve,texStorage2D:Re,texStorage3D:ce,texSubImage2D:nt,texSubImage3D:Pt,compressedTexSubImage2D:vt,compressedTexSubImage3D:At,scissor:Se,viewport:Ae,reset:Xe}}function qfe(n,e,t,r,i,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),l=new Nn,u=new WeakMap;let h;const f=new WeakMap;let d=!1;try{d=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(we,pe){return d?new OffscreenCanvas(we,pe):$w("canvas")}function _(we,pe,ze){let Ze=1;const Je=_e(we);if((Je.width>ze||Je.height>ze)&&(Ze=ze/Math.max(Je.width,Je.height)),Ze<1)if(typeof HTMLImageElement<"u"&&we instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&we instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&we instanceof ImageBitmap||typeof VideoFrame<"u"&&we instanceof VideoFrame){const nt=Math.floor(Ze*Je.width),Pt=Math.floor(Ze*Je.height);h===void 0&&(h=p(nt,Pt));const vt=pe?p(nt,Pt):h;return vt.width=nt,vt.height=Pt,vt.getContext("2d").drawImage(we,0,0,nt,Pt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Je.width+"x"+Je.height+") to ("+nt+"x"+Pt+")."),vt}else return"data"in we&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Je.width+"x"+Je.height+")."),we;return we}function g(we){return we.generateMipmaps}function m(we){n.generateMipmap(we)}function b(we){return we.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:we.isWebGL3DRenderTarget?n.TEXTURE_3D:we.isWebGLArrayRenderTarget||we.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function y(we,pe,ze,Ze,Je=!1){if(we!==null){if(n[we]!==void 0)return n[we];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+we+"'")}let nt=pe;if(pe===n.RED&&(ze===n.FLOAT&&(nt=n.R32F),ze===n.HALF_FLOAT&&(nt=n.R16F),ze===n.UNSIGNED_BYTE&&(nt=n.R8)),pe===n.RED_INTEGER&&(ze===n.UNSIGNED_BYTE&&(nt=n.R8UI),ze===n.UNSIGNED_SHORT&&(nt=n.R16UI),ze===n.UNSIGNED_INT&&(nt=n.R32UI),ze===n.BYTE&&(nt=n.R8I),ze===n.SHORT&&(nt=n.R16I),ze===n.INT&&(nt=n.R32I)),pe===n.RG&&(ze===n.FLOAT&&(nt=n.RG32F),ze===n.HALF_FLOAT&&(nt=n.RG16F),ze===n.UNSIGNED_BYTE&&(nt=n.RG8)),pe===n.RG_INTEGER&&(ze===n.UNSIGNED_BYTE&&(nt=n.RG8UI),ze===n.UNSIGNED_SHORT&&(nt=n.RG16UI),ze===n.UNSIGNED_INT&&(nt=n.RG32UI),ze===n.BYTE&&(nt=n.RG8I),ze===n.SHORT&&(nt=n.RG16I),ze===n.INT&&(nt=n.RG32I)),pe===n.RGB_INTEGER&&(ze===n.UNSIGNED_BYTE&&(nt=n.RGB8UI),ze===n.UNSIGNED_SHORT&&(nt=n.RGB16UI),ze===n.UNSIGNED_INT&&(nt=n.RGB32UI),ze===n.BYTE&&(nt=n.RGB8I),ze===n.SHORT&&(nt=n.RGB16I),ze===n.INT&&(nt=n.RGB32I)),pe===n.RGBA_INTEGER&&(ze===n.UNSIGNED_BYTE&&(nt=n.RGBA8UI),ze===n.UNSIGNED_SHORT&&(nt=n.RGBA16UI),ze===n.UNSIGNED_INT&&(nt=n.RGBA32UI),ze===n.BYTE&&(nt=n.RGBA8I),ze===n.SHORT&&(nt=n.RGBA16I),ze===n.INT&&(nt=n.RGBA32I)),pe===n.RGB&&ze===n.UNSIGNED_INT_5_9_9_9_REV&&(nt=n.RGB9_E5),pe===n.RGBA){const Pt=Je?cM:zi.getTransfer(Ze);ze===n.FLOAT&&(nt=n.RGBA32F),ze===n.HALF_FLOAT&&(nt=n.RGBA16F),ze===n.UNSIGNED_BYTE&&(nt=Pt===Cs?n.SRGB8_ALPHA8:n.RGBA8),ze===n.UNSIGNED_SHORT_4_4_4_4&&(nt=n.RGBA4),ze===n.UNSIGNED_SHORT_5_5_5_1&&(nt=n.RGB5_A1)}return(nt===n.R16F||nt===n.R32F||nt===n.RG16F||nt===n.RG32F||nt===n.RGBA16F||nt===n.RGBA32F)&&e.get("EXT_color_buffer_float"),nt}function x(we,pe){let ze;return we?pe===null||pe===jv||pe===ex?ze=n.DEPTH24_STENCIL8:pe===mp?ze=n.DEPTH32F_STENCIL8:pe===Hw&&(ze=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):pe===null||pe===jv||pe===ex?ze=n.DEPTH_COMPONENT24:pe===mp?ze=n.DEPTH_COMPONENT32F:pe===Hw&&(ze=n.DEPTH_COMPONENT16),ze}function T(we,pe){return g(we)===!0||we.isFramebufferTexture&&we.minFilter!==cu&&we.minFilter!==ou?Math.log2(Math.max(pe.width,pe.height))+1:we.mipmaps!==void 0&&we.mipmaps.length>0?we.mipmaps.length:we.isCompressedTexture&&Array.isArray(we.image)?pe.mipmaps.length:1}function k(we){const pe=we.target;pe.removeEventListener("dispose",k),P(pe),pe.isVideoTexture&&u.delete(pe)}function R(we){const pe=we.target;pe.removeEventListener("dispose",R),U(pe)}function P(we){const pe=r.get(we);if(pe.__webglInit===void 0)return;const ze=we.source,Ze=f.get(ze);if(Ze){const Je=Ze[pe.__cacheKey];Je.usedTimes--,Je.usedTimes===0&&B(we),Object.keys(Ze).length===0&&f.delete(ze)}r.remove(we)}function B(we){const pe=r.get(we);n.deleteTexture(pe.__webglTexture);const ze=we.source,Ze=f.get(ze);delete Ze[pe.__cacheKey],o.memory.textures--}function U(we){const pe=r.get(we);if(we.depthTexture&&(we.depthTexture.dispose(),r.remove(we.depthTexture)),we.isWebGLCubeRenderTarget)for(let Ze=0;Ze<6;Ze++){if(Array.isArray(pe.__webglFramebuffer[Ze]))for(let Je=0;Je<pe.__webglFramebuffer[Ze].length;Je++)n.deleteFramebuffer(pe.__webglFramebuffer[Ze][Je]);else n.deleteFramebuffer(pe.__webglFramebuffer[Ze]);pe.__webglDepthbuffer&&n.deleteRenderbuffer(pe.__webglDepthbuffer[Ze])}else{if(Array.isArray(pe.__webglFramebuffer))for(let Ze=0;Ze<pe.__webglFramebuffer.length;Ze++)n.deleteFramebuffer(pe.__webglFramebuffer[Ze]);else n.deleteFramebuffer(pe.__webglFramebuffer);if(pe.__webglDepthbuffer&&n.deleteRenderbuffer(pe.__webglDepthbuffer),pe.__webglMultisampledFramebuffer&&n.deleteFramebuffer(pe.__webglMultisampledFramebuffer),pe.__webglColorRenderbuffer)for(let Ze=0;Ze<pe.__webglColorRenderbuffer.length;Ze++)pe.__webglColorRenderbuffer[Ze]&&n.deleteRenderbuffer(pe.__webglColorRenderbuffer[Ze]);pe.__webglDepthRenderbuffer&&n.deleteRenderbuffer(pe.__webglDepthRenderbuffer)}const ze=we.textures;for(let Ze=0,Je=ze.length;Ze<Je;Ze++){const nt=r.get(ze[Ze]);nt.__webglTexture&&(n.deleteTexture(nt.__webglTexture),o.memory.textures--),r.remove(ze[Ze])}r.remove(we)}let z=0;function I(){z=0}function L(){const we=z;return we>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+we+" texture units while this GPU supports only "+i.maxTextures),z+=1,we}function M(we){const pe=[];return pe.push(we.wrapS),pe.push(we.wrapT),pe.push(we.wrapR||0),pe.push(we.magFilter),pe.push(we.minFilter),pe.push(we.anisotropy),pe.push(we.internalFormat),pe.push(we.format),pe.push(we.type),pe.push(we.generateMipmaps),pe.push(we.premultiplyAlpha),pe.push(we.flipY),pe.push(we.unpackAlignment),pe.push(we.colorSpace),pe.join()}function F(we,pe){const ze=r.get(we);if(we.isVideoTexture&&Oe(we),we.isRenderTargetTexture===!1&&we.version>0&&ze.__version!==we.version){const Ze=we.image;if(Ze===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ze.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ie(ze,we,pe);return}}t.bindTexture(n.TEXTURE_2D,ze.__webglTexture,n.TEXTURE0+pe)}function Z(we,pe){const ze=r.get(we);if(we.version>0&&ze.__version!==we.version){ie(ze,we,pe);return}t.bindTexture(n.TEXTURE_2D_ARRAY,ze.__webglTexture,n.TEXTURE0+pe)}function $(we,pe){const ze=r.get(we);if(we.version>0&&ze.__version!==we.version){ie(ze,we,pe);return}t.bindTexture(n.TEXTURE_3D,ze.__webglTexture,n.TEXTURE0+pe)}function Y(we,pe){const ze=r.get(we);if(we.version>0&&ze.__version!==we.version){ae(ze,we,pe);return}t.bindTexture(n.TEXTURE_CUBE_MAP,ze.__webglTexture,n.TEXTURE0+pe)}const Q={[aM]:n.REPEAT,[D1]:n.CLAMP_TO_EDGE,[TD]:n.MIRRORED_REPEAT},q={[cu]:n.NEAREST,[rae]:n.NEAREST_MIPMAP_NEAREST,[VR]:n.NEAREST_MIPMAP_LINEAR,[ou]:n.LINEAR,[R3]:n.LINEAR_MIPMAP_NEAREST,[L1]:n.LINEAR_MIPMAP_LINEAR},V={[aae]:n.NEVER,[dae]:n.ALWAYS,[cae]:n.LESS,[eW]:n.LEQUAL,[lae]:n.EQUAL,[fae]:n.GEQUAL,[uae]:n.GREATER,[hae]:n.NOTEQUAL};function K(we,pe){if(pe.type===mp&&e.has("OES_texture_float_linear")===!1&&(pe.magFilter===ou||pe.magFilter===R3||pe.magFilter===VR||pe.magFilter===L1||pe.minFilter===ou||pe.minFilter===R3||pe.minFilter===VR||pe.minFilter===L1)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(we,n.TEXTURE_WRAP_S,Q[pe.wrapS]),n.texParameteri(we,n.TEXTURE_WRAP_T,Q[pe.wrapT]),(we===n.TEXTURE_3D||we===n.TEXTURE_2D_ARRAY)&&n.texParameteri(we,n.TEXTURE_WRAP_R,Q[pe.wrapR]),n.texParameteri(we,n.TEXTURE_MAG_FILTER,q[pe.magFilter]),n.texParameteri(we,n.TEXTURE_MIN_FILTER,q[pe.minFilter]),pe.compareFunction&&(n.texParameteri(we,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(we,n.TEXTURE_COMPARE_FUNC,V[pe.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(pe.magFilter===cu||pe.minFilter!==VR&&pe.minFilter!==L1||pe.type===mp&&e.has("OES_texture_float_linear")===!1)return;if(pe.anisotropy>1||r.get(pe).__currentAnisotropy){const ze=e.get("EXT_texture_filter_anisotropic");n.texParameterf(we,ze.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(pe.anisotropy,i.getMaxAnisotropy())),r.get(pe).__currentAnisotropy=pe.anisotropy}}}function ne(we,pe){let ze=!1;we.__webglInit===void 0&&(we.__webglInit=!0,pe.addEventListener("dispose",k));const Ze=pe.source;let Je=f.get(Ze);Je===void 0&&(Je={},f.set(Ze,Je));const nt=M(pe);if(nt!==we.__cacheKey){Je[nt]===void 0&&(Je[nt]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,ze=!0),Je[nt].usedTimes++;const Pt=Je[we.__cacheKey];Pt!==void 0&&(Je[we.__cacheKey].usedTimes--,Pt.usedTimes===0&&B(pe)),we.__cacheKey=nt,we.__webglTexture=Je[nt].texture}return ze}function ie(we,pe,ze){let Ze=n.TEXTURE_2D;(pe.isDataArrayTexture||pe.isCompressedArrayTexture)&&(Ze=n.TEXTURE_2D_ARRAY),pe.isData3DTexture&&(Ze=n.TEXTURE_3D);const Je=ne(we,pe),nt=pe.source;t.bindTexture(Ze,we.__webglTexture,n.TEXTURE0+ze);const Pt=r.get(nt);if(nt.version!==Pt.__version||Je===!0){t.activeTexture(n.TEXTURE0+ze);const vt=zi.getPrimaries(zi.workingColorSpace),At=pe.colorSpace===Bm?null:zi.getPrimaries(pe.colorSpace),Re=pe.colorSpace===Bm||vt===At?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,pe.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,pe.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Re);let ce=_(pe.image,!1,i.maxTextureSize);ce=ue(pe,ce);const W=s.convert(pe.format,pe.colorSpace),le=s.convert(pe.type);let Se=y(pe.internalFormat,W,le,pe.colorSpace,pe.isVideoTexture);K(Ze,pe);let Ae;const ye=pe.mipmaps,ve=pe.isVideoTexture!==!0,Xe=Pt.__version===void 0||Je===!0,Me=nt.dataReady,Ve=T(pe,ce);if(pe.isDepthTexture)Se=x(pe.format===tx,pe.type),Xe&&(ve?t.texStorage2D(n.TEXTURE_2D,1,Se,ce.width,ce.height):t.texImage2D(n.TEXTURE_2D,0,Se,ce.width,ce.height,0,W,le,null));else if(pe.isDataTexture)if(ye.length>0){ve&&Xe&&t.texStorage2D(n.TEXTURE_2D,Ve,Se,ye[0].width,ye[0].height);for(let je=0,We=ye.length;je<We;je++)Ae=ye[je],ve?Me&&t.texSubImage2D(n.TEXTURE_2D,je,0,0,Ae.width,Ae.height,W,le,Ae.data):t.texImage2D(n.TEXTURE_2D,je,Se,Ae.width,Ae.height,0,W,le,Ae.data);pe.generateMipmaps=!1}else ve?(Xe&&t.texStorage2D(n.TEXTURE_2D,Ve,Se,ce.width,ce.height),Me&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,ce.width,ce.height,W,le,ce.data)):t.texImage2D(n.TEXTURE_2D,0,Se,ce.width,ce.height,0,W,le,ce.data);else if(pe.isCompressedTexture)if(pe.isCompressedArrayTexture){ve&&Xe&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ve,Se,ye[0].width,ye[0].height,ce.depth);for(let je=0,We=ye.length;je<We;je++)if(Ae=ye[je],pe.format!==Du)if(W!==null)if(ve){if(Me)if(pe.layerUpdates.size>0){const ct=_F(Ae.width,Ae.height,pe.format,pe.type);for(const Fe of pe.layerUpdates){const rt=Ae.data.subarray(Fe*ct/Ae.data.BYTES_PER_ELEMENT,(Fe+1)*ct/Ae.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,je,0,0,Fe,Ae.width,Ae.height,1,W,rt)}pe.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,je,0,0,0,Ae.width,Ae.height,ce.depth,W,Ae.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,je,Se,Ae.width,Ae.height,ce.depth,0,Ae.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else ve?Me&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,je,0,0,0,Ae.width,Ae.height,ce.depth,W,le,Ae.data):t.texImage3D(n.TEXTURE_2D_ARRAY,je,Se,Ae.width,Ae.height,ce.depth,0,W,le,Ae.data)}else{ve&&Xe&&t.texStorage2D(n.TEXTURE_2D,Ve,Se,ye[0].width,ye[0].height);for(let je=0,We=ye.length;je<We;je++)Ae=ye[je],pe.format!==Du?W!==null?ve?Me&&t.compressedTexSubImage2D(n.TEXTURE_2D,je,0,0,Ae.width,Ae.height,W,Ae.data):t.compressedTexImage2D(n.TEXTURE_2D,je,Se,Ae.width,Ae.height,0,Ae.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ve?Me&&t.texSubImage2D(n.TEXTURE_2D,je,0,0,Ae.width,Ae.height,W,le,Ae.data):t.texImage2D(n.TEXTURE_2D,je,Se,Ae.width,Ae.height,0,W,le,Ae.data)}else if(pe.isDataArrayTexture)if(ve){if(Xe&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ve,Se,ce.width,ce.height,ce.depth),Me)if(pe.layerUpdates.size>0){const je=_F(ce.width,ce.height,pe.format,pe.type);for(const We of pe.layerUpdates){const ct=ce.data.subarray(We*je/ce.data.BYTES_PER_ELEMENT,(We+1)*je/ce.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,We,ce.width,ce.height,1,W,le,ct)}pe.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,ce.width,ce.height,ce.depth,W,le,ce.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Se,ce.width,ce.height,ce.depth,0,W,le,ce.data);else if(pe.isData3DTexture)ve?(Xe&&t.texStorage3D(n.TEXTURE_3D,Ve,Se,ce.width,ce.height,ce.depth),Me&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,ce.width,ce.height,ce.depth,W,le,ce.data)):t.texImage3D(n.TEXTURE_3D,0,Se,ce.width,ce.height,ce.depth,0,W,le,ce.data);else if(pe.isFramebufferTexture){if(Xe)if(ve)t.texStorage2D(n.TEXTURE_2D,Ve,Se,ce.width,ce.height);else{let je=ce.width,We=ce.height;for(let ct=0;ct<Ve;ct++)t.texImage2D(n.TEXTURE_2D,ct,Se,je,We,0,W,le,null),je>>=1,We>>=1}}else if(ye.length>0){if(ve&&Xe){const je=_e(ye[0]);t.texStorage2D(n.TEXTURE_2D,Ve,Se,je.width,je.height)}for(let je=0,We=ye.length;je<We;je++)Ae=ye[je],ve?Me&&t.texSubImage2D(n.TEXTURE_2D,je,0,0,W,le,Ae):t.texImage2D(n.TEXTURE_2D,je,Se,W,le,Ae);pe.generateMipmaps=!1}else if(ve){if(Xe){const je=_e(ce);t.texStorage2D(n.TEXTURE_2D,Ve,Se,je.width,je.height)}Me&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,W,le,ce)}else t.texImage2D(n.TEXTURE_2D,0,Se,W,le,ce);g(pe)&&m(Ze),Pt.__version=nt.version,pe.onUpdate&&pe.onUpdate(pe)}we.__version=pe.version}function ae(we,pe,ze){if(pe.image.length!==6)return;const Ze=ne(we,pe),Je=pe.source;t.bindTexture(n.TEXTURE_CUBE_MAP,we.__webglTexture,n.TEXTURE0+ze);const nt=r.get(Je);if(Je.version!==nt.__version||Ze===!0){t.activeTexture(n.TEXTURE0+ze);const Pt=zi.getPrimaries(zi.workingColorSpace),vt=pe.colorSpace===Bm?null:zi.getPrimaries(pe.colorSpace),At=pe.colorSpace===Bm||Pt===vt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,pe.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,pe.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,At);const Re=pe.isCompressedTexture||pe.image[0].isCompressedTexture,ce=pe.image[0]&&pe.image[0].isDataTexture,W=[];for(let We=0;We<6;We++)!Re&&!ce?W[We]=_(pe.image[We],!0,i.maxCubemapSize):W[We]=ce?pe.image[We].image:pe.image[We],W[We]=ue(pe,W[We]);const le=W[0],Se=s.convert(pe.format,pe.colorSpace),Ae=s.convert(pe.type),ye=y(pe.internalFormat,Se,Ae,pe.colorSpace),ve=pe.isVideoTexture!==!0,Xe=nt.__version===void 0||Ze===!0,Me=Je.dataReady;let Ve=T(pe,le);K(n.TEXTURE_CUBE_MAP,pe);let je;if(Re){ve&&Xe&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Ve,ye,le.width,le.height);for(let We=0;We<6;We++){je=W[We].mipmaps;for(let ct=0;ct<je.length;ct++){const Fe=je[ct];pe.format!==Du?Se!==null?ve?Me&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+We,ct,0,0,Fe.width,Fe.height,Se,Fe.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+We,ct,ye,Fe.width,Fe.height,0,Fe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ve?Me&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+We,ct,0,0,Fe.width,Fe.height,Se,Ae,Fe.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+We,ct,ye,Fe.width,Fe.height,0,Se,Ae,Fe.data)}}}else{if(je=pe.mipmaps,ve&&Xe){je.length>0&&Ve++;const We=_e(W[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Ve,ye,We.width,We.height)}for(let We=0;We<6;We++)if(ce){ve?Me&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+We,0,0,0,W[We].width,W[We].height,Se,Ae,W[We].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+We,0,ye,W[We].width,W[We].height,0,Se,Ae,W[We].data);for(let ct=0;ct<je.length;ct++){const rt=je[ct].image[We].image;ve?Me&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+We,ct+1,0,0,rt.width,rt.height,Se,Ae,rt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+We,ct+1,ye,rt.width,rt.height,0,Se,Ae,rt.data)}}else{ve?Me&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+We,0,0,0,Se,Ae,W[We]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+We,0,ye,Se,Ae,W[We]);for(let ct=0;ct<je.length;ct++){const Fe=je[ct];ve?Me&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+We,ct+1,0,0,Se,Ae,Fe.image[We]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+We,ct+1,ye,Se,Ae,Fe.image[We])}}}g(pe)&&m(n.TEXTURE_CUBE_MAP),nt.__version=Je.version,pe.onUpdate&&pe.onUpdate(pe)}we.__version=pe.version}function Te(we,pe,ze,Ze,Je,nt){const Pt=s.convert(ze.format,ze.colorSpace),vt=s.convert(ze.type),At=y(ze.internalFormat,Pt,vt,ze.colorSpace),Re=r.get(pe),ce=r.get(ze);if(ce.__renderTarget=pe,!Re.__hasExternalTextures){const W=Math.max(1,pe.width>>nt),le=Math.max(1,pe.height>>nt);Je===n.TEXTURE_3D||Je===n.TEXTURE_2D_ARRAY?t.texImage3D(Je,nt,At,W,le,pe.depth,0,Pt,vt,null):t.texImage2D(Je,nt,At,W,le,0,Pt,vt,null)}t.bindFramebuffer(n.FRAMEBUFFER,we),De(pe)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Ze,Je,ce.__webglTexture,0,Be(pe)):(Je===n.TEXTURE_2D||Je>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Je<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Ze,Je,ce.__webglTexture,nt),t.bindFramebuffer(n.FRAMEBUFFER,null)}function Ie(we,pe,ze){if(n.bindRenderbuffer(n.RENDERBUFFER,we),pe.depthBuffer){const Ze=pe.depthTexture,Je=Ze&&Ze.isDepthTexture?Ze.type:null,nt=x(pe.stencilBuffer,Je),Pt=pe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,vt=Be(pe);De(pe)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,vt,nt,pe.width,pe.height):ze?n.renderbufferStorageMultisample(n.RENDERBUFFER,vt,nt,pe.width,pe.height):n.renderbufferStorage(n.RENDERBUFFER,nt,pe.width,pe.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,Pt,n.RENDERBUFFER,we)}else{const Ze=pe.textures;for(let Je=0;Je<Ze.length;Je++){const nt=Ze[Je],Pt=s.convert(nt.format,nt.colorSpace),vt=s.convert(nt.type),At=y(nt.internalFormat,Pt,vt,nt.colorSpace),Re=Be(pe);ze&&De(pe)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Re,At,pe.width,pe.height):De(pe)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Re,At,pe.width,pe.height):n.renderbufferStorage(n.RENDERBUFFER,At,pe.width,pe.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function be(we,pe){if(pe&&pe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,we),!(pe.depthTexture&&pe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Ze=r.get(pe.depthTexture);Ze.__renderTarget=pe,(!Ze.__webglTexture||pe.depthTexture.image.width!==pe.width||pe.depthTexture.image.height!==pe.height)&&(pe.depthTexture.image.width=pe.width,pe.depthTexture.image.height=pe.height,pe.depthTexture.needsUpdate=!0),F(pe.depthTexture,0);const Je=Ze.__webglTexture,nt=Be(pe);if(pe.depthTexture.format===Vw)De(pe)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Je,0,nt):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Je,0);else if(pe.depthTexture.format===tx)De(pe)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Je,0,nt):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Je,0);else throw new Error("Unknown depthTexture format")}function Pe(we){const pe=r.get(we),ze=we.isWebGLCubeRenderTarget===!0;if(pe.__boundDepthTexture!==we.depthTexture){const Ze=we.depthTexture;if(pe.__depthDisposeCallback&&pe.__depthDisposeCallback(),Ze){const Je=()=>{delete pe.__boundDepthTexture,delete pe.__depthDisposeCallback,Ze.removeEventListener("dispose",Je)};Ze.addEventListener("dispose",Je),pe.__depthDisposeCallback=Je}pe.__boundDepthTexture=Ze}if(we.depthTexture&&!pe.__autoAllocateDepthBuffer){if(ze)throw new Error("target.depthTexture not supported in Cube render targets");const Ze=we.texture.mipmaps;Ze&&Ze.length>0?be(pe.__webglFramebuffer[0],we):be(pe.__webglFramebuffer,we)}else if(ze){pe.__webglDepthbuffer=[];for(let Ze=0;Ze<6;Ze++)if(t.bindFramebuffer(n.FRAMEBUFFER,pe.__webglFramebuffer[Ze]),pe.__webglDepthbuffer[Ze]===void 0)pe.__webglDepthbuffer[Ze]=n.createRenderbuffer(),Ie(pe.__webglDepthbuffer[Ze],we,!1);else{const Je=we.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,nt=pe.__webglDepthbuffer[Ze];n.bindRenderbuffer(n.RENDERBUFFER,nt),n.framebufferRenderbuffer(n.FRAMEBUFFER,Je,n.RENDERBUFFER,nt)}}else{const Ze=we.texture.mipmaps;if(Ze&&Ze.length>0?t.bindFramebuffer(n.FRAMEBUFFER,pe.__webglFramebuffer[0]):t.bindFramebuffer(n.FRAMEBUFFER,pe.__webglFramebuffer),pe.__webglDepthbuffer===void 0)pe.__webglDepthbuffer=n.createRenderbuffer(),Ie(pe.__webglDepthbuffer,we,!1);else{const Je=we.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,nt=pe.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,nt),n.framebufferRenderbuffer(n.FRAMEBUFFER,Je,n.RENDERBUFFER,nt)}}t.bindFramebuffer(n.FRAMEBUFFER,null)}function $e(we,pe,ze){const Ze=r.get(we);pe!==void 0&&Te(Ze.__webglFramebuffer,we,we.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),ze!==void 0&&Pe(we)}function tt(we){const pe=we.texture,ze=r.get(we),Ze=r.get(pe);we.addEventListener("dispose",R);const Je=we.textures,nt=we.isWebGLCubeRenderTarget===!0,Pt=Je.length>1;if(Pt||(Ze.__webglTexture===void 0&&(Ze.__webglTexture=n.createTexture()),Ze.__version=pe.version,o.memory.textures++),nt){ze.__webglFramebuffer=[];for(let vt=0;vt<6;vt++)if(pe.mipmaps&&pe.mipmaps.length>0){ze.__webglFramebuffer[vt]=[];for(let At=0;At<pe.mipmaps.length;At++)ze.__webglFramebuffer[vt][At]=n.createFramebuffer()}else ze.__webglFramebuffer[vt]=n.createFramebuffer()}else{if(pe.mipmaps&&pe.mipmaps.length>0){ze.__webglFramebuffer=[];for(let vt=0;vt<pe.mipmaps.length;vt++)ze.__webglFramebuffer[vt]=n.createFramebuffer()}else ze.__webglFramebuffer=n.createFramebuffer();if(Pt)for(let vt=0,At=Je.length;vt<At;vt++){const Re=r.get(Je[vt]);Re.__webglTexture===void 0&&(Re.__webglTexture=n.createTexture(),o.memory.textures++)}if(we.samples>0&&De(we)===!1){ze.__webglMultisampledFramebuffer=n.createFramebuffer(),ze.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,ze.__webglMultisampledFramebuffer);for(let vt=0;vt<Je.length;vt++){const At=Je[vt];ze.__webglColorRenderbuffer[vt]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,ze.__webglColorRenderbuffer[vt]);const Re=s.convert(At.format,At.colorSpace),ce=s.convert(At.type),W=y(At.internalFormat,Re,ce,At.colorSpace,we.isXRRenderTarget===!0),le=Be(we);n.renderbufferStorageMultisample(n.RENDERBUFFER,le,W,we.width,we.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+vt,n.RENDERBUFFER,ze.__webglColorRenderbuffer[vt])}n.bindRenderbuffer(n.RENDERBUFFER,null),we.depthBuffer&&(ze.__webglDepthRenderbuffer=n.createRenderbuffer(),Ie(ze.__webglDepthRenderbuffer,we,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(nt){t.bindTexture(n.TEXTURE_CUBE_MAP,Ze.__webglTexture),K(n.TEXTURE_CUBE_MAP,pe);for(let vt=0;vt<6;vt++)if(pe.mipmaps&&pe.mipmaps.length>0)for(let At=0;At<pe.mipmaps.length;At++)Te(ze.__webglFramebuffer[vt][At],we,pe,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+vt,At);else Te(ze.__webglFramebuffer[vt],we,pe,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+vt,0);g(pe)&&m(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Pt){for(let vt=0,At=Je.length;vt<At;vt++){const Re=Je[vt],ce=r.get(Re);t.bindTexture(n.TEXTURE_2D,ce.__webglTexture),K(n.TEXTURE_2D,Re),Te(ze.__webglFramebuffer,we,Re,n.COLOR_ATTACHMENT0+vt,n.TEXTURE_2D,0),g(Re)&&m(n.TEXTURE_2D)}t.unbindTexture()}else{let vt=n.TEXTURE_2D;if((we.isWebGL3DRenderTarget||we.isWebGLArrayRenderTarget)&&(vt=we.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(vt,Ze.__webglTexture),K(vt,pe),pe.mipmaps&&pe.mipmaps.length>0)for(let At=0;At<pe.mipmaps.length;At++)Te(ze.__webglFramebuffer[At],we,pe,n.COLOR_ATTACHMENT0,vt,At);else Te(ze.__webglFramebuffer,we,pe,n.COLOR_ATTACHMENT0,vt,0);g(pe)&&m(vt),t.unbindTexture()}we.depthBuffer&&Pe(we)}function qe(we){const pe=we.textures;for(let ze=0,Ze=pe.length;ze<Ze;ze++){const Je=pe[ze];if(g(Je)){const nt=b(we),Pt=r.get(Je).__webglTexture;t.bindTexture(nt,Pt),m(nt),t.unbindTexture()}}}const ut=[],te=[];function Ne(we){if(we.samples>0){if(De(we)===!1){const pe=we.textures,ze=we.width,Ze=we.height;let Je=n.COLOR_BUFFER_BIT;const nt=we.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Pt=r.get(we),vt=pe.length>1;if(vt)for(let Re=0;Re<pe.length;Re++)t.bindFramebuffer(n.FRAMEBUFFER,Pt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Re,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Pt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Re,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Pt.__webglMultisampledFramebuffer);const At=we.texture.mipmaps;At&&At.length>0?t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Pt.__webglFramebuffer[0]):t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Pt.__webglFramebuffer);for(let Re=0;Re<pe.length;Re++){if(we.resolveDepthBuffer&&(we.depthBuffer&&(Je|=n.DEPTH_BUFFER_BIT),we.stencilBuffer&&we.resolveStencilBuffer&&(Je|=n.STENCIL_BUFFER_BIT)),vt){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Pt.__webglColorRenderbuffer[Re]);const ce=r.get(pe[Re]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,ce,0)}n.blitFramebuffer(0,0,ze,Ze,0,0,ze,Ze,Je,n.NEAREST),c===!0&&(ut.length=0,te.length=0,ut.push(n.COLOR_ATTACHMENT0+Re),we.depthBuffer&&we.resolveDepthBuffer===!1&&(ut.push(nt),te.push(nt),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,te)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,ut))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),vt)for(let Re=0;Re<pe.length;Re++){t.bindFramebuffer(n.FRAMEBUFFER,Pt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Re,n.RENDERBUFFER,Pt.__webglColorRenderbuffer[Re]);const ce=r.get(pe[Re]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Pt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Re,n.TEXTURE_2D,ce,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Pt.__webglMultisampledFramebuffer)}else if(we.depthBuffer&&we.resolveDepthBuffer===!1&&c){const pe=we.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[pe])}}}function Be(we){return Math.min(i.maxSamples,we.samples)}function De(we){const pe=r.get(we);return we.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&pe.__useRenderToTexture!==!1}function Oe(we){const pe=o.render.frame;u.get(we)!==pe&&(u.set(we,pe),we.update())}function ue(we,pe){const ze=we.colorSpace,Ze=we.format,Je=we.type;return we.isCompressedTexture===!0||we.isVideoTexture===!0||ze!==t_&&ze!==Bm&&(zi.getTransfer(ze)===Cs?(Ze!==Du||Je!==Do)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ze)),pe}function _e(we){return typeof HTMLImageElement<"u"&&we instanceof HTMLImageElement?(l.width=we.naturalWidth||we.width,l.height=we.naturalHeight||we.height):typeof VideoFrame<"u"&&we instanceof VideoFrame?(l.width=we.displayWidth,l.height=we.displayHeight):(l.width=we.width,l.height=we.height),l}this.allocateTextureUnit=L,this.resetTextureUnits=I,this.setTexture2D=F,this.setTexture2DArray=Z,this.setTexture3D=$,this.setTextureCube=Y,this.rebindTextures=$e,this.setupRenderTarget=tt,this.updateRenderTargetMipmap=qe,this.updateMultisampleRenderTarget=Ne,this.setupDepthRenderbuffer=Pe,this.setupFrameBufferTexture=Te,this.useMultisampledRTT=De}function Yfe(n,e){function t(r,i=Bm){let s;const o=zi.getTransfer(i);if(r===Do)return n.UNSIGNED_BYTE;if(r===Z4)return n.UNSIGNED_SHORT_4_4_4_4;if(r===J4)return n.UNSIGNED_SHORT_5_5_5_1;if(r===X$)return n.UNSIGNED_INT_5_9_9_9_REV;if(r===Y$)return n.BYTE;if(r===K$)return n.SHORT;if(r===Hw)return n.UNSIGNED_SHORT;if(r===X4)return n.INT;if(r===jv)return n.UNSIGNED_INT;if(r===mp)return n.FLOAT;if(r===Jv)return n.HALF_FLOAT;if(r===Z$)return n.ALPHA;if(r===J$)return n.RGB;if(r===Du)return n.RGBA;if(r===Vw)return n.DEPTH_COMPONENT;if(r===tx)return n.DEPTH_STENCIL;if(r===jA)return n.RED;if(r===Q4)return n.RED_INTEGER;if(r===e5)return n.RG;if(r===t5)return n.RG_INTEGER;if(r===zk)return n.RGBA_INTEGER;if(r===pC||r===mC||r===gC||r===_C)if(o===Cs)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===pC)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===mC)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===gC)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===_C)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===pC)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===mC)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===gC)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===_C)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===wD||r===AD||r===RD||r===CD)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===wD)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===AD)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===RD)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===CD)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===MD||r===kD||r===OD)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(r===MD||r===kD)return o===Cs?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===OD)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===ID||r===ND||r===PD||r===DD||r===LD||r===UD||r===BD||r===FD||r===jD||r===zD||r===HD||r===VD||r===GD||r===$D)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(r===ID)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===ND)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===PD)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===DD)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===LD)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===UD)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===BD)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===FD)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===jD)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===zD)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===HD)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===VD)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===GD)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===$D)return o===Cs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===vC||r===WD||r===qD)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(r===vC)return o===Cs?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===WD)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===qD)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===Q$||r===YD||r===KD||r===XD)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(r===vC)return s.COMPRESSED_RED_RGTC1_EXT;if(r===YD)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===KD)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===XD)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===ex?n.UNSIGNED_INT_24_8:n[r]!==void 0?n[r]:null}return{convert:t}}const Kfe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Xfe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Zfe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,r){if(this.texture===null){const i=new kc,s=e.properties.get(i);s.__webglTexture=t.texture,(t.depthNear!==r.depthNear||t.depthFar!==r.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,r=new io({vertexShader:Kfe,fragmentShader:Xfe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new wf(new HA(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Jfe extends c_{constructor(e,t){super();const r=this;let i=null,s=1,o=null,a="local-floor",c=1,l=null,u=null,h=null,f=null,d=null,p=null;const _=new Zfe,g=t.getContextAttributes();let m=null,b=null;const y=[],x=[],T=new Nn;let k=null;const R=new Ou;R.viewport=new Zo;const P=new Ou;P.viewport=new Zo;const B=[R,P],U=new _ce;let z=null,I=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ie){let ae=y[ie];return ae===void 0&&(ae=new q3,y[ie]=ae),ae.getTargetRaySpace()},this.getControllerGrip=function(ie){let ae=y[ie];return ae===void 0&&(ae=new q3,y[ie]=ae),ae.getGripSpace()},this.getHand=function(ie){let ae=y[ie];return ae===void 0&&(ae=new q3,y[ie]=ae),ae.getHandSpace()};function L(ie){const ae=x.indexOf(ie.inputSource);if(ae===-1)return;const Te=y[ae];Te!==void 0&&(Te.update(ie.inputSource,ie.frame,l||o),Te.dispatchEvent({type:ie.type,data:ie.inputSource}))}function M(){i.removeEventListener("select",L),i.removeEventListener("selectstart",L),i.removeEventListener("selectend",L),i.removeEventListener("squeeze",L),i.removeEventListener("squeezestart",L),i.removeEventListener("squeezeend",L),i.removeEventListener("end",M),i.removeEventListener("inputsourceschange",F);for(let ie=0;ie<y.length;ie++){const ae=x[ie];ae!==null&&(x[ie]=null,y[ie].disconnect(ae))}z=null,I=null,_.reset(),e.setRenderTarget(m),d=null,f=null,h=null,i=null,b=null,ne.stop(),r.isPresenting=!1,e.setPixelRatio(k),e.setSize(T.width,T.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ie){s=ie,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ie){a=ie,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(ie){l=ie},this.getBaseLayer=function(){return f!==null?f:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(ie){if(i=ie,i!==null){if(m=e.getRenderTarget(),i.addEventListener("select",L),i.addEventListener("selectstart",L),i.addEventListener("selectend",L),i.addEventListener("squeeze",L),i.addEventListener("squeezestart",L),i.addEventListener("squeezeend",L),i.addEventListener("end",M),i.addEventListener("inputsourceschange",F),g.xrCompatible!==!0&&await t.makeXRCompatible(),k=e.getPixelRatio(),e.getSize(T),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let Te=null,Ie=null,be=null;g.depth&&(be=g.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Te=g.stencil?tx:Vw,Ie=g.stencil?ex:jv);const Pe={colorFormat:t.RGBA8,depthFormat:be,scaleFactor:s};h=new XRWebGLBinding(i,t),f=h.createProjectionLayer(Pe),i.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),b=new Nl(f.textureWidth,f.textureHeight,{format:Du,type:Do,depthTexture:new Vk(f.textureWidth,f.textureHeight,Ie,void 0,void 0,void 0,void 0,void 0,void 0,Te),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}else{const Te={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(i,t,Te),i.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),b=new Nl(d.framebufferWidth,d.framebufferHeight,{format:Du,type:Do,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1})}b.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=await i.requestReferenceSpace(a),ne.setContext(i),ne.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return _.getDepthTexture()};function F(ie){for(let ae=0;ae<ie.removed.length;ae++){const Te=ie.removed[ae],Ie=x.indexOf(Te);Ie>=0&&(x[Ie]=null,y[Ie].disconnect(Te))}for(let ae=0;ae<ie.added.length;ae++){const Te=ie.added[ae];let Ie=x.indexOf(Te);if(Ie===-1){for(let Pe=0;Pe<y.length;Pe++)if(Pe>=x.length){x.push(Te),Ie=Pe;break}else if(x[Pe]===null){x[Pe]=Te,Ie=Pe;break}if(Ie===-1)break}const be=y[Ie];be&&be.connect(Te)}}const Z=new Lt,$=new Lt;function Y(ie,ae,Te){Z.setFromMatrixPosition(ae.matrixWorld),$.setFromMatrixPosition(Te.matrixWorld);const Ie=Z.distanceTo($),be=ae.projectionMatrix.elements,Pe=Te.projectionMatrix.elements,$e=be[14]/(be[10]-1),tt=be[14]/(be[10]+1),qe=(be[9]+1)/be[5],ut=(be[9]-1)/be[5],te=(be[8]-1)/be[0],Ne=(Pe[8]+1)/Pe[0],Be=$e*te,De=$e*Ne,Oe=Ie/(-te+Ne),ue=Oe*-te;if(ae.matrixWorld.decompose(ie.position,ie.quaternion,ie.scale),ie.translateX(ue),ie.translateZ(Oe),ie.matrixWorld.compose(ie.position,ie.quaternion,ie.scale),ie.matrixWorldInverse.copy(ie.matrixWorld).invert(),be[10]===-1)ie.projectionMatrix.copy(ae.projectionMatrix),ie.projectionMatrixInverse.copy(ae.projectionMatrixInverse);else{const _e=$e+Oe,we=tt+Oe,pe=Be-ue,ze=De+(Ie-ue),Ze=qe*tt/we*_e,Je=ut*tt/we*_e;ie.projectionMatrix.makePerspective(pe,ze,Ze,Je,_e,we),ie.projectionMatrixInverse.copy(ie.projectionMatrix).invert()}}function Q(ie,ae){ae===null?ie.matrixWorld.copy(ie.matrix):ie.matrixWorld.multiplyMatrices(ae.matrixWorld,ie.matrix),ie.matrixWorldInverse.copy(ie.matrixWorld).invert()}this.updateCamera=function(ie){if(i===null)return;let ae=ie.near,Te=ie.far;_.texture!==null&&(_.depthNear>0&&(ae=_.depthNear),_.depthFar>0&&(Te=_.depthFar)),U.near=P.near=R.near=ae,U.far=P.far=R.far=Te,(z!==U.near||I!==U.far)&&(i.updateRenderState({depthNear:U.near,depthFar:U.far}),z=U.near,I=U.far),R.layers.mask=ie.layers.mask|2,P.layers.mask=ie.layers.mask|4,U.layers.mask=R.layers.mask|P.layers.mask;const Ie=ie.parent,be=U.cameras;Q(U,Ie);for(let Pe=0;Pe<be.length;Pe++)Q(be[Pe],Ie);be.length===2?Y(U,R,P):U.projectionMatrix.copy(R.projectionMatrix),q(ie,U,Ie)};function q(ie,ae,Te){Te===null?ie.matrix.copy(ae.matrixWorld):(ie.matrix.copy(Te.matrixWorld),ie.matrix.invert(),ie.matrix.multiply(ae.matrixWorld)),ie.matrix.decompose(ie.position,ie.quaternion,ie.scale),ie.updateMatrixWorld(!0),ie.projectionMatrix.copy(ae.projectionMatrix),ie.projectionMatrixInverse.copy(ae.projectionMatrixInverse),ie.isPerspectiveCamera&&(ie.fov=Gw*2*Math.atan(1/ie.projectionMatrix.elements[5]),ie.zoom=1)}this.getCamera=function(){return U},this.getFoveation=function(){if(!(f===null&&d===null))return c},this.setFoveation=function(ie){c=ie,f!==null&&(f.fixedFoveation=ie),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=ie)},this.hasDepthSensing=function(){return _.texture!==null},this.getDepthSensingMesh=function(){return _.getMesh(U)};let V=null;function K(ie,ae){if(u=ae.getViewerPose(l||o),p=ae,u!==null){const Te=u.views;d!==null&&(e.setRenderTargetFramebuffer(b,d.framebuffer),e.setRenderTarget(b));let Ie=!1;Te.length!==U.cameras.length&&(U.cameras.length=0,Ie=!0);for(let $e=0;$e<Te.length;$e++){const tt=Te[$e];let qe=null;if(d!==null)qe=d.getViewport(tt);else{const te=h.getViewSubImage(f,tt);qe=te.viewport,$e===0&&(e.setRenderTargetTextures(b,te.colorTexture,te.depthStencilTexture),e.setRenderTarget(b))}let ut=B[$e];ut===void 0&&(ut=new Ou,ut.layers.enable($e),ut.viewport=new Zo,B[$e]=ut),ut.matrix.fromArray(tt.transform.matrix),ut.matrix.decompose(ut.position,ut.quaternion,ut.scale),ut.projectionMatrix.fromArray(tt.projectionMatrix),ut.projectionMatrixInverse.copy(ut.projectionMatrix).invert(),ut.viewport.set(qe.x,qe.y,qe.width,qe.height),$e===0&&(U.matrix.copy(ut.matrix),U.matrix.decompose(U.position,U.quaternion,U.scale)),Ie===!0&&U.cameras.push(ut)}const be=i.enabledFeatures;if(be&&be.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&h){const $e=h.getDepthInformation(Te[0]);$e&&$e.isValid&&$e.texture&&_.init(e,$e,i.renderState)}}for(let Te=0;Te<y.length;Te++){const Ie=x[Te],be=y[Te];Ie!==null&&be!==void 0&&be.update(Ie,ae,l||o)}V&&V(ie,ae),ae.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:ae}),p=null}const ne=new hW;ne.setAnimationLoop(K),this.setAnimationLoop=function(ie){V=ie},this.dispose=function(){}}}const l1=new t0,Qfe=new vo;function ede(n,e){function t(g,m){g.matrixAutoUpdate===!0&&g.updateMatrix(),m.value.copy(g.matrix)}function r(g,m){m.color.getRGB(g.fogColor.value,aW(n)),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)}function i(g,m,b,y,x){m.isMeshBasicMaterial||m.isMeshLambertMaterial?s(g,m):m.isMeshToonMaterial?(s(g,m),h(g,m)):m.isMeshPhongMaterial?(s(g,m),u(g,m)):m.isMeshStandardMaterial?(s(g,m),f(g,m),m.isMeshPhysicalMaterial&&d(g,m,x)):m.isMeshMatcapMaterial?(s(g,m),p(g,m)):m.isMeshDepthMaterial?s(g,m):m.isMeshDistanceMaterial?(s(g,m),_(g,m)):m.isMeshNormalMaterial?s(g,m):m.isLineBasicMaterial?(o(g,m),m.isLineDashedMaterial&&a(g,m)):m.isPointsMaterial?c(g,m,b,y):m.isSpriteMaterial?l(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function s(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map,t(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.bumpMap&&(g.bumpMap.value=m.bumpMap,t(m.bumpMap,g.bumpMapTransform),g.bumpScale.value=m.bumpScale,m.side===ol&&(g.bumpScale.value*=-1)),m.normalMap&&(g.normalMap.value=m.normalMap,t(m.normalMap,g.normalMapTransform),g.normalScale.value.copy(m.normalScale),m.side===ol&&g.normalScale.value.negate()),m.displacementMap&&(g.displacementMap.value=m.displacementMap,t(m.displacementMap,g.displacementMapTransform),g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap,t(m.emissiveMap,g.emissiveMapTransform)),m.specularMap&&(g.specularMap.value=m.specularMap,t(m.specularMap,g.specularMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);const b=e.get(m),y=b.envMap,x=b.envMapRotation;y&&(g.envMap.value=y,l1.copy(x),l1.x*=-1,l1.y*=-1,l1.z*=-1,y.isCubeTexture&&y.isRenderTargetTexture===!1&&(l1.y*=-1,l1.z*=-1),g.envMapRotation.value.setFromMatrix4(Qfe.makeRotationFromEuler(l1)),g.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio),m.lightMap&&(g.lightMap.value=m.lightMap,g.lightMapIntensity.value=m.lightMapIntensity,t(m.lightMap,g.lightMapTransform)),m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity,t(m.aoMap,g.aoMapTransform))}function o(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,m.map&&(g.map.value=m.map,t(m.map,g.mapTransform))}function a(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}function c(g,m,b,y){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*b,g.scale.value=y*.5,m.map&&(g.map.value=m.map,t(m.map,g.uvTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}function l(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map,t(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}function u(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4)}function h(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap)}function f(g,m){g.metalness.value=m.metalness,m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap,t(m.metalnessMap,g.metalnessMapTransform)),g.roughness.value=m.roughness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap,t(m.roughnessMap,g.roughnessMapTransform)),m.envMap&&(g.envMapIntensity.value=m.envMapIntensity)}function d(g,m,b){g.ior.value=m.ior,m.sheen>0&&(g.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(g.sheenColorMap.value=m.sheenColorMap,t(m.sheenColorMap,g.sheenColorMapTransform)),m.sheenRoughnessMap&&(g.sheenRoughnessMap.value=m.sheenRoughnessMap,t(m.sheenRoughnessMap,g.sheenRoughnessMapTransform))),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap,t(m.clearcoatMap,g.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,t(m.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(g.clearcoatNormalMap.value=m.clearcoatNormalMap,t(m.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),m.side===ol&&g.clearcoatNormalScale.value.negate())),m.dispersion>0&&(g.dispersion.value=m.dispersion),m.iridescence>0&&(g.iridescence.value=m.iridescence,g.iridescenceIOR.value=m.iridescenceIOR,g.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(g.iridescenceMap.value=m.iridescenceMap,t(m.iridescenceMap,g.iridescenceMapTransform)),m.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=m.iridescenceThicknessMap,t(m.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=b.texture,g.transmissionSamplerSize.value.set(b.width,b.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap,t(m.transmissionMap,g.transmissionMapTransform)),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap,t(m.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=m.attenuationDistance,g.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(g.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(g.anisotropyMap.value=m.anisotropyMap,t(m.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=m.specularIntensity,g.specularColor.value.copy(m.specularColor),m.specularColorMap&&(g.specularColorMap.value=m.specularColorMap,t(m.specularColorMap,g.specularColorMapTransform)),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap,t(m.specularIntensityMap,g.specularIntensityMapTransform))}function p(g,m){m.matcap&&(g.matcap.value=m.matcap)}function _(g,m){const b=e.get(m).light;g.referencePosition.value.setFromMatrixPosition(b.matrixWorld),g.nearDistance.value=b.shadow.camera.near,g.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function tde(n,e,t,r){let i={},s={},o=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function c(b,y){const x=y.program;r.uniformBlockBinding(b,x)}function l(b,y){let x=i[b.id];x===void 0&&(p(b),x=u(b),i[b.id]=x,b.addEventListener("dispose",g));const T=y.program;r.updateUBOMapping(b,T);const k=e.render.frame;s[b.id]!==k&&(f(b),s[b.id]=k)}function u(b){const y=h();b.__bindingPointIndex=y;const x=n.createBuffer(),T=b.__size,k=b.usage;return n.bindBuffer(n.UNIFORM_BUFFER,x),n.bufferData(n.UNIFORM_BUFFER,T,k),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,y,x),x}function h(){for(let b=0;b<a;b++)if(o.indexOf(b)===-1)return o.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(b){const y=i[b.id],x=b.uniforms,T=b.__cache;n.bindBuffer(n.UNIFORM_BUFFER,y);for(let k=0,R=x.length;k<R;k++){const P=Array.isArray(x[k])?x[k]:[x[k]];for(let B=0,U=P.length;B<U;B++){const z=P[B];if(d(z,k,B,T)===!0){const I=z.__offset,L=Array.isArray(z.value)?z.value:[z.value];let M=0;for(let F=0;F<L.length;F++){const Z=L[F],$=_(Z);typeof Z=="number"||typeof Z=="boolean"?(z.__data[0]=Z,n.bufferSubData(n.UNIFORM_BUFFER,I+M,z.__data)):Z.isMatrix3?(z.__data[0]=Z.elements[0],z.__data[1]=Z.elements[1],z.__data[2]=Z.elements[2],z.__data[3]=0,z.__data[4]=Z.elements[3],z.__data[5]=Z.elements[4],z.__data[6]=Z.elements[5],z.__data[7]=0,z.__data[8]=Z.elements[6],z.__data[9]=Z.elements[7],z.__data[10]=Z.elements[8],z.__data[11]=0):(Z.toArray(z.__data,M),M+=$.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,I,z.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function d(b,y,x,T){const k=b.value,R=y+"_"+x;if(T[R]===void 0)return typeof k=="number"||typeof k=="boolean"?T[R]=k:T[R]=k.clone(),!0;{const P=T[R];if(typeof k=="number"||typeof k=="boolean"){if(P!==k)return T[R]=k,!0}else if(P.equals(k)===!1)return P.copy(k),!0}return!1}function p(b){const y=b.uniforms;let x=0;const T=16;for(let R=0,P=y.length;R<P;R++){const B=Array.isArray(y[R])?y[R]:[y[R]];for(let U=0,z=B.length;U<z;U++){const I=B[U],L=Array.isArray(I.value)?I.value:[I.value];for(let M=0,F=L.length;M<F;M++){const Z=L[M],$=_(Z),Y=x%T,Q=Y%$.boundary,q=Y+Q;x+=Q,q!==0&&T-q<$.storage&&(x+=T-q),I.__data=new Float32Array($.storage/Float32Array.BYTES_PER_ELEMENT),I.__offset=x,x+=$.storage}}}const k=x%T;return k>0&&(x+=T-k),b.__size=x,b.__cache={},this}function _(b){const y={boundary:0,storage:0};return typeof b=="number"||typeof b=="boolean"?(y.boundary=4,y.storage=4):b.isVector2?(y.boundary=8,y.storage=8):b.isVector3||b.isColor?(y.boundary=16,y.storage=12):b.isVector4?(y.boundary=16,y.storage=16):b.isMatrix3?(y.boundary=48,y.storage=48):b.isMatrix4?(y.boundary=64,y.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),y}function g(b){const y=b.target;y.removeEventListener("dispose",g);const x=o.indexOf(y.__bindingPointIndex);o.splice(x,1),n.deleteBuffer(i[y.id]),delete i[y.id],delete s[y.id]}function m(){for(const b in i)n.deleteBuffer(i[b]);o=[],i={},s={}}return{bind:c,update:l,dispose:m}}class nde{constructor(e={}){const{canvas:t=kae(),context:r=null,depth:i=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:f=!1}=e;this.isWebGLRenderer=!0;let d;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=r.getContextAttributes().alpha}else d=o;const p=new Uint32Array(4),_=new Int32Array(4);let g=null,m=null;const b=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Wg,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const x=this;let T=!1;this._outputColorSpace=Oi;let k=0,R=0,P=null,B=-1,U=null;const z=new Zo,I=new Zo;let L=null;const M=new gi(0);let F=0,Z=t.width,$=t.height,Y=1,Q=null,q=null;const V=new Zo(0,0,Z,$),K=new Zo(0,0,Z,$);let ne=!1;const ie=new lW;let ae=!1,Te=!1;const Ie=new vo,be=new vo,Pe=new Lt,$e=new Zo,tt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let qe=!1;function ut(){return P===null?Y:1}let te=r;function Ne(Le,mt){return t.getContext(Le,mt)}try{const Le={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${FA}`),t.addEventListener("webglcontextlost",We,!1),t.addEventListener("webglcontextrestored",ct,!1),t.addEventListener("webglcontextcreationerror",Fe,!1),te===null){const mt="webgl2";if(te=Ne(mt,Le),te===null)throw Ne(mt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Le){throw console.error("THREE.WebGLRenderer: "+Le.message),Le}let Be,De,Oe,ue,_e,we,pe,ze,Ze,Je,nt,Pt,vt,At,Re,ce,W,le,Se,Ae,ye,ve,Xe,Me;function Ve(){Be=new fhe(te),Be.init(),ve=new Yfe(te,Be),De=new she(te,Be,e,ve),Oe=new Wfe(te,Be),De.reverseDepthBuffer&&f&&Oe.buffers.depth.setReversed(!0),ue=new mhe(te),_e=new Nfe,we=new qfe(te,Be,Oe,_e,De,ve,ue),pe=new ahe(x),ze=new hhe(x),Ze=new Sce(te),Xe=new rhe(te,Ze),Je=new dhe(te,Ze,ue,Xe),nt=new _he(te,Je,Ze,ue),Se=new ghe(te,De,we),ce=new ohe(_e),Pt=new Ife(x,pe,ze,Be,De,Xe,ce),vt=new ede(x,_e),At=new Dfe,Re=new zfe(Be),le=new nhe(x,pe,ze,Oe,nt,d,c),W=new Gfe(x,nt,De),Me=new tde(te,ue,De,Oe),Ae=new ihe(te,Be,ue),ye=new phe(te,Be,ue),ue.programs=Pt.programs,x.capabilities=De,x.extensions=Be,x.properties=_e,x.renderLists=At,x.shadowMap=W,x.state=Oe,x.info=ue}Ve();const je=new Jfe(x,te);this.xr=je,this.getContext=function(){return te},this.getContextAttributes=function(){return te.getContextAttributes()},this.forceContextLoss=function(){const Le=Be.get("WEBGL_lose_context");Le&&Le.loseContext()},this.forceContextRestore=function(){const Le=Be.get("WEBGL_lose_context");Le&&Le.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(Le){Le!==void 0&&(Y=Le,this.setSize(Z,$,!1))},this.getSize=function(Le){return Le.set(Z,$)},this.setSize=function(Le,mt,Ct=!0){if(je.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Z=Le,$=mt,t.width=Math.floor(Le*Y),t.height=Math.floor(mt*Y),Ct===!0&&(t.style.width=Le+"px",t.style.height=mt+"px"),this.setViewport(0,0,Le,mt)},this.getDrawingBufferSize=function(Le){return Le.set(Z*Y,$*Y).floor()},this.setDrawingBufferSize=function(Le,mt,Ct){Z=Le,$=mt,Y=Ct,t.width=Math.floor(Le*Ct),t.height=Math.floor(mt*Ct),this.setViewport(0,0,Le,mt)},this.getCurrentViewport=function(Le){return Le.copy(z)},this.getViewport=function(Le){return Le.copy(V)},this.setViewport=function(Le,mt,Ct,Ot){Le.isVector4?V.set(Le.x,Le.y,Le.z,Le.w):V.set(Le,mt,Ct,Ot),Oe.viewport(z.copy(V).multiplyScalar(Y).round())},this.getScissor=function(Le){return Le.copy(K)},this.setScissor=function(Le,mt,Ct,Ot){Le.isVector4?K.set(Le.x,Le.y,Le.z,Le.w):K.set(Le,mt,Ct,Ot),Oe.scissor(I.copy(K).multiplyScalar(Y).round())},this.getScissorTest=function(){return ne},this.setScissorTest=function(Le){Oe.setScissorTest(ne=Le)},this.setOpaqueSort=function(Le){Q=Le},this.setTransparentSort=function(Le){q=Le},this.getClearColor=function(Le){return Le.copy(le.getClearColor())},this.setClearColor=function(){le.setClearColor(...arguments)},this.getClearAlpha=function(){return le.getClearAlpha()},this.setClearAlpha=function(){le.setClearAlpha(...arguments)},this.clear=function(Le=!0,mt=!0,Ct=!0){let Ot=0;if(Le){let yt=!1;if(P!==null){const Qt=P.texture.format;yt=Qt===zk||Qt===t5||Qt===Q4}if(yt){const Qt=P.texture.type,Sn=Qt===Do||Qt===jv||Qt===Hw||Qt===ex||Qt===Z4||Qt===J4,an=le.getClearColor(),Dn=le.getClearAlpha(),or=an.r,rr=an.g,zn=an.b;Sn?(p[0]=or,p[1]=rr,p[2]=zn,p[3]=Dn,te.clearBufferuiv(te.COLOR,0,p)):(_[0]=or,_[1]=rr,_[2]=zn,_[3]=Dn,te.clearBufferiv(te.COLOR,0,_))}else Ot|=te.COLOR_BUFFER_BIT}mt&&(Ot|=te.DEPTH_BUFFER_BIT),Ct&&(Ot|=te.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),te.clear(Ot)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",We,!1),t.removeEventListener("webglcontextrestored",ct,!1),t.removeEventListener("webglcontextcreationerror",Fe,!1),le.dispose(),At.dispose(),Re.dispose(),_e.dispose(),pe.dispose(),ze.dispose(),nt.dispose(),Xe.dispose(),Me.dispose(),Pt.dispose(),je.dispose(),je.removeEventListener("sessionstart",Rt),je.removeEventListener("sessionend",Ut),_t.stop()};function We(Le){Le.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),T=!0}function ct(){console.log("THREE.WebGLRenderer: Context Restored."),T=!1;const Le=ue.autoReset,mt=W.enabled,Ct=W.autoUpdate,Ot=W.needsUpdate,yt=W.type;Ve(),ue.autoReset=Le,W.enabled=mt,W.autoUpdate=Ct,W.needsUpdate=Ot,W.type=yt}function Fe(Le){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Le.statusMessage)}function rt(Le){const mt=Le.target;mt.removeEventListener("dispose",rt),it(mt)}function it(Le){St(Le),_e.remove(Le)}function St(Le){const mt=_e.get(Le).programs;mt!==void 0&&(mt.forEach(function(Ct){Pt.releaseProgram(Ct)}),Le.isShaderMaterial&&Pt.releaseShaderCache(Le))}this.renderBufferDirect=function(Le,mt,Ct,Ot,yt,Qt){mt===null&&(mt=tt);const Sn=yt.isMesh&&yt.matrixWorld.determinant()<0,an=_i(Le,mt,Ct,Ot,yt);Oe.setMaterial(Ot,Sn);let Dn=Ct.index,or=1;if(Ot.wireframe===!0){if(Dn=Je.getWireframeAttribute(Ct),Dn===void 0)return;or=2}const rr=Ct.drawRange,zn=Ct.attributes.position;let dr=rr.start*or,Ur=(rr.start+rr.count)*or;Qt!==null&&(dr=Math.max(dr,Qt.start*or),Ur=Math.min(Ur,(Qt.start+Qt.count)*or)),Dn!==null?(dr=Math.max(dr,0),Ur=Math.min(Ur,Dn.count)):zn!=null&&(dr=Math.max(dr,0),Ur=Math.min(Ur,zn.count));const rs=Ur-dr;if(rs<0||rs===1/0)return;Xe.setup(yt,Ot,an,Ct,Dn);let Rr,Dr=Ae;if(Dn!==null&&(Rr=Ze.get(Dn),Dr=ye,Dr.setIndex(Rr)),yt.isMesh)Ot.wireframe===!0?(Oe.setLineWidth(Ot.wireframeLinewidth*ut()),Dr.setMode(te.LINES)):Dr.setMode(te.TRIANGLES);else if(yt.isLine){let Qn=Ot.linewidth;Qn===void 0&&(Qn=1),Oe.setLineWidth(Qn*ut()),yt.isLineSegments?Dr.setMode(te.LINES):yt.isLineLoop?Dr.setMode(te.LINE_LOOP):Dr.setMode(te.LINE_STRIP)}else yt.isPoints?Dr.setMode(te.POINTS):yt.isSprite&&Dr.setMode(te.TRIANGLES);if(yt.isBatchedMesh)if(yt._multiDrawInstances!==null)yC("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Dr.renderMultiDrawInstances(yt._multiDrawStarts,yt._multiDrawCounts,yt._multiDrawCount,yt._multiDrawInstances);else if(Be.get("WEBGL_multi_draw"))Dr.renderMultiDraw(yt._multiDrawStarts,yt._multiDrawCounts,yt._multiDrawCount);else{const Qn=yt._multiDrawStarts,pr=yt._multiDrawCounts,On=yt._multiDrawCount,Fs=Dn?Ze.get(Dn).bytesPerElement:1,So=_e.get(Ot).currentProgram.getUniforms();for(let js=0;js<On;js++)So.setValue(te,"_gl_DrawID",js),Dr.render(Qn[js]/Fs,pr[js])}else if(yt.isInstancedMesh)Dr.renderInstances(dr,rs,yt.count);else if(Ct.isInstancedBufferGeometry){const Qn=Ct._maxInstanceCount!==void 0?Ct._maxInstanceCount:1/0,pr=Math.min(Ct.instanceCount,Qn);Dr.renderInstances(dr,rs,pr)}else Dr.render(dr,rs)};function at(Le,mt,Ct){Le.transparent===!0&&Le.side===Ba&&Le.forceSinglePass===!1?(Le.side=ol,Le.needsUpdate=!0,Un(Le,mt,Ct),Le.side=e_,Le.needsUpdate=!0,Un(Le,mt,Ct),Le.side=Ba):Un(Le,mt,Ct)}this.compile=function(Le,mt,Ct=null){Ct===null&&(Ct=Le),m=Re.get(Ct),m.init(mt),y.push(m),Ct.traverseVisible(function(yt){yt.isLight&&yt.layers.test(mt.layers)&&(m.pushLight(yt),yt.castShadow&&m.pushShadow(yt))}),Le!==Ct&&Le.traverseVisible(function(yt){yt.isLight&&yt.layers.test(mt.layers)&&(m.pushLight(yt),yt.castShadow&&m.pushShadow(yt))}),m.setupLights();const Ot=new Set;return Le.traverse(function(yt){if(!(yt.isMesh||yt.isPoints||yt.isLine||yt.isSprite))return;const Qt=yt.material;if(Qt)if(Array.isArray(Qt))for(let Sn=0;Sn<Qt.length;Sn++){const an=Qt[Sn];at(an,Ct,yt),Ot.add(an)}else at(Qt,Ct,yt),Ot.add(Qt)}),m=y.pop(),Ot},this.compileAsync=function(Le,mt,Ct=null){const Ot=this.compile(Le,mt,Ct);return new Promise(yt=>{function Qt(){if(Ot.forEach(function(Sn){_e.get(Sn).currentProgram.isReady()&&Ot.delete(Sn)}),Ot.size===0){yt(Le);return}setTimeout(Qt,10)}Be.get("KHR_parallel_shader_compile")!==null?Qt():setTimeout(Qt,10)})};let Yt=null;function sn(Le){Yt&&Yt(Le)}function Rt(){_t.stop()}function Ut(){_t.start()}const _t=new hW;_t.setAnimationLoop(sn),typeof self<"u"&&_t.setContext(self),this.setAnimationLoop=function(Le){Yt=Le,je.setAnimationLoop(Le),Le===null?_t.stop():_t.start()},je.addEventListener("sessionstart",Rt),je.addEventListener("sessionend",Ut),this.render=function(Le,mt){if(mt!==void 0&&mt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(T===!0)return;if(Le.matrixWorldAutoUpdate===!0&&Le.updateMatrixWorld(),mt.parent===null&&mt.matrixWorldAutoUpdate===!0&&mt.updateMatrixWorld(),je.enabled===!0&&je.isPresenting===!0&&(je.cameraAutoUpdate===!0&&je.updateCamera(mt),mt=je.getCamera()),Le.isScene===!0&&Le.onBeforeRender(x,Le,mt,P),m=Re.get(Le,y.length),m.init(mt),y.push(m),be.multiplyMatrices(mt.projectionMatrix,mt.matrixWorldInverse),ie.setFromProjectionMatrix(be),Te=this.localClippingEnabled,ae=ce.init(this.clippingPlanes,Te),g=At.get(Le,b.length),g.init(),b.push(g),je.enabled===!0&&je.isPresenting===!0){const Qt=x.xr.getDepthSensingMesh();Qt!==null&&Ht(Qt,mt,-1/0,x.sortObjects)}Ht(Le,mt,0,x.sortObjects),g.finish(),x.sortObjects===!0&&g.sort(Q,q),qe=je.enabled===!1||je.isPresenting===!1||je.hasDepthSensing()===!1,qe&&le.addToRenderList(g,Le),this.info.render.frame++,ae===!0&&ce.beginShadows();const Ct=m.state.shadowsArray;W.render(Ct,Le,mt),ae===!0&&ce.endShadows(),this.info.autoReset===!0&&this.info.reset();const Ot=g.opaque,yt=g.transmissive;if(m.setupLights(),mt.isArrayCamera){const Qt=mt.cameras;if(yt.length>0)for(let Sn=0,an=Qt.length;Sn<an;Sn++){const Dn=Qt[Sn];jt(Ot,yt,Le,Dn)}qe&&le.render(Le);for(let Sn=0,an=Qt.length;Sn<an;Sn++){const Dn=Qt[Sn];_n(g,Le,Dn,Dn.viewport)}}else yt.length>0&&jt(Ot,yt,Le,mt),qe&&le.render(Le),_n(g,Le,mt);P!==null&&R===0&&(we.updateMultisampleRenderTarget(P),we.updateRenderTargetMipmap(P)),Le.isScene===!0&&Le.onAfterRender(x,Le,mt),Xe.resetDefaultState(),B=-1,U=null,y.pop(),y.length>0?(m=y[y.length-1],ae===!0&&ce.setGlobalState(x.clippingPlanes,m.state.camera)):m=null,b.pop(),b.length>0?g=b[b.length-1]:g=null};function Ht(Le,mt,Ct,Ot){if(Le.visible===!1)return;if(Le.layers.test(mt.layers)){if(Le.isGroup)Ct=Le.renderOrder;else if(Le.isLOD)Le.autoUpdate===!0&&Le.update(mt);else if(Le.isLight)m.pushLight(Le),Le.castShadow&&m.pushShadow(Le);else if(Le.isSprite){if(!Le.frustumCulled||ie.intersectsSprite(Le)){Ot&&$e.setFromMatrixPosition(Le.matrixWorld).applyMatrix4(be);const Sn=nt.update(Le),an=Le.material;an.visible&&g.push(Le,Sn,an,Ct,$e.z,null)}}else if((Le.isMesh||Le.isLine||Le.isPoints)&&(!Le.frustumCulled||ie.intersectsObject(Le))){const Sn=nt.update(Le),an=Le.material;if(Ot&&(Le.boundingSphere!==void 0?(Le.boundingSphere===null&&Le.computeBoundingSphere(),$e.copy(Le.boundingSphere.center)):(Sn.boundingSphere===null&&Sn.computeBoundingSphere(),$e.copy(Sn.boundingSphere.center)),$e.applyMatrix4(Le.matrixWorld).applyMatrix4(be)),Array.isArray(an)){const Dn=Sn.groups;for(let or=0,rr=Dn.length;or<rr;or++){const zn=Dn[or],dr=an[zn.materialIndex];dr&&dr.visible&&g.push(Le,Sn,dr,Ct,$e.z,zn)}}else an.visible&&g.push(Le,Sn,an,Ct,$e.z,null)}}const Qt=Le.children;for(let Sn=0,an=Qt.length;Sn<an;Sn++)Ht(Qt[Sn],mt,Ct,Ot)}function _n(Le,mt,Ct,Ot){const yt=Le.opaque,Qt=Le.transmissive,Sn=Le.transparent;m.setupLightsView(Ct),ae===!0&&ce.setGlobalState(x.clippingPlanes,Ct),Ot&&Oe.viewport(z.copy(Ot)),yt.length>0&&mn(yt,mt,Ct),Qt.length>0&&mn(Qt,mt,Ct),Sn.length>0&&mn(Sn,mt,Ct),Oe.buffers.depth.setTest(!0),Oe.buffers.depth.setMask(!0),Oe.buffers.color.setMask(!0),Oe.setPolygonOffset(!1)}function jt(Le,mt,Ct,Ot){if((Ct.isScene===!0?Ct.overrideMaterial:null)!==null)return;m.state.transmissionRenderTarget[Ot.id]===void 0&&(m.state.transmissionRenderTarget[Ot.id]=new Nl(1,1,{generateMipmaps:!0,type:Be.has("EXT_color_buffer_half_float")||Be.has("EXT_color_buffer_float")?Jv:Do,minFilter:L1,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:zi.workingColorSpace}));const Qt=m.state.transmissionRenderTarget[Ot.id],Sn=Ot.viewport||z;Qt.setSize(Sn.z*x.transmissionResolutionScale,Sn.w*x.transmissionResolutionScale);const an=x.getRenderTarget();x.setRenderTarget(Qt),x.getClearColor(M),F=x.getClearAlpha(),F<1&&x.setClearColor(16777215,.5),x.clear(),qe&&le.render(Ct);const Dn=x.toneMapping;x.toneMapping=Wg;const or=Ot.viewport;if(Ot.viewport!==void 0&&(Ot.viewport=void 0),m.setupLightsView(Ot),ae===!0&&ce.setGlobalState(x.clippingPlanes,Ot),mn(Le,Ct,Ot),we.updateMultisampleRenderTarget(Qt),we.updateRenderTargetMipmap(Qt),Be.has("WEBGL_multisampled_render_to_texture")===!1){let rr=!1;for(let zn=0,dr=mt.length;zn<dr;zn++){const Ur=mt[zn],rs=Ur.object,Rr=Ur.geometry,Dr=Ur.material,Qn=Ur.group;if(Dr.side===Ba&&rs.layers.test(Ot.layers)){const pr=Dr.side;Dr.side=ol,Dr.needsUpdate=!0,Rn(rs,Ct,Ot,Rr,Dr,Qn),Dr.side=pr,Dr.needsUpdate=!0,rr=!0}}rr===!0&&(we.updateMultisampleRenderTarget(Qt),we.updateRenderTargetMipmap(Qt))}x.setRenderTarget(an),x.setClearColor(M,F),or!==void 0&&(Ot.viewport=or),x.toneMapping=Dn}function mn(Le,mt,Ct){const Ot=mt.isScene===!0?mt.overrideMaterial:null;for(let yt=0,Qt=Le.length;yt<Qt;yt++){const Sn=Le[yt],an=Sn.object,Dn=Sn.geometry,or=Sn.group;let rr=Sn.material;rr.allowOverride===!0&&Ot!==null&&(rr=Ot),an.layers.test(Ct.layers)&&Rn(an,mt,Ct,Dn,rr,or)}}function Rn(Le,mt,Ct,Ot,yt,Qt){Le.onBeforeRender(x,mt,Ct,Ot,yt,Qt),Le.modelViewMatrix.multiplyMatrices(Ct.matrixWorldInverse,Le.matrixWorld),Le.normalMatrix.getNormalMatrix(Le.modelViewMatrix),yt.onBeforeRender(x,mt,Ct,Ot,Le,Qt),yt.transparent===!0&&yt.side===Ba&&yt.forceSinglePass===!1?(yt.side=ol,yt.needsUpdate=!0,x.renderBufferDirect(Ct,mt,Ot,yt,Le,Qt),yt.side=e_,yt.needsUpdate=!0,x.renderBufferDirect(Ct,mt,Ot,yt,Le,Qt),yt.side=Ba):x.renderBufferDirect(Ct,mt,Ot,yt,Le,Qt),Le.onAfterRender(x,mt,Ct,Ot,yt,Qt)}function Un(Le,mt,Ct){mt.isScene!==!0&&(mt=tt);const Ot=_e.get(Le),yt=m.state.lights,Qt=m.state.shadowsArray,Sn=yt.state.version,an=Pt.getParameters(Le,yt.state,Qt,mt,Ct),Dn=Pt.getProgramCacheKey(an);let or=Ot.programs;Ot.environment=Le.isMeshStandardMaterial?mt.environment:null,Ot.fog=mt.fog,Ot.envMap=(Le.isMeshStandardMaterial?ze:pe).get(Le.envMap||Ot.environment),Ot.envMapRotation=Ot.environment!==null&&Le.envMap===null?mt.environmentRotation:Le.envMapRotation,or===void 0&&(Le.addEventListener("dispose",rt),or=new Map,Ot.programs=or);let rr=or.get(Dn);if(rr!==void 0){if(Ot.currentProgram===rr&&Ot.lightsStateVersion===Sn)return oi(Le,an),rr}else an.uniforms=Pt.getUniforms(Le),Le.onBeforeCompile(an,x),rr=Pt.acquireProgram(an,Dn),or.set(Dn,rr),Ot.uniforms=an.uniforms;const zn=Ot.uniforms;return(!Le.isShaderMaterial&&!Le.isRawShaderMaterial||Le.clipping===!0)&&(zn.clippingPlanes=ce.uniform),oi(Le,an),Ot.needsLights=Is(Le),Ot.lightsStateVersion=Sn,Ot.needsLights&&(zn.ambientLightColor.value=yt.state.ambient,zn.lightProbe.value=yt.state.probe,zn.directionalLights.value=yt.state.directional,zn.directionalLightShadows.value=yt.state.directionalShadow,zn.spotLights.value=yt.state.spot,zn.spotLightShadows.value=yt.state.spotShadow,zn.rectAreaLights.value=yt.state.rectArea,zn.ltc_1.value=yt.state.rectAreaLTC1,zn.ltc_2.value=yt.state.rectAreaLTC2,zn.pointLights.value=yt.state.point,zn.pointLightShadows.value=yt.state.pointShadow,zn.hemisphereLights.value=yt.state.hemi,zn.directionalShadowMap.value=yt.state.directionalShadowMap,zn.directionalShadowMatrix.value=yt.state.directionalShadowMatrix,zn.spotShadowMap.value=yt.state.spotShadowMap,zn.spotLightMatrix.value=yt.state.spotLightMatrix,zn.spotLightMap.value=yt.state.spotLightMap,zn.pointShadowMap.value=yt.state.pointShadowMap,zn.pointShadowMatrix.value=yt.state.pointShadowMatrix),Ot.currentProgram=rr,Ot.uniformsList=null,rr}function qi(Le){if(Le.uniformsList===null){const mt=Le.currentProgram.getUniforms();Le.uniformsList=bC.seqWithValue(mt.seq,Le.uniforms)}return Le.uniformsList}function oi(Le,mt){const Ct=_e.get(Le);Ct.outputColorSpace=mt.outputColorSpace,Ct.batching=mt.batching,Ct.batchingColor=mt.batchingColor,Ct.instancing=mt.instancing,Ct.instancingColor=mt.instancingColor,Ct.instancingMorph=mt.instancingMorph,Ct.skinning=mt.skinning,Ct.morphTargets=mt.morphTargets,Ct.morphNormals=mt.morphNormals,Ct.morphColors=mt.morphColors,Ct.morphTargetsCount=mt.morphTargetsCount,Ct.numClippingPlanes=mt.numClippingPlanes,Ct.numIntersection=mt.numClipIntersection,Ct.vertexAlphas=mt.vertexAlphas,Ct.vertexTangents=mt.vertexTangents,Ct.toneMapping=mt.toneMapping}function _i(Le,mt,Ct,Ot,yt){mt.isScene!==!0&&(mt=tt),we.resetTextureUnits();const Qt=mt.fog,Sn=Ot.isMeshStandardMaterial?mt.environment:null,an=P===null?x.outputColorSpace:P.isXRRenderTarget===!0?P.texture.colorSpace:t_,Dn=(Ot.isMeshStandardMaterial?ze:pe).get(Ot.envMap||Sn),or=Ot.vertexColors===!0&&!!Ct.attributes.color&&Ct.attributes.color.itemSize===4,rr=!!Ct.attributes.tangent&&(!!Ot.normalMap||Ot.anisotropy>0),zn=!!Ct.morphAttributes.position,dr=!!Ct.morphAttributes.normal,Ur=!!Ct.morphAttributes.color;let rs=Wg;Ot.toneMapped&&(P===null||P.isXRRenderTarget===!0)&&(rs=x.toneMapping);const Rr=Ct.morphAttributes.position||Ct.morphAttributes.normal||Ct.morphAttributes.color,Dr=Rr!==void 0?Rr.length:0,Qn=_e.get(Ot),pr=m.state.lights;if(ae===!0&&(Te===!0||Le!==U)){const $n=Le===U&&Ot.id===B;ce.setState(Ot,Le,$n)}let On=!1;Ot.version===Qn.__version?(Qn.needsLights&&Qn.lightsStateVersion!==pr.state.version||Qn.outputColorSpace!==an||yt.isBatchedMesh&&Qn.batching===!1||!yt.isBatchedMesh&&Qn.batching===!0||yt.isBatchedMesh&&Qn.batchingColor===!0&&yt.colorTexture===null||yt.isBatchedMesh&&Qn.batchingColor===!1&&yt.colorTexture!==null||yt.isInstancedMesh&&Qn.instancing===!1||!yt.isInstancedMesh&&Qn.instancing===!0||yt.isSkinnedMesh&&Qn.skinning===!1||!yt.isSkinnedMesh&&Qn.skinning===!0||yt.isInstancedMesh&&Qn.instancingColor===!0&&yt.instanceColor===null||yt.isInstancedMesh&&Qn.instancingColor===!1&&yt.instanceColor!==null||yt.isInstancedMesh&&Qn.instancingMorph===!0&&yt.morphTexture===null||yt.isInstancedMesh&&Qn.instancingMorph===!1&&yt.morphTexture!==null||Qn.envMap!==Dn||Ot.fog===!0&&Qn.fog!==Qt||Qn.numClippingPlanes!==void 0&&(Qn.numClippingPlanes!==ce.numPlanes||Qn.numIntersection!==ce.numIntersection)||Qn.vertexAlphas!==or||Qn.vertexTangents!==rr||Qn.morphTargets!==zn||Qn.morphNormals!==dr||Qn.morphColors!==Ur||Qn.toneMapping!==rs||Qn.morphTargetsCount!==Dr)&&(On=!0):(On=!0,Qn.__version=Ot.version);let Fs=Qn.currentProgram;On===!0&&(Fs=Un(Ot,mt,yt));let So=!1,js=!1,Qo=!1;const Ci=Fs.getUniforms(),xn=Qn.uniforms;if(Oe.useProgram(Fs.program)&&(So=!0,js=!0,Qo=!0),Ot.id!==B&&(B=Ot.id,js=!0),So||U!==Le){Oe.buffers.depth.getReversed()?(Ie.copy(Le.projectionMatrix),Iae(Ie),Nae(Ie),Ci.setValue(te,"projectionMatrix",Ie)):Ci.setValue(te,"projectionMatrix",Le.projectionMatrix),Ci.setValue(te,"viewMatrix",Le.matrixWorldInverse);const fs=Ci.map.cameraPosition;fs!==void 0&&fs.setValue(te,Pe.setFromMatrixPosition(Le.matrixWorld)),De.logarithmicDepthBuffer&&Ci.setValue(te,"logDepthBufFC",2/(Math.log(Le.far+1)/Math.LN2)),(Ot.isMeshPhongMaterial||Ot.isMeshToonMaterial||Ot.isMeshLambertMaterial||Ot.isMeshBasicMaterial||Ot.isMeshStandardMaterial||Ot.isShaderMaterial)&&Ci.setValue(te,"isOrthographic",Le.isOrthographicCamera===!0),U!==Le&&(U=Le,js=!0,Qo=!0)}if(yt.isSkinnedMesh){Ci.setOptional(te,yt,"bindMatrix"),Ci.setOptional(te,yt,"bindMatrixInverse");const $n=yt.skeleton;$n&&($n.boneTexture===null&&$n.computeBoneTexture(),Ci.setValue(te,"boneTexture",$n.boneTexture,we))}yt.isBatchedMesh&&(Ci.setOptional(te,yt,"batchingTexture"),Ci.setValue(te,"batchingTexture",yt._matricesTexture,we),Ci.setOptional(te,yt,"batchingIdTexture"),Ci.setValue(te,"batchingIdTexture",yt._indirectTexture,we),Ci.setOptional(te,yt,"batchingColorTexture"),yt._colorsTexture!==null&&Ci.setValue(te,"batchingColorTexture",yt._colorsTexture,we));const bs=Ct.morphAttributes;if((bs.position!==void 0||bs.normal!==void 0||bs.color!==void 0)&&Se.update(yt,Ct,Fs),(js||Qn.receiveShadow!==yt.receiveShadow)&&(Qn.receiveShadow=yt.receiveShadow,Ci.setValue(te,"receiveShadow",yt.receiveShadow)),Ot.isMeshGouraudMaterial&&Ot.envMap!==null&&(xn.envMap.value=Dn,xn.flipEnvMap.value=Dn.isCubeTexture&&Dn.isRenderTargetTexture===!1?-1:1),Ot.isMeshStandardMaterial&&Ot.envMap===null&&mt.environment!==null&&(xn.envMapIntensity.value=mt.environmentIntensity),js&&(Ci.setValue(te,"toneMappingExposure",x.toneMappingExposure),Qn.needsLights&&ys(xn,Qo),Qt&&Ot.fog===!0&&vt.refreshFogUniforms(xn,Qt),vt.refreshMaterialUniforms(xn,Ot,Y,$,m.state.transmissionRenderTarget[Le.id]),bC.upload(te,qi(Qn),xn,we)),Ot.isShaderMaterial&&Ot.uniformsNeedUpdate===!0&&(bC.upload(te,qi(Qn),xn,we),Ot.uniformsNeedUpdate=!1),Ot.isSpriteMaterial&&Ci.setValue(te,"center",yt.center),Ci.setValue(te,"modelViewMatrix",yt.modelViewMatrix),Ci.setValue(te,"normalMatrix",yt.normalMatrix),Ci.setValue(te,"modelMatrix",yt.matrixWorld),Ot.isShaderMaterial||Ot.isRawShaderMaterial){const $n=Ot.uniformsGroups;for(let fs=0,ac=$n.length;fs<ac;fs++){const is=$n[fs];Me.update(is,Fs),Me.bind(is,Fs)}}return Fs}function ys(Le,mt){Le.ambientLightColor.needsUpdate=mt,Le.lightProbe.needsUpdate=mt,Le.directionalLights.needsUpdate=mt,Le.directionalLightShadows.needsUpdate=mt,Le.pointLights.needsUpdate=mt,Le.pointLightShadows.needsUpdate=mt,Le.spotLights.needsUpdate=mt,Le.spotLightShadows.needsUpdate=mt,Le.rectAreaLights.needsUpdate=mt,Le.hemisphereLights.needsUpdate=mt}function Is(Le){return Le.isMeshLambertMaterial||Le.isMeshToonMaterial||Le.isMeshPhongMaterial||Le.isMeshStandardMaterial||Le.isShadowMaterial||Le.isShaderMaterial&&Le.lights===!0}this.getActiveCubeFace=function(){return k},this.getActiveMipmapLevel=function(){return R},this.getRenderTarget=function(){return P},this.setRenderTargetTextures=function(Le,mt,Ct){const Ot=_e.get(Le);Ot.__autoAllocateDepthBuffer=Le.resolveDepthBuffer===!1,Ot.__autoAllocateDepthBuffer===!1&&(Ot.__useRenderToTexture=!1),_e.get(Le.texture).__webglTexture=mt,_e.get(Le.depthTexture).__webglTexture=Ot.__autoAllocateDepthBuffer?void 0:Ct,Ot.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(Le,mt){const Ct=_e.get(Le);Ct.__webglFramebuffer=mt,Ct.__useDefaultFramebuffer=mt===void 0};const Ui=te.createFramebuffer();this.setRenderTarget=function(Le,mt=0,Ct=0){P=Le,k=mt,R=Ct;let Ot=!0,yt=null,Qt=!1,Sn=!1;if(Le){const Dn=_e.get(Le);if(Dn.__useDefaultFramebuffer!==void 0)Oe.bindFramebuffer(te.FRAMEBUFFER,null),Ot=!1;else if(Dn.__webglFramebuffer===void 0)we.setupRenderTarget(Le);else if(Dn.__hasExternalTextures)we.rebindTextures(Le,_e.get(Le.texture).__webglTexture,_e.get(Le.depthTexture).__webglTexture);else if(Le.depthBuffer){const zn=Le.depthTexture;if(Dn.__boundDepthTexture!==zn){if(zn!==null&&_e.has(zn)&&(Le.width!==zn.image.width||Le.height!==zn.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");we.setupDepthRenderbuffer(Le)}}const or=Le.texture;(or.isData3DTexture||or.isDataArrayTexture||or.isCompressedArrayTexture)&&(Sn=!0);const rr=_e.get(Le).__webglFramebuffer;Le.isWebGLCubeRenderTarget?(Array.isArray(rr[mt])?yt=rr[mt][Ct]:yt=rr[mt],Qt=!0):Le.samples>0&&we.useMultisampledRTT(Le)===!1?yt=_e.get(Le).__webglMultisampledFramebuffer:Array.isArray(rr)?yt=rr[Ct]:yt=rr,z.copy(Le.viewport),I.copy(Le.scissor),L=Le.scissorTest}else z.copy(V).multiplyScalar(Y).floor(),I.copy(K).multiplyScalar(Y).floor(),L=ne;if(Ct!==0&&(yt=Ui),Oe.bindFramebuffer(te.FRAMEBUFFER,yt)&&Ot&&Oe.drawBuffers(Le,yt),Oe.viewport(z),Oe.scissor(I),Oe.setScissorTest(L),Qt){const Dn=_e.get(Le.texture);te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_CUBE_MAP_POSITIVE_X+mt,Dn.__webglTexture,Ct)}else if(Sn){const Dn=_e.get(Le.texture),or=mt;te.framebufferTextureLayer(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,Dn.__webglTexture,Ct,or)}else if(Le!==null&&Ct!==0){const Dn=_e.get(Le.texture);te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_2D,Dn.__webglTexture,Ct)}B=-1},this.readRenderTargetPixels=function(Le,mt,Ct,Ot,yt,Qt,Sn){if(!(Le&&Le.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let an=_e.get(Le).__webglFramebuffer;if(Le.isWebGLCubeRenderTarget&&Sn!==void 0&&(an=an[Sn]),an){Oe.bindFramebuffer(te.FRAMEBUFFER,an);try{const Dn=Le.texture,or=Dn.format,rr=Dn.type;if(!De.textureFormatReadable(or)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!De.textureTypeReadable(rr)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}mt>=0&&mt<=Le.width-Ot&&Ct>=0&&Ct<=Le.height-yt&&te.readPixels(mt,Ct,Ot,yt,ve.convert(or),ve.convert(rr),Qt)}finally{const Dn=P!==null?_e.get(P).__webglFramebuffer:null;Oe.bindFramebuffer(te.FRAMEBUFFER,Dn)}}},this.readRenderTargetPixelsAsync=async function(Le,mt,Ct,Ot,yt,Qt,Sn){if(!(Le&&Le.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let an=_e.get(Le).__webglFramebuffer;if(Le.isWebGLCubeRenderTarget&&Sn!==void 0&&(an=an[Sn]),an)if(mt>=0&&mt<=Le.width-Ot&&Ct>=0&&Ct<=Le.height-yt){Oe.bindFramebuffer(te.FRAMEBUFFER,an);const Dn=Le.texture,or=Dn.format,rr=Dn.type;if(!De.textureFormatReadable(or))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!De.textureTypeReadable(rr))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const zn=te.createBuffer();te.bindBuffer(te.PIXEL_PACK_BUFFER,zn),te.bufferData(te.PIXEL_PACK_BUFFER,Qt.byteLength,te.STREAM_READ),te.readPixels(mt,Ct,Ot,yt,ve.convert(or),ve.convert(rr),0);const dr=P!==null?_e.get(P).__webglFramebuffer:null;Oe.bindFramebuffer(te.FRAMEBUFFER,dr);const Ur=te.fenceSync(te.SYNC_GPU_COMMANDS_COMPLETE,0);return te.flush(),await Oae(te,Ur,4),te.bindBuffer(te.PIXEL_PACK_BUFFER,zn),te.getBufferSubData(te.PIXEL_PACK_BUFFER,0,Qt),te.deleteBuffer(zn),te.deleteSync(Ur),Qt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(Le,mt=null,Ct=0){const Ot=Math.pow(2,-Ct),yt=Math.floor(Le.image.width*Ot),Qt=Math.floor(Le.image.height*Ot),Sn=mt!==null?mt.x:0,an=mt!==null?mt.y:0;we.setTexture2D(Le,0),te.copyTexSubImage2D(te.TEXTURE_2D,Ct,0,0,Sn,an,yt,Qt),Oe.unbindTexture()};const us=te.createFramebuffer(),hs=te.createFramebuffer();this.copyTextureToTexture=function(Le,mt,Ct=null,Ot=null,yt=0,Qt=null){Qt===null&&(yt!==0?(yC("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Qt=yt,yt=0):Qt=0);let Sn,an,Dn,or,rr,zn,dr,Ur,rs;const Rr=Le.isCompressedTexture?Le.mipmaps[Qt]:Le.image;if(Ct!==null)Sn=Ct.max.x-Ct.min.x,an=Ct.max.y-Ct.min.y,Dn=Ct.isBox3?Ct.max.z-Ct.min.z:1,or=Ct.min.x,rr=Ct.min.y,zn=Ct.isBox3?Ct.min.z:0;else{const bs=Math.pow(2,-yt);Sn=Math.floor(Rr.width*bs),an=Math.floor(Rr.height*bs),Le.isDataArrayTexture?Dn=Rr.depth:Le.isData3DTexture?Dn=Math.floor(Rr.depth*bs):Dn=1,or=0,rr=0,zn=0}Ot!==null?(dr=Ot.x,Ur=Ot.y,rs=Ot.z):(dr=0,Ur=0,rs=0);const Dr=ve.convert(mt.format),Qn=ve.convert(mt.type);let pr;mt.isData3DTexture?(we.setTexture3D(mt,0),pr=te.TEXTURE_3D):mt.isDataArrayTexture||mt.isCompressedArrayTexture?(we.setTexture2DArray(mt,0),pr=te.TEXTURE_2D_ARRAY):(we.setTexture2D(mt,0),pr=te.TEXTURE_2D),te.pixelStorei(te.UNPACK_FLIP_Y_WEBGL,mt.flipY),te.pixelStorei(te.UNPACK_PREMULTIPLY_ALPHA_WEBGL,mt.premultiplyAlpha),te.pixelStorei(te.UNPACK_ALIGNMENT,mt.unpackAlignment);const On=te.getParameter(te.UNPACK_ROW_LENGTH),Fs=te.getParameter(te.UNPACK_IMAGE_HEIGHT),So=te.getParameter(te.UNPACK_SKIP_PIXELS),js=te.getParameter(te.UNPACK_SKIP_ROWS),Qo=te.getParameter(te.UNPACK_SKIP_IMAGES);te.pixelStorei(te.UNPACK_ROW_LENGTH,Rr.width),te.pixelStorei(te.UNPACK_IMAGE_HEIGHT,Rr.height),te.pixelStorei(te.UNPACK_SKIP_PIXELS,or),te.pixelStorei(te.UNPACK_SKIP_ROWS,rr),te.pixelStorei(te.UNPACK_SKIP_IMAGES,zn);const Ci=Le.isDataArrayTexture||Le.isData3DTexture,xn=mt.isDataArrayTexture||mt.isData3DTexture;if(Le.isDepthTexture){const bs=_e.get(Le),$n=_e.get(mt),fs=_e.get(bs.__renderTarget),ac=_e.get($n.__renderTarget);Oe.bindFramebuffer(te.READ_FRAMEBUFFER,fs.__webglFramebuffer),Oe.bindFramebuffer(te.DRAW_FRAMEBUFFER,ac.__webglFramebuffer);for(let is=0;is<Dn;is++)Ci&&(te.framebufferTextureLayer(te.READ_FRAMEBUFFER,te.COLOR_ATTACHMENT0,_e.get(Le).__webglTexture,yt,zn+is),te.framebufferTextureLayer(te.DRAW_FRAMEBUFFER,te.COLOR_ATTACHMENT0,_e.get(mt).__webglTexture,Qt,rs+is)),te.blitFramebuffer(or,rr,Sn,an,dr,Ur,Sn,an,te.DEPTH_BUFFER_BIT,te.NEAREST);Oe.bindFramebuffer(te.READ_FRAMEBUFFER,null),Oe.bindFramebuffer(te.DRAW_FRAMEBUFFER,null)}else if(yt!==0||Le.isRenderTargetTexture||_e.has(Le)){const bs=_e.get(Le),$n=_e.get(mt);Oe.bindFramebuffer(te.READ_FRAMEBUFFER,us),Oe.bindFramebuffer(te.DRAW_FRAMEBUFFER,hs);for(let fs=0;fs<Dn;fs++)Ci?te.framebufferTextureLayer(te.READ_FRAMEBUFFER,te.COLOR_ATTACHMENT0,bs.__webglTexture,yt,zn+fs):te.framebufferTexture2D(te.READ_FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_2D,bs.__webglTexture,yt),xn?te.framebufferTextureLayer(te.DRAW_FRAMEBUFFER,te.COLOR_ATTACHMENT0,$n.__webglTexture,Qt,rs+fs):te.framebufferTexture2D(te.DRAW_FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_2D,$n.__webglTexture,Qt),yt!==0?te.blitFramebuffer(or,rr,Sn,an,dr,Ur,Sn,an,te.COLOR_BUFFER_BIT,te.NEAREST):xn?te.copyTexSubImage3D(pr,Qt,dr,Ur,rs+fs,or,rr,Sn,an):te.copyTexSubImage2D(pr,Qt,dr,Ur,or,rr,Sn,an);Oe.bindFramebuffer(te.READ_FRAMEBUFFER,null),Oe.bindFramebuffer(te.DRAW_FRAMEBUFFER,null)}else xn?Le.isDataTexture||Le.isData3DTexture?te.texSubImage3D(pr,Qt,dr,Ur,rs,Sn,an,Dn,Dr,Qn,Rr.data):mt.isCompressedArrayTexture?te.compressedTexSubImage3D(pr,Qt,dr,Ur,rs,Sn,an,Dn,Dr,Rr.data):te.texSubImage3D(pr,Qt,dr,Ur,rs,Sn,an,Dn,Dr,Qn,Rr):Le.isDataTexture?te.texSubImage2D(te.TEXTURE_2D,Qt,dr,Ur,Sn,an,Dr,Qn,Rr.data):Le.isCompressedTexture?te.compressedTexSubImage2D(te.TEXTURE_2D,Qt,dr,Ur,Rr.width,Rr.height,Dr,Rr.data):te.texSubImage2D(te.TEXTURE_2D,Qt,dr,Ur,Sn,an,Dr,Qn,Rr);te.pixelStorei(te.UNPACK_ROW_LENGTH,On),te.pixelStorei(te.UNPACK_IMAGE_HEIGHT,Fs),te.pixelStorei(te.UNPACK_SKIP_PIXELS,So),te.pixelStorei(te.UNPACK_SKIP_ROWS,js),te.pixelStorei(te.UNPACK_SKIP_IMAGES,Qo),Qt===0&&mt.generateMipmaps&&te.generateMipmap(pr),Oe.unbindTexture()},this.copyTextureToTexture3D=function(Le,mt,Ct=null,Ot=null,yt=0){return yC('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(Le,mt,Ct,Ot,yt)},this.initRenderTarget=function(Le){_e.get(Le).__webglFramebuffer===void 0&&we.setupRenderTarget(Le)},this.initTexture=function(Le){Le.isCubeTexture?we.setTextureCube(Le,0):Le.isData3DTexture?we.setTexture3D(Le,0):Le.isDataArrayTexture||Le.isCompressedArrayTexture?we.setTexture2DArray(Le,0):we.setTexture2D(Le,0),Oe.unbindTexture()},this.resetState=function(){k=0,R=0,P=null,Oe.reset(),Xe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Hg}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=zi._getDrawingBufferColorSpace(e),t.unpackColorSpace=zi._getUnpackColorSpace()}}var tI={exports:{}},nI={},rI={exports:{}},iI={};var HF;function rde(){if(HF)return iI;HF=1;var n=Fk();function e(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var t=typeof Object.is=="function"?Object.is:e,r=n.useState,i=n.useEffect,s=n.useLayoutEffect,o=n.useDebugValue;function a(h,f){var d=f(),p=r({inst:{value:d,getSnapshot:f}}),_=p[0].inst,g=p[1];return s(function(){_.value=d,_.getSnapshot=f,c(_)&&g({inst:_})},[h,d,f]),i(function(){return c(_)&&g({inst:_}),h(function(){c(_)&&g({inst:_})})},[h]),o(d),d}function c(h){var f=h.getSnapshot;h=h.value;try{var d=f();return!t(h,d)}catch{return!0}}function l(h,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?l:a;return iI.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:u,iI}var VF;function ide(){return VF||(VF=1,rI.exports=rde()),rI.exports}var GF;function sde(){if(GF)return nI;GF=1;var n=Fk(),e=ide();function t(l,u){return l===u&&(l!==0||1/l===1/u)||l!==l&&u!==u}var r=typeof Object.is=="function"?Object.is:t,i=e.useSyncExternalStore,s=n.useRef,o=n.useEffect,a=n.useMemo,c=n.useDebugValue;return nI.useSyncExternalStoreWithSelector=function(l,u,h,f,d){var p=s(null);if(p.current===null){var _={hasValue:!1,value:null};p.current=_}else _=p.current;p=a(function(){function m(k){if(!b){if(b=!0,y=k,k=f(k),d!==void 0&&_.hasValue){var R=_.value;if(d(R,k))return x=R}return x=k}if(R=x,r(y,k))return R;var P=f(k);return d!==void 0&&d(R,P)?(y=k,R):(y=k,x=P)}var b=!1,y,x,T=h===void 0?null:h;return[function(){return m(u())},T===null?void 0:function(){return m(T())}]},[u,h,f,d]);var g=i(l,p[0],p[1]);return o(function(){_.hasValue=!0,_.value=g},[g]),c(g),g},nI}var $F;function ode(){return $F||($F=1,tI.exports=sde()),tI.exports}var ade=ode();const cde=Dl(ade),WF=n=>{let e;const t=new Set,r=(l,u)=>{const h=typeof l=="function"?l(e):l;if(!Object.is(h,e)){const f=e;e=u??(typeof h!="object"||h===null)?h:Object.assign({},e,h),t.forEach(d=>d(e,f))}},i=()=>e,a={setState:r,getState:i,getInitialState:()=>c,subscribe:l=>(t.add(l),()=>t.delete(l))},c=e=n(r,i,a);return a},$k=n=>n?WF(n):WF,{useSyncExternalStoreWithSelector:lde}=cde,ude=n=>n;function hde(n,e=ude,t){const r=lde(n.subscribe,n.getState,n.getInitialState,e,t);return Tf.useDebugValue(r),r}const qF=(n,e)=>{const t=$k(n),r=(i,s=e)=>hde(t,i,s);return Object.assign(r,t),r},gW=(n,e)=>n?qF(n,e):qF,fde=n=>typeof n=="object"&&typeof n.then=="function",U1=[];function _W(n,e,t=(r,i)=>r===i){if(n===e)return!0;if(!n||!e)return!1;const r=n.length;if(e.length!==r)return!1;for(let i=0;i<r;i++)if(!t(n[i],e[i]))return!1;return!0}function vW(n,e=null,t=!1,r={}){e===null&&(e=[n]);for(const s of U1)if(_W(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!t)throw s.promise}const i={keys:e,equal:r.equal,remove:()=>{const s=U1.indexOf(i);s!==-1&&U1.splice(s,1)},promise:(fde(n)?n:n(...e)).then(s=>{i.response=s,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(s=>i.error=s)};if(U1.push(i),!t)throw i.promise}const yW=(n,e,t)=>vW(n,e,!1,t),dde=(n,e,t)=>void vW(n,e,!0,t),pde=n=>{if(n===void 0||n.length===0)U1.splice(0,U1.length);else{const e=U1.find(t=>_W(n,t.keys,t.equal));e&&e.remove()}};var sI={exports:{}},oI={exports:{}},aI={exports:{}},cI={};var YF;function mde(){return YF||(YF=1,(function(n){function e(Z,$){var Y=Z.length;Z.push($);e:for(;0<Y;){var Q=Y-1>>>1,q=Z[Q];if(0<i(q,$))Z[Q]=$,Z[Y]=q,Y=Q;else break e}}function t(Z){return Z.length===0?null:Z[0]}function r(Z){if(Z.length===0)return null;var $=Z[0],Y=Z.pop();if(Y!==$){Z[0]=Y;e:for(var Q=0,q=Z.length,V=q>>>1;Q<V;){var K=2*(Q+1)-1,ne=Z[K],ie=K+1,ae=Z[ie];if(0>i(ne,Y))ie<q&&0>i(ae,ne)?(Z[Q]=ae,Z[ie]=Y,Q=ie):(Z[Q]=ne,Z[K]=Y,Q=K);else if(ie<q&&0>i(ae,Y))Z[Q]=ae,Z[ie]=Y,Q=ie;else break e}}return $}function i(Z,$){var Y=Z.sortIndex-$.sortIndex;return Y!==0?Y:Z.id-$.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,h=null,f=3,d=!1,p=!1,_=!1,g=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;function y(Z){for(var $=t(l);$!==null;){if($.callback===null)r(l);else if($.startTime<=Z)r(l),$.sortIndex=$.expirationTime,e(c,$);else break;$=t(l)}}function x(Z){if(_=!1,y(Z),!p)if(t(c)!==null)p=!0,M();else{var $=t(l);$!==null&&F(x,$.startTime-Z)}}var T=!1,k=-1,R=5,P=-1;function B(){return!(n.unstable_now()-P<R)}function U(){if(T){var Z=n.unstable_now();P=Z;var $=!0;try{e:{p=!1,_&&(_=!1,m(k),k=-1),d=!0;var Y=f;try{t:{for(y(Z),h=t(c);h!==null&&!(h.expirationTime>Z&&B());){var Q=h.callback;if(typeof Q=="function"){h.callback=null,f=h.priorityLevel;var q=Q(h.expirationTime<=Z);if(Z=n.unstable_now(),typeof q=="function"){h.callback=q,y(Z),$=!0;break t}h===t(c)&&r(c),y(Z)}else r(c);h=t(c)}if(h!==null)$=!0;else{var V=t(l);V!==null&&F(x,V.startTime-Z),$=!1}}break e}finally{h=null,f=Y,d=!1}$=void 0}}finally{$?z():T=!1}}}var z;if(typeof b=="function")z=function(){b(U)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,L=I.port2;I.port1.onmessage=U,z=function(){L.postMessage(null)}}else z=function(){g(U,0)};function M(){T||(T=!0,z())}function F(Z,$){k=g(function(){Z(n.unstable_now())},$)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Z){Z.callback=null},n.unstable_continueExecution=function(){p||d||(p=!0,M())},n.unstable_forceFrameRate=function(Z){0>Z||125<Z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<Z?Math.floor(1e3/Z):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(Z){switch(f){case 1:case 2:case 3:var $=3;break;default:$=f}var Y=f;f=$;try{return Z()}finally{f=Y}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Z,$){switch(Z){case 1:case 2:case 3:case 4:case 5:break;default:Z=3}var Y=f;f=Z;try{return $()}finally{f=Y}},n.unstable_scheduleCallback=function(Z,$,Y){var Q=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?Q+Y:Q):Y=Q,Z){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=Y+q,Z={id:u++,callback:$,priorityLevel:Z,startTime:Y,expirationTime:q,sortIndex:-1},Y>Q?(Z.sortIndex=Y,e(l,Z),t(c)===null&&Z===t(l)&&(_?(m(k),k=-1):_=!0,F(x,Y-Q))):(Z.sortIndex=q,e(c,Z),p||d||(p=!0,M())),Z},n.unstable_shouldYield=B,n.unstable_wrapCallback=function(Z){var $=f;return function(){var Y=f;f=$;try{return Z.apply(this,arguments)}finally{f=Y}}}})(cI)),cI}var KF;function bW(){return KF||(KF=1,aI.exports=mde()),aI.exports}var XF;function gde(){return XF||(XF=1,(function(n){n.exports=function(e){function t(v,S,N,G){return new Wp(v,S,N,G)}function r(){}function i(v){var S="https://react.dev/errors/"+v;if(1<arguments.length){S+="?args[]="+encodeURIComponent(arguments[1]);for(var N=2;N<arguments.length;N++)S+="&args[]="+encodeURIComponent(arguments[N])}return"Minified React error #"+v+"; visit "+S+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(v){return v===null||typeof v!="object"?null:(v=Hl&&v[Hl]||v["@@iterator"],typeof v=="function"?v:null)}function o(v){if(v==null)return null;if(typeof v=="function")return v.$$typeof===G_?null:v.displayName||v.name||null;if(typeof v=="string")return v;switch(v){case hr:return"Fragment";case $f:return"Portal";case _l:return"Profiler";case aa:return"StrictMode";case Kp:return"Suspense";case pc:return"SuspenseList"}if(typeof v=="object")switch(v.$$typeof){case ms:return(v.displayName||"Context")+".Provider";case W0:return(v._context.displayName||"Context")+".Consumer";case sh:var S=v.render;return v=v.displayName,v||(v=S.displayName||S.name||"",v=v!==""?"ForwardRef("+v+")":"ForwardRef"),v;case $t:return S=v.displayName||null,S!==null?S:o(v.type)||"Memo";case $s:S=v._payload,v=v._init;try{return o(v(S))}catch{}}return null}function a(v){if(Vd===void 0)try{throw Error()}catch(N){var S=N.stack.trim().match(/\n( *(at )?)/);Vd=S&&S[1]||"",Ay=-1<N.stack.indexOf(`
    at`)?" (<anonymous>)":-1<N.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Vd+v+Ay}function c(v,S){if(!v||Wf)return"";Wf=!0;var N=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var G={DetermineComponentFrameRoot:function(){try{if(S){var E=function(){throw Error()};if(Object.defineProperty(E.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(E,[])}catch(O){var A=O}Reflect.construct(v,[],E)}else{try{E.call()}catch(O){A=O}v.call(E.prototype)}}else{try{throw Error()}catch(O){A=O}(E=v())&&typeof E.catch=="function"&&E.catch(function(){})}}catch(O){if(O&&A&&typeof O.stack=="string")return[O.stack,A.stack]}return[null,null]}};G.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var oe=Object.getOwnPropertyDescriptor(G.DetermineComponentFrameRoot,"name");oe&&oe.configurable&&Object.defineProperty(G.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var me=G.DetermineComponentFrameRoot(),He=me[0],ht=me[1];if(He&&ht){var Tt=He.split(`
`),qt=ht.split(`
`);for(oe=G=0;G<Tt.length&&!Tt[G].includes("DetermineComponentFrameRoot");)G++;for(;oe<qt.length&&!qt[oe].includes("DetermineComponentFrameRoot");)oe++;if(G===Tt.length||oe===qt.length)for(G=Tt.length-1,oe=qt.length-1;1<=G&&0<=oe&&Tt[G]!==qt[oe];)oe--;for(;1<=G&&0<=oe;G--,oe--)if(Tt[G]!==qt[oe]){if(G!==1||oe!==1)do if(G--,oe--,0>oe||Tt[G]!==qt[oe]){var C=`
`+Tt[G].replace(" at new "," at ");return v.displayName&&C.includes("<anonymous>")&&(C=C.replace("<anonymous>",v.displayName)),C}while(1<=G&&0<=oe);break}}}finally{Wf=!1,Error.prepareStackTrace=N}return(N=v?v.displayName||v.name:"")?a(N):""}function l(v){switch(v.tag){case 26:case 27:case 5:return a(v.type);case 16:return a("Lazy");case 13:return a("Suspense");case 19:return a("SuspenseList");case 0:case 15:return v=c(v.type,!1),v;case 11:return v=c(v.type.render,!1),v;case 1:return v=c(v.type,!0),v;default:return""}}function u(v){try{var S="";do S+=l(v),v=v.return;while(v);return S}catch(N){return`
Error generating stack: `+N.message+`
`+N.stack}}function h(v){var S=v,N=v;if(v.alternate)for(;S.return;)S=S.return;else{v=S;do S=v,(S.flags&4098)!==0&&(N=S.return),v=S.return;while(v)}return S.tag===3?N:null}function f(v){if(h(v)!==v)throw Error(i(188))}function d(v){var S=v.alternate;if(!S){if(S=h(v),S===null)throw Error(i(188));return S!==v?null:v}for(var N=v,G=S;;){var oe=N.return;if(oe===null)break;var me=oe.alternate;if(me===null){if(G=oe.return,G!==null){N=G;continue}break}if(oe.child===me.child){for(me=oe.child;me;){if(me===N)return f(oe),v;if(me===G)return f(oe),S;me=me.sibling}throw Error(i(188))}if(N.return!==G.return)N=oe,G=me;else{for(var He=!1,ht=oe.child;ht;){if(ht===N){He=!0,N=oe,G=me;break}if(ht===G){He=!0,G=oe,N=me;break}ht=ht.sibling}if(!He){for(ht=me.child;ht;){if(ht===N){He=!0,N=me,G=oe;break}if(ht===G){He=!0,G=me,N=oe;break}ht=ht.sibling}if(!He)throw Error(i(189))}}if(N.alternate!==G)throw Error(i(190))}if(N.tag!==3)throw Error(i(188));return N.stateNode.current===N?v:S}function p(v){var S=v.tag;if(S===5||S===26||S===27||S===6)return v;for(v=v.child;v!==null;){if(S=p(v),S!==null)return S;v=v.sibling}return null}function _(v){var S=v.tag;if(S===5||S===26||S===27||S===6)return v;for(v=v.child;v!==null;){if(v.tag!==4&&(S=_(v),S!==null))return S;v=v.sibling}return null}function g(v){return{current:v}}function m(v){0>Xd||(v.current=rg[Xd],rg[Xd]=null,Xd--)}function b(v,S){Xd++,rg[Xd]=v.current,v.current=S}function y(v){return v>>>=0,v===0?32:31-(la(v)/ig|0)|0}function x(v){var S=v&42;if(S!==0)return S;switch(v&-v){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return v&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return v}}function T(v,S){var N=v.pendingLanes;if(N===0)return 0;var G=0,oe=v.suspendedLanes,me=v.pingedLanes,He=v.warmLanes;v=v.finishedLanes!==0;var ht=N&134217727;return ht!==0?(N=ht&~oe,N!==0?G=x(N):(me&=ht,me!==0?G=x(me):v||(He=ht&~He,He!==0&&(G=x(He))))):(ht=N&~oe,ht!==0?G=x(ht):me!==0?G=x(me):v||(He=N&~He,He!==0&&(G=x(He)))),G===0?0:S!==0&&S!==G&&(S&oe)===0&&(oe=G&-G,He=S&-S,oe>=He||oe===32&&(He&4194176)!==0)?S:G}function k(v,S){return(v.pendingLanes&~(v.suspendedLanes&~v.pingedLanes)&S)===0}function R(v,S){switch(v){case 1:case 2:case 4:case 8:return S+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return S+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function P(){var v=sg;return sg<<=1,(sg&4194176)===0&&(sg=128),v}function B(){var v=og;return og<<=1,(og&62914560)===0&&(og=4194304),v}function U(v){for(var S=[],N=0;31>N;N++)S.push(v);return S}function z(v,S){v.pendingLanes|=S,S!==268435456&&(v.suspendedLanes=0,v.pingedLanes=0,v.warmLanes=0)}function I(v,S,N,G,oe,me){var He=v.pendingLanes;v.pendingLanes=N,v.suspendedLanes=0,v.pingedLanes=0,v.warmLanes=0,v.expiredLanes&=N,v.entangledLanes&=N,v.errorRecoveryDisabledLanes&=N,v.shellSuspendCounter=0;var ht=v.entanglements,Tt=v.expirationTimes,qt=v.hiddenUpdates;for(N=He&~N;0<N;){var C=31-Ma(N),E=1<<C;ht[C]=0,Tt[C]=-1;var A=qt[C];if(A!==null)for(qt[C]=null,C=0;C<A.length;C++){var O=A[C];O!==null&&(O.lane&=-536870913)}N&=~E}G!==0&&L(v,G,0),me!==0&&oe===0&&v.tag!==0&&(v.suspendedLanes|=me&~(He&~S))}function L(v,S,N){v.pendingLanes|=S,v.suspendedLanes&=~S;var G=31-Ma(S);v.entangledLanes|=S,v.entanglements[G]=v.entanglements[G]|1073741824|N&4194218}function M(v,S){var N=v.entangledLanes|=S;for(v=v.entanglements;N;){var G=31-Ma(N),oe=1<<G;oe&S|v[G]&S&&(v[G]|=S),N&=~oe}}function F(v){return v&=-v,2<v?8<v?(v&134217727)!==0?32:268435456:8:2}function Z(v){if(Xa&&typeof Xa.onCommitFiberRoot=="function")try{Xa.onCommitFiberRoot(vc,v,void 0,(v.current.flags&128)===128)}catch{}}function $(v){if(typeof bT=="function"&&Yy(v),Xa&&typeof Xa.setStrictMode=="function")try{Xa.setStrictMode(vc,v)}catch{}}function Y(v,S){return v===S&&(v!==0||1/v===1/S)||v!==v&&S!==S}function Q(v,S){if(typeof v=="object"&&v!==null){var N=os.get(v);return N!==void 0?N:(S={value:v,source:S,stack:u(S)},os.set(v,S),S)}return{value:v,source:S,stack:u(S)}}function q(v,S){Ki[Zd++]=sf,Ki[Zd++]=cg,cg=v,sf=S}function V(v,S,N){Wc[Za++]=ao,Wc[Za++]=ua,Wc[Za++]=dh,dh=v;var G=ao;v=ua;var oe=32-Ma(G)-1;G&=~(1<<oe),N+=1;var me=32-Ma(S)+oe;if(30<me){var He=oe-oe%5;me=(G&(1<<He)-1).toString(32),G>>=He,oe-=He,ao=1<<32-Ma(S)+oe|N<<oe|G,ua=me+v}else ao=1<<me|N<<oe|G,ua=v}function K(v){v.return!==null&&(q(v,1),V(v,1,0))}function ne(v){for(;v===cg;)cg=Ki[--Zd],Ki[Zd]=null,sf=Ki[--Zd],Ki[Zd]=null;for(;v===dh;)dh=Wc[--Za],Wc[Za]=null,ua=Wc[--Za],Wc[Za]=null,ao=Wc[--Za],Wc[Za]=null}function ie(v,S){b(of,S),b(sm,v),b(Co,null),v=qf(S),m(Co),b(Co,v)}function ae(){m(Co),m(sm),m(of)}function Te(v){v.memoizedState!==null&&b($l,v);var S=Co.current,N=$_(S,v.type);S!==N&&(b(sm,v),b(Co,N))}function Ie(v){sm.current===v&&(m(Co),m(sm)),$l.current===v&&(m($l),Vc?Sl._currentValue=ss:Sl._currentValue2=ss)}function be(v){var S=Error(i(418,""));throw ut(Q(S,v)),Ky}function Pe(v,S){if(!Gc)throw Error(i(175));mT(v.stateNode,v.type,v.memoizedProps,S,v)||be(v)}function $e(v){for(ir=v.return;ir;)switch(ir.tag){case 3:case 27:Xr=!0;return;case 5:case 13:Xr=!1;return;default:ir=ir.return}}function tt(v){if(!Gc||v!==ir)return!1;if(!Lr)return $e(v),Lr=!0,!1;var S=!1;if(Ro?v.tag!==3&&v.tag!==27&&(v.tag!==5||nm(v.type)&&!Zp(v.type,v.memoizedProps))&&(S=!0):v.tag!==3&&(v.tag!==5||nm(v.type)&&!Zp(v.type,v.memoizedProps))&&(S=!0),S&&Oa&&be(v),$e(v),v.tag===13){if(!Gc)throw Error(i(316));if(v=v.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(i(317));Oa=Gy(v)}else Oa=ir?jy(v.stateNode):null;return!0}function qe(){Gc&&(Oa=ir=null,Lr=!1)}function ut(v){Wl===null?Wl=[v]:Wl.push(v)}function te(){for(var v=ph,S=Xy=ph=0;S<v;){var N=El[S];El[S++]=null;var G=El[S];El[S++]=null;var oe=El[S];El[S++]=null;var me=El[S];if(El[S++]=null,G!==null&&oe!==null){var He=G.pending;He===null?oe.next=oe:(oe.next=He.next,He.next=oe),G.pending=oe}me!==0&&Oe(N,oe,me)}}function Ne(v,S,N,G){El[ph++]=v,El[ph++]=S,El[ph++]=N,El[ph++]=G,Xy|=G,v.lanes|=G,v=v.alternate,v!==null&&(v.lanes|=G)}function Be(v,S,N,G){return Ne(v,S,N,G),ue(v)}function De(v,S){return Ne(v,null,null,S),ue(v)}function Oe(v,S,N){v.lanes|=N;var G=v.alternate;G!==null&&(G.lanes|=N);for(var oe=!1,me=v.return;me!==null;)me.childLanes|=N,G=me.alternate,G!==null&&(G.childLanes|=N),me.tag===22&&(v=me.stateNode,v===null||v._visibility&1||(oe=!0)),v=me,me=me.return;oe&&S!==null&&v.tag===3&&(me=v.stateNode,oe=31-Ma(N),me=me.hiddenUpdates,v=me[oe],v===null?me[oe]=[S]:v.push(S),S.lane=N|536870912)}function ue(v){if(50<Vo)throw Vo=0,Kc=null,Error(i(185));for(var S=v.return;S!==null;)v=S,S=v.return;return v.tag===3?v.stateNode:null}function _e(v){v!==om&&v.next===null&&(om===null?rv=om=v:om=om.next=v),am=!0,Zy||(Zy=!0,nt(pe))}function we(v,S){if(!lg&&am){lg=!0;do for(var N=!1,G=rv;G!==null;){if(v!==0){var oe=G.pendingLanes;if(oe===0)var me=0;else{var He=G.suspendedLanes,ht=G.pingedLanes;me=(1<<31-Ma(42|v)+1)-1,me&=oe&~(He&~ht),me=me&201326677?me&201326677|1:me?me|2:0}me!==0&&(N=!0,Je(G,me))}else me=Gn,me=T(G,G===Cn?me:0),(me&3)===0||k(G,me)||(N=!0,Je(G,me));G=G.next}while(N);lg=!1}}function pe(){am=Zy=!1;var v=0;cm!==0&&(Oy()&&(v=cm),cm=0);for(var S=cr(),N=null,G=rv;G!==null;){var oe=G.next,me=ze(G,S);me===0?(G.next=null,N===null?rv=oe:N.next=oe,oe===null&&(om=N)):(N=G,(v!==0||(me&3)!==0)&&(am=!0)),G=oe}we(v)}function ze(v,S){for(var N=v.suspendedLanes,G=v.pingedLanes,oe=v.expirationTimes,me=v.pendingLanes&-62914561;0<me;){var He=31-Ma(me),ht=1<<He,Tt=oe[He];Tt===-1?((ht&N)===0||(ht&G)!==0)&&(oe[He]=R(ht,S)):Tt<=S&&(v.expiredLanes|=ht),me&=~ht}if(S=Cn,N=Gn,N=T(v,v===S?N:0),G=v.callbackNode,N===0||v===S&&bn===2||v.cancelPendingCommit!==null)return G!==null&&G!==null&&ag(G),v.callbackNode=null,v.callbackPriority=0;if((N&3)===0||k(v,N)){if(S=N&-N,S===v.callbackPriority)return S;switch(G!==null&&ag(G),F(N)){case 2:case 8:N=$c;break;case 32:N=Ps;break;case 268435456:N=Jf;break;default:N=Ps}return G=Ze.bind(null,v),N=_c(N,G),v.callbackPriority=S,v.callbackNode=N,S}return G!==null&&G!==null&&ag(G),v.callbackPriority=2,v.callbackNode=null,2}function Ze(v,S){var N=v.callbackNode;if(Hc()&&v.callbackNode!==N)return null;var G=Gn;return G=T(v,v===Cn?G:0),G===0?null:(ml(v,G,S),ze(v,cr()),v.callbackNode!=null&&v.callbackNode===N?Ze.bind(null,v):null)}function Je(v,S){if(Hc())return null;ml(v,S,!0)}function nt(v){K_?ah(function(){(Jt&6)!==0?_c(bS,v):v()}):_c(bS,v)}function Pt(){return cm===0&&(cm=P()),cm}function vt(v,S){if(ug===null){var N=ug=[];Jy=0,xs=Pt(),Ws={status:"pending",value:void 0,then:function(G){N.push(G)}}}return Jy++,S.then(At,At),S}function At(){if(--Jy===0&&ug!==null){Ws!==null&&(Ws.status="fulfilled");var v=ug;ug=null,xs=0,Ws=null;for(var S=0;S<v.length;S++)(0,v[S])()}}function Re(v,S){var N=[],G={status:"pending",value:null,reason:null,then:function(oe){N.push(oe)}};return v.then(function(){G.status="fulfilled",G.value=S;for(var oe=0;oe<N.length;oe++)(0,N[oe])(S)},function(oe){for(G.status="rejected",G.reason=oe,oe=0;oe<N.length;oe++)(0,N[oe])(void 0)}),G}function ce(v){v.updateQueue={baseState:v.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function W(v,S){v=v.updateQueue,S.updateQueue===v&&(S.updateQueue={baseState:v.baseState,firstBaseUpdate:v.firstBaseUpdate,lastBaseUpdate:v.lastBaseUpdate,shared:v.shared,callbacks:null})}function le(v){return{lane:v,tag:0,payload:null,callback:null,next:null}}function Se(v,S,N){var G=v.updateQueue;if(G===null)return null;if(G=G.shared,(Jt&2)!==0){var oe=G.pending;return oe===null?S.next=S:(S.next=oe.next,oe.next=S),G.pending=S,S=ue(v),Oe(v,null,N),S}return Ne(v,G,S,N),ue(v)}function Ae(v,S,N){if(S=S.updateQueue,S!==null&&(S=S.shared,(N&4194176)!==0)){var G=S.lanes;G&=v.pendingLanes,N|=G,S.lanes=N,M(v,N)}}function ye(v,S){var N=v.updateQueue,G=v.alternate;if(G!==null&&(G=G.updateQueue,N===G)){var oe=null,me=null;if(N=N.firstBaseUpdate,N!==null){do{var He={lane:N.lane,tag:N.tag,payload:N.payload,callback:null,next:null};me===null?oe=me=He:me=me.next=He,N=N.next}while(N!==null);me===null?oe=me=S:me=me.next=S}else oe=me=S;N={baseState:G.baseState,firstBaseUpdate:oe,lastBaseUpdate:me,shared:G.shared,callbacks:G.callbacks},v.updateQueue=N;return}v=N.lastBaseUpdate,v===null?N.firstBaseUpdate=S:v.next=S,N.lastBaseUpdate=S}function ve(){if(yc){var v=Ws;if(v!==null)throw v}}function Xe(v,S,N,G){yc=!1;var oe=v.updateQueue;co=!1;var me=oe.firstBaseUpdate,He=oe.lastBaseUpdate,ht=oe.shared.pending;if(ht!==null){oe.shared.pending=null;var Tt=ht,qt=Tt.next;Tt.next=null,He===null?me=qt:He.next=qt,He=Tt;var C=v.alternate;C!==null&&(C=C.updateQueue,ht=C.lastBaseUpdate,ht!==He&&(ht===null?C.firstBaseUpdate=qt:ht.next=qt,C.lastBaseUpdate=Tt))}if(me!==null){var E=oe.baseState;He=0,C=qt=Tt=null,ht=me;do{var A=ht.lane&-536870913,O=A!==ht.lane;if(O?(Gn&A)===A:(G&A)===A){A!==0&&A===xs&&(yc=!0),C!==null&&(C=C.next={lane:0,tag:ht.tag,payload:ht.payload,callback:null,next:null});e:{var j=v,H=ht;A=S;var X=N;switch(H.tag){case 1:if(j=H.payload,typeof j=="function"){E=j.call(X,E,A);break e}E=j;break e;case 3:j.flags=j.flags&-65537|128;case 0:if(j=H.payload,A=typeof j=="function"?j.call(X,E,A):j,A==null)break e;E=oa({},E,A);break e;case 2:co=!0}}A=ht.callback,A!==null&&(v.flags|=64,O&&(v.flags|=8192),O=oe.callbacks,O===null?oe.callbacks=[A]:O.push(A))}else O={lane:A,tag:ht.tag,payload:ht.payload,callback:ht.callback,next:null},C===null?(qt=C=O,Tt=E):C=C.next=O,He|=A;if(ht=ht.next,ht===null){if(ht=oe.shared.pending,ht===null)break;O=ht,ht=O.next,O.next=null,oe.lastBaseUpdate=O,oe.shared.pending=null}}while(!0);C===null&&(Tt=E),oe.baseState=Tt,oe.firstBaseUpdate=qt,oe.lastBaseUpdate=C,me===null&&(oe.shared.lanes=0),da|=He,v.lanes=He,v.memoizedState=E}}function Me(v,S){if(typeof v!="function")throw Error(i(191,v));v.call(S)}function Ve(v,S){var N=v.callbacks;if(N!==null)for(v.callbacks=null,v=0;v<N.length;v++)Me(N[v],S)}function je(v,S){if(ka(v,S))return!0;if(typeof v!="object"||v===null||typeof S!="object"||S===null)return!1;var N=Object.keys(v),G=Object.keys(S);if(N.length!==G.length)return!1;for(G=0;G<N.length;G++){var oe=N[G];if(!Xi.call(S,oe)||!ka(v[oe],S[oe]))return!1}return!0}function We(v){return v=v.status,v==="fulfilled"||v==="rejected"}function ct(){}function Fe(v,S,N){switch(N=v[N],N===void 0?v.push(S):N!==S&&(S.then(ct,ct),S=N),S.status){case"fulfilled":return S.value;case"rejected":throw v=S.reason,v===hg?Error(i(483)):v;default:if(typeof S.status=="string")S.then(ct,ct);else{if(v=Cn,v!==null&&100<v.shellSuspendCounter)throw Error(i(482));v=S,v.status="pending",v.then(function(G){if(S.status==="pending"){var oe=S;oe.status="fulfilled",oe.value=G}},function(G){if(S.status==="pending"){var oe=S;oe.status="rejected",oe.reason=G}})}switch(S.status){case"fulfilled":return S.value;case"rejected":throw v=S.reason,v===hg?Error(i(483)):v}throw Qf=S,hg}}function rt(){if(Qf===null)throw Error(i(459));var v=Qf;return Qf=null,v}function it(v){var S=pg;return pg+=1,ql===null&&(ql=[]),Fe(ql,v,S)}function St(v,S){S=S.props.ref,v.ref=S!==void 0?S:null}function at(v,S){throw S.$$typeof===$0?Error(i(525)):(v=Object.prototype.toString.call(S),Error(i(31,v==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":v)))}function Yt(v){var S=v._init;return S(v._payload)}function sn(v){function S(re,se){if(v){var ee=re.deletions;ee===null?(re.deletions=[se],re.flags|=16):ee.push(se)}}function N(re,se){if(!v)return null;for(;se!==null;)S(re,se),se=se.sibling;return null}function G(re){for(var se=new Map;re!==null;)re.key!==null?se.set(re.key,re):se.set(re.index,re),re=re.sibling;return se}function oe(re,se){return re=ih(re,se),re.index=0,re.sibling=null,re}function me(re,se,ee){return re.index=ee,v?(ee=re.alternate,ee!==null?(ee=ee.index,ee<se?(re.flags|=33554434,se):ee):(re.flags|=33554434,se)):(re.flags|=1048576,se)}function He(re){return v&&re.alternate===null&&(re.flags|=33554434),re}function ht(re,se,ee,he){return se===null||se.tag!==6?(se=zd(ee,re.mode,he),se.return=re,se):(se=oe(se,ee),se.return=re,se)}function Tt(re,se,ee,he){var Ee=ee.type;return Ee===hr?C(re,se,ee.props.children,he,ee.key):se!==null&&(se.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===$s&&Yt(Ee)===se.type)?(se=oe(se,ee.props),St(se,ee),se.return=re,se):(se=qp(ee.type,ee.key,ee.props,null,re.mode,he),St(se,ee),se.return=re,se)}function qt(re,se,ee,he){return se===null||se.tag!==4||se.stateNode.containerInfo!==ee.containerInfo||se.stateNode.implementation!==ee.implementation?(se=V0(ee,re.mode,he),se.return=re,se):(se=oe(se,ee.children||[]),se.return=re,se)}function C(re,se,ee,he,Ee){return se===null||se.tag!==7?(se=Su(ee,re.mode,he,Ee),se.return=re,se):(se=oe(se,ee),se.return=re,se)}function E(re,se,ee){if(typeof se=="string"&&se!==""||typeof se=="number"||typeof se=="bigint")return se=zd(""+se,re.mode,ee),se.return=re,se;if(typeof se=="object"&&se!==null){switch(se.$$typeof){case dc:return ee=qp(se.type,se.key,se.props,null,re.mode,ee),St(ee,se),ee.return=re,ee;case $f:return se=V0(se,re.mode,ee),se.return=re,se;case $s:var he=se._init;return se=he(se._payload),E(re,se,ee)}if(Xp(se)||s(se))return se=Su(se,re.mode,ee,null),se.return=re,se;if(typeof se.then=="function")return E(re,it(se),ee);if(se.$$typeof===ms)return E(re,Ti(re,se),ee);at(re,se)}return null}function A(re,se,ee,he){var Ee=se!==null?se.key:null;if(typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint")return Ee!==null?null:ht(re,se,""+ee,he);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case dc:return ee.key===Ee?Tt(re,se,ee,he):null;case $f:return ee.key===Ee?qt(re,se,ee,he):null;case $s:return Ee=ee._init,ee=Ee(ee._payload),A(re,se,ee,he)}if(Xp(ee)||s(ee))return Ee!==null?null:C(re,se,ee,he,null);if(typeof ee.then=="function")return A(re,se,it(ee),he);if(ee.$$typeof===ms)return A(re,se,Ti(re,ee),he);at(re,ee)}return null}function O(re,se,ee,he,Ee){if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return re=re.get(ee)||null,ht(se,re,""+he,Ee);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case dc:return re=re.get(he.key===null?ee:he.key)||null,Tt(se,re,he,Ee);case $f:return re=re.get(he.key===null?ee:he.key)||null,qt(se,re,he,Ee);case $s:var Ce=he._init;return he=Ce(he._payload),O(re,se,ee,he,Ee)}if(Xp(he)||s(he))return re=re.get(ee)||null,C(se,re,he,Ee,null);if(typeof he.then=="function")return O(re,se,ee,it(he),Ee);if(he.$$typeof===ms)return O(re,se,ee,Ti(se,he),Ee);at(se,he)}return null}function j(re,se,ee,he){for(var Ee=null,Ce=null,Ye=se,gt=se=0,ft=null;Ye!==null&&gt<ee.length;gt++){Ye.index>gt?(ft=Ye,Ye=null):ft=Ye.sibling;var lt=A(re,Ye,ee[gt],he);if(lt===null){Ye===null&&(Ye=ft);break}v&&Ye&&lt.alternate===null&&S(re,Ye),se=me(lt,se,gt),Ce===null?Ee=lt:Ce.sibling=lt,Ce=lt,Ye=ft}if(gt===ee.length)return N(re,Ye),Lr&&q(re,gt),Ee;if(Ye===null){for(;gt<ee.length;gt++)Ye=E(re,ee[gt],he),Ye!==null&&(se=me(Ye,se,gt),Ce===null?Ee=Ye:Ce.sibling=Ye,Ce=Ye);return Lr&&q(re,gt),Ee}for(Ye=G(Ye);gt<ee.length;gt++)ft=O(Ye,re,gt,ee[gt],he),ft!==null&&(v&&ft.alternate!==null&&Ye.delete(ft.key===null?gt:ft.key),se=me(ft,se,gt),Ce===null?Ee=ft:Ce.sibling=ft,Ce=ft);return v&&Ye.forEach(function(et){return S(re,et)}),Lr&&q(re,gt),Ee}function H(re,se,ee,he){if(ee==null)throw Error(i(151));for(var Ee=null,Ce=null,Ye=se,gt=se=0,ft=null,lt=ee.next();Ye!==null&&!lt.done;gt++,lt=ee.next()){Ye.index>gt?(ft=Ye,Ye=null):ft=Ye.sibling;var et=A(re,Ye,lt.value,he);if(et===null){Ye===null&&(Ye=ft);break}v&&Ye&&et.alternate===null&&S(re,Ye),se=me(et,se,gt),Ce===null?Ee=et:Ce.sibling=et,Ce=et,Ye=ft}if(lt.done)return N(re,Ye),Lr&&q(re,gt),Ee;if(Ye===null){for(;!lt.done;gt++,lt=ee.next())lt=E(re,lt.value,he),lt!==null&&(se=me(lt,se,gt),Ce===null?Ee=lt:Ce.sibling=lt,Ce=lt);return Lr&&q(re,gt),Ee}for(Ye=G(Ye);!lt.done;gt++,lt=ee.next())lt=O(Ye,re,gt,lt.value,he),lt!==null&&(v&&lt.alternate!==null&&Ye.delete(lt.key===null?gt:lt.key),se=me(lt,se,gt),Ce===null?Ee=lt:Ce.sibling=lt,Ce=lt);return v&&Ye.forEach(function(ot){return S(re,ot)}),Lr&&q(re,gt),Ee}function X(re,se,ee,he){if(typeof ee=="object"&&ee!==null&&ee.type===hr&&ee.key===null&&(ee=ee.props.children),typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case dc:e:{for(var Ee=ee.key;se!==null;){if(se.key===Ee){if(Ee=ee.type,Ee===hr){if(se.tag===7){N(re,se.sibling),he=oe(se,ee.props.children),he.return=re,re=he;break e}}else if(se.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===$s&&Yt(Ee)===se.type){N(re,se.sibling),he=oe(se,ee.props),St(he,ee),he.return=re,re=he;break e}N(re,se);break}else S(re,se);se=se.sibling}ee.type===hr?(he=Su(ee.props.children,re.mode,he,ee.key),he.return=re,re=he):(he=qp(ee.type,ee.key,ee.props,null,re.mode,he),St(he,ee),he.return=re,re=he)}return He(re);case $f:e:{for(Ee=ee.key;se!==null;){if(se.key===Ee)if(se.tag===4&&se.stateNode.containerInfo===ee.containerInfo&&se.stateNode.implementation===ee.implementation){N(re,se.sibling),he=oe(se,ee.children||[]),he.return=re,re=he;break e}else{N(re,se);break}else S(re,se);se=se.sibling}he=V0(ee,re.mode,he),he.return=re,re=he}return He(re);case $s:return Ee=ee._init,ee=Ee(ee._payload),X(re,se,ee,he)}if(Xp(ee))return j(re,se,ee,he);if(s(ee)){if(Ee=s(ee),typeof Ee!="function")throw Error(i(150));return ee=Ee.call(ee),H(re,se,ee,he)}if(typeof ee.then=="function")return X(re,se,it(ee),he);if(ee.$$typeof===ms)return X(re,se,Ti(re,ee),he);at(re,ee)}return typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint"?(ee=""+ee,se!==null&&se.tag===6?(N(re,se.sibling),he=oe(se,ee),he.return=re,re=he):(N(re,se),he=zd(ee,re.mode,he),he.return=re,re=he),He(re)):N(re,se)}return function(re,se,ee,he){try{pg=0;var Ee=X(re,se,ee,he);return ql=null,Ee}catch(Ye){if(Ye===hg)throw Ye;var Ce=t(29,Ye,null,re.mode);return Ce.lanes=he,Ce.return=re,Ce}finally{}}}function Rt(v,S){v=Ei,b(iv,v),b(lm,S),Ei=v|S.baseLanes}function Ut(){b(iv,Ei),b(lm,lm.current)}function _t(){Ei=iv.current,m(lm),m(iv)}function Ht(v){var S=v.alternate;b(vi,vi.current&1),b(Yl,v),Kl===null&&(S===null||lm.current!==null||S.memoizedState!==null)&&(Kl=v)}function _n(v){if(v.tag===22){if(b(vi,vi.current),b(Yl,v),Kl===null){var S=v.alternate;S!==null&&S.memoizedState!==null&&(Kl=v)}}else jt()}function jt(){b(vi,vi.current),b(Yl,Yl.current)}function mn(v){m(Yl),Kl===v&&(Kl=null),m(vi)}function Rn(v){for(var S=v;S!==null;){if(S.tag===13){var N=S.memoizedState;if(N!==null&&(N=N.dehydrated,N===null||tm(N)||Z_(N)))return S}else if(S.tag===19&&S.memoizedProps.revealOrder!==void 0){if((S.flags&128)!==0)return S}else if(S.child!==null){S.child.return=S,S=S.child;continue}if(S===v)break;for(;S.sibling===null;){if(S.return===null||S.return===v)return null;S=S.return}S.sibling.return=S.return,S=S.sibling}return null}function Un(){throw Error(i(321))}function qi(v,S){if(S===null)return!1;for(var N=0;N<S.length&&N<v.length;N++)if(!ka(v[N],S[N]))return!1;return!0}function oi(v,S,N,G,oe,me){return af=me,Fr=S,S.memoizedState=null,S.updateQueue=null,S.lanes=0,yr.H=v===null||v.memoizedState===null?xl:lf,nd=!1,me=N(G,oe),nd=!1,td&&(me=ys(S,N,G,oe)),_i(v),me}function _i(v){yr.H=Fi;var S=Bi!==null&&Bi.next!==null;if(af=0,gs=Bi=Fr=null,ha=!1,Ni=0,cf=null,S)throw Error(i(300));v===null||qs||(v=v.dependencies,v!==null&&Zh(v)&&(qs=!0))}function ys(v,S,N,G){Fr=v;var oe=0;do{if(td&&(cf=null),Ni=0,td=!1,25<=oe)throw Error(i(301));if(oe+=1,gs=Bi=null,v.updateQueue!=null){var me=v.updateQueue;me.lastEffect=null,me.events=null,me.stores=null,me.memoCache!=null&&(me.memoCache.index=0)}yr.H=rd,me=S(N,G)}while(td);return me}function Is(){var v=yr.H,S=v.useState()[0];return S=typeof S.then=="function"?Ct(S):S,v=v.useState()[0],(Bi!==null?Bi.memoizedState:null)!==v&&(Fr.flags|=1024),S}function Ui(){var v=mg!==0;return mg=0,v}function us(v,S,N){S.updateQueue=v.updateQueue,S.flags&=-2053,v.lanes&=~N}function hs(v){if(ha){for(v=v.memoizedState;v!==null;){var S=v.queue;S!==null&&(S.pending=null),v=v.next}ha=!1}af=0,gs=Bi=Fr=null,td=!1,Ni=mg=0,cf=null}function Le(){var v={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gs===null?Fr.memoizedState=gs=v:gs=gs.next=v,gs}function mt(){if(Bi===null){var v=Fr.alternate;v=v!==null?v.memoizedState:null}else v=Bi.next;var S=gs===null?Fr.memoizedState:gs.next;if(S!==null)gs=S,Bi=v;else{if(v===null)throw Fr.alternate===null?Error(i(467)):Error(i(310));Bi=v,v={memoizedState:Bi.memoizedState,baseState:Bi.baseState,baseQueue:Bi.baseQueue,queue:Bi.queue,next:null},gs===null?Fr.memoizedState=gs=v:gs=gs.next=v}return gs}function Ct(v){var S=Ni;return Ni+=1,cf===null&&(cf=[]),v=Fe(cf,v,S),S=Fr,(gs===null?S.memoizedState:gs.next)===null&&(S=S.alternate,yr.H=S===null||S.memoizedState===null?xl:lf),v}function Ot(v){if(v!==null&&typeof v=="object"){if(typeof v.then=="function")return Ct(v);if(v.$$typeof===ms)return Uo(v)}throw Error(i(438,String(v)))}function yt(v){var S=null,N=Fr.updateQueue;if(N!==null&&(S=N.memoCache),S==null){var G=Fr.alternate;G!==null&&(G=G.updateQueue,G!==null&&(G=G.memoCache,G!=null&&(S={data:G.data.map(function(oe){return oe.slice()}),index:0})))}if(S==null&&(S={data:[],index:0}),N===null&&(N=e1(),Fr.updateQueue=N),N.memoCache=S,N=S.data[S.index],N===void 0)for(N=S.data[S.index]=Array(v),G=0;G<v;G++)N[G]=V_;return S.index++,N}function Qt(v,S){return typeof S=="function"?S(v):S}function Sn(v){var S=mt();return an(S,Bi,v)}function an(v,S,N){var G=v.queue;if(G===null)throw Error(i(311));G.lastRenderedReducer=N;var oe=v.baseQueue,me=G.pending;if(me!==null){if(oe!==null){var He=oe.next;oe.next=me.next,me.next=He}S.baseQueue=oe=me,G.pending=null}if(me=v.baseState,oe===null)v.memoizedState=me;else{S=oe.next;var ht=He=null,Tt=null,qt=S,C=!1;do{var E=qt.lane&-536870913;if(E!==qt.lane?(Gn&E)===E:(af&E)===E){var A=qt.revertLane;if(A===0)Tt!==null&&(Tt=Tt.next={lane:0,revertLane:0,action:qt.action,hasEagerState:qt.hasEagerState,eagerState:qt.eagerState,next:null}),E===xs&&(C=!0);else if((af&A)===A){qt=qt.next,A===xs&&(C=!0);continue}else E={lane:0,revertLane:qt.revertLane,action:qt.action,hasEagerState:qt.hasEagerState,eagerState:qt.eagerState,next:null},Tt===null?(ht=Tt=E,He=me):Tt=Tt.next=E,Fr.lanes|=A,da|=A;E=qt.action,nd&&N(me,E),me=qt.hasEagerState?qt.eagerState:N(me,E)}else A={lane:E,revertLane:qt.revertLane,action:qt.action,hasEagerState:qt.hasEagerState,eagerState:qt.eagerState,next:null},Tt===null?(ht=Tt=A,He=me):Tt=Tt.next=A,Fr.lanes|=E,da|=E;qt=qt.next}while(qt!==null&&qt!==S);if(Tt===null?He=me:Tt.next=ht,!ka(me,v.memoizedState)&&(qs=!0,C&&(N=Ws,N!==null)))throw N;v.memoizedState=me,v.baseState=He,v.baseQueue=Tt,G.lastRenderedState=me}return oe===null&&(G.lanes=0),[v.memoizedState,G.dispatch]}function Dn(v){var S=mt(),N=S.queue;if(N===null)throw Error(i(311));N.lastRenderedReducer=v;var G=N.dispatch,oe=N.pending,me=S.memoizedState;if(oe!==null){N.pending=null;var He=oe=oe.next;do me=v(me,He.action),He=He.next;while(He!==oe);ka(me,S.memoizedState)||(qs=!0),S.memoizedState=me,S.baseQueue===null&&(S.baseState=me),N.lastRenderedState=me}return[me,G]}function or(v,S,N){var G=Fr,oe=mt(),me=Lr;if(me){if(N===void 0)throw Error(i(407));N=N()}else N=S();var He=!ka((Bi||oe).memoizedState,N);if(He&&(oe.memoizedState=N,qs=!0),oe=oe.queue,w0(dr.bind(null,G,oe,v),[v]),oe.getSnapshot!==S||He||gs!==null&&gs.memoizedState.tag&1){if(G.flags|=2048,ac(9,zn.bind(null,G,oe,N,S),{destroy:void 0},null),Cn===null)throw Error(i(349));me||(af&60)!==0||rr(G,S,N)}return N}function rr(v,S,N){v.flags|=16384,v={getSnapshot:S,value:N},S=Fr.updateQueue,S===null?(S=e1(),Fr.updateQueue=S,S.stores=[v]):(N=S.stores,N===null?S.stores=[v]:N.push(v))}function zn(v,S,N,G){S.value=N,S.getSnapshot=G,Ur(S)&&rs(v)}function dr(v,S,N){return N(function(){Ur(S)&&rs(v)})}function Ur(v){var S=v.getSnapshot;v=v.value;try{var N=S();return!ka(v,N)}catch{return!0}}function rs(v){var S=De(v,2);S!==null&&Ya(S,v,2)}function Rr(v){var S=Le();if(typeof v=="function"){var N=v;if(v=N(),nd){$(!0);try{N()}finally{$(!1)}}}return S.memoizedState=S.baseState=v,S.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qt,lastRenderedState:v},S}function Dr(v,S,N,G){return v.baseState=N,an(v,Bi,typeof G=="function"?G:Qt)}function Qn(v,S,N,G,oe){if(Zn(v))throw Error(i(485));if(v=S.action,v!==null){var me={payload:oe,action:v,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(He){me.listeners.push(He)}};yr.T!==null?N(!0):me.isTransition=!1,G(me),N=S.pending,N===null?(me.next=S.pending=me,pr(S,me)):(me.next=N.next,S.pending=N.next=me)}}function pr(v,S){var N=S.action,G=S.payload,oe=v.state;if(S.isTransition){var me=yr.T,He={};yr.T=He;try{var ht=N(oe,G),Tt=yr.S;Tt!==null&&Tt(He,ht),On(v,S,ht)}catch(qt){So(v,S,qt)}finally{yr.T=me}}else try{me=N(oe,G),On(v,S,me)}catch(qt){So(v,S,qt)}}function On(v,S,N){N!==null&&typeof N=="object"&&typeof N.then=="function"?N.then(function(G){Fs(v,S,G)},function(G){return So(v,S,G)}):Fs(v,S,N)}function Fs(v,S,N){S.status="fulfilled",S.value=N,js(S),v.state=N,S=v.pending,S!==null&&(N=S.next,N===S?v.pending=null:(N=N.next,S.next=N,pr(v,N)))}function So(v,S,N){var G=v.pending;if(v.pending=null,G!==null){G=G.next;do S.status="rejected",S.reason=N,js(S),S=S.next;while(S!==G)}v.action=null}function js(v){v=v.listeners;for(var S=0;S<v.length;S++)(0,v[S])()}function Qo(v,S){return S}function Ci(v,S){if(Lr){var N=Cn.formState;if(N!==null){e:{var G=Fr;if(Lr){if(Oa){var oe=hS(Oa,Xr);if(oe){Oa=jy(oe),G=dT(oe);break e}}be(G)}G=!1}G&&(S=N[0])}}N=Le(),N.memoizedState=N.baseState=S,G={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qo,lastRenderedState:S},N.queue=G,N=Yu.bind(null,Fr,G),G.dispatch=N,G=Rr(!1);var me=fl.bind(null,Fr,!1,G.queue);return G=Le(),oe={state:S,dispatch:null,action:v,pending:null},G.queue=oe,N=Qn.bind(null,Fr,oe,me,N),oe.dispatch=N,G.memoizedState=v,[S,N,!1]}function xn(v){var S=mt();return bs(S,Bi,v)}function bs(v,S,N){S=an(v,S,Qo)[0],v=Sn(Qt)[0],S=typeof S=="object"&&S!==null&&typeof S.then=="function"?Ct(S):S;var G=mt(),oe=G.queue,me=oe.dispatch;return N!==G.memoizedState&&(Fr.flags|=2048,ac(9,$n.bind(null,oe,N),{destroy:void 0},null)),[S,me,v]}function $n(v,S){v.action=S}function fs(v){var S=mt(),N=Bi;if(N!==null)return bs(S,N,v);mt(),S=S.memoizedState,N=mt();var G=N.queue.dispatch;return N.memoizedState=v,[S,G,!1]}function ac(v,S,N,G){return v={tag:v,create:S,inst:N,deps:G,next:null},S=Fr.updateQueue,S===null&&(S=e1(),Fr.updateQueue=S),N=S.lastEffect,N===null?S.lastEffect=v.next=v:(G=N.next,N.next=v,v.next=G,S.lastEffect=v),v}function is(){return mt().memoizedState}function cc(v,S,N,G){var oe=Le();Fr.flags|=v,oe.memoizedState=ac(1|S,N,{destroy:void 0},G===void 0?null:G)}function Dd(v,S,N,G){var oe=mt();G=G===void 0?null:G;var me=oe.memoizedState.inst;Bi!==null&&G!==null&&qi(G,Bi.memoizedState.deps)?oe.memoizedState=ac(S,N,me,G):(Fr.flags|=v,oe.memoizedState=ac(1|S,N,me,G))}function x_(v,S){cc(8390656,8,v,S)}function w0(v,S){Dd(2048,8,v,S)}function T_(v,S){return Dd(4,2,v,S)}function A0(v,S){return Dd(4,4,v,S)}function wa(v,S){if(typeof S=="function"){v=v();var N=S(v);return function(){typeof N=="function"?N():S(null)}}if(S!=null)return v=v(),S.current=v,function(){S.current=null}}function uy(v,S,N){N=N!=null?N.concat([v]):null,Dd(4,4,wa.bind(null,S,v),N)}function Bc(){}function hy(v,S){var N=mt();S=S===void 0?null:S;var G=N.memoizedState;return S!==null&&qi(S,G[1])?G[0]:(N.memoizedState=[v,S],v)}function w_(v,S){var N=mt();S=S===void 0?null:S;var G=N.memoizedState;if(S!==null&&qi(S,G[1]))return G[0];if(G=v(),nd){$(!0);try{v()}finally{$(!1)}}return N.memoizedState=[G,S],G}function Ul(v,S,N){return N===void 0||(af&1073741824)!==0?v.memoizedState=S:(v.memoizedState=N,v=F0(),Fr.lanes|=v,da|=v,N)}function Dp(v,S,N,G){return ka(N,S)?N:lm.current!==null?(v=Ul(v,N,G),ka(v,S)||(qs=!0),v):(af&42)===0?(qs=!0,v.memoizedState=N):(v=F0(),Fr.lanes|=v,da|=v,S)}function R0(v,S,N,G,oe){var me=gc();Ka(me!==0&&8>me?me:8);var He=yr.T,ht={};yr.T=ht,fl(v,!1,S,N);try{var Tt=oe(),qt=yr.S;if(qt!==null&&qt(ht,Tt),Tt!==null&&typeof Tt=="object"&&typeof Tt.then=="function"){var C=Re(Tt,G);Ku(v,S,C,qa(v))}else Ku(v,S,G,qa(v))}catch(E){Ku(v,S,{then:function(){},status:"rejected",reason:E},qa())}finally{Ka(me),yr.T=He}}function ds(v){var S=v.memoizedState;if(S!==null)return S;S={memoizedState:ss,baseState:ss,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qt,lastRenderedState:ss},next:null};var N={};return S.next={memoizedState:N,baseState:N,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qt,lastRenderedState:N},next:null},v.memoizedState=S,v=v.alternate,v!==null&&(v.memoizedState=S),S}function lc(){return Uo(Sl)}function Lf(){return mt().memoizedState}function uc(){return mt().memoizedState}function Bl(v){for(var S=v.return;S!==null;){switch(S.tag){case 24:case 3:var N=qa();v=le(N);var G=Se(S,v,N);G!==null&&(Ya(G,S,N),Ae(G,S,N)),S={cache:N_()},v.payload=S;return}S=S.return}}function fy(v,S,N){var G=qa();N={lane:G,revertLane:0,action:N,hasEagerState:!1,eagerState:null,next:null},Zn(v)?A_(S,N):(N=Be(v,S,N,G),N!==null&&(Ya(N,v,G),R_(N,S,G)))}function Yu(v,S,N){var G=qa();Ku(v,S,N,G)}function Ku(v,S,N,G){var oe={lane:G,revertLane:0,action:N,hasEagerState:!1,eagerState:null,next:null};if(Zn(v))A_(S,oe);else{var me=v.alternate;if(v.lanes===0&&(me===null||me.lanes===0)&&(me=S.lastRenderedReducer,me!==null))try{var He=S.lastRenderedState,ht=me(He,N);if(oe.hasEagerState=!0,oe.eagerState=ht,ka(ht,He))return Ne(v,S,oe,0),Cn===null&&te(),!1}catch{}finally{}if(N=Be(v,S,oe,G),N!==null)return Ya(N,v,G),R_(N,S,G),!0}return!1}function fl(v,S,N,G){if(G={lane:2,revertLane:Pt(),action:G,hasEagerState:!1,eagerState:null,next:null},Zn(v)){if(S)throw Error(i(479))}else S=Be(v,N,G,2),S!==null&&Ya(S,v,2)}function Zn(v){var S=v.alternate;return v===Fr||S!==null&&S===Fr}function A_(v,S){td=ha=!0;var N=v.pending;N===null?S.next=S:(S.next=N.next,N.next=S),v.pending=S}function R_(v,S,N){if((N&4194176)!==0){var G=S.lanes;G&=v.pendingLanes,N|=G,S.lanes=N,M(v,N)}}function C0(v,S,N,G){S=v.memoizedState,N=N(G,S),N=N==null?S:oa({},S,N),v.memoizedState=N,v.lanes===0&&(v.updateQueue.baseState=N)}function Yh(v,S,N,G,oe,me,He){return v=v.stateNode,typeof v.shouldComponentUpdate=="function"?v.shouldComponentUpdate(G,me,He):S.prototype&&S.prototype.isPureReactComponent?!je(N,G)||!je(oe,me):!0}function C_(v,S,N,G){v=S.state,typeof S.componentWillReceiveProps=="function"&&S.componentWillReceiveProps(N,G),typeof S.UNSAFE_componentWillReceiveProps=="function"&&S.UNSAFE_componentWillReceiveProps(N,G),S.state!==v&&t1.enqueueReplaceState(S,S.state,null)}function Xu(v,S){var N=S;if("ref"in S){N={};for(var G in S)G!=="ref"&&(N[G]=S[G])}if(v=v.defaultProps){N===S&&(N=oa({},N));for(var oe in v)N[oe]===void 0&&(N[oe]=v[oe])}return N}function ea(v,S){try{var N=v.onUncaughtError;N(S.value,{componentStack:S.stack})}catch(G){setTimeout(function(){throw G})}}function M_(v,S,N){try{var G=v.onCaughtError;G(N.value,{componentStack:N.stack,errorBoundary:S.tag===1?S.stateNode:null})}catch(oe){setTimeout(function(){throw oe})}}function hc(v,S,N){return N=le(N),N.tag=3,N.payload={element:null},N.callback=function(){ea(v,S)},N}function k_(v){return v=le(v),v.tag=3,v}function Kh(v,S,N,G){var oe=N.type.getDerivedStateFromError;if(typeof oe=="function"){var me=G.value;v.payload=function(){return oe(me)},v.callback=function(){M_(S,N,G)}}var He=N.stateNode;He!==null&&typeof He.componentDidCatch=="function"&&(v.callback=function(){M_(S,N,G),typeof oe!="function"&&(pa===null?pa=new Set([this]):pa.add(this));var ht=G.stack;this.componentDidCatch(G.value,{componentStack:ht!==null?ht:""})})}function Eo(v,S,N,G,oe){if(N.flags|=32768,G!==null&&typeof G=="object"&&typeof G.then=="function"){if(S=N.alternate,S!==null&&M0(S,N,oe,!0),N=Yl.current,N!==null){switch(N.tag){case 13:return Kl===null?Fo():N.alternate===null&&ti===0&&(ti=3),N.flags&=-257,N.flags|=65536,N.lanes=oe,G===dg?N.flags|=16384:(S=N.updateQueue,S===null?N.updateQueue=new Set([G]):S.add(G),rh(v,G,oe)),!1;case 22:return N.flags|=65536,G===dg?N.flags|=16384:(S=N.updateQueue,S===null?(S={transitions:null,markerInstances:null,retryQueue:new Set([G])},N.updateQueue=S):(N=S.retryQueue,N===null?S.retryQueue=new Set([G]):N.add(G)),rh(v,G,oe)),!1}throw Error(i(435,N.tag))}return rh(v,G,oe),Fo(),!1}if(Lr)return S=Yl.current,S!==null?((S.flags&65536)===0&&(S.flags|=256),S.flags|=65536,S.lanes=oe,G!==Ky&&(v=Error(i(422),{cause:G}),ut(Q(v,N)))):(G!==Ky&&(S=Error(i(423),{cause:G}),ut(Q(S,N))),v=v.current.alternate,v.flags|=65536,oe&=-oe,v.lanes|=oe,G=Q(G,N),oe=hc(v.stateNode,G,oe),ye(v,oe),ti!==4&&(ti=2)),!1;var me=Error(i(520),{cause:G});if(me=Q(me,N),Yc===null?Yc=[me]:Yc.push(me),ti!==4&&(ti=2),S===null)return!0;G=Q(G,N),N=S;do{switch(N.tag){case 3:return N.flags|=65536,v=oe&-oe,N.lanes|=v,v=hc(N.stateNode,G,v),ye(N,v),!1;case 1:if(S=N.type,me=N.stateNode,(N.flags&128)===0&&(typeof S.getDerivedStateFromError=="function"||me!==null&&typeof me.componentDidCatch=="function"&&(pa===null||!pa.has(me))))return N.flags|=65536,oe&=-oe,N.lanes|=oe,oe=k_(oe),Kh(oe,v,N,G),ye(N,oe),!1}N=N.return}while(N!==null);return!1}function ta(v,S,N,G){S.child=v===null?Qy(S,null,N,G):ed(S,v.child,N,G)}function O_(v,S,N,G,oe){N=N.render;var me=S.ref;if("ref"in G){var He={};for(var ht in G)ht!=="ref"&&(He[ht]=G[ht])}else He=G;return Qu(S),G=oi(v,S,N,He,me,oe),ht=Ui(),v!==null&&!qs?(us(v,S,oe),Br(v,S,oe)):(Lr&&ht&&K(S),S.flags|=1,ta(v,S,G,oe),S.child)}function vu(v,S,N,G,oe){if(v===null){var me=N.type;return typeof me=="function"&&!z_(me)&&me.defaultProps===void 0&&N.compare===null?(S.tag=15,S.type=me,Ss(v,S,me,G,oe)):(v=qp(N.type,null,G,S,S.mode,oe),v.ref=S.ref,v.return=S,S.child=v)}if(me=v.child,!Hs(v,oe)){var He=me.memoizedProps;if(N=N.compare,N=N!==null?N:je,N(He,G)&&v.ref===S.ref)return Br(v,S,oe)}return S.flags|=1,v=ih(me,G),v.ref=S.ref,v.return=S,S.child=v}function Ss(v,S,N,G,oe){if(v!==null){var me=v.memoizedProps;if(je(me,G)&&v.ref===S.ref)if(qs=!1,S.pendingProps=G=me,Hs(v,oe))(v.flags&131072)!==0&&(qs=!0);else return S.lanes=v.lanes,Br(v,S,oe)}return Fl(v,S,N,G,oe)}function na(v,S,N){var G=S.pendingProps,oe=G.children,me=(S.stateNode._pendingVisibility&2)!==0,He=v!==null?v.memoizedState:null;if(Lp(v,S),G.mode==="hidden"||me){if((S.flags&128)!==0){if(G=He!==null?He.baseLanes|N:N,v!==null){for(oe=S.child=v.child,me=0;oe!==null;)me=me|oe.lanes|oe.childLanes,oe=oe.sibling;S.childLanes=me&~G}else S.childLanes=0,S.child=null;return I_(v,S,G,N)}if((N&536870912)!==0)S.memoizedState={baseLanes:0,cachePool:null},v!==null&&jc(S,He!==null?He.cachePool:null),He!==null?Rt(S,He):Ut(),_n(S);else return S.lanes=S.childLanes=536870912,I_(v,S,He!==null?He.baseLanes|N:N,N)}else He!==null?(jc(S,He.cachePool),Rt(S,He),jt(),S.memoizedState=null):(v!==null&&jc(S,null),Ut(),jt());return ta(v,S,oe,N),S.child}function I_(v,S,N,G){var oe=py();return oe=oe===null?null:{parent:Vc?ci._currentValue:ci._currentValue2,pool:oe},S.memoizedState={baseLanes:N,cachePool:oe},v!==null&&jc(S,null),Ut(),_n(S),v!==null&&M0(v,S,G,!0),null}function Lp(v,S){var N=S.ref;if(N===null)v!==null&&v.ref!==null&&(S.flags|=2097664);else{if(typeof N!="function"&&typeof N!="object")throw Error(i(284));(v===null||v.ref!==N)&&(S.flags|=2097664)}}function Fl(v,S,N,G,oe){return Qu(S),N=oi(v,S,N,G,void 0,oe),G=Ui(),v!==null&&!qs?(us(v,S,oe),Br(v,S,oe)):(Lr&&G&&K(S),S.flags|=1,ta(v,S,N,oe),S.child)}function Ga(v,S,N,G,oe,me){return Qu(S),S.updateQueue=null,N=ys(S,G,N,oe),_i(v),G=Ui(),v!==null&&!qs?(us(v,S,me),Br(v,S,me)):(Lr&&G&&K(S),S.flags|=1,ta(v,S,N,me),S.child)}function zs(v,S,N,G,oe){if(Qu(S),S.stateNode===null){var me=fh,He=N.contextType;typeof He=="object"&&He!==null&&(me=Uo(He)),me=new N(G,me),S.memoizedState=me.state!==null&&me.state!==void 0?me.state:null,me.updater=t1,S.stateNode=me,me._reactInternals=S,me=S.stateNode,me.props=G,me.state=S.memoizedState,me.refs={},ce(S),He=N.contextType,me.context=typeof He=="object"&&He!==null?Uo(He):fh,me.state=S.memoizedState,He=N.getDerivedStateFromProps,typeof He=="function"&&(C0(S,N,He,G),me.state=S.memoizedState),typeof N.getDerivedStateFromProps=="function"||typeof me.getSnapshotBeforeUpdate=="function"||typeof me.UNSAFE_componentWillMount!="function"&&typeof me.componentWillMount!="function"||(He=me.state,typeof me.componentWillMount=="function"&&me.componentWillMount(),typeof me.UNSAFE_componentWillMount=="function"&&me.UNSAFE_componentWillMount(),He!==me.state&&t1.enqueueReplaceState(me,me.state,null),Xe(S,G,me,oe),ve(),me.state=S.memoizedState),typeof me.componentDidMount=="function"&&(S.flags|=4194308),G=!0}else if(v===null){me=S.stateNode;var ht=S.memoizedProps,Tt=Xu(N,ht);me.props=Tt;var qt=me.context,C=N.contextType;He=fh,typeof C=="object"&&C!==null&&(He=Uo(C));var E=N.getDerivedStateFromProps;C=typeof E=="function"||typeof me.getSnapshotBeforeUpdate=="function",ht=S.pendingProps!==ht,C||typeof me.UNSAFE_componentWillReceiveProps!="function"&&typeof me.componentWillReceiveProps!="function"||(ht||qt!==He)&&C_(S,me,G,He),co=!1;var A=S.memoizedState;me.state=A,Xe(S,G,me,oe),ve(),qt=S.memoizedState,ht||A!==qt||co?(typeof E=="function"&&(C0(S,N,E,G),qt=S.memoizedState),(Tt=co||Yh(S,N,Tt,G,A,qt,He))?(C||typeof me.UNSAFE_componentWillMount!="function"&&typeof me.componentWillMount!="function"||(typeof me.componentWillMount=="function"&&me.componentWillMount(),typeof me.UNSAFE_componentWillMount=="function"&&me.UNSAFE_componentWillMount()),typeof me.componentDidMount=="function"&&(S.flags|=4194308)):(typeof me.componentDidMount=="function"&&(S.flags|=4194308),S.memoizedProps=G,S.memoizedState=qt),me.props=G,me.state=qt,me.context=He,G=Tt):(typeof me.componentDidMount=="function"&&(S.flags|=4194308),G=!1)}else{me=S.stateNode,W(v,S),He=S.memoizedProps,C=Xu(N,He),me.props=C,E=S.pendingProps,A=me.context,qt=N.contextType,Tt=fh,typeof qt=="object"&&qt!==null&&(Tt=Uo(qt)),ht=N.getDerivedStateFromProps,(qt=typeof ht=="function"||typeof me.getSnapshotBeforeUpdate=="function")||typeof me.UNSAFE_componentWillReceiveProps!="function"&&typeof me.componentWillReceiveProps!="function"||(He!==E||A!==Tt)&&C_(S,me,G,Tt),co=!1,A=S.memoizedState,me.state=A,Xe(S,G,me,oe),ve();var O=S.memoizedState;He!==E||A!==O||co||v!==null&&v.dependencies!==null&&Zh(v.dependencies)?(typeof ht=="function"&&(C0(S,N,ht,G),O=S.memoizedState),(C=co||Yh(S,N,C,G,A,O,Tt)||v!==null&&v.dependencies!==null&&Zh(v.dependencies))?(qt||typeof me.UNSAFE_componentWillUpdate!="function"&&typeof me.componentWillUpdate!="function"||(typeof me.componentWillUpdate=="function"&&me.componentWillUpdate(G,O,Tt),typeof me.UNSAFE_componentWillUpdate=="function"&&me.UNSAFE_componentWillUpdate(G,O,Tt)),typeof me.componentDidUpdate=="function"&&(S.flags|=4),typeof me.getSnapshotBeforeUpdate=="function"&&(S.flags|=1024)):(typeof me.componentDidUpdate!="function"||He===v.memoizedProps&&A===v.memoizedState||(S.flags|=4),typeof me.getSnapshotBeforeUpdate!="function"||He===v.memoizedProps&&A===v.memoizedState||(S.flags|=1024),S.memoizedProps=G,S.memoizedState=O),me.props=G,me.state=O,me.context=Tt,G=C):(typeof me.componentDidUpdate!="function"||He===v.memoizedProps&&A===v.memoizedState||(S.flags|=4),typeof me.getSnapshotBeforeUpdate!="function"||He===v.memoizedProps&&A===v.memoizedState||(S.flags|=1024),G=!1)}return me=G,Lp(v,S),G=(S.flags&128)!==0,me||G?(me=S.stateNode,N=G&&typeof N.getDerivedStateFromError!="function"?null:me.render(),S.flags|=1,v!==null&&G?(S.child=ed(S,v.child,null,oe),S.child=ed(S,null,N,oe)):ta(v,S,N,oe),S.memoizedState=me.state,v=S.child):v=Br(v,S,oe),v}function Zu(v,S,N,G){return qe(),S.flags|=256,ta(v,S,N,G),S.child}function ra(v){return{baseLanes:v,cachePool:k0()}}function pn(v,S,N){return v=v!==null?v.childLanes&~N:0,S&&(v|=Ja),v}function eS(v,S,N){var G=S.pendingProps,oe=!1,me=(S.flags&128)!==0,He;if((He=me)||(He=v!==null&&v.memoizedState===null?!1:(vi.current&2)!==0),He&&(oe=!0,S.flags&=-129),He=(S.flags&32)!==0,S.flags&=-33,v===null){if(Lr){if(oe?Ht(S):jt(),Lr){var ht=Oa,Tt;(Tt=ht)&&(ht=Vy(ht,Xr),ht!==null?(S.memoizedState={dehydrated:ht,treeContext:dh!==null?{id:ao,overflow:ua}:null,retryLane:536870912},Tt=t(18,null,null,0),Tt.stateNode=ht,Tt.return=S,S.child=Tt,ir=S,Oa=null,Tt=!0):Tt=!1),Tt||be(S)}if(ht=S.memoizedState,ht!==null&&(ht=ht.dehydrated,ht!==null))return Z_(ht)?S.lanes=16:S.lanes=536870912,null;mn(S)}return ht=G.children,G=G.fallback,oe?(jt(),oe=S.mode,ht=Nt({mode:"hidden",children:ht},oe),G=Su(G,oe,N,null),ht.return=S,G.return=S,ht.sibling=G,S.child=ht,oe=S.child,oe.memoizedState=ra(N),oe.childLanes=pn(v,He,N),S.memoizedState=Ys,G):(Ht(S),Up(S,ht))}if(Tt=v.memoizedState,Tt!==null&&(ht=Tt.dehydrated,ht!==null)){if(me)S.flags&256?(Ht(S),S.flags&=-257,S=Kt(v,S,N)):S.memoizedState!==null?(jt(),S.child=v.child,S.flags|=128,S=null):(jt(),oe=G.fallback,ht=S.mode,G=Nt({mode:"visible",children:G.children},ht),oe=Su(oe,ht,N,null),oe.flags|=2,G.return=S,oe.return=S,G.sibling=oe,S.child=G,ed(S,v.child,null,N),G=S.child,G.memoizedState=ra(N),G.childLanes=pn(v,He,N),S.memoizedState=Ys,S=oe);else if(Ht(S),Z_(ht))He=lS(ht).digest,G=Error(i(419)),G.stack="",G.digest=He,ut({value:G,source:null,stack:null}),S=Kt(v,S,N);else if(qs||M0(v,S,N,!1),He=(N&v.childLanes)!==0,qs||He){if(He=Cn,He!==null){if(G=N&-N,(G&42)!==0)G=1;else switch(G){case 2:G=1;break;case 8:G=4;break;case 32:G=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:G=64;break;case 268435456:G=134217728;break;default:G=0}if(G=(G&(He.suspendedLanes|N))!==0?0:G,G!==0&&G!==Tt.retryLane)throw Tt.retryLane=G,De(v,G),Ya(He,v,G),ES}tm(ht)||Fo(),S=Kt(v,S,N)}else tm(ht)?(S.flags|=128,S.child=v.child,S=Ey.bind(null,v),uS(ht,S),S=null):(v=Tt.treeContext,Gc&&(Oa=fS(ht),ir=S,Lr=!0,Wl=null,Xr=!1,v!==null&&(Wc[Za++]=ao,Wc[Za++]=ua,Wc[Za++]=dh,ao=v.id,ua=v.overflow,dh=S)),S=Up(S,G.children),S.flags|=4096);return S}return oe?(jt(),oe=G.fallback,ht=S.mode,Tt=v.child,me=Tt.sibling,G=ih(Tt,{mode:"hidden",children:G.children}),G.subtreeFlags=Tt.subtreeFlags&31457280,me!==null?oe=ih(me,oe):(oe=Su(oe,ht,N,null),oe.flags|=2),oe.return=S,G.return=S,G.sibling=oe,S.child=G,G=oe,oe=S.child,ht=v.child.memoizedState,ht===null?ht=ra(N):(Tt=ht.cachePool,Tt!==null?(me=Vc?ci._currentValue:ci._currentValue2,Tt=Tt.parent!==me?{parent:me,pool:me}:Tt):Tt=k0(),ht={baseLanes:ht.baseLanes|N,cachePool:Tt}),oe.memoizedState=ht,oe.childLanes=pn(v,He,N),S.memoizedState=Ys,G):(Ht(S),N=v.child,v=N.sibling,N=ih(N,{mode:"visible",children:G.children}),N.return=S,N.sibling=null,v!==null&&(He=S.deletions,He===null?(S.deletions=[v],S.flags|=16):He.push(v)),S.child=N,S.memoizedState=null,N)}function Up(v,S){return S=Nt({mode:"visible",children:S},v.mode),S.return=v,v.child=S}function Nt(v,S){return Ty(v,S,0,null)}function Kt(v,S,N){return ed(S,v.child,null,N),v=Up(S,S.pendingProps.children),v.flags|=2,S.memoizedState=null,v}function Zt(v,S,N){v.lanes|=S;var G=v.alternate;G!==null&&(G.lanes|=S),Fc(v.return,S,N)}function In(v,S,N,G,oe){var me=v.memoizedState;me===null?v.memoizedState={isBackwards:S,rendering:null,renderingStartTime:0,last:G,tail:N,tailMode:oe}:(me.isBackwards=S,me.rendering=null,me.renderingStartTime=0,me.last=G,me.tail=N,me.tailMode=oe)}function wr(v,S,N){var G=S.pendingProps,oe=G.revealOrder,me=G.tail;if(ta(v,S,G.children,N),G=vi.current,(G&2)!==0)G=G&1|2,S.flags|=128;else{if(v!==null&&(v.flags&128)!==0)e:for(v=S.child;v!==null;){if(v.tag===13)v.memoizedState!==null&&Zt(v,N,S);else if(v.tag===19)Zt(v,N,S);else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===S)break e;for(;v.sibling===null;){if(v.return===null||v.return===S)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}G&=1}switch(b(vi,G),oe){case"forwards":for(N=S.child,oe=null;N!==null;)v=N.alternate,v!==null&&Rn(v)===null&&(oe=N),N=N.sibling;N=oe,N===null?(oe=S.child,S.child=null):(oe=N.sibling,N.sibling=null),In(S,!1,oe,N,me);break;case"backwards":for(N=null,oe=S.child,S.child=null;oe!==null;){if(v=oe.alternate,v!==null&&Rn(v)===null){S.child=oe;break}v=oe.sibling,oe.sibling=N,N=oe,oe=v}In(S,!0,N,null,me);break;case"together":In(S,!1,null,null,void 0);break;default:S.memoizedState=null}return S.child}function Br(v,S,N){if(v!==null&&(S.dependencies=v.dependencies),da|=S.lanes,(N&S.childLanes)===0)if(v!==null){if(M0(v,S,N,!1),(N&S.childLanes)===0)return null}else return null;if(v!==null&&S.child!==v.child)throw Error(i(153));if(S.child!==null){for(v=S.child,N=ih(v,v.pendingProps),S.child=N,N.return=S;v.sibling!==null;)v=v.sibling,N=N.sibling=ih(v,v.pendingProps),N.return=S;N.sibling=null}return S.child}function Hs(v,S){return(v.lanes&S)!==0?!0:(v=v.dependencies,!!(v!==null&&Zh(v)))}function yu(v,S,N){switch(S.tag){case 3:ie(S,S.stateNode.containerInfo),Ju(S,ci,v.memoizedState.cache),qe();break;case 27:case 5:Te(S);break;case 4:ie(S,S.stateNode.containerInfo);break;case 10:Ju(S,S.type,S.memoizedProps.value);break;case 13:var G=S.memoizedState;if(G!==null)return G.dehydrated!==null?(Ht(S),S.flags|=128,null):(N&S.child.childLanes)!==0?eS(v,S,N):(Ht(S),v=Br(v,S,N),v!==null?v.sibling:null);Ht(S);break;case 19:var oe=(v.flags&128)!==0;if(G=(N&S.childLanes)!==0,G||(M0(v,S,N,!1),G=(N&S.childLanes)!==0),oe){if(G)return wr(v,S,N);S.flags|=128}if(oe=S.memoizedState,oe!==null&&(oe.rendering=null,oe.tail=null,oe.lastEffect=null),b(vi,vi.current),G)break;return null;case 22:case 23:return S.lanes=0,na(v,S,N);case 24:Ju(S,ci,v.memoizedState.cache)}return Br(v,S,N)}function Yi(v,S,N){if(v!==null)if(v.memoizedProps!==S.pendingProps)qs=!0;else{if(!Hs(v,N)&&(S.flags&128)===0)return qs=!1,yu(v,S,N);qs=(v.flags&131072)!==0}else qs=!1,Lr&&(S.flags&1048576)!==0&&V(S,sf,S.index);switch(S.lanes=0,S.tag){case 16:e:{v=S.pendingProps;var G=S.elementType,oe=G._init;if(G=oe(G._payload),S.type=G,typeof G=="function")z_(G)?(v=Xu(G,v),S.tag=1,S=zs(null,S,G,v,N)):(S.tag=0,S=Fl(null,S,G,v,N));else{if(G!=null){if(oe=G.$$typeof,oe===sh){S.tag=11,S=O_(null,S,G,v,N);break e}else if(oe===$t){S.tag=14,S=vu(null,S,G,v,N);break e}}throw S=o(G)||G,Error(i(306,S,""))}}return S;case 0:return Fl(v,S,S.type,S.pendingProps,N);case 1:return G=S.type,oe=Xu(G,S.pendingProps),zs(v,S,G,oe,N);case 3:e:{if(ie(S,S.stateNode.containerInfo),v===null)throw Error(i(387));var me=S.pendingProps;oe=S.memoizedState,G=oe.element,W(v,S),Xe(S,me,null,N);var He=S.memoizedState;if(me=He.cache,Ju(S,ci,me),me!==oe.cache&&Bp(S,[ci],N,!0),ve(),me=He.element,Gc&&oe.isDehydrated)if(oe={element:me,isDehydrated:!1,cache:He.cache},S.updateQueue.baseState=oe,S.memoizedState=oe,S.flags&256){S=Zu(v,S,me,N);break e}else if(me!==G){G=Q(Error(i(424)),S),ut(G),S=Zu(v,S,me,N);break e}else for(Gc&&(Oa=oo(S.stateNode.containerInfo),ir=S,Lr=!0,Wl=null,Xr=!0),N=Qy(S,null,me,N),S.child=N;N;)N.flags=N.flags&-3|4096,N=N.sibling;else{if(qe(),me===G){S=Br(v,S,N);break e}ta(v,S,me,N)}S=S.child}return S;case 26:if(zo)return Lp(v,S),v===null?(N=eg(S.type,null,S.pendingProps,null))?S.memoizedState=N:Lr||(S.stateNode=ng(S.type,S.pendingProps,of.current,S)):S.memoizedState=eg(S.type,v.memoizedProps,S.pendingProps,v.memoizedState),null;case 27:if(Ro)return Te(S),v===null&&Ro&&Lr&&(G=S.stateNode=Q_(S.type,S.pendingProps,of.current,Co.current,!1),ir=S,Xr=!0,Oa=zy(G)),G=S.pendingProps.children,v!==null||Lr?ta(v,S,G,N):S.child=ed(S,null,G,N),Lp(v,S),S.child;case 5:return v===null&&Lr&&(rm(S.type,S.pendingProps,Co.current),(oe=G=Oa)&&(G=Hy(G,S.type,S.pendingProps,Xr),G!==null?(S.stateNode=G,ir=S,Oa=zy(G),Xr=!1,oe=!0):oe=!1),oe||be(S)),Te(S),oe=S.type,me=S.pendingProps,He=v!==null?v.memoizedProps:null,G=me.children,Zp(oe,me)?G=null:He!==null&&Zp(oe,He)&&(S.flags|=32),S.memoizedState!==null&&(oe=oi(v,S,Is,null,null,N),Vc?Sl._currentValue=oe:Sl._currentValue2=oe),Lp(v,S),ta(v,S,G,N),S.child;case 6:return v===null&&Lr&&(im(S.pendingProps,Co.current),(v=N=Oa)&&(N=pT(N,S.pendingProps,Xr),N!==null?(S.stateNode=N,ir=S,Oa=null,v=!0):v=!1),v||be(S)),null;case 13:return eS(v,S,N);case 4:return ie(S,S.stateNode.containerInfo),G=S.pendingProps,v===null?S.child=ed(S,null,G,N):ta(v,S,G,N),S.child;case 11:return O_(v,S,S.type,S.pendingProps,N);case 7:return ta(v,S,S.pendingProps,N),S.child;case 8:return ta(v,S,S.pendingProps.children,N),S.child;case 12:return ta(v,S,S.pendingProps.children,N),S.child;case 10:return G=S.pendingProps,Ju(S,S.type,G.value),ta(v,S,G.children,N),S.child;case 9:return oe=S.type._context,G=S.pendingProps.children,Qu(S),oe=Uo(oe),G=G(oe),S.flags|=1,ta(v,S,G,N),S.child;case 14:return vu(v,S,S.type,S.pendingProps,N);case 15:return Ss(v,S,S.type,S.pendingProps,N);case 19:return wr(v,S,N);case 22:return na(v,S,N);case 24:return Qu(S),G=Uo(ci),v===null?(oe=py(),oe===null&&(oe=Cn,me=N_(),oe.pooledCache=me,me.refCount++,me!==null&&(oe.pooledCacheLanes|=N),oe=me),S.memoizedState={parent:G,cache:oe},ce(S),Ju(S,ci,oe)):((v.lanes&N)!==0&&(W(v,S),Xe(S,null,null,N),ve()),oe=v.memoizedState,me=S.memoizedState,oe.parent!==G?(oe={parent:G,cache:G},S.memoizedState=oe,S.lanes===0&&(S.memoizedState=S.updateQueue.baseState=oe),Ju(S,ci,G)):(G=me.cache,Ju(S,ci,G),G!==oe.cache&&Bp(S,[ci],N,!0))),ta(v,S,S.pendingProps.children,N),S.child;case 29:throw S.pendingProps}throw Error(i(156,S.tag))}function Ju(v,S,N){Vc?(b(uf,S._currentValue),S._currentValue=N):(b(uf,S._currentValue2),S._currentValue2=N)}function Xh(v){var S=uf.current;Vc?v._currentValue=S:v._currentValue2=S,m(uf)}function Fc(v,S,N){for(;v!==null;){var G=v.alternate;if((v.childLanes&S)!==S?(v.childLanes|=S,G!==null&&(G.childLanes|=S)):G!==null&&(G.childLanes&S)!==S&&(G.childLanes|=S),v===N)break;v=v.return}}function Bp(v,S,N,G){var oe=v.child;for(oe!==null&&(oe.return=v);oe!==null;){var me=oe.dependencies;if(me!==null){var He=oe.child;me=me.firstContext;e:for(;me!==null;){var ht=me;me=oe;for(var Tt=0;Tt<S.length;Tt++)if(ht.context===S[Tt]){me.lanes|=N,ht=me.alternate,ht!==null&&(ht.lanes|=N),Fc(me.return,N,v),G||(He=null);break e}me=ht.next}}else if(oe.tag===18){if(He=oe.return,He===null)throw Error(i(341));He.lanes|=N,me=He.alternate,me!==null&&(me.lanes|=N),Fc(He,N,v),He=null}else He=oe.child;if(He!==null)He.return=oe;else for(He=oe;He!==null;){if(He===v){He=null;break}if(oe=He.sibling,oe!==null){oe.return=He.return,He=oe;break}He=He.return}oe=He}}function M0(v,S,N,G){v=null;for(var oe=S,me=!1;oe!==null;){if(!me){if((oe.flags&524288)!==0)me=!0;else if((oe.flags&262144)!==0)break}if(oe.tag===10){var He=oe.alternate;if(He===null)throw Error(i(387));if(He=He.memoizedProps,He!==null){var ht=oe.type;ka(oe.pendingProps.value,He.value)||(v!==null?v.push(ht):v=[ht])}}else if(oe===$l.current){if(He=oe.alternate,He===null)throw Error(i(387));He.memoizedState.memoizedState!==oe.memoizedState.memoizedState&&(v!==null?v.push(Sl):v=[Sl])}oe=oe.return}v!==null&&Bp(S,v,N,G),S.flags|=262144}function Zh(v){for(v=v.firstContext;v!==null;){var S=v.context;if(!ka(Vc?S._currentValue:S._currentValue2,v.memoizedValue))return!0;v=v.next}return!1}function Qu(v){Ts=v,Ia=null,v=v.dependencies,v!==null&&(v.firstContext=null)}function Uo(v){return dy(Ts,v)}function Ti(v,S){return Ts===null&&Qu(v),dy(v,S)}function dy(v,S){var N=Vc?S._currentValue:S._currentValue2;if(S={context:S,memoizedValue:N,next:null},Ia===null){if(v===null)throw Error(i(308));Ia=S,v.dependencies={lanes:0,firstContext:S},v.flags|=524288}else Ia=Ia.next=S;return N}function N_(){return{controller:new ST,data:new Map,refCount:0}}function Uf(v){v.refCount--,v.refCount===0&&gg(um,function(){v.controller.abort()})}function py(){var v=Xl.current;return v!==null?v:Cn.pooledCache}function jc(v,S){S===null?b(Xl,Xl.current):b(Xl,S.pool)}function k0(){var v=py();return v===null?null:{parent:Vc?ci._currentValue:ci._currentValue2,pool:v}}function Vs(v){v.flags|=4}function Es(v,S){if(v!==null&&v.child===S.child)return!1;if((S.flags&16)!==0)return!0;for(v=S.child;v!==null;){if((v.flags&13878)!==0||(v.subtreeFlags&13878)!==0)return!0;v=v.sibling}return!1}function Fp(v,S,N,G){if(jo)for(N=S.child;N!==null;){if(N.tag===5||N.tag===6)Yf(v,N.stateNode);else if(!(N.tag===4||Ro&&N.tag===27)&&N.child!==null){N.child.return=N,N=N.child;continue}if(N===S)break;for(;N.sibling===null;){if(N.return===null||N.return===S)return;N=N.return}N.sibling.return=N.return,N=N.sibling}else if(Vl)for(var oe=S.child;oe!==null;){if(oe.tag===5){var me=oe.stateNode;N&&G&&(me=By(me,oe.type,oe.memoizedProps)),Yf(v,me)}else if(oe.tag===6)me=oe.stateNode,N&&G&&(me=Fy(me,oe.memoizedProps)),Yf(v,me);else if(oe.tag!==4){if(oe.tag===22&&oe.memoizedState!==null)me=oe.child,me!==null&&(me.return=oe),Fp(v,oe,!0,!0);else if(oe.child!==null){oe.child.return=oe,oe=oe.child;continue}}if(oe===S)break;for(;oe.sibling===null;){if(oe.return===null||oe.return===S)return;oe=oe.return}oe.sibling.return=oe.return,oe=oe.sibling}}function Vi(v,S,N,G){if(Vl)for(var oe=S.child;oe!==null;){if(oe.tag===5){var me=oe.stateNode;N&&G&&(me=By(me,oe.type,oe.memoizedProps)),xu(v,me)}else if(oe.tag===6)me=oe.stateNode,N&&G&&(me=Fy(me,oe.memoizedProps)),xu(v,me);else if(oe.tag!==4){if(oe.tag===22&&oe.memoizedState!==null)me=oe.child,me!==null&&(me.return=oe),Vi(v,oe,!(oe.memoizedProps!==null&&oe.memoizedProps.mode==="manual"),!0);else if(oe.child!==null){oe.child.return=oe,oe=oe.child;continue}}if(oe===S)break;for(;oe.sibling===null;){if(oe.return===null||oe.return===S)return;oe=oe.return}oe.sibling.return=oe.return,oe=oe.sibling}}function O0(v,S){if(Vl&&Es(v,S)){v=S.stateNode;var N=v.containerInfo,G=Ly();Vi(G,S,!1,!1),v.pendingChildren=G,Vs(S),Kd(N,G)}}function jp(v,S,N,G){if(jo)v.memoizedProps!==G&&Vs(S);else if(Vl){var oe=v.stateNode,me=v.memoizedProps;if((v=Es(v,S))||me!==G){var He=Co.current;me=Q0(oe,N,me,G,!v,null),me===oe?S.stateNode=oe:(q_(me,N,G,He)&&Vs(S),S.stateNode=me,v?Fp(me,S,!1,!1):Vs(S))}else S.stateNode=oe}}function zp(v,S,N){if(Iy(S,N)){if(v.flags|=16777216,!bl(S,N))if(F_())v.flags|=8192;else throw Qf=dg,fg}else v.flags&=-16777217}function Ld(v,S){if(rf(S)){if(v.flags|=16777216,!Wy(S))if(F_())v.flags|=8192;else throw Qf=dg,fg}else v.flags&=-16777217}function I0(v,S){S!==null&&(v.flags|=4),v.flags&16384&&(S=v.tag!==22?B():536870912,v.lanes|=S,mh|=S)}function Jh(v,S){if(!Lr)switch(v.tailMode){case"hidden":S=v.tail;for(var N=null;S!==null;)S.alternate!==null&&(N=S),S=S.sibling;N===null?v.tail=null:N.sibling=null;break;case"collapsed":N=v.tail;for(var G=null;N!==null;)N.alternate!==null&&(G=N),N=N.sibling;G===null?S||v.tail===null?v.tail=null:v.tail.sibling=null:G.sibling=null}}function Ii(v){var S=v.alternate!==null&&v.alternate.child===v.child,N=0,G=0;if(S)for(var oe=v.child;oe!==null;)N|=oe.lanes|oe.childLanes,G|=oe.subtreeFlags&31457280,G|=oe.flags&31457280,oe.return=v,oe=oe.sibling;else for(oe=v.child;oe!==null;)N|=oe.lanes|oe.childLanes,G|=oe.subtreeFlags,G|=oe.flags,oe.return=v,oe=oe.sibling;return v.subtreeFlags|=G,v.childLanes=N,S}function eh(v,S,N){var G=S.pendingProps;switch(ne(S),S.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ii(S),null;case 1:return Ii(S),null;case 3:return N=S.stateNode,G=null,v!==null&&(G=v.memoizedState.cache),S.memoizedState.cache!==G&&(S.flags|=2048),Xh(ci),ae(),N.pendingContext&&(N.context=N.pendingContext,N.pendingContext=null),(v===null||v.child===null)&&(tt(S)?Vs(S):v===null||v.memoizedState.isDehydrated&&(S.flags&256)===0||(S.flags|=1024,Wl!==null&&(j0(Wl),Wl=null))),O0(v,S),Ii(S),null;case 26:if(zo){N=S.type;var oe=S.memoizedState;return v===null?(Vs(S),oe!==null?(Ii(S),Ld(S,oe)):(Ii(S),zp(S,N,G))):oe?oe!==v.memoizedState?(Vs(S),Ii(S),Ld(S,oe)):(Ii(S),S.flags&=-16777217):(jo?v.memoizedProps!==G&&Vs(S):jp(v,S,N,G),Ii(S),zp(S,N,G)),null}case 27:if(Ro){if(Ie(S),N=of.current,oe=S.type,v!==null&&S.stateNode!=null)jo?v.memoizedProps!==G&&Vs(S):jp(v,S,oe,G);else{if(!G){if(S.stateNode===null)throw Error(i(166));return Ii(S),null}v=Co.current,tt(S)?Pe(S,v):(v=Q_(oe,G,N,v,!0),S.stateNode=v,Vs(S))}return Ii(S),null}case 5:if(Ie(S),N=S.type,v!==null&&S.stateNode!=null)jp(v,S,N,G);else{if(!G){if(S.stateNode===null)throw Error(i(166));return Ii(S),null}v=Co.current,tt(S)?Pe(S,v):(oe=Gd(N,G,of.current,v,S),Fp(oe,S,!1,!1),S.stateNode=oe,q_(oe,N,G,v)&&Vs(S))}return Ii(S),zp(S,S.type,S.pendingProps),null;case 6:if(v&&S.stateNode!=null)N=v.memoizedProps,jo?N!==G&&Vs(S):Vl&&(N!==G?(S.stateNode=Kf(G,of.current,Co.current,S),Vs(S)):S.stateNode=v.stateNode);else{if(typeof G!="string"&&S.stateNode===null)throw Error(i(166));if(v=of.current,N=Co.current,tt(S)){if(!Gc)throw Error(i(176));if(v=S.stateNode,N=S.memoizedProps,G=null,oe=ir,oe!==null)switch(oe.tag){case 27:case 5:G=oe.memoizedProps}gT(v,N,S,G)||be(S)}else S.stateNode=Kf(G,v,N,S)}return Ii(S),null;case 13:if(G=S.memoizedState,v===null||v.memoizedState!==null&&v.memoizedState.dehydrated!==null){if(oe=tt(S),G!==null&&G.dehydrated!==null){if(v===null){if(!oe)throw Error(i(318));if(!Gc)throw Error(i(344));if(oe=S.memoizedState,oe=oe!==null?oe.dehydrated:null,!oe)throw Error(i(317));_T(oe,S)}else qe(),(S.flags&128)===0&&(S.memoizedState=null),S.flags|=4;Ii(S),oe=!1}else Wl!==null&&(j0(Wl),Wl=null),oe=!0;if(!oe)return S.flags&256?(mn(S),S):(mn(S),null)}if(mn(S),(S.flags&128)!==0)return S.lanes=N,S;if(N=G!==null,v=v!==null&&v.memoizedState!==null,N){G=S.child,oe=null,G.alternate!==null&&G.alternate.memoizedState!==null&&G.alternate.memoizedState.cachePool!==null&&(oe=G.alternate.memoizedState.cachePool.pool);var me=null;G.memoizedState!==null&&G.memoizedState.cachePool!==null&&(me=G.memoizedState.cachePool.pool),me!==oe&&(G.flags|=2048)}return N!==v&&N&&(S.child.flags|=8192),I0(S,S.updateQueue),Ii(S),null;case 4:return ae(),O0(v,S),v===null&&aS(S.stateNode.containerInfo),Ii(S),null;case 10:return Xh(S.type),Ii(S),null;case 19:if(m(vi),oe=S.memoizedState,oe===null)return Ii(S),null;if(G=(S.flags&128)!==0,me=oe.rendering,me===null)if(G)Jh(oe,!1);else{if(ti!==0||v!==null&&(v.flags&128)!==0)for(v=S.child;v!==null;){if(me=Rn(v),me!==null){for(S.flags|=128,Jh(oe,!1),v=me.updateQueue,S.updateQueue=v,I0(S,v),S.subtreeFlags=0,v=N,N=S.child;N!==null;)jd(N,v),N=N.sibling;return b(vi,vi.current&1|2),S.child}v=v.sibling}oe.tail!==null&&cr()>lo&&(S.flags|=128,G=!0,Jh(oe,!1),S.lanes=4194304)}else{if(!G)if(v=Rn(me),v!==null){if(S.flags|=128,G=!0,v=v.updateQueue,S.updateQueue=v,I0(S,v),Jh(oe,!0),oe.tail===null&&oe.tailMode==="hidden"&&!me.alternate&&!Lr)return Ii(S),null}else 2*cr()-oe.renderingStartTime>lo&&N!==536870912&&(S.flags|=128,G=!0,Jh(oe,!1),S.lanes=4194304);oe.isBackwards?(me.sibling=S.child,S.child=me):(v=oe.last,v!==null?v.sibling=me:S.child=me,oe.last=me)}return oe.tail!==null?(S=oe.tail,oe.rendering=S,oe.tail=S.sibling,oe.renderingStartTime=cr(),S.sibling=null,v=vi.current,b(vi,G?v&1|2:v&1),S):(Ii(S),null);case 22:case 23:return mn(S),_t(),G=S.memoizedState!==null,v!==null?v.memoizedState!==null!==G&&(S.flags|=8192):G&&(S.flags|=8192),G?(N&536870912)!==0&&(S.flags&128)===0&&(Ii(S),S.subtreeFlags&6&&(S.flags|=8192)):Ii(S),N=S.updateQueue,N!==null&&I0(S,N.retryQueue),N=null,v!==null&&v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(N=v.memoizedState.cachePool.pool),G=null,S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(G=S.memoizedState.cachePool.pool),G!==N&&(S.flags|=2048),v!==null&&m(Xl),null;case 24:return N=null,v!==null&&(N=v.memoizedState.cache),S.memoizedState.cache!==N&&(S.flags|=2048),Xh(ci),Ii(S),null;case 25:return null}throw Error(i(156,S.tag))}function tS(v,S){switch(ne(S),S.tag){case 1:return v=S.flags,v&65536?(S.flags=v&-65537|128,S):null;case 3:return Xh(ci),ae(),v=S.flags,(v&65536)!==0&&(v&128)===0?(S.flags=v&-65537|128,S):null;case 26:case 27:case 5:return Ie(S),null;case 13:if(mn(S),v=S.memoizedState,v!==null&&v.dehydrated!==null){if(S.alternate===null)throw Error(i(340));qe()}return v=S.flags,v&65536?(S.flags=v&-65537|128,S):null;case 19:return m(vi),null;case 4:return ae(),null;case 10:return Xh(S.type),null;case 22:case 23:return mn(S),_t(),v!==null&&m(Xl),v=S.flags,v&65536?(S.flags=v&-65537|128,S):null;case 24:return Xh(ci),null;case 25:return null;default:return null}}function my(v,S){switch(ne(S),S.tag){case 3:Xh(ci),ae();break;case 26:case 27:case 5:Ie(S);break;case 4:ae();break;case 13:mn(S);break;case 19:m(vi);break;case 10:Xh(S.type);break;case 22:case 23:mn(S),_t(),v!==null&&m(Xl);break;case 24:Xh(ci)}}function N0(v,S){try{var N=S.updateQueue,G=N!==null?N.lastEffect:null;if(G!==null){var oe=G.next;N=oe;do{if((N.tag&v)===v){G=void 0;var me=N.create,He=N.inst;G=me(),He.destroy=G}N=N.next}while(N!==oe)}}catch(ht){Si(S,S.return,ht)}}function bu(v,S,N){try{var G=S.updateQueue,oe=G!==null?G.lastEffect:null;if(oe!==null){var me=oe.next;G=me;do{if((G.tag&v)===v){var He=G.inst,ht=He.destroy;if(ht!==void 0){He.destroy=void 0,oe=S;var Tt=N;try{ht()}catch(qt){Si(oe,Tt,qt)}}}G=G.next}while(G!==me)}}catch(qt){Si(S,S.return,qt)}}function P0(v){var S=v.updateQueue;if(S!==null){var N=v.stateNode;try{Ve(S,N)}catch(G){Si(v,v.return,G)}}}function Hp(v,S,N){N.props=Xu(v.type,v.memoizedProps),N.state=v.memoizedState;try{N.componentWillUnmount()}catch(G){Si(v,S,G)}}function Bf(v,S){try{var N=v.ref;if(N!==null){var G=v.stateNode;switch(v.tag){case 26:case 27:case 5:var oe=oh(G);break;default:oe=G}typeof N=="function"?v.refCleanup=N(oe):N.current=oe}}catch(me){Si(v,S,me)}}function Aa(v,S){var N=v.ref,G=v.refCleanup;if(N!==null)if(typeof G=="function")try{G()}catch(oe){Si(v,S,oe)}finally{v.refCleanup=null,v=v.alternate,v!=null&&(v.refCleanup=null)}else if(typeof N=="function")try{N(null)}catch(oe){Si(v,S,oe)}else N.current=null}function P_(v){var S=v.type,N=v.memoizedProps,G=v.stateNode;try{Dy(G,S,N,v)}catch(oe){Si(v,v.return,oe)}}function nS(v,S,N){try{K0(v.stateNode,v.type,N,S,v)}catch(G){Si(v,v.return,G)}}function xo(v){return v.tag===5||v.tag===3||(zo?v.tag===26:!1)||(Ro?v.tag===27:!1)||v.tag===4}function To(v){e:for(;;){for(;v.sibling===null;){if(v.return===null||xo(v.return))return null;v=v.return}for(v.sibling.return=v.return,v=v.sibling;v.tag!==5&&v.tag!==6&&(!Ro||v.tag!==27)&&v.tag!==18;){if(v.flags&2||v.child===null||v.tag===4)continue e;v.child.return=v,v=v.child}if(!(v.flags&2))return v.stateNode}}function D_(v,S,N){var G=v.tag;if(G===5||G===6)v=v.stateNode,S?ch(N,v,S):Jp(N,v);else if(!(G===4||Ro&&G===27)&&(v=v.child,v!==null))for(D_(v,S,N),v=v.sibling;v!==null;)D_(v,S,N),v=v.sibling}function L_(v,S,N){var G=v.tag;if(G===5||G===6)v=v.stateNode,S?Zf(N,v,S):ca(N,v);else if(!(G===4||Ro&&G===27)&&(v=v.child,v!==null))for(L_(v,S,N),v=v.sibling;v!==null;)L_(v,S,N),v=v.sibling}function D0(v,S,N){v=v.containerInfo;try{Uy(v,N)}catch(G){Si(S,S.return,G)}}function vn(v,S){for(Cy(v.containerInfo),ke=S;ke!==null;)if(v=ke,S=v.child,(v.subtreeFlags&1028)!==0&&S!==null)S.return=v,ke=S;else for(;ke!==null;){v=ke;var N=v.alternate;switch(S=v.flags,v.tag){case 0:break;case 11:case 15:break;case 1:if((S&1024)!==0&&N!==null){S=void 0;var G=v,oe=N.memoizedProps;N=N.memoizedState;var me=G.stateNode;try{var He=Xu(G.type,oe,G.elementType===G.type);S=me.getSnapshotBeforeUpdate(He,N),me.__reactInternalSnapshotBeforeUpdate=S}catch(ht){Si(G,G.return,ht)}}break;case 3:(S&1024)!==0&&jo&&em(v.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((S&1024)!==0)throw Error(i(163))}if(S=v.sibling,S!==null){S.return=v.return,ke=S;break}ke=v.return}return He=Ge,Ge=!1,He}function ln(v,S,N){var G=N.flags;switch(N.tag){case 0:case 11:case 15:jl(v,N),G&4&&N0(5,N);break;case 1:if(jl(v,N),G&4)if(v=N.stateNode,S===null)try{v.componentDidMount()}catch(ht){Si(N,N.return,ht)}else{var oe=Xu(N.type,S.memoizedProps);S=S.memoizedState;try{v.componentDidUpdate(oe,S,v.__reactInternalSnapshotBeforeUpdate)}catch(ht){Si(N,N.return,ht)}}G&64&&P0(N),G&512&&Bf(N,N.return);break;case 3:if(jl(v,N),G&64&&(G=N.updateQueue,G!==null)){if(v=null,N.child!==null)switch(N.child.tag){case 27:case 5:v=oh(N.child.stateNode);break;case 1:v=N.child.stateNode}try{Ve(G,v)}catch(ht){Si(N,N.return,ht)}}break;case 26:if(zo){jl(v,N),G&512&&Bf(N,N.return);break}case 27:case 5:jl(v,N),S===null&&G&4&&P_(N),G&512&&Bf(N,N.return);break;case 12:jl(v,N);break;case 13:jl(v,N),G&4&&Yr(v,N);break;case 22:if(oe=N.memoizedState!==null||w,!oe){S=S!==null&&S.memoizedState!==null||D;var me=w,He=D;w=oe,(D=S)&&!He?dl(v,N,(N.subtreeFlags&8772)!==0):jl(v,N),w=me,D=He}G&512&&(N.memoizedProps.mode==="manual"?Bf(N,N.return):Aa(N,N.return));break;default:jl(v,N)}}function fn(v){var S=v.alternate;S!==null&&(v.alternate=null,fn(S)),v.child=null,v.deletions=null,v.sibling=null,v.tag===5&&(S=v.stateNode,S!==null&&fT(S)),v.stateNode=null,v.return=null,v.dependencies=null,v.memoizedProps=null,v.memoizedState=null,v.pendingProps=null,v.stateNode=null,v.updateQueue=null}function $a(v,S,N){for(N=N.child;N!==null;)zr(v,S,N),N=N.sibling}function zr(v,S,N){if(Xa&&typeof Xa.onCommitFiberUnmount=="function")try{Xa.onCommitFiberUnmount(vc,N)}catch{}switch(N.tag){case 26:if(zo){D||Aa(N,S),$a(v,S,N),N.memoizedState?mS(N.memoizedState):N.stateNode&&gS(N.stateNode);break}case 27:if(Ro){D||Aa(N,S);var G=st,oe=dt;st=N.stateNode,$a(v,S,N),tv(N.stateNode),st=G,dt=oe;break}case 5:D||Aa(N,S);case 6:if(jo){if(G=st,oe=dt,st=null,$a(v,S,N),st=G,dt=oe,st!==null)if(dt)try{lh(st,N.stateNode)}catch(me){Si(N,S,me)}else try{Qp(st,N.stateNode)}catch(me){Si(N,S,me)}}else $a(v,S,N);break;case 18:jo&&st!==null&&(dt?J_(st,N.stateNode):yT(st,N.stateNode));break;case 4:jo?(G=st,oe=dt,st=N.stateNode.containerInfo,dt=!0,$a(v,S,N),st=G,dt=oe):(Vl&&D0(N.stateNode,N,Ly()),$a(v,S,N));break;case 0:case 11:case 14:case 15:D||bu(2,N,S),D||bu(4,N,S),$a(v,S,N);break;case 1:D||(Aa(N,S),G=N.stateNode,typeof G.componentWillUnmount=="function"&&Hp(N,S,G)),$a(v,S,N);break;case 21:$a(v,S,N);break;case 22:D||Aa(N,S),D=(G=D)||N.memoizedState!==null,$a(v,S,N),D=G;break;default:$a(v,S,N)}}function Yr(v,S){if(Gc&&S.memoizedState===null&&(v=S.alternate,v!==null&&(v=v.memoizedState,v!==null&&(v=v.dehydrated,v!==null))))try{vT(v)}catch(N){Si(S,S.return,N)}}function Wa(v){switch(v.tag){case 13:case 19:var S=v.stateNode;return S===null&&(S=v.stateNode=new ge),S;case 22:return v=v.stateNode,S=v._retryCache,S===null&&(S=v._retryCache=new ge),S;default:throw Error(i(435,v.tag))}}function th(v,S){var N=Wa(v);S.forEach(function(G){var oe=iS.bind(null,v,G);N.has(G)||(N.add(G),G.then(oe,oe))})}function wo(v,S){var N=S.deletions;if(N!==null)for(var G=0;G<N.length;G++){var oe=N[G],me=v,He=S;if(jo){var ht=He;e:for(;ht!==null;){switch(ht.tag){case 27:case 5:st=ht.stateNode,dt=!1;break e;case 3:st=ht.stateNode.containerInfo,dt=!0;break e;case 4:st=ht.stateNode.containerInfo,dt=!0;break e}ht=ht.return}if(st===null)throw Error(i(160));zr(me,He,oe),st=null,dt=!1}else zr(me,He,oe);me=oe.alternate,me!==null&&(me.return=null),oe.return=null}if(S.subtreeFlags&13878)for(S=S.child;S!==null;)L0(S,v),S=S.sibling}function L0(v,S){var N=v.alternate,G=v.flags;switch(v.tag){case 0:case 11:case 14:case 15:wo(S,v),Ra(v),G&4&&(bu(3,v,v.return),N0(3,v),bu(5,v,v.return));break;case 1:wo(S,v),Ra(v),G&512&&(D||N===null||Aa(N,N.return)),G&64&&w&&(v=v.updateQueue,v!==null&&(G=v.callbacks,G!==null&&(N=v.shared.hiddenCallbacks,v.shared.hiddenCallbacks=N===null?G:N.concat(G))));break;case 26:if(zo){var oe=xt;wo(S,v),Ra(v),G&512&&(D||N===null||Aa(N,N.return)),G&4&&(G=N!==null?N.memoizedState:null,S=v.memoizedState,N===null?S===null?v.stateNode===null?v.stateNode=tg(oe,v.type,v.memoizedProps,v):$y(oe,v.type,v.stateNode):v.stateNode=pS(oe,S,v.memoizedProps):G!==S?(G===null?N.stateNode!==null&&gS(N.stateNode):mS(G),S===null?$y(oe,v.type,v.stateNode):pS(oe,S,v.memoizedProps)):S===null&&v.stateNode!==null&&nS(v,v.memoizedProps,N.memoizedProps));break}case 27:if(Ro&&G&4&&v.alternate===null){oe=v.stateNode;var me=v.memoizedProps;try{qy(oe),ev(v.type,me,oe,v)}catch(C){Si(v,v.return,C)}}case 5:if(wo(S,v),Ra(v),G&512&&(D||N===null||Aa(N,N.return)),jo){if(v.flags&32){S=v.stateNode;try{qd(S)}catch(C){Si(v,v.return,C)}}G&4&&v.stateNode!=null&&(S=v.memoizedProps,nS(v,S,N!==null?N.memoizedProps:S)),G&1024&&(J=!0)}break;case 6:if(wo(S,v),Ra(v),G&4&&jo){if(v.stateNode===null)throw Error(i(162));G=v.memoizedProps,N=N!==null?N.memoizedProps:G,S=v.stateNode;try{Wd(S,N,G)}catch(C){Si(v,v.return,C)}}break;case 3:if(zo?(_S(),oe=xt,xt=hh(S.containerInfo),wo(S,v),xt=oe):wo(S,v),Ra(v),G&4){if(jo&&Gc&&N!==null&&N.memoizedState.isDehydrated)try{dS(S.containerInfo)}catch(C){Si(v,v.return,C)}if(Vl){G=S.containerInfo,N=S.pendingChildren;try{Uy(G,N)}catch(C){Si(v,v.return,C)}}}J&&(J=!1,gy(v));break;case 4:zo?(N=xt,xt=hh(v.stateNode.containerInfo),wo(S,v),Ra(v),xt=N):(wo(S,v),Ra(v)),G&4&&Vl&&D0(v.stateNode,v,v.stateNode.pendingChildren);break;case 12:wo(S,v),Ra(v);break;case 13:wo(S,v),Ra(v),v.child.flags&8192&&v.memoizedState!==null!=(N!==null&&N.memoizedState!==null)&&(hm=cr()),G&4&&(G=v.updateQueue,G!==null&&(v.updateQueue=null,th(v,G)));break;case 22:G&512&&(D||N===null||Aa(N,N.return)),oe=v.memoizedState!==null;var He=N!==null&&N.memoizedState!==null,ht=w,Tt=D;if(w=ht||oe,D=Tt||He,wo(S,v),D=Tt,w=ht,Ra(v),S=v.stateNode,S._current=v,S._visibility&=-3,S._visibility|=S._pendingVisibility&2,G&8192&&(S._visibility=oe?S._visibility&-2:S._visibility|1,oe&&(S=w||D,N===null||He||S||Ud(v)),jo&&(v.memoizedProps===null||v.memoizedProps.mode!=="manual"))){e:if(N=null,jo)for(S=v;;){if(S.tag===5||zo&&S.tag===26||Ro&&S.tag===27){if(N===null){He=N=S;try{me=He.stateNode,oe?Yd(me):Z0(He.stateNode,He.memoizedProps)}catch(C){Si(He,He.return,C)}}}else if(S.tag===6){if(N===null){He=S;try{var qt=He.stateNode;oe?X0(qt):J0(qt,He.memoizedProps)}catch(C){Si(He,He.return,C)}}}else if((S.tag!==22&&S.tag!==23||S.memoizedState===null||S===v)&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===v)break e;for(;S.sibling===null;){if(S.return===null||S.return===v)break e;N===S&&(N=null),S=S.return}N===S&&(N=null),S.sibling.return=S.return,S=S.sibling}}G&4&&(G=v.updateQueue,G!==null&&(N=G.retryQueue,N!==null&&(G.retryQueue=null,th(v,N))));break;case 19:wo(S,v),Ra(v),G&4&&(G=v.updateQueue,G!==null&&(v.updateQueue=null,th(v,G)));break;case 21:break;default:wo(S,v),Ra(v)}}function Ra(v){var S=v.flags;if(S&2){try{if(jo&&(!Ro||v.tag!==27)){e:{for(var N=v.return;N!==null;){if(xo(N)){var G=N;break e}N=N.return}throw Error(i(160))}switch(G.tag){case 27:if(Ro){var oe=G.stateNode,me=To(v);L_(v,me,oe);break}case 5:var He=G.stateNode;G.flags&32&&(qd(He),G.flags&=-33);var ht=To(v);L_(v,ht,He);break;case 3:case 4:var Tt=G.stateNode.containerInfo,qt=To(v);D_(v,qt,Tt);break;default:throw Error(i(161))}}}catch(C){Si(v,v.return,C)}v.flags&=-3}S&4096&&(v.flags&=-4097)}function gy(v){if(v.subtreeFlags&1024)for(v=v.child;v!==null;){var S=v;gy(S),S.tag===5&&S.flags&1024&&lr(S.stateNode),v=v.sibling}}function jl(v,S){if(S.subtreeFlags&8772)for(S=S.child;S!==null;)ln(v,S.alternate,S),S=S.sibling}function Ud(v){for(v=v.child;v!==null;){var S=v;switch(S.tag){case 0:case 11:case 14:case 15:bu(4,S,S.return),Ud(S);break;case 1:Aa(S,S.return);var N=S.stateNode;typeof N.componentWillUnmount=="function"&&Hp(S,S.return,N),Ud(S);break;case 26:case 27:case 5:Aa(S,S.return),Ud(S);break;case 22:Aa(S,S.return),S.memoizedState===null&&Ud(S);break;default:Ud(S)}v=v.sibling}}function dl(v,S,N){for(N=N&&(S.subtreeFlags&8772)!==0,S=S.child;S!==null;){var G=S.alternate,oe=v,me=S,He=me.flags;switch(me.tag){case 0:case 11:case 15:dl(oe,me,N),N0(4,me);break;case 1:if(dl(oe,me,N),G=me,oe=G.stateNode,typeof oe.componentDidMount=="function")try{oe.componentDidMount()}catch(qt){Si(G,G.return,qt)}if(G=me,oe=G.updateQueue,oe!==null){var ht=G.stateNode;try{var Tt=oe.shared.hiddenCallbacks;if(Tt!==null)for(oe.shared.hiddenCallbacks=null,oe=0;oe<Tt.length;oe++)Me(Tt[oe],ht)}catch(qt){Si(G,G.return,qt)}}N&&He&64&&P0(me),Bf(me,me.return);break;case 26:case 27:case 5:dl(oe,me,N),N&&G===null&&He&4&&P_(me),Bf(me,me.return);break;case 12:dl(oe,me,N);break;case 13:dl(oe,me,N),N&&He&4&&Yr(oe,me);break;case 22:me.memoizedState===null&&dl(oe,me,N),Bf(me,me.return);break;default:dl(oe,me,N)}S=S.sibling}}function Qh(v,S){var N=null;v!==null&&v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(N=v.memoizedState.cachePool.pool),v=null,S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(v=S.memoizedState.cachePool.pool),v!==N&&(v!=null&&v.refCount++,N!=null&&Uf(N))}function U0(v,S){v=null,S.alternate!==null&&(v=S.alternate.memoizedState.cache),S=S.memoizedState.cache,S!==v&&(S.refCount++,v!=null&&Uf(v))}function Ue(v,S,N,G){if(S.subtreeFlags&10256)for(S=S.child;S!==null;)Ff(v,S,N,G),S=S.sibling}function Ff(v,S,N,G){var oe=S.flags;switch(S.tag){case 0:case 11:case 15:Ue(v,S,N,G),oe&2048&&N0(9,S);break;case 3:Ue(v,S,N,G),oe&2048&&(v=null,S.alternate!==null&&(v=S.alternate.memoizedState.cache),S=S.memoizedState.cache,S!==v&&(S.refCount++,v!=null&&Uf(v)));break;case 12:if(oe&2048){Ue(v,S,N,G),v=S.stateNode;try{var me=S.memoizedProps,He=me.id,ht=me.onPostCommit;typeof ht=="function"&&ht(He,S.alternate===null?"mount":"update",v.passiveEffectDuration,-0)}catch(Tt){Si(S,S.return,Tt)}}else Ue(v,S,N,G);break;case 23:break;case 22:me=S.stateNode,S.memoizedState!==null?me._visibility&4?Ue(v,S,N,G):ia(v,S):me._visibility&4?Ue(v,S,N,G):(me._visibility|=4,zl(v,S,N,G,(S.subtreeFlags&10256)!==0)),oe&2048&&Qh(S.alternate,S);break;case 24:Ue(v,S,N,G),oe&2048&&U0(S.alternate,S);break;default:Ue(v,S,N,G)}}function zl(v,S,N,G,oe){for(oe=oe&&(S.subtreeFlags&10256)!==0,S=S.child;S!==null;){var me=v,He=S,ht=N,Tt=G,qt=He.flags;switch(He.tag){case 0:case 11:case 15:zl(me,He,ht,Tt,oe),N0(8,He);break;case 23:break;case 22:var C=He.stateNode;He.memoizedState!==null?C._visibility&4?zl(me,He,ht,Tt,oe):ia(me,He):(C._visibility|=4,zl(me,He,ht,Tt,oe)),oe&&qt&2048&&Qh(He.alternate,He);break;case 24:zl(me,He,ht,Tt,oe),oe&&qt&2048&&U0(He.alternate,He);break;default:zl(me,He,ht,Tt,oe)}S=S.sibling}}function ia(v,S){if(S.subtreeFlags&10256)for(S=S.child;S!==null;){var N=v,G=S,oe=G.flags;switch(G.tag){case 22:ia(N,G),oe&2048&&Qh(G.alternate,G);break;case 24:ia(N,G),oe&2048&&U0(G.alternate,G);break;default:ia(N,G)}S=S.sibling}}function Mr(v){if(v.subtreeFlags&Gt)for(v=v.child;v!==null;)ef(v),v=v.sibling}function ef(v){switch(v.tag){case 26:Mr(v),v.flags&Gt&&(v.memoizedState!==null?vS(xt,v.memoizedState,v.memoizedProps):Y_(v.type,v.memoizedProps));break;case 5:Mr(v),v.flags&Gt&&Y_(v.type,v.memoizedProps);break;case 3:case 4:if(zo){var S=xt;xt=hh(v.stateNode.containerInfo),Mr(v),xt=S}else Mr(v);break;case 22:v.memoizedState===null&&(S=v.alternate,S!==null&&S.memoizedState!==null?(S=Gt,Gt=16777216,Mr(v),Gt=S):Mr(v));break;default:Mr(v)}}function nh(v){var S=v.alternate;if(S!==null&&(v=S.child,v!==null)){S.child=null;do S=v.sibling,v.sibling=null,v=S;while(v!==null)}}function pl(v){var S=v.deletions;if((v.flags&16)!==0){if(S!==null)for(var N=0;N<S.length;N++){var G=S[N];ke=G,_y(G,v)}nh(v)}if(v.subtreeFlags&10256)for(v=v.child;v!==null;)jf(v),v=v.sibling}function jf(v){switch(v.tag){case 0:case 11:case 15:pl(v),v.flags&2048&&bu(9,v,v.return);break;case 3:pl(v);break;case 12:pl(v);break;case 22:var S=v.stateNode;v.memoizedState!==null&&S._visibility&4&&(v.return===null||v.return.tag!==13)?(S._visibility&=-5,fc(v)):pl(v);break;default:pl(v)}}function fc(v){var S=v.deletions;if((v.flags&16)!==0){if(S!==null)for(var N=0;N<S.length;N++){var G=S[N];ke=G,_y(G,v)}nh(v)}for(v=v.child;v!==null;){switch(S=v,S.tag){case 0:case 11:case 15:bu(8,S,S.return),fc(S);break;case 22:N=S.stateNode,N._visibility&4&&(N._visibility&=-5,fc(S));break;default:fc(S)}v=v.sibling}}function _y(v,S){for(;ke!==null;){var N=ke;switch(N.tag){case 0:case 11:case 15:bu(8,N,S);break;case 23:case 22:if(N.memoizedState!==null&&N.memoizedState.cachePool!==null){var G=N.memoizedState.cachePool.pool;G!=null&&G.refCount++}break;case 24:Uf(N.memoizedState.cache)}if(G=N.child,G!==null)G.return=N,ke=G;else e:for(N=v;ke!==null;){G=ke;var oe=G.sibling,me=G.return;if(fn(G),G===N){ke=null;break e}if(oe!==null){oe.return=me,ke=oe;break e}ke=me}}}function U_(v){var S=Y0(v);if(S!=null){if(typeof S.memoizedProps["data-testname"]!="string")throw Error(i(364));return S}if(v=X_(v),v===null)throw Error(i(362));return v.stateNode.current}function vy(v,S){var N=v.tag;switch(S.$$typeof){case un:if(v.type===S.value)return!0;break;case Vn:e:{for(S=S.value,v=[v,0],N=0;N<v.length;){var G=v[N++],oe=G.tag,me=v[N++],He=S[me];if(oe!==5&&oe!==26&&oe!==27||!$d(G)){for(;He!=null&&vy(G,He);)me++,He=S[me];if(me===S.length){S=!0;break e}else for(G=G.child;G!==null;)v.push(G,me),G=G.sibling}}S=!1}return S;case qn:if((N===5||N===26||N===27)&&Py(v.stateNode,S.value))return!0;break;case Vt:if((N===5||N===6||N===26||N===27)&&(v=Ca(v),v!==null&&0<=v.indexOf(S.value)))return!0;break;case sr:if((N===5||N===26||N===27)&&(v=v.memoizedProps["data-testname"],typeof v=="string"&&v.toLowerCase()===S.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function Bo(v){switch(v.$$typeof){case un:return"<"+(o(v.value)||"Unknown")+">";case Vn:return":has("+(Bo(v)||"")+")";case qn:return'[role="'+v.value+'"]';case Vt:return'"'+v.value+'"';case sr:return'[data-testname="'+v.value+'"]';default:throw Error(i(365))}}function B0(v,S){var N=[];v=[v,0];for(var G=0;G<v.length;){var oe=v[G++],me=oe.tag,He=v[G++],ht=S[He];if(me!==5&&me!==26&&me!==27||!$d(oe)){for(;ht!=null&&vy(oe,ht);)He++,ht=S[He];if(He===S.length)N.push(oe);else for(oe=oe.child;oe!==null;)v.push(oe,He),oe=oe.sibling}}return N}function zf(v,S){if(!Hr)throw Error(i(363));v=U_(v),v=B0(v,S),S=[],v=Array.from(v);for(var N=0;N<v.length;){var G=v[N++],oe=G.tag;if(oe===5||oe===26||oe===27)$d(G)||S.push(G.stateNode);else for(G=G.child;G!==null;)v.push(G),G=G.sibling}return S}function qa(){if((Jt&2)!==0&&Gn!==0)return Gn&-Gn;if(yr.T!==null){var v=xs;return v!==0?v:Pt()}return ky()}function F0(){Ja===0&&(Ja=(Gn&536870912)===0||Lr?P():536870912);var v=Yl.current;return v!==null&&(v.flags|=32),Ja}function Ya(v,S,N){(v===Cn&&bn===2||v.cancelPendingCommit!==null)&&(gl(v,0),Gs(v,Gn,Ja,!1)),z(v,N),((Jt&2)===0||v!==Cn)&&(v===Cn&&((Jt&2)===0&&(qc|=N),ti===4&&Gs(v,Gn,Ja,!1)),_e(v))}function ml(v,S,N){if((Jt&6)!==0)throw Error(i(327));var G=!N&&(S&60)===0&&(S&v.expiredLanes)===0||k(v,S),oe=G?Ns(v,S):z0(v,S,!0),me=G;do{if(oe===0){Zi&&!G&&Gs(v,S,0,!1);break}else if(oe===6)Gs(v,S,0,!Vr);else{if(N=v.current.alternate,me&&!zc(N)){oe=z0(v,S,!1),me=!1;continue}if(oe===2){if(me=S,v.errorRecoveryDisabledLanes&me)var He=0;else He=v.pendingLanes&-536870913,He=He!==0?He:He&536870912?536870912:0;if(He!==0){S=He;e:{var ht=v;oe=Yc;var Tt=Gc&&ht.current.memoizedState.isDehydrated;if(Tt&&(gl(ht,He).flags|=256),He=z0(ht,He,!1),He!==2){if(fa&&!Tt){ht.errorRecoveryDisabledLanes|=me,qc|=me,oe=4;break e}me=Tl,Tl=oe,me!==null&&j0(me)}oe=He}if(me=!1,oe!==2)continue}}if(oe===1){gl(v,0),Gs(v,S,0,!0);break}e:{switch(G=v,oe){case 0:case 1:throw Error(i(345));case 4:if((S&4194176)===S){Gs(G,S,Ja,!Vr);break e}break;case 2:Tl=null;break;case 3:case 5:break;default:throw Error(i(329))}if(G.finishedWork=N,G.finishedLanes=S,(S&62914560)===S&&(me=hm+300-cr(),10<me)){if(Gs(G,S,Ja,!Vr),T(G,0)!==0)break e;G.timeoutHandle=My(tf.bind(null,G,N,Tl,hf,sv,S,Ja,qc,mh,Vr,2,-0,0),me);break e}tf(G,N,Tl,hf,sv,S,Ja,qc,mh,Vr,0,-0,0)}}break}while(!0);_e(v)}function j0(v){Tl===null?Tl=v:Tl.push.apply(Tl,v)}function tf(v,S,N,G,oe,me,He,ht,Tt,qt,C,E,A){var O=S.subtreeFlags;if((O&8192||(O&16785408)===16785408)&&(Xf(),ef(S),S=Ny(),S!==null)){v.cancelPendingCommit=S($p.bind(null,v,N,G,oe,He,ht,Tt,1,E,A)),Gs(v,me,He,!qt);return}$p(v,N,G,oe,He,ht,Tt,C,E,A)}function zc(v){for(var S=v;;){var N=S.tag;if((N===0||N===11||N===15)&&S.flags&16384&&(N=S.updateQueue,N!==null&&(N=N.stores,N!==null)))for(var G=0;G<N.length;G++){var oe=N[G],me=oe.getSnapshot;oe=oe.value;try{if(!ka(me(),oe))return!1}catch{return!1}}if(N=S.child,S.subtreeFlags&16384&&N!==null)N.return=S,S=N;else{if(S===v)break;for(;S.sibling===null;){if(S.return===null||S.return===v)return!0;S=S.return}S.sibling.return=S.return,S=S.sibling}}return!0}function Gs(v,S,N,G){S&=~Jd,S&=~qc,v.suspendedLanes|=S,v.pingedLanes&=~S,G&&(v.warmLanes|=S),G=v.expirationTimes;for(var oe=S;0<oe;){var me=31-Ma(oe),He=1<<me;G[me]=-1,oe&=~He}N!==0&&L(v,N,S)}function Hf(){return(Jt&6)===0?(we(0),!1):!0}function Vf(){if(Tn!==null){if(bn===0)var v=Tn.return;else v=Tn,Ia=Ts=null,hs(v),ql=null,pg=0,v=Tn;for(;v!==null;)my(v.alternate,v),v=v.return;Tn=null}}function gl(v,S){v.finishedWork=null,v.finishedLanes=0;var N=v.timeoutHandle;N!==yl&&(v.timeoutHandle=yl,q0(N)),N=v.cancelPendingCommit,N!==null&&(v.cancelPendingCommit=null,N()),Vf(),Cn=v,Tn=N=ih(v.current,null),Gn=S,bn=0,wn=null,Vr=!1,Zi=k(v,S),fa=!1,mh=Ja=Jd=qc=da=ti=0,Tl=Yc=null,sv=!1,(S&8)!==0&&(S|=S&32);var G=v.entangledLanes;if(G!==0)for(v=v.entanglements,G&=S;0<G;){var oe=31-Ma(G),me=1<<oe;S|=v[oe],G&=~me}return Ei=S,te(),N}function B_(v,S){Fr=null,yr.H=Fi,S===hg?(S=rt(),bn=3):S===fg?(S=rt(),bn=4):bn=S===ES?8:S!==null&&typeof S=="object"&&typeof S.then=="function"?6:1,wn=S,Tn===null&&(ti=1,ea(v,Q(S,v.current)))}function F_(){var v=Yl.current;return v===null?!0:(Gn&4194176)===Gn?Kl===null:(Gn&62914560)===Gn||(Gn&536870912)!==0?v===Kl:!1}function Bd(){var v=yr.H;return yr.H=Fi,v===null?Fi:v}function vr(){var v=yr.A;return yr.A=Wt,v}function Fo(){ti=4,Vr||(Gn&4194176)!==Gn&&Yl.current!==null||(Zi=!0),(da&134217727)===0&&(qc&134217727)===0||Cn===null||Gs(Cn,Gn,Ja,!1)}function z0(v,S,N){var G=Jt;Jt|=2;var oe=Bd(),me=vr();(Cn!==v||Gn!==S)&&(hf=null,gl(v,S)),S=!1;var He=ti;e:do try{if(bn!==0&&Tn!==null){var ht=Tn,Tt=wn;switch(bn){case 8:Vf(),He=6;break e;case 3:case 2:case 6:Yl.current===null&&(S=!0);var qt=bn;if(bn=0,wn=null,Fd(v,ht,Tt,qt),N&&Zi){He=0;break e}break;default:qt=bn,bn=0,wn=null,Fd(v,ht,Tt,qt)}}rS(),He=ti;break}catch(C){B_(v,C)}while(!0);return S&&v.shellSuspendCounter++,Ia=Ts=null,Jt=G,yr.H=oe,yr.A=me,Tn===null&&(Cn=null,Gn=0,te()),He}function rS(){for(;Tn!==null;)Vp(Tn)}function Ns(v,S){var N=Jt;Jt|=2;var G=Bd(),oe=vr();Cn!==v||Gn!==S?(hf=null,lo=cr()+500,gl(v,S)):Zi=k(v,S);e:do try{if(bn!==0&&Tn!==null){S=Tn;var me=wn;t:switch(bn){case 1:bn=0,wn=null,Fd(v,S,me,1);break;case 2:if(We(me)){bn=0,wn=null,Gf(S);break}S=function(){bn===2&&Cn===v&&(bn=7),_e(v)},me.then(S,S);break e;case 3:bn=7;break e;case 4:bn=5;break e;case 7:We(me)?(bn=0,wn=null,Gf(S)):(bn=0,wn=null,Fd(v,S,me,7));break;case 5:var He=null;switch(Tn.tag){case 26:He=Tn.memoizedState;case 5:case 27:var ht=Tn,Tt=ht.type,qt=ht.pendingProps;if(He?Wy(He):bl(Tt,qt)){bn=0,wn=null;var C=ht.sibling;if(C!==null)Tn=C;else{var E=ht.return;E!==null?(Tn=E,sa(E)):Tn=null}break t}}bn=0,wn=null,Fd(v,S,me,5);break;case 6:bn=0,wn=null,Fd(v,S,me,6);break;case 8:Vf(),ti=6;break e;default:throw Error(i(462))}}H0();break}catch(A){B_(v,A)}while(!0);return Ia=Ts=null,yr.H=G,yr.A=oe,Jt=N,Tn!==null?0:(Cn=null,Gn=0,te(),ti)}function H0(){for(;Tn!==null&&!yS();)Vp(Tn)}function Vp(v){var S=Yi(v.alternate,v,Ei);v.memoizedProps=v.pendingProps,S===null?sa(v):Tn=S}function Gf(v){var S=v,N=S.alternate;switch(S.tag){case 15:case 0:S=Ga(N,S,S.pendingProps,S.type,void 0,Gn);break;case 11:S=Ga(N,S,S.pendingProps,S.type.render,S.ref,Gn);break;case 5:hs(S);default:my(N,S),S=Tn=jd(S,Ei),S=Yi(N,S,Ei)}v.memoizedProps=v.pendingProps,S===null?sa(v):Tn=S}function Fd(v,S,N,G){Ia=Ts=null,hs(S),ql=null,pg=0;var oe=S.return;try{if(Eo(v,oe,S,N,Gn)){ti=1,ea(v,Q(N,v.current)),Tn=null;return}}catch(me){if(oe!==null)throw Tn=oe,me;ti=1,ea(v,Q(N,v.current)),Tn=null;return}S.flags&32768?(Lr||G===1?v=!0:Zi||(Gn&536870912)!==0?v=!1:(Vr=v=!0,(G===2||G===3||G===6)&&(G=Yl.current,G!==null&&G.tag===13&&(G.flags|=16384))),Gp(S,v)):sa(S)}function sa(v){var S=v;do{if((S.flags&32768)!==0){Gp(S,Vr);return}v=S.return;var N=eh(S.alternate,S,Ei);if(N!==null){Tn=N;return}if(S=S.sibling,S!==null){Tn=S;return}Tn=S=v}while(S!==null);ti===0&&(ti=5)}function Gp(v,S){do{var N=tS(v.alternate,v);if(N!==null){N.flags&=32767,Tn=N;return}if(N=v.return,N!==null&&(N.flags|=32768,N.subtreeFlags=0,N.deletions=null),!S&&(v=v.sibling,v!==null)){Tn=v;return}Tn=v=N}while(v!==null);ti=6,Tn=null}function $p(v,S,N,G,oe,me,He,ht,Tt,qt){var C=yr.T,E=gc();try{Ka(2),yr.T=null,hT(v,S,N,G,E,oe,me,He,ht,Tt,qt)}finally{yr.T=C,Ka(E)}}function hT(v,S,N,G,oe,me,He,ht){do Hc();while(gh!==null);if((Jt&6)!==0)throw Error(i(327));var Tt=v.finishedWork;if(G=v.finishedLanes,Tt===null)return null;if(v.finishedWork=null,v.finishedLanes=0,Tt===v.current)throw Error(i(177));v.callbackNode=null,v.callbackPriority=0,v.cancelPendingCommit=null;var qt=Tt.lanes|Tt.childLanes;if(qt|=Xy,I(v,G,qt,me,He,ht),v===Cn&&(Tn=Cn=null,Gn=0),(Tt.subtreeFlags&10256)===0&&(Tt.flags&10256)===0||_g||(_g=!0,xS=qt,ET=N,xy(Ps,function(){return Hc(),null})),N=(Tt.flags&15990)!==0,(Tt.subtreeFlags&15990)!==0||N?(N=yr.T,yr.T=null,me=gc(),Ka(2),He=Jt,Jt|=4,vn(v,Tt),L0(Tt,v),W_(v.containerInfo),v.current=Tt,ln(v,Tt.alternate,Tt),Gl(),Jt=He,Ka(me),yr.T=N):v.current=Tt,_g?(_g=!1,gh=v,ff=G):j_(v,qt),qt=v.pendingLanes,qt===0&&(pa=null),Z(Tt.stateNode),_e(v),S!==null)for(oe=v.onRecoverableError,Tt=0;Tt<S.length;Tt++)qt=S[Tt],oe(qt.value,{componentStack:qt.stack});return(ff&3)!==0&&Hc(),qt=v.pendingLanes,(G&4194218)!==0&&(qt&42)!==0?v===Kc?Vo++:(Vo=0,Kc=v):Vo=0,we(0),null}function j_(v,S){(v.pooledCacheLanes&=S)===0&&(S=v.pooledCache,S!=null&&(v.pooledCache=null,Uf(S)))}function Hc(){if(gh!==null){var v=gh,S=xS;xS=0;var N=F(ff),G=32>N?32:N;N=yr.T;var oe=gc();try{if(Ka(G),yr.T=null,gh===null)var me=!1;else{G=ET,ET=null;var He=gh,ht=ff;if(gh=null,ff=0,(Jt&6)!==0)throw Error(i(331));var Tt=Jt;if(Jt|=4,jf(He.current),Ff(He,He.current,ht,G),Jt=Tt,we(0,!1),Xa&&typeof Xa.onPostCommitFiberRoot=="function")try{Xa.onPostCommitFiberRoot(vc,He)}catch{}me=!0}return me}finally{Ka(oe),yr.T=N,j_(v,S)}}return!1}function yy(v,S,N){S=Q(N,S),S=hc(v.stateNode,S,2),v=Se(v,S,2),v!==null&&(z(v,2),_e(v))}function Si(v,S,N){if(v.tag===3)yy(v,v,N);else for(;S!==null;){if(S.tag===3){yy(S,v,N);break}else if(S.tag===1){var G=S.stateNode;if(typeof S.type.getDerivedStateFromError=="function"||typeof G.componentDidCatch=="function"&&(pa===null||!pa.has(G))){v=Q(N,v),N=k_(2),G=Se(S,N,2),G!==null&&(Kh(N,G,S,v),z(G,2),_e(G));break}}S=S.return}}function rh(v,S,N){var G=v.pingCache;if(G===null){G=v.pingCache=new nr;var oe=new Set;G.set(S,oe)}else oe=G.get(S),oe===void 0&&(oe=new Set,G.set(S,oe));oe.has(N)||(fa=!0,oe.add(N),v=by.bind(null,v,S,N),S.then(v,v))}function by(v,S,N){var G=v.pingCache;G!==null&&G.delete(S),v.pingedLanes|=v.suspendedLanes&N,v.warmLanes&=~N,Cn===v&&(Gn&N)===N&&(ti===4||ti===3&&(Gn&62914560)===Gn&&300>cr()-hm?(Jt&2)===0&&gl(v,0):Jd|=N,mh===Gn&&(mh=0)),_e(v)}function Sy(v,S){S===0&&(S=B()),v=De(v,S),v!==null&&(z(v,S),_e(v))}function Ey(v){var S=v.memoizedState,N=0;S!==null&&(N=S.retryLane),Sy(v,N)}function iS(v,S){var N=0;switch(v.tag){case 13:var G=v.stateNode,oe=v.memoizedState;oe!==null&&(N=oe.retryLane);break;case 19:G=v.stateNode;break;case 22:G=v.stateNode._retryCache;break;default:throw Error(i(314))}G!==null&&G.delete(S),Sy(v,N)}function xy(v,S){return _c(v,S)}function Wp(v,S,N,G){this.tag=v,this.key=N,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=S,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=G,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function z_(v){return v=v.prototype,!(!v||!v.isReactComponent)}function ih(v,S){var N=v.alternate;return N===null?(N=t(v.tag,S,v.key,v.mode),N.elementType=v.elementType,N.type=v.type,N.stateNode=v.stateNode,N.alternate=v,v.alternate=N):(N.pendingProps=S,N.type=v.type,N.flags=0,N.subtreeFlags=0,N.deletions=null),N.flags=v.flags&31457280,N.childLanes=v.childLanes,N.lanes=v.lanes,N.child=v.child,N.memoizedProps=v.memoizedProps,N.memoizedState=v.memoizedState,N.updateQueue=v.updateQueue,S=v.dependencies,N.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext},N.sibling=v.sibling,N.index=v.index,N.ref=v.ref,N.refCleanup=v.refCleanup,N}function jd(v,S){v.flags&=31457282;var N=v.alternate;return N===null?(v.childLanes=0,v.lanes=S,v.child=null,v.subtreeFlags=0,v.memoizedProps=null,v.memoizedState=null,v.updateQueue=null,v.dependencies=null,v.stateNode=null):(v.childLanes=N.childLanes,v.lanes=N.lanes,v.child=N.child,v.subtreeFlags=0,v.deletions=null,v.memoizedProps=N.memoizedProps,v.memoizedState=N.memoizedState,v.updateQueue=N.updateQueue,v.type=N.type,S=N.dependencies,v.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext}),v}function qp(v,S,N,G,oe,me){var He=0;if(G=v,typeof v=="function")z_(v)&&(He=1);else if(typeof v=="string")He=zo&&Ro?uh(v,N,Co.current)?26:nv(v)?27:5:zo?uh(v,N,Co.current)?26:5:Ro&&nv(v)?27:5;else e:switch(v){case hr:return Su(N.children,oe,me,S);case aa:He=8,oe|=24;break;case _l:return v=t(12,N,S,oe|2),v.elementType=_l,v.lanes=me,v;case Kp:return v=t(13,N,S,oe),v.elementType=Kp,v.lanes=me,v;case pc:return v=t(19,N,S,oe),v.elementType=pc,v.lanes=me,v;case nf:return Ty(N,oe,me,S);default:if(typeof v=="object"&&v!==null)switch(v.$$typeof){case wy:case ms:He=10;break e;case W0:He=9;break e;case sh:He=11;break e;case $t:He=14;break e;case $s:He=16,G=null;break e}He=29,N=Error(i(130,v===null?"null":typeof v,"")),G=null}return S=t(He,N,S,oe),S.elementType=v,S.type=G,S.lanes=me,S}function Su(v,S,N,G){return v=t(7,v,G,S),v.lanes=N,v}function Ty(v,S,N,G){v=t(22,v,G,S),v.elementType=nf,v.lanes=N;var oe={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var me=oe._current;if(me===null)throw Error(i(456));if((oe._pendingVisibility&2)===0){var He=De(me,2);He!==null&&(oe._pendingVisibility|=2,Ya(He,me,2))}},attach:function(){var me=oe._current;if(me===null)throw Error(i(456));if((oe._pendingVisibility&2)!==0){var He=De(me,2);He!==null&&(oe._pendingVisibility&=-3,Ya(He,me,2))}}};return v.stateNode=oe,v}function zd(v,S,N){return v=t(6,v,null,S),v.lanes=N,v}function V0(v,S,N){return S=t(4,v.children!==null?v.children:[],v.key,S),S.lanes=N,S.stateNode={containerInfo:v.containerInfo,pendingChildren:null,implementation:v.implementation},S}function H_(v,S,N,G,oe,me,He,ht){this.tag=1,this.containerInfo=v,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=yl,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=U(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=U(0),this.hiddenUpdates=U(null),this.identifierPrefix=G,this.onUncaughtError=oe,this.onCaughtError=me,this.onRecoverableError=He,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ht,this.incompleteTransitions=new Map}function yn(v,S,N,G,oe,me,He,ht,Tt,qt,C,E){return v=new H_(v,S,N,He,ht,Tt,qt,E),S=1,me===!0&&(S|=24),me=t(3,null,null,S),v.current=me,me.stateNode=v,S=N_(),S.refCount++,v.pooledCache=S,S.refCount++,me.memoizedState={element:G,isDehydrated:N,cache:S},ce(me),v}function Kr(v){return v?(v=fh,v):fh}function sS(v){var S=v._reactInternals;if(S===void 0)throw typeof v.render=="function"?Error(i(188)):(v=Object.keys(v).join(","),Error(i(268,v)));return v=d(S),v=v!==null?p(v):null,v===null?null:oh(v.stateNode)}function oS(v,S,N,G,oe,me){oe=Kr(oe),G.context===null?G.context=oe:G.pendingContext=oe,G=le(S),G.payload={element:N},me=me===void 0?null:me,me!==null&&(G.callback=me),N=Se(v,G,S),N!==null&&(Ya(N,v,S),Ae(N,v,S))}function Yp(v,S){if(v=v.memoizedState,v!==null&&v.dehydrated!==null){var N=v.retryLane;v.retryLane=N!==0&&N<S?N:S}}function G0(v,S){Yp(v,S),(v=v.alternate)&&Yp(v,S)}var ai={},Hd=Fk(),ps=bW(),oa=Object.assign,$0=Symbol.for("react.element"),dc=Symbol.for("react.transitional.element"),$f=Symbol.for("react.portal"),hr=Symbol.for("react.fragment"),aa=Symbol.for("react.strict_mode"),_l=Symbol.for("react.profiler"),wy=Symbol.for("react.provider"),W0=Symbol.for("react.consumer"),ms=Symbol.for("react.context"),sh=Symbol.for("react.forward_ref"),Kp=Symbol.for("react.suspense"),pc=Symbol.for("react.suspense_list"),$t=Symbol.for("react.memo"),$s=Symbol.for("react.lazy"),nf=Symbol.for("react.offscreen"),V_=Symbol.for("react.memo_cache_sentinel"),Hl=Symbol.iterator,G_=Symbol.for("react.client.reference"),yr=Hd.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Vd,Ay,Wf=!1,Xp=Array.isArray,Ry=e.rendererVersion,mc=e.rendererPackageName,vl=e.extraDevToolsConfig,oh=e.getPublicInstance,qf=e.getRootHostContext,$_=e.getChildHostContext,Cy=e.prepareForCommit,W_=e.resetAfterCommit,Gd=e.createInstance,Yf=e.appendInitialChild,q_=e.finalizeInitialChildren,Zp=e.shouldSetTextContent,Kf=e.createTextInstance,My=e.scheduleTimeout,q0=e.cancelTimeout,yl=e.noTimeout,Vc=e.isPrimaryRenderer;e.warnsIfNotActing;var jo=e.supportsMutation,Vl=e.supportsPersistence,Gc=e.supportsHydration,Y0=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var aS=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var Ka=e.setCurrentUpdatePriority,gc=e.getCurrentUpdatePriority,ky=e.resolveUpdatePriority;e.resolveEventType,e.resolveEventTimeStamp;var Oy=e.shouldAttemptEagerTransition,fT=e.detachDeletedInstance;e.requestPostPaintCallback;var Iy=e.maySuspendCommit,bl=e.preloadInstance,Xf=e.startSuspendingCommit,Y_=e.suspendInstance,Ny=e.waitForCommitToBeReady,ss=e.NotPendingTransition,Sl=e.HostTransitionContext,lr=e.resetFormInstance;e.bindToConsole;var K_=e.supportsMicrotasks,ah=e.scheduleMicrotask,Hr=e.supportsTestSelectors,X_=e.findFiberRoot,Eu=e.getBoundingRect,Ca=e.getTextContent,$d=e.isHiddenSubtree,Py=e.matchAccessibilityRole,cS=e.setFocusIfFocusable,Ao=e.setupIntersectionObserver,ca=e.appendChild,Jp=e.appendChildToContainer,Wd=e.commitTextUpdate,Dy=e.commitMount,K0=e.commitUpdate,Zf=e.insertBefore,ch=e.insertInContainerBefore,Qp=e.removeChild,lh=e.removeChildFromContainer,qd=e.resetTextContent,Yd=e.hideInstance,X0=e.hideTextInstance,Z0=e.unhideInstance,J0=e.unhideTextInstance,em=e.clearContainer,Q0=e.cloneInstance,Ly=e.createContainerChildSet,xu=e.appendChildToContainerChildSet,Kd=e.finalizeContainerChildren,Uy=e.replaceContainerChildren,By=e.cloneHiddenInstance,Fy=e.cloneHiddenTextInstance,tm=e.isSuspenseInstancePending,Z_=e.isSuspenseInstanceFallback,lS=e.getSuspenseInstanceFallbackErrorDetails,uS=e.registerSuspenseInstanceRetry,hS=e.canHydrateFormStateMarker,dT=e.isFormStateMarkerMatching,jy=e.getNextHydratableSibling,zy=e.getFirstHydratableChild,oo=e.getFirstHydratableChildWithinContainer,fS=e.getFirstHydratableChildWithinSuspenseInstance,Hy=e.canHydrateInstance,pT=e.canHydrateTextInstance,Vy=e.canHydrateSuspenseInstance,mT=e.hydrateInstance,gT=e.hydrateTextInstance,_T=e.hydrateSuspenseInstance,Gy=e.getNextHydratableInstanceAfterSuspenseInstance,dS=e.commitHydratedContainer,vT=e.commitHydratedSuspenseInstance,yT=e.clearSuspenseBoundary,J_=e.clearSuspenseBoundaryFromContainer,nm=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var rm=e.validateHydratableInstance,im=e.validateHydratableTextInstance,zo=e.supportsResources,uh=e.isHostHoistableType,hh=e.getHoistableRoot,eg=e.getResource,pS=e.acquireResource,mS=e.releaseResource,tg=e.hydrateHoistable,$y=e.mountHoistable,gS=e.unmountHoistable,ng=e.createHoistableInstance,_S=e.prepareToCommitHoistables,rf=e.mayResourceSuspendCommit,Wy=e.preloadResource,vS=e.suspendResource,Ro=e.supportsSingletons,Q_=e.resolveSingletonInstance,qy=e.clearSingleton,ev=e.acquireSingletonInstance,tv=e.releaseSingletonInstance,nv=e.isHostSingletonType,rg=[],Xd=-1,fh={},Ma=Math.clz32?Math.clz32:y,la=Math.log,ig=Math.LN2,sg=128,og=4194304,_c=ps.unstable_scheduleCallback,ag=ps.unstable_cancelCallback,yS=ps.unstable_shouldYield,Gl=ps.unstable_requestPaint,cr=ps.unstable_now,bS=ps.unstable_ImmediatePriority,$c=ps.unstable_UserBlockingPriority,Ps=ps.unstable_NormalPriority,Jf=ps.unstable_IdlePriority,bT=ps.log,Yy=ps.unstable_setDisableYieldValue,vc=null,Xa=null,ka=typeof Object.is=="function"?Object.is:Y,os=new WeakMap,Ki=[],Zd=0,cg=null,sf=0,Wc=[],Za=0,dh=null,ao=1,ua="",Co=g(null),sm=g(null),of=g(null),$l=g(null),ir=null,Oa=null,Lr=!1,Wl=null,Xr=!1,Ky=Error(i(519)),El=[],ph=0,Xy=0,rv=null,om=null,Zy=!1,am=!1,lg=!1,cm=0,ug=null,Jy=0,xs=0,Ws=null,co=!1,yc=!1,Xi=Object.prototype.hasOwnProperty,hg=Error(i(460)),fg=Error(i(474)),dg={then:function(){}},Qf=null,ql=null,pg=0,ed=sn(!0),Qy=sn(!1),lm=g(null),iv=g(0),Yl=g(null),Kl=null,vi=g(0),af=0,Fr=null,Bi=null,gs=null,ha=!1,td=!1,nd=!1,mg=0,Ni=0,cf=null,SS=0,e1=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},Fi={readContext:Uo,use:Ot,useCallback:Un,useContext:Un,useEffect:Un,useImperativeHandle:Un,useLayoutEffect:Un,useInsertionEffect:Un,useMemo:Un,useReducer:Un,useRef:Un,useState:Un,useDebugValue:Un,useDeferredValue:Un,useTransition:Un,useSyncExternalStore:Un,useId:Un};Fi.useCacheRefresh=Un,Fi.useMemoCache=Un,Fi.useHostTransitionStatus=Un,Fi.useFormState=Un,Fi.useActionState=Un,Fi.useOptimistic=Un;var xl={readContext:Uo,use:Ot,useCallback:function(v,S){return Le().memoizedState=[v,S===void 0?null:S],v},useContext:Uo,useEffect:x_,useImperativeHandle:function(v,S,N){N=N!=null?N.concat([v]):null,cc(4194308,4,wa.bind(null,S,v),N)},useLayoutEffect:function(v,S){return cc(4194308,4,v,S)},useInsertionEffect:function(v,S){cc(4,2,v,S)},useMemo:function(v,S){var N=Le();S=S===void 0?null:S;var G=v();if(nd){$(!0);try{v()}finally{$(!1)}}return N.memoizedState=[G,S],G},useReducer:function(v,S,N){var G=Le();if(N!==void 0){var oe=N(S);if(nd){$(!0);try{N(S)}finally{$(!1)}}}else oe=S;return G.memoizedState=G.baseState=oe,v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:v,lastRenderedState:oe},G.queue=v,v=v.dispatch=fy.bind(null,Fr,v),[G.memoizedState,v]},useRef:function(v){var S=Le();return v={current:v},S.memoizedState=v},useState:function(v){v=Rr(v);var S=v.queue,N=Yu.bind(null,Fr,S);return S.dispatch=N,[v.memoizedState,N]},useDebugValue:Bc,useDeferredValue:function(v,S){var N=Le();return Ul(N,v,S)},useTransition:function(){var v=Rr(!1);return v=R0.bind(null,Fr,v.queue,!0,!1),Le().memoizedState=v,[!1,v]},useSyncExternalStore:function(v,S,N){var G=Fr,oe=Le();if(Lr){if(N===void 0)throw Error(i(407));N=N()}else{if(N=S(),Cn===null)throw Error(i(349));(Gn&60)!==0||rr(G,S,N)}oe.memoizedState=N;var me={value:N,getSnapshot:S};return oe.queue=me,x_(dr.bind(null,G,me,v),[v]),G.flags|=2048,ac(9,zn.bind(null,G,me,N,S),{destroy:void 0},null),N},useId:function(){var v=Le(),S=Cn.identifierPrefix;if(Lr){var N=ua,G=ao;N=(G&~(1<<32-Ma(G)-1)).toString(32)+N,S=":"+S+"R"+N,N=mg++,0<N&&(S+="H"+N.toString(32)),S+=":"}else N=SS++,S=":"+S+"r"+N.toString(32)+":";return v.memoizedState=S},useCacheRefresh:function(){return Le().memoizedState=Bl.bind(null,Fr)}};xl.useMemoCache=yt,xl.useHostTransitionStatus=lc,xl.useFormState=Ci,xl.useActionState=Ci,xl.useOptimistic=function(v){var S=Le();S.memoizedState=S.baseState=v;var N={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return S.queue=N,S=fl.bind(null,Fr,!0,N),N.dispatch=S,[v,S]};var lf={readContext:Uo,use:Ot,useCallback:hy,useContext:Uo,useEffect:w0,useImperativeHandle:uy,useInsertionEffect:T_,useLayoutEffect:A0,useMemo:w_,useReducer:Sn,useRef:is,useState:function(){return Sn(Qt)},useDebugValue:Bc,useDeferredValue:function(v,S){var N=mt();return Dp(N,Bi.memoizedState,v,S)},useTransition:function(){var v=Sn(Qt)[0],S=mt().memoizedState;return[typeof v=="boolean"?v:Ct(v),S]},useSyncExternalStore:or,useId:Lf};lf.useCacheRefresh=uc,lf.useMemoCache=yt,lf.useHostTransitionStatus=lc,lf.useFormState=xn,lf.useActionState=xn,lf.useOptimistic=function(v,S){var N=mt();return Dr(N,Bi,v,S)};var rd={readContext:Uo,use:Ot,useCallback:hy,useContext:Uo,useEffect:w0,useImperativeHandle:uy,useInsertionEffect:T_,useLayoutEffect:A0,useMemo:w_,useReducer:Dn,useRef:is,useState:function(){return Dn(Qt)},useDebugValue:Bc,useDeferredValue:function(v,S){var N=mt();return Bi===null?Ul(N,v,S):Dp(N,Bi.memoizedState,v,S)},useTransition:function(){var v=Dn(Qt)[0],S=mt().memoizedState;return[typeof v=="boolean"?v:Ct(v),S]},useSyncExternalStore:or,useId:Lf};rd.useCacheRefresh=uc,rd.useMemoCache=yt,rd.useHostTransitionStatus=lc,rd.useFormState=fs,rd.useActionState=fs,rd.useOptimistic=function(v,S){var N=mt();return Bi!==null?Dr(N,Bi,v,S):(N.baseState=v,[v,N.queue.dispatch])};var t1={isMounted:function(v){return(v=v._reactInternals)?h(v)===v:!1},enqueueSetState:function(v,S,N){v=v._reactInternals;var G=qa(),oe=le(G);oe.payload=S,N!=null&&(oe.callback=N),S=Se(v,oe,G),S!==null&&(Ya(S,v,G),Ae(S,v,G))},enqueueReplaceState:function(v,S,N){v=v._reactInternals;var G=qa(),oe=le(G);oe.tag=1,oe.payload=S,N!=null&&(oe.callback=N),S=Se(v,oe,G),S!==null&&(Ya(S,v,G),Ae(S,v,G))},enqueueForceUpdate:function(v,S){v=v._reactInternals;var N=qa(),G=le(N);G.tag=2,S!=null&&(G.callback=S),S=Se(v,G,N),S!==null&&(Ya(S,v,N),Ae(S,v,N))}},n1=typeof reportError=="function"?reportError:function(v){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var S=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof v=="object"&&v!==null&&typeof v.message=="string"?String(v.message):String(v),error:v});if(!window.dispatchEvent(S))return}else if(typeof oc=="object"&&typeof oc.emit=="function"){oc.emit("uncaughtException",v);return}console.error(v)},ES=Error(i(461)),qs=!1,Ys={dehydrated:null,treeContext:null,retryLane:0},uf=g(null),Ts=null,Ia=null,ST=typeof AbortController<"u"?AbortController:function(){var v=[],S=this.signal={aborted:!1,addEventListener:function(N,G){v.push(G)}};this.abort=function(){S.aborted=!0,v.forEach(function(N){return N()})}},gg=ps.unstable_scheduleCallback,um=ps.unstable_NormalPriority,ci={$$typeof:ms,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},Ho=yr.S;yr.S=function(v,S){typeof S=="object"&&S!==null&&typeof S.then=="function"&&vt(v,S),Ho!==null&&Ho(v,S)};var Xl=g(null),w=!1,D=!1,J=!1,ge=typeof WeakSet=="function"?WeakSet:Set,ke=null,Ge=!1,st=null,dt=!1,xt=null,Gt=8192,Wt={getCacheForType:function(v){var S=Uo(ci),N=S.data.get(v);return N===void 0&&(N=v(),S.data.set(v,N)),N}},un=0,Vn=1,qn=2,sr=3,Vt=4;if(typeof Symbol=="function"&&Symbol.for){var tn=Symbol.for;un=tn("selector.component"),Vn=tn("selector.has_pseudo_class"),qn=tn("selector.role"),sr=tn("selector.test_id"),Vt=tn("selector.text")}var nr=typeof WeakMap=="function"?WeakMap:Map,Jt=0,Cn=null,Tn=null,Gn=0,bn=0,wn=null,Vr=!1,Zi=!1,fa=!1,Ei=0,ti=0,da=0,qc=0,Jd=0,Ja=0,mh=0,Yc=null,Tl=null,sv=!1,hm=0,lo=1/0,hf=null,pa=null,_g=!1,gh=null,ff=0,xS=0,ET=null,Vo=0,Kc=null;return ai.attemptContinuousHydration=function(v){if(v.tag===13){var S=De(v,67108864);S!==null&&Ya(S,v,67108864),G0(v,67108864)}},ai.attemptHydrationAtCurrentPriority=function(v){if(v.tag===13){var S=qa(),N=De(v,S);N!==null&&Ya(N,v,S),G0(v,S)}},ai.attemptSynchronousHydration=function(v){switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var S=x(v.pendingLanes);if(S!==0){for(v.pendingLanes|=2,v.entangledLanes|=2;S;){var N=1<<31-Ma(S);v.entanglements[1]|=N,S&=~N}_e(v),(Jt&6)===0&&(lo=cr()+500,we(0))}}break;case 13:S=De(v,2),S!==null&&Ya(S,v,2),Hf(),G0(v,2)}},ai.batchedUpdates=function(v,S){return v(S)},ai.createComponentSelector=function(v){return{$$typeof:un,value:v}},ai.createContainer=function(v,S,N,G,oe,me,He,ht,Tt,qt){return yn(v,S,!1,null,N,G,me,He,ht,Tt,qt,null)},ai.createHasPseudoClassSelector=function(v){return{$$typeof:Vn,value:v}},ai.createHydrationContainer=function(v,S,N,G,oe,me,He,ht,Tt,qt,C,E,A){return v=yn(N,G,!0,v,oe,me,ht,Tt,qt,C,E,A),v.context=Kr(null),N=v.current,G=qa(),oe=le(G),oe.callback=S??null,Se(N,oe,G),v.current.lanes=G,z(v,G),_e(v),v},ai.createPortal=function(v,S,N){var G=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$f,key:G==null?null:""+G,children:v,containerInfo:S,implementation:N}},ai.createRoleSelector=function(v){return{$$typeof:qn,value:v}},ai.createTestNameSelector=function(v){return{$$typeof:sr,value:v}},ai.createTextSelector=function(v){return{$$typeof:Vt,value:v}},ai.defaultOnCaughtError=function(v){console.error(v)},ai.defaultOnRecoverableError=function(v){n1(v)},ai.defaultOnUncaughtError=function(v){n1(v)},ai.deferredUpdates=function(v){var S=yr.T,N=gc();try{return Ka(32),yr.T=null,v()}finally{Ka(N),yr.T=S}},ai.discreteUpdates=function(v,S,N,G,oe){var me=yr.T,He=gc();try{return Ka(2),yr.T=null,v(S,N,G,oe)}finally{Ka(He),yr.T=me,Jt===0&&(lo=cr()+500)}},ai.findAllNodes=zf,ai.findBoundingRects=function(v,S){if(!Hr)throw Error(i(363));S=zf(v,S),v=[];for(var N=0;N<S.length;N++)v.push(Eu(S[N]));for(S=v.length-1;0<S;S--){N=v[S];for(var G=N.x,oe=G+N.width,me=N.y,He=me+N.height,ht=S-1;0<=ht;ht--)if(S!==ht){var Tt=v[ht],qt=Tt.x,C=qt+Tt.width,E=Tt.y,A=E+Tt.height;if(G>=qt&&me>=E&&oe<=C&&He<=A){v.splice(S,1);break}else if(G!==qt||N.width!==Tt.width||A<me||E>He){if(!(me!==E||N.height!==Tt.height||C<G||qt>oe)){qt>G&&(Tt.width+=qt-G,Tt.x=G),C<oe&&(Tt.width=oe-qt),v.splice(S,1);break}}else{E>me&&(Tt.height+=E-me,Tt.y=me),A<He&&(Tt.height=He-E),v.splice(S,1);break}}}return v},ai.findHostInstance=sS,ai.findHostInstanceWithNoPortals=function(v){return v=d(v),v=v!==null?_(v):null,v===null?null:oh(v.stateNode)},ai.findHostInstanceWithWarning=function(v){return sS(v)},ai.flushPassiveEffects=Hc,ai.flushSyncFromReconciler=function(v){var S=Jt;Jt|=1;var N=yr.T,G=gc();try{if(Ka(2),yr.T=null,v)return v()}finally{Ka(G),yr.T=N,Jt=S,(Jt&6)===0&&we(0)}},ai.flushSyncWork=Hf,ai.focusWithin=function(v,S){if(!Hr)throw Error(i(363));for(v=U_(v),S=B0(v,S),S=Array.from(S),v=0;v<S.length;){var N=S[v++],G=N.tag;if(!$d(N)){if((G===5||G===26||G===27)&&cS(N.stateNode))return!0;for(N=N.child;N!==null;)S.push(N),N=N.sibling}}return!1},ai.getFindAllNodesFailureDescription=function(v,S){if(!Hr)throw Error(i(363));var N=0,G=[];v=[U_(v),0];for(var oe=0;oe<v.length;){var me=v[oe++],He=me.tag,ht=v[oe++],Tt=S[ht];if((He!==5&&He!==26&&He!==27||!$d(me))&&(vy(me,Tt)&&(G.push(Bo(Tt)),ht++,ht>N&&(N=ht)),ht<S.length))for(me=me.child;me!==null;)v.push(me,ht),me=me.sibling}if(N<S.length){for(v=[];N<S.length;N++)v.push(Bo(S[N]));return`findAllNodes was able to match part of the selector:
  `+(G.join(" > ")+`

No matching component was found for:
  `)+v.join(" > ")}return null},ai.getPublicRootInstance=function(v){if(v=v.current,!v.child)return null;switch(v.child.tag){case 27:case 5:return oh(v.child.stateNode);default:return v.child.stateNode}},ai.injectIntoDevTools=function(){var v={bundleType:0,version:Ry,rendererPackageName:mc,currentDispatcherRef:yr,findFiberByHostInstance:Y0,reconcilerVersion:"19.0.0"};if(vl!==null&&(v.rendererConfig=vl),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")v=!1;else{var S=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(S.isDisabled||!S.supportsFiber)v=!0;else{try{vc=S.inject(v),Xa=S}catch{}v=!!S.checkDCE}}return v},ai.isAlreadyRendering=function(){return!1},ai.observeVisibleRects=function(v,S,N,G){if(!Hr)throw Error(i(363));v=zf(v,S);var oe=Ao(v,N,G).disconnect;return{disconnect:function(){oe()}}},ai.shouldError=function(){return null},ai.shouldSuspend=function(){return!1},ai.startHostTransition=function(v,S,N,G){if(v.tag!==5)throw Error(i(476));var oe=ds(v).queue;R0(v,oe,S,ss,N===null?r:function(){var me=ds(v).next.queue;return Ku(v,me,{},qa()),N(G)})},ai.updateContainer=function(v,S,N,G){var oe=S.current,me=qa();return oS(oe,me,v,S,N,G),me},ai.updateContainerSync=function(v,S,N,G){return S.tag===0&&Hc(),oS(S.current,2,v,S,N,G),2},ai},n.exports.default=n.exports,Object.defineProperty(n.exports,"__esModule",{value:!0})})(oI)),oI.exports}var ZF;function _de(){return ZF||(ZF=1,sI.exports=gde()),sI.exports}var vde=_de();const yde=Dl(vde);var JF=bW();function SW(n){let e=n.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const EW=n=>n&&n.isOrthographicCamera,bde=n=>n!=null&&(typeof n=="string"||typeof n=="number"||n.isColor),u5=((n,e)=>typeof window<"u"&&(((n=window.document)==null?void 0:n.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?Qe.useLayoutEffect:Qe.useEffect;function xW(n){const e=Qe.useRef(n);return u5(()=>void(e.current=n),[n]),e}function TW(n){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(n)?Math.min(Math.max(n[0],t),n[1]):n}function $S(n){var e;return(e=n.__r3f)==null?void 0:e.root.getState()}const No={obj:n=>n===Object(n)&&!No.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,nul:n=>n===null,arr:n=>Array.isArray(n),equ(n,e,{arrays:t="shallow",objects:r="reference",strict:i=!0}={}){if(typeof n!=typeof e||!!n!=!!e)return!1;if(No.str(n)||No.num(n)||No.boo(n))return n===e;const s=No.obj(n);if(s&&r==="reference")return n===e;const o=No.arr(n);if(o&&t==="reference")return n===e;if((o||s)&&n===e)return!0;let a;for(a in n)if(!(a in e))return!1;if(s&&t==="shallow"&&r==="shallow"){for(a in i?e:n)if(!No.equ(n[a],e[a],{strict:i,objects:"reference"}))return!1}else for(a in i?e:n)if(n[a]!==e[a])return!1;if(No.und(a)){if(o&&n.length===0&&e.length===0||s&&Object.keys(n).length===0&&Object.keys(e).length===0)return!0;if(n!==e)return!1}return!0}};function Sde(n){const e={nodes:{},materials:{},meshes:{}};return n&&n.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material),t.isMesh&&!e.meshes[t.name]&&(e.meshes[t.name]=t)}),e}function Ede(n){n.type!=="Scene"&&(n.dispose==null||n.dispose());for(const e in n){const t=n[e];t?.type!=="Scene"&&(t==null||t.dispose==null||t.dispose())}}const wW=["children","key","ref"];function xde(n){const e={};for(const t in n)wW.includes(t)||(e[t]=n[t]);return e}function hM(n,e,t,r){const i=n;let s=i?.__r3f;return s||(s={root:e,type:t,parent:null,children:[],props:xde(r),object:i,eventCount:0,handlers:{},isHidden:!1},i&&(i.__r3f=s)),s}function qw(n,e){if(!e.includes("-"))return{root:n,key:e,target:n[e]};if(e in n)return{root:n,key:e,target:n[e]};let t=n;const r=e.split("-");for(const i of r){if(typeof t!="object"||t===null){if(t!==void 0){const s=r.slice(r.indexOf(i)).join("-");return{root:t,key:s,target:void 0}}return{root:n,key:e,target:void 0}}e=i,n=t,t=t[e]}return{root:n,key:e,target:t}}const QF=/-\d+$/;function fM(n,e){if(No.str(e.props.attach)){if(QF.test(e.props.attach)){const i=e.props.attach.replace(QF,""),{root:s,key:o}=qw(n.object,i);Array.isArray(s[o])||(s[o]=[])}const{root:t,key:r}=qw(n.object,e.props.attach);e.previousAttach=t[r],t[r]=e.object}else No.fun(e.props.attach)&&(e.previousAttach=e.props.attach(n.object,e.object))}function dM(n,e){if(No.str(e.props.attach)){const{root:t,key:r}=qw(n.object,e.props.attach),i=e.previousAttach;i===void 0?delete t[r]:t[r]=i}else e.previousAttach==null||e.previousAttach(n.object,e.object);delete e.previousAttach}const tL=[...wW,"args","dispose","attach","object","onUpdate","dispose"],e7=new Map;function Tde(n){let e=e7.get(n.constructor);try{e||(e=new n.constructor,e7.set(n.constructor,e))}catch{}return e}function wde(n,e){const t={};for(const r in e)if(!tL.includes(r)&&!No.equ(e[r],n.props[r])){t[r]=e[r];for(const i in e)i.startsWith(`${r}-`)&&(t[i]=e[i])}for(const r in n.props){if(tL.includes(r)||e.hasOwnProperty(r))continue;const{root:i,key:s}=qw(n.object,r);if(i.constructor&&i.constructor.length===0){const o=Tde(i);No.und(o)||(t[s]=o[s])}else t[s]=0}return t}const Ade=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],Rde=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function Av(n,e){var t;const r=n.__r3f,i=r&&SW(r).getState(),s=r?.eventCount;for(const a in e){let c=e[a];if(tL.includes(a))continue;if(r&&Rde.test(a)){typeof c=="function"?r.handlers[a]=c:delete r.handlers[a],r.eventCount=Object.keys(r.handlers).length;continue}if(c===void 0)continue;let{root:l,key:u,target:h}=qw(n,a);if(h===void 0&&(typeof l!="object"||l===null))throw Error(`R3F: Cannot set "${a}". Ensure it is an object before setting "${u}".`);if(h instanceof Ww&&c instanceof Ww)h.mask=c.mask;else if(h instanceof gi&&bde(c))h.set(c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof h.copy=="function"&&c!=null&&c.constructor&&h.constructor===c.constructor)h.copy(c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&Array.isArray(c))typeof h.fromArray=="function"?h.fromArray(c):h.set(...c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof c=="number")typeof h.setScalar=="function"?h.setScalar(c):h.set(c);else{var o;l[u]=c,i&&!i.linear&&Ade.includes(u)&&(o=l[u])!=null&&o.isTexture&&l[u].format===Du&&l[u].type===Do&&(l[u].colorSpace=Oi)}}if(r!=null&&r.parent&&i!=null&&i.internal&&(t=r.object)!=null&&t.isObject3D&&s!==r.eventCount){const a=r.object,c=i.internal.interaction.indexOf(a);c>-1&&i.internal.interaction.splice(c,1),r.eventCount&&a.raycast!==null&&i.internal.interaction.push(a)}return r&&r.props.attach===void 0&&(r.object.isBufferGeometry?r.props.attach="geometry":r.object.isMaterial&&(r.props.attach="material")),r&&jx(r),n}function jx(n){var e;if(!n.parent)return;n.props.onUpdate==null||n.props.onUpdate(n.object);const t=(e=n.root)==null||e.getState==null?void 0:e.getState();t&&t.internal.frames===0&&t.invalidate()}function AW(n,e){n.manual||(EW(n)?(n.left=e.width/-2,n.right=e.width/2,n.top=e.height/2,n.bottom=e.height/-2):n.aspect=e.width/e.height,n.updateProjectionMatrix())}const Mu=n=>n?.isObject3D;function d2(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function RW(n,e,t,r){const i=t.get(e);i&&(t.delete(e),t.size===0&&(n.delete(r),i.target.releasePointerCapture(r)))}function Cde(n,e){const{internal:t}=n.getState();t.interaction=t.interaction.filter(r=>r!==e),t.initialHits=t.initialHits.filter(r=>r!==e),t.hovered.forEach((r,i)=>{(r.eventObject===e||r.object===e)&&t.hovered.delete(i)}),t.capturedMap.forEach((r,i)=>{RW(t.capturedMap,e,r,i)})}function Mde(n){function e(c){const{internal:l}=n.getState(),u=c.offsetX-l.initialClick[0],h=c.offsetY-l.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function t(c){return c.filter(l=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=l.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function r(c,l){const u=n.getState(),h=new Set,f=[],d=l?l(u.internal.interaction):u.internal.interaction;for(let m=0;m<d.length;m++){const b=$S(d[m]);b&&(b.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(c,u);function p(m){const b=$S(m);if(!b||!b.events.enabled||b.raycaster.camera===null)return[];if(b.raycaster.camera===void 0){var y;b.events.compute==null||b.events.compute(c,b,(y=b.previousRoot)==null?void 0:y.getState()),b.raycaster.camera===void 0&&(b.raycaster.camera=null)}return b.raycaster.camera?b.raycaster.intersectObject(m,!0):[]}let _=d.flatMap(p).sort((m,b)=>{const y=$S(m.object),x=$S(b.object);return!y||!x?m.distance-b.distance:x.events.priority-y.events.priority||m.distance-b.distance}).filter(m=>{const b=d2(m);return h.has(b)?!1:(h.add(b),!0)});u.events.filter&&(_=u.events.filter(_,u));for(const m of _){let b=m.object;for(;b;){var g;(g=b.__r3f)!=null&&g.eventCount&&f.push({...m,eventObject:b}),b=b.parent}}if("pointerId"in c&&u.internal.capturedMap.has(c.pointerId))for(let m of u.internal.capturedMap.get(c.pointerId).values())h.has(d2(m.intersection))||f.push(m.intersection);return f}function i(c,l,u,h){if(c.length){const f={stopped:!1};for(const d of c){let p=$S(d.object);if(p||d.object.traverseAncestors(_=>{const g=$S(_);if(g)return p=g,!1}),p){const{raycaster:_,pointer:g,camera:m,internal:b}=p,y=new Lt(g.x,g.y,0).unproject(m),x=B=>{var U,z;return(U=(z=b.capturedMap.get(B))==null?void 0:z.has(d.eventObject))!=null?U:!1},T=B=>{const U={intersection:d,target:l.target};b.capturedMap.has(B)?b.capturedMap.get(B).set(d.eventObject,U):b.capturedMap.set(B,new Map([[d.eventObject,U]])),l.target.setPointerCapture(B)},k=B=>{const U=b.capturedMap.get(B);U&&RW(b.capturedMap,d.eventObject,U,B)};let R={};for(let B in l){let U=l[B];typeof U!="function"&&(R[B]=U)}let P={...d,...R,pointer:g,intersections:c,stopped:f.stopped,delta:u,unprojectedPoint:y,ray:_.ray,camera:m,stopPropagation(){const B="pointerId"in l&&b.capturedMap.get(l.pointerId);if((!B||B.has(d.eventObject))&&(P.stopped=f.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(U=>U.eventObject===d.eventObject))){const U=c.slice(0,c.indexOf(d));s([...U,d])}},target:{hasPointerCapture:x,setPointerCapture:T,releasePointerCapture:k},currentTarget:{hasPointerCapture:x,setPointerCapture:T,releasePointerCapture:k},nativeEvent:l};if(h(P),f.stopped===!0)break}}}return c}function s(c){const{internal:l}=n.getState();for(const u of l.hovered.values())if(!c.length||!c.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const f=u.eventObject.__r3f;if(l.hovered.delete(d2(u)),f!=null&&f.eventCount){const d=f.handlers,p={...u,intersections:c};d.onPointerOut==null||d.onPointerOut(p),d.onPointerLeave==null||d.onPointerLeave(p)}}}function o(c,l){for(let u=0;u<l.length;u++){const h=l[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(c)}}function a(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return l=>{const{internal:u}=n.getState();"pointerId"in l&&u.capturedMap.has(l.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(l.pointerId)&&(u.capturedMap.delete(l.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:f}=n.getState();f.lastEvent.current=u;const d=c==="onPointerMove",p=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",g=r(u,d?t:void 0),m=p?e(u):0;c==="onPointerDown"&&(f.initialClick=[u.offsetX,u.offsetY],f.initialHits=g.map(y=>y.eventObject)),p&&!g.length&&m<=2&&(o(u,f.interaction),h&&h(u)),d&&s(g);function b(y){const x=y.eventObject,T=x.__r3f;if(!(T!=null&&T.eventCount))return;const k=T.handlers;if(d){if(k.onPointerOver||k.onPointerEnter||k.onPointerOut||k.onPointerLeave){const R=d2(y),P=f.hovered.get(R);P?P.stopped&&y.stopPropagation():(f.hovered.set(R,y),k.onPointerOver==null||k.onPointerOver(y),k.onPointerEnter==null||k.onPointerEnter(y))}k.onPointerMove==null||k.onPointerMove(y)}else{const R=k[c];R?(!p||f.initialHits.includes(x))&&(o(u,f.interaction.filter(P=>!f.initialHits.includes(P))),R(y)):p&&f.initialHits.includes(x)&&o(u,f.interaction.filter(P=>!f.initialHits.includes(P)))}}i(g,u,m,b)}}return{handlePointer:a}}const t7=n=>!!(n!=null&&n.render),h5=Qe.createContext(null),kde=(n,e)=>{const t=gW((a,c)=>{const l=new Lt,u=new Lt,h=new Lt;function f(m=c().camera,b=u,y=c().size){const{width:x,height:T,top:k,left:R}=y,P=x/T;b.isVector3?h.copy(b):h.set(...b);const B=m.getWorldPosition(l).distanceTo(h);if(EW(m))return{width:x/m.zoom,height:T/m.zoom,top:k,left:R,factor:1,distance:B,aspect:P};{const U=m.fov*Math.PI/180,z=2*Math.tan(U/2)*B,I=z*(x/T);return{width:I,height:z,top:k,left:R,factor:x/I,distance:B,aspect:P}}}let d;const p=m=>a(b=>({performance:{...b.performance,current:m}})),_=new Nn;return{set:a,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(m=1)=>n(c(),m),advance:(m,b)=>e(m,b,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new vce,pointer:_,mouse:_,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const m=c();d&&clearTimeout(d),m.performance.current!==m.performance.min&&p(m.performance.min),d=setTimeout(()=>p(c().performance.max),m.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:f},setEvents:m=>a(b=>({...b,events:{...b.events,...m}})),setSize:(m,b,y=0,x=0)=>{const T=c().camera,k={width:m,height:b,top:y,left:x};a(R=>({size:k,viewport:{...R.viewport,...f(T,u,k)}}))},setDpr:m=>a(b=>{const y=TW(m);return{viewport:{...b.viewport,dpr:y,initialDpr:b.viewport.initialDpr||y}}}),setFrameloop:(m="always")=>{const b=c().clock;b.stop(),b.elapsedTime=0,m!=="never"&&(b.start(),b.elapsedTime=0),a(()=>({frameloop:m}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:Qe.createRef(),active:!1,frames:0,priority:0,subscribe:(m,b,y)=>{const x=c().internal;return x.priority=x.priority+(b>0?1:0),x.subscribers.push({ref:m,priority:b,store:y}),x.subscribers=x.subscribers.sort((T,k)=>T.priority-k.priority),()=>{const T=c().internal;T!=null&&T.subscribers&&(T.priority=T.priority-(b>0?1:0),T.subscribers=T.subscribers.filter(k=>k.ref!==m))}}}}}),r=t.getState();let i=r.size,s=r.viewport.dpr,o=r.camera;return t.subscribe(()=>{const{camera:a,size:c,viewport:l,gl:u,set:h}=t.getState();if(c.width!==i.width||c.height!==i.height||l.dpr!==s){i=c,s=l.dpr,AW(a,c),l.dpr>0&&u.setPixelRatio(l.dpr);const f=typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(c.width,c.height,f)}a!==o&&(o=a,h(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(a)}})))}),t.subscribe(a=>n(a)),t};function f5(){const n=Qe.useContext(h5);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function cl(n=t=>t,e){return f5()(n,e)}function l_(n,e=0){const t=f5(),r=t.getState().internal.subscribe,i=xW(n);return u5(()=>r(i,e,t),[e,r,t]),null}const n7=new WeakMap,Ode=n=>{var e;return typeof n=="function"&&(n==null||(e=n.prototype)==null?void 0:e.constructor)===n};function CW(n,e){return function(t,...r){let i;return Ode(t)?(i=n7.get(t),i||(i=new t,n7.set(t,i))):i=t,n&&n(i),Promise.all(r.map(s=>new Promise((o,a)=>i.load(s,c=>{Mu(c?.scene)&&Object.assign(c,Sde(c.scene)),o(c)},e,c=>a(new Error(`Could not load ${s}: ${c?.message}`))))))}}function d5(n,e,t,r){const i=Array.isArray(e)?e:[e],s=yW(CW(t,r),[n,...i],{equal:No.equ});return Array.isArray(e)?s:s[0]}d5.preload=function(n,e,t){const r=Array.isArray(e)?e:[e];return dde(CW(t),[n,...r])};d5.clear=function(n,e){const t=Array.isArray(e)?e:[e];return pde([n,...t])};function Ide(n){const e=yde(n);return e.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:Qe.version}),e}const MW=0,rx={},Nde=/^three(?=[A-Z])/,Wk=n=>`${n[0].toUpperCase()}${n.slice(1)}`;let Pde=0;const Dde=n=>typeof n=="function";function kW(n){if(Dde(n)){const e=`${Pde++}`;return rx[e]=n,e}else Object.assign(rx,n)}function OW(n,e){const t=Wk(n),r=rx[t];if(n!=="primitive"&&!r)throw new Error(`R3F: ${t} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(n==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function Lde(n,e,t){var r;return n=Wk(n)in rx?n:n.replace(Nde,""),OW(n,e),n==="primitive"&&(r=e.object)!=null&&r.__r3f&&delete e.object.__r3f,hM(e.object,t,n,e)}function Ude(n){if(!n.isHidden){var e;n.props.attach&&(e=n.parent)!=null&&e.object?dM(n.parent,n):Mu(n.object)&&(n.object.visible=!1),n.isHidden=!0,jx(n)}}function IW(n){if(n.isHidden){var e;n.props.attach&&(e=n.parent)!=null&&e.object?fM(n.parent,n):Mu(n.object)&&n.props.visible!==!1&&(n.object.visible=!0),n.isHidden=!1,jx(n)}}function p5(n,e,t){const r=e.root.getState();if(!(!n.parent&&n.object!==r.scene)){if(!e.object){var i,s;const o=rx[Wk(e.type)];e.object=(i=e.props.object)!=null?i:new o(...(s=e.props.args)!=null?s:[]),e.object.__r3f=e}if(Av(e.object,e.props),e.props.attach)fM(n,e);else if(Mu(e.object)&&Mu(n.object)){const o=n.object.children.indexOf(t?.object);if(t&&o!==-1){const a=n.object.children.indexOf(e.object);if(a!==-1){n.object.children.splice(a,1);const c=a<o?o-1:o;n.object.children.splice(c,0,e.object)}else e.object.parent=n.object,n.object.children.splice(o,0,e.object),e.object.dispatchEvent({type:"added"}),n.object.dispatchEvent({type:"childadded",child:e.object})}else n.object.add(e.object)}for(const o of e.children)p5(e,o);jx(e)}}function lI(n,e){e&&(e.parent=n,n.children.push(e),p5(n,e))}function r7(n,e,t){if(!e||!t)return;e.parent=n;const r=n.children.indexOf(t);r!==-1?n.children.splice(r,0,e):n.children.push(e),p5(n,e,t)}function NW(n){if(typeof n.dispose=="function"){const e=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():JF.unstable_scheduleCallback(JF.unstable_IdlePriority,e)}}function nL(n,e,t){if(!e)return;e.parent=null;const r=n.children.indexOf(e);r!==-1&&n.children.splice(r,1),e.props.attach?dM(n,e):Mu(e.object)&&Mu(n.object)&&(n.object.remove(e.object),Cde(SW(e),e.object));const i=e.props.dispose!==null&&t!==!1;for(let s=e.children.length-1;s>=0;s--){const o=e.children[s];nL(e,o,i)}e.children.length=0,delete e.object.__r3f,i&&e.type!=="primitive"&&e.object.type!=="Scene"&&NW(e.object),t===void 0&&jx(e)}function Bde(n,e){for(const t of[n,n.alternate])if(t!==null)if(typeof t.ref=="function"){t.refCleanup==null||t.refCleanup();const r=t.ref(e);typeof r=="function"&&(t.refCleanup=r)}else t.ref&&(t.ref.current=e)}const SC=[];function Fde(){for(const[t]of SC){const r=t.parent;if(r){t.props.attach?dM(r,t):Mu(t.object)&&Mu(r.object)&&r.object.remove(t.object);for(const i of t.children)i.props.attach?dM(t,i):Mu(i.object)&&Mu(t.object)&&t.object.remove(i.object)}t.isHidden&&IW(t),t.object.__r3f&&delete t.object.__r3f,t.type!=="primitive"&&NW(t.object)}for(const[t,r,i]of SC){t.props=r;const s=t.parent;if(s){var n,e;const o=rx[Wk(t.type)];t.object=(n=t.props.object)!=null?n:new o(...(e=t.props.args)!=null?e:[]),t.object.__r3f=t,Bde(i,t.object),Av(t.object,t.props),t.props.attach?fM(s,t):Mu(t.object)&&Mu(s.object)&&s.object.add(t.object);for(const a of t.children)a.props.attach?fM(t,a):Mu(a.object)&&Mu(t.object)&&t.object.add(a.object);jx(t)}}SC.length=0}const uI=()=>{},i7={};let p2=MW;const jde=0,zde=4,pM=Ide({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:Lde,removeChild:nL,appendChild:lI,appendInitialChild:lI,insertBefore:r7,appendChildToContainer(n,e){const t=n.getState().scene.__r3f;!e||!t||lI(t,e)},removeChildFromContainer(n,e){const t=n.getState().scene.__r3f;!e||!t||nL(t,e)},insertInContainerBefore(n,e,t){const r=n.getState().scene.__r3f;!e||!t||!r||r7(r,e,t)},getRootHostContext:()=>i7,getChildHostContext:()=>i7,commitUpdate(n,e,t,r,i){var s,o,a;OW(e,r);let c=!1;if((n.type==="primitive"&&t.object!==r.object||((s=r.args)==null?void 0:s.length)!==((o=t.args)==null?void 0:o.length)||(a=r.args)!=null&&a.some((u,h)=>{var f;return u!==((f=t.args)==null?void 0:f[h])}))&&(c=!0),c)SC.push([n,{...r},i]);else{const u=wde(n,r);Object.keys(u).length&&(Object.assign(n.props,u),Av(n.object,u))}(i.sibling===null||(i.flags&zde)===jde)&&Fde()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:n=>n?.object,prepareForCommit:()=>null,preparePortalMount:n=>hM(n.getState().scene,n,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:Ude,unhideInstance:IW,createTextInstance:uI,hideTextInstance:uI,unhideTextInstance:uI,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:Qe.createContext(null),setCurrentUpdatePriority(n){p2=n},getCurrentUpdatePriority(){return p2},resolveUpdatePriority(){var n;if(p2!==MW)return p2;switch(typeof window<"u"&&((n=window.event)==null?void 0:n.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return fC.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return fC.ContinuousEventPriority;default:return fC.DefaultEventPriority}},resetFormInstance(){}}),ib=new Map,WS={objects:"shallow",strict:!1};function Hde(n,e){if(!e&&typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:t,height:r,top:i,left:s}=n.parentElement.getBoundingClientRect();return{width:t,height:r,top:i,left:s}}else if(!e&&typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function Vde(n){const e=ib.get(n),t=e?.fiber,r=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=r||kde(sL,o7),o=t||pM.createContainer(s,fC.ConcurrentRoot,null,!1,null,"",i,i,i,null);e||ib.set(n,{fiber:o,store:s});let a,c,l=!1,u=null;return{async configure(h={}){let f;u=new Promise(V=>f=V);let{gl:d,size:p,scene:_,events:g,onCreated:m,shadows:b=!1,linear:y=!1,flat:x=!1,legacy:T=!1,orthographic:k=!1,frameloop:R="always",dpr:P=[1,2],performance:B,raycaster:U,camera:z,onPointerMissed:I}=h,L=s.getState(),M=L.gl;if(!L.gl){const V={canvas:n,powerPreference:"high-performance",antialias:!0,alpha:!0},K=typeof d=="function"?await d(V):d;t7(K)?M=K:M=new nde({...V,...d}),L.set({gl:M})}let F=L.raycaster;F||L.set({raycaster:F=new uW});const{params:Z,...$}=U||{};if(No.equ($,F,WS)||Av(F,{...$}),No.equ(Z,F.params,WS)||Av(F,{params:{...F.params,...Z}}),!L.camera||L.camera===c&&!No.equ(c,z,WS)){c=z;const V=z?.isCamera,K=V?z:k?new c5(0,0,0,0,.1,1e3):new Ou(75,0,.1,1e3);V||(K.position.z=5,z&&(Av(K,z),K.manual||("aspect"in z||"left"in z||"right"in z||"bottom"in z||"top"in z)&&(K.manual=!0,K.updateProjectionMatrix())),!L.camera&&!(z!=null&&z.rotation)&&K.lookAt(0,0,0)),L.set({camera:K}),F.camera=K}if(!L.scene){let V;_!=null&&_.isScene?(V=_,hM(V,s,"",{})):(V=new uM,hM(V,s,"",{}),_&&Av(V,_)),L.set({scene:V})}g&&!L.events.handlers&&L.set({events:g(s)});const Y=Hde(n,p);if(No.equ(Y,L.size,WS)||L.setSize(Y.width,Y.height,Y.top,Y.left),P&&L.viewport.dpr!==TW(P)&&L.setDpr(P),L.frameloop!==R&&L.setFrameloop(R),L.onPointerMissed||L.set({onPointerMissed:I}),B&&!No.equ(B,L.performance,WS)&&L.set(V=>({performance:{...V.performance,...B}})),!L.xr){var Q;const V=(ie,ae)=>{const Te=s.getState();Te.frameloop!=="never"&&o7(ie,!0,Te,ae)},K=()=>{const ie=s.getState();ie.gl.xr.enabled=ie.gl.xr.isPresenting,ie.gl.xr.setAnimationLoop(ie.gl.xr.isPresenting?V:null),ie.gl.xr.isPresenting||sL(ie)},ne={connect(){const ie=s.getState().gl;ie.xr.addEventListener("sessionstart",K),ie.xr.addEventListener("sessionend",K)},disconnect(){const ie=s.getState().gl;ie.xr.removeEventListener("sessionstart",K),ie.xr.removeEventListener("sessionend",K)}};typeof((Q=M.xr)==null?void 0:Q.addEventListener)=="function"&&ne.connect(),L.set({xr:ne})}if(M.shadowMap){const V=M.shadowMap.enabled,K=M.shadowMap.type;if(M.shadowMap.enabled=!!b,No.boo(b))M.shadowMap.type=dC;else if(No.str(b)){var q;const ne={basic:koe,percentage:K4,soft:dC,variance:Cm};M.shadowMap.type=(q=ne[b])!=null?q:dC}else No.obj(b)&&Object.assign(M.shadowMap,b);(V!==M.shadowMap.enabled||K!==M.shadowMap.type)&&(M.shadowMap.needsUpdate=!0)}return zi.enabled=!T,l||(M.outputColorSpace=y?t_:Oi,M.toneMapping=x?Wg:W$),L.legacy!==T&&L.set(()=>({legacy:T})),L.linear!==y&&L.set(()=>({linear:y})),L.flat!==x&&L.set(()=>({flat:x})),d&&!No.fun(d)&&!t7(d)&&!No.equ(d,M,WS)&&Av(M,d),a=m,l=!0,f(),this},render(h){return!l&&!u&&this.configure(),u.then(()=>{pM.updateContainer(xe.jsx(Gde,{store:s,children:h,onCreated:a,rootElement:n}),o,null,()=>{})}),s},unmount(){$de(n)}}}function Gde({store:n,children:e,onCreated:t,rootElement:r}){return u5(()=>{const i=n.getState();i.set(s=>({internal:{...s.internal,active:!0}})),t&&t(i),n.getState().events.connected||i.events.connect==null||i.events.connect(r)},[]),xe.jsx(h5.Provider,{value:n,children:e})}function $de(n,e){const t=ib.get(n),r=t?.fiber;if(r){const i=t?.store.getState();i&&(i.internal.active=!1),pM.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var s,o,a,c;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=i.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(c=i.gl)!=null&&c.xr&&i.xr.disconnect(),Ede(i.scene),ib.delete(n)}catch{}},500)})}}function Wde(n,e,t){return xe.jsx(qde,{children:n,container:e,state:t})}function qde({state:n={},children:e,container:t}){const{events:r,size:i,...s}=n,o=f5(),[a]=Qe.useState(()=>new uW),[c]=Qe.useState(()=>new Nn),l=xW((h,f)=>{let d;if(f.camera&&i){const p=f.camera;d=h.viewport.getCurrentViewport(p,new Lt,i),p!==h.camera&&AW(p,i)}return{...h,...f,scene:t,raycaster:a,pointer:c,mouse:c,previousRoot:o,events:{...h.events,...f.events,...r},size:{...h.size,...i},viewport:{...h.viewport,...d},setEvents:p=>f.set(_=>({..._,events:{..._.events,...p}}))}}),u=Qe.useMemo(()=>{const h=gW((d,p)=>({...s,set:d,get:p})),f=d=>h.setState(p=>l.current(d,p));return f(o.getState()),o.subscribe(f),h},[o,t]);return xe.jsx(xe.Fragment,{children:pM.createPortal(xe.jsx(h5.Provider,{value:u,children:e}),u,null)})}function PW(n,e){const t={callback:n};return e.add(t),()=>void e.delete(t)}const DW=new Set,LW=new Set,Yde=new Set,Kde=n=>PW(n,DW),Xde=n=>PW(n,LW);function hI(n,e){if(n.size)for(const{callback:t}of n.values())t(e)}function Cw(n,e){switch(n){case"before":return hI(DW,e);case"after":return hI(LW,e);case"tail":return hI(Yde,e)}}let fI,dI;function rL(n,e,t){let r=e.clock.getDelta();e.frameloop==="never"&&typeof n=="number"&&(r=n-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=n),fI=e.internal.subscribers;for(let i=0;i<fI.length;i++)dI=fI[i],dI.ref.current(dI.store.getState(),r,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let mM=!1,iL=!1,pI,s7,qS;function UW(n){s7=requestAnimationFrame(UW),mM=!0,pI=0,Cw("before",n),iL=!0;for(const t of ib.values()){var e;qS=t.store.getState(),qS.internal.active&&(qS.frameloop==="always"||qS.internal.frames>0)&&!((e=qS.gl.xr)!=null&&e.isPresenting)&&(pI+=rL(n,qS))}if(iL=!1,Cw("after",n),pI===0)return Cw("tail",n),mM=!1,cancelAnimationFrame(s7)}function sL(n,e=1){var t;if(!n)return ib.forEach(r=>sL(r.store.getState(),e));(t=n.gl.xr)!=null&&t.isPresenting||!n.internal.active||n.frameloop==="never"||(e>1?n.internal.frames=Math.min(60,n.internal.frames+e):iL?n.internal.frames=2:n.internal.frames=1,mM||(mM=!0,requestAnimationFrame(UW)))}function o7(n,e=!0,t,r){if(e&&Cw("before",n),t)rL(n,t,r);else for(const i of ib.values())rL(n,i.store.getState());e&&Cw("after",n)}const mI={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Zde(n){const{handlePointer:e}=Mde(n);return{priority:1,enabled:!0,compute(t,r,i){r.pointer.set(t.offsetX/r.size.width*2-1,-(t.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(mI).reduce((t,r)=>({...t,[r]:e(r)}),{}),update:()=>{var t;const{events:r,internal:i}=n.getState();(t=i.lastEvent)!=null&&t.current&&r.handlers&&r.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{const{set:r,events:i}=n.getState();if(i.disconnect==null||i.disconnect(),r(s=>({events:{...s.events,connected:t}})),i.handlers)for(const s in i.handlers){const o=i.handlers[s],[a,c]=mI[s];t.addEventListener(a,o,{passive:c})}},disconnect:()=>{const{set:t,events:r}=n.getState();if(r.connected){if(r.handlers)for(const i in r.handlers){const s=r.handlers[i],[o]=mI[i];r.connected.removeEventListener(o,s)}t(i=>({events:{...i.events,connected:void 0}}))}}}}var m2={exports:{}},a7;function Jde(){if(a7)return m2.exports;a7=1;function n(e,t=100,r={}){if(typeof e!="function")throw new TypeError(`Expected the first parameter to be a function, got \`${typeof e}\`.`);if(t<0)throw new RangeError("`wait` must not be negative.");const{immediate:i}=typeof r=="boolean"?{immediate:r}:r;let s,o,a,c,l;function u(){const d=s,p=o;return s=void 0,o=void 0,l=e.apply(d,p),l}function h(){const d=Date.now()-c;d<t&&d>=0?a=setTimeout(h,t-d):(a=void 0,i||(l=u()))}const f=function(...d){if(s&&this!==s&&Object.getPrototypeOf(this)===Object.getPrototypeOf(s))throw new Error("Debounced method called with different contexts of the same prototype.");s=this,o=d,c=Date.now();const p=i&&!a;return a||(a=setTimeout(h,t)),p&&(l=u()),l};return Object.defineProperty(f,"isPending",{get(){return a!==void 0}}),f.clear=()=>{a&&(clearTimeout(a),a=void 0)},f.flush=()=>{a&&f.trigger()},f.trigger=()=>{l=u(),f.clear()},f}return m2.exports.debounce=n,m2.exports=n,m2.exports}var Qde=Jde();const epe=Dl(Qde),dn=60,_r=25,f0=dn*_r;var Wr=(n=>(n[n.ERROR=0]="ERROR",n[n.LOADER=1]="LOADER",n[n.BOARD=2]="BOARD",n[n.OBJECT=3]="OBJECT",n[n.TERRAIN=4]="TERRAIN",n[n.CHARSET=5]="CHARSET",n[n.PALETTE=6]="PALETTE",n))(Wr||{}),xc=(n=>(n.MAIN="main",n.TEMP="temp",n.TITLE="title",n.PLAYER="player",n.GADGETSTORE="gadgetstore",n))(xc||{});var tpe=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),npe=Object.prototype.hasOwnProperty;function oL(n,e){return npe.call(n,e)}function aL(n){if(Array.isArray(n)){for(var e=new Array(n.length),t=0;t<e.length;t++)e[t]=""+t;return e}if(Object.keys)return Object.keys(n);var r=[];for(var i in n)oL(n,i)&&r.push(i);return r}function Nh(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function cL(n){for(var e=0,t=n.length,r;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function w1(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function BW(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function lL(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(var e=0,t=n.length;e<t;e++)if(lL(n[e]))return!0}else if(typeof n=="object"){for(var r=aL(n),i=r.length,s=0;s<i;s++)if(lL(n[r[s]]))return!0}}return!1}function c7(n,e){var t=[n];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&t.push(r+": "+i)}return t.join(`
`)}var FW=(function(n){tpe(e,n);function e(t,r,i,s,o){var a=this.constructor,c=n.call(this,c7(t,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=c7(t,{name:r,index:i,operation:s,tree:o}),c}return e})(Error),_a=FW,rpe=Nh,AE={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){var r=gM(t,this.path);r&&(r=Nh(r));var i=G1(t,{op:"remove",path:this.from}).removed;return G1(t,{op:"add",path:this.path,value:i}),{newDocument:t,removed:r}},copy:function(n,e,t){var r=gM(t,this.from);return G1(t,{op:"add",path:this.path,value:Nh(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:Yw(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}},ipe={add:function(n,e,t){return cL(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:AE.move,copy:AE.copy,test:AE.test,_get:AE._get};function gM(n,e){if(e=="")return n;var t={op:"_get",path:e};return G1(n,t),t.value}function G1(n,e,t,r,i,s){if(t===void 0&&(t=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),t&&(typeof t=="function"?t(e,0,n,e.path):_M(e,0)),e.path===""){var o={newDocument:n};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=n,o;if(e.op==="move"||e.op==="copy")return o.newDocument=gM(n,e.from),e.op==="move"&&(o.removed=n),o;if(e.op==="test"){if(o.test=Yw(n,e.value),o.test===!1)throw new _a("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return o.newDocument=n,o}else{if(e.op==="remove")return o.removed=n,o.newDocument=null,o;if(e.op==="_get")return e.value=n,o;if(t)throw new _a("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,n);return o}}else{r||(n=Nh(n));var a=e.path||"",c=a.split("/"),l=n,u=1,h=c.length,f=void 0,d=void 0,p=void 0;for(typeof t=="function"?p=t:p=_M;;){if(d=c[u],d&&d.indexOf("~")!=-1&&(d=BW(d)),i&&(d=="__proto__"||d=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&f===void 0&&(l[d]===void 0?f=c.slice(0,u).join("/"):u==h-1&&(f=e.path),f!==void 0&&p(e,0,n,f)),u++,Array.isArray(l)){if(d==="-")d=l.length;else{if(t&&!cL(d))throw new _a("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,n);cL(d)&&(d=~~d)}if(u>=h){if(t&&e.op==="add"&&d>l.length)throw new _a("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,n);var o=ipe[e.op].call(e,l,d,n);if(o.test===!1)throw new _a("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return o}}else if(u>=h){var o=AE[e.op].call(e,l,d,n);if(o.test===!1)throw new _a("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return o}if(l=l[d],t&&u<h&&(!l||typeof l!="object"))throw new _a("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,n)}}}function qk(n,e,t,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),t&&!Array.isArray(e))throw new _a("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=Nh(n));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=G1(n,e[o],t,!0,i,o),n=s[o].newDocument;return s.newDocument=n,s}function spe(n,e,t){var r=G1(n,e);if(r.test===!1)throw new _a("Test operation failed","TEST_OPERATION_FAILED",t,e,n);return r.newDocument}function _M(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new _a("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(AE[n.op]){if(typeof n.path!="string")throw new _a("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new _a('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new _a("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new _a("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&lL(n.value))throw new _a("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var i=n.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new _a("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new _a("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var o={op:"_get",path:n.from,value:void 0},a=jW([o],t);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new _a("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new _a("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function jW(n,e,t){try{if(!Array.isArray(n))throw new _a("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)qk(Nh(e),Nh(n),t||!0);else{t=t||_M;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(i){if(i instanceof _a)return i;throw i}}function Yw(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),i,s,o;if(t&&r){if(s=n.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!Yw(n[i],e[i]))return!1;return!0}if(t!=r)return!1;var a=Object.keys(n);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!Yw(n[o],e[o]))return!1;return!0}return n!==n&&e!==e}const ope=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:_a,_areEquals:Yw,applyOperation:G1,applyPatch:qk,applyReducer:spe,deepClone:rpe,getValueByPointer:gM,validate:jW,validator:_M},Symbol.toStringTag,{value:"Module"}));var m5=new WeakMap,ape=(function(){function n(e){this.observers=new Map,this.obj=e}return n})(),cpe=(function(){function n(e,t){this.callback=e,this.observer=t}return n})();function lpe(n){return m5.get(n)}function upe(n,e){return n.observers.get(e)}function hpe(n,e){n.observers.delete(e.callback)}function fpe(n,e){e.unobserve()}function dpe(n,e){var t=[],r,i=lpe(n);if(!i)i=new ape(n),m5.set(n,i);else{var s=upe(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Nh(n),e){r.callback=e,r.next=null;var o=function(){uL(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=t,r.object=n,r.unobserve=function(){uL(r),clearTimeout(r.next),hpe(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new cpe(e,r)),r}function uL(n,e){e===void 0&&(e=!1);var t=m5.get(n.object);g5(t.value,n.object,n.patches,"",e),n.patches.length&&qk(t.value,n.patches);var r=n.patches;return r.length>0&&(n.patches=[],n.callback&&n.callback(r)),r}function g5(n,e,t,r,i){if(e!==n){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=aL(e),o=aL(n),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=n[l];if(oL(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?g5(u,h,t,r+"/"+w1(l),i):u!==h&&(i&&t.push({op:"test",path:r+"/"+w1(l),value:Nh(u)}),t.push({op:"replace",path:r+"/"+w1(l),value:Nh(h)}))}else Array.isArray(n)===Array.isArray(e)?(i&&t.push({op:"test",path:r+"/"+w1(l),value:Nh(u)}),t.push({op:"remove",path:r+"/"+w1(l)}),a=!0):(i&&t.push({op:"test",path:r,value:n}),t.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!oL(n,l)&&e[l]!==void 0&&t.push({op:"add",path:r+"/"+w1(l),value:Nh(e[l])})}}}function ppe(n,e,t){t===void 0&&(t=!1);var r=[];return g5(n,e,r,"",t),r}const mpe=Object.freeze(Object.defineProperty({__proto__:null,compare:ppe,generate:uL,observe:dpe,unobserve:fpe},Symbol.toStringTag,{value:"Module"}));Object.assign({},ope,mpe,{JsonPatchError:FW,deepClone:Nh,escapePathComponent:w1,unescapePathComponent:BW});var gI,l7;function gpe(){if(l7)return gI;l7=1;var n=typeof Element<"u",e=typeof Map=="function",t=typeof Set=="function",r=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function i(s,o){if(s===o)return!0;if(s&&o&&typeof s=="object"&&typeof o=="object"){if(s.constructor!==o.constructor)return!1;var a,c,l;if(Array.isArray(s)){if(a=s.length,a!=o.length)return!1;for(c=a;c--!==0;)if(!i(s[c],o[c]))return!1;return!0}var u;if(e&&s instanceof Map&&o instanceof Map){if(s.size!==o.size)return!1;for(u=s.entries();!(c=u.next()).done;)if(!o.has(c.value[0]))return!1;for(u=s.entries();!(c=u.next()).done;)if(!i(c.value[1],o.get(c.value[0])))return!1;return!0}if(t&&s instanceof Set&&o instanceof Set){if(s.size!==o.size)return!1;for(u=s.entries();!(c=u.next()).done;)if(!o.has(c.value[0]))return!1;return!0}if(r&&ArrayBuffer.isView(s)&&ArrayBuffer.isView(o)){if(a=s.length,a!=o.length)return!1;for(c=a;c--!==0;)if(s[c]!==o[c])return!1;return!0}if(s.constructor===RegExp)return s.source===o.source&&s.flags===o.flags;if(s.valueOf!==Object.prototype.valueOf&&typeof s.valueOf=="function"&&typeof o.valueOf=="function")return s.valueOf()===o.valueOf();if(s.toString!==Object.prototype.toString&&typeof s.toString=="function"&&typeof o.toString=="function")return s.toString()===o.toString();if(l=Object.keys(s),a=l.length,a!==Object.keys(o).length)return!1;for(c=a;c--!==0;)if(!Object.prototype.hasOwnProperty.call(o,l[c]))return!1;if(n&&s instanceof Element)return!1;for(c=a;c--!==0;)if(!((l[c]==="_owner"||l[c]==="__v"||l[c]==="__o")&&s.$$typeof)&&!i(s[l[c]],o[l[c]]))return!1;return!0}return s!==s&&o!==o}return gI=function(o,a){try{return i(o,a)}catch(c){if((c.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw c}},gI}var _pe=gpe();const Sv=Dl(_pe);function fe(n){return n!=null}const vpe=Object.fromEntries,n0=Object.keys;function Us(n){return Nh(n)}function ype(n){return typeof n=="boolean"}function Xt(n){return typeof n=="number"&&isNaN(n)===!1}function rn(n){return typeof n=="string"}function Xn(n){return Array.isArray(n)}function _5(n){return n}function bpe(n){return n!==null&&typeof n=="object"&&rn(n.id)&&rn(n.name)&&Xn(n.pages)&&Xn(n.activelist)&&typeof n.flags=="object"}var Bt=(n=>(n[n.BLACK=0]="BLACK",n[n.DKBLUE=1]="DKBLUE",n[n.DKGREEN=2]="DKGREEN",n[n.DKCYAN=3]="DKCYAN",n[n.DKRED=4]="DKRED",n[n.DKPURPLE=5]="DKPURPLE",n[n.DKYELLOW=6]="DKYELLOW",n[n.LTGRAY=7]="LTGRAY",n[n.DKGRAY=8]="DKGRAY",n[n.BLUE=9]="BLUE",n[n.GREEN=10]="GREEN",n[n.CYAN=11]="CYAN",n[n.RED=12]="RED",n[n.PURPLE=13]="PURPLE",n[n.YELLOW=14]="YELLOW",n[n.WHITE=15]="WHITE",n[n.ONBLACK=16]="ONBLACK",n[n.ONDKBLUE=17]="ONDKBLUE",n[n.ONDKGREEN=18]="ONDKGREEN",n[n.ONDKCYAN=19]="ONDKCYAN",n[n.ONDKRED=20]="ONDKRED",n[n.ONDKPURPLE=21]="ONDKPURPLE",n[n.ONDKYELLOW=22]="ONDKYELLOW",n[n.ONLTGRAY=23]="ONLTGRAY",n[n.ONDKGRAY=24]="ONDKGRAY",n[n.ONBLUE=25]="ONBLUE",n[n.ONGREEN=26]="ONGREEN",n[n.ONCYAN=27]="ONCYAN",n[n.ONRED=28]="ONRED",n[n.ONPURPLE=29]="ONPURPLE",n[n.ONYELLOW=30]="ONYELLOW",n[n.ONWHITE=31]="ONWHITE",n[n.ONCLEAR=32]="ONCLEAR",n[n.BLBLACK=33]="BLBLACK",n[n.BLDKBLUE=34]="BLDKBLUE",n[n.BLDKGREEN=35]="BLDKGREEN",n[n.BLDKCYAN=36]="BLDKCYAN",n[n.BLDKRED=37]="BLDKRED",n[n.BLDKPURPLE=38]="BLDKPURPLE",n[n.BLDKYELLOW=39]="BLDKYELLOW",n[n.BLLTGRAY=40]="BLLTGRAY",n[n.BLDKGRAY=41]="BLDKGRAY",n[n.BLBLUE=42]="BLBLUE",n[n.BLGREEN=43]="BLGREEN",n[n.BLCYAN=44]="BLCYAN",n[n.BLRED=45]="BLRED",n[n.BLPURPLE=46]="BLPURPLE",n[n.BLYELLOW=47]="BLYELLOW",n[n.BLWHITE=48]="BLWHITE",n))(Bt||{}),kn=(n=>(n[n.ISWALK=0]="ISWALK",n[n.ISSOLID=1]="ISSOLID",n[n.ISSWIM=2]="ISSWIM",n[n.ISBULLET=3]="ISBULLET",n[n.ISGHOST=4]="ISGHOST",n))(kn||{}),sb=(n=>(n[n.ISTERRAIN=0]="ISTERRAIN",n[n.ISOBJECT=1]="ISOBJECT",n))(sb||{}),hn=(n=>(n[n.IDLE=0]="IDLE",n[n.NORTH=1]="NORTH",n[n.SOUTH=2]="SOUTH",n[n.WEST=3]="WEST",n[n.EAST=4]="EAST",n[n.BY=5]="BY",n[n.AT=6]="AT",n[n.FLOW=7]="FLOW",n[n.SEEK=8]="SEEK",n[n.RNDNS=9]="RNDNS",n[n.RNDNE=10]="RNDNE",n[n.RND=11]="RND",n[n.CW=12]="CW",n[n.CCW=13]="CCW",n[n.OPP=14]="OPP",n[n.RNDP=15]="RNDP",n[n.AWAY=16]="AWAY",n[n.TOWARD=17]="TOWARD",n[n.FIND=18]="FIND",n[n.FLEE=19]="FLEE",n[n.TO=20]="TO",n[n.MID=21]="MID",n[n.OVER=22]="OVER",n[n.UNDER=23]="UNDER",n[n.GROUND=24]="GROUND",n[n.WITHIN=25]="WITHIN",n[n.AWAYBY=26]="AWAYBY",n[n.ELEMENTS=27]="ELEMENTS",n))(hn||{}),Pn=(n=>(n[n.LOADER=0]="LOADER",n[n.BOARD=1]="BOARD",n[n.OBJECT=2]="OBJECT",n[n.TERRAIN=3]="TERRAIN",n[n.CHARSET=4]="CHARSET",n[n.PALETTE=5]="PALETTE",n[n.CONST=6]="CONST",n[n.RANGE=7]="RANGE",n[n.SELECT=8]="SELECT",n[n.NUMBER=9]="NUMBER",n[n.TEXT=10]="TEXT",n[n.HOTKEY=11]="HOTKEY",n[n.COPYIT=12]="COPYIT",n[n.OPENIT=13]="OPENIT",n[n.VIEWIT=14]="VIEWIT",n[n.RUNIT=15]="RUNIT",n[n.ZSSEDIT=16]="ZSSEDIT",n[n.CHAREDIT=17]="CHAREDIT",n[n.COLOREDIT=18]="COLOREDIT",n))(Pn||{});function Jn(n){return rn(n)?n.toLowerCase().trim():""}const $1=14,Kw=3,ja=8,Oc=14,Fa=16,u7=16,Spe=16;var es=(n=>(n[n.BLANK=0]="BLANK",n[n.TILES=1]="TILES",n[n.SPRITES=2]="SPRITES",n[n.DITHER=3]="DITHER",n[n.MEDIA=4]="MEDIA",n[n.CONTROL=5]="CONTROL",n))(es||{}),Ic=(n=>(n[n.FAR=1]="FAR",n[n.MID=1.5]="MID",n[n.NEAR=3]="NEAR",n))(Ic||{});function zx(n){let e=0,t=0,r=dn*.5,i=_r*.5,s=1.5,o="flat",a=0;return n.forEach(c=>{switch(c.type){case 1:e=Math.max(e,c.width),t=Math.max(t,c.height);break;case 3:e=Math.max(e,c.width),t=Math.max(t,c.height);break;case 5:r=c.focusx,i=c.focusy,s=c.viewscale,o=c.graphics,a=c.facing;break}}),{width:e,height:t,focusx:r,focusy:i,viewscale:s,graphics:o,facing:a}}function Qv(n,e){return`${n}:${e}`}const v5=1,y5=16,b5=256;var wt=(n=>(n[n.NONE=0]="NONE",n[n.ALT=1]="ALT",n[n.CTRL=2]="CTRL",n[n.SHIFT=3]="SHIFT",n[n.MOVE_UP=4]="MOVE_UP",n[n.MOVE_DOWN=5]="MOVE_DOWN",n[n.MOVE_LEFT=6]="MOVE_LEFT",n[n.MOVE_RIGHT=7]="MOVE_RIGHT",n[n.OK_BUTTON=8]="OK_BUTTON",n[n.CANCEL_BUTTON=9]="CANCEL_BUTTON",n[n.MENU_BUTTON=10]="MENU_BUTTON",n))(wt||{});const r0=!!JSON.parse("false"),Epe=!!JSON.parse("false"),xpe=!!JSON.parse("false"),h7=!!JSON.parse("false");JSON.parse("false");JSON.parse("false");JSON.parse("false");JSON.parse("false");const An={YIELD_AT_COUNT:512,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return ja*An.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Oc*An.DRAW_CHAR_SCALE}};function Tpe(n){const e=document.createElement("canvas");if(e.width=n?.width||1,e.height=n?.height||1,n){const t=e.getContext("2d"),r=t?.getImageData(0,0,n.width,n.height);if(r&&t){let i=0;const{data:s}=r;for(let o=0;o<s.length;o+=4){const a=n.bits[i];s[o]=a,s[o+1]=a,s[o+2]=a,s[o+3]=255,i+=1}t.putImageData(r,0,0)}}return e}function S5(n,e){return{width:n,height:e,size:n*e,bits:new Uint8Array(n*e).fill(0)}}function _I(n,e,t){return{width:n,height:e,size:n*e,bits:new Uint8Array(t)}}function vI(n,e,t){if(!fe(n))return;const r=Math.round(n.height/t),i=Math.round(n.width/e),s=e+2,o=t+2,a=i*e,c=i*s,l=r*o,u=S5(c,l);for(let h=0;h<r;++h)for(let f=0;f<i;++f)for(let d=0;d<t;++d)for(let p=0;p<e;++p){const _=f*e+p,g=h*t+d,m=n.bits[_+g*a],b=f*s+p+1,y=h*o+d+1,x=b+y*c;u.bits[x]=m,p===0&&(u.bits[x-1]=m),p===ja-1&&(u.bits[x+1]=m),d===0&&(u.bits[x-c]=m),d===Oc-1&&(u.bits[x+c]=m)}return u}function Cb(n){const e=Math.floor(n.length/Kw);if(e*Kw!==n.length)return;const t=S5(3,e);for(let r=0;r<t.bits.length;++r)t.bits[r]=n[r];return t}function wpe(n,e){return n&1<<e?255:0}function Mb(n){const e=Math.floor(n.length/$1);if(e*$1!==n.length)return;const t=Math.ceil(e/Fa),r=ja*Fa,i=S5(r,Oc*t);let s=0,o=0,a=0;for(let c=0;c<n.length;++c){const l=o*Oc+a,u=n[c];for(let h=0;h<ja;++h){const f=s*ja+h;i.bits[f+l*r]=wpe(u,7-h)}++a,a===Oc&&(a=0,++s,s===Fa&&(s=0,++o))}return i}function Ape(n,e,t){if(!fe(e))return;const r=Math.floor(e.bits.length/$1);if(t<0||t>255||n.length===$1||r*$1!==e.bits.length)return;const i=ja*Fa,s=t%Fa*ja,o=Math.floor(t/Fa)*Oc,a=0;for(let c=0;c<Oc;++c)for(let l=0;l<ja;++l){const u=s+l,h=o+c;e.bits[u+h*i]=n[a]?255:0}}function Rpe(n,e){const t=[];if(!fe(n))return Uint8Array.from(t);const r=Math.floor(n.bits.length/$1);if(e<0||e>255||r*$1!==n.bits.length)return Uint8Array.from(t);const i=ja*Fa,s=e%Fa*ja,o=Math.floor(e/Fa)*Oc;for(let a=0;a<Oc;++a)for(let c=0;c<ja;++c){const l=s+c,u=o+a;t.push(n.bits[l+u*i])}return Uint8Array.from(t)}const f7="0123456789abcdef",zW=[],vM=[];for(let n=0;n<256;n++)zW[n]=f7[n>>4&15]+f7[n&15],n<16&&(n<10?vM[48+n]=n:vM[87+n]=n);const HW=n=>{const e=n.length;let t="",r=0;for(;r<e;)t+=zW[n[r++]];return t},yM=n=>{const e=n.length>>1,t=e<<1,r=new Uint8Array(e);let i=0,s=0;for(;s<t;)r[i++]=vM[n.charCodeAt(s++)]<<4|vM[n.charCodeAt(s++)];return r};var d7="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Cpe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var g2=0;g2<d7.length;g2++)Cpe[d7.charCodeAt(g2)]=g2;new TextDecoder;new TextEncoder;const p7=typeof window<"u"?window:self,m7=p7.crypto||p7.msCrypto||{};m7.subtle||m7.webkitSubtle;const kb=yM("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),Ob=yM("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f"),Vg=globalThis||void 0||self;var VW=typeof Vg=="object"&&Vg&&Vg.Object===Object&&Vg,Mpe=typeof self=="object"&&self&&self.Object===Object&&self,d0=VW||Mpe||Function("return this")(),Cd=d0.Symbol,GW=Object.prototype,kpe=GW.hasOwnProperty,Ope=GW.toString,DT=Cd?Cd.toStringTag:void 0;function Ipe(n){var e=kpe.call(n,DT),t=n[DT];try{n[DT]=void 0;var r=!0}catch{}var i=Ope.call(n);return r&&(e?n[DT]=t:delete n[DT]),i}var Npe=Object.prototype,Ppe=Npe.toString;function Dpe(n){return Ppe.call(n)}var Lpe="[object Null]",Upe="[object Undefined]",g7=Cd?Cd.toStringTag:void 0;function ey(n){return n==null?n===void 0?Upe:Lpe:g7&&g7 in Object(n)?Ipe(n):Dpe(n)}function bp(n){return n!=null&&typeof n=="object"}var Bpe="[object Symbol]";function Yk(n){return typeof n=="symbol"||bp(n)&&ey(n)==Bpe}function Kk(n,e){for(var t=-1,r=n==null?0:n.length,i=Array(r);++t<r;)i[t]=e(n[t],t,n);return i}var Li=Array.isArray,_7=Cd?Cd.prototype:void 0,v7=_7?_7.toString:void 0;function $W(n){if(typeof n=="string")return n;if(Li(n))return Kk(n,$W)+"";if(Yk(n))return v7?v7.call(n):"";var e=n+"";return e=="0"&&1/n==-1/0?"-0":e}var Fpe=/\s/;function jpe(n){for(var e=n.length;e--&&Fpe.test(n.charAt(e)););return e}var zpe=/^\s+/;function Hpe(n){return n&&n.slice(0,jpe(n)+1).replace(zpe,"")}function Md(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var y7=NaN,Vpe=/^[-+]0x[0-9a-f]+$/i,Gpe=/^0b[01]+$/i,$pe=/^0o[0-7]+$/i,Wpe=parseInt;function qpe(n){if(typeof n=="number")return n;if(Yk(n))return y7;if(Md(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=Md(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=Hpe(n);var t=Gpe.test(n);return t||$pe.test(n)?Wpe(n.slice(2),t?2:8):Vpe.test(n)?y7:+n}var b7=1/0,Ype=17976931348623157e292;function Kpe(n){if(!n)return n===0?n:0;if(n=qpe(n),n===b7||n===-b7){var e=n<0?-1:1;return e*Ype}return n===n?n:0}function Xk(n){var e=Kpe(n),t=e%1;return e===e?t?e-t:e:0}function ix(n){return n}var Xpe="[object AsyncFunction]",Zpe="[object Function]",Jpe="[object GeneratorFunction]",Qpe="[object Proxy]";function u_(n){if(!Md(n))return!1;var e=ey(n);return e==Zpe||e==Jpe||e==Xpe||e==Qpe}var yI=d0["__core-js_shared__"],S7=(function(){var n=/[^.]+$/.exec(yI&&yI.keys&&yI.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""})();function eme(n){return!!S7&&S7 in n}var tme=Function.prototype,nme=tme.toString;function Ib(n){if(n!=null){try{return nme.call(n)}catch{}try{return n+""}catch{}}return""}var rme=/[\\^$.*+?()[\]{}|]/g,ime=/^\[object .+?Constructor\]$/,sme=Function.prototype,ome=Object.prototype,ame=sme.toString,cme=ome.hasOwnProperty,lme=RegExp("^"+ame.call(cme).replace(rme,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ume(n){if(!Md(n)||eme(n))return!1;var e=u_(n)?lme:ime;return e.test(Ib(n))}function hme(n,e){return n?.[e]}function Nb(n,e){var t=hme(n,e);return ume(t)?t:void 0}var hL=Nb(d0,"WeakMap"),E7=Object.create,fme=(function(){function n(){}return function(e){if(!Md(e))return{};if(E7)return E7(e);n.prototype=e;var t=new n;return n.prototype=void 0,t}})();function dme(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}function Sc(){}function pme(n,e){var t=-1,r=n.length;for(e||(e=Array(r));++t<r;)e[t]=n[t];return e}var mme=800,gme=16,_me=Date.now;function vme(n){var e=0,t=0;return function(){var r=_me(),i=gme-(r-t);if(t=r,i>0){if(++e>=mme)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}function yme(n){return function(){return n}}var bM=(function(){try{var n=Nb(Object,"defineProperty");return n({},"",{}),n}catch{}})(),bme=bM?function(n,e){return bM(n,"toString",{configurable:!0,enumerable:!1,value:yme(e),writable:!0})}:ix,Sme=vme(bme);function WW(n,e){for(var t=-1,r=n==null?0:n.length;++t<r&&e(n[t],t,n)!==!1;);return n}function qW(n,e,t,r){for(var i=n.length,s=t+-1;++s<i;)if(e(n[s],s,n))return s;return-1}function Eme(n){return n!==n}function xme(n,e,t){for(var r=t-1,i=n.length;++r<i;)if(n[r]===e)return r;return-1}function E5(n,e,t){return e===e?xme(n,e,t):qW(n,Eme,t)}function YW(n,e){var t=n==null?0:n.length;return!!t&&E5(n,e,0)>-1}var Tme=9007199254740991,wme=/^(?:0|[1-9]\d*)$/;function Zk(n,e){var t=typeof n;return e=e??Tme,!!e&&(t=="number"||t!="symbol"&&wme.test(n))&&n>-1&&n%1==0&&n<e}function x5(n,e,t){e=="__proto__"&&bM?bM(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}function VA(n,e){return n===e||n!==n&&e!==e}var Ame=Object.prototype,Rme=Ame.hasOwnProperty;function Jk(n,e,t){var r=n[e];(!(Rme.call(n,e)&&VA(r,t))||t===void 0&&!(e in n))&&x5(n,e,t)}function T5(n,e,t,r){var i=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=n[a]),i?x5(t,a,c):Jk(t,a,c)}return t}var x7=Math.max;function Cme(n,e,t){return e=x7(e===void 0?n.length-1:e,0),function(){for(var r=arguments,i=-1,s=x7(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=t(o),dme(n,this,a)}}function w5(n,e){return Sme(Cme(n,e,ix),n+"")}var Mme=9007199254740991;function A5(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=Mme}function p0(n){return n!=null&&A5(n.length)&&!u_(n)}function KW(n,e,t){if(!Md(t))return!1;var r=typeof e;return(r=="number"?p0(t)&&Zk(e,t.length):r=="string"&&e in t)?VA(t[e],n):!1}function kme(n){return w5(function(e,t){var r=-1,i=t.length,s=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(s=n.length>3&&typeof s=="function"?(i--,s):void 0,o&&KW(t[0],t[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=t[r];a&&n(e,a,r,s)}return e})}var Ome=Object.prototype;function GA(n){var e=n&&n.constructor,t=typeof e=="function"&&e.prototype||Ome;return n===t}function Ime(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}var Nme="[object Arguments]";function T7(n){return bp(n)&&ey(n)==Nme}var XW=Object.prototype,Pme=XW.hasOwnProperty,Dme=XW.propertyIsEnumerable,Qk=T7((function(){return arguments})())?T7:function(n){return bp(n)&&Pme.call(n,"callee")&&!Dme.call(n,"callee")};function Lme(){return!1}var ZW=typeof Rf=="object"&&Rf&&!Rf.nodeType&&Rf,w7=ZW&&typeof Cf=="object"&&Cf&&!Cf.nodeType&&Cf,Ume=w7&&w7.exports===ZW,A7=Ume?d0.Buffer:void 0,Bme=A7?A7.isBuffer:void 0,Xw=Bme||Lme,Fme="[object Arguments]",jme="[object Array]",zme="[object Boolean]",Hme="[object Date]",Vme="[object Error]",Gme="[object Function]",$me="[object Map]",Wme="[object Number]",qme="[object Object]",Yme="[object RegExp]",Kme="[object Set]",Xme="[object String]",Zme="[object WeakMap]",Jme="[object ArrayBuffer]",Qme="[object DataView]",e0e="[object Float32Array]",t0e="[object Float64Array]",n0e="[object Int8Array]",r0e="[object Int16Array]",i0e="[object Int32Array]",s0e="[object Uint8Array]",o0e="[object Uint8ClampedArray]",a0e="[object Uint16Array]",c0e="[object Uint32Array]",po={};po[e0e]=po[t0e]=po[n0e]=po[r0e]=po[i0e]=po[s0e]=po[o0e]=po[a0e]=po[c0e]=!0;po[Fme]=po[jme]=po[Jme]=po[zme]=po[Qme]=po[Hme]=po[Vme]=po[Gme]=po[$me]=po[Wme]=po[qme]=po[Yme]=po[Kme]=po[Xme]=po[Zme]=!1;function l0e(n){return bp(n)&&A5(n.length)&&!!po[ey(n)]}function eO(n){return function(e){return n(e)}}var JW=typeof Rf=="object"&&Rf&&!Rf.nodeType&&Rf,Mw=JW&&typeof Cf=="object"&&Cf&&!Cf.nodeType&&Cf,u0e=Mw&&Mw.exports===JW,bI=u0e&&VW.process,zv=(function(){try{var n=Mw&&Mw.require&&Mw.require("util").types;return n||bI&&bI.binding&&bI.binding("util")}catch{}})(),R7=zv&&zv.isTypedArray,R5=R7?eO(R7):l0e,h0e=Object.prototype,f0e=h0e.hasOwnProperty;function QW(n,e){var t=Li(n),r=!t&&Qk(n),i=!t&&!r&&Xw(n),s=!t&&!r&&!i&&R5(n),o=t||r||i||s,a=o?Ime(n.length,String):[],c=a.length;for(var l in n)(e||f0e.call(n,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Zk(l,c)))&&a.push(l);return a}function eq(n,e){return function(t){return n(e(t))}}var d0e=eq(Object.keys,Object),p0e=Object.prototype,m0e=p0e.hasOwnProperty;function tq(n){if(!GA(n))return d0e(n);var e=[];for(var t in Object(n))m0e.call(n,t)&&t!="constructor"&&e.push(t);return e}function kd(n){return p0(n)?QW(n):tq(n)}var g0e=Object.prototype,_0e=g0e.hasOwnProperty,jh=kme(function(n,e){if(GA(e)||p0(e)){T5(e,kd(e),n);return}for(var t in e)_0e.call(e,t)&&Jk(n,t,e[t])});function v0e(n){var e=[];if(n!=null)for(var t in Object(n))e.push(t);return e}var y0e=Object.prototype,b0e=y0e.hasOwnProperty;function S0e(n){if(!Md(n))return v0e(n);var e=GA(n),t=[];for(var r in n)r=="constructor"&&(e||!b0e.call(n,r))||t.push(r);return t}function nq(n){return p0(n)?QW(n,!0):S0e(n)}var E0e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,x0e=/^\w*$/;function C5(n,e){if(Li(n))return!1;var t=typeof n;return t=="number"||t=="symbol"||t=="boolean"||n==null||Yk(n)?!0:x0e.test(n)||!E0e.test(n)||e!=null&&n in Object(e)}var Zw=Nb(Object,"create");function T0e(){this.__data__=Zw?Zw(null):{},this.size=0}function w0e(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var A0e="__lodash_hash_undefined__",R0e=Object.prototype,C0e=R0e.hasOwnProperty;function M0e(n){var e=this.__data__;if(Zw){var t=e[n];return t===A0e?void 0:t}return C0e.call(e,n)?e[n]:void 0}var k0e=Object.prototype,O0e=k0e.hasOwnProperty;function I0e(n){var e=this.__data__;return Zw?e[n]!==void 0:O0e.call(e,n)}var N0e="__lodash_hash_undefined__";function P0e(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=Zw&&e===void 0?N0e:e,this}function ob(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}ob.prototype.clear=T0e;ob.prototype.delete=w0e;ob.prototype.get=M0e;ob.prototype.has=I0e;ob.prototype.set=P0e;function D0e(){this.__data__=[],this.size=0}function tO(n,e){for(var t=n.length;t--;)if(VA(n[t][0],e))return t;return-1}var L0e=Array.prototype,U0e=L0e.splice;function B0e(n){var e=this.__data__,t=tO(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():U0e.call(e,t,1),--this.size,!0}function F0e(n){var e=this.__data__,t=tO(e,n);return t<0?void 0:e[t][1]}function j0e(n){return tO(this.__data__,n)>-1}function z0e(n,e){var t=this.__data__,r=tO(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}function h_(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}h_.prototype.clear=D0e;h_.prototype.delete=B0e;h_.prototype.get=F0e;h_.prototype.has=j0e;h_.prototype.set=z0e;var Jw=Nb(d0,"Map");function H0e(){this.size=0,this.__data__={hash:new ob,map:new(Jw||h_),string:new ob}}function V0e(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}function nO(n,e){var t=n.__data__;return V0e(e)?t[typeof e=="string"?"string":"hash"]:t.map}function G0e(n){var e=nO(this,n).delete(n);return this.size-=e?1:0,e}function $0e(n){return nO(this,n).get(n)}function W0e(n){return nO(this,n).has(n)}function q0e(n,e){var t=nO(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}function f_(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}f_.prototype.clear=H0e;f_.prototype.delete=G0e;f_.prototype.get=$0e;f_.prototype.has=W0e;f_.prototype.set=q0e;var Y0e="Expected a function";function M5(n,e){if(typeof n!="function"||e!=null&&typeof e!="function")throw new TypeError(Y0e);var t=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=t.cache;if(s.has(i))return s.get(i);var o=n.apply(this,r);return t.cache=s.set(i,o)||s,o};return t.cache=new(M5.Cache||f_),t}M5.Cache=f_;var K0e=500;function X0e(n){var e=M5(n,function(r){return t.size===K0e&&t.clear(),r}),t=e.cache;return e}var Z0e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,J0e=/\\(\\)?/g,Q0e=X0e(function(n){var e=[];return n.charCodeAt(0)===46&&e.push(""),n.replace(Z0e,function(t,r,i,s){e.push(i?s.replace(J0e,"$1"):r||t)}),e});function rq(n){return n==null?"":$W(n)}function rO(n,e){return Li(n)?n:C5(n,e)?[n]:Q0e(rq(n))}function $A(n){if(typeof n=="string"||Yk(n))return n;var e=n+"";return e=="0"&&1/n==-1/0?"-0":e}function k5(n,e){e=rO(e,n);for(var t=0,r=e.length;n!=null&&t<r;)n=n[$A(e[t++])];return t&&t==r?n:void 0}function ege(n,e,t){var r=n==null?void 0:k5(n,e);return r===void 0?t:r}function O5(n,e){for(var t=-1,r=e.length,i=n.length;++t<r;)n[i+t]=e[t];return n}var C7=Cd?Cd.isConcatSpreadable:void 0;function tge(n){return Li(n)||Qk(n)||!!(C7&&n&&n[C7])}function I5(n,e,t,r,i){var s=-1,o=n.length;for(t||(t=tge),i||(i=[]);++s<o;){var a=n[s];t(a)?O5(i,a):r||(i[i.length]=a)}return i}function Mf(n){var e=n==null?0:n.length;return e?I5(n):[]}var iq=eq(Object.getPrototypeOf,Object);function N5(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function nge(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:N5(n,e,t)}var rge="\\ud800-\\udfff",ige="\\u0300-\\u036f",sge="\\ufe20-\\ufe2f",oge="\\u20d0-\\u20ff",age=ige+sge+oge,cge="\\ufe0e\\ufe0f",lge="\\u200d",uge=RegExp("["+lge+rge+age+cge+"]");function sq(n){return uge.test(n)}function hge(n){return n.split("")}var oq="\\ud800-\\udfff",fge="\\u0300-\\u036f",dge="\\ufe20-\\ufe2f",pge="\\u20d0-\\u20ff",mge=fge+dge+pge,gge="\\ufe0e\\ufe0f",_ge="["+oq+"]",fL="["+mge+"]",dL="\\ud83c[\\udffb-\\udfff]",vge="(?:"+fL+"|"+dL+")",aq="[^"+oq+"]",cq="(?:\\ud83c[\\udde6-\\uddff]){2}",lq="[\\ud800-\\udbff][\\udc00-\\udfff]",yge="\\u200d",uq=vge+"?",hq="["+gge+"]?",bge="(?:"+yge+"(?:"+[aq,cq,lq].join("|")+")"+hq+uq+")*",Sge=hq+uq+bge,Ege="(?:"+[aq+fL+"?",fL,cq,lq,_ge].join("|")+")",xge=RegExp(dL+"(?="+dL+")|"+Ege+Sge,"g");function Tge(n){return n.match(xge)||[]}function wge(n){return sq(n)?Tge(n):hge(n)}function Age(n){return function(e){e=rq(e);var t=sq(e)?wge(e):void 0,r=t?t[0]:e.charAt(0),i=t?nge(t,1).join(""):e.slice(1);return r[n]()+i}}var fq=Age("toUpperCase");function Rge(n,e,t,r){var i=-1,s=n==null?0:n.length;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function Cge(){this.__data__=new h_,this.size=0}function Mge(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}function kge(n){return this.__data__.get(n)}function Oge(n){return this.__data__.has(n)}var Ige=200;function Nge(n,e){var t=this.__data__;if(t instanceof h_){var r=t.__data__;if(!Jw||r.length<Ige-1)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new f_(r)}return t.set(n,e),this.size=t.size,this}function Xm(n){var e=this.__data__=new h_(n);this.size=e.size}Xm.prototype.clear=Cge;Xm.prototype.delete=Mge;Xm.prototype.get=kge;Xm.prototype.has=Oge;Xm.prototype.set=Nge;function Pge(n,e){return n&&T5(e,kd(e),n)}var dq=typeof Rf=="object"&&Rf&&!Rf.nodeType&&Rf,M7=dq&&typeof Cf=="object"&&Cf&&!Cf.nodeType&&Cf,Dge=M7&&M7.exports===dq,k7=Dge?d0.Buffer:void 0,O7=k7?k7.allocUnsafe:void 0;function Lge(n,e){var t=n.length,r=O7?O7(t):new n.constructor(t);return n.copy(r),r}function P5(n,e){for(var t=-1,r=n==null?0:n.length,i=0,s=[];++t<r;){var o=n[t];e(o,t,n)&&(s[i++]=o)}return s}function pq(){return[]}var Uge=Object.prototype,Bge=Uge.propertyIsEnumerable,I7=Object.getOwnPropertySymbols,D5=I7?function(n){return n==null?[]:(n=Object(n),P5(I7(n),function(e){return Bge.call(n,e)}))}:pq;function Fge(n,e){return T5(n,D5(n),e)}var jge=Object.getOwnPropertySymbols,zge=jge?function(n){for(var e=[];n;)O5(e,D5(n)),n=iq(n);return e}:pq;function mq(n,e,t){var r=e(n);return Li(n)?r:O5(r,t(n))}function pL(n){return mq(n,kd,D5)}function Hge(n){return mq(n,nq,zge)}var mL=Nb(d0,"DataView"),gL=Nb(d0,"Promise"),zE=Nb(d0,"Set"),N7="[object Map]",Vge="[object Object]",P7="[object Promise]",D7="[object Set]",L7="[object WeakMap]",U7="[object DataView]",Gge=Ib(mL),$ge=Ib(Jw),Wge=Ib(gL),qge=Ib(zE),Yge=Ib(hL),dd=ey;(mL&&dd(new mL(new ArrayBuffer(1)))!=U7||Jw&&dd(new Jw)!=N7||gL&&dd(gL.resolve())!=P7||zE&&dd(new zE)!=D7||hL&&dd(new hL)!=L7)&&(dd=function(n){var e=ey(n),t=e==Vge?n.constructor:void 0,r=t?Ib(t):"";if(r)switch(r){case Gge:return U7;case $ge:return N7;case Wge:return P7;case qge:return D7;case Yge:return L7}return e});var Kge=Object.prototype,Xge=Kge.hasOwnProperty;function Zge(n){var e=n.length,t=new n.constructor(e);return e&&typeof n[0]=="string"&&Xge.call(n,"index")&&(t.index=n.index,t.input=n.input),t}var SM=d0.Uint8Array;function Jge(n){var e=new n.constructor(n.byteLength);return new SM(e).set(new SM(n)),e}function Qge(n,e){var t=n.buffer;return new n.constructor(t,n.byteOffset,n.byteLength)}var e_e=/\w*$/;function t_e(n){var e=new n.constructor(n.source,e_e.exec(n));return e.lastIndex=n.lastIndex,e}var B7=Cd?Cd.prototype:void 0,F7=B7?B7.valueOf:void 0;function n_e(n){return F7?Object(F7.call(n)):{}}function r_e(n,e){var t=n.buffer;return new n.constructor(t,n.byteOffset,n.length)}var i_e="[object Boolean]",s_e="[object Date]",o_e="[object Map]",a_e="[object Number]",c_e="[object RegExp]",l_e="[object Set]",u_e="[object String]",h_e="[object Symbol]",f_e="[object ArrayBuffer]",d_e="[object DataView]",p_e="[object Float32Array]",m_e="[object Float64Array]",g_e="[object Int8Array]",__e="[object Int16Array]",v_e="[object Int32Array]",y_e="[object Uint8Array]",b_e="[object Uint8ClampedArray]",S_e="[object Uint16Array]",E_e="[object Uint32Array]";function x_e(n,e,t){var r=n.constructor;switch(e){case f_e:return Jge(n);case i_e:case s_e:return new r(+n);case d_e:return Qge(n);case p_e:case m_e:case g_e:case __e:case v_e:case y_e:case b_e:case S_e:case E_e:return r_e(n);case o_e:return new r;case a_e:case u_e:return new r(n);case c_e:return t_e(n);case l_e:return new r;case h_e:return n_e(n)}}function T_e(n){return typeof n.constructor=="function"&&!GA(n)?fme(iq(n)):{}}var w_e="[object Map]";function A_e(n){return bp(n)&&dd(n)==w_e}var j7=zv&&zv.isMap,R_e=j7?eO(j7):A_e,C_e="[object Set]";function M_e(n){return bp(n)&&dd(n)==C_e}var z7=zv&&zv.isSet,k_e=z7?eO(z7):M_e,gq="[object Arguments]",O_e="[object Array]",I_e="[object Boolean]",N_e="[object Date]",P_e="[object Error]",_q="[object Function]",D_e="[object GeneratorFunction]",L_e="[object Map]",U_e="[object Number]",vq="[object Object]",B_e="[object RegExp]",F_e="[object Set]",j_e="[object String]",z_e="[object Symbol]",H_e="[object WeakMap]",V_e="[object ArrayBuffer]",G_e="[object DataView]",$_e="[object Float32Array]",W_e="[object Float64Array]",q_e="[object Int8Array]",Y_e="[object Int16Array]",K_e="[object Int32Array]",X_e="[object Uint8Array]",Z_e="[object Uint8ClampedArray]",J_e="[object Uint16Array]",Q_e="[object Uint32Array]",Zs={};Zs[gq]=Zs[O_e]=Zs[V_e]=Zs[G_e]=Zs[I_e]=Zs[N_e]=Zs[$_e]=Zs[W_e]=Zs[q_e]=Zs[Y_e]=Zs[K_e]=Zs[L_e]=Zs[U_e]=Zs[vq]=Zs[B_e]=Zs[F_e]=Zs[j_e]=Zs[z_e]=Zs[X_e]=Zs[Z_e]=Zs[J_e]=Zs[Q_e]=!0;Zs[P_e]=Zs[_q]=Zs[H_e]=!1;function EC(n,e,t,r,i,s){var o;if(o!==void 0)return o;if(!Md(n))return n;var a=Li(n);if(a)return o=Zge(n),pme(n,o);var c=dd(n),l=c==_q||c==D_e;if(Xw(n))return Lge(n);if(c==vq||c==gq||l&&!i)return o=l?{}:T_e(n),Fge(n,Pge(o,n));if(!Zs[c])return i?n:{};o=x_e(n,c),s||(s=new Xm);var u=s.get(n);if(u)return u;s.set(n,o),k_e(n)?n.forEach(function(d){o.add(EC(d,e,t,d,n,s))}):R_e(n)&&n.forEach(function(d,p){o.set(p,EC(d,e,t,p,n,s))});var h=pL,f=a?void 0:h(n);return WW(f||n,function(d,p){f&&(p=d,d=n[p]),Jk(o,p,EC(d,e,t,p,n,s))}),o}var eve=4;function Pl(n){return EC(n,eve)}function WA(n){for(var e=-1,t=n==null?0:n.length,r=0,i=[];++e<t;){var s=n[e];s&&(i[r++]=s)}return i}var tve="__lodash_hash_undefined__";function nve(n){return this.__data__.set(n,tve),this}function rve(n){return this.__data__.has(n)}function sx(n){var e=-1,t=n==null?0:n.length;for(this.__data__=new f_;++e<t;)this.add(n[e])}sx.prototype.add=sx.prototype.push=nve;sx.prototype.has=rve;function yq(n,e){for(var t=-1,r=n==null?0:n.length;++t<r;)if(e(n[t],t,n))return!0;return!1}function L5(n,e){return n.has(e)}var ive=1,sve=2;function bq(n,e,t,r,i,s){var o=t&ive,a=n.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(n),u=s.get(e);if(l&&u)return l==e&&u==n;var h=-1,f=!0,d=t&sve?new sx:void 0;for(s.set(n,e),s.set(e,n);++h<a;){var p=n[h],_=e[h];if(r)var g=o?r(_,p,h,e,n,s):r(p,_,h,n,e,s);if(g!==void 0){if(g)continue;f=!1;break}if(d){if(!yq(e,function(m,b){if(!L5(d,b)&&(p===m||i(p,m,t,r,s)))return d.push(b)})){f=!1;break}}else if(!(p===_||i(p,_,t,r,s))){f=!1;break}}return s.delete(n),s.delete(e),f}function ove(n){var e=-1,t=Array(n.size);return n.forEach(function(r,i){t[++e]=[i,r]}),t}function U5(n){var e=-1,t=Array(n.size);return n.forEach(function(r){t[++e]=r}),t}var ave=1,cve=2,lve="[object Boolean]",uve="[object Date]",hve="[object Error]",fve="[object Map]",dve="[object Number]",pve="[object RegExp]",mve="[object Set]",gve="[object String]",_ve="[object Symbol]",vve="[object ArrayBuffer]",yve="[object DataView]",H7=Cd?Cd.prototype:void 0,SI=H7?H7.valueOf:void 0;function bve(n,e,t,r,i,s,o){switch(t){case yve:if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case vve:return!(n.byteLength!=e.byteLength||!s(new SM(n),new SM(e)));case lve:case uve:case dve:return VA(+n,+e);case hve:return n.name==e.name&&n.message==e.message;case pve:case gve:return n==e+"";case fve:var a=ove;case mve:var c=r&ave;if(a||(a=U5),n.size!=e.size&&!c)return!1;var l=o.get(n);if(l)return l==e;r|=cve,o.set(n,e);var u=bq(a(n),a(e),r,i,s,o);return o.delete(n),u;case _ve:if(SI)return SI.call(n)==SI.call(e)}return!1}var Sve=1,Eve=Object.prototype,xve=Eve.hasOwnProperty;function Tve(n,e,t,r,i,s){var o=t&Sve,a=pL(n),c=a.length,l=pL(e),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var f=a[h];if(!(o?f in e:xve.call(e,f)))return!1}var d=s.get(n),p=s.get(e);if(d&&p)return d==e&&p==n;var _=!0;s.set(n,e),s.set(e,n);for(var g=o;++h<c;){f=a[h];var m=n[f],b=e[f];if(r)var y=o?r(b,m,f,e,n,s):r(m,b,f,n,e,s);if(!(y===void 0?m===b||i(m,b,t,r,s):y)){_=!1;break}g||(g=f=="constructor")}if(_&&!g){var x=n.constructor,T=e.constructor;x!=T&&"constructor"in n&&"constructor"in e&&!(typeof x=="function"&&x instanceof x&&typeof T=="function"&&T instanceof T)&&(_=!1)}return s.delete(n),s.delete(e),_}var wve=1,V7="[object Arguments]",G7="[object Array]",_2="[object Object]",Ave=Object.prototype,$7=Ave.hasOwnProperty;function Rve(n,e,t,r,i,s){var o=Li(n),a=Li(e),c=o?G7:dd(n),l=a?G7:dd(e);c=c==V7?_2:c,l=l==V7?_2:l;var u=c==_2,h=l==_2,f=c==l;if(f&&Xw(n)){if(!Xw(e))return!1;o=!0,u=!1}if(f&&!u)return s||(s=new Xm),o||R5(n)?bq(n,e,t,r,i,s):bve(n,e,c,t,r,i,s);if(!(t&wve)){var d=u&&$7.call(n,"__wrapped__"),p=h&&$7.call(e,"__wrapped__");if(d||p){var _=d?n.value():n,g=p?e.value():e;return s||(s=new Xm),i(_,g,t,r,s)}}return f?(s||(s=new Xm),Tve(n,e,t,r,i,s)):!1}function B5(n,e,t,r,i){return n===e?!0:n==null||e==null||!bp(n)&&!bp(e)?n!==n&&e!==e:Rve(n,e,t,r,B5,i)}var Cve=1,Mve=2;function kve(n,e,t,r){var i=t.length,s=i;if(n==null)return!s;for(n=Object(n);i--;){var o=t[i];if(o[2]?o[1]!==n[o[0]]:!(o[0]in n))return!1}for(;++i<s;){o=t[i];var a=o[0],c=n[a],l=o[1];if(o[2]){if(c===void 0&&!(a in n))return!1}else{var u=new Xm,h;if(!(h===void 0?B5(l,c,Cve|Mve,r,u):h))return!1}}return!0}function Sq(n){return n===n&&!Md(n)}function Ove(n){for(var e=kd(n),t=e.length;t--;){var r=e[t],i=n[r];e[t]=[r,i,Sq(i)]}return e}function Eq(n,e){return function(t){return t==null?!1:t[n]===e&&(e!==void 0||n in Object(t))}}function Ive(n){var e=Ove(n);return e.length==1&&e[0][2]?Eq(e[0][0],e[0][1]):function(t){return t===n||kve(t,n,e)}}function Nve(n,e){return n!=null&&e in Object(n)}function xq(n,e,t){e=rO(e,n);for(var r=-1,i=e.length,s=!1;++r<i;){var o=$A(e[r]);if(!(s=n!=null&&t(n,o)))break;n=n[o]}return s||++r!=i?s:(i=n==null?0:n.length,!!i&&A5(i)&&Zk(o,i)&&(Li(n)||Qk(n)))}function Pve(n,e){return n!=null&&xq(n,e,Nve)}var Dve=1,Lve=2;function Uve(n,e){return C5(n)&&Sq(e)?Eq($A(n),e):function(t){var r=ege(t,n);return r===void 0&&r===e?Pve(t,n):B5(e,r,Dve|Lve)}}function Bve(n){return function(e){return e?.[n]}}function Fve(n){return function(e){return k5(e,n)}}function jve(n){return C5(n)?Bve($A(n)):Fve(n)}function m0(n){return typeof n=="function"?n:n==null?ix:typeof n=="object"?Li(n)?Uve(n[0],n[1]):Ive(n):jve(n)}function zve(n,e,t,r){for(var i=-1,s=n==null?0:n.length;++i<s;){var o=n[i];e(r,o,t(o),n)}return r}function Hve(n){return function(e,t,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(t(s[c],c,s)===!1)break}return e}}var Vve=Hve();function Gve(n,e){return n&&Vve(n,e,kd)}function $ve(n,e){return function(t,r){if(t==null)return t;if(!p0(t))return n(t,r);for(var i=t.length,s=-1,o=Object(t);++s<i&&r(o[s],s,o)!==!1;);return t}}var Pb=$ve(Gve);function Wve(n,e,t,r){return Pb(n,function(i,s,o){e(r,i,t(i),o)}),r}function qve(n,e){return function(t,r){var i=Li(t)?zve:Wve,s=e?e():{};return i(t,n,m0(r),s)}}var Tq=Object.prototype,Yve=Tq.hasOwnProperty,F5=w5(function(n,e){n=Object(n);var t=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&KW(e[0],e[1],i)&&(r=1);++t<r;)for(var s=e[t],o=nq(s),a=-1,c=o.length;++a<c;){var l=o[a],u=n[l];(u===void 0||VA(u,Tq[l])&&!Yve.call(n,l))&&(n[l]=s[l])}return n});function W7(n){return bp(n)&&p0(n)}var Kve=200;function Xve(n,e,t,r){var i=-1,s=YW,o=!0,a=n.length,c=[],l=e.length;if(!a)return c;e.length>=Kve&&(s=L5,o=!1,e=new sx(e));e:for(;++i<a;){var u=n[i],h=u;if(u=u!==0?u:0,o&&h===h){for(var f=l;f--;)if(e[f]===h)continue e;c.push(u)}else s(e,h,r)||c.push(u)}return c}var iO=w5(function(n,e){return W7(n)?Xve(n,I5(e,1,W7,!0)):[]});function ox(n){var e=n==null?0:n.length;return e?n[e-1]:void 0}function Cl(n,e,t){var r=n==null?0:n.length;return r?(e=e===void 0?1:Xk(e),N5(n,e<0?0:e,r)):[]}function Qw(n,e,t){var r=n==null?0:n.length;return r?(e=e===void 0?1:Xk(e),e=r-e,N5(n,0,e<0?0:e)):[]}function Zve(n){return typeof n=="function"?n:ix}function Cr(n,e){var t=Li(n)?WW:Pb;return t(n,Zve(e))}function Jve(n,e){for(var t=-1,r=n==null?0:n.length;++t<r;)if(!e(n[t],t,n))return!1;return!0}function Qve(n,e){var t=!0;return Pb(n,function(r,i,s){return t=!!e(r,i,s),t}),t}function gp(n,e,t){var r=Li(n)?Jve:Qve;return r(n,m0(e))}function wq(n,e){var t=[];return Pb(n,function(r,i,s){e(r,i,s)&&t.push(r)}),t}function Pd(n,e){var t=Li(n)?P5:wq;return t(n,m0(e))}function eye(n){return function(e,t,r){var i=Object(e);if(!p0(e)){var s=m0(t);e=kd(e),t=function(a){return s(i[a],a,i)}}var o=n(e,t,r);return o>-1?i[s?e[o]:o]:void 0}}var tye=Math.max;function nye(n,e,t){var r=n==null?0:n.length;if(!r)return-1;var i=t==null?0:Xk(t);return i<0&&(i=tye(r+i,0)),qW(n,m0(e),i)}var ax=eye(nye);function Sp(n){return n&&n.length?n[0]:void 0}function rye(n,e){var t=-1,r=p0(n)?Array(n.length):[];return Pb(n,function(i,s,o){r[++t]=e(i,s,o)}),r}function Kn(n,e){var t=Li(n)?Kk:rye;return t(n,m0(e))}function Td(n,e){return I5(Kn(n,e))}var iye=Object.prototype,sye=iye.hasOwnProperty,Aq=qve(function(n,e,t){sye.call(n,t)?n[t].push(e):x5(n,t,[e])}),oye=Object.prototype,aye=oye.hasOwnProperty;function cye(n,e){return n!=null&&aye.call(n,e)}function Tr(n,e){return n!=null&&xq(n,e,cye)}var lye="[object String]";function zh(n){return typeof n=="string"||!Li(n)&&bp(n)&&ey(n)==lye}function uye(n,e){return Kk(e,function(t){return n[t]})}function ic(n){return n==null?[]:uye(n,kd(n))}var hye=Math.max;function Vu(n,e,t,r){n=p0(n)?n:ic(n),t=t?Xk(t):0;var i=n.length;return t<0&&(t=hye(i+t,0)),zh(n)?t<=i&&n.indexOf(e,t)>-1:!!i&&E5(n,e,t)>-1}function q7(n,e,t){var r=n==null?0:n.length;if(!r)return-1;var i=0;return E5(n,e,i)}var fye="[object Map]",dye="[object Set]",pye=Object.prototype,mye=pye.hasOwnProperty;function no(n){if(n==null)return!0;if(p0(n)&&(Li(n)||typeof n=="string"||typeof n.splice=="function"||Xw(n)||R5(n)||Qk(n)))return!n.length;var e=dd(n);if(e==fye||e==dye)return!n.size;if(GA(n))return!tq(n).length;for(var t in n)if(mye.call(n,t))return!1;return!0}var gye="[object RegExp]";function _ye(n){return bp(n)&&ey(n)==gye}var Y7=zv&&zv.isRegExp,n_=Y7?eO(Y7):_ye;function r_(n){return n===void 0}var vye="Expected a function";function yye(n){if(typeof n!="function")throw new TypeError(vye);return function(){var e=arguments;switch(e.length){case 0:return!n.call(this);case 1:return!n.call(this,e[0]);case 2:return!n.call(this,e[0],e[1]);case 3:return!n.call(this,e[0],e[1],e[2])}return!n.apply(this,e)}}function bye(n,e,t,r){if(!Md(n))return n;e=rO(e,n);for(var i=-1,s=e.length,o=s-1,a=n;a!=null&&++i<s;){var c=$A(e[i]),l=t;if(c==="__proto__"||c==="constructor"||c==="prototype")return n;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=Md(u)?u:Zk(e[i+1])?[]:{})}Jk(a,c,l),a=a[c]}return n}function Sye(n,e,t){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=k5(n,o);t(a,o)&&bye(s,rO(o,n),a)}return s}function Cp(n,e){if(n==null)return{};var t=Kk(Hge(n),function(r){return[r]});return e=m0(e),Sye(n,t,function(r,i){return e(r,i[0])})}function Eye(n,e,t,r,i){return i(n,function(s,o,a){t=r?(r=!1,s):e(t,s,o,a)}),t}function Hh(n,e,t){var r=Li(n)?Rge:Eye,i=arguments.length<3;return r(n,m0(e),t,i,Pb)}function sO(n,e){var t=Li(n)?P5:wq;return t(n,yye(m0(e)))}function xye(n,e){var t;return Pb(n,function(r,i,s){return t=e(r,i,s),!t}),!!t}function j5(n,e,t){var r=Li(n)?yq:xye;return r(n,m0(e))}var Tye=1/0,wye=zE&&1/U5(new zE([,-0]))[1]==Tye?function(n){return new zE(n)}:Sc,Aye=200;function Rye(n,e,t){var r=-1,i=YW,s=n.length,o=!0,a=[],c=a;if(s>=Aye){var l=wye(n);if(l)return U5(l);o=!1,i=L5,c=new sx}else c=a;e:for(;++r<s;){var u=n[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var f=c.length;f--;)if(c[f]===h)continue e;a.push(u)}else i(c,h,t)||(c!==a&&c.push(h),a.push(u))}return a}function oO(n){return n&&n.length?Rye(n):[]}function _L(n){console&&console.error&&console.error(`Error: ${n}`)}function Rq(n){console&&console.warn&&console.warn(`Warning: ${n}`)}function Cq(n){const e=new Date().getTime(),t=n();return{time:new Date().getTime()-e,value:t}}function Mq(n){function e(){}e.prototype=n;const t=new e;function r(){return typeof t.bar}return r(),r(),n}function Cye(n){return Mye(n)?n.LABEL:n.name}function Mye(n){return zh(n.LABEL)&&n.LABEL!==""}class g0{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Cr(this.definition,t=>{t.accept(e)})}}class Vh extends g0{constructor(e){super([]),this.idx=1,jh(this,Cp(e,t=>t!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Hx extends g0{constructor(e){super(e.definition),this.orgText="",jh(this,Cp(e,t=>t!==void 0))}}class Gh extends g0{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,jh(this,Cp(e,t=>t!==void 0))}}class Lh extends g0{constructor(e){super(e.definition),this.idx=1,jh(this,Cp(e,t=>t!==void 0))}}class _0 extends g0{constructor(e){super(e.definition),this.idx=1,jh(this,Cp(e,t=>t!==void 0))}}class v0 extends g0{constructor(e){super(e.definition),this.idx=1,jh(this,Cp(e,t=>t!==void 0))}}class Ac extends g0{constructor(e){super(e.definition),this.idx=1,jh(this,Cp(e,t=>t!==void 0))}}class Mp extends g0{constructor(e){super(e.definition),this.idx=1,jh(this,Cp(e,t=>t!==void 0))}}class kp extends g0{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,jh(this,Cp(e,t=>t!==void 0))}}class Jo{constructor(e){this.idx=1,jh(this,Cp(e,t=>t!==void 0))}accept(e){e.visit(this)}}function kye(n){return Kn(n,xC)}function xC(n){function e(t){return Kn(t,xC)}if(n instanceof Vh){const t={type:"NonTerminal",name:n.nonTerminalName,idx:n.idx};return zh(n.label)&&(t.label=n.label),t}else{if(n instanceof Gh)return{type:"Alternative",definition:e(n.definition)};if(n instanceof Lh)return{type:"Option",idx:n.idx,definition:e(n.definition)};if(n instanceof _0)return{type:"RepetitionMandatory",idx:n.idx,definition:e(n.definition)};if(n instanceof v0)return{type:"RepetitionMandatoryWithSeparator",idx:n.idx,separator:xC(new Jo({terminalType:n.separator})),definition:e(n.definition)};if(n instanceof Mp)return{type:"RepetitionWithSeparator",idx:n.idx,separator:xC(new Jo({terminalType:n.separator})),definition:e(n.definition)};if(n instanceof Ac)return{type:"Repetition",idx:n.idx,definition:e(n.definition)};if(n instanceof kp)return{type:"Alternation",idx:n.idx,definition:e(n.definition)};if(n instanceof Jo){const t={type:"Terminal",name:n.terminalType.name,label:Cye(n.terminalType),idx:n.idx};zh(n.label)&&(t.terminalLabel=n.label);const r=n.terminalType.PATTERN;return n.terminalType.PATTERN&&(t.pattern=n_(r)?r.source:r),t}else{if(n instanceof Hx)return{type:"Rule",name:n.name,orgText:n.orgText,definition:e(n.definition)};throw Error("non exhaustive match")}}}class Db{visit(e){const t=e;switch(t.constructor){case Vh:return this.visitNonTerminal(t);case Gh:return this.visitAlternative(t);case Lh:return this.visitOption(t);case _0:return this.visitRepetitionMandatory(t);case v0:return this.visitRepetitionMandatoryWithSeparator(t);case Mp:return this.visitRepetitionWithSeparator(t);case Ac:return this.visitRepetition(t);case kp:return this.visitAlternation(t);case Jo:return this.visitTerminal(t);case Hx:return this.visitRule(t);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function Oye(n){return n instanceof Gh||n instanceof Lh||n instanceof Ac||n instanceof _0||n instanceof v0||n instanceof Mp||n instanceof Jo||n instanceof Hx}function EM(n,e=[]){return n instanceof Lh||n instanceof Ac||n instanceof Mp?!0:n instanceof kp?j5(n.definition,r=>EM(r,e)):n instanceof Vh&&Vu(e,n)?!1:n instanceof g0?(n instanceof Vh&&e.push(n),gp(n.definition,r=>EM(r,e))):!1}function Iye(n){return n instanceof kp}function Nm(n){if(n instanceof Vh)return"SUBRULE";if(n instanceof Lh)return"OPTION";if(n instanceof kp)return"OR";if(n instanceof _0)return"AT_LEAST_ONE";if(n instanceof v0)return"AT_LEAST_ONE_SEP";if(n instanceof Mp)return"MANY_SEP";if(n instanceof Ac)return"MANY";if(n instanceof Jo)return"CONSUME";throw Error("non exhaustive match")}class aO{walk(e,t=[]){Cr(e.definition,(r,i)=>{const s=Cl(e.definition,i+1);if(r instanceof Vh)this.walkProdRef(r,s,t);else if(r instanceof Jo)this.walkTerminal(r,s,t);else if(r instanceof Gh)this.walkFlat(r,s,t);else if(r instanceof Lh)this.walkOption(r,s,t);else if(r instanceof _0)this.walkAtLeastOne(r,s,t);else if(r instanceof v0)this.walkAtLeastOneSep(r,s,t);else if(r instanceof Mp)this.walkManySep(r,s,t);else if(r instanceof Ac)this.walkMany(r,s,t);else if(r instanceof kp)this.walkOr(r,s,t);else throw Error("non exhaustive match")})}walkTerminal(e,t,r){}walkProdRef(e,t,r){}walkFlat(e,t,r){const i=t.concat(r);this.walk(e,i)}walkOption(e,t,r){const i=t.concat(r);this.walk(e,i)}walkAtLeastOne(e,t,r){const i=[new Lh({definition:e.definition})].concat(t,r);this.walk(e,i)}walkAtLeastOneSep(e,t,r){const i=K7(e,t,r);this.walk(e,i)}walkMany(e,t,r){const i=[new Lh({definition:e.definition})].concat(t,r);this.walk(e,i)}walkManySep(e,t,r){const i=K7(e,t,r);this.walk(e,i)}walkOr(e,t,r){const i=t.concat(r);Cr(e.definition,s=>{const o=new Gh({definition:[s]});this.walk(o,i)})}}function K7(n,e,t){return[new Lh({definition:[new Jo({terminalType:n.separator})].concat(n.definition)})].concat(e,t)}function qA(n){if(n instanceof Vh)return qA(n.referencedRule);if(n instanceof Jo)return Dye(n);if(Oye(n))return Nye(n);if(Iye(n))return Pye(n);throw Error("non exhaustive match")}function Nye(n){let e=[];const t=n.definition;let r=0,i=t.length>r,s,o=!0;for(;i&&o;)s=t[r],o=EM(s),e=e.concat(qA(s)),r=r+1,i=t.length>r;return oO(e)}function Pye(n){const e=Kn(n.definition,t=>qA(t));return oO(Mf(e))}function Dye(n){return[n.terminalType]}const kq="_~IN~_";class Lye extends aO{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,t,r){}walkProdRef(e,t,r){const i=Bye(e.referencedRule,e.idx)+this.topProd.name,s=t.concat(r),o=new Gh({definition:s}),a=qA(o);this.follows[i]=a}}function Uye(n){const e={};return Cr(n,t=>{const r=new Lye(t).startWalking();jh(e,r)}),e}function Bye(n,e){return n.name+e+kq}function Ir(n){return n.charCodeAt(0)}function EI(n,e){Array.isArray(n)?n.forEach(function(t){e.push(t)}):e.push(n)}function LT(n,e){if(n[e]===!0)throw"duplicate flag "+e;n[e],n[e]=!0}function YS(n){if(n===void 0)throw Error("Internal Error - Should never get here!");return!0}function Fye(){throw Error("Internal Error - Should never get here!")}function X7(n){return n.type==="Character"}const xM=[];for(let n=Ir("0");n<=Ir("9");n++)xM.push(n);const TM=[Ir("_")].concat(xM);for(let n=Ir("a");n<=Ir("z");n++)TM.push(n);for(let n=Ir("A");n<=Ir("Z");n++)TM.push(n);const Z7=[Ir(" "),Ir("\f"),Ir(`
`),Ir("\r"),Ir("	"),Ir("\v"),Ir("	"),Ir(""),Ir(""),Ir(""),Ir(""),Ir(""),Ir(""),Ir(""),Ir(""),Ir(""),Ir(""),Ir(""),Ir(""),Ir(""),Ir("\u2028"),Ir("\u2029"),Ir(""),Ir(""),Ir(""),Ir("\uFEFF")],jye=/[0-9a-fA-F]/,v2=/[0-9]/,zye=/[1-9]/;class Hye{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const t=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":LT(r,"global");break;case"i":LT(r,"ignoreCase");break;case"m":LT(r,"multiLine");break;case"u":LT(r,"unicode");break;case"y":LT(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:t,loc:this.loc(0)}}disjunction(){const e=[],t=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(t)}}alternative(){const e=[],t=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(t)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let t;switch(this.popChar()){case"=":t="Lookahead";break;case"!":t="NegativeLookahead";break}YS(t);const r=this.disjunction();return this.consumeChar(")"),{type:t,value:r,loc:this.loc(e)}}return Fye()}quantifier(e=!1){let t;const r=this.idx;switch(this.popChar()){case"*":t={atLeast:0,atMost:1/0};break;case"+":t={atLeast:1,atMost:1/0};break;case"?":t={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),t={atLeast:i,atMost:s}):t={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&t===void 0)return;YS(t);break}if(!(e===!0&&t===void 0)&&YS(t))return this.peekChar(0)==="?"?(this.consumeChar("?"),t.greedy=!1):t.greedy=!0,t.type="Quantifier",t.loc=this.loc(r),t}atom(){let e;const t=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),YS(e))return e.loc=this.loc(t),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Ir(`
`),Ir("\r"),Ir("\u2028"),Ir("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,t=!1;switch(this.popChar()){case"d":e=xM;break;case"D":e=xM,t=!0;break;case"s":e=Z7;break;case"S":e=Z7,t=!0;break;case"w":e=TM;break;case"W":e=TM,t=!0;break}if(YS(e))return{type:"Set",value:e,complement:t}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=Ir("\f");break;case"n":e=Ir(`
`);break;case"r":e=Ir("\r");break;case"t":e=Ir("	");break;case"v":e=Ir("\v");break}if(YS(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Ir("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:Ir(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:Ir(e)}}}characterClass(){const e=[];let t=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),t=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,X7(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,X7(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else EI(r.value,e),e.push(Ir("-")),EI(i.value,e)}else EI(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:t,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Ir("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const t=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:t};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(zye.test(e)===!1)throw Error("Expecting a positive integer");for(;v2.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(v2.test(e)===!1)throw Error("Expecting an integer");for(;v2.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Ir(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return v2.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let t="";for(let i=0;i<e;i++){const s=this.popChar();if(jye.test(s)===!1)throw Error("Expecting a HexDecimal digits");t+=s}return{type:"Character",value:parseInt(t,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class z5{visitChildren(e){for(const t in e){const r=e[t];e.hasOwnProperty(t)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let TC={};const Vye=new Hye;function cO(n){const e=n.toString();if(TC.hasOwnProperty(e))return TC[e];{const t=Vye.pattern(e);return TC[e]=t,t}}function Gye(){TC={}}const Oq="Complement Sets are not supported for first char optimization",wM=`Unable to use "first char" lexer optimizations:
`;function $ye(n,e=!1){try{const t=cO(n);return vL(t.value,{},t.flags.ignoreCase)}catch(t){if(t.message===Oq)e&&Rq(`${wM}	Unable to optimize: < ${n.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),_L(`${wM}
	Failed parsing: < ${n.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function vL(n,e,t){switch(n.type){case"Disjunction":for(let i=0;i<n.value.length;i++)vL(n.value[i],e,t);break;case"Alternative":const r=n.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":y2(o.value,e,t);break;case"Set":if(o.complement===!0)throw Error(Oq);Cr(o.value,c=>{if(typeof c=="number")y2(c,e,t);else{const l=c;if(t===!0)for(let u=l.from;u<=l.to;u++)y2(u,e,t);else{for(let u=l.from;u<=l.to&&u<vw;u++)y2(u,e,t);if(l.to>=vw){const u=l.from>=vw?l.from:vw,h=l.to,f=Hv(u),d=Hv(h);for(let p=f;p<=d;p++)e[p]=p}}}});break;case"Group":vL(o.value,e,t);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&yL(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return ic(e)}function y2(n,e,t){const r=Hv(n);e[r]=r,t===!0&&Wye(n,e)}function Wye(n,e){const t=String.fromCharCode(n),r=t.toUpperCase();if(r!==t){const i=Hv(r.charCodeAt(0));e[i]=i}else{const i=t.toLowerCase();if(i!==t){const s=Hv(i.charCodeAt(0));e[s]=s}}}function J7(n,e){return ax(n.value,t=>{if(typeof t=="number")return Vu(e,t);{const r=t;return ax(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function yL(n){const e=n.quantifier;return e&&e.atLeast===0?!0:n.value?Li(n.value)?gp(n.value,yL):yL(n.value):!1}class qye extends z5{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){Vu(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?J7(e,this.targetCharCodes)===void 0&&(this.found=!0):J7(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function H5(n,e){if(e instanceof RegExp){const t=cO(e),r=new qye(n);return r.visit(t),r.found}else return ax(e,t=>Vu(n,t.charCodeAt(0)))!==void 0}const ab="PATTERN",_w="defaultMode",b2="modes";let Iq=typeof new RegExp("(?:)").sticky=="boolean";function Yye(n,e){e=F5(e,{useSticky:Iq,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(b,y)=>y()});const t=e.tracer;t("initCharCodeToOptimizedIndexMap",()=>{_1e()});let r;t("Reject Lexer.NA",()=>{r=sO(n,b=>b[ab]===ll.NA)});let i=!1,s;t("Transform Patterns",()=>{i=!1,s=Kn(r,b=>{const y=b[ab];if(n_(y)){const x=y.source;return x.length===1&&x!=="^"&&x!=="$"&&x!=="."&&!y.ignoreCase?x:x.length===2&&x[0]==="\\"&&!Vu(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],x[1])?x[1]:e.useSticky?e9(y):Q7(y)}else{if(u_(y))return i=!0,{exec:y};if(typeof y=="object")return i=!0,y;if(typeof y=="string"){if(y.length===1)return y;{const x=y.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),T=new RegExp(x);return e.useSticky?e9(T):Q7(T)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;t("misc mapping",()=>{o=Kn(r,b=>b.tokenTypeIdx),a=Kn(r,b=>{const y=b.GROUP;if(y!==ll.SKIPPED){if(zh(y))return y;if(r_(y))return!1;throw Error("non exhaustive match")}}),c=Kn(r,b=>{const y=b.LONGER_ALT;if(y)return Li(y)?Kn(y,T=>q7(r,T)):[q7(r,y)]}),l=Kn(r,b=>b.PUSH_MODE),u=Kn(r,b=>Tr(b,"POP_MODE"))});let h;t("Line Terminator Handling",()=>{const b=Dq(e.lineTerminatorCharacters);h=Kn(r,y=>!1),e.positionTracking!=="onlyOffset"&&(h=Kn(r,y=>Tr(y,"LINE_BREAKS")?!!y.LINE_BREAKS:Pq(y,b)===!1&&H5(b,y.PATTERN)))});let f,d,p,_;t("Misc Mapping #2",()=>{f=Kn(r,Nq),d=Kn(s,p1e),p=Hh(r,(b,y)=>{const x=y.GROUP;return zh(x)&&x!==ll.SKIPPED&&(b[x]=[]),b},{}),_=Kn(s,(b,y)=>({pattern:s[y],longerAlt:c[y],canLineTerminator:h[y],isCustom:f[y],short:d[y],group:a[y],push:l[y],pop:u[y],tokenTypeIdx:o[y],tokenType:r[y]}))});let g=!0,m=[];return e.safeMode||t("First Char Optimization",()=>{m=Hh(r,(b,y,x)=>{if(typeof y.PATTERN=="string"){const T=y.PATTERN.charCodeAt(0),k=Hv(T);xI(b,k,_[x])}else if(Li(y.START_CHARS_HINT)){let T;Cr(y.START_CHARS_HINT,k=>{const R=typeof k=="string"?k.charCodeAt(0):k,P=Hv(R);T!==P&&(T=P,xI(b,P,_[x]))})}else if(n_(y.PATTERN))if(y.PATTERN.unicode)g=!1,e.ensureOptimizations&&_L(`${wM}	Unable to analyze < ${y.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const T=$ye(y.PATTERN,e.ensureOptimizations);no(T)&&(g=!1),Cr(T,k=>{xI(b,k,_[x])})}else e.ensureOptimizations&&_L(`${wM}	TokenType: <${y.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),g=!1;return b},[])}),{emptyGroups:p,patternIdxToConfig:_,charCodeToPatternIdxToConfig:m,hasCustom:i,canBeOptimized:g}}function Kye(n,e){let t=[];const r=Zye(n);t=t.concat(r.errors);const i=Jye(r.valid),s=i.valid;return t=t.concat(i.errors),t=t.concat(Xye(s)),t=t.concat(o1e(s)),t=t.concat(a1e(s,e)),t=t.concat(c1e(s)),t}function Xye(n){let e=[];const t=Pd(n,r=>n_(r[ab]));return e=e.concat(e1e(t)),e=e.concat(r1e(t)),e=e.concat(i1e(t)),e=e.concat(s1e(t)),e=e.concat(t1e(t)),e}function Zye(n){const e=Pd(n,i=>!Tr(i,ab)),t=Kn(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Sa.MISSING_PATTERN,tokenTypes:[i]})),r=iO(n,e);return{errors:t,valid:r}}function Jye(n){const e=Pd(n,i=>{const s=i[ab];return!n_(s)&&!u_(s)&&!Tr(s,"exec")&&!zh(s)}),t=Kn(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Sa.INVALID_PATTERN,tokenTypes:[i]})),r=iO(n,e);return{errors:t,valid:r}}const Qye=/[^\\][$]/;function e1e(n){class e extends z5{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const t=Pd(n,i=>{const s=i.PATTERN;try{const o=cO(s),a=new e;return a.visit(o),a.found}catch{return Qye.test(s.source)}});return Kn(t,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Sa.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function t1e(n){const e=Pd(n,r=>r.PATTERN.test(""));return Kn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Sa.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const n1e=/[^\\[][\^]|^\^/;function r1e(n){class e extends z5{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const t=Pd(n,i=>{const s=i.PATTERN;try{const o=cO(s),a=new e;return a.visit(o),a.found}catch{return n1e.test(s.source)}});return Kn(t,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Sa.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function i1e(n){const e=Pd(n,r=>{const i=r[ab];return i instanceof RegExp&&(i.multiline||i.global)});return Kn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Sa.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function s1e(n){const e=[];let t=Kn(n,s=>Hh(n,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Vu(e,a)&&a.PATTERN!==ll.NA&&(e.push(a),o.push(a)),o),[]));t=WA(t);const r=Pd(t,s=>s.length>1);return Kn(r,s=>{const o=Kn(s,c=>c.name);return{message:`The same RegExp pattern ->${Sp(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Sa.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function o1e(n){const e=Pd(n,r=>{if(!Tr(r,"GROUP"))return!1;const i=r.GROUP;return i!==ll.SKIPPED&&i!==ll.NA&&!zh(i)});return Kn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Sa.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function a1e(n,e){const t=Pd(n,i=>i.PUSH_MODE!==void 0&&!Vu(e,i.PUSH_MODE));return Kn(t,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Sa.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function c1e(n){const e=[],t=Hh(n,(r,i,s)=>{const o=i.PATTERN;return o===ll.NA||(zh(o)?r.push({str:o,idx:s,tokenType:i}):n_(o)&&u1e(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Cr(n,(r,i)=>{Cr(t,({str:s,idx:o,tokenType:a})=>{if(i<o&&l1e(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:Sa.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function l1e(n,e){if(n_(e)){const t=e.exec(n);return t!==null&&t.index===0}else{if(u_(e))return e(n,0,[],{});if(Tr(e,"exec"))return e.exec(n,0,[],{});if(typeof e=="string")return e===n;throw Error("non exhaustive match")}}function u1e(n){return ax([".","\\","[","]","|","^","$","(",")","?","*","+","{"],t=>n.source.indexOf(t)!==-1)===void 0}function Q7(n){const e=n.ignoreCase?"i":"";return new RegExp(`^(?:${n.source})`,e)}function e9(n){const e=n.ignoreCase?"iy":"y";return new RegExp(`${n.source}`,e)}function h1e(n,e,t){const r=[];return Tr(n,_w)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+_w+`> property in its definition
`,type:Sa.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Tr(n,b2)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+b2+`> property in its definition
`,type:Sa.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Tr(n,b2)&&Tr(n,_w)&&!Tr(n.modes,n.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${_w}: <${n.defaultMode}>which does not exist
`,type:Sa.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Tr(n,b2)&&Cr(n.modes,(i,s)=>{Cr(i,(o,a)=>{if(r_(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Sa.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Tr(o,"LONGER_ALT")){const c=Li(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Cr(c,l=>{!r_(l)&&!Vu(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Sa.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function f1e(n,e,t){const r=[];let i=!1;const s=WA(Mf(ic(n.modes))),o=sO(s,c=>c[ab]===ll.NA),a=Dq(t);return e&&Cr(o,c=>{const l=Pq(c,a);if(l!==!1){const h={message:g1e(c,l),type:l.issue,tokenType:c};r.push(h)}else Tr(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):H5(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Sa.NO_LINE_BREAKS_FLAGS}),r}function d1e(n){const e={},t=kd(n);return Cr(t,r=>{const i=n[r];if(Li(i))e[r]=[];else throw Error("non exhaustive match")}),e}function Nq(n){const e=n.PATTERN;if(n_(e))return!1;if(u_(e))return!0;if(Tr(e,"exec"))return!0;if(zh(e))return!1;throw Error("non exhaustive match")}function p1e(n){return zh(n)&&n.length===1?n.charCodeAt(0):!1}const m1e={test:function(n){const e=n.length;for(let t=this.lastIndex;t<e;t++){const r=n.charCodeAt(t);if(r===10)return this.lastIndex=t+1,!0;if(r===13)return n.charCodeAt(t+1)===10?this.lastIndex=t+2:this.lastIndex=t+1,!0}return!1},lastIndex:0};function Pq(n,e){if(Tr(n,"LINE_BREAKS"))return!1;if(n_(n.PATTERN)){try{H5(e,n.PATTERN)}catch(t){return{issue:Sa.IDENTIFY_TERMINATOR,errMsg:t.message}}return!1}else{if(zh(n.PATTERN))return!1;if(Nq(n))return{issue:Sa.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function g1e(n,e){if(e.issue===Sa.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${n.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===Sa.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${n.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Dq(n){return Kn(n,t=>zh(t)?t.charCodeAt(0):t)}function xI(n,e,t){n[e]===void 0?n[e]=[t]:n[e].push(t)}const vw=256;let wC=[];function Hv(n){return n<vw?n:wC[n]}function _1e(){if(no(wC)){wC=new Array(65536);for(let n=0;n<65536;n++)wC[n]=n>255?255+~~(n/255):n}}function YA(n,e){const t=n.tokenTypeIdx;return t===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[t]===!0}function AM(n,e){return n.tokenTypeIdx===e.tokenTypeIdx}let t9=1;const Lq={};function KA(n){const e=v1e(n);y1e(e),S1e(e),b1e(e),Cr(e,t=>{t.isParent=t.categoryMatches.length>0})}function v1e(n){let e=Pl(n),t=n,r=!0;for(;r;){t=WA(Mf(Kn(t,s=>s.CATEGORIES)));const i=iO(t,e);e=e.concat(i),no(i)?r=!1:t=i}return e}function y1e(n){Cr(n,e=>{Bq(e)||(Lq[t9]=e,e.tokenTypeIdx=t9++),n9(e)&&!Li(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),n9(e)||(e.CATEGORIES=[]),E1e(e)||(e.categoryMatches=[]),x1e(e)||(e.categoryMatchesMap={})})}function b1e(n){Cr(n,e=>{e.categoryMatches=[],Cr(e.categoryMatchesMap,(t,r)=>{e.categoryMatches.push(Lq[r].tokenTypeIdx)})})}function S1e(n){Cr(n,e=>{Uq([],e)})}function Uq(n,e){Cr(n,t=>{e.categoryMatchesMap[t.tokenTypeIdx]=!0}),Cr(e.CATEGORIES,t=>{const r=n.concat(e);Vu(r,t)||Uq(r,t)})}function Bq(n){return Tr(n,"tokenTypeIdx")}function n9(n){return Tr(n,"CATEGORIES")}function E1e(n){return Tr(n,"categoryMatches")}function x1e(n){return Tr(n,"categoryMatchesMap")}function T1e(n){return Tr(n,"tokenTypeIdx")}const w1e={buildUnableToPopLexerModeMessage(n){return`Unable to pop Lexer Mode after encountering Token ->${n.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(n,e,t,r,i){return`unexpected character: ->${n.charAt(e)}<- at offset: ${e}, skipped ${t} characters.`}};var Sa;(function(n){n[n.MISSING_PATTERN=0]="MISSING_PATTERN",n[n.INVALID_PATTERN=1]="INVALID_PATTERN",n[n.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",n[n.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",n[n.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",n[n.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",n[n.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",n[n.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",n[n.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",n[n.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",n[n.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",n[n.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",n[n.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",n[n.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",n[n.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",n[n.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",n[n.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",n[n.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Sa||(Sa={}));const yw={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:w1e,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(yw);let ll=class{constructor(e,t=yw){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Cq(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof t=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=jh({},yw,t);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===yw.lineTerminatorsPattern)this.config.lineTerminatorsPattern=m1e;else if(this.config.lineTerminatorCharacters===yw.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Li(e)?i={modes:{defaultMode:Pl(e)},defaultMode:_w}:(s=!1,i=Pl(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(h1e(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(f1e(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Cr(i.modes,(a,c)=>{i.modes[c]=sO(a,l=>r_(l))});const o=kd(i.modes);if(Cr(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Kye(a,o))}),no(this.lexerDefinitionErrors)){KA(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=Yye(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=jh({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!no(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Kn(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Cr(this.lexerDefinitionWarning,a=>{Rq(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Iq?(this.chopInput=ix,this.match=this.matchWithTest):(this.updateLastIndex=Sc,this.match=this.matchWithExec),s&&(this.handleModes=Sc),this.trackStartLines===!1&&(this.computeNewColumn=ix),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Sc),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Hh(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(t.ensureOptimizations&&!no(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{Gye()}),this.TRACE_INIT("toFastProperties",()=>{Mq(this)})})}tokenize(e,t=this.defaultMode){if(!no(this.lexerDefinitionErrors)){const i=Kn(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,t)}tokenizeInternal(e,t){let r,i,s,o,a,c,l,u,h,f,d,p,_,g,m;const b=e,y=b.length;let x=0,T=0;const k=this.hasCustom?0:Math.floor(e.length/10),R=new Array(k),P=[];let B=this.trackStartLines?1:void 0,U=this.trackStartLines?1:void 0;const z=d1e(this.emptyGroups),I=this.trackStartLines,L=this.config.lineTerminatorsPattern;let M=0,F=[],Z=[];const $=[],Y=[];Object.freeze(Y);let Q;function q(){return F}function V(Te){const Ie=Hv(Te),be=Z[Ie];return be===void 0?Y:be}const K=Te=>{if($.length===1&&Te.tokenType.PUSH_MODE===void 0){const Ie=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Te);P.push({offset:Te.startOffset,line:Te.startLine,column:Te.startColumn,length:Te.image.length,message:Ie})}else{$.pop();const Ie=ox($);F=this.patternIdxToConfig[Ie],Z=this.charCodeToPatternIdxToConfig[Ie],M=F.length;const be=this.canModeBeOptimized[Ie]&&this.config.safeMode===!1;Z&&be?Q=V:Q=q}};function ne(Te){$.push(Te),Z=this.charCodeToPatternIdxToConfig[Te],F=this.patternIdxToConfig[Te],M=F.length,M=F.length;const Ie=this.canModeBeOptimized[Te]&&this.config.safeMode===!1;Z&&Ie?Q=V:Q=q}ne.call(this,t);let ie;const ae=this.config.recoveryEnabled;for(;x<y;){c=null;const Te=b.charCodeAt(x),Ie=Q(Te),be=Ie.length;for(r=0;r<be;r++){ie=Ie[r];const Pe=ie.pattern;l=null;const $e=ie.short;if($e!==!1?Te===$e&&(c=Pe):ie.isCustom===!0?(m=Pe.exec(b,x,R,z),m!==null?(c=m[0],m.payload!==void 0&&(l=m.payload)):c=null):(this.updateLastIndex(Pe,x),c=this.match(Pe,e,x)),c!==null){if(a=ie.longerAlt,a!==void 0){const tt=a.length;for(s=0;s<tt;s++){const qe=F[a[s]],ut=qe.pattern;if(u=null,qe.isCustom===!0?(m=ut.exec(b,x,R,z),m!==null?(o=m[0],m.payload!==void 0&&(u=m.payload)):o=null):(this.updateLastIndex(ut,x),o=this.match(ut,e,x)),o&&o.length>c.length){c=o,l=u,ie=qe;break}}}break}}if(c!==null){if(h=c.length,f=ie.group,f!==void 0&&(d=ie.tokenTypeIdx,p=this.createTokenInstance(c,x,d,ie.tokenType,B,U,h),this.handlePayload(p,l),f===!1?T=this.addToken(R,T,p):z[f].push(p)),e=this.chopInput(e,h),x=x+h,U=this.computeNewColumn(U,h),I===!0&&ie.canLineTerminator===!0){let Pe=0,$e,tt;L.lastIndex=0;do $e=L.test(c),$e===!0&&(tt=L.lastIndex-1,Pe++);while($e===!0);Pe!==0&&(B=B+Pe,U=h-tt,this.updateTokenEndLineColumnLocation(p,f,tt,Pe,B,U,h))}this.handleModes(ie,K,ne,p)}else{const Pe=x,$e=B,tt=U;let qe=ae===!1;for(;qe===!1&&x<y;)for(e=this.chopInput(e,1),x++,i=0;i<M;i++){const ut=F[i],te=ut.pattern,Ne=ut.short;if(Ne!==!1?b.charCodeAt(x)===Ne&&(qe=!0):ut.isCustom===!0?qe=te.exec(b,x,R,z)!==null:(this.updateLastIndex(te,x),qe=te.exec(e)!==null),qe===!0)break}if(_=x-Pe,U=this.computeNewColumn(U,_),g=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(b,Pe,_,$e,tt),P.push({offset:Pe,line:$e,column:tt,length:_,message:g}),ae===!1)break}}return this.hasCustom||(R.length=T),{tokens:R,groups:z,errors:P}}handleModes(e,t,r,i){if(e.pop===!0){const s=e.push;t(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,t){return e.substring(t)}updateLastIndex(e,t){e.lastIndex=t}updateTokenEndLineColumnLocation(e,t,r,i,s,o,a){let c,l;t!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,t){return e+t}createOffsetOnlyToken(e,t,r,i){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,t,r,i,s,o){return{image:e,startOffset:t,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,t,r,i,s,o,a){return{image:e,startOffset:t,endOffset:t+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,t,r){return e.push(r),t}addTokenUsingMemberAccess(e,t,r){return e[t]=r,t++,t}handlePayloadNoCustom(e,t){}handlePayloadWithCustom(e,t){t!==null&&(e.payload=t)}matchWithTest(e,t,r){return e.test(t)===!0?t.substring(r,e.lastIndex):null}matchWithExec(e,t){const r=e.exec(t);return r!==null?r[0]:null}};ll.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.";ll.NA=/NOT_APPLICABLE/;function kw(n){return Fq(n)?n.LABEL:n.name}function Fq(n){return zh(n.LABEL)&&n.LABEL!==""}const A1e="parent",r9="categories",i9="label",s9="group",o9="push_mode",a9="pop_mode",c9="longer_alt",l9="line_breaks",u9="start_chars_hint";function Gu(n){return R1e(n)}function R1e(n){const e=n.pattern,t={};if(t.name=n.name,r_(e)||(t.PATTERN=e),Tr(n,A1e))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Tr(n,r9)&&(t.CATEGORIES=n[r9]),KA([t]),Tr(n,i9)&&(t.LABEL=n[i9]),Tr(n,s9)&&(t.GROUP=n[s9]),Tr(n,a9)&&(t.POP_MODE=n[a9]),Tr(n,o9)&&(t.PUSH_MODE=n[o9]),Tr(n,c9)&&(t.LONGER_ALT=n[c9]),Tr(n,l9)&&(t.LINE_BREAKS=n[l9]),Tr(n,u9)&&(t.START_CHARS_HINT=n[u9]),t}const cb=Gu({name:"EOF",pattern:ll.NA});KA([cb]);function XA(n,e,t,r,i,s,o,a){return{image:e,startOffset:t,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:n.tokenTypeIdx,tokenType:n}}function C1e(n,e){return YA(n,e)}const jq={buildMismatchTokenMessage({expected:n,actual:e,previous:t,ruleName:r}){return`Expecting ${Fq(n)?`--> ${kw(n)} <--`:`token of type --> ${n.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:n,ruleName:e}){return"Redundant input, expecting EOF but found: "+n.image},buildNoViableAltMessage({expectedPathsPerAlt:n,actual:e,previous:t,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Sp(e).image+"'";if(r)return s+r+a;{const c=Hh(n,(f,d)=>f.concat(d),[]),l=Kn(c,f=>`[${Kn(f,d=>kw(d)).join(", ")}]`),h=`one of these possible Token sequences:
${Kn(l,(f,d)=>`  ${d+1}. ${f}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:n,actual:e,customUserDescription:t,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Sp(e).image+"'";if(t)return i+t+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Kn(n,l=>`[${Kn(l,u=>kw(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(jq);const M1e={buildRuleNotFoundError(n,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+n.name+"<-"}},B1={buildDuplicateFoundError(n,e){function t(u){return u instanceof Jo?u.terminalType.name:u instanceof Vh?u.nonTerminalName:""}const r=n.name,i=Sp(e),s=i.idx,o=Nm(i),a=t(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(n){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${n.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(n){const e=Kn(n.prefixPath,i=>kw(i)).join(", "),t=n.alternation.idx===0?"":n.alternation.idx;return`Ambiguous alternatives: <${n.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${t}> inside <${n.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(n){const e=Kn(n.prefixPath,i=>kw(i)).join(", "),t=n.alternation.idx===0?"":n.alternation.idx;let r=`Ambiguous Alternatives Detected: <${n.ambiguityIndices.join(" ,")}> in <OR${t}> inside <${n.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(n){let e=Nm(n.repetition);return n.repetition.idx!==0&&(e+=n.repetition.idx),`The repetition <${e}> within Rule <${n.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(n){return"deprecated"},buildEmptyAlternationError(n){return`Ambiguous empty alternative: <${n.emptyChoiceIdx+1}> in <OR${n.alternation.idx}> inside <${n.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(n){return`An Alternation cannot have more than 256 alternatives:
<OR${n.alternation.idx}> inside <${n.topLevelRule.name}> Rule.
 has ${n.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(n){const e=n.topLevelRule.name,t=Kn(n.leftRecursionPath,s=>s.name),r=`${e} --> ${t.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(n){return"deprecated"},buildDuplicateRuleNameError(n){let e;return n.topLevelRule instanceof Hx?e=n.topLevelRule.name:e=n.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${n.grammarName}<-`}};function k1e(n,e){const t=new O1e(n,e);return t.resolveRefs(),t.errors}class O1e extends Db{constructor(e,t){super(),this.nameToTopRule=e,this.errMsgProvider=t,this.errors=[]}resolveRefs(){Cr(ic(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const t=this.nameToTopRule[e.nonTerminalName];if(t)e.referencedRule=t;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:ju.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class I1e extends aO{constructor(e,t){super(),this.topProd=e,this.path=t,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Pl(this.path.ruleStack).reverse(),this.occurrenceStack=Pl(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,t=[]){this.found||super.walk(e,t)}walkProdRef(e,t,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=t.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){no(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class N1e extends I1e{constructor(e,t){super(e,t),this.path=t,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,t,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=t.concat(r),s=new Gh({definition:i});this.possibleTokTypes=qA(s),this.found=!0}}}class lO extends aO{constructor(e,t){super(),this.topRule=e,this.occurrence=t,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class P1e extends lO{walkMany(e,t,r){if(e.idx===this.occurrence){const i=Sp(t.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Jo&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,t,r)}}class h9 extends lO{walkManySep(e,t,r){if(e.idx===this.occurrence){const i=Sp(t.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Jo&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,t,r)}}class D1e extends lO{walkAtLeastOne(e,t,r){if(e.idx===this.occurrence){const i=Sp(t.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Jo&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,t,r)}}class f9 extends lO{walkAtLeastOneSep(e,t,r){if(e.idx===this.occurrence){const i=Sp(t.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Jo&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,t,r)}}function bL(n,e,t=[]){t=Pl(t);let r=[],i=0;function s(a){return a.concat(Cl(n,i+1))}function o(a){const c=bL(s(a),e,t);return r.concat(c)}for(;t.length<e&&i<n.length;){const a=n[i];if(a instanceof Gh)return o(a.definition);if(a instanceof Vh)return o(a.definition);if(a instanceof Lh)r=o(a.definition);else if(a instanceof _0){const c=a.definition.concat([new Ac({definition:a.definition})]);return o(c)}else if(a instanceof v0){const c=[new Gh({definition:a.definition}),new Ac({definition:[new Jo({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Mp){const c=a.definition.concat([new Ac({definition:[new Jo({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Ac){const c=a.definition.concat([new Ac({definition:a.definition})]);r=o(c)}else{if(a instanceof kp)return Cr(a.definition,c=>{no(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Jo)t.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:t,suffixDef:Cl(n,i)}),r}function zq(n,e,t,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:n,ruleStack:[],occurrenceStack:[]});!no(h);){const f=h.pop();if(f===o){a&&ox(h).idx<=l&&h.pop();continue}const d=f.def,p=f.idx,_=f.ruleStack,g=f.occurrenceStack;if(no(d))continue;const m=d[0];if(m===i){const b={idx:p,def:Cl(d),ruleStack:Qw(_),occurrenceStack:Qw(g)};h.push(b)}else if(m instanceof Jo)if(p<c-1){const b=p+1,y=e[b];if(t(y,m.terminalType)){const x={idx:b,def:Cl(d),ruleStack:_,occurrenceStack:g};h.push(x)}}else if(p===c-1)u.push({nextTokenType:m.terminalType,nextTokenOccurrence:m.idx,ruleStack:_,occurrenceStack:g}),a=!0;else throw Error("non exhaustive match");else if(m instanceof Vh){const b=Pl(_);b.push(m.nonTerminalName);const y=Pl(g);y.push(m.idx);const x={idx:p,def:m.definition.concat(s,Cl(d)),ruleStack:b,occurrenceStack:y};h.push(x)}else if(m instanceof Lh){const b={idx:p,def:Cl(d),ruleStack:_,occurrenceStack:g};h.push(b),h.push(o);const y={idx:p,def:m.definition.concat(Cl(d)),ruleStack:_,occurrenceStack:g};h.push(y)}else if(m instanceof _0){const b=new Ac({definition:m.definition,idx:m.idx}),y=m.definition.concat([b],Cl(d)),x={idx:p,def:y,ruleStack:_,occurrenceStack:g};h.push(x)}else if(m instanceof v0){const b=new Jo({terminalType:m.separator}),y=new Ac({definition:[b].concat(m.definition),idx:m.idx}),x=m.definition.concat([y],Cl(d)),T={idx:p,def:x,ruleStack:_,occurrenceStack:g};h.push(T)}else if(m instanceof Mp){const b={idx:p,def:Cl(d),ruleStack:_,occurrenceStack:g};h.push(b),h.push(o);const y=new Jo({terminalType:m.separator}),x=new Ac({definition:[y].concat(m.definition),idx:m.idx}),T=m.definition.concat([x],Cl(d)),k={idx:p,def:T,ruleStack:_,occurrenceStack:g};h.push(k)}else if(m instanceof Ac){const b={idx:p,def:Cl(d),ruleStack:_,occurrenceStack:g};h.push(b),h.push(o);const y=new Ac({definition:m.definition,idx:m.idx}),x=m.definition.concat([y],Cl(d)),T={idx:p,def:x,ruleStack:_,occurrenceStack:g};h.push(T)}else if(m instanceof kp)for(let b=m.definition.length-1;b>=0;b--){const y=m.definition[b],x={idx:p,def:y.definition.concat(Cl(d)),ruleStack:_,occurrenceStack:g};h.push(x),h.push(o)}else if(m instanceof Gh)h.push({idx:p,def:m.definition.concat(Cl(d)),ruleStack:_,occurrenceStack:g});else if(m instanceof Hx)h.push(L1e(m,p,_,g));else throw Error("non exhaustive match")}return u}function L1e(n,e,t,r){const i=Pl(t);i.push(n.name);const s=Pl(r);return s.push(1),{idx:e,def:n.definition,ruleStack:i,occurrenceStack:s}}var va;(function(n){n[n.OPTION=0]="OPTION",n[n.REPETITION=1]="REPETITION",n[n.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",n[n.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",n[n.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",n[n.ALTERNATION=5]="ALTERNATION"})(va||(va={}));function Hq(n){if(n instanceof Lh||n==="Option")return va.OPTION;if(n instanceof Ac||n==="Repetition")return va.REPETITION;if(n instanceof _0||n==="RepetitionMandatory")return va.REPETITION_MANDATORY;if(n instanceof v0||n==="RepetitionMandatoryWithSeparator")return va.REPETITION_MANDATORY_WITH_SEPARATOR;if(n instanceof Mp||n==="RepetitionWithSeparator")return va.REPETITION_WITH_SEPARATOR;if(n instanceof kp||n==="Alternation")return va.ALTERNATION;throw Error("non exhaustive match")}function U1e(n,e,t,r,i,s){const o=V5(n,e,t),a=$q(o)?AM:YA;return s(o,r,a,i)}function B1e(n,e,t,r,i,s){const o=G5(n,e,i,t),a=$q(o)?AM:YA;return s(o[0],a,r)}function F1e(n,e,t,r){const i=n.length,s=gp(n,o=>gp(o,a=>a.length===1));if(e)return function(o){const a=Kn(o,c=>c.GATE);for(let c=0;c<i;c++){const l=n[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))e:for(let f=0;f<u;f++){const d=l[f],p=d.length;for(let _=0;_<p;_++){const g=this.LA(_+1);if(t(g,d[_])===!1)continue e}return c}}};if(s&&!r){const o=Kn(n,c=>Mf(c)),a=Hh(o,(c,l,u)=>(Cr(l,h=>{Tr(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),Cr(h.categoryMatches,f=>{Tr(c,f)||(c[f]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=n[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let f=0;f<h;f++){const d=this.LA(f+1);if(t(d,u[f])===!1)continue e}return o}}}}function j1e(n,e,t){const r=gp(n,s=>s.length===1),i=n.length;if(r&&!t){const s=Mf(n);if(s.length===1&&no(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Hh(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Cr(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=n[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class z1e extends aO{constructor(e,t,r){super(),this.topProd=e,this.targetOccurrence=t,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,t,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===t?(this.restDef=r.concat(i),!0):!1}walkOption(e,t,r){this.checkIsTarget(e,va.OPTION,t,r)||super.walkOption(e,t,r)}walkAtLeastOne(e,t,r){this.checkIsTarget(e,va.REPETITION_MANDATORY,t,r)||super.walkOption(e,t,r)}walkAtLeastOneSep(e,t,r){this.checkIsTarget(e,va.REPETITION_MANDATORY_WITH_SEPARATOR,t,r)||super.walkOption(e,t,r)}walkMany(e,t,r){this.checkIsTarget(e,va.REPETITION,t,r)||super.walkOption(e,t,r)}walkManySep(e,t,r){this.checkIsTarget(e,va.REPETITION_WITH_SEPARATOR,t,r)||super.walkOption(e,t,r)}}class Vq extends Db{constructor(e,t,r){super(),this.targetOccurrence=e,this.targetProdType=t,this.targetRef=r,this.result=[]}checkIsTarget(e,t){e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,va.OPTION)}visitRepetition(e){this.checkIsTarget(e,va.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,va.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,va.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,va.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,va.ALTERNATION)}}function d9(n){const e=new Array(n);for(let t=0;t<n;t++)e[t]=[];return e}function TI(n){let e=[""];for(let t=0;t<n.length;t++){const r=n[t],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function H1e(n,e,t){for(let r=0;r<n.length;r++){if(r===t)continue;const i=n[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function Gq(n,e){const t=Kn(n,o=>bL([o],1)),r=d9(t.length),i=Kn(t,o=>{const a={};return Cr(o,c=>{const l=TI(c.partialPath);Cr(l,u=>{a[u]=!0})}),a});let s=t;for(let o=1;o<=e;o++){const a=s;s=d9(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,f=l[u].suffixDef,d=TI(h);if(H1e(i,d,c)||no(f)||h.length===e){const _=r[c];if(SL(_,h)===!1){_.push(h);for(let g=0;g<d.length;g++){const m=d[g];i[c][m]=!0}}}else{const _=bL(f,o+1,h);s[c]=s[c].concat(_),Cr(_,g=>{const m=TI(g.partialPath);Cr(m,b=>{i[c][b]=!0})})}}}}return r}function V5(n,e,t,r){const i=new Vq(n,va.ALTERNATION,r);return e.accept(i),Gq(i.result,t)}function G5(n,e,t,r){const i=new Vq(n,t);e.accept(i);const s=i.result,a=new z1e(e,n,t).startWalking(),c=new Gh({definition:s}),l=new Gh({definition:a});return Gq([c,l],r)}function SL(n,e){e:for(let t=0;t<n.length;t++){const r=n[t];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function V1e(n,e){return n.length<e.length&&gp(n,(t,r)=>{const i=e[r];return t===i||i.categoryMatchesMap[t.tokenTypeIdx]})}function $q(n){return gp(n,e=>gp(e,t=>gp(t,r=>no(r.categoryMatches))))}function G1e(n){const e=n.lookaheadStrategy.validate({rules:n.rules,tokenTypes:n.tokenTypes,grammarName:n.grammarName});return Kn(e,t=>Object.assign({type:ju.CUSTOM_LOOKAHEAD_VALIDATION},t))}function $1e(n,e,t,r){const i=Td(n,c=>W1e(c,t)),s=ibe(n,e,t),o=Td(n,c=>ebe(c,t)),a=Td(n,c=>K1e(c,n,r,t));return i.concat(s,o,a)}function W1e(n,e){const t=new Y1e;n.accept(t);const r=t.allProductions,i=Aq(r,q1e),s=Cp(i,a=>a.length>1);return Kn(ic(s),a=>{const c=Sp(a),l=e.buildDuplicateFoundError(n,a),u=Nm(c),h={message:l,type:ju.DUPLICATE_PRODUCTIONS,ruleName:n.name,dslName:u,occurrence:c.idx},f=Wq(c);return f&&(h.parameter=f),h})}function q1e(n){return`${Nm(n)}_#_${n.idx}_#_${Wq(n)}`}function Wq(n){return n instanceof Jo?n.terminalType.name:n instanceof Vh?n.nonTerminalName:""}class Y1e extends Db{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function K1e(n,e,t,r){const i=[];if(Hh(e,(o,a)=>a.name===n.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:n,grammarName:t});i.push({message:o,type:ju.DUPLICATE_RULE_NAME,ruleName:n.name})}return i}function X1e(n,e,t){const r=[];let i;return Vu(e,n)||(i=`Invalid rule override, rule: ->${n}<- cannot be overridden in the grammar: ->${t}<-as it is not defined in any of the super grammars `,r.push({message:i,type:ju.INVALID_RULE_OVERRIDE,ruleName:n})),r}function qq(n,e,t,r=[]){const i=[],s=AC(e.definition);if(no(s))return[];{const o=n.name;Vu(s,n)&&i.push({message:t.buildLeftRecursionError({topLevelRule:n,leftRecursionPath:r}),type:ju.LEFT_RECURSION,ruleName:o});const c=iO(s,r.concat([n])),l=Td(c,u=>{const h=Pl(r);return h.push(u),qq(n,u,t,h)});return i.concat(l)}}function AC(n){let e=[];if(no(n))return e;const t=Sp(n);if(t instanceof Vh)e.push(t.referencedRule);else if(t instanceof Gh||t instanceof Lh||t instanceof _0||t instanceof v0||t instanceof Mp||t instanceof Ac)e=e.concat(AC(t.definition));else if(t instanceof kp)e=Mf(Kn(t.definition,s=>AC(s.definition)));else if(!(t instanceof Jo))throw Error("non exhaustive match");const r=EM(t),i=n.length>1;if(r&&i){const s=Cl(n);return e.concat(AC(s))}else return e}class $5 extends Db{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function Z1e(n,e){const t=new $5;n.accept(t);const r=t.alternations;return Td(r,s=>{const o=Qw(s.definition);return Td(o,(a,c)=>{const l=zq([a],[],YA,1);return no(l)?[{message:e.buildEmptyAlternationError({topLevelRule:n,alternation:s,emptyChoiceIdx:c}),type:ju.NONE_LAST_EMPTY_ALT,ruleName:n.name,occurrence:s.idx,alternative:c+1}]:[]})})}function J1e(n,e,t){const r=new $5;n.accept(r);let i=r.alternations;return i=sO(i,o=>o.ignoreAmbiguities===!0),Td(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=V5(a,n,c,o),u=nbe(l,o,n,t),h=rbe(l,o,n,t);return u.concat(h)})}class Q1e extends Db{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function ebe(n,e){const t=new $5;n.accept(t);const r=t.alternations;return Td(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:n,alternation:s}),type:ju.TOO_MANY_ALTS,ruleName:n.name,occurrence:s.idx}]:[])}function tbe(n,e,t){const r=[];return Cr(n,i=>{const s=new Q1e;i.accept(s);const o=s.allProductions;Cr(o,a=>{const c=Hq(a),l=a.maxLookahead||e,u=a.idx,f=G5(u,i,c,l)[0];if(no(Mf(f))){const d=t.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:d,type:ju.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function nbe(n,e,t,r){const i=[],s=Hh(n,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||Cr(c,u=>{const h=[l];Cr(n,(f,d)=>{l!==d&&SL(f,u)&&e.definition[d].ignoreAmbiguities!==!0&&h.push(d)}),h.length>1&&!SL(i,u)&&(i.push(u),a.push({alts:h,path:u}))}),a),[]);return Kn(s,a=>{const c=Kn(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:ju.AMBIGUOUS_ALTS,ruleName:t.name,occurrence:e.idx,alternatives:a.alts}})}function rbe(n,e,t,r){const i=Hh(n,(o,a,c)=>{const l=Kn(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return WA(Td(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Pd(i,f=>e.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<c&&V1e(f.path,l));return Kn(u,f=>{const d=[f.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:d,prefixPath:f.path}),type:ju.AMBIGUOUS_PREFIX_ALTS,ruleName:t.name,occurrence:p,alternatives:d}})}))}function ibe(n,e,t){const r=[],i=Kn(e,s=>s.name);return Cr(n,s=>{const o=s.name;if(Vu(i,o)){const a=t.buildNamespaceConflictError(s);r.push({message:a,type:ju.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function sbe(n){const e=F5(n,{errMsgProvider:M1e}),t={};return Cr(n.rules,r=>{t[r.name]=r}),k1e(t,e.errMsgProvider)}function obe(n){return n=F5(n,{errMsgProvider:B1}),$1e(n.rules,n.tokenTypes,n.errMsgProvider,n.grammarName)}const Yq="MismatchedTokenException",Kq="NoViableAltException",Xq="EarlyExitException",Zq="NotAllInputParsedException",Jq=[Yq,Kq,Xq,Zq];Object.freeze(Jq);function RM(n){return Vu(Jq,n.name)}class uO extends Error{constructor(e,t){super(e),this.token=t,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Qq extends uO{constructor(e,t,r){super(e,t),this.previousToken=r,this.name=Yq}}class abe extends uO{constructor(e,t,r){super(e,t),this.previousToken=r,this.name=Kq}}class cbe extends uO{constructor(e,t){super(e,t),this.name=Zq}}class lbe extends uO{constructor(e,t,r){super(e,t),this.previousToken=r,this.name=Xq}}const wI={},eY="InRuleRecoveryException";class ube extends Error{constructor(e){super(e),this.name=eY}}class hbe{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Tr(e,"recoveryEnabled")?e.recoveryEnabled:i_.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=fbe)}getTokenToInsert(e){const t=XA(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,t,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const f=this.LA(0),d=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:f,ruleName:this.getCurrRuleFullName()}),p=new Qq(d,l,this.LA(0));p.resyncedTokens=Qw(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){h();return}else if(r.call(this)){h(),e.apply(this,t);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,t,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t)))}getFollowsForInRuleRecovery(e,t){const r=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new ube("sad sad panda")}canPerformInRuleRecovery(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,t){if(!this.canTokenTypeBeInsertedInRecovery(e)||no(t))return!1;const r=this.LA(1);return ax(t,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return Vu(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let t=this.LA(1),r=2;for(;;){const i=ax(e,s=>C1e(t,s));if(i!==void 0)return i;t=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return wI;const e=this.getLastExplicitRuleShortName(),t=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:t,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,t=this.RULE_OCCURRENCE_STACK;return Kn(e,(r,i)=>i===0?wI:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:t[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=Kn(this.buildFullFollowKeyStack(),t=>this.getFollowSetFromFollowKey(t));return Mf(e)}getFollowSetFromFollowKey(e){if(e===wI)return[cb];const t=e.ruleName+e.idxInCallingRule+kq+e.inRule;return this.resyncFollows[t]}addToResyncTokens(e,t){return this.tokenMatcher(e,cb)||t.push(e),t}reSyncTo(e){const t=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return Qw(t)}attemptInRepetitionRecovery(e,t,r,i,s,o,a){}getCurrentGrammarPath(e,t){const r=this.getHumanReadableRuleStack(),i=Pl(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:t}}getHumanReadableRuleStack(){return Kn(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function fbe(n,e,t,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const f=this.getCurrRuleFullName(),d=this.getGAstProductions()[f];c=new s(d,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=cb,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(n,e,t,l)}const dbe=4,ty=8,tY=1<<ty,nY=2<<ty,EL=3<<ty,xL=4<<ty,TL=5<<ty,RC=6<<ty;function AI(n,e,t){return t|e|n}class pbe{constructor(e){var t;this.maxLookahead=(t=e?.maxLookahead)!==null&&t!==void 0?t:i_.maxLookahead}validate(e){const t=this.validateNoLeftRecursion(e.rules);if(no(t)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...t,...r,...i,...s]}return t}validateNoLeftRecursion(e){return Td(e,t=>qq(t,t,B1))}validateEmptyOrAlternatives(e){return Td(e,t=>Z1e(t,B1))}validateAmbiguousAlternationAlternatives(e,t){return Td(e,r=>J1e(r,t,B1))}validateSomeNonEmptyLookaheadPath(e,t){return tbe(e,t,B1)}buildLookaheadForAlternation(e){return U1e(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,F1e)}buildLookaheadForOptional(e){return B1e(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Hq(e.prodType),j1e)}}class mbe{initLooksAhead(e){this.dynamicTokensEnabled=Tr(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:i_.dynamicTokensEnabled,this.maxLookahead=Tr(e,"maxLookahead")?e.maxLookahead:i_.maxLookahead,this.lookaheadStrategy=Tr(e,"lookaheadStrategy")?e.lookaheadStrategy:new pbe({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Cr(e,t=>{this.TRACE_INIT(`${t.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=_be(t);Cr(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Nm(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:t,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=AI(this.fullRuleNameToShort[t.name],tY,l.idx);this.setLaFuncCache(f,h)})}),Cr(i,l=>{this.computeLookaheadFunc(t,l.idx,EL,"Repetition",l.maxLookahead,Nm(l))}),Cr(s,l=>{this.computeLookaheadFunc(t,l.idx,nY,"Option",l.maxLookahead,Nm(l))}),Cr(o,l=>{this.computeLookaheadFunc(t,l.idx,xL,"RepetitionMandatory",l.maxLookahead,Nm(l))}),Cr(a,l=>{this.computeLookaheadFunc(t,l.idx,RC,"RepetitionMandatoryWithSeparator",l.maxLookahead,Nm(l))}),Cr(c,l=>{this.computeLookaheadFunc(t,l.idx,TL,"RepetitionWithSeparator",l.maxLookahead,Nm(l))})})})}computeLookaheadFunc(e,t,r,i,s,o){this.TRACE_INIT(`${o}${t===0?"":t}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:t,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=AI(this.fullRuleNameToShort[e.name],r,t);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,t){const r=this.getLastExplicitRuleShortName();return AI(r,e,t)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,t){this.lookAheadFuncsCache.set(e,t)}}class gbe extends Db{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const S2=new gbe;function _be(n){S2.reset(),n.accept(S2);const e=S2.dslMethods;return S2.reset(),e}function p9(n,e){isNaN(n.startOffset)===!0?(n.startOffset=e.startOffset,n.endOffset=e.endOffset):n.endOffset<e.endOffset&&(n.endOffset=e.endOffset)}function m9(n,e){isNaN(n.startOffset)===!0?(n.startOffset=e.startOffset,n.startColumn=e.startColumn,n.startLine=e.startLine,n.endOffset=e.endOffset,n.endColumn=e.endColumn,n.endLine=e.endLine):n.endOffset<e.endOffset&&(n.endOffset=e.endOffset,n.endColumn=e.endColumn,n.endLine=e.endLine)}function vbe(n,e,t){n.children[t]===void 0?n.children[t]=[e]:n.children[t].push(e)}function ybe(n,e,t){n.children[e]===void 0?n.children[e]=[t]:n.children[e].push(t)}const bbe="name";function rY(n,e){Object.defineProperty(n,bbe,{enumerable:!1,configurable:!0,writable:!1,value:e})}function Sbe(n,e){const t=kd(n),r=t.length;for(let i=0;i<r;i++){const s=t[i],o=n[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function Ebe(n,e){const t=function(){};rY(t,n+"BaseSemantics");const r={visit:function(i,s){if(Li(i)&&(i=i[0]),!r_(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=Tbe(this,e);if(!no(i)){const s=Kn(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return t.prototype=r,t.prototype.constructor=t,t._RULE_NAMES=e,t}function xbe(n,e,t){const r=function(){};rY(r,n+"BaseSemanticsWithDefaults");const i=Object.create(t.prototype);return Cr(e,s=>{i[s]=Sbe}),r.prototype=i,r.prototype.constructor=r,r}var wL;(function(n){n[n.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",n[n.MISSING_METHOD=1]="MISSING_METHOD"})(wL||(wL={}));function Tbe(n,e){return wbe(n,e)}function wbe(n,e){const t=Pd(e,i=>u_(n[i])===!1),r=Kn(t,i=>({msg:`Missing visitor method: <${i}> on ${n.constructor.name} CST Visitor.`,type:wL.MISSING_METHOD,methodName:i}));return WA(r)}class Abe{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=Tr(e,"nodeLocationTracking")?e.nodeLocationTracking:i_.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Sc,this.cstFinallyStateUpdate=Sc,this.cstPostTerminal=Sc,this.cstPostNonTerminal=Sc,this.cstPostRule=Sc;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=m9,this.setNodeLocationFromNode=m9,this.cstPostRule=Sc,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Sc,this.setNodeLocationFromNode=Sc,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=p9,this.setNodeLocationFromNode=p9,this.cstPostRule=Sc,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Sc,this.setNodeLocationFromNode=Sc,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Sc,this.setNodeLocationFromNode=Sc,this.cstPostRule=Sc,this.setInitialNodeLocation=Sc;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const t={name:e,children:Object.create(null)};this.setInitialNodeLocation(t),this.CST_STACK.push(t)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?(r.endOffset=t.endOffset,r.endLine=t.endLine,r.endColumn=t.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?r.endOffset=t.endOffset:r.startOffset=NaN}cstPostTerminal(e,t){const r=this.CST_STACK[this.CST_STACK.length-1];vbe(r,t,e),this.setNodeLocationFromToken(r.location,t)}cstPostNonTerminal(e,t){const r=this.CST_STACK[this.CST_STACK.length-1];ybe(r,t,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(r_(this.baseCstVisitorConstructor)){const e=Ebe(this.className,kd(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(r_(this.baseCstVisitorWithDefaultsConstructor)){const e=xbe(this.className,kd(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class Rbe{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):MM}LA(e){const t=this.currIdx+e;return t<0||this.tokVectorLength<=t?MM:this.tokVector[t]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class Cbe{ACTION(e){return e.call(this)}consume(e,t,r){return this.consumeInternal(t,e,r)}subrule(e,t,r){return this.subruleInternal(t,e,r)}option(e,t){return this.optionInternal(t,e)}or(e,t){return this.orInternal(t,e)}many(e,t){return this.manyInternal(e,t)}atLeastOne(e,t){return this.atLeastOneInternal(e,t)}CONSUME(e,t){return this.consumeInternal(e,0,t)}CONSUME1(e,t){return this.consumeInternal(e,1,t)}CONSUME2(e,t){return this.consumeInternal(e,2,t)}CONSUME3(e,t){return this.consumeInternal(e,3,t)}CONSUME4(e,t){return this.consumeInternal(e,4,t)}CONSUME5(e,t){return this.consumeInternal(e,5,t)}CONSUME6(e,t){return this.consumeInternal(e,6,t)}CONSUME7(e,t){return this.consumeInternal(e,7,t)}CONSUME8(e,t){return this.consumeInternal(e,8,t)}CONSUME9(e,t){return this.consumeInternal(e,9,t)}SUBRULE(e,t){return this.subruleInternal(e,0,t)}SUBRULE1(e,t){return this.subruleInternal(e,1,t)}SUBRULE2(e,t){return this.subruleInternal(e,2,t)}SUBRULE3(e,t){return this.subruleInternal(e,3,t)}SUBRULE4(e,t){return this.subruleInternal(e,4,t)}SUBRULE5(e,t){return this.subruleInternal(e,5,t)}SUBRULE6(e,t){return this.subruleInternal(e,6,t)}SUBRULE7(e,t){return this.subruleInternal(e,7,t)}SUBRULE8(e,t){return this.subruleInternal(e,8,t)}SUBRULE9(e,t){return this.subruleInternal(e,9,t)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,t,r=kM){if(Vu(this.definedRulesNames,e)){const o={message:B1.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:ju.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,t,r);return this[e]=i,i}OVERRIDE_RULE(e,t,r=kM){const i=X1e(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,t,r);return this[e]=s,s}BACKTRACK(e,t){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,t),!0}catch(i){if(RM(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return kye(ic(this.gastProductionsCache))}}class Mbe{initRecognizerEngine(e,t){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=AM,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Tr(t,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Li(e)){if(no(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Li(e))this.tokensMap=Hh(e,(s,o)=>(s[o.name]=o,s),{});else if(Tr(e,"modes")&&gp(Mf(ic(e.modes)),T1e)){const s=Mf(ic(e.modes)),o=oO(s);this.tokensMap=Hh(o,(a,c)=>(a[c.name]=c,a),{})}else if(Md(e))this.tokensMap=Pl(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=cb;const r=Tr(e,"modes")?Mf(ic(e.modes)):ic(e),i=gp(r,s=>no(s.categoryMatches));this.tokenMatcher=i?AM:YA,KA(ic(this.tokensMap))}defineRule(e,t,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Tr(r,"resyncEnabled")?r.resyncEnabled:kM.resyncEnabled,s=Tr(r,"recoveryValueFunc")?r.recoveryValueFunc:kM.recoveryValueFunc,o=this.ruleShortNameIdx<<dbe+ty;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),t.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),t.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:t})}invokeRuleCatch(e,t,r){const i=this.RULE_STACK.length===1,s=t&&!this.isBackTracking()&&this.recoveryEnabled;if(RM(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,t){const r=this.getKeyForAutomaticLookahead(nY,t);return this.optionInternalLogic(e,t,r)}optionInternalLogic(e,t,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,t){const r=this.getKeyForAutomaticLookahead(xL,e);return this.atLeastOneInternalLogic(e,t,r)}atLeastOneInternalLogic(e,t,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,va.REPETITION_MANDATORY,t.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],i,xL,e,D1e)}atLeastOneSepFirstInternal(e,t){const r=this.getKeyForAutomaticLookahead(RC,e);this.atLeastOneSepFirstInternalLogic(e,t,r)}atLeastOneSepFirstInternalLogic(e,t,r){const i=t.DEF,s=t.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,f9],a,RC,e,f9)}else throw this.raiseEarlyExitException(e,va.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG)}manyInternal(e,t){const r=this.getKeyForAutomaticLookahead(EL,e);return this.manyInternalLogic(e,t,r)}manyInternalLogic(e,t,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const a=t.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=t;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],i,EL,e,P1e,o)}manySepFirstInternal(e,t){const r=this.getKeyForAutomaticLookahead(TL,e);this.manySepFirstInternalLogic(e,t,r)}manySepFirstInternalLogic(e,t,r){const i=t.DEF,s=t.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,h9],a,TL,e,h9)}}repetitionSepSecondInternal(e,t,r,i,s){for(;r();)this.CONSUME(t),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,i,s],r,RC,e,s)}doSingleRepetition(e){const t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t}orInternal(e,t){const r=this.getKeyForAutomaticLookahead(tY,t),i=Li(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new cbe(t,e))}}subruleInternal(e,t,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=t,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,t,r){throw RM(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,t!==void 0&&t.LABEL!==void 0?t.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,t,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,t,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,t,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Qq(i,t,s))}consumeInternalRecovery(e,t,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===eY?r:s}}else throw r}saveRecogState(){const e=this.errors,t=Pl(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),cb)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class kbe{initErrorHandler(e){this._errors=[],this.errorMessageProvider=Tr(e,"errorMessageProvider")?e.errorMessageProvider:i_.errorMessageProvider}SAVE_ERROR(e){if(RM(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Pl(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Pl(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,t,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=G5(e,s,t,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new lbe(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,t){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=V5(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new abe(c,this.LA(1),a))}}class Obe{initContentAssist(){}computeContentAssist(e,t){const r=this.gastProductionsCache[e];if(r_(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return zq([r],t,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const t=Sp(e.ruleStack),i=this.getGAstProductions()[t];return new N1e(i,e).startWalking()}}const hO={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(hO);const g9=!0,_9=Math.pow(2,ty)-1,iY=Gu({name:"RECORDING_PHASE_TOKEN",pattern:ll.NA});KA([iY]);const sY=XA(iY,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(sY);const Ibe={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class Nbe{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const t=e>0?e:"";this[`CONSUME${t}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${t}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${t}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${t}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${t}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${t}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${t}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${t}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,t,r){return this.consumeInternalRecord(t,e,r)},this.subrule=function(e,t,r){return this.subruleInternalRecord(t,e,r)},this.option=function(e,t){return this.optionInternalRecord(t,e)},this.or=function(e,t){return this.orInternalRecord(t,e)},this.many=function(e,t){this.manyInternalRecord(e,t)},this.atLeastOne=function(e,t){this.atLeastOneInternalRecord(e,t)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let t=0;t<10;t++){const r=t>0?t:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,t){return()=>!0}LA_RECORD(e){return MM}topLevelRuleRecord(e,t){try{const r=new Hx({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),t.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,t){return UT.call(this,Lh,e,t)}atLeastOneInternalRecord(e,t){UT.call(this,_0,t,e)}atLeastOneSepFirstInternalRecord(e,t){UT.call(this,v0,t,e,g9)}manyInternalRecord(e,t){UT.call(this,Ac,t,e)}manySepFirstInternalRecord(e,t){UT.call(this,Mp,t,e,g9)}orInternalRecord(e,t){return Pbe.call(this,e,t)}subruleInternalRecord(e,t,r){if(CM(t),!e||Tr(e,"ruleName")===!1){const a=new Error(`<SUBRULE${v9(t)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=ox(this.recordingProdStack),s=e.ruleName,o=new Vh({idx:t,nonTerminalName:s,label:r?.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?Ibe:hO}consumeInternalRecord(e,t,r){if(CM(t),!Bq(e)){const o=new Error(`<CONSUME${v9(t)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=ox(this.recordingProdStack),s=new Jo({idx:t,terminalType:e,label:r?.LABEL});return i.definition.push(s),sY}}function UT(n,e,t,r=!1){CM(t);const i=ox(this.recordingProdStack),s=u_(e)?e:e.DEF,o=new n({definition:[],idx:t});return r&&(o.separator=e.SEP),Tr(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),hO}function Pbe(n,e){CM(e);const t=ox(this.recordingProdStack),r=Li(n)===!1,i=r===!1?n:n.DEF,s=new kp({definition:[],idx:e,ignoreAmbiguities:r&&n.IGNORE_AMBIGUITIES===!0});Tr(n,"MAX_LOOKAHEAD")&&(s.maxLookahead=n.MAX_LOOKAHEAD);const o=j5(i,a=>u_(a.GATE));return s.hasPredicates=o,t.definition.push(s),Cr(i,a=>{const c=new Gh({definition:[]});s.definition.push(c),Tr(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Tr(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),hO}function v9(n){return n===0?"":`${n}`}function CM(n){if(n<0||n>_9){const e=new Error(`Invalid DSL Method idx value: <${n}>
	Idx value must be a none negative value smaller than ${_9+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class Dbe{initPerformanceTracer(e){if(Tr(e,"traceInitPerf")){const t=e.traceInitPerf,r=typeof t=="number";this.traceInitMaxIdent=r?t:1/0,this.traceInitPerf=r?t>0:t}else this.traceInitMaxIdent=0,this.traceInitPerf=i_.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=Cq(t),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return t()}}function Lbe(n,e){e.forEach(t=>{const r=t.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(n.prototype,i,s):n.prototype[i]=t.prototype[i]})})}const MM=XA(cb,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(MM);const i_=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:jq,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),kM=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var ju;(function(n){n[n.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",n[n.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",n[n.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",n[n.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",n[n.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",n[n.LEFT_RECURSION=5]="LEFT_RECURSION",n[n.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",n[n.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",n[n.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",n[n.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",n[n.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",n[n.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",n[n.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",n[n.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(ju||(ju={}));let W5=class oY{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const t=this.className;this.TRACE_INIT("toFastProps",()=>{Mq(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Cr(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=sbe({rules:ic(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(no(r)&&this.skipValidations===!1){const i=obe({rules:ic(this.gastProductionsCache),tokenTypes:ic(this.tokensMap),errMsgProvider:B1,grammarName:t}),s=G1e({lookaheadStrategy:this.lookaheadStrategy,rules:ic(this.gastProductionsCache),tokenTypes:ic(this.tokensMap),grammarName:t});this.definitionErrors=this.definitionErrors.concat(i,s)}}),no(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=Uye(ic(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:ic(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(ic(this.gastProductionsCache))})),!oY.DEFER_DEFINITION_ERRORS_HANDLING&&!no(this.definitionErrors))throw e=Kn(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,t){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(t),r.initLexerAdapter(),r.initLooksAhead(t),r.initRecognizerEngine(e,t),r.initRecoverable(t),r.initTreeBuilder(t),r.initContentAssist(),r.initGastRecorder(t),r.initPerformanceTracer(t),Tr(t,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Tr(t,"skipValidations")?t.skipValidations:i_.skipValidations}};W5.DEFER_DEFINITION_ERRORS_HANDLING=!1;Lbe(W5,[hbe,mbe,Abe,Rbe,Mbe,Cbe,kbe,Obe,Nbe,Dbe]);class Ube extends W5{constructor(e,t=i_){const r=Pl(t);r.outputCst=!0,super(e,r)}}function Bbe(n){const e=new Fbe,t=ic(n);return Kn(t,r=>e.visitRule(r))}class Fbe extends Db{visitRule(e){const t=this.visitEach(e.definition),r=Aq(t,s=>s.propertyName),i=Kn(r,(s,o)=>{const a=!j5(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=Kn(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:E2(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:E2(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:E2(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:E2(e)}]}visitEachAndOverrideWith(e,t){return Kn(this.visitEach(e),r=>jh({},r,t))}visitEach(e){return Mf(Kn(e,t=>this.visit(t)))}}function E2(n){return n instanceof Vh?{kind:"rule",name:n.referencedRule.name}:{kind:"token"}}function jbe(n,e){let t=[];return t=t.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),t=t.concat(Mf(Kn(n,r=>zbe(r)))),e.includeVisitorInterface&&(t=t.concat($be(e.visitorInterfaceName,n))),t.join(`

`)+`
`}function zbe(n){const e=Hbe(n),t=Vbe(n);return[e,t]}function Hbe(n){const e=aY(n.name),t=q5(n.name);return`export interface ${e} extends CstNode {
  name: "${n.name}";
  children: ${t};
}`}function Vbe(n){return`export type ${q5(n.name)} = {
  ${Kn(n.properties,t=>Gbe(t)).join(`
  `)}
};`}function Gbe(n){const e=qbe(n.type);return`${n.name}${n.optional?"?":""}: ${e}[];`}function $be(n,e){return`export interface ${n}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Kn(e,t=>Wbe(t)).join(`
  `)}
}`}function Wbe(n){const e=q5(n.name);return`${n.name}(children: ${e}, param?: IN): OUT;`}function qbe(n){if(Li(n)){const e=oO(Kn(n,r=>y9(r)));return"("+Hh(e,(r,i)=>r+" | "+i)+")"}else return y9(n)}function y9(n){return n.kind==="token"?"IToken":aY(n.name)}function aY(n){return fq(n)+"CstNode"}function q5(n){return fq(n)+"CstChildren"}const Ybe={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function Kbe(n,e){const t=Object.assign(Object.assign({},Ybe),e),r=Bbe(n);return jbe(r,t)}var CC={exports:{}},Xbe=CC.exports,b9;function Zbe(){return b9||(b9=1,(function(n,e){(function(t,r){n.exports=r()})(Xbe,function(){return t.importState=function(i){var s=new t;return s.importState(i),s},t;function t(){return(function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var h=function(){var f=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=f-(c=f|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(f){s=+f[0]||0,o=+f[1]||0,a=+f[2]||0,c=+f[3]||0},h})(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(CC)),CC.exports}var Jbe=Zbe();const Y5=Dl(Jbe);new Nn;new Nn;function Ri(n,e,t){return Math.max(e,Math.min(t,n))}function Qbe(n,e){return Ri(n-Math.floor(n/e)*e,0,e)}function eSe(n,e){var t=Qbe(e-n,Math.PI*2);return t>Math.PI&&(t-=Math.PI*2),t}function cY(n){return n/180*Math.PI}function lY(n){return n*180/Math.PI}const tSe=Y5("089fad0j9awfem09wavefc09uwaef");function S9(n){return 2*Math.floor(n/2)}function K5(n,e){return Math.round(n/e)*e}function nSe(){return tSe()}function rSe(n){return Y5(n)()}function Nu(n,e){const t=Math.min(n,e),i=Math.max(n,e)-t+1;return t+Math.floor(nSe()*i)}function uY(n,e,t){const r=Math.min(e,t),s=Math.max(e,t)-r+1;return r+Math.floor(rSe(n)*s)}function cx(n,e,t){typeof n!="number"&&(n=0,e=0,t=1),typeof e!="number"&&(e=n,n=0,t=1),typeof t!="number"&&(t=1);const r=[],i=Math.min(n,e),s=Math.max(n,e);for(let o=i;o<=s;o+=t)r.push(o);return r}function iSe(n){return n[Nu(0,n.length-1)]}function sSe(n,e){return e[uY(n,0,e.length-1)]}function md(...n){return iSe(n.flat())}function oSe(n,...e){return sSe(n,e.flat())}function aSe(n){return[...new Set(n)].filter(fe)}var hY={},fO={};fO.byteLength=uSe;fO.toByteArray=fSe;fO.fromByteArray=mSe;var Fm=[],hd=[],cSe=typeof Uint8Array<"u"?Uint8Array:Array,RI="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var KS=0,lSe=RI.length;KS<lSe;++KS)Fm[KS]=RI[KS],hd[RI.charCodeAt(KS)]=KS;hd[45]=62;hd[95]=63;function fY(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function uSe(n){var e=fY(n),t=e[0],r=e[1];return(t+r)*3/4-r}function hSe(n,e,t){return(e+t)*3/4-t}function fSe(n){var e,t=fY(n),r=t[0],i=t[1],s=new cSe(hSe(n,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=hd[n.charCodeAt(c)]<<18|hd[n.charCodeAt(c+1)]<<12|hd[n.charCodeAt(c+2)]<<6|hd[n.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=hd[n.charCodeAt(c)]<<2|hd[n.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=hd[n.charCodeAt(c)]<<10|hd[n.charCodeAt(c+1)]<<4|hd[n.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function dSe(n){return Fm[n>>18&63]+Fm[n>>12&63]+Fm[n>>6&63]+Fm[n&63]}function pSe(n,e,t){for(var r,i=[],s=e;s<t;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),i.push(dSe(r));return i.join("")}function mSe(n){for(var e,t=n.length,r=t%3,i=[],s=16383,o=0,a=t-r;o<a;o+=s)i.push(pSe(n,o,o+s>a?a:o+s));return r===1?(e=n[t-1],i.push(Fm[e>>2]+Fm[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(Fm[e>>10]+Fm[e>>4&63]+Fm[e<<2&63]+"=")),i.join("")}var X5={};X5.read=function(n,e,t,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=t?i-1:0,f=t?-1:1,d=n[e+h];for(h+=f,s=d&(1<<-u)-1,d>>=-u,u+=a;u>0;s=s*256+n[e+h],h+=f,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+n[e+h],h+=f,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(d?-1:1)*o*Math.pow(2,s-r)};X5.write=function(n,e,t,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,h=u>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,_=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=f/c:e+=f*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;n[t+d]=a&255,d+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;n[t+d]=o&255,d+=p,o/=256,l-=8);n[t+d-p]|=_*128};(function(n){const e=fO,t=X5,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=u,n.SlowBuffer=T,n.INSPECT_MAX_BYTES=50;const i=2147483647;n.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const Re=new s(1),ce={foo:function(){return 42}};return Object.setPrototypeOf(ce,s.prototype),Object.setPrototypeOf(Re,ce),Re.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(Re){if(Re>i)throw new RangeError('The value "'+Re+'" is invalid for option "size"');const ce=new s(Re);return Object.setPrototypeOf(ce,u.prototype),ce}function u(Re,ce,W){if(typeof Re=="number"){if(typeof ce=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(Re)}return h(Re,ce,W)}u.poolSize=8192;function h(Re,ce,W){if(typeof Re=="string")return _(Re,ce);if(o.isView(Re))return m(Re);if(Re==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Re);if(Je(Re,o)||Re&&Je(Re.buffer,o)||typeof a<"u"&&(Je(Re,a)||Re&&Je(Re.buffer,a)))return b(Re,ce,W);if(typeof Re=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const le=Re.valueOf&&Re.valueOf();if(le!=null&&le!==Re)return u.from(le,ce,W);const Se=y(Re);if(Se)return Se;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Re[Symbol.toPrimitive]=="function")return u.from(Re[Symbol.toPrimitive]("string"),ce,W);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Re)}u.from=function(Re,ce,W){return h(Re,ce,W)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function f(Re){if(typeof Re!="number")throw new TypeError('"size" argument must be of type number');if(Re<0)throw new RangeError('The value "'+Re+'" is invalid for option "size"')}function d(Re,ce,W){return f(Re),Re<=0?l(Re):ce!==void 0?typeof W=="string"?l(Re).fill(ce,W):l(Re).fill(ce):l(Re)}u.alloc=function(Re,ce,W){return d(Re,ce,W)};function p(Re){return f(Re),l(Re<0?0:x(Re)|0)}u.allocUnsafe=function(Re){return p(Re)},u.allocUnsafeSlow=function(Re){return p(Re)};function _(Re,ce){if((typeof ce!="string"||ce==="")&&(ce="utf8"),!u.isEncoding(ce))throw new TypeError("Unknown encoding: "+ce);const W=k(Re,ce)|0;let le=l(W);const Se=le.write(Re,ce);return Se!==W&&(le=le.slice(0,Se)),le}function g(Re){const ce=Re.length<0?0:x(Re.length)|0,W=l(ce);for(let le=0;le<ce;le+=1)W[le]=Re[le]&255;return W}function m(Re){if(Je(Re,s)){const ce=new s(Re);return b(ce.buffer,ce.byteOffset,ce.byteLength)}return g(Re)}function b(Re,ce,W){if(ce<0||Re.byteLength<ce)throw new RangeError('"offset" is outside of buffer bounds');if(Re.byteLength<ce+(W||0))throw new RangeError('"length" is outside of buffer bounds');let le;return ce===void 0&&W===void 0?le=new s(Re):W===void 0?le=new s(Re,ce):le=new s(Re,ce,W),Object.setPrototypeOf(le,u.prototype),le}function y(Re){if(u.isBuffer(Re)){const ce=x(Re.length)|0,W=l(ce);return W.length===0||Re.copy(W,0,0,ce),W}if(Re.length!==void 0)return typeof Re.length!="number"||nt(Re.length)?l(0):g(Re);if(Re.type==="Buffer"&&Array.isArray(Re.data))return g(Re.data)}function x(Re){if(Re>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return Re|0}function T(Re){return+Re!=Re&&(Re=0),u.alloc(+Re)}u.isBuffer=function(ce){return ce!=null&&ce._isBuffer===!0&&ce!==u.prototype},u.compare=function(ce,W){if(Je(ce,s)&&(ce=u.from(ce,ce.offset,ce.byteLength)),Je(W,s)&&(W=u.from(W,W.offset,W.byteLength)),!u.isBuffer(ce)||!u.isBuffer(W))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(ce===W)return 0;let le=ce.length,Se=W.length;for(let Ae=0,ye=Math.min(le,Se);Ae<ye;++Ae)if(ce[Ae]!==W[Ae]){le=ce[Ae],Se=W[Ae];break}return le<Se?-1:Se<le?1:0},u.isEncoding=function(ce){switch(String(ce).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(ce,W){if(!Array.isArray(ce))throw new TypeError('"list" argument must be an Array of Buffers');if(ce.length===0)return u.alloc(0);let le;if(W===void 0)for(W=0,le=0;le<ce.length;++le)W+=ce[le].length;const Se=u.allocUnsafe(W);let Ae=0;for(le=0;le<ce.length;++le){let ye=ce[le];if(Je(ye,s))Ae+ye.length>Se.length?(u.isBuffer(ye)||(ye=u.from(ye)),ye.copy(Se,Ae)):s.prototype.set.call(Se,ye,Ae);else if(u.isBuffer(ye))ye.copy(Se,Ae);else throw new TypeError('"list" argument must be an Array of Buffers');Ae+=ye.length}return Se};function k(Re,ce){if(u.isBuffer(Re))return Re.length;if(o.isView(Re)||Je(Re,o))return Re.byteLength;if(typeof Re!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Re);const W=Re.length,le=arguments.length>2&&arguments[2]===!0;if(!le&&W===0)return 0;let Se=!1;for(;;)switch(ce){case"ascii":case"latin1":case"binary":return W;case"utf8":case"utf-8":return _e(Re).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return W*2;case"hex":return W>>>1;case"base64":return ze(Re).length;default:if(Se)return le?-1:_e(Re).length;ce=(""+ce).toLowerCase(),Se=!0}}u.byteLength=k;function R(Re,ce,W){let le=!1;if((ce===void 0||ce<0)&&(ce=0),ce>this.length||((W===void 0||W>this.length)&&(W=this.length),W<=0)||(W>>>=0,ce>>>=0,W<=ce))return"";for(Re||(Re="utf8");;)switch(Re){case"hex":return K(this,ce,W);case"utf8":case"utf-8":return $(this,ce,W);case"ascii":return q(this,ce,W);case"latin1":case"binary":return V(this,ce,W);case"base64":return Z(this,ce,W);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ne(this,ce,W);default:if(le)throw new TypeError("Unknown encoding: "+Re);Re=(Re+"").toLowerCase(),le=!0}}u.prototype._isBuffer=!0;function P(Re,ce,W){const le=Re[ce];Re[ce]=Re[W],Re[W]=le}u.prototype.swap16=function(){const ce=this.length;if(ce%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let W=0;W<ce;W+=2)P(this,W,W+1);return this},u.prototype.swap32=function(){const ce=this.length;if(ce%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let W=0;W<ce;W+=4)P(this,W,W+3),P(this,W+1,W+2);return this},u.prototype.swap64=function(){const ce=this.length;if(ce%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let W=0;W<ce;W+=8)P(this,W,W+7),P(this,W+1,W+6),P(this,W+2,W+5),P(this,W+3,W+4);return this},u.prototype.toString=function(){const ce=this.length;return ce===0?"":arguments.length===0?$(this,0,ce):R.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(ce){if(!u.isBuffer(ce))throw new TypeError("Argument must be a Buffer");return this===ce?!0:u.compare(this,ce)===0},u.prototype.inspect=function(){let ce="";const W=n.INSPECT_MAX_BYTES;return ce=this.toString("hex",0,W).replace(/(.{2})/g,"$1 ").trim(),this.length>W&&(ce+=" ... "),"<Buffer "+ce+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(ce,W,le,Se,Ae){if(Je(ce,s)&&(ce=u.from(ce,ce.offset,ce.byteLength)),!u.isBuffer(ce))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof ce);if(W===void 0&&(W=0),le===void 0&&(le=ce?ce.length:0),Se===void 0&&(Se=0),Ae===void 0&&(Ae=this.length),W<0||le>ce.length||Se<0||Ae>this.length)throw new RangeError("out of range index");if(Se>=Ae&&W>=le)return 0;if(Se>=Ae)return-1;if(W>=le)return 1;if(W>>>=0,le>>>=0,Se>>>=0,Ae>>>=0,this===ce)return 0;let ye=Ae-Se,ve=le-W;const Xe=Math.min(ye,ve),Me=this.slice(Se,Ae),Ve=ce.slice(W,le);for(let je=0;je<Xe;++je)if(Me[je]!==Ve[je]){ye=Me[je],ve=Ve[je];break}return ye<ve?-1:ve<ye?1:0};function B(Re,ce,W,le,Se){if(Re.length===0)return-1;if(typeof W=="string"?(le=W,W=0):W>2147483647?W=2147483647:W<-2147483648&&(W=-2147483648),W=+W,nt(W)&&(W=Se?0:Re.length-1),W<0&&(W=Re.length+W),W>=Re.length){if(Se)return-1;W=Re.length-1}else if(W<0)if(Se)W=0;else return-1;if(typeof ce=="string"&&(ce=u.from(ce,le)),u.isBuffer(ce))return ce.length===0?-1:U(Re,ce,W,le,Se);if(typeof ce=="number")return ce=ce&255,typeof s.prototype.indexOf=="function"?Se?s.prototype.indexOf.call(Re,ce,W):s.prototype.lastIndexOf.call(Re,ce,W):U(Re,[ce],W,le,Se);throw new TypeError("val must be string, number or Buffer")}function U(Re,ce,W,le,Se){let Ae=1,ye=Re.length,ve=ce.length;if(le!==void 0&&(le=String(le).toLowerCase(),le==="ucs2"||le==="ucs-2"||le==="utf16le"||le==="utf-16le")){if(Re.length<2||ce.length<2)return-1;Ae=2,ye/=2,ve/=2,W/=2}function Xe(Ve,je){return Ae===1?Ve[je]:Ve.readUInt16BE(je*Ae)}let Me;if(Se){let Ve=-1;for(Me=W;Me<ye;Me++)if(Xe(Re,Me)===Xe(ce,Ve===-1?0:Me-Ve)){if(Ve===-1&&(Ve=Me),Me-Ve+1===ve)return Ve*Ae}else Ve!==-1&&(Me-=Me-Ve),Ve=-1}else for(W+ve>ye&&(W=ye-ve),Me=W;Me>=0;Me--){let Ve=!0;for(let je=0;je<ve;je++)if(Xe(Re,Me+je)!==Xe(ce,je)){Ve=!1;break}if(Ve)return Me}return-1}u.prototype.includes=function(ce,W,le){return this.indexOf(ce,W,le)!==-1},u.prototype.indexOf=function(ce,W,le){return B(this,ce,W,le,!0)},u.prototype.lastIndexOf=function(ce,W,le){return B(this,ce,W,le,!1)};function z(Re,ce,W,le){W=Number(W)||0;const Se=Re.length-W;le?(le=Number(le),le>Se&&(le=Se)):le=Se;const Ae=ce.length;le>Ae/2&&(le=Ae/2);let ye;for(ye=0;ye<le;++ye){const ve=parseInt(ce.substr(ye*2,2),16);if(nt(ve))return ye;Re[W+ye]=ve}return ye}function I(Re,ce,W,le){return Ze(_e(ce,Re.length-W),Re,W,le)}function L(Re,ce,W,le){return Ze(we(ce),Re,W,le)}function M(Re,ce,W,le){return Ze(ze(ce),Re,W,le)}function F(Re,ce,W,le){return Ze(pe(ce,Re.length-W),Re,W,le)}u.prototype.write=function(ce,W,le,Se){if(W===void 0)Se="utf8",le=this.length,W=0;else if(le===void 0&&typeof W=="string")Se=W,le=this.length,W=0;else if(isFinite(W))W=W>>>0,isFinite(le)?(le=le>>>0,Se===void 0&&(Se="utf8")):(Se=le,le=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Ae=this.length-W;if((le===void 0||le>Ae)&&(le=Ae),ce.length>0&&(le<0||W<0)||W>this.length)throw new RangeError("Attempt to write outside buffer bounds");Se||(Se="utf8");let ye=!1;for(;;)switch(Se){case"hex":return z(this,ce,W,le);case"utf8":case"utf-8":return I(this,ce,W,le);case"ascii":case"latin1":case"binary":return L(this,ce,W,le);case"base64":return M(this,ce,W,le);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,ce,W,le);default:if(ye)throw new TypeError("Unknown encoding: "+Se);Se=(""+Se).toLowerCase(),ye=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Z(Re,ce,W){return ce===0&&W===Re.length?e.fromByteArray(Re):e.fromByteArray(Re.slice(ce,W))}function $(Re,ce,W){W=Math.min(Re.length,W);const le=[];let Se=ce;for(;Se<W;){const Ae=Re[Se];let ye=null,ve=Ae>239?4:Ae>223?3:Ae>191?2:1;if(Se+ve<=W){let Xe,Me,Ve,je;switch(ve){case 1:Ae<128&&(ye=Ae);break;case 2:Xe=Re[Se+1],(Xe&192)===128&&(je=(Ae&31)<<6|Xe&63,je>127&&(ye=je));break;case 3:Xe=Re[Se+1],Me=Re[Se+2],(Xe&192)===128&&(Me&192)===128&&(je=(Ae&15)<<12|(Xe&63)<<6|Me&63,je>2047&&(je<55296||je>57343)&&(ye=je));break;case 4:Xe=Re[Se+1],Me=Re[Se+2],Ve=Re[Se+3],(Xe&192)===128&&(Me&192)===128&&(Ve&192)===128&&(je=(Ae&15)<<18|(Xe&63)<<12|(Me&63)<<6|Ve&63,je>65535&&je<1114112&&(ye=je))}}ye===null?(ye=65533,ve=1):ye>65535&&(ye-=65536,le.push(ye>>>10&1023|55296),ye=56320|ye&1023),le.push(ye),Se+=ve}return Q(le)}const Y=4096;function Q(Re){const ce=Re.length;if(ce<=Y)return String.fromCharCode.apply(String,Re);let W="",le=0;for(;le<ce;)W+=String.fromCharCode.apply(String,Re.slice(le,le+=Y));return W}function q(Re,ce,W){let le="";W=Math.min(Re.length,W);for(let Se=ce;Se<W;++Se)le+=String.fromCharCode(Re[Se]&127);return le}function V(Re,ce,W){let le="";W=Math.min(Re.length,W);for(let Se=ce;Se<W;++Se)le+=String.fromCharCode(Re[Se]);return le}function K(Re,ce,W){const le=Re.length;(!ce||ce<0)&&(ce=0),(!W||W<0||W>le)&&(W=le);let Se="";for(let Ae=ce;Ae<W;++Ae)Se+=Pt[Re[Ae]];return Se}function ne(Re,ce,W){const le=Re.slice(ce,W);let Se="";for(let Ae=0;Ae<le.length-1;Ae+=2)Se+=String.fromCharCode(le[Ae]+le[Ae+1]*256);return Se}u.prototype.slice=function(ce,W){const le=this.length;ce=~~ce,W=W===void 0?le:~~W,ce<0?(ce+=le,ce<0&&(ce=0)):ce>le&&(ce=le),W<0?(W+=le,W<0&&(W=0)):W>le&&(W=le),W<ce&&(W=ce);const Se=this.subarray(ce,W);return Object.setPrototypeOf(Se,u.prototype),Se};function ie(Re,ce,W){if(Re%1!==0||Re<0)throw new RangeError("offset is not uint");if(Re+ce>W)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(ce,W,le){ce=ce>>>0,W=W>>>0,le||ie(ce,W,this.length);let Se=this[ce],Ae=1,ye=0;for(;++ye<W&&(Ae*=256);)Se+=this[ce+ye]*Ae;return Se},u.prototype.readUintBE=u.prototype.readUIntBE=function(ce,W,le){ce=ce>>>0,W=W>>>0,le||ie(ce,W,this.length);let Se=this[ce+--W],Ae=1;for(;W>0&&(Ae*=256);)Se+=this[ce+--W]*Ae;return Se},u.prototype.readUint8=u.prototype.readUInt8=function(ce,W){return ce=ce>>>0,W||ie(ce,1,this.length),this[ce]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(ce,W){return ce=ce>>>0,W||ie(ce,2,this.length),this[ce]|this[ce+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(ce,W){return ce=ce>>>0,W||ie(ce,2,this.length),this[ce]<<8|this[ce+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(ce,W){return ce=ce>>>0,W||ie(ce,4,this.length),(this[ce]|this[ce+1]<<8|this[ce+2]<<16)+this[ce+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(ce,W){return ce=ce>>>0,W||ie(ce,4,this.length),this[ce]*16777216+(this[ce+1]<<16|this[ce+2]<<8|this[ce+3])},u.prototype.readBigUInt64LE=vt(function(ce){ce=ce>>>0,Be(ce,"offset");const W=this[ce],le=this[ce+7];(W===void 0||le===void 0)&&De(ce,this.length-8);const Se=W+this[++ce]*2**8+this[++ce]*2**16+this[++ce]*2**24,Ae=this[++ce]+this[++ce]*2**8+this[++ce]*2**16+le*2**24;return BigInt(Se)+(BigInt(Ae)<<BigInt(32))}),u.prototype.readBigUInt64BE=vt(function(ce){ce=ce>>>0,Be(ce,"offset");const W=this[ce],le=this[ce+7];(W===void 0||le===void 0)&&De(ce,this.length-8);const Se=W*2**24+this[++ce]*2**16+this[++ce]*2**8+this[++ce],Ae=this[++ce]*2**24+this[++ce]*2**16+this[++ce]*2**8+le;return(BigInt(Se)<<BigInt(32))+BigInt(Ae)}),u.prototype.readIntLE=function(ce,W,le){ce=ce>>>0,W=W>>>0,le||ie(ce,W,this.length);let Se=this[ce],Ae=1,ye=0;for(;++ye<W&&(Ae*=256);)Se+=this[ce+ye]*Ae;return Ae*=128,Se>=Ae&&(Se-=Math.pow(2,8*W)),Se},u.prototype.readIntBE=function(ce,W,le){ce=ce>>>0,W=W>>>0,le||ie(ce,W,this.length);let Se=W,Ae=1,ye=this[ce+--Se];for(;Se>0&&(Ae*=256);)ye+=this[ce+--Se]*Ae;return Ae*=128,ye>=Ae&&(ye-=Math.pow(2,8*W)),ye},u.prototype.readInt8=function(ce,W){return ce=ce>>>0,W||ie(ce,1,this.length),this[ce]&128?(255-this[ce]+1)*-1:this[ce]},u.prototype.readInt16LE=function(ce,W){ce=ce>>>0,W||ie(ce,2,this.length);const le=this[ce]|this[ce+1]<<8;return le&32768?le|4294901760:le},u.prototype.readInt16BE=function(ce,W){ce=ce>>>0,W||ie(ce,2,this.length);const le=this[ce+1]|this[ce]<<8;return le&32768?le|4294901760:le},u.prototype.readInt32LE=function(ce,W){return ce=ce>>>0,W||ie(ce,4,this.length),this[ce]|this[ce+1]<<8|this[ce+2]<<16|this[ce+3]<<24},u.prototype.readInt32BE=function(ce,W){return ce=ce>>>0,W||ie(ce,4,this.length),this[ce]<<24|this[ce+1]<<16|this[ce+2]<<8|this[ce+3]},u.prototype.readBigInt64LE=vt(function(ce){ce=ce>>>0,Be(ce,"offset");const W=this[ce],le=this[ce+7];(W===void 0||le===void 0)&&De(ce,this.length-8);const Se=this[ce+4]+this[ce+5]*2**8+this[ce+6]*2**16+(le<<24);return(BigInt(Se)<<BigInt(32))+BigInt(W+this[++ce]*2**8+this[++ce]*2**16+this[++ce]*2**24)}),u.prototype.readBigInt64BE=vt(function(ce){ce=ce>>>0,Be(ce,"offset");const W=this[ce],le=this[ce+7];(W===void 0||le===void 0)&&De(ce,this.length-8);const Se=(W<<24)+this[++ce]*2**16+this[++ce]*2**8+this[++ce];return(BigInt(Se)<<BigInt(32))+BigInt(this[++ce]*2**24+this[++ce]*2**16+this[++ce]*2**8+le)}),u.prototype.readFloatLE=function(ce,W){return ce=ce>>>0,W||ie(ce,4,this.length),t.read(this,ce,!0,23,4)},u.prototype.readFloatBE=function(ce,W){return ce=ce>>>0,W||ie(ce,4,this.length),t.read(this,ce,!1,23,4)},u.prototype.readDoubleLE=function(ce,W){return ce=ce>>>0,W||ie(ce,8,this.length),t.read(this,ce,!0,52,8)},u.prototype.readDoubleBE=function(ce,W){return ce=ce>>>0,W||ie(ce,8,this.length),t.read(this,ce,!1,52,8)};function ae(Re,ce,W,le,Se,Ae){if(!u.isBuffer(Re))throw new TypeError('"buffer" argument must be a Buffer instance');if(ce>Se||ce<Ae)throw new RangeError('"value" argument is out of bounds');if(W+le>Re.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(ce,W,le,Se){if(ce=+ce,W=W>>>0,le=le>>>0,!Se){const ve=Math.pow(2,8*le)-1;ae(this,ce,W,le,ve,0)}let Ae=1,ye=0;for(this[W]=ce&255;++ye<le&&(Ae*=256);)this[W+ye]=ce/Ae&255;return W+le},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(ce,W,le,Se){if(ce=+ce,W=W>>>0,le=le>>>0,!Se){const ve=Math.pow(2,8*le)-1;ae(this,ce,W,le,ve,0)}let Ae=le-1,ye=1;for(this[W+Ae]=ce&255;--Ae>=0&&(ye*=256);)this[W+Ae]=ce/ye&255;return W+le},u.prototype.writeUint8=u.prototype.writeUInt8=function(ce,W,le){return ce=+ce,W=W>>>0,le||ae(this,ce,W,1,255,0),this[W]=ce&255,W+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(ce,W,le){return ce=+ce,W=W>>>0,le||ae(this,ce,W,2,65535,0),this[W]=ce&255,this[W+1]=ce>>>8,W+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(ce,W,le){return ce=+ce,W=W>>>0,le||ae(this,ce,W,2,65535,0),this[W]=ce>>>8,this[W+1]=ce&255,W+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(ce,W,le){return ce=+ce,W=W>>>0,le||ae(this,ce,W,4,4294967295,0),this[W+3]=ce>>>24,this[W+2]=ce>>>16,this[W+1]=ce>>>8,this[W]=ce&255,W+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(ce,W,le){return ce=+ce,W=W>>>0,le||ae(this,ce,W,4,4294967295,0),this[W]=ce>>>24,this[W+1]=ce>>>16,this[W+2]=ce>>>8,this[W+3]=ce&255,W+4};function Te(Re,ce,W,le,Se){Ne(ce,le,Se,Re,W,7);let Ae=Number(ce&BigInt(4294967295));Re[W++]=Ae,Ae=Ae>>8,Re[W++]=Ae,Ae=Ae>>8,Re[W++]=Ae,Ae=Ae>>8,Re[W++]=Ae;let ye=Number(ce>>BigInt(32)&BigInt(4294967295));return Re[W++]=ye,ye=ye>>8,Re[W++]=ye,ye=ye>>8,Re[W++]=ye,ye=ye>>8,Re[W++]=ye,W}function Ie(Re,ce,W,le,Se){Ne(ce,le,Se,Re,W,7);let Ae=Number(ce&BigInt(4294967295));Re[W+7]=Ae,Ae=Ae>>8,Re[W+6]=Ae,Ae=Ae>>8,Re[W+5]=Ae,Ae=Ae>>8,Re[W+4]=Ae;let ye=Number(ce>>BigInt(32)&BigInt(4294967295));return Re[W+3]=ye,ye=ye>>8,Re[W+2]=ye,ye=ye>>8,Re[W+1]=ye,ye=ye>>8,Re[W]=ye,W+8}u.prototype.writeBigUInt64LE=vt(function(ce,W=0){return Te(this,ce,W,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=vt(function(ce,W=0){return Ie(this,ce,W,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(ce,W,le,Se){if(ce=+ce,W=W>>>0,!Se){const Xe=Math.pow(2,8*le-1);ae(this,ce,W,le,Xe-1,-Xe)}let Ae=0,ye=1,ve=0;for(this[W]=ce&255;++Ae<le&&(ye*=256);)ce<0&&ve===0&&this[W+Ae-1]!==0&&(ve=1),this[W+Ae]=(ce/ye>>0)-ve&255;return W+le},u.prototype.writeIntBE=function(ce,W,le,Se){if(ce=+ce,W=W>>>0,!Se){const Xe=Math.pow(2,8*le-1);ae(this,ce,W,le,Xe-1,-Xe)}let Ae=le-1,ye=1,ve=0;for(this[W+Ae]=ce&255;--Ae>=0&&(ye*=256);)ce<0&&ve===0&&this[W+Ae+1]!==0&&(ve=1),this[W+Ae]=(ce/ye>>0)-ve&255;return W+le},u.prototype.writeInt8=function(ce,W,le){return ce=+ce,W=W>>>0,le||ae(this,ce,W,1,127,-128),ce<0&&(ce=255+ce+1),this[W]=ce&255,W+1},u.prototype.writeInt16LE=function(ce,W,le){return ce=+ce,W=W>>>0,le||ae(this,ce,W,2,32767,-32768),this[W]=ce&255,this[W+1]=ce>>>8,W+2},u.prototype.writeInt16BE=function(ce,W,le){return ce=+ce,W=W>>>0,le||ae(this,ce,W,2,32767,-32768),this[W]=ce>>>8,this[W+1]=ce&255,W+2},u.prototype.writeInt32LE=function(ce,W,le){return ce=+ce,W=W>>>0,le||ae(this,ce,W,4,2147483647,-2147483648),this[W]=ce&255,this[W+1]=ce>>>8,this[W+2]=ce>>>16,this[W+3]=ce>>>24,W+4},u.prototype.writeInt32BE=function(ce,W,le){return ce=+ce,W=W>>>0,le||ae(this,ce,W,4,2147483647,-2147483648),ce<0&&(ce=4294967295+ce+1),this[W]=ce>>>24,this[W+1]=ce>>>16,this[W+2]=ce>>>8,this[W+3]=ce&255,W+4},u.prototype.writeBigInt64LE=vt(function(ce,W=0){return Te(this,ce,W,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=vt(function(ce,W=0){return Ie(this,ce,W,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function be(Re,ce,W,le,Se,Ae){if(W+le>Re.length)throw new RangeError("Index out of range");if(W<0)throw new RangeError("Index out of range")}function Pe(Re,ce,W,le,Se){return ce=+ce,W=W>>>0,Se||be(Re,ce,W,4),t.write(Re,ce,W,le,23,4),W+4}u.prototype.writeFloatLE=function(ce,W,le){return Pe(this,ce,W,!0,le)},u.prototype.writeFloatBE=function(ce,W,le){return Pe(this,ce,W,!1,le)};function $e(Re,ce,W,le,Se){return ce=+ce,W=W>>>0,Se||be(Re,ce,W,8),t.write(Re,ce,W,le,52,8),W+8}u.prototype.writeDoubleLE=function(ce,W,le){return $e(this,ce,W,!0,le)},u.prototype.writeDoubleBE=function(ce,W,le){return $e(this,ce,W,!1,le)},u.prototype.copy=function(ce,W,le,Se){if(!u.isBuffer(ce))throw new TypeError("argument should be a Buffer");if(le||(le=0),!Se&&Se!==0&&(Se=this.length),W>=ce.length&&(W=ce.length),W||(W=0),Se>0&&Se<le&&(Se=le),Se===le||ce.length===0||this.length===0)return 0;if(W<0)throw new RangeError("targetStart out of bounds");if(le<0||le>=this.length)throw new RangeError("Index out of range");if(Se<0)throw new RangeError("sourceEnd out of bounds");Se>this.length&&(Se=this.length),ce.length-W<Se-le&&(Se=ce.length-W+le);const Ae=Se-le;return this===ce&&typeof s.prototype.copyWithin=="function"?this.copyWithin(W,le,Se):s.prototype.set.call(ce,this.subarray(le,Se),W),Ae},u.prototype.fill=function(ce,W,le,Se){if(typeof ce=="string"){if(typeof W=="string"?(Se=W,W=0,le=this.length):typeof le=="string"&&(Se=le,le=this.length),Se!==void 0&&typeof Se!="string")throw new TypeError("encoding must be a string");if(typeof Se=="string"&&!u.isEncoding(Se))throw new TypeError("Unknown encoding: "+Se);if(ce.length===1){const ye=ce.charCodeAt(0);(Se==="utf8"&&ye<128||Se==="latin1")&&(ce=ye)}}else typeof ce=="number"?ce=ce&255:typeof ce=="boolean"&&(ce=Number(ce));if(W<0||this.length<W||this.length<le)throw new RangeError("Out of range index");if(le<=W)return this;W=W>>>0,le=le===void 0?this.length:le>>>0,ce||(ce=0);let Ae;if(typeof ce=="number")for(Ae=W;Ae<le;++Ae)this[Ae]=ce;else{const ye=u.isBuffer(ce)?ce:u.from(ce,Se),ve=ye.length;if(ve===0)throw new TypeError('The value "'+ce+'" is invalid for argument "value"');for(Ae=0;Ae<le-W;++Ae)this[Ae+W]=ye[Ae%ve]}return this};const tt={};function qe(Re,ce,W){tt[Re]=class extends W{constructor(){super(),Object.defineProperty(this,"message",{value:ce.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Re}]`,this.stack,delete this.name}get code(){return Re}set code(Se){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Se,writable:!0})}toString(){return`${this.name} [${Re}]: ${this.message}`}}}qe("ERR_BUFFER_OUT_OF_BOUNDS",function(Re){return Re?`${Re} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),qe("ERR_INVALID_ARG_TYPE",function(Re,ce){return`The "${Re}" argument must be of type number. Received type ${typeof ce}`},TypeError),qe("ERR_OUT_OF_RANGE",function(Re,ce,W){let le=`The value of "${Re}" is out of range.`,Se=W;return Number.isInteger(W)&&Math.abs(W)>2**32?Se=ut(String(W)):typeof W=="bigint"&&(Se=String(W),(W>BigInt(2)**BigInt(32)||W<-(BigInt(2)**BigInt(32)))&&(Se=ut(Se)),Se+="n"),le+=` It must be ${ce}. Received ${Se}`,le},RangeError);function ut(Re){let ce="",W=Re.length;const le=Re[0]==="-"?1:0;for(;W>=le+4;W-=3)ce=`_${Re.slice(W-3,W)}${ce}`;return`${Re.slice(0,W)}${ce}`}function te(Re,ce,W){Be(ce,"offset"),(Re[ce]===void 0||Re[ce+W]===void 0)&&De(ce,Re.length-(W+1))}function Ne(Re,ce,W,le,Se,Ae){if(Re>W||Re<ce){const ye=typeof ce=="bigint"?"n":"";let ve;throw ce===0||ce===BigInt(0)?ve=`>= 0${ye} and < 2${ye} ** ${(Ae+1)*8}${ye}`:ve=`>= -(2${ye} ** ${(Ae+1)*8-1}${ye}) and < 2 ** ${(Ae+1)*8-1}${ye}`,new tt.ERR_OUT_OF_RANGE("value",ve,Re)}te(le,Se,Ae)}function Be(Re,ce){if(typeof Re!="number")throw new tt.ERR_INVALID_ARG_TYPE(ce,"number",Re)}function De(Re,ce,W){throw Math.floor(Re)!==Re?(Be(Re,W),new tt.ERR_OUT_OF_RANGE("offset","an integer",Re)):ce<0?new tt.ERR_BUFFER_OUT_OF_BOUNDS:new tt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${ce}`,Re)}const Oe=/[^+/0-9A-Za-z-_]/g;function ue(Re){if(Re=Re.split("=")[0],Re=Re.trim().replace(Oe,""),Re.length<2)return"";for(;Re.length%4!==0;)Re=Re+"=";return Re}function _e(Re,ce){ce=ce||1/0;let W;const le=Re.length;let Se=null;const Ae=[];for(let ye=0;ye<le;++ye){if(W=Re.charCodeAt(ye),W>55295&&W<57344){if(!Se){if(W>56319){(ce-=3)>-1&&Ae.push(239,191,189);continue}else if(ye+1===le){(ce-=3)>-1&&Ae.push(239,191,189);continue}Se=W;continue}if(W<56320){(ce-=3)>-1&&Ae.push(239,191,189),Se=W;continue}W=(Se-55296<<10|W-56320)+65536}else Se&&(ce-=3)>-1&&Ae.push(239,191,189);if(Se=null,W<128){if((ce-=1)<0)break;Ae.push(W)}else if(W<2048){if((ce-=2)<0)break;Ae.push(W>>6|192,W&63|128)}else if(W<65536){if((ce-=3)<0)break;Ae.push(W>>12|224,W>>6&63|128,W&63|128)}else if(W<1114112){if((ce-=4)<0)break;Ae.push(W>>18|240,W>>12&63|128,W>>6&63|128,W&63|128)}else throw new Error("Invalid code point")}return Ae}function we(Re){const ce=[];for(let W=0;W<Re.length;++W)ce.push(Re.charCodeAt(W)&255);return ce}function pe(Re,ce){let W,le,Se;const Ae=[];for(let ye=0;ye<Re.length&&!((ce-=2)<0);++ye)W=Re.charCodeAt(ye),le=W>>8,Se=W%256,Ae.push(Se),Ae.push(le);return Ae}function ze(Re){return e.toByteArray(ue(Re))}function Ze(Re,ce,W,le){let Se;for(Se=0;Se<le&&!(Se+W>=ce.length||Se>=Re.length);++Se)ce[Se+W]=Re[Se];return Se}function Je(Re,ce){return Re instanceof ce||Re!=null&&Re.constructor!=null&&Re.constructor.name!=null&&Re.constructor.name===ce.name}function nt(Re){return Re!==Re}const Pt=(function(){const Re="0123456789abcdef",ce=new Array(256);for(let W=0;W<16;++W){const le=W*16;for(let Se=0;Se<16;++Se)ce[le+Se]=Re[W]+Re[Se]}return ce})();function vt(Re){return typeof BigInt>"u"?At:Re}function At(){throw new Error("BigInt not supported")}})(hY);const Qs=hY.Buffer;var AL;try{AL=new TextDecoder}catch{}var Ln,Zm,bt=0,eo={},ki,Mv,fd=0,jm=0,sl,Yg,$h=[],wi,E9={useRecords:!1,mapsAsObjects:!0};class dY{}const pY=new dY;pY.name="MessagePack 0xC1";var Pv=!1,mY=2,gSe;try{new Function("")}catch{mY=1/0}class eA{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(Ln)return SY(()=>(CL(),this?this.unpack(e,t):eA.prototype.unpack.call(E9,e,t)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Qs<"u"?Qs.from(e):new Uint8Array(e)),typeof t=="object"?(Zm=t.end||e.length,bt=t.start||0):(bt=0,Zm=t>-1?t:e.length),jm=0,Mv=null,sl=null,Ln=e;try{wi=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw Ln=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof eA){if(eo=this,this.structures)return ki=this.structures,x2(t);(!ki||ki.length>0)&&(ki=[])}else eo=E9,(!ki||ki.length>0)&&(ki=[]);return x2(t)}unpackMultiple(e,t){let r,i=0;try{Pv=!0;let s=e.length,o=this?this.unpack(e,s):dO.unpack(e,s);if(t){if(t(o,i,bt)===!1)return;for(;bt<s;)if(i=bt,t(x2(),i,bt)===!1)return}else{for(r=[o];bt<s;)i=bt,r.push(x2());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Pv=!1,CL()}}_mergeStructures(e,t){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in t||[])if(r>=0){let i=e[r],s=t[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,t){return this.unpack(e,t)}}function x2(n){try{if(!eo.trusted&&!Pv){let t=ki.sharedLength||0;t<ki.length&&(ki.length=t)}let e;if(eo.randomAccessStructure&&Ln[bt]<64&&Ln[bt]>=32&&gSe||(e=La()),sl&&(bt=sl.postBundlePosition,sl=null),Pv&&(ki.restoreStructures=null),bt==Zm)ki&&ki.restoreStructures&&x9(),ki=null,Ln=null,Yg&&(Yg=null);else{if(bt>Zm)throw new Error("Unexpected end of MessagePack data");if(!Pv){let t;try{t=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){t="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+t)}}return e}catch(e){throw ki&&ki.restoreStructures&&x9(),CL(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||bt>Zm)&&(e.incomplete=!0),e}}function x9(){for(let n in ki.restoreStructures)ki[n]=ki.restoreStructures[n];ki.restoreStructures=null}function La(){let n=Ln[bt++];if(n<160)if(n<128){if(n<64)return n;{let e=ki[n&63]||eo.getStructures&&gY()[n&63];return e?(e.read||(e.read=Z5(e,n&63)),e.read()):n}}else if(n<144)if(n-=128,eo.mapsAsObjects){let e={};for(let t=0;t<n;t++){let r=vY();r==="__proto__"&&(r="__proto_"),e[r]=La()}return e}else{let e=new Map;for(let t=0;t<n;t++)e.set(La(),La());return e}else{n-=144;let e=new Array(n);for(let t=0;t<n;t++)e[t]=La();return eo.freezeData?Object.freeze(e):e}else if(n<192){let e=n-160;if(jm>=bt)return Mv.slice(bt-fd,(bt+=e)-fd);if(jm==0&&Zm<140){let t=e<16?J5(e):_Y(e);if(t!=null)return t}return RL(e)}else{let e;switch(n){case 192:return null;case 193:return sl?(e=La(),e>0?sl[1].slice(sl.position1,sl.position1+=e):sl[0].slice(sl.position0,sl.position0-=e)):pY;case 194:return!1;case 195:return!0;case 196:if(e=Ln[bt++],e===void 0)throw new Error("Unexpected end of buffer");return CI(e);case 197:return e=wi.getUint16(bt),bt+=2,CI(e);case 198:return e=wi.getUint32(bt),bt+=4,CI(e);case 199:return u1(Ln[bt++]);case 200:return e=wi.getUint16(bt),bt+=2,u1(e);case 201:return e=wi.getUint32(bt),bt+=4,u1(e);case 202:if(e=wi.getFloat32(bt),eo.useFloat32>2){let t=Q5[(Ln[bt]&127)<<1|Ln[bt+1]>>7];return bt+=4,(t*e+(e>0?.5:-.5)>>0)/t}return bt+=4,e;case 203:return e=wi.getFloat64(bt),bt+=8,e;case 204:return Ln[bt++];case 205:return e=wi.getUint16(bt),bt+=2,e;case 206:return e=wi.getUint32(bt),bt+=4,e;case 207:return eo.int64AsType==="number"?(e=wi.getUint32(bt)*4294967296,e+=wi.getUint32(bt+4)):eo.int64AsType==="string"?e=wi.getBigUint64(bt).toString():eo.int64AsType==="auto"?(e=wi.getBigUint64(bt),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=wi.getBigUint64(bt),bt+=8,e;case 208:return wi.getInt8(bt++);case 209:return e=wi.getInt16(bt),bt+=2,e;case 210:return e=wi.getInt32(bt),bt+=4,e;case 211:return eo.int64AsType==="number"?(e=wi.getInt32(bt)*4294967296,e+=wi.getUint32(bt+4)):eo.int64AsType==="string"?e=wi.getBigInt64(bt).toString():eo.int64AsType==="auto"?(e=wi.getBigInt64(bt),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=wi.getBigInt64(bt),bt+=8,e;case 212:if(e=Ln[bt++],e==114)return M9(Ln[bt++]&63);{let t=$h[e];if(t)return t.read?(bt++,t.read(La())):t.noBuffer?(bt++,t()):t(Ln.subarray(bt,++bt));throw new Error("Unknown extension "+e)}case 213:return e=Ln[bt],e==114?(bt++,M9(Ln[bt++]&63,Ln[bt++])):u1(2);case 214:return u1(4);case 215:return u1(8);case 216:return u1(16);case 217:return e=Ln[bt++],jm>=bt?Mv.slice(bt-fd,(bt+=e)-fd):vSe(e);case 218:return e=wi.getUint16(bt),bt+=2,jm>=bt?Mv.slice(bt-fd,(bt+=e)-fd):ySe(e);case 219:return e=wi.getUint32(bt),bt+=4,jm>=bt?Mv.slice(bt-fd,(bt+=e)-fd):bSe(e);case 220:return e=wi.getUint16(bt),bt+=2,w9(e);case 221:return e=wi.getUint32(bt),bt+=4,w9(e);case 222:return e=wi.getUint16(bt),bt+=2,A9(e);case 223:return e=wi.getUint32(bt),bt+=4,A9(e);default:if(n>=224)return n-256;if(n===void 0){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}throw new Error("Unknown MessagePack token "+n)}}}const _Se=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Z5(n,e){function t(){if(t.count++>mY){let i=n.read=new Function("r","return function(){return "+(eo.freezeData?"Object.freeze":"")+"({"+n.map(s=>s==="__proto__"?"__proto_:r()":_Se.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(La);return n.highByte===0&&(n.read=T9(e,n.read)),i()}let r={};for(let i=0,s=n.length;i<s;i++){let o=n[i];o==="__proto__"&&(o="__proto_"),r[o]=La()}return eo.freezeData?Object.freeze(r):r}return t.count=0,n.highByte===0?T9(e,t):t}const T9=(n,e)=>function(){let t=Ln[bt++];if(t===0)return e();let r=n<32?-(n+(t<<5)):n+(t<<5),i=ki[r]||gY()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=Z5(i,n)),i.read()};function gY(){let n=SY(()=>(Ln=null,eo.getStructures()));return ki=eo._mergeStructures(n,ki)}var RL=ZA,vSe=ZA,ySe=ZA,bSe=ZA;function ZA(n){let e;if(n<16&&(e=J5(n)))return e;if(n>64&&AL)return AL.decode(Ln.subarray(bt,bt+=n));const t=bt+n,r=[];for(e="";bt<t;){const i=Ln[bt++];if((i&128)===0)r.push(i);else if((i&224)===192){const s=Ln[bt++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=Ln[bt++]&63,o=Ln[bt++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=Ln[bt++]&63,o=Ln[bt++]&63,a=Ln[bt++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=el.apply(String,r),r.length=0)}return r.length>0&&(e+=el.apply(String,r)),e}function w9(n){let e=new Array(n);for(let t=0;t<n;t++)e[t]=La();return eo.freezeData?Object.freeze(e):e}function A9(n){if(eo.mapsAsObjects){let e={};for(let t=0;t<n;t++){let r=vY();r==="__proto__"&&(r="__proto_"),e[r]=La()}return e}else{let e=new Map;for(let t=0;t<n;t++)e.set(La(),La());return e}}var el=String.fromCharCode;function _Y(n){let e=bt,t=new Array(n);for(let r=0;r<n;r++){const i=Ln[bt++];if((i&128)>0){bt=e;return}t[r]=i}return el.apply(String,t)}function J5(n){if(n<4)if(n<2){if(n===0)return"";{let e=Ln[bt++];if((e&128)>1){bt-=1;return}return el(e)}}else{let e=Ln[bt++],t=Ln[bt++];if((e&128)>0||(t&128)>0){bt-=2;return}if(n<3)return el(e,t);let r=Ln[bt++];if((r&128)>0){bt-=3;return}return el(e,t,r)}else{let e=Ln[bt++],t=Ln[bt++],r=Ln[bt++],i=Ln[bt++];if((e&128)>0||(t&128)>0||(r&128)>0||(i&128)>0){bt-=4;return}if(n<6){if(n===4)return el(e,t,r,i);{let s=Ln[bt++];if((s&128)>0){bt-=5;return}return el(e,t,r,i,s)}}else if(n<8){let s=Ln[bt++],o=Ln[bt++];if((s&128)>0||(o&128)>0){bt-=6;return}if(n<7)return el(e,t,r,i,s,o);let a=Ln[bt++];if((a&128)>0){bt-=7;return}return el(e,t,r,i,s,o,a)}else{let s=Ln[bt++],o=Ln[bt++],a=Ln[bt++],c=Ln[bt++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){bt-=8;return}if(n<10){if(n===8)return el(e,t,r,i,s,o,a,c);{let l=Ln[bt++];if((l&128)>0){bt-=9;return}return el(e,t,r,i,s,o,a,c,l)}}else if(n<12){let l=Ln[bt++],u=Ln[bt++];if((l&128)>0||(u&128)>0){bt-=10;return}if(n<11)return el(e,t,r,i,s,o,a,c,l,u);let h=Ln[bt++];if((h&128)>0){bt-=11;return}return el(e,t,r,i,s,o,a,c,l,u,h)}else{let l=Ln[bt++],u=Ln[bt++],h=Ln[bt++],f=Ln[bt++];if((l&128)>0||(u&128)>0||(h&128)>0||(f&128)>0){bt-=12;return}if(n<14){if(n===12)return el(e,t,r,i,s,o,a,c,l,u,h,f);{let d=Ln[bt++];if((d&128)>0){bt-=13;return}return el(e,t,r,i,s,o,a,c,l,u,h,f,d)}}else{let d=Ln[bt++],p=Ln[bt++];if((d&128)>0||(p&128)>0){bt-=14;return}if(n<15)return el(e,t,r,i,s,o,a,c,l,u,h,f,d,p);let _=Ln[bt++];if((_&128)>0){bt-=15;return}return el(e,t,r,i,s,o,a,c,l,u,h,f,d,p,_)}}}}}function R9(){let n=Ln[bt++],e;if(n<192)e=n-160;else switch(n){case 217:e=Ln[bt++];break;case 218:e=wi.getUint16(bt),bt+=2;break;case 219:e=wi.getUint32(bt),bt+=4;break;default:throw new Error("Expected string")}return ZA(e)}function CI(n){return eo.copyBuffers?Uint8Array.prototype.slice.call(Ln,bt,bt+=n):Ln.subarray(bt,bt+=n)}function u1(n){let e=Ln[bt++];if($h[e]){let t;return $h[e](Ln.subarray(bt,t=bt+=n),r=>{bt=r;try{return La()}finally{bt=t}})}else throw new Error("Unknown extension type "+e)}var C9=new Array(4096);function vY(){let n=Ln[bt++];if(n>=160&&n<192){if(n=n-160,jm>=bt)return Mv.slice(bt-fd,(bt+=n)-fd);if(!(jm==0&&Zm<180))return RL(n)}else return bt--,yY(La());let e=(n<<5^(n>1?wi.getUint16(bt):n>0?Ln[bt]:0))&4095,t=C9[e],r=bt,i=bt+n-3,s,o=0;if(t&&t.bytes==n){for(;r<i;){if(s=wi.getUint32(r),s!=t[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=Ln[r++],s!=t[o++]){r=1879048192;break}if(r===i)return bt=r,t.string;i-=3,r=bt}for(t=[],C9[e]=t,t.bytes=n;r<i;)s=wi.getUint32(r),t.push(s),r+=4;for(i+=3;r<i;)s=Ln[r++],t.push(s);let a=n<16?J5(n):_Y(n);return a!=null?t.string=a:t.string=RL(n)}function yY(n){if(typeof n=="string")return n;if(typeof n=="number"||typeof n=="boolean"||typeof n=="bigint")return n.toString();if(n==null)return n+"";if(eo.allowArraysInMapKeys&&Array.isArray(n)&&n.flat().every(e=>["string","number","boolean","bigint"].includes(typeof e)))return n.flat().toString();throw new Error(`Invalid property type for record: ${typeof n}`)}const M9=(n,e)=>{let t=La().map(yY),r=n;e!==void 0&&(n=n<32?-((e<<5)+n):(e<<5)+n,t.highByte=e);let i=ki[n];return i&&(i.isShared||Pv)&&((ki.restoreStructures||(ki.restoreStructures=[]))[n]=i),ki[n]=t,t.read=Z5(t,r),t.read()};$h[0]=()=>{};$h[0].noBuffer=!0;$h[66]=n=>{let e=n.byteLength%8||8,t=BigInt(n[0]&128?n[0]-256:n[0]);for(let r=1;r<e;r++)t<<=BigInt(8),t+=BigInt(n[r]);if(n.byteLength!==e){let r=new DataView(n.buffer,n.byteOffset,n.byteLength),i=(s,o)=>{let a=o-s;if(a<=40){let h=r.getBigUint64(s);for(let f=s+8;f<o;f+=8)h<<=64n,h|=r.getBigUint64(f);return h}let c=s+(a>>4<<3),l=i(s,c),u=i(c,o);return l<<BigInt((o-c)*8)|u};t=t<<BigInt((r.byteLength-e)*8)|i(e,r.byteLength)}return t};let k9={Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError:typeof AggregateError=="function"?AggregateError:null};$h[101]=()=>{let n=La();if(!k9[n[0]]){let e=Error(n[1],{cause:n[2]});return e.name=n[0],e}return k9[n[0]](n[1],{cause:n[2]})};$h[105]=n=>{if(eo.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=wi.getUint32(bt-4);Yg||(Yg=new Map);let t=Ln[bt],r;t>=144&&t<160||t==220||t==221?r=[]:t>=128&&t<144||t==222||t==223?r=new Map:(t>=199&&t<=201||t>=212&&t<=216)&&Ln[bt+1]===115?r=new Set:r={};let i={target:r};Yg.set(e,i);let s=La();if(i.used)Object.assign(r,s);else return i.target=s;if(r instanceof Map)for(let[o,a]of s.entries())r.set(o,a);if(r instanceof Set)for(let o of Array.from(s))r.add(o);return r};$h[112]=n=>{if(eo.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=wi.getUint32(bt-4),t=Yg.get(e);return t.used=!0,t.target};$h[115]=()=>new Set(La());const bY=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(n=>n+"Array");let SSe=typeof globalThis=="object"?globalThis:window;$h[116]=n=>{let e=n[0],t=Uint8Array.prototype.slice.call(n,1).buffer,r=bY[e];if(!r){if(e===16)return t;if(e===17)return new DataView(t);throw new Error("Could not find typed array for code "+e)}return new SSe[r](t)};$h[120]=()=>{let n=La();return new RegExp(n[0],n[1])};const ESe=[];$h[98]=n=>{let e=(n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3],t=bt;return bt+=e-n.length,sl=ESe,sl=[R9(),R9()],sl.position0=0,sl.position1=0,sl.postBundlePosition=bt,bt=t,La()};$h[255]=n=>n.length==4?new Date((n[0]*16777216+(n[1]<<16)+(n[2]<<8)+n[3])*1e3):n.length==8?new Date(((n[0]<<22)+(n[1]<<14)+(n[2]<<6)+(n[3]>>2))/1e6+((n[3]&3)*4294967296+n[4]*16777216+(n[5]<<16)+(n[6]<<8)+n[7])*1e3):n.length==12?new Date(((n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3])/1e6+((n[4]&128?-281474976710656:0)+n[6]*1099511627776+n[7]*4294967296+n[8]*16777216+(n[9]<<16)+(n[10]<<8)+n[11])*1e3):new Date("invalid");function SY(n){let e=Zm,t=bt,r=fd,i=jm,s=Mv,o=Yg,a=sl,c=new Uint8Array(Ln.slice(0,Zm)),l=ki,u=ki.slice(0,ki.length),h=eo,f=Pv,d=n();return Zm=e,bt=t,fd=r,jm=i,Mv=s,Yg=o,sl=a,Ln=c,Pv=f,ki=l,ki.splice(0,ki.length,...u),eo=h,wi=new DataView(Ln.buffer,Ln.byteOffset,Ln.byteLength),d}function CL(){Ln=null,Yg=null,ki=null}const Q5=new Array(147);for(let n=0;n<256;n++)Q5[n]=+("1e"+Math.floor(45.15-n*.30103));var dO=new eA({useRecords:!1});dO.unpack;dO.unpackMultiple;dO.unpack;let xSe=new Float32Array(1);new Uint8Array(xSe.buffer,0,4);let MC;try{MC=new TextEncoder}catch{}let ML,EY;const lx=typeof Qs<"u",T2=lx?function(n){return Qs.allocUnsafeSlow(n)}:Uint8Array,xY=lx?Qs:Uint8Array,O9=lx?4294967296:2144337920;let Dt,BT,Ls,Et=0,eu,Wo=null,TSe;const wSe=21760,ASe=/[\u0080-\uFFFF]/,XS=Symbol("record-id");class RSe extends eA{constructor(e){super(e),this.offset=0;let t,r,i,s,o=xY.prototype.utf8Write?function(L,M){return Dt.utf8Write(L,M,Dt.byteLength-M)}:MC&&MC.encodeInto?function(L,M){return MC.encodeInto(L,Dt.subarray(M)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let h=e.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let f=u>32||h+u>64,d=u+64,p=u+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let _=[],g=0,m=0;this.pack=this.encode=function(L,M){if(Dt||(Dt=new T2(8192),Ls=Dt.dataView||(Dt.dataView=new DataView(Dt.buffer,0,8192)),Et=0),eu=Dt.length-10,eu-Et<2048?(Dt=new T2(Dt.length),Ls=Dt.dataView||(Dt.dataView=new DataView(Dt.buffer,0,Dt.length)),eu=Dt.length-10,Et=0):Et=Et+7&2147483640,t=Et,M&ISe&&(Et+=M&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof L!="string"?(Wo=[],Wo.size=1/0):Wo=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let Z=i.sharedLength||0;if(Z>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let $=0;$<Z;$++){let Y=i[$];if(!Y)continue;let Q,q=i.transitions;for(let V=0,K=Y.length;V<K;V++){let ne=Y[V];Q=q[ne],Q||(Q=q[ne]=Object.create(null)),q=Q}q[XS]=$+64}this.lastNamedStructuresLength=Z}c||(i.nextId=Z+64)}r&&(r=!1);let F;try{a.randomAccessStructure&&L&&L.constructor&&L.constructor===Object?I(L):x(L);let Z=Wo;if(Wo&&N9(t,x,0),s&&s.idsToInsert){let $=s.idsToInsert.sort((V,K)=>V.offset>K.offset?1:-1),Y=$.length,Q=-1;for(;Z&&Y>0;){let V=$[--Y].offset+t;V<Z.stringsPosition+t&&Q===-1&&(Q=0),V>Z.position+t?Q>=0&&(Q+=6):(Q>=0&&(Ls.setUint32(Z.position+t,Ls.getUint32(Z.position+t)+Q),Q=-1),Z=Z.previous,Y++)}Q>=0&&Z&&Ls.setUint32(Z.position+t,Ls.getUint32(Z.position+t)+Q),Et+=$.length*6,Et>eu&&B(Et),a.offset=Et;let q=CSe(Dt.subarray(t,Et),$);return s=null,q}return a.offset=Et,M&kSe?(Dt.start=t,Dt.end=Et,Dt):Dt.subarray(t,Et)}catch(Z){throw F=Z,Z}finally{if(i&&(b(),r&&a.saveStructures)){let Z=i.sharedLength||0,$=Dt.subarray(t,Et),Y=MSe(i,a);if(!F)return a.saveStructures(Y,Y.isCompatible)===!1?a.pack(L,M):(a.lastNamedStructuresLength=Z,Dt.length>1073741824&&(Dt=null),$)}Dt.length>1073741824&&(Dt=null),M&OSe&&(Et=t)}};const b=()=>{m<10&&m++;let L=i.sharedLength||0;if(i.length>L&&!c&&(i.length=L),g>1e4)i.transitions=null,m=0,g=0,_.length>0&&(_=[]);else if(_.length>0&&!c){for(let M=0,F=_.length;M<F;M++)_[M][XS]=0;_=[]}},y=L=>{var M=L.length;M<16?Dt[Et++]=144|M:M<65536?(Dt[Et++]=220,Dt[Et++]=M>>8,Dt[Et++]=M&255):(Dt[Et++]=221,Ls.setUint32(Et,M),Et+=4);for(let F=0;F<M;F++)x(L[F])},x=L=>{Et>eu&&(Dt=B(Et));var M=typeof L,F;if(M==="string"){let Z=L.length;if(Wo&&Z>=4&&Z<4096){if((Wo.size+=Z)>wSe){let q,V=(Wo[0]?Wo[0].length*3+Wo[1].length:0)+10;Et+V>eu&&(Dt=B(Et+V));let K;Wo.position?(K=Wo,Dt[Et]=200,Et+=3,Dt[Et++]=98,q=Et-t,Et+=4,N9(t,x,0),Ls.setUint16(q+t-3,Et-t-q)):(Dt[Et++]=214,Dt[Et++]=98,q=Et-t,Et+=4),Wo=["",""],Wo.previous=K,Wo.size=0,Wo.position=q}let Q=ASe.test(L);Wo[Q?0:1]+=L,Dt[Et++]=193,x(Q?-Z:Z);return}let $;Z<32?$=1:Z<256?$=2:Z<65536?$=3:$=5;let Y=Z*3;if(Et+Y>eu&&(Dt=B(Et+Y)),Z<64||!o){let Q,q,V,K=Et+$;for(Q=0;Q<Z;Q++)q=L.charCodeAt(Q),q<128?Dt[K++]=q:q<2048?(Dt[K++]=q>>6|192,Dt[K++]=q&63|128):(q&64512)===55296&&((V=L.charCodeAt(Q+1))&64512)===56320?(q=65536+((q&1023)<<10)+(V&1023),Q++,Dt[K++]=q>>18|240,Dt[K++]=q>>12&63|128,Dt[K++]=q>>6&63|128,Dt[K++]=q&63|128):(Dt[K++]=q>>12|224,Dt[K++]=q>>6&63|128,Dt[K++]=q&63|128);F=K-Et-$}else F=o(L,Et+$);F<32?Dt[Et++]=160|F:F<256?($<2&&Dt.copyWithin(Et+2,Et+1,Et+1+F),Dt[Et++]=217,Dt[Et++]=F):F<65536?($<3&&Dt.copyWithin(Et+3,Et+2,Et+2+F),Dt[Et++]=218,Dt[Et++]=F>>8,Dt[Et++]=F&255):($<5&&Dt.copyWithin(Et+5,Et+3,Et+3+F),Dt[Et++]=219,Ls.setUint32(Et,F),Et+=4),Et+=F}else if(M==="number")if(L>>>0===L)L<32||L<128&&this.useRecords===!1||L<64&&!this.randomAccessStructure?Dt[Et++]=L:L<256?(Dt[Et++]=204,Dt[Et++]=L):L<65536?(Dt[Et++]=205,Dt[Et++]=L>>8,Dt[Et++]=L&255):(Dt[Et++]=206,Ls.setUint32(Et,L),Et+=4);else if(L>>0===L)L>=-32?Dt[Et++]=256+L:L>=-128?(Dt[Et++]=208,Dt[Et++]=L+256):L>=-32768?(Dt[Et++]=209,Ls.setInt16(Et,L),Et+=2):(Dt[Et++]=210,Ls.setInt32(Et,L),Et+=4);else{let Z;if((Z=this.useFloat32)>0&&L<4294967296&&L>=-2147483648){Dt[Et++]=202,Ls.setFloat32(Et,L);let $;if(Z<4||($=L*Q5[(Dt[Et]&127)<<1|Dt[Et+1]>>7])>>0===$){Et+=4;return}else Et--}Dt[Et++]=203,Ls.setFloat64(Et,L),Et+=8}else if(M==="object"||M==="function")if(!L)Dt[Et++]=192;else{if(s){let $=s.get(L);if($){if(!$.id){let Y=s.idsToInsert||(s.idsToInsert=[]);$.id=Y.push($)}Dt[Et++]=214,Dt[Et++]=112,Ls.setUint32(Et,$.id),Et+=4;return}else s.set(L,{offset:Et-t})}let Z=L.constructor;if(Z===Object)P(L);else if(Z===Array)y(L);else if(Z===Map)if(this.mapAsEmptyObject)Dt[Et++]=128;else{F=L.size,F<16?Dt[Et++]=128|F:F<65536?(Dt[Et++]=222,Dt[Et++]=F>>8,Dt[Et++]=F&255):(Dt[Et++]=223,Ls.setUint32(Et,F),Et+=4);for(let[$,Y]of L)x($),x(Y)}else{for(let $=0,Y=ML.length;$<Y;$++){let Q=EY[$];if(L instanceof Q){let q=ML[$];if(q.write){q.type&&(Dt[Et++]=212,Dt[Et++]=q.type,Dt[Et++]=0);let ae=q.write.call(this,L);ae===L?Array.isArray(L)?y(L):P(L):x(ae);return}let V=Dt,K=Ls,ne=Et;Dt=null;let ie;try{ie=q.pack.call(this,L,ae=>(Dt=V,V=null,Et+=ae,Et>eu&&B(Et),{target:Dt,targetView:Ls,position:Et-ae}),x)}finally{V&&(Dt=V,Ls=K,Et=ne,eu=Dt.length-10)}ie&&(ie.length+Et>eu&&B(ie.length+Et),Et=I9(ie,Dt,Et,q.type));return}}if(Array.isArray(L))y(L);else{if(L.toJSON){const $=L.toJSON();if($!==L)return x($)}if(M==="function")return x(this.writeFunction&&this.writeFunction(L));P(L)}}}else if(M==="boolean")Dt[Et++]=L?195:194;else if(M==="bigint"){if(L<9223372036854776e3&&L>=-9223372036854776e3)Dt[Et++]=211,Ls.setBigInt64(Et,L);else if(L<18446744073709552e3&&L>0)Dt[Et++]=207,Ls.setBigUint64(Et,L);else if(this.largeBigIntToFloat)Dt[Et++]=203,Ls.setFloat64(Et,Number(L));else{if(this.largeBigIntToString)return x(L.toString());if(this.useBigIntExtension||this.moreTypes){let Z=L<0?BigInt(-1):BigInt(0),$;if(L>>BigInt(65536)===Z){let Y=BigInt(18446744073709552e3)-BigInt(1),Q=[];for(;Q.push(L&Y),L>>BigInt(63)!==Z;)L>>=BigInt(64);$=new Uint8Array(new BigUint64Array(Q).buffer),$.reverse()}else{let Y=L<0,Q=(Y?~L:L).toString(16);if(Q.length%2?Q="0"+Q:parseInt(Q.charAt(0),16)>=8&&(Q="00"+Q),lx)$=Qs.from(Q,"hex");else{$=new Uint8Array(Q.length/2);for(let q=0;q<$.length;q++)$[q]=parseInt(Q.slice(q*2,q*2+2),16)}if(Y)for(let q=0;q<$.length;q++)$[q]=~$[q]}$.length+Et>eu&&B($.length+Et),Et=I9($,Dt,Et,66);return}else throw new RangeError(L+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}Et+=8}else if(M==="undefined")this.encodeUndefinedAsNil?Dt[Et++]=192:(Dt[Et++]=212,Dt[Et++]=0,Dt[Et++]=0);else throw new Error("Unknown type: "+M)},T=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?L=>{let M;if(this.skipValues){M=[];for(let $ in L)(typeof L.hasOwnProperty!="function"||L.hasOwnProperty($))&&!this.skipValues.includes(L[$])&&M.push($)}else M=Object.keys(L);let F=M.length;F<16?Dt[Et++]=128|F:F<65536?(Dt[Et++]=222,Dt[Et++]=F>>8,Dt[Et++]=F&255):(Dt[Et++]=223,Ls.setUint32(Et,F),Et+=4);let Z;if(this.coercibleKeyAsNumber)for(let $=0;$<F;$++){Z=M[$];let Y=Number(Z);x(isNaN(Y)?Z:Y),x(L[Z])}else for(let $=0;$<F;$++)x(Z=M[$]),x(L[Z])}:L=>{Dt[Et++]=222;let M=Et-t;Et+=2;let F=0;for(let Z in L)(typeof L.hasOwnProperty!="function"||L.hasOwnProperty(Z))&&(x(Z),x(L[Z]),F++);if(F>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');Dt[M+++t]=F>>8,Dt[M+t]=F&255},k=this.useRecords===!1?T:e.progressiveRecords&&!f?L=>{let M,F=i.transitions||(i.transitions=Object.create(null)),Z=Et++-t,$;for(let Y in L)if(typeof L.hasOwnProperty!="function"||L.hasOwnProperty(Y)){if(M=F[Y],M)F=M;else{let Q=Object.keys(L),q=F;F=i.transitions;let V=0;for(let K=0,ne=Q.length;K<ne;K++){let ie=Q[K];M=F[ie],M||(M=F[ie]=Object.create(null),V++),F=M}Z+t+1==Et?(Et--,U(F,Q,V)):z(F,Q,Z,V),$=!0,F=q[Y]}x(L[Y])}if(!$){let Y=F[XS];Y?Dt[Z+t]=Y:z(F,Object.keys(L),Z,0)}}:L=>{let M,F=i.transitions||(i.transitions=Object.create(null)),Z=0;for(let Y in L)(typeof L.hasOwnProperty!="function"||L.hasOwnProperty(Y))&&(M=F[Y],M||(M=F[Y]=Object.create(null),Z++),F=M);let $=F[XS];$?$>=96&&f?(Dt[Et++]=(($-=96)&31)+96,Dt[Et++]=$>>5):Dt[Et++]=$:U(F,F.__keys__||Object.keys(L),Z);for(let Y in L)(typeof L.hasOwnProperty!="function"||L.hasOwnProperty(Y))&&x(L[Y])},R=typeof this.useRecords=="function"&&this.useRecords,P=R?L=>{R(L)?k(L):T(L)}:k,B=L=>{let M;if(L>16777216){if(L-t>O9)throw new Error("Packed buffer would be larger than maximum buffer size");M=Math.min(O9,Math.round(Math.max((L-t)*(L>67108864?1.25:2),4194304)/4096)*4096)}else M=(Math.max(L-t<<2,Dt.length-1)>>12)+1<<12;let F=new T2(M);return Ls=F.dataView||(F.dataView=new DataView(F.buffer,0,M)),L=Math.min(L,Dt.length),Dt.copy?Dt.copy(F,0,t,L):F.set(Dt.slice(t,L)),Et-=t,t=0,eu=F.length-10,Dt=F},U=(L,M,F)=>{let Z=i.nextId;Z||(Z=64),Z<d&&this.shouldShareStructure&&!this.shouldShareStructure(M)?(Z=i.nextOwnId,Z<p||(Z=d),i.nextOwnId=Z+1):(Z>=p&&(Z=d),i.nextId=Z+1);let $=M.highByte=Z>=96&&f?Z-96>>5:-1;L[XS]=Z,L.__keys__=M,i[Z-64]=M,Z<d?(M.isShared=!0,i.sharedLength=Z-63,r=!0,$>=0?(Dt[Et++]=(Z&31)+96,Dt[Et++]=$):Dt[Et++]=Z):($>=0?(Dt[Et++]=213,Dt[Et++]=114,Dt[Et++]=(Z&31)+96,Dt[Et++]=$):(Dt[Et++]=212,Dt[Et++]=114,Dt[Et++]=Z),F&&(g+=m*F),_.length>=h&&(_.shift()[XS]=0),_.push(L),x(M))},z=(L,M,F,Z)=>{let $=Dt,Y=Et,Q=eu,q=t;Dt=BT,Et=0,t=0,Dt||(BT=Dt=new T2(8192)),eu=Dt.length-10,U(L,M,Z),BT=Dt;let V=Et;if(Dt=$,Et=Y,eu=Q,t=q,V>1){let K=Et+V-1;K>eu&&B(K);let ne=F+t;Dt.copyWithin(ne+V,ne+1,Et),Dt.set(BT.slice(0,V),ne),Et=K}else Dt[F+t]=BT[0]},I=L=>{let M=TSe(L,Dt,t,Et,i,B,(F,Z,$)=>{if($)return r=!0;Et=Z;let Y=Dt;return x(F),b(),Y!==Dt?{position:Et,targetView:Ls,target:Dt}:Et},this);if(M===0)return P(L);Et=M}}useBuffer(e){Dt=e,Dt.dataView||(Dt.dataView=new DataView(Dt.buffer,Dt.byteOffset,Dt.byteLength)),Ls=Dt.dataView,Et=0}set position(e){Et=e}get position(){return Et}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}EY=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,DataView,dY];ML=[{pack(n,e,t){let r=n.getTime()/1e3;if((this.useTimestamp32||n.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,n.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),t(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,n.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(n,e,t){if(this.setAsEmptyObject)return e(0),t({});let r=Array.from(n),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),t(r)}},{pack(n,e,t){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),t([n.name,n.message,n.cause])}},{pack(n,e,t){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),t([n.source,n.flags])}},{pack(n,e){this.moreTypes?MI(n,16,e):kI(lx?Qs.from(n):new Uint8Array(n),e)}},{pack(n,e){let t=n.constructor;t!==xY&&this.moreTypes?MI(n,bY.indexOf(t.name),e):kI(n,e)}},{pack(n,e){this.moreTypes?MI(n,17,e):kI(lx?Qs.from(n):new Uint8Array(n),e)}},{pack(n,e){let{target:t,position:r}=e(1);t[r]=193}}];function MI(n,e,t,r){let i=n.byteLength;if(i+1<256){var{target:s,position:o}=t(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=t(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=t(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,n.buffer||(n=new Uint8Array(n)),s.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o)}function kI(n,e){let t=n.byteLength;var r,i;if(t<256){var{target:r,position:i}=e(t+2);r[i++]=196,r[i++]=t}else if(t<65536){var{target:r,position:i}=e(t+3);r[i++]=197,r[i++]=t>>8,r[i++]=t&255}else{var{target:r,position:i,targetView:s}=e(t+5);r[i++]=198,s.setUint32(i,t),i+=4}r.set(n,i)}function I9(n,e,t,r){let i=n.length;switch(i){case 1:e[t++]=212;break;case 2:e[t++]=213;break;case 4:e[t++]=214;break;case 8:e[t++]=215;break;case 16:e[t++]=216;break;default:i<256?(e[t++]=199,e[t++]=i):i<65536?(e[t++]=200,e[t++]=i>>8,e[t++]=i&255):(e[t++]=201,e[t++]=i>>24,e[t++]=i>>16&255,e[t++]=i>>8&255,e[t++]=i&255)}return e[t++]=r,e.set(n,t),t+=i,t}function CSe(n,e){let t,r=e.length*6,i=n.length-r;for(;t=e.pop();){let s=t.offset,o=t.id;n.copyWithin(s+r,s,i),r-=6;let a=s+r;n[a++]=214,n[a++]=105,n[a++]=o>>24,n[a++]=o>>16&255,n[a++]=o>>8&255,n[a++]=o&255,i=s}return n}function N9(n,e,t){if(Wo.length>0){Ls.setUint32(Wo.position+n,Et+t-Wo.position-n),Wo.stringsPosition=Et-n;let r=Wo;Wo=null,e(r[0]),e(r[1])}}function MSe(n,e){return n.isCompatible=t=>{let r=!t||(e.lastNamedStructuresLength||0)===t.length;return r||e._mergeStructures(t),r},n}let TY=new RSe({useRecords:!1});TY.pack;TY.pack;const kSe=512,OSe=1024,ISe=2048;function NSe(n){return typeof n=="object"&&rn(n.session)&&rn(n.player)&&rn(n.id)&&rn(n.sender)&&rn(n.target)}function PSe(n){n.emit("","sessionreset")}function ur(n,e,t,...r){return n.emit(e,"log",[`$red${t}$blue>>`,...r]),!1}function Qi(n,e,...t){return n.emit(e,"log",t),!0}function kL(n,e,...t){return n.emit(e,"chat",t),!0}function wY(n,e,t){n.emit(e,"toast",t)}function DSe(n,e,t){n.emit(e,"bridge:streamstart",t)}function LSe(n,e){n.emit(e,"bridge:streamstop",void 0)}function USe(n,e,t){n.emit(e,"bridge:chatstart",t)}function BSe(n,e){n.emit(e,"bridge:chatstop")}function FSe(n,e,t,r,i,s,o){n.emit(e,"bridge:fetch",[t,r,i,s,o])}function jSe(n,e,t){n.emit(e,"bridge:join",t)}function zSe(n,e,t){n.emit(e,"bridge:start",t)}function HSe(n,e,t){n.emit(e,"bridge:tab",t)}function VSe(n,e){n.emit(e,"bridge:tabopen")}function GSe(n,e,t){n.emit(e,"bridge:showjoincode",t)}function $Se(n,e){n.emit(e,"gadgetserver:desync")}function WSe(n,e){n.emit(e,"gadgetserver:clearscroll")}function qSe(n,e,t,r){n.emit(e,"heavy:ttsinfo",[t,r])}function YSe(n,e,t,r,i,s){n.emit(e,"heavy:ttsrequest",[t,r,i,s])}function bm(n,e,t,r){n.emit(e,"register:input",[t,r])}function ux(n,e,t){n.emit(e,"register:copy",t)}function P9(n,e,t,r){n.emit(e,"register:downloadjsonfile",[t,r])}function KSe(n,e){n.emit(e,"register:share",void 0)}function XSe(n,e){n.emit(e,"register:nuke",void 0)}function ZSe(n,e){n.emit(e,"synth:audioenabled",void 0)}function JSe(n,e){n.emit(e,"synth:restart",void 0)}function AY(n,e,t){n.emit(e,"synth:audiobuffer",t)}function QSe(n,e,t,r){n.emit(e,"synth:play",[t,r])}function eEe(n,e,t,r,i){n.emit(e,"synth:bgplay",[t,r,i])}function tEe(n,e,t){n.emit(e,"synth:bpm",t)}function nEe(n,e,t){n.emit(e,"synth:playvolume",t)}function rEe(n,e,t){n.emit(e,"synth:bgplayvolume",t)}function iEe(n,e,t){n.emit(e,"synth:ttsvolume",t)}function sEe(n,e,t,r){n.emit(e,"synth:ttsengine",[t,r])}function oEe(n,e,t,r,i){n.emit(e,"synth:tts",[t,r,i])}function aEe(n,e,t){n.emit(e,"synth:ttsinfo",t)}function cEe(n,e,t,r,i){n.emit(e,"synth:ttsqueue",[t,r,i])}function lEe(n,e){n.emit(e,"synth:ttsclearqueue")}function OI(n,e,t,r,i){n.emit(e,"synth:voice",[t,r,i])}function RY(n,e,t,r,i,s){n.emit(e,"synth:voicefx",[t,r,i,s])}function uEe(n,e,t){n.emit(e,"synth:record",t)}function hEe(n,e){n.emit(e,"synth:flush")}function fEe(n,e,t,r){n.emit(e,"register:store",[t,r])}function dEe(n,e,t){n.emit(e,"register:inspector",t)}function D9(n,e,t){n.emit(e,"register:findany",t)}function lb(n,e,t){n.emit(e,"register:terminal:open",t)}function e6(n,e,t){n.emit(e,"register:terminal:quickopen",t)}function Ow(n,e){n.emit(e,"register:terminal:close")}function CY(n,e,t){n.emit(e,"register:terminal:inclayout",t)}function t6(n,e){n.emit(e,"register:terminal:full")}function pEe(n,e,t,r,i,s){n.emit(e,"register:editor:open",[t,r,i,s])}function mEe(n,e){n.emit(e,"register:editor:close")}function gEe(n,e){n.emit(e,"vm:operator")}function _Ee(n,e){n.emit(e,"vm:admin")}function vEe(n,e,t,r){n.emit(e,"vm:zztsearch",[t,r])}function yEe(n,e){n.emit(e,"vm:zztrandom")}function MY(n,e){n.emit(e,"vm:zsswords")}function bEe(n,e){n.emit(e,"vm:halt")}function SEe(n,e,t){n.emit(e,"vm:topic",t)}function kY(n,e,t){n.emit(e,"vm:books",t)}function EEe(n,e){n.emit(e,"vm:search")}function xEe(n,e,t){n.emit(e,"vm:login",t)}function TEe(n,e){n.emit(e,"vm:local")}function OY(n,e,t){n.emit(e,"vm:logout",t)}function IY(n,e){n.emit(e,"vm:doot")}function NY(n,e,t,r){n.emit(e,"vm:input",[t,r])}function wEe(n,e,t){n.emit(e,"vm:makeitscroll",t)}function n6(n,e){n.emit(e,"vm:refscroll")}function AEe(n,e,t,r){n.emit(e,"vm:inspect",[t,r])}function REe(n,e){n.emit(e,"vm:findany")}function PY(n,e){const[t,r]=e;return`${n}:${[t,r].filter(fe).join(":")}`}function CEe(n,e,t,r){n.emit(e,"vm:codewatch",[t,r])}function MEe(n,e,t,r){n.emit(e,"vm:coderelease",[t,r])}function $m(n,e,t){n.emit(e,"vm:cli",t)}function r6(n,e){n.emit(e,"vm:clirepeatlast")}function kEe(n,e){n.emit(e,"vm:restart")}function OEe(n,e){n.emit(e,"vm:flush")}function IEe(n,e,t){n.emit(e,"vm:fork",t)}function L9(n,e,t,...r){n.emit(e,"vm:publish",[t,...r])}function NEe(n,e){return{filename:n,cursor:0,lines:e.split(`
`)}}function PEe(n,e){return{filename:n,json:e}}function DEe(n,e){return{filename:n,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function Uh(n,e,t,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=NEe(i,s);break;case"json":o=PEe(i,s);break;case"binary":o=DEe(i,s);break}setTimeout(()=>{n.emit(e,"vm:loader",[t,r,i,o])},1)}const II=new Set,ub={emit(n,e,t,r,i){ub.invoke(JEe(n,e,t,r,i))},invoke(n){II.forEach(e=>e.handle(n))},connect(n){II.add(n)},disconnect(n){II.delete(n)}};var FT={},U9;function LEe(){return U9||(U9=1,(function(n){var e=FT&&FT.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var f=0,d=u.length,p;f<d;f++)(p||!(f in u))&&(p||(p=Array.prototype.slice.call(u,0,f)),p[f]=u[f]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(n,"__esModule",{value:!0}),n.minLength=n.maxLength=n.poolSize=n.humanId=n.adverbs=n.verbs=n.nouns=n.adjectives=void 0,n.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],n.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],n.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],n.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function t(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function i(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,f=l.capitalize,d=f===void 0?!0:f,p=l.adjectiveCount,_=p===void 0?1:p,g=l.addAdverb,m=g===void 0?!1:g,b=e(e(e([],e([],Array(_),!0).map(function(y){return t(n.adjectives)}),!0),[t(n.nouns),t(n.verbs)],!1),m?[t(n.adverbs)]:[],!0);return d&&(b=b.map(function(y){return y.charAt(0).toUpperCase()+y.substr(1)})),b.join(h)}n.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,f=l.addAdverb,d=f===void 0?!1:f;return n.adjectives.length*h*n.nouns.length*n.verbs.length*(d?n.adverbs.length:1)}n.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,f=l.addAdverb,d=f===void 0?!1:f,p=l.separator,_=p===void 0?"":p;return r(n.adjectives).length*h+h*_.length+r(n.nouns).length+_.length+r(n.verbs).length+(d?r(n.adverbs).length+_.length:0)}n.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,f=l.addAdverb,d=f===void 0?!1:f,p=l.separator,_=p===void 0?"":p;return i(n.adjectives).length*h+h*_.length+i(n.nouns).length+_.length+i(n.verbs).length+(d?i(n.adverbs).length+_.length:0)}n.minLength=c,n.default=s})(FT)),FT}var UEe=LEe();const i6=Dl(UEe),BEe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let FEe=n=>crypto.getRandomValues(new Uint8Array(n)),jEe=(n,e,t)=>{let r=(2<<Math.log2(n.length-1))-1,i=-~(1.6*r*e/n.length);return(s=e)=>{let o="";for(;;){let a=t(i),c=i|0;for(;c--;)if(o+=n[a[c]&r]||"",o.length>=s)return o}}},DY=(n,e=21)=>jEe(n,e|0,FEe),zEe=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=BEe[t[n]&63];return e};var NI,B9;function LY(){return B9||(B9=1,NI="abcdefghijklmnopqrstuvwxyz"),NI}var PI,F9;function UY(){return F9||(F9=1,PI="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),PI}var DI,j9;function BY(){return j9||(j9=1,DI="0123456789"),DI}var LI,z9;function HEe(){return z9||(z9=1,LI="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz"),LI}var UI,H9;function VEe(){return H9||(H9=1,UI="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz"),UI}var BI,V9;function GEe(){if(V9)return BI;V9=1;const n=BY(),e=LY(),t=UY();return BI=n+e+t,BI}var FI,G9;function $Ee(){return G9||(G9=1,FI={lowercase:LY(),uppercase:UY(),numbers:BY(),nolookalikes:HEe(),nolookalikesSafe:VEe(),alphanumeric:GEe()}),FI}var OL=$Ee();function Ko(){return`sid_${zEe(12).replaceAll("-",".")}`}const WEe=DY(OL.numbers,4),qEe=DY(`${OL.numbers}${OL.lowercase}`,16);function YEe(){return`pid_${WEe()}_${qEe()}`}function lu(n){return n?.startsWith("pid_")??!1}function s6(){return i6({capitalize:!1,adjectiveCount:1})}function KEe(){return i6({addAdverb:!1,capitalize:!1,adjectiveCount:0})}const XEe=20,$9="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function ZEe(n){const e=Y5(n),t=[];for(let r=0;r<XEe;++r)t.push($9[Math.floor(e()*$9.length)]);return t.join("")}function JEe(n,e,t,r,i){return{session:n,player:e,id:Ko(),sender:t,target:r,data:i}}function Vv(n){const[e,...t]=n.split(":");return{target:e,path:t.join(":")}}function y0(n,e=[],t=_5,r=""){const i=Ko(),s=Jn(n),o=e.map(Jn);let a=r;const c={id(){return i},name(){return n},session(l){return fe(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,h){ub.emit(a,l,i,u,h)},reply(l,u,h){c.emit(l.player,`${l.sender}:${u}`,h)},replynext(l,u,h){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,h),64)},handle(l){const{target:u,path:h}=Vv(l.target),f=Jn(u);!a&&f==="ready"&&(a=l.session),f==="sessionreset"&&(a=""),o.findIndex(d=>d==="all"||d===f)!==-1&&t(l),(i===u||f==="all"||s===f)&&t({...l,target:h})}};return ub.connect(c),c}const Ke=y0("SOFTWARE");function o6(n,e,t={}){if(fe(n))try{const r={};for(let i=0;i<n.length;i+=2){let s=n[i],o=n[i+1];const a=e[s];fe(a)&&(s=a);const c=t[s];fe(c)&&(o=c(o)),r[s]=o}return r}catch(r){ur(Ke,"","format",r.message)}}function QEe(n,e){return n%e}function exe(n,e){return Math.floor(n/e)}function OM(n,e){return{x:QEe(n,e),y:exe(n,e)}}function W9(n,e){const t=n.x-e.x,r=n.y-e.y;return Math.sqrt(t*t+r*r)}function bd(n,e){return n.x+n.y*e}function txe(n,e,t,r,i,s){return n>=s&&n<=r&&e>=t&&e<=i}function q9(n,e,t,r){const i=[],s=Math.abs(t-n),o=Math.abs(r-e),a=n<t?1:-1,c=e<r?1:-1;let l=s-o;for(i.push({x:n,y:e});n!==t||e!==r;){const u=2*l;u>-o&&(l-=o,n+=a),u<s&&(l+=s,e+=c),i.push({x:n,y:e})}return i}function Dv(n){return fe(n)&&fe(n.x)&&fe(n.y)}function $o(n,e){switch(e){case hn.NORTH:--n.y;break;case hn.SOUTH:++n.y;break;case hn.WEST:--n.x;break;case hn.EAST:++n.x;break}return n}function F1(n,e){return n<0?hn.WEST:n>0?hn.EAST:e<0?hn.NORTH:e>0?hn.SOUTH:hn.IDLE}function fp(n,e){return F1(e.x-n.x,e.y-n.y)}const FY={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER",ground:"GROUND",within:"WITHIN",awayby:"AWAYBY",elements:"ELEMENTS"};function Od(n){return Xn(n)&&jY(n[0])}function jY(n){return fe(hn[n])&&rn(n)}function zY(n){const e=hn[n];return fe(e)?e:hn.IDLE}function JA(n){if(rn(n))return FY[Jn(n)]}function nxe(n){if(Od(n))return n;if(jY(n))return[n];const e=JA(n);if(fe(e))return[e]}function Y9(n){const e=de.words[n],t=nxe(e);return Od(t)?[t,n+1]:[void 0,n]}function HY(n){const e=[];let[t,r]=Y9(n);for(;Od(t);){switch(e.push(...t),t[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[a,c,l]=It(de.words,r,[pt.NUMBER,pt.NUMBER]);e.push(a,c),r=l;break}case"FLEE":case"FIND":{const[a,c]=It(de.words,r,[pt.KIND]);console.info("kind",a),r=c;break}case"TO":{const[a,c,l]=It(de.words,r,[pt.DIR,pt.DIR]),u=de.element?.x??0,h=de.element?.y??0;a.destpt.x-=u,a.destpt.y-=h,c.destpt.x-=u,c.destpt.y-=h,e.push(u+a.destpt.x+c.destpt.x,h+a.destpt.y+c.destpt.y),r=l;break}case"WITHIN":case"AWAYBY":{const[a,c]=It(de.words,r,[pt.NUMBER]);e.push(a),r=c;break}}const i=r;switch(t[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":case"WITHIN":case"AWAYBY":case"ELEMENTS":break;default:return[e,r]}const[s,o]=Y9(i);t=s,r=o}return e.length?[e,r]:[void 0,n]}function W1(n,e){if(!fe(n)||!Mc(e))return;const{color:t,bg:r}=kE(e);fe(t)&&(n.color=t),fe(r)&&(n.bg=r)}function _s(n){return n?.category===sb.ISOBJECT}function K9(){return{id:Ko()}}const QA=cx(32,126).map(n=>String.fromCharCode(n));function fi(n){return Gu({...n,name:`token_${n.name}`})}function Ft(n){return fi({name:n,pattern:new RegExp(n.toLowerCase(),"i"),longer_alt:Ta})}const tA=fi({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),VY=fi({name:"whitespace",pattern:/ +/,group:ll.SKIPPED}),GY=fi({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:ll.SKIPPED}),hb=fi({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Fg=fi({name:"command",pattern:/#/,start_chars_hint:["#"]});let $Y=!1;const rxe="@#/?':!",ixe=/^(by|at|away|toward|find|flee|to|cw|ccw|opp|rndp)/i;function sxe(n,e){if(!$Y)return null;let t=e;const r=n[t-1]??"";if(t>0&&r!==" "&&r!==`
`)return null;if(n[t]===" "){for(;n[t]===" ";)t++;if(rxe.includes(n[t]))return null}for(;t>0&&`$"@#':!/?
`.includes(n[t])===!1;)t--;switch(n[t]){case"?":case"/":{const o=n.substring(t+1,e+1).toLowerCase();if(o.indexOf(" ")<1||ixe.test(o))return null;break}case"#":return null;case'"':{for(t--;t>0&&n[t]===" ";)t--;if(!(t<1||n[t]===`
`))return null;break}case"@":case"'":case":":case"!":return null}let i=e;for(n[i]==='"'&&++i;i<n.length&&n[i]!==`
`;)i++;const s=n.substring(e,i);return s.trim().length===0||s.toLowerCase()==="do"?null:[s]}const nA=fi({name:"text",pattern:sxe,line_breaks:!1,start_chars_hint:QA}),rA=fi({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),hx=fi({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),iA=fi({name:"hyperlink",pattern:/![^;\n]*/,start_chars_hint:["!"]}),a6=fi({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),Ta=fi({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:QA}),Iw=fi({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),RE=fi({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),WY=Ft("isterrain"),qY=Ft("isobject"),YY=Ft("issolid"),KY=Ft("iswalk"),XY=Ft("isswim"),ZY=Ft("isbullet"),JY=Ft("isghost"),QY=Ft("iswalking"),eK=Ft("iswalkable"),tK=Ft("isswimming"),nK=Ft("isswimmable"),rK=Ft("black"),iK=Ft("dkblue"),sK=Ft("dkgreen"),oK=Ft("dkcyan"),aK=Ft("dkred"),cK=Ft("dkpurple"),lK=Ft("dkyellow"),uK=Ft("ltgray"),hK=Ft("dkgray"),fK=Ft("blue"),dK=Ft("green"),pK=Ft("cyan"),mK=Ft("red"),gK=Ft("purple"),_K=Ft("yellow"),vK=Ft("white"),yK=Ft("brown"),bK=Ft("dkwhite"),SK=Ft("ltgrey"),EK=Ft("gray"),xK=Ft("grey"),TK=Ft("dkgrey"),wK=Ft("ltblack"),AK=Ft("onblack"),RK=Ft("ondkblue"),CK=Ft("ondkgreen"),MK=Ft("ondkcyan"),kK=Ft("ondkred"),OK=Ft("ondkpurple"),IK=Ft("ondkyellow"),NK=Ft("onltgray"),PK=Ft("ondkgray"),DK=Ft("onblue"),LK=Ft("ongreen"),UK=Ft("oncyan"),BK=Ft("onred"),FK=Ft("onpurple"),jK=Ft("onyellow"),zK=Ft("onwhite"),HK=Ft("onbrown"),VK=Ft("ondkwhite"),GK=Ft("onltgrey"),$K=Ft("ongray"),WK=Ft("ongrey"),qK=Ft("ondkgrey"),YK=Ft("onltblack"),KK=Ft("onclear"),XK=Ft("blblack"),ZK=Ft("bldkblue"),JK=Ft("bldkgreen"),QK=Ft("bldkcyan"),eX=Ft("bldkred"),tX=Ft("bldkpurple"),nX=Ft("bldkyellow"),rX=Ft("blltgray"),iX=Ft("bldkgray"),sX=Ft("blblue"),oX=Ft("blgreen"),aX=Ft("blcyan"),cX=Ft("blred"),lX=Ft("blpurple"),uX=Ft("blyellow"),hX=Ft("blwhite"),fX=Ft("blbrown"),dX=Ft("bldkwhite"),pX=Ft("blltgrey"),mX=Ft("blgray"),gX=Ft("blgrey"),_X=Ft("bldkgrey"),vX=Ft("blltblack"),yX=Ft("idle"),bX=Ft("up"),SX=Ft("down"),EX=Ft("left"),xX=Ft("right"),TX=Ft("by"),wX=Ft("at"),AX=Ft("flow"),RX=Ft("seek"),CX=Ft("rndns"),MX=Ft("rndne"),kX=Ft("rnd"),OX=Ft("cw"),IX=Ft("ccw"),NX=Ft("opp"),PX=Ft("rndp"),DX=Ft("away"),LX=Ft("toward"),UX=Ft("find"),BX=Ft("flee"),FX=Ft("to"),jX=Ft("i"),zX=Ft("u"),HX=Ft("north"),VX=Ft("n"),GX=Ft("d"),$X=Ft("south"),WX=Ft("s"),qX=Ft("l"),YX=Ft("west"),KX=Ft("w"),XX=Ft("r"),ZX=Ft("east"),JX=Ft("e"),QX=Ft("over"),eZ=Ft("under"),tZ=Ft("ground"),nZ=Ft("within"),rZ=Ft("awayby"),iZ=Ft("elements"),sZ=fi({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:Ta}),oZ=Ft("contact"),aZ=Ft("blocked"),cZ=Ft("any"),lZ=Ft("countof"),uZ=Ft("abs"),hZ=Ft("intceil"),fZ=Ft("intfloor"),dZ=Ft("intround"),pZ=Ft("clamp"),mZ=Ft("min"),gZ=Ft("max"),_Z=Ft("pick"),vZ=Ft("pickwith"),yZ=Ft("random"),bZ=Ft("randomwith"),SZ=Ft("run"),EZ=Ft("runwith"),xZ=fi({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),c6=fi({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:Ta}),l6=fi({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:Ta}),u6=fi({name:"islessthan",pattern:/<|below/i,longer_alt:Ta}),h6=fi({name:"isgreaterthan",pattern:/>|above/i,longer_alt:Ta}),f6=fi({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:Ta}),d6=fi({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:Ta}),IM=fi({name:"or",pattern:/or/i,longer_alt:Ta}),NM=fi({name:"not",pattern:/not/i,longer_alt:Ta}),PM=fi({name:"and",pattern:/and/i,longer_alt:Ta}),DM=fi({name:"plus",pattern:/\+/}),LM=fi({name:"minus",pattern:/-/}),p6=fi({name:"power",pattern:/\*\*/}),m6=fi({name:"multiply",pattern:/\*/}),q1=fi({name:"divide",pattern:/\//}),g6=fi({name:"moddivide",pattern:/%/}),_6=fi({name:"floordivide",pattern:/%%/}),sA=fi({name:"query",pattern:/\?/}),v6=fi({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),y6=fi({name:"rparen",pattern:/\)/,pop_mode:!0}),b6=fi({name:"command_play",pattern:/(play|bgplay|bgplayon64n|bgplayon32n|bgplayon16n|bgplayon8n|bgplayon4n|bgplayon2n|bgplayon1n) .*/i,start_chars_hint:QA,longer_alt:Ta}),TZ=fi({name:"command_toast",pattern:/toast .*/i,start_chars_hint:QA,longer_alt:Ta}),wZ=fi({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:QA,longer_alt:Ta}),Y1=fi({name:"if",pattern:/if|try|take|give|duplicate/i,longer_alt:Ta}),K1=fi({name:"do",pattern:new RegExp("(?<!(zap |send |restore ))(?<=\\s)do","i"),start_chars_hint:["d"],longer_alt:Ta}),UM=Ft("done"),X1=Ft("else"),S6=Ft("while"),E6=Ft("repeat"),x6=Ft("waitfor"),T6=fi({name:"foreach",pattern:/foreach|for/i,longer_alt:Ta}),w6=Ft("break"),A6=Ft("continue");function AZ(n,e){return[...n,SX,...e,RE,WY,qY,YY,eK,QY,KY,nK,tK,XY,ZY,JY,rK,iK,sK,oK,aK,cK,lK,uK,hK,fK,dK,pK,mK,gK,_K,vK,yK,bK,SK,EK,xK,TK,wK,AK,RK,CK,MK,kK,OK,IK,NK,PK,DK,LK,UK,BK,FK,jK,zK,HK,VK,GK,$K,WK,qK,YK,KK,XK,ZK,JK,QK,eX,tX,nX,rX,iX,sX,oX,aX,cX,lX,uX,hX,fX,dX,pX,mX,gX,_X,vX,yX,bX,EX,xX,TX,wX,AX,RX,PX,CX,MX,kX,OX,IX,NX,nZ,rZ,iZ,DX,LX,UX,BX,FX,HX,$X,YX,ZX,QX,eZ,tZ,sZ,oZ,aZ,cZ,lZ,uZ,hZ,fZ,dZ,pZ,mZ,gZ,vZ,_Z,bZ,yZ,EZ,SZ,xZ,c6,l6,f6,u6,d6,h6,IM,NM,PM,DM,LM,p6,m6,q1,_6,g6,sA,v6,y6,jX,zX,VX,GX,WX,qX,KX,XX,JX,Iw,Ta]}const RZ=AZ([nA,hb,b6,TZ,wZ,Fg,rA,hx,iA,a6,tA,VY],[w6,A6,UM,K1,X1,T6,Y1,E6,x6,S6]),oxe=new ll({defaultMode:"use_newlines",modes:{use_newlines:RZ,ignore_newlines:AZ([GY],[])}},{skipValidations:!r0,ensureOptimizations:r0,positionTracking:"full"});function CZ(n){$Y=!0;const e=oxe.tokenize(n||` 
`),[t]=(Xn(e.tokens)?e.tokens:[]).slice(-1);return t&&t.tokenType.name!=="Newline"&&e.tokens.push(XA(tA,`
`,t.startOffset,t.endOffset??NaN,t.startLine??NaN,t.endLine??NaN,t.startColumn??NaN,t.endColumn??NaN)),e}function mo(n){return`${n??""}`}function j1(n,e){const t=parseFloat(mo(n));return isNaN(t)?e:t}function _p(n,e){return typeof n==typeof e?n:e}function IL(n,e,t=!0){if(t){const[r,...i]=e;switch(Jn(r??"")){default:return{type:Pn.OBJECT,values:e};case"loader":return{type:Pn.LOADER,values:i};case"board":return{type:Pn.BOARD,values:i};case"object":return{type:Pn.OBJECT,values:i};case"terrain":return{type:Pn.TERRAIN,values:i};case"charset":return{type:Pn.CHARSET,values:i};case"palette":return{type:Pn.PALETTE,values:i}}}else{const[r,i,...s]=e,o=Jn(i??""),a=[r,n,...s];switch(o){default:return{type:Pn.CONST,values:e};case"rn":case"range":return{type:Pn.RANGE,values:a};case"sl":case"select":return{type:Pn.SELECT,values:a};case"nm":case"number":return{type:Pn.NUMBER,values:a};case"tx":case"text":return{type:Pn.TEXT,values:a};case"hk":case"hotkey":return{type:Pn.HOTKEY,values:a};case"copyit":return{type:Pn.COPYIT,values:a};case"openit":return{type:Pn.OPENIT,values:a};case"viewit":return{type:Pn.VIEWIT,values:a};case"runit":return{type:Pn.RUNIT,values:a};case"zssedit":return{type:Pn.ZSSEDIT,values:a};case"charedit":return{type:Pn.CHAREDIT,values:a};case"coloredit":return{type:Pn.COLOREDIT,values:a}}}}function Ev(n){switch(n){case Pn.LOADER:return"loader";case Pn.BOARD:return"board";case Pn.OBJECT:return"object";case Pn.TERRAIN:return"terrain";case Pn.CHARSET:return"charset";case Pn.PALETTE:return"palette";case Pn.CONST:return"const";case Pn.RANGE:return"range";case Pn.SELECT:return"select";case Pn.NUMBER:return"number";case Pn.TEXT:return"text";case Pn.HOTKEY:return"hotkey";case Pn.COPYIT:return"copyit";case Pn.OPENIT:return"openit";case Pn.VIEWIT:return"viewit";case Pn.RUNIT:return"runit";case Pn.ZSSEDIT:return"zssedit";case Pn.CHAREDIT:return"charedit";case Pn.COLOREDIT:return"coloredit"}}function NL(n,e){const t=Object.keys(n);for(let r=0;r<t.length;++r){const i=t[r],s=n[i];if(Xn(s)){const[o,...a]=s;switch(o){case"text":fe(e[i])||(e[i]="");break;case"range":fe(e[i])||(e[i]=4);break;case"number":fe(e[i])||(e[i]=0);break;case"select":if(!fe(e[i])){const[,c]=a;e[i]=c}break}continue}switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"cycle":case"stepx":case"stepy":case"shootx":case"shooty":case"displaychar":e[i]=s;break;case"color":case"bg":case"lightdir":case"displaycolor":case"displaybg":e[i]=MZ(s)??s;break;case"isitem":e.item=1;break;case"notitem":e.item=0;break;case"ispushable":e.pushable=s===""?1:s;break;case"notpushable":e.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=kn.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=kn.ISSWIM;break;case"issolid":e.collision=kn.ISSOLID;break;case"isbullet":e.collision=kn.ISBULLET;break;case"isghost":e.collision=kn.ISGHOST;break;case"isbreakable":e.breakable=1;break;case"notbreakable":e.breakable=0;break}}}function oA(n){if(fe(n))switch(i0(n)){default:return;case Wr.ERROR:return n.code??"";case Wr.LOADER:return n.code??"";case Wr.BOARD:{fe(n.board)||(n.board=aU()),n.board.id=n.id,n.board.name=Tc(n);const e=jT(n),t=Object.keys(e);for(let r=0;r<t.length;++r){const i=t[r],s=e[i];switch(i){case"isdark":n.board.isdark=1;break;case"notdark":n.board.isdark=0;break;case"restartonzap":n.board.restartonzap=1;break;case"norestartonzap":n.board.restartonzap=0;break;case"startx":case"starty":case"facing":case"timelimit":case"maxplayershots":Xt(s)&&(n.board[i]=s);break;case"over":case"under":case"camera":case"graphics":case"charset":case"palette":case"exitnorth":case"exitsouth":case"exitwest":case"exiteast":rn(s)&&(Jn(s)==="empty"?n.board[i]=void 0:n.board[i]=s);break;case"b1":case"b2":case"b3":case"b4":case"b5":case"b6":case"b7":case"b8":case"b9":case"b10":fe(s)&&(n.board[i]=MZ(s)??s);break}}return n.board}case Wr.OBJECT:return fe(n.object)||(n.object=K9()),n.object.id=n.id,n.object.code=n.code,n.object.name=Tc(n),n.object.category=sb.ISOBJECT,NL(jT(n),n.object),n.object;case Wr.TERRAIN:return fe(n.terrain)||(n.terrain=K9()),n.terrain.id=n.id,n.terrain.name=Tc(n),n.terrain.category=sb.ISTERRAIN,NL(jT(n),n.terrain),n.terrain;case Wr.PALETTE:{if(fe(n.palette)||(n.palette=Cb(Ob)),fe(n.palette?.bits)){const e=jT(n),t=n0(e);for(let r=0;r<t.length;++r){const i=t[r].toLowerCase(),s=e[i];if(i.startsWith("color")&&rn(s)){const o=parseFloat(i.replace("color",""));if(o>=0&&o<=15){w2.set(s);const a=o*Kw,c=w2.r*63,l=w2.g*63,u=w2.b*63;n.palette.bits[a+0]=Ri(c,0,63),n.palette.bits[a+1]=Ri(l,0,63),n.palette.bits[a+2]=Ri(u,0,63)}}}}return n.palette}case Wr.CHARSET:{if(fe(n.charset)||(n.charset=Mb(kb)),fe(n.charset?.bits)){const e=jT(n),t=n0(e);for(let r=0;r<t.length;++r){const i=t[r].toLowerCase(),s=e[i];if(i.startsWith("char")&&rn(s)){const o=parseFloat(i.replace("char",""));if(o>=0&&o<=255){const c=[];for(let l=0;l<112;++l)switch(s[l]){case"-":case void 0:c.push(0);break;default:c.push(128);break}Ape(Uint8Array.from(c),n.charset,o)}}}}return n.charset}}}function Tc(n){return eR(n).name??""}function axe(n,e){return eR(n)[e]}const w2=new gi;function MZ(n){if(!rn(n))return;const e=Ex(n);if(fe(e)&&fe(Bt[e]))return Bt[e];const t=Jn(n),r=hn[t];if(fe(r))return r}function jT(n){const e={...eR(n)};return Object.keys(e).forEach(t=>{switch(t){case"type":case"name":delete e[t];break}}),e}function eR(n){return fe(n)?(fe(n.stats?.type)||(n.stats=kZ(n.code),fe(n.stats.type)||(n.stats.type=Wr.OBJECT)),n.stats):{}}function kZ(n){const e=CZ(n),t={};let r=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===hb){const o=s.image.slice(1),[a,c]=o.split(";").map(f=>f.trim()),l=a.split(" "),u=IL(rn(c)?c:"",l,r),h=u.values.join(" ");switch(r=!1,u.type){case Pn.LOADER:t.type=Wr.LOADER,t.name=h;break;case Pn.BOARD:t.type=Wr.BOARD,t.name=h;break;case Pn.OBJECT:t.type=Wr.OBJECT,t.name=h||"object";break;case Pn.TERRAIN:t.type=Wr.TERRAIN,t.name=h;break;case Pn.CHARSET:t.type=Wr.CHARSET,t.name=h;break;case Pn.PALETTE:t.type=Wr.PALETTE,t.name=h;break;case Pn.CONST:{const[f,...d]=u.values;if(rn(f)){const p=Jn(f),_=d.join(" ");if(rn(_)){const g=parseFloat(_);Xt(g)?t[p]=g:t[p]=`${mo(t[p])}${_}`}else t[p]=1}break}case Pn.RANGE:case Pn.SELECT:case Pn.NUMBER:case Pn.TEXT:case Pn.HOTKEY:case Pn.ZSSEDIT:case Pn.CHAREDIT:case Pn.COLOREDIT:{const[f,...d]=u.values;if(rn(f)){const p=Jn(f);t[p]=[Ev(u.type),...d]}break}}}}return t}function i0(n){return eR(n).type??Wr.ERROR}function h1(n){return OZ(i0(n))}function OZ(n){switch(n){default:case Wr.ERROR:return"error";case Wr.LOADER:return Ev(Pn.LOADER);case Wr.BOARD:return Ev(Pn.BOARD);case Wr.OBJECT:return Ev(Pn.OBJECT);case Wr.TERRAIN:return Ev(Pn.TERRAIN);case Wr.CHARSET:return Ev(Pn.CHARSET);case Wr.PALETTE:return Ev(Pn.PALETTE)}}function cxe(n,e){return{id:Ko(),code:n,...e}}function IZ(n,e){const t=aA(n,e);if(fe(n)&&fe(t)){const r=Jn(e);return n.pages=n.pages.filter(i=>i.id!==e&&r!==Tc(i)),NZ(n),t}}function lxe(n,e){n&&delete n.flags[e]}function zu(n,e=1,t=Bt.WHITE,r=Bt.BLACK){const i=n?.kinddata;return{name:Jn(n?.name??i?.name),char:n?.displaychar??i?.displaychar??n?.char??i?.char??e,color:n?.displaycolor??i?.displaycolor??n?.color??i?.color??t,bg:n?.displaybg??i?.displaybg??n?.bg??i?.bg??r,light:n?.light??i?.light??0}}function uxe(n,e,t){let r=hxe(n,e,t);if(!fe(r)){const i=OZ(e);return r=cxe(i==="object"?`@${t||"object"}
`:`@${i} ${t}
`,{}),dxe(n,r),[r,!0]}return[r,!1]}function aA(n,e){if(!fe(n))return;const t=Jn(e);return n.pages.find(i=>i.id===e||t===Tc(i))}function PL(n,e,t){if(!fe(n))return[];const r=Jn(t);return n.pages.filter(s=>i0(s)===e).filter(s=>{const o=eR(s),a=Jn(Tc(s));return s.id===t||r===a||fe(o[t])})}function hxe(n,e,t){if(!fe(n))return;const r=Jn(t);return n.pages.find(s=>i0(s)===e&&(s.id===t||r===Tc(s)))}function BM(n,e,t){return R6(n,e)?.[t]}function R6(n,e){return n?(n.flags[e]=n.flags[e]??{},n.flags[e]):{}}function zT(n){return fe(n)?Us(n.pages).sort((t,r)=>{const i=i0(t),s=i0(r);return i===s?Tc(t).localeCompare(Tc(r)):s-i}):[]}function fxe(n){fe(n)&&(n.name=s6())}function NZ(n){fe(n)&&(n.token=`${KEe()}${Nu(1111,9999)}`)}function dxe(n,e){if(!fe(n)||!fe(e))return!1;const t=aA(n,e.id);return fe(t)?!1:(n.pages.push(e),NZ(n),!0)}function DL(n,e,t,r){const i=R6(n,e);return i&&(i[t]=r),r}function PZ(n){return{id:Ko(),name:s6(),timestamp:0,activelist:[],pages:n,flags:{}}}const pxe=80,tR=1e3/pxe,mxe=3;function Mh(n){return new Promise(e=>setTimeout(e,n))}const Op={session:Ko(),operator:"",software:{main:"",temp:""},books:new Map};function Wm(){return Op.operator}function Pm(){return[...Op.books.values()]}function gxe(){const[n]=Op.books.values();return n}function kv(n){const e=Jn(n);return Op.books.get(n)??Pm().find(t=>t.name===e)}function DZ(n,e){fe(kv(e))&&(Op.software[n]=e)}function zm(n){return kv(Op.software[n])}function _xe(n){const e=PZ([]);return rn(n)&&(e.name=n),LZ(e),Qi(Ke,Op.operator,`created [book] ${e.name}`),e}function vxe(n){let e=kv(n);return fe(e)||(e=PZ([]),e.name=n),LZ(e),Qi(Ke,Op.operator,`created [book] ${e.name}`),e}function Ov(n,e){let t=fe(e)?vxe(e):zm(n);return fe(t)||(fe(t)||(t=gxe()),fe(t)||(t=_xe(e)),fe(t)&&Qi(Ke,Op.operator,`opened [book] ${t.name} for ${n}`)),DZ(n,t.id),t}function yxe(n,e,t){return uxe(Ov(n),t,e)}function Lu(n,e){const t=zm(xc.MAIN),r=md(PL(t,n,e));if(fe(r))return r;const i=Pm();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==t?.id){const a=md(PL(o,n,e));if(fe(a))return a}}}function Ep(n){if(fe(n?.kinddata))return n.kinddata;if(!rn(n?.kind)||!n.kind)return;const e=Lu(Wr.OBJECT,n.kind);if(fe(e))return n.kinddata=oA(e),n.kinddata;const t=Lu(Wr.TERRAIN,n.kind);if(fe(t))return n.kinddata=oA(t),n.kinddata}function Zr(n,e){const t=n?.kinddata,r=t?.id??"",i=n?.[e];if(fe(i))return i;const s=t?.[e];if(fe(s))return s;const o=Lu(Wr.OBJECT,r)??Lu(Wr.TERRAIN,r),a=axe(o,e);if(fe(a))return a;switch(e){case"group":return"";case"cycle":return mxe;case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"item":case"pushable":case"breakable":return 0;case"collision":return kn.ISWALK;default:return}}function LL(n,e){const t={x:n?.x??-1,y:n?.y??-1},r={x:e?.x??-1,y:e?.y??-1},i=fp(t,r),s=Zr(e,"pushable");return Xt(s)?s!==0:rn(s)?s.trim().split(" ").map(o=>zY(JA(o))).some(o=>o===i):!1}function wd(n,e,t,r){if(!fe(n)||!fe(e))return;const[i,s]=e,o=Lu(Wr.OBJECT,i);if(fe(o)){const c=LQ(n,t,i,r);if(fe(c))return W1(c,s),Ep(c),UZ(n,c),UL(n,c),c}const a=Lu(Wr.TERRAIN,i);if(fe(a)){const c=bDe(n,t,i);if(fe(c)){W1(c,s),Ep(c);const l=bd(t,dn);return UL(n,c,l),c}}}function bxe(n,e,t){if(!fe(n)||!fe(e))return;const[r,i]=e,s=Lu(Wr.OBJECT,r);if(fe(s)){const o=LQ(n,t,r);return W1(o,i),o}}function vs(n){const e=Lu(Wr.BOARD,n);return oA(e)}function Kg(n){const e=Ov(xc.MAIN);return R6(e,n)}function Sxe(n){const e=Ov(xc.MAIN);return lxe(e,n)}function LZ(n){return Op.books.set(n.id,n),n.id}function Exe(n){const e=kv(n);e&&Op.books.delete(e.id)}function Rc(n){if(!fe(n))return;for(let t=0;t<n.terrain.length;++t)Ep(n.terrain[t]);const e=Object.keys(n.objects);for(let t=0;t<e.length;++t){const r=e[t];Ep(n.objects[r])}xxe(n)}function UL(n,e,t){if(!fe(n)||!fe(n.named)||!fe(e))return;const r=Jn(e.name??e.kinddata?.name??"");n.named[r]||(n.named[r]=new Set),n.named[r].add(e?.id??t??"")}function UZ(n,e){if(!(!fe(n)||!fe(n.lookup)||!fe(e?.id))&&!fe(e.removed)&&Zr(e,"collision")!==kn.ISGHOST){const t=e.x??0,r=e.y??0;n.lookup[t+r*dn]=e.id}}function C6(n,e){if(fe(n)&&fe(e?.id)){if(fe(n.lookup)&&fe(e.x)&&fe(e.y)){const r=e.x+e.y*dn;n.lookup[r]===e.id&&(n.lookup[r]=void 0)}const t=zu(e);fe(n.named?.[t.name])&&fe(e.id)&&n.named[t.name].delete(e.id)}}function xxe(n){fe(n)&&(delete n.named,delete n.lookup,Txe(n))}function Txe(n){if(!fe(n)||fe(n.lookup)&&fe(n.named))return;const e=new Array(dn*_r).fill(void 0),t={},r=Object.values(n.objects);for(let o=0;o<r.length;++o){const a=r[o];if(fe(a.x)&&fe(a.y)&&fe(a.id)&&!fe(a.removed)){a.category=sb.ISOBJECT,Zr(a,"collision")!==kn.ISGHOST&&(e[a.x+a.y*dn]=a.id),rn(a.code)&&!fe(a.name)&&NL(kZ(a.code),a);const c=zu(a);t[c.name]||(t[c.name]=new Set),t[c.name].add(a.id)}}let i=0,s=0;for(let o=0;o<n.terrain.length;++o){const a=n.terrain[o];if(fe(a)){a.x=i,a.y=s,a.category=sb.ISTERRAIN;const c=zu(Ep(a));t[c.name]||(t[c.name]=new Set),t[c.name].add(o)}++i,i>=dn&&(i=0,++s)}n.lookup=e,n.named=t}function wxe(n,e){if(fe(n)&&fe(e?.x)&&fe(e.y)){const t=zu(e),r=yA(n,e);fe(n.named?.[t.name])&&n.named[t.name].delete(r)}}var kC={exports:{}},OC={exports:{}},Axe=OC.exports,X9;function Rxe(){return X9||(X9=1,(function(n,e){(function(t,r){n.exports=r()})(Axe,function(){function t(_){return!isNaN(parseFloat(_))&&isFinite(_)}function r(_){return _.charAt(0).toUpperCase()+_.substring(1)}function i(_){return function(){return this[_]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function h(_){if(_)for(var g=0;g<u.length;g++)_[u[g]]!==void 0&&this["set"+r(u[g])](_[u[g]])}h.prototype={getArgs:function(){return this.args},setArgs:function(_){if(Object.prototype.toString.call(_)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=_},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(_){if(_ instanceof h)this.evalOrigin=_;else if(_ instanceof Object)this.evalOrigin=new h(_);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var _=this.getFileName()||"",g=this.getLineNumber()||"",m=this.getColumnNumber()||"",b=this.getFunctionName()||"";return this.getIsEval()?_?"[eval] ("+_+":"+g+":"+m+")":"[eval]:"+g+":"+m:b?b+" ("+_+":"+g+":"+m+")":_+":"+g+":"+m}},h.fromString=function(g){var m=g.indexOf("("),b=g.lastIndexOf(")"),y=g.substring(0,m),x=g.substring(m+1,b).split(","),T=g.substring(b+1);if(T.indexOf("@")===0)var k=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(T,""),R=k[1],P=k[2],B=k[3];return new h({functionName:y,args:x||void 0,fileName:R,lineNumber:P||void 0,columnNumber:B||void 0})};for(var f=0;f<s.length;f++)h.prototype["get"+r(s[f])]=i(s[f]),h.prototype["set"+r(s[f])]=(function(_){return function(g){this[_]=!!g}})(s[f]);for(var d=0;d<o.length;d++)h.prototype["get"+r(o[d])]=i(o[d]),h.prototype["set"+r(o[d])]=(function(_){return function(g){if(!t(g))throw new TypeError(_+" must be a Number");this[_]=Number(g)}})(o[d]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=(function(_){return function(g){this[_]=String(g)}})(a[p]);return h})})(OC)),OC.exports}var Cxe=kC.exports,Z9;function Mxe(){return Z9||(Z9=1,(function(n,e){(function(t,r){n.exports=r(Rxe())})(Cxe,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=h.match(/ (\(.+\)$)/);h=f?h.replace(f[0],""):h;var d=this.extractLocation(f?f[1]:h),p=f&&h||void 0,_=["eval","<anonymous>"].indexOf(d[0])>-1?void 0:d[0];return new r({functionName:p,fileName:_,lineNumber:d[1],columnNumber:d[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=u.match(h),d=f&&f[1]?f[1]:void 0,p=this.extractLocation(u.replace(h,""));return new r({functionName:d,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],f=2,d=u.length;f<d;f+=2){var p=l.exec(u[f]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:u[f]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],f=0,d=u.length;f<d;f+=2){var p=l.exec(u[f]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[f]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),f=this.extractLocation(h.pop()),d=h.shift()||"",p=d.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,_;d.match(/\(([^)]*)\)/)&&(_=d.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var g=_===void 0||_==="[arguments not available]"?void 0:_.split(",");return new r({functionName:p,args:g,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:u})},this)}}})})(kC)),kC.exports}var kxe=Mxe();const Oxe=Dl(kxe);function d_(n){const e={},t={everytick(){},aftertick(){},listcommands(){return n0(e)},...n,getcommand(r){return e[r]},command(r,i){return e[r]=i,t}};return t}let J9=0;const Q9=r0,Ixe=["Command","lines"];class Nxe extends Ube{constructor(){super(RZ,{traceInitPerf:r0,skipValidations:!r0,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"}),this.performSelfAnalysis()}PEEK(e,t,...r){console.info(e,r.map(i=>[i.image,i.tokenType]),t)}RULED(e,t,r){const i=Ixe.some(s=>e.includes(s));return this.RULE(e,()=>{const o=(J9++).toString().padStart(3),a=i?"font-weight: bold;":"";if(Q9&&!this.RECORDING_PHASE){const c=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${o}%c> ${e} ${c.join(" ")}`,a)}t(),Q9&&!this.RECORDING_PHASE&&console.info(`${o}%c< ${e} `,a),J9--},r)}program=this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))});line=this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(tA)}])});stmt=this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])});inline_go=this.RULED("inline_go",()=>{this.SUBRULE(this.short_go),this.OPTION(()=>this.SUBRULE(this.inline))});inline_try=this.RULED("inline_try",()=>{this.SUBRULE(this.short_try),this.OPTION(()=>this.SUBRULE(this.inline))});inline_command=this.RULED("inline_command",()=>{this.SUBRULE(this.stmt_command),this.OPTION(()=>this.SUBRULE(this.inline))});inline=this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.structured_cmd)},{ALT:()=>this.SUBRULE(this.inline_go)},{ALT:()=>this.SUBRULE(this.inline_try)},{ALT:()=>this.SUBRULE(this.inline_command)}])});stmt_label=this.RULED("stmt_label",()=>{this.CONSUME(hx)});stmt_stat=this.RULED("stmt_stat",()=>{this.CONSUME(hb)});stmt_text=this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(nA)}])});stmt_comment=this.RULED("stmt_comment",()=>{this.CONSUME(rA)});stmt_hyperlink=this.RULED("stmt_hyperlink",()=>{this.CONSUME(iA),this.CONSUME(a6)});stmt_command=this.RULED("stmt_command",()=>{this.CONSUME(Fg),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])});structured_cmd=this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])});short_go=this.RULED("short_go",()=>{this.CONSUME(q1),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])});short_try=this.RULED("short_try",()=>{this.CONSUME(sA),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])});command_if=this.RULED("command_if",()=>{this.CONSUME(Y1),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))});command_if_block=this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(K1),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(tA)),this.CONSUME4(Fg),this.CONSUME4(UM)}}])});command_block=this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(K1),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Fg),this.CONSUME(UM)}}])});command_fork=this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(K1),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])});command_else_if=this.RULED("command_else_if",()=>{this.CONSUME(Fg),this.CONSUME(X1),this.CONSUME(Y1),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))});command_else=this.RULED("command_else",()=>{this.CONSUME(Fg),this.CONSUME(X1),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))});command_while=this.RULED("command_while",()=>{this.CONSUME(S6),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_repeat=this.RULED("command_repeat",()=>{this.CONSUME(E6),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_waitfor=this.RULED("command_waitfor",()=>{this.CONSUME(x6),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_foreach=this.RULED("command_foreach",()=>{this.CONSUME(T6),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_break=this.RULED("command_break",()=>{this.CONSUME(w6)});command_continue=this.RULED("command_continue",()=>{this.CONSUME(A6)});command_play=this.RULED("command_play",()=>{this.CONSUME(b6)});command_toast=this.RULED("command_toast",()=>{this.CONSUME(TZ)});command_ticker=this.RULED("command_ticker",()=>{this.CONSUME(wZ)});expr=this.RULED("expr",()=>{this.SUBRULE1(this.and_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(IM),this.SUBRULE2(this.and_test,{LABEL:"RHS"})})});and_test=this.RULED("and_test",()=>{this.SUBRULE1(this.not_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(PM),this.SUBRULE2(this.not_test,{LABEL:"RHS"})})});not_test=this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(NM),this.SUBRULE1(this.not_test,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.comparison)}])});comparison=this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr,{LABEL:"LHS"}),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr,{LABEL:"RHS"})})});comp_op=this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(c6)},{ALT:()=>this.CONSUME(l6)},{ALT:()=>this.CONSUME(u6)},{ALT:()=>this.CONSUME(h6)},{ALT:()=>this.CONSUME(f6)},{ALT:()=>this.CONSUME(d6)}])});expr_value=this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(IM),this.SUBRULE2(this.and_test_value,{LABEL:"RHS"})})});and_test_value=this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(PM),this.SUBRULE2(this.not_test_value,{LABEL:"RHS"})})});not_test_value=this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(NM),this.SUBRULE1(this.not_test_value,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])});arith_expr=this.RULED("arith_expr",()=>{this.OR([{ALT:()=>this.SUBRULE(this.token_expr,{LABEL:"LHS"})},{ALT:()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item,{LABEL:"RHS"}))}}])});arith_expr_item=this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(DM)},{ALT:()=>this.CONSUME(LM)}]),this.SUBRULE(this.term)});term=this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))});term_item=this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(m6)},{ALT:()=>this.CONSUME(q1)},{ALT:()=>this.CONSUME(g6)},{ALT:()=>this.CONSUME(_6)}]),this.SUBRULE(this.factor)});factor=this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(DM)},{ALT:()=>this.CONSUME(LM)}]),this.SUBRULE(this.factor,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE(this.power)}])});power=this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(p6),this.SUBRULE(this.factor)})});words=this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))});kind=this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)});category=this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(WY)},{ALT:()=>this.CONSUME(qY)}])});collision=this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(YY)},{ALT:()=>this.CONSUME(KY)},{ALT:()=>this.CONSUME(XY)},{ALT:()=>this.CONSUME(ZY)},{ALT:()=>this.CONSUME(JY)},{ALT:()=>this.CONSUME(QY)},{ALT:()=>this.CONSUME(eK)},{ALT:()=>this.CONSUME(tK)},{ALT:()=>this.CONSUME(nK)}])});color=this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(rK)},{ALT:()=>this.CONSUME(iK)},{ALT:()=>this.CONSUME(sK)},{ALT:()=>this.CONSUME(oK)},{ALT:()=>this.CONSUME(aK)},{ALT:()=>this.CONSUME(cK)},{ALT:()=>this.CONSUME(lK)},{ALT:()=>this.CONSUME(uK)},{ALT:()=>this.CONSUME(hK)},{ALT:()=>this.CONSUME(fK)},{ALT:()=>this.CONSUME(dK)},{ALT:()=>this.CONSUME(pK)},{ALT:()=>this.CONSUME(mK)},{ALT:()=>this.CONSUME(gK)},{ALT:()=>this.CONSUME(_K)},{ALT:()=>this.CONSUME(vK)},{ALT:()=>this.CONSUME(yK)},{ALT:()=>this.CONSUME(bK)},{ALT:()=>this.CONSUME(SK)},{ALT:()=>this.CONSUME(EK)},{ALT:()=>this.CONSUME(xK)},{ALT:()=>this.CONSUME(TK)},{ALT:()=>this.CONSUME(wK)},{ALT:()=>this.CONSUME(AK)},{ALT:()=>this.CONSUME(RK)},{ALT:()=>this.CONSUME(CK)},{ALT:()=>this.CONSUME(MK)},{ALT:()=>this.CONSUME(kK)},{ALT:()=>this.CONSUME(OK)},{ALT:()=>this.CONSUME(IK)},{ALT:()=>this.CONSUME(NK)},{ALT:()=>this.CONSUME(PK)},{ALT:()=>this.CONSUME(DK)},{ALT:()=>this.CONSUME(LK)},{ALT:()=>this.CONSUME(UK)},{ALT:()=>this.CONSUME(BK)},{ALT:()=>this.CONSUME(FK)},{ALT:()=>this.CONSUME(jK)},{ALT:()=>this.CONSUME(zK)},{ALT:()=>this.CONSUME(HK)},{ALT:()=>this.CONSUME(VK)},{ALT:()=>this.CONSUME(GK)},{ALT:()=>this.CONSUME($K)},{ALT:()=>this.CONSUME(WK)},{ALT:()=>this.CONSUME(qK)},{ALT:()=>this.CONSUME(YK)},{ALT:()=>this.CONSUME(KK)},{ALT:()=>this.CONSUME(XK)},{ALT:()=>this.CONSUME(ZK)},{ALT:()=>this.CONSUME(JK)},{ALT:()=>this.CONSUME(QK)},{ALT:()=>this.CONSUME(eX)},{ALT:()=>this.CONSUME(tX)},{ALT:()=>this.CONSUME(nX)},{ALT:()=>this.CONSUME(rX)},{ALT:()=>this.CONSUME(iX)},{ALT:()=>this.CONSUME(sX)},{ALT:()=>this.CONSUME(oX)},{ALT:()=>this.CONSUME(aX)},{ALT:()=>this.CONSUME(cX)},{ALT:()=>this.CONSUME(lX)},{ALT:()=>this.CONSUME(uX)},{ALT:()=>this.CONSUME(hX)},{ALT:()=>this.CONSUME(fX)},{ALT:()=>this.CONSUME(dX)},{ALT:()=>this.CONSUME(pX)},{ALT:()=>this.CONSUME(mX)},{ALT:()=>this.CONSUME(gX)},{ALT:()=>this.CONSUME(_X)},{ALT:()=>this.CONSUME(vX)}])});dir_mod=this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(OX)},{ALT:()=>this.CONSUME(IX)},{ALT:()=>this.CONSUME(NX)},{ALT:()=>this.CONSUME(PX)},{ALT:()=>this.CONSUME(QX)},{ALT:()=>this.CONSUME(eZ)},{ALT:()=>this.CONSUME(tZ)},{ALT:()=>this.SUBRULE(this.dir_within)},{ALT:()=>this.SUBRULE(this.dir_awayby)},{ALT:()=>this.CONSUME(iZ)}])});dir_by=this.RULED("dir_by",()=>{this.CONSUME(TX),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_at=this.RULED("dir_at",()=>{this.CONSUME(wX),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_away=this.RULED("dir_away",()=>{this.CONSUME(DX),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_toward=this.RULED("dir_toward",()=>{this.CONSUME(LX),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_find=this.RULED("dir_find",()=>{this.CONSUME(UX),this.OR([{ALT:()=>this.SUBRULE(this.kind)},{ALT:()=>this.CONSUME(RE)}])});dir_flee=this.RULED("dir_flee",()=>{this.CONSUME(BX),this.OR([{ALT:()=>this.SUBRULE(this.kind)},{ALT:()=>this.CONSUME(RE)}])});dir_to=this.RULED("dir_to",()=>{this.CONSUME(FX),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)});dir_within=this.RULED("dir_within",()=>{this.CONSUME(nZ),this.SUBRULE1(this.simple_token)});dir_awayby=this.RULED("dir_awayby",()=>{this.CONSUME(rZ),this.SUBRULE1(this.simple_token)});dir=this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(yX)},{ALT:()=>this.CONSUME(bX)},{ALT:()=>this.CONSUME(SX)},{ALT:()=>this.CONSUME(EX)},{ALT:()=>this.CONSUME(xX)},{ALT:()=>this.SUBRULE(this.dir_by)},{ALT:()=>this.SUBRULE(this.dir_at)},{ALT:()=>this.SUBRULE(this.dir_away)},{ALT:()=>this.SUBRULE(this.dir_toward)},{ALT:()=>this.CONSUME(AX)},{ALT:()=>this.CONSUME(RX)},{ALT:()=>this.CONSUME(CX)},{ALT:()=>this.CONSUME(MX)},{ALT:()=>this.CONSUME(kX)},{ALT:()=>this.SUBRULE(this.dir_find)},{ALT:()=>this.SUBRULE(this.dir_flee)},{ALT:()=>this.SUBRULE(this.dir_to)},{ALT:()=>this.CONSUME(jX)},{ALT:()=>this.CONSUME(zX)},{ALT:()=>this.CONSUME(HX)},{ALT:()=>this.CONSUME(VX)},{ALT:()=>this.CONSUME(GX)},{ALT:()=>this.CONSUME($X)},{ALT:()=>this.CONSUME(WX)},{ALT:()=>this.CONSUME(qX)},{ALT:()=>this.CONSUME(YX)},{ALT:()=>this.CONSUME(KX)},{ALT:()=>this.CONSUME(XX)},{ALT:()=>this.CONSUME(ZX)},{ALT:()=>this.CONSUME(JX)}])});expr_any=this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])});token_expr_any=this.RULED("token_expr_any",()=>{this.CONSUME(cZ),this.SUBRULE(this.expr_any)});token_expr_count=this.RULED("token_expr_count",()=>{this.CONSUME(lZ),this.SUBRULE(this.expr_any)});token_expr_blocked=this.RULED("token_expr_blocked",()=>{this.CONSUME(aZ),this.SUBRULE(this.dir)});token_expr_abs=this.RULED("token_expr_abs",()=>{this.CONSUME(uZ),this.SUBRULE(this.simple_token)});token_expr_intceil=this.RULED("token_expr_intceil",()=>{this.CONSUME(hZ),this.SUBRULE(this.simple_token)});token_expr_intfloor=this.RULED("token_expr_intfloor",()=>{this.CONSUME(fZ),this.SUBRULE(this.simple_token)});token_expr_intround=this.RULED("token_expr_intround",()=>{this.CONSUME(dZ),this.SUBRULE(this.simple_token)});token_expr_clamp=this.RULED("token_expr_clamp",()=>{this.CONSUME(pZ),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)});token_expr_min=this.RULED("token_expr_min",()=>{this.CONSUME(mZ),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_max=this.RULED("token_expr_max",()=>{this.CONSUME(gZ),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_pick=this.RULED("token_expr_pick",()=>{this.CONSUME(_Z),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_pickwith=this.RULED("token_expr_pickwith",()=>{this.CONSUME(vZ),this.SUBRULE1(this.simple_token),this.AT_LEAST_ONE(()=>this.SUBRULE2(this.simple_token))});token_expr_random=this.RULED("token_expr_random",()=>{this.CONSUME(yZ),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))});token_expr_randomwith=this.RULED("token_expr_randomwith",()=>{this.CONSUME(bZ),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))});token_expr_run=this.RULED("token_expr_run",()=>{this.CONSUME(SZ),this.SUBRULE(this.string_token)});token_expr_runwith=this.RULED("token_expr_runwith",()=>{this.CONSUME(EZ),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)});token_expr=this.RULED("token_expr",()=>{this.OR([{ALT:()=>this.CONSUME(sZ)},{ALT:()=>this.CONSUME(oZ)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_blocked)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])});string_token=this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(Ta)},{ALT:()=>this.CONSUME(Iw)}])});simple_token=this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(RE)},{ALT:()=>this.CONSUME(Ta)},{ALT:()=>this.CONSUME(Iw)},{ALT:()=>this.SUBRULE(this.color)}])});token=this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(hx)},{ALT:()=>this.CONSUME(Iw)},{ALT:()=>this.CONSUME(Ta)},{ALT:()=>this.CONSUME(RE)},{ALT:()=>this.CONSUME(xZ)},{ALT:()=>{this.CONSUME(v6),this.SUBRULE(this.expr),this.CONSUME(y6)}}])})}const CE=new Nxe;if(Epe){const n=CE.getGAstProductions(),e=Kbe(n);console.info(e)}const Pxe=CE.getBaseCstVisitorConstructor();var Mn=(n=>(n[n.PROGRAM=0]="PROGRAM",n[n.API=1]="API",n[n.LINE=2]="LINE",n[n.MARK=3]="MARK",n[n.GOTO=4]="GOTO",n[n.COUNT=5]="COUNT",n[n.TEXT=6]="TEXT",n[n.LABEL=7]="LABEL",n[n.HYPERLINK=8]="HYPERLINK",n[n.STAT=9]="STAT",n[n.MOVE=10]="MOVE",n[n.COMMAND=11]="COMMAND",n[n.LITERAL=12]="LITERAL",n[n.IF=13]="IF",n[n.IF_CHECK=14]="IF_CHECK",n[n.IF_BLOCK=15]="IF_BLOCK",n[n.ELSE_IF=16]="ELSE_IF",n[n.ELSE=17]="ELSE",n[n.WHILE=18]="WHILE",n[n.BREAK=19]="BREAK",n[n.CONTINUE=20]="CONTINUE",n[n.REPEAT=21]="REPEAT",n[n.WAITFOR=22]="WAITFOR",n[n.FOREACH=23]="FOREACH",n[n.OR=24]="OR",n[n.AND=25]="AND",n[n.NOT=26]="NOT",n[n.COMPARE=27]="COMPARE",n[n.COMPARE_ITEM=28]="COMPARE_ITEM",n[n.OPERATOR=29]="OPERATOR",n[n.OPERATOR_ITEM=30]="OPERATOR_ITEM",n[n.EXPR=31]="EXPR",n))(Mn||{}),A1=(n=>(n[n.IS_EQ=0]="IS_EQ",n[n.IS_NOT_EQ=1]="IS_NOT_EQ",n[n.IS_LESS_THAN=2]="IS_LESS_THAN",n[n.IS_GREATER_THAN=3]="IS_GREATER_THAN",n[n.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",n[n.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",n))(A1||{}),wm=(n=>(n[n.EMPTY=0]="EMPTY",n[n.PLUS=1]="PLUS",n[n.MINUS=2]="MINUS",n[n.POWER=3]="POWER",n[n.MULTIPLY=4]="MULTIPLY",n[n.DIVIDE=5]="DIVIDE",n[n.MOD_DIVIDE=6]="MOD_DIVIDE",n[n.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",n[n.UNI_PLUS=8]="UNI_PLUS",n[n.UNI_MINUS=9]="UNI_MINUS",n))(wm||{}),IC=(n=>(n[n.NUMBER=0]="NUMBER",n[n.STRING=1]="STRING",n[n.TEMPLATE=2]="TEMPLATE",n))(IC||{});function Go(n,e){const[t]=n??[];return(t?.image??e).trimStart().replaceAll(/^"|"$/g,"")}class Dxe extends Pxe{unique=0;constructor(){super(),r0&&this.validateVisitor()}visit(e){if(Xn(e)&&(e=e[0]),!!fe(e))return this[e.name](e.children,e.location)}createcodenode(e,t){return[{...t,...e,lineindex:0}]}createstringnode(e,t){return this.createcodenode(e,{type:12,literal:1,value:t})}createtemplatenode(e,t){return this.createcodenode(e,{type:12,literal:2,value:t})}createmarknode(e,t,r){return this.createlinenode(e,this.createcodenode(e,{type:3,id:t,comment:r}))}creategotonode(e,t,r){return this.createlinenode(e,this.createcodenode(e,{type:4,id:t,comment:r}))}createlinenode(e,t){return this.createcodenode(e,{type:2,stmts:t})}createapinode(e,t,r){return this.createlinenode(e,this.createcodenode(e,{type:1,words:r,method:t}))}createlogicnode(e,t,r,i){return this.createlinenode(e,this.createcodenode(e,{type:14,skip:r,words:i,method:t}))}createcountnode(e){return this.createcodenode(e,{type:5,index:this.unique++})}createexprnodeondemand(e,t){return e.length===1?e[0]:this.createcodenode(t,{type:31,words:e})[0]}go(e){return Array.isArray(e)?e.map(t=>this.visit(t)).flat():fe(e)?[this.visit(e)].flat():[]}program(e,t){return this.unique=0,this.createcodenode(t,{type:0,lines:[this.createlinenode(t,this.createcodenode(t,{type:7,active:!0,name:"restart"})),this.go(e.line)].flat()})}line(e){return e.stmt?this.go(e.stmt):[]}stmt(e){return e.stmt_label?this.go(e.stmt_label):e.stmt_stat?this.go(e.stmt_stat):e.stmt_text?this.go(e.stmt_text):e.stmt_comment?this.go(e.stmt_comment):e.stmt_hyperlink?this.go(e.stmt_hyperlink):e.stmt_command?this.go(e.stmt_command):e.short_go?this.go(e.short_go):e.short_try?this.go(e.short_try):[]}inline_go(e){const t=[];return e.short_go&&t.push(...this.go(e.short_go)),e.inline&&t.push(...this.go(e.inline)),t}inline_try(e){const t=[];return e.short_try&&t.push(...this.go(e.short_try)),e.inline&&t.push(...this.go(e.inline)),t}inline_command(e){const t=[];return e.stmt_command&&t.push(...this.go(e.stmt_command)),e.inline&&t.push(...this.go(e.inline)),t}inline(e){const t=[];return e.stmt_stat&&t.push(...this.go(e.stmt_stat)),e.stmt_text&&t.push(...this.go(e.stmt_text)),e.stmt_comment&&t.push(...this.go(e.stmt_comment)),e.stmt_hyperlink&&t.push(...this.go(e.stmt_hyperlink)),e.inline_go&&t.push(...this.go(e.inline_go)),e.inline_try&&t.push(...this.go(e.inline_try)),e.inline_command&&t.push(...this.go(e.inline_command)),e.structured_cmd&&t.push(...this.go(e.structured_cmd)),t}stmt_label(e,t){return this.createlinenode(t,this.createcodenode(t,{type:7,active:!0,name:Go(e.token_label,":").slice(1).trim()}))}stmt_stat(e,t){return this.createlinenode(t,this.createcodenode(t,{type:9,value:Go(e.token_stat,"@").slice(1)}))}stmt_text(e,t){const r=Go(e.token_text,"");return this.createlinenode(t,this.createcodenode(t,{type:6,value:r}))}stmt_comment(e,t){return this.createlinenode(t,this.createcodenode(t,{type:7,active:!1,name:Go(e.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(e,t){return this.createlinenode(t,this.createcodenode(t,{type:8,link:Go(e.token_hyperlink,"!").slice(1),text:Go(e.token_hyperlinktext,";").slice(1)}))}stmt_command(e,t){return e.structured_cmd?this.go(e.structured_cmd):this.createlinenode(t,this.createcodenode(t,{type:11,words:this.go(e.words)}))}structured_cmd(e){return e.command_if?this.go(e.command_if):e.command_while?this.go(e.command_while):e.command_repeat?this.go(e.command_repeat):e.command_waitfor?this.go(e.command_waitfor):e.command_foreach?this.go(e.command_foreach):e.command_break?this.go(e.command_break):e.command_continue?this.go(e.command_continue):[]}short_go(e,t){return e.token_divide?this.createlinenode(t,this.createcodenode(t,{type:10,wait:!0,words:[this.go(e.string_token),this.go(e.dir)].flat()})):[]}short_try(e,t){return e.token_query?this.createlinenode(t,this.createcodenode(t,{type:10,wait:!1,words:[this.go(e.string_token),this.go(e.dir)].flat()})):[]}command_if(e,t){const[r]=this.createlogicnode(t,Go(e.token_if,"if").toLowerCase(),"",this.go(e.words)),[i]=this.go(e.command_if_block)??[];return this.createcodenode(t,{type:13,check:r,block:i})}command_if_block(e,t){const r=Ko(),i=Ko();return this.createcodenode(t,{type:15,skip:r,done:i,lines:[this.go(e.inline),this.go(e.line),this.creategotonode(t,i,"end of if"),this.createmarknode(t,r,"alt logic")].flat(),altlines:[this.go(e.command_else_if),this.go(e.command_else),this.createmarknode(t,i,"end of if")].flat()})}command_block(e){return[this.go(e.inline),this.go(e.line)].flat()}command_fork(e){return[this.go(e.inline),this.go(e.line)].flat()}command_else_if(e,t){const r=Ko(),i=Ko();return this.createcodenode(t,{type:16,done:i,lines:[this.createlogicnode(t,Go(e.token_if,"if"),r,this.go(e.words)),this.go(e.command_fork),this.creategotonode(t,i,"end of if"),this.createmarknode(t,r,"skip")].flat()})}command_else(e,t){const r=[];return e.words&&r.push(...this.createlinenode(t,this.createcodenode(t,{type:11,words:this.go(e.words)}))),e.command_fork&&r.push(...this.go(e.command_fork)),this.createcodenode(t,{type:17,lines:r})}command_while(e,t){const r=Ko(),i=Ko();return this.createcodenode(t,{type:18,loop:r,done:i,lines:[this.createmarknode(t,r,"start of while"),this.createlogicnode(t,"if",i,this.go(e.words)),this.go(e.command_block),this.creategotonode(t,r,"loop of while"),this.createmarknode(t,i,"end of while")].flat()})}command_repeat(e,t){const r=Ko(),i=Ko(),o=[this.createcountnode(t),this.go(e.words)].flat();return this.createcodenode(t,{type:21,loop:r,done:i,lines:[this.createapinode(t,"repeatstart",o),this.createmarknode(t,r,"start of repeat"),this.createlogicnode(t,"repeat",i,o),this.go(e.command_block),this.creategotonode(t,r,"loop of repeat"),this.createmarknode(t,i,"end of repeat")].flat()})}command_foreach(e,t){const r=Ko(),i=Ko(),o=[this.createcountnode(t),this.go(e.words)].flat();return this.createcodenode(t,{type:23,loop:r,done:i,lines:[this.createapinode(t,"foreachstart",o),this.createmarknode(t,r,"start of foreach"),this.createlogicnode(t,"foreach",i,o),this.go(e.command_block),this.creategotonode(t,r,"loop of foreach"),this.createmarknode(t,i,"end of foreach")].flat()})}command_waitfor(e,t){const r=Ko();return this.createcodenode(t,{type:22,loop:r,lines:[this.createmarknode(t,r,"start of waitfor"),this.createlogicnode(t,"waitfor",r,this.go(e.words))].flat()})}command_break(e,t){return this.createcodenode(t,{type:19,goto:0})}command_continue(e,t){return this.createcodenode(t,{type:20,goto:0})}command_play(e,t){const r=Go(e.token_command_play,"").trim(),[i,...s]=r.split(" ");return[this.createstringnode(t,i),this.createstringnode(t,s.join(" "))].flat()}command_toast(e,t){const i=Go(e.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(t,"toast"),this.createtemplatenode(t,i)].flat()}command_ticker(e,t){const i=Go(e.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(t,"ticker"),this.createtemplatenode(t,i)].flat()}expr(e,t){return e.RHS?this.createcodenode(t,{type:24,items:[this.createexprnodeondemand(this.go(e.LHS),t),this.createexprnodeondemand(this.go(e.RHS),t)]}):this.go(e.LHS)}and_test(e,t){return e.RHS?this.createcodenode(t,{type:25,items:[this.createexprnodeondemand(this.go(e.LHS),t),this.createexprnodeondemand(this.go(e.RHS),t)]}):this.go(e.LHS)}not_test(e,t){return e.comparison?this.go(e.comparison):e.LHS?this.createcodenode(t,{type:26,items:this.go(e.LHS)}):[]}comparison(e,t){if(e.RHS){const[r]=this.go(e.comp_op);return this.createcodenode(t,{type:27,compare:r,lhs:this.createexprnodeondemand(this.go(e.LHS),t),rhs:this.createexprnodeondemand(this.go(e.RHS),t)})}return this.go(e.LHS)}comp_op(e,t){return e.token_iseq?this.createcodenode(t,{type:28,method:0}):e.token_isnoteq?this.createcodenode(t,{type:28,method:1}):e.token_islessthan?this.createcodenode(t,{type:28,method:2}):e.token_isgreaterthan?this.createcodenode(t,{type:28,method:3}):e.token_islessthanorequal?this.createcodenode(t,{type:28,method:4}):e.token_isgreaterthanorequal?this.createcodenode(t,{type:28,method:5}):[]}expr_value(e,t){return e.RHS?this.createcodenode(t,{type:24,items:[this.createexprnodeondemand(this.go(e.LHS),t),this.createexprnodeondemand(this.go(e.RHS),t)]}):this.go(e.LHS)}and_test_value(e,t){return e.RHS?this.createcodenode(t,{type:25,items:[this.createexprnodeondemand(this.go(e.LHS),t),this.createexprnodeondemand(this.go(e.RHS),t)]}):this.go(e.LHS)}not_test_value(e,t){return e.arith_expr?this.go(e.arith_expr):e.LHS?this.createcodenode(t,{type:26,items:this.go(e.LHS)}):[]}arith_expr(e,t){if(e.LHS)return this.go(e.LHS);const r=this.go(e.term);return e.RHS?this.createcodenode(t,{type:29,lhs:r[0],items:this.go(e.RHS)}):r}arith_expr_item(e,t){return this.createcodenode(t,{type:30,operator:e.token_plus?1:2,rhs:this.go(e.term)[0]})}term(e,t){return e.term_item?this.createcodenode(t,{type:29,lhs:this.go(e.factor)[0],items:this.go(e.term_item)}):this.go(e.factor)}term_item(e,t){let r=0;return e.token_multiply&&(r=4),e.token_divide&&(r=5),e.token_moddivide&&(r=6),e.token_floordivide&&(r=7),this.createcodenode(t,{type:30,operator:r,rhs:this.go(e.factor)[0]})}factor(e,t){if(e.power)return this.go(e.power);let r=0;return e.token_plus&&(r=8),e.token_minus&&(r=9),this.createcodenode(t,{type:29,lhs:void 0,items:this.createcodenode(t,{type:30,operator:r,rhs:this.go(e.LHS)[0]})})}power(e,t){const r=this.go(e.token);return e.factor?this.createcodenode(t,{type:29,lhs:r[0],items:this.createcodenode(t,{type:30,operator:3,rhs:this.go(e.factor)[0]})}):r}words(e){return this.go(e.expr)}kind(e){return[this.go(e.color),this.go(e.string_token)].flat()}category(e,t){return e.token_isterrain?this.createcodenode(t,{type:12,literal:1,value:"isterrain"}):e.token_isobject?this.createcodenode(t,{type:12,literal:1,value:"isobject"}):[]}collision(e,t){return e.token_iswalkable?this.createcodenode(t,{type:12,literal:1,value:"iswalkable"}):e.token_iswalking?this.createcodenode(t,{type:12,literal:1,value:"iswalking"}):e.token_iswalk?this.createcodenode(t,{type:12,literal:1,value:"iswalk"}):e.token_isswimmable?this.createcodenode(t,{type:12,literal:1,value:"isswimmable"}):e.token_isswimming?this.createcodenode(t,{type:12,literal:1,value:"isswimming"}):e.token_isswim?this.createcodenode(t,{type:12,literal:1,value:"isswim"}):e.token_issolid?this.createcodenode(t,{type:12,literal:1,value:"issolid"}):e.token_isbullet?this.createcodenode(t,{type:12,literal:1,value:"isbullet"}):e.token_isghost?this.createcodenode(t,{type:12,literal:1,value:"isghost"}):[]}color(e,t){let r="ERROR";return e.token_black&&(r="black"),e.token_dkblue&&(r="dkblue"),e.token_dkgreen&&(r="dkgreen"),e.token_dkcyan&&(r="dkcyan"),e.token_dkred&&(r="dkred"),e.token_dkpurple&&(r="dkpurple"),e.token_dkyellow&&(r="dkyellow"),e.token_ltgray&&(r="ltgray"),e.token_dkgray&&(r="dkgray"),e.token_blue&&(r="blue"),e.token_green&&(r="green"),e.token_cyan&&(r="cyan"),e.token_red&&(r="red"),e.token_purple&&(r="purple"),e.token_yellow&&(r="yellow"),e.token_white&&(r="white"),e.token_brown&&(r="brown"),e.token_dkwhite&&(r="dkwhite"),e.token_ltgrey&&(r="ltgrey"),e.token_gray&&(r="gray"),e.token_grey&&(r="grey"),e.token_dkgrey&&(r="dkgrey"),e.token_ltblack&&(r="ltblack"),e.token_onblack&&(r="onblack"),e.token_ondkblue&&(r="ondkblue"),e.token_ondkgreen&&(r="ondkgreen"),e.token_ondkcyan&&(r="ondkcyan"),e.token_ondkred&&(r="ondkred"),e.token_ondkpurple&&(r="ondkpurple"),e.token_ondkyellow&&(r="ondkyellow"),e.token_onltgray&&(r="onltgray"),e.token_ondkgray&&(r="ondkgray"),e.token_onblue&&(r="onblue"),e.token_ongreen&&(r="ongreen"),e.token_oncyan&&(r="oncyan"),e.token_onred&&(r="onred"),e.token_onpurple&&(r="onpurple"),e.token_onyellow&&(r="onyellow"),e.token_onwhite&&(r="onwhite"),e.token_onbrown&&(r="onbrown"),e.token_ondkwhite&&(r="ondkwhite"),e.token_onltgrey&&(r="onltgrey"),e.token_ongray&&(r="ongray"),e.token_ongrey&&(r="ongrey"),e.token_ondkgrey&&(r="ondkgrey"),e.token_onltblack&&(r="onltblack"),e.token_onclear&&(r="onclear"),e.token_blblack&&(r="blblack"),e.token_bldkblue&&(r="blblue"),e.token_bldkgreen&&(r="blgreen"),e.token_bldkcyan&&(r="bldkcyan"),e.token_bldkred&&(r="bldkred"),e.token_bldkpurple&&(r="bldkpurple"),e.token_bldkyellow&&(r="bldkyellow"),e.token_blltgray&&(r="blltgray"),e.token_bldkgray&&(r="bldkgray"),e.token_blblue&&(r="blblue"),e.token_blgreen&&(r="blgreen"),e.token_blcyan&&(r="blcyan"),e.token_blred&&(r="blred"),e.token_blpurple&&(r="blpurple"),e.token_blyellow&&(r="blyellow"),e.token_blwhite&&(r="blwhite"),e.token_blbrown&&(r="blbrown"),e.token_bldkwhite&&(r="bldkwhite"),e.token_blltgrey&&(r="blltgrey"),e.token_blgray&&(r="blgray"),e.token_blgrey&&(r="blgrey"),e.token_bldkgrey&&(r="bldkgrey"),e.token_blltblack&&(r="blltblack"),this.createcodenode(t,{type:12,literal:1,value:r})}dir_mod(e,t){if(e.dir_within)return this.go(e.dir_within);if(e.dir_awayby)return this.go(e.dir_awayby);let r="ERROR";return e.token_cw&&(r="cw"),e.token_ccw&&(r="ccw"),e.token_opp&&(r="opp"),e.token_rndp&&(r="rndp"),e.token_over&&(r="over"),e.token_under&&(r="under"),e.token_ground&&(r="ground"),e.token_elements&&(r="elements"),this.createcodenode(t,{type:12,literal:1,value:r})}dir_by(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"by"}),...this.go(e.simple_token)]}dir_at(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"at"}),...this.go(e.simple_token)]}dir_away(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"away"}),...this.go(e.simple_token)]}dir_toward(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"toward"}),...this.go(e.simple_token)]}dir_find(e,t){const r=this.go(e.kind);if(e.token_numberliteral){const i=parseFloat(Go(e.token_numberliteral,"0"));r.push(...this.createcodenode(t,{type:12,literal:0,value:i}))}return[...this.createcodenode(t,{type:12,literal:1,value:"find"}),...r]}dir_flee(e,t){const r=this.go(e.kind);if(e.token_numberliteral){const i=parseFloat(Go(e.token_numberliteral,"0"));r.push(...this.createcodenode(t,{type:12,literal:0,value:i}))}return[...this.createcodenode(t,{type:12,literal:1,value:"flee"}),...r]}dir_to(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"to"}),...this.go(e.dir)]}dir_within(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"within"}),...this.go(e.simple_token)]}dir_awayby(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"awayby"}),...this.go(e.simple_token)]}dir(e,t){const r=this.go(e.dir_mod)??[];return e.token_i&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"i"})),e.token_idle&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"idle"})),e.token_n&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"n"})),e.token_u&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"u"})),e.token_north&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"north"})),e.token_up&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"up"})),e.token_s&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"s"})),e.token_d&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"d"})),e.token_south&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"south"})),e.token_down&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"down"})),e.token_w&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"w"})),e.token_l&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"l"})),e.token_west&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"west"})),e.token_left&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"left"})),e.token_e&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"e"})),e.token_r&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"r"})),e.token_east&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"east"})),e.token_right&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"right"})),e.token_rnd&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"rnd"})),e.token_rndne&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"rndne"})),e.token_rndns&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"rndns"})),e.token_flow&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"flow"})),e.token_seek&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"seek"})),e.dir_by&&r.push(...this.go(e.dir_by)),e.dir_at&&r.push(...this.go(e.dir_at)),e.dir_away&&r.push(...this.go(e.dir_away)),e.dir_toward&&r.push(...this.go(e.dir_toward)),e.dir_find&&r.push(...this.go(e.dir_find)),e.dir_flee&&r.push(...this.go(e.dir_flee)),e.dir_to&&r.push(...this.go(e.dir_to)),r.flat()}expr_any(e){return[this.go(e.dir),this.go(e.kind),this.go(e.color)].flat()}token_expr_any(e,t){return[this.createcodenode(t,{type:12,literal:1,value:"any"}),this.go(e.expr_any)].flat()}token_expr_count(e,t){return[this.createcodenode(t,{type:12,literal:1,value:"countof"}),this.go(e.expr_any)].flat()}token_expr_blocked(e,t){return[this.createcodenode(t,{type:12,literal:1,value:"blocked"}),this.go(e.dir)].flat()}token_expr_abs(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"abs"}),...this.go(e.simple_token)]}token_expr_intceil(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"intceil"}),...this.go(e.simple_token)]}token_expr_intfloor(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"intfloor"}),...this.go(e.simple_token)]}token_expr_intround(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"intround"}),...this.go(e.simple_token)]}token_expr_clamp(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"clamp"}),...this.go(e.simple_token)]}token_expr_min(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"min"}),...this.go(e.simple_token)]}token_expr_max(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"max"}),...this.go(e.simple_token)]}token_expr_pick(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"pick"}),...this.go(e.simple_token)]}token_expr_pickwith(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"pickwith"}),...this.go(e.simple_token)]}token_expr_random(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"random"}),...this.go(e.simple_token)]}token_expr_randomwith(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"randomwith"}),...this.go(e.simple_token)]}token_expr_run(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"run"}),...this.go(e.string_token)]}token_expr_runwith(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"runwith"}),...this.go(e.simple_token),...this.go(e.string_token)]}token_expr(e,t){return e.token_expr_aligned?this.createcodenode(t,{type:12,literal:1,value:"aligned"}):e.token_contact?this.createcodenode(t,{type:12,literal:1,value:"contact"}):e.token_expr_any?this.go(e.token_expr_any):e.token_expr_count?this.go(e.token_expr_count):e.token_expr_blocked?this.go(e.token_expr_blocked):e.token_expr_abs?this.go(e.token_expr_abs):e.token_expr_intceil?this.go(e.token_expr_intceil):e.token_expr_intfloor?this.go(e.token_expr_intfloor):e.token_expr_intround?this.go(e.token_expr_intround):e.token_expr_clamp?this.go(e.token_expr_clamp):e.token_expr_min?this.go(e.token_expr_min):e.token_expr_max?this.go(e.token_expr_max):e.token_expr_pick?this.go(e.token_expr_pick):e.token_expr_pickwith?this.go(e.token_expr_pickwith):e.token_expr_random?this.go(e.token_expr_random):e.token_expr_randomwith?this.go(e.token_expr_randomwith):e.token_expr_run?this.go(e.token_expr_run):e.token_expr_runwith?this.go(e.token_expr_runwith):[]}string_token(e,t){if(e.token_stringliteraldouble){const r=Go(e.token_stringliteraldouble,"");return this.createcodenode(t,{type:12,literal:2,value:r})}if(e.token_stringliteral){const r=Go(e.token_stringliteral,"");return this.createcodenode(t,{type:12,literal:1,value:r})}return[]}simple_token(e,t){if(e.token_stringliteraldouble){const r=Go(e.token_stringliteraldouble,"");return this.createcodenode(t,{type:12,literal:2,value:r})}if(e.token_stringliteral){const r=Go(e.token_stringliteral,"");return this.createcodenode(t,{type:12,literal:1,value:r})}if(e.token_numberliteral){const r=parseFloat(Go(e.token_numberliteral,"0"));return this.createcodenode(t,{type:12,literal:0,value:r})}return e.color?this.go(e.color):[]}token(e,t){if(e.category)return this.go(e.category);if(e.collision)return this.go(e.collision);if(e.color)return this.go(e.color);if(e.dir)return this.go(e.dir);if(e.command_play)return this.go(e.command_play);if(e.command_toast)return this.go(e.command_toast);if(e.command_ticker)return this.go(e.command_ticker);if(e.token_label){const r=Go(e.token_label,"");return this.createcodenode(t,{type:12,literal:1,value:r})}if(e.token_stringliteraldouble){const r=Go(e.token_stringliteraldouble,"");return this.createcodenode(t,{type:12,literal:2,value:r})}if(e.token_stringliteral){const r=Go(e.token_stringliteral,"");return this.createcodenode(t,{type:12,literal:1,value:r})}if(e.token_numberliteral){const r=parseFloat(Go(e.token_numberliteral,"0"));return this.createcodenode(t,{type:12,literal:0,value:r})}if(e.token_lparen)return[this.createexprnodeondemand(this.go(e.expr),t)];if(e.token_stop){const r=Go(e.token_stop,"");return this.createcodenode(t,{type:12,literal:1,value:r})}return[]}}const Lxe=new Dxe;function BL(n){if(!n||n.type===void 0)return;const e=[{start:n.startOffset,end:n.endOffset??0}];return Object.keys(n).forEach(t=>{if(t!=="parent"){const r=n[t];Xn(r)?r.forEach(i=>{e.push(BL(i))}):e.push(BL(r))}}),n.range={start:Math.min(...e.filter(t=>t).map(t=>t?.start??0)),end:Math.max(...e.filter(t=>t).map(t=>t?.end??0))},n.range}function BZ(n){const e=CZ(`${n}
`);if(e.errors.length>0)return e;CE.input=e.tokens;const t=CE.program();if(CE.errors.length>0)return{tokens:e.tokens,errors:CE.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=Lxe.go(t);return r?(BL(r),{tokens:e.tokens,cst:t,ast:r}):{tokens:e.tokens,cst:t,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}var HT={},jI={},zI={},HI={},ej;function Uxe(){if(ej)return HI;ej=1;const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return HI.encode=function(e){if(0<=e&&e<n.length)return n[e];throw new TypeError("Must be between 0 and 63: "+e)},HI}var tj;function FZ(){if(tj)return zI;tj=1;const n=Uxe(),e=5,t=1<<e,r=t-1,i=t;function s(o){return o<0?(-o<<1)+1:(o<<1)+0}return zI.encode=function(a){let c="",l,u=s(a);do l=u&r,u>>>=e,u>0&&(l|=i),c+=n.encode(l);while(u>0);return c},zI}var rp={},f1={},bw={exports:{}};var Bxe=bw.exports,nj;function Fxe(){return nj||(nj=1,(function(n,e){(function(t){var r=e&&!e.nodeType&&e,i=n&&!n.nodeType&&n,s=typeof yd=="object"&&yd;(s.global===s||s.window===s||s.self===s)&&(t=s);var o,a=2147483647,c=36,l=1,u=26,h=38,f=700,d=72,p=128,_="-",g=/^xn--/,m=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=c-l,T=Math.floor,k=String.fromCharCode,R;function P(q){throw new RangeError(y[q])}function B(q,V){for(var K=q.length,ne=[];K--;)ne[K]=V(q[K]);return ne}function U(q,V){var K=q.split("@"),ne="";K.length>1&&(ne=K[0]+"@",q=K[1]),q=q.replace(b,".");var ie=q.split("."),ae=B(ie,V).join(".");return ne+ae}function z(q){for(var V=[],K=0,ne=q.length,ie,ae;K<ne;)ie=q.charCodeAt(K++),ie>=55296&&ie<=56319&&K<ne?(ae=q.charCodeAt(K++),(ae&64512)==56320?V.push(((ie&1023)<<10)+(ae&1023)+65536):(V.push(ie),K--)):V.push(ie);return V}function I(q){return B(q,function(V){var K="";return V>65535&&(V-=65536,K+=k(V>>>10&1023|55296),V=56320|V&1023),K+=k(V),K}).join("")}function L(q){return q-48<10?q-22:q-65<26?q-65:q-97<26?q-97:c}function M(q,V){return q+22+75*(q<26)-((V!=0)<<5)}function F(q,V,K){var ne=0;for(q=K?T(q/f):q>>1,q+=T(q/V);q>x*u>>1;ne+=c)q=T(q/x);return T(ne+(x+1)*q/(q+h))}function Z(q){var V=[],K=q.length,ne,ie=0,ae=p,Te=d,Ie,be,Pe,$e,tt,qe,ut,te,Ne;for(Ie=q.lastIndexOf(_),Ie<0&&(Ie=0),be=0;be<Ie;++be)q.charCodeAt(be)>=128&&P("not-basic"),V.push(q.charCodeAt(be));for(Pe=Ie>0?Ie+1:0;Pe<K;){for($e=ie,tt=1,qe=c;Pe>=K&&P("invalid-input"),ut=L(q.charCodeAt(Pe++)),(ut>=c||ut>T((a-ie)/tt))&&P("overflow"),ie+=ut*tt,te=qe<=Te?l:qe>=Te+u?u:qe-Te,!(ut<te);qe+=c)Ne=c-te,tt>T(a/Ne)&&P("overflow"),tt*=Ne;ne=V.length+1,Te=F(ie-$e,ne,$e==0),T(ie/ne)>a-ae&&P("overflow"),ae+=T(ie/ne),ie%=ne,V.splice(ie++,0,ae)}return I(V)}function $(q){var V,K,ne,ie,ae,Te,Ie,be,Pe,$e,tt,qe=[],ut,te,Ne,Be;for(q=z(q),ut=q.length,V=p,K=0,ae=d,Te=0;Te<ut;++Te)tt=q[Te],tt<128&&qe.push(k(tt));for(ne=ie=qe.length,ie&&qe.push(_);ne<ut;){for(Ie=a,Te=0;Te<ut;++Te)tt=q[Te],tt>=V&&tt<Ie&&(Ie=tt);for(te=ne+1,Ie-V>T((a-K)/te)&&P("overflow"),K+=(Ie-V)*te,V=Ie,Te=0;Te<ut;++Te)if(tt=q[Te],tt<V&&++K>a&&P("overflow"),tt==V){for(be=K,Pe=c;$e=Pe<=ae?l:Pe>=ae+u?u:Pe-ae,!(be<$e);Pe+=c)Be=be-$e,Ne=c-$e,qe.push(k(M($e+Be%Ne,0))),be=T(Be/Ne);qe.push(k(M(be,0))),ae=F(K,te,ne==ie),K=0,++ne}++K,++V}return qe.join("")}function Y(q){return U(q,function(V){return g.test(V)?Z(V.slice(4).toLowerCase()):V})}function Q(q){return U(q,function(V){return m.test(V)?"xn--"+$(V):V})}if(o={version:"1.4.1",ucs2:{decode:z,encode:I},decode:Z,encode:$,toASCII:Q,toUnicode:Y},r&&i)if(n.exports==r)i.exports=o;else for(R in o)o.hasOwnProperty(R)&&(r[R]=o[R]);else t.punycode=o})(Bxe)})(bw,bw.exports)),bw.exports}var VI,rj;function Vx(){return rj||(rj=1,VI=TypeError),VI}const jxe={},zxe=Object.freeze(Object.defineProperty({__proto__:null,default:jxe},Symbol.toStringTag,{value:"Module"})),Hxe=j$(zxe);var GI,ij;function pO(){if(ij)return GI;ij=1;var n=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,t=n&&e&&typeof e.get=="function"?e.get:null,r=n&&Map.prototype.forEach,i=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=i&&s&&typeof s.get=="function"?s.get:null,a=i&&Set.prototype.forEach,c=typeof WeakMap=="function"&&WeakMap.prototype,l=c?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,h=u?WeakSet.prototype.has:null,f=typeof WeakRef=="function"&&WeakRef.prototype,d=f?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,_=Object.prototype.toString,g=Function.prototype.toString,m=String.prototype.match,b=String.prototype.slice,y=String.prototype.replace,x=String.prototype.toUpperCase,T=String.prototype.toLowerCase,k=RegExp.prototype.test,R=Array.prototype.concat,P=Array.prototype.join,B=Array.prototype.slice,U=Math.floor,z=typeof BigInt=="function"?BigInt.prototype.valueOf:null,I=Object.getOwnPropertySymbols,L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,M=typeof Symbol=="function"&&typeof Symbol.iterator=="object",F=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===M||!0)?Symbol.toStringTag:null,Z=Object.prototype.propertyIsEnumerable,$=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(ye){return ye.__proto__}:null);function Y(ye,ve){if(ye===1/0||ye===-1/0||ye!==ye||ye&&ye>-1e3&&ye<1e3||k.call(/e/,ve))return ve;var Xe=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof ye=="number"){var Me=ye<0?-U(-ye):U(ye);if(Me!==ye){var Ve=String(Me),je=b.call(ve,Ve.length+1);return y.call(Ve,Xe,"$&_")+"."+y.call(y.call(je,/([0-9]{3})/g,"$&_"),/_$/,"")}}return y.call(ve,Xe,"$&_")}var Q=Hxe,q=Q.custom,V=te(q)?q:null,K={__proto__:null,double:'"',single:"'"},ne={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};GI=function ye(ve,Xe,Me,Ve){var je=Xe||{};if(De(je,"quoteStyle")&&!De(K,je.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(De(je,"maxStringLength")&&(typeof je.maxStringLength=="number"?je.maxStringLength<0&&je.maxStringLength!==1/0:je.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var We=De(je,"customInspect")?je.customInspect:!0;if(typeof We!="boolean"&&We!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(De(je,"indent")&&je.indent!==null&&je.indent!=="	"&&!(parseInt(je.indent,10)===je.indent&&je.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(De(je,"numericSeparator")&&typeof je.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var ct=je.numericSeparator;if(typeof ve>"u")return"undefined";if(ve===null)return"null";if(typeof ve=="boolean")return ve?"true":"false";if(typeof ve=="string")return Pt(ve,je);if(typeof ve=="number"){if(ve===0)return 1/0/ve>0?"0":"-0";var Fe=String(ve);return ct?Y(ve,Fe):Fe}if(typeof ve=="bigint"){var rt=String(ve)+"n";return ct?Y(ve,rt):rt}var it=typeof je.depth>"u"?5:je.depth;if(typeof Me>"u"&&(Me=0),Me>=it&&it>0&&typeof ve=="object")return Ie(ve)?"[Array]":"[Object]";var St=le(je,Me);if(typeof Ve>"u")Ve=[];else if(_e(Ve,ve)>=0)return"[Circular]";function at(Ui,us,hs){if(us&&(Ve=B.call(Ve),Ve.push(us)),hs){var Le={depth:je.depth};return De(je,"quoteStyle")&&(Le.quoteStyle=je.quoteStyle),ye(Ui,Le,Me+1,Ve)}return ye(Ui,je,Me+1,Ve)}if(typeof ve=="function"&&!Pe(ve)){var Yt=ue(ve),sn=Ae(ve,at);return"[Function"+(Yt?": "+Yt:" (anonymous)")+"]"+(sn.length>0?" { "+P.call(sn,", ")+" }":"")}if(te(ve)){var Rt=M?y.call(String(ve),/^(Symbol\(.*\))_[^)]*$/,"$1"):L.call(ve);return typeof ve=="object"&&!M?At(Rt):Rt}if(nt(ve)){for(var Ut="<"+T.call(String(ve.nodeName)),_t=ve.attributes||[],Ht=0;Ht<_t.length;Ht++)Ut+=" "+_t[Ht].name+"="+ie(ae(_t[Ht].value),"double",je);return Ut+=">",ve.childNodes&&ve.childNodes.length&&(Ut+="..."),Ut+="</"+T.call(String(ve.nodeName))+">",Ut}if(Ie(ve)){if(ve.length===0)return"[]";var _n=Ae(ve,at);return St&&!W(_n)?"["+Se(_n,St)+"]":"[ "+P.call(_n,", ")+" ]"}if($e(ve)){var jt=Ae(ve,at);return!("cause"in Error.prototype)&&"cause"in ve&&!Z.call(ve,"cause")?"{ ["+String(ve)+"] "+P.call(R.call("[cause]: "+at(ve.cause),jt),", ")+" }":jt.length===0?"["+String(ve)+"]":"{ ["+String(ve)+"] "+P.call(jt,", ")+" }"}if(typeof ve=="object"&&We){if(V&&typeof ve[V]=="function"&&Q)return Q(ve,{depth:it-Me});if(We!=="symbol"&&typeof ve.inspect=="function")return ve.inspect()}if(we(ve)){var mn=[];return r&&r.call(ve,function(Ui,us){mn.push(at(us,ve,!0)+" => "+at(Ui,ve))}),ce("Map",t.call(ve),mn,St)}if(Ze(ve)){var Rn=[];return a&&a.call(ve,function(Ui){Rn.push(at(Ui,ve))}),ce("Set",o.call(ve),Rn,St)}if(pe(ve))return Re("WeakMap");if(Je(ve))return Re("WeakSet");if(ze(ve))return Re("WeakRef");if(qe(ve))return At(at(Number(ve)));if(Ne(ve))return At(at(z.call(ve)));if(ut(ve))return At(p.call(ve));if(tt(ve))return At(at(String(ve)));if(typeof window<"u"&&ve===window)return"{ [object Window] }";if(typeof globalThis<"u"&&ve===globalThis||typeof yd<"u"&&ve===yd)return"{ [object globalThis] }";if(!be(ve)&&!Pe(ve)){var Un=Ae(ve,at),qi=$?$(ve)===Object.prototype:ve instanceof Object||ve.constructor===Object,oi=ve instanceof Object?"":"null prototype",_i=!qi&&F&&Object(ve)===ve&&F in ve?b.call(Oe(ve),8,-1):oi?"Object":"",ys=qi||typeof ve.constructor!="function"?"":ve.constructor.name?ve.constructor.name+" ":"",Is=ys+(_i||oi?"["+P.call(R.call([],_i||[],oi||[]),": ")+"] ":"");return Un.length===0?Is+"{}":St?Is+"{"+Se(Un,St)+"}":Is+"{ "+P.call(Un,", ")+" }"}return String(ve)};function ie(ye,ve,Xe){var Me=Xe.quoteStyle||ve,Ve=K[Me];return Ve+ye+Ve}function ae(ye){return y.call(String(ye),/"/g,"&quot;")}function Te(ye){return!F||!(typeof ye=="object"&&(F in ye||typeof ye[F]<"u"))}function Ie(ye){return Oe(ye)==="[object Array]"&&Te(ye)}function be(ye){return Oe(ye)==="[object Date]"&&Te(ye)}function Pe(ye){return Oe(ye)==="[object RegExp]"&&Te(ye)}function $e(ye){return Oe(ye)==="[object Error]"&&Te(ye)}function tt(ye){return Oe(ye)==="[object String]"&&Te(ye)}function qe(ye){return Oe(ye)==="[object Number]"&&Te(ye)}function ut(ye){return Oe(ye)==="[object Boolean]"&&Te(ye)}function te(ye){if(M)return ye&&typeof ye=="object"&&ye instanceof Symbol;if(typeof ye=="symbol")return!0;if(!ye||typeof ye!="object"||!L)return!1;try{return L.call(ye),!0}catch{}return!1}function Ne(ye){if(!ye||typeof ye!="object"||!z)return!1;try{return z.call(ye),!0}catch{}return!1}var Be=Object.prototype.hasOwnProperty||function(ye){return ye in this};function De(ye,ve){return Be.call(ye,ve)}function Oe(ye){return _.call(ye)}function ue(ye){if(ye.name)return ye.name;var ve=m.call(g.call(ye),/^function\s*([\w$]+)/);return ve?ve[1]:null}function _e(ye,ve){if(ye.indexOf)return ye.indexOf(ve);for(var Xe=0,Me=ye.length;Xe<Me;Xe++)if(ye[Xe]===ve)return Xe;return-1}function we(ye){if(!t||!ye||typeof ye!="object")return!1;try{t.call(ye);try{o.call(ye)}catch{return!0}return ye instanceof Map}catch{}return!1}function pe(ye){if(!l||!ye||typeof ye!="object")return!1;try{l.call(ye,l);try{h.call(ye,h)}catch{return!0}return ye instanceof WeakMap}catch{}return!1}function ze(ye){if(!d||!ye||typeof ye!="object")return!1;try{return d.call(ye),!0}catch{}return!1}function Ze(ye){if(!o||!ye||typeof ye!="object")return!1;try{o.call(ye);try{t.call(ye)}catch{return!0}return ye instanceof Set}catch{}return!1}function Je(ye){if(!h||!ye||typeof ye!="object")return!1;try{h.call(ye,h);try{l.call(ye,l)}catch{return!0}return ye instanceof WeakSet}catch{}return!1}function nt(ye){return!ye||typeof ye!="object"?!1:typeof HTMLElement<"u"&&ye instanceof HTMLElement?!0:typeof ye.nodeName=="string"&&typeof ye.getAttribute=="function"}function Pt(ye,ve){if(ye.length>ve.maxStringLength){var Xe=ye.length-ve.maxStringLength,Me="... "+Xe+" more character"+(Xe>1?"s":"");return Pt(b.call(ye,0,ve.maxStringLength),ve)+Me}var Ve=ne[ve.quoteStyle||"single"];Ve.lastIndex=0;var je=y.call(y.call(ye,Ve,"\\$1"),/[\x00-\x1f]/g,vt);return ie(je,"single",ve)}function vt(ye){var ve=ye.charCodeAt(0),Xe={8:"b",9:"t",10:"n",12:"f",13:"r"}[ve];return Xe?"\\"+Xe:"\\x"+(ve<16?"0":"")+x.call(ve.toString(16))}function At(ye){return"Object("+ye+")"}function Re(ye){return ye+" { ? }"}function ce(ye,ve,Xe,Me){var Ve=Me?Se(Xe,Me):P.call(Xe,", ");return ye+" ("+ve+") {"+Ve+"}"}function W(ye){for(var ve=0;ve<ye.length;ve++)if(_e(ye[ve],`
`)>=0)return!1;return!0}function le(ye,ve){var Xe;if(ye.indent==="	")Xe="	";else if(typeof ye.indent=="number"&&ye.indent>0)Xe=P.call(Array(ye.indent+1)," ");else return null;return{base:Xe,prev:P.call(Array(ve+1),Xe)}}function Se(ye,ve){if(ye.length===0)return"";var Xe=`
`+ve.prev+ve.base;return Xe+P.call(ye,","+Xe)+`
`+ve.prev}function Ae(ye,ve){var Xe=Ie(ye),Me=[];if(Xe){Me.length=ye.length;for(var Ve=0;Ve<ye.length;Ve++)Me[Ve]=De(ye,Ve)?ve(ye[Ve],ye):""}var je=typeof I=="function"?I(ye):[],We;if(M){We={};for(var ct=0;ct<je.length;ct++)We["$"+je[ct]]=je[ct]}for(var Fe in ye)De(ye,Fe)&&(Xe&&String(Number(Fe))===Fe&&Fe<ye.length||M&&We["$"+Fe]instanceof Symbol||(k.call(/[^\w$]/,Fe)?Me.push(ve(Fe,ye)+": "+ve(ye[Fe],ye)):Me.push(Fe+": "+ve(ye[Fe],ye))));if(typeof I=="function")for(var rt=0;rt<je.length;rt++)Z.call(ye,je[rt])&&Me.push("["+ve(je[rt])+"]: "+ve(ye[je[rt]],ye));return Me}return GI}var $I,sj;function Vxe(){if(sj)return $I;sj=1;var n=pO(),e=Vx(),t=function(a,c,l){for(var u=a,h;(h=u.next)!=null;u=h)if(h.key===c)return u.next=h.next,l||(h.next=a.next,a.next=h),h},r=function(a,c){if(a){var l=t(a,c);return l&&l.value}},i=function(a,c,l){var u=t(a,c);u?u.value=l:a.next={key:c,next:a.next,value:l}},s=function(a,c){return a?!!t(a,c):!1},o=function(a,c){if(a)return t(a,c,!0)};return $I=function(){var c,l={assert:function(u){if(!l.has(u))throw new e("Side channel does not contain "+n(u))},delete:function(u){var h=c&&c.next,f=o(c,u);return f&&h&&h===f&&(c=void 0),!!f},get:function(u){return r(c,u)},has:function(u){return s(c,u)},set:function(u,h){c||(c={next:void 0}),i(c,u,h)}};return l},$I}var WI,oj;function jZ(){return oj||(oj=1,WI=Object),WI}var qI,aj;function Gxe(){return aj||(aj=1,qI=Error),qI}var YI,cj;function $xe(){return cj||(cj=1,YI=EvalError),YI}var KI,lj;function Wxe(){return lj||(lj=1,KI=RangeError),KI}var XI,uj;function qxe(){return uj||(uj=1,XI=ReferenceError),XI}var ZI,hj;function Yxe(){return hj||(hj=1,ZI=SyntaxError),ZI}var JI,fj;function Kxe(){return fj||(fj=1,JI=URIError),JI}var QI,dj;function Xxe(){return dj||(dj=1,QI=Math.abs),QI}var eN,pj;function Zxe(){return pj||(pj=1,eN=Math.floor),eN}var tN,mj;function Jxe(){return mj||(mj=1,tN=Math.max),tN}var nN,gj;function Qxe(){return gj||(gj=1,nN=Math.min),nN}var rN,_j;function eTe(){return _j||(_j=1,rN=Math.pow),rN}var iN,vj;function tTe(){return vj||(vj=1,iN=Math.round),iN}var sN,yj;function nTe(){return yj||(yj=1,sN=Number.isNaN||function(e){return e!==e}),sN}var oN,bj;function rTe(){if(bj)return oN;bj=1;var n=nTe();return oN=function(t){return n(t)||t===0?t:t<0?-1:1},oN}var aN,Sj;function iTe(){return Sj||(Sj=1,aN=Object.getOwnPropertyDescriptor),aN}var cN,Ej;function zZ(){if(Ej)return cN;Ej=1;var n=iTe();if(n)try{n([],"length")}catch{n=null}return cN=n,cN}var lN,xj;function sTe(){if(xj)return lN;xj=1;var n=Object.defineProperty||!1;if(n)try{n({},"a",{value:1})}catch{n=!1}return lN=n,lN}var uN,Tj;function oTe(){return Tj||(Tj=1,uN=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),uN}var hN,wj;function aTe(){if(wj)return hN;wj=1;var n=typeof Symbol<"u"&&Symbol,e=oTe();return hN=function(){return typeof n!="function"||typeof Symbol!="function"||typeof n("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},hN}var fN,Aj;function HZ(){return Aj||(Aj=1,fN=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),fN}var dN,Rj;function VZ(){if(Rj)return dN;Rj=1;var n=jZ();return dN=n.getPrototypeOf||null,dN}var pN,Cj;function cTe(){if(Cj)return pN;Cj=1;var n="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",i=function(c,l){for(var u=[],h=0;h<c.length;h+=1)u[h]=c[h];for(var f=0;f<l.length;f+=1)u[f+c.length]=l[f];return u},s=function(c,l){for(var u=[],h=l,f=0;h<c.length;h+=1,f+=1)u[f]=c[h];return u},o=function(a,c){for(var l="",u=0;u<a.length;u+=1)l+=a[u],u+1<a.length&&(l+=c);return l};return pN=function(c){var l=this;if(typeof l!="function"||e.apply(l)!==r)throw new TypeError(n+l);for(var u=s(arguments,1),h,f=function(){if(this instanceof h){var m=l.apply(this,i(u,arguments));return Object(m)===m?m:this}return l.apply(c,i(u,arguments))},d=t(0,l.length-u.length),p=[],_=0;_<d;_++)p[_]="$"+_;if(h=Function("binder","return function ("+o(p,",")+"){ return binder.apply(this,arguments); }")(f),l.prototype){var g=function(){};g.prototype=l.prototype,h.prototype=new g,g.prototype=null}return h},pN}var mN,Mj;function mO(){if(Mj)return mN;Mj=1;var n=cTe();return mN=Function.prototype.bind||n,mN}var gN,kj;function M6(){return kj||(kj=1,gN=Function.prototype.call),gN}var _N,Oj;function GZ(){return Oj||(Oj=1,_N=Function.prototype.apply),_N}var vN,Ij;function lTe(){return Ij||(Ij=1,vN=typeof Reflect<"u"&&Reflect&&Reflect.apply),vN}var yN,Nj;function uTe(){if(Nj)return yN;Nj=1;var n=mO(),e=GZ(),t=M6(),r=lTe();return yN=r||n.call(t,e),yN}var bN,Pj;function $Z(){if(Pj)return bN;Pj=1;var n=mO(),e=Vx(),t=M6(),r=uTe();return bN=function(s){if(s.length<1||typeof s[0]!="function")throw new e("a function is required");return r(n,t,s)},bN}var SN,Dj;function hTe(){if(Dj)return SN;Dj=1;var n=$Z(),e=zZ(),t;try{t=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!t&&e&&e(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return SN=r&&typeof r.get=="function"?n([r.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,SN}var EN,Lj;function fTe(){if(Lj)return EN;Lj=1;var n=HZ(),e=VZ(),t=hTe();return EN=n?function(i){return n(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:t?function(i){return t(i)}:null,EN}var xN,Uj;function dTe(){if(Uj)return xN;Uj=1;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=mO();return xN=t.call(n,e),xN}var TN,Bj;function k6(){if(Bj)return TN;Bj=1;var n,e=jZ(),t=Gxe(),r=$xe(),i=Wxe(),s=qxe(),o=Yxe(),a=Vx(),c=Kxe(),l=Xxe(),u=Zxe(),h=Jxe(),f=Qxe(),d=eTe(),p=tTe(),_=rTe(),g=Function,m=function(Pe){try{return g('"use strict"; return ('+Pe+").constructor;")()}catch{}},b=zZ(),y=sTe(),x=function(){throw new a},T=b?(function(){try{return arguments.callee,x}catch{try{return b(arguments,"callee").get}catch{return x}}})():x,k=aTe()(),R=fTe(),P=VZ(),B=HZ(),U=GZ(),z=M6(),I={},L=typeof Uint8Array>"u"||!R?n:R(Uint8Array),M={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?n:ArrayBuffer,"%ArrayIteratorPrototype%":k&&R?R([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":I,"%AsyncGenerator%":I,"%AsyncGeneratorFunction%":I,"%AsyncIteratorPrototype%":I,"%Atomics%":typeof Atomics>"u"?n:Atomics,"%BigInt%":typeof BigInt>"u"?n:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?n:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?n:Float16Array,"%Float32Array%":typeof Float32Array>"u"?n:Float32Array,"%Float64Array%":typeof Float64Array>"u"?n:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?n:FinalizationRegistry,"%Function%":g,"%GeneratorFunction%":I,"%Int8Array%":typeof Int8Array>"u"?n:Int8Array,"%Int16Array%":typeof Int16Array>"u"?n:Int16Array,"%Int32Array%":typeof Int32Array>"u"?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":k&&R?R(R([][Symbol.iterator]())):n,"%JSON%":typeof JSON=="object"?JSON:n,"%Map%":typeof Map>"u"?n:Map,"%MapIteratorPrototype%":typeof Map>"u"||!k||!R?n:R(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":b,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?n:Promise,"%Proxy%":typeof Proxy>"u"?n:Proxy,"%RangeError%":i,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?n:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?n:Set,"%SetIteratorPrototype%":typeof Set>"u"||!k||!R?n:R(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":k&&R?R(""[Symbol.iterator]()):n,"%Symbol%":k?Symbol:n,"%SyntaxError%":o,"%ThrowTypeError%":T,"%TypedArray%":L,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?n:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?n:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?n:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?n:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?n:WeakMap,"%WeakRef%":typeof WeakRef>"u"?n:WeakRef,"%WeakSet%":typeof WeakSet>"u"?n:WeakSet,"%Function.prototype.call%":z,"%Function.prototype.apply%":U,"%Object.defineProperty%":y,"%Object.getPrototypeOf%":P,"%Math.abs%":l,"%Math.floor%":u,"%Math.max%":h,"%Math.min%":f,"%Math.pow%":d,"%Math.round%":p,"%Math.sign%":_,"%Reflect.getPrototypeOf%":B};if(R)try{null.error}catch(Pe){var F=R(R(Pe));M["%Error.prototype%"]=F}var Z=function Pe($e){var tt;if($e==="%AsyncFunction%")tt=m("async function () {}");else if($e==="%GeneratorFunction%")tt=m("function* () {}");else if($e==="%AsyncGeneratorFunction%")tt=m("async function* () {}");else if($e==="%AsyncGenerator%"){var qe=Pe("%AsyncGeneratorFunction%");qe&&(tt=qe.prototype)}else if($e==="%AsyncIteratorPrototype%"){var ut=Pe("%AsyncGenerator%");ut&&R&&(tt=R(ut.prototype))}return M[$e]=tt,tt},$={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Y=mO(),Q=dTe(),q=Y.call(z,Array.prototype.concat),V=Y.call(U,Array.prototype.splice),K=Y.call(z,String.prototype.replace),ne=Y.call(z,String.prototype.slice),ie=Y.call(z,RegExp.prototype.exec),ae=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Te=/\\(\\)?/g,Ie=function($e){var tt=ne($e,0,1),qe=ne($e,-1);if(tt==="%"&&qe!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(qe==="%"&&tt!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var ut=[];return K($e,ae,function(te,Ne,Be,De){ut[ut.length]=Be?K(De,Te,"$1"):Ne||te}),ut},be=function($e,tt){var qe=$e,ut;if(Q($,qe)&&(ut=$[qe],qe="%"+ut[0]+"%"),Q(M,qe)){var te=M[qe];if(te===I&&(te=Z(qe)),typeof te>"u"&&!tt)throw new a("intrinsic "+$e+" exists, but is not available. Please file an issue!");return{alias:ut,name:qe,value:te}}throw new o("intrinsic "+$e+" does not exist!")};return TN=function($e,tt){if(typeof $e!="string"||$e.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof tt!="boolean")throw new a('"allowMissing" argument must be a boolean');if(ie(/^%?[^%]*%?$/,$e)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var qe=Ie($e),ut=qe.length>0?qe[0]:"",te=be("%"+ut+"%",tt),Ne=te.name,Be=te.value,De=!1,Oe=te.alias;Oe&&(ut=Oe[0],V(qe,q([0,1],Oe)));for(var ue=1,_e=!0;ue<qe.length;ue+=1){var we=qe[ue],pe=ne(we,0,1),ze=ne(we,-1);if((pe==='"'||pe==="'"||pe==="`"||ze==='"'||ze==="'"||ze==="`")&&pe!==ze)throw new o("property names with quotes must have matching quotes");if((we==="constructor"||!_e)&&(De=!0),ut+="."+we,Ne="%"+ut+"%",Q(M,Ne))Be=M[Ne];else if(Be!=null){if(!(we in Be)){if(!tt)throw new a("base intrinsic for "+$e+" exists, but the property is not available.");return}if(b&&ue+1>=qe.length){var Ze=b(Be,we);_e=!!Ze,_e&&"get"in Ze&&!("originalValue"in Ze.get)?Be=Ze.get:Be=Be[we]}else _e=Q(Be,we),Be=Be[we];_e&&!De&&(M[Ne]=Be)}}return Be},TN}var wN,Fj;function WZ(){if(Fj)return wN;Fj=1;var n=k6(),e=$Z(),t=e([n("%String.prototype.indexOf%")]);return wN=function(i,s){var o=n(i,!!s);return typeof o=="function"&&t(i,".prototype.")>-1?e([o]):o},wN}var AN,jj;function qZ(){if(jj)return AN;jj=1;var n=k6(),e=WZ(),t=pO(),r=Vx(),i=n("%Map%",!0),s=e("Map.prototype.get",!0),o=e("Map.prototype.set",!0),a=e("Map.prototype.has",!0),c=e("Map.prototype.delete",!0),l=e("Map.prototype.size",!0);return AN=!!i&&function(){var h,f={assert:function(d){if(!f.has(d))throw new r("Side channel does not contain "+t(d))},delete:function(d){if(h){var p=c(h,d);return l(h)===0&&(h=void 0),p}return!1},get:function(d){if(h)return s(h,d)},has:function(d){return h?a(h,d):!1},set:function(d,p){h||(h=new i),o(h,d,p)}};return f},AN}var RN,zj;function pTe(){if(zj)return RN;zj=1;var n=k6(),e=WZ(),t=pO(),r=qZ(),i=Vx(),s=n("%WeakMap%",!0),o=e("WeakMap.prototype.get",!0),a=e("WeakMap.prototype.set",!0),c=e("WeakMap.prototype.has",!0),l=e("WeakMap.prototype.delete",!0);return RN=s?function(){var h,f,d={assert:function(p){if(!d.has(p))throw new i("Side channel does not contain "+t(p))},delete:function(p){if(s&&p&&(typeof p=="object"||typeof p=="function")){if(h)return l(h,p)}else if(r&&f)return f.delete(p);return!1},get:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&h?o(h,p):f&&f.get(p)},has:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&h?c(h,p):!!f&&f.has(p)},set:function(p,_){s&&p&&(typeof p=="object"||typeof p=="function")?(h||(h=new s),a(h,p,_)):r&&(f||(f=r()),f.set(p,_))}};return d}:r,RN}var CN,Hj;function mTe(){if(Hj)return CN;Hj=1;var n=Vx(),e=pO(),t=Vxe(),r=qZ(),i=pTe(),s=i||r||t;return CN=function(){var a,c={assert:function(l){if(!c.has(l))throw new n("Side channel does not contain "+e(l))},delete:function(l){return!!a&&a.delete(l)},get:function(l){return a&&a.get(l)},has:function(l){return!!a&&a.has(l)},set:function(l,u){a||(a=s()),a.set(l,u)}};return c},CN}var MN,Vj;function O6(){if(Vj)return MN;Vj=1;var n=String.prototype.replace,e=/%20/g,t={RFC1738:"RFC1738",RFC3986:"RFC3986"};return MN={default:t.RFC3986,formatters:{RFC1738:function(r){return n.call(r,e,"+")},RFC3986:function(r){return String(r)}},RFC1738:t.RFC1738,RFC3986:t.RFC3986},MN}var kN,Gj;function YZ(){if(Gj)return kN;Gj=1;var n=O6(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r=(function(){for(var g=[],m=0;m<256;++m)g.push("%"+((m<16?"0":"")+m.toString(16)).toUpperCase());return g})(),i=function(m){for(;m.length>1;){var b=m.pop(),y=b.obj[b.prop];if(t(y)){for(var x=[],T=0;T<y.length;++T)typeof y[T]<"u"&&x.push(y[T]);b.obj[b.prop]=x}}},s=function(m,b){for(var y=b&&b.plainObjects?{__proto__:null}:{},x=0;x<m.length;++x)typeof m[x]<"u"&&(y[x]=m[x]);return y},o=function g(m,b,y){if(!b)return m;if(typeof b!="object"&&typeof b!="function"){if(t(m))m.push(b);else if(m&&typeof m=="object")(y&&(y.plainObjects||y.allowPrototypes)||!e.call(Object.prototype,b))&&(m[b]=!0);else return[m,b];return m}if(!m||typeof m!="object")return[m].concat(b);var x=m;return t(m)&&!t(b)&&(x=s(m,y)),t(m)&&t(b)?(b.forEach(function(T,k){if(e.call(m,k)){var R=m[k];R&&typeof R=="object"&&T&&typeof T=="object"?m[k]=g(R,T,y):m.push(T)}else m[k]=T}),m):Object.keys(b).reduce(function(T,k){var R=b[k];return e.call(T,k)?T[k]=g(T[k],R,y):T[k]=R,T},x)},a=function(m,b){return Object.keys(b).reduce(function(y,x){return y[x]=b[x],y},m)},c=function(g,m,b){var y=g.replace(/\+/g," ");if(b==="iso-8859-1")return y.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(y)}catch{return y}},l=1024,u=function(m,b,y,x,T){if(m.length===0)return m;var k=m;if(typeof m=="symbol"?k=Symbol.prototype.toString.call(m):typeof m!="string"&&(k=String(m)),y==="iso-8859-1")return escape(k).replace(/%u[0-9a-f]{4}/gi,function(L){return"%26%23"+parseInt(L.slice(2),16)+"%3B"});for(var R="",P=0;P<k.length;P+=l){for(var B=k.length>=l?k.slice(P,P+l):k,U=[],z=0;z<B.length;++z){var I=B.charCodeAt(z);if(I===45||I===46||I===95||I===126||I>=48&&I<=57||I>=65&&I<=90||I>=97&&I<=122||T===n.RFC1738&&(I===40||I===41)){U[U.length]=B.charAt(z);continue}if(I<128){U[U.length]=r[I];continue}if(I<2048){U[U.length]=r[192|I>>6]+r[128|I&63];continue}if(I<55296||I>=57344){U[U.length]=r[224|I>>12]+r[128|I>>6&63]+r[128|I&63];continue}z+=1,I=65536+((I&1023)<<10|B.charCodeAt(z)&1023),U[U.length]=r[240|I>>18]+r[128|I>>12&63]+r[128|I>>6&63]+r[128|I&63]}R+=U.join("")}return R},h=function(m){for(var b=[{obj:{o:m},prop:"o"}],y=[],x=0;x<b.length;++x)for(var T=b[x],k=T.obj[T.prop],R=Object.keys(k),P=0;P<R.length;++P){var B=R[P],U=k[B];typeof U=="object"&&U!==null&&y.indexOf(U)===-1&&(b.push({obj:k,prop:B}),y.push(U))}return i(b),m},f=function(m){return Object.prototype.toString.call(m)==="[object RegExp]"},d=function(m){return!m||typeof m!="object"?!1:!!(m.constructor&&m.constructor.isBuffer&&m.constructor.isBuffer(m))},p=function(m,b){return[].concat(m,b)},_=function(m,b){if(t(m)){for(var y=[],x=0;x<m.length;x+=1)y.push(b(m[x]));return y}return b(m)};return kN={arrayToObject:s,assign:a,combine:p,compact:h,decode:c,encode:u,isBuffer:d,isRegExp:f,maybeMap:_,merge:o},kN}var ON,$j;function gTe(){if($j)return ON;$j=1;var n=mTe(),e=YZ(),t=O6(),r=Object.prototype.hasOwnProperty,i={brackets:function(g){return g+"[]"},comma:"comma",indices:function(g,m){return g+"["+m+"]"},repeat:function(g){return g}},s=Array.isArray,o=Array.prototype.push,a=function(_,g){o.apply(_,s(g)?g:[g])},c=Date.prototype.toISOString,l=t.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:t.formatters[l],indices:!1,serializeDate:function(g){return c.call(g)},skipNulls:!1,strictNullHandling:!1},h=function(g){return typeof g=="string"||typeof g=="number"||typeof g=="boolean"||typeof g=="symbol"||typeof g=="bigint"},f={},d=function _(g,m,b,y,x,T,k,R,P,B,U,z,I,L,M,F,Z,$){for(var Y=g,Q=$,q=0,V=!1;(Q=Q.get(f))!==void 0&&!V;){var K=Q.get(g);if(q+=1,typeof K<"u"){if(K===q)throw new RangeError("Cyclic object value");V=!0}typeof Q.get(f)>"u"&&(q=0)}if(typeof B=="function"?Y=B(m,Y):Y instanceof Date?Y=I(Y):b==="comma"&&s(Y)&&(Y=e.maybeMap(Y,function(Ne){return Ne instanceof Date?I(Ne):Ne})),Y===null){if(T)return P&&!F?P(m,u.encoder,Z,"key",L):m;Y=""}if(h(Y)||e.isBuffer(Y)){if(P){var ne=F?m:P(m,u.encoder,Z,"key",L);return[M(ne)+"="+M(P(Y,u.encoder,Z,"value",L))]}return[M(m)+"="+M(String(Y))]}var ie=[];if(typeof Y>"u")return ie;var ae;if(b==="comma"&&s(Y))F&&P&&(Y=e.maybeMap(Y,P)),ae=[{value:Y.length>0?Y.join(",")||null:void 0}];else if(s(B))ae=B;else{var Te=Object.keys(Y);ae=U?Te.sort(U):Te}var Ie=R?String(m).replace(/\./g,"%2E"):String(m),be=y&&s(Y)&&Y.length===1?Ie+"[]":Ie;if(x&&s(Y)&&Y.length===0)return be+"[]";for(var Pe=0;Pe<ae.length;++Pe){var $e=ae[Pe],tt=typeof $e=="object"&&$e&&typeof $e.value<"u"?$e.value:Y[$e];if(!(k&&tt===null)){var qe=z&&R?String($e).replace(/\./g,"%2E"):String($e),ut=s(Y)?typeof b=="function"?b(be,qe):be:be+(z?"."+qe:"["+qe+"]");$.set(g,q);var te=n();te.set(f,$),a(ie,_(tt,ut,b,y,x,T,k,R,b==="comma"&&F&&s(Y)?null:P,B,U,z,I,L,M,F,Z,te))}}return ie},p=function(g){if(!g)return u;if(typeof g.allowEmptyArrays<"u"&&typeof g.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof g.encodeDotInKeys<"u"&&typeof g.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(g.encoder!==null&&typeof g.encoder<"u"&&typeof g.encoder!="function")throw new TypeError("Encoder has to be a function.");var m=g.charset||u.charset;if(typeof g.charset<"u"&&g.charset!=="utf-8"&&g.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var b=t.default;if(typeof g.format<"u"){if(!r.call(t.formatters,g.format))throw new TypeError("Unknown format option provided.");b=g.format}var y=t.formatters[b],x=u.filter;(typeof g.filter=="function"||s(g.filter))&&(x=g.filter);var T;if(g.arrayFormat in i?T=g.arrayFormat:"indices"in g?T=g.indices?"indices":"repeat":T=u.arrayFormat,"commaRoundTrip"in g&&typeof g.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var k=typeof g.allowDots>"u"?g.encodeDotInKeys===!0?!0:u.allowDots:!!g.allowDots;return{addQueryPrefix:typeof g.addQueryPrefix=="boolean"?g.addQueryPrefix:u.addQueryPrefix,allowDots:k,allowEmptyArrays:typeof g.allowEmptyArrays=="boolean"?!!g.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:T,charset:m,charsetSentinel:typeof g.charsetSentinel=="boolean"?g.charsetSentinel:u.charsetSentinel,commaRoundTrip:!!g.commaRoundTrip,delimiter:typeof g.delimiter>"u"?u.delimiter:g.delimiter,encode:typeof g.encode=="boolean"?g.encode:u.encode,encodeDotInKeys:typeof g.encodeDotInKeys=="boolean"?g.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof g.encoder=="function"?g.encoder:u.encoder,encodeValuesOnly:typeof g.encodeValuesOnly=="boolean"?g.encodeValuesOnly:u.encodeValuesOnly,filter:x,format:b,formatter:y,serializeDate:typeof g.serializeDate=="function"?g.serializeDate:u.serializeDate,skipNulls:typeof g.skipNulls=="boolean"?g.skipNulls:u.skipNulls,sort:typeof g.sort=="function"?g.sort:null,strictNullHandling:typeof g.strictNullHandling=="boolean"?g.strictNullHandling:u.strictNullHandling}};return ON=function(_,g){var m=_,b=p(g),y,x;typeof b.filter=="function"?(x=b.filter,m=x("",m)):s(b.filter)&&(x=b.filter,y=x);var T=[];if(typeof m!="object"||m===null)return"";var k=i[b.arrayFormat],R=k==="comma"&&b.commaRoundTrip;y||(y=Object.keys(m)),b.sort&&y.sort(b.sort);for(var P=n(),B=0;B<y.length;++B){var U=y[B],z=m[U];b.skipNulls&&z===null||a(T,d(z,U,k,R,b.allowEmptyArrays,b.strictNullHandling,b.skipNulls,b.encodeDotInKeys,b.encode?b.encoder:null,b.filter,b.sort,b.allowDots,b.serializeDate,b.format,b.formatter,b.encodeValuesOnly,b.charset,P))}var I=T.join(b.delimiter),L=b.addQueryPrefix===!0?"?":"";return b.charsetSentinel&&(b.charset==="iso-8859-1"?L+="utf8=%26%2310003%3B&":L+="utf8=%E2%9C%93&"),I.length>0?L+I:""},ON}var IN,Wj;function _Te(){if(Wj)return IN;Wj=1;var n=YZ(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:n.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},i=function(f){return f.replace(/&#(\d+);/g,function(d,p){return String.fromCharCode(parseInt(p,10))})},s=function(f,d,p){if(f&&typeof f=="string"&&d.comma&&f.indexOf(",")>-1)return f.split(",");if(d.throwOnLimitExceeded&&p>=d.arrayLimit)throw new RangeError("Array limit exceeded. Only "+d.arrayLimit+" element"+(d.arrayLimit===1?"":"s")+" allowed in an array.");return f},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",c=function(d,p){var _={__proto__:null},g=p.ignoreQueryPrefix?d.replace(/^\?/,""):d;g=g.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var m=p.parameterLimit===1/0?void 0:p.parameterLimit,b=g.split(p.delimiter,p.throwOnLimitExceeded?m+1:m);if(p.throwOnLimitExceeded&&b.length>m)throw new RangeError("Parameter limit exceeded. Only "+m+" parameter"+(m===1?"":"s")+" allowed.");var y=-1,x,T=p.charset;if(p.charsetSentinel)for(x=0;x<b.length;++x)b[x].indexOf("utf8=")===0&&(b[x]===a?T="utf-8":b[x]===o&&(T="iso-8859-1"),y=x,x=b.length);for(x=0;x<b.length;++x)if(x!==y){var k=b[x],R=k.indexOf("]="),P=R===-1?k.indexOf("="):R+1,B,U;P===-1?(B=p.decoder(k,r.decoder,T,"key"),U=p.strictNullHandling?null:""):(B=p.decoder(k.slice(0,P),r.decoder,T,"key"),U=n.maybeMap(s(k.slice(P+1),p,t(_[B])?_[B].length:0),function(I){return p.decoder(I,r.decoder,T,"value")})),U&&p.interpretNumericEntities&&T==="iso-8859-1"&&(U=i(String(U))),k.indexOf("[]=")>-1&&(U=t(U)?[U]:U);var z=e.call(_,B);z&&p.duplicates==="combine"?_[B]=n.combine(_[B],U):(!z||p.duplicates==="last")&&(_[B]=U)}return _},l=function(f,d,p,_){var g=0;if(f.length>0&&f[f.length-1]==="[]"){var m=f.slice(0,-1).join("");g=Array.isArray(d)&&d[m]?d[m].length:0}for(var b=_?d:s(d,p,g),y=f.length-1;y>=0;--y){var x,T=f[y];if(T==="[]"&&p.parseArrays)x=p.allowEmptyArrays&&(b===""||p.strictNullHandling&&b===null)?[]:n.combine([],b);else{x=p.plainObjects?{__proto__:null}:{};var k=T.charAt(0)==="["&&T.charAt(T.length-1)==="]"?T.slice(1,-1):T,R=p.decodeDotInKeys?k.replace(/%2E/g,"."):k,P=parseInt(R,10);!p.parseArrays&&R===""?x={0:b}:!isNaN(P)&&T!==R&&String(P)===R&&P>=0&&p.parseArrays&&P<=p.arrayLimit?(x=[],x[P]=b):R!=="__proto__"&&(x[R]=b)}b=x}return b},u=function(d,p,_,g){if(d){var m=_.allowDots?d.replace(/\.([^.[]+)/g,"[$1]"):d,b=/(\[[^[\]]*])/,y=/(\[[^[\]]*])/g,x=_.depth>0&&b.exec(m),T=x?m.slice(0,x.index):m,k=[];if(T){if(!_.plainObjects&&e.call(Object.prototype,T)&&!_.allowPrototypes)return;k.push(T)}for(var R=0;_.depth>0&&(x=y.exec(m))!==null&&R<_.depth;){if(R+=1,!_.plainObjects&&e.call(Object.prototype,x[1].slice(1,-1))&&!_.allowPrototypes)return;k.push(x[1])}if(x){if(_.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+_.depth+" and strictDepth is true");k.push("["+m.slice(x.index)+"]")}return l(k,p,_,g)}},h=function(d){if(!d)return r;if(typeof d.allowEmptyArrays<"u"&&typeof d.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof d.decodeDotInKeys<"u"&&typeof d.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(d.decoder!==null&&typeof d.decoder<"u"&&typeof d.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof d.charset<"u"&&d.charset!=="utf-8"&&d.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof d.throwOnLimitExceeded<"u"&&typeof d.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var p=typeof d.charset>"u"?r.charset:d.charset,_=typeof d.duplicates>"u"?r.duplicates:d.duplicates;if(_!=="combine"&&_!=="first"&&_!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var g=typeof d.allowDots>"u"?d.decodeDotInKeys===!0?!0:r.allowDots:!!d.allowDots;return{allowDots:g,allowEmptyArrays:typeof d.allowEmptyArrays=="boolean"?!!d.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof d.allowPrototypes=="boolean"?d.allowPrototypes:r.allowPrototypes,allowSparse:typeof d.allowSparse=="boolean"?d.allowSparse:r.allowSparse,arrayLimit:typeof d.arrayLimit=="number"?d.arrayLimit:r.arrayLimit,charset:p,charsetSentinel:typeof d.charsetSentinel=="boolean"?d.charsetSentinel:r.charsetSentinel,comma:typeof d.comma=="boolean"?d.comma:r.comma,decodeDotInKeys:typeof d.decodeDotInKeys=="boolean"?d.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof d.decoder=="function"?d.decoder:r.decoder,delimiter:typeof d.delimiter=="string"||n.isRegExp(d.delimiter)?d.delimiter:r.delimiter,depth:typeof d.depth=="number"||d.depth===!1?+d.depth:r.depth,duplicates:_,ignoreQueryPrefix:d.ignoreQueryPrefix===!0,interpretNumericEntities:typeof d.interpretNumericEntities=="boolean"?d.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof d.parameterLimit=="number"?d.parameterLimit:r.parameterLimit,parseArrays:d.parseArrays!==!1,plainObjects:typeof d.plainObjects=="boolean"?d.plainObjects:r.plainObjects,strictDepth:typeof d.strictDepth=="boolean"?!!d.strictDepth:r.strictDepth,strictNullHandling:typeof d.strictNullHandling=="boolean"?d.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof d.throwOnLimitExceeded=="boolean"?d.throwOnLimitExceeded:!1}};return IN=function(f,d){var p=h(d);if(f===""||f===null||typeof f>"u")return p.plainObjects?{__proto__:null}:{};for(var _=typeof f=="string"?c(f,p):f,g=p.plainObjects?{__proto__:null}:{},m=Object.keys(_),b=0;b<m.length;++b){var y=m[b],x=u(y,_[y],p,typeof f=="string");g=n.merge(g,x,p)}return p.allowSparse===!0?g:n.compact(g)},IN}var NN,qj;function vTe(){if(qj)return NN;qj=1;var n=gTe(),e=_Te(),t=O6();return NN={formats:t,parse:e,stringify:n},NN}var Yj;function yTe(){if(Yj)return f1;Yj=1;var n=Fxe();function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var t=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),c=["%","/","?",";","#"].concat(a),l=["/","?","#"],u=255,h=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,d={javascript:!0,"javascript:":!0},p={javascript:!0,"javascript:":!0},_={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=vTe();function m(T,k,R){if(T&&typeof T=="object"&&T instanceof e)return T;var P=new e;return P.parse(T,k,R),P}e.prototype.parse=function(T,k,R){if(typeof T!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof T);var P=T.indexOf("?"),B=P!==-1&&P<T.indexOf("#")?"?":"#",U=T.split(B),z=/\\/g;U[0]=U[0].replace(z,"/"),T=U.join(B);var I=T;if(I=I.trim(),!R&&T.split("#").length===1){var L=i.exec(I);if(L)return this.path=I,this.href=I,this.pathname=L[1],L[2]?(this.search=L[2],k?this.query=g.parse(this.search.substr(1)):this.query=this.search.substr(1)):k&&(this.search="",this.query={}),this}var M=t.exec(I);if(M){M=M[0];var F=M.toLowerCase();this.protocol=F,I=I.substr(M.length)}if(R||M||I.match(/^\/\/[^@/]+@[^@/]+/)){var Z=I.substr(0,2)==="//";Z&&!(M&&p[M])&&(I=I.substr(2),this.slashes=!0)}if(!p[M]&&(Z||M&&!_[M])){for(var $=-1,Y=0;Y<l.length;Y++){var Q=I.indexOf(l[Y]);Q!==-1&&($===-1||Q<$)&&($=Q)}var q,V;$===-1?V=I.lastIndexOf("@"):V=I.lastIndexOf("@",$),V!==-1&&(q=I.slice(0,V),I=I.slice(V+1),this.auth=decodeURIComponent(q)),$=-1;for(var Y=0;Y<c.length;Y++){var Q=I.indexOf(c[Y]);Q!==-1&&($===-1||Q<$)&&($=Q)}$===-1&&($=I.length),this.host=I.slice(0,$),I=I.slice($),this.parseHost(),this.hostname=this.hostname||"";var K=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!K)for(var ne=this.hostname.split(/\./),Y=0,ie=ne.length;Y<ie;Y++){var ae=ne[Y];if(ae&&!ae.match(h)){for(var Te="",Ie=0,be=ae.length;Ie<be;Ie++)ae.charCodeAt(Ie)>127?Te+="x":Te+=ae[Ie];if(!Te.match(h)){var Pe=ne.slice(0,Y),$e=ne.slice(Y+1),tt=ae.match(f);tt&&(Pe.push(tt[1]),$e.unshift(tt[2])),$e.length&&(I="/"+$e.join(".")+I),this.hostname=Pe.join(".");break}}}this.hostname.length>u?this.hostname="":this.hostname=this.hostname.toLowerCase(),K||(this.hostname=n.toASCII(this.hostname));var qe=this.port?":"+this.port:"",ut=this.hostname||"";this.host=ut+qe,this.href+=this.host,K&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),I[0]!=="/"&&(I="/"+I))}if(!d[F])for(var Y=0,ie=a.length;Y<ie;Y++){var te=a[Y];if(I.indexOf(te)!==-1){var Ne=encodeURIComponent(te);Ne===te&&(Ne=escape(te)),I=I.split(te).join(Ne)}}var Be=I.indexOf("#");Be!==-1&&(this.hash=I.substr(Be),I=I.slice(0,Be));var De=I.indexOf("?");if(De!==-1?(this.search=I.substr(De),this.query=I.substr(De+1),k&&(this.query=g.parse(this.query)),I=I.slice(0,De)):k&&(this.search="",this.query={}),I&&(this.pathname=I),_[F]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var qe=this.pathname||"",Oe=this.search||"";this.path=qe+Oe}return this.href=this.format(),this};function b(T){return typeof T=="string"&&(T=m(T)),T instanceof e?T.format():e.prototype.format.call(T)}e.prototype.format=function(){var T=this.auth||"";T&&(T=encodeURIComponent(T),T=T.replace(/%3A/i,":"),T+="@");var k=this.protocol||"",R=this.pathname||"",P=this.hash||"",B=!1,U="";this.host?B=T+this.host:this.hostname&&(B=T+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(B+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(U=g.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var z=this.search||U&&"?"+U||"";return k&&k.substr(-1)!==":"&&(k+=":"),this.slashes||(!k||_[k])&&B!==!1?(B="//"+(B||""),R&&R.charAt(0)!=="/"&&(R="/"+R)):B||(B=""),P&&P.charAt(0)!=="#"&&(P="#"+P),z&&z.charAt(0)!=="?"&&(z="?"+z),R=R.replace(/[?#]/g,function(I){return encodeURIComponent(I)}),z=z.replace("#","%23"),k+B+R+z+P};function y(T,k){return m(T,!1,!0).resolve(k)}e.prototype.resolve=function(T){return this.resolveObject(m(T,!1,!0)).format()};function x(T,k){return T?m(T,!1,!0).resolveObject(k):k}return e.prototype.resolveObject=function(T){if(typeof T=="string"){var k=new e;k.parse(T,!1,!0),T=k}for(var R=new e,P=Object.keys(this),B=0;B<P.length;B++){var U=P[B];R[U]=this[U]}if(R.hash=T.hash,T.href==="")return R.href=R.format(),R;if(T.slashes&&!T.protocol){for(var z=Object.keys(T),I=0;I<z.length;I++){var L=z[I];L!=="protocol"&&(R[L]=T[L])}return _[R.protocol]&&R.hostname&&!R.pathname&&(R.pathname="/",R.path=R.pathname),R.href=R.format(),R}if(T.protocol&&T.protocol!==R.protocol){if(!_[T.protocol]){for(var M=Object.keys(T),F=0;F<M.length;F++){var Z=M[F];R[Z]=T[Z]}return R.href=R.format(),R}if(R.protocol=T.protocol,!T.host&&!p[T.protocol]){for(var ie=(T.pathname||"").split("/");ie.length&&!(T.host=ie.shift()););T.host||(T.host=""),T.hostname||(T.hostname=""),ie[0]!==""&&ie.unshift(""),ie.length<2&&ie.unshift(""),R.pathname=ie.join("/")}else R.pathname=T.pathname;if(R.search=T.search,R.query=T.query,R.host=T.host||"",R.auth=T.auth,R.hostname=T.hostname||T.host,R.port=T.port,R.pathname||R.search){var $=R.pathname||"",Y=R.search||"";R.path=$+Y}return R.slashes=R.slashes||T.slashes,R.href=R.format(),R}var Q=R.pathname&&R.pathname.charAt(0)==="/",q=T.host||T.pathname&&T.pathname.charAt(0)==="/",V=q||Q||R.host&&T.pathname,K=V,ne=R.pathname&&R.pathname.split("/")||[],ie=T.pathname&&T.pathname.split("/")||[],ae=R.protocol&&!_[R.protocol];if(ae&&(R.hostname="",R.port=null,R.host&&(ne[0]===""?ne[0]=R.host:ne.unshift(R.host)),R.host="",T.protocol&&(T.hostname=null,T.port=null,T.host&&(ie[0]===""?ie[0]=T.host:ie.unshift(T.host)),T.host=null),V=V&&(ie[0]===""||ne[0]==="")),q)R.host=T.host||T.host===""?T.host:R.host,R.hostname=T.hostname||T.hostname===""?T.hostname:R.hostname,R.search=T.search,R.query=T.query,ne=ie;else if(ie.length)ne||(ne=[]),ne.pop(),ne=ne.concat(ie),R.search=T.search,R.query=T.query;else if(T.search!=null){if(ae){R.host=ne.shift(),R.hostname=R.host;var Te=R.host&&R.host.indexOf("@")>0?R.host.split("@"):!1;Te&&(R.auth=Te.shift(),R.hostname=Te.shift(),R.host=R.hostname)}return R.search=T.search,R.query=T.query,(R.pathname!==null||R.search!==null)&&(R.path=(R.pathname?R.pathname:"")+(R.search?R.search:"")),R.href=R.format(),R}if(!ne.length)return R.pathname=null,R.search?R.path="/"+R.search:R.path=null,R.href=R.format(),R;for(var Ie=ne.slice(-1)[0],be=(R.host||T.host||ne.length>1)&&(Ie==="."||Ie==="..")||Ie==="",Pe=0,$e=ne.length;$e>=0;$e--)Ie=ne[$e],Ie==="."?ne.splice($e,1):Ie===".."?(ne.splice($e,1),Pe++):Pe&&(ne.splice($e,1),Pe--);if(!V&&!K)for(;Pe--;Pe)ne.unshift("..");V&&ne[0]!==""&&(!ne[0]||ne[0].charAt(0)!=="/")&&ne.unshift(""),be&&ne.join("/").substr(-1)!=="/"&&ne.push("");var tt=ne[0]===""||ne[0]&&ne[0].charAt(0)==="/";if(ae){R.hostname=tt?"":ne.length?ne.shift():"",R.host=R.hostname;var Te=R.host&&R.host.indexOf("@")>0?R.host.split("@"):!1;Te&&(R.auth=Te.shift(),R.hostname=Te.shift(),R.host=R.hostname)}return V=V||R.host&&ne.length,V&&!tt&&ne.unshift(""),ne.length>0?R.pathname=ne.join("/"):(R.pathname=null,R.path=null),(R.pathname!==null||R.search!==null)&&(R.path=(R.pathname?R.pathname:"")+(R.search?R.search:"")),R.auth=T.auth||R.auth,R.slashes=R.slashes||T.slashes,R.href=R.format(),R},e.prototype.parseHost=function(){var T=this.host,k=r.exec(T);k&&(k=k[0],k!==":"&&(this.port=k.substr(1)),T=T.substr(0,T.length-k.length)),T&&(this.hostname=T)},f1.parse=m,f1.resolve=y,f1.resolveObject=x,f1.format=b,f1.Url=e,f1}var PN,Kj;function bTe(){return Kj||(Kj=1,PN=typeof URL=="function"?URL:yTe().URL),PN}var Xj;function gO(){if(Xj)return rp;Xj=1;const n=bTe();function e(U,z,I){if(z in U)return U[z];if(arguments.length===3)return I;throw new Error('"'+z+'" is a required argument.')}rp.getArg=e;const t=(function(){return!("__proto__"in Object.create(null))})();function r(U){return U}function i(U){return o(U)?"$"+U:U}rp.toSetString=t?r:i;function s(U){return o(U)?U.slice(1):U}rp.fromSetString=t?r:s;function o(U){if(!U)return!1;const z=U.length;if(z<9||U.charCodeAt(z-1)!==95||U.charCodeAt(z-2)!==95||U.charCodeAt(z-3)!==111||U.charCodeAt(z-4)!==116||U.charCodeAt(z-5)!==111||U.charCodeAt(z-6)!==114||U.charCodeAt(z-7)!==112||U.charCodeAt(z-8)!==95||U.charCodeAt(z-9)!==95)return!1;for(let I=z-10;I>=0;I--)if(U.charCodeAt(I)!==36)return!1;return!0}function a(U,z){return U===z?0:U===null?1:z===null?-1:U>z?1:-1}function c(U,z){let I=U.generatedLine-z.generatedLine;return I!==0||(I=U.generatedColumn-z.generatedColumn,I!==0)||(I=a(U.source,z.source),I!==0)||(I=U.originalLine-z.originalLine,I!==0)||(I=U.originalColumn-z.originalColumn,I!==0)?I:a(U.name,z.name)}rp.compareByGeneratedPositionsInflated=c;function l(U){return JSON.parse(U.replace(/^\)]}'[^\n]*\n/,""))}rp.parseSourceMapInput=l;const u="http:",h=`${u}//host`;function f(U){return z=>{const I=m(z),L=_(z),M=new n(z,L);U(M);const F=M.toString();return I==="absolute"?F:I==="scheme-relative"?F.slice(u.length):I==="path-absolute"?F.slice(h.length):b(L,F)}}function d(U,z){return new n(U,z).toString()}function p(U,z){let I=0;do{const L=U+I++;if(z.indexOf(L)===-1)return L}while(!0)}function _(U){const z=U.split("..").length-1,I=p("p",U);let L=`${h}/`;for(let M=0;M<z;M++)L+=`${I}/`;return L}const g=/^[A-Za-z0-9\+\-\.]+:/;function m(U){return U[0]==="/"?U[1]==="/"?"scheme-relative":"path-absolute":g.test(U)?"absolute":"path-relative"}function b(U,z){typeof U=="string"&&(U=new n(U)),typeof z=="string"&&(z=new n(z));const I=z.pathname.split("/"),L=U.pathname.split("/");for(L.length>0&&!L[L.length-1]&&L.pop();I.length>0&&L.length>0&&I[0]===L[0];)I.shift(),L.shift();return L.map(()=>"..").concat(I).join("/")+z.search+z.hash}const y=f(U=>{U.pathname=U.pathname.replace(/\/?$/,"/")}),x=f(U=>{U.href=new n(".",U.toString()).toString()}),T=f(U=>{});rp.normalize=T;function k(U,z){const I=m(z),L=m(U);if(U=y(U),I==="absolute")return d(z,void 0);if(L==="absolute")return d(z,U);if(I==="scheme-relative")return T(z);if(L==="scheme-relative")return d(z,d(U,h)).slice(u.length);if(I==="path-absolute")return T(z);if(L==="path-absolute")return d(z,d(U,h)).slice(h.length);const M=_(z+U),F=d(z,d(U,M));return b(M,F)}rp.join=k;function R(U,z){const I=P(U,z);return typeof I=="string"?I:T(z)}rp.relative=R;function P(U,z){if(m(U)!==m(z))return null;const L=_(U+z),M=new n(U,L),F=new n(z,L);try{new n("",F.toString())}catch{return null}return F.protocol!==M.protocol||F.user!==M.user||F.password!==M.password||F.hostname!==M.hostname||F.port!==M.port?null:b(M,F)}function B(U,z,I){U&&m(z)==="path-absolute"&&(z=z.replace(/^\//,""));let L=T(z||"");return U&&(L=k(U,L)),I&&(L=k(x(I),L)),L}return rp.computeSourceURL=B,rp}var DN={},Zj;function KZ(){if(Zj)return DN;Zj=1;class n{constructor(){this._array=[],this._set=new Map}static fromArray(t,r){const i=new n;for(let s=0,o=t.length;s<o;s++)i.add(t[s],r);return i}size(){return this._set.size}add(t,r){const i=this.has(t),s=this._array.length;(!i||r)&&this._array.push(t),i||this._set.set(t,s)}has(t){return this._set.has(t)}indexOf(t){const r=this._set.get(t);if(r>=0)return r;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}}return DN.ArraySet=n,DN}var LN={},Jj;function STe(){if(Jj)return LN;Jj=1;const n=gO();function e(r,i){const s=r.generatedLine,o=i.generatedLine,a=r.generatedColumn,c=i.generatedColumn;return o>s||o==s&&c>=a||n.compareByGeneratedPositionsInflated(r,i)<=0}class t{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(i,s){this._array.forEach(i,s)}add(i){e(this._last,i)?(this._last=i,this._array.push(i)):(this._sorted=!1,this._array.push(i))}toArray(){return this._sorted||(this._array.sort(n.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}}return LN.MappingList=t,LN}var Qj;function XZ(){if(Qj)return jI;Qj=1;const n=FZ(),e=gO(),t=KZ().ArraySet,r=STe().MappingList;class i{constructor(o){o||(o={}),this._file=e.getArg(o,"file",null),this._sourceRoot=e.getArg(o,"sourceRoot",null),this._skipValidation=e.getArg(o,"skipValidation",!1),this._sources=new t,this._names=new t,this._mappings=new r,this._sourcesContents=null}static fromSourceMap(o){const a=o.sourceRoot,c=new i({file:o.file,sourceRoot:a});return o.eachMapping(function(l){const u={generated:{line:l.generatedLine,column:l.generatedColumn}};l.source!=null&&(u.source=l.source,a!=null&&(u.source=e.relative(a,u.source)),u.original={line:l.originalLine,column:l.originalColumn},l.name!=null&&(u.name=l.name)),c.addMapping(u)}),o.sources.forEach(function(l){let u=l;a!=null&&(u=e.relative(a,l)),c._sources.has(u)||c._sources.add(u);const h=o.sourceContentFor(l);h!=null&&c.setSourceContent(l,h)}),c}addMapping(o){const a=e.getArg(o,"generated"),c=e.getArg(o,"original",null);let l=e.getArg(o,"source",null),u=e.getArg(o,"name",null);this._skipValidation||this._validateMapping(a,c,l,u),l!=null&&(l=String(l),this._sources.has(l)||this._sources.add(l)),u!=null&&(u=String(u),this._names.has(u)||this._names.add(u)),this._mappings.add({generatedLine:a.line,generatedColumn:a.column,originalLine:c&&c.line,originalColumn:c&&c.column,source:l,name:u})}setSourceContent(o,a){let c=o;this._sourceRoot!=null&&(c=e.relative(this._sourceRoot,c)),a!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[e.toSetString(c)]=a):this._sourcesContents&&(delete this._sourcesContents[e.toSetString(c)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(o,a,c){let l=a;if(a==null){if(o.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);l=o.file}const u=this._sourceRoot;u!=null&&(l=e.relative(u,l));const h=this._mappings.toArray().length>0?new t:this._sources,f=new t;this._mappings.unsortedForEach(function(d){if(d.source===l&&d.originalLine!=null){const g=o.originalPositionFor({line:d.originalLine,column:d.originalColumn});g.source!=null&&(d.source=g.source,c!=null&&(d.source=e.join(c,d.source)),u!=null&&(d.source=e.relative(u,d.source)),d.originalLine=g.line,d.originalColumn=g.column,g.name!=null&&(d.name=g.name))}const p=d.source;p!=null&&!h.has(p)&&h.add(p);const _=d.name;_!=null&&!f.has(_)&&f.add(_)},this),this._sources=h,this._names=f,o.sources.forEach(function(d){const p=o.sourceContentFor(d);p!=null&&(c!=null&&(d=e.join(c,d)),u!=null&&(d=e.relative(u,d)),this.setSourceContent(d,p))},this)}_validateMapping(o,a,c,l){if(a&&typeof a.line!="number"&&typeof a.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(o&&"line"in o&&"column"in o&&o.line>0&&o.column>=0&&!a&&!c&&!l)){if(!(o&&"line"in o&&"column"in o&&a&&"line"in a&&"column"in a&&o.line>0&&o.column>=0&&a.line>0&&a.column>=0&&c))throw new Error("Invalid mapping: "+JSON.stringify({generated:o,source:c,original:a,name:l}))}}_serializeMappings(){let o=0,a=1,c=0,l=0,u=0,h=0,f="",d,p,_,g;const m=this._mappings.toArray();for(let b=0,y=m.length;b<y;b++){if(p=m[b],d="",p.generatedLine!==a)for(o=0;p.generatedLine!==a;)d+=";",a++;else if(b>0){if(!e.compareByGeneratedPositionsInflated(p,m[b-1]))continue;d+=","}d+=n.encode(p.generatedColumn-o),o=p.generatedColumn,p.source!=null&&(g=this._sources.indexOf(p.source),d+=n.encode(g-h),h=g,d+=n.encode(p.originalLine-1-l),l=p.originalLine-1,d+=n.encode(p.originalColumn-c),c=p.originalColumn,p.name!=null&&(_=this._names.indexOf(p.name),d+=n.encode(_-u),u=_)),f+=d}return f}_generateSourcesContent(o,a){return o.map(function(c){if(!this._sourcesContents)return null;a!=null&&(c=e.relative(a,c));const l=e.toSetString(c);return Object.prototype.hasOwnProperty.call(this._sourcesContents,l)?this._sourcesContents[l]:null},this)}toJSON(){const o={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(o.file=this._file),this._sourceRoot!=null&&(o.sourceRoot=this._sourceRoot),this._sourcesContents&&(o.sourcesContent=this._generateSourcesContent(o.sources,o.sourceRoot)),o}toString(){return JSON.stringify(this.toJSON())}}return i.prototype._version=3,jI.SourceMapGenerator=i,jI}var VT={},UN={},ez;function ETe(){return ez||(ez=1,(function(n){n.GREATEST_LOWER_BOUND=1,n.LEAST_UPPER_BOUND=2;function e(t,r,i,s,o,a){const c=Math.floor((r-t)/2)+t,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a===n.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-t>1?e(t,c,i,s,o,a):a==n.LEAST_UPPER_BOUND?c:t<0?-1:t}n.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||n.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(UN)),UN}var A2={exports:{}},tz;function ZZ(){if(tz)return A2.exports;tz=1;let n=null;return A2.exports=function(){if(typeof n=="string")return fetch(n).then(t=>t.arrayBuffer());if(n instanceof ArrayBuffer)return Promise.resolve(n);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},A2.exports.initialize=e=>{n=e},A2.exports}var BN,nz;function xTe(){if(nz)return BN;nz=1;const n=ZZ();function e(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let t=null;return BN=function(){if(t)return t;const i=[];return t=n().then(s=>WebAssembly.instantiate(s,{env:{mapping_callback(o,a,c,l,u,h,f,d,p,_){const g=new e;g.generatedLine=o+1,g.generatedColumn=a,c&&(g.lastGeneratedColumn=l-1),u&&(g.source=h,g.originalLine=f+1,g.originalColumn=d,p&&(g.name=_)),i[i.length-1](g)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(s=>({exports:s.instance.exports,withMappingCallback:(o,a)=>{i.push(o);try{a()}finally{i.pop()}}})).then(null,s=>{throw t=null,s}),t},BN}var rz;function TTe(){if(rz)return VT;rz=1;const n=gO(),e=ETe(),t=KZ().ArraySet;FZ();const r=ZZ(),i=xTe(),s=Symbol("smcInternal");class o{constructor(f,d){return f==s?Promise.resolve(this):l(f,d)}static initialize(f){r.initialize(f["lib/mappings.wasm"])}static fromSourceMap(f,d){return u(f,d)}static async with(f,d,p){const _=await new o(f,d);try{return await p(_)}finally{_.destroy()}}eachMapping(f,d,p){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(f){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}o.prototype._version=3,o.GENERATED_ORDER=1,o.ORIGINAL_ORDER=2,o.GREATEST_LOWER_BOUND=1,o.LEAST_UPPER_BOUND=2,VT.SourceMapConsumer=o;class a extends o{constructor(f,d){return super(s).then(p=>{let _=f;typeof f=="string"&&(_=n.parseSourceMapInput(f));const g=n.getArg(_,"version"),m=n.getArg(_,"sources").map(String),b=n.getArg(_,"names",[]),y=n.getArg(_,"sourceRoot",null),x=n.getArg(_,"sourcesContent",null),T=n.getArg(_,"mappings"),k=n.getArg(_,"file",null),R=n.getArg(_,"x_google_ignoreList",null);if(g!=p._version)throw new Error("Unsupported version: "+g);return p._sourceLookupCache=new Map,p._names=t.fromArray(b.map(String),!0),p._sources=t.fromArray(m,!0),p._absoluteSources=t.fromArray(p._sources.toArray().map(function(P){return n.computeSourceURL(y,P,d)}),!0),p.sourceRoot=y,p.sourcesContent=x,p._mappings=T,p._sourceMapURL=d,p.file=k,p.x_google_ignoreList=R,p._computedColumnSpans=!1,p._mappingsPtr=0,p._wasm=null,i().then(P=>(p._wasm=P,p))})}_findSourceIndex(f){const d=this._sourceLookupCache.get(f);if(typeof d=="number")return d;const p=n.computeSourceURL(null,f,this._sourceMapURL);if(this._absoluteSources.has(p)){const g=this._absoluteSources.indexOf(p);return this._sourceLookupCache.set(f,g),g}const _=n.computeSourceURL(this.sourceRoot,f,this._sourceMapURL);if(this._absoluteSources.has(_)){const g=this._absoluteSources.indexOf(_);return this._sourceLookupCache.set(f,g),g}return-1}static fromSourceMap(f,d){return new a(f.toString())}get sources(){return this._absoluteSources.toArray()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(),this._mappingsPtr}_parseMappings(){const f=this._mappings,d=f.length,p=this._wasm.exports.allocate_mappings(d)>>>0,_=new Uint8Array(this._wasm.exports.memory.buffer,p,d);for(let m=0;m<d;m++)_[m]=f.charCodeAt(m);const g=this._wasm.exports.parse_mappings(p);if(!g){const m=this._wasm.exports.get_last_error();let b=`Error parsing mappings (code ${m}): `;switch(m){case 1:b+="the mappings contained a negative line, column, source index, or name index";break;case 2:b+="the mappings contained a number larger than 2**32";break;case 3:b+="reached EOF while in the middle of parsing a VLQ";break;case 4:b+="invalid base 64 character while parsing a VLQ";break;default:b+="unknown error code";break}throw new Error(b)}this._mappingsPtr=g}eachMapping(f,d,p){const _=d||null,g=p||o.GENERATED_ORDER;this._wasm.withMappingCallback(m=>{m.source!==null&&(m.source=this._absoluteSources.at(m.source),m.name!==null&&(m.name=this._names.at(m.name))),this._computedColumnSpans&&m.lastGeneratedColumn===null&&(m.lastGeneratedColumn=1/0),f.call(_,m)},()=>{switch(g){case o.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case o.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(f){let d=n.getArg(f,"source");const p=n.getArg(f,"line"),_=f.column||0;if(d=this._findSourceIndex(d),d<0)return[];if(p<1)throw new Error("Line numbers must be >= 1");if(_<0)throw new Error("Column numbers must be >= 0");const g=[];return this._wasm.withMappingCallback(m=>{let b=m.lastGeneratedColumn;this._computedColumnSpans&&b===null&&(b=1/0),g.push({line:m.generatedLine,column:m.generatedColumn,lastColumn:b})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),d,p-1,"column"in f,_)}),g}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(f){const d={generatedLine:n.getArg(f,"line"),generatedColumn:n.getArg(f,"column")};if(d.generatedLine<1)throw new Error("Line numbers must be >= 1");if(d.generatedColumn<0)throw new Error("Column numbers must be >= 0");let p=n.getArg(f,"bias",o.GREATEST_LOWER_BOUND);p==null&&(p=o.GREATEST_LOWER_BOUND);let _;if(this._wasm.withMappingCallback(g=>_=g,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),d.generatedLine-1,d.generatedColumn,p)}),_&&_.generatedLine===d.generatedLine){let g=n.getArg(_,"source",null);g!==null&&(g=this._absoluteSources.at(g));let m=n.getArg(_,"name",null);return m!==null&&(m=this._names.at(m)),{source:g,line:n.getArg(_,"originalLine",null),column:n.getArg(_,"originalColumn",null),name:m}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(f){return f==null}):!1}sourceContentFor(f,d){if(!this.sourcesContent)return null;const p=this._findSourceIndex(f);if(p>=0)return this.sourcesContent[p];if(d)return null;throw new Error('"'+f+'" is not in the SourceMap.')}generatedPositionFor(f){let d=n.getArg(f,"source");if(d=this._findSourceIndex(d),d<0)return{line:null,column:null,lastColumn:null};const p={source:d,originalLine:n.getArg(f,"line"),originalColumn:n.getArg(f,"column")};if(p.originalLine<1)throw new Error("Line numbers must be >= 1");if(p.originalColumn<0)throw new Error("Column numbers must be >= 0");let _=n.getArg(f,"bias",o.GREATEST_LOWER_BOUND);_==null&&(_=o.GREATEST_LOWER_BOUND);let g;if(this._wasm.withMappingCallback(m=>g=m,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),p.source,p.originalLine-1,p.originalColumn,_)}),g&&g.source===p.source){let m=g.lastGeneratedColumn;return this._computedColumnSpans&&m===null&&(m=1/0),{line:n.getArg(g,"generatedLine",null),column:n.getArg(g,"generatedColumn",null),lastColumn:m}}return{line:null,column:null,lastColumn:null}}}a.prototype.consumer=o,VT.BasicSourceMapConsumer=a;class c extends o{constructor(f,d){return super(s).then(p=>{let _=f;typeof f=="string"&&(_=n.parseSourceMapInput(f));const g=n.getArg(_,"version"),m=n.getArg(_,"sections");if(g!=p._version)throw new Error("Unsupported version: "+g);let b={line:-1,column:0};return Promise.all(m.map(y=>{if(y.url)throw new Error("Support for url field in sections not implemented.");const x=n.getArg(y,"offset"),T=n.getArg(x,"line"),k=n.getArg(x,"column");if(T<b.line||T===b.line&&k<b.column)throw new Error("Section offsets must be ordered and non-overlapping.");return b=x,new o(n.getArg(y,"map"),d).then(P=>({generatedOffset:{generatedLine:T+1,generatedColumn:k+1},consumer:P}))})).then(y=>(p._sections=y,p))})}get sources(){const f=[];for(let d=0;d<this._sections.length;d++)for(let p=0;p<this._sections[d].consumer.sources.length;p++)f.push(this._sections[d].consumer.sources[p]);return f}originalPositionFor(f){const d={generatedLine:n.getArg(f,"line"),generatedColumn:n.getArg(f,"column")},p=e.search(d,this._sections,function(g,m){const b=g.generatedLine-m.generatedOffset.generatedLine;return b||g.generatedColumn-(m.generatedOffset.generatedColumn-1)}),_=this._sections[p];return _?_.consumer.originalPositionFor({line:d.generatedLine-(_.generatedOffset.generatedLine-1),column:d.generatedColumn-(_.generatedOffset.generatedLine===d.generatedLine?_.generatedOffset.generatedColumn-1:0),bias:f.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(f){return f.consumer.hasContentsOfAllSources()})}sourceContentFor(f,d){for(let p=0;p<this._sections.length;p++){const g=this._sections[p].consumer.sourceContentFor(f,!0);if(g)return g}if(d)return null;throw new Error('"'+f+'" is not in the SourceMap.')}_findSectionIndex(f){for(let d=0;d<this._sections.length;d++){const{consumer:p}=this._sections[d];if(p._findSourceIndex(f)!==-1)return d}return-1}generatedPositionFor(f){const d=this._findSectionIndex(n.getArg(f,"source")),p=d>=0?this._sections[d]:null,_=d>=0&&d+1<this._sections.length?this._sections[d+1]:null,g=p&&p.consumer.generatedPositionFor(f);if(g&&g.line!==null){const m=p.generatedOffset.generatedLine-1,b=p.generatedOffset.generatedColumn-1;return g.line===1&&(g.column+=b,typeof g.lastColumn=="number"&&(g.lastColumn+=b)),g.lastColumn===1/0&&_&&g.line===_.generatedOffset.generatedLine&&(g.lastColumn=_.generatedOffset.generatedColumn-2),g.line+=m,g}return{line:null,column:null,lastColumn:null}}allGeneratedPositionsFor(f){const d=this._findSectionIndex(n.getArg(f,"source")),p=d>=0?this._sections[d]:null,_=d>=0&&d+1<this._sections.length?this._sections[d+1]:null;return p?p.consumer.allGeneratedPositionsFor(f).map(g=>{const m=p.generatedOffset.generatedLine-1,b=p.generatedOffset.generatedColumn-1;return g.line===1&&(g.column+=b,typeof g.lastColumn=="number"&&(g.lastColumn+=b)),g.lastColumn===1/0&&_&&g.line===_.generatedOffset.generatedLine&&(g.lastColumn=_.generatedOffset.generatedColumn-2),g.line+=m,g}):[]}eachMapping(f,d,p){this._sections.forEach((_,g)=>{const m=g+1<this._sections.length?this._sections[g+1]:null,{generatedOffset:b}=_,y=b.generatedLine-1,x=b.generatedColumn-1;_.consumer.eachMapping(function(T){T.generatedLine===1&&(T.generatedColumn+=x,typeof T.lastGeneratedColumn=="number"&&(T.lastGeneratedColumn+=x)),T.lastGeneratedColumn===1/0&&m&&T.generatedLine===m.generatedOffset.generatedLine&&(T.lastGeneratedColumn=m.generatedOffset.generatedColumn-2),T.generatedLine+=y,f.call(this,T)},d,p)})}computeColumnSpans(){for(let f=0;f<this._sections.length;f++)this._sections[f].consumer.computeColumnSpans()}destroy(){for(let f=0;f<this._sections.length;f++)this._sections[f].consumer.destroy()}}VT.IndexedSourceMapConsumer=c;function l(h,f){let d=h;typeof h=="string"&&(d=n.parseSourceMapInput(h));const p=d.sections!=null?new c(d,f):new a(d,f);return Promise.resolve(p)}function u(h,f){return a.fromSourceMap(h,f)}return VT}var FN={},iz;function wTe(){if(iz)return FN;iz=1;const n=XZ().SourceMapGenerator,e=gO(),t=/(\r?\n)/,r=10,i="$$$isSourceNode$$$";class s{constructor(a,c,l,u,h){this.children=[],this.sourceContents={},this.line=a??null,this.column=c??null,this.source=l??null,this.name=h??null,this[i]=!0,u!=null&&this.add(u)}static fromStringWithSourceMap(a,c,l){const u=new s,h=a.split(t);let f=0;const d=function(){const y=T(),x=T()||"";return y+x;function T(){return f<h.length?h[f++]:void 0}};let p=1,_=0,g=null,m;return c.eachMapping(function(y){if(g!==null)if(p<y.generatedLine)b(g,d()),p++,_=0;else{m=h[f]||"";const x=m.substr(0,y.generatedColumn-_);h[f]=m.substr(y.generatedColumn-_),_=y.generatedColumn,b(g,x),g=y;return}for(;p<y.generatedLine;)u.add(d()),p++;_<y.generatedColumn&&(m=h[f]||"",u.add(m.substr(0,y.generatedColumn)),h[f]=m.substr(y.generatedColumn),_=y.generatedColumn),g=y},this),f<h.length&&(g&&b(g,d()),u.add(h.splice(f).join(""))),c.sources.forEach(function(y){const x=c.sourceContentFor(y);x!=null&&(l!=null&&(y=e.join(l,y)),u.setSourceContent(y,x))}),u;function b(y,x){if(y===null||y.source===void 0)u.add(x);else{const T=l?e.join(l,y.source):y.source;u.add(new s(y.originalLine,y.originalColumn,T,x,y.name))}}}add(a){if(Array.isArray(a))a.forEach(function(c){this.add(c)},this);else if(a[i]||typeof a=="string")a&&this.children.push(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this}prepend(a){if(Array.isArray(a))for(let c=a.length-1;c>=0;c--)this.prepend(a[c]);else if(a[i]||typeof a=="string")this.children.unshift(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this}walk(a){let c;for(let l=0,u=this.children.length;l<u;l++)c=this.children[l],c[i]?c.walk(a):c!==""&&a(c,{source:this.source,line:this.line,column:this.column,name:this.name})}join(a){let c,l;const u=this.children.length;if(u>0){for(c=[],l=0;l<u-1;l++)c.push(this.children[l]),c.push(a);c.push(this.children[l]),this.children=c}return this}replaceRight(a,c){const l=this.children[this.children.length-1];return l[i]?l.replaceRight(a,c):typeof l=="string"?this.children[this.children.length-1]=l.replace(a,c):this.children.push("".replace(a,c)),this}setSourceContent(a,c){this.sourceContents[e.toSetString(a)]=c}walkSourceContents(a){for(let l=0,u=this.children.length;l<u;l++)this.children[l][i]&&this.children[l].walkSourceContents(a);const c=Object.keys(this.sourceContents);for(let l=0,u=c.length;l<u;l++)a(e.fromSetString(c[l]),this.sourceContents[c[l]])}toString(){let a="";return this.walk(function(c){a+=c}),a}toStringWithSourceMap(a){const c={code:"",line:1,column:0},l=new n(a);let u=!1,h=null,f=null,d=null,p=null;return this.walk(function(_,g){c.code+=_,g.source!==null&&g.line!==null&&g.column!==null?((h!==g.source||f!==g.line||d!==g.column||p!==g.name)&&l.addMapping({source:g.source,original:{line:g.line,column:g.column},generated:{line:c.line,column:c.column},name:g.name}),h=g.source,f=g.line,d=g.column,p=g.name,u=!0):u&&(l.addMapping({generated:{line:c.line,column:c.column}}),h=null,u=!1);for(let m=0,b=_.length;m<b;m++)_.charCodeAt(m)===r?(c.line++,c.column=0,m+1===b?(h=null,u=!1):u&&l.addMapping({source:g.source,original:{line:g.line,column:g.column},generated:{line:c.line,column:c.column},name:g.name})):c.column++}),this.walkSourceContents(function(_,g){l.setSourceContent(_,g)}),{code:c.code,map:l}}}return FN.SourceNode=s,FN}var sz;function ATe(){return sz||(sz=1,HT.SourceMapGenerator=XZ().SourceMapGenerator,HT.SourceMapConsumer=TTe().SourceMapConsumer,HT.SourceNode=wTe().SourceNode),HT}var RTe=ATe();const kh={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},_O="zss.js";function Mi(n,e){return new RTe.SourceNode(n.startLine??1,n.startColumn??1,_O,e)}function FL(n){return n.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function R2(n){return`'${FL(n)}'`}function jN(n){const e=Xx(n);return e.errors.length?n:`['${e.tokens.map(r=>{if(r.tokenType===lR){const i=FL(r.image.substring(1));return Jn(i)==="center"?"$CENTER":`', api.print(api.get('${i}')), '`}return FL(r.image)}).join("")}'].join('')`}function GT(n){return n.filter(e=>e!==void 0).map(Gi)}function oz(n){return Mi(n,"")}function CTe(n,e){const t=[];return n.forEach(r=>{t.push(r,e)}),t.pop(),t}function Ec(n,e,t){return Mi(n,[`api.${e}(`,...CTe(t,", "),")"])}function MTe(n){if(n.type===Mn.COMPARE&&n.compare.type===Mn.COMPARE_ITEM)switch(n.compare.method){case A1.IS_EQ:return Ec(n,"isEq",[Gi(n.lhs),Gi(n.rhs)]);case A1.IS_NOT_EQ:return Ec(n,"isNotEq",[Gi(n.lhs),Gi(n.rhs)]);case A1.IS_LESS_THAN:return Ec(n,"isLessThan",[Gi(n.lhs),Gi(n.rhs)]);case A1.IS_GREATER_THAN:return Ec(n,"isGreaterThan",[Gi(n.lhs),Gi(n.rhs)]);case A1.IS_LESS_THAN_OR_EQ:return Ec(n,"isLessThanOrEq",[Gi(n.lhs),Gi(n.rhs)]);case A1.IS_GREATER_THAN_OR_EQ:return Ec(n,"isGreaterThanOrEq",[Gi(n.lhs),Gi(n.rhs)])}return Mi(n,"")}function d1(n,e,t){return n.prepend(`api.${e}(`),n.add([", ",Gi(t),")"])}function az(n,e,t){return n.prepend(`api.${e}(`),n.add([Gi(t),")"])}function kTe(n,e){if(n.type===Mn.OPERATOR_ITEM)switch(n.operator){case wm.PLUS:return d1(e,"opPlus",n.rhs);case wm.MINUS:return d1(e,"opMinus",n.rhs);case wm.POWER:return d1(e,"opPower",n.rhs);case wm.MULTIPLY:return d1(e,"opMultiply",n.rhs);case wm.DIVIDE:return d1(e,"opDivide",n.rhs);case wm.MOD_DIVIDE:return d1(e,"opModDivide",n.rhs);case wm.FLOOR_DIVIDE:return d1(e,"opFloorDivide",n.rhs);case wm.UNI_PLUS:return az(e,"opUniPlus",n.rhs);case wm.UNI_MINUS:return az(e,"opUniMinus",n.rhs)}return Mi(n,"")}function OTe(n){if(n.type===Mn.OPERATOR){const e=n.lhs?Gi(n.lhs):Mi(n,"");return n.items.forEach(t=>kTe(t,e)),e}return Mi(n,"")}function C2(n,e){return Mi(n,[Ec(n,"jump",[`${e}`]),"; continue;"])}function Rg(n){return kh.linelookup[n??""]??-1}function jL(n,e){kh.linelookup[n]=e}function pE(n,e,t){for(let r=0;r<n.length;++r){const i=n[r];switch(i.type){case Mn.WHILE:case Mn.REPEAT:case Mn.FOREACH:case Mn.ELSE_IF:i.type===e&&(i.done=t);break;case Mn.IF_BLOCK:case Mn.IF_CHECK:i.type===e&&(i.skip=t);break;case Mn.LINE:pE(i.stmts,e,t);break}}}function JZ(n,e,t){for(let r=0;r<n.length;++r){const i=n[r];switch(i.type){case Mn.WHILE:case Mn.REPEAT:case Mn.FOREACH:case Mn.ELSE_IF:i.type===e&&jL(i.done,t);break;case Mn.IF_BLOCK:case Mn.IF_CHECK:i.type===e&&jL(i.skip,t);break;case Mn.LINE:JZ(i.stmts,e,t);break}}}function Gi(n){switch(n.type){case Mn.PROGRAM:return Mi(n,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { return 1; }
`,`switch (api.getcase()) {
`,...n.lines.map(Gi).flat(),`default:
`,`  return 0;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${_O}`]);case Mn.API:return Mi(n,["  ",Ec(n,n.method,GT(n.words)),`;
`]);case Mn.LINE:return Mi(n,[`case ${n.lineindex}:
`,...n.stmts.map(Gi).flat(),`  break;
`]);case Mn.MARK:return Mi(n,`  // ${n.comment}
`);case Mn.GOTO:{const e=Rg(n.id);return Mi(n,["  ",C2(n,e),`
`])}case Mn.COUNT:return Mi(n,`${n.index}`);case Mn.LITERAL:switch(n.literal){case IC.NUMBER:return Mi(n,`${n.value}`);case IC.STRING:return Mi(n,R2(n.value));case IC.TEMPLATE:return Mi(n,jN(n.value))}return oz(n);case Mn.TEXT:return Mi(n,["  ",Ec(n,"text",[jN(n.value)]),`;
`]);case Mn.STAT:if(kh.isfirststat){kh.isfirststat=!1;const e=n.value.trim().split(" ").map(R2);return Mi(n,["  ",Ec(n,"stat",e),`;
`])}return Mi(n,`  // skipped ${n.value}
`);case Mn.LABEL:{const e=Jn(n.name),t=n.active?"label":"comment";kh.labels[e]||(kh.labels[e]=[]);const r=(n.active?1:-1)*n.lineindex;return kh.labels[e].push(r),Mi(n,`  // ${r} '${e}' ${t}
`)}case Mn.HYPERLINK:return Mi(n,["  ",Ec(n,"hyperlink",[jN(n.text),...n.link.split(" ").filter(e=>e.length>0).map(R2)]),`;
`]);case Mn.MOVE:{const e=Ec(n,"command",[R2("go"),GT(n.words)].flat());return n.wait?Mi(n,["  if (",e,`) { continue; };
`]):Mi(n,["  ",e,`;
`])}case Mn.COMMAND:return Mi(n,["  if (",Ec(n,"command",GT(n.words)),`) { continue; };
`]);case Mn.IF:{const e=n.block?.type===Mn.IF_BLOCK?n.block:void 0;if(fe(e)){pE([n.check],Mn.IF_CHECK,e.skip);const t=Mi(n,Gi(n.check));return e.lines.forEach(r=>t.add(Gi(r))),JZ(e.altlines,Mn.ELSE_IF,Rg(e.done)),e.altlines.forEach(r=>t.add(Gi(r))),t}return Mi(n,Gi(n.check))}case Mn.IF_CHECK:{const e=Rg(n.skip);return e===-1?Mi(n,["  ",Ec(n,n.method,GT(n.words)),`;
`]):Mi(n,["  if (!",Ec(n,n.method,GT(n.words)),") { ",C2(n,e),` }
`])}case Mn.ELSE_IF:case Mn.ELSE:{const e=Mi(n,"");return n.lines.forEach(t=>e.add(Gi(t))),e}case Mn.WHILE:{const e=Rg(n.loop),t=Rg(n.done),r=Mi(n,"");return pE(n.lines,Mn.IF_CHECK,n.done),n.lines.forEach(i=>{switch(i.type){case Mn.BREAK:i.goto=t;break;case Mn.CONTINUE:i.goto=e;break}r.add(Gi(i))}),r}case Mn.REPEAT:{const e=Rg(n.loop),t=Rg(n.done),r=Mi(n,"");return pE(n.lines,Mn.IF_CHECK,n.done),n.lines.forEach(i=>{switch(i.type){case Mn.BREAK:i.goto=t;break;case Mn.CONTINUE:i.goto=e;break}r.add(Gi(i))}),r}case Mn.WAITFOR:{const e=Mi(n,"");return pE(n.lines,Mn.IF_CHECK,n.loop),n.lines.forEach(t=>{e.add(Gi(t))}),e}case Mn.FOREACH:{const e=Rg(n.loop),t=Rg(n.done),r=Mi(n,"");return pE(n.lines,Mn.IF_CHECK,n.done),n.lines.forEach(i=>{switch(i.type){case Mn.BREAK:i.goto=t;break;case Mn.CONTINUE:i.goto=e;break}r.add(Gi(i))}),r}case Mn.BREAK:return Mi(n,["  ",C2(n,n.goto),`
`]);case Mn.CONTINUE:return Mi(n,["  ",C2(n,n.goto),`
`]);case Mn.OR:return Ec(n,"or",n.items.map(Gi));case Mn.AND:return Ec(n,"and",n.items.map(Gi));case Mn.NOT:return Ec(n,"not",n.items.map(Gi));case Mn.COMPARE:return MTe(n);case Mn.OPERATOR:return OTe(n);case Mn.EXPR:return Ec(n,"expr",n.words.map(Gi));default:return console.error("<unsupported node>",n.type,n),oz(n)}}function Am(n){if(fe(n))switch(n.type===Mn.LINE&&++kh.lineindex,n.lineindex=kh.lineindex,n.type){case Mn.PROGRAM:n.lines.forEach(Am);break;case Mn.LINE:n.stmts.forEach(Am);break;case Mn.MARK:jL(n.id,n.lineindex);break;case Mn.IF:Am(n.check),Am(n.block);break;case Mn.IF_BLOCK:n.lines.forEach(Am),n.altlines.forEach(Am);break;case Mn.ELSE_IF:n.lines.forEach(Am);break;case Mn.ELSE:case Mn.WHILE:case Mn.REPEAT:case Mn.FOREACH:case Mn.WAITFOR:n.lines.forEach(Am);break;case Mn.MOVE:case Mn.COMMAND:case Mn.IF_CHECK:n.words.forEach(Am);break}}function QZ(n){kh.labels={},kh.internal=1,kh.lineindex=0,kh.isfirststat=!0,Am(n)}function ITe(n){return QZ(n),{...Gi(n).toStringWithSourceMap({file:`${_O}.map`}),...kh}}function NTe(n,e){const t=`compile-${n}`;console.time(t);const r=BZ(e);if(console.timeEnd(t),h7&&console.info(e,r.errors),r.errors&&r.errors.length>0)return console.info(e,r.tokens,r.errors),r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=ITe(r.ast);if(i.code){h7&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Function("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Function("api"," ")}}}return{...r,...i,source:"",code:new Function("api"," ")}}function PTe(){const n={},e={};function t(i,s){const o=n[s];if(o)return o;const a=NTe(i,s);return n[s]=a,a}const r={ids(){return Object.keys(e)},isended(i){const s=e[i];return fe(s)?s.isended():!0},scrollunlock(i,s){const o=e[i];fe(o)&&o.scrollunlock(s)},halt(i){const s=e[i];return fe(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=e[i];fe(o)&&o.set("arg",s)},boot(i,s,o,a){let c=e[i];if(!fe(e[i])){const l=t(o,a);if(c=e[i]=dDe(i,s,l),l.errors?.length){const[u]=l.errors,h=(u?.line??2)-1,f=a.replaceAll(`\r
`,"").split(`
`).map((b,y)=>[b,y]),d=f.slice(h-2,h);for(let b=0;b<d.length;++b){const[y,x]=d[b];ur(Ke,Wm(),"build",`$grey${x+1} $grey${y}`)}const[p,_]=f[h]??[];if(rn(p)&&fe(_)){const b=(u.column??1)-1,y=b+u.length,x=b<p.length?p:`${p}*`,T=x.substring(0,b),k=x.substring(b,y),R=x.substring(y);ur(Ke,Wm(),"build",`$red${_+1} $grey${T}$red${k}$grey${R}`)}const g=f.slice(h+1,h+3);for(let b=0;b<g.length;++b){const[y,x]=g[b];ur(Ke,Wm(),"build",`$grey${x+1} $grey${y}`)}const m=u.message.split(`
`).slice(0,4).join(" ");ur(Ke,Wm(),"build",m);return}}return c},tick(i,s,o,a,c){return!!r.boot(i,s,a,c)?.tick(o)},once(i,s,o,a){r.boot(i,s,o,a)?.once(),r.halt(i)},message(i){const{target:s,path:o}=Vv(i.target),a=e[s];if(fe(a)){const c={...i,target:o};a.message(c)}}};return r}const eJ={};function HE(n){return eJ[n]?.content}function DTe(n){return eJ[n]?.format}function Z1(n){return Xn(n)&&typeof n[0]=="string"}function LTe(n){const e=de.words[n];return rn(e)?[e,n+1]:[void 0,n]}function zN(n){const e=de.words[n];if(Z1(e))return[e,n+1];const[t,r]=tk(n),[i,s]=LTe(r);return rn(i)&&(i==="empty"||Ep({kind:i}))?[[i,t],s]:[void 0,n]}function cA(n){if(!Z1(n))return;const[e]=n;return e}function FM(n){if(!Z1(n))return;const[,e]=n,t=fe(e)?QM(e):void 0;return fe(t)?t:void 0}function tJ(n){if(!Z1(n))return;const[,e]=n,t=fe(e)?ek(e):void 0;return fe(t)?cU(t):void 0}function zL(n,e,t,r){if(!fe(n))return!1;const i=zu(n);return!(fe(e)&&e!==i.name||fe(t)&&t!==i.color||fe(r)&&r!==i.bg)}function Gx(n,e){const t=n??kn.ISWALK,r=e??kn.ISWALK;if(t===kn.ISGHOST||r===kn.ISGHOST)return!1;switch(t){case kn.ISWALK:return r!==kn.ISWALK;case kn.ISSWIM:return r!==kn.ISSWIM;case kn.ISSOLID:return!0;case kn.ISBULLET:return r!==kn.ISWALK&&r!==kn.ISSWIM}}function Nw(n,e,t){const r=n?.objects[t];if(fe(r))return r;const i=$x(n,"player");return fe(e)?(e.x<0&&(e.x=Nu(0,dn-1)),e.y<0&&(e.y=Nu(0,_r-1)),rJ(e,i)):md(...i)}function cz(n,e){const t=fe(e)?QM(e):void 0,r=fe(e)?ek(e):void 0,i=[];if(fe(n)){for(let o=0;o<n.terrain.length;++o){const a=n.terrain[o];fe(a)&&zL(a,void 0,t,r)&&i.push(a)}const s=Object.values(n.objects);for(let o=0;o<s.length;++o){const a=s[o];zL(a,void 0,t,r)&&i.push(a)}}return i}function nJ(n,e){return fe(n)?e.map(t=>{if(typeof t=="string"){const r=n.objects[t];if(fe(r))return r;const i=$x(n,Jn(t));if(i.length)return i}else if(Dv(t)&&t.x>=0&&t.x<dn&&t.y>=0&&t.y<_r){const r=t.x+t.y*dn,i=n.lookup?.[r];return fe(i)?n.objects[i]:n.terrain[r]}}).flat().filter(fe):[]}function UTe(n,e,t,r){if(!fe(n))return;fe(n.distmaps)||(n.distmaps={});const i=`${e}.${t.x}.${t.y}.${r.x}.${r.y}`;let s=n.distmaps[i];if(!fe(s)){s=new Array(f0).fill(-2);const o=[{...r}];let a=0;for(;o.length;){const c=o.shift();if(fe(c)&&Q1(c)){const l=bd(c,dn);if(s[l]===-2){const u=qv(n,c.x,c.y);Gx(e,Zr(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}n.distmaps[i]=s}return s}function lz(n,e){return Q1(n)?e[bd(n,dn)]:-1}function jM(n,e){const t=cA(e),r=FM(e),i=tJ(e);return $x(n,t??"").filter(s=>zL(s,t,r,i))}function $x(n,e){const t=n?.named?.[e];return fe(t)?[...t.values()].map(i=>typeof i=="string"?n?.objects[i]:n?.terrain[i]).filter(fe):[]}function BTe(n){const e=[];for(let t=0;t<_r;++t)for(let r=0;r<dn;++r){const i={x:r,y:t},s=ts(n,i);!s?.name&&!s?.kind&&e.push(i)}return e}function rJ(n,e){let t=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=n.x-(s.x??0),a=n.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<t)&&(t=c,r=s)}}return r}function uz(n,e,t,r,i){if(!fe(n))return;const s=UTe(n,e,t,r);if(!fe(s))return;const o=[{x:t.x,y:t.y-1},{x:t.x,y:t.y+1},{x:t.x-1,y:t.y},{x:t.x+1,y:t.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=lz(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=lz(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function ME(n,e,t,r){const i=iJ(e);if(!fe(n)||!fe(i))return!1;const s=Bh(i,e);if(!_s(s)||!s?.id)return!1;const o=vs(t);if(!fe(o))return!1;Rc(o);const a=oU(o,kn.ISWALK,r,!0);if(!fe(a)&&!_s(a)){const c=Zr(a,"collision");if(Gx(kn.ISWALK,c))return!1}return C6(i,s),delete i.objects[s.id],s.x=r.x,s.y=r.y,o.objects[s.id]=s,UL(o,s),UZ(o,s),DL(n,e,"enterx",r.x),DL(n,e,"entery",r.y),zTe(n,e,o.id),!0}function FTe(n){const t=(n?.activelist??[]).map(r=>{const i=BM(n,r,"board");return rn(i)?i:""});return aSe(t)}function jTe(n){const e=FTe(n),t=new Set,r=[];for(let i=0;i<e.length;++i){const s=vs(e[i]);if(fe(s)&&!t.has(s.id)){SDe(s);const o=vs(s.overboard??"");fe(o)&&(t.has(o.id)||r.push(o)),r.push(s)}}return r}function zTe(n,e,t){if(!fe(n))return;DL(n,e,"board",t);const r=vs(t);fe(r)?n.activelist.includes(e)||n.activelist.push(e):n.activelist=n.activelist.filter(i=>i!==e)}function iJ(n){const e=zm(xc.MAIN),t=BM(e,n,"board"),r=Lu(Wr.BOARD,t);return oA(r)}const vO=PTe();function HN(n){vO.halt(n)}function HTe(n){vO.message(n)}function VTe(n,e,t,r){if(!fe(n)||!fe(e)||!fe(t))return;const i={...de};de.book=n,de.board=e,de.element=t,de.elementid=t.id??"",de.elementisplayer=lu(de.elementid);const s=de.element.player??Wm();de.elementfocus=de.elementisplayer?de.elementid:s;const o=Zr(t,"cycle"),a=t.id??"",c=Jn(t.name??t.kinddata?.name??"");if(vO.tick(a,iU.RUNTIME,o,c,r),Xt(t?.tickertime)&&de.timestamp-t.tickertime>tR*5&&(t.tickertime=0,t.tickertext=""),de.elementisplayer){const l=Kg(de.elementid);Xt(l.inputcurrent)&&(l.inputcurrent=0)}n0(i).forEach(l=>{de[l]=i[l]})}function zM(n){const e=Ov(xc.MAIN),t=aA(e,n);if(!fe(e)||!fe(t))return;const r={...de},i=`${n}_run`,s=de.element?.name??de.element?.kinddata?.name??"",o=t?.code??"";vO.once(i,iU.RUNTIME,Jn(s),o),n0(r).forEach(a=>{de[a]=r[a]})}const sJ={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",isghost:"ISGHOST",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};kn.ISSOLID,kn.ISWALK,kn.ISSWIM,kn.ISBULLET,kn.ISGHOST,kn.ISWALK,kn.ISSWIM;function HM(n){return Xn(n)&&HL(n[0])}function HL(n){return fe(kn[n])&&rn(n)}function oJ(n){if(rn(n))return sJ[Jn(n)]}function GTe(n){const e=de.words[n];if(HM(e))return[e,n+1];if(HL(e))return[[e],n+1];const[t,r]=Cu(n);return HM(t)?[t,r]:HL(t)?[[t],r]:[void 0,n]}function ZS(n,e=0){const t=[];let r=n;for(;r<de.words.length;){const[i,s]=Cu(r);if(Xn(i)&&!Od(i)&&!lA(i)&&!HM(i)&&!Mc(i)&&t.push(...i),i==="|")return[t,s];if(r=s,t.push(i),e>0&&t.length>=e)return[t,r]}return[t,r]}function Cu(n){const e=de.words[n],t=n+1;if(I6(e)){const[r,i]=$Te(n);if(fe(r))return[r,i]}if(oJ(e)){const[r,i]=GTe(n);if(fe(r))return[r,i]}if(Ex(e)){const[r,i]=tk(n);if(fe(r))return[r,i]}if(rn(e)&&Jn(e)==="rnd"){const[r,i]=Cu(t),[s,o]=Cu(i);return Xt(r)&&Xt(s)?[Nu(r,s),o]:Xt(r)?[Nu(0,r),i]:[Nu(0,1),t]}if(JA(e)){const[r,i]=HY(n);if(fe(r))return[r,i]}if(!fe(e))return[void 0,n];if(Xt(e)||Xn(e))return[e,t];if(rn(e)){const r=Jn(e),i=de.get?.(e);if(fe(i))return[i,t];switch(r){case"aligned":case"alligned":{const s=Nw(de.board,{x:de.element?.x??-1,y:de.element?.y??-1},de.elementfocus);return!fe(de.element)||!fe(s)?[0,t]:[de.element.x===s.x||de.element.y===s.y?1:0,t]}case"contact":{const s=Nw(de.board,{x:de.element?.x??-1,y:de.element?.y??-1},de.elementfocus);if(!fe(de.element)||!fe(s))return[0,t];const o=(s.x??0)-(de.element?.x??0),a=(s.y??0)-(de.element?.y??0);return[o===0&&Math.abs(a)<2||a===0&&Math.abs(o)<2?1:0,t]}case"blocked":{const[s,o]=It(de.words,t,[pt.DIR]);return[mDe(de.board,de.element,s.destpt)?1:0,o]}case"any":{const[s]=It(de.words,t,[pt.ANY]);if(Od(s)){const[l,u,h]=It(de.words,t,[pt.DIR,pt.COLOR_OR_KIND]);if(l.targets.length){const[d,p]=u,_=[];for(let g=0;g<l.targets.length;++g){const m=l.targets[g],b=["any","at",m.x,m.y,...Xn(p)?p:[],d].filter(x=>x!==void 0),[y]=It(b,0,[pt.ANY]);Xn(y)&&y.length&&_.push(...y)}return[_,h]}let f;switch(l.layer){default:case hn.MID:f=ts(de.board,l.destpt);break;case hn.GROUND:f=qv(de.board,l.destpt.x,l.destpt.y);break}if(fe(f)){const d=zu(f);if(Mc(u))return[QM(u)===d.color||ek(u)===d.bg?[f]:[],h];const p=Jn(cA(u)),_=FM(u);if((p.length&&p!==d.name||fe(_)&&_!==d.color)===!1)return[[f],h]}return[[],h]}const[o,a]=It(de.words,t,[pt.COLOR_OR_KIND]);return Mc(o)?[cz(de.board,o),a]:[jM(de.board,o),a]}case"countof":{const[s]=It(de.words,t,[pt.ANY]);if(Od(s)){const[l,u,h]=It(de.words,t,[pt.DIR,pt.COLOR_OR_KIND]);if(l.targets.length){let d=0;const[p,_]=u;for(let g=0;g<l.targets.length;++g){const m=l.targets[g],b=["countof","at",m.x,m.y,...Xn(_)?_:[],p].filter(x=>x!==void 0),[y]=It(b,0,[pt.ANY]);Xt(y)&&(d+=y)}return[d,h]}let f;switch(l.layer){default:case hn.MID:f=ts(de.board,l.destpt);break;case hn.GROUND:f=qv(de.board,l.destpt.x,l.destpt.y);break}if(fe(f)){const d=zu(f);if(Mc(u))return[QM(u)===d.color||ek(u)===d.bg?1:0,h];const p=Jn(cA(u)),_=FM(u),g=p.length?p===d.name:!0,m=fe(_)?_===d.color:!0;if(g&&m)return[1,h]}return[0,h]}const[o,a]=It(de.words,t,[pt.COLOR_OR_KIND]);return Mc(o)?[cz(de.board,o).length,a]:[jM(de.board,o).length,a]}case"rnd":return[Nu(0,1),t];case"abs":{const[s,o]=It(de.words,t,[pt.NUMBER]);return[Math.abs(s),o]}case"intceil":{const[s,o]=It(de.words,t,[pt.NUMBER]);return[Math.ceil(s),o]}case"intfloor":{const[s,o]=It(de.words,t,[pt.NUMBER]);return[Math.floor(s),o]}case"intround":{const[s,o]=It(de.words,t,[pt.NUMBER]);return[Math.round(s),o]}case"clamp":{const[s,o,a,c]=It(de.words,t,[pt.NUMBER,pt.NUMBER,pt.NUMBER]);return[Ri(s,o,a),c]}case"min":{const[s,o]=ZS(t);return[Math.min(...s),o]}case"max":{const[s,o]=ZS(t);return[Math.max(...s),o]}case"pick":{const[s,o]=ZS(t);return[md(s),o]}case"pickwith":{const[s,o]=It(de.words,t,[pt.NUMBER_OR_STRING]),[a,c]=ZS(o);return[oSe(`${s}`,a),c]}case"random":{const[s,o]=ZS(t,2),[a,c]=s;return[Nu(a,c??0),o]}case"randomwith":{const[s,o]=It(de.words,t,[pt.NUMBER_OR_STRING]),[a,c]=ZS(o,2),[l,u]=a;return[uY(`${s}`,l,u??0),c]}case"run":{const[s,o]=It(de.words,t,[pt.NAME]);return zM(s),[de.get?.("arg"),o]}case"runwith":{const[s,o,a]=It(de.words,t,[pt.ANY,pt.NAME]);return fe(de.element)&&(de.element.arg=s),zM(o),[de.get?.("arg"),a]}}}return[e,t]}const aJ={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function lA(n){return Xn(n)&&cJ(n[0])}function cJ(n){return fe(sb[n])&&rn(n)}function I6(n){if(rn(n))return aJ[Jn(n)]}function hz(n){if(lA(n))return n;if(cJ(n))return[n];const e=I6(n);if(fe(e))return[e]}function $Te(n){const e=de.words[n],t=hz(e);if(lA(t))return[t,n+1];const[r,i]=Cu(n),s=hz(r);return lA(s)?[s,i]:[void 0,n]}function Ah(n,e,t,r){const[i,s]=It(r,0,[pt.NUMBER_OR_STRING,pt.MAYBE_NUMBER_OR_STRING]);RY(Ke,n,e,t,i,s)}const WTe=["echo","reverb","autofilter","distortion","vibrato","fc","fcrush","autowah"];function N6(n,e,t){const[r,i]=It(t,0,[pt.NUMBER_OR_STRING]);if(Xt(r))OI(Ke,n,e,"volume",r);else if(WTe.includes(Jn(r))){const[s,o]=It(t,i,[pt.NUMBER_OR_STRING,pt.MAYBE_NUMBER_OR_STRING]);RY(Ke,n,e,r,s,o)}else{const[s]=It(t,i,[pt.MAYBE_NUMBER_OR_STRING]);if(Xt(s)){const o=t.length-i,a=new Array(o).fill(pt.NUMBER),c=It(t,i,a).slice(0,o),l=c.length===1?c[0]:c;OI(Ke,n,e,r,l)}else{const[o]=It(t,i,[pt.MAYBE_NUMBER_OR_STRING]);OI(Ke,n,e,r,o)}}}function lJ(n,e){const[t]=It(e,0,[pt.MAYBE_NAME]);let r="";if(rn(t)){const i=n.get(t);r=rn(i)&&!fe(I6(i))&&!fe(oJ(i))&&!fe(Ex(i))&&!fe(JA(i))?i:t}return r}function fv(n,e,t){eEe(Ke,de.elementfocus,de.board?.id??"",lJ(n,e),t)}const yO=d_().command("ttsengine",(n,e)=>{const[t,r]=It(e,0,[pt.STRING,pt.MAYBE_STRING]);return sEe(Ke,de.elementfocus,t,r??""),0}).command("tts",(n,e)=>{const[t,r]=It(e,0,[pt.MAYBE_NUMBER_OR_STRING,pt.MAYBE_STRING]);return fe(t)&&fe(r)?oEe(Ke,de.elementfocus,de.board?.id??"",t,r):rn(t)?aEe(Ke,de.elementfocus,t):lEe(Ke,de.elementfocus),0}).command("ttsqueue",(n,e)=>{const[t,r]=It(e,0,[pt.NUMBER_OR_STRING,pt.STRING]);return cEe(Ke,de.elementfocus,de.board?.id??"",t,r),0}).command("bpm",(n,e)=>{const[t]=It(e,0,[pt.NUMBER]);return tEe(Ke,de.elementfocus,t),0}).command("vol",(n,e)=>{const[t]=It(e,0,[pt.NUMBER]);return nEe(Ke,de.elementfocus,t),0}).command("bgvol",(n,e)=>{const[t]=It(e,0,[pt.NUMBER]);return rEe(Ke,de.elementfocus,t),0}).command("ttsvol",(n,e)=>{const[t]=It(e,0,[pt.NUMBER]);return iEe(Ke,de.elementfocus,t),0}).command("play",(n,e)=>(QSe(Ke,de.elementfocus,de.board?.id??"",lJ(n,e)),0)).command("bgplay",(n,e)=>(fv(n,e,""),0)).command("bgplayon64n",(n,e)=>(fv(n,e,"@64n"),0)).command("bgplayon32n",(n,e)=>(fv(n,e,"@32n"),0)).command("bgplayon16n",(n,e)=>(fv(n,e,"@16n"),0)).command("bgplayon8n",(n,e)=>(fv(n,e,"@8n"),0)).command("bgplayon4n",(n,e)=>(fv(n,e,"@4n"),0)).command("bgplayon2n",(n,e)=>(fv(n,e,"@2n"),0)).command("bgplayon1n",(n,e)=>(fv(n,e,"@1m"),0)).command("synth",(n,e)=>{if(e.length===0)return JSe(Ke,de.elementfocus),0;for(let t=0;t<4;++t)N6(de.elementfocus,t,e);return 0}).command("synthrecord",(n,e)=>{const[t]=It(e,0,[pt.MAYBE_STRING]);return uEe(Ke,de.elementfocus,t??""),0}).command("synthflush",()=>(hEe(Ke,de.elementfocus),0)).command("echo",(n,e)=>{for(let t=0;t<2;++t)Ah(de.elementfocus,t,"echo",e);return 0}).command("fcrush",(n,e)=>{for(let t=0;t<2;++t)Ah(de.elementfocus,t,"fc",e);return 0}).command("autofilter",(n,e)=>{for(let t=0;t<2;++t)Ah(de.elementfocus,t,"autofilter",e);return 0}).command("reverb",(n,e)=>{for(let t=0;t<2;++t)Ah(de.elementfocus,t,"reverb",e);return 0}).command("distort",(n,e)=>{for(let t=0;t<2;++t)Ah(de.elementfocus,t,"distort",e);return 0}).command("vibrato",(n,e)=>{for(let t=0;t<2;++t)Ah(de.elementfocus,t,"vibrato",e);return 0}).command("autowah",(n,e)=>{for(let t=0;t<2;++t)Ah(de.elementfocus,t,"autowah",e);return 0});for(let n=0;n<4;++n)yO.command(`synth${n+1}`,(e,t)=>(N6(de.elementfocus,n,t),0));yO.command("synth5",(n,e)=>{for(let t=4;t<8;++t)N6(de.elementfocus,t,e);return 0});for(let n=0;n<3;++n){const e=n+1;yO.command(`echo${e}`,(t,r)=>(Ah(de.elementfocus,n,"echo",r),0)).command(`fcrush${e}`,(t,r)=>(Ah(de.elementfocus,n,"fcrush",r),0)).command(`autofilter${e}`,(t,r)=>(Ah(de.elementfocus,n,"autofilter",r),0)).command(`reverb${e}`,(t,r)=>(Ah(de.elementfocus,n,"reverb",r),0)).command(`distort${e}`,(t,r)=>(Ah(de.elementfocus,n,"distort",r),0)).command(`vibrato${e}`,(t,r)=>(Ah(de.elementfocus,n,"vibrato",r),0)).command(`autowah${e}`,(t,r)=>(Ah(de.elementfocus,n,"autowah",r),0))}function fz(n,e,t,r){for(let i=t.y;i<=r.y;++i)for(let s=t.x;s<=r.x;++s){const o=ts(e,{x:s,y:i});_s(o)&&Ad(e,o,n.timestamp),au(e,{x:s,y:i})}}function qTe(n,e,t){for(let r=e.y;r<=t.y;++r)for(let i=e.x;i<=t.x;++i)au(n,{x:i,y:r})}function dz(n,e,t,r){for(let i=t.y;i<=r.y;++i)for(let s=t.x;s<=r.x;++s){const o=ts(e,{x:s,y:i});_s(o)&&Ad(e,o,n.timestamp),au(e,{x:s,y:i})}}function fb(n,e){fe(n)&&(n.name=e.name,n.char=e.char,n.color=e.color,n.bg=e.bg,n.displaychar=e.displaychar,n.displaycolor=e.displaycolor,n.displaybg=e.displaybg,n.p1=e.p1,n.p2=e.p2,n.p3=e.p3,n.p4=e.p4,n.p5=e.p5,n.p6=e.p6,n.p7=e.p7,n.p8=e.p8,n.p9=e.p9,n.p10=e.p10,n.code=e.code,n.item=e.item,n.group=e.group,n.party=e.party,n.cycle=e.cycle,n.light=e.light,n.lightdir=e.lightdir,n.stepx=e.stepx,n.stepy=e.stepy,n.shootx=e.shootx,n.shooty=e.shooty,n.pushable=e.pushable,n.collision=e.collision,n.breakable=e.breakable,n.tickertext=e.tickertext,n.tickertime=e.tickertime)}function bO(n,e,t,r,i){switch(i){case"all":case"object":case"terrain":break;default:return YTe(n,e,t,"",i)}if(!fe(de.book))return;const s=de.book,o=vs(n);if(!fe(o))return;const a=vs(e);if(!fe(a))return;Rc(o),Rc(a);let c=!1;if(fe(o)&&fe(a)){switch(i){case"all":fz(s,a,t,r);break;case"object":dz(s,a,t,r);break;case"terrain":qTe(a,t,r);break;default:c=!0;break}for(let l=t.y;l<=r.y;++l)for(let u=t.x;u<=r.x;++u){let h=!1,f=!1;switch(i){case"all":h=!0,f=!0;break;case"object":h=!0;break;case"terrain":f=!0;break}const d={x:u,y:l};let p,_=ts(o,d);if(_s(_)?(p=qv(o,u,l),lu(_?.id)&&(_=void 0)):(p=_,_=void 0),fe(p)&&(f||c&&Zr(p,"group")===i)){c&&fz(s,a,d,d);const g=wd(a,[p.kind??""],d);fb(g,p)}if(fe(_)&&(h||c&&Zr(_,"group")===i)){c&&dz(s,a,d,d);const g=wd(a,[_.kind??""],d);fb(g,_)}}Rc(a)}}function YTe(n,e,t,r,i){if(!fe(de.book))return;const s=de.book,o=vs(n);if(!fe(o))return;const a=vs(e);if(fe(a)&&(Rc(o),Rc(a),fe(o)&&fe(a))){const{terrainelements:c,objectelements:l}=UQ(o,r,i);if(c.length===0&&l.length===0)return;const u={x:dn,y:_r};for(let h=0;h<c.length;++h){const f=c[h];Xt(f.x)&&(u.x=Math.min(u.x,f.x)),Xt(f.y)&&(u.y=Math.min(u.y,f.y))}for(let h=0;h<l.length;++h){const f=l[h];Xt(f.x)&&(u.x=Math.min(u.x,f.x)),Xt(f.y)&&(u.y=Math.min(u.y,f.y))}for(let h=0;h<c.length;++h){const f=c[h],d={x:t.x+(f.x??0)-u.x,y:t.y+(f.y??0)-u.y},p=ts(a,d);fe(p)&&(_s(p)&&Ad(a,p,s.timestamp),au(a,d));const _=wd(a,[f.kind??""],d);fb(_,f)}for(let h=0;h<l.length;++h){const f=l[h],d={x:t.x+(f.x??0)-u.x,y:t.y+(f.y??0)-u.y},p=wd(a,[f.kind??""],d);fb(p,f)}Rc(a)}}function M2(n,e,t){if(!fe(de.element?.x)||!fe(de.element.y))return 0;if(de.elementisplayer){const c=de.board?.maxplayershots??0;if(c>0&&yDe(de.board).filter(u=>!u.removed&&lu(u.party)&&Zr(u,"collision")===kn.ISBULLET).length>=c)return n.set("didshoot",0),n.yield(),0}const[r,i]=It(e,0,[pt.DIR,pt.MAYBE_KIND]),[s]=i??[];if(Jn(s)==="player")return n.set("didshoot",0),n.yield(),0;de.element.shootx=Ri(r.destpt.x-r.startpt.x,-1,1),de.element.shooty=Ri(r.destpt.y-r.startpt.y,-1,1);const o=i??["bullet"],a=bxe(de.board,o,{x:de.element.x,y:de.element.y});if(fe(a)){fe(t)&&(a.arg=t),a.cycle=1,a.party=de.element.party??de.element.id??"",a.collision=kn.ISBULLET,a.breakable=1,a.stepx=r.destpt.x-de.element.x,a.stepy=r.destpt.y-de.element.y,a.bg=Bt.ONCLEAR;const c=Ep(a),l=a.code??c?.code??"";VTe(de.book,de.board,a,l)}return de.elementisplayer&&n.set("didshoot",fe(a)?1:0),n.yield(),0}function Sw(n,e,t){if(!Dv(de.element)||!fe(de.book)||!fe(de.board)||!fe(de.element))return 0;const[r,i]=It(n,0,[pt.DIR,pt.KIND]),[s]=i;if(Jn(s)==="player")return 0;if(r.targets.length){for(let f=0;f<r.targets.length;++f){const d=r.targets[f];Sw(["at",d.x,d.y,...i],e,t)}return 0}const{destpt:o}=r;if(o.x<0||o.x>=dn||o.y<0||o.y>=_r)return 0;const[a]=i,c={x:de.element?.x??0,y:de.element?.y??0},l=Ep({kind:a});if(Zr(l,"collision")===kn.ISGHOST)return wd(de.board,i,r.destpt,e),0;let h=ts(de.board,r.destpt);if(_s(h)&&Zr(h,"pushable")){const f=Us(r.destpt),d=$o(f,fp(c,f));xf(de.book,de.board,h,d),h=ts(de.board,r.destpt)}if(a==="empty")return Ad(de.board,h,de.timestamp),0;if(h?.kind===a){const[,f]=i;return W1(h,f),0}if(_s(h)&&Ad(de.board,h,de.timestamp),_s(l)||wd(de.board,i,r.destpt,e),_s(l)){const f=wd(de.board,i,r.destpt,e);fe(f)&&fe(t)&&(f.arg=t)}return 0}function k2(n,e,t){if(!fe(de.book)||!fe(de.board))return 1;const[r,i]=It(e,0,[pt.DIR,pt.DIR]),s=ts(de.board,r.destpt);if(fe(s)&&fe(s.kind)){const[o]=s.kind;if(Jn(o)==="player")return 1;const a=Zr(s,"collision"),c=oU(de.board,a,i.destpt);if(fe(c))return 1;const l=wd(de.board,[s.kind],i.destpt);if(!fe(l))return 1;fb(l,s),fe(t)&&(l.arg=t)}else return 1;return 0}const KTe={x:0,y:0},XTe={x:dn-1,y:_r-1},ZTe="all",JTe=d_().command("build",(n,e)=>{if(!fe(de.book)||!fe(de.board)||!fe(de.element))return 0;const[t,r]=It(e,0,[pt.NAME,pt.MAYBE_STRING]),[i]=yxe(xc.TEMP,Ko(),Wr.BOARD);if(!fe(i))return 0;const s=oA(i);if(!fe(s))return 0;if(rn(r)){const o=vs(r);if(fe(o))switch(bO(o.id,s.id,KTe,XTe,ZTe),s.isdark=o.isdark,s.startx=o.startx,s.starty=o.starty,s.over=o.over,s.under=o.under,s.camera=o.camera,s.graphics=o.graphics,s.facing=o.facing,s.charset=o.charset,s.palette=o.palette,s.timelimit=o.timelimit,s.restartonzap=o.restartonzap,s.maxplayershots=o.maxplayershots,s.b1=o.b1,s.b2=o.b2,s.b3=o.b3,s.b4=o.b4,s.b5=o.b5,s.b6=o.b6,s.b7=o.b7,s.b8=o.b8,s.b9=o.b9,s.b10=o.b10,Jn(t)){case"exitwest":s.exiteast=de.board.id;break;case"exiteast":s.exitwest=de.board.id;break;case"exitnorth":s.exitsouth=de.board.id;break;case"exitsouth":s.exitnorth=de.board.id;break}}return n.set(t,s.id),0}).command("goto",(n,e)=>{if(!fe(de.book)||!fe(de.board))return 0;const[t,r]=It(e,0,[pt.STRING]),[i,s]=It(e,r,[pt.MAYBE_NUMBER,pt.MAYBE_NUMBER]),o=vs(t);if(!fe(o))return 0;Rc(o);const a={x:i??o.startx??Math.round(dn*.5),y:s??o.starty??Math.round(_r*.5)},c=zu(de.element);if(c.name!=="player"){const l=Zr(de.element,"color"),u=Zr(de.element,"bg"),h=MO(l,u),f=jM(o,[c.name,h]),[d]=f.sort((p,_)=>{const g=p.y??1e4,m=_.y??1e4,b=g-m;if(b!==0)return b;const y=p.x??1e4,x=_.x??1e4;return y-x});fe(d)&&Xt(d.x)&&Xt(d.y)&&(a.x=d.x,a.y=d.y)}return ME(de.book,de.elementfocus,o.id,a),0}).command("transport",(n,e)=>{if(!fe(de.book)||!fe(de.board)||!fe(de.element))return 0;const[t]=It(e,0,[pt.STRING]),r=Bh(de.board,t);if(fe(de.element?.x)&&fe(de.element.y)&&fe(r?.x)&&fe(r.y)){let i=!0;const s={x:de.element.x,y:de.element.y},o=s.x-r.x,a=s.y-r.y;if(Zr(de.element,"shootx")!==o||Zr(de.element,"shooty")!==a)return 0;for(;i&&(s.x+=o,s.y+=a,!(s.x<0||s.x>=dn||s.y<0||s.y>=_r));){const c=ts(de.board,s);c?.kind===de.element.kind&&Zr(c,"shootx")===-o&&Zr(c,"shooty")===-a&&xf(de.book,de.board,r,{x:s.x+o,y:s.y+a})&&(i=!1)}i&&xf(de.book,de.board,r,{x:de.element.x+o,y:de.element.y+a})}return 0}).command("shove",(n,e)=>{if(!fe(de.book)||!fe(de.board))return 0;const[t,r]=It(e,0,[pt.DIR,pt.DIR]),i=ts(de.board,t.destpt);if(_s(i)){const s=t.destpt.x+(r.destpt.x-r.startpt.x),o=t.destpt.y+(r.destpt.y-r.startpt.y);xf(de.book,de.board,i,{x:s,y:o})}return 0}).command("push",(n,e)=>{if(!fe(de.book)||!fe(de.board))return 0;const[t,r]=It(e,0,[pt.DIR,pt.DIR]),i=ts(de.board,t.destpt);if(_s(i)&&Zr(i,"pushable")){const s=t.destpt.x+(r.destpt.x-r.startpt.x),o=t.destpt.y+(r.destpt.y-r.startpt.y);xf(de.book,de.board,i,{x:s,y:o})}return 0}).command("duplicate",k2).command("duplicatewith",(n,e)=>{const[t,r]=It(e,0,[pt.ANY]);return k2(e.slice(r),t)}).command("dupe",k2).command("dupewith",(n,e)=>{const[t,r]=It(e,0,[pt.ANY]);return k2(e.slice(r),t)}).command("write",(n,e)=>{if(!fe(de.book)||!fe(de.board))return 0;const[t,r,i]=It(e,0,[pt.DIR,pt.COLOR]),s=e.slice(i).map(mo).join(" "),{color:o,bg:a}=kE(r),c=b0(s,256,1)?.measuredwidth??1,l=g_(256,1,o??Bt.WHITE,a??Bt.BLACK);qr(s,l,!1);const u=c-1;switch(fp(t.startpt,t.destpt)){case hn.EAST:for(let f=0;f<c;++f)au(de.board,{x:t.destpt.x+f,y:t.destpt.y,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case hn.WEST:for(let f=0;f<c;++f)au(de.board,{x:t.destpt.x+f-u,y:t.destpt.y,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case hn.NORTH:for(let f=0;f<c;++f)au(de.board,{x:t.destpt.x,y:t.destpt.y+f-u,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case hn.SOUTH:for(let f=0;f<c;++f)au(de.board,{x:t.destpt.x,y:t.destpt.y+f,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break}return 0}).command("change",(n,e)=>{if(!fe(de.book)||!fe(de.board))return 0;const[t,r]=It(e,0,[pt.KIND,pt.KIND]),[i]=t,[s]=r;if(Jn(i)==="player"||Jn(s)==="player")return 0;(cA(t)??"")==="empty"&&BTe(de.board).forEach(u=>{wd(de.board,r,u)});const a=cA(r),c=FM(r),l=tJ(r);return jM(de.board,t).forEach(u=>{if(fe(c)&&(u.color=c),fe(l)&&(u.bg=l),zu(u).name!==a){const f=Zr(u,"color"),d=Zr(u,"bg");if(Ad(de.board,u,de.timestamp),a!=="empty"){const p={x:u.x??0,y:u.y??0},_=wd(de.board,r,p);fe(_)&&(_.color=f,_.bg=d)}}}),0}).command("put",(n,e)=>Sw(e)).command("putwith",(n,e)=>{const[t,r]=It(e,0,[pt.ANY]);return Sw(e.slice(r),void 0,t)}).command("oneof",(n,e)=>{const[t,r]=It(e,0,[pt.ANY]);return fe(de.board)&&Bh(de.board,t)?0:Sw(e.slice(r),t)}).command("oneofwith",(n,e)=>{const[t,r,i]=It(e,0,[pt.ANY,pt.ANY]);return fe(de.board)&&Bh(de.board,r)?0:Sw(e.slice(i),r,t)}).command("shoot",M2).command("shootwith",(n,e)=>{const[t,r]=It(e,0,[pt.ANY]);return M2(n,e.slice(r),t)}).command("throwstar",(n,e)=>M2(n,[...e,"star"])).command("throwstarwith",(n,e)=>{const[t,r]=It(e,0,[pt.ANY]);return M2(n,[...e.slice(r),"star"],t)}),vp=()=>new Map,VL=n=>{const e=vp();return n.forEach((t,r)=>{e.set(r,t)}),e},ny=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},QTe=(n,e)=>{const t=[];for(const[r,i]of n)t.push(e(i,r));return t},ewe=(n,e)=>{for(const[t,r]of n)if(e(r,t))return!0;return!1},fx=()=>new Set,VN=n=>n[n.length-1],twe=(n,e)=>{for(let t=0;t<e.length;t++)n.push(e[t])},db=Array.from,nwe=(n,e)=>{for(let t=0;t<n.length;t++)if(e(n[t],t,n))return!0;return!1},GL=Array.isArray;class uJ{constructor(){this._observers=vp()}on(e,t){return ny(this._observers,e,fx).add(t),t}once(e,t){const r=(...i)=>{this.off(e,r),t(...i)};this.on(e,r)}off(e,t){const r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return db((this._observers.get(e)||vp()).values()).forEach(r=>r(...t))}destroy(){this._observers=vp()}}const Gv=Math.floor,NC=Math.abs,hJ=(n,e)=>n<e?n:e,Lb=(n,e)=>n>e?n:e,fJ=n=>n!==0?n<0:1/n<0,pz=1,mz=2,GN=4,$N=8,uA=32,Xg=64,kf=128,SO=31,$L=63,J1=127,rwe=2147483647,dJ=Number.MAX_SAFE_INTEGER,iwe=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&Gv(n)===n),swe=n=>n.toLowerCase(),owe=/^\s*/g,awe=n=>n.replace(owe,""),cwe=/([A-Z])/g,gz=(n,e)=>awe(n.replace(cwe,t=>`${e}${swe(t)}`)),lwe=n=>{const e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.codePointAt(i);return r},hA=typeof TextEncoder<"u"?new TextEncoder:null,uwe=n=>hA.encode(n),hwe=hA?uwe:lwe;let Pw=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Pw&&Pw.decode(new Uint8Array).length===1&&(Pw=null);class nR{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const EO=()=>new nR,fwe=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e},qm=n=>{const e=new Uint8Array(fwe(n));let t=0;for(let r=0;r<n.bufs.length;r++){const i=n.bufs[r];e.set(i,t),t+=i.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},dwe=(n,e)=>{const t=n.cbuf.length;t-n.cpos<e&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(Lb(t,e)*2),n.cpos=0)},nl=(n,e)=>{const t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e},WL=nl,Hi=(n,e)=>{for(;e>J1;)nl(n,kf|J1&e),e=Gv(e/128);nl(n,J1&e)},P6=(n,e)=>{const t=fJ(e);for(t&&(e=-e),nl(n,(e>$L?kf:0)|(t?Xg:0)|$L&e),e=Gv(e/64);e>0;)nl(n,(e>J1?kf:0)|J1&e),e=Gv(e/128)},qL=new Uint8Array(3e4),pwe=qL.length/3,mwe=(n,e)=>{if(e.length<pwe){const t=hA.encodeInto(e,qL).written||0;Hi(n,t);for(let r=0;r<t;r++)nl(n,qL[r])}else vf(n,hwe(e))},gwe=(n,e)=>{const t=unescape(encodeURIComponent(e)),r=t.length;Hi(n,r);for(let i=0;i<r;i++)nl(n,t.codePointAt(i))},VE=hA&&hA.encodeInto?mwe:gwe,xO=(n,e)=>{const t=n.cbuf.length,r=n.cpos,i=hJ(t-r,e.length),s=e.length-i;n.cbuf.set(e.subarray(0,i),r),n.cpos+=i,s>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(Lb(t*2,s)),n.cbuf.set(e.subarray(i)),n.cpos=s)},vf=(n,e)=>{Hi(n,e.byteLength),xO(n,e)},D6=(n,e)=>{dwe(n,e);const t=new DataView(n.cbuf.buffer,n.cpos,e);return n.cpos+=e,t},_we=(n,e)=>D6(n,4).setFloat32(0,e,!1),vwe=(n,e)=>D6(n,8).setFloat64(0,e,!1),ywe=(n,e)=>D6(n,8).setBigInt64(0,e,!1),_z=new DataView(new ArrayBuffer(4)),bwe=n=>(_z.setFloat32(0,n),_z.getFloat32(0)===n),fA=(n,e)=>{switch(typeof e){case"string":nl(n,119),VE(n,e);break;case"number":iwe(e)&&NC(e)<=rwe?(nl(n,125),P6(n,e)):bwe(e)?(nl(n,124),_we(n,e)):(nl(n,123),vwe(n,e));break;case"bigint":nl(n,122),ywe(n,e);break;case"object":if(e===null)nl(n,126);else if(GL(e)){nl(n,117),Hi(n,e.length);for(let t=0;t<e.length;t++)fA(n,e[t])}else if(e instanceof Uint8Array)nl(n,116),vf(n,e);else{nl(n,118);const t=Object.keys(e);Hi(n,t.length);for(let r=0;r<t.length;r++){const i=t[r];VE(n,i),fA(n,e[i])}}break;case"boolean":nl(n,e?120:121);break;default:nl(n,127)}};class vz extends nR{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Hi(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const yz=n=>{n.count>0&&(P6(n.encoder,n.count===1?n.s:-n.s),n.count>1&&Hi(n.encoder,n.count-2))};class PC{constructor(){this.encoder=new nR,this.s=0,this.count=0}write(e){this.s===e?this.count++:(yz(this),this.count=1,this.s=e)}toUint8Array(){return yz(this),qm(this.encoder)}}const bz=n=>{if(n.count>0){const e=n.diff*2+(n.count===1?0:1);P6(n.encoder,e),n.count>1&&Hi(n.encoder,n.count-2)}};class WN{constructor(){this.encoder=new nR,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(bz(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return bz(this),qm(this.encoder)}}class Swe{constructor(){this.sarr=[],this.s="",this.lensE=new PC}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new nR;return this.sarr.push(this.s),this.s="",VE(e,this.sarr.join("")),xO(e,this.lensE.toUint8Array()),qm(e)}}const $v=n=>new Error(n),Jm=()=>{throw $v("Method unimplemented")},s0=()=>{throw $v("Unexpected case")},pJ=$v("Unexpected end of array"),mJ=$v("Integer out of Range");let TO=class{constructor(e){this.arr=e,this.pos=0}};const Wx=n=>new TO(n),Ewe=n=>n.pos!==n.arr.length,xwe=(n,e)=>{const t=new Uint8Array(n.arr.buffer,n.pos+n.arr.byteOffset,e);return n.pos+=e,t},yf=n=>xwe(n,yi(n)),dx=n=>n.arr[n.pos++],yi=n=>{let e=0,t=1;const r=n.arr.length;for(;n.pos<r;){const i=n.arr[n.pos++];if(e=e+(i&J1)*t,t*=128,i<kf)return e;if(e>dJ)throw mJ}throw pJ},L6=n=>{let e=n.arr[n.pos++],t=e&$L,r=64;const i=(e&Xg)>0?-1:1;if((e&kf)===0)return i*t;const s=n.arr.length;for(;n.pos<s;){if(e=n.arr[n.pos++],t=t+(e&J1)*r,r*=128,e<kf)return i*t;if(t>dJ)throw mJ}throw pJ},Twe=n=>{let e=yi(n);if(e===0)return"";{let t=String.fromCodePoint(dx(n));if(--e<100)for(;e--;)t+=String.fromCodePoint(dx(n));else for(;e>0;){const r=e<1e4?e:1e4,i=n.arr.subarray(n.pos,n.pos+r);n.pos+=r,t+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(t))}},wwe=n=>Pw.decode(yf(n)),GE=Pw?wwe:Twe,U6=(n,e)=>{const t=new DataView(n.arr.buffer,n.arr.byteOffset+n.pos,e);return n.pos+=e,t},Awe=n=>U6(n,4).getFloat32(0,!1),Rwe=n=>U6(n,8).getFloat64(0,!1),Cwe=n=>U6(n,8).getBigInt64(0,!1),Mwe=[n=>{},n=>null,L6,Awe,Rwe,Cwe,n=>!1,n=>!0,GE,n=>{const e=yi(n),t={};for(let r=0;r<e;r++){const i=GE(n);t[i]=dA(n)}return t},n=>{const e=yi(n),t=[];for(let r=0;r<e;r++)t.push(dA(n));return t},yf],dA=n=>Mwe[127-dx(n)](n);class Sz extends TO{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Ewe(this)?this.count=yi(this)+1:this.count=-1),this.count--,this.s}}class DC extends TO{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=L6(this);const e=fJ(this.s);this.count=1,e&&(this.s=-this.s,this.count=yi(this)+2)}return this.count--,this.s}}class qN extends TO{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=L6(this),t=e&1;this.diff=Gv(e/2),this.count=1,t&&(this.count=yi(this)+2)}return this.s+=this.diff,this.count--,this.s}}class kwe{constructor(e){this.decoder=new DC(e),this.str=GE(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}}const Owe=crypto.getRandomValues.bind(crypto),gJ=()=>Owe(new Uint32Array(1))[0],Iwe="10000000-1000-4000-8000"+-1e11,Nwe=()=>Iwe.replace(/[018]/g,n=>(n^gJ()&15>>n/4).toString(16)),Pwe=Date.now,Ez=n=>new Promise(n);Promise.all.bind(Promise);const xz=n=>n===void 0?null:n;class Dwe{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let _J=new Dwe,Lwe=!0;try{typeof localStorage<"u"&&localStorage&&(_J=localStorage,Lwe=!1)}catch{}const Uwe=_J,Bwe=Object.assign,Fwe=Object.keys,jwe=(n,e)=>{for(const t in n)e(n[t],t)},Tz=n=>Fwe(n).length,zwe=n=>{for(const e in n)return!1;return!0},Hwe=(n,e)=>{for(const t in n)if(!e(n[t],t))return!1;return!0},Vwe=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),Gwe=(n,e)=>n===e||Tz(n)===Tz(e)&&Hwe(n,(t,r)=>(t!==void 0||Vwe(e,r))&&e[r]===t),$we=Object.freeze,vJ=n=>{for(const e in n){const t=n[e];(typeof t=="object"||typeof t=="function")&&vJ(n[e])}return $we(n)},B6=(n,e,t=0)=>{try{for(;t<n.length;t++)n[t](...e)}finally{t<n.length&&B6(n,e,t+1)}},Wwe=n=>n,qwe=(n,e)=>e.includes(n);var yJ={};const pA=typeof oc<"u"&&oc.release&&/node|io\.js/.test(oc.release.name)&&Object.prototype.toString.call(typeof oc<"u"?oc:0)==="[object process]";let Sm;const Ywe=()=>{if(Sm===void 0)if(pA){Sm=vp();const n=oc.argv;let e=null;for(let t=0;t<n.length;t++){const r=n[t];r[0]==="-"?(e!==null&&Sm.set(e,""),e=r):e!==null&&(Sm.set(e,r),e=null)}e!==null&&Sm.set(e,"")}else typeof location=="object"?(Sm=vp(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[e,t]=n.split("=");Sm.set(`--${gz(e,"-")}`,t),Sm.set(`-${gz(e,"-")}`,t)}})):Sm=vp();return Sm},YL=n=>Ywe().has(n),VM=n=>xz(pA?yJ[n.toUpperCase().replaceAll("-","_")]:Uwe.getItem(n)),bJ=n=>YL("--"+n)||VM(n)!==null;bJ("production");const Kwe=pA&&qwe(yJ.FORCE_COLOR,["true","1","2"]),Xwe=Kwe||!YL("--no-colors")&&!bJ("no-color")&&(!pA||oc.stdout.isTTY)&&(!pA||YL("--color")||VM("COLORTERM")!==null||(VM("TERM")||"").includes("color")),Zwe=n=>new Uint8Array(n),Jwe=n=>{const e=Zwe(n.byteLength);return e.set(n),e};class Qwe{constructor(e,t){this.left=e,this.right=t}}const Cg=(n,e)=>new Qwe(n,e);typeof DOMParser<"u"&&new DOMParser;const eAe=n=>QTe(n,(e,t)=>`${t}:${e};`).join(""),p_=Symbol,SJ=p_(),EJ=p_(),tAe=p_(),nAe=p_(),rAe=p_(),xJ=p_(),iAe=p_(),F6=p_(),sAe=p_(),oAe=n=>{n.length===1&&n[0]?.constructor===Function&&(n=n[0]());const e=[],t=[];let r=0;for(;r<n.length;r++){const i=n[r];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(r>0&&t.push(e.join(""));r<n.length;r++){const i=n[r];i instanceof Symbol||t.push(i)}return t},aAe={[SJ]:Cg("font-weight","bold"),[EJ]:Cg("font-weight","normal"),[tAe]:Cg("color","blue"),[rAe]:Cg("color","green"),[nAe]:Cg("color","grey"),[xJ]:Cg("color","red"),[iAe]:Cg("color","purple"),[F6]:Cg("color","orange"),[sAe]:Cg("color","black")},cAe=n=>{n.length===1&&n[0]?.constructor===Function&&(n=n[0]());const e=[],t=[],r=vp();let i=[],s=0;for(;s<n.length;s++){const o=n[s],a=aAe[o];if(a!==void 0)r.set(a.left,a.right);else{if(o===void 0)break;if(o.constructor===String||o.constructor===Number){const c=eAe(r);s>0||c.length>0?(e.push("%c"+o),t.push(c)):e.push(o)}else break}}for(s>0&&(i=t,i.unshift(e.join("")));s<n.length;s++){const o=n[s];o instanceof Symbol||i.push(o)}return i},TJ=Xwe?cAe:oAe,lAe=(...n)=>{console.log(...TJ(n)),AJ.forEach(e=>e.print(n))},wJ=(...n)=>{console.warn(...TJ(n)),n.unshift(F6),AJ.forEach(e=>e.print(n))},AJ=fx(),RJ=n=>({[Symbol.iterator](){return this},next:n}),uAe=(n,e)=>RJ(()=>{let t;do t=n.next();while(!t.done&&!e(t.value));return t}),YN=(n,e)=>RJ(()=>{const{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}});class j6{constructor(e,t){this.clock=e,this.len=t}}class qx{constructor(){this.clients=new Map}}const px=(n,e,t)=>e.clients.forEach((r,i)=>{const s=n.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let c=0,l=r[c];c<r.length&&l.clock<a;l=r[++c])LJ(n,s,l.clock,l.len,t)}}),hAe=(n,e)=>{let t=0,r=n.length-1;for(;t<=r;){const i=Gv((t+r)/2),s=n[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;t=i+1}else r=i-1}return null},rR=(n,e)=>{const t=n.clients.get(e.client);return t!==void 0&&hAe(t,e.clock)!==null},z6=n=>{n.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){const i=e[r-1],s=e[t];i.clock+i.len>=s.clock?i.len=Lb(i.len,s.clock+s.len-i.clock):(r<t&&(e[r]=s),r++)}e.length=r})},KL=n=>{const e=new qx;for(let t=0;t<n.length;t++)n[t].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=t+1;o<n.length;o++)twe(s,n[o].clients.get(i)||[]);e.clients.set(i,s)}});return z6(e),e},mA=(n,e,t,r)=>{ny(n.clients,e,()=>[]).push(new j6(t,r))},fAe=()=>new qx,dAe=n=>{const e=fAe();return n.clients.forEach((t,r)=>{const i=[];for(let s=0;s<t.length;s++){const o=t[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<t.length)for(let l=t[s+1];s+1<t.length&&l.deleted;l=t[++s+1])c+=l.length;i.push(new j6(a,c))}}i.length>0&&e.clients.set(r,i)}),e},Yx=(n,e)=>{Hi(n.restEncoder,e.clients.size),db(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{n.resetDsCurVal(),Hi(n.restEncoder,t);const i=r.length;Hi(n.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];n.writeDsClock(o.clock),n.writeDsLen(o.len)}})},H6=n=>{const e=new qx,t=yi(n.restDecoder);for(let r=0;r<t;r++){n.resetDsCurVal();const i=yi(n.restDecoder),s=yi(n.restDecoder);if(s>0){const o=ny(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new j6(n.readDsClock(),n.readDsLen()))}}return e},wz=(n,e,t)=>{const r=new qx,i=yi(n.restDecoder);for(let s=0;s<i;s++){n.resetDsCurVal();const o=yi(n.restDecoder),a=yi(n.restDecoder),c=t.clients.get(o)||[],l=Cc(t,o);for(let u=0;u<a;u++){const h=n.readDsClock(),f=h+n.readDsLen();if(h<l){l<f&&mA(r,o,l,f-l);let d=o0(c,h),p=c[d];for(!p.deleted&&p.id.clock<h&&(c.splice(d+1,0,ZM(e,p,h-p.id.clock)),d++);d<c.length&&(p=c[d++],p.id.clock<f);)p.deleted||(f<p.id.clock+p.length&&c.splice(d,0,ZM(e,p,f-p.id.clock)),p.delete(e))}else mA(r,o,h,f-h)}}if(r.clients.size>0){const s=new pb;return Hi(s.restEncoder,0),Yx(s,r),s.toUint8Array()}return null},CJ=gJ;class Ub extends uJ{constructor({guid:e=Nwe(),collectionid:t=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=CJ(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new PJ,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Ez(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Ez(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Bs(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(db(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Bs(this,e,t)}get(e,t=ul){const r=ny(this.share,e,()=>{const s=new t;return s._integrate(this,null),s}),i=r.constructor;if(t!==ul&&i!==t)if(i===ul){const s=new t;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,WE)}getText(e=""){return this.get(e,a0)}getMap(e=""){return this.get(e,gx)}getXmlElement(e=""){return this.get(e,_x)}getXmlFragment(e=""){return this.get(e,mb)}toJSON(){const e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){this.isDestroyed=!0,db(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new Ub({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Bs(e.parent.doc,r=>{const i=t.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class MJ{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return yi(this.restDecoder)}readDsLen(){return yi(this.restDecoder)}}class kJ extends MJ{readLeftID(){return bi(yi(this.restDecoder),yi(this.restDecoder))}readRightID(){return bi(yi(this.restDecoder),yi(this.restDecoder))}readClient(){return yi(this.restDecoder)}readInfo(){return dx(this.restDecoder)}readString(){return GE(this.restDecoder)}readParentInfo(){return yi(this.restDecoder)===1}readTypeRef(){return yi(this.restDecoder)}readLen(){return yi(this.restDecoder)}readAny(){return dA(this.restDecoder)}readBuf(){return Jwe(yf(this.restDecoder))}readJSON(){return JSON.parse(GE(this.restDecoder))}readKey(){return GE(this.restDecoder)}}class pAe{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=yi(this.restDecoder),this.dsCurrVal}readDsLen(){const e=yi(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class mx extends pAe{constructor(e){super(e),this.keys=[],yi(e),this.keyClockDecoder=new qN(yf(e)),this.clientDecoder=new DC(yf(e)),this.leftClockDecoder=new qN(yf(e)),this.rightClockDecoder=new qN(yf(e)),this.infoDecoder=new Sz(yf(e),dx),this.stringDecoder=new kwe(yf(e)),this.parentInfoDecoder=new Sz(yf(e),dx),this.typeRefDecoder=new DC(yf(e)),this.lenDecoder=new DC(yf(e))}readLeftID(){return new $E(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new $E(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return dA(this.restDecoder)}readBuf(){return yf(this.restDecoder)}readJSON(){return dA(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class mAe{constructor(){this.restEncoder=EO()}toUint8Array(){return qm(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Hi(this.restEncoder,e)}writeDsLen(e){Hi(this.restEncoder,e)}}class iR extends mAe{writeLeftID(e){Hi(this.restEncoder,e.client),Hi(this.restEncoder,e.clock)}writeRightID(e){Hi(this.restEncoder,e.client),Hi(this.restEncoder,e.clock)}writeClient(e){Hi(this.restEncoder,e)}writeInfo(e){WL(this.restEncoder,e)}writeString(e){VE(this.restEncoder,e)}writeParentInfo(e){Hi(this.restEncoder,e?1:0)}writeTypeRef(e){Hi(this.restEncoder,e)}writeLen(e){Hi(this.restEncoder,e)}writeAny(e){fA(this.restEncoder,e)}writeBuf(e){vf(this.restEncoder,e)}writeJSON(e){VE(this.restEncoder,JSON.stringify(e))}writeKey(e){VE(this.restEncoder,e)}}class gAe{constructor(){this.restEncoder=EO(),this.dsCurrVal=0}toUint8Array(){return qm(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,Hi(this.restEncoder,t)}writeDsLen(e){e===0&&s0(),Hi(this.restEncoder,e-1),this.dsCurrVal+=e}}class pb extends gAe{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new WN,this.clientEncoder=new PC,this.leftClockEncoder=new WN,this.rightClockEncoder=new WN,this.infoEncoder=new vz(WL),this.stringEncoder=new Swe,this.parentInfoEncoder=new vz(WL),this.typeRefEncoder=new PC,this.lenEncoder=new PC}toUint8Array(){const e=EO();return Hi(e,0),vf(e,this.keyClockEncoder.toUint8Array()),vf(e,this.clientEncoder.toUint8Array()),vf(e,this.leftClockEncoder.toUint8Array()),vf(e,this.rightClockEncoder.toUint8Array()),vf(e,qm(this.infoEncoder)),vf(e,this.stringEncoder.toUint8Array()),vf(e,qm(this.parentInfoEncoder)),vf(e,this.typeRefEncoder.toUint8Array()),vf(e,this.lenEncoder.toUint8Array()),xO(e,qm(this.restEncoder)),qm(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){fA(this.restEncoder,e)}writeBuf(e){vf(this.restEncoder,e)}writeJSON(e){fA(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const _Ae=(n,e,t,r)=>{r=Lb(r,e[0].id.clock);const i=o0(e,r);Hi(n.restEncoder,e.length-i),n.writeClient(t),Hi(n.restEncoder,r);const s=e[i];s.write(n,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(n,0)},V6=(n,e,t)=>{const r=new Map;t.forEach((i,s)=>{Cc(e,s)>i&&r.set(s,i)}),G6(e).forEach((i,s)=>{t.has(s)||r.set(s,0)}),Hi(n.restEncoder,r.size),db(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{_Ae(n,e.clients.get(i),i,s)})},vAe=(n,e)=>{const t=vp(),r=yi(n.restDecoder);for(let i=0;i<r;i++){const s=yi(n.restDecoder),o=new Array(s),a=n.readClient();let c=yi(n.restDecoder);t.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=n.readInfo();switch(SO&u){case 0:{const h=n.readLen();o[l]=new gd(bi(a,c),h),c+=h;break}case 10:{const h=yi(n.restDecoder);o[l]=new _d(bi(a,c),h),c+=h;break}default:{const h=(u&(Xg|kf))===0,f=new go(bi(a,c),null,(u&kf)===kf?n.readLeftID():null,null,(u&Xg)===Xg?n.readRightID():null,h?n.readParentInfo()?e.get(n.readString()):n.readLeftID():null,h&&(u&uA)===uA?n.readString():null,nQ(n,u));o[l]=f,c+=f.length}}}}return t},yAe=(n,e,t)=>{const r=[];let i=db(t.keys()).sort((d,p)=>d-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let d=t.get(i[i.length-1]);for(;d.refs.length===d.i;)if(i.pop(),i.length>0)d=t.get(i[i.length-1]);else return null;return d};let o=s();if(o===null)return null;const a=new PJ,c=new Map,l=(d,p)=>{const _=c.get(d);(_==null||_>p)&&c.set(d,p)};let u=o.refs[o.i++];const h=new Map,f=()=>{for(const d of r){const p=d.id.client,_=t.get(p);_?(_.i--,a.clients.set(p,_.refs.slice(_.i)),t.delete(p),_.i=0,_.refs=[]):a.clients.set(p,[d]),i=i.filter(g=>g!==p)}r.length=0};for(;;){if(u.constructor!==_d){const p=ny(h,u.id.client,()=>Cc(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),f();else{const _=u.getMissing(n,e);if(_!==null){r.push(u);const g=t.get(_)||{refs:[],i:0};if(g.refs.length===g.i)l(_,Cc(e,_)),f();else{u=g.refs[g.i++];continue}}else(p===0||p<u.length)&&(u.integrate(n,p),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const d=new pb;return V6(d,a,new Map),Hi(d.restEncoder,0),{missing:c,update:d.toUint8Array()}}return null},bAe=(n,e)=>V6(n,e.doc.store,e.beforeState),SAe=(n,e,t,r=new mx(n))=>Bs(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=vAe(r,o),l=yAe(i,a,c),u=a.pendingStructs;if(u){for(const[f,d]of u.missing)if(d<Cc(a,f)){s=!0;break}if(l){for(const[f,d]of l.missing){const p=u.missing.get(f);(p==null||p>d)&&u.missing.set(f,d)}u.update=$M([u.update,l.update])}}else a.pendingStructs=l;const h=wz(r,i,a);if(a.pendingDs){const f=new mx(Wx(a.pendingDs));yi(f.restDecoder);const d=wz(f,i,a);h&&d?a.pendingDs=$M([h,d]):a.pendingDs=h||d}else a.pendingDs=h;if(s){const f=a.pendingStructs.update;a.pendingStructs=null,OJ(i.doc,f)}},t,!1),OJ=(n,e,t,r=mx)=>{const i=Wx(e);SAe(i,n,t,new r(i))},Az=(n,e,t)=>OJ(n,e,t,kJ),EAe=(n,e,t=new Map)=>{V6(n,e.store,t),Yx(n,dAe(e.store))},xAe=(n,e=new Uint8Array([0]),t=new pb)=>{const r=IJ(e);EAe(t,n,r);const i=[t.toUint8Array()];if(n.store.pendingDs&&i.push(n.store.pendingDs),n.store.pendingStructs&&i.push(BAe(n.store.pendingStructs.update,e)),i.length>1){if(t.constructor===iR)return LAe(i.map((s,o)=>o===0?s:jAe(s)));if(t.constructor===pb)return $M(i)}return i[0]},TAe=(n,e)=>xAe(n,e,new iR),wAe=n=>{const e=new Map,t=yi(n.restDecoder);for(let r=0;r<t;r++){const i=yi(n.restDecoder),s=yi(n.restDecoder);e.set(i,s)}return e},IJ=n=>wAe(new MJ(Wx(n)));class AAe{constructor(){this.l=[]}}const Rz=()=>new AAe,Cz=(n,e)=>n.l.push(e),Mz=(n,e)=>{const t=n.l,r=t.length;n.l=t.filter(i=>e!==i),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},NJ=(n,e,t)=>B6(n.l,[e,t]);class $E{constructor(e,t){this.client=e,this.clock=t}}const O2=(n,e)=>n===e||n!==null&&e!==null&&n.client===e.client&&n.clock===e.clock,bi=(n,e)=>new $E(n,e),RAe=n=>{for(const[e,t]of n.doc.share.entries())if(t===n)return e;throw s0()},GM=(n,e)=>{for(;e!==null;){if(e.parent===n)return!0;e=e.parent._item}return!1},mE=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&(e.sv.get(n.id.client)||0)>n.id.clock&&!rR(e.ds,n.id),XL=(n,e)=>{const t=ny(n.meta,XL,fx),r=n.doc.store;t.has(e)||(e.sv.forEach((i,s)=>{i<Cc(r,s)&&Oh(n,bi(s,i))}),px(n,e.ds,i=>{}),t.add(e))};class PJ{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const G6=n=>{const e=new Map;return n.clients.forEach((t,r)=>{const i=t[t.length-1];e.set(r,i.id.clock+i.length)}),e},Cc=(n,e)=>{const t=n.clients.get(e);if(t===void 0)return 0;const r=t[t.length-1];return r.id.clock+r.length},DJ=(n,e)=>{let t=n.clients.get(e.id.client);if(t===void 0)t=[],n.clients.set(e.id.client,t);else{const r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw s0()}t.push(e)},o0=(n,e)=>{let t=0,r=n.length-1,i=n[r],s=i.id.clock;if(s===e)return r;let o=Gv(e/(s+i.length-1)*r);for(;t<=r;){if(i=n[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;t=o+1}else r=o-1;o=Gv((t+r)/2)}throw s0()},CAe=(n,e)=>{const t=n.clients.get(e.client);return t[o0(t,e.clock)]},LC=CAe,ZL=(n,e,t)=>{const r=o0(e,t),i=e[r];return i.id.clock<t&&i instanceof go?(e.splice(r+1,0,ZM(n,i,t-i.id.clock)),r+1):r},Oh=(n,e)=>{const t=n.doc.store.clients.get(e.client);return t[ZL(n,t,e.clock)]},kz=(n,e,t)=>{const r=e.clients.get(t.client),i=o0(r,t.clock),s=r[i];return t.clock!==s.id.clock+s.length-1&&s.constructor!==gd&&r.splice(i+1,0,ZM(n,s,t.clock-s.id.clock+1)),s},MAe=(n,e,t)=>{const r=n.clients.get(e.id.client);r[o0(r,e.id.clock)]=t},LJ=(n,e,t,r,i)=>{if(r===0)return;const s=t+r;let o=ZL(n,e,t),a;do a=e[o++],s<a.id.clock+a.length&&ZL(n,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class kAe{constructor(e,t,r){this.doc=e,this.deleteSet=new qx,this.beforeState=G6(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Oz=(n,e)=>e.deleteSet.clients.size===0&&!ewe(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(z6(e.deleteSet),bAe(n,e),Yx(n,e.deleteSet),!0),Iz=(n,e,t)=>{const r=e._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&ny(n.changed,e,fx).add(t)},UC=(n,e)=>{let t=n[e],r=n[e-1],i=e;for(;i>0;t=r,r=n[--i-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof go&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}const s=e-i;return s&&n.splice(e+1-s,s),s},OAe=(n,e,t)=>{for(const[r,i]of n.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=o0(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const h=s[l];if(a.clock+a.len<=h.id.clock)break;h instanceof go&&h.deleted&&!h.keep&&t(h)&&h.gc(e,!1)}}}},IAe=(n,e)=>{n.clients.forEach((t,r)=>{const i=e.clients.get(r);for(let s=t.length-1;s>=0;s--){const o=t[s],a=hJ(i.length-1,1+o0(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+UC(i,c)}})},UJ=(n,e)=>{if(e<n.length){const t=n[e],r=t.doc,i=r.store,s=t.deleteSet,o=t._mergeStructs;try{z6(s),t.afterState=G6(t.doc.store),r.emit("beforeObserverCalls",[t,r]);const a=[];t.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(t,c)})),a.push(()=>{t.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),NJ(l._dEH,c,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),B6(a,[]),t._needFormattingCleanup&&eRe(t)}finally{r.gc&&OAe(s,i,r.gcFilter),IAe(s,i),t.afterState.forEach((u,h)=>{const f=t.beforeState.get(h)||0;if(f!==u){const d=i.clients.get(h),p=Lb(o0(d,f),1);for(let _=d.length-1;_>=p;)_-=1+UC(d,_)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:f}=o[u].id,d=i.clients.get(h),p=o0(d,f);p+1<d.length&&UC(d,p+1)>1||p>0&&UC(d,p)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(lAe(F6,SJ,"[yjs] ",EJ,xJ,"Changed the client-id because another client seems to be using it."),r.clientID=CJ()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){const u=new iR;Oz(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){const u=new pb;Oz(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=t;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,t]),l.forEach(u=>u.destroy())),n.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):UJ(n,e+1)}}},Bs=(n,e,t=null,r=!0)=>{const i=n._transactionCleanups;let s=!1,o=null;n._transaction===null&&(s=!0,n._transaction=new kAe(n,t,r),i.push(n._transaction),i.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{o=e(n._transaction)}finally{if(s){const a=n._transaction===i[0];n._transaction=null,a&&UJ(i,0)}}return o};class NAe{constructor(e,t){this.insertions=t,this.deletions=e,this.meta=new Map}}const Nz=(n,e,t)=>{px(n,t.deletions,r=>{r instanceof go&&e.scope.some(i=>i===n.doc||GM(i,r))&&J6(r,!1)})},Pz=(n,e,t)=>{let r=null;const i=n.doc,s=n.scope;Bs(i,a=>{for(;e.length>0&&n.currStackItem===null;){const c=i.store,l=e.pop(),u=new Set,h=[];let f=!1;px(a,l.insertions,d=>{if(d instanceof go){if(d.redone!==null){let{item:p,diff:_}=RRe(c,d.id);_>0&&(p=Oh(a,bi(p.id.client,p.id.clock+_))),d=p}!d.deleted&&s.some(p=>p===a.doc||GM(p,d))&&h.push(d)}}),px(a,l.deletions,d=>{d instanceof go&&s.some(p=>p===a.doc||GM(p,d))&&!rR(l.insertions,d.id)&&u.add(d)}),u.forEach(d=>{f=tQ(a,d,u,l.insertions,n.ignoreRemoteMapChanges,n)!==null||f});for(let d=h.length-1;d>=0;d--){const p=h[d];n.deleteFilter(p)&&(p.delete(a),f=!0)}n.currStackItem=f?l:null}a.changed.forEach((c,l)=>{c.has(null)&&l._searchMarker&&(l._searchMarker.length=0)}),r=a},n);const o=n.currStackItem;if(o!=null){const a=r.changedParentTypes;n.emit("stack-item-popped",[{stackItem:o,type:t,changedParentTypes:a,origin:n},n]),n.currStackItem=null}return o};class PAe extends uJ{constructor(e,{captureTimeout:t=500,captureTransaction:r=c=>!0,deleteFilter:i=()=>!0,trackedOrigins:s=new Set([null]),ignoreRemoteMapChanges:o=!1,doc:a=GL(e)?e[0].doc:e instanceof Ub?e:e.doc}={}){super(),this.scope=[],this.doc=a,this.addToScope(e),this.deleteFilter=i,s.add(this),this.trackedOrigins=s,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=o,this.captureTimeout=t,this.afterTransactionHandler=c=>{if(!this.captureTransaction(c)||!this.scope.some(g=>c.changedParentTypes.has(g)||g===this.doc)||!this.trackedOrigins.has(c.origin)&&(!c.origin||!this.trackedOrigins.has(c.origin.constructor)))return;const l=this.undoing,u=this.redoing,h=l?this.redoStack:this.undoStack;l?this.stopCapturing():u||this.clear(!1,!0);const f=new qx;c.afterState.forEach((g,m)=>{const b=c.beforeState.get(m)||0,y=g-b;y>0&&mA(f,m,b,y)});const d=Pwe();let p=!1;if(this.lastChange>0&&d-this.lastChange<this.captureTimeout&&h.length>0&&!l&&!u){const g=h[h.length-1];g.deletions=KL([g.deletions,c.deleteSet]),g.insertions=KL([g.insertions,f])}else h.push(new NAe(c.deleteSet,f)),p=!0;!l&&!u&&(this.lastChange=d),px(c,c.deleteSet,g=>{g instanceof go&&this.scope.some(m=>m===c.doc||GM(m,g))&&J6(g,!0)});const _=[{stackItem:h[h.length-1],origin:c.origin,type:l?"redo":"undo",changedParentTypes:c.changedParentTypes},this];p?this.emit("stack-item-added",_):this.emit("stack-item-updated",_)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(e){const t=new Set(this.scope);e=GL(e)?e:[e],e.forEach(r=>{t.has(r)||(t.add(r),(r instanceof ul?r.doc!==this.doc:r!==this.doc)&&wJ("[yjs#509] Not same Y.Doc"),this.scope.push(r))})}addTrackedOrigin(e){this.trackedOrigins.add(e)}removeTrackedOrigin(e){this.trackedOrigins.delete(e)}clear(e=!0,t=!0){(e&&this.canUndo()||t&&this.canRedo())&&this.doc.transact(r=>{e&&(this.undoStack.forEach(i=>Nz(r,this,i)),this.undoStack=[]),t&&(this.redoStack.forEach(i=>Nz(r,this,i)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:e,redoStackCleared:t}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let e;try{e=Pz(this,this.undoStack,"undo")}finally{this.undoing=!1}return e}redo(){this.redoing=!0;let e;try{e=Pz(this,this.redoStack,"redo")}finally{this.redoing=!1}return e}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*DAe(n){const e=yi(n.restDecoder);for(let t=0;t<e;t++){const r=yi(n.restDecoder),i=n.readClient();let s=yi(n.restDecoder);for(let o=0;o<r;o++){const a=n.readInfo();if(a===10){const c=yi(n.restDecoder);yield new _d(bi(i,s),c),s+=c}else if((SO&a)!==0){const c=(a&(Xg|kf))===0,l=new go(bi(i,s),null,(a&kf)===kf?n.readLeftID():null,null,(a&Xg)===Xg?n.readRightID():null,c?n.readParentInfo()?n.readString():n.readLeftID():null,c&&(a&uA)===uA?n.readString():null,nQ(n,a));yield l,s+=l.length}else{const c=n.readLen();yield new gd(bi(i,s),c),s+=c}}}}class $6{constructor(e,t){this.gen=DAe(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===_d);return this.curr}}class W6{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const LAe=n=>$M(n,kJ,iR),UAe=(n,e)=>{if(n.constructor===gd){const{client:t,clock:r}=n.id;return new gd(bi(t,r+e),n.length-e)}else if(n.constructor===_d){const{client:t,clock:r}=n.id;return new _d(bi(t,r+e),n.length-e)}else{const t=n,{client:r,clock:i}=t.id;return new go(bi(r,i+e),null,bi(r,i+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},$M=(n,e=mx,t=pb)=>{if(n.length===1)return n[0];const r=n.map(u=>new e(Wx(u)));let i=r.map(u=>new $6(u,!0)),s=null;const o=new t,a=new W6(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,d)=>{if(f.curr.id.client===d.curr.id.client){const p=f.curr.id.clock-d.curr.id.clock;return p===0?f.curr.constructor===d.curr.constructor?0:f.curr.constructor===_d?1:-1:p}else return d.curr.id.client-f.curr.id.client}),i.length!==0;){const u=i[0],h=u.curr.id.client;if(s!==null){let f=u.curr,d=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=u.next(),d=!0;if(f===null||f.id.client!==h||d&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Rv(a,s.struct,s.offset),s={struct:f,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===_d)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{Rv(a,s.struct,s.offset);const p=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new _d(bi(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-f.id.clock;p>0&&(s.struct.constructor===_d?s.struct.length-=p:f=UAe(f,p)),s.struct.mergeWith(f)||(Rv(a,s.struct,s.offset),s={struct:f,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let f=u.curr;f!==null&&f.id.client===h&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==_d;f=u.next())Rv(a,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(Rv(a,s.struct,s.offset),s=null),q6(a);const c=r.map(u=>H6(u)),l=KL(c);return Yx(o,l),o.toUint8Array()},BAe=(n,e,t=mx,r=pb)=>{const i=IJ(e),s=new r,o=new W6(s),a=new t(Wx(n)),c=new $6(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,f=i.get(h)||0;if(c.curr.constructor===_d){c.next();continue}if(u.id.clock+u.length>f)for(Rv(o,u,Lb(f-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Rv(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=f;)c.next()}q6(o);const l=H6(a);return Yx(s,l),s.toUint8Array()},BJ=n=>{n.written>0&&(n.clientStructs.push({written:n.written,restEncoder:qm(n.encoder.restEncoder)}),n.encoder.restEncoder=EO(),n.written=0)},Rv=(n,e,t)=>{n.written>0&&n.currClient!==e.id.client&&BJ(n),n.written===0&&(n.currClient=e.id.client,n.encoder.writeClient(e.id.client),Hi(n.encoder.restEncoder,e.id.clock+t)),e.write(n.encoder,t),n.written++},q6=n=>{BJ(n);const e=n.encoder.restEncoder;Hi(e,n.clientStructs.length);for(let t=0;t<n.clientStructs.length;t++){const r=n.clientStructs[t];Hi(e,r.written),xO(e,r.restEncoder)}},FAe=(n,e,t,r)=>{const i=new t(Wx(n)),s=new $6(i,!1),o=new r,a=new W6(o);for(let l=s.curr;l!==null;l=s.next())Rv(a,e(l),0);q6(a);const c=H6(i);return Yx(o,c),o.toUint8Array()},jAe=n=>FAe(n,Wwe,mx,iR),Dz="You must not compute changes after the event-handler fired.";class wO{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=zAe(this.currentTarget,this.target))}deletes(e){return rR(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw $v(Dz);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(i=>{if(i!==null){const s=t._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=VN(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=VN(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=VN(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw $v(Dz);const t=this.target,r=fx(),i=fx(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=t._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const zAe=(n,e)=>{const t=[];for(;e._item!==null&&e!==n;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;t.unshift(r)}e=e._item.parent}return t},uu=()=>{wJ("Invalid access: Add Yjs type to a document before reading data.")},FJ=80;let Y6=0;class HAe{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Y6++}}const VAe=n=>{n.timestamp=Y6++},jJ=(n,e,t)=>{n.p.marker=!1,n.p=e,e.marker=!0,n.index=t,n.timestamp=Y6++},GAe=(n,e,t)=>{if(n.length>=FJ){const r=n.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return jJ(r,e,t),r}else{const r=new HAe(e,t);return n.push(r),r}},AO=(n,e)=>{if(n._start===null||e===0||n._searchMarker===null)return null;const t=n._searchMarker.length===0?null:n._searchMarker.reduce((s,o)=>NC(e-s.index)<NC(e-o.index)?s:o);let r=n._start,i=0;for(t!==null&&(r=t.p,i=t.index,VAe(t));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return t!==null&&NC(t.index-i)<r.parent.length/FJ?(jJ(t,r,i),t):GAe(n._searchMarker,r,i)},gA=(n,e,t)=>{for(let r=n.length-1;r>=0;r--){const i=n[r];if(t>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){n.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||t>0&&e===i.index)&&(i.index=Lb(e,i.index+t))}},RO=(n,e,t)=>{const r=n,i=e.changedParentTypes;for(;ny(i,n,()=>[]).push(t),n._item!==null;)n=n._item.parent;NJ(r._eH,t,e)};class ul{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Rz(),this._dEH=Rz(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw Jm()}clone(){throw Jm()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Cz(this._eH,e)}observeDeep(e){Cz(this._dEH,e)}unobserve(e){Mz(this._eH,e)}unobserveDeep(e){Mz(this._dEH,e)}toJSON(){}}const zJ=(n,e,t)=>{n.doc??uu(),e<0&&(e=n._length+e),t<0&&(t=n._length+t);let r=t-e;const i=[];let s=n._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},HJ=n=>{n.doc??uu();const e=[];let t=n._start;for(;t!==null;){if(t.countable&&!t.deleted){const r=t.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}t=t.right}return e},_A=(n,e)=>{let t=0,r=n._start;for(n.doc??uu();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],t++,n)}r=r.right}},VJ=(n,e)=>{const t=[];return _A(n,(r,i)=>{t.push(e(r,i,n))}),t},$Ae=n=>{let e=n._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}const i=t[r++];return t.length<=r&&(t=null),{done:!1,value:i}}}},GJ=(n,e)=>{n.doc??uu();const t=AO(n,e);let r=n._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},WM=(n,e,t,r)=>{let i=t;const s=n.doc,o=s.clientID,a=s.store,c=t===null?e._start:t.right;let l=[];const u=()=>{l.length>0&&(i=new go(bi(o,Cc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new gb(l)),i.integrate(n,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:i=new go(bi(o,Cc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new sR(new Uint8Array(h))),i.integrate(n,0);break;case Ub:i=new go(bi(o,Cc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new oR(h)),i.integrate(n,0);break;default:if(h instanceof ul)i=new go(bi(o,Cc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new m_(h)),i.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},$J=()=>$v("Length exceeded!"),WJ=(n,e,t,r)=>{if(t>e._length)throw $J();if(t===0)return e._searchMarker&&gA(e._searchMarker,t,r.length),WM(n,e,null,r);const i=t,s=AO(e,t);let o=e._start;for(s!==null&&(o=s.p,t-=s.index,t===0&&(o=o.prev,t+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(t<=o.length){t<o.length&&Oh(n,bi(o.id.client,o.id.clock+t));break}t-=o.length}return e._searchMarker&&gA(e._searchMarker,i,r.length),WM(n,e,o,r)},WAe=(n,e,t)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return WM(n,e,i,t)},qJ=(n,e,t,r)=>{if(r===0)return;const i=t,s=r,o=AO(e,t);let a=e._start;for(o!==null&&(a=o.p,t-=o.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&Oh(n,bi(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Oh(n,bi(a.id.client,a.id.clock+r)),a.delete(n),r-=a.length),a=a.right;if(r>0)throw $J();e._searchMarker&&gA(e._searchMarker,i,-s+r)},qM=(n,e,t)=>{const r=e._map.get(t);r!==void 0&&r.delete(n)},K6=(n,e,t,r)=>{const i=e._map.get(t)||null,s=n.doc,o=s.clientID;let a;if(r==null)a=new gb([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new gb([r]);break;case Uint8Array:a=new sR(r);break;case Ub:a=new oR(r);break;default:if(r instanceof ul)a=new m_(r);else throw new Error("Unexpected content type")}new go(bi(o,Cc(s.store,o)),i,i&&i.lastId,null,null,e,t,a).integrate(n,0)},X6=(n,e)=>{n.doc??uu();const t=n._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},YJ=n=>{const e={};return n.doc??uu(),n._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},KJ=(n,e)=>{n.doc??uu();const t=n._map.get(e);return t!==void 0&&!t.deleted},qAe=(n,e)=>{const t={};return n._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&mE(s,e)&&(t[i]=s.content.getContent()[s.length-1])}),t},I2=n=>(n.doc??uu(),uAe(n._map.entries(),e=>!e[1].deleted));class YAe extends wO{}class WE extends ul{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new WE;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new WE}clone(){const e=new WE;return e.insert(0,this.toArray().map(t=>t instanceof ul?t.clone():t)),e}get length(){return this.doc??uu(),this._length}_callObserver(e,t){super._callObserver(e,t),RO(this,e,new YAe(this,e))}insert(e,t){this.doc!==null?Bs(this.doc,r=>{WJ(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Bs(this.doc,t=>{WAe(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Bs(this.doc,r=>{qJ(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return GJ(this,e)}toArray(){return HJ(this)}slice(e=0,t=this.length){return zJ(this,e,t)}toJSON(){return this.map(e=>e instanceof ul?e.toJSON():e)}map(e){return VJ(this,e)}forEach(e){_A(this,e)}[Symbol.iterator](){return $Ae(this)}_write(e){e.writeTypeRef(yRe)}}const KAe=n=>new WE;class XAe extends wO{constructor(e,t,r){super(e,t),this.keysChanged=r}}class gx extends ul{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new gx}clone(){const e=new gx;return this.forEach((t,r)=>{e.set(r,t instanceof ul?t.clone():t)}),e}_callObserver(e,t){RO(this,e,new XAe(this,e,t))}toJSON(){this.doc??uu();const e={};return this._map.forEach((t,r)=>{if(!t.deleted){const i=t.content.getContent()[t.length-1];e[r]=i instanceof ul?i.toJSON():i}}),e}get size(){return[...I2(this)].length}keys(){return YN(I2(this),e=>e[0])}values(){return YN(I2(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return YN(I2(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??uu(),this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Bs(this.doc,t=>{qM(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Bs(this.doc,r=>{K6(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return X6(this,e)}has(e){return KJ(this,e)}clear(){this.doc!==null?Bs(this.doc,e=>{this.forEach(function(t,r,i){qM(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(bRe)}}const ZAe=n=>new gx,Iv=(n,e)=>n===e||typeof n=="object"&&typeof e=="object"&&n&&e&&Gwe(n,e);class JL{constructor(e,t,r,i){this.left=e,this.right=t,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&s0(),this.right.content.constructor){case Dc:this.right.deleted||Kx(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Lz=(n,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case Dc:e.right.deleted||Kx(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&Oh(n,bi(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},N2=(n,e,t,r)=>{const i=new Map,s=r?AO(e,t):null;if(s){const o=new JL(s.p.left,s.p,s.index,i);return Lz(n,o,t-s.index)}else{const o=new JL(null,e._start,0,i);return Lz(n,o,t)}},XJ=(n,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===Dc&&Iv(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();const i=n.doc,s=i.clientID;r.forEach((o,a)=>{const c=t.left,l=t.right,u=new go(bi(s,Cc(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new Dc(a,o));u.integrate(n,0),t.right=u,t.forward()})},Kx=(n,e)=>{const{key:t,value:r}=e;r===null?n.delete(t):n.set(t,r)},ZJ=(n,e)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===Dc&&Iv(e[n.right.content.key]??null,n.right.content.value)))break;n.forward()}},JJ=(n,e,t,r)=>{const i=n.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=t.currentAttributes.get(a)??null;if(!Iv(l,c)){o.set(a,l);const{left:u,right:h}=t;t.right=new go(bi(s,Cc(i.store,s)),u,u&&u.lastId,h,h&&h.id,e,null,new Dc(a,c)),t.right.integrate(n,0),t.forward()}}return o},KN=(n,e,t,r,i)=>{t.currentAttributes.forEach((f,d)=>{i[d]===void 0&&(i[d]=null)});const s=n.doc,o=s.clientID;ZJ(t,i);const a=JJ(n,e,t,i),c=r.constructor===String?new c0(r):r instanceof ul?new m_(r):new Bb(r);let{left:l,right:u,index:h}=t;e._searchMarker&&gA(e._searchMarker,t.index,c.getLength()),u=new go(bi(o,Cc(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(n,0),t.right=u,t.index=h,t.forward(),XJ(n,e,t,a)},Uz=(n,e,t,r,i)=>{const s=n.doc,o=s.clientID;ZJ(t,i);const a=JJ(n,e,t,i);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===Dc));){if(!t.right.deleted)switch(t.right.content.constructor){case Dc:{const{key:c,value:l}=t.right.content,u=i[c];if(u!==void 0){if(Iv(u,l))a.delete(c);else{if(r===0)break e;a.set(c,l)}t.right.delete(n)}else t.currentAttributes.set(c,l);break}default:r<t.right.length&&Oh(n,bi(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;t.right=new go(bi(o,Cc(s.store,o)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new c0(c)),t.right.integrate(n,0),t.forward()}XJ(n,e,t,a)},QJ=(n,e,t,r,i)=>{let s=e;const o=vp();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Dc){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(t===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Dc:{const{key:u,value:h}=l,f=r.get(u)??null;(o.get(u)!==l||f===h)&&(e.delete(n),a++,!c&&(i.get(u)??null)===h&&f!==h&&(f===null?i.delete(u):i.set(u,f))),!c&&!e.deleted&&Kx(i,l);break}}}e=e.right}return a},JAe=(n,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Dc){const r=e.content.key;t.has(r)?e.delete(n):t.add(r)}e=e.left}},QAe=n=>{let e=0;return Bs(n.doc,t=>{let r=n._start,i=n._start,s=vp();const o=VL(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Dc:Kx(o,i.content);break;default:e+=QJ(t,r,i,s,o),s=VL(o),r=i;break}i=i.right}}),e},eRe=n=>{const e=new Set,t=n.doc;for(const[r,i]of n.afterState.entries()){const s=n.beforeState.get(r)||0;i!==s&&LJ(n,t.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Dc&&o.constructor!==gd&&e.add(o.parent)})}Bs(t,r=>{px(n,n.deleteSet,i=>{if(i instanceof gd||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Dc?e.add(s):JAe(r,i)});for(const i of e)QAe(i)})},Bz=(n,e,t)=>{const r=t,i=VL(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case m_:case Bb:case c0:t<e.right.length&&Oh(n,bi(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(n);break}e.forward()}s&&QJ(n,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&gA(o._searchMarker,e.index,-r+t),e};class tRe extends wO{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];Bs(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const f=()=>{if(a!==null){let d=null;switch(a){case"delete":h>0&&(d={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(d={insert:l},i.size>0&&(d.attributes={},i.forEach((p,_)=>{p!==null&&(d.attributes[_]=p)}))),l="";break;case"retain":u>0&&(d={retain:u},zwe(c)||(d.attributes=Bwe({},c))),u=0;break}d&&t.push(d),a=null}};for(;o!==null;){switch(o.content.constructor){case m_:case Bb:this.adds(o)?this.deletes(o)||(f(),a="insert",l=o.content.getContent()[0],f()):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(f(),a="retain"),u+=1);break;case c0:this.adds(o)?this.deletes(o)||(a!=="insert"&&(f(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(f(),a="retain"),u+=o.length);break;case Dc:{const{key:d,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const _=i.get(d)??null;Iv(_,p)?p!==null&&o.delete(r):(a==="retain"&&f(),Iv(p,s.get(d)??null)?delete c[d]:c[d]=p)}}else if(this.deletes(o)){s.set(d,p);const _=i.get(d)??null;Iv(_,p)||(a==="retain"&&f(),c[d]=_)}else if(!o.deleted){s.set(d,p);const _=c[d];_!==void 0&&(Iv(_,p)?_!==null&&o.delete(r):(a==="retain"&&f(),p===null?delete c[d]:c[d]=p))}o.deleted||(a==="insert"&&f(),Kx(i,o.content));break}}o=o.right}for(f();t.length>0;){const d=t[t.length-1];if(d.retain!==void 0&&d.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}}class a0 extends ul{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??uu(),this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new a0}clone(){const e=new a0;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const r=new tRe(this,e,t);RO(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??uu();let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===c0&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Bs(this.doc,r=>{const i=new JL(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!t&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&KN(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Uz(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Bz(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){this.doc??uu();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let f=!1;s.forEach((p,_)=>{f=!0,h[_]=p});const d={insert:a};f&&(d.attributes=h),i.push(d),a=""}}const u=()=>{for(;c!==null;){if(mE(c,e)||t!==void 0&&mE(c,t))switch(c.content.constructor){case c0:{const h=s.get("ychange");e!==void 0&&!mE(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):t!==void 0&&!mE(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case m_:case Bb:{l();const h={insert:c.content.getContent()[0]};if(s.size>0){const f={};h.attributes=f,s.forEach((d,p)=>{f[p]=d})}i.push(h);break}case Dc:mE(c,e)&&(l(),Kx(s,c.content));break}c=c.right}l()};return e||t?Bs(o,h=>{e&&XL(h,e),t&&XL(h,t),u()},"cleanup"):u(),i}insert(e,t,r){if(t.length<=0)return;const i=this.doc;i!==null?Bs(i,s=>{const o=N2(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),KN(s,this,o,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){const i=this.doc;i!==null?Bs(i,s=>{const o=N2(s,this,e,!r);KN(s,this,o,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;const r=this.doc;r!==null?Bs(r,i=>{Bz(i,N2(i,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;const i=this.doc;i!==null?Bs(i,s=>{const o=N2(s,this,e,!1);o.right!==null&&Uz(s,this,o,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Bs(this.doc,t=>{qM(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Bs(this.doc,r=>{K6(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return X6(this,e)}getAttributes(){return YJ(this)}_write(e){e.writeTypeRef(SRe)}}const nRe=n=>new a0;class XN{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??uu()}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===_x||t.constructor===mb)&&t._start!==null)e=t._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class mb extends ul{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new mb}clone(){const e=new mb;return e.insert(0,this.toArray().map(t=>t instanceof ul?t.clone():t)),e}get length(){return this.doc??uu(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new XN(this,e)}querySelector(e){e=e.toUpperCase();const r=new XN(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),db(new XN(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){RO(this,e,new sRe(this,t,e))}toString(){return VJ(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),_A(this,s=>{i.insertBefore(s.toDOM(e,t,r),null)}),i}insert(e,t){this.doc!==null?Bs(this.doc,r=>{WJ(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Bs(this.doc,r=>{const i=e&&e instanceof ul?e._item:e;WM(r,this,i,t)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw $v("Reference item not found");r.splice(i,0,...t)}}delete(e,t=1){this.doc!==null?Bs(this.doc,r=>{qJ(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return HJ(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return GJ(this,e)}slice(e=0,t=this.length){return zJ(this,e,t)}forEach(e){_A(this,e)}_write(e){e.writeTypeRef(xRe)}}const rRe=n=>new mb;class _x extends mb{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new _x(this.nodeName)}clone(){const e=new _x(this.nodeName),t=this.getAttributes();return jwe(t,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof ul?r.clone():r)),e}toString(){const e=this.getAttributes(),t=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];t.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=t.length>0?" "+t.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Bs(this.doc,t=>{qM(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Bs(this.doc,r=>{K6(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return X6(this,e)}hasAttribute(e){return KJ(this,e)}getAttributes(e){return e?qAe(this,e):YJ(this)}toDOM(e=document,t={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return _A(this,o=>{i.appendChild(o.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(ERe),e.writeKey(this.nodeName)}}const iRe=n=>new _x(n.readKey());class sRe extends wO{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class YM extends gx{constructor(e){super(),this.hookName=e}_copy(){return new YM(this.hookName)}clone(){const e=new YM(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){const i=t[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(TRe),e.writeKey(this.hookName)}}const oRe=n=>new YM(n.readKey());class KM extends a0{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new KM}clone(){const e=new KM;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const t=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),t.push({nodeName:i,attrs:s})}t.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<t.length;i++){const s=t[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=t.length-1;i>=0;i--)r+=`</${t[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(wRe)}}const aRe=n=>new KM;class Z6{constructor(e,t){this.id=e,this.length=t}get deleted(){throw Jm()}mergeWith(e){return!1}write(e,t,r){throw Jm()}integrate(e,t){throw Jm()}}const cRe=0;class gd extends Z6{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),DJ(e.doc.store,this)}write(e,t){e.writeInfo(cRe),e.writeLen(this.length-t)}getMissing(e,t){return null}}class sR{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new sR(this.content)}splice(e){throw Jm()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}const lRe=n=>new sR(n.readBuf());class vA{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new vA(this.len)}splice(e){const t=new vA(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){mA(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const uRe=n=>new vA(n.readLen()),eQ=(n,e)=>new Ub({guid:n,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class oR{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new oR(eQ(this.doc.guid,this.opts))}splice(e){throw Jm()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const hRe=n=>new oR(eQ(n.readString(),n.readAny()));class Bb{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Bb(this.embed)}splice(e){throw Jm()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}const fRe=n=>new Bb(n.readJSON());class Dc{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Dc(this.key,this.value)}splice(e){throw Jm()}mergeWith(e){return!1}integrate(e,t){const r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const dRe=n=>new Dc(n.readKey(),n.readJSON());class XM{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new XM(this.arr)}splice(e){const t=new XM(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const pRe=n=>{const e=n.readLen(),t=[];for(let r=0;r<e;r++){const i=n.readString();i==="undefined"?t.push(void 0):t.push(JSON.parse(i))}return new XM(t)},mRe=VM("node_env")==="development";class gb{constructor(e){this.arr=e,mRe&&vJ(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new gb(this.arr)}splice(e){const t=new gb(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const gRe=n=>{const e=n.readLen(),t=[];for(let r=0;r<e;r++)t.push(n.readAny());return new gb(t)};class c0{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new c0(this.str)}splice(e){const t=new c0(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",t.str=""+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}}const _Re=n=>new c0(n.readString()),vRe=[KAe,ZAe,nRe,iRe,rRe,oRe,aRe],yRe=0,bRe=1,SRe=2,ERe=3,xRe=4,TRe=5,wRe=6;class m_{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new m_(this.type._copy())}splice(e){throw Jm()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const ARe=n=>new m_(vRe[n.readTypeRef()](n)),RRe=(n,e)=>{let t=e,r=0,i;do r>0&&(t=bi(t.client,t.clock+r)),i=LC(n,t),r=t.clock-i.id.clock,t=i.redone;while(t!==null&&i instanceof go);return{item:i,diff:r}},J6=(n,e)=>{for(;n!==null&&n.keep!==e;)n.keep=e,n=n.parent._item},ZM=(n,e,t)=>{const{client:r,clock:i}=e.id,s=new go(bi(r,i+t),e,bi(r,i+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=bi(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),n._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s},Fz=(n,e)=>nwe(n,t=>rR(t.deletions,e)),tQ=(n,e,t,r,i,s)=>{const o=n.doc,a=o.store,c=o.clientID,l=e.redone;if(l!==null)return Oh(n,l);let u=e.parent._item,h=null,f;if(u!==null&&u.deleted===!0){if(u.redone===null&&(!t.has(u)||tQ(n,u,t,r,i,s)===null))return null;for(;u.redone!==null;)u=Oh(n,u.redone)}const d=u===null?e.parent:u.content.type;if(e.parentSub===null){for(h=e.left,f=e;h!==null;){let m=h;for(;m!==null&&m.parent._item!==u;)m=m.redone===null?null:Oh(n,m.redone);if(m!==null&&m.parent._item===u){h=m;break}h=h.left}for(;f!==null;){let m=f;for(;m!==null&&m.parent._item!==u;)m=m.redone===null?null:Oh(n,m.redone);if(m!==null&&m.parent._item===u){f=m;break}f=f.right}}else if(f=null,e.right&&!i){for(h=e;h!==null&&h.right!==null&&(h.right.redone||rR(r,h.right.id)||Fz(s.undoStack,h.right.id)||Fz(s.redoStack,h.right.id));)for(h=h.right;h.redone;)h=Oh(n,h.redone);if(h&&h.right!==null)return null}else h=d._map.get(e.parentSub)||null;const p=Cc(a,c),_=bi(c,p),g=new go(_,h,h&&h.lastId,f,f&&f.id,d,e.parentSub,e.content.copy());return e.redone=_,J6(g,!0),g.integrate(n,0),g};class go extends Z6{constructor(e,t,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=t,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?mz:0}set marker(e){(this.info&$N)>0!==e&&(this.info^=$N)}get marker(){return(this.info&$N)>0}get keep(){return(this.info&pz)>0}set keep(e){this.keep!==e&&(this.info^=pz)}get countable(){return(this.info&mz)>0}get deleted(){return(this.info&GN)>0}set deleted(e){this.deleted!==e&&(this.info^=GN)}markDeleted(){this.info|=GN}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Cc(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Cc(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===$E&&this.id.client!==this.parent.client&&this.parent.clock>=Cc(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=kz(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Oh(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===gd||this.right&&this.right.constructor===gd)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===go?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===go&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===$E){const r=LC(t,this.parent);r.constructor===gd?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=kz(e,e.doc.store,bi(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),O2(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(O2(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(LC(e.doc.store,i.origin)))s.has(LC(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),DJ(e.doc.store,this),this.content.integrate(e,this),Iz(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new gd(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:bi(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&O2(e.origin,this.lastId)&&this.right===e&&O2(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),mA(e.deleteSet,this.id.client,this.id.clock,this.length),Iz(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw s0();this.content.gc(e),t?MAe(e,this,new gd(this.id,this.length)):this.content=new vA(this.length)}write(e,t){const r=t>0?bi(this.id.client,this.id.clock+t-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&SO|(r===null?0:kf)|(i===null?0:Xg)|(s===null?0:uA);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=RAe(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===$E?(e.writeParentInfo(!1),e.writeLeftID(a)):s0();s!==null&&e.writeString(s)}this.content.write(e,t)}}const nQ=(n,e)=>CRe[e&SO](n),CRe=[()=>{s0()},uRe,pRe,lRe,_Re,fRe,dRe,ARe,gRe,hRe,()=>{s0()}],MRe=10;class _d extends Z6{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){s0()}write(e,t){e.writeInfo(MRe),Hi(e.restEncoder,this.length-t)}getMissing(e,t){return null}}const rQ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Vg<"u"?Vg:{},iQ="__ $YJS$ __";rQ[iQ]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");rQ[iQ]=!0;let jz=!1;const Ih=new Ub;function sQ(n){const e=Ih.getMap(),[,t]=Qe.useState(0);if(Qe.useEffect(()=>{function r(){t(i=>1-i)}return e.observe(r),()=>{e.unobserve(r)}},[e,t]),e.has(n))return e.get(n)}function aR(n){const e=sQ(n);if(Xt(e))return e}function oQ(n){const e=sQ(n);if(!(!fe(e)||!(e instanceof a0)))return e}function aQ(n,e,t){const r=Ih.getMap();if(!r.has(n))switch(e){case 0:case 1:r.set(n,t);break}}function kRe(n,e){aQ(n,0,e)}function cQ(n,e){const t=new a0(e);aQ(n,1,t)}function Pu(n,e){Ih.getMap().set(n,e)}function ORe(n,e){const t=Ih.getMap(),r=new a0(e);t.set(n,r)}function lQ(n,e){const t=Ih.getMap();function r(i){const s=t.get(n);for(let o=0;o<i.length;++o)(i[o].target===t||i[o].target===s)&&e(s)}return t.has(n)&&e(t.get(n)),t.observeDeep(r),()=>{t.observeDeep(r)}}function IRe(n,e){return lQ(n,t=>{Xt(t)&&e(t)})}function NRe(n,e){return lQ(n,t=>{t instanceof a0&&e(t.toJSON())})}const R1=y0("modem",["second"],n=>{if(R1.session(n))switch(n.target){case"second":!jz&&n.data%2===0&&R1.emit(n.player,"modem:join");break;case"join":n.sender!==R1.id()&&R1.reply(n,"joinack",HW(TAe(Ih)));break;case"joinack":n.sender!==R1.id()&&(jz=!0,Az(Ih,yM(n.data),Ih));break;case"sync":{n.sender!==R1.id()&&fe(n.data)&&Az(Ih,yM(n.data),Ih);break}}});function uQ(n,e){e!==Ih&&R1.emit("","modem:sync",HW(n))}Ih.on("update",uQ);Ih.on("destroy",()=>{Ih.off("update",uQ)});const PRe=`desc;$DKGRAYname and type of codepage
`,DRe=Object.freeze(Object.defineProperty({__proto__:null,default:PRe},Symbol.toStringTag,{value:"Module"})),LRe=`desc;$DKGRAYShow admin scroll
`,URe=Object.freeze(Object.defineProperty({__proto__:null,default:LRe},Symbol.toStringTag,{value:"Module"})),BRe=`desc;$DKGRAYCreate array variable
`,FRe=Object.freeze(Object.defineProperty({__proto__:null,default:BRe},Symbol.toStringTag,{value:"Module"})),jRe=`desc;$DKGRAYApply autofilter to fx 0-1
`,zRe=Object.freeze(Object.defineProperty({__proto__:null,default:jRe},Symbol.toStringTag,{value:"Module"})),HRe=`desc;$DKGRAYAutofilter for fx 0
`,VRe=Object.freeze(Object.defineProperty({__proto__:null,default:HRe},Symbol.toStringTag,{value:"Module"})),GRe=`desc;$DKGRAYAutofilter for fx 1
`,$Re=Object.freeze(Object.defineProperty({__proto__:null,default:GRe},Symbol.toStringTag,{value:"Module"})),WRe=`desc;$DKGRAYAutofilter for fx 2
`,qRe=Object.freeze(Object.defineProperty({__proto__:null,default:WRe},Symbol.toStringTag,{value:"Module"})),YRe=`desc;$DKGRAYApply autowah to fx 0-1
`,KRe=Object.freeze(Object.defineProperty({__proto__:null,default:YRe},Symbol.toStringTag,{value:"Module"})),XRe=`desc;$DKGRAYAutowah for fx 0
`,ZRe=Object.freeze(Object.defineProperty({__proto__:null,default:XRe},Symbol.toStringTag,{value:"Module"})),JRe=`desc;$DKGRAYAutowah for fx 1
`,QRe=Object.freeze(Object.defineProperty({__proto__:null,default:JRe},Symbol.toStringTag,{value:"Module"})),e2e=`desc;$DKGRAYAutowah for fx 2
`,t2e=Object.freeze(Object.defineProperty({__proto__:null,default:e2e},Symbol.toStringTag,{value:"Module"})),n2e=`desc;$DKGRAYBBS login/publish actions
`,r2e=Object.freeze(Object.defineProperty({__proto__:null,default:n2e},Symbol.toStringTag,{value:"Module"})),i2e="desc;$DKGRAYchanges object into specified element",s2e=Object.freeze(Object.defineProperty({__proto__:null,default:i2e},Symbol.toStringTag,{value:"Module"})),o2e="desc;$DKGRAYlike #play but for sound effects",a2e=Object.freeze(Object.defineProperty({__proto__:null,default:o2e},Symbol.toStringTag,{value:"Module"})),c2e=`desc;$DKGRAYQuantized bgplay on 16n
`,l2e=Object.freeze(Object.defineProperty({__proto__:null,default:c2e},Symbol.toStringTag,{value:"Module"})),u2e=`desc;$DKGRAYQuantized bgplay on 1m
`,h2e=Object.freeze(Object.defineProperty({__proto__:null,default:u2e},Symbol.toStringTag,{value:"Module"})),f2e=`desc;$DKGRAYQuantized bgplay on 2n
`,d2e=Object.freeze(Object.defineProperty({__proto__:null,default:f2e},Symbol.toStringTag,{value:"Module"})),p2e=`desc;$DKGRAYQuantized bgplay on 32n
`,m2e=Object.freeze(Object.defineProperty({__proto__:null,default:p2e},Symbol.toStringTag,{value:"Module"})),g2e=`desc;$DKGRAYQuantized bgplay on 4n
`,_2e=Object.freeze(Object.defineProperty({__proto__:null,default:g2e},Symbol.toStringTag,{value:"Module"})),v2e=`desc;$DKGRAYQuantized bgplay on 64n
`,y2e=Object.freeze(Object.defineProperty({__proto__:null,default:v2e},Symbol.toStringTag,{value:"Module"})),b2e=`desc;$DKGRAYQuantized bgplay on 8n
`,S2e=Object.freeze(Object.defineProperty({__proto__:null,default:b2e},Symbol.toStringTag,{value:"Module"})),E2e=`desc;$DKGRAYSet bgplay volume
`,x2e=Object.freeze(Object.defineProperty({__proto__:null,default:E2e},Symbol.toStringTag,{value:"Module"})),T2e=`desc;$DKGRAYCopy code from named element
`,w2e=Object.freeze(Object.defineProperty({__proto__:null,default:T2e},Symbol.toStringTag,{value:"Module"})),A2e=`desc;$DKGRAY
`,R2e=Object.freeze(Object.defineProperty({__proto__:null,default:A2e},Symbol.toStringTag,{value:"Module"})),C2e=`desc;$DKGRAYUsed to move player to board
`,M2e=Object.freeze(Object.defineProperty({__proto__:null,default:C2e},Symbol.toStringTag,{value:"Module"})),k2e=`desc;$DKGRAYList all boards as goto hyperlinks
`,O2e=Object.freeze(Object.defineProperty({__proto__:null,default:k2e},Symbol.toStringTag,{value:"Module"})),I2e=`desc;$DKGRAYExport entire book as JSON (operator only)
`,N2e=Object.freeze(Object.defineProperty({__proto__:null,default:I2e},Symbol.toStringTag,{value:"Module"})),P2e=`desc;$DKGRAYShow book export options (operator only)
`,D2e=Object.freeze(Object.defineProperty({__proto__:null,default:P2e},Symbol.toStringTag,{value:"Module"})),L2e=`desc;$DKGRAYRename the main book (operator only)
`,U2e=Object.freeze(Object.defineProperty({__proto__:null,default:L2e},Symbol.toStringTag,{value:"Module"})),B2e=`desc;$DKGRAYList all books
`,F2e=Object.freeze(Object.defineProperty({__proto__:null,default:B2e},Symbol.toStringTag,{value:"Module"})),j2e=`desc;$DKGRAYTrash a book by address (operator only)
`,z2e=Object.freeze(Object.defineProperty({__proto__:null,default:j2e},Symbol.toStringTag,{value:"Module"})),H2e=`desc;$DKGRAYSet BPM
`,V2e=Object.freeze(Object.defineProperty({__proto__:null,default:H2e},Symbol.toStringTag,{value:"Module"})),G2e=`desc;$DKGRAY
`,$2e=Object.freeze(Object.defineProperty({__proto__:null,default:G2e},Symbol.toStringTag,{value:"Module"})),W2e=`desc;$DKGRAYStart/stop stream broadcast (operator only)
`,q2e=Object.freeze(Object.defineProperty({__proto__:null,default:W2e},Symbol.toStringTag,{value:"Module"})),Y2e=`desc;$DKGRAYCreate new board and write id to stat
`,K2e=Object.freeze(Object.defineProperty({__proto__:null,default:Y2e},Symbol.toStringTag,{value:"Module"})),X2e=`desc;$DKGRAYChange elements of one kind to another
`,Z2e=Object.freeze(Object.defineProperty({__proto__:null,default:X2e},Symbol.toStringTag,{value:"Module"})),J2e=`desc;$DKGRAYSet character (self or at direction)
`,Q2e=Object.freeze(Object.defineProperty({__proto__:null,default:J2e},Symbol.toStringTag,{value:"Module"})),eCe=`desc;$DKGRAY
`,tCe=Object.freeze(Object.defineProperty({__proto__:null,default:eCe},Symbol.toStringTag,{value:"Module"})),nCe=`desc;$DKGRAYStart/stop twitch chat integration (operator only)
`,rCe=Object.freeze(Object.defineProperty({__proto__:null,default:nCe},Symbol.toStringTag,{value:"Module"})),iCe="desc;$DKGRAYClear variables (set to 0)",sCe=Object.freeze(Object.defineProperty({__proto__:null,default:iCe},Symbol.toStringTag,{value:"Module"})),oCe=`desc;$DKGRAYSet color (self or at direction)
`,aCe=Object.freeze(Object.defineProperty({__proto__:null,default:oCe},Symbol.toStringTag,{value:"Module"})),cCe=`desc;$DKGRAY
`,lCe=Object.freeze(Object.defineProperty({__proto__:null,default:cCe},Symbol.toStringTag,{value:"Module"})),uCe=`desc;$DKGRAYCopy region from source to current board
`,hCe=Object.freeze(Object.defineProperty({__proto__:null,default:uCe},Symbol.toStringTag,{value:"Module"})),fCe=`desc;$DKGRAYSet element cycle value (1-255)
`,dCe=Object.freeze(Object.defineProperty({__proto__:null,default:fCe},Symbol.toStringTag,{value:"Module"})),pCe=`desc;$DKGRAYEnter dev mode / halt execution (operator only)
`,mCe=Object.freeze(Object.defineProperty({__proto__:null,default:pCe},Symbol.toStringTag,{value:"Module"})),gCe=`desc;$DKGRAYDelete element (halt execution unless @isitem)
`,_Ce=Object.freeze(Object.defineProperty({__proto__:null,default:gCe},Symbol.toStringTag,{value:"Module"})),vCe=`desc;$DKGRAYApply distortion to fx 0-1
`,yCe=Object.freeze(Object.defineProperty({__proto__:null,default:vCe},Symbol.toStringTag,{value:"Module"})),bCe=`desc;$DKGRAYDistortion for fx 0
`,SCe=Object.freeze(Object.defineProperty({__proto__:null,default:bCe},Symbol.toStringTag,{value:"Module"})),ECe=`desc;$DKGRAYDistortion for fx 1
`,xCe=Object.freeze(Object.defineProperty({__proto__:null,default:ECe},Symbol.toStringTag,{value:"Module"})),TCe=`desc;$DKGRAYDistortion for fx 2
`,wCe=Object.freeze(Object.defineProperty({__proto__:null,default:TCe},Symbol.toStringTag,{value:"Module"})),ACe=`desc;$DKGRAYstarts a do-done block
`,RCe=Object.freeze(Object.defineProperty({__proto__:null,default:ACe},Symbol.toStringTag,{value:"Module"})),CCe=`desc;$DKGRAYcompletes an if-do-done block
`,MCe=Object.freeze(Object.defineProperty({__proto__:null,default:CCe},Symbol.toStringTag,{value:"Module"})),kCe=`desc;$DKGRAYDuplicate element at direction in given direction
`,OCe=Object.freeze(Object.defineProperty({__proto__:null,default:kCe},Symbol.toStringTag,{value:"Module"})),ICe=`desc;$DKGRAYDuplicate element with argument
`,NCe=Object.freeze(Object.defineProperty({__proto__:null,default:ICe},Symbol.toStringTag,{value:"Module"})),PCe="desc;$DKGRAYDuplicate element at direction in given direction",DCe=Object.freeze(Object.defineProperty({__proto__:null,default:PCe},Symbol.toStringTag,{value:"Module"})),LCe=`desc;$DKGRAYDuplicate element with argument
`,UCe=Object.freeze(Object.defineProperty({__proto__:null,default:LCe},Symbol.toStringTag,{value:"Module"})),BCe="desc;$DKGRAYApply echo effect to fx 0-1",FCe=Object.freeze(Object.defineProperty({__proto__:null,default:BCe},Symbol.toStringTag,{value:"Module"})),jCe=`desc;$DKGRAYEcho for fx 0
`,zCe=Object.freeze(Object.defineProperty({__proto__:null,default:jCe},Symbol.toStringTag,{value:"Module"})),HCe=`desc;$DKGRAYEcho for fx 1
`,VCe=Object.freeze(Object.defineProperty({__proto__:null,default:HCe},Symbol.toStringTag,{value:"Module"})),GCe=`desc;$DKGRAYEcho for fx 2
`,$Ce=Object.freeze(Object.defineProperty({__proto__:null,default:GCe},Symbol.toStringTag,{value:"Module"})),WCe=`desc;$DKGRAYelse logic in an if-do-done block
`,qCe=Object.freeze(Object.defineProperty({__proto__:null,default:WCe},Symbol.toStringTag,{value:"Module"})),YCe=`desc;$DKGRAYconditional else logic in an if-do-done block
`,KCe=Object.freeze(Object.defineProperty({__proto__:null,default:YCe},Symbol.toStringTag,{value:"Module"})),XCe="desc;$DKGRAYEnd program (optionally set 'arg' variable)",ZCe=Object.freeze(Object.defineProperty({__proto__:null,default:XCe},Symbol.toStringTag,{value:"Module"})),JCe="desc;$DKGRAYSet health to 0",QCe=Object.freeze(Object.defineProperty({__proto__:null,default:JCe},Symbol.toStringTag,{value:"Module"})),eMe=`desc;$DKGRAY
`,tMe=Object.freeze(Object.defineProperty({__proto__:null,default:eMe},Symbol.toStringTag,{value:"Module"})),nMe=`desc;$DKGRAYShow export menu (operator only)
`,rMe=Object.freeze(Object.defineProperty({__proto__:null,default:nMe},Symbol.toStringTag,{value:"Module"})),iMe=`desc;$DKGRAYApply frequency crush to fx 0-1
`,sMe=Object.freeze(Object.defineProperty({__proto__:null,default:iMe},Symbol.toStringTag,{value:"Module"})),oMe=`desc;$DKGRAYFrequency crush for fx 0
`,aMe=Object.freeze(Object.defineProperty({__proto__:null,default:oMe},Symbol.toStringTag,{value:"Module"})),cMe=`desc;$DKGRAYFrequency crush for fx 1
`,lMe=Object.freeze(Object.defineProperty({__proto__:null,default:cMe},Symbol.toStringTag,{value:"Module"})),uMe=`desc;$DKGRAYFrequency crush for fx 2
`,hMe=Object.freeze(Object.defineProperty({__proto__:null,default:uMe},Symbol.toStringTag,{value:"Module"})),fMe=`desc;$DKGRAYFetch URL with label, method, and optional data
`,dMe=Object.freeze(Object.defineProperty({__proto__:null,default:fMe},Symbol.toStringTag,{value:"Module"})),pMe=`desc;$DKGRAYFetch URL with argument, label, method, and optional data
`,mMe=Object.freeze(Object.defineProperty({__proto__:null,default:pMe},Symbol.toStringTag,{value:"Module"})),gMe=`desc;$DKGRAYHighlight matched elements
`,_Me=Object.freeze(Object.defineProperty({__proto__:null,default:gMe},Symbol.toStringTag,{value:"Module"})),vMe=`desc;$DKGRAY
`,yMe=Object.freeze(Object.defineProperty({__proto__:null,default:vMe},Symbol.toStringTag,{value:"Module"})),bMe=`desc;$DKGRAYOpen tab with copy of state (operator only)
`,SMe=Object.freeze(Object.defineProperty({__proto__:null,default:bMe},Symbol.toStringTag,{value:"Module"})),EMe=`desc;$DKGRAYToggle built-in inspector
`,xMe=Object.freeze(Object.defineProperty({__proto__:null,default:EMe},Symbol.toStringTag,{value:"Module"})),TMe=`desc;$DKGRAYMove element in direction
`,wMe=Object.freeze(Object.defineProperty({__proto__:null,default:TMe},Symbol.toStringTag,{value:"Module"})),AMe=`desc;$DKGRAYTeleport player to board by stat with optional x, y
`,RMe=Object.freeze(Object.defineProperty({__proto__:null,default:AMe},Symbol.toStringTag,{value:"Module"})),CMe=`desc;$DKGRAYShow help scroll
`,MMe=Object.freeze(Object.defineProperty({__proto__:null,default:CMe},Symbol.toStringTag,{value:"Module"})),kMe=`desc;$DKGRAYhyperlink
`,OMe=Object.freeze(Object.defineProperty({__proto__:null,default:kMe},Symbol.toStringTag,{value:"Module"})),IMe=`desc;$DKGRAYYield execution until next tick
`,NMe=Object.freeze(Object.defineProperty({__proto__:null,default:IMe},Symbol.toStringTag,{value:"Module"})),PMe=`desc;$DKGRAYevals condition for true or false
`,DMe=Object.freeze(Object.defineProperty({__proto__:null,default:PMe},Symbol.toStringTag,{value:"Module"})),LMe=`desc;$DKGRAYExport zip file for itch.io (operator only)
`,UMe=Object.freeze(Object.defineProperty({__proto__:null,default:LMe},Symbol.toStringTag,{value:"Module"})),BMe=`desc;$DKGRAYStart multiplayer session (operator only)
`,FMe=Object.freeze(Object.defineProperty({__proto__:null,default:BMe},Symbol.toStringTag,{value:"Module"})),jMe=`desc;$DKGRAYOpen new tab with the join url (operator only)
`,zMe=Object.freeze(Object.defineProperty({__proto__:null,default:jMe},Symbol.toStringTag,{value:"Module"})),HMe=`desc;$DKGRAYLoad code from object codepage into object at given direction
`,VMe=Object.freeze(Object.defineProperty({__proto__:null,default:HMe},Symbol.toStringTag,{value:"Module"})),GMe=`desc;$DKGRAYLock against external messages
`,$Me=Object.freeze(Object.defineProperty({__proto__:null,default:GMe},Symbol.toStringTag,{value:"Module"})),WMe=`desc;$DKGRAYDoes a countdown and reloads into an empty state (operator only)
`,qMe=Object.freeze(Object.defineProperty({__proto__:null,default:WMe},Symbol.toStringTag,{value:"Module"})),YMe=`desc;$DKGRAYUses given id to ensure only one element of given kind is made
`,KMe=Object.freeze(Object.defineProperty({__proto__:null,default:YMe},Symbol.toStringTag,{value:"Module"})),XMe=`desc;$DKGRAYPut element with argument and oneof logic
`,ZMe=Object.freeze(Object.defineProperty({__proto__:null,default:XMe},Symbol.toStringTag,{value:"Module"})),JMe=`desc;$DKGRAYExport code page as JSON (operator only)
`,QMe=Object.freeze(Object.defineProperty({__proto__:null,default:JMe},Symbol.toStringTag,{value:"Module"})),eke=`desc;$DKGRAYOpen a code page editor
`,tke=Object.freeze(Object.defineProperty({__proto__:null,default:eke},Symbol.toStringTag,{value:"Module"})),nke=`desc;$DKGRAYList all pages in main book
`,rke=Object.freeze(Object.defineProperty({__proto__:null,default:nke},Symbol.toStringTag,{value:"Module"})),ike=`desc;$DKGRAYTrash a code page (operator only)
`,ske=Object.freeze(Object.defineProperty({__proto__:null,default:ike},Symbol.toStringTag,{value:"Module"})),oke=`desc;$DKGRAY
`,ake=Object.freeze(Object.defineProperty({__proto__:null,default:oke},Symbol.toStringTag,{value:"Module"})),cke=`desc;$DKGRAYRotate board elements by degrees
`,lke=Object.freeze(Object.defineProperty({__proto__:null,default:cke},Symbol.toStringTag,{value:"Module"})),uke="desc;$DKGRAYPlay music notes",hke=Object.freeze(Object.defineProperty({__proto__:null,default:uke},Symbol.toStringTag,{value:"Module"})),fke=`desc;$DKGRAYShove target object in direction ONLY if pushable
`,dke=Object.freeze(Object.defineProperty({__proto__:null,default:fke},Symbol.toStringTag,{value:"Module"})),pke="desc;$DKGRAYPut element in direction",mke=Object.freeze(Object.defineProperty({__proto__:null,default:pke},Symbol.toStringTag,{value:"Module"})),gke=`desc;$DKGRAYPut element with argument
`,_ke=Object.freeze(Object.defineProperty({__proto__:null,default:gke},Symbol.toStringTag,{value:"Module"})),vke=`desc;$DKGRAYRead property from object into variable
`,yke=Object.freeze(Object.defineProperty({__proto__:null,default:vke},Symbol.toStringTag,{value:"Module"})),bke=`desc;$DKGRAYParse binary data
`,Ske=Object.freeze(Object.defineProperty({__proto__:null,default:bke},Symbol.toStringTag,{value:"Module"})),Eke=`desc;$DKGRAYParse JSON data
`,xke=Object.freeze(Object.defineProperty({__proto__:null,default:Eke},Symbol.toStringTag,{value:"Module"})),Tke=`desc;$DKGRAYParse text data
`,wke=Object.freeze(Object.defineProperty({__proto__:null,default:Tke},Symbol.toStringTag,{value:"Module"})),Ake=`desc;$DKGRAY
`,Rke=Object.freeze(Object.defineProperty({__proto__:null,default:Ake},Symbol.toStringTag,{value:"Module"})),Cke=`desc;$DKGRAYRemix from source with pattern size and mirror to current board
`,Mke=Object.freeze(Object.defineProperty({__proto__:null,default:Cke},Symbol.toStringTag,{value:"Module"})),kke=`desc;$DKGRAY
`,Oke=Object.freeze(Object.defineProperty({__proto__:null,default:kke},Symbol.toStringTag,{value:"Module"})),Ike=`desc;$DKGRAYRestart software, deletes all chip and player state (operator only)
`,Nke=Object.freeze(Object.defineProperty({__proto__:null,default:Ike},Symbol.toStringTag,{value:"Module"})),Pke=`desc;$DKGRAYRestore all labels of given name
`,Dke=Object.freeze(Object.defineProperty({__proto__:null,default:Pke},Symbol.toStringTag,{value:"Module"})),Lke=`desc;$DKGRAYApply reverb to fx 0-1
`,Uke=Object.freeze(Object.defineProperty({__proto__:null,default:Lke},Symbol.toStringTag,{value:"Module"})),Bke=`desc;$DKGRAYReverb for fx 0
`,Fke=Object.freeze(Object.defineProperty({__proto__:null,default:Bke},Symbol.toStringTag,{value:"Module"})),jke=`desc;$DKGRAYReverb for fx 1
`,zke=Object.freeze(Object.defineProperty({__proto__:null,default:jke},Symbol.toStringTag,{value:"Module"})),Hke=`desc;$DKGRAYReverb for fx 2
`,Vke=Object.freeze(Object.defineProperty({__proto__:null,default:Hke},Symbol.toStringTag,{value:"Module"})),Gke=`desc;$DKGRAYRevert board to snapshot state
`,$ke=Object.freeze(Object.defineProperty({__proto__:null,default:Gke},Symbol.toStringTag,{value:"Module"})),Wke=`desc;$DKGRAYRun object codepage of given name
`,qke=Object.freeze(Object.defineProperty({__proto__:null,default:Wke},Symbol.toStringTag,{value:"Module"})),Yke=`desc;$DKGRAYRun function with argument
`,Kke=Object.freeze(Object.defineProperty({__proto__:null,default:Yke},Symbol.toStringTag,{value:"Module"})),Xke=`desc;$DKGRAYSave state to url (operator only)
`,Zke=Object.freeze(Object.defineProperty({__proto__:null,default:Xke},Symbol.toStringTag,{value:"Module"})),Jke=`desc;$DKGRAYsend
`,Qke=Object.freeze(Object.defineProperty({__proto__:null,default:Jke},Symbol.toStringTag,{value:"Module"})),eOe="desc;$DKGRAYSet variable to value",tOe=Object.freeze(Object.defineProperty({__proto__:null,default:eOe},Symbol.toStringTag,{value:"Module"})),nOe=`desc;$DKGRAYget share url (operator only)
`,rOe=Object.freeze(Object.defineProperty({__proto__:null,default:nOe},Symbol.toStringTag,{value:"Module"})),iOe=`desc;$DKGRAYShoot projectile, with optional kind
`,sOe=Object.freeze(Object.defineProperty({__proto__:null,default:iOe},Symbol.toStringTag,{value:"Module"})),oOe=`desc;$DKGRAYShoot projectile with argument
`,aOe=Object.freeze(Object.defineProperty({__proto__:null,default:oOe},Symbol.toStringTag,{value:"Module"})),cOe=`desc;$DKGRAYshortsend
`,lOe=Object.freeze(Object.defineProperty({__proto__:null,default:cOe},Symbol.toStringTag,{value:"Module"})),uOe=`desc;$DKGRAYShove target object in direction
`,hOe=Object.freeze(Object.defineProperty({__proto__:null,default:uOe},Symbol.toStringTag,{value:"Module"})),fOe=`desc;$DKGRAYCreate board snapshot
`,dOe=Object.freeze(Object.defineProperty({__proto__:null,default:fOe},Symbol.toStringTag,{value:"Module"})),pOe=`desc;$DKGRAYstat
`,mOe=Object.freeze(Object.defineProperty({__proto__:null,default:pOe},Symbol.toStringTag,{value:"Module"})),gOe=`desc;$DKGRAYConfigure or restart 8track synth
`,_Oe=Object.freeze(Object.defineProperty({__proto__:null,default:gOe},Symbol.toStringTag,{value:"Module"})),vOe=`desc;$DKGRAYConfigure synth voice 1
`,yOe=Object.freeze(Object.defineProperty({__proto__:null,default:vOe},Symbol.toStringTag,{value:"Module"})),bOe=`desc;$DKGRAYConfigure synth voice 2
`,SOe=Object.freeze(Object.defineProperty({__proto__:null,default:bOe},Symbol.toStringTag,{value:"Module"})),EOe=`desc;$DKGRAYConfigure synth voice 3
`,xOe=Object.freeze(Object.defineProperty({__proto__:null,default:EOe},Symbol.toStringTag,{value:"Module"})),TOe=`desc;$DKGRAYConfigure synth voice 4
`,wOe=Object.freeze(Object.defineProperty({__proto__:null,default:TOe},Symbol.toStringTag,{value:"Module"})),AOe=`desc;$DKGRAYConfigure bgplay synth (voices 4-8)
`,ROe=Object.freeze(Object.defineProperty({__proto__:null,default:AOe},Symbol.toStringTag,{value:"Module"})),COe=`desc;$DKGRAYClear buffer of played notes
`,MOe=Object.freeze(Object.defineProperty({__proto__:null,default:COe},Symbol.toStringTag,{value:"Module"})),kOe=`desc;$DKGRAYRecord played note buffer to an mp3 file
`,OOe=Object.freeze(Object.defineProperty({__proto__:null,default:kOe},Symbol.toStringTag,{value:"Module"})),IOe=`desc;$DKGRAYtext
`,NOe=Object.freeze(Object.defineProperty({__proto__:null,default:IOe},Symbol.toStringTag,{value:"Module"})),POe="desc;$DKGRAYThrow star projectile, shorthand for `#shoot <dir> star`\n",DOe=Object.freeze(Object.defineProperty({__proto__:null,default:POe},Symbol.toStringTag,{value:"Module"})),LOe=`desc;$DKGRAYThrow star with argument
`,UOe=Object.freeze(Object.defineProperty({__proto__:null,default:LOe},Symbol.toStringTag,{value:"Module"})),BOe=`desc;$DKGRAYSets element ticker text
`,FOe=Object.freeze(Object.defineProperty({__proto__:null,default:BOe},Symbol.toStringTag,{value:"Module"})),jOe=`desc;$DKGRAYShow toast notification
`,zOe=Object.freeze(Object.defineProperty({__proto__:null,default:jOe},Symbol.toStringTag,{value:"Module"})),HOe=`desc;$DKGRAYMove element across board with transporter logic
`,VOe=Object.freeze(Object.defineProperty({__proto__:null,default:HOe},Symbol.toStringTag,{value:"Module"})),GOe=`desc;$DKGRAYList books/codepages to delete (operator only)
`,$Oe=Object.freeze(Object.defineProperty({__proto__:null,default:GOe},Symbol.toStringTag,{value:"Module"})),WOe=`desc;$DKGRAYSpeak text with voice (or clear queue)
`,qOe=Object.freeze(Object.defineProperty({__proto__:null,default:WOe},Symbol.toStringTag,{value:"Module"})),YOe=`desc;$DKGRAYSet TTS engine and config
`,KOe=Object.freeze(Object.defineProperty({__proto__:null,default:YOe},Symbol.toStringTag,{value:"Module"})),XOe=`desc;$DKGRAYQueue TTS phrase
`,ZOe=Object.freeze(Object.defineProperty({__proto__:null,default:XOe},Symbol.toStringTag,{value:"Module"})),JOe=`desc;$DKGRAYSet TTS volume
`,QOe=Object.freeze(Object.defineProperty({__proto__:null,default:JOe},Symbol.toStringTag,{value:"Module"})),e3e=`desc;$DKGRAY
`,t3e=Object.freeze(Object.defineProperty({__proto__:null,default:e3e},Symbol.toStringTag,{value:"Module"})),n3e=`desc;$DKGRAY
`,r3e=Object.freeze(Object.defineProperty({__proto__:null,default:n3e},Symbol.toStringTag,{value:"Module"})),i3e=`desc;$DKGRAYUnlock against messages from others
`,s3e=Object.freeze(Object.defineProperty({__proto__:null,default:i3e},Symbol.toStringTag,{value:"Module"})),o3e=`desc;$DKGRAYAutomate user input actions (up/down/left/right/etc)
`,a3e=Object.freeze(Object.defineProperty({__proto__:null,default:o3e},Symbol.toStringTag,{value:"Module"})),c3e=`desc;$DKGRAYApply vibrato to fx 0-1
`,l3e=Object.freeze(Object.defineProperty({__proto__:null,default:c3e},Symbol.toStringTag,{value:"Module"})),u3e=`desc;$DKGRAYVibrato for fx 0
`,h3e=Object.freeze(Object.defineProperty({__proto__:null,default:u3e},Symbol.toStringTag,{value:"Module"})),f3e=`desc;$DKGRAYVibrato for fx 1
`,d3e=Object.freeze(Object.defineProperty({__proto__:null,default:f3e},Symbol.toStringTag,{value:"Module"})),p3e=`desc;$DKGRAYVibrato for fx 2
`,m3e=Object.freeze(Object.defineProperty({__proto__:null,default:p3e},Symbol.toStringTag,{value:"Module"})),g3e="desc;$DKGRAYSet main volume",_3e=Object.freeze(Object.defineProperty({__proto__:null,default:g3e},Symbol.toStringTag,{value:"Module"})),v3e="desc;$DKGRAY",y3e=Object.freeze(Object.defineProperty({__proto__:null,default:v3e},Symbol.toStringTag,{value:"Module"})),b3e="desc;$DKGRAYWill cause element to move in direction each tick",S3e=Object.freeze(Object.defineProperty({__proto__:null,default:b3e},Symbol.toStringTag,{value:"Module"})),E3e="desc;$DKGRAYWeave board elements in direction",x3e=Object.freeze(Object.defineProperty({__proto__:null,default:E3e},Symbol.toStringTag,{value:"Module"})),T3e="desc;$DKGRAYlooping do-done block",w3e=Object.freeze(Object.defineProperty({__proto__:null,default:T3e},Symbol.toStringTag,{value:"Module"})),A3e="desc;$DKGRAYSwitch to target board by id, name, or stat",R3e=Object.freeze(Object.defineProperty({__proto__:null,default:A3e},Symbol.toStringTag,{value:"Module"})),C3e="desc;$DKGRAYSwitch to target object id",M3e=Object.freeze(Object.defineProperty({__proto__:null,default:C3e},Symbol.toStringTag,{value:"Module"})),k3e="desc;$DKGRAYWrite text to board at direction",O3e=Object.freeze(Object.defineProperty({__proto__:null,default:k3e},Symbol.toStringTag,{value:"Module"})),I3e="desc;$DKGRAYDe-activate first label of given name",N3e=Object.freeze(Object.defineProperty({__proto__:null,default:I3e},Symbol.toStringTag,{value:"Module"})),P3e=`desc;$DKGRAYGet random ZZT content
`,D3e=Object.freeze(Object.defineProperty({__proto__:null,default:P3e},Symbol.toStringTag,{value:"Module"})),L3e=`desc;$DKGRAYSearch ZZT content by field and text
`,U3e=Object.freeze(Object.defineProperty({__proto__:null,default:L3e},Symbol.toStringTag,{value:"Module"})),B3e=`desc;$DKGRAYdesignates an inactive label or comment
`,F3e=Object.freeze(Object.defineProperty({__proto__:null,default:B3e},Symbol.toStringTag,{value:"Module"})),j3e=`desc;$DKGRAYadds hyperlink text

`,z3e=Object.freeze(Object.defineProperty({__proto__:null,default:j3e},Symbol.toStringTag,{value:"Module"})),H3e=`desc;$DKGRAYsends the given message when hotkey is pressed

`,V3e=Object.freeze(Object.defineProperty({__proto__:null,default:H3e},Symbol.toStringTag,{value:"Module"})),G3e=`desc;$DKGRAYread number input into given stat/flag
`,$3e=Object.freeze(Object.defineProperty({__proto__:null,default:G3e},Symbol.toStringTag,{value:"Module"})),W3e=`desc;$DKGRAYa slider input from 1 to 9 

`,q3e=Object.freeze(Object.defineProperty({__proto__:null,default:W3e},Symbol.toStringTag,{value:"Module"})),Y3e=`desc;$DKGRAYlist with label value pairs to pick from
`,K3e=Object.freeze(Object.defineProperty({__proto__:null,default:Y3e},Symbol.toStringTag,{value:"Module"})),X3e=`desc;$DKGRAYread text input into given stat/flag
`,Z3e=Object.freeze(Object.defineProperty({__proto__:null,default:X3e},Symbol.toStringTag,{value:"Module"})),J3e=`desc;$DKGRAYdesignates a starting point for running code
`,Q3e=Object.freeze(Object.defineProperty({__proto__:null,default:J3e},Symbol.toStringTag,{value:"Module"})),eIe=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,tIe=Object.freeze(Object.defineProperty({__proto__:null,default:eIe},Symbol.toStringTag,{value:"Module"})),nIe=`desc;$DKGRAYwill move the object in the given direction
`,rIe=Object.freeze(Object.defineProperty({__proto__:null,default:nIe},Symbol.toStringTag,{value:"Module"})),iIe=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,sIe=Object.freeze(Object.defineProperty({__proto__:null,default:iIe},Symbol.toStringTag,{value:"Module"})),oIe=`desc;$DKGRAYcustom 8x14 charset
`,aIe=Object.freeze(Object.defineProperty({__proto__:null,default:oIe},Symbol.toStringTag,{value:"Module"})),cIe=`desc;$DKGRAYsets stat to given value

`,lIe=Object.freeze(Object.defineProperty({__proto__:null,default:cIe},Symbol.toStringTag,{value:"Module"})),uIe=`desc;$DKGRAYsends the given message when hotkey is pressed

`,hIe=Object.freeze(Object.defineProperty({__proto__:null,default:uIe},Symbol.toStringTag,{value:"Module"})),fIe=`desc;$DKGRAYread external content and/or handle events
`,dIe=Object.freeze(Object.defineProperty({__proto__:null,default:fIe},Symbol.toStringTag,{value:"Module"})),pIe=`desc;$DKGRAYread number input into given stat/flag
`,mIe=Object.freeze(Object.defineProperty({__proto__:null,default:pIe},Symbol.toStringTag,{value:"Module"})),gIe=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,_Ie=Object.freeze(Object.defineProperty({__proto__:null,default:gIe},Symbol.toStringTag,{value:"Module"})),vIe=`desc;$DKGRAYcustom palette colors
`,yIe=Object.freeze(Object.defineProperty({__proto__:null,default:vIe},Symbol.toStringTag,{value:"Module"})),bIe=`desc;$DKGRAYa slider input from 1 to 9 

`,SIe=Object.freeze(Object.defineProperty({__proto__:null,default:bIe},Symbol.toStringTag,{value:"Module"})),EIe=`desc;$DKGRAYlist with label value pairs to pick from
`,xIe=Object.freeze(Object.defineProperty({__proto__:null,default:EIe},Symbol.toStringTag,{value:"Module"})),TIe=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,wIe=Object.freeze(Object.defineProperty({__proto__:null,default:TIe},Symbol.toStringTag,{value:"Module"})),AIe=`desc;$DKGRAYread text input into given stat/flag
`,RIe=Object.freeze(Object.defineProperty({__proto__:null,default:AIe},Symbol.toStringTag,{value:"Module"})),CIe=`desc;$DKGRAYadds text
`,MIe=Object.freeze(Object.defineProperty({__proto__:null,default:CIe},Symbol.toStringTag,{value:"Module"})),kIe=`$white no pages found
$white use @ to create a page
$white @board name of board
$white @object name of object
$white @terrain name of terrain
$white You can omit the type and it will default to object
$white @object name of object
$white @name of object`,OIe=Object.freeze(Object.defineProperty({__proto__:null,default:kIe},Symbol.toStringTag,{value:"Module"})),IIe=`section;legend
s1, s2, s3, s4 = sound sources/operators
m = modulator
c = carrier
--> = signal flow
section;algo0
S1 --> M --> S2 --> M --> S3 --> M --> S4 --> C
`,NIe=Object.freeze(Object.defineProperty({__proto__:null,default:IIe},Symbol.toStringTag,{value:"Module"})),PIe=`section;#autofilter on
#autofilter <number>
$white 0-100, 0 is off, 100 is full volume
#autofilter depth <number>
$white Controls the intensity of the filter.
#autofilter frequency <number>
$white The rate of oscilation of the effect.
#autofilter octaves <number>
$white Controls the range of the effect.
#autofilter q <number>
$white Sets the intensity of the effect.
#autofilter type <lowpass, highpass, ...>
$white Sets the behavior of the filter.
!openit https://developer.mozilla.org/en-US/docs/Web/API/BiquadFilterNode/type;filter types`,DIe=Object.freeze(Object.defineProperty({__proto__:null,default:PIe},Symbol.toStringTag,{value:"Module"})),LIe=`section;#autowah on
#autowah <number>
$white 0-100, 0 is off, 100 is full volume
#autowah basefrequency <frequency>
$white The frequency the filter is set to at the
$white low point of the wah.
#autowah octaves <number>
$white The number of octaves above the baseFrequency 
$white the filter will sweep to when fully open.
#autowah sensitivity <number>
$white The decibel threshold sensitivity for 
$white the incoming signal.
$white Normal range of -40 to 0.
#autowah gain <number>
$white Controls the loudness of the effect.
#autowah follower <seconds>
$white Sets the smoothing time for the effect.`,UIe=Object.freeze(Object.defineProperty({__proto__:null,default:LIe},Symbol.toStringTag,{value:"Module"})),BIe=`press$white C$yellow to chat
press$white #$yellow to run a quick command
section;dev-tools
#gadget
$white toggles inspector tool on/off
#zztrandom
$white downloads random from the museumofzzt api
#zztsearch <field> <value>
$white searches the museumofzzt api for zzt games
section;multi-player
#set user <name>
$white sets your display name when talking to others
#joincode OR $meta+O 
$white starts a multi-player session showing a
$white QR code. It also provides are sharable link
$white you can give to other to join the game.`,FIe=Object.freeze(Object.defineProperty({__proto__:null,default:BIe},Symbol.toStringTag,{value:"Module"})),jIe=`section;#distort on
#distort <number>
$white 0-100, 0 is off, 100 is full volume
#distort distortion <number>
$white 0 or higher, controls strength of effect.
#distort oversample <2x|4x|none>
$white oversample improves quality.`,zIe=Object.freeze(Object.defineProperty({__proto__:null,default:jIe},Symbol.toStringTag,{value:"Module"})),HIe=`section;#echo on
#echo <number>
$white 0-100, 0 is off, 100 is full volume
#echo delaytime <seconds>
$white duration between echos.
#echo feedback <number>
$white A number that is between [0, 1]
$white 1 is forever feedback and 0 is none.`,VIe=Object.freeze(Object.defineProperty({__proto__:null,default:HIe},Symbol.toStringTag,{value:"Module"})),GIe=`!fcrushscroll hk c C next;#fcrush on
!echoscroll hk e E next;#echo on
!reverbscroll hk r R next;#reverb on
!autofilterscroll hk f F next;#autofilter on
!distortscroll hk d D next;#distort on
!vibratoscroll hk v V next;#vibrato on
!autowahscroll hk w W next;#autowah on`,$Ie=Object.freeze(Object.defineProperty({__proto__:null,default:GIe},Symbol.toStringTag,{value:"Module"})),WIe=`section;#fcrush on
#fcrush <number>
$white 0-100, 0 is off, 100 is full volume
#fcrush rate <number>
$white 1 or higher, more rate, more crush`,qIe=Object.freeze(Object.defineProperty({__proto__:null,default:WIe},Symbol.toStringTag,{value:"Module"})),YIe=`section;keyboard input
option;arrow keys;$greenmove
option;shift + arrow keys;$greenshoot
option;enter;$greenok / accept
option;escape;$greencancel / close
option;tab;$greenmenu / layout
section;controller input
option;left stick;$greenmove
option;right stick;$greenshoot
option;left trigger;$greenalt
option;right trigger;$green$meta
option;left shoulder;$greencancel / close
option;right shoulder;$greenok / accept
option;d-pad;$greenmove
option;a X;$greenshoot down
option;b $9;$greenshoot right
option;x $254;$greenshoot left
option;y $30;$greenshoot up
option;menu;$greenmenu / change layout
`,KIe=Object.freeze(Object.defineProperty({__proto__:null,default:YIe},Symbol.toStringTag,{value:"Module"})),XIe=`option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,ZIe=Object.freeze(Object.defineProperty({__proto__:null,default:XIe},Symbol.toStringTag,{value:"Module"})),JIe=`!helpcontrols hk c C next;read help on controls
!helptext hk t T next;read help on text and inputs
"
keyboard input
option;? or /;$greenopen cli
option;esc;$greenclose cli, scroll, or editor
option;tab;$greenchange layout
option;up or down arrow keys;$greennavigate cli lines
option;left or right arrow keys;$greenchange cli lines
option;enter;$greenaction on selected line
option;alt + arrow keys;$greenskip words and cli lines
option;$meta + up / down arrow keys;$greeninput history`,QIe=Object.freeze(Object.defineProperty({__proto__:null,default:JIe},Symbol.toStringTag,{value:"Module"})),eNe=`player settings
$white#set user "name goes here"
`,tNe=Object.freeze(Object.defineProperty({__proto__:null,default:eNe},Symbol.toStringTag,{value:"Module"})),nNe=`section;typography
plain text
use $34@quoted strings for special chars$34
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$yellow to change
 foreground color
use color names like $black$ONGREEN$$ongreen$ONCLEAR$yellow to change
 background color
use onclear $WHITE$$onclear$yellow to change
 background to transparent
section;hyperlinks
"
option;!message$59 Label;
send the given #message when the
<hyperlink> is pressed
"
option;!message hotkey <shortcut>$59 Label;
option;!message hk <shortcut>$59 Label;
send the given #message when the <shortcut>
is pressed. is-hotkey listens for <shortcut>
!openit https://github.com/ianstormtaylor/is-hotkey;$whiteis-hotkey on https://github.com/
"
option;!flagorstat range [minword] [maxword]$59 Label;
option;!flagorstat rn [minword] [maxword]$59 Label;
uses the standard 1 to 9 values input range
[minword] is the label for value 1
[maxword] is the label for value 9
write user range input into a flagorstat
"
option;!flagorstat select <choices>$59 Label;
option;!flagorstat sl <choices>$59 Label;
<choices> is a list of <word> <value> pairs
select gives a user a way to cycle through
preset choices
write user select input into a flagorstat
"
option;!flagorstat number$59 Label;
option;!flagorstat nm$59 Label;
write user number input into a flagorstat
"
option;!flagorstat text$59 Label;
option;!flagorstat tx$59 Label;
write user text input into a flagorstat
"
option;!copyit content goes here$59 Label;
copies given content into the clipboard
"
option;!openit url$59 Label;
opens the given url in a new browser tab
"
option;!runit content goes here$59 Label;
opens the cli, with the input filled out with 
the given content`,rNe=Object.freeze(Object.defineProperty({__proto__:null,default:nNe},Symbol.toStringTag,{value:"Module"})),iNe=`!helpmenu hk 1 1 next;controls and $greenstart here
!objectlistscroll hk 2 2 next;list object elements
!terrainlistscroll hk 3 3 next;list terrain elements
!adminscroll hk 4 4 next;cpu #admin
!cliscroll hk t T next;cli commands
!dictionary hk d D next;dictionary of commands
!charscroll hk a A next;char
!colorscroll hk c C next;color
!bgscroll hk b B next;bg
!notesscroll hk n N next;notes
!synthscroll hk s S next;synth
!effectsscroll hk e E next;effects
!voicescroll hk v V next;tts voices
`,sNe=Object.freeze(Object.defineProperty({__proto__:null,default:iNe},Symbol.toStringTag,{value:"Module"})),oNe=`"duration             cdefgab = notes 
"y = 64th note        x = rest
"t = 32nd note        
"s = 16th note        drums
"i = eight note       0 = hihat
"q = quarter note     1 = open hihat
"h = half note        2 = cowbell
"w = whole note       p = clap
"mods                 4 = high snare
"3 = triplet          5 = high woodblock
". = time and a half  6 = low snare
"# = sharp            7 = low tom
"! = flat             8 = low woodblock
"+ = increase octave  9 = bass drum
"- = decrease octave
helpful resource on scales
!openit https://www.pianoscales.org/;https://www.pianoscales.org/`,aNe=Object.freeze(Object.defineProperty({__proto__:null,default:oNe},Symbol.toStringTag,{value:"Module"})),cNe=`section;sine, square, triangle, sawtooth
#synth phase <degrees>
$white The phase is the starting position within 
$white the oscillator's cycle. For example a phase 
$white of 180 would start halfway through the
$white oscillator's cycle.
section;amsine, amsquare, amtriangle, amsawtooth
#synth harmonicity <number>
$white Harmonicity is the frequency ratio between 
$white the carrier and the modulator oscillators.
$white A harmonicity of 1 gives both oscillators 
$white the same frequency. Harmonicity = 2 
$white means a change of an octave.
#synth modtype <sine, square, triangle, sawtooth>
#synth modenv <a> <d> <s> <r> - in seconds
section;fmsine, fmsquare, fmtriangle, fmsawtooth
#synth harmonicity <number>
$white Harmonicity is the frequency ratio between 
$white the carrier and the modulator oscillators.
$white A harmonicity of 1 gives both oscillators 
$white the same frequency. Harmonicity = 2 
$white means a change of an octave.
#synth modtype <sine, square, triangle, sawtooth>
#synth modenv <a> <d> <s> <r> - in seconds
#synth modindex <degrees>
$white The modulation index which is in essence
$white the depth or amount of the modulation.
$white In other terms it is the ratio of the 
$white frequency of the modulating signal (mf) 
$white to the amplitude of the modulating signal 
$white (ma) -- as in ma/mf
section;fatsine, fatsquare, fattriangle, fatsawtooth
#synth phase <degrees>
#synth count <number>
$white This sets the number of oscillators to 
$white spread along the given range.
#synth spread <cents>
$white This signals the number of cents between
$white oscillators.`,lNe=Object.freeze(Object.defineProperty({__proto__:null,default:cNe},Symbol.toStringTag,{value:"Module"})),uNe=`section;pulse
#synth width <range>
$white A number that is between [-1, 1] altering
$white this value changes the shape of the square
$white wave`,hNe=Object.freeze(Object.defineProperty({__proto__:null,default:uNe},Symbol.toStringTag,{value:"Module"})),fNe=`section;pwm
#synth modfreq <frequency>
$white This sets the frequency of change for the 
$white pulse width of this oscillator.`,dNe=Object.freeze(Object.defineProperty({__proto__:null,default:fNe},Symbol.toStringTag,{value:"Module"})),pNe=`section;#reverb on
#reverb <number>
$white 0-100, 0 is off, 100 is full volume
#reverb predelay <seconds>
$white The amount of time before the reverb
$white is fully ramped in.
#reverb decay <seconds>
$white The duration of the reverb.
`,mNe=Object.freeze(Object.defineProperty({__proto__:null,default:pNe},Symbol.toStringTag,{value:"Module"})),gNe=`switching voices
#synth <sine, square, triangle, sawtooth> 
#synth <pwm, pulse, bells, doot>
#synth <retro, buzz, clang, metallic>
#synth <retro, buzz, clang, metallic>
#synth <algo0, algo1, ... ,algo7> 
voice settings
#synth restart - resets voice to default
#synth vol <db> - control volume
#synth port <seconds>
#synth env <attack> <delay> <sustain> <release>
voice specific 
!oscscroll hk o O next;sine, square, triangle, sawtooth
!pwmscroll hk m M next;pwm
!pulsescroll hk p P next;pulse
!algoscroll hk a A next;algo0 -> algo7
`,_Ne=Object.freeze(Object.defineProperty({__proto__:null,default:gNe},Symbol.toStringTag,{value:"Module"})),vNe=`section;#vibrato on
#vibrato <number>
$white 0-100, 0 is off, 100 is full volume
#vibrato maxdelay <seconds>
$white longer delay increases the vibrato`,yNe=Object.freeze(Object.defineProperty({__proto__:null,default:vNe},Symbol.toStringTag,{value:"Module"})),bNe=`update this to explain

#tts
#ttsqueue
#ttsengine
`,SNe=Object.freeze(Object.defineProperty({__proto__:null,default:bNe},Symbol.toStringTag,{value:"Module"}));var I1=(n=>(n[n.Border=-1]="Border",n[n.Data=0]="Data",n[n.Function=1]="Function",n[n.Position=2]="Position",n[n.Timing=3]="Timing",n[n.Alignment=4]="Alignment",n))(I1||{}),ENe=Object.defineProperty,xNe=(n,e,t)=>e in n?ENe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,P2=(n,e,t)=>(xNe(n,typeof e!="symbol"?e+"":e,t),t);const TNe=[0,1],hQ=[1,0],fQ=[2,3],dQ=[3,2],wNe={L:TNe,M:hQ,Q:fQ,H:dQ},ANe=/^[0-9]*$/,RNe=/^[A-Z0-9 $%*+.\/:-]*$/,ZN="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Q6=1,eU=40,zz=3,CNe=3,D2=40,MNe=10,pQ=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],mQ=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class kNe{constructor(e,t,r,i){if(this.version=e,this.ecc=t,P2(this,"size"),P2(this,"mask"),P2(this,"modules",[]),P2(this,"types",[]),e<Q6||e>eU)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=e*4+17;const s=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const o=this.addEccAndInterleave(r);if(this.drawCodewords(o),i===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const l=this.getPenaltyScore();l<a&&(i=c,a=l),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(e,t){return e>=0&&e<this.size&&t>=0&&t<this.size&&this.modules[t][e]}drawFunctionPatterns(){for(let r=0;r<this.size;r++)this.setFunctionModule(6,r,r%2===0,I1.Timing),this.setFunctionModule(r,6,r%2===0,I1.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),t=e.length;for(let r=0;r<t;r++)for(let i=0;i<t;i++)r===0&&i===0||r===0&&i===t-1||r===t-1&&i===0||this.drawAlignmentPattern(e[r],e[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const t=this.ecc[1]<<3|e;let r=t;for(let s=0;s<10;s++)r=r<<1^(r>>>9)*1335;const i=(t<<10|r)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,Mg(i,s));this.setFunctionModule(8,7,Mg(i,6)),this.setFunctionModule(8,8,Mg(i,7)),this.setFunctionModule(7,8,Mg(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,Mg(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,Mg(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,Mg(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let r=0;r<12;r++)e=e<<1^(e>>>11)*7973;const t=this.version<<12|e;for(let r=0;r<18;r++){const i=Mg(t,r),s=this.size-11+r%3,o=Math.floor(r/3);this.setFunctionModule(s,o,i),this.setFunctionModule(o,s,i)}}drawFinderPattern(e,t){for(let r=-4;r<=4;r++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(r)),o=e+i,a=t+r;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,s!==2&&s!==4,I1.Position)}}drawAlignmentPattern(e,t){for(let r=-2;r<=2;r++)for(let i=-2;i<=2;i++)this.setFunctionModule(e+i,t+r,Math.max(Math.abs(i),Math.abs(r))!==1,I1.Alignment)}setFunctionModule(e,t,r,i=I1.Function){this.modules[t][e]=r,this.types[t][e]=i}addEccAndInterleave(e){const t=this.version,r=this.ecc;if(e.length!==BC(t,r))throw new RangeError("Invalid argument");const i=mQ[r[0]][t],s=pQ[r[0]][t],o=Math.floor(QL(t)/8),a=i-o%i,c=Math.floor(o/i),l=[],u=FNe(s);for(let f=0,d=0;f<i;f++){const p=e.slice(d,d+c-s+(f<a?0:1));d+=p.length;const _=jNe(p,u);f<a&&p.push(0),l.push(p.concat(_))}const h=[];for(let f=0;f<l[0].length;f++)l.forEach((d,p)=>{(f!==c-s||p>=a)&&h.push(d[f])});return h}drawCodewords(e){if(e.length!==Math.floor(QL(this.version)/8))throw new RangeError("Invalid argument");let t=0;for(let r=this.size-1;r>=1;r-=2){r===6&&(r=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const o=r-s,c=(r+1&2)===0?this.size-1-i:i;!this.types[c][o]&&t<e.length*8&&(this.modules[c][o]=Mg(e[t>>>3],7-(t&7)),t++)}}}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let t=0;t<this.size;t++)for(let r=0;r<this.size;r++){let i;switch(e){case 0:i=(r+t)%2===0;break;case 1:i=t%2===0;break;case 2:i=r%3===0;break;case 3:i=(r+t)%3===0;break;case 4:i=(Math.floor(r/3)+Math.floor(t/2))%2===0;break;case 5:i=r*t%2+r*t%3===0;break;case 6:i=(r*t%2+r*t%3)%2===0;break;case 7:i=((r+t)%2+r*t%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[t][r]&&i&&(this.modules[t][r]=!this.modules[t][r])}}getPenaltyScore(){let e=0;for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[s][l]===o?(a++,a===5?e+=zz:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*D2),o=this.modules[s][l],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*D2}for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[l][s]===o?(a++,a===5?e+=zz:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*D2),o=this.modules[l][s],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*D2}for(let s=0;s<this.size-1;s++)for(let o=0;o<this.size-1;o++){const a=this.modules[s][o];a===this.modules[s][o+1]&&a===this.modules[s+1][o]&&a===this.modules[s+1][o+1]&&(e+=CNe)}let t=0;for(const s of this.modules)t=s.reduce((o,a)=>o+(a?1:0),t);const r=this.size*this.size,i=Math.ceil(Math.abs(t*20-r*10)/r)-1;return e+=i*MNe,e}getAlignmentPatternPositions(){if(this.version===1)return[];{const e=Math.floor(this.version/7)+2,t=this.version===32?26:Math.ceil((this.version*4+4)/(e*2-2))*2,r=[6];for(let i=this.size-7;r.length<e;i-=t)r.splice(1,0,i);return r}}finderPenaltyCountPatterns(e){const t=e[1],r=t>0&&e[2]===t&&e[3]===t*3&&e[4]===t&&e[5]===t;return(r&&e[0]>=t*4&&e[6]>=t?1:0)+(r&&e[6]>=t*4&&e[0]>=t?1:0)}finderPenaltyTerminateAndCount(e,t,r){return e&&(this.finderPenaltyAddHistory(t,r),t=0),t+=this.size,this.finderPenaltyAddHistory(t,r),this.finderPenaltyCountPatterns(r)}finderPenaltyAddHistory(e,t){t[0]===0&&(e+=this.size),t.pop(),t.unshift(e)}}function jg(n,e,t){if(e<0||e>31||n>>>e)throw new RangeError("Value out of range");for(let r=e-1;r>=0;r--)t.push(n>>>r&1)}function Mg(n,e){return(n>>>e&1)!==0}class tU{constructor(e,t,r){if(this.mode=e,this.numChars=t,this.bitData=r,t<0)throw new RangeError("Invalid argument");this.bitData=r.slice()}getData(){return this.bitData.slice()}}const ONe=[1,10,12,14],INe=[2,9,11,13],NNe=[4,8,16,16];function gQ(n,e){return n[Math.floor((e+7)/17)+1]}function _Q(n){const e=[];for(const t of n)jg(t,8,e);return new tU(NNe,n.length,e)}function PNe(n){if(!vQ(n))throw new RangeError("String contains non-numeric characters");const e=[];for(let t=0;t<n.length;){const r=Math.min(n.length-t,3);jg(Number.parseInt(n.substring(t,t+r),10),r*3+1,e),t+=r}return new tU(ONe,n.length,e)}function DNe(n){if(!yQ(n))throw new RangeError("String contains unencodable characters in alphanumeric mode");const e=[];let t;for(t=0;t+2<=n.length;t+=2){let r=ZN.indexOf(n.charAt(t))*45;r+=ZN.indexOf(n.charAt(t+1)),jg(r,11,e)}return t<n.length&&jg(ZN.indexOf(n.charAt(t)),6,e),new tU(INe,n.length,e)}function LNe(n){return n===""?[]:vQ(n)?[PNe(n)]:yQ(n)?[DNe(n)]:[_Q(BNe(n))]}function vQ(n){return ANe.test(n)}function yQ(n){return RNe.test(n)}function UNe(n,e){let t=0;for(const r of n){const i=gQ(r.mode,e);if(r.numChars>=1<<i)return Number.POSITIVE_INFINITY;t+=4+i+r.bitData.length}return t}function BNe(n){n=encodeURI(n);const e=[];for(let t=0;t<n.length;t++)n.charAt(t)!=="%"?e.push(n.charCodeAt(t)):(e.push(Number.parseInt(n.substring(t+1,t+3),16)),t+=2);return e}function QL(n){if(n<Q6||n>eU)throw new RangeError("Version number out of range");let e=(16*n+128)*n+64;if(n>=2){const t=Math.floor(n/7)+2;e-=(25*t-10)*t-55,n>=7&&(e-=36)}return e}function BC(n,e){return Math.floor(QL(n)/8)-pQ[e[0]][n]*mQ[e[0]][n]}function FNe(n){if(n<1||n>255)throw new RangeError("Degree out of range");const e=[];for(let r=0;r<n-1;r++)e.push(0);e.push(1);let t=1;for(let r=0;r<n;r++){for(let i=0;i<e.length;i++)e[i]=e4(e[i],t),i+1<e.length&&(e[i]^=e[i+1]);t=e4(t,2)}return e}function jNe(n,e){const t=e.map(r=>0);for(const r of n){const i=r^t.shift();t.push(0),e.forEach((s,o)=>t[o]^=e4(s,i))}return t}function e4(n,e){if(n>>>8||e>>>8)throw new RangeError("Byte out of range");let t=0;for(let r=7;r>=0;r--)t=t<<1^(t>>>7)*285,t^=(e>>>r&1)*n;return t}function zNe(n,e,t=1,r=40,i=-1,s=!0){if(!(Q6<=t&&t<=r&&r<=eU)||i<-1||i>7)throw new RangeError("Invalid value");let o,a;for(o=t;;o++){const h=BC(o,e)*8,f=UNe(n,o);if(f<=h){a=f;break}if(o>=r)throw new RangeError("Data too long")}for(const h of[hQ,fQ,dQ])s&&a<=BC(o,h)*8&&(e=h);const c=[];for(const h of n){jg(h.mode[0],4,c),jg(h.numChars,gQ(h.mode,o),c);for(const f of h.getData())c.push(f)}const l=BC(o,e)*8;jg(0,Math.min(4,l-c.length),c),jg(0,(8-c.length%8)%8,c);for(let h=236;c.length<l;h^=253)jg(h,8,c);const u=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((h,f)=>u[f>>>3]|=h<<7-(f&7)),new kNe(o,e,u,i)}function HNe(n,e){const{ecc:t="L",boostEcc:r=!1,minVersion:i=1,maxVersion:s=40,maskPattern:o=-1,border:a=1}=e||{},c=typeof n=="string"?LNe(n):Array.isArray(n)?[_Q(n)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof n}`);const l=zNe(c,wNe[t],i,s,o,r),u=VNe({version:l.version,maskPattern:l.mask,size:l.size,data:l.modules,types:l.types},a);return e?.invert&&(u.data=u.data.map(h=>h.map(f=>!f))),e?.onEncoded?.(u),u}function VNe(n,e=1){if(!e)return n;const{size:t}=n,r=t+e*2;n.size=r,n.data.forEach(s=>{for(let o=0;o<e;o++)s.unshift(!1),s.push(!1)});for(let s=0;s<e;s++)n.data.unshift(Array.from({length:r},o=>!1)),n.data.push(Array.from({length:r},o=>!1));const i=I1.Border;n.types.forEach(s=>{for(let o=0;o<e;o++)s.unshift(i),s.push(i)});for(let s=0;s<e;s++)n.types.unshift(Array.from({length:r},o=>i)),n.types.push(Array.from({length:r},o=>i));return n}function GNe(n,e,t,r=!1){return e<0||t<0||e>=n.length||t>=n.length?r:n[t][e]}function $Ne(n,e={}){const t={WHITE_ALL:"",WHITE_BLACK:"",BLACK_WHITE:"",BLACK_ALL:" "},r=HNe(n,e),i=!1,s=!0,o=(l,u)=>GNe(r.data,l,u,!0),a=[];let c="";for(let l=0;l<r.size;l+=2){for(let u=0;u<r.size;u++)o(u,l)===i&&o(u,l+1)===i?c+=t.WHITE_ALL:o(u,l)===i&&o(u,l+1)===s?c+=t.WHITE_BLACK:o(u,l)===s&&o(u,l+1)===i?c+=t.BLACK_WHITE:c+=t.BLACK_ALL;a.push(c),c=""}return a.join(`
`)}function WNe(n){const e=[],t=$Ne(n).split(`
`),r={32:32,9600:223,9604:220,9608:219};for(let i=0;i<t.length;i++){const s=[...t[i]].map(o=>`$${r[o.charCodeAt(0)]}`).join("");e.push(s)}return e}const _b="$dkpurple",qNe="$196",YNe="$205";function Nr(n,e,t){Qi(n,e,t)}function bQ(n,e,t){const r=qNe.repeat(t);Nr(n,e,`${_b}${r}`)}function nU(n,e,t){const r=YNe.repeat(t);Nr(n,e,`${_b}${r}`)}function Wv(n,e,t){bQ(n,e,t.length+2),Nr(n,e,`${_b} $white${t} `),nU(n,e,t.length+2)}function C1(n,e,t){Nr(n,e,`${_b} ${" ".repeat(t.length)} `),Nr(n,e,`${_b} $gray${t} `),nU(n,e,t.length+2)}function Rh(n,e,t,r){Nr(n,e,`${_b} $white${t} $blue${r}`)}function Js(n,e,t){Nr(n,e,`${_b}$blue${t}`)}function t4(n,e,t,r){Nr(n,e,`!${t};${r}`)}function KNe(n,e,t){const r=WNe(t);for(let i=0;i<r.length;i++)Nr(n,e,r[i])}function n4(n,e,t,r,i=!0){i&&(KNe(n,e,t),setTimeout(()=>t6(n,e),2e3)),Nr(n,e,`!copyit ${t};${r}`)}function XNe(n,e,t,r){Nr(n,e,`!openit ${t};${r}`)}const FC={},gE={};function ZNe(){return{id:Ko(),board:"",layers:[],scroll:[],sidebar:[],exiteast:"",exitwest:"",exitnorth:"",exitsouth:""}}const JNe=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit","bgedit"]),QNe=new Set(["tx","text"]),ePe={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},Hz={};let tPe=n=>{let e=Hz[n];return fe(e)||(Hz[n]=e=ZNe()),e};function JN(n){return tPe(n)}function rU(n){return fe(FC[n])||(FC[n]=[]),FC[n]}function nPe(n,e,t){Object.values(gE).forEach(r=>{if(r[e]!==void 0){const i=Qv(n.id(),e);Xt(t)&&Pu(i,t),rn(t)&&ORe(i,t)}})}function rPe(n){const e=rU(n);return FC[n]=[],e}function Vz(n){const e=[];let t;for(let r=0;r<n.length;++r){const i=n[r],s=rn(i)&&fe(hU(i));fe(t)&&t!==s&&e.push(" "),e.push(i),t=s}return e}function iPe(n,e){rU(n).push(e)}function sPe(n,e,t,r,i=()=>0,s=_5){switch(Jn(mo(r[0]))){case"copyit":case"openit":case"viewit":case"runit":r.unshift("istargetless");break}const a=[e,t,...r],c=Jn(`${a[3]}`),l={...de};function u(h,f){fe(f)&&f!==i(h)&&(de.board=l.board,de.element=l.element,de.elementfocus=l.elementfocus,s(h,f))}if(JNe.has(c)){const h=`${a[2]}`;gE[e]=gE[e]??{};const f=i(h)??ePe[c];if(gE[e][h]===void 0){const d=Qv(e,h);QNe.has(c)?(rn(f)&&cQ(d,f),gE[e][h]=NRe(d,p=>{u(h,p)})):(Xt(f)&&kRe(d,f),gE[e][h]=IRe(d,p=>{u(h,p)}))}}rU(n).push(a)}const Gz=Object.assign({"./editor/codepagename.txt":DRe,"./editor/command/admin.txt":URe,"./editor/command/array.txt":FRe,"./editor/command/autofilter.txt":zRe,"./editor/command/autofilter1.txt":VRe,"./editor/command/autofilter2.txt":$Re,"./editor/command/autofilter3.txt":qRe,"./editor/command/autowah.txt":KRe,"./editor/command/autowah1.txt":ZRe,"./editor/command/autowah2.txt":QRe,"./editor/command/autowah3.txt":t2e,"./editor/command/bbs.txt":r2e,"./editor/command/become.txt":s2e,"./editor/command/bgplay.txt":a2e,"./editor/command/bgplayon16n.txt":l2e,"./editor/command/bgplayon1n.txt":h2e,"./editor/command/bgplayon2n.txt":d2e,"./editor/command/bgplayon32n.txt":m2e,"./editor/command/bgplayon4n.txt":_2e,"./editor/command/bgplayon64n.txt":y2e,"./editor/command/bgplayon8n.txt":S2e,"./editor/command/bgvol.txt":x2e,"./editor/command/bind.txt":w2e,"./editor/command/board.txt":R2e,"./editor/command/boardopen.txt":M2e,"./editor/command/boards.txt":O2e,"./editor/command/bookallexport.txt":N2e,"./editor/command/bookexport.txt":D2e,"./editor/command/bookrename.txt":U2e,"./editor/command/books.txt":F2e,"./editor/command/booktrash.txt":z2e,"./editor/command/bpm.txt":V2e,"./editor/command/break.txt":$2e,"./editor/command/broadcast.txt":q2e,"./editor/command/build.txt":K2e,"./editor/command/change.txt":Z2e,"./editor/command/char.txt":Q2e,"./editor/command/charset.txt":tCe,"./editor/command/chat.txt":rCe,"./editor/command/clear.txt":sCe,"./editor/command/color.txt":aCe,"./editor/command/continue.txt":lCe,"./editor/command/copy.txt":hCe,"./editor/command/cycle.txt":dCe,"./editor/command/dev.txt":mCe,"./editor/command/die.txt":_Ce,"./editor/command/distort.txt":yCe,"./editor/command/distort1.txt":SCe,"./editor/command/distort2.txt":xCe,"./editor/command/distort3.txt":wCe,"./editor/command/do.txt":RCe,"./editor/command/done.txt":MCe,"./editor/command/dupe.txt":OCe,"./editor/command/dupewith.txt":NCe,"./editor/command/duplicate.txt":DCe,"./editor/command/duplicatewith.txt":UCe,"./editor/command/echo.txt":FCe,"./editor/command/echo1.txt":zCe,"./editor/command/echo2.txt":VCe,"./editor/command/echo3.txt":$Ce,"./editor/command/else.txt":qCe,"./editor/command/elseif.txt":KCe,"./editor/command/end.txt":ZCe,"./editor/command/endgame.txt":QCe,"./editor/command/endwith.txt":tMe,"./editor/command/export.txt":rMe,"./editor/command/fcrush.txt":sMe,"./editor/command/fcrush1.txt":aMe,"./editor/command/fcrush2.txt":lMe,"./editor/command/fcrush3.txt":hMe,"./editor/command/fetch.txt":dMe,"./editor/command/fetchwith.txt":mMe,"./editor/command/findany.txt":_Me,"./editor/command/foreach.txt":yMe,"./editor/command/fork.txt":SMe,"./editor/command/gadget.txt":xMe,"./editor/command/go.txt":wMe,"./editor/command/goto.txt":RMe,"./editor/command/help.txt":MMe,"./editor/command/hyperlink.txt":OMe,"./editor/command/idle.txt":NMe,"./editor/command/if.txt":DMe,"./editor/command/itchiopublish.txt":UMe,"./editor/command/joincode.txt":FMe,"./editor/command/jointab.txt":zMe,"./editor/command/load.txt":VMe,"./editor/command/lock.txt":$Me,"./editor/command/nuke.txt":qMe,"./editor/command/oneof.txt":KMe,"./editor/command/oneofwith.txt":ZMe,"./editor/command/pageexport.txt":QMe,"./editor/command/pageopen.txt":tke,"./editor/command/pages.txt":rke,"./editor/command/pagetrash.txt":ske,"./editor/command/palette.txt":ake,"./editor/command/pivot.txt":lke,"./editor/command/play.txt":hke,"./editor/command/push.txt":dke,"./editor/command/put.txt":mke,"./editor/command/putwith.txt":_ke,"./editor/command/read.txt":yke,"./editor/command/readbin.txt":Ske,"./editor/command/readjson.txt":xke,"./editor/command/readline.txt":wke,"./editor/command/readrexpaint.txt":Rke,"./editor/command/remix.txt":Mke,"./editor/command/repeat.txt":Oke,"./editor/command/restart.txt":Nke,"./editor/command/restore.txt":Dke,"./editor/command/reverb.txt":Uke,"./editor/command/reverb1.txt":Fke,"./editor/command/reverb2.txt":zke,"./editor/command/reverb3.txt":Vke,"./editor/command/revert.txt":$ke,"./editor/command/run.txt":qke,"./editor/command/runwith.txt":Kke,"./editor/command/save.txt":Zke,"./editor/command/send.txt":Qke,"./editor/command/set.txt":tOe,"./editor/command/share.txt":rOe,"./editor/command/shoot.txt":sOe,"./editor/command/shootwith.txt":aOe,"./editor/command/shortsend.txt":lOe,"./editor/command/shove.txt":hOe,"./editor/command/snapshot.txt":dOe,"./editor/command/stat.txt":mOe,"./editor/command/synth.txt":_Oe,"./editor/command/synth1.txt":yOe,"./editor/command/synth2.txt":SOe,"./editor/command/synth3.txt":xOe,"./editor/command/synth4.txt":wOe,"./editor/command/synth5.txt":ROe,"./editor/command/synthflush.txt":MOe,"./editor/command/synthrecord.txt":OOe,"./editor/command/text.txt":NOe,"./editor/command/throwstar.txt":DOe,"./editor/command/throwstarwith.txt":UOe,"./editor/command/ticker.txt":FOe,"./editor/command/toast.txt":zOe,"./editor/command/transport.txt":VOe,"./editor/command/trash.txt":$Oe,"./editor/command/tts.txt":qOe,"./editor/command/ttsengine.txt":KOe,"./editor/command/ttsqueue.txt":ZOe,"./editor/command/ttsvol.txt":QOe,"./editor/command/twitchbroadcast.txt":t3e,"./editor/command/twitchchat.txt":r3e,"./editor/command/unlock.txt":s3e,"./editor/command/userinput.txt":a3e,"./editor/command/vibrato.txt":l3e,"./editor/command/vibrato1.txt":h3e,"./editor/command/vibrato2.txt":d3e,"./editor/command/vibrato3.txt":m3e,"./editor/command/vol.txt":_3e,"./editor/command/waitfor.txt":y3e,"./editor/command/walk.txt":S3e,"./editor/command/weave.txt":x3e,"./editor/command/while.txt":w3e,"./editor/command/withboard.txt":R3e,"./editor/command/withobject.txt":M3e,"./editor/command/write.txt":O3e,"./editor/command/zap.txt":N3e,"./editor/command/zztrandom.txt":D3e,"./editor/command/zztsearch.txt":U3e,"./editor/comment.txt":F3e,"./editor/hyperlink.txt":z3e,"./editor/hyperlink/hotkey.txt":V3e,"./editor/hyperlink/number.txt":$3e,"./editor/hyperlink/range.txt":q3e,"./editor/hyperlink/select.txt":K3e,"./editor/hyperlink/text.txt":Z3e,"./editor/label.txt":Q3e,"./editor/shortgo.txt":tIe,"./editor/shorttry.txt":rIe,"./editor/stat/board.txt":sIe,"./editor/stat/charset.txt":aIe,"./editor/stat/const.txt":lIe,"./editor/stat/hotkey.txt":hIe,"./editor/stat/loader.txt":dIe,"./editor/stat/number.txt":mIe,"./editor/stat/object.txt":_Ie,"./editor/stat/palette.txt":yIe,"./editor/stat/range.txt":SIe,"./editor/stat/select.txt":xIe,"./editor/stat/terrain.txt":wIe,"./editor/stat/text.txt":RIe,"./editor/text.txt":MIe,"./help/nopages.txt":OIe,"./refscroll/algoscroll.txt":NIe,"./refscroll/autofilterscroll.txt":DIe,"./refscroll/autowahscroll.txt":UIe,"./refscroll/cliscroll.txt":FIe,"./refscroll/distortscroll.txt":zIe,"./refscroll/echoscroll.txt":VIe,"./refscroll/effectsscroll.txt":$Ie,"./refscroll/fcrushscroll.txt":qIe,"./refscroll/helpcontrols.txt":KIe,"./refscroll/helpdeveloper.txt":ZIe,"./refscroll/helpmenu.txt":QIe,"./refscroll/helpplayer.txt":tNe,"./refscroll/helptext.txt":rNe,"./refscroll/menu.txt":sNe,"./refscroll/notesscroll.txt":aNe,"./refscroll/oscscroll.txt":lNe,"./refscroll/pulsescroll.txt":hNe,"./refscroll/pwmscroll.txt":dNe,"./refscroll/reverbscroll.txt":mNe,"./refscroll/synthscroll.txt":_Ne,"./refscroll/vibratoscroll.txt":yNe,"./refscroll/voicescroll.txt":SNe}),SQ={};n0(Gz).forEach(n=>{const e=n.replace(".txt","").replace("./","").replaceAll("/",":");SQ[e]=Gz[n].default});function xQ(n){const e=Jn(n.trim().replaceAll(`
`,"").replace(/:+$/,"")),t=SQ[e];if(fe(t))return t;const{target:r,path:i}=Vv(e);switch(r){case"editor":{const s=Vv(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function TQ(n,e){const t=(n??"").split(`
`);for(let r=0;r<t.length;++r)e(t[r].split(";"))}function oPe(n,e){const[t,...r]=e,i=r[0]??"",s=r[1]??"";switch(Jn(t.trim())){case"header":Wv(Ke,n,i);break;case"section":C1(Ke,n,i);break;case"option":Rh(Ke,n,i,s);break;default:t.trimStart().startsWith("!")?t4(Ke,n,t.trimStart().slice(1),i):Nr(Ke,n,t);break}}function aPe(n){const e={};return TQ(n,t=>{const[r,...i]=t,s=i[0]??"";e[r]=s}),e}function L2(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var QN={exports:{}},$z;function cPe(){return $z||($z=1,(function(n,e){(function(t){n.exports=t()})(function(){return(function t(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var h=typeof L2=="function"&&L2;if(!u&&h)return h(l,!0);if(a)return a(l,!0);var f=new Error("Cannot find module '"+l+"'");throw f.code="MODULE_NOT_FOUND",f}var d=i[l]={exports:{}};r[l][0].call(d.exports,function(p){var _=r[l][1][p];return o(_||p)},d,d.exports,t,r,i,s)}return i[l].exports}for(var a=typeof L2=="function"&&L2,c=0;c<s.length;c++)o(s[c]);return o})({1:[function(t,r,i){var s=t("./utils"),o=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,h,f,d,p,_,g=[],m=0,b=c.length,y=b,x=s.getTypeOf(c)!=="string";m<c.length;)y=b-m,h=x?(l=c[m++],u=m<b?c[m++]:0,m<b?c[m++]:0):(l=c.charCodeAt(m++),u=m<b?c.charCodeAt(m++):0,m<b?c.charCodeAt(m++):0),f=l>>2,d=(3&l)<<4|u>>4,p=1<y?(15&u)<<2|h>>6:64,_=2<y?63&h:64,g.push(a.charAt(f)+a.charAt(d)+a.charAt(p)+a.charAt(_));return g.join("")},i.decode=function(c){var l,u,h,f,d,p,_=0,g=0,m="data:";if(c.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");var b,y=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&y--,c.charAt(c.length-2)===a.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=o.uint8array?new Uint8Array(0|y):new Array(0|y);_<c.length;)l=a.indexOf(c.charAt(_++))<<2|(f=a.indexOf(c.charAt(_++)))>>4,u=(15&f)<<4|(d=a.indexOf(c.charAt(_++)))>>2,h=(3&d)<<6|(p=a.indexOf(c.charAt(_++))),b[g++]=l,d!==64&&(b[g++]=u),p!==64&&(b[g++]=h);return b}},{"./support":30,"./utils":32}],2:[function(t,r,i){var s=t("./external"),o=t("./stream/DataWorker"),a=t("./stream/Crc32Probe"),c=t("./stream/DataLengthProbe");function l(u,h,f,d,p){this.compressedSize=u,this.uncompressedSize=h,this.crc32=f,this.compression=d,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return u.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,h,f){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(f)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,r,i){var s=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,r,i){var s=t("./utils"),o=(function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c})();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?(function(l,u,h,f){var d=o,p=f+h;l^=-1;for(var _=f;_<p;_++)l=l>>>8^d[255&(l^u[_])];return-1^l})(0|c,a,a.length,0):(function(l,u,h,f){var d=o,p=f+h;l^=-1;for(var _=f;_<p;_++)l=l>>>8^d[255&(l^u.charCodeAt(_))];return-1^l})(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(t,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,r,i){var s=null;s=typeof Promise<"u"?Promise:t("lie"),r.exports={Promise:s}},{lie:37}],7:[function(t,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=t("pako"),a=t("./utils"),c=t("./stream/GenericWorker"),l=s?"uint8array":"array";function u(h,f){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=f,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,h.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(f){h.push({data:f,meta:h.meta})}},i.compressWorker=function(h){return new u("Deflate",h)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,r,i){function s(d,p){var _,g="";for(_=0;_<p;_++)g+=String.fromCharCode(255&d),d>>>=8;return g}function o(d,p,_,g,m,b){var y,x,T=d.file,k=d.compression,R=b!==l.utf8encode,P=a.transformTo("string",b(T.name)),B=a.transformTo("string",l.utf8encode(T.name)),U=T.comment,z=a.transformTo("string",b(U)),I=a.transformTo("string",l.utf8encode(U)),L=B.length!==T.name.length,M=I.length!==U.length,F="",Z="",$="",Y=T.dir,Q=T.date,q={crc32:0,compressedSize:0,uncompressedSize:0};p&&!_||(q.crc32=d.crc32,q.compressedSize=d.compressedSize,q.uncompressedSize=d.uncompressedSize);var V=0;p&&(V|=8),R||!L&&!M||(V|=2048);var K=0,ne=0;Y&&(K|=16),m==="UNIX"?(ne=798,K|=(function(ae,Te){var Ie=ae;return ae||(Ie=Te?16893:33204),(65535&Ie)<<16})(T.unixPermissions,Y)):(ne=20,K|=(function(ae){return 63&(ae||0)})(T.dosPermissions)),y=Q.getUTCHours(),y<<=6,y|=Q.getUTCMinutes(),y<<=5,y|=Q.getUTCSeconds()/2,x=Q.getUTCFullYear()-1980,x<<=4,x|=Q.getUTCMonth()+1,x<<=5,x|=Q.getUTCDate(),L&&(Z=s(1,1)+s(u(P),4)+B,F+="up"+s(Z.length,2)+Z),M&&($=s(1,1)+s(u(z),4)+I,F+="uc"+s($.length,2)+$);var ie="";return ie+=`
\0`,ie+=s(V,2),ie+=k.magic,ie+=s(y,2),ie+=s(x,2),ie+=s(q.crc32,4),ie+=s(q.compressedSize,4),ie+=s(q.uncompressedSize,4),ie+=s(P.length,2),ie+=s(F.length,2),{fileRecord:h.LOCAL_FILE_HEADER+ie+P+F,dirRecord:h.CENTRAL_FILE_HEADER+s(ne,2)+ie+s(z.length,2)+"\0\0\0\0"+s(K,4)+s(g,4)+P+F+z}}var a=t("../utils"),c=t("../stream/GenericWorker"),l=t("../utf8"),u=t("../crc32"),h=t("../signature");function f(d,p,_,g){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=_,this.encodeFileName=g,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,c),f.prototype.push=function(d){var p=d.meta.percent||0,_=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,c.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:_?(p+100*(_-g-1))/_:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var p=this.streamFiles&&!d.file.dir;if(p){var _=o(d,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:_.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var p=this.streamFiles&&!d.file.dir,_=o(d,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(_.dirRecord),p)this.push({data:(function(g){return h.DATA_DESCRIPTOR+s(g.crc32,4)+s(g.compressedSize,4)+s(g.uncompressedSize,4)})(d),meta:{percent:100}});else for(this.push({data:_.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var _=this.bytesWritten-d,g=(function(m,b,y,x,T){var k=a.transformTo("string",T(x));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(m,2)+s(m,2)+s(b,4)+s(y,4)+s(k.length,2)+k})(this.dirRecords.length,_,d,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var p=this;return d.on("data",function(_){p.processChunk(_)}),d.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),d.on("error",function(_){p.error(_)}),this},f.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var p=this._sources;if(!c.prototype.error.call(this,d))return!1;for(var _=0;_<p.length;_++)try{p[_].error(d)}catch{}return!0},f.prototype.lock=function(){c.prototype.lock.call(this);for(var d=this._sources,p=0;p<d.length;p++)d[p].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,r,i){var s=t("../compressions"),o=t("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),h=0;try{a.forEach(function(f,d){h++;var p=(function(b,y){var x=b||y,T=s[x];if(!T)throw new Error(x+" is not a valid compression method !");return T})(d.options.compression,c.compression),_=d.options.compressionOptions||c.compressionOptions||{},g=d.dir,m=d.date;d._compressWorker(p,_).withStreamInfo("file",{name:f,dir:g,date:m,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(u)}),u.entriesCount=h}catch(f){u.error(f)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=t("./object")).loadAsync=t("./load"),s.support=t("./support"),s.defaults=t("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=t("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,r,i){var s=t("./utils"),o=t("./external"),a=t("./utf8"),c=t("./zipEntries"),l=t("./stream/Crc32Probe"),u=t("./nodejsUtils");function h(f){return new o.Promise(function(d,p){var _=f.decompressed.getContentWorker().pipe(new l);_.on("error",function(g){p(g)}).on("end",function(){_.streamInfo.crc32!==f.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}r.exports=function(f,d){var p=this;return d=s.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(_){var g=new c(d);return g.load(_),g}).then(function(_){var g=[o.Promise.resolve(_)],m=_.files;if(d.checkCRC32)for(var b=0;b<m.length;b++)g.push(h(m[b]));return o.Promise.all(g)}).then(function(_){for(var g=_.shift(),m=g.files,b=0;b<m.length;b++){var y=m[b],x=y.fileNameStr,T=s.resolve(y.fileNameStr);p.file(T,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:d.createFolders}),y.dir||(p.file(T).unsafeOriginalName=x)}return g.zipComment.length&&(p.comment=g.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,r,i){var s=t("../utils"),o=t("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,r,i){var s=t("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(h,f){u.push(h)||u._helper.pause(),l&&l(f)}).on("error",function(h){u.emit("error",h)}).on("end",function(){u.push(null)})}t("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,r,i){r.exports={isNode:typeof Qs<"u",newBufferFrom:function(s,o){if(Qs.from&&Qs.from!==Uint8Array.from)return Qs.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Qs(s,o)},allocBuffer:function(s){if(Qs.alloc)return Qs.alloc(s);var o=new Qs(s);return o.fill(0),o},isBuffer:function(s){return Qs.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(t,r,i){function s(T,k,R){var P,B=a.getTypeOf(k),U=a.extend(R||{},u);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(T=m(T)),U.createFolders&&(P=g(T))&&b.call(this,P,!0);var z=B==="string"&&U.binary===!1&&U.base64===!1;R&&R.binary!==void 0||(U.binary=!z),(k instanceof h&&k.uncompressedSize===0||U.dir||!k||k.length===0)&&(U.base64=!1,U.binary=!0,k="",U.compression="STORE",B="string");var I=null;I=k instanceof h||k instanceof c?k:p.isNode&&p.isStream(k)?new _(T,k):a.prepareContent(T,k,U.binary,U.optimizedBinaryString,U.base64);var L=new f(T,I,U);this.files[T]=L}var o=t("./utf8"),a=t("./utils"),c=t("./stream/GenericWorker"),l=t("./stream/StreamHelper"),u=t("./defaults"),h=t("./compressedObject"),f=t("./zipObject"),d=t("./generate"),p=t("./nodejsUtils"),_=t("./nodejs/NodejsStreamInputAdapter"),g=function(T){T.slice(-1)==="/"&&(T=T.substring(0,T.length-1));var k=T.lastIndexOf("/");return 0<k?T.substring(0,k):""},m=function(T){return T.slice(-1)!=="/"&&(T+="/"),T},b=function(T,k){return k=k!==void 0?k:u.createFolders,T=m(T),this.files[T]||s.call(this,T,null,{dir:!0,createFolders:k}),this.files[T]};function y(T){return Object.prototype.toString.call(T)==="[object RegExp]"}var x={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(T){var k,R,P;for(k in this.files)P=this.files[k],(R=k.slice(this.root.length,k.length))&&k.slice(0,this.root.length)===this.root&&T(R,P)},filter:function(T){var k=[];return this.forEach(function(R,P){T(R,P)&&k.push(P)}),k},file:function(T,k,R){if(arguments.length!==1)return T=this.root+T,s.call(this,T,k,R),this;if(y(T)){var P=T;return this.filter(function(U,z){return!z.dir&&P.test(U)})}var B=this.files[this.root+T];return B&&!B.dir?B:null},folder:function(T){if(!T)return this;if(y(T))return this.filter(function(B,U){return U.dir&&T.test(B)});var k=this.root+T,R=b.call(this,k),P=this.clone();return P.root=R.name,P},remove:function(T){T=this.root+T;var k=this.files[T];if(k||(T.slice(-1)!=="/"&&(T+="/"),k=this.files[T]),k&&!k.dir)delete this.files[T];else for(var R=this.filter(function(B,U){return U.name.slice(0,T.length)===T}),P=0;P<R.length;P++)delete this.files[R[P].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(T){var k,R={};try{if((R=a.extend(T||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");a.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var P=R.comment||this.comment||"";k=d.generateWorker(this,R,P)}catch(B){(k=new c("error")).error(B)}return new l(k,R.type||"string",R.mimeType)},generateAsync:function(T,k){return this.generateInternalStream(T).accumulate(k)},generateNodeStream:function(T,k){return(T=T||{}).type||(T.type="nodebuffer"),this.generateInternalStream(T).toNodejsStream(k)}};r.exports=x},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,r,i){r.exports=t("stream")},{stream:void 0}],17:[function(t,r,i){var s=t("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}t("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===l&&this.data[f+2]===u&&this.data[f+3]===h)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),f=this.readData(4);return c===f[0]&&l===f[1]&&u===f[2]&&h===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,r,i){var s=t("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(t,r,i){var s=t("./Uint8ArrayReader");function o(a){s.call(this,a)}t("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,r,i){var s=t("./DataReader");function o(a){s.call(this,a)}t("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,r,i){var s=t("./ArrayReader");function o(a){s.call(this,a)}t("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,r,i){var s=t("../utils"),o=t("../support"),a=t("./ArrayReader"),c=t("./StringReader"),l=t("./NodeBufferReader"),u=t("./Uint8ArrayReader");r.exports=function(h){var f=s.getTypeOf(h);return s.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new l(h):o.uint8array?new u(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,r,i){var s=t("./GenericWorker"),o=t("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,r,i){var s=t("./GenericWorker"),o=t("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,r,i){var s=t("../utils"),o=t("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,r,i){var s=t("../utils"),o=t("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(t,r,i){var s=t("../utils"),o=t("./ConvertWorker"),a=t("./GenericWorker"),c=t("../base64"),l=t("../support"),u=t("../external"),h=null;if(l.nodestream)try{h=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(p,_){return new u.Promise(function(g,m){var b=[],y=p._internalType,x=p._outputType,T=p._mimeType;p.on("data",function(k,R){b.push(k),_&&_(R)}).on("error",function(k){b=[],m(k)}).on("end",function(){try{var k=(function(R,P,B){switch(R){case"blob":return s.newBlob(s.transformTo("arraybuffer",P),B);case"base64":return c.encode(P);default:return s.transformTo(R,P)}})(x,(function(R,P){var B,U=0,z=null,I=0;for(B=0;B<P.length;B++)I+=P[B].length;switch(R){case"string":return P.join("");case"array":return Array.prototype.concat.apply([],P);case"uint8array":for(z=new Uint8Array(I),B=0;B<P.length;B++)z.set(P[B],U),U+=P[B].length;return z;case"nodebuffer":return Qs.concat(P);default:throw new Error("concat : unsupported type '"+R+"'")}})(y,b),T);g(k)}catch(R){m(R)}b=[]}).resume()})}function d(p,_,g){var m=_;switch(_){case"blob":case"arraybuffer":m="uint8array";break;case"base64":m="string"}try{this._internalType=m,this._outputType=_,this._mimeType=g,s.checkSupport(m),this._worker=p.pipe(new o(m)),p.lock()}catch(b){this._worker=new a("error"),this._worker.error(b)}}d.prototype={accumulate:function(p){return f(this,p)},on:function(p,_){var g=this;return p==="data"?this._worker.on(p,function(m){_.call(g,m.data,m.meta)}):this._worker.on(p,function(){s.delay(_,arguments,g)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Qs<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(t,r,i){for(var s=t("./utils"),o=t("./support"),a=t("./nodejsUtils"),c=t("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function f(){c.call(this,"utf-8 encode")}i.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):(function(p){var _,g,m,b,y,x=p.length,T=0;for(b=0;b<x;b++)(64512&(g=p.charCodeAt(b)))==55296&&b+1<x&&(64512&(m=p.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(m-56320),b++),T+=g<128?1:g<2048?2:g<65536?3:4;for(_=o.uint8array?new Uint8Array(T):new Array(T),b=y=0;y<T;b++)(64512&(g=p.charCodeAt(b)))==55296&&b+1<x&&(64512&(m=p.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(m-56320),b++),g<128?_[y++]=g:(g<2048?_[y++]=192|g>>>6:(g<65536?_[y++]=224|g>>>12:(_[y++]=240|g>>>18,_[y++]=128|g>>>12&63),_[y++]=128|g>>>6&63),_[y++]=128|63&g);return _})(d)},i.utf8decode=function(d){return o.nodebuffer?s.transformTo("nodebuffer",d).toString("utf-8"):(function(p){var _,g,m,b,y=p.length,x=new Array(2*y);for(_=g=0;_<y;)if((m=p[_++])<128)x[g++]=m;else if(4<(b=l[m]))x[g++]=65533,_+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&_<y;)m=m<<6|63&p[_++],b--;1<b?x[g++]=65533:m<65536?x[g++]=m:(m-=65536,x[g++]=55296|m>>10&1023,x[g++]=56320|1023&m)}return x.length!==g&&(x.subarray?x=x.subarray(0,g):x.length=g),s.applyFromCharCode(x)})(d=s.transformTo(o.uint8array?"uint8array":"array",d))},s.inherits(h,c),h.prototype.processChunk=function(d){var p=s.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var _=p;(p=new Uint8Array(_.length+this.leftOver.length)).set(this.leftOver,0),p.set(_,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var g=(function(b,y){var x;for((y=y||b.length)>b.length&&(y=b.length),x=y-1;0<=x&&(192&b[x])==128;)x--;return x<0||x===0?y:x+l[b[x]]>y?x:y})(p),m=p;g!==p.length&&(o.uint8array?(m=p.subarray(0,g),this.leftOver=p.subarray(g,p.length)):(m=p.slice(0,g),this.leftOver=p.slice(g,p.length))),this.push({data:i.utf8decode(m),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(f,c),f.prototype.processChunk=function(d){this.push({data:i.utf8encode(d.data),meta:d.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,r,i){var s=t("./support"),o=t("./base64"),a=t("./nodejsUtils"),c=t("./external");function l(_){return _}function u(_,g){for(var m=0;m<_.length;++m)g[m]=255&_.charCodeAt(m);return g}t("setimmediate"),i.newBlob=function(_,g){i.checkSupport("blob");try{return new Blob([_],{type:g})}catch{try{var m=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return m.append(_),m.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(_,g,m){var b=[],y=0,x=_.length;if(x<=m)return String.fromCharCode.apply(null,_);for(;y<x;)g==="array"||g==="nodebuffer"?b.push(String.fromCharCode.apply(null,_.slice(y,Math.min(y+m,x)))):b.push(String.fromCharCode.apply(null,_.subarray(y,Math.min(y+m,x)))),y+=m;return b.join("")},stringifyByChar:function(_){for(var g="",m=0;m<_.length;m++)g+=String.fromCharCode(_[m]);return g},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function f(_){var g=65536,m=i.getTypeOf(_),b=!0;if(m==="uint8array"?b=h.applyCanBeUsed.uint8array:m==="nodebuffer"&&(b=h.applyCanBeUsed.nodebuffer),b)for(;1<g;)try{return h.stringifyByChunk(_,m,g)}catch{g=Math.floor(g/2)}return h.stringifyByChar(_)}function d(_,g){for(var m=0;m<_.length;m++)g[m]=_[m];return g}i.applyFromCharCode=f;var p={};p.string={string:l,array:function(_){return u(_,new Array(_.length))},arraybuffer:function(_){return p.string.uint8array(_).buffer},uint8array:function(_){return u(_,new Uint8Array(_.length))},nodebuffer:function(_){return u(_,a.allocBuffer(_.length))}},p.array={string:f,array:l,arraybuffer:function(_){return new Uint8Array(_).buffer},uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return a.newBufferFrom(_)}},p.arraybuffer={string:function(_){return f(new Uint8Array(_))},array:function(_){return d(new Uint8Array(_),new Array(_.byteLength))},arraybuffer:l,uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return a.newBufferFrom(new Uint8Array(_))}},p.uint8array={string:f,array:function(_){return d(_,new Array(_.length))},arraybuffer:function(_){return _.buffer},uint8array:l,nodebuffer:function(_){return a.newBufferFrom(_)}},p.nodebuffer={string:f,array:function(_){return d(_,new Array(_.length))},arraybuffer:function(_){return p.nodebuffer.uint8array(_).buffer},uint8array:function(_){return d(_,new Uint8Array(_.length))},nodebuffer:l},i.transformTo=function(_,g){if(g=g||"",!_)return g;i.checkSupport(_);var m=i.getTypeOf(g);return p[m][_](g)},i.resolve=function(_){for(var g=_.split("/"),m=[],b=0;b<g.length;b++){var y=g[b];y==="."||y===""&&b!==0&&b!==g.length-1||(y===".."?m.pop():m.push(y))}return m.join("/")},i.getTypeOf=function(_){return typeof _=="string"?"string":Object.prototype.toString.call(_)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(_)?"nodebuffer":s.uint8array&&_ instanceof Uint8Array?"uint8array":s.arraybuffer&&_ instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(_){if(!s[_.toLowerCase()])throw new Error(_+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(_){var g,m,b="";for(m=0;m<(_||"").length;m++)b+="\\x"+((g=_.charCodeAt(m))<16?"0":"")+g.toString(16).toUpperCase();return b},i.delay=function(_,g,m){setImmediate(function(){_.apply(m||null,g||[])})},i.inherits=function(_,g){function m(){}m.prototype=g.prototype,_.prototype=new m},i.extend=function(){var _,g,m={};for(_=0;_<arguments.length;_++)for(g in arguments[_])Object.prototype.hasOwnProperty.call(arguments[_],g)&&m[g]===void 0&&(m[g]=arguments[_][g]);return m},i.prepareContent=function(_,g,m,b,y){return c.Promise.resolve(g).then(function(x){return s.blob&&(x instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(x))!==-1)&&typeof FileReader<"u"?new c.Promise(function(T,k){var R=new FileReader;R.onload=function(P){T(P.target.result)},R.onerror=function(P){k(P.target.error)},R.readAsArrayBuffer(x)}):x}).then(function(x){var T=i.getTypeOf(x);return T?(T==="arraybuffer"?x=i.transformTo("uint8array",x):T==="string"&&(y?x=o.decode(x):m&&b!==!0&&(x=(function(k){return u(k,s.uint8array?new Uint8Array(k.length):new Array(k.length))})(x))),x):c.Promise.reject(new Error("Can't read the data of '"+_+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,r,i){var s=t("./reader/readerFor"),o=t("./utils"),a=t("./signature"),c=t("./zipEntry"),l=t("./support");function u(h){this.files=[],this.loadOptions=h}u.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(h)+")")}},isSignature:function(h,f){var d=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===f;return this.reader.setIndex(d),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),f=l.uint8array?"uint8array":"array",d=o.transformTo(f,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,f,d,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[h]={id:h,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,f;for(h=0;h<this.files.length;h++)f=this.files[h],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var f=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var p=f-d;if(0<p)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,r,i){var s=t("./reader/readerFor"),o=t("./utils"),a=t("./compressedObject"),c=t("./crc32"),l=t("./utf8"),u=t("./compressions"),h=t("./support");function f(d,p){this.options=d,this.loadOptions=p}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var p,_;if(d.skip(22),this.fileNameLength=d.readInt(2),_=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(_),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=(function(g){for(var m in u)if(Object.prototype.hasOwnProperty.call(u,m)&&u[m].magic===g)return u[m];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var p=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(p),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var p,_,g,m=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<m;)p=d.readInt(2),_=d.readInt(2),g=d.readData(_),this.extraFields[p]={id:p,length:_,value:g};d.setIndex(m)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var _=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(_)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var m=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(m)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(d.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,r,i){function s(p,_,g){this.name=p,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=_,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var o=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),c=t("./utf8"),l=t("./compressedObject"),u=t("./stream/GenericWorker");s.prototype={internalStream:function(p){var _=null,g="string";try{if(!p)throw new Error("No output type specified.");var m=(g=p.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),_=this._decompressWorker();var b=!this._dataBinary;b&&!m&&(_=_.pipe(new c.Utf8EncodeWorker)),!b&&m&&(_=_.pipe(new c.Utf8DecodeWorker))}catch(y){(_=new u("error")).error(y)}return new o(_,g,"")},async:function(p,_){return this.internalStream(p).accumulate(_)},nodeStream:function(p,_){return this.internalStream(p||"nodebuffer").toNodejsStream(_)},_compressWorker:function(p,_){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(g,p,_)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)s.prototype[h[d]]=f;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),h=s.document.createTextNode("");u.observe(h,{characterData:!0}),o=function(){h.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var _=s.document.createElement("script");_.onreadystatechange=function(){p(),_.onreadystatechange=null,_.parentNode.removeChild(_),_=null},s.document.documentElement.appendChild(_)}:function(){setTimeout(p,0)};else{var f=new s.MessageChannel;f.port1.onmessage=p,o=function(){f.port2.postMessage(0)}}var d=[];function p(){var _,g;a=!0;for(var m=d.length;m;){for(g=d,d=[],_=-1;++_<m;)g[_]();m=d.length}a=!1}r.exports=function(_){d.push(_)!==1||a||o()}}).call(this,typeof yd<"u"?yd:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,r,i){var s=t("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function h(m){if(typeof m!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,m!==o&&_(this,m)}function f(m,b,y){this.promise=m,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function d(m,b,y){s(function(){var x;try{x=b(y)}catch(T){return a.reject(m,T)}x===m?a.reject(m,new TypeError("Cannot resolve promise with itself")):a.resolve(m,x)})}function p(m){var b=m&&m.then;if(m&&(typeof m=="object"||typeof m=="function")&&typeof b=="function")return function(){b.apply(m,arguments)}}function _(m,b){var y=!1;function x(R){y||(y=!0,a.reject(m,R))}function T(R){y||(y=!0,a.resolve(m,R))}var k=g(function(){b(T,x)});k.status==="error"&&x(k.value)}function g(m,b){var y={};try{y.value=m(b),y.status="success"}catch(x){y.status="error",y.value=x}return y}(r.exports=h).prototype.finally=function(m){if(typeof m!="function")return this;var b=this.constructor;return this.then(function(y){return b.resolve(m()).then(function(){return y})},function(y){return b.resolve(m()).then(function(){throw y})})},h.prototype.catch=function(m){return this.then(null,m)},h.prototype.then=function(m,b){if(typeof m!="function"&&this.state===l||typeof b!="function"&&this.state===c)return this;var y=new this.constructor(o);return this.state!==u?d(y,this.state===l?m:b,this.outcome):this.queue.push(new f(y,m,b)),y},f.prototype.callFulfilled=function(m){a.resolve(this.promise,m)},f.prototype.otherCallFulfilled=function(m){d(this.promise,this.onFulfilled,m)},f.prototype.callRejected=function(m){a.reject(this.promise,m)},f.prototype.otherCallRejected=function(m){d(this.promise,this.onRejected,m)},a.resolve=function(m,b){var y=g(p,b);if(y.status==="error")return a.reject(m,y.value);var x=y.value;if(x)_(m,x);else{m.state=l,m.outcome=b;for(var T=-1,k=m.queue.length;++T<k;)m.queue[T].callFulfilled(b)}return m},a.reject=function(m,b){m.state=c,m.outcome=b;for(var y=-1,x=m.queue.length;++y<x;)m.queue[y].callRejected(b);return m},h.resolve=function(m){return m instanceof this?m:a.resolve(new this(o),m)},h.reject=function(m){var b=new this(o);return a.reject(b,m)},h.all=function(m){var b=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=m.length,x=!1;if(!y)return this.resolve([]);for(var T=new Array(y),k=0,R=-1,P=new this(o);++R<y;)B(m[R],R);return P;function B(U,z){b.resolve(U).then(function(I){T[z]=I,++k!==y||x||(x=!0,a.resolve(P,T))},function(I){x||(x=!0,a.reject(P,I))})}},h.race=function(m){var b=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=m.length,x=!1;if(!y)return this.resolve([]);for(var T=-1,k=new this(o);++T<y;)R=m[T],b.resolve(R).then(function(P){x||(x=!0,a.resolve(k,P))},function(P){x||(x=!0,a.reject(k,P))});var R;return k}},{immediate:36}],38:[function(t,r,i){var s={};(0,t("./lib/utils/common").assign)(s,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,r,i){var s=t("./zlib/deflate"),o=t("./utils/common"),a=t("./utils/strings"),c=t("./zlib/messages"),l=t("./zlib/zstream"),u=Object.prototype.toString,h=0,f=-1,d=0,p=8;function _(m){if(!(this instanceof _))return new _(m);this.options=o.assign({level:f,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},m||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var y=s.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(y!==h)throw new Error(c[y]);if(b.header&&s.deflateSetHeader(this.strm,b.header),b.dictionary){var x;if(x=typeof b.dictionary=="string"?a.string2buf(b.dictionary):u.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(y=s.deflateSetDictionary(this.strm,x))!==h)throw new Error(c[y]);this._dict_set=!0}}function g(m,b){var y=new _(b);if(y.push(m,!0),y.err)throw y.msg||c[y.err];return y.result}_.prototype.push=function(m,b){var y,x,T=this.strm,k=this.options.chunkSize;if(this.ended)return!1;x=b===~~b?b:b===!0?4:0,typeof m=="string"?T.input=a.string2buf(m):u.call(m)==="[object ArrayBuffer]"?T.input=new Uint8Array(m):T.input=m,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new o.Buf8(k),T.next_out=0,T.avail_out=k),(y=s.deflate(T,x))!==1&&y!==h)return this.onEnd(y),!(this.ended=!0);T.avail_out!==0&&(T.avail_in!==0||x!==4&&x!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(T.output,T.next_out))):this.onData(o.shrinkBuf(T.output,T.next_out)))}while((0<T.avail_in||T.avail_out===0)&&y!==1);return x===4?(y=s.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===h):x!==2||(this.onEnd(h),!(T.avail_out=0))},_.prototype.onData=function(m){this.chunks.push(m)},_.prototype.onEnd=function(m){m===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Deflate=_,i.deflate=g,i.deflateRaw=function(m,b){return(b=b||{}).raw=!0,g(m,b)},i.gzip=function(m,b){return(b=b||{}).gzip=!0,g(m,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,r,i){var s=t("./zlib/inflate"),o=t("./utils/common"),a=t("./utils/strings"),c=t("./zlib/constants"),l=t("./zlib/messages"),u=t("./zlib/zstream"),h=t("./zlib/gzheader"),f=Object.prototype.toString;function d(_){if(!(this instanceof d))return new d(_);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},_||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||_&&_.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&(15&g.windowBits)==0&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var m=s.inflateInit2(this.strm,g.windowBits);if(m!==c.Z_OK)throw new Error(l[m]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(_,g){var m=new d(g);if(m.push(_,!0),m.err)throw m.msg||l[m.err];return m.result}d.prototype.push=function(_,g){var m,b,y,x,T,k,R=this.strm,P=this.options.chunkSize,B=this.options.dictionary,U=!1;if(this.ended)return!1;b=g===~~g?g:g===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof _=="string"?R.input=a.binstring2buf(_):f.call(_)==="[object ArrayBuffer]"?R.input=new Uint8Array(_):R.input=_,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new o.Buf8(P),R.next_out=0,R.avail_out=P),(m=s.inflate(R,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&B&&(k=typeof B=="string"?a.string2buf(B):f.call(B)==="[object ArrayBuffer]"?new Uint8Array(B):B,m=s.inflateSetDictionary(this.strm,k)),m===c.Z_BUF_ERROR&&U===!0&&(m=c.Z_OK,U=!1),m!==c.Z_STREAM_END&&m!==c.Z_OK)return this.onEnd(m),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&m!==c.Z_STREAM_END&&(R.avail_in!==0||b!==c.Z_FINISH&&b!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=a.utf8border(R.output,R.next_out),x=R.next_out-y,T=a.buf2string(R.output,y),R.next_out=x,R.avail_out=P-x,x&&o.arraySet(R.output,R.output,y,x,0),this.onData(T)):this.onData(o.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(U=!0)}while((0<R.avail_in||R.avail_out===0)&&m!==c.Z_STREAM_END);return m===c.Z_STREAM_END&&(b=c.Z_FINISH),b===c.Z_FINISH?(m=s.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===c.Z_OK):b!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(R.avail_out=0))},d.prototype.onData=function(_){this.chunks.push(_)},d.prototype.onEnd=function(_){_===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},i.Inflate=d,i.inflate=p,i.inflateRaw=function(_,g){return(g=g||{}).raw=!0,p(_,g)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var h in u)u.hasOwnProperty(h)&&(c[h]=u[h])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,h,f){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+h),f);else for(var d=0;d<h;d++)c[f+d]=l[u+d]},flattenChunks:function(c){var l,u,h,f,d,p;for(l=h=0,u=c.length;l<u;l++)h+=c[l].length;for(p=new Uint8Array(h),l=f=0,u=c.length;l<u;l++)d=c[l],p.set(d,f),f+=d.length;return p}},a={arraySet:function(c,l,u,h,f){for(var d=0;d<h;d++)c[f+d]=l[u+d]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(t,r,i){var s=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(h,f){if(f<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,f));for(var d="",p=0;p<f;p++)d+=String.fromCharCode(h[p]);return d}c[254]=c[254]=1,i.string2buf=function(h){var f,d,p,_,g,m=h.length,b=0;for(_=0;_<m;_++)(64512&(d=h.charCodeAt(_)))==55296&&_+1<m&&(64512&(p=h.charCodeAt(_+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),_++),b+=d<128?1:d<2048?2:d<65536?3:4;for(f=new s.Buf8(b),_=g=0;g<b;_++)(64512&(d=h.charCodeAt(_)))==55296&&_+1<m&&(64512&(p=h.charCodeAt(_+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),_++),d<128?f[g++]=d:(d<2048?f[g++]=192|d>>>6:(d<65536?f[g++]=224|d>>>12:(f[g++]=240|d>>>18,f[g++]=128|d>>>12&63),f[g++]=128|d>>>6&63),f[g++]=128|63&d);return f},i.buf2binstring=function(h){return u(h,h.length)},i.binstring2buf=function(h){for(var f=new s.Buf8(h.length),d=0,p=f.length;d<p;d++)f[d]=h.charCodeAt(d);return f},i.buf2string=function(h,f){var d,p,_,g,m=f||h.length,b=new Array(2*m);for(d=p=0;d<m;)if((_=h[d++])<128)b[p++]=_;else if(4<(g=c[_]))b[p++]=65533,d+=g-1;else{for(_&=g===2?31:g===3?15:7;1<g&&d<m;)_=_<<6|63&h[d++],g--;1<g?b[p++]=65533:_<65536?b[p++]=_:(_-=65536,b[p++]=55296|_>>10&1023,b[p++]=56320|1023&_)}return u(b,p)},i.utf8border=function(h,f){var d;for((f=f||h.length)>h.length&&(f=h.length),d=f-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?f:d+c[h[d]]>f?d:f}},{"./common":41}],43:[function(t,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--h;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(t,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,r,i){var s=(function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a})();r.exports=function(o,a,c,l){var u=s,h=l+c;o^=-1;for(var f=l;f<h;f++)o=o>>>8^u[255&(o^a[f])];return-1^o}},{}],46:[function(t,r,i){var s,o=t("../utils/common"),a=t("./trees"),c=t("./adler32"),l=t("./crc32"),u=t("./messages"),h=0,f=4,d=0,p=-2,_=-1,g=4,m=2,b=8,y=9,x=286,T=30,k=19,R=2*x+1,P=15,B=3,U=258,z=U+B+1,I=42,L=113,M=1,F=2,Z=3,$=4;function Y(te,Ne){return te.msg=u[Ne],Ne}function Q(te){return(te<<1)-(4<te?9:0)}function q(te){for(var Ne=te.length;0<=--Ne;)te[Ne]=0}function V(te){var Ne=te.state,Be=Ne.pending;Be>te.avail_out&&(Be=te.avail_out),Be!==0&&(o.arraySet(te.output,Ne.pending_buf,Ne.pending_out,Be,te.next_out),te.next_out+=Be,Ne.pending_out+=Be,te.total_out+=Be,te.avail_out-=Be,Ne.pending-=Be,Ne.pending===0&&(Ne.pending_out=0))}function K(te,Ne){a._tr_flush_block(te,0<=te.block_start?te.block_start:-1,te.strstart-te.block_start,Ne),te.block_start=te.strstart,V(te.strm)}function ne(te,Ne){te.pending_buf[te.pending++]=Ne}function ie(te,Ne){te.pending_buf[te.pending++]=Ne>>>8&255,te.pending_buf[te.pending++]=255&Ne}function ae(te,Ne){var Be,De,Oe=te.max_chain_length,ue=te.strstart,_e=te.prev_length,we=te.nice_match,pe=te.strstart>te.w_size-z?te.strstart-(te.w_size-z):0,ze=te.window,Ze=te.w_mask,Je=te.prev,nt=te.strstart+U,Pt=ze[ue+_e-1],vt=ze[ue+_e];te.prev_length>=te.good_match&&(Oe>>=2),we>te.lookahead&&(we=te.lookahead);do if(ze[(Be=Ne)+_e]===vt&&ze[Be+_e-1]===Pt&&ze[Be]===ze[ue]&&ze[++Be]===ze[ue+1]){ue+=2,Be++;do;while(ze[++ue]===ze[++Be]&&ze[++ue]===ze[++Be]&&ze[++ue]===ze[++Be]&&ze[++ue]===ze[++Be]&&ze[++ue]===ze[++Be]&&ze[++ue]===ze[++Be]&&ze[++ue]===ze[++Be]&&ze[++ue]===ze[++Be]&&ue<nt);if(De=U-(nt-ue),ue=nt-U,_e<De){if(te.match_start=Ne,we<=(_e=De))break;Pt=ze[ue+_e-1],vt=ze[ue+_e]}}while((Ne=Je[Ne&Ze])>pe&&--Oe!=0);return _e<=te.lookahead?_e:te.lookahead}function Te(te){var Ne,Be,De,Oe,ue,_e,we,pe,ze,Ze,Je=te.w_size;do{if(Oe=te.window_size-te.lookahead-te.strstart,te.strstart>=Je+(Je-z)){for(o.arraySet(te.window,te.window,Je,Je,0),te.match_start-=Je,te.strstart-=Je,te.block_start-=Je,Ne=Be=te.hash_size;De=te.head[--Ne],te.head[Ne]=Je<=De?De-Je:0,--Be;);for(Ne=Be=Je;De=te.prev[--Ne],te.prev[Ne]=Je<=De?De-Je:0,--Be;);Oe+=Je}if(te.strm.avail_in===0)break;if(_e=te.strm,we=te.window,pe=te.strstart+te.lookahead,ze=Oe,Ze=void 0,Ze=_e.avail_in,ze<Ze&&(Ze=ze),Be=Ze===0?0:(_e.avail_in-=Ze,o.arraySet(we,_e.input,_e.next_in,Ze,pe),_e.state.wrap===1?_e.adler=c(_e.adler,we,Ze,pe):_e.state.wrap===2&&(_e.adler=l(_e.adler,we,Ze,pe)),_e.next_in+=Ze,_e.total_in+=Ze,Ze),te.lookahead+=Be,te.lookahead+te.insert>=B)for(ue=te.strstart-te.insert,te.ins_h=te.window[ue],te.ins_h=(te.ins_h<<te.hash_shift^te.window[ue+1])&te.hash_mask;te.insert&&(te.ins_h=(te.ins_h<<te.hash_shift^te.window[ue+B-1])&te.hash_mask,te.prev[ue&te.w_mask]=te.head[te.ins_h],te.head[te.ins_h]=ue,ue++,te.insert--,!(te.lookahead+te.insert<B)););}while(te.lookahead<z&&te.strm.avail_in!==0)}function Ie(te,Ne){for(var Be,De;;){if(te.lookahead<z){if(Te(te),te.lookahead<z&&Ne===h)return M;if(te.lookahead===0)break}if(Be=0,te.lookahead>=B&&(te.ins_h=(te.ins_h<<te.hash_shift^te.window[te.strstart+B-1])&te.hash_mask,Be=te.prev[te.strstart&te.w_mask]=te.head[te.ins_h],te.head[te.ins_h]=te.strstart),Be!==0&&te.strstart-Be<=te.w_size-z&&(te.match_length=ae(te,Be)),te.match_length>=B)if(De=a._tr_tally(te,te.strstart-te.match_start,te.match_length-B),te.lookahead-=te.match_length,te.match_length<=te.max_lazy_match&&te.lookahead>=B){for(te.match_length--;te.strstart++,te.ins_h=(te.ins_h<<te.hash_shift^te.window[te.strstart+B-1])&te.hash_mask,Be=te.prev[te.strstart&te.w_mask]=te.head[te.ins_h],te.head[te.ins_h]=te.strstart,--te.match_length!=0;);te.strstart++}else te.strstart+=te.match_length,te.match_length=0,te.ins_h=te.window[te.strstart],te.ins_h=(te.ins_h<<te.hash_shift^te.window[te.strstart+1])&te.hash_mask;else De=a._tr_tally(te,0,te.window[te.strstart]),te.lookahead--,te.strstart++;if(De&&(K(te,!1),te.strm.avail_out===0))return M}return te.insert=te.strstart<B-1?te.strstart:B-1,Ne===f?(K(te,!0),te.strm.avail_out===0?Z:$):te.last_lit&&(K(te,!1),te.strm.avail_out===0)?M:F}function be(te,Ne){for(var Be,De,Oe;;){if(te.lookahead<z){if(Te(te),te.lookahead<z&&Ne===h)return M;if(te.lookahead===0)break}if(Be=0,te.lookahead>=B&&(te.ins_h=(te.ins_h<<te.hash_shift^te.window[te.strstart+B-1])&te.hash_mask,Be=te.prev[te.strstart&te.w_mask]=te.head[te.ins_h],te.head[te.ins_h]=te.strstart),te.prev_length=te.match_length,te.prev_match=te.match_start,te.match_length=B-1,Be!==0&&te.prev_length<te.max_lazy_match&&te.strstart-Be<=te.w_size-z&&(te.match_length=ae(te,Be),te.match_length<=5&&(te.strategy===1||te.match_length===B&&4096<te.strstart-te.match_start)&&(te.match_length=B-1)),te.prev_length>=B&&te.match_length<=te.prev_length){for(Oe=te.strstart+te.lookahead-B,De=a._tr_tally(te,te.strstart-1-te.prev_match,te.prev_length-B),te.lookahead-=te.prev_length-1,te.prev_length-=2;++te.strstart<=Oe&&(te.ins_h=(te.ins_h<<te.hash_shift^te.window[te.strstart+B-1])&te.hash_mask,Be=te.prev[te.strstart&te.w_mask]=te.head[te.ins_h],te.head[te.ins_h]=te.strstart),--te.prev_length!=0;);if(te.match_available=0,te.match_length=B-1,te.strstart++,De&&(K(te,!1),te.strm.avail_out===0))return M}else if(te.match_available){if((De=a._tr_tally(te,0,te.window[te.strstart-1]))&&K(te,!1),te.strstart++,te.lookahead--,te.strm.avail_out===0)return M}else te.match_available=1,te.strstart++,te.lookahead--}return te.match_available&&(De=a._tr_tally(te,0,te.window[te.strstart-1]),te.match_available=0),te.insert=te.strstart<B-1?te.strstart:B-1,Ne===f?(K(te,!0),te.strm.avail_out===0?Z:$):te.last_lit&&(K(te,!1),te.strm.avail_out===0)?M:F}function Pe(te,Ne,Be,De,Oe){this.good_length=te,this.max_lazy=Ne,this.nice_length=Be,this.max_chain=De,this.func=Oe}function $e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*R),this.dyn_dtree=new o.Buf16(2*(2*T+1)),this.bl_tree=new o.Buf16(2*(2*k+1)),q(this.dyn_ltree),q(this.dyn_dtree),q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(P+1),this.heap=new o.Buf16(2*x+1),q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*x+1),q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function tt(te){var Ne;return te&&te.state?(te.total_in=te.total_out=0,te.data_type=m,(Ne=te.state).pending=0,Ne.pending_out=0,Ne.wrap<0&&(Ne.wrap=-Ne.wrap),Ne.status=Ne.wrap?I:L,te.adler=Ne.wrap===2?0:1,Ne.last_flush=h,a._tr_init(Ne),d):Y(te,p)}function qe(te){var Ne=tt(te);return Ne===d&&(function(Be){Be.window_size=2*Be.w_size,q(Be.head),Be.max_lazy_match=s[Be.level].max_lazy,Be.good_match=s[Be.level].good_length,Be.nice_match=s[Be.level].nice_length,Be.max_chain_length=s[Be.level].max_chain,Be.strstart=0,Be.block_start=0,Be.lookahead=0,Be.insert=0,Be.match_length=Be.prev_length=B-1,Be.match_available=0,Be.ins_h=0})(te.state),Ne}function ut(te,Ne,Be,De,Oe,ue){if(!te)return p;var _e=1;if(Ne===_&&(Ne=6),De<0?(_e=0,De=-De):15<De&&(_e=2,De-=16),Oe<1||y<Oe||Be!==b||De<8||15<De||Ne<0||9<Ne||ue<0||g<ue)return Y(te,p);De===8&&(De=9);var we=new $e;return(te.state=we).strm=te,we.wrap=_e,we.gzhead=null,we.w_bits=De,we.w_size=1<<we.w_bits,we.w_mask=we.w_size-1,we.hash_bits=Oe+7,we.hash_size=1<<we.hash_bits,we.hash_mask=we.hash_size-1,we.hash_shift=~~((we.hash_bits+B-1)/B),we.window=new o.Buf8(2*we.w_size),we.head=new o.Buf16(we.hash_size),we.prev=new o.Buf16(we.w_size),we.lit_bufsize=1<<Oe+6,we.pending_buf_size=4*we.lit_bufsize,we.pending_buf=new o.Buf8(we.pending_buf_size),we.d_buf=1*we.lit_bufsize,we.l_buf=3*we.lit_bufsize,we.level=Ne,we.strategy=ue,we.method=Be,qe(te)}s=[new Pe(0,0,0,0,function(te,Ne){var Be=65535;for(Be>te.pending_buf_size-5&&(Be=te.pending_buf_size-5);;){if(te.lookahead<=1){if(Te(te),te.lookahead===0&&Ne===h)return M;if(te.lookahead===0)break}te.strstart+=te.lookahead,te.lookahead=0;var De=te.block_start+Be;if((te.strstart===0||te.strstart>=De)&&(te.lookahead=te.strstart-De,te.strstart=De,K(te,!1),te.strm.avail_out===0)||te.strstart-te.block_start>=te.w_size-z&&(K(te,!1),te.strm.avail_out===0))return M}return te.insert=0,Ne===f?(K(te,!0),te.strm.avail_out===0?Z:$):(te.strstart>te.block_start&&(K(te,!1),te.strm.avail_out),M)}),new Pe(4,4,8,4,Ie),new Pe(4,5,16,8,Ie),new Pe(4,6,32,32,Ie),new Pe(4,4,16,16,be),new Pe(8,16,32,32,be),new Pe(8,16,128,128,be),new Pe(8,32,128,256,be),new Pe(32,128,258,1024,be),new Pe(32,258,258,4096,be)],i.deflateInit=function(te,Ne){return ut(te,Ne,b,15,8,0)},i.deflateInit2=ut,i.deflateReset=qe,i.deflateResetKeep=tt,i.deflateSetHeader=function(te,Ne){return te&&te.state?te.state.wrap!==2?p:(te.state.gzhead=Ne,d):p},i.deflate=function(te,Ne){var Be,De,Oe,ue;if(!te||!te.state||5<Ne||Ne<0)return te?Y(te,p):p;if(De=te.state,!te.output||!te.input&&te.avail_in!==0||De.status===666&&Ne!==f)return Y(te,te.avail_out===0?-5:p);if(De.strm=te,Be=De.last_flush,De.last_flush=Ne,De.status===I)if(De.wrap===2)te.adler=0,ne(De,31),ne(De,139),ne(De,8),De.gzhead?(ne(De,(De.gzhead.text?1:0)+(De.gzhead.hcrc?2:0)+(De.gzhead.extra?4:0)+(De.gzhead.name?8:0)+(De.gzhead.comment?16:0)),ne(De,255&De.gzhead.time),ne(De,De.gzhead.time>>8&255),ne(De,De.gzhead.time>>16&255),ne(De,De.gzhead.time>>24&255),ne(De,De.level===9?2:2<=De.strategy||De.level<2?4:0),ne(De,255&De.gzhead.os),De.gzhead.extra&&De.gzhead.extra.length&&(ne(De,255&De.gzhead.extra.length),ne(De,De.gzhead.extra.length>>8&255)),De.gzhead.hcrc&&(te.adler=l(te.adler,De.pending_buf,De.pending,0)),De.gzindex=0,De.status=69):(ne(De,0),ne(De,0),ne(De,0),ne(De,0),ne(De,0),ne(De,De.level===9?2:2<=De.strategy||De.level<2?4:0),ne(De,3),De.status=L);else{var _e=b+(De.w_bits-8<<4)<<8;_e|=(2<=De.strategy||De.level<2?0:De.level<6?1:De.level===6?2:3)<<6,De.strstart!==0&&(_e|=32),_e+=31-_e%31,De.status=L,ie(De,_e),De.strstart!==0&&(ie(De,te.adler>>>16),ie(De,65535&te.adler)),te.adler=1}if(De.status===69)if(De.gzhead.extra){for(Oe=De.pending;De.gzindex<(65535&De.gzhead.extra.length)&&(De.pending!==De.pending_buf_size||(De.gzhead.hcrc&&De.pending>Oe&&(te.adler=l(te.adler,De.pending_buf,De.pending-Oe,Oe)),V(te),Oe=De.pending,De.pending!==De.pending_buf_size));)ne(De,255&De.gzhead.extra[De.gzindex]),De.gzindex++;De.gzhead.hcrc&&De.pending>Oe&&(te.adler=l(te.adler,De.pending_buf,De.pending-Oe,Oe)),De.gzindex===De.gzhead.extra.length&&(De.gzindex=0,De.status=73)}else De.status=73;if(De.status===73)if(De.gzhead.name){Oe=De.pending;do{if(De.pending===De.pending_buf_size&&(De.gzhead.hcrc&&De.pending>Oe&&(te.adler=l(te.adler,De.pending_buf,De.pending-Oe,Oe)),V(te),Oe=De.pending,De.pending===De.pending_buf_size)){ue=1;break}ue=De.gzindex<De.gzhead.name.length?255&De.gzhead.name.charCodeAt(De.gzindex++):0,ne(De,ue)}while(ue!==0);De.gzhead.hcrc&&De.pending>Oe&&(te.adler=l(te.adler,De.pending_buf,De.pending-Oe,Oe)),ue===0&&(De.gzindex=0,De.status=91)}else De.status=91;if(De.status===91)if(De.gzhead.comment){Oe=De.pending;do{if(De.pending===De.pending_buf_size&&(De.gzhead.hcrc&&De.pending>Oe&&(te.adler=l(te.adler,De.pending_buf,De.pending-Oe,Oe)),V(te),Oe=De.pending,De.pending===De.pending_buf_size)){ue=1;break}ue=De.gzindex<De.gzhead.comment.length?255&De.gzhead.comment.charCodeAt(De.gzindex++):0,ne(De,ue)}while(ue!==0);De.gzhead.hcrc&&De.pending>Oe&&(te.adler=l(te.adler,De.pending_buf,De.pending-Oe,Oe)),ue===0&&(De.status=103)}else De.status=103;if(De.status===103&&(De.gzhead.hcrc?(De.pending+2>De.pending_buf_size&&V(te),De.pending+2<=De.pending_buf_size&&(ne(De,255&te.adler),ne(De,te.adler>>8&255),te.adler=0,De.status=L)):De.status=L),De.pending!==0){if(V(te),te.avail_out===0)return De.last_flush=-1,d}else if(te.avail_in===0&&Q(Ne)<=Q(Be)&&Ne!==f)return Y(te,-5);if(De.status===666&&te.avail_in!==0)return Y(te,-5);if(te.avail_in!==0||De.lookahead!==0||Ne!==h&&De.status!==666){var we=De.strategy===2?(function(pe,ze){for(var Ze;;){if(pe.lookahead===0&&(Te(pe),pe.lookahead===0)){if(ze===h)return M;break}if(pe.match_length=0,Ze=a._tr_tally(pe,0,pe.window[pe.strstart]),pe.lookahead--,pe.strstart++,Ze&&(K(pe,!1),pe.strm.avail_out===0))return M}return pe.insert=0,ze===f?(K(pe,!0),pe.strm.avail_out===0?Z:$):pe.last_lit&&(K(pe,!1),pe.strm.avail_out===0)?M:F})(De,Ne):De.strategy===3?(function(pe,ze){for(var Ze,Je,nt,Pt,vt=pe.window;;){if(pe.lookahead<=U){if(Te(pe),pe.lookahead<=U&&ze===h)return M;if(pe.lookahead===0)break}if(pe.match_length=0,pe.lookahead>=B&&0<pe.strstart&&(Je=vt[nt=pe.strstart-1])===vt[++nt]&&Je===vt[++nt]&&Je===vt[++nt]){Pt=pe.strstart+U;do;while(Je===vt[++nt]&&Je===vt[++nt]&&Je===vt[++nt]&&Je===vt[++nt]&&Je===vt[++nt]&&Je===vt[++nt]&&Je===vt[++nt]&&Je===vt[++nt]&&nt<Pt);pe.match_length=U-(Pt-nt),pe.match_length>pe.lookahead&&(pe.match_length=pe.lookahead)}if(pe.match_length>=B?(Ze=a._tr_tally(pe,1,pe.match_length-B),pe.lookahead-=pe.match_length,pe.strstart+=pe.match_length,pe.match_length=0):(Ze=a._tr_tally(pe,0,pe.window[pe.strstart]),pe.lookahead--,pe.strstart++),Ze&&(K(pe,!1),pe.strm.avail_out===0))return M}return pe.insert=0,ze===f?(K(pe,!0),pe.strm.avail_out===0?Z:$):pe.last_lit&&(K(pe,!1),pe.strm.avail_out===0)?M:F})(De,Ne):s[De.level].func(De,Ne);if(we!==Z&&we!==$||(De.status=666),we===M||we===Z)return te.avail_out===0&&(De.last_flush=-1),d;if(we===F&&(Ne===1?a._tr_align(De):Ne!==5&&(a._tr_stored_block(De,0,0,!1),Ne===3&&(q(De.head),De.lookahead===0&&(De.strstart=0,De.block_start=0,De.insert=0))),V(te),te.avail_out===0))return De.last_flush=-1,d}return Ne!==f?d:De.wrap<=0?1:(De.wrap===2?(ne(De,255&te.adler),ne(De,te.adler>>8&255),ne(De,te.adler>>16&255),ne(De,te.adler>>24&255),ne(De,255&te.total_in),ne(De,te.total_in>>8&255),ne(De,te.total_in>>16&255),ne(De,te.total_in>>24&255)):(ie(De,te.adler>>>16),ie(De,65535&te.adler)),V(te),0<De.wrap&&(De.wrap=-De.wrap),De.pending!==0?d:1)},i.deflateEnd=function(te){var Ne;return te&&te.state?(Ne=te.state.status)!==I&&Ne!==69&&Ne!==73&&Ne!==91&&Ne!==103&&Ne!==L&&Ne!==666?Y(te,p):(te.state=null,Ne===L?Y(te,-3):d):p},i.deflateSetDictionary=function(te,Ne){var Be,De,Oe,ue,_e,we,pe,ze,Ze=Ne.length;if(!te||!te.state||(ue=(Be=te.state).wrap)===2||ue===1&&Be.status!==I||Be.lookahead)return p;for(ue===1&&(te.adler=c(te.adler,Ne,Ze,0)),Be.wrap=0,Ze>=Be.w_size&&(ue===0&&(q(Be.head),Be.strstart=0,Be.block_start=0,Be.insert=0),ze=new o.Buf8(Be.w_size),o.arraySet(ze,Ne,Ze-Be.w_size,Be.w_size,0),Ne=ze,Ze=Be.w_size),_e=te.avail_in,we=te.next_in,pe=te.input,te.avail_in=Ze,te.next_in=0,te.input=Ne,Te(Be);Be.lookahead>=B;){for(De=Be.strstart,Oe=Be.lookahead-(B-1);Be.ins_h=(Be.ins_h<<Be.hash_shift^Be.window[De+B-1])&Be.hash_mask,Be.prev[De&Be.w_mask]=Be.head[Be.ins_h],Be.head[Be.ins_h]=De,De++,--Oe;);Be.strstart=De,Be.lookahead=B-1,Te(Be)}return Be.strstart+=Be.lookahead,Be.block_start=Be.strstart,Be.insert=Be.lookahead,Be.lookahead=0,Be.match_length=Be.prev_length=B-1,Be.match_available=0,te.next_in=we,te.input=pe,te.avail_in=_e,Be.wrap=ue,d},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,r,i){r.exports=function(s,o){var a,c,l,u,h,f,d,p,_,g,m,b,y,x,T,k,R,P,B,U,z,I,L,M,F;a=s.state,c=s.next_in,M=s.input,l=c+(s.avail_in-5),u=s.next_out,F=s.output,h=u-(o-s.avail_out),f=u+(s.avail_out-257),d=a.dmax,p=a.wsize,_=a.whave,g=a.wnext,m=a.window,b=a.hold,y=a.bits,x=a.lencode,T=a.distcode,k=(1<<a.lenbits)-1,R=(1<<a.distbits)-1;e:do{y<15&&(b+=M[c++]<<y,y+=8,b+=M[c++]<<y,y+=8),P=x[b&k];t:for(;;){if(b>>>=B=P>>>24,y-=B,(B=P>>>16&255)===0)F[u++]=65535&P;else{if(!(16&B)){if((64&B)==0){P=x[(65535&P)+(b&(1<<B)-1)];continue t}if(32&B){a.mode=12;break e}s.msg="invalid literal/length code",a.mode=30;break e}U=65535&P,(B&=15)&&(y<B&&(b+=M[c++]<<y,y+=8),U+=b&(1<<B)-1,b>>>=B,y-=B),y<15&&(b+=M[c++]<<y,y+=8,b+=M[c++]<<y,y+=8),P=T[b&R];n:for(;;){if(b>>>=B=P>>>24,y-=B,!(16&(B=P>>>16&255))){if((64&B)==0){P=T[(65535&P)+(b&(1<<B)-1)];continue n}s.msg="invalid distance code",a.mode=30;break e}if(z=65535&P,y<(B&=15)&&(b+=M[c++]<<y,(y+=8)<B&&(b+=M[c++]<<y,y+=8)),d<(z+=b&(1<<B)-1)){s.msg="invalid distance too far back",a.mode=30;break e}if(b>>>=B,y-=B,(B=u-h)<z){if(_<(B=z-B)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break e}if(L=m,(I=0)===g){if(I+=p-B,B<U){for(U-=B;F[u++]=m[I++],--B;);I=u-z,L=F}}else if(g<B){if(I+=p+g-B,(B-=g)<U){for(U-=B;F[u++]=m[I++],--B;);if(I=0,g<U){for(U-=B=g;F[u++]=m[I++],--B;);I=u-z,L=F}}}else if(I+=g-B,B<U){for(U-=B;F[u++]=m[I++],--B;);I=u-z,L=F}for(;2<U;)F[u++]=L[I++],F[u++]=L[I++],F[u++]=L[I++],U-=3;U&&(F[u++]=L[I++],1<U&&(F[u++]=L[I++]))}else{for(I=u-z;F[u++]=F[I++],F[u++]=F[I++],F[u++]=F[I++],2<(U-=3););U&&(F[u++]=F[I++],1<U&&(F[u++]=F[I++]))}break}}break}}while(c<l&&u<f);c-=U=y>>3,b&=(1<<(y-=U<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<f?f-u+257:257-(u-f),a.hold=b,a.bits=y}},{}],49:[function(t,r,i){var s=t("../utils/common"),o=t("./adler32"),a=t("./crc32"),c=t("./inffast"),l=t("./inftrees"),u=1,h=2,f=0,d=-2,p=1,_=852,g=592;function m(I){return(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(I){var L;return I&&I.state?(L=I.state,I.total_in=I.total_out=L.total=0,I.msg="",L.wrap&&(I.adler=1&L.wrap),L.mode=p,L.last=0,L.havedict=0,L.dmax=32768,L.head=null,L.hold=0,L.bits=0,L.lencode=L.lendyn=new s.Buf32(_),L.distcode=L.distdyn=new s.Buf32(g),L.sane=1,L.back=-1,f):d}function x(I){var L;return I&&I.state?((L=I.state).wsize=0,L.whave=0,L.wnext=0,y(I)):d}function T(I,L){var M,F;return I&&I.state?(F=I.state,L<0?(M=0,L=-L):(M=1+(L>>4),L<48&&(L&=15)),L&&(L<8||15<L)?d:(F.window!==null&&F.wbits!==L&&(F.window=null),F.wrap=M,F.wbits=L,x(I))):d}function k(I,L){var M,F;return I?(F=new b,(I.state=F).window=null,(M=T(I,L))!==f&&(I.state=null),M):d}var R,P,B=!0;function U(I){if(B){var L;for(R=new s.Buf32(512),P=new s.Buf32(32),L=0;L<144;)I.lens[L++]=8;for(;L<256;)I.lens[L++]=9;for(;L<280;)I.lens[L++]=7;for(;L<288;)I.lens[L++]=8;for(l(u,I.lens,0,288,R,0,I.work,{bits:9}),L=0;L<32;)I.lens[L++]=5;l(h,I.lens,0,32,P,0,I.work,{bits:5}),B=!1}I.lencode=R,I.lenbits=9,I.distcode=P,I.distbits=5}function z(I,L,M,F){var Z,$=I.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new s.Buf8($.wsize)),F>=$.wsize?(s.arraySet($.window,L,M-$.wsize,$.wsize,0),$.wnext=0,$.whave=$.wsize):(F<(Z=$.wsize-$.wnext)&&(Z=F),s.arraySet($.window,L,M-F,Z,$.wnext),(F-=Z)?(s.arraySet($.window,L,M-F,F,0),$.wnext=F,$.whave=$.wsize):($.wnext+=Z,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=Z))),0}i.inflateReset=x,i.inflateReset2=T,i.inflateResetKeep=y,i.inflateInit=function(I){return k(I,15)},i.inflateInit2=k,i.inflate=function(I,L){var M,F,Z,$,Y,Q,q,V,K,ne,ie,ae,Te,Ie,be,Pe,$e,tt,qe,ut,te,Ne,Be,De,Oe=0,ue=new s.Buf8(4),_e=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!I||!I.state||!I.output||!I.input&&I.avail_in!==0)return d;(M=I.state).mode===12&&(M.mode=13),Y=I.next_out,Z=I.output,q=I.avail_out,$=I.next_in,F=I.input,Q=I.avail_in,V=M.hold,K=M.bits,ne=Q,ie=q,Ne=f;e:for(;;)switch(M.mode){case p:if(M.wrap===0){M.mode=13;break}for(;K<16;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}if(2&M.wrap&&V===35615){ue[M.check=0]=255&V,ue[1]=V>>>8&255,M.check=a(M.check,ue,2,0),K=V=0,M.mode=2;break}if(M.flags=0,M.head&&(M.head.done=!1),!(1&M.wrap)||(((255&V)<<8)+(V>>8))%31){I.msg="incorrect header check",M.mode=30;break}if((15&V)!=8){I.msg="unknown compression method",M.mode=30;break}if(K-=4,te=8+(15&(V>>>=4)),M.wbits===0)M.wbits=te;else if(te>M.wbits){I.msg="invalid window size",M.mode=30;break}M.dmax=1<<te,I.adler=M.check=1,M.mode=512&V?10:12,K=V=0;break;case 2:for(;K<16;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}if(M.flags=V,(255&M.flags)!=8){I.msg="unknown compression method",M.mode=30;break}if(57344&M.flags){I.msg="unknown header flags set",M.mode=30;break}M.head&&(M.head.text=V>>8&1),512&M.flags&&(ue[0]=255&V,ue[1]=V>>>8&255,M.check=a(M.check,ue,2,0)),K=V=0,M.mode=3;case 3:for(;K<32;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}M.head&&(M.head.time=V),512&M.flags&&(ue[0]=255&V,ue[1]=V>>>8&255,ue[2]=V>>>16&255,ue[3]=V>>>24&255,M.check=a(M.check,ue,4,0)),K=V=0,M.mode=4;case 4:for(;K<16;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}M.head&&(M.head.xflags=255&V,M.head.os=V>>8),512&M.flags&&(ue[0]=255&V,ue[1]=V>>>8&255,M.check=a(M.check,ue,2,0)),K=V=0,M.mode=5;case 5:if(1024&M.flags){for(;K<16;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}M.length=V,M.head&&(M.head.extra_len=V),512&M.flags&&(ue[0]=255&V,ue[1]=V>>>8&255,M.check=a(M.check,ue,2,0)),K=V=0}else M.head&&(M.head.extra=null);M.mode=6;case 6:if(1024&M.flags&&(Q<(ae=M.length)&&(ae=Q),ae&&(M.head&&(te=M.head.extra_len-M.length,M.head.extra||(M.head.extra=new Array(M.head.extra_len)),s.arraySet(M.head.extra,F,$,ae,te)),512&M.flags&&(M.check=a(M.check,F,ae,$)),Q-=ae,$+=ae,M.length-=ae),M.length))break e;M.length=0,M.mode=7;case 7:if(2048&M.flags){if(Q===0)break e;for(ae=0;te=F[$+ae++],M.head&&te&&M.length<65536&&(M.head.name+=String.fromCharCode(te)),te&&ae<Q;);if(512&M.flags&&(M.check=a(M.check,F,ae,$)),Q-=ae,$+=ae,te)break e}else M.head&&(M.head.name=null);M.length=0,M.mode=8;case 8:if(4096&M.flags){if(Q===0)break e;for(ae=0;te=F[$+ae++],M.head&&te&&M.length<65536&&(M.head.comment+=String.fromCharCode(te)),te&&ae<Q;);if(512&M.flags&&(M.check=a(M.check,F,ae,$)),Q-=ae,$+=ae,te)break e}else M.head&&(M.head.comment=null);M.mode=9;case 9:if(512&M.flags){for(;K<16;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}if(V!==(65535&M.check)){I.msg="header crc mismatch",M.mode=30;break}K=V=0}M.head&&(M.head.hcrc=M.flags>>9&1,M.head.done=!0),I.adler=M.check=0,M.mode=12;break;case 10:for(;K<32;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}I.adler=M.check=m(V),K=V=0,M.mode=11;case 11:if(M.havedict===0)return I.next_out=Y,I.avail_out=q,I.next_in=$,I.avail_in=Q,M.hold=V,M.bits=K,2;I.adler=M.check=1,M.mode=12;case 12:if(L===5||L===6)break e;case 13:if(M.last){V>>>=7&K,K-=7&K,M.mode=27;break}for(;K<3;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}switch(M.last=1&V,K-=1,3&(V>>>=1)){case 0:M.mode=14;break;case 1:if(U(M),M.mode=20,L!==6)break;V>>>=2,K-=2;break e;case 2:M.mode=17;break;case 3:I.msg="invalid block type",M.mode=30}V>>>=2,K-=2;break;case 14:for(V>>>=7&K,K-=7&K;K<32;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}if((65535&V)!=(V>>>16^65535)){I.msg="invalid stored block lengths",M.mode=30;break}if(M.length=65535&V,K=V=0,M.mode=15,L===6)break e;case 15:M.mode=16;case 16:if(ae=M.length){if(Q<ae&&(ae=Q),q<ae&&(ae=q),ae===0)break e;s.arraySet(Z,F,$,ae,Y),Q-=ae,$+=ae,q-=ae,Y+=ae,M.length-=ae;break}M.mode=12;break;case 17:for(;K<14;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}if(M.nlen=257+(31&V),V>>>=5,K-=5,M.ndist=1+(31&V),V>>>=5,K-=5,M.ncode=4+(15&V),V>>>=4,K-=4,286<M.nlen||30<M.ndist){I.msg="too many length or distance symbols",M.mode=30;break}M.have=0,M.mode=18;case 18:for(;M.have<M.ncode;){for(;K<3;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}M.lens[_e[M.have++]]=7&V,V>>>=3,K-=3}for(;M.have<19;)M.lens[_e[M.have++]]=0;if(M.lencode=M.lendyn,M.lenbits=7,Be={bits:M.lenbits},Ne=l(0,M.lens,0,19,M.lencode,0,M.work,Be),M.lenbits=Be.bits,Ne){I.msg="invalid code lengths set",M.mode=30;break}M.have=0,M.mode=19;case 19:for(;M.have<M.nlen+M.ndist;){for(;Pe=(Oe=M.lencode[V&(1<<M.lenbits)-1])>>>16&255,$e=65535&Oe,!((be=Oe>>>24)<=K);){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}if($e<16)V>>>=be,K-=be,M.lens[M.have++]=$e;else{if($e===16){for(De=be+2;K<De;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}if(V>>>=be,K-=be,M.have===0){I.msg="invalid bit length repeat",M.mode=30;break}te=M.lens[M.have-1],ae=3+(3&V),V>>>=2,K-=2}else if($e===17){for(De=be+3;K<De;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}K-=be,te=0,ae=3+(7&(V>>>=be)),V>>>=3,K-=3}else{for(De=be+7;K<De;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}K-=be,te=0,ae=11+(127&(V>>>=be)),V>>>=7,K-=7}if(M.have+ae>M.nlen+M.ndist){I.msg="invalid bit length repeat",M.mode=30;break}for(;ae--;)M.lens[M.have++]=te}}if(M.mode===30)break;if(M.lens[256]===0){I.msg="invalid code -- missing end-of-block",M.mode=30;break}if(M.lenbits=9,Be={bits:M.lenbits},Ne=l(u,M.lens,0,M.nlen,M.lencode,0,M.work,Be),M.lenbits=Be.bits,Ne){I.msg="invalid literal/lengths set",M.mode=30;break}if(M.distbits=6,M.distcode=M.distdyn,Be={bits:M.distbits},Ne=l(h,M.lens,M.nlen,M.ndist,M.distcode,0,M.work,Be),M.distbits=Be.bits,Ne){I.msg="invalid distances set",M.mode=30;break}if(M.mode=20,L===6)break e;case 20:M.mode=21;case 21:if(6<=Q&&258<=q){I.next_out=Y,I.avail_out=q,I.next_in=$,I.avail_in=Q,M.hold=V,M.bits=K,c(I,ie),Y=I.next_out,Z=I.output,q=I.avail_out,$=I.next_in,F=I.input,Q=I.avail_in,V=M.hold,K=M.bits,M.mode===12&&(M.back=-1);break}for(M.back=0;Pe=(Oe=M.lencode[V&(1<<M.lenbits)-1])>>>16&255,$e=65535&Oe,!((be=Oe>>>24)<=K);){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}if(Pe&&(240&Pe)==0){for(tt=be,qe=Pe,ut=$e;Pe=(Oe=M.lencode[ut+((V&(1<<tt+qe)-1)>>tt)])>>>16&255,$e=65535&Oe,!(tt+(be=Oe>>>24)<=K);){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}V>>>=tt,K-=tt,M.back+=tt}if(V>>>=be,K-=be,M.back+=be,M.length=$e,Pe===0){M.mode=26;break}if(32&Pe){M.back=-1,M.mode=12;break}if(64&Pe){I.msg="invalid literal/length code",M.mode=30;break}M.extra=15&Pe,M.mode=22;case 22:if(M.extra){for(De=M.extra;K<De;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}M.length+=V&(1<<M.extra)-1,V>>>=M.extra,K-=M.extra,M.back+=M.extra}M.was=M.length,M.mode=23;case 23:for(;Pe=(Oe=M.distcode[V&(1<<M.distbits)-1])>>>16&255,$e=65535&Oe,!((be=Oe>>>24)<=K);){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}if((240&Pe)==0){for(tt=be,qe=Pe,ut=$e;Pe=(Oe=M.distcode[ut+((V&(1<<tt+qe)-1)>>tt)])>>>16&255,$e=65535&Oe,!(tt+(be=Oe>>>24)<=K);){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}V>>>=tt,K-=tt,M.back+=tt}if(V>>>=be,K-=be,M.back+=be,64&Pe){I.msg="invalid distance code",M.mode=30;break}M.offset=$e,M.extra=15&Pe,M.mode=24;case 24:if(M.extra){for(De=M.extra;K<De;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}M.offset+=V&(1<<M.extra)-1,V>>>=M.extra,K-=M.extra,M.back+=M.extra}if(M.offset>M.dmax){I.msg="invalid distance too far back",M.mode=30;break}M.mode=25;case 25:if(q===0)break e;if(ae=ie-q,M.offset>ae){if((ae=M.offset-ae)>M.whave&&M.sane){I.msg="invalid distance too far back",M.mode=30;break}Te=ae>M.wnext?(ae-=M.wnext,M.wsize-ae):M.wnext-ae,ae>M.length&&(ae=M.length),Ie=M.window}else Ie=Z,Te=Y-M.offset,ae=M.length;for(q<ae&&(ae=q),q-=ae,M.length-=ae;Z[Y++]=Ie[Te++],--ae;);M.length===0&&(M.mode=21);break;case 26:if(q===0)break e;Z[Y++]=M.length,q--,M.mode=21;break;case 27:if(M.wrap){for(;K<32;){if(Q===0)break e;Q--,V|=F[$++]<<K,K+=8}if(ie-=q,I.total_out+=ie,M.total+=ie,ie&&(I.adler=M.check=M.flags?a(M.check,Z,ie,Y-ie):o(M.check,Z,ie,Y-ie)),ie=q,(M.flags?V:m(V))!==M.check){I.msg="incorrect data check",M.mode=30;break}K=V=0}M.mode=28;case 28:if(M.wrap&&M.flags){for(;K<32;){if(Q===0)break e;Q--,V+=F[$++]<<K,K+=8}if(V!==(4294967295&M.total)){I.msg="incorrect length check",M.mode=30;break}K=V=0}M.mode=29;case 29:Ne=1;break e;case 30:Ne=-3;break e;case 31:return-4;case 32:default:return d}return I.next_out=Y,I.avail_out=q,I.next_in=$,I.avail_in=Q,M.hold=V,M.bits=K,(M.wsize||ie!==I.avail_out&&M.mode<30&&(M.mode<27||L!==4))&&z(I,I.output,I.next_out,ie-I.avail_out)?(M.mode=31,-4):(ne-=I.avail_in,ie-=I.avail_out,I.total_in+=ne,I.total_out+=ie,M.total+=ie,M.wrap&&ie&&(I.adler=M.check=M.flags?a(M.check,Z,ie,I.next_out-ie):o(M.check,Z,ie,I.next_out-ie)),I.data_type=M.bits+(M.last?64:0)+(M.mode===12?128:0)+(M.mode===20||M.mode===15?256:0),(ne==0&&ie===0||L===4)&&Ne===f&&(Ne=-5),Ne)},i.inflateEnd=function(I){if(!I||!I.state)return d;var L=I.state;return L.window&&(L.window=null),I.state=null,f},i.inflateGetHeader=function(I,L){var M;return I&&I.state?(2&(M=I.state).wrap)==0?d:((M.head=L).done=!1,f):d},i.inflateSetDictionary=function(I,L){var M,F=L.length;return I&&I.state?(M=I.state).wrap!==0&&M.mode!==11?d:M.mode===11&&o(1,L,F,0)!==M.check?-3:z(I,L,F,F)?(M.mode=31,-4):(M.havedict=1,f):d},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,r,i){var s=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,h,f,d,p,_,g,m){var b,y,x,T,k,R,P,B,U,z=m.bits,I=0,L=0,M=0,F=0,Z=0,$=0,Y=0,Q=0,q=0,V=0,K=null,ne=0,ie=new s.Buf16(16),ae=new s.Buf16(16),Te=null,Ie=0;for(I=0;I<=15;I++)ie[I]=0;for(L=0;L<d;L++)ie[h[f+L]]++;for(Z=z,F=15;1<=F&&ie[F]===0;F--);if(F<Z&&(Z=F),F===0)return p[_++]=20971520,p[_++]=20971520,m.bits=1,0;for(M=1;M<F&&ie[M]===0;M++);for(Z<M&&(Z=M),I=Q=1;I<=15;I++)if(Q<<=1,(Q-=ie[I])<0)return-1;if(0<Q&&(u===0||F!==1))return-1;for(ae[1]=0,I=1;I<15;I++)ae[I+1]=ae[I]+ie[I];for(L=0;L<d;L++)h[f+L]!==0&&(g[ae[h[f+L]]++]=L);if(R=u===0?(K=Te=g,19):u===1?(K=o,ne-=257,Te=a,Ie-=257,256):(K=c,Te=l,-1),I=M,k=_,Y=L=V=0,x=-1,T=(q=1<<($=Z))-1,u===1&&852<q||u===2&&592<q)return 1;for(;;){for(P=I-Y,U=g[L]<R?(B=0,g[L]):g[L]>R?(B=Te[Ie+g[L]],K[ne+g[L]]):(B=96,0),b=1<<I-Y,M=y=1<<$;p[k+(V>>Y)+(y-=b)]=P<<24|B<<16|U|0,y!==0;);for(b=1<<I-1;V&b;)b>>=1;if(b!==0?(V&=b-1,V+=b):V=0,L++,--ie[I]==0){if(I===F)break;I=h[f+g[L]]}if(Z<I&&(V&T)!==x){for(Y===0&&(Y=Z),k+=M,Q=1<<($=I-Y);$+Y<F&&!((Q-=ie[$+Y])<=0);)$++,Q<<=1;if(q+=1<<$,u===1&&852<q||u===2&&592<q)return 1;p[x=V&T]=Z<<24|$<<16|k-_|0}}return V!==0&&(p[k+V]=I-Y<<24|64<<16|0),m.bits=Z,0}},{"../utils/common":41}],51:[function(t,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,r,i){var s=t("../utils/common"),o=0,a=1;function c(Oe){for(var ue=Oe.length;0<=--ue;)Oe[ue]=0}var l=0,u=29,h=256,f=h+1+u,d=30,p=19,_=2*f+1,g=15,m=16,b=7,y=256,x=16,T=17,k=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=new Array(2*(f+2));c(z);var I=new Array(2*d);c(I);var L=new Array(512);c(L);var M=new Array(256);c(M);var F=new Array(u);c(F);var Z,$,Y,Q=new Array(d);function q(Oe,ue,_e,we,pe){this.static_tree=Oe,this.extra_bits=ue,this.extra_base=_e,this.elems=we,this.max_length=pe,this.has_stree=Oe&&Oe.length}function V(Oe,ue){this.dyn_tree=Oe,this.max_code=0,this.stat_desc=ue}function K(Oe){return Oe<256?L[Oe]:L[256+(Oe>>>7)]}function ne(Oe,ue){Oe.pending_buf[Oe.pending++]=255&ue,Oe.pending_buf[Oe.pending++]=ue>>>8&255}function ie(Oe,ue,_e){Oe.bi_valid>m-_e?(Oe.bi_buf|=ue<<Oe.bi_valid&65535,ne(Oe,Oe.bi_buf),Oe.bi_buf=ue>>m-Oe.bi_valid,Oe.bi_valid+=_e-m):(Oe.bi_buf|=ue<<Oe.bi_valid&65535,Oe.bi_valid+=_e)}function ae(Oe,ue,_e){ie(Oe,_e[2*ue],_e[2*ue+1])}function Te(Oe,ue){for(var _e=0;_e|=1&Oe,Oe>>>=1,_e<<=1,0<--ue;);return _e>>>1}function Ie(Oe,ue,_e){var we,pe,ze=new Array(g+1),Ze=0;for(we=1;we<=g;we++)ze[we]=Ze=Ze+_e[we-1]<<1;for(pe=0;pe<=ue;pe++){var Je=Oe[2*pe+1];Je!==0&&(Oe[2*pe]=Te(ze[Je]++,Je))}}function be(Oe){var ue;for(ue=0;ue<f;ue++)Oe.dyn_ltree[2*ue]=0;for(ue=0;ue<d;ue++)Oe.dyn_dtree[2*ue]=0;for(ue=0;ue<p;ue++)Oe.bl_tree[2*ue]=0;Oe.dyn_ltree[2*y]=1,Oe.opt_len=Oe.static_len=0,Oe.last_lit=Oe.matches=0}function Pe(Oe){8<Oe.bi_valid?ne(Oe,Oe.bi_buf):0<Oe.bi_valid&&(Oe.pending_buf[Oe.pending++]=Oe.bi_buf),Oe.bi_buf=0,Oe.bi_valid=0}function $e(Oe,ue,_e,we){var pe=2*ue,ze=2*_e;return Oe[pe]<Oe[ze]||Oe[pe]===Oe[ze]&&we[ue]<=we[_e]}function tt(Oe,ue,_e){for(var we=Oe.heap[_e],pe=_e<<1;pe<=Oe.heap_len&&(pe<Oe.heap_len&&$e(ue,Oe.heap[pe+1],Oe.heap[pe],Oe.depth)&&pe++,!$e(ue,we,Oe.heap[pe],Oe.depth));)Oe.heap[_e]=Oe.heap[pe],_e=pe,pe<<=1;Oe.heap[_e]=we}function qe(Oe,ue,_e){var we,pe,ze,Ze,Je=0;if(Oe.last_lit!==0)for(;we=Oe.pending_buf[Oe.d_buf+2*Je]<<8|Oe.pending_buf[Oe.d_buf+2*Je+1],pe=Oe.pending_buf[Oe.l_buf+Je],Je++,we===0?ae(Oe,pe,ue):(ae(Oe,(ze=M[pe])+h+1,ue),(Ze=R[ze])!==0&&ie(Oe,pe-=F[ze],Ze),ae(Oe,ze=K(--we),_e),(Ze=P[ze])!==0&&ie(Oe,we-=Q[ze],Ze)),Je<Oe.last_lit;);ae(Oe,y,ue)}function ut(Oe,ue){var _e,we,pe,ze=ue.dyn_tree,Ze=ue.stat_desc.static_tree,Je=ue.stat_desc.has_stree,nt=ue.stat_desc.elems,Pt=-1;for(Oe.heap_len=0,Oe.heap_max=_,_e=0;_e<nt;_e++)ze[2*_e]!==0?(Oe.heap[++Oe.heap_len]=Pt=_e,Oe.depth[_e]=0):ze[2*_e+1]=0;for(;Oe.heap_len<2;)ze[2*(pe=Oe.heap[++Oe.heap_len]=Pt<2?++Pt:0)]=1,Oe.depth[pe]=0,Oe.opt_len--,Je&&(Oe.static_len-=Ze[2*pe+1]);for(ue.max_code=Pt,_e=Oe.heap_len>>1;1<=_e;_e--)tt(Oe,ze,_e);for(pe=nt;_e=Oe.heap[1],Oe.heap[1]=Oe.heap[Oe.heap_len--],tt(Oe,ze,1),we=Oe.heap[1],Oe.heap[--Oe.heap_max]=_e,Oe.heap[--Oe.heap_max]=we,ze[2*pe]=ze[2*_e]+ze[2*we],Oe.depth[pe]=(Oe.depth[_e]>=Oe.depth[we]?Oe.depth[_e]:Oe.depth[we])+1,ze[2*_e+1]=ze[2*we+1]=pe,Oe.heap[1]=pe++,tt(Oe,ze,1),2<=Oe.heap_len;);Oe.heap[--Oe.heap_max]=Oe.heap[1],(function(vt,At){var Re,ce,W,le,Se,Ae,ye=At.dyn_tree,ve=At.max_code,Xe=At.stat_desc.static_tree,Me=At.stat_desc.has_stree,Ve=At.stat_desc.extra_bits,je=At.stat_desc.extra_base,We=At.stat_desc.max_length,ct=0;for(le=0;le<=g;le++)vt.bl_count[le]=0;for(ye[2*vt.heap[vt.heap_max]+1]=0,Re=vt.heap_max+1;Re<_;Re++)We<(le=ye[2*ye[2*(ce=vt.heap[Re])+1]+1]+1)&&(le=We,ct++),ye[2*ce+1]=le,ve<ce||(vt.bl_count[le]++,Se=0,je<=ce&&(Se=Ve[ce-je]),Ae=ye[2*ce],vt.opt_len+=Ae*(le+Se),Me&&(vt.static_len+=Ae*(Xe[2*ce+1]+Se)));if(ct!==0){do{for(le=We-1;vt.bl_count[le]===0;)le--;vt.bl_count[le]--,vt.bl_count[le+1]+=2,vt.bl_count[We]--,ct-=2}while(0<ct);for(le=We;le!==0;le--)for(ce=vt.bl_count[le];ce!==0;)ve<(W=vt.heap[--Re])||(ye[2*W+1]!==le&&(vt.opt_len+=(le-ye[2*W+1])*ye[2*W],ye[2*W+1]=le),ce--)}})(Oe,ue),Ie(ze,Pt,Oe.bl_count)}function te(Oe,ue,_e){var we,pe,ze=-1,Ze=ue[1],Je=0,nt=7,Pt=4;for(Ze===0&&(nt=138,Pt=3),ue[2*(_e+1)+1]=65535,we=0;we<=_e;we++)pe=Ze,Ze=ue[2*(we+1)+1],++Je<nt&&pe===Ze||(Je<Pt?Oe.bl_tree[2*pe]+=Je:pe!==0?(pe!==ze&&Oe.bl_tree[2*pe]++,Oe.bl_tree[2*x]++):Je<=10?Oe.bl_tree[2*T]++:Oe.bl_tree[2*k]++,ze=pe,Pt=(Je=0)===Ze?(nt=138,3):pe===Ze?(nt=6,3):(nt=7,4))}function Ne(Oe,ue,_e){var we,pe,ze=-1,Ze=ue[1],Je=0,nt=7,Pt=4;for(Ze===0&&(nt=138,Pt=3),we=0;we<=_e;we++)if(pe=Ze,Ze=ue[2*(we+1)+1],!(++Je<nt&&pe===Ze)){if(Je<Pt)for(;ae(Oe,pe,Oe.bl_tree),--Je!=0;);else pe!==0?(pe!==ze&&(ae(Oe,pe,Oe.bl_tree),Je--),ae(Oe,x,Oe.bl_tree),ie(Oe,Je-3,2)):Je<=10?(ae(Oe,T,Oe.bl_tree),ie(Oe,Je-3,3)):(ae(Oe,k,Oe.bl_tree),ie(Oe,Je-11,7));ze=pe,Pt=(Je=0)===Ze?(nt=138,3):pe===Ze?(nt=6,3):(nt=7,4)}}c(Q);var Be=!1;function De(Oe,ue,_e,we){ie(Oe,(l<<1)+(we?1:0),3),(function(pe,ze,Ze,Je){Pe(pe),ne(pe,Ze),ne(pe,~Ze),s.arraySet(pe.pending_buf,pe.window,ze,Ze,pe.pending),pe.pending+=Ze})(Oe,ue,_e)}i._tr_init=function(Oe){Be||((function(){var ue,_e,we,pe,ze,Ze=new Array(g+1);for(pe=we=0;pe<u-1;pe++)for(F[pe]=we,ue=0;ue<1<<R[pe];ue++)M[we++]=pe;for(M[we-1]=pe,pe=ze=0;pe<16;pe++)for(Q[pe]=ze,ue=0;ue<1<<P[pe];ue++)L[ze++]=pe;for(ze>>=7;pe<d;pe++)for(Q[pe]=ze<<7,ue=0;ue<1<<P[pe]-7;ue++)L[256+ze++]=pe;for(_e=0;_e<=g;_e++)Ze[_e]=0;for(ue=0;ue<=143;)z[2*ue+1]=8,ue++,Ze[8]++;for(;ue<=255;)z[2*ue+1]=9,ue++,Ze[9]++;for(;ue<=279;)z[2*ue+1]=7,ue++,Ze[7]++;for(;ue<=287;)z[2*ue+1]=8,ue++,Ze[8]++;for(Ie(z,f+1,Ze),ue=0;ue<d;ue++)I[2*ue+1]=5,I[2*ue]=Te(ue,5);Z=new q(z,R,h+1,f,g),$=new q(I,P,0,d,g),Y=new q(new Array(0),B,0,p,b)})(),Be=!0),Oe.l_desc=new V(Oe.dyn_ltree,Z),Oe.d_desc=new V(Oe.dyn_dtree,$),Oe.bl_desc=new V(Oe.bl_tree,Y),Oe.bi_buf=0,Oe.bi_valid=0,be(Oe)},i._tr_stored_block=De,i._tr_flush_block=function(Oe,ue,_e,we){var pe,ze,Ze=0;0<Oe.level?(Oe.strm.data_type===2&&(Oe.strm.data_type=(function(Je){var nt,Pt=4093624447;for(nt=0;nt<=31;nt++,Pt>>>=1)if(1&Pt&&Je.dyn_ltree[2*nt]!==0)return o;if(Je.dyn_ltree[18]!==0||Je.dyn_ltree[20]!==0||Je.dyn_ltree[26]!==0)return a;for(nt=32;nt<h;nt++)if(Je.dyn_ltree[2*nt]!==0)return a;return o})(Oe)),ut(Oe,Oe.l_desc),ut(Oe,Oe.d_desc),Ze=(function(Je){var nt;for(te(Je,Je.dyn_ltree,Je.l_desc.max_code),te(Je,Je.dyn_dtree,Je.d_desc.max_code),ut(Je,Je.bl_desc),nt=p-1;3<=nt&&Je.bl_tree[2*U[nt]+1]===0;nt--);return Je.opt_len+=3*(nt+1)+5+5+4,nt})(Oe),pe=Oe.opt_len+3+7>>>3,(ze=Oe.static_len+3+7>>>3)<=pe&&(pe=ze)):pe=ze=_e+5,_e+4<=pe&&ue!==-1?De(Oe,ue,_e,we):Oe.strategy===4||ze===pe?(ie(Oe,2+(we?1:0),3),qe(Oe,z,I)):(ie(Oe,4+(we?1:0),3),(function(Je,nt,Pt,vt){var At;for(ie(Je,nt-257,5),ie(Je,Pt-1,5),ie(Je,vt-4,4),At=0;At<vt;At++)ie(Je,Je.bl_tree[2*U[At]+1],3);Ne(Je,Je.dyn_ltree,nt-1),Ne(Je,Je.dyn_dtree,Pt-1)})(Oe,Oe.l_desc.max_code+1,Oe.d_desc.max_code+1,Ze+1),qe(Oe,Oe.dyn_ltree,Oe.dyn_dtree)),be(Oe),we&&Pe(Oe)},i._tr_tally=function(Oe,ue,_e){return Oe.pending_buf[Oe.d_buf+2*Oe.last_lit]=ue>>>8&255,Oe.pending_buf[Oe.d_buf+2*Oe.last_lit+1]=255&ue,Oe.pending_buf[Oe.l_buf+Oe.last_lit]=255&_e,Oe.last_lit++,ue===0?Oe.dyn_ltree[2*_e]++:(Oe.matches++,ue--,Oe.dyn_ltree[2*(M[_e]+h+1)]++,Oe.dyn_dtree[2*K(ue)]++),Oe.last_lit===Oe.lit_bufsize-1},i._tr_align=function(Oe){ie(Oe,2,3),ae(Oe,y,z),(function(ue){ue.bi_valid===16?(ne(ue,ue.bi_buf),ue.bi_buf=0,ue.bi_valid=0):8<=ue.bi_valid&&(ue.pending_buf[ue.pending++]=255&ue.bi_buf,ue.bi_buf>>=8,ue.bi_valid-=8)})(Oe)}},{"../utils/common":41}],53:[function(t,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,h,f=1,d={},p=!1,_=o.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(o);g=g&&g.setTimeout?g:o,c={}.toString.call(o.process)==="[object process]"?function(x){oc.nextTick(function(){b(x)})}:(function(){if(o.postMessage&&!o.importScripts){var x=!0,T=o.onmessage;return o.onmessage=function(){x=!1},o.postMessage("","*"),o.onmessage=T,x}})()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",y,!1):o.attachEvent("onmessage",y),function(x){o.postMessage(h+x,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(x){b(x.data)},function(x){u.port2.postMessage(x)}):_&&"onreadystatechange"in _.createElement("script")?(l=_.documentElement,function(x){var T=_.createElement("script");T.onreadystatechange=function(){b(x),T.onreadystatechange=null,l.removeChild(T),T=null},l.appendChild(T)}):function(x){setTimeout(b,0,x)},g.setImmediate=function(x){typeof x!="function"&&(x=new Function(""+x));for(var T=new Array(arguments.length-1),k=0;k<T.length;k++)T[k]=arguments[k+1];var R={callback:x,args:T};return d[f]=R,c(f),f++},g.clearImmediate=m}function m(x){delete d[x]}function b(x){if(p)setTimeout(b,0,x);else{var T=d[x];if(T){p=!0;try{(function(k){var R=k.callback,P=k.args;switch(P.length){case 0:R();break;case 1:R(P[0]);break;case 2:R(P[0],P[1]);break;case 3:R(P[0],P[1],P[2]);break;default:R.apply(a,P)}})(T)}finally{m(x),p=!1}}}}function y(x){x.source===o&&typeof x.data=="string"&&x.data.indexOf(h)===0&&b(+x.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof yd<"u"?yd:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(QN)),QN.exports}var lPe=cPe();const uPe=Dl(lPe),wQ={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/dicom":["dcm"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg","one","onea"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"application/zip+dotlottie":["lottie"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a","m4b"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/ief":["ief"],"image/jaii":["jaii"],"image/jais":["jais"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpg","jpeg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/pjpeg":["jfif"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step":["step","stp","stpnc","p21","210"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(wQ);var od=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},_E,Ew,M1;class hPe{constructor(...e){_E.set(this,new Map),Ew.set(this,new Map),M1.set(this,new Map);for(const t of e)this.define(t)}define(e,t=!1){for(let[r,i]of Object.entries(e)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),od(this,M1,"f").has(r)||od(this,M1,"f").set(r,new Set);const s=od(this,M1,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s?.add(a),o&&od(this,Ew,"f").set(r,a),o=!1,c)continue;const l=od(this,_E,"f").get(a);if(l&&l!=r&&!t)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);od(this,_E,"f").set(a,r)}}return this}getType(e){if(typeof e!="string")return null;const t=e.replace(/^.*[/\\]/s,"").toLowerCase(),r=t.replace(/^.*\./s,"").toLowerCase(),i=t.length<e.length;return!(r.length<t.length-1)&&i?null:od(this,_E,"f").get(r)??null}getExtension(e){return typeof e!="string"?null:(e=e?.split?.(";")[0],(e&&od(this,Ew,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:od(this,M1,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of od(this,M1,"f").values())Object.freeze(e);return this}_getTestState(){return{types:od(this,_E,"f"),extensions:od(this,Ew,"f")}}}_E=new WeakMap,Ew=new WeakMap,M1=new WeakMap;new hPe(wQ)._freeze();var U2={},Wz;function fPe(){if(Wz)return U2;Wz=1,Object.defineProperty(U2,"__esModule",{value:!0});function n(a){return typeof a=="string"?a.startsWith("#")?"hex":null:"r"in a&&"g"in a&&"b"in a?"rgb":"h"in a&&"s"in a&&"l"in a?"hsl":"h"in a&&"s"in a&&"v"in a?"hsv":null}function e(a){const c=a.replace("#",""),l=parseInt(c.substring(0,2),16),u=parseInt(c.substring(2,4),16),h=parseInt(c.substring(4,6),16);return{r:l,g:u,b:h}}function t(a){const{r:c,g:l,b:u}=a;return`#${(c<<16|l<<8|u).toString(16).padStart(6,"0")}`}function r(a,c,l){c/=100,l/=100;const u=d=>(d+a/30)%12,h=c*Math.min(l,1-l),f=d=>l-h*Math.max(-1,Math.min(u(d)-3,Math.min(9-u(d),1)));return{r:Math.round(f(0)*255),g:Math.round(f(8)*255),b:Math.round(f(4)*255)}}function i(a,c,l){c/=100,l/=100;const u=f=>(f+a/60)%6,h=f=>l-l*c*Math.max(0,Math.min(u(f),4-u(f),1));return{r:Math.round(h(5)*255),g:Math.round(h(3)*255),b:Math.round(h(1)*255)}}function s(a,c){const l=Math.abs(a.r-c.r),u=Math.abs(a.g-c.g),h=Math.abs(a.b-c.b),f=1-l/255,d=1-u/255,p=1-h/255;return(f+d+p)/3}function o(a){let c=Math.min(Math.max(a.similarityThreshold||.8,.01),1);const{targetColor:l,colorArray:u}=a,h=n(l);if(h===null)return null;let f;if(h==="hex")f=e(l);else if(h==="rgb")f=l;else if(h==="hsl"){const{h:_,s:g,l:m}=l;f=r(_,g,m)}else if(h==="hsv"){const{h:_,s:g,v:m}=l;f=i(_,g,m)}else return null;let d=null,p=0;for(const _ of u){n(_.hex?_.hex:_.rgb),_.hex?_.rgb||(_.rgb=e(_.hex)):_.hex=t(_.rgb);const g=Math.round(s(f,_.rgb)*100)/100;g>=c&&g>p&&(p=g,d={name:_.name,hex:_.hex,rgb:_.rgb,similarity:g})}return d}return U2.default=o,U2}fPe();function vx(n,e=16){return n?cx(e-1).map(t=>{const r=t*Kw;return new gi(n.bits[r]/63,n.bits[r+1]/63,n.bits[r+2]/63)}):[]}async function AQ(n){const e=new FormData;e.append("url",n);const t=new Request("https://bytes.zed.cafe",{method:"POST",body:e});return await(await fetch(t)).text()}function RQ(){return location.href.includes("/join/")}async function dPe(n,e){const t=new FormData;t.append("email",n),t.append("tag",e);const r=new Request("https://bbs.zed.cafe/api/login",{method:"POST",body:t});return await(await fetch(r)).json()}async function pPe(n,e){const t=new FormData;t.append("email",n),t.append("code",e);const r=new Request("https://bbs.zed.cafe/api/code",{method:"POST",body:t});return await(await fetch(r)).json()}async function mPe(n,e){const t=new FormData;t.append("email",n),t.append("code",e);const r=new Request("https://bbs.zed.cafe/api/list",{method:"POST",body:t});return await(await fetch(r)).json()}async function gPe(n,e,t,r,i){const s=new FormData;s.append("email",n),s.append("code",e),s.append("filename",t),s.append("url",r),s.append("tags",i.join(","));const o=new Request("https://bbs.zed.cafe/api/publish",{method:"POST",body:s});return await(await fetch(o)).json()}async function _Pe(n,e,t){const r=new FormData;r.append("email",n),r.append("code",e),r.append("filename",t);const i=new Request("https://bbs.zed.cafe/api/delete",{method:"POST",body:r});return await(await fetch(i)).json()}function to(n,e,t){t().catch(r=>{console.error(r),ur(n,e,"crash",r?.message)})}function B2(n){if(i0(n)!==Wr.TERRAIN&&i0(n)!==Wr.OBJECT)return"";const t={kind:Tc(n)};return Ep(t),`${CQ(t)}$ONCLEAR$BLUE `}function CQ(n){const e=zu(n),t=`${Bt[e.color]}`,r=`${Bt[e.bg>Bt.WHITE?Bt.BLACK:e.bg]}`;return`$${t}$ON${r}$${e.char}`}function vPe(n){if(!fe(n?.id))return"";let e=zu(n).name;if(n.kind==="player"){const{user:r}=Kg(n.id);e=rn(r)?r:"player"}return`${CQ(n)}$ONCLEAR$CYAN ${e}:$WHITE `}new Nn;function yx(n,e=!1){const[t,r]=It(n,0,[pt.ANY]);if(e&&Od(t)){const[i,s,o]=It(n,0,[pt.DIR,pt.NAME]);return s.startsWith(":")?{targetdir:i,label:s.substring(1).trim(),args:n.slice(o)}:{targetdir:i,label:s,args:n.slice(o)}}else{const[i,s,o]=It(n,0,[pt.NAME,pt.ANY]);return rn(s)&&s.startsWith(":")?{targetname:i,label:s.substring(1).trim(),args:n.slice(o)}:{targetname:"self",label:i,args:n.slice(r)}}}let kg="",ip="";function yPe(n){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.exec(String(n).toLowerCase())}function ec(n){return n===Wm()}function JS(){OEe(Ke,Wm())}const bPe=d_().command("shortsend",(n,e)=>{const t=yx(e);return t.targetname==="self"?Uh(Ke,de.elementfocus,void 0,"text",`cli:${t.label}`,t.args.join(" ")):Sx(n,de.element,t),0}).command("send",(n,e)=>{const t=yx(e,!0);return Sx(n,de.element,t),0}).command("stat",(n,e)=>(wEe(Ke,de.elementfocus,e.map(mo).join(" ")),0)).command("text",(n,e)=>{const t=e.map(mo).join(" ");if(fe(de.element)&&de.elementisplayer){de.element.tickertext=t,de.element.tickertime=de.timestamp,sU("",de.element,t);const{user:r}=Kg(de.elementid),i=rn(r)?r:"player";Uh(Ke,de.elementid,void 0,"text",`chat:message:${de.board?.id??""}`,`${i}:${t}`)}return 0}).command("hyperlink",(n,e)=>{const[t,...r]=e,{user:i}=Kg(de.elementid),s=rn(i)?i:"player",o=zu(de.element),a=`$${Bt[o.color]}$ON${Bt[o.bg]}$${o.char}$ONCLEAR $WHITE${s}$BLUE `,c=n.template(mo(t).split(" "));return Qi(Ke,de.elementid,`!${n.template(r)};${a}${c}`),0}).command("bookrename",()=>{if(!ec(de.elementfocus))return 0;const n=Ov(xc.MAIN);return fxe(n),fe(n)&&Rh(Ke,de.elementfocus,"main",`${n?.name??"empty"} $GREEN${n?.id??""}`),0}).command("booktrash",(n,e)=>{if(!ec(de.elementfocus))return 0;const[t]=It(e,0,[pt.NAME]),r=zm(xc.MAIN),i=kv(t);return fe(i)&&(r===i&&DZ(xc.MAIN,""),Exe(t),Qi(Ke,de.elementfocus,`trashed [book] ${i.name}`),JS(),n.command("pages")),0}).command("boardopen",(n,e)=>{const[t]=It(e,0,[pt.NAME]),r=vs(t);return fe(r)&&ME(de.book,de.elementfocus,r.id,{x:Nu(0,dn-1),y:Nu(0,_r-1)}),0}).command("pageopen",(n,e)=>{const[t,r]=It(e,0,[pt.NAME,pt.MAYBE_NAME]);let i,s;const o=Pm();for(let a=0;a<o.length&&(s=o[a],i=aA(s,t),!fe(i));++a);if(fe(i)&&fe(s)){const a=Tc(i),c=[i.id,r];cQ(PY(s.id,c),i.code);const l=h1(i),u=`${B2(i)}$ONCLEAR$GREEN ${a} - ${s.name}`;pEe(Ke,de.elementfocus,s.id,c,l,u)}else ur(Ke,"pageopen",`page ${t} not found`,de.elementfocus);return 0}).command("pagetrash",(n,e)=>{if(!ec(de.elementfocus))return 0;const[t]=It(e,0,[pt.NAME]),r=Ov(xc.MAIN),i=IZ(r,t);if(fe(t)){const s=Tc(i),o=h1(i);Qi(Ke,de.elementfocus,`trashed [${o}] ${s}`),JS(),n.command("pages")}return 0}).command("help",()=>(n6(Ke,de.elementfocus),0)).command("books",()=>{if(!ec(de.elementfocus))return 0;C1(Ke,de.elementfocus,"books");const n=zm(xc.MAIN);Rh(Ke,de.elementfocus,"main",`${n?.name??"empty"} $GREEN${n?.id??""}`);const e=zm(xc.MAIN);Rh(Ke,de.elementfocus,"content",`${e?.name??"empty"} ${e?.id??""}`),nU(Ke,de.elementfocus,7);const t=Pm();return t.length?t.forEach(r=>{Nr(Ke,de.elementfocus,`!bookopen ${r.id};${r.name}`)}):Js(Ke,de.elementfocus,"no books found"),Nr(Ke,de.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const n=Ov(xc.MAIN);if(!fe(n))return 0;C1(Ke,de.elementfocus,"pages"),Rh(Ke,de.elementfocus,"main",`${n.name} $GREEN${n.id}`),n.pages.length?zT(n).forEach(r=>{const i=Tc(r),s=h1(r),o=B2(r);Nr(Ke,de.elementfocus,`!pageopen ${r.id};$blue[${s}] ${o}$white${i}`)}):(Nr(Ke,de.elementfocus,""),TQ(xQ("help:nopages"),t=>oPe(de.elementfocus,t)));const e=Pm();for(let t=0;t<e.length;++t){const r=e[t];r.id!==n.id&&(Rh(Ke,de.elementfocus,"content",`${r.name} $GREEN${r.id}`),zT(r).forEach(s=>{const o=Tc(s),a=h1(s);Nr(Ke,de.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{C1(Ke,de.elementfocus,"boards");const n=Ov(xc.MAIN);if(fe(n)){Rh(Ke,de.elementfocus,"main",`${n.name} $GREEN${n.id}`);const t=zT(n);t.filter(r=>i0(r)===Wr.BOARD).forEach(r=>{const i=Tc(r);Nr(Ke,de.elementfocus,`!boardopen ${r.id};$blue[#goto]$white ${i}`)}),t.length===0&&(Nr(Ke,de.elementfocus,""),Js(Ke,de.elementfocus,"$white no boards found"),Js(Ke,de.elementfocus,"$white use @ to create a board"),Js(Ke,de.elementfocus,"$white @board name of board"))}const e=Pm();for(let t=0;t<e.length;++t){const r=e[t];r.id!==n.id&&(Rh(Ke,de.elementfocus,"content",`${r.name} $GREEN${r.id}`),zT(r).filter(s=>i0(s)===Wr.BOARD).forEach(s=>{const o=Tc(s);Nr(Ke,de.elementfocus,`!boardopen ${s.id};$blue[#goto]$white ${o}`)}))}return 0}).command("trash",()=>{if(!ec(de.elementfocus))return 0;C1(Ke,de.elementfocus,"$REDTRASH"),Js(Ke,de.elementfocus,"books");const n=Pm();n.length&&(n.forEach(t=>{Nr(Ke,de.elementfocus,`!booktrash ${t.id};$REDTRASH ${t.name}`)}),Nr(Ke,de.elementfocus,""));const e=zm(xc.MAIN);return fe(e)&&(Js(Ke,de.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(t=>{const r=Tc(t),i=h1(t),s=B2(t);Nr(Ke,de.elementfocus,`!pagetrash ${t.id};$REDTRASH [${i}] ${s}${r}`)}),Nr(Ke,de.elementfocus,"")),0}).command("dev",()=>(ec(de.elementfocus)&&(JS(),bEe(Ke,de.elementfocus)),0)).command("share",()=>(ec(de.elementfocus)&&(JS(),KSe(Ke,de.elementfocus)),0)).command("save",()=>(ec(de.elementfocus)&&JS(),0)).command("fork",(n,e)=>{if(ec(de.elementfocus)){const[t]=It(e,0,[pt.MAYBE_NAME]);IEe(Ke,de.elementfocus,t??"")}return 0}).command("nuke",()=>(ec(de.elementfocus)&&XSe(Ke,de.elementfocus),0)).command("endgame",()=>(OY(Ke,de.elementfocus,!1),0)).command("restart",()=>(ec(de.elementfocus)&&(kEe(Ke,de.elementfocus),JS()),0)).command("export",()=>{if(!ec(de.elementfocus))return 0;Wv(Ke,de.elementfocus,"E X P O R T"),C1(Ke,de.elementfocus,"books");const n=Pm();return n.length&&n.forEach(e=>Nr(Ke,de.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(n,e)=>{if(!ec(de.elementfocus))return 0;const[t]=It(e,0,[pt.NAME]),r=kv(t);return fe(r)&&(Wv(Ke,de.elementfocus,"E X P O R T"),C1(Ke,de.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=zT(r);Nr(Ke,de.elementfocus,`!bookallexport ${t};$blue[all] $whiteexport book`),i.forEach(s=>{const o=Tc(s),a=h1(s),c=B2(s);Nr(Ke,de.elementfocus,`!pageexport ${t}:${s.id};$blue[${a}] ${c}$white${o}`)})}},1e3)),0}).command("bookallexport",(n,e)=>{if(!ec(de.elementfocus))return 0;const[t]=It(e,0,[pt.NAME]),r=kv(t);return fe(r)&&P9(Ke,de.elementfocus,Us(r),`${r.name}.book.json`),0}).command("pageexport",(n,e)=>{if(!ec(de.elementfocus))return 0;const[t]=It(e,0,[pt.NAME]),{target:r,path:i}=Vv(t),s=kv(r),o=aA(s,i);return fe(o)&&P9(Ke,de.elementfocus,Us(o),`${Tc(o)}.${h1(o)}.json`),0}).command("itchiopublish",()=>{if(!ec(de.elementfocus))return 0;const n=zm(xc.MAIN);return L9(Ke,de.elementfocus,"itchio",n?.name??""),0}).command("gadget",()=>(dEe(Ke,de.elementfocus,void 0),0)).command("findany",(n,e)=>{const[t]=It(e,0,[pt.ANY]);if(Xn(t)){const r=t.filter(Dv);D9(Ke,de.elementfocus,r)}else D9(Ke,de.elementfocus,[]);return 0}).command("zztsearch",(n,e)=>{const[t,r]=It(e,0,[pt.NAME,pt.MAYBE_NAME]),i=fe(r)?t:"title",s=fe(r)?r:t;return vEe(Ke,de.elementfocus,i,s),0}).command("zztrandom",()=>(yEe(Ke,de.elementfocus),0)).command("admin",()=>(_Ee(Ke,de.elementfocus),0)).command("joincode",(n,e)=>{if(!ec(de.elementfocus))return 0;const[t]=It(e,0,[pt.MAYBE_NAME]),r=iJ(de.elementfocus);return fe(r)?zSe(Ke,de.elementfocus,!!t):ur(Ke,de.elementfocus,"multiplayer","need to have an active player on a board in order to start multiplayer"),0}).command("jointab",(n,e)=>{if(!ec(de.elementfocus))return 0;const[t]=It(e,0,[pt.MAYBE_NAME]);return HSe(Ke,de.elementfocus,!!t),0}).command("chat",(n,e)=>{if(!ec(de.elementfocus))return 0;const[t]=It(e,0,[pt.MAYBE_NAME]);return t?USe(Ke,de.elementfocus,t):BSe(Ke,de.elementfocus),0}).command("broadcast",(n,e)=>{if(!ec(de.elementfocus))return 0;const[t]=It(e,0,[pt.MAYBE_NAME]);return t?DSe(Ke,de.elementfocus,t):LSe(Ke,de.elementfocus),0}).command("bbs",(n,e)=>{const[t,r]=It(e,0,[pt.ANY]);switch(Jn(t)){default:if(ip)kg?Js(Ke,de.elementfocus,"you are already logged in, use #bbs restart to login again"):to(Ke,de.elementfocus,async()=>{Js(Ke,de.elementfocus,`confirming login with $green${t}`),(await pPe(ip,t)).success&&(kg=`${t}`,Js(Ke,de.elementfocus,`$green${ip} has been logged in`))});else{const[i,s]=It(e,0,[pt.NAME,pt.NAME]);yPe(i)&&s?to(Ke,de.elementfocus,async()=>{Js(Ke,de.elementfocus,`starting login with $green${i} ${s}`),(await dPe(i,s)).success&&(ip=i,Js(Ke,de.elementfocus,"check your email for #bbs <code>"))}):Js(Ke,de.elementfocus,"please login with $green#bbs <email> <tag>")}break;case"restart":ip="",kg="",Js(Ke,de.elementfocus,"bbs restarted"),Js(Ke,de.elementfocus,"please login with $green#bbs <email> <tag>");break;case"list":!ip||!kg?Js(Ke,de.elementfocus,"please login with $green#bbs <email> <tag>$blue first"):to(Ke,de.elementfocus,async()=>{Js(Ke,de.elementfocus,"listing files");const i=await mPe(ip,kg);if(i.success)for(let s=0;s<i.list.length;++s){const{metadata:o}=i.list[s];XNe(Ke,de.elementfocus,o.url,o.filename),Js(Ke,de.elementfocus,o.tags)}});break;case"pub":case"publish":if(!ip||!kg)Js(Ke,de.elementfocus,"please login with $green#bbs <email> <tag>$blue first");else{const[i,s]=It(e,r,[pt.NAME]),o=[];for(let a=s;a<e.length;){const[c,l]=It(e,a,[pt.NAME]);a=l,o.push(c)}L9(Ke,de.elementfocus,"bbs",ip,kg,i,...o)}break;case"del":case"delete":if(!ip||!kg)Js(Ke,de.elementfocus,"please login with $green#bbs <email> <tag>$blue first");else{const[i]=It(e,r,[pt.NAME]);to(Ke,de.elementfocus,async()=>{Js(Ke,de.elementfocus,`deleting ${i}`),(await _Pe(ip,kg,i)).success&&Js(Ke,de.elementfocus,`$red${i} has been deleted`)})}break}return 0}),SPe=d_().command("toast",(n,e)=>{const t=e.map(mo).join("");return wY(Ke,de.elementfocus,t),0}).command("ticker",(n,e)=>{const t=e.map(mo).join("");return fe(de.element)&&(de.element.tickertext=t,de.element.tickertime=de.timestamp,sU(de.board?.id,de.element,t)),0}),EPe=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),qz=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10","cycle","stepx","stepy","shootx","shooty","light","lightdir","arg"]),xPe=["NORTH","SOUTH","WEST","EAST"];function TPe(n,e,t){const r=Kg(n);if(Xt(r.inputcurrent)||(r.inputcurrent=0),Xn(r.inputqueue)||(r.inputqueue=[]),r.inputcurrent>0)return r;const[i]=r.inputqueue,[s=wt.NONE,o=0]=i??[wt.NONE,0];switch(r.inputmove=[],r.inputok=0,r.inputcancel=0,r.inputmenu=0,r.inputalt=o&v5?1:0,r.inputctrl=o&y5?1:0,r.inputshift=o&b5?1:0,s){case wt.MOVE_UP:case wt.MOVE_DOWN:case wt.MOVE_LEFT:case wt.MOVE_RIGHT:{const a=xPe[s-wt.MOVE_UP];if(rn(e)&&e==="fpv"&&Xt(t))switch(Math.round(t/90)){default:case 0:r.inputmove=[a];break;case 1:switch(a){default:case"NORTH":r.inputmove=["EAST"];break;case"EAST":r.inputmove=["SOUTH"];break;case"SOUTH":r.inputmove=["WEST"];break;case"WEST":r.inputmove=["NORTH"];break}break;case 2:switch(a){default:case"NORTH":r.inputmove=["SOUTH"];break;case"EAST":r.inputmove=["WEST"];break;case"SOUTH":r.inputmove=["NORTH"];break;case"WEST":r.inputmove=["EAST"];break}break;case 3:switch(a){default:case"NORTH":r.inputmove=["WEST"];break;case"EAST":r.inputmove=["NORTH"];break;case"SOUTH":r.inputmove=["EAST"];break;case"WEST":r.inputmove=["SOUTH"];break}break}else r.inputmove=[a];break}case wt.OK_BUTTON:r.inputok=1;break;case wt.CANCEL_BUTTON:r.inputcancel=1;break;case wt.MENU_BUTTON:r.inputmenu=1;break}return r.inputcurrent=s,r.inputqueue=r.inputqueue.filter(a=>{const[c]=a;return c!==wt.NONE&&c!==s}),r}function wPe(n){const e=aJ[n];if(fe(e))return e;const t=sJ[n];if(fe(t))return t;const r=CO[n];if(fe(r))return r;const i=FY[n];if(fe(i))return i}const APe=d_({get(n,e){const t=wPe(e);if(fe(t))return[!0,t];if(de.elementisplayer&&EPe.has(e)){const c=n.get("graphics"),l=n.get("facing"),u=TPe(de.elementid,c,l)[e];return[fe(u),u]}const r=Nw(de.board,{x:de.element?.x??-1,y:de.element?.y??-1},de.elementfocus),i=r?.id??de.elementfocus??Wm(),s=de.element?.sender,o=DQ(de.board,rn(s)?s:"");switch(e){case"camera":case"graphics":case"facing":{const c=Kg(i)[e];return[!0,fe(c)?c:de.board?.[e]??0]}case"isdark":return[!0,de.board?.isdark?1:0];case"startx":return[!0,de.board?.startx??0];case"starty":return[!0,de.board?.starty??0];case"over":return[!0,de.board?.over??""];case"under":return[!0,de.board?.under??""];case"palette":return[!0,de.board?.palette??""];case"charset":return[!0,de.board?.charset??""];case"exitnorth":return[!0,de.board?.exitnorth??""];case"exitsouth":return[!0,de.board?.exitsouth??""];case"exitwest":return[!0,de.board?.exitwest??""];case"exiteast":return[!0,de.board?.exiteast??""];case"timelimit":return[!0,de.board?.timelimit??0];case"restartonzap":return[!0,de.board?.restartonzap??0];case"maxplayershots":return[!0,de.board?.maxplayershots??0];case"b1":return[!0,de.board?.b1??0];case"b2":return[!0,de.board?.b2??0];case"b3":return[!0,de.board?.b3??0];case"b4":return[!0,de.board?.b4??0];case"b5":return[!0,de.board?.b5??0];case"b6":return[!0,de.board?.b6??0];case"b7":return[!0,de.board?.b7??0];case"b8":return[!0,de.board?.b8??0];case"b9":return[!0,de.board?.b9??0];case"b10":return[!0,de.board?.b10??0];case"currenttick":return[!0,de.timestamp];case"boardid":return[!0,de.board?.id??""];case"playerid":return[!0,i];case"playerx":return[!0,r?.x??-1];case"playery":return[!0,r?.y??-1];case"thisid":return[!0,de.element?.id??""];case"thisx":return[!0,de.element?.x??-1];case"thisy":return[!0,de.element?.y??-1];case"senderid":return[!0,o?.id??""];case"senderx":return[!0,o?.x??-1];case"sendery":return[!0,o?.y??-1];default:{if(qz.has(e))return[!0,Zr(de.element,e)??0];break}}const a=Kg(i)[e];return[fe(a),a]},set(n,e,t){const r={x:de.element?.x??-1,y:de.element?.y??-1},s=Nw(de.board,r,de.elementfocus)?.id??de.elementfocus;switch(e){case"camera":case"graphics":break;case"facing":t=tW.euclideanModulo(t,360);break;case"isdark":if(fe(de.board))return de.board.isdark=t?1:0,[!0,de.board.isdark];break;case"startx":if(fe(de.board))return de.board.startx=j1(t,0),[!0,de.board.startx];break;case"starty":if(fe(de.board))return de.board.starty=j1(t,0),[!0,de.board.starty];break;case"over":if(fe(de.board)){const a=mo(t);return de.board.over!==a&&(de.board.overboard=void 0),de.board.over=a,[!0,a]}break;case"under":if(fe(de.board)){const a=mo(t);return de.board.under!==a&&(de.board.underboard=void 0),de.board.under=a,[!0,a]}break;case"palette":if(fe(de.board)){const a=mo(t);return de.board.palette!==a&&(de.board.palettepage=void 0),de.board.palette=a,[!0,a]}break;case"charset":if(fe(de.board)){const a=mo(t);return de.board.charset!==a&&(de.board.charsetpage=void 0),de.board.charset=a,[!0,a]}break;case"exitnorth":if(fe(de.board))return[!0,de.board.exitnorth=mo(t)];break;case"exitsouth":if(fe(de.board))return[!0,de.board.exitsouth=mo(t)];break;case"exitwest":if(fe(de.board))return[!0,de.board.exitwest=mo(t)];break;case"exiteast":if(fe(de.board))return[!0,de.board.exiteast=mo(t)];break;case"timelimit":if(fe(de.board))return[!0,de.board.timelimit=j1(t,0)];break;case"restartonzap":if(fe(de.board))return[!0,de.board.restartonzap=t?1:0];break;case"maxplayershots":if(fe(de.board))return[!0,de.board.maxplayershots=j1(t,0)];break;case"b1":if(fe(de.board))return[!0,de.board.b1=t];break;case"b2":if(fe(de.board))return[!0,de.board.b2=t];break;case"b3":if(fe(de.board))return[!0,de.board.b3=t];break;case"b4":if(fe(de.board))return[!0,de.board.b4=t];break;case"b5":if(fe(de.board))return[!0,de.board.b5=t];break;case"b6":if(fe(de.board))return[!0,de.board.b6=t];break;case"b7":if(fe(de.board))return[!0,de.board.b7=t];break;case"b8":if(fe(de.board))return[!0,de.board.b8=t];break;case"b9":if(fe(de.board))return[!0,de.board.b9=t];break;case"b10":if(fe(de.board))return[!0,de.board.b10=t];break;case"currenttick":case"boardid":return[!0,t];case"playerid":case"playerx":case"playery":return[!0,t];case"thisid":case"thisx":case"thisy":return[!0,t];case"senderid":return fe(de.element)&&(de.element.sender=t),[!0,t];case"senderx":case"sendery":return[!0,t];default:{if(qz.has(e)){if(fe(de.element))switch(e){case"color":if(Mc(t)){const{color:a,bg:c}=kE(t);fe(a)&&(de.element.color=a),fe(c)&&(de.element.bg=c)}else Xt(t)&&(de.element.color=t);break;case"bg":if(Mc(t)){const{color:a,bg:c}=kE(t);de.element.bg=a??c??Bt.PURPLE}else Xt(t)&&(de.element.bg=t);break;case"displaycolor":if(Mc(t)){const{color:a,bg:c}=kE(t);fe(a)&&(de.element.displaycolor=a),fe(c)&&(de.element.displaybg=c)}else Xt(t)&&(de.element.displaycolor=t);break;case"displaybg":{if(Mc(t)){const{color:a,bg:c}=kE(t);de.element.displaybg=a??c??Bt.PURPLE}else Xt(t)&&(de.element.displaybg=t);break}default:de.element[e]=t;break}return[!0,t]}break}}const o=Kg(s);if(fe(o)){switch(o[e]=t,e){case"user":fEe(Ke,s,e,t);break}return[!0,t]}return[!1,t]},everytick(n){if(de.elementisplayer){const e=n.get("health");Xt(e)&&e<=0&&(n.endofprogram(),OY(Ke,de.elementid,!0))}!de.element?.removed&&fe(de.element?.x)&&fe(de.element.y)&&fe(de.element.stepx)&&fe(de.element.stepy)&&(de.element.stepx||de.element.stepy)&&xf(de.book,de.board,de.element,{x:de.element.x+de.element.stepx,y:de.element.y+de.element.stepy})}}).command("clear",(n,e)=>{for(let t=0;t<e.length;++t)n.set(mo(e[t]),0);return 0}).command("set",(n,e)=>{const[t,r]=It(e,0,[pt.NAME,pt.ANY]);return n.set(t,r??1),0}).command("become",(n,e)=>{const[t]=It(e,0,[pt.KIND]),r=zu(de.element),[i,s]=t,o=[...MO(r.color,r.bg),...s??[]],a=[i,o];if(C6(de.board,de.element),Ad(de.board,de.element,de.timestamp)){const c={x:de.element?.x??0,y:de.element?.y??0};wd(de.board,a,c)}return n.endofprogram(),0}).command("bind",(n,e)=>{const[t]=It(e,0,[pt.NAME]),r=$x(de.board,t);return fe(de.element)&&r.length>0&&(de.element.code=md(...r).code??"",HN(de.elementid)),0}).command("char",(n,e)=>{const[t]=It(e,0,[pt.ANY]);if(Od(t)){const[r,i]=It(e,0,[pt.DIR,pt.NUMBER]);if(r.targets.length){for(let o=0;o<r.targets.length;++o){const a=r.targets[o],c=ts(de.board,a);fe(c)&&(c.char=i)}return 0}const s=ts(de.board,r.destpt);fe(s)&&(s.char=i)}else fe(de.element)&&Xt(t)&&(de.element.char=t);return 0}).command("color",(n,e)=>{const[t]=It(e,0,[pt.ANY]);if(Od(t)){const[r,i]=It(e,0,[pt.DIR,pt.COLOR]);if(r.targets.length){for(let o=0;o<r.targets.length;++o){const a=r.targets[o],c=ts(de.board,a);fe(c)&&W1(c,i??Bt.PURPLE)}return 0}const s=ts(de.board,r.destpt);fe(s)&&W1(s,i??Bt.PURPLE)}else{const[r]=It(e,0,[pt.COLOR]);fe(de.element)&&fe(r)&&W1(de.element,r)}return 0}).command("go",(n,e)=>{if(fe(de.element)){const[t]=It(e,0,[pt.DIR]);if(xf(de.book,de.board,de.element,t.destpt),n.yield(),de.element.x===t.destpt.x&&de.element.y===t.destpt.y)return 0}return 1}).command("walk",(n,e)=>{if(!fe(de.element))return 0;const[t]=It(e,0,[pt.DIR]),r=de.element.x??0,i=de.element.y??0;return de.element.stepx=t.destpt.x-r,de.element.stepy=t.destpt.y-i,0}).command("idle",n=>(n.yield(),0)).command("end",(n,e)=>{const[t]=It(e,0,[pt.ANY]);return fe(t)&&n.set("arg",t),n.endofprogram(),0}).command("lock",n=>(n.lock(n.id()),0)).command("restore",(n,e)=>(n.restore(mo(e[0])),0)).command("unlock",n=>(n.unlock(),0)).command("zap",(n,e)=>(n.zap(mo(e[0])),0)).command("cycle",(n,e)=>{if(fe(de.element)){const[t]=It(e,0,[pt.NUMBER]);de.element.cycle=Ri(Math.round(t),1,255)}return 0}).command("die",n=>{if(Ad(de.board,de.element,de.timestamp),Zr(de.element,"item")){const e={x:de.element?.x??-1,y:de.element?.y??-1},t=Nw(de.board,e,de.elementfocus);fe(t?.x)&&fe(t.y)&&Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<2&&(t.x=e.x,t.y=e.y)}else n.endofprogram();return 0}).command("run",(n,e)=>{const[t]=It(e,0,[pt.NAME]);return zM(t),0}).command("runwith",(n,e)=>{const[t,r]=It(e,0,[pt.ANY,pt.NAME]);return n.set("arg",t),zM(r),0}).command("array",(n,e)=>{const t=[],[r,i]=It(e,0,[pt.NAME]);for(let s=i;s<e.length;){const[o,a]=It(e,s,[pt.ANY]);t.push(o),s=a}return n.set(r,t),0}).command("read",(n,e)=>{const[t,r,i]=It(e,0,[pt.ANY,pt.NUMBER_OR_STRING,pt.NAME]);if(fe(t)){const s=t[r];n.set(i,s)}return 0}).command("load",(n,e)=>{const[t,r,i]=It(e,0,[pt.DIR,pt.NAME]),s=ts(de.board,t.destpt);if(fe(s)&&_s(s))switch(Jn(r)){case"append":{const[o]=It(e,i,[pt.NAME]),a=Lu(Wr.OBJECT,o);fe(a)&&(s.code+=a.code,HN(s.id??""));break}default:{const o=Lu(Wr.OBJECT,r);fe(o)&&(s.code=o.code,HN(s.id??""));break}}return 0});function Yz(n,e){if(!fe(n))return;const t=Jn(e),r=t.endsWith("le");switch(t){case"float32":case"float32le":{const i=n.dataview.getFloat32(n.cursor,r);return n.cursor+=4,i}case"float64":case"float64le":{const i=n.dataview.getFloat64(n.cursor,r);return n.cursor+=8,i}case"int8":case"int8le":{const i=n.dataview.getInt8(n.cursor);return n.cursor+=1,i}case"int16":case"int16le":{const i=n.dataview.getInt16(n.cursor,r);return n.cursor+=2,i}case"int32":case"int32le":{const i=n.dataview.getInt32(n.cursor,r);return n.cursor+=4,i}case"int64":case"int64le":{const i=n.dataview.getBigInt64(n.cursor,r);return n.cursor+=8,i}case"uint8":case"uint8le":{const i=n.dataview.getUint8(n.cursor);return n.cursor+=1,i}case"uint16":case"uint16le":{const i=n.dataview.getUint16(n.cursor,r);return n.cursor+=2,i}case"uint32":case"uint32le":{const i=n.dataview.getUint32(n.cursor,r);return n.cursor+=4,i}case"uint64":case"uint64le":{const i=n.dataview.getBigUint64(n.cursor,r);return n.cursor+=8,i}}}const RPe=(n,e)=>{const t=HE(n.id());if(!fe(t))return 0;const[r,i]=It(e,0,[pt.NAME]),s=Jn(r);switch(s){case"seek":{const[o]=It(e,i,[pt.NUMBER]);t.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=It(e,i,[pt.NAME]);n.set(o,Yz(t,s));break}case"text":{const[o,a]=It(e,i,[pt.NAME,pt.NAME]),c=Yz(t,o);if(Xt(c)&&rn(a)){const l=new Uint8Array(t.bytes.buffer,t.cursor,c),h=new TextDecoder("utf-8").decode(l);n.set(a,h),t.cursor+=c}break}}return 0},bx=n=>n!==null&&Object.prototype.toString.call(n)==="[object Object]",JM=(n,e)=>{if(n===e)return!0;if(typeof n!=typeof e)return!1;if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t+=1)if(!JM(n[t],e[t]))return!1;return!0}if(bx(n)&&bx(e)){const t=Object.entries(n),r=new Set(Object.keys(e));if(t.length!==r.size)return!1;for(const[i,s]of t){if(!JM(s,e[i]))return!1;r.delete(i)}return r.size===0}return!1},F2=n=>{if(n===""||n===!1||n===null||n===void 0||Array.isArray(n)&&n.length===0)return!0;if(bx(n)){for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}return!1},CPe=n=>n>="a"&&n<="z"||n>="A"&&n<="Z"||n==="_",Kz=n=>n>="0"&&n<="9"||n==="-",MPe=n=>n>="a"&&n<="z"||n>="A"&&n<="Z"||n>="0"&&n<="9"||n==="_";var kt;(function(n){n.TOK_EOF="EOF",n.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",n.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",n.TOK_RBRACKET="Rbracket",n.TOK_RPAREN="Rparen",n.TOK_COMMA="Comma",n.TOK_COLON="Colon",n.TOK_RBRACE="Rbrace",n.TOK_NUMBER="Number",n.TOK_CURRENT="Current",n.TOK_ROOT="Root",n.TOK_EXPREF="Expref",n.TOK_PIPE="Pipe",n.TOK_OR="Or",n.TOK_AND="And",n.TOK_EQ="EQ",n.TOK_GT="GT",n.TOK_LT="LT",n.TOK_GTE="GTE",n.TOK_LTE="LTE",n.TOK_NE="NE",n.TOK_FLATTEN="Flatten",n.TOK_STAR="Star",n.TOK_FILTER="Filter",n.TOK_DOT="Dot",n.TOK_NOT="Not",n.TOK_LBRACE="Lbrace",n.TOK_LBRACKET="Lbracket",n.TOK_LPAREN="Lparen",n.TOK_LITERAL="Literal"})(kt||(kt={}));const Xz={"(":kt.TOK_LPAREN,")":kt.TOK_RPAREN,"*":kt.TOK_STAR,",":kt.TOK_COMMA,".":kt.TOK_DOT,":":kt.TOK_COLON,"@":kt.TOK_CURRENT,$:kt.TOK_ROOT,"]":kt.TOK_RBRACKET,"{":kt.TOK_LBRACE,"}":kt.TOK_RBRACE},kPe={"!":!0,"<":!0,"=":!0,">":!0},OPe={"	":!0,"\n":!0,"\r":!0," ":!0};class IPe{constructor(){this._current=0}tokenize(e){const t=[];this._current=0;let r,i,s;for(;this._current<e.length;)if(CPe(e[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(e),t.push({start:r,type:kt.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Xz[e[this._current]]!==void 0)t.push({start:this._current,type:Xz[e[this._current]],value:e[this._current]}),this._current+=1;else if(Kz(e[this._current]))s=this.consumeNumber(e),t.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),t.push(s);else if(e[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(e),t.push({start:r,type:kt.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(e),t.push({start:r,type:kt.TOK_LITERAL,value:i});else if(e[this._current]==="`"){r=this._current;const o=this.consumeLiteral(e);t.push({start:r,type:kt.TOK_LITERAL,value:o})}else if(kPe[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&t.push(s);else if(OPe[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")r=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,t.push({start:r,type:kt.TOK_AND,value:"&&"})):t.push({start:r,type:kt.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")r=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,t.push({start:r,type:kt.TOK_OR,value:"||"})):t.push({start:r,type:kt.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return t}consumeUnquotedIdentifier(e){const t=this._current;for(this._current+=1;this._current<e.length&&MPe(e[this._current]);)this._current+=1;return e.slice(t,this._current)}consumeQuotedIdentifier(e){const t=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=='"'&&this._current<r;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(t,this._current))}consumeRawStringLiteral(e){const t=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=="'"&&this._current<r;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(t+1,this._current-1).replace("\\'","'")}consumeNumber(e){const t=this._current;this._current+=1;const r=e.length;for(;Kz(e[this._current])&&this._current<r;)this._current+=1;const i=parseInt(e.slice(t,this._current),10);return{start:t,value:i,type:kt.TOK_NUMBER}}consumeLBracket(e){const t=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:t,type:kt.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:t,type:kt.TOK_FLATTEN,value:"[]"}):{start:t,type:kt.TOK_LBRACKET,value:"["}}consumeOperator(e){const t=this._current,r=e[t];if(this._current+=1,r==="!")return e[this._current]==="="?(this._current+=1,{start:t,type:kt.TOK_NE,value:"!="}):{start:t,type:kt.TOK_NOT,value:"!"};if(r==="<")return e[this._current]==="="?(this._current+=1,{start:t,type:kt.TOK_LTE,value:"<="}):{start:t,type:kt.TOK_LT,value:"<"};if(r===">")return e[this._current]==="="?(this._current+=1,{start:t,type:kt.TOK_GTE,value:">="}):{start:t,type:kt.TOK_GT,value:">"};if(r==="="&&e[this._current]==="=")return this._current+=1,{start:t,type:kt.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const t=this._current,r=e.length;for(;e[this._current]!=="`"&&this._current<r;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(t,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const r=["true","false","null"],i="-0123456789";if(e==="")return!1;if('[{"'.includes(e[0])||r.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const NPe=new IPe,tu={[kt.TOK_EOF]:0,[kt.TOK_UNQUOTEDIDENTIFIER]:0,[kt.TOK_QUOTEDIDENTIFIER]:0,[kt.TOK_RBRACKET]:0,[kt.TOK_RPAREN]:0,[kt.TOK_COMMA]:0,[kt.TOK_RBRACE]:0,[kt.TOK_NUMBER]:0,[kt.TOK_CURRENT]:0,[kt.TOK_EXPREF]:0,[kt.TOK_ROOT]:0,[kt.TOK_PIPE]:1,[kt.TOK_OR]:2,[kt.TOK_AND]:3,[kt.TOK_EQ]:5,[kt.TOK_GT]:5,[kt.TOK_LT]:5,[kt.TOK_GTE]:5,[kt.TOK_LTE]:5,[kt.TOK_NE]:5,[kt.TOK_FLATTEN]:9,[kt.TOK_STAR]:20,[kt.TOK_FILTER]:21,[kt.TOK_DOT]:40,[kt.TOK_NOT]:45,[kt.TOK_LBRACE]:50,[kt.TOK_LBRACKET]:55,[kt.TOK_LPAREN]:60};class PPe{constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const t=this.expression(0);if(this.lookahead(0)!==kt.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return t}loadTokens(e){this.tokens=[...NPe.tokenize(e),{type:kt.TOK_EOF,value:"",start:e.length}]}expression(e){const t=this.lookaheadToken(0);this.advance();let r=this.nud(t),i=this.lookahead(0);for(;e<tu[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let t,r,i;switch(e.type){case kt.TOK_LITERAL:return{type:"Literal",value:e.value};case kt.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case kt.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===kt.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case kt.TOK_NOT:return r=this.expression(tu.Not),{type:"NotExpression",children:[r]};case kt.TOK_STAR:return t={type:"Identity"},r=this.lookahead(0)===kt.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(tu.Star),{type:"ValueProjection",children:[t,r]};case kt.TOK_FILTER:return this.led(e.type,{type:"Identity"});case kt.TOK_LBRACE:return this.parseMultiselectHash();case kt.TOK_FLATTEN:return t={type:kt.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(tu.Flatten),{type:"Projection",children:[t,r]};case kt.TOK_LBRACKET:return this.lookahead(0)===kt.TOK_NUMBER||this.lookahead(0)===kt.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===kt.TOK_STAR&&this.lookahead(1)===kt.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(tu.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case kt.TOK_CURRENT:return{type:kt.TOK_CURRENT};case kt.TOK_ROOT:return{type:kt.TOK_ROOT};case kt.TOK_EXPREF:return i=this.expression(tu.Expref),{type:"ExpressionReference",children:[i]};case kt.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==kt.TOK_RPAREN;)this.lookahead(0)===kt.TOK_CURRENT?(i={type:kt.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(kt.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,t){let r;switch(e){case kt.TOK_DOT:const i=tu.Dot;return this.lookahead(0)!==kt.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[t,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[t,r]});case kt.TOK_PIPE:return r=this.expression(tu.Pipe),{type:kt.TOK_PIPE,children:[t,r]};case kt.TOK_OR:return r=this.expression(tu.Or),{type:"OrExpression",children:[t,r]};case kt.TOK_AND:return r=this.expression(tu.And),{type:"AndExpression",children:[t,r]};case kt.TOK_LPAREN:const s=t.name,o=[];let a;for(;this.lookahead(0)!==kt.TOK_RPAREN;)this.lookahead(0)===kt.TOK_CURRENT?(a={type:kt.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===kt.TOK_COMMA&&this.match(kt.TOK_COMMA),o.push(a);return this.match(kt.TOK_RPAREN),{name:s,type:"Function",children:o};case kt.TOK_FILTER:const l=this.expression(0);return this.match(kt.TOK_RBRACKET),r=this.lookahead(0)===kt.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(tu.Filter),{type:"FilterProjection",children:[t,r,l]};case kt.TOK_FLATTEN:const u={type:kt.TOK_FLATTEN,children:[t]},h=this.parseProjectionRHS(tu.Flatten);return{type:"Projection",children:[u,h]};case kt.TOK_EQ:case kt.TOK_NE:case kt.TOK_GT:case kt.TOK_GTE:case kt.TOK_LT:case kt.TOK_LTE:return this.parseComparator(t,e);case kt.TOK_LBRACKET:const f=this.lookaheadToken(0);return f.type===kt.TOK_NUMBER||f.type===kt.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(t,r)):(this.match(kt.TOK_STAR),this.match(kt.TOK_RBRACKET),r=this.parseProjectionRHS(tu.Star),{type:"Projection",children:[t,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const t=this.lookaheadToken(0);this.errorToken(t,`Expected ${e}, got: ${t.type}`)}}errorToken(e,t=""){const r=new Error(t||`Invalid token (${e.type}): "${e.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===kt.TOK_COLON||this.lookahead(1)===kt.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(kt.TOK_RBRACKET),e}projectIfSlice(e,t){const r={type:"IndexExpression",children:[e,t]};return t.type==="Slice"?{children:[r,this.parseProjectionRHS(tu.Star)],type:"Projection"}:r}parseSliceExpression(){const e=[null,null,null];let t=0,r=this.lookahead(0);for(;r!==kt.TOK_RBRACKET&&t<3;){if(r===kt.TOK_COLON)t+=1,this.advance();else if(r===kt.TOK_NUMBER)e[t]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(kt.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,t){const r=this.expression(tu[t]);return{type:"Comparator",name:t,children:[e,r]}}parseDotRHS(e){const t=this.lookahead(0);if([kt.TOK_UNQUOTEDIDENTIFIER,kt.TOK_QUOTEDIDENTIFIER,kt.TOK_STAR].includes(t))return this.expression(e);if(t===kt.TOK_LBRACKET)return this.match(kt.TOK_LBRACKET),this.parseMultiselectList();if(t===kt.TOK_LBRACE)return this.match(kt.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(tu[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===kt.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===kt.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===kt.TOK_DOT)return this.match(kt.TOK_DOT),this.parseDotRHS(e);const t=this.lookaheadToken(0);this.errorToken(t,`Syntax error, unexpected token: ${t.value}(${t.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==kt.TOK_RBRACKET;){const t=this.expression(0);if(e.push(t),this.lookahead(0)===kt.TOK_COMMA&&(this.match(kt.TOK_COMMA),this.lookahead(0)===kt.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(kt.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],t=[kt.TOK_UNQUOTEDIDENTIFIER,kt.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!t.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(kt.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===kt.TOK_COMMA)this.match(kt.TOK_COMMA);else if(this.lookahead(0)===kt.TOK_RBRACE){this.match(kt.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const DPe=new PPe;var cn;(function(n){n[n.TYPE_NUMBER=0]="TYPE_NUMBER",n[n.TYPE_ANY=1]="TYPE_ANY",n[n.TYPE_STRING=2]="TYPE_STRING",n[n.TYPE_ARRAY=3]="TYPE_ARRAY",n[n.TYPE_OBJECT=4]="TYPE_OBJECT",n[n.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",n[n.TYPE_EXPREF=6]="TYPE_EXPREF",n[n.TYPE_NULL=7]="TYPE_NULL",n[n.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",n[n.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(cn||(cn={}));class LPe{constructor(e){this.TYPE_NAME_TABLE={[cn.TYPE_NUMBER]:"number",[cn.TYPE_ANY]:"any",[cn.TYPE_STRING]:"string",[cn.TYPE_ARRAY]:"array",[cn.TYPE_OBJECT]:"object",[cn.TYPE_BOOLEAN]:"boolean",[cn.TYPE_EXPREF]:"expression",[cn.TYPE_NULL]:"null",[cn.TYPE_ARRAY_NUMBER]:"Array<number>",[cn.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([t])=>Math.abs(t),this.functionAvg=([t])=>{let r=0;for(let i=0;i<t.length;i+=1)r+=t[i];return r/t.length},this.functionCeil=([t])=>Math.ceil(t),this.functionContains=t=>{const[r,i]=t;return r.includes(i)},this.functionEndsWith=t=>{const[r,i]=t;return r.includes(i,r.length-i.length)},this.functionFloor=([t])=>Math.floor(t),this.functionJoin=t=>{const[r,i]=t;return i.join(r)},this.functionKeys=([t])=>Object.keys(t),this.functionLength=([t])=>bx(t)?Object.keys(t).length:t.length,this.functionMap=t=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=t[0],o=t[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([t])=>{if(!t.length)return null;if(this.getTypeName(t[0])===cn.TYPE_NUMBER)return Math.max(...t);const i=t;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=t=>{const r=t[1],i=t[0],s=this.createKeyFunction(r,[cn.TYPE_NUMBER,cn.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=t=>{let r={};for(let i=0;i<t.length;i+=1){const s=t[i];r=Object.assign(r,s)}return r},this.functionMin=([t])=>{if(!t.length)return null;if(this.getTypeName(t[0])===cn.TYPE_NUMBER)return Math.min(...t);const i=t;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=t=>{const r=t[1],i=t[0],s=this.createKeyFunction(r,[cn.TYPE_NUMBER,cn.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=t=>{for(let r=0;r<t.length;r+=1)if(this.getTypeName(t[r])!==cn.TYPE_NULL)return t[r];return null},this.functionReverse=([t])=>{if(this.getTypeName(t)===cn.TYPE_STRING){const s=t;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=t.slice(0);return i.reverse(),i},this.functionSort=([t])=>[...t].sort(),this.functionSortBy=t=>{if(!this._interpreter)return[];const r=t[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=t[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![cn.TYPE_NUMBER,cn.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),h=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return u>h?1:u<h?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([t,r])=>t.startsWith(r),this.functionSum=([t])=>t.reduce((r,i)=>r+i,0),this.functionToArray=([t])=>this.getTypeName(t)===cn.TYPE_ARRAY?t:[t],this.functionToNumber=([t])=>{const r=this.getTypeName(t);let i;return r===cn.TYPE_NUMBER?t:r===cn.TYPE_STRING&&(i=+t,!isNaN(i))?i:null},this.functionToString=([t])=>this.getTypeName(t)===cn.TYPE_STRING?t:JSON.stringify(t),this.functionType=([t])=>{switch(this.getTypeName(t)){case cn.TYPE_NUMBER:return"number";case cn.TYPE_STRING:return"string";case cn.TYPE_ARRAY:return"array";case cn.TYPE_OBJECT:return"object";case cn.TYPE_BOOLEAN:return"boolean";case cn.TYPE_EXPREF:return"expref";case cn.TYPE_NULL:return"null";default:return}},this.functionValues=([t])=>Object.values(t),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[cn.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[cn.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[cn.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[cn.TYPE_STRING,cn.TYPE_ARRAY]},{types:[cn.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[cn.TYPE_STRING]},{types:[cn.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[cn.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[cn.TYPE_STRING]},{types:[cn.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[cn.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[cn.TYPE_STRING,cn.TYPE_ARRAY,cn.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[cn.TYPE_EXPREF]},{types:[cn.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[cn.TYPE_ARRAY_NUMBER,cn.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[cn.TYPE_ARRAY]},{types:[cn.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[cn.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[cn.TYPE_ARRAY_NUMBER,cn.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[cn.TYPE_ARRAY]},{types:[cn.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[cn.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[cn.TYPE_STRING,cn.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[cn.TYPE_ARRAY_STRING,cn.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[cn.TYPE_ARRAY]},{types:[cn.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[cn.TYPE_STRING]},{types:[cn.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[cn.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[cn.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[cn.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[cn.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[cn.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[cn.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,t,r){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:t.bind(this),_signature:r}}callFunction(e,t){const r=this.functionTable[e];if(r===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,t,r._signature),r._func.call(this,t)}validateInputSignatures(e,t){for(let r=0;r<t.length;r+=1)if("variadic"in t[r]&&r!==t.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${r+1} must occur last`)}validateArgs(e,t,r){var i,s;let o;this.validateInputSignatures(e,r);const a=r.filter(_=>{var g;return(g=!_.optional)!==null&&g!==void 0?g:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=t.length<a,u=t.length>r.length,h=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${e}() takes ${h}${a} argument${o&&"s"||""} but received ${t.length}`);let f,d,p;for(let _=0;_<r.length;_+=1){p=!1,f=r[_].types,d=this.getTypeName(t[_]);let g;for(g=0;g<f.length;g+=1)if(d!==void 0&&this.typeMatches(d,f[g],t[_])){p=!0;break}if(!p&&d!==void 0){const m=f.map(b=>this.TYPE_NAME_TABLE[b]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${_+1} to be type (${m}) but received type ${this.TYPE_NAME_TABLE[d]} instead.`)}}}typeMatches(e,t,r){if(t===cn.TYPE_ANY)return!0;if(t===cn.TYPE_ARRAY_STRING||t===cn.TYPE_ARRAY_NUMBER||t===cn.TYPE_ARRAY){if(t===cn.TYPE_ARRAY)return e===cn.TYPE_ARRAY;if(e===cn.TYPE_ARRAY){let i;t===cn.TYPE_ARRAY_NUMBER?i=cn.TYPE_NUMBER:t===cn.TYPE_ARRAY_STRING&&(i=cn.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return e===t;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return cn.TYPE_STRING;case"[object Number]":return cn.TYPE_NUMBER;case"[object Array]":return cn.TYPE_ARRAY;case"[object Boolean]":return cn.TYPE_BOOLEAN;case"[object Null]":return cn.TYPE_NULL;case"[object Object]":return e.jmespathType===kt.TOK_EXPREF?cn.TYPE_EXPREF:cn.TYPE_OBJECT;default:return}}createKeyFunction(e,t){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(e,s);if(!t.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${t.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class UPe{constructor(){this._rootValue=null,this.runtime=new LPe(this)}search(e,t){return this._rootValue=t,this.visit(e,t)}visit(e,t){let r,i,s,o,a,c,l,u,h,f,d;switch(e.type){case"Field":return t===null?null:bx(t)?(c=t[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],t),f=1;f<e.children.length;f+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],t),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(t))return null;let p=e.value;return p<0&&(p=t.length+p),s=t[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(t))return null;const _=[...e.children],g=this.computeSliceParams(t.length,_),[m,b,y]=g;if(s=[],y>0)for(f=m;f<b;f+=y)s.push(t[f]);else for(f=m;f>b;f+=y)s.push(t[f]);return s;case"Projection":if(d=this.visit(e.children[0],t),!Array.isArray(d))return null;for(h=[],f=0;f<d.length;f+=1)i=this.visit(e.children[1],d[f]),i!==null&&h.push(i);return h;case"ValueProjection":if(d=this.visit(e.children[0],t),!bx(d))return null;h=[];const x=Object.values(d);for(f=0;f<x.length;f+=1)i=this.visit(e.children[1],x[f]),i!==null&&h.push(i);return h;case"FilterProjection":if(d=this.visit(e.children[0],t),!Array.isArray(d))return null;const T=[],k=[];for(f=0;f<d.length;f+=1)r=this.visit(e.children[2],d[f]),F2(r)||T.push(d[f]);for(let I=0;I<T.length;I+=1)i=this.visit(e.children[1],T[I]),i!==null&&k.push(i);return k;case"Comparator":switch(o=this.visit(e.children[0],t),a=this.visit(e.children[1],t),e.name){case kt.TOK_EQ:s=JM(o,a);break;case kt.TOK_NE:s=!JM(o,a);break;case kt.TOK_GT:s=o>a;break;case kt.TOK_GTE:s=o>=a;break;case kt.TOK_LT:s=o<a;break;case kt.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case kt.TOK_FLATTEN:const R=this.visit(e.children[0],t);if(!Array.isArray(R))return null;let P=[];for(f=0;f<R.length;f+=1)i=R[f],Array.isArray(i)?P=[...P,...i]:P.push(i);return P;case"Identity":return t;case"MultiSelectList":if(t===null)return null;for(h=[],f=0;f<e.children.length;f+=1)h.push(this.visit(e.children[f],t));return h;case"MultiSelectHash":if(t===null)return null;h={};let B;for(f=0;f<e.children.length;f+=1)B=e.children[f],h[B.name]=this.visit(B.value,t);return h;case"OrExpression":return r=this.visit(e.children[0],t),F2(r)&&(r=this.visit(e.children[1],t)),r;case"AndExpression":return o=this.visit(e.children[0],t),F2(o)?o:this.visit(e.children[1],t);case"NotExpression":return o=this.visit(e.children[0],t),F2(o);case"Literal":return e.value;case kt.TOK_PIPE:return l=this.visit(e.children[0],t),this.visit(e.children[1],l);case kt.TOK_CURRENT:return t;case kt.TOK_ROOT:return this._rootValue;case"Function":const U=[];for(let I=0;I<e.children.length;I+=1)U.push(this.visit(e.children[I],t));return this.runtime.callFunction(e.name,U);case"ExpressionReference":const z=e.children[0];return z.jmespathType=kt.TOK_EXPREF,z;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,t){let[r,i,s]=t;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?e-1:0:this.capSliceRange(e,r,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[r,i,s]}capSliceRange(e,t,r){let i=t;return i<0?(i+=e,i<0&&(i=r<0?-1:0)):i>=e&&(i=r<0?e-1:e),i}}const BPe=new UPe;cn.TYPE_ANY;cn.TYPE_ARRAY;cn.TYPE_ARRAY_NUMBER;cn.TYPE_ARRAY_STRING;cn.TYPE_BOOLEAN;cn.TYPE_EXPREF;cn.TYPE_NULL;cn.TYPE_NUMBER;cn.TYPE_OBJECT;cn.TYPE_STRING;function FPe(n,e){const t=DPe.parse(e);return BPe.search(t,n)}const jPe=(n,e)=>{const t=HE(n.id());if(!fe(t))return 0;const[r,i]=It(e,0,[pt.NAME,pt.NAME]),s=FPe(t.json,r);return n.set(i,s),0},zPe=(n,e)=>{const t=HE(n.id());if(!fe(t))return 0;const[r,i]=It(e,0,[pt.NAME]);switch(Jn(r)){case"seek":{const[o]=It(e,i,[pt.NUMBER]);t.cursor=Ri(o,0,t.lines.length-1);break}case"line":t.cursor=Ri(t.cursor+1,0,t.lines.length-1);break;default:{const o=t.lines[t.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[h,f]=It(e,u,[pt.NAME]);n.set(h,c[l]??0),++l,u=f}break}}return 0},HPe=d_({get(n,e){const t=DTe(n.id());if(e==="format")return[!0,t];switch(t){case"text":{const r=HE(n.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=HE(n.id());switch(e){case"filename":return[!0,r.filename]}break}case"binary":{const r=HE(n.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("endgame",()=>0).command("shortsend",(n,e)=>{const t=yx(e);return Sx(n,de.element,t),0}).command("send",(n,e)=>{const t=yx(e,!0);return Sx(n,de.element,t),0}).command("stat",()=>0).command("text",(n,e)=>{const t=e.map(mo).join(" ");return kL(Ke,"","$GREEN",t),0}).command("hyperlink",(n,e)=>{const[t,...r]=e,i=n.template(mo(t).split(" "));return kL(Ke,"",`!${n.template(r)};${i}`),0}).command("readline",zPe).command("readjson",jPe).command("readbin",RPe).command("withboard",(n,e)=>{const[t]=It(e,0,[pt.STRING]),r=vs(t);return fe(r)&&(de.board=r,de.element={x:Nu(0,dn-1),y:Nu(0,_r-1)}),0}).command("withobject",(n,e)=>{const[t]=It(e,0,[pt.STRING]),r=Bh(de.board,t);return fe(r)&&(de.element=r,de.elementid=r.id??"",de.elementisplayer=lu(de.elementid),de.elementfocus=de.elementisplayer?de.elementid:de.element?.player??Wm()),0}).command("userinput",(n,e)=>{const[t]=It(e,0,[pt.NAME]),r=Wm();switch(Jn(t)){case"up":bm(Ke,r,wt.MOVE_UP,!1);break;case"down":bm(Ke,r,wt.MOVE_DOWN,!1);break;case"left":bm(Ke,r,wt.MOVE_RIGHT,!1);break;case"right":bm(Ke,r,wt.MOVE_RIGHT,!1);break;case"shootup":bm(Ke,r,wt.MOVE_UP,!0);break;case"shootdown":bm(Ke,r,wt.MOVE_DOWN,!0);break;case"shootleft":bm(Ke,r,wt.MOVE_RIGHT,!0);break;case"shootright":bm(Ke,r,wt.MOVE_RIGHT,!0);break;case"ok":bm(Ke,r,wt.OK_BUTTON,!1);break;case"cancel":bm(Ke,r,wt.CANCEL_BUTTON,!1);break}return 0});function Zz(n,e,t,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=It(i,a,[pt.ANY]);Xn(c)&&!Od(c)&&!lA(c)&&!HM(c)&&!Mc(c)?o.push(...c):o.push(c),a=l}switch(Jn(r)){case"get":case"post:json":FSe(Ke,de.elementfocus,n,e,t,r,o);break}return 0}const VPe=d_().command("fetch",(n,e)=>{const[t,r,i="get",s]=It(e,0,[pt.NAME,pt.NAME,pt.MAYBE_STRING]);return Zz(void 0,t,r,i,e,s),0}).command("fetchwith",(n,e)=>{const[t,r,i,s="get",o]=It(e,0,[pt.ANY,pt.NAME,pt.NAME,pt.MAYBE_STRING]);return Zz(t,r,i,s,e,o),0}),GPe=d_({set(n,e,t){return nPe(n,e,t),[!1,void 0]},aftertick(n){const e=rPe(de.elementid),[t]=e;if(e.length===1&&rn(t)){if(fe(de.element))if(t.trim().length===0){const r=JN(de.elementid);r.sidebar=[]}else de.element.tickertext=t,de.element.tickertime=de.timestamp,sU(de.board?.id,de.element,t)}else if(e.length>1)if(de.elementisplayer){const r=JN(de.elementid);r.sidebar=Vz(e)}else{const r=de.elementfocus;n.scrolllock(r);const i=JN(r);i.scrollname=de.element?.name??de.element?.kinddata?.name??"",i.scroll=Vz(e)}}}).command("endgame",n=>(n.set("health",0),0)).command("shortsend",(n,e)=>{const t=yx(e);return Sx(n,de.element,t),0}).command("send",(n,e)=>{const t=yx(e,!0);return Sx(n,de.element,t),0}).command("stat",()=>0).command("text",(n,e)=>{const t=e.map(mo).join("");return iPe(de.elementid,t),0}).command("hyperlink",(n,e)=>{const[t,...r]=e,i=n.template(mo(t).split(" ")),s=n.template(r);return sPe(de.elementid,n.id(),i,s.split(" "),n.get,n.set),0}).command("help",()=>(n6(Ke,de.elementfocus),0));function $Pe(n,e,t,r,i){if(!fe(de.book))return;const s=vs(n);if(!fe(s))return;const o=aU(),a=i==="all"||i==="object",c=i==="all"||i==="terrain";Rc(s),Rc(o);const l=-Math.tan(e*.5),u=Math.sin(e),h=Math.round(12.5*l),f=Math.round(12.5*u),d=new Array(_r).fill(0);q9(h,0,-h,_r-1).forEach(b=>{b.x<0?d[b.y]=Math.min(d[b.y],b.x):d[b.y]=Math.max(d[b.y],b.x)});const _=new Array(dn).fill(0);q9(0,f,dn-1,-f).forEach(b=>{b.y<0?_[b.x]=Math.min(_[b.x],b.y):_[b.x]=Math.max(_[b.x],b.y)});const m=[d,_,d];for(let b=0;b<m.length;++b){const y=m[b];if(b!==1){for(let x=0;x<_r;++x){const T=y[x],k=x*dn;for(let R=0;R<dn;R++){const P=(R+T+dn)%dn;c&&(o.terrain[P+k]=s.terrain[R+k])}}if(a){const x=Object.keys(s.objects);for(let T=0;T<x.length;++T){const k=x[T],{x:R,y:P}=s.objects[k];if(fe(R)&&fe(P)){const B=y[P];s.objects[k].x=(R+B+dn)%dn,s.objects[k].lx=s.objects[k].x}}}}if(b===1){for(let x=0;x<dn;++x){const T=y[x];for(let k=0;k<_r;++k){const R=(k+T+_r)%_r;c&&(o.terrain[x+R*dn]=s.terrain[x+k*dn])}}if(a){const x=Object.keys(s.objects);for(let T=0;T<x.length;++T){const k=x[T],{x:R,y:P}=s.objects[k];if(fe(R)&&fe(P)){const B=y[R];s.objects[k].y=(P+B+_r)%_r,s.objects[k].ly=s.objects[k].y}}}}c&&(s.terrain=[...o.terrain]),Rc(o),Rc(s)}}var eP,Jz;function WPe(){if(Jz)return eP;Jz=1;function n(e,t){let r=0,i=0,s=0;for(;s<e.length;s++)r+=e[s];for(s=0,t*=r;t&&s<e.length;){if(i+=e[s],t<=i)return s;s++}return 0}return eP=n,eP}var tP,Qz;function MQ(){if(Qz)return tP;Qz=1;const n=WPe(),e=function(){};return e.prototype.FMX=0,e.prototype.FMY=0,e.prototype.FMXxFMY=0,e.prototype.T=0,e.prototype.N=0,e.prototype.initiliazedField=!1,e.prototype.generationComplete=!1,e.prototype.wave=null,e.prototype.compatible=null,e.prototype.weightLogWeights=null,e.prototype.sumOfWeights=0,e.prototype.sumOfWeightLogWeights=0,e.prototype.startingEntropy=0,e.prototype.sumsOfOnes=null,e.prototype.sumsOfWeights=null,e.prototype.sumsOfWeightLogWeights=null,e.prototype.entropies=null,e.prototype.propagator=null,e.prototype.observed=null,e.prototype.distribution=null,e.prototype.stack=null,e.prototype.stackSize=0,e.prototype.DX=[-1,0,1,0],e.prototype.DY=[0,1,0,-1],e.prototype.opposite=[2,3,0,1],e.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let t=0;t<this.FMXxFMY;t++){this.wave[t]=new Array(this.T),this.compatible[t]=new Array(this.T);for(let r=0;r<this.T;r++)this.compatible[t][r]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let t=0;t<this.T;t++)this.weightLogWeights[t]=this.weights[t]*Math.log(this.weights[t]),this.sumOfWeights+=this.weights[t],this.sumOfWeightLogWeights+=this.weightLogWeights[t];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},e.prototype.observe=function(t){let r=1e3,i=-1;for(let a=0;a<this.FMXxFMY;a++){if(this.onBoundary(a%this.FMX,a/this.FMX|0))continue;const c=this.sumsOfOnes[a];if(c===0)return!1;const l=this.entropies[a];if(c>1&&l<=r){const u=1e-6*t();l+u<r&&(r=l+u,i=a)}}if(i===-1){this.observed=new Array(this.FMXxFMY);for(let a=0;a<this.FMXxFMY;a++)for(let c=0;c<this.T;c++)if(this.wave[a][c]){this.observed[a]=c;break}return!0}for(let a=0;a<this.T;a++)this.distribution[a]=this.wave[i][a]?this.weights[a]:0;const s=n(this.distribution,t()),o=this.wave[i];for(let a=0;a<this.T;a++)o[a]!==(a===s)&&this.ban(i,a);return null},e.prototype.propagate=function(){for(;this.stackSize>0;){const t=this.stack[this.stackSize-1];this.stackSize--;const r=t[0],i=r%this.FMX,s=r/this.FMX|0;for(let o=0;o<4;o++){const a=this.DX[o],c=this.DY[o];let l=i+a,u=s+c;if(this.onBoundary(l,u))continue;l<0?l+=this.FMX:l>=this.FMX&&(l-=this.FMX),u<0?u+=this.FMY:u>=this.FMY&&(u-=this.FMY);const h=l+u*this.FMX,f=this.propagator[o][t[1]],d=this.compatible[h];for(let p=0;p<f.length;p++){const _=f[p],g=d[_];g[o]--,g[o]==0&&this.ban(h,_)}}}},e.prototype.singleIteration=function(t){const r=this.observe(t);return r!==null?(this.generationComplete=r,!!r):(this.propagate(),null)},e.prototype.iterate=function(t,r){this.wave||this.initialize(),this.initiliazedField||this.clear(),t=t||0,r=r||Math.random;for(let i=0;i<t||t===0;i++){const s=this.singleIteration(r);if(s!==null)return!!s}return!0},e.prototype.generate=function(t){for(t=t||Math.random,this.wave||this.initialize(),this.clear();;){const r=this.singleIteration(t);if(r!==null)return!!r}},e.prototype.isGenerationComplete=function(){return this.generationComplete},e.prototype.ban=function(t,r){const i=this.compatible[t][r];for(let o=0;o<4;o++)i[o]=0;this.wave[t][r]=!1,this.stack[this.stackSize]=[t,r],this.stackSize++,this.sumsOfOnes[t]-=1,this.sumsOfWeights[t]-=this.weights[r],this.sumsOfWeightLogWeights[t]-=this.weightLogWeights[r];const s=this.sumsOfWeights[t];this.entropies[t]=Math.log(s)-this.sumsOfWeightLogWeights[t]/s},e.prototype.clear=function(){for(let t=0;t<this.FMXxFMY;t++){for(let r=0;r<this.T;r++){this.wave[t][r]=!0;for(let i=0;i<4;i++)this.compatible[t][r][i]=this.propagator[this.opposite[i]][r].length}this.sumsOfOnes[t]=this.weights.length,this.sumsOfWeights[t]=this.sumOfWeights,this.sumsOfWeightLogWeights[t]=this.sumOfWeightLogWeights,this.entropies[t]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1},tP=e,tP}var nP,eH;function qPe(){if(eH)return nP;eH=1;const n=MQ(),e=function(r,i,s,o,a,c,l,u,h,f){f=f||0,this.N=o,this.FMX=a,this.FMY=c,this.FMXxFMY=a*c,this.periodic=u;const d=i,p=new Array(d);for(let z=0;z<d;z++)p[z]=new Array(s);this.colors=[];const _={};for(let z=0;z<s;z++)for(let I=0;I<i;I++){const L=(z*i+I)*4,M=[r[L],r[L+1],r[L+2],r[L+3]],F=M.join("-");_.hasOwnProperty(F)||(_[F]=this.colors.length,this.colors.push(M)),p[I][z]=_[F]}const g=this.colors.length,m=Math.pow(g,o*o),b=function(I){let L=new Array(o*o);for(let M=0;M<o;M++)for(let F=0;F<o;F++)L[F+M*o]=I(F,M);return L},y=function(I,L){return b(function(M,F){return p[(I+M)%i][(L+F)%s]})},x=function(I){return b(function(L,M){return I[o-1-M+L*o]})},T=function(I){return b(function(L,M){return I[o-1-L+M*o]})},k=function(I){let L=0,M=1;for(let F=0;F<I.length;F++)L+=I[I.length-1-F]*M,M*=g;return L},R=function(I){let L=I,M=m;const F=new Array(o*o);for(let Z=0;Z<F.length;Z++){M/=g;let $=0;for(;L>=M;)L-=M,$++;F[Z]=$}return F},P={},B=[];for(let z=0;z<(l?s:s-o+1);z++)for(let I=0;I<(l?i:i-o+1);I++){const L=new Array(8);L[0]=y(I,z),L[1]=T(L[0]),L[2]=x(L[0]),L[3]=T(L[2]),L[4]=x(L[2]),L[5]=T(L[4]),L[6]=x(L[4]),L[7]=T(L[6]);for(let M=0;M<h;M++){const F=k(L[M]);P[F]?P[F]++:(B.push(F),P[F]=1)}}this.T=B.length,this.ground=(f+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let z=0;z<this.T;z++){const I=parseInt(B[z],10);this.patterns[z]=R(I),this.weights[z]=P[I]}const U=function(I,L,M,F){const Z=M<0?0:M,$=M<0?M+o:o,Y=F<0?0:F,Q=F<0?F+o:o;for(let q=Y;q<Q;q++)for(let V=Z;V<$;V++)if(I[V+o*q]!=L[V-M+o*(q-F)])return!1;return!0};this.propagator=new Array(4);for(let z=0;z<4;z++){this.propagator[z]=new Array(this.T);for(let I=0;I<this.T;I++){const L=[];for(let M=0;M<this.T;M++)U(this.patterns[I],this.patterns[M],this.DX[z],this.DY[z])&&L.push(M);this.propagator[z][I]=L}}};return e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.onBoundary=function(t,r){return!this.periodic&&(t+this.N>this.FMX||r+this.N>this.FMY||t<0||r<0)},e.prototype.clear=function(){if(n.prototype.clear.call(this),this.ground!==0){for(let t=0;t<this.FMX;t++){for(let r=0;r<this.T;r++)r!==this.ground&&this.ban(t+(this.FMY-1)*this.FMX,r);for(let r=0;r<this.FMY-1;r++)this.ban(t+r*this.FMX,this.ground)}this.propagate()}},e.prototype.graphics=function(t){return t=t||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t),t},e.prototype.graphicsComplete=function(t){for(let r=0;r<this.FMY;r++){const i=r<this.FMY-this.N+1?0:this.N-1;for(let s=0;s<this.FMX;s++){const o=s<this.FMX-this.N+1?0:this.N-1,a=(r*this.FMX+s)*4,c=this.colors[this.patterns[this.observed[s-o+(r-i)*this.FMX]][o+i*this.N]];t[a]=c[0],t[a+1]=c[1],t[a+2]=c[2],t[a+3]=c[3]}}},e.prototype.graphicsIncomplete=function(t){for(let r=0;r<this.FMXxFMY;r++){const i=r%this.FMX,s=r/this.FMX|0;let o=0,a=0,c=0,l=0,u=0;for(let f=0;f<this.N;f++)for(let d=0;d<this.N;d++){let p=i-d;p<0&&(p+=this.FMX);let _=s-f;if(_<0&&(_+=this.FMY),this.onBoundary(p,_))continue;const g=p+_*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[g][m]){o++;const b=this.colors[this.patterns[m][d+f*this.N]];a+=b[0],c+=b[1],l+=b[2],u+=b[3]}}const h=r*4;t[h]=a/o,t[h+1]=c/o,t[h+2]=l/o,t[h+3]=u/o}},nP=e,nP}var rP,tH;function YPe(){if(tH)return rP;tH=1;const n=MQ(),e=function(r,i,s,o,a){const c=r.tilesize||16;this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=a,this.tilesize=c;const l=!!r.unique;let u=null;i&&r.subsets&&r.subsets[i]&&(u=r.subsets[i]);const h=function(k){const R=new Array(c*c);for(let P=0;P<c;P++)for(let B=0;B<c;B++)R[B+P*c]=k(B,P);return R},f=function(k){return h(function(R,P){return k[c-1-P+R*c]})},d=function(k){return h(function(R,P){return k[c-1-R+P*c]})};this.tiles=[];const p=[],_=[],g={};let m,b,y;for(let T=0;T<r.tiles.length;T++){const k=r.tiles[T];if(u!==null&&u.indexOf(k.name)===-1)continue;switch(k.symmetry){case"L":y=4,m=function(P){return(P+1)%4},b=function(P){return P%2===0?P+1:P-1};break;case"T":y=4,m=function(P){return(P+1)%4},b=function(P){return P%2===0?P:4-P};break;case"I":y=2,m=function(P){return 1-P},b=function(P){return P};break;case"\\":y=2,m=function(P){return 1-P},b=function(P){return 1-P};break;case"F":y=8,m=function(P){return P<4?(P+1)%4:4+(P-1)%4},b=function(P){return P<4?P+4:P-4};break;default:y=1,m=function(P){return P},b=function(P){return P};break}this.T=_.length,g[k.name]=this.T;for(let P=0;P<y;P++)_.push([this.T+P,this.T+m(P),this.T+m(m(P)),this.T+m(m(m(P))),this.T+b(P),this.T+b(m(P)),this.T+b(m(m(P))),this.T+b(m(m(m(P))))]);let R;if(l)for(let P=0;P<y;P++)R=k.bitmap[P],this.tiles.push(h(function(B,U){return[R[(c*U+B)*4],R[(c*U+B)*4+1],R[(c*U+B)*4+2],R[(c*U+B)*4+3]]}));else{R=k.bitmap,this.tiles.push(h(function(P,B){return[R[(c*B+P)*4],R[(c*B+P)*4+1],R[(c*B+P)*4+2],R[(c*B+P)*4+3]]}));for(let P=1;P<y;P++)this.tiles.push(P<4?f(this.tiles[this.T+P-1]):d(this.tiles[this.T+P-4]))}for(let P=0;P<y;P++)p.push(k.weight||1)}this.T=_.length,this.weights=p,this.propagator=new Array(4);const x=new Array(4);for(let T=0;T<4;T++){this.propagator[T]=new Array(this.T),x[T]=new Array(this.T);for(let k=0;k<this.T;k++){x[T][k]=new Array(this.T);for(let R=0;R<this.T;R++)x[T][k][R]=!1}}for(let T=0;T<r.neighbors.length;T++){const k=r.neighbors[T],R=k.left.split(" ").filter(function(L){return L.length}),P=k.right.split(" ").filter(function(L){return L.length});if(u!==null&&(u.indexOf(R[0])===-1||u.indexOf(P[0])===-1))continue;const B=_[g[R[0]]][R.length==1?0:parseInt(R[1],10)],U=_[B][1],z=_[g[P[0]]][P.length==1?0:parseInt(P[1],10)],I=_[z][1];x[0][z][B]=!0,x[0][_[z][6]][_[B][6]]=!0,x[0][_[B][4]][_[z][4]]=!0,x[0][_[B][2]][_[z][2]]=!0,x[1][I][U]=!0,x[1][_[U][6]][_[I][6]]=!0,x[1][_[I][4]][_[U][4]]=!0,x[1][_[U][2]][_[I][2]]=!0}for(let T=0;T<this.T;T++)for(let k=0;k<this.T;k++)x[2][T][k]=x[0][k][T],x[3][T][k]=x[1][k][T];for(let T=0;T<4;T++)for(let k=0;k<this.T;k++){const R=[],P=x[T][k];for(let B=0;B<this.T;B++)P[B]&&R.push(B);this.propagator[T][k]=R}};return e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.onBoundary=function(t,r){return!this.periodic&&(t<0||r<0||t>=this.FMX||r>=this.FMY)},e.prototype.graphics=function(t,r){return t=t||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t,r),t},e.prototype.graphicsComplete=function(t){for(let r=0;r<this.FMX;r++)for(let i=0;i<this.FMY;i++){const s=this.tiles[this.observed[r+i*this.FMX]];for(let o=0;o<this.tilesize;o++)for(let a=0;a<this.tilesize;a++){const c=(r*this.tilesize+a+(i*this.tilesize+o)*this.FMX*this.tilesize)*4,l=s[a+o*this.tilesize];t[c]=l[0],t[c+1]=l[1],t[c+2]=l[2],t[c+3]=l[3]}}},e.prototype.graphicsIncomplete=function(t,r){(!r||r.length!==4)&&(r=!1);for(let i=0;i<this.FMX;i++)for(let s=0;s<this.FMY;s++){const o=this.wave[i+s*this.FMX];let a=0,c=0;for(let u=0;u<this.T;u++)o[u]&&(a++,c+=this.weights[u]);const l=1/c;for(let u=0;u<this.tilesize;u++)for(let h=0;h<this.tilesize;h++){const f=(i*this.tilesize+h+(s*this.tilesize+u)*this.FMX*this.tilesize)*4;if(r&&a===this.T)t[f]=r[0],t[f+1]=r[1],t[f+2]=r[2],t[f+3]=r[3];else{let d=0,p=0,_=0,g=0;for(let m=0;m<this.T;m++)if(o[m]){const b=this.tiles[m][h+u*this.tilesize],y=this.weights[m]*l;d+=b[0]*y,p+=b[1]*y,_+=b[2]*y,g+=b[3]*y}t[f]=d,t[f+1]=p,t[f+2]=_,t[f+3]=g}}}},rP=e,rP}var iP,nH;function KPe(){return nH||(nH=1,iP={OverlappingModel:qPe(),SimpleTiledModel:YPe()}),iP}var XPe=KPe();const ZPe=Dl(XPe);function JPe(n,e,t,r,i,s,o){if(!fe(de.book))return!1;const a=de.book,c=vs(n);if(!fe(c))return!1;const l=vs(e);if(!fe(l))return!1;Rc(c),Rc(l);let u=0;const h=new Map,f=new Map;let d=0;const p=32,_=new Uint8Array(f0*4);for(let x=0;x<_r;++x)for(let T=0;T<dn;++T){const k=ts(l,{x:T,y:x}),R=k?.char??0,P=k?.color??p,B=k?.bg??p;let U=0;const z=Ep(k),I=Jn(z?.name??"empty"),L=h.get(I);Xt(L)?U=L:(U=u,h.set(I,u),f.set(u,I),u++),_[d++]=R,_[d++]=P,_[d++]=B,_[d++]=U}const g=s.x-i.x+1,m=s.y-i.y+1,b=new ZPe.OverlappingModel(_,dn,_r,t,g,m,!0,!1,r);if(!b.generate())return!1;d=0;const y=b.graphics();for(let x=i.y;x<=s.y;++x)for(let T=i.x;T<=s.x;++T){const k={x:T,y:x},R=y[d++],P=y[d++],B=y[d++],U=y[d++];switch(o){case"all":{const M=ts(c,{x:T,y:x});_s(M)&&Ad(c,M,a.timestamp),au(c,{x:T,y:x});break}case"object":{const M=ts(c,{x:T,y:x});_s(M)&&Ad(c,M,a.timestamp);break}case"terrain":au(c,{x:T,y:x});break}let z=f.get(U)??"";const I=Ep({kind:z});switch(o){case"all":break;case"object":_s(I)||(z="");break;case"terrain":_s(I)&&(z="");break;default:if(Zr(I,"group")!==o&&(z=""),z){const M=ts(c,{x:T,y:x});_s(M)&&Ad(c,M,a.timestamp),au(c,{x:T,y:x})}break}const L=z?wd(c,[z],k):void 0;if(!(!fe(L)||!fe(I))&&(fb(L,I),R>0&&(L.char=R),P<p&&(L.color=P),B<p&&(L.bg=B),_s(L))){const M=md($x(l,z));fe(M)&&(au(c,{...qv(l,M.x??0,M.y??0),x:T,y:x}),fb(L,M))}}return!0}function kQ(n){return`zss_snapshot_${n}`}const OQ={x:0,y:0},IQ={x:dn-1,y:_r-1},NQ="all";function QPe(n){const e=vs(n);if(!fe(e))return;const t=Pm(),r=kQ(e.id);for(let s=0;s<t.length;++s)IZ(t[s],r);const i=vs(r);if(fe(i))return bO(n,i.id,OQ,IQ,NQ),i}function eDe(n){const e=vs(n);if(!fe(e))return;const t=kQ(e.id),r=vs(t);if(fe(r))return bO(r.id,n,OQ,IQ,NQ),r}function tDe(n,e,t,r,i,s){switch(s){case"all":case"object":case"terrain":break;default:return nDe(n,e,i,s)}if(!fe(de.book))return;const o=vs(n);if(!fe(o))return;const a=aU();Rc(o);for(let c=t.y;c<=r.y;++c)for(let l=t.x;l<=r.x;++l){let u=!1,h=!1;switch(s){case"all":u=!0,h=!0;break;case"object":u=!0;break;case"terrain":h=!0;break}const f=(l+e.x+dn)%dn,d=(c+e.y+_r)%_r;if(u){const p=ts(o,{x:l,y:c});_s(p)&&fe(p?.x)&&fe(p?.y)&&(p.x=f,p.lx=f,p.y=d,p.ly=d)}h&&(a.terrain[f+d*dn]=o.terrain[l+c*dn])}(s==="all"||s==="terrain")&&(o.terrain=[...a.terrain]),Rc(o)}function nDe(n,e,t,r){if(!fe(de.book))return;const i=de.book,s=vs(n);if(!fe(s))return;Rc(s);const{terrainelements:o,objectelements:a}=UQ(s,t,r);if(o.length===0&&a.length===0)return;e.x<0&&(o.sort((d,p)=>{const _=d.x??0,g=p.x??0;return _-g}),a.sort((d,p)=>{const _=d.x??0,g=p.x??0;return _-g})),e.x>0&&(o.sort((d,p)=>{const _=d.x??0;return(p.x??0)-_}),a.sort((d,p)=>{const _=d.x??0;return(p.x??0)-_})),e.y<0&&(o.sort((d,p)=>{const _=d.y??0,g=p.y??0;return _-g}),a.sort((d,p)=>{const _=d.y??0,g=p.y??0;return _-g})),e.y>0&&(o.sort((d,p)=>{const _=d.y??0;return(p.y??0)-_}),a.sort((d,p)=>{const _=d.y??0;return(p.y??0)-_}));const c=a.map(d=>d.id??""),l=o.map(d=>bd({x:d.x??0,y:d.y??0},dn)),u=[],h=[];for(let d=0;d<o.length;++d){const p=o[d],_={x:p.x??-1,y:p.y??-1},g=ts(s,_);fe(g)&&_s(g)&&(u.push(g.id??""),u.push(g.id??""),h.push(bd({x:g.x??0,y:g.y??0},dn)))}let f=!1;for(let d=0;d<o.length;++d){const p=o[d],_=Zr(p,"collision"),g={x:p.x??-1,y:p.y??-1},m=bd(g,dn),b={x:g.x+e.x,y:g.y+e.y};if(Q1(b)){const y=ts(s,b),x=y?.id??"",T=bd({x:y?.x??0,y:y?.y??0},dn),k=Zr(y,"collision");if(fe(y)&&_s(y)&&u.includes(x)!==!0&&c.includes(x)!==!0){let R=!1;const P=h.includes(m),B=P?ts(s,g):void 0,U=P?Zr(B,"pushable"):!1,z=P&&U;if(LL(p,y)&&(_!==kn.ISWALK||P)){let I=P;fe(B)&&U&&(f=xf(i,s,B,{x:(B.x??0)-e.x,y:(B.y??0)-e.y})!==!0,f||(I=!1)),(I||_!==kn.ISWALK)&&(f=xf(i,s,y,{x:(y.x??0)+e.x,y:(y.y??0)+e.y})!==!0,f&&(R=z))}else(_!==kn.ISWALK||z)&&(f=!0,R=z);R&&fe(B)&&(f=xf(i,s,B,{x:(B.x??0)-e.x,y:(B.y??0)-e.y})!==!0)}else k===kn.ISSOLID&&l.includes(T)===!1&&(f=!0)}else f=!0}if(!f){for(let d=0;d<a.length;++d){const p=a[d],_=Zr(p,"collision"),g={x:p.x??0,y:p.y??0},m={x:g.x+e.x,y:g.y+e.y};if(Q1(m)){const b=ts(s,m),y=b?.id??"",x=Zr(b,"collision"),T=Zr(b,"group");fe(b)&&_s(b)&&u.includes(y)&&c.includes(y)!==!0?LL(p,b)?f=xf(i,s,b,m)!==!0:f=!0:Gx(_,x)&&r!==T&&(f=!0)}else f=!0}if(!f){for(let d=0;d<o.length;++d){const p=o[d],_={x:p.x??-1,y:p.y??-1},g={x:_.x+e.x,y:_.y+e.y},m=qv(s,g.x,g.y);if(fe(p)&&fe(m)){au(s,{...p,x:g.x,y:g.y}),au(s,{...m,x:_.x,y:_.y});const b=ts(s,_);_s(b)&&fe(b)&&(b.x=(b.x??0)+e.x,b.y=(b.y??0)+e.y,b.lx=(b.lx??0)+e.x,b.ly=(b.ly??0)+e.y)}}Rc(s);for(let d=0;d<a.length;++d){const p=a[d],_={x:p.x??-1,y:p.y??-1},g={x:_.x+e.x,y:_.y+e.y};if(!xf(i,s,p,g))break}Rc(s)}}}function j2(n,e){let t="all";const r={x:0,y:0},i={x:dn-1,y:_r-1};for(let s=e;s<n.length;){const[o,a]=It(n,s,[pt.MAYBE_NUMBER_OR_STRING]);if(rn(o))t=Jn(o),s=a;else if(Xt(o)){const[c,l,u,h]=It(n,a,[pt.NUMBER,pt.MAYBE_NUMBER,pt.MAYBE_NUMBER]);r.x=Math.min(o,l??o),r.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=h}else break}return{targetset:t,pt1:r,pt2:i}}function rH(n,e){const t=Pm();for(let r=0;r<t.length;++r){const i=t[r],s=md(PL(i,n,e));if(fe(s))return s}}const rDe=d_().command("snapshot",()=>(!fe(de.book)||!fe(de.board)||QPe(de.board.id),0)).command("revert",()=>(!fe(de.book)||!fe(de.board)||eDe(de.board.id),0)).command("copy",(n,e)=>{if(!fe(de.book)||!fe(de.board))return 0;const[t,r]=It(e,0,[pt.STRING]),i=rH(Wr.BOARD,t);if(fe(i)){const s=j2(e,r);bO(i.id,de.board.id,s.pt1,s.pt2,s.targetset)}return 0}).command("remix",(n,e)=>{if(!fe(de.book)||!fe(de.board))return 0;const[t,r,i,s]=It(e,0,[pt.STRING,pt.NUMBER,pt.NUMBER]),o=rH(Wr.BOARD,t);if(fe(o)){const a=j2(e,s);JPe(de.board.id,o.id,r,i,a.pt1,a.pt2,a.targetset)}return 0}).command("weave",(n,e)=>{if(!fe(de.book)||!fe(de.board))return 0;const[t,r]=It(e,0,[pt.DIR]),i={x:t.destpt.x-(de.element?.x??0),y:t.destpt.y-(de.element?.y??0)},s=j2(e,r);return tDe(de.board.id,i,s.pt1,s.pt2,de.elementid,s.targetset),0}).command("pivot",(n,e)=>{if(!fe(de.book)||!fe(de.board))return 0;const[t,r]=It(e,0,[pt.NUMBER]),i=j2(e,r);return $Pe(de.board.id,cY(t),i.pt1,i.pt2,i.targetset),0});var iU=(n=>(n[n.ERROR=0]="ERROR",n[n.CLI=1]="CLI",n[n.LOADER=2]="LOADER",n[n.RUNTIME=3]="RUNTIME",n))(iU||{});const iDe={audio:yO,board:JTe,cli:bPe,display:SPe,element:APe,runtime:GPe,loader:HPe,network:VPe,transform:rDe},sP=["audio","board","display","network","transform","element"],sDe={0:[],1:["cli",...sP],2:["loader",...sP],3:["runtime",...sP]},oDe={0:new Map,1:new Map,2:new Map,3:new Map};function cR(n){return(sDe[n]??[]).map(t=>iDe[t]).filter(fe)}function aDe(n,e){const t=oDe[n];if(!t.has(e)){let r;const i=cR(n);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!fe(r));++s);t.set(e,r)}return t.get(e)}function cDe(n,e,t){const r=cR(n);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(e,t);if(o)return[o,a]}}return[!1,void 0]}function lDe(n,e,t,r){const i=cR(n);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(e,t,r);if(a)return[a,r]}}return[!1,void 0]}function uDe(n,e){const t=cR(n);for(let r=0;r<t.length;++r)t[r].everytick(e)}function hDe(n,e){const t=cR(n);for(let r=0;r<t.length;++r)t[r].aftertick(e)}function oP(n){return Xn(n)?n.length>0?1:0:n??0}function fDe(n){return`${n}_chip`}function PQ(n=""){return`vm:${n??""}`}function dDe(n,e,t){const r=fDe(n),i=Kg(r);let s;const o=Us(Object.entries(t.labels??{}));(!Xn(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.sk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(t.errors?.length??0)!==0?1:0);function a(l,u){de.words=u;const h=aDe(e,l);return fe(h)?h(c,u):l!=="send"?a("shortsend",[l,...u]):0}const c={halt(){Sxe(r)},id(){return n},set(l,u){const[h,f]=lDe(e,c,l,u);if(h)return f},get(l){const[u,h]=cDe(e,c,l);if(u)return h},once(){i.lc=0,i.ys=0,de.get=c.get;try{s?.(c)||(i.es=1)}catch(l){ur(Ke,de.elementfocus,"crash",l.message),i.es=1}},tick(l){const u=Xt(i.ps)?i.ps:0,h=u%l===0;if(i.ps=u+1,h===!1)return!1;uDe(e,c);const f=c.shouldtick();return f&&c.once(),hDe(e,c),f},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return!i.sk&&(i.es===0||c.hm()!==0)},checkcount(){return Xt(i.lc)?++i.lc>An.YIELD_AT_COUNT:!0},haslabel(l){if(Xn(i.lb))for(let u=0;u<i.lb.length;++u){const[h,f]=i.lb[u];if(h===l)return(f.find(p=>Xt(p)&&p>0)??0)>0}return!1},hm(){if(Xn(i.mg)&&Xn(i.lb)){const[l]=i.mg;if(fe(l))for(let u=0;u<i.lb.length;++u){const[h,f]=i.lb[u];if(h===l)return f.find(d=>Xt(d)&&d>0)??0}}return 0},yield(){i.ys=1},jump(l){i.ec=l},sy(){return!!i.ys||c.checkcount()},send(l,u,h,f){Ke.emit(l,`${PQ(u)}:${h}`,f)},lock(l){i.lk=l},unlock(){i.lk=""},scrolllock(l){i.sk=l},scrollunlock(l){i.sk===l&&(i.sk="")},message(l){i.sk&&l.player!==i.sk||i.lk&&l.sender!==i.lk||c.haslabel(l.target)&&(i.mg=[l.target,l.data,l.sender,l.player])},zap(l){if(Xn(i.lb))for(let u=0;u<i.lb.length;++u){const h=i.lb[u];if(h[0]===l){const f=h[1].findIndex(d=>d>0);if(f>=0&&fe(h[1])){h[1][f]*=-1;break}}}},restore(l){if(Xn(i.lb))for(let u=0;u<i.lb.length;++u){const h=i.lb[u];if(h[0]===l)for(let f=0;f<h[1].length;f++)h[1][f]=Math.abs(h[1][f])}},getcase(){i.ec=Xt(i.ec)?i.ec:1;const l=c.hm();if(l&&Xn(i.mg)){const[,u,h,f]=i.mg;c.set("senderid",h),fe(u)&&c.set("arg",u),f&&(c.set("player",f),de.elementfocus=f),i.mg=void 0,i.ys=0,i.es=0,i.ec=l}return i.ec},nextcase(){const l=Xt(i.ec)?i.ec:1;return i.ec=l+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(l){const u=Oxe.parse(l),[h]=u.filter(f=>f.fileName===_O);return{line:h?.lineNumber??0,column:h?.columnNumber??0}},text(l){return a("text",[l])},stat(...l){return a("stat",l)},hyperlink(...l){return a("hyperlink",l)},print(l){return Xn(l)?`array ${l.length} ${l.length===1?"item":"items"}`:typeof l=="object"?`obj ${Object.keys(l).join(", ")}`:l},template(l){return Xx(l.join(" "),!0).tokens.map(h=>{if(h.tokenType===lR){const f=c.get(h.image.substring(1));if(fe(f))return f}return h.image}).join(" ")},command(...l){if(l.length===0)return 0;const[u,...h]=l;return a(Jn(mo(u)),h)},if(...l){const[u,h]=It(l,0,[pt.ANY]),f=oP(u);return f&&h<l.length&&c.command(...l.slice(h)),f?1:0},try(...l){const[,u]=It(l,0,[pt.DIR]),h=c.command("go",...l);return h&&u<l.length&&c.command(...l.slice(u)),h?1:0},take(...l){const[u,h,f]=It(l,0,[pt.NAME,pt.ANY]),d=Xt(h),p=d?f:1,_=c.get(u),g=d?h:1;if(!Xt(_))return p<l.length&&c.command(...l.slice(p)),1;const m=_-g;return m<0?(p<l.length&&c.command(...l.slice(p)),1):(c.set(u,m),0)},give(...l){const[u,h,f]=It(l,0,[pt.NAME,pt.ANY]),d=Xt(h),p=d?f:1,_=c.get(u),g=d?h:1,m=_===void 0?1:0;return m&&p<l.length&&c.command(...l.slice(p)),c.set(u,j1(_,0)+g),m},duplicate(...l){return c.command("duplicate",...l)},repeatstart(l,...u){const[h,f]=It(u,0,[pt.NUMBER]),d=`repeatcount${l}`,p=`repeatwords${l}`;i[d]=h,i[p]=f<u.length?u.slice(f):void 0},repeat(l){const u=`repeatcount${l}`,h=`repeatwords${l}`;if(!Xt(i[u]))return 0;const f=i[u];i[u]=f-1;const d=f>0,p=i[h];return d&&Xn(p)&&c.command(...p),d?1:0},foreachstart(l,...u){const[h,f]=It(u,0,[pt.NAME,pt.ANY]);if(Xn(f)){const d=`${h}_values`,p=Us(f);c.set(h,p.shift()),c.set(d,p)}else{const[,d,p,_]=It(u,0,[pt.NAME,pt.NUMBER,pt.NUMBER,pt.MAYBE_NUMBER]);let g=Math.min(d,p),m=Math.max(d,p);const b=(_??0)||1;if(b<0){const y=g;g=m,m=y}c.set(h,g-b)}return 0},foreach(l,...u){const[h,f]=It(u,0,[pt.NAME,pt.ANY]);if(Xn(f)){const k=`${h}_values`,R=c.get(k),P=R.shift();return c.set(h,P),R.length>0?1:0}const[,d,p,_,g]=It(u,0,[pt.NAME,pt.NUMBER,pt.NUMBER,pt.MAYBE_NUMBER]);let m=Math.min(d,p),b=Math.max(d,p);const y=(_??0)||1;if(y<0){const k=m;m=b,b=k}let x=c.get(h);!Xt(x)||x<m||x>b?x=m:x+=y;const T=x<=b?1:0;return T&&(c.set(h,x),g<u.length&&c.command(...u.slice(g))),T},waitfor(...l){const[u]=It(l,0,[pt.ANY]),h=oP(u);return h||c.yield(),h?1:0},or(...l){let u=0;for(let h=0;h<l.length;){const[f,d]=It(l,h,[pt.ANY]);if(u=f,u)break;h=d}return u},and(...l){let u=0;for(let h=0;h<l.length;){const[f,d]=It(l,h,[pt.ANY]);if(u=f,!u)break;h=d}return u},not(...l){const[u]=It(l,0,[pt.ANY]);return oP(u)?0:1},expr(...l){const[u]=It(l,0,[pt.ANY]);return u},isEq(l,u){const[h]=It([l],0,[pt.ANY]),[f]=It([u],0,[pt.ANY]);return typeof h=="object"||typeof f=="object"?Sv(h,f)?1:0:h===f?1:0},isNotEq(l,u){return this.isEq(l,u)?0:1},isLessThan(l,u){const[h]=It([l],0,[pt.NUMBER]),[f]=It([u],0,[pt.NUMBER]);return h<f?1:0},isGreaterThan(l,u){const[h]=It([l],0,[pt.NUMBER]),[f]=It([u],0,[pt.NUMBER]);return h>f?1:0},isLessThanOrEq(l,u){const[h]=It([l],0,[pt.NUMBER]),[f]=It([u],0,[pt.NUMBER]);return h<=f?1:0},isGreaterThanOrEq(l,u){const[h]=It([l],0,[pt.NUMBER]),[f]=It([u],0,[pt.NUMBER]);return h>=f?1:0},opPlus(l,u){const[h]=It([l],0,[pt.ANY]),[f]=It([u],0,[pt.ANY]);return h+f},opMinus(l,u){const[h]=It([l],0,[pt.ANY]),[f]=It([u],0,[pt.ANY]);return h-f},opPower(l,u){const[h]=It([l],0,[pt.NUMBER]),[f]=It([u],0,[pt.NUMBER]);return Math.pow(h,f)},opMultiply(l,u){const[h]=It([l],0,[pt.NUMBER]),[f]=It([u],0,[pt.NUMBER]);return h*f},opDivide(l,u){const[h]=It([l],0,[pt.NUMBER]),[f]=It([u],0,[pt.NUMBER]);return h/f},opModDivide(l,u){const[h]=It([l],0,[pt.NUMBER]),[f]=It([u],0,[pt.NUMBER]);return h%f},opFloorDivide(l,u){const[h]=It([l],0,[pt.NUMBER]),[f]=It([u],0,[pt.NUMBER]);return Math.floor(h/f)},opUniPlus(l){const[u]=It([l],0,[pt.NUMBER]);return+u},opUniMinus(l){const[u]=It([l],0,[pt.NUMBER]);return-u}};return s=t.code,c}function iH(n,e){const t=lu(n.id),r=lu(n.party??n.id),i=n.kind==="object"||n.kind==="scroll";let s="";n.party&&r&&(s=n.party),t&&(s=n.id??"");const o=lu(e.party??e.id),a=e.kind==="object"||e.kind==="scroll";return{sameparty:r===o&&!a&&!i,fromelementplayer:s}}function pDe(n,e,t,r){const i=zm(xc.MAIN);if(!fe(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(fe(c.id)){const l=`${PQ(c.id)}:${e}`;Ke.emit("",l,t)}}}if(Dv(n)){for(let o=0;o<r.length;++o){const a=r[o],c=ts(a,n);fe(c)&&s([c])}return}for(let o=0;o<r.length;++o){const a=r[o];switch(Jn(n)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(nJ(a,[n]));break}}}}function qo(n,e,t){if(!fe(de.board)||!fe(n))return;const r=lu(n.id),i=lu(e.id);let s=t,o=r&&!i?n.id??"":"";switch(t){case"shot":{const{sameparty:a,fromelementplayer:c}=iH(n,e);a&&_s(e)?s="partyshot":o=c;break}case"touch":{const{sameparty:a,fromelementplayer:c}=iH(n,e);a?s="bump":o=c;break}}if(s==="shot"&&Zr(e,"breakable")&&Ad(de.board,e,de.timestamp),fe(e?.id)){let a="";fe(n?.id)?a=n.id:a=`${bd({x:n.x??0,y:n.y??0},dn)}`,HTe({id:Ko(),session:Ke.session(),player:o,sender:a,target:`${e.id}:${s}`,data:void 0})}}function Sx(n,e,t){if(fe(t.targetname)){const r=Object.keys(de.board?.objects??{});switch(t.targetname){case"all":for(let i=0;i<r.length;++i){const s=r[i],o=Bh(de.board,s);fe(o)&&qo(e,o,t.label)}break;case"others":for(let i=0;i<r.length;++i){const s=r[i],o=Bh(de.board,s);s!==n.id()&&fe(o)&&qo(e,o,t.label)}break;case"sender":{const i=DQ(de.board,de.element?.sender??"");fe(i)&&_s(i)&&qo(e,i,t.label);break}case"self":de.elementid!==n.id()?n.send(de.elementfocus,de.elementid,t.label):fe(de.element)&&qo(e,de.element,t.label);break;case"ping":{const i=zm(xc.MAIN),s=jTe(i);pDe("all",t.label,void 0,s);break}default:{const i=nJ(de.board,[t.targetname]);for(let s=0;s<i.length;++s){const o=i[s];fe(o)&&qo(e,o,t.label)}break}}}else if(fe(t.targetdir))if(t.targetdir.targets.length)for(let r=0;r<t.targetdir.targets.length;++r){const i=ts(de.board,t.targetdir.targets[r]);fe(i)&&qo(e,i,t.label)}else{const r=ts(de.board,t.targetdir.destpt);fe(r)&&qo(e,r,t.label)}}function sU(n,e,t){!fe(n)||!fe(e?.id)||kL(Ke,n,`${vPe(e)}${t}`)}function oU(n,e,t,r=!1){if(!fe(n)||!fe(n.lookup)||t.x<0||t.x>=dn||t.y<0||t.y>=_r)return{name:"edge",kind:"edge",collision:kn.ISSOLID,x:t.x,y:t.y};const i=t.x+t.y*dn,s=Bh(n,n.lookup[i]??"404");if(fe(s))return r&&lu(s.id)?void 0:s;const o=n.terrain[i];if(fe(o)&&Gx(e,Zr(o,"collision")))return o}function mDe(n,e,t){const r=Bh(n,e?.id??""),i=r?.x??-1,s=r?.y??-1;if(i-t.x===0&&s-t.y===0)return!0;const o=Zr(r,"collision"),a=oU(n,o,t);return fe(a)}function r4(n,e,t){const r=Bh(n,e?.id??"");if(!fe(n)||!fe(r)||!fe(r.x)||!fe(r.y)||!fe(n.lookup)||t.x<0||t.x>=dn||t.y<0||t.y>=_r)return{name:"edge",kind:"edge",collision:kn.ISSOLID,x:t.x,y:t.y};if(r.x-t.x===0&&r.y-t.y===0)return;const i=yA(n,r),s=yA(n,t),o=Zr(r,"collision");if(o===kn.ISGHOST){r.x=t.x,r.y=t.y;return}const a=lu(r?.id),c=Bh(n,n.lookup[s]??"");if(Zr(c,"collision")===kn.ISGHOST)return;const l=lu(c?.id??"");if(fe(c)&&(!a||!l))return{...c};const u=n.terrain[s],h=Zr(u,"collision");if(Gx(o,h))return{...u,x:t.x,y:t.y};r.x=t.x,r.y=t.y,fe(r.removed)||(n.lookup[i]=void 0,n.lookup[s]=r.id??"")}function xf(n,e,t,r,i={}){if(!fe(t?.id))return!1;let s=r4(e,t,r);const o=Zr(t,"collision"),a=lu(t.id),c=o===kn.ISBULLET;if(o!==kn.ISBULLET&&fe(s)&&_s(s)){const l=qv(e,s.x??-1,s.y??-1),u=Zr(l,"collision");if(!Gx(o,u)){const h=lu(t?.id),f=!!Zr(s,"item"),d=LL(t,s),p=s.id??"";if(d&&(!h||!f)&&!i[p]){i[p]=!0;const _=fp({x:t.x??0,y:t.y??0},r),g=$o({x:s.x??0,y:s.y??0},_);!xf(n,e,s,g)&&h&&qo(t,s,"touch")}s=r4(e,t,r)}}if(fe(s)){const l=lu(s.id),u=Zr(s,"collision")===kn.ISBULLET,h=s.kind==="edge";return a?h?EDe(n,e,t,r)||qo(s,t,"thud"):u?(e?.restartonzap&&oH(n,e,t,t.id??""),qo(s,t,"shot"),qo(t,s,"thud")):(qo(s,t,"touch"),qo(t,s,"touch")):c?u?(qo(s,t,"thud"),qo(t,s,"thud")):(l&&e?.restartonzap&&oH(n,e,s,s.id??""),qo(s,t,"thud"),qo(t,s,"shot")):l?(qo(s,t,"touch"),qo(t,s,"touch")):u?(qo(s,t,"shot"),qo(t,s,"thud")):(qo(s,t,"thud"),qo(t,s,"bump")),!1}return!0}function gDe(){return new Array(dn*_r).map(()=>{})}function yA(n,e){return!fe(n)||!fe(e?.x)||!fe(e?.y)||e.x<0||e.x>=dn||e.y<0||e.y>=_r?-1:e.x+e.y*dn}function ts(n,e){const t=yA(n,e);if(t<0||!fe(n?.lookup))return;const r=Bh(n,n.lookup[t]??"");return fe(r)?r:n.terrain[t]}function DQ(n,e){const t=Bh(n,e);if(fe(t))return t;const r=parseFloat(e),i=OM(isNaN(r)?-1:r,dn);return qv(n,i.x,i.y)}function vE(n,e,t,r,i){const s=hn.MID;if(!fe(n)||!fe(e))return{dir:r,startpt:i,destpt:i,layer:s,targets:[]};const o={x:e.x??0,y:e.y??0},a={x:o.x+(e.stepx??0),y:o.y+(e.stepy??0)},c=fp(o,a);for(let l=0;l<r.length;++l){const u=zY(r[l]);switch(u){case hn.IDLE:break;case hn.NORTH:case hn.SOUTH:case hn.WEST:case hn.EAST:$o(o,u);break;case hn.BY:{const[h,f]=r.slice(l+1);Xt(h)&&Xt(f)&&(o.x+=h,o.y+=f),l+=2;break}case hn.TO:{const[h,f]=r.slice(l+1);Xt(h)&&Xt(f)&&(o.x=h,o.y=f),l+=2;break}case hn.AT:{const[h,f]=r.slice(l+1);Xt(h)&&Xt(f)&&(o.x=h,o.y=f),l+=2;break}case hn.FLOW:$o(o,c);break;case hn.SEEK:{const h=_De(n,e,t);Dv(h)&&$o(o,fp(i,h));break}case hn.RNDNS:$o(o,md(hn.NORTH,hn.SOUTH));break;case hn.RNDNE:$o(o,md(hn.NORTH,hn.EAST));break;case hn.RND:$o(o,md(hn.NORTH,hn.SOUTH,hn.WEST,hn.EAST));break;case hn.CW:case hn.CCW:case hn.OPP:case hn.RNDP:{const h=vE(n,e,t,r.slice(l+1),i);switch(o.x=i.x,o.y=i.y,u){case hn.CW:switch(fp(i,h.destpt)){case hn.NORTH:$o(o,hn.EAST);break;case hn.SOUTH:$o(o,hn.WEST);break;case hn.EAST:$o(o,hn.SOUTH);break;case hn.WEST:$o(o,hn.NORTH);break}break;case hn.CCW:switch(fp(i,h.destpt)){case hn.NORTH:$o(o,hn.WEST);break;case hn.SOUTH:$o(o,hn.EAST);break;case hn.EAST:$o(o,hn.NORTH);break;case hn.WEST:$o(o,hn.SOUTH);break}break;case hn.OPP:switch(fp(i,h.destpt)){case hn.NORTH:$o(o,hn.SOUTH);break;case hn.SOUTH:$o(o,hn.NORTH);break;case hn.EAST:$o(o,hn.WEST);break;case hn.WEST:$o(o,hn.EAST);break}break;case hn.RNDP:switch(fp(i,h.destpt)){case hn.NORTH:case hn.SOUTH:o.x+=md(-1,1);break;case hn.WEST:case hn.EAST:o.y+=md(-1,1);break}break}return{dir:r,startpt:i,destpt:o,layer:s,targets:[]}}case hn.FLEE:break;case hn.FIND:break;case hn.AWAY:{const[h,f]=r.slice(l+1);if(Xt(h)&&Xt(f)){const d={x:h,y:f},p=d.x-o.x,_=d.y-o.y;if(Math.abs(p)>1||Math.abs(_)>1){const g=Zr(e,"collision"),m=uz(n,g,o,d,!0);if(fe(m)&&(m.x!==h||m.y!==f)){const b=sH(n,m);fe(b)||(o.x=m.x,o.y=m.y)}}else{const g=F1(-p,-_);$o(o,g)}}l+=2;break}case hn.TOWARD:{const[h,f]=r.slice(l+1);if(Xt(h)&&Xt(f)){const d={x:h,y:f},p=d.x-o.x,_=d.y-o.y;if(Math.abs(p)>1||Math.abs(_)>1){const g=Zr(e,"collision"),m=uz(n,g,o,d,!1);if(fe(m)&&(m.x!==h||m.y!==f)){const b=sH(n,m);fe(b)||(o.x=m.x,o.y=m.y)}}else{const g=F1(p,_);$o(o,g)}}l+=2;break}case hn.MID:case hn.OVER:case hn.UNDER:case hn.GROUND:{const h=vE(n,e,t,r.slice(l+1),i);return h.layer=u,h}case hn.WITHIN:{const[h]=r.slice(l+1),f=vE(n,e,t,r.slice(l+2),i);if(f.targets.length===0&&Xt(h)&&h>0)for(let d=-h;d<=h;++d)for(let p=-h;p<=h;++p){const _={x:f.destpt.x+p,y:f.destpt.y+d};Q1(_)&&f.targets.push(_)}return Xt(h)&&h>0?{...f,targets:f.targets.filter(d=>Dv(d)?W9(d,f.destpt)<=h:!1)}:f}case hn.AWAYBY:{const[h]=r.slice(l+1),f=vE(n,e,t,r.slice(l+2),i);if(f.targets.length===0)for(let d=-dn;d<=dn;++d)for(let p=-dn;p<=dn;++p){const _={x:f.destpt.x+p,y:f.destpt.y+d};Q1(_)&&f.targets.push(_)}return Xt(h)&&h>0?{...f,targets:f.targets.filter(d=>Dv(d)?W9(d,f.destpt)>=h:!1)}:f}case hn.ELEMENTS:{const h=vE(n,e,t,r.slice(l+1),i);o.x=i.x,o.y=i.y,h.targets=[];const f=fp(h.startpt,h.destpt);for(let d=0;d<dn&&($o(o,f),!!Q1(o));++d)h.targets.push({x:o.x,y:o.y});return h}}}return{dir:r,startpt:i,destpt:o,layer:s,targets:[]}}function _De(n,e,t){if(!fe(n)||!fe(e))return;const r=n.objects[t];if(fe(r))return r;if(Dv(e))return rJ(e,$x(n,"player"))}function qv(n,e,t){return(e>=0&&e<dn)??(t>=0&&t<_r)?n?.terrain[e+t*dn]:void 0}function vDe(n,e){if(!fe(n)||!fe(e))return;const t=Us(e);return t.id=t.id??Ko(),n.objects[t.id]=t,n.objects[t.id]}function LQ(n,e,t,r){return vDe(n,{...e,kind:t,id:r})}function Bh(n,e){if(n)return n.objects[e]}function sH(n,e){const t=yA(n,e);if(t<0||!fe(n?.lookup))return;const r=Bh(n,n.lookup[t]??"");if(fe(r))return r}function yDe(n){return fe(n)?[...Object.values(n.objects)]:[]}function UQ(n,e,t){const r=[],i=[];if(!fe(n))return{objectelements:r,terrainelements:i};function s(o,a){if(o.removed)return!1;switch(t){case"all":return!0;case"self":return o?.id===e;case"others":return o?.id!==e;case"terrain":return a===!0;case"object":return a===!1}const c=Zr(o,t);return fe(c)||zu(o).name===t||Zr(o,"group")===t}for(let o=0;o<f0;++o){const a=n.terrain[o],c=n.objects[n.lookup?.[o]??""];if(fe(a)&&s(a,!0)){i.push(a);const l=n.objects[n.lookup?.[o]??""];fe(l)&&_s(l)&&r.push(l)}else _s(c)&&s(c,!1)&&r.push(c)}return{objectelements:r,terrainelements:i}}function Ad(n,e,t){return!fe(e)||zu(e).name==="player"?!1:(e.id?(e.removed=t,C6(n,e)):(au(n,{x:e?.x??0,y:e?.y??0}),wxe(n,e)),!0)}function au(n,e){if(!fe(n)||!fe(e)||!fe(e.x)||!fe(e.y)||e.x<0||e.x>=dn||e.y<0||e.y>=_r)return;const t=Us(e),r=e.x+e.y*dn;return n.terrain[r]=t,delete n.distmaps,n.terrain[r]}function bDe(n,e,t){return au(n,{...e,kind:t})}function SDe(n){if(fe(n)){if(rn(n.over))if(rn(n.overboard)){const e=vs(n.overboard);fe(e)||delete n.overboard}else{const e=vs(n.over);fe(e)&&(n.overboard=e.id)}else rn(n.overboard)&&delete n.overboard;if(rn(n.under))if(rn(n.underboard)){const e=vs(n.underboard);fe(e)||delete n.underboard}else{const e=vs(n.under);fe(e)&&(n.underboard=e.id)}else rn(n.underboard)&&delete n.underboard;if(rn(n.charset))if(rn(n.charsetpage)){const e=Lu(Wr.CHARSET,n.charset);fe(e)||delete n.charsetpage}else{const e=Lu(Wr.CHARSET,n.charset);fe(e)&&(n.charsetpage=e.id)}else rn(n.charsetpage)&&delete n.charsetpage;if(rn(n.palette))if(rn(n.palettepage)){const e=Lu(Wr.PALETTE,n.palette);fe(e)||delete n.palettepage}else{const e=Lu(Wr.PALETTE,n.palette);fe(e)&&(n.palettepage=e.id)}else rn(n.palettepage)&&delete n.palettepage}}function aU(n=_5){const e={terrain:gDe(),objects:{},id:"",name:""};return n(e)}function EDe(n,e,t,r){const i=t.id??"";if(r.x<0){const s=vs(e?.exitwest??"");if(fe(s))return ME(n,i,s.id,{x:dn-1,y:r.y})}else if(r.x>=dn){const s=vs(e?.exiteast??"");if(fe(s))return ME(n,i,s.id,{x:0,y:r.y})}else if(r.y<0){const s=vs(e?.exitnorth??"");if(fe(s))return ME(n,i,s.id,{x:r.x,y:_r-1})}else if(r.y>=_r){const s=vs(e?.exitsouth??"");if(fe(s))return ME(n,i,s.id,{x:r.x,y:0})}return!1}function oH(n,e,t,r){const i=BM(n,r,"enterx"),s=BM(n,r,"entery");Xt(i)&&Xt(s)&&fe(t)&&r4(e,t,{x:i,y:s})}function Q1(n){return txe(n.x,n.y,0,dn-1,_r-1,0)}const de={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var pt=(n=>(n[n.COLOR=0]="COLOR",n[n.KIND=1]="KIND",n[n.DIR=2]="DIR",n[n.NAME=3]="NAME",n[n.NUMBER=4]="NUMBER",n[n.STRING=5]="STRING",n[n.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",n[n.COLOR_OR_KIND=7]="COLOR_OR_KIND",n[n.MAYBE_KIND=8]="MAYBE_KIND",n[n.MAYBE_NAME=9]="MAYBE_NAME",n[n.MAYBE_NUMBER=10]="MAYBE_NUMBER",n[n.MAYBE_STRING=11]="MAYBE_STRING",n[n.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",n[n.ANY=13]="ANY",n))(pt||{});function Qc(n,e,t){throw console.info(t,de.element,de.elementid,de.elementfocus),new Error(`Invalid arg, expected: ${n} but got ${JSON.stringify(e)}`)}function aH(n){const e={x:de.element?.x??0,y:de.element?.y??0};return vE(de.board,de.element,de.elementfocus,n,e)}function It(n,e,t){const r=de.words;de.words=n;const i=[];let s=e;for(let o=0;o<t.length;++o)switch(t[o]){case 1:{const[a,c]=zN(s);Z1(a)?(s=c,i.push(a)):Qc("kind",a,n);break}case 0:{if(Ex(n[s])===void 0){const[a,c]=Cu(s);Mc(a)?(s=c,i.push(a)):Xt(a)?(s=c,i.push(MO(a,void 0))):Qc("color",a,n)}else{const[a,c]=tk(s);Mc(a)?(s=c,i.push(a)):Qc("color",a,n)}break}case 2:{if(JA(n[s])===void 0){const[a,c]=Cu(s);Od(a)?(s=c,i.push(aH(a))):Qc("direction",a,n)}else{const[a,c]=HY(s);Od(a)?(s=c,i.push(aH(a))):Qc("direction",a,n)}break}case 3:{const a=de.words[s];rn(a)||Qc("string",a,n),++s,i.push(a);break}case 4:{const[a,c]=Cu(s);if(rn(a)){const l=parseFloat(a);Xt(l)?i.push(l):Qc("number",a,n)}else Xt(a)?i.push(a):Qc("number",a,n);s=c;break}case 5:{const[a,c]=Cu(s);rn(a)||Qc("string",a,n),s=c,i.push(a);break}case 6:{const[a,c]=Cu(s);let l=a;if(rn(l)){const u=parseFloat(l);Xt(u)&&(l=u)}else Xt(l)||Qc("number or string",l,n);s=c,i.push(l);break}case 7:{const[a,c]=zN(s);if(Z1(a))s=c,i.push(a);else if(Ex(n[s])===void 0){const[l,u]=Cu(s);Mc(l)?(s=u,i.push(l)):Qc("color",l,n)}else{const[l,u]=tk(s);Mc(l)?(s=u,i.push(l)):Qc("color or kind",l,n)}break}case 8:{const[a,c]=zN(s);a!==void 0&&!Z1(a)&&Qc("optional kind",a,n),s=c,i.push(a);break}case 9:{const a=de.words[s];a!==void 0&&!rn(a)&&Qc("optional string",a,n),++s,i.push(a);break}case 10:{const[a,c]=Cu(s);if(rn(a)){const l=parseFloat(a);Xt(l)?i.push(l):Qc("optional number",a,n)}else Xt(a)||a===void 0?i.push(a):Qc("optional number",a,n);s=c;break}case 11:{const[a,c]=Cu(s);a!==void 0&&!rn(a)&&Qc("optional string",a,n),s=c,i.push(a);break}case 12:{const[a,c]=Cu(s);let l=a;if(rn(l)){const u=parseFloat(l);Xt(u)&&(l=u)}else l!==void 0&&!Xt(l)&&Qc("number or string",l,n);s=c,i.push(l);break}case 13:{const[a,c]=Cu(s);s=c,i.push(a);break}}return de.words=r,[...i,s]}function xDe(n){if(fe(n)&&(n<Bt.ONBLACK||n>Bt.ONCLEAR))return n}function cU(n){return fe(n)&&n>Bt.WHITE&&n<Bt.ONCLEAR?n-Bt.ONBLACK:void 0}const CO={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR",blblack:"BLBLACK",bldkblue:"BLDKBLUE",bldkgreen:"BLDKGREEN",bldkcyan:"BLDKCYAN",bldkred:"BLDKRED",bldkpurple:"BLDKPURPLE",bldkyellow:"BLDKYELLOW",blltgray:"BLLTGRAY",bldkgray:"BLDKGRAY",blblue:"BLBLUE",blgreen:"BLGREEN",blcyan:"BLCYAN",blred:"BLRED",blpurple:"BLPURPLE",blyellow:"BLYELLOW",blwhite:"BLWHITE",blbrown:"BLDKYELLOW",bldkwhite:"BLLTGRAY",blltgrey:"BLLTGRAY",blgray:"BLLTGRAY",blgrey:"BLLTGRAY",bldkgrey:"BLDKGRAY",blltblack:"BLDKGRAY"};function Mc(n){return Xn(n)&&BQ(n[0])}function TDe(n){return Mc(n)&&n[0].startsWith("ON")}function BQ(n){return fe(Bt[n])&&rn(n)}function Ex(n){if(rn(n))return CO[Jn(n)]}function MO(n,e){return[fe(n)?`${Bt[n]}`:void 0,fe(e)?`ON${Bt[e]}`:void 0].filter(fe)}function QM(n){return n.map(e=>Bt[e]).find(e=>fe(e)&&e<Bt.ONBLACK)}function ek(n){return n.map(e=>Bt[e]).find(e=>fe(e)&&e>=Bt.ONBLACK)}function wDe(n){if(Mc(n))return n;if(BQ(n))return[n];const e=Ex(n);if(fe(e))return[e]}function cH(n){const e=de.words[n],t=wDe(e);return Mc(t)?[t,n+1]:[void 0,n]}function tk(n){const e=[];let t=n;const r=parseFloat(de.words[n]);if(Xt(r))return[MO(r,void 0),n+1];const[i,s]=cH(n);Mc(i)&&(e.push(...i),t=s);const[o,a]=cH(s);return TDe(o)&&(e.push(...o),t=a),e.length?[e,t]:[void 0,n]}function kE(n){const e={};for(let t=0;t<n.length;++t){const r=n[t],i=Bt[r];fe(i)&&(i<Bt.ONBLACK||i>Bt.ONCLEAR?e.color=i:e.bg=cU(i))}return e}const vb=navigator.userAgent.includes("Mac"),ADe=navigator.userAgent.includes("Linux"),FQ=navigator.userAgent.includes("Firefox")||navigator.userAgent.includes("FxiOS"),bA=vb?"cmd":"ctrl",RDe=cx(32,126).map(n=>String.fromCharCode(n)),jQ=Gu({name:"Whitespace",pattern:/ +/}),CDe=Gu({name:"WhitespaceSkipped",pattern:/ +/,group:ll.SKIPPED}),kO=Gu({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),OO=Gu({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:RDe}),IO=Gu({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),NO=Gu({name:"EscapedDollar",pattern:"$$",start_chars_hint:["$"]}),lR=Gu({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:["$"]}),lU=Gu({name:"Center",pattern:/\$CENTER/i,start_chars_hint:["$"]}),uU=Gu({name:"MetaKey",pattern:/\$META/i,start_chars_hint:["$"]}),PO=Gu({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),DO=Gu({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function MDe(n,e=""){return Gu({name:e||n,pattern:new RegExp(n.toLowerCase(),"i")})}const kDe=Object.keys(CO),zQ=kDe.map(n=>MDe(`\\$(${n})`,n)),ODe=[jQ,kO,...zQ,IO,OO,PO,NO,DO,lU,uU,lR],IDe=new ll(ODe,{skipValidations:!r0,ensureOptimizations:r0}),NDe=new ll([CDe,kO,...zQ,IO,OO,PO,NO,DO,lU,uU,lR],{skipValidations:!r0,ensureOptimizations:r0}),lH=/\$CENTER/i;function hU(n){if(lH.test(n))return n.replace(lH,"")}function Xx(n,e=!1){return e?NDe.tokenize(n):IDe.tokenize(n)}function g_(n,e,t,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:t,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:t,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:n,height:e,char:[],color:[],bg:[],changed(){}}}function fU(n){n.active={...n.reset}}function dU(n,e){const t=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<n.length;++a){const c=n[a];switch(c.tokenType){case NO:s("$");break;case PO:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case IO:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case kO:{e.x=e.active.leftedge??0,++e.y;break}case lU:break;case uU:{s(bA);break}default:{const l=c.tokenType.name,u=CO[l],h=xDe(Bt[u]),f=cU(Bt[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):fe(h)?e.active.color=h:fe(f)?e.active.bg=f:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(fe(e.writefullwidth)&&(e.x>o||e.y===t)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){fU(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;xx(u,u+l.length,e.active.color,e.active.bg,e),LO(u,l,e)}}}function qr(n,e,t){const r=Xx(n);r.tokens&&(dU(r.tokens,e),t&&fU(e),e.changed())}function uH(n){const e=Xx(n);if(!e.tokens)return"";const t=e.tokens.filter(r=>{switch(r.tokenType){case jQ:case kO:case IO:case OO:case PO:case NO:case DO:case lR:return!0;default:return!1}}).map(r=>r.image).join("");return t.trim().length===0?"":t}function b0(n,e,t){const r=Xx(n);if(!r.tokens)return;const i=g_(e,t,Bt.WHITE,Bt.BLACK);return i.measureonly=!0,dU(r.tokens,i),i.x>0&&++i.y,i}function LO(n,e,t){let r=0;const i=n+e.length;for(let s=n;s<i;++s)t.char[s]=e.charCodeAt(r++);t.changed()}function xx(n,e,t,r,i){const s=Math.min(n,e),o=Math.max(n,e);for(let a=s;a<=o;++a)i.color[a]=t,i.bg[a]=r;i.changed()}function PDe(n,e,t,r){const i=Math.min(n,e),s=Math.max(n,e);for(let o=i;o<=s;++o)r.bg[o]=t;r.changed()}function ad(n,e,t,r,i,s,o){const a=Math.min(t,r),c=Math.max(t,r);if(a>e||c<0)return;const l=Math.max(0,a),u=Math.min(e,c);xx(n+l,n+u,i,s,o)}function $T(n,e,t,r,i,s){const o=Math.min(t,r),a=Math.max(t,r);if(o>e||a<0)return;const c=Math.max(0,o),l=Math.min(e,a);PDe(n+c,n+l,i,s)}function i4(n,e,t){const r=XA(OO,n,0,0,0,0,0,0);dU([r],e),t&&fU(e),e.changed()}function Ip(n){const e=n.reset.leftedge??0,t=n.reset.rightedge??n.width-1,r=n.reset.topedge??0,i=n.reset.bottomedge??n.height-1,s=t-e+1,o=i-r+1;return{left:e,right:t,top:r,bottom:i,width:s,height:o}}const DDe=n=>n;function pU(n,e=DDe){const t=Tf.useSyncExternalStore(n.subscribe,Tf.useCallback(()=>e(n.getState()),[n,e]),Tf.useCallback(()=>e(n.getInitialState()),[n,e]));return Tf.useDebugValue(t),t}const hH=n=>{const e=$k(n),t=r=>pU(e,r);return Object.assign(t,e),t},ry=n=>n?hH(n):hH;function HQ(n){return n.generateMipmaps=!1,n.minFilter=cu,n.magFilter=cu,n.needsUpdate=!0,n}function Dm(n){if(fe(n))return HQ(new uce(Tpe(n)))}const uR=Qe.createContext(g_(1,1,15,1));function pu(){return Qe.useContext(uR)}const VQ=ry(()=>({blink:!1}));setInterval(()=>{VQ.setState(n=>({blink:!n.blink}))},333);function Pf(){return VQ(n=>n.blink)}function GQ(){return $k(n=>{function e(){n(t=>({render:t.render+1}))}return{dither:[],render:0,changed(){queueMicrotask(e)}}})}function LDe(n){n.fill(0)}function aP(n,e,t,r,i,s){if(r<0||r>=e||i<0||i>=t)return-1;n[r+i*e]=s}const $Q=Qe.createContext(GQ());function UDe(n,e,t){const[r]=Qe.useState(()=>GQ()),i=n*e,s=r.getState();return s.dither.length!==i&&(s.dither=new Array(i).fill(t),s.render=0),r}function WQ(){return $k(n=>{function e(){n(t=>({render:t.render+1}))}return{width:0,height:0,char:[],color:[],bg:[],render:0,changed(){queueMicrotask(e)}}})}function UO(n,e,t,r){n.char.fill(e),n.color.fill(t),n.bg.fill(r)}function Yo(n,e,t,r,i,s){if(r<0||r>=e||i<0||i>=t)return;const o=r+i*e;n0(s).forEach(a=>{const c=s[a];fe(c)&&(n[a][o]=c)})}const mU=Qe.createContext(WQ());function Fb(n,e,t,r,i){const[s]=Qe.useState(()=>WQ()),o=n*e,a=s.getState();return a.char.length!==o&&(a.width=n,a.height=e,a.char=new Array(o).fill(t),a.color=new Array(o).fill(r),a.bg=new Array(o).fill(i),a.render=0),s}function qQ(){return Qe.useContext(mU).getState()}const cP=Cb(Ob),WT=Mb(kb),za=ry(n=>({palette:cP,charset:WT,mood:"",viewimage:"",screen:{},reset(){const e=fe(WT)?vI(WT,ja,Oc):void 0;n({palette:cP,mood:"",viewimage:"",screen:{},palettedata:vx(cP),charset:WT,charsetdata:Dm(WT),spritecharset:e,spritecharsetdata:Dm(e)})},setmood(e){n(t=>Sv(t.mood,e)?t:{...t,mood:e})},setviewimage(e){n(t=>Sv(t.viewimage,e)?t:{...t,viewimage:e})},setpalette(e){n(t=>Sv(t.palette,e)?t:{...t,palette:e,palettedata:vx(e)})},setcharset(e){n(t=>{if(Sv(t.charset,e))return t;const r=fe(e)?vI(e,ja,Oc):void 0;return{...t,charset:e,charsetdata:Dm(e),spritecharset:r,spritecharsetdata:Dm(r)}})},setaltcharset(e){n(t=>{if(Sv(t.altcharset,e))return t;const r=fe(e)?vI(e,ja,Oc):void 0;return{...t,altcharset:e,altcharsetdata:Dm(e),spritealtcharset:r,spritealtcharsetdata:Dm(r)}})},setscreen(e,t){n(r=>Sv(r.screen,t)?r:{...r,screen:{...r.screen,[e]:t}})}}));za.getState().reset();const Sd=ry(()=>({active:!0,saferows:1,insetcols:1,insetrows:1,islowrez:!1,islandscape:!0,sidebaropen:!0,keyboardalt:!1,keyboardctrl:!1,keyboardshift:!1,showtouchcontrols:!1,checknumbers:"",wordlist:[],wordlistflag:""}));async function gU(n){const e=Nu(1111111,9999999),t=Jn(n.replace(/[^a-zA-Z/]/g,""));return await(await fetch(`https://raw.githubusercontent.com/wiki/goldbuick/zed-software-system/${t}.md?q=${e}`)).text()}var jC={exports:{}},BDe=jC.exports,fH;function FDe(){return fH||(fH=1,(function(n,e){(function(t,r){r()})(BDe,function(){function t(l,u){return typeof u>"u"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function r(l,u,h){var f=new XMLHttpRequest;f.open("GET",l),f.responseType="blob",f.onload=function(){c(f.response,u,h)},f.onerror=function(){console.error("could not download file")},f.send()}function i(l){var u=new XMLHttpRequest;u.open("HEAD",l,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function s(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(u)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof yd=="object"&&yd.global===yd?yd:void 0,a=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(l,u,h){var f=o.URL||o.webkitURL,d=document.createElement("a");u=u||l.name||"download",d.download=u,d.rel="noopener",typeof l=="string"?(d.href=l,d.origin===location.origin?s(d):i(d.href)?r(l,u,h):s(d,d.target="_blank")):(d.href=f.createObjectURL(l),setTimeout(function(){f.revokeObjectURL(d.href)},4e4),setTimeout(function(){s(d)},0))}:"msSaveOrOpenBlob"in navigator?function(l,u,h){if(u=u||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(t(l,h),u);else if(i(l))r(l,u,h);else{var f=document.createElement("a");f.href=l,f.target="_blank",setTimeout(function(){s(f)})}}:function(l,u,h,f){if(f=f||open("","_blank"),f&&(f.document.title=f.document.body.innerText="downloading..."),typeof l=="string")return r(l,u,h);var d=l.type==="application/octet-stream",p=/constructor/i.test(o.HTMLElement)||o.safari,_=/CriOS\/[\d]+/.test(navigator.userAgent);if((_||d&&p||a)&&typeof FileReader<"u"){var g=new FileReader;g.onloadend=function(){var y=g.result;y=_?y:y.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=y:location=y,f=null},g.readAsDataURL(l)}else{var m=o.URL||o.webkitURL,b=m.createObjectURL(l);f?f.location=b:location.href=b,f=null,setTimeout(function(){m.revokeObjectURL(b)},4e4)}});o.saveAs=c.saveAs=c,n.exports=c})})(jC)),jC.exports}var jDe=FDe();async function zDe(n,e){const t=new uPe;t.file("index.html",`<!doctype html>
      <html lang=en>
      <head>
      <meta charset=utf-8>
      <title>...adding bytes</title>
      </head>
      <body>
      <script>location = 'https://zed.cafe/#${e}';<\/script>
      </body>
    </html>`);const r=await t.generateAsync({type:"blob"});jDe.saveAs(r,`${n}.zip`)}function ya(){return navigator.clipboard}function _U(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var jb=_U();function YQ(n){jb=n}var Dw={exec:()=>null};function ls(n,e=""){let t=typeof n=="string"?n:n.source,r={replace:(i,s)=>{let o=typeof s=="string"?s:s.source;return o=o.replace(Uu.caret,"$1"),t=t.replace(i,o),r},getRegex:()=>new RegExp(t,e)};return r}var Uu={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:n=>new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}#`),htmlBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}<(?:[a-z].*>|!--)`,"i")},HDe=/^(?:[ \t]*(?:\n|$))+/,VDe=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,GDe=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hR=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,$De=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,vU=/(?:[*+-]|\d{1,9}[.)])/,KQ=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,XQ=ls(KQ).replace(/bull/g,vU).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),WDe=ls(KQ).replace(/bull/g,vU).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),yU=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,qDe=/^[^\n]+/,bU=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,YDe=ls(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",bU).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),KDe=ls(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,vU).getRegex(),BO="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",SU=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,XDe=ls("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",SU).replace("tag",BO).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),ZQ=ls(yU).replace("hr",hR).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",BO).getRegex(),ZDe=ls(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",ZQ).getRegex(),EU={blockquote:ZDe,code:VDe,def:YDe,fences:GDe,heading:$De,hr:hR,html:XDe,lheading:XQ,list:KDe,newline:HDe,paragraph:ZQ,table:Dw,text:qDe},dH=ls("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",hR).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",BO).getRegex(),JDe={...EU,lheading:WDe,table:dH,paragraph:ls(yU).replace("hr",hR).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",dH).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",BO).getRegex()},QDe={...EU,html:ls(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",SU).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Dw,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:ls(yU).replace("hr",hR).replace("heading",` *#{1,6} *[^
]`).replace("lheading",XQ).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},eLe=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,tLe=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,JQ=/^( {2,}|\\)\n(?!\s*$)/,nLe=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,FO=/[\p{P}\p{S}]/u,xU=/[\s\p{P}\p{S}]/u,QQ=/[^\s\p{P}\p{S}]/u,rLe=ls(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,xU).getRegex(),eee=/(?!~)[\p{P}\p{S}]/u,iLe=/(?!~)[\s\p{P}\p{S}]/u,sLe=/(?:[^\s\p{P}\p{S}]|~)/u,oLe=/\[[^\[\]]*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)|`[^`]*?`|<(?! )[^<>]*?>/g,tee=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,aLe=ls(tee,"u").replace(/punct/g,FO).getRegex(),cLe=ls(tee,"u").replace(/punct/g,eee).getRegex(),nee="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",lLe=ls(nee,"gu").replace(/notPunctSpace/g,QQ).replace(/punctSpace/g,xU).replace(/punct/g,FO).getRegex(),uLe=ls(nee,"gu").replace(/notPunctSpace/g,sLe).replace(/punctSpace/g,iLe).replace(/punct/g,eee).getRegex(),hLe=ls("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,QQ).replace(/punctSpace/g,xU).replace(/punct/g,FO).getRegex(),fLe=ls(/\\(punct)/,"gu").replace(/punct/g,FO).getRegex(),dLe=ls(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),pLe=ls(SU).replace("(?:-->|$)","-->").getRegex(),mLe=ls("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",pLe).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),nk=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`[^`]*`|[^\[\]\\`])*?/,gLe=ls(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",nk).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),ree=ls(/^!?\[(label)\]\[(ref)\]/).replace("label",nk).replace("ref",bU).getRegex(),iee=ls(/^!?\[(ref)\](?:\[\])?/).replace("ref",bU).getRegex(),_Le=ls("reflink|nolink(?!\\()","g").replace("reflink",ree).replace("nolink",iee).getRegex(),TU={_backpedal:Dw,anyPunctuation:fLe,autolink:dLe,blockSkip:oLe,br:JQ,code:tLe,del:Dw,emStrongLDelim:aLe,emStrongRDelimAst:lLe,emStrongRDelimUnd:hLe,escape:eLe,link:gLe,nolink:iee,punctuation:rLe,reflink:ree,reflinkSearch:_Le,tag:mLe,text:nLe,url:Dw},vLe={...TU,link:ls(/^!?\[(label)\]\((.*?)\)/).replace("label",nk).getRegex(),reflink:ls(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",nk).getRegex()},s4={...TU,emStrongRDelimAst:uLe,emStrongLDelim:cLe,url:ls(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},yLe={...s4,br:ls(JQ).replace("{2,}","*").getRegex(),text:ls(s4.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},z2={normal:EU,gfm:JDe,pedantic:QDe},qT={normal:TU,gfm:s4,breaks:yLe,pedantic:vLe},bLe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},pH=n=>bLe[n];function Rm(n,e){if(e){if(Uu.escapeTest.test(n))return n.replace(Uu.escapeReplace,pH)}else if(Uu.escapeTestNoEncode.test(n))return n.replace(Uu.escapeReplaceNoEncode,pH);return n}function mH(n){try{n=encodeURI(n).replace(Uu.percentDecode,"%")}catch{return null}return n}function gH(n,e){let t=n.replace(Uu.findPipe,(s,o,a)=>{let c=!1,l=o;for(;--l>=0&&a[l]==="\\";)c=!c;return c?"|":" |"}),r=t.split(Uu.splitPipe),i=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;i<r.length;i++)r[i]=r[i].trim().replace(Uu.slashPipe,"|");return r}function YT(n,e,t){let r=n.length;if(r===0)return"";let i=0;for(;i<r&&n.charAt(r-i-1)===e;)i++;return n.slice(0,r-i)}function SLe(n,e){if(n.indexOf(e[1])===-1)return-1;let t=0;for(let r=0;r<n.length;r++)if(n[r]==="\\")r++;else if(n[r]===e[0])t++;else if(n[r]===e[1]&&(t--,t<0))return r;return t>0?-2:-1}function _H(n,e,t,r,i){let s=e.href,o=e.title||null,a=n[1].replace(i.other.outputLinkReplace,"$1");r.state.inLink=!0;let c={type:n[0].charAt(0)==="!"?"image":"link",raw:t,href:s,title:o,text:a,tokens:r.inlineTokens(a)};return r.state.inLink=!1,c}function ELe(n,e,t){let r=n.match(t.other.indentCodeCompensation);if(r===null)return e;let i=r[1];return e.split(`
`).map(s=>{let o=s.match(t.other.beginningSpace);if(o===null)return s;let[a]=o;return a.length>=i.length?s.slice(i.length):s}).join(`
`)}var rk=class{options;rules;lexer;constructor(n){this.options=n||jb}space(n){let e=this.rules.block.newline.exec(n);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(n){let e=this.rules.block.code.exec(n);if(e){let t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:YT(t,`
`)}}}fences(n){let e=this.rules.block.fences.exec(n);if(e){let t=e[0],r=ELe(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(n){let e=this.rules.block.heading.exec(n);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){let r=YT(t,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(t=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(n){let e=this.rules.block.hr.exec(n);if(e)return{type:"hr",raw:YT(e[0],`
`)}}blockquote(n){let e=this.rules.block.blockquote.exec(n);if(e){let t=YT(e[0],`
`).split(`
`),r="",i="",s=[];for(;t.length>0;){let o=!1,a=[],c;for(c=0;c<t.length;c++)if(this.rules.other.blockquoteStart.test(t[c]))a.push(t[c]),o=!0;else if(!o)a.push(t[c]);else break;t=t.slice(c);let l=a.join(`
`),u=l.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${l}`:l,i=i?`${i}
${u}`:u;let h=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,s,!0),this.lexer.state.top=h,t.length===0)break;let f=s.at(-1);if(f?.type==="code")break;if(f?.type==="blockquote"){let d=f,p=d.raw+`
`+t.join(`
`),_=this.blockquote(p);s[s.length-1]=_,r=r.substring(0,r.length-d.raw.length)+_.raw,i=i.substring(0,i.length-d.text.length)+_.text;break}else if(f?.type==="list"){let d=f,p=d.raw+`
`+t.join(`
`),_=this.list(p);s[s.length-1]=_,r=r.substring(0,r.length-f.raw.length)+_.raw,i=i.substring(0,i.length-d.raw.length)+_.raw,t=p.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:s,text:i}}}list(n){let e=this.rules.block.list.exec(n);if(e){let t=e[1].trim(),r=t.length>1,i={type:"list",raw:"",ordered:r,start:r?+t.slice(0,-1):"",loose:!1,items:[]};t=r?`\\d{1,9}\\${t.slice(-1)}`:`\\${t}`,this.options.pedantic&&(t=r?t:"[*+-]");let s=this.rules.other.listItemRegex(t),o=!1;for(;n;){let c=!1,l="",u="";if(!(e=s.exec(n))||this.rules.block.hr.test(n))break;l=e[0],n=n.substring(l.length);let h=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,m=>" ".repeat(3*m.length)),f=n.split(`
`,1)[0],d=!h.trim(),p=0;if(this.options.pedantic?(p=2,u=h.trimStart()):d?p=e[1].length+1:(p=e[2].search(this.rules.other.nonSpaceChar),p=p>4?1:p,u=h.slice(p),p+=e[1].length),d&&this.rules.other.blankLine.test(f)&&(l+=f+`
`,n=n.substring(f.length+1),c=!0),!c){let m=this.rules.other.nextBulletRegex(p),b=this.rules.other.hrRegex(p),y=this.rules.other.fencesBeginRegex(p),x=this.rules.other.headingBeginRegex(p),T=this.rules.other.htmlBeginRegex(p);for(;n;){let k=n.split(`
`,1)[0],R;if(f=k,this.options.pedantic?(f=f.replace(this.rules.other.listReplaceNesting,"  "),R=f):R=f.replace(this.rules.other.tabCharGlobal,"    "),y.test(f)||x.test(f)||T.test(f)||m.test(f)||b.test(f))break;if(R.search(this.rules.other.nonSpaceChar)>=p||!f.trim())u+=`
`+R.slice(p);else{if(d||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||y.test(h)||x.test(h)||b.test(h))break;u+=`
`+f}!d&&!f.trim()&&(d=!0),l+=k+`
`,n=n.substring(k.length+1),h=R.slice(p)}}i.loose||(o?i.loose=!0:this.rules.other.doubleBlankLine.test(l)&&(o=!0));let _=null,g;this.options.gfm&&(_=this.rules.other.listIsTask.exec(u),_&&(g=_[0]!=="[ ] ",u=u.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:l,task:!!_,checked:g,loose:!1,text:u,tokens:[]}),i.raw+=l}let a=i.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let c=0;c<i.items.length;c++)if(this.lexer.state.top=!1,i.items[c].tokens=this.lexer.blockTokens(i.items[c].text,[]),!i.loose){let l=i.items[c].tokens.filter(h=>h.type==="space"),u=l.length>0&&l.some(h=>this.rules.other.anyLine.test(h.raw));i.loose=u}if(i.loose)for(let c=0;c<i.items.length;c++)i.items[c].loose=!0;return i}}html(n){let e=this.rules.block.html.exec(n);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(n){let e=this.rules.block.def.exec(n);if(e){let t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:r,title:i}}}table(n){let e=this.rules.block.table.exec(n);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let t=gH(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:e[0],header:[],align:[],rows:[]};if(t.length===r.length){for(let o of r)this.rules.other.tableAlignRight.test(o)?s.align.push("right"):this.rules.other.tableAlignCenter.test(o)?s.align.push("center"):this.rules.other.tableAlignLeft.test(o)?s.align.push("left"):s.align.push(null);for(let o=0;o<t.length;o++)s.header.push({text:t[o],tokens:this.lexer.inline(t[o]),header:!0,align:s.align[o]});for(let o of i)s.rows.push(gH(o,s.header.length).map((a,c)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:s.align[c]})));return s}}lheading(n){let e=this.rules.block.lheading.exec(n);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(n){let e=this.rules.block.paragraph.exec(n);if(e){let t=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(n){let e=this.rules.block.text.exec(n);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(n){let e=this.rules.inline.escape.exec(n);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(n){let e=this.rules.inline.tag.exec(n);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(n){let e=this.rules.inline.link.exec(n);if(e){let t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;let s=YT(t.slice(0,-1),"\\");if((t.length-s.length)%2===0)return}else{let s=SLe(e[2],"()");if(s===-2)return;if(s>-1){let o=(e[0].indexOf("!")===0?5:4)+e[1].length+s;e[2]=e[2].substring(0,s),e[0]=e[0].substring(0,o).trim(),e[3]=""}}let r=e[2],i="";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(r);s&&(r=s[1],i=s[3])}else i=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?r=r.slice(1):r=r.slice(1,-1)),_H(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(n,e){let t;if((t=this.rules.inline.reflink.exec(n))||(t=this.rules.inline.nolink.exec(n))){let r=(t[2]||t[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[r.toLowerCase()];if(!i){let s=t[0].charAt(0);return{type:"text",raw:s,text:s}}return _H(t,i,t[0],this.lexer,this.rules)}}emStrong(n,e,t=""){let r=this.rules.inline.emStrongLDelim.exec(n);if(!(!r||r[3]&&t.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!t||this.rules.inline.punctuation.exec(t))){let i=[...r[0]].length-1,s,o,a=i,c=0,l=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,e=e.slice(-1*n.length+i);(r=l.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s)continue;if(o=[...s].length,r[3]||r[4]){a+=o;continue}else if((r[5]||r[6])&&i%3&&!((i+o)%3)){c+=o;continue}if(a-=o,a>0)continue;o=Math.min(o,o+a+c);let u=[...r[0]][0].length,h=n.slice(0,i+r.index+u+o);if(Math.min(i,o)%2){let d=h.slice(1,-1);return{type:"em",raw:h,text:d,tokens:this.lexer.inlineTokens(d)}}let f=h.slice(2,-2);return{type:"strong",raw:h,text:f,tokens:this.lexer.inlineTokens(f)}}}}codespan(n){let e=this.rules.inline.code.exec(n);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(t),i=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return r&&i&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(n){let e=this.rules.inline.br.exec(n);if(e)return{type:"br",raw:e[0]}}del(n){let e=this.rules.inline.del.exec(n);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(n){let e=this.rules.inline.autolink.exec(n);if(e){let t,r;return e[2]==="@"?(t=e[1],r="mailto:"+t):(t=e[1],r=t),{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}url(n){let e;if(e=this.rules.inline.url.exec(n)){let t,r;if(e[2]==="@")t=e[0],r="mailto:"+t;else{let i;do i=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??"";while(i!==e[0]);t=e[0],e[1]==="www."?r="http://"+e[0]:r=e[0]}return{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}inlineText(n){let e=this.rules.inline.text.exec(n);if(e){let t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}},Gg=class o4{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||jb,this.options.tokenizer=this.options.tokenizer||new rk,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={other:Uu,block:z2.normal,inline:qT.normal};this.options.pedantic?(t.block=z2.pedantic,t.inline=qT.pedantic):this.options.gfm&&(t.block=z2.gfm,this.options.breaks?t.inline=qT.breaks:t.inline=qT.gfm),this.tokenizer.rules=t}static get rules(){return{block:z2,inline:qT}}static lex(e,t){return new o4(t).lex(e)}static lexInline(e,t){return new o4(t).inlineTokens(e)}lex(e){e=e.replace(Uu.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let r=this.inlineQueue[t];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],r=!1){for(this.options.pedantic&&(e=e.replace(Uu.tabCharGlobal,"    ").replace(Uu.spaceLine,""));e;){let i;if(this.options.extensions?.block?.some(o=>(i=o.call({lexer:this},e,t))?(e=e.substring(i.raw.length),t.push(i),!0):!1))continue;if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length);let o=t.at(-1);i.raw.length===1&&o!==void 0?o.raw+=`
`:t.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length);let o=t.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.at(-1).src=o.text):t.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length);let o=t.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.raw,this.inlineQueue.at(-1).src=o.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title},t.push(i));continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),t.push(i);continue}let s=e;if(this.options.extensions?.startBlock){let o=1/0,a=e.slice(1),c;this.options.extensions.startBlock.forEach(l=>{c=l.call({lexer:this},a),typeof c=="number"&&c>=0&&(o=Math.min(o,c))}),o<1/0&&o>=0&&(s=e.substring(0,o+1))}if(this.state.top&&(i=this.tokenizer.paragraph(s))){let o=t.at(-1);r&&o?.type==="paragraph"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):t.push(i),r=s.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length);let o=t.at(-1);o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):t.push(i);continue}if(e){let o="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let r=e,i=null;if(this.tokens.links){let a=Object.keys(this.tokens.links);if(a.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)a.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,i.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(i=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let s=!1,o="";for(;e;){s||(o=""),s=!1;let a;if(this.options.extensions?.inline?.some(l=>(a=l.call({lexer:this},e,t))?(e=e.substring(a.raw.length),t.push(a),!0):!1))continue;if(a=this.tokenizer.escape(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.tag(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.link(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(a.raw.length);let l=t.at(-1);a.type==="text"&&l?.type==="text"?(l.raw+=a.raw,l.text+=a.text):t.push(a);continue}if(a=this.tokenizer.emStrong(e,r,o)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.codespan(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.br(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.del(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.autolink(e)){e=e.substring(a.raw.length),t.push(a);continue}if(!this.state.inLink&&(a=this.tokenizer.url(e))){e=e.substring(a.raw.length),t.push(a);continue}let c=e;if(this.options.extensions?.startInline){let l=1/0,u=e.slice(1),h;this.options.extensions.startInline.forEach(f=>{h=f.call({lexer:this},u),typeof h=="number"&&h>=0&&(l=Math.min(l,h))}),l<1/0&&l>=0&&(c=e.substring(0,l+1))}if(a=this.tokenizer.inlineText(c)){e=e.substring(a.raw.length),a.raw.slice(-1)!=="_"&&(o=a.raw.slice(-1)),s=!0;let l=t.at(-1);l?.type==="text"?(l.raw+=a.raw,l.text+=a.text):t.push(a);continue}if(e){let l="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(l);break}else throw new Error(l)}}return t}},ik=class{options;parser;constructor(e){this.options=e||jb}space(e){return""}code({text:e,lang:t,escaped:r}){let i=(t||"").match(Uu.notSpaceStart)?.[0],s=e.replace(Uu.endingNewline,"")+`
`;return i?'<pre><code class="language-'+Rm(i)+'">'+(r?s:Rm(s,!0))+`</code></pre>
`:"<pre><code>"+(r?s:Rm(s,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}def(e){return""}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){let t=e.ordered,r=e.start,i="";for(let a=0;a<e.items.length;a++){let c=e.items[a];i+=this.listitem(c)}let s=t?"ol":"ul",o=t&&r!==1?' start="'+r+'"':"";return"<"+s+o+`>
`+i+"</"+s+`>
`}listitem(e){let t="";if(e.task){let r=this.checkbox({checked:!!e.checked});e.loose?e.tokens[0]?.type==="paragraph"?(e.tokens[0].text=r+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=r+" "+Rm(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",r="";for(let s=0;s<e.header.length;s++)r+=this.tablecell(e.header[s]);t+=this.tablerow({text:r});let i="";for(let s=0;s<e.rows.length;s++){let o=e.rows[s];r="";for(let a=0;a<o.length;a++)r+=this.tablecell(o[a]);i+=this.tablerow({text:r})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+i+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let t=this.parser.parseInline(e.tokens),r=e.header?"th":"td";return(e.align?`<${r} align="${e.align}">`:`<${r}>`)+t+`</${r}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${Rm(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:r}){let i=this.parser.parseInline(r),s=mH(e);if(s===null)return i;e=s;let o='<a href="'+e+'"';return t&&(o+=' title="'+Rm(t)+'"'),o+=">"+i+"</a>",o}image({href:e,title:t,text:r,tokens:i}){i&&(r=this.parser.parseInline(i,this.parser.textRenderer));let s=mH(e);if(s===null)return Rm(r);e=s;let o=`<img src="${e}" alt="${r}"`;return t&&(o+=` title="${Rm(t)}"`),o+=">",o}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:Rm(e.text)}},wU=class{strong({text:n}){return n}em({text:n}){return n}codespan({text:n}){return n}del({text:n}){return n}html({text:n}){return n}text({text:n}){return n}link({text:n}){return""+n}image({text:n}){return""+n}br(){return""}},$g=class a4{options;renderer;textRenderer;constructor(e){this.options=e||jb,this.options.renderer=this.options.renderer||new ik,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new wU}static parse(e,t){return new a4(t).parse(e)}static parseInline(e,t){return new a4(t).parseInline(e)}parse(e,t=!0){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=s,c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(a.type)){r+=c||"";continue}}let o=s;switch(o.type){case"space":{r+=this.renderer.space(o);continue}case"hr":{r+=this.renderer.hr(o);continue}case"heading":{r+=this.renderer.heading(o);continue}case"code":{r+=this.renderer.code(o);continue}case"table":{r+=this.renderer.table(o);continue}case"blockquote":{r+=this.renderer.blockquote(o);continue}case"list":{r+=this.renderer.list(o);continue}case"html":{r+=this.renderer.html(o);continue}case"def":{r+=this.renderer.def(o);continue}case"paragraph":{r+=this.renderer.paragraph(o);continue}case"text":{let a=o,c=this.renderer.text(a);for(;i+1<e.length&&e[i+1].type==="text";)a=e[++i],c+=`
`+this.renderer.text(a);t?r+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):r+=c;continue}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}parseInline(e,t=this.renderer){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=this.options.extensions.renderers[s.type].call({parser:this},s);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){r+=a||"";continue}}let o=s;switch(o.type){case"escape":{r+=t.text(o);break}case"html":{r+=t.html(o);break}case"link":{r+=t.link(o);break}case"image":{r+=t.image(o);break}case"strong":{r+=t.strong(o);break}case"em":{r+=t.em(o);break}case"codespan":{r+=t.codespan(o);break}case"br":{r+=t.br(o);break}case"del":{r+=t.del(o);break}case"text":{r+=t.text(o);break}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}},zC=class{options;block;constructor(n){this.options=n||jb}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(n){return n}postprocess(n){return n}processAllTokens(n){return n}provideLexer(){return this.block?Gg.lex:Gg.lexInline}provideParser(){return this.block?$g.parse:$g.parseInline}},xLe=class{defaults=_U();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=$g;Renderer=ik;TextRenderer=wU;Lexer=Gg;Tokenizer=rk;Hooks=zC;constructor(...n){this.use(...n)}walkTokens(n,e){let t=[];for(let r of n)switch(t=t.concat(e.call(this,r)),r.type){case"table":{let i=r;for(let s of i.header)t=t.concat(this.walkTokens(s.tokens,e));for(let s of i.rows)for(let o of s)t=t.concat(this.walkTokens(o.tokens,e));break}case"list":{let i=r;t=t.concat(this.walkTokens(i.items,e));break}default:{let i=r;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(s=>{let o=i[s].flat(1/0);t=t.concat(this.walkTokens(o,e))}):i.tokens&&(t=t.concat(this.walkTokens(i.tokens,e)))}}return t}use(...n){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return n.forEach(t=>{let r={...t};if(r.async=this.defaults.async||r.async||!1,t.extensions&&(t.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let s=e.renderers[i.name];s?e.renderers[i.name]=function(...o){let a=i.renderer.apply(this,o);return a===!1&&(a=s.apply(this,o)),a}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let s=e[i.level];s?s.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),r.extensions=e),t.renderer){let i=this.defaults.renderer||new ik(this.defaults);for(let s in t.renderer){if(!(s in i))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;let o=s,a=t.renderer[o],c=i[o];i[o]=(...l)=>{let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u||""}}r.renderer=i}if(t.tokenizer){let i=this.defaults.tokenizer||new rk(this.defaults);for(let s in t.tokenizer){if(!(s in i))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;let o=s,a=t.tokenizer[o],c=i[o];i[o]=(...l)=>{let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u}}r.tokenizer=i}if(t.hooks){let i=this.defaults.hooks||new zC;for(let s in t.hooks){if(!(s in i))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;let o=s,a=t.hooks[o],c=i[o];zC.passThroughHooks.has(s)?i[o]=l=>{if(this.defaults.async)return Promise.resolve(a.call(i,l)).then(h=>c.call(i,h));let u=a.call(i,l);return c.call(i,u)}:i[o]=(...l)=>{let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u}}r.hooks=i}if(t.walkTokens){let i=this.defaults.walkTokens,s=t.walkTokens;r.walkTokens=function(o){let a=[];return a.push(s.call(this,o)),i&&(a=a.concat(i.call(this,o))),a}}this.defaults={...this.defaults,...r}}),this}setOptions(n){return this.defaults={...this.defaults,...n},this}lexer(n,e){return Gg.lex(n,e??this.defaults)}parser(n,e){return $g.parse(n,e??this.defaults)}parseMarkdown(n){return(e,t)=>{let r={...t},i={...this.defaults,...r},s=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&r.async===!1)return s(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));i.hooks&&(i.hooks.options=i,i.hooks.block=n);let o=i.hooks?i.hooks.provideLexer():n?Gg.lex:Gg.lexInline,a=i.hooks?i.hooks.provideParser():n?$g.parse:$g.parseInline;if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(e):e).then(c=>o(c,i)).then(c=>i.hooks?i.hooks.processAllTokens(c):c).then(c=>i.walkTokens?Promise.all(this.walkTokens(c,i.walkTokens)).then(()=>c):c).then(c=>a(c,i)).then(c=>i.hooks?i.hooks.postprocess(c):c).catch(s);try{i.hooks&&(e=i.hooks.preprocess(e));let c=o(e,i);i.hooks&&(c=i.hooks.processAllTokens(c)),i.walkTokens&&this.walkTokens(c,i.walkTokens);let l=a(c,i);return i.hooks&&(l=i.hooks.postprocess(l)),l}catch(c){return s(c)}}}onError(n,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,n){let r="<p>An error occurred:</p><pre>"+Rm(t.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(t);throw t}}},yb=new xLe;function cs(n,e){return yb.parse(n,e)}cs.options=cs.setOptions=function(n){return yb.setOptions(n),cs.defaults=yb.defaults,YQ(cs.defaults),cs};cs.getDefaults=_U;cs.defaults=jb;cs.use=function(...n){return yb.use(...n),cs.defaults=yb.defaults,YQ(cs.defaults),cs};cs.walkTokens=function(n,e){return yb.walkTokens(n,e)};cs.parseInline=yb.parseInline;cs.Parser=$g;cs.parser=$g.parse;cs.Renderer=ik;cs.TextRenderer=wU;cs.Lexer=Gg;cs.lexer=Gg.lex;cs.Tokenizer=rk;cs.Hooks=zC;cs.parse=cs;cs.options;cs.setOptions;cs.use;cs.walkTokens;cs.parseInline;$g.parse;Gg.lex;function Dg(n,e){switch(e.type){default:console.info("unknown",e);break;case"heading":Wv(Ke,n,e.text),Nr(Ke,n," ");break;case"hr":Nr(Ke,n," "),bQ(Ke,n,10),Nr(Ke,n," ");break;case"paragraph":for(let t=0;t<(e.tokens?.length??0);++t)fe(e.tokens?.[t])&&Dg(n,e.tokens[t]);break;case"code":e.text.split(`
`).forEach(t=>Nr(Ke,n,t.replace(/\s+/g," ").trim()));break;case"text":Nr(Ke,n,e.text);break;case"link":{const[t,...r]=e.text.split("|").map(s=>s.trim()),i=[...r,e.href??""];t4(Ke,n,i.join(" "),t);break}case"image":t4(Ke,n,`openit ${e.href}`,`show ${e.title??e.href}`);break;case"blockquote":e.text.split(`
`).forEach(t=>{Nr(Ke,n,`$dkpurple$221$white  ${t}`)}),Nr(Ke,n," ");break;case"list":for(let t=0;t<(e.items?.length??0);++t)fe(e.items?.[t])&&Dg(n,e.items[t]);Nr(Ke,n," ");break;case"list_item":Nr(Ke,n,` $grey$7 ${e.text}`);break}}function AU(n,e){cs.use({pedantic:!1,gfm:!0,breaks:!1,renderer:{heading(t){return Dg(n,t),""},code(t){return Dg(n,t),""},blockquote(t){return Dg(n,t),""},hr(t){return Dg(n,t),""},list(t){return Dg(n,t),""},listitem(t){return Dg(n,t),""},paragraph(t){return Dg(n,t),""}}}),cs.parse(e)}async function see(n,e={},t){return window.__TAURI_INTERNALS__.invoke(n,e,t)}var c4;(function(n){n[n.Audio=1]="Audio",n[n.Cache=2]="Cache",n[n.Config=3]="Config",n[n.Data=4]="Data",n[n.LocalData=5]="LocalData",n[n.Document=6]="Document",n[n.Download=7]="Download",n[n.Picture=8]="Picture",n[n.Public=9]="Public",n[n.Video=10]="Video",n[n.Resource=11]="Resource",n[n.Temp=12]="Temp",n[n.AppConfig=13]="AppConfig",n[n.AppData=14]="AppData",n[n.AppLocalData=15]="AppLocalData",n[n.AppCache=16]="AppCache",n[n.AppLog=17]="AppLog",n[n.Desktop=18]="Desktop",n[n.Executable=19]="Executable",n[n.Font=20]="Font",n[n.Home=21]="Home",n[n.Runtime=22]="Runtime",n[n.Template=23]="Template"})(c4||(c4={}));async function TLe(){return see("plugin:path|resolve_directory",{directory:c4.AppData})}async function wLe(...n){return see("plugin:path|join",{paths:n})}async function RU(n,e={},t){return window.__TAURI_INTERNALS__.invoke(n,e,t)}var SA;(function(n){n[n.Audio=1]="Audio",n[n.Cache=2]="Cache",n[n.Config=3]="Config",n[n.Data=4]="Data",n[n.LocalData=5]="LocalData",n[n.Document=6]="Document",n[n.Download=7]="Download",n[n.Picture=8]="Picture",n[n.Public=9]="Public",n[n.Video=10]="Video",n[n.Resource=11]="Resource",n[n.Temp=12]="Temp",n[n.AppConfig=13]="AppConfig",n[n.AppData=14]="AppData",n[n.AppLocalData=15]="AppLocalData",n[n.AppCache=16]="AppCache",n[n.AppLog=17]="AppLog",n[n.Desktop=18]="Desktop",n[n.Executable=19]="Executable",n[n.Font=20]="Font",n[n.Home=21]="Home",n[n.Runtime=22]="Runtime",n[n.Template=23]="Template"})(SA||(SA={}));var vH;(function(n){n[n.Start=0]="Start",n[n.Current=1]="Current",n[n.End=2]="End"})(vH||(vH={}));async function ALe(n,e){if(n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");await RU("plugin:fs|mkdir",{path:n instanceof URL?n.toString():n,options:e})}async function RLe(n,e){if(n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");const t=await RU("plugin:fs|read_text_file",{path:n instanceof URL?n.toString():n,options:e}),r=t instanceof ArrayBuffer?t:Uint8Array.from(t);return new TextDecoder().decode(r)}async function CLe(n,e,t){if(n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");const r=new TextEncoder;await RU("plugin:fs|write_text_file",r.encode(e),{headers:{path:encodeURIComponent(n instanceof URL?n.toString():n),options:JSON.stringify(t)}})}async function MLe(n,e={},t){return window.__TAURI_INTERNALS__.invoke(n,e,t)}async function kLe(n){return MLe("plugin:opener|reveal_item_in_dir",{paths:typeof n=="string"?[n]:n})}function CU(n){return new Promise((e,t)=>{n.oncomplete=n.onsuccess=()=>e(n.result),n.onabort=n.onerror=()=>t(n.error)})}function OLe(n,e){let t;const r=()=>{if(t)return t;const i=indexedDB.open(n);return i.onupgradeneeded=()=>i.result.createObjectStore(e),t=CU(i),t.then(s=>{s.onclose=()=>t=void 0},()=>{}),t};return(i,s)=>r().then(o=>s(o.transaction(e,i).objectStore(e)))}let lP;function oee(){return lP||(lP=OLe("keyval-store","keyval")),lP}function aee(n,e=oee()){return e("readonly",t=>CU(t.get(n)))}function cee(n,e,t=oee()){return t("readwrite",r=>new Promise((i,s)=>{r.get(n).onsuccess=function(){try{r.put(e(this.result),n),i(CU(r.transaction))}catch(o){s(o)}}}))}const jO=typeof window<"u"&&("__TAURI__"in window||"__TAURI_INTERNALS__"in window),EA="zss-content.json";async function Tx(n){return aee(n)}async function sk(n,e){return cee(n,e)}function ILe(n){switch(n){case"crt":return"on";default:return"off"}}async function HC(n){const e=await Tx(`config_${n}`);return e?e&&e!=="off"?"on":"off":ILe(n)}async function NLe(){return Tx("HISTORYBUFFER")}async function yH(n){return sk("HISTORYBUFFER",()=>n)}async function PLe(n){let e=await Tx(n);if(e===void 0){for(;e===void 0;){const t=i6({addAdverb:!0,capitalize:!1,adjectiveCount:2});await Tx(t)===void 0&&(e=t)}await sk(n,()=>e),await sk(e,()=>n)}return e}async function DLe(n){return await Tx(n)}function lee(n){try{const e=location.hash.slice(1);if(e.length)return e}catch(e){ur(Ke,n,"crash",e.message)}return""}async function MU(n){const e=lee(n);if(jO){if(e.length)return Nr(Ke,n,"reading url content, make sure to save"),location.hash="",e;try{Nr(Ke,n,`reading ${EA}`);const t=await RLe(EA,{baseDir:SA.AppData});return JSON.parse(t)}catch(t){return ur(Ke,n,"readcontent",t.toString()),[]}}if(e.length){const t=await DLe(e);return fe(t)&&t.length>e.length?t:e}return""}async function uee(n,e,t,r,i){if(jO){try{Nr(Ke,n,`writing ${EA}`),await CLe(EA,JSON.stringify(i,null,2),{baseDir:SA.AppData,create:!0})}catch(o){ur(Ke,n,"writecontent",o.toString())}return}if(r.length>2048){const o=await PLe(r);return uee(n,e,t,o,i)}const s=`#${r}`;if(location.hash!==s){xA=r,location.hash=s;const o=`wrote ${t.length} chars [${t.slice(0,8)}...${t.slice(-8)}]`;e.includes("autosave")||Qi(Ke,n,o),document.title=e}}async function hee(){return await Tx("storage")??{}}async function LLe(n,e){const t=await hee();return t[n]=e,sk("storage",()=>t)}let xA="";async function ULe(n){if(jO){await ALe("",{baseDir:SA.AppData,recursive:!0});try{const e=await TLe(),t=await wLe(e,EA);await kLe(t)}catch(e){ur(Ke,n,"storage",e.toString())}return}window.addEventListener("hashchange",()=>{to(Ke,n,async()=>{const e=lee(n);if(xA!==e){xA=e;const t=await MU(n);kY(Ke,n,t)}})})}async function BLe(n){const e=await MU(n);if(Xn(e)){ur(Ke,n,"storage","#share not supported in server mode");return}const t=`#${e}`;xA=e,location.hash=t;const r=await AQ(location.href);n4(Ke,n,r,r)}function FLe(n){if(jO){ur(Ke,n,"storage","#nuke not supported in server mode");return}location.hash="",xA=location.hash,location.reload()}function bH(n){const e=Qe.useRef(null);return t=>{const r=n(t);return(e.current===void 0||r===void 0?e.current===r:Sv(e.current,r))?e.current:e.current=r}}const Jr=ry(()=>({desync:!1,zsswords:{cli:[],loader:[],runtime:[],flags:[],stats:[],kinds:[],altkinds:[],colors:[],dirs:[],dirmods:[],exprs:[]},gadget:{id:"",board:"",exiteast:"",exitwest:"",exitnorth:"",exitsouth:"",layers:[],tickers:[],scrollname:"",scroll:[],sidebar:[]},gadgetlayercache:{},slim:[]})),jLe=256;var vd=(n=>(n[n.TOP=0]="TOP",n[n.FULL=1]="FULL",n[n.BOTTOM=2]="BOTTOM",n[n.SPLIT_X=3]="SPLIT_X",n[n.MAX=4]="MAX",n))(vd||{});const as=ry(n=>({layout:0,inspector:!1,quickterminal:!1,toast:"",terminal:{open:!0,info:[],logs:[]},editor:{open:!1,book:"",path:[],type:"",title:""},reset(){n({layout:0,inspector:!1,quickterminal:!1,toast:"",terminal:{open:!0,logs:[]},editor:{open:!1,book:"",path:[],type:"",title:""}})}})),Ji=ry(n=>({scroll:0,xcursor:0,ycursor:0,xselect:void 0,yselect:void 0,bufferindex:0,buffer:[""],reset(){n({scroll:0,xcursor:0,ycursor:0,xselect:void 0,yselect:void 0,bufferindex:0,buffer:[""]})}})),ru=ry(n=>({xscroll:0,yscroll:0,cursor:0,select:void 0,reset(){n({xscroll:0,yscroll:0,cursor:0,select:void 0})}})),xv=ry(n=>({pts:[],cursor:void 0,select:void 0,reset(){n({pts:[],cursor:void 0,select:void 0})}}));var VC={exports:{}},zLe=VC.exports,SH;function HLe(){return SH||(SH=1,(function(n,e){(function(t,r){n.exports=r()})(zLe,(()=>(()=>{var t={944:function(o){var a;a=()=>(()=>{var c={d:(m,b)=>{for(var y in b)c.o(b,y)&&!c.o(m,y)&&Object.defineProperty(m,y,{enumerable:!0,get:b[y]})},o:(m,b)=>Object.prototype.hasOwnProperty.call(m,b)},l={};function u(m){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},u(m)}function h(m,b){var y=typeof Symbol<"u"&&m[Symbol.iterator]||m["@@iterator"];if(!y){if(Array.isArray(m)||(y=d(m))||b){y&&(m=y);var x=0,T=function(){};return{s:T,n:function(){return x>=m.length?{done:!0}:{done:!1,value:m[x++]}},e:function(B){throw B},f:T}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var k,R=!0,P=!1;return{s:function(){y=y.call(m)},n:function(){var B=y.next();return R=B.done,B},e:function(B){P=!0,k=B},f:function(){try{R||y.return==null||y.return()}finally{if(P)throw k}}}}function f(m,b){return(function(y){if(Array.isArray(y))return y})(m)||(function(y,x){var T=y==null?null:typeof Symbol<"u"&&y[Symbol.iterator]||y["@@iterator"];if(T!=null){var k,R,P,B,U=[],z=!0,I=!1;try{if(P=(T=T.call(y)).next,x!==0)for(;!(z=(k=P.call(T)).done)&&(U.push(k.value),U.length!==x);z=!0);}catch(L){I=!0,R=L}finally{try{if(!z&&T.return!=null&&(B=T.return(),Object(B)!==B))return}finally{if(I)throw R}}return U}})(m,b)||d(m,b)||(function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function d(m,b){if(m){if(typeof m=="string")return p(m,b);var y=Object.prototype.toString.call(m).slice(8,-1);return y==="Object"&&m.constructor&&(y=m.constructor.name),y==="Map"||y==="Set"?Array.from(m):y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(y)?p(m,b):void 0}}function p(m,b){(b==null||b>m.length)&&(b=m.length);for(var y=0,x=new Array(b);y<b;y++)x[y]=m[y];return x}function _(m,b){if(!(m instanceof b))throw new TypeError("Cannot call a class as a function")}c.d(l,{default:()=>g});var g=(function(){function m(){var x=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];_(this,m),this.strict=x,this.defaults=new Map,this.validators=new Map,this.types=new Map,this.optional=new Set,this.required=new Set}var b,y;return b=m,(y=[{key:"allowExtra",value:function(){return this.strict=!1,this}},{key:"setDefaults",value:function(x){var T=this;return Object.entries(x).forEach((function(k){var R=f(k,2),P=R[0],B=R[1];return T.defaults.set(P,B)})),this}},{key:"setValidators",value:function(x){var T=this;return Object.entries(x).forEach((function(k){var R=f(k,2),P=R[0],B=R[1];return T.validators.set(P,B)})),this}},{key:"setTypes",value:function(x){var T=this;return Object.entries(x).forEach((function(k){var R=f(k,2),P=R[0],B=R[1];return T.types.set(P,B)})),this}},{key:"setOptional",value:function(x){var T=this;return x.forEach((function(k){return T.optional.add(k)})),this}},{key:"setRequired",value:function(x){var T=this;return x.forEach((function(k){return T.required.add(k)})),this}},{key:"resolve",value:function(x){return this.validate(Object.assign(this.getDefaults(),x))}},{key:"getDefaults",value:function(){var x,T={},k=h(this.defaults);try{for(k.s();!(x=k.n()).done;){var R=f(x.value,2),P=R[0],B=R[1];T[P]=B}}catch(U){k.e(U)}finally{k.f()}return T}},{key:"validate",value:function(x){for(var T in x)this.validators.has(T)&&(x[T]=this.validators.get(T)(x[T]));for(var k in x){if(!this.optionExists(k))throw new Error('Unkown option "'.concat(k,'".'));this.checkType(k,x[k])}var R,P=h(this.required.values());try{for(P.s();!(R=P.n()).done;){var B=R.value;if(x[B]===void 0)throw new Error('Option "'.concat(B,'" is required.'))}}catch(U){P.e(U)}finally{P.f()}return x}},{key:"checkType",value:function(x,T){if(this.types.has(x)){var k=this.types.get(x),R=u(T);if(R!==k)throw new Error('Wrong value for option "'.concat(x,'": expected type "').concat(k,'", got "').concat(R,'".'))}}},{key:"optionExists",value:function(x){return!this.strict||this.defaults.has(x)||this.validators.has(x)||this.optional.has(x)||this.required.has(x)||this.types.has(x)}}])&&(function(x,T){for(var k=0;k<T.length;k++){var R=T[k];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(x,(P=(function(B,U){if(u(B)!=="object"||B===null)return B;var z=B[Symbol.toPrimitive];if(z!==void 0){var I=z.call(B,"string");if(u(I)!=="object")return I;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(B)})(R.key),u(P)==="symbol"?P:String(P)),R)}var P})(b.prototype,y),Object.defineProperty(b,"prototype",{writable:!1}),m})();return l.default})(),o.exports=a()},162:function(o){o.exports=(()=>{var a={d:(u,h)=>{for(var f in h)a.o(h,f)&&!a.o(u,f)&&Object.defineProperty(u,f,{enumerable:!0,get:h[f]})},o:(u,h)=>Object.prototype.hasOwnProperty.call(u,h)},c={};a.d(c,{default:()=>l});var l=(function(){function u(){(function(f,d){if(!(f instanceof d))throw new TypeError("Cannot call a class as a function")})(this,u),this._events={},this.on=this.addEventListener,this.off=this.removeEventListener}var h;return(h=[{key:"emit",value:function(f,d){if(Object.prototype.hasOwnProperty.call(this._events,f))for(var p=this._events[f],_={type:f,detail:d},g=p.length,m=0;m<g;m++)this.handle(p[m],_)}},{key:"handle",value:function(f,d){f(d)}},{key:"addEventListener",value:function(f,d){Object.prototype.hasOwnProperty.call(this._events,f)||(this._events[f]=[]),this._events[f].indexOf(d)<0&&this._events[f].push(d)}},{key:"removeEventListener",value:function(f,d){if(Object.prototype.hasOwnProperty.call(this._events,f)){var p=this._events[f],_=p.indexOf(d);_>=0&&p.splice(_,1),p.length===0&&delete this._events[f]}}}])&&(function(f,d){for(var p=0;p<d.length;p++){var _=d[p];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(f,_.key,_)}})(u.prototype,h),u})();return c.default})()}},r={};function i(o){var a=r[o];if(a!==void 0)return a.exports;var c=r[o]={exports:{}};return t[o].call(c.exports,c,c.exports,i),c.exports}i.n=o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return i.d(a,{a}),a},i.d=(o,a)=>{for(var c in a)i.o(a,c)&&!i.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:a[c]})},i.o=(o,a)=>Object.prototype.hasOwnProperty.call(o,a),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var s={};return(()=>{i.r(s),i.d(s,{GamepadHandler:()=>x,GamepadListener:()=>$});var o=i(162),a=i.n(o),c=i(944),l=i.n(c);function u(Y){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Q){return typeof Q}:function(Q){return Q&&typeof Symbol=="function"&&Q.constructor===Symbol&&Q!==Symbol.prototype?"symbol":typeof Q},u(Y)}function h(Y,Q){if(!(Y instanceof Q))throw new TypeError("Cannot call a class as a function")}function f(Y,Q){for(var q=0;q<Q.length;q++){var V=Q[q];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(Y,g(V.key),V)}}function d(Y,Q){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(q,V){return q.__proto__=V,q},d(Y,Q)}function p(Y,Q){if(Q&&(u(Q)==="object"||typeof Q=="function"))return Q;if(Q!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(q){if(q===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return q})(Y)}function _(Y){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(Q){return Q.__proto__||Object.getPrototypeOf(Q)},_(Y)}function g(Y){var Q=(function(q,V){if(u(q)!=="object"||q===null)return q;var K=q[Symbol.toPrimitive];if(K!==void 0){var ne=K.call(q,"string");if(u(ne)!=="object")return ne;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(q)})(Y);return u(Q)==="symbol"?Q:String(Q)}var m,b,y,x=(function(Y){(function(Te,Ie){if(typeof Ie!="function"&&Ie!==null)throw new TypeError("Super expression must either be null or a function");Te.prototype=Object.create(Ie&&Ie.prototype,{constructor:{value:Te,writable:!0,configurable:!0}}),Object.defineProperty(Te,"prototype",{writable:!1}),Ie&&d(Te,Ie)})(ae,Y);var Q,q,V,K,ne,ie=(K=ae,ne=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})(),function(){var Te,Ie=_(K);if(ne){var be=_(this).constructor;Te=Reflect.construct(Ie,arguments,be)}else Te=Ie.apply(this,arguments);return p(this,Te)});function ae(Te,Ie){var be,Pe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return h(this,ae),(be=ie.call(this)).index=Te,be.gamepad=Ie,be.options=be.constructor.resolveOptions(Pe),be.axes=new Array(Ie.axes.length).fill(null),be.buttons=new Array(Ie.buttons.length).fill(null),be.initAxes(),be.initButtons(),be}return Q=ae,V=[{key:"resolveOptions",value:function(Te){var Ie,be,Pe,$e,tt=Te.axis,qe=Te.button;return{axis:this.optionResolver.resolve((Ie=(be=tt??qe)!==null&&be!==void 0?be:Te)!==null&&Ie!==void 0?Ie:{}),button:this.optionResolver.resolve((Pe=($e=qe??tt)!==null&&$e!==void 0?$e:Te)!==null&&Pe!==void 0?Pe:{})}}}],(q=[{key:"initAxes",value:function(){for(var Te=this.axes.length,Ie=0;Ie<Te;Ie++)this.axes[Ie]=this.resolveAxisValue(Ie)}},{key:"initButtons",value:function(){for(var Te=this.buttons.length,Ie=0;Ie<Te;Ie++)this.buttons[Ie]=this.resolveButtonValue(Ie)}},{key:"update",value:function(Te){this.gamepad=Te,this.updateAxis(),this.updateButtons()}},{key:"updateAxis",value:function(){for(var Te=this.axes.length,Ie=0;Ie<Te;Ie++)this.setAxisValue(Ie,this.resolveAxisValue(Ie))}},{key:"updateButtons",value:function(){for(var Te=this.buttons.length,Ie=0;Ie<Te;Ie++)this.setButtonValue(Ie,this.resolveButtonValue(Ie))}},{key:"setAxisValue",value:function(Te,Ie){this.axes[Te]!==Ie&&(this.axes[Te]=Ie,this.emit("axis",{gamepad:this.gamepad,index:this.index,axis:Te,value:Ie}))}},{key:"setButtonValue",value:function(Te,Ie){this.buttons[Te]!==Ie&&(this.buttons[Te]=Ie,this.emit("button",{gamepad:this.gamepad,index:this.index,button:Te,pressed:this.gamepad.buttons[Te].pressed,value:Ie}))}},{key:"resolveAxisValue",value:function(Te){var Ie=this.options.axis,be=Ie.deadZone,Pe=Ie.analog,$e=Ie.precision,tt=this.gamepad.axes[Te];return be&&tt<be&&tt>-be?0:Pe?$e?Math.round(tt*$e)/$e:tt:tt>0?1:tt<0?-1:0}},{key:"resolveButtonValue",value:function(Te){var Ie=this.options.button,be=Ie.deadZone,Pe=Ie.analog,$e=Ie.precision,tt=this.gamepad.buttons[Te].value;return be>0&&tt<be&&tt>-be?0:Pe?$e?Math.round(tt*$e)/$e:tt:tt===0?0:1}}])&&f(Q.prototype,q),V&&f(Q,V),Object.defineProperty(Q,"prototype",{writable:!1}),ae})(a());function T(Y){return T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Q){return typeof Q}:function(Q){return Q&&typeof Symbol=="function"&&Q.constructor===Symbol&&Q!==Symbol.prototype?"symbol":typeof Q},T(Y)}function k(Y,Q){for(var q=0;q<Q.length;q++){var V=Q[q];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(Y,R(V.key),V)}}function R(Y){var Q=(function(q,V){if(T(q)!=="object"||q===null)return q;var K=q[Symbol.toPrimitive];if(K!==void 0){var ne=K.call(q,"string");if(T(ne)!=="object")return ne;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(q)})(Y);return T(Q)==="symbol"?Q:String(Q)}m=x,b="optionResolver",y=new(l())().setDefaults({analog:!0,deadZone:0,precision:0}).setTypes({analog:"boolean",deadZone:"number",precision:"number"}).setValidators({deadZone:function(Y){return Math.max(Math.min(Y,1),0)},precision:function(Y){return Y>0?Math.pow(10,Y):0}}),(b=g(b))in m?Object.defineProperty(m,b,{value:y,enumerable:!0,configurable:!0,writable:!0}):m[b]=y;var P=(function(){function Y(V){(function(K,ne){if(!(K instanceof ne))throw new TypeError("Cannot call a class as a function")})(this,Y),this.callback=V,this.frame=null,this.update=this.update.bind(this)}var Q,q;return Q=Y,(q=[{key:"setCallback",value:function(V){this.callback=V}},{key:"start",value:function(){this.frame||(this.frame=window.requestAnimationFrame(this.update))}},{key:"stop",value:function(){this.frame&&(window.cancelAnimationFrame(this.frame),this.frame=null)}},{key:"update",value:function(){this.frame=window.requestAnimationFrame(this.update),this.callback()}}])&&k(Q.prototype,q),Object.defineProperty(Q,"prototype",{writable:!1}),Y})();function B(Y){return B=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Q){return typeof Q}:function(Q){return Q&&typeof Symbol=="function"&&Q.constructor===Symbol&&Q!==Symbol.prototype?"symbol":typeof Q},B(Y)}function U(Y,Q){if(!(Y instanceof Q))throw new TypeError("Cannot call a class as a function")}function z(Y,Q){for(var q=0;q<Q.length;q++){var V=Q[q];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(Y,I(V.key),V)}}function I(Y){var Q=(function(q,V){if(B(q)!=="object"||q===null)return q;var K=q[Symbol.toPrimitive];if(K!==void 0){var ne=K.call(q,"string");if(B(ne)!=="object")return ne;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(q)})(Y);return B(Q)==="symbol"?Q:String(Q)}function L(Y,Q){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(q,V){return q.__proto__=V,q},L(Y,Q)}function M(Y,Q){if(Q&&(B(Q)==="object"||typeof Q=="function"))return Q;if(Q!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return F(Y)}function F(Y){if(Y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Y}function Z(Y){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(Q){return Q.__proto__||Object.getPrototypeOf(Q)},Z(Y)}var $=(function(Y){(function(ae,Te){if(typeof Te!="function"&&Te!==null)throw new TypeError("Super expression must either be null or a function");ae.prototype=Object.create(Te&&Te.prototype,{constructor:{value:ae,writable:!0,configurable:!0}}),Object.defineProperty(ae,"prototype",{writable:!1}),Te&&L(ae,Te)})(ie,Y);var Q,q,V,K,ne=(V=ie,K=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})(),function(){var ae,Te=Z(V);if(K){var Ie=Z(this).constructor;ae=Reflect.construct(Te,arguments,Ie)}else ae=Te.apply(this,arguments);return M(this,ae)});function ie(){var ae,Te=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(U(this,ie),ae=ne.call(this),typeof navigator.getGamepads!="function")throw new Error("This browser does not support gamepad API.");return ae.options=Te,ae.onAxis=ae.onAxis.bind(F(ae)),ae.update=ae.update.bind(F(ae)),ae.start=ae.start.bind(F(ae)),ae.stop=ae.stop.bind(F(ae)),ae.discover=ae.discover.bind(F(ae)),ae.onButton=ae.onButton.bind(F(ae)),ae.handlers=new Array(4).fill(null),ae.loop=new P(ae.update),window.addEventListener("error",ae.stop),ae}return Q=ie,(q=[{key:"start",value:function(){this.loop.start()}},{key:"stop",value:function(){this.loop.stop()}},{key:"update",value:function(){var ae=navigator.getGamepads();this.discover(ae[0],0),this.discover(ae[1],1),this.discover(ae[2],2),this.discover(ae[3],3)}},{key:"discover",value:function(ae,Te){ae?(this.handlers[Te]===null&&this.registerHandler(Te,ae),this.handlers[Te].update(ae)):this.handlers[Te]&&this.removeGamepad(Te)}},{key:"registerHandler",value:function(ae,Te){var Ie=new x(ae,Te,this.options);this.handlers[ae]=Ie,Ie.addEventListener("axis",this.onAxis),Ie.addEventListener("button",this.onButton),this.emit("gamepad:connected",{index:ae,gamepad:Te}),this.emit("gamepad:".concat(ae,":connected"),{index:ae,gamepad:Te})}},{key:"removeGamepad",value:function(ae){var Te=this.handlers[ae];Te.removeEventListener("axis",this.onAxis),Te.removeEventListener("button",this.onButton),this.handlers[ae]=null,this.emit("gamepad:disconnected",{index:ae}),this.emit("gamepad:".concat(ae,":disconnected"),{index:ae})}},{key:"onAxis",value:function(ae){var Te=ae.detail.index;this.emit("gamepad:axis",ae.detail),this.emit("gamepad:".concat(Te,":axis"),ae.detail),this.emit("gamepad:".concat(Te,":axis:").concat(ae.detail.axis),ae.detail)}},{key:"onButton",value:function(ae){var Te=ae.detail.index;this.emit("gamepad:button",ae.detail),this.emit("gamepad:".concat(Te,":button"),ae.detail),this.emit("gamepad:".concat(Te,":button:").concat(ae.detail.button),ae.detail)}}])&&z(Q.prototype,q),Object.defineProperty(Q,"prototype",{writable:!1}),ie})(a())})(),s})()))})(VC)),VC.exports}var VLe=HLe(),sp={},EH;function GLe(){if(EH)return sp;EH=1,Object.defineProperty(sp,"__esModule",{value:!0});for(var n=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),e={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},t={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:n?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},r={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},i=1;i<20;i++)r["f"+i]=111+i;function s(f,d,p){d&&!("byKey"in d)&&(p=d,d=null),Array.isArray(f)||(f=[f]);var _=f.map(function(b){return c(b,d)}),g=function(y){return _.some(function(x){return l(x,y)})},m=p==null?g:g(p);return m}function o(f,d){return s(f,d)}function a(f,d){return s(f,{byKey:!0},d)}function c(f,d){var p=d&&d.byKey,_={};f=f.replace("++","+add");var g=f.split("+"),m=g.length;for(var b in e)_[e[b]]=!1;var y=!0,x=!1,T=void 0;try{for(var k=g[Symbol.iterator](),R;!(y=(R=k.next()).done);y=!0){var P=R.value,B=P.endsWith("?")&&P.length>1;B&&(P=P.slice(0,-1));var U=h(P),z=e[U];if(P.length>1&&!z&&!t[P]&&!r[U])throw new TypeError('Unknown modifier: "'+P+'"');(m===1||!z)&&(p?_.key=U:_.which=u(P)),z&&(_[z]=B?null:!0)}}catch(I){x=!0,T=I}finally{try{!y&&k.return&&k.return()}finally{if(x)throw T}}return _}function l(f,d){for(var p in f){var _=f[p],g=void 0;if(_!=null&&(p==="key"&&d.key!=null?g=d.key.toLowerCase():p==="which"?g=_===91&&d.which===93?91:d.which:g=d[p],!(g==null&&_===!1)&&g!==_))return!1}return!0}function u(f){f=h(f);var d=r[f]||f.toUpperCase().charCodeAt(0);return d}function h(f){return f=f.toLowerCase(),f=t[f]||f,f}return sp.default=s,sp.isHotkey=s,sp.isCodeHotkey=o,sp.isKeyHotkey=a,sp.parseHotkey=c,sp.compareHotkey=l,sp.toKeyCode=u,sp.toKeyName=h,sp}var $Le=GLe();const xH=Dl($Le);function fee(n){return{all:n=n||new Map,on:function(e,t){var r=n.get(e);r?r.push(t):n.set(e,[t])},off:function(e,t){var r=n.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):n.set(e,[]))},emit:function(e,t){var r=n.get(e);r&&r.slice().map(function(i){i(t)}),(r=n.get("*"))&&r.slice().map(function(i){i(e,t)})}}}const eb={};function kU(n){return`${Qr()}local${n}`}const WLe=1e3,yE={};let uP=0,TH=performance.now();const wx=100,wH=[wt.MOVE_UP,wt.MOVE_DOWN,wt.MOVE_LEFT,wt.MOVE_RIGHT,wt.OK_BUTTON,wt.CANCEL_BUTTON,wt.MENU_BUTTON];function dee(){const n=performance.now(),e=n-TH,t=n0(eb);for(let r=0;r<t.length;++r){const i=parseFloat(t[r]);if(yE[i]=yE[i]??0,yE[i]+=e,yE[i]>=wx){yE[i]-=wx;const s=eb[i],o={alt:!!s[wt.ALT],ctrl:!!s[wt.CTRL],shift:!!s[wt.SHIFT]};for(let a=0;a<wH.length;++a){const c=wH[a];s[c]&&mee(i,c,o)}}}if(++uP,TH=n,setTimeout(dee,10),uP>WLe){uP=0;const r=n0(eb);for(let i=1;i<r.length;++i){const s=parseFloat(r[i]);IY(Ke,kU(s))}}}dee();function OU(n){return eb[n]=eb[n]??{[wt.NONE]:!1,[wt.ALT]:!1,[wt.CTRL]:!1,[wt.SHIFT]:!1,[wt.MOVE_UP]:!1,[wt.MOVE_DOWN]:!1,[wt.MOVE_LEFT]:!1,[wt.MOVE_RIGHT]:!1,[wt.OK_BUTTON]:!1,[wt.CANCEL_BUTTON]:!1,[wt.MENU_BUTTON]:!1},eb[n]}function fr(n,e){const t=OU(n);t[e]||(yE[n]=wx*-2,mee(n,e,{alt:t[wt.ALT],ctrl:t[wt.CTRL],shift:t[wt.SHIFT]})),t[e]=!0}function tr(n,e){const t=OU(n);t[e]=!1}const Lm={root:fee(),ignorehotkeys:!1},pee=Qe.createContext(Lm.root);function fR(n){return{alt:n.altKey,ctrl:vb?n.metaKey:n.ctrlKey,shift:n.shiftKey}}function mee(n,e,t){if(n===0)Lm.root.emit(wt[e],t);else{let r=0;const i=kU(n);t.alt&&(r|=v5),t.ctrl&&(r|=y5),t.shift&&(r|=b5),NY(Ke,i,e,r)}}window.addEventListener("wheel",n=>{n.preventDefault()},{passive:!1});window.addEventListener("keydown",n=>{const e=Jn(n.key),t=fR(n),r=Qr();switch(e){case"s":case"j":case"o":case"f":case"z":case"y":case"a":case"p":case"h":case"n":case"k":case"[":case"]":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"delete":case"backspace":(t.alt||t.ctrl||t.shift)&&n.preventDefault();break;case"tab":case"arrowleft":case"arrowright":case"arrowup":case"arrowdown":case"'":case'"':case"/":n.preventDefault();break}switch(t.alt?fr(0,wt.ALT):tr(0,wt.ALT),t.ctrl?fr(0,wt.CTRL):tr(0,wt.CTRL),t.shift?fr(0,wt.SHIFT):tr(0,wt.SHIFT),e){case"arrowleft":fr(0,wt.MOVE_LEFT),n.metaKey&&tr(0,wt.MOVE_LEFT);break;case"arrowright":fr(0,wt.MOVE_RIGHT),n.metaKey&&tr(0,wt.MOVE_RIGHT);break;case"arrowup":fr(0,wt.MOVE_UP),n.metaKey&&tr(0,wt.MOVE_UP);break;case"arrowdown":fr(0,wt.MOVE_DOWN),n.metaKey&&tr(0,wt.MOVE_DOWN);break;case"enter":fr(0,wt.OK_BUTTON);break;case"esc":case"escape":fr(0,wt.CANCEL_BUTTON);break;case"tab":fr(0,wt.MENU_BUTTON);break;case"s":t.ctrl&&$m(Ke,r,"#save");break;case"j":t.ctrl&&$m(Ke,r,t.shift?"#jointab hush":"#jointab");break;case"o":t.ctrl&&$m(Ke,r,t.shift?"#joincode hush":"#joincode");break;case"l":break;case"f":t.ctrl&&$m(Ke,r,"#fork");break;case"h":t.ctrl&&n6(Ke,r)}Lm.root.emit("keydown",n)},{capture:!0});window.addEventListener("keyup",n=>{const e=Jn(n.key),t=fR(n);switch(t.alt?fr(0,wt.ALT):tr(0,wt.ALT),t.ctrl?fr(0,wt.CTRL):tr(0,wt.CTRL),t.shift?fr(0,wt.SHIFT):tr(0,wt.SHIFT),e){case"meta":break;case"arrowleft":tr(0,wt.MOVE_LEFT);break;case"arrowright":tr(0,wt.MOVE_RIGHT);break;case"arrowup":tr(0,wt.MOVE_UP);break;case"arrowdown":tr(0,wt.MOVE_DOWN);break;case"enter":tr(0,wt.OK_BUTTON);break;case"esc":case"escape":tr(0,wt.CANCEL_BUTTON);break;case"tab":tr(0,wt.MENU_BUTTON);break}},{capture:!0});window.addEventListener("blur",()=>{tr(0,wt.ALT),tr(0,wt.CTRL),tr(0,wt.SHIFT),tr(0,wt.MOVE_UP),tr(0,wt.MOVE_DOWN),tr(0,wt.MOVE_LEFT),tr(0,wt.MOVE_RIGHT),tr(0,wt.OK_BUTTON),tr(0,wt.CANCEL_BUTTON),tr(0,wt.MENU_BUTTON)});y0("userinput",[],n=>{switch(n.target){case"up":Xt(n.data)&&tr(0,n.data);break;case"down":Xt(n.data)&&fr(0,n.data);break}});const gee=0,_ee=1,vee=2,yee=3,qLe=4,YLe=5,KLe=6,XLe=7,ZLe=9,JLe=12,QLe=13,e4e=14,t4e=15,hP={[yee]:wt.MOVE_UP,[gee]:wt.MOVE_DOWN,[vee]:wt.MOVE_LEFT,[_ee]:wt.MOVE_RIGHT,[qLe]:wt.CANCEL_BUTTON,[YLe]:wt.OK_BUTTON,[KLe]:wt.ALT,[XLe]:wt.CTRL,[ZLe]:wt.MENU_BUTTON,[JLe]:wt.MOVE_UP,[QLe]:wt.MOVE_DOWN,[e4e]:wt.MOVE_LEFT,[t4e]:wt.MOVE_RIGHT},fP={};function n4e(n){return fP[n]=fP[n]??{},fP[n]}function r4e(n,e,t){const r=n4e(n),i=F1(r[0]??0,r[1]??0),s=F1(r[2]??0,r[3]??0);r[e]=t;const o=F1(r[0]??0,r[1]??0),a=F1(r[2]??0,r[3]??0);if(i!==o)switch(tr(n,wt.MOVE_LEFT),tr(n,wt.MOVE_RIGHT),tr(n,wt.MOVE_UP),tr(n,wt.MOVE_DOWN),o){case hn.NORTH:fr(n,wt.MOVE_UP);break;case hn.SOUTH:fr(n,wt.MOVE_DOWN);break;case hn.WEST:fr(n,wt.MOVE_LEFT);break;case hn.EAST:fr(n,wt.MOVE_RIGHT);break}if(s!==a)switch(a===hn.IDLE?tr(n,wt.SHIFT):fr(n,wt.SHIFT),tr(n,wt.MOVE_LEFT),tr(n,wt.MOVE_RIGHT),tr(n,wt.MOVE_UP),tr(n,wt.MOVE_DOWN),a){case hn.NORTH:fr(n,wt.MOVE_UP);break;case hn.SOUTH:fr(n,wt.MOVE_DOWN);break;case hn.WEST:fr(n,wt.MOVE_LEFT);break;case hn.EAST:fr(n,wt.MOVE_RIGHT);break}}const dR=new VLe.GamepadListener({analog:!1,deadZone:.3});dR.on("gamepad:connected",n=>{const e=Qr();Qi(Ke,e,`connected ${n.detail.gamepad.id}`),OU(n.detail.index),n.detail.index>0&&TEe(Ke,kU(n.detail.index))});dR.on("gamepad:disconnected",n=>{const e=Qr();Qi(Ke,e,`disconnected gamepad ${n.detail.index}`),delete eb[n.detail.index]});dR.on("gamepad:axis",n=>{r4e(n.detail.index,n.detail.axis,n.detail.value)});dR.on("gamepad:button",n=>{const e=n.detail.index;switch(n.detail.button){case vee:case _ee:case yee:case gee:tr(e,wt.MOVE_UP),tr(e,wt.MOVE_DOWN),tr(e,wt.MOVE_LEFT),tr(e,wt.MOVE_RIGHT),n.detail.value?(fr(e,wt.SHIFT),fr(e,hP[n.detail.button])):tr(e,wt.SHIFT);break;default:n.detail.value?fr(e,hP[n.detail.button]):tr(e,hP[n.detail.button]);break}});dR.start();const AH="keyup";function tb({hotkey:n,althotkey:e,children:t}){return Qe.useEffect(()=>{const r=xH(n,{byKey:!0}),i=fe(e)?xH(e,{byKey:!0}):void 0;function s(o){Lm.ignorehotkeys===!1&&(r(o)||i?.(o))&&t()}return document.addEventListener(AH,s,!1),()=>document.removeEventListener(AH,s,!1)},[n,e,t]),null}function bo(n){const e=Qe.useContext(pee);return Qe.useEffect(()=>{const t=Object.entries(n);return t.forEach(([r,i])=>e.on(r,i)),()=>{t.forEach(([r,i])=>e.off(r,i))}},[e,n]),null}function iy({blockhotkeys:n,children:e}){const[t]=Qe.useState(()=>fee());return Qe.useEffect(()=>{const r=Lm.root,i=Lm.ignorehotkeys;return Lm.root=t,Lm.ignorehotkeys=!!n,()=>{Lm.root=r,Lm.ignorehotkeys=i}},[t,n]),xe.jsx(pee.Provider,{value:t,children:e})}function i4e(n){try{return sessionStorage.getItem(n)??void 0}catch(e){ur(ii,Io,`readsession ${n}`,e.message)}}function s4e(n,e){try{fe(e)?sessionStorage.setItem(n,e):sessionStorage.removeItem(n)}catch(t){ur(ii,Io,`writesession ${n} <- ${e}`,t.message)}}async function bee(){const n=await gU("cli");AU(Io,n)}async function See(){await Mh(1e3),Js(ii,Io,"try typing $green#help$blue and pressing enter!")}function o4e(){$m(ii,Io,"#pages")}function a4e(n){const e=n.map(r=>`${r}`).join(" ");return e.startsWith("!")?`!${e}`:`$onclear$blue${e}`}const RH=/\((\d+)\)/;function CH(n){const{terminal:e}=as.getState(),t=a4e(n.data),[r=""]=e.logs,i=[...e.logs],s=uH(r).replace(RH,""),o=uH(t),a=s.indexOf(o);if(o.length&&s.length&&a===0){const c=RH.exec(r);if(fe(c)){const l=parseFloat(c[1])+1;i.shift(),i.unshift(`(${l})${t}`)}else i.shift(),i.unshift(`(2)${t}`)}else{for(;i.length>=jLe;)i.pop();i.unshift(t),Ji.getState().ycursor>0&&Ji.setState(c=>({ycursor:c.ycursor+1,yselect:c.yselect?c.yselect+1:void 0}))}as.setState(c=>({terminal:{...c.terminal,logs:i}}))}function c4e(n){const{layout:e,editor:t}=as.getState();let i=e+(n?1:-1);if(i<0&&(i+=vd.MAX),i>=vd.MAX&&(i-=vd.MAX),!t.open)switch(i){case vd.SPLIT_X:i=vd.TOP;break}as.setState({layout:i})}async function l4e(n){if(n.length===0){ur(ii,Io,"content","no content found"),await bee(),MY(ii,Io),t6(ii,Io),await See();return}kY(ii,Io,n)}let dP=0;const MH=10,Io=i4e("PLAYER")??YEe();s4e("PLAYER",Io);let kH;function Qr(){return Io}const ii=y0("register",["ready","second","log","chat","toast"],function(n){if(!ii.session(n))return;switch(n.target){case"ready":case"chat":case"toast":case"second":break;default:if(n.player!==Io)return;break}const e=Jr.getState().gadget.board;switch(n.target){case"ready":{to(ii,n.player,async()=>{await ULe(Io);const t=await NLe();fe(t)&&Ji.setState({buffer:t.filter(r=>r.includes("#broadcast")===!1)}),await Mh(256),Qi(ii,Io,`myplayerid ${Io}`),gEe(ii,Io)});break}case"ackoperator":$Se(ii,Io),to(ii,n.player,async()=>{const t=await MU(Io);RQ()&&rn(t)?jSe(ii,Io,t):await l4e(t)});break;case"loginready":to(ii,n.player,async()=>{const t=await hee();xEe(ii,Io,t),MY(ii,Io)});break;case"loginfail":to(ii,n.player,async()=>{await bee(),o4e(),t6(ii,Io),Uh(ii,n.player,void 0,"text","sim:load",""),await See()});break;case"acklogin":Ow(ii,Io),Uh(ii,n.player,void 0,"text","sim:load","");break;case"ackzsswords":{Jr.setState({zsswords:n.data});const t=[],r=Object.values(n.data);for(let i=0;i<r.length;++i)t.push(...r[i]);break}case"input":if(Xn(n.data)){const[t,r]=n.data;r?(fr(0,wt.SHIFT),fr(0,t),tr(0,t),tr(0,wt.SHIFT)):(fr(0,t),tr(0,t))}break;case"store":to(ii,n.player,async()=>{if(Xn(n.data)){const[t,r]=n.data;await LLe(t,r)}});break;case"copy":rn(n.data)&&fe(ya())&&ya().writeText(n.data).then(()=>wY(ii,n.player,`copied! ${n.data.slice(0,200)}`)).catch(t=>console.error(t));break;case"downloadjsonfile":if(Xn(n.data)){const[t,r]=n.data;try{const i=new Blob([JSON.stringify({exported:r,data:t},null,2)],{type:"application/json;charset=utf-8"}),s=URL.createObjectURL(i),o=document.createElement("a");o.href=s,o.download=r,o.click(),URL.revokeObjectURL(s)}catch(i){console.error(i)}}break;case"share":to(ii,n.player,async function(){await BLe(n.player)});break;case"nuke":to(ii,n.player,async function(){Wv(ii,n.player,"nuke in"),Rh(ii,n.player,"3","..."),await Mh(1e3),Rh(ii,n.player,"2","..."),await Mh(1e3),Rh(ii,n.player,"1","..."),await Mh(1e3),Wv(ii,n.player,"BYE"),await Mh(100),FLe(n.player)});break;case"savemem":to(ii,n.player,async function(){if(Xn(n.data)){const[t,r,i]=n.data;rn(t)&&rn(r)&&Xn(i)&&i.every(bpe)&&await uee(n.player,t,r,r,i)}});break;case"forkmem":if(Xn(n.data)){const[t,r]=n.data;if(rn(t)&&rn(r)){const i=r?`https://${r}/#${t}`:location.href.replace(/#.*/,`#${t}`);window.open(i,"_blank")}}break;case"publishmem":to(ii,n.player,async()=>{if(Xn(n.data)){const[t,r]=n.data;switch(r){case"itchio":{const[,,i]=n.data;rn(t)&&rn(i)&&(Js(ii,n.player,`publishing ${i}`),await zDe(i,t),Js(ii,n.player,`$green${i} has been exported for upload to itch.io`));break}case"bbs":{const[,,i,s,o,...a]=n.data;if(rn(t)&&rn(i)&&rn(s)&&rn(o)){Js(ii,n.player,`publishing ${o}`);const c=await AQ(`${location.origin}/#${t}`);(await gPe(i,s,o,c,a)).success&&Js(ii,n.player,`$green${o} has been published to bbs`)}break}default:ur(ii,n.player,"publish",`unknown publish method ${r}`);break}}});break;case"second":++dP,dP>=MH&&(dP-=MH,IY(ii,Io));break;case"inspector":as.setState(t=>{const r=fe(n.data)?!!n.data:!t.inspector;return Qi(ii,n.player,`gadget inspector ${r?"$greenon":"$redoff"}`),r&&Qi(ii,n.player,"mouse click or tap elements to inspect"),{inspector:r}});break;case"findany":Xn(n.data)&&xv.setState({pts:n.data});break;case"log":CH(n);break;case"chat":{(n.player===""||n.player===e)&&CH(n);break}case"toast":if(fe(n.data)){clearTimeout(kH),as.setState({toast:n.data});const t=Math.max(n.data.length*150,3e3),r=Math.min(t,14e3);kH=setTimeout(()=>as.setState({toast:""}),r)}break;case"terminal:full":as.setState(t=>({layout:vd.FULL,terminal:{...t.terminal,open:!0}}));break;case"terminal:open":if(rn(n.data)){const t=Ji.getState().buffer;t[0]=n.data,Ji.setState({buffer:t,bufferindex:0,xcursor:n.data.length,ycursor:0,xselect:void 0,yselect:void 0})}as.setState(t=>({terminal:{...t.terminal,open:!0}}));break;case"terminal:quickopen":if(rn(n.data)){const t=Ji.getState().buffer;t[0]=n.data,Ji.setState({buffer:t,bufferindex:0,xcursor:n.data.length,ycursor:0,xselect:void 0,yselect:void 0})}as.setState({quickterminal:!0,layout:vd.TOP});break;case"terminal:close":as.setState(t=>({quickterminal:!1,terminal:{...t.terminal,open:!1}}));break;case"terminal:toggle":as.setState(t=>({terminal:{...t.terminal,open:!t.terminal.open}}));break;case"terminal:inclayout":ype(n.data)&&c4e(n.data);break;case"editor:open":if(Xn(n.data)){const[t,r,i,s]=n.data;as.setState(()=>({editor:{open:!0,player:n.player,book:t,path:r,type:i,title:s}}))}break;case"editor:close":as.setState(t=>({editor:{...t.editor,open:!1}}));break}}),Eee="15.1.22",OH=(n,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:n}),IH=(n,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:n}),l4=(n,e)=>({startTime:e,type:"setValue",value:n}),xee=(n,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:n}),Tee=(n,e,{startTime:t,target:r,timeConstant:i})=>r+(e-r)*Math.exp((t-n)/i),OE=n=>n.type==="exponentialRampToValue",ok=n=>n.type==="linearRampToValue",Tv=n=>OE(n)||ok(n),IU=n=>n.type==="setValue",Lg=n=>n.type==="setValueCurve",ak=(n,e,t,r)=>{const i=n[e];return i===void 0?r:Tv(i)||IU(i)?i.value:Lg(i)?i.values[i.values.length-1]:Tee(t,ak(n,e-1,i.startTime,r),i)},NH=(n,e,t,r,i)=>t===void 0?[r.insertTime,i]:Tv(t)?[t.endTime,t.value]:IU(t)?[t.startTime,t.value]:Lg(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,ak(n,e-1,t.startTime,i)],u4=n=>n.type==="cancelAndHold",h4=n=>n.type==="cancelScheduledValues",dv=n=>u4(n)||h4(n)?n.cancelTime:OE(n)||ok(n)?n.endTime:n.startTime,PH=(n,e,t,{endTime:r,value:i})=>t===i?i:0<t&&0<i||t<0&&i<0?t*(i/t)**((n-e)/(r-e)):0,DH=(n,e,t,{endTime:r,value:i})=>t+(n-e)/(r-e)*(i-t),u4e=(n,e)=>{const t=Math.floor(e),r=Math.ceil(e);return t===r?n[t]:(1-(e-t))*n[t]+(1-(r-e))*n[r]},h4e=(n,{duration:e,startTime:t,values:r})=>{const i=(n-t)/e*(r.length-1);return u4e(r,i)},H2=n=>n.type==="setTarget";class f4e{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=dv(e);if(u4(e)||h4(e)){const r=this._automationEvents.findIndex(s=>h4(e)&&Lg(s)?s.startTime+s.duration>=t:dv(s)>=t),i=this._automationEvents[r];if(r!==-1&&(this._automationEvents=this._automationEvents.slice(0,r)),u4(e)){const s=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&Tv(i)){if(s!==void 0&&H2(s))throw new Error("The internal list is malformed.");const o=s===void 0?i.insertTime:Lg(s)?s.startTime+s.duration:dv(s),a=s===void 0?this._defaultValue:Lg(s)?s.values[s.values.length-1]:s.value,c=OE(i)?PH(t,o,a,i):DH(t,o,a,i),l=OE(i)?OH(c,t,this._currenTime):IH(c,t,this._currenTime);this._automationEvents.push(l)}if(s!==void 0&&H2(s)&&this._automationEvents.push(l4(this.getValue(t),t)),s!==void 0&&Lg(s)&&s.startTime+s.duration>t){const o=t-s.startTime,a=(s.values.length-1)/s.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=s.values.slice(0,c);if(l<1)for(let h=1;h<c;h+=1){const f=l*h%1;u[h]=s.values[h-1]*(1-f)+s.values[h]*f}this._automationEvents[this._automationEvents.length-1]=xee(u,s.startTime,o)}}}else{const r=this._automationEvents.findIndex(o=>dv(o)>t),i=r===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[r-1];if(i!==void 0&&Lg(i)&&dv(i)+i.duration>t)return!1;const s=OE(e)?OH(e.value,e.endTime,this._currenTime):ok(e)?IH(e.value,t,this._currenTime):e;if(r===-1)this._automationEvents.push(s);else{if(Lg(e)&&t+e.duration>dv(this._automationEvents[r]))return!1;this._automationEvents.splice(r,0,s)}}return!0}flush(e){const t=this._automationEvents.findIndex(r=>dv(r)>e);if(t>1){const r=this._automationEvents.slice(t-1),i=r[0];H2(i)&&r.unshift(l4(ak(this._automationEvents,t-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=r}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(o=>dv(o)>e),r=this._automationEvents[t],i=(t===-1?this._automationEvents.length:t)-1,s=this._automationEvents[i];if(s!==void 0&&H2(s)&&(r===void 0||!Tv(r)||r.insertTime>e))return Tee(e,ak(this._automationEvents,i-1,s.startTime,this._defaultValue),s);if(s!==void 0&&IU(s)&&(r===void 0||!Tv(r)))return s.value;if(s!==void 0&&Lg(s)&&(r===void 0||!Tv(r)||s.startTime+s.duration>e))return e<s.startTime+s.duration?h4e(e,s):s.values[s.values.length-1];if(s!==void 0&&Tv(s)&&(r===void 0||!Tv(r)))return s.value;if(r!==void 0&&OE(r)){const[o,a]=NH(this._automationEvents,i,s,r,this._defaultValue);return PH(e,o,a,r)}if(r!==void 0&&ok(r)){const[o,a]=NH(this._automationEvents,i,s,r,this._defaultValue);return DH(e,o,a,r)}return this._defaultValue}}const d4e=n=>({cancelTime:n,type:"cancelAndHold"}),p4e=n=>({cancelTime:n,type:"cancelScheduledValues"}),m4e=(n,e)=>({endTime:e,type:"exponentialRampToValue",value:n}),g4e=(n,e)=>({endTime:e,type:"linearRampToValue",value:n}),_4e=(n,e,t)=>({startTime:e,target:n,timeConstant:t,type:"setTarget"}),v4e=()=>new DOMException("","AbortError"),y4e=n=>(e,t,[r,i,s],o)=>{n(e[i],[t,r,s],a=>a[0]===t&&a[1]===r,o)},b4e=n=>(e,t,r)=>{const i=[];for(let s=0;s<r.numberOfInputs;s+=1)i.push(new Set);n.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},S4e=n=>(e,t)=>{n.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},Ax=new WeakSet,wee=new WeakMap,NU=new WeakMap,Aee=new WeakMap,PU=new WeakMap,zO=new WeakMap,Ree=new WeakMap,f4=new WeakMap,d4=new WeakMap,p4=new WeakMap,Cee={construct(){return Cee}},E4e=n=>{try{const e=new Proxy(n,Cee);new e}catch{return!1}return!0},LH=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,UH=(n,e)=>{const t=[];let r=n.replace(/^[\s]+/,""),i=r.match(LH);for(;i!==null;){const s=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(s,new URL(s,e).toString());t.push(o),r=r.slice(i[0].length).replace(/^[\s]+/,""),i=r.match(LH)}return[t.join(";"),r]},BH=n=>{if(n!==void 0&&!Array.isArray(n))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},FH=n=>{if(!E4e(n))throw new TypeError("The given value for processorCtor should be a constructor.");if(n.prototype===null||typeof n.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},x4e=(n,e,t,r,i,s,o,a,c,l,u,h,f)=>{let d=0;return(p,_,g={credentials:"omit"})=>{const m=u.get(p);if(m!==void 0&&m.has(_))return Promise.resolve();const b=l.get(p);if(b!==void 0){const T=b.get(_);if(T!==void 0)return T}const y=s(p),x=y.audioWorklet===void 0?i(_).then(([T,k])=>{const[R,P]=UH(T,k),B=`${R};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${P}
})})(window,'_AWGS')`;return t(B)}).then(()=>{const T=f._AWGS.pop();if(T===void 0)throw new SyntaxError;r(y.currentTime,y.sampleRate,()=>T(class{},void 0,(k,R)=>{if(k.trim()==="")throw e();const P=d4.get(y);if(P!==void 0){if(P.has(k))throw e();FH(R),BH(R.parameterDescriptors),P.set(k,R)}else FH(R),BH(R.parameterDescriptors),d4.set(y,new Map([[k,R]]))},y.sampleRate,void 0,void 0))}):Promise.all([i(_),Promise.resolve(n(h,h))]).then(([[T,k],R])=>{const P=d+1;d=P;const[B,U]=UH(T,k),M=`${B};((AudioWorkletProcessor,registerProcessor)=>{${U}
})(${R?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${R?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${R?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${P}',class extends AudioWorkletProcessor{process(){return !1}})`,F=new Blob([M],{type:"application/javascript; charset=utf-8"}),Z=URL.createObjectURL(F);return y.audioWorklet.addModule(Z,g).then(()=>{if(a(y))return y;const $=o(y);return $.audioWorklet.addModule(Z,g).then(()=>$)}).then($=>{if(c===null)throw new SyntaxError;try{new c($,`__sac${P}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(Z))});return b===void 0?l.set(p,new Map([[_,x]])):b.set(_,x),x.then(()=>{const T=u.get(p);T===void 0?u.set(p,new Set([_])):T.add(_)}).finally(()=>{const T=l.get(p);T!==void 0&&T.delete(_)}),x}},xp=(n,e)=>{const t=n.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},HO=(n,e)=>{const t=Array.from(n).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[r]=t;return n.delete(r),r},Mee=(n,e,t,r)=>{const i=xp(n,e),s=HO(i,o=>o[0]===t&&o[1]===r);return i.size===0&&n.delete(e),s},pR=n=>xp(Ree,n),Rx=n=>{if(Ax.has(n))throw new Error("The AudioNode is already stored.");Ax.add(n),pR(n).forEach(e=>e(!0))},kee=n=>"port"in n,mR=n=>{if(!Ax.has(n))throw new Error("The AudioNode is not stored.");Ax.delete(n),pR(n).forEach(e=>e(!1))},m4=(n,e)=>{!kee(n)&&e.every(t=>t.size===0)&&mR(n)},T4e=(n,e,t,r,i,s,o,a,c,l,u,h,f)=>{const d=new WeakMap;return(p,_,g,m,b)=>{const{activeInputs:y,passiveInputs:x}=s(_),{outputs:T}=s(p),k=a(p),R=P=>{const B=c(_),U=c(p);if(P){const z=Mee(x,p,g,m);n(y,p,z,!1),!b&&!h(p)&&t(U,B,g,m),f(_)&&Rx(_)}else{const z=r(y,p,g,m);e(x,m,z,!1),!b&&!h(p)&&i(U,B,g,m);const I=o(_);if(I===0)u(_)&&m4(_,y);else{const L=d.get(_);L!==void 0&&clearTimeout(L),d.set(_,setTimeout(()=>{u(_)&&m4(_,y)},I*1e3))}}};return l(T,[_,g,m],P=>P[0]===_&&P[1]===g&&P[2]===m,!0)?(k.add(R),u(p)?n(y,p,[g,m,R],!0):e(x,m,[p,g,R],!0),!0):!1}},w4e=n=>(e,t,[r,i,s],o)=>{const a=e.get(r);a===void 0?e.set(r,new Set([[i,t,s]])):n(a,[i,t,s],c=>c[0]===i&&c[1]===t,o)},A4e=n=>(e,t)=>{const r=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(r).connect(e.destination);const i=()=>{t.removeEventListener("ended",i),t.disconnect(r),r.disconnect()};t.addEventListener("ended",i)},R4e=n=>(e,t)=>{n(e).add(t)},C4e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},M4e=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=i(a),u={...C4e,...c},h=r(l,u),f=s(l)?e():null;super(a,!1,h,f),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},mu=(n,e)=>n.context===e,k4e=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!mu(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=n(o,l)}return r.set(o,a),await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},ck=n=>{try{n.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},S0=()=>new DOMException("","IndexSizeError"),DU=n=>{n.getChannelData=(e=>t=>{try{return e.call(n,t)}catch(r){throw r.code===12?S0():r}})(n.getChannelData)},O4e={numberOfChannels:1},I4e=(n,e,t,r,i,s,o,a)=>{let c=null;return class Oee{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:f,sampleRate:d}={...O4e,...u};c===null&&(c=new i(1,1,44100));const p=r!==null&&e(s,s)?new r({length:h,numberOfChannels:f,sampleRate:d}):c.createBuffer(f,h,d);if(p.numberOfChannels===0)throw t();return typeof p.copyFromChannel!="function"?(o(p),DU(p)):e(ck,()=>ck(p))||a(p),n.add(p),p}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===Oee.prototype||n.has(u)}}},Ch=-34028234663852886e22,Iu=-Ch,Zg=n=>Ax.has(n),N4e={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},P4e=(n,e,t,r,i,s,o,a)=>class extends n{constructor(l,u){const h=s(l),f={...N4e,...u},d=i(h,f),p=o(h),_=p?e():null;super(l,!1,d,_),this._audioBufferSourceNodeRenderer=_,this._isBufferNullified=!1,this._isBufferSet=f.buffer!==null,this._nativeAudioBufferSourceNode=d,this._onended=null,this._playbackRate=t(this,p,d.playbackRate,Iu,Ch)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw r();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){Rx(this);const f=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",f),Zg(this)&&mR(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",f)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},D4e=(n,e,t,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const f=mu(h,u);if(!f){const d={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,d),o!==null&&h.start(...o),a!==null&&h.stop(a)}return s.set(u,h),f?await n(u,l.playbackRate,h.playbackRate):await r(u,l.playbackRate,h.playbackRate),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=s.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},L4e=n=>"playbackRate"in n,U4e=n=>"frequency"in n&&"gain"in n,B4e=n=>"offset"in n,F4e=n=>!("frequency"in n)&&"gain"in n,j4e=n=>"detune"in n&&"frequency"in n&&!("gain"in n),z4e=n=>"pan"in n,Bu=n=>xp(wee,n),gR=n=>xp(Aee,n),g4=(n,e)=>{const{activeInputs:t}=Bu(n);t.forEach(i=>i.forEach(([s])=>{e.includes(n)||g4(s,[...e,n])}));const r=L4e(n)?[n.playbackRate]:kee(n)?Array.from(n.parameters.values()):U4e(n)?[n.Q,n.detune,n.frequency,n.gain]:B4e(n)?[n.offset]:F4e(n)?[n.gain]:j4e(n)?[n.detune,n.frequency]:z4e(n)?[n.pan]:[];for(const i of r){const s=gR(i);s!==void 0&&s.activeInputs.forEach(([o])=>g4(o,e))}Zg(n)&&mR(n)},Iee=n=>{g4(n.destination,[])},H4e=n=>n===void 0||typeof n=="number"||typeof n=="string"&&(n==="balanced"||n==="interactive"||n==="playback"),V4e=(n,e,t,r,i,s,o,a,c)=>class extends n{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(p){throw p.code===12&&p.message==="sampleRate is not in range"?t():p}if(h===null)throw r();if(!H4e(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw t();super(h,2);const{latencyHint:f}=u,{sampleRate:d}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:f==="balanced"?512/d:f==="interactive"||f===void 0?256/d:f==="playback"?1024/d:Math.max(2,Math.min(128,Math.round(f*d/128)))*128/d,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const p=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",p)};h.addEventListener("statechange",p)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Iee(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new s(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{const f=()=>{this._nativeAudioContext.removeEventListener("statechange",f),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",f)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},G4e=(n,e,t,r,i,s,o,a)=>class extends n{constructor(l,u){const h=s(l),f=o(h),d=i(h,u,f),p=f?e(a):null;super(l,!1,d,p),this._isNodeOfNativeOfflineAudioContext=f,this._nativeAudioDestinationNode=d}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},$4e=n=>{const e=new WeakMap,t=async(r,i)=>{const s=i.destination;return e.set(i,s),await n(r,i,s),s};return{render(r,i){const s=e.get(i);return s!==void 0?Promise.resolve(s):t(r,i)}}},W4e=(n,e,t,r,i,s,o,a)=>(c,l)=>{const u=l.listener,h=()=>{const T=new Float32Array(1),k=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),R=o(l);let P=!1,B=[0,0,-1,0,1,0],U=[0,0,0];const z=()=>{if(P)return;P=!0;const F=r(l,256,9,0);F.onaudioprocess=({inputBuffer:Z})=>{const $=[s(Z,T,0),s(Z,T,1),s(Z,T,2),s(Z,T,3),s(Z,T,4),s(Z,T,5)];$.some((Q,q)=>Q!==B[q])&&(u.setOrientation(...$),B=$);const Y=[s(Z,T,6),s(Z,T,7),s(Z,T,8)];Y.some((Q,q)=>Q!==U[q])&&(u.setPosition(...Y),U=Y)},k.connect(F)},I=F=>Z=>{Z!==B[F]&&(B[F]=Z,u.setOrientation(...B))},L=F=>Z=>{Z!==U[F]&&(U[F]=Z,u.setPosition(...U))},M=(F,Z,$)=>{const Y=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Z});Y.connect(k,0,F),Y.start(),Object.defineProperty(Y.offset,"defaultValue",{get(){return Z}});const Q=n({context:c},R,Y.offset,Iu,Ch);return a(Q,"value",q=>()=>q.call(Q),q=>V=>{try{q.call(Q,V)}catch(K){if(K.code!==9)throw K}z(),R&&$(V)}),Q.cancelAndHoldAtTime=(q=>R?()=>{throw i()}:(...V)=>{const K=q.apply(Q,V);return z(),K})(Q.cancelAndHoldAtTime),Q.cancelScheduledValues=(q=>R?()=>{throw i()}:(...V)=>{const K=q.apply(Q,V);return z(),K})(Q.cancelScheduledValues),Q.exponentialRampToValueAtTime=(q=>R?()=>{throw i()}:(...V)=>{const K=q.apply(Q,V);return z(),K})(Q.exponentialRampToValueAtTime),Q.linearRampToValueAtTime=(q=>R?()=>{throw i()}:(...V)=>{const K=q.apply(Q,V);return z(),K})(Q.linearRampToValueAtTime),Q.setTargetAtTime=(q=>R?()=>{throw i()}:(...V)=>{const K=q.apply(Q,V);return z(),K})(Q.setTargetAtTime),Q.setValueAtTime=(q=>R?()=>{throw i()}:(...V)=>{const K=q.apply(Q,V);return z(),K})(Q.setValueAtTime),Q.setValueCurveAtTime=(q=>R?()=>{throw i()}:(...V)=>{const K=q.apply(Q,V);return z(),K})(Q.setValueCurveAtTime),Q};return{forwardX:M(0,0,I(0)),forwardY:M(1,0,I(1)),forwardZ:M(2,-1,I(2)),positionX:M(6,0,L(0)),positionY:M(7,0,L(1)),positionZ:M(8,0,L(2)),upX:M(3,0,I(3)),upY:M(4,1,I(4)),upZ:M(5,0,I(5))}},{forwardX:f,forwardY:d,forwardZ:p,positionX:_,positionY:g,positionZ:m,upX:b,upY:y,upZ:x}=u.forwardX===void 0?h():u;return{get forwardX(){return f},get forwardY(){return d},get forwardZ(){return p},get positionX(){return _},get positionY(){return g},get positionZ(){return m},get upX(){return b},get upY(){return y},get upZ(){return x}}},lk=n=>"context"in n,_R=n=>lk(n[0]),zb=(n,e,t,r)=>{for(const i of n)if(t(i)){if(r)return!1;throw Error("The set contains at least one similar element.")}return n.add(e),!0},jH=(n,e,[t,r],i)=>{zb(n,[e,t,r],s=>s[0]===e&&s[1]===t,i)},zH=(n,[e,t,r],i)=>{const s=n.get(e);s===void 0?n.set(e,new Set([[t,r]])):zb(s,[t,r],o=>o[0]===t,i)},Zx=n=>"inputs"in n,uk=(n,e,t,r)=>{if(Zx(e)){const i=e.inputs[r];return n.connect(i,t,0),[i,t,0]}return n.connect(e,t,r),[e,t,r]},Nee=(n,e,t)=>{for(const r of n)if(r[0]===e&&r[1]===t)return n.delete(r),r;return null},q4e=(n,e,t)=>HO(n,r=>r[0]===e&&r[1]===t),Pee=(n,e)=>{if(!pR(n).delete(e))throw new Error("Missing the expected event listener.")},Dee=(n,e,t)=>{const r=xp(n,e),i=HO(r,s=>s[0]===t);return r.size===0&&n.delete(e),i},hk=(n,e,t,r)=>{Zx(e)?n.disconnect(e.inputs[r],t,0):n.disconnect(e,t,r)},yo=n=>xp(NU,n),TA=n=>xp(PU,n),bb=n=>f4.has(n),GC=n=>!Ax.has(n),HH=(n,e)=>new Promise(t=>{if(e!==null)t(!0);else{const r=n.createScriptProcessor(256,1,1),i=n.createGain(),s=n.createBuffer(1,2,44100),o=s.getChannelData(0);o[0]=1,o[1]=1;const a=n.createBufferSource();a.buffer=s,a.loop=!0,a.connect(r).connect(n.destination),a.connect(i),a.disconnect(i),r.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?t(!0):t(!1),a.stop(),r.onaudioprocess=null,a.disconnect(r),r.disconnect(n.destination)},a.start()}}),pP=(n,e)=>{const t=new Map;for(const r of n)for(const i of r){const s=t.get(i);t.set(i,s===void 0?1:s+1)}t.forEach((r,i)=>e(i,r))},fk=n=>"context"in n,Y4e=n=>{const e=new Map;n.connect=(t=>(r,i=0,s=0)=>{const o=fk(r)?t(r,i,s):t(r,i),a=e.get(r);return a===void 0?e.set(r,[{input:s,output:i}]):a.every(c=>c.input!==s||c.output!==i)&&a.push({input:s,output:i}),o})(n.connect.bind(n)),n.disconnect=(t=>(r,i,s)=>{if(t.apply(n),r===void 0)e.clear();else if(typeof r=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==r);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(r))if(i===void 0)e.delete(r);else{const o=e.get(r);if(o!==void 0){const a=o.filter(c=>c.output!==i&&(c.input!==s||s===void 0));a.length===0?e.delete(r):e.set(r,a)}}for(const[o,a]of e)a.forEach(c=>{fk(o)?n.connect(o,c.output,c.input):n.connect(o,c.output)})})(n.disconnect)},K4e=(n,e,t,r)=>{const{activeInputs:i,passiveInputs:s}=gR(e),{outputs:o}=Bu(n),a=pR(n),c=l=>{const u=yo(n),h=TA(e);if(l){const f=Dee(s,n,t);jH(i,n,f,!1),!r&&!bb(n)&&u.connect(h,t)}else{const f=q4e(i,n,t);zH(s,f,!1),!r&&!bb(n)&&u.disconnect(h,t)}};return zb(o,[e,t],l=>l[0]===e&&l[1]===t,!0)?(a.add(c),Zg(n)?jH(i,n,[t,c],!0):zH(s,[n,t,c],!0),!0):!1},X4e=(n,e,t,r)=>{const{activeInputs:i,passiveInputs:s}=Bu(e),o=Nee(i[r],n,t);return o===null?[Mee(s,n,t,r)[2],!1]:[o[2],!0]},Z4e=(n,e,t)=>{const{activeInputs:r,passiveInputs:i}=gR(e),s=Nee(r,n,t);return s===null?[Dee(i,n,t)[1],!1]:[s[2],!0]},LU=(n,e,t,r,i)=>{const[s,o]=X4e(n,t,r,i);if(s!==null&&(Pee(n,s),o&&!e&&!bb(n)&&hk(yo(n),yo(t),r,i)),Zg(t)){const{activeInputs:a}=Bu(t);m4(t,a)}},UU=(n,e,t,r)=>{const[i,s]=Z4e(n,t,r);i!==null&&(Pee(n,i),s&&!e&&!bb(n)&&yo(n).disconnect(TA(t),r))},J4e=(n,e)=>{const t=Bu(n),r=[];for(const i of t.outputs)_R(i)?LU(n,e,...i):UU(n,e,...i),r.push(i[0]);return t.outputs.clear(),r},Q4e=(n,e,t)=>{const r=Bu(n),i=[];for(const s of r.outputs)s[1]===t&&(_R(s)?LU(n,e,...s):UU(n,e,...s),i.push(s[0]),r.outputs.delete(s));return i},e5e=(n,e,t,r,i)=>{const s=Bu(n);return Array.from(s.outputs).filter(o=>o[0]===t&&(r===void 0||o[1]===r)&&(i===void 0||o[2]===i)).map(o=>(_R(o)?LU(n,e,...o):UU(n,e,...o),s.outputs.delete(o),o[0]))},t5e=(n,e,t,r,i,s,o,a,c,l,u,h,f,d,p,_)=>class extends l{constructor(m,b,y,x){super(y),this._context=m,this._nativeAudioNode=y;const T=u(m);h(T)&&t(HH,()=>HH(T,_))!==!0&&Y4e(y),NU.set(this,y),Ree.set(this,new Set),m.state!=="closed"&&b&&Rx(this),n(this,x,y)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(m){this._nativeAudioNode.channelCount=m}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(m){this._nativeAudioNode.channelCountMode=m}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(m){this._nativeAudioNode.channelInterpretation=m}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(m,b=0,y=0){if(b<0||b>=this._nativeAudioNode.numberOfOutputs)throw i();const x=u(this._context),T=p(x);if(f(m)||d(m))throw s();if(lk(m)){const P=yo(m);try{const U=uk(this._nativeAudioNode,P,b,y),z=GC(this);(T||z)&&this._nativeAudioNode.disconnect(...U),this.context.state!=="closed"&&!z&&GC(m)&&Rx(m)}catch(U){throw U.code===12?s():U}if(e(this,m,b,y,T)){const U=c([this],m);pP(U,r(T))}return m}const k=TA(m);if(k.name==="playbackRate"&&k.maxValue===1024)throw o();try{this._nativeAudioNode.connect(k,b),(T||GC(this))&&this._nativeAudioNode.disconnect(k,b)}catch(P){throw P.code===12?s():P}if(K4e(this,m,b,T)){const P=c([this],m);pP(P,r(T))}}disconnect(m,b,y){let x;const T=u(this._context),k=p(T);if(m===void 0)x=J4e(this,k);else if(typeof m=="number"){if(m<0||m>=this.numberOfOutputs)throw i();x=Q4e(this,k,m)}else{if(b!==void 0&&(b<0||b>=this.numberOfOutputs)||lk(m)&&y!==void 0&&(y<0||y>=m.numberOfInputs))throw i();if(x=e5e(this,k,m,b,y),x.length===0)throw s()}for(const R of x){const P=c([this],R);pP(P,a)}}},n5e=(n,e,t,r,i,s,o,a,c,l,u,h,f)=>(d,p,_,g=null,m=null)=>{const b=_.value,y=new f4e(b),x=p?r(y):null,T={get defaultValue(){return b},get maxValue(){return g===null?_.maxValue:g},get minValue(){return m===null?_.minValue:m},get value(){return _.value},set value(k){_.value=k,T.setValueAtTime(k,d.context.currentTime)},cancelAndHoldAtTime(k){if(typeof _.cancelAndHoldAtTime=="function")x===null&&y.flush(d.context.currentTime),y.add(i(k)),_.cancelAndHoldAtTime(k);else{const R=Array.from(y).pop();x===null&&y.flush(d.context.currentTime),y.add(i(k));const P=Array.from(y).pop();_.cancelScheduledValues(k),R!==P&&P!==void 0&&(P.type==="exponentialRampToValue"?_.exponentialRampToValueAtTime(P.value,P.endTime):P.type==="linearRampToValue"?_.linearRampToValueAtTime(P.value,P.endTime):P.type==="setValue"?_.setValueAtTime(P.value,P.startTime):P.type==="setValueCurve"&&_.setValueCurveAtTime(P.values,P.startTime,P.duration))}return T},cancelScheduledValues(k){return x===null&&y.flush(d.context.currentTime),y.add(s(k)),_.cancelScheduledValues(k),T},exponentialRampToValueAtTime(k,R){if(k===0)throw new RangeError;if(!Number.isFinite(R)||R<0)throw new RangeError;const P=d.context.currentTime;return x===null&&y.flush(P),Array.from(y).length===0&&(y.add(l(b,P)),_.setValueAtTime(b,P)),y.add(o(k,R)),_.exponentialRampToValueAtTime(k,R),T},linearRampToValueAtTime(k,R){const P=d.context.currentTime;return x===null&&y.flush(P),Array.from(y).length===0&&(y.add(l(b,P)),_.setValueAtTime(b,P)),y.add(a(k,R)),_.linearRampToValueAtTime(k,R),T},setTargetAtTime(k,R,P){return x===null&&y.flush(d.context.currentTime),y.add(c(k,R,P)),_.setTargetAtTime(k,R,P),T},setValueAtTime(k,R){return x===null&&y.flush(d.context.currentTime),y.add(l(k,R)),_.setValueAtTime(k,R),T},setValueCurveAtTime(k,R,P){const B=k instanceof Float32Array?k:new Float32Array(k);if(h!==null&&h.name==="webkitAudioContext"){const U=R+P,z=d.context.sampleRate,I=Math.ceil(R*z),L=Math.floor(U*z),M=L-I,F=new Float32Array(M);for(let $=0;$<M;$+=1){const Y=(B.length-1)/P*((I+$)/z-R),Q=Math.floor(Y),q=Math.ceil(Y);F[$]=Q===q?B[Q]:(1-(Y-Q))*B[Q]+(1-(q-Y))*B[q]}x===null&&y.flush(d.context.currentTime),y.add(u(F,R,P)),_.setValueCurveAtTime(F,R,P);const Z=L/z;Z<U&&f(T,F[F.length-1],Z),f(T,B[B.length-1],U)}else x===null&&y.flush(d.context.currentTime),y.add(u(B,R,P)),_.setValueCurveAtTime(B,R,P);return T}};return t.set(T,_),e.set(T,d),n(T,x),T},r5e=n=>({replay(e){for(const t of n)if(t.type==="exponentialRampToValue"){const{endTime:r,value:i}=t;e.exponentialRampToValueAtTime(i,r)}else if(t.type==="linearRampToValue"){const{endTime:r,value:i}=t;e.linearRampToValueAtTime(i,r)}else if(t.type==="setTarget"){const{startTime:r,target:i,timeConstant:s}=t;e.setTargetAtTime(i,r,s)}else if(t.type==="setValue"){const{startTime:r,value:i}=t;e.setValueAtTime(i,r)}else if(t.type==="setValueCurve"){const{duration:r,startTime:i,values:s}=t;e.setValueCurveAtTime(s,i,r)}else throw new Error("Can't apply an unknown automation.")}});class Lee{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((r,i)=>e.call(t,r,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const i5e={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},s5e=(n,e,t,r,i,s,o,a,c,l,u,h,f,d)=>class extends e{constructor(_,g,m){var b;const y=a(_),x=c(y),T=u({...i5e,...m});f(T);const k=d4.get(y),R=k?.get(g),P=x||y.state!=="closed"?y:(b=o(y))!==null&&b!==void 0?b:y,B=i(P,x?null:_.baseLatency,l,g,R,T),U=x?r(g,T,R):null;super(_,!0,B,U);const z=[];B.parameters.forEach((L,M)=>{const F=t(this,x,L);z.push([M,F])}),this._nativeAudioWorkletNode=B,this._onprocessorerror=null,this._parameters=new Lee(z),x&&n(y,this);const{activeInputs:I}=s(this);h(B,I)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(_){const g=typeof _=="function"?d(this,_):null;this._nativeAudioWorkletNode.onprocessorerror=g;const m=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=m!==null&&m===g?_:m}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function dk(n,e,t,r,i){if(typeof n.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),n.copyFromChannel(e[t],r,i);else{const s=n.getChannelData(r);if(e[t].byteLength===0)e[t]=s.slice(i,i+128);else{const o=new Float32Array(s.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(o)}}}const Uee=(n,e,t,r,i)=>{typeof n.copyToChannel=="function"?e[t].byteLength!==0&&n.copyToChannel(e[t],r,i):e[t].byteLength!==0&&n.getChannelData(r).set(e[t],i)},pk=(n,e)=>{const t=[];for(let r=0;r<n;r+=1){const i=[],s=typeof e=="number"?e:e[r];for(let o=0;o<s;o+=1)i.push(new Float32Array(128));t.push(i)}return t},o5e=(n,e)=>{const t=xp(p4,n),r=yo(e);return xp(t,r)},a5e=async(n,e,t,r,i,s,o)=>{const a=e===null?Math.ceil(n.context.length/128)*128:e.length,c=r.channelCount*r.numberOfInputs,l=i.reduce((g,m)=>g+m,0),u=l===0?null:t.createBuffer(l,a,t.sampleRate);if(s===void 0)throw new Error("Missing the processor constructor.");const h=Bu(n),f=await o5e(t,n),d=pk(r.numberOfInputs,r.channelCount),p=pk(r.numberOfOutputs,i),_=Array.from(n.parameters.keys()).reduce((g,m)=>({...g,[m]:new Float32Array(128)}),{});for(let g=0;g<a;g+=128){if(r.numberOfInputs>0&&e!==null)for(let m=0;m<r.numberOfInputs;m+=1)for(let b=0;b<r.channelCount;b+=1)dk(e,d[m],b,b,g);s.parameterDescriptors!==void 0&&e!==null&&s.parameterDescriptors.forEach(({name:m},b)=>{dk(e,_,m,c+b,g)});for(let m=0;m<r.numberOfInputs;m+=1)for(let b=0;b<i[m];b+=1)p[m][b].byteLength===0&&(p[m][b]=new Float32Array(128));try{const m=d.map((y,x)=>h.activeInputs[x].size===0?[]:y),b=o(g/t.sampleRate,t.sampleRate,()=>f.process(m,p,_));if(u!==null)for(let y=0,x=0;y<r.numberOfOutputs;y+=1){for(let T=0;T<i[y];T+=1)Uee(u,p[y],T,x+T,g);x+=i[y]}if(!b)break}catch(m){n.dispatchEvent(new ErrorEvent("processorerror",{colno:m.colno,filename:m.filename,lineno:m.lineno,message:m.message}));break}}return u},c5e=(n,e,t,r,i,s,o,a,c,l,u,h,f,d,p,_)=>(g,m,b)=>{const y=new WeakMap;let x=null;const T=async(k,R)=>{let P=u(k),B=null;const U=mu(P,R),z=Array.isArray(m.outputChannelCount)?m.outputChannelCount:Array.from(m.outputChannelCount);if(h===null){const I=z.reduce((Z,$)=>Z+$,0),L=i(R,{channelCount:Math.max(1,I),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,I)}),M=[];for(let Z=0;Z<k.numberOfOutputs;Z+=1)M.push(r(R,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:z[Z]}));const F=o(R,{channelCount:m.channelCount,channelCountMode:m.channelCountMode,channelInterpretation:m.channelInterpretation,gain:1});F.connect=e.bind(null,M),F.disconnect=c.bind(null,M),B=[L,M,F]}else U||(P=new h(R,g));if(y.set(R,B===null?P:B[2]),B!==null){if(x===null){if(b===void 0)throw new Error("Missing the processor constructor.");if(f===null)throw new Error("Missing the native OfflineAudioContext constructor.");const $=k.channelCount*k.numberOfInputs,Y=b.parameterDescriptors===void 0?0:b.parameterDescriptors.length,Q=$+Y;x=a5e(k,Q===0?null:await(async()=>{const V=new f(Q,Math.ceil(k.context.length/128)*128,R.sampleRate),K=[],ne=[];for(let Te=0;Te<m.numberOfInputs;Te+=1)K.push(o(V,{channelCount:m.channelCount,channelCountMode:m.channelCountMode,channelInterpretation:m.channelInterpretation,gain:1})),ne.push(i(V,{channelCount:m.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:m.channelCount}));const ie=await Promise.all(Array.from(k.parameters.values()).map(async Te=>{const Ie=s(V,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Te.value});return await d(V,Te,Ie.offset),Ie})),ae=r(V,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,$+Y)});for(let Te=0;Te<m.numberOfInputs;Te+=1){K[Te].connect(ne[Te]);for(let Ie=0;Ie<m.channelCount;Ie+=1)ne[Te].connect(ae,Ie,Te*m.channelCount+Ie)}for(const[Te,Ie]of ie.entries())Ie.connect(ae,0,$+Te),Ie.start(0);return ae.connect(V.destination),await Promise.all(K.map(Te=>p(k,V,Te))),_(V)})(),R,m,z,b,l)}const I=await x,L=t(R,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[M,F,Z]=B;I!==null&&(L.buffer=I,L.start(0)),L.connect(M);for(let $=0,Y=0;$<k.numberOfOutputs;$+=1){const Q=F[$];for(let q=0;q<z[$];q+=1)M.connect(Q,Y+q,q);Y+=z[$]}return Z}if(U)for(const[I,L]of k.parameters.entries())await n(R,L,P.parameters.get(I));else for(const[I,L]of k.parameters.entries())await d(R,L,P.parameters.get(I));return await p(k,R,P),P};return{render(k,R){a(R,k);const P=y.get(R);return P!==void 0?Promise.resolve(P):T(k,R)}}},l5e=(n,e,t,r,i,s,o,a,c,l,u,h,f,d,p,_,g,m,b,y)=>class extends p{constructor(T,k){super(T,k),this._nativeContext=T,this._audioWorklet=n===void 0?void 0:{addModule:(R,P)=>n(this,R,P)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(T,k,R){return new t({length:k,numberOfChannels:T,sampleRate:R})}createBufferSource(){return new r(this)}createChannelMerger(T=6){return new s(this,{numberOfInputs:T})}createChannelSplitter(T=6){return new o(this,{numberOfOutputs:T})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(T=1){return new u(this,{maxDelayTime:T})}createDynamicsCompressor(){return new h(this)}createGain(){return new f(this)}createIIRFilter(T,k){return new d(this,{feedback:k,feedforward:T})}createOscillator(){return new _(this)}createPanner(){return new g(this)}createPeriodicWave(T,k,R={disableNormalization:!1}){return new m(this,{...R,imag:k,real:T})}createStereoPanner(){return new b(this)}createWaveShaper(){return new y(this)}decodeAudioData(T,k,R){return l(this._nativeContext,T).then(P=>(typeof k=="function"&&k(P),P),P=>{throw typeof R=="function"&&R(P),P})}},u5e={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},h5e=(n,e,t,r,i,s,o,a)=>class extends n{constructor(l,u){const h=s(l),f={...u5e,...u},d=i(h,f),p=o(h),_=p?t():null;super(l,!1,d,_),this._Q=e(this,p,d.Q,Iu,Ch),this._detune=e(this,p,d.detune,1200*Math.log2(Iu),-1200*Math.log2(Iu)),this._frequency=e(this,p,d.frequency,l.sampleRate/2,0),this._gain=e(this,p,d.gain,40*Math.log10(Iu),Ch),this._nativeBiquadFilterNode=d,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(f){throw f.code===11?r():f}if(l.length!==u.length||u.length!==h.length)throw r()}},f5e=(n,e,t,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=t(a);const u=mu(l,c);if(!u){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,h)}return s.set(c,l),u?(await n(c,a.Q,l.Q),await n(c,a.detune,l.detune),await n(c,a.frequency,l.frequency),await n(c,a.gain,l.gain)):(await r(c,a.Q,l.Q),await r(c,a.detune,l.detune),await r(c,a.frequency,l.frequency),await r(c,a.gain,l.gain)),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},d5e=(n,e)=>(t,r)=>{const i=e.get(t);if(i!==void 0)return i;const s=n.get(t);if(s!==void 0)return s;try{const o=r();return o instanceof Promise?(n.set(t,o),o.catch(()=>!1).then(a=>(n.delete(t),e.set(t,a),a))):(e.set(t,o),o)}catch{return e.set(t,!1),!1}},p5e={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},m5e=(n,e,t,r,i)=>class extends n{constructor(o,a){const c=r(o),l={...p5e,...a},u=t(c,l),h=i(c)?e():null;super(o,!1,u,h)}},g5e=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!mu(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=n(o,l)}return r.set(o,a),await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},_5e={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},v5e=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=r(a),u=s({..._5e,...c}),h=t(l,u),f=i(l)?e():null;super(a,!1,h,f)}},y5e=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!mu(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=n(o,l)}return r.set(o,a),await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},b5e=n=>(e,t,r)=>n(t,e,r),S5e=n=>(e,t,r=0,i=0)=>{const s=e[r];if(s===void 0)throw n();return fk(t)?s.connect(t,0,i):s.connect(t,0)},E5e=n=>(e,t)=>{const r=n(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return r.buffer=i,r.loop=!0,r.connect(t),r.start(),()=>{r.stop(),r.disconnect(t)}},x5e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},T5e=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...x5e,...l},f=r(u,h),d=s(u),p=d?t():null;super(c,!1,f,p),this._constantSourceNodeRenderer=p,this._nativeConstantSourceNode=f,this._offset=e(this,d,f.offset,Iu,Ch),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){Rx(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),Zg(this)&&mR(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},w5e=(n,e,t,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const f=mu(h,u);if(!f){const d={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,d),o!==null&&h.start(o),a!==null&&h.stop(a)}return s.set(u,h),f?await n(u,l.offset,h.offset):await r(u,l.offset,h.offset),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=s.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},A5e=n=>e=>(n[0]=e,n[0]),R5e={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},C5e=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=r(a),u={...R5e,...c},h=t(l,u),d=i(l)?e():null;super(a,!1,h,d),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&s(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,s(this,0)}else this._isBufferNullified=!1,s(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},M5e=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!mu(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=n(o,l)}return r.set(o,a),Zx(a)?await t(s,o,a.inputs[0]):await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},k5e=(n,e)=>(t,r,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,r,i)}catch(s){throw s.name==="SyntaxError"?n():s}},O5e=()=>new DOMException("","DataCloneError"),VH=n=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(r=>{const i=()=>{t.onmessage=null,e.close(),t.close(),r()};t.onmessage=()=>i();try{e.postMessage(n,[n])}catch{}finally{i()}})},I5e=(n,e,t,r,i,s,o,a,c,l,u)=>(h,f)=>{const d=o(h)?h:s(h);if(i.has(f)){const p=t();return Promise.reject(p)}try{i.add(f)}catch{}return e(c,()=>c(d))?d.decodeAudioData(f).then(p=>(VH(f).catch(()=>{}),e(a,()=>a(p))||u(p),n.add(p),p)):new Promise((p,_)=>{const g=async()=>{try{await VH(f)}catch{}},m=b=>{_(b),g()};try{d.decodeAudioData(f,b=>{typeof b.copyFromChannel!="function"&&(l(b),DU(b)),n.add(b),g().then(()=>p(b))},b=>{m(b===null?r():b)})}catch(b){m(b)}})},N5e=(n,e,t,r,i,s,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const h=s(c.context),f=a(h);if(u===l){if(e.delete(c),!f&&o(c)){const d=r(c),{outputs:p}=t(c);for(const _ of p)if(_R(_)){const g=r(_[0]);n(d,g,_[1],_[2])}else{const g=i(_[0]);d.connect(g,_[1])}}}else e.set(c,u-l)},P5e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},D5e=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...P5e,...l},f=r(u,h),d=s(u),p=d?t(h.maxDelayTime):null;super(c,!1,f,p),this._delayTime=e(this,d,f.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},L5e=(n,e,t,r,i)=>s=>{const o=new WeakMap,a=async(c,l)=>{let u=t(c);const h=mu(u,l);if(!h){const f={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:s};u=e(l,f)}return o.set(l,u),h?await n(l,c.delayTime,u.delayTime):await r(l,c.delayTime,u.delayTime),await i(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},U5e=n=>(e,t,r,i)=>n(e[i],s=>s[0]===t&&s[1]===r),B5e=n=>(e,t)=>{n(e).delete(t)},F5e=n=>"delayTime"in n,j5e=(n,e,t)=>function r(i,s){const o=lk(s)?s:t(n,s);if(F5e(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>r([...i,o],c[0])).reduce((c,l)=>c.concat(l),[])},V2=(n,e,t)=>{const r=e[t];if(r===void 0)throw n();return r},z5e=n=>(e,t=void 0,r=void 0,i=0)=>t===void 0?e.forEach(s=>s.disconnect()):typeof t=="number"?V2(n,e,t).disconnect():fk(t)?r===void 0?e.forEach(s=>s.disconnect(t)):i===void 0?V2(n,e,r).disconnect(t,0):V2(n,e,r).disconnect(t,0,i):r===void 0?e.forEach(s=>s.disconnect(t)):V2(n,e,r).disconnect(t,0),H5e={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},V5e=(n,e,t,r,i,s,o,a)=>class extends n{constructor(l,u){const h=s(l),f={...H5e,...u},d=r(h,f),p=o(h),_=p?t():null;super(l,!1,d,_),this._attack=e(this,p,d.attack),this._knee=e(this,p,d.knee),this._nativeDynamicsCompressorNode=d,this._ratio=e(this,p,d.ratio),this._release=e(this,p,d.release),this._threshold=e(this,p,d.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},G5e=(n,e,t,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=t(a);const u=mu(l,c);if(!u){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,h)}return s.set(c,l),u?(await n(c,a.attack,l.attack),await n(c,a.knee,l.knee),await n(c,a.ratio,l.ratio),await n(c,a.release,l.release),await n(c,a.threshold,l.threshold)):(await r(c,a.attack,l.attack),await r(c,a.knee,l.knee),await r(c,a.ratio,l.ratio),await r(c,a.release,l.release),await r(c,a.threshold,l.threshold)),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},$5e=()=>new DOMException("","EncodingError"),W5e=n=>e=>new Promise((t,r)=>{if(n===null){r(new SyntaxError);return}const i=n.document.head;if(i===null)r(new SyntaxError);else{const s=n.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=n.onerror,l=()=>{n.onerror=c,URL.revokeObjectURL(a)};n.onerror=(u,h,f,d,p)=>{if(h===a||h===n.location.href&&f===1&&d===1)return l(),r(p),!1;if(c!==null)return c(u,h,f,d,p)},s.onerror=()=>{l(),r(new SyntaxError)},s.onload=()=>{l(),t()},s.src=a,s.type="module",i.appendChild(s)}}),q5e=n=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,r,i){if(r!==null){let s=this._listeners.get(r);s===void 0&&(s=n(this,r),typeof r=="function"&&this._listeners.set(r,s)),this._nativeEventTarget.addEventListener(t,s,i)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,r,i){const s=r===null?void 0:this._listeners.get(r);this._nativeEventTarget.removeEventListener(t,s===void 0?null:s,i)}},Y5e=n=>(e,t,r)=>{Object.defineProperties(n,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return r()}finally{n!==null&&(delete n.currentFrame,delete n.currentTime)}},K5e=n=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw n()},X5e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Z5e=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=i(a),u={...X5e,...c},h=r(l,u),f=s(l),d=f?t():null;super(a,!1,h,d),this._gain=e(this,f,h.gain,Iu,Ch)}get gain(){return this._gain}},J5e=(n,e,t,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=t(a);const u=mu(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,h)}return s.set(c,l),u?await n(c,a.gain,l.gain):await r(c,a.gain,l.gain),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Q5e=(n,e)=>t=>e(n,t),e6e=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},t6e=n=>e=>{var t;return(t=n.get(e))!==null&&t!==void 0?t:0},n6e=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},r6e=n=>e=>n.get(e),hl=()=>new DOMException("","InvalidStateError"),i6e=n=>e=>{const t=n.get(e);if(t===void 0)throw hl();return t},s6e=(n,e)=>t=>{let r=n.get(t);if(r!==void 0)return r;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new e(1,1,44100),n.set(t,r),r},o6e=n=>e=>{const t=n.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},VO=()=>new DOMException("","InvalidAccessError"),a6e=n=>{n.getFrequencyResponse=(e=>(t,r,i)=>{if(t.length!==r.length||r.length!==i.length)throw VO();return e.call(n,t,r,i)})(n.getFrequencyResponse)},c6e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},l6e=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=r(a),u=i(l),h={...c6e,...c},f=e(l,u?null:a.baseLatency,h),d=u?t(h.feedback,h.feedforward):null;super(a,!1,f,d),a6e(f),this._nativeIIRFilterNode=f,s(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},Bee=(n,e,t,r,i,s,o,a,c,l,u)=>{const h=l.length;let f=a;for(let d=0;d<h;d+=1){let p=t[0]*l[d];for(let _=1;_<i;_+=1){const g=f-_&c-1;p+=t[_]*s[g],p-=n[_]*o[g]}for(let _=i;_<r;_+=1)p+=t[_]*s[f-_&c-1];for(let _=i;_<e;_+=1)p-=n[_]*o[f-_&c-1];s[f]=l[d],o[f]=p,f=f+1&c-1,u[d]=p}return f},u6e=(n,e,t,r)=>{const i=t instanceof Float64Array?t:new Float64Array(t),s=r instanceof Float64Array?r:new Float64Array(r),o=i.length,a=s.length,c=Math.min(o,a);if(i[0]!==1){for(let p=0;p<o;p+=1)s[p]/=i[0];for(let p=1;p<a;p+=1)i[p]/=i[0]}const l=32,u=new Float32Array(l),h=new Float32Array(l),f=e.createBuffer(n.numberOfChannels,n.length,n.sampleRate),d=n.numberOfChannels;for(let p=0;p<d;p+=1){const _=n.getChannelData(p),g=f.getChannelData(p);u.fill(0),h.fill(0),Bee(i,o,s,a,c,u,h,0,l,_,g)}return f},h6e=(n,e,t,r,i)=>(s,o)=>{const a=new WeakMap;let c=null;const l=async(u,h)=>{let f=null,d=e(u);const p=mu(d,h);if(h.createIIRFilter===void 0?f=n(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(d=h.createIIRFilter(o,s)),a.set(h,f===null?d:f),f!==null){if(c===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const g=new t(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await r(u,g,g.destination);const m=await i(g);return u6e(m,h,s,o)})()}const _=await c;return f.buffer=_,f.start(0),f}return await r(u,h,d),d};return{render(u,h){const f=a.get(h);return f!==void 0?Promise.resolve(f):l(u,h)}}},f6e=(n,e,t,r,i,s)=>o=>(a,c)=>{const l=n.get(a);if(l===void 0){if(!o&&s(a)){const u=r(a),{outputs:h}=t(a);for(const f of h)if(_R(f)){const d=r(f[0]);e(u,d,f[1],f[2])}else{const d=i(f[0]);u.disconnect(d,f[1])}}n.set(a,c)}else n.set(a,l+c)},d6e=(n,e)=>t=>{const r=n.get(t);return e(r)||e(t)},p6e=(n,e)=>t=>n.has(t)||e(t),m6e=(n,e)=>t=>n.has(t)||e(t),g6e=(n,e)=>t=>{const r=n.get(t);return e(r)||e(t)},_6e=n=>e=>n!==null&&e instanceof n,v6e=n=>e=>n!==null&&typeof n.AudioNode=="function"&&e instanceof n.AudioNode,y6e=n=>e=>n!==null&&typeof n.AudioParam=="function"&&e instanceof n.AudioParam,b6e=(n,e)=>t=>n(t)||e(t),S6e=n=>e=>n!==null&&e instanceof n,E6e=n=>n!==null&&n.isSecureContext,x6e=(n,e,t,r)=>class extends n{constructor(s,o){const a=t(s),c=e(a,o);if(r(a))throw TypeError();super(s,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},T6e={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},w6e=(n,e,t,r)=>class extends n{constructor(s,o){const a=t(s);if(r(a))throw new TypeError;const c={...T6e,...o},l=e(a,c);super(s,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},A6e=(n,e,t,r)=>class extends n{constructor(s,o){const a=t(s),c=e(a,o);if(r(a))throw new TypeError;super(s,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},R6e=(n,e,t)=>class extends n{constructor(i,s){const o=t(i),a=e(o,s);super(i,!0,a,null)}},C6e=(n,e,t,r,i,s)=>class extends t{constructor(a,c){super(a),this._nativeContext=a,zO.set(this,a),r(a)&&i.set(a,new Set),this._destination=new n(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?s(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},wA=n=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=n.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},M6e=(n,e)=>(t,r,i)=>{const s=new Set;return t.connect=(o=>(a,c=0,l=0)=>{const u=s.size===0;if(e(a))return o.call(t,a,c,l),n(s,[a,c,l],h=>h[0]===a&&h[1]===c&&h[2]===l,!0),u&&r(),a;o.call(t,a,c),n(s,[a,c],h=>h[0]===a&&h[1]===c,!0),u&&r()})(t.connect),t.disconnect=(o=>(a,c,l)=>{const u=s.size>0;if(a===void 0)o.apply(t),s.clear();else if(typeof a=="number"){o.call(t,a);for(const f of s)f[1]===a&&s.delete(f)}else{e(a)?o.call(t,a,c,l):o.call(t,a,c);for(const f of s)f[0]===a&&(c===void 0||f[1]===c)&&(l===void 0||f[2]===l)&&s.delete(f)}const h=s.size===0;u&&h&&i()})(t.disconnect),t},Po=(n,e,t)=>{const r=e[t];r!==void 0&&r!==n[t]&&(n[t]=r)},Lc=(n,e)=>{Po(n,e,"channelCount"),Po(n,e,"channelCountMode"),Po(n,e,"channelInterpretation")},GH=n=>typeof n.getFloatTimeDomainData=="function",k6e=n=>{n.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);n.getByteTimeDomainData(t);const r=Math.max(t.length,n.fftSize);for(let i=0;i<r;i+=1)e[i]=(t[i]-128)*.0078125;return e}},O6e=(n,e)=>(t,r)=>{const i=t.createAnalyser();if(Lc(i,r),!(r.maxDecibels>r.minDecibels))throw e();return Po(i,r,"fftSize"),Po(i,r,"maxDecibels"),Po(i,r,"minDecibels"),Po(i,r,"smoothingTimeConstant"),n(GH,()=>GH(i))||k6e(i),i},I6e=n=>n===null?null:n.hasOwnProperty("AudioBuffer")?n.AudioBuffer:null,ba=(n,e,t)=>{const r=e[t];r!==void 0&&r!==n[t].value&&(n[t].value=r)},N6e=n=>{n.start=(e=>{let t=!1;return(r=0,i=0,s)=>{if(t)throw hl();e.call(n,r,i,s),t=!0}})(n.start)},BU=n=>{n.start=(e=>(t=0,r=0,i)=>{if(typeof i=="number"&&i<0||r<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(n,t,r,i)})(n.start)},FU=n=>{n.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(n,t)})(n.stop)},P6e=(n,e,t,r,i,s,o,a,c,l,u)=>(h,f)=>{const d=h.createBufferSource();return Lc(d,f),ba(d,f,"playbackRate"),Po(d,f,"buffer"),Po(d,f,"loop"),Po(d,f,"loopEnd"),Po(d,f,"loopStart"),e(t,()=>t(h))||N6e(d),e(r,()=>r(h))||c(d),e(i,()=>i(h))||l(d,h),e(s,()=>s(h))||BU(d),e(o,()=>o(h))||u(d,h),e(a,()=>a(h))||FU(d),n(h,d),d},D6e=n=>n===null?null:n.hasOwnProperty("AudioContext")?n.AudioContext:n.hasOwnProperty("webkitAudioContext")?n.webkitAudioContext:null,L6e=(n,e)=>(t,r,i)=>{const s=t.destination;if(s.channelCount!==r)try{s.channelCount=r}catch{}i&&s.channelCountMode!=="explicit"&&(s.channelCountMode="explicit"),s.maxChannelCount===0&&Object.defineProperty(s,"maxChannelCount",{value:r});const o=n(t,{channelCount:r,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{s.channelCount=c}catch(l){if(c>s.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),s.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),s.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>s.maxChannelCount}),o.connect(s),o},U6e=n=>n===null?null:n.hasOwnProperty("AudioWorkletNode")?n.AudioWorkletNode:null,B6e=n=>{const{port1:e}=new MessageChannel;try{e.postMessage(n)}finally{e.close()}},F6e=(n,e,t,r,i)=>(s,o,a,c,l,u)=>{if(a!==null)try{const h=new a(s,c,u),f=new Map;let d=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw n()}},channelCountMode:{get:()=>"explicit",set:()=>{throw n()}},onprocessorerror:{get:()=>d,set:p=>{typeof d=="function"&&h.removeEventListener("processorerror",d),d=typeof p=="function"?p:null,typeof d=="function"&&h.addEventListener("processorerror",d)}}}),h.addEventListener=(p=>(..._)=>{if(_[0]==="processorerror"){const g=typeof _[1]=="function"?_[1]:typeof _[1]=="object"&&_[1]!==null&&typeof _[1].handleEvent=="function"?_[1].handleEvent:null;if(g!==null){const m=f.get(_[1]);m!==void 0?_[1]=m:(_[1]=b=>{b.type==="error"?(Object.defineProperties(b,{type:{value:"processorerror"}}),g(b)):g(new ErrorEvent(_[0],{...b}))},f.set(g,_[1]))}}return p.call(h,"error",_[1],_[2]),p.call(h,..._)})(h.addEventListener),h.removeEventListener=(p=>(..._)=>{if(_[0]==="processorerror"){const g=f.get(_[1]);g!==void 0&&(f.delete(_[1]),_[1]=g)}return p.call(h,"error",_[1],_[2]),p.call(h,_[0],_[1],_[2])})(h.removeEventListener),u.numberOfOutputs!==0){const p=t(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(p).connect(s.destination),i(h,()=>p.disconnect(),()=>p.connect(s.destination))}return h}catch(h){throw h.code===11?r():h}if(l===void 0)throw r();return B6e(u),e(s,o,l,u)},Fee=(n,e)=>n===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(n*e))))),j6e=n=>new Promise((e,t)=>{const{port1:r,port2:i}=new MessageChannel;r.onmessage=({data:s})=>{r.close(),i.close(),e(s)},r.onmessageerror=({data:s})=>{r.close(),i.close(),t(s)},i.postMessage(n)}),z6e=async(n,e)=>{const t=await j6e(e);return new n(t)},H6e=(n,e,t,r)=>{let i=p4.get(n);i===void 0&&(i=new WeakMap,p4.set(n,i));const s=z6e(t,r);return i.set(e,s),s},V6e=(n,e,t,r,i,s,o,a,c,l,u,h,f)=>(d,p,_,g)=>{if(g.numberOfInputs===0&&g.numberOfOutputs===0)throw c();const m=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(m.some(Ne=>Ne<1))throw c();if(m.length!==g.numberOfOutputs)throw e();if(g.channelCountMode!=="explicit")throw c();const b=g.channelCount*g.numberOfInputs,y=m.reduce((Ne,Be)=>Ne+Be,0),x=_.parameterDescriptors===void 0?0:_.parameterDescriptors.length;if(b+x>6||y>6)throw c();const T=new MessageChannel,k=[],R=[];for(let Ne=0;Ne<g.numberOfInputs;Ne+=1)k.push(o(d,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),R.push(i(d,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const P=[];if(_.parameterDescriptors!==void 0)for(const{defaultValue:Ne,maxValue:Be,minValue:De,name:Oe}of _.parameterDescriptors){const ue=s(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:g.parameterData[Oe]!==void 0?g.parameterData[Oe]:Ne===void 0?0:Ne});Object.defineProperties(ue.offset,{defaultValue:{get:()=>Ne===void 0?0:Ne},maxValue:{get:()=>Be===void 0?Iu:Be},minValue:{get:()=>De===void 0?Ch:De}}),P.push(ue)}const B=r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,b+x)}),U=Fee(p,d.sampleRate),z=a(d,U,b+x,Math.max(1,y)),I=i(d,{channelCount:Math.max(1,y),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,y)}),L=[];for(let Ne=0;Ne<g.numberOfOutputs;Ne+=1)L.push(r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:m[Ne]}));for(let Ne=0;Ne<g.numberOfInputs;Ne+=1){k[Ne].connect(R[Ne]);for(let Be=0;Be<g.channelCount;Be+=1)R[Ne].connect(B,Be,Ne*g.channelCount+Be)}const M=new Lee(_.parameterDescriptors===void 0?[]:_.parameterDescriptors.map(({name:Ne},Be)=>{const De=P[Be];return De.connect(B,0,b+Be),De.start(0),[Ne,De.offset]}));B.connect(z);let F=g.channelInterpretation,Z=null;const $=g.numberOfOutputs===0?[z]:L,Y={get bufferSize(){return U},get channelCount(){return g.channelCount},set channelCount(Ne){throw t()},get channelCountMode(){return g.channelCountMode},set channelCountMode(Ne){throw t()},get channelInterpretation(){return F},set channelInterpretation(Ne){for(const Be of k)Be.channelInterpretation=Ne;F=Ne},get context(){return z.context},get inputs(){return k},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return Z},set onprocessorerror(Ne){typeof Z=="function"&&Y.removeEventListener("processorerror",Z),Z=typeof Ne=="function"?Ne:null,typeof Z=="function"&&Y.addEventListener("processorerror",Z)},get parameters(){return M},get port(){return T.port2},addEventListener(...Ne){return z.addEventListener(Ne[0],Ne[1],Ne[2])},connect:n.bind(null,$),disconnect:l.bind(null,$),dispatchEvent(...Ne){return z.dispatchEvent(Ne[0])},removeEventListener(...Ne){return z.removeEventListener(Ne[0],Ne[1],Ne[2])}},Q=new Map;T.port1.addEventListener=(Ne=>(...Be)=>{if(Be[0]==="message"){const De=typeof Be[1]=="function"?Be[1]:typeof Be[1]=="object"&&Be[1]!==null&&typeof Be[1].handleEvent=="function"?Be[1].handleEvent:null;if(De!==null){const Oe=Q.get(Be[1]);Oe!==void 0?Be[1]=Oe:(Be[1]=ue=>{u(d.currentTime,d.sampleRate,()=>De(ue))},Q.set(De,Be[1]))}}return Ne.call(T.port1,Be[0],Be[1],Be[2])})(T.port1.addEventListener),T.port1.removeEventListener=(Ne=>(...Be)=>{if(Be[0]==="message"){const De=Q.get(Be[1]);De!==void 0&&(Q.delete(Be[1]),Be[1]=De)}return Ne.call(T.port1,Be[0],Be[1],Be[2])})(T.port1.removeEventListener);let q=null;Object.defineProperty(T.port1,"onmessage",{get:()=>q,set:Ne=>{typeof q=="function"&&T.port1.removeEventListener("message",q),q=typeof Ne=="function"?Ne:null,typeof q=="function"&&(T.port1.addEventListener("message",q),T.port1.start())}}),_.prototype.port=T.port1;let V=null;H6e(d,Y,_,g).then(Ne=>V=Ne);const ne=pk(g.numberOfInputs,g.channelCount),ie=pk(g.numberOfOutputs,m),ae=_.parameterDescriptors===void 0?[]:_.parameterDescriptors.reduce((Ne,{name:Be})=>({...Ne,[Be]:new Float32Array(128)}),{});let Te=!0;const Ie=()=>{g.numberOfOutputs>0&&z.disconnect(I);for(let Ne=0,Be=0;Ne<g.numberOfOutputs;Ne+=1){const De=L[Ne];for(let Oe=0;Oe<m[Ne];Oe+=1)I.disconnect(De,Be+Oe,Oe);Be+=m[Ne]}},be=new Map;z.onaudioprocess=({inputBuffer:Ne,outputBuffer:Be})=>{if(V!==null){const De=h(Y);for(let Oe=0;Oe<U;Oe+=128){for(let ue=0;ue<g.numberOfInputs;ue+=1)for(let _e=0;_e<g.channelCount;_e+=1)dk(Ne,ne[ue],_e,_e,Oe);_.parameterDescriptors!==void 0&&_.parameterDescriptors.forEach(({name:ue},_e)=>{dk(Ne,ae,ue,b+_e,Oe)});for(let ue=0;ue<g.numberOfInputs;ue+=1)for(let _e=0;_e<m[ue];_e+=1)ie[ue][_e].byteLength===0&&(ie[ue][_e]=new Float32Array(128));try{const ue=ne.map((we,pe)=>{if(De[pe].size>0)return be.set(pe,U/128),we;const Ze=be.get(pe);return Ze===void 0?[]:(we.every(Je=>Je.every(nt=>nt===0))&&(Ze===1?be.delete(pe):be.set(pe,Ze-1)),we)});Te=u(d.currentTime+Oe/d.sampleRate,d.sampleRate,()=>V.process(ue,ie,ae));for(let we=0,pe=0;we<g.numberOfOutputs;we+=1){for(let ze=0;ze<m[we];ze+=1)Uee(Be,ie[we],ze,pe+ze,Oe);pe+=m[we]}}catch(ue){Te=!1,Y.dispatchEvent(new ErrorEvent("processorerror",{colno:ue.colno,filename:ue.filename,lineno:ue.lineno,message:ue.message}))}if(!Te){for(let ue=0;ue<g.numberOfInputs;ue+=1){k[ue].disconnect(R[ue]);for(let _e=0;_e<g.channelCount;_e+=1)R[Oe].disconnect(B,_e,ue*g.channelCount+_e)}if(_.parameterDescriptors!==void 0){const ue=_.parameterDescriptors.length;for(let _e=0;_e<ue;_e+=1){const we=P[_e];we.disconnect(B,0,b+_e),we.stop()}}B.disconnect(z),z.onaudioprocess=null,Pe?Ie():qe();break}}}};let Pe=!1;const $e=o(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),tt=()=>z.connect($e).connect(d.destination),qe=()=>{z.disconnect($e),$e.disconnect()},ut=()=>{if(Te){qe(),g.numberOfOutputs>0&&z.connect(I);for(let Ne=0,Be=0;Ne<g.numberOfOutputs;Ne+=1){const De=L[Ne];for(let Oe=0;Oe<m[Ne];Oe+=1)I.connect(De,Be+Oe,Oe);Be+=m[Ne]}}Pe=!0},te=()=>{Te&&(tt(),Ie()),Pe=!1};return tt(),f(Y,ut,te)},jee=(n,e)=>{const t=n.createBiquadFilter();return Lc(t,e),ba(t,e,"Q"),ba(t,e,"detune"),ba(t,e,"frequency"),ba(t,e,"gain"),Po(t,e,"type"),t},G6e=(n,e)=>(t,r)=>{const i=t.createChannelMerger(r.numberOfInputs);return n!==null&&n.name==="webkitAudioContext"&&e(t,i),Lc(i,r),i},$6e=n=>{const e=n.numberOfOutputs;Object.defineProperty(n,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw hl()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw hl()}}),Object.defineProperty(n,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw hl()}})},vR=(n,e)=>{const t=n.createChannelSplitter(e.numberOfOutputs);return Lc(t,e),$6e(t),t},W6e=(n,e,t,r,i)=>(s,o)=>{if(s.createConstantSource===void 0)return t(s,o);const a=s.createConstantSource();return Lc(a,o),ba(a,o,"offset"),e(r,()=>r(s))||BU(a),e(i,()=>i(s))||FU(a),n(s,a),a},Jx=(n,e)=>(n.connect=e.connect.bind(e),n.disconnect=e.disconnect.bind(e),n),q6e=(n,e,t,r)=>(i,{offset:s,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=t(i,{...o,gain:s}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(p){l.channelCount=p},get channelCountMode(){return l.channelCountMode},set channelCountMode(p){l.channelCountMode=p},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(p){l.channelInterpretation=p},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(p){c.onended=p},addEventListener(...p){return c.addEventListener(p[0],p[1],p[2])},dispatchEvent(...p){return c.dispatchEvent(p[0])},removeEventListener(...p){return c.removeEventListener(p[0],p[1],p[2])},start(p=0){c.start.call(c,p)},stop(p=0){c.stop.call(c,p)}},f=()=>c.connect(l),d=()=>c.disconnect(l);return n(i,c),r(Jx(h,l),f,d)},Y6e=(n,e)=>(t,r)=>{const i=t.createConvolver();if(Lc(i,r),r.disableNormalization===i.normalize&&(i.normalize=!r.disableNormalization),Po(i,r,"buffer"),r.channelCount>2||(e(i,"channelCount",s=>()=>s.call(i),s=>o=>{if(o>2)throw n();return s.call(i,o)}),r.channelCountMode==="max"))throw n();return e(i,"channelCountMode",s=>()=>s.call(i),s=>o=>{if(o==="max")throw n();return s.call(i,o)}),i},zee=(n,e)=>{const t=n.createDelay(e.maxDelayTime);return Lc(t,e),ba(t,e,"delayTime"),t},K6e=n=>(e,t)=>{const r=e.createDynamicsCompressor();if(Lc(r,t),t.channelCount>2||t.channelCountMode==="max")throw n();return ba(r,t,"attack"),ba(r,t,"knee"),ba(r,t,"ratio"),ba(r,t,"release"),ba(r,t,"threshold"),r},Wh=(n,e)=>{const t=n.createGain();return Lc(t,e),ba(t,e,"gain"),t},X6e=n=>(e,t,r)=>{if(e.createIIRFilter===void 0)return n(e,t,r);const i=e.createIIRFilter(r.feedforward,r.feedback);return Lc(i,r),i};function Z6e(n,e){const t=e[0]*e[0]+e[1]*e[1];return[(n[0]*e[0]+n[1]*e[1])/t,(n[1]*e[0]-n[0]*e[1])/t]}function J6e(n,e){return[n[0]*e[0]-n[1]*e[1],n[0]*e[1]+n[1]*e[0]]}function $H(n,e){let t=[0,0];for(let r=n.length-1;r>=0;r-=1)t=J6e(t,e),t[0]+=n[r];return t}const Q6e=(n,e,t,r)=>(i,s,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=Fee(s,i.sampleRate),f=l instanceof Float64Array?l:new Float64Array(l),d=u instanceof Float64Array?u:new Float64Array(u),p=f.length,_=d.length,g=Math.min(p,_);if(p===0||p>20)throw r();if(f[0]===0)throw e();if(_===0||_>20)throw r();if(d[0]===0)throw e();if(f[0]!==1){for(let P=0;P<_;P+=1)d[P]/=f[0];for(let P=1;P<p;P+=1)f[P]/=f[0]}const m=t(i,h,o,o);m.channelCount=o,m.channelCountMode=a,m.channelInterpretation=c;const b=32,y=[],x=[],T=[];for(let P=0;P<o;P+=1){y.push(0);const B=new Float32Array(b),U=new Float32Array(b);B.fill(0),U.fill(0),x.push(B),T.push(U)}m.onaudioprocess=P=>{const B=P.inputBuffer,U=P.outputBuffer,z=B.numberOfChannels;for(let I=0;I<z;I+=1){const L=B.getChannelData(I),M=U.getChannelData(I);y[I]=Bee(f,p,d,_,g,x[I],T[I],y[I],b,L,M)}};const k=i.sampleRate/2;return Jx({get bufferSize(){return h},get channelCount(){return m.channelCount},set channelCount(P){m.channelCount=P},get channelCountMode(){return m.channelCountMode},set channelCountMode(P){m.channelCountMode=P},get channelInterpretation(){return m.channelInterpretation},set channelInterpretation(P){m.channelInterpretation=P},get context(){return m.context},get inputs(){return[m]},get numberOfInputs(){return m.numberOfInputs},get numberOfOutputs(){return m.numberOfOutputs},addEventListener(...P){return m.addEventListener(P[0],P[1],P[2])},dispatchEvent(...P){return m.dispatchEvent(P[0])},getFrequencyResponse(P,B,U){if(P.length!==B.length||B.length!==U.length)throw n();const z=P.length;for(let I=0;I<z;I+=1){const L=-Math.PI*(P[I]/k),M=[Math.cos(L),Math.sin(L)],F=$H(d,M),Z=$H(f,M),$=Z6e(F,Z);B[I]=Math.sqrt($[0]*$[0]+$[1]*$[1]),U[I]=Math.atan2($[1],$[0])}},removeEventListener(...P){return m.removeEventListener(P[0],P[1],P[2])}},m)},eUe=(n,e)=>n.createMediaElementSource(e.mediaElement),tUe=(n,e)=>{const t=n.createMediaStreamDestination();return Lc(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},nUe=(n,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((s,o)=>s.id<o.id?-1:s.id>o.id?1:0);const r=t.slice(0,1),i=n.createMediaStreamSource(new MediaStream(r));return Object.defineProperty(i,"mediaStream",{value:e}),i},rUe=(n,e)=>(t,{mediaStreamTrack:r})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(r);const i=new MediaStream([r]),s=t.createMediaStreamSource(i);if(r.kind!=="audio")throw n();if(e(t))throw new TypeError;return s},iUe=n=>n===null?null:n.hasOwnProperty("OfflineAudioContext")?n.OfflineAudioContext:n.hasOwnProperty("webkitOfflineAudioContext")?n.webkitOfflineAudioContext:null,sUe=(n,e,t,r,i,s)=>(o,a)=>{const c=o.createOscillator();return Lc(c,a),ba(c,a,"detune"),ba(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):Po(c,a,"type"),e(t,()=>t(o))||BU(c),e(r,()=>r(o))||s(c,o),e(i,()=>i(o))||FU(c),n(o,c),c},oUe=n=>(e,t)=>{const r=e.createPanner();return r.orientationX===void 0?n(e,t):(Lc(r,t),ba(r,t,"orientationX"),ba(r,t,"orientationY"),ba(r,t,"orientationZ"),ba(r,t,"positionX"),ba(r,t,"positionY"),ba(r,t,"positionZ"),Po(r,t,"coneInnerAngle"),Po(r,t,"coneOuterAngle"),Po(r,t,"coneOuterGain"),Po(r,t,"distanceModel"),Po(r,t,"maxDistance"),Po(r,t,"panningModel"),Po(r,t,"refDistance"),Po(r,t,"rolloffFactor"),r)},aUe=(n,e,t,r,i,s,o,a,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:f,coneOuterGain:d,distanceModel:p,maxDistance:_,orientationX:g,orientationY:m,orientationZ:b,panningModel:y,positionX:x,positionY:T,positionZ:k,refDistance:R,rolloffFactor:P,...B})=>{const U=u.createPanner();if(B.channelCount>2||B.channelCountMode==="max")throw o();Lc(U,B);const z={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},I=t(u,{...z,channelInterpretation:"speakers",numberOfInputs:6}),L=r(u,{...B,gain:1}),M=r(u,{...z,gain:1}),F=r(u,{...z,gain:0}),Z=r(u,{...z,gain:0}),$=r(u,{...z,gain:0}),Y=r(u,{...z,gain:0}),Q=r(u,{...z,gain:0}),q=i(u,256,6,1),V=s(u,{...z,curve:new Float32Array([1,1]),oversample:"none"});let K=[g,m,b],ne=[x,T,k];const ie=new Float32Array(1);q.onaudioprocess=({inputBuffer:be})=>{const Pe=[c(be,ie,0),c(be,ie,1),c(be,ie,2)];Pe.some((tt,qe)=>tt!==K[qe])&&(U.setOrientation(...Pe),K=Pe);const $e=[c(be,ie,3),c(be,ie,4),c(be,ie,5)];$e.some((tt,qe)=>tt!==ne[qe])&&(U.setPosition(...$e),ne=$e)},Object.defineProperty(F.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Z.gain,"defaultValue",{get:()=>0}),Object.defineProperty($.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Y.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Q.gain,"defaultValue",{get:()=>0});const ae={get bufferSize(){},get channelCount(){return U.channelCount},set channelCount(be){if(be>2)throw o();L.channelCount=be,U.channelCount=be},get channelCountMode(){return U.channelCountMode},set channelCountMode(be){if(be==="max")throw o();L.channelCountMode=be,U.channelCountMode=be},get channelInterpretation(){return U.channelInterpretation},set channelInterpretation(be){L.channelInterpretation=be,U.channelInterpretation=be},get coneInnerAngle(){return U.coneInnerAngle},set coneInnerAngle(be){U.coneInnerAngle=be},get coneOuterAngle(){return U.coneOuterAngle},set coneOuterAngle(be){U.coneOuterAngle=be},get coneOuterGain(){return U.coneOuterGain},set coneOuterGain(be){if(be<0||be>1)throw e();U.coneOuterGain=be},get context(){return U.context},get distanceModel(){return U.distanceModel},set distanceModel(be){U.distanceModel=be},get inputs(){return[L]},get maxDistance(){return U.maxDistance},set maxDistance(be){if(be<0)throw new RangeError;U.maxDistance=be},get numberOfInputs(){return U.numberOfInputs},get numberOfOutputs(){return U.numberOfOutputs},get orientationX(){return M.gain},get orientationY(){return F.gain},get orientationZ(){return Z.gain},get panningModel(){return U.panningModel},set panningModel(be){U.panningModel=be},get positionX(){return $.gain},get positionY(){return Y.gain},get positionZ(){return Q.gain},get refDistance(){return U.refDistance},set refDistance(be){if(be<0)throw new RangeError;U.refDistance=be},get rolloffFactor(){return U.rolloffFactor},set rolloffFactor(be){if(be<0)throw new RangeError;U.rolloffFactor=be},addEventListener(...be){return L.addEventListener(be[0],be[1],be[2])},dispatchEvent(...be){return L.dispatchEvent(be[0])},removeEventListener(...be){return L.removeEventListener(be[0],be[1],be[2])}};h!==ae.coneInnerAngle&&(ae.coneInnerAngle=h),f!==ae.coneOuterAngle&&(ae.coneOuterAngle=f),d!==ae.coneOuterGain&&(ae.coneOuterGain=d),p!==ae.distanceModel&&(ae.distanceModel=p),_!==ae.maxDistance&&(ae.maxDistance=_),g!==ae.orientationX.value&&(ae.orientationX.value=g),m!==ae.orientationY.value&&(ae.orientationY.value=m),b!==ae.orientationZ.value&&(ae.orientationZ.value=b),y!==ae.panningModel&&(ae.panningModel=y),x!==ae.positionX.value&&(ae.positionX.value=x),T!==ae.positionY.value&&(ae.positionY.value=T),k!==ae.positionZ.value&&(ae.positionZ.value=k),R!==ae.refDistance&&(ae.refDistance=R),P!==ae.rolloffFactor&&(ae.rolloffFactor=P),(K[0]!==1||K[1]!==0||K[2]!==0)&&U.setOrientation(...K),(ne[0]!==0||ne[1]!==0||ne[2]!==0)&&U.setPosition(...ne);const Te=()=>{L.connect(U),n(L,V,0,0),V.connect(M).connect(I,0,0),V.connect(F).connect(I,0,1),V.connect(Z).connect(I,0,2),V.connect($).connect(I,0,3),V.connect(Y).connect(I,0,4),V.connect(Q).connect(I,0,5),I.connect(q).connect(u.destination)},Ie=()=>{L.disconnect(U),a(L,V,0,0),V.disconnect(M),M.disconnect(I),V.disconnect(F),F.disconnect(I),V.disconnect(Z),Z.disconnect(I),V.disconnect($),$.disconnect(I),V.disconnect(Y),Y.disconnect(I),V.disconnect(Q),Q.disconnect(I),I.disconnect(q),q.disconnect(u.destination)};return l(Jx(ae,U),Te,Ie)},cUe=n=>(e,{disableNormalization:t,imag:r,real:i})=>{const s=r instanceof Float32Array?r:new Float32Array(r),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,s,{disableNormalization:t});if(Array.from(r).length<2)throw n();return a},yR=(n,e,t,r)=>n.createScriptProcessor(e,t,r),lUe=(n,e)=>(t,r)=>{const i=r.channelCountMode;if(i==="clamped-max")throw e();if(t.createStereoPanner===void 0)return n(t,r);const s=t.createStereoPanner();return Lc(s,r),ba(s,r,"pan"),Object.defineProperty(s,"channelCountMode",{get:()=>i,set:o=>{if(o!==i)throw e()}}),s},uUe=(n,e,t,r,i,s)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(p,_,g,m)=>{const b=new Float32Array(16385),y=new Float32Array(16385);for(let B=0;B<16385;B+=1){const U=B/16384*c;b[B]=Math.cos(U),y[B]=Math.sin(U)}const x=t(p,{...l,gain:0}),T=r(p,{...u,curve:b}),k=r(p,{...u,curve:a}),R=t(p,{...l,gain:0}),P=r(p,{...u,curve:y});return{connectGraph(){_.connect(x),_.connect(k.inputs===void 0?k:k.inputs[0]),_.connect(R),k.connect(g),g.connect(T.inputs===void 0?T:T.inputs[0]),g.connect(P.inputs===void 0?P:P.inputs[0]),T.connect(x.gain),P.connect(R.gain),x.connect(m,0,0),R.connect(m,0,1)},disconnectGraph(){_.disconnect(x),_.disconnect(k.inputs===void 0?k:k.inputs[0]),_.disconnect(R),k.disconnect(g),g.disconnect(T.inputs===void 0?T:T.inputs[0]),g.disconnect(P.inputs===void 0?P:P.inputs[0]),T.disconnect(x.gain),P.disconnect(R.gain),x.disconnect(m,0,0),R.disconnect(m,0,1)}}},f=(p,_,g,m)=>{const b=new Float32Array(16385),y=new Float32Array(16385),x=new Float32Array(16385),T=new Float32Array(16385),k=Math.floor(16385/2);for(let $=0;$<16385;$+=1)if($>k){const Y=($-k)/(16384-k)*c;b[$]=Math.cos(Y),y[$]=Math.sin(Y),x[$]=0,T[$]=1}else{const Y=$/(16384-k)*c;b[$]=1,y[$]=0,x[$]=Math.cos(Y),T[$]=Math.sin(Y)}const R=e(p,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),P=t(p,{...l,gain:0}),B=r(p,{...u,curve:b}),U=t(p,{...l,gain:0}),z=r(p,{...u,curve:y}),I=r(p,{...u,curve:a}),L=t(p,{...l,gain:0}),M=r(p,{...u,curve:x}),F=t(p,{...l,gain:0}),Z=r(p,{...u,curve:T});return{connectGraph(){_.connect(R),_.connect(I.inputs===void 0?I:I.inputs[0]),R.connect(P,0),R.connect(U,0),R.connect(L,1),R.connect(F,1),I.connect(g),g.connect(B.inputs===void 0?B:B.inputs[0]),g.connect(z.inputs===void 0?z:z.inputs[0]),g.connect(M.inputs===void 0?M:M.inputs[0]),g.connect(Z.inputs===void 0?Z:Z.inputs[0]),B.connect(P.gain),z.connect(U.gain),M.connect(L.gain),Z.connect(F.gain),P.connect(m,0,0),L.connect(m,0,0),U.connect(m,0,1),F.connect(m,0,1)},disconnectGraph(){_.disconnect(R),_.disconnect(I.inputs===void 0?I:I.inputs[0]),R.disconnect(P,0),R.disconnect(U,0),R.disconnect(L,1),R.disconnect(F,1),I.disconnect(g),g.disconnect(B.inputs===void 0?B:B.inputs[0]),g.disconnect(z.inputs===void 0?z:z.inputs[0]),g.disconnect(M.inputs===void 0?M:M.inputs[0]),g.disconnect(Z.inputs===void 0?Z:Z.inputs[0]),B.disconnect(P.gain),z.disconnect(U.gain),M.disconnect(L.gain),Z.disconnect(F.gain),P.disconnect(m,0,0),L.disconnect(m,0,0),U.disconnect(m,0,1),F.disconnect(m,0,1)}}},d=(p,_,g,m,b)=>{if(_===1)return h(p,g,m,b);if(_===2)return f(p,g,m,b);throw i()};return(p,{channelCount:_,channelCountMode:g,pan:m,...b})=>{if(g==="max")throw i();const y=n(p,{...b,channelCount:1,channelCountMode:g,numberOfInputs:2}),x=t(p,{...b,channelCount:_,channelCountMode:g,gain:1}),T=t(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:m});let{connectGraph:k,disconnectGraph:R}=d(p,_,x,T,y);Object.defineProperty(T.gain,"defaultValue",{get:()=>0}),Object.defineProperty(T.gain,"maxValue",{get:()=>1}),Object.defineProperty(T.gain,"minValue",{get:()=>-1});const P={get bufferSize(){},get channelCount(){return x.channelCount},set channelCount(I){x.channelCount!==I&&(B&&R(),{connectGraph:k,disconnectGraph:R}=d(p,I,x,T,y),B&&k()),x.channelCount=I},get channelCountMode(){return x.channelCountMode},set channelCountMode(I){if(I==="clamped-max"||I==="max")throw i();x.channelCountMode=I},get channelInterpretation(){return x.channelInterpretation},set channelInterpretation(I){x.channelInterpretation=I},get context(){return x.context},get inputs(){return[x]},get numberOfInputs(){return x.numberOfInputs},get numberOfOutputs(){return x.numberOfOutputs},get pan(){return T.gain},addEventListener(...I){return x.addEventListener(I[0],I[1],I[2])},dispatchEvent(...I){return x.dispatchEvent(I[0])},removeEventListener(...I){return x.removeEventListener(I[0],I[1],I[2])}};let B=!1;const U=()=>{k(),B=!0},z=()=>{R(),B=!1};return s(Jx(P,y),U,z)}},hUe=(n,e,t,r,i,s,o)=>(a,c)=>{const l=a.createWaveShaper();if(s!==null&&s.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return t(a,c);Lc(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();Po(l,{curve:u},"curve"),Po(l,c,"oversample");let h=null,f=!1;return o(l,"curve",_=>()=>_.call(l),_=>g=>(_.call(l,g),f&&(r(g)&&h===null?h=n(a,l):!r(g)&&h!==null&&(h(),h=null)),g)),i(l,()=>{f=!0,r(l.curve)&&(h=n(a,l))},()=>{f=!1,h!==null&&(h(),h=null)})},fUe=(n,e,t,r,i)=>(s,{curve:o,oversample:a,...c})=>{const l=s.createWaveShaper(),u=s.createWaveShaper();Lc(l,c),Lc(u,c);const h=t(s,{...c,gain:1}),f=t(s,{...c,gain:-1}),d=t(s,{...c,gain:1}),p=t(s,{...c,gain:-1});let _=null,g=!1,m=null;const b={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(T){h.channelCount=T,f.channelCount=T,l.channelCount=T,d.channelCount=T,u.channelCount=T,p.channelCount=T},get channelCountMode(){return l.channelCountMode},set channelCountMode(T){h.channelCountMode=T,f.channelCountMode=T,l.channelCountMode=T,d.channelCountMode=T,u.channelCountMode=T,p.channelCountMode=T},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(T){h.channelInterpretation=T,f.channelInterpretation=T,l.channelInterpretation=T,d.channelInterpretation=T,u.channelInterpretation=T,p.channelInterpretation=T},get context(){return l.context},get curve(){return m},set curve(T){if(T!==null&&T.length<2)throw e();if(T===null)l.curve=T,u.curve=T;else{const k=T.length,R=new Float32Array(k+2-k%2),P=new Float32Array(k+2-k%2);R[0]=T[0],P[0]=-T[k-1];const B=Math.ceil((k+1)/2),U=(k+1)/2-1;for(let z=1;z<B;z+=1){const I=z/B*U,L=Math.floor(I),M=Math.ceil(I);R[z]=L===M?T[L]:(1-(I-L))*T[L]+(1-(M-I))*T[M],P[z]=L===M?-T[k-1-L]:-((1-(I-L))*T[k-1-L])-(1-(M-I))*T[k-1-M]}R[B]=k%2===1?T[B-1]:(T[B-2]+T[B-1])/2,l.curve=R,u.curve=P}m=T,g&&(r(m)&&_===null?_=n(s,h):_!==null&&(_(),_=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(T){l.oversample=T,u.oversample=T},addEventListener(...T){return h.addEventListener(T[0],T[1],T[2])},dispatchEvent(...T){return h.dispatchEvent(T[0])},removeEventListener(...T){return h.removeEventListener(T[0],T[1],T[2])}};o!==null&&(b.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==b.oversample&&(b.oversample=a);const y=()=>{h.connect(l).connect(d),h.connect(f).connect(u).connect(p).connect(d),g=!0,r(m)&&(_=n(s,h))},x=()=>{h.disconnect(l),l.disconnect(d),h.disconnect(f),f.disconnect(u),u.disconnect(p),p.disconnect(d),g=!1,_!==null&&(_(),_=null)};return i(Jx(b,d),y,x)},$u=()=>new DOMException("","NotSupportedError"),dUe={numberOfChannels:1},pUe=(n,e,t,r,i)=>class extends n{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:h,sampleRate:f}={...dUe,...l},d=r(h,u,f);e(wA,()=>wA(d))||d.addEventListener("statechange",(()=>{let p=0;const _=g=>{this._state==="running"&&(p>0?(d.removeEventListener("statechange",_),g.stopImmediatePropagation(),this._waitForThePromiseToSettle(g)):p+=1)};return _})()),super(d,h),this._length=u,this._nativeOfflineAudioContext=d,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,Iee(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},mUe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},gUe=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...mUe,...l},f=t(u,h),d=s(u),p=d?r():null,_=c.sampleRate/2;super(c,!1,f,p),this._detune=e(this,d,f.detune,153600,-153600),this._frequency=e(this,d,f.frequency,_,-_),this._nativeOscillatorNode=f,this._onended=null,this._oscillatorNodeRenderer=p,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){Rx(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),Zg(this)&&mR(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},_Ue=(n,e,t,r,i)=>()=>{const s=new WeakMap;let o=null,a=null,c=null;const l=async(u,h)=>{let f=t(u);const d=mu(f,h);if(!d){const p={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,detune:f.detune.value,frequency:f.frequency.value,periodicWave:o===null?void 0:o,type:f.type};f=e(h,p),a!==null&&f.start(a),c!==null&&f.stop(c)}return s.set(h,f),d?(await n(h,u.detune,f.detune),await n(h,u.frequency,f.frequency)):(await r(h,u.detune,f.detune),await r(h,u.frequency,f.frequency)),await i(u,h,f),f};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,h){const f=s.get(h);return f!==void 0?Promise.resolve(f):l(u,h)}}},vUe={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},yUe=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...vUe,...l},f=t(u,h),d=s(u),p=d?r():null;super(c,!1,f,p),this._nativePannerNode=f,this._orientationX=e(this,d,f.orientationX,Iu,Ch),this._orientationY=e(this,d,f.orientationY,Iu,Ch),this._orientationZ=e(this,d,f.orientationZ,Iu,Ch),this._positionX=e(this,d,f.positionX,Iu,Ch),this._positionY=e(this,d,f.positionY,Iu,Ch),this._positionZ=e(this,d,f.positionZ,Iu,Ch),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},bUe=(n,e,t,r,i,s,o,a,c,l)=>()=>{const u=new WeakMap;let h=null;const f=async(d,p)=>{let _=null,g=s(d);const m={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},b={...m,coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor},y=mu(g,p);if("bufferSize"in g)_=r(p,{...m,gain:1});else if(!y){const x={...b,orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value};g=i(p,x)}if(u.set(p,_===null?g:_),_!==null){if(h===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const z=new o(6,d.context.length,p.sampleRate),I=e(z,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});I.connect(z.destination),h=(async()=>{const L=await Promise.all([d.orientationX,d.orientationY,d.orientationZ,d.positionX,d.positionY,d.positionZ].map(async(M,F)=>{const Z=t(z,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:F===0?1:0});return await a(z,M,Z.offset),Z}));for(let M=0;M<6;M+=1)L[M].connect(I,0,M),L[M].start(0);return l(z)})()}const x=await h,T=r(p,{...m,gain:1});await c(d,p,T);const k=[];for(let z=0;z<x.numberOfChannels;z+=1)k.push(x.getChannelData(z));let R=[k[0][0],k[1][0],k[2][0]],P=[k[3][0],k[4][0],k[5][0]],B=r(p,{...m,gain:1}),U=i(p,{...b,orientationX:R[0],orientationY:R[1],orientationZ:R[2],positionX:P[0],positionY:P[1],positionZ:P[2]});T.connect(B).connect(U.inputs[0]),U.connect(_);for(let z=128;z<x.length;z+=128){const I=[k[0][z],k[1][z],k[2][z]],L=[k[3][z],k[4][z],k[5][z]];if(I.some((M,F)=>M!==R[F])||L.some((M,F)=>M!==P[F])){R=I,P=L;const M=z/p.sampleRate;B.gain.setValueAtTime(0,M),B=r(p,{...m,gain:0}),U=i(p,{...b,orientationX:R[0],orientationY:R[1],orientationZ:R[2],positionX:P[0],positionY:P[1],positionZ:P[2]}),B.gain.setValueAtTime(1,M),T.connect(B).connect(U.inputs[0]),U.connect(_)}}return _}return y?(await n(p,d.orientationX,g.orientationX),await n(p,d.orientationY,g.orientationY),await n(p,d.orientationZ,g.orientationZ),await n(p,d.positionX,g.positionX),await n(p,d.positionY,g.positionY),await n(p,d.positionZ,g.positionZ)):(await a(p,d.orientationX,g.orientationX),await a(p,d.orientationY,g.orientationY),await a(p,d.orientationZ,g.orientationZ),await a(p,d.positionX,g.positionX),await a(p,d.positionY,g.positionY),await a(p,d.positionZ,g.positionZ)),Zx(g)?await c(d,p,g.inputs[0]):await c(d,p,g),g};return{render(d,p){const _=u.get(p);return _!==void 0?Promise.resolve(_):f(d,p)}}},SUe={disableNormalization:!1},EUe=(n,e,t,r)=>class Hee{constructor(s,o){const a=e(s),c=r({...SUe,...o}),l=n(a,c);return t.add(l),l}static[Symbol.hasInstance](s){return s!==null&&typeof s=="object"&&Object.getPrototypeOf(s)===Hee.prototype||t.has(s)}},xUe=(n,e)=>(t,r,i)=>(n(r).replay(i),e(r,t,i)),TUe=(n,e,t)=>async(r,i,s)=>{const o=n(r);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const f=await e(l).render(l,i),d=r.context.destination;!t(l)&&(r!==d||!t(r))&&f.connect(s,u,c)})).reduce((a,c)=>[...a,...c],[]))},wUe=(n,e,t)=>async(r,i,s)=>{const o=e(r);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await n(a).render(a,i);t(a)||u.connect(s,c)}))},AUe=(n,e,t,r)=>i=>n(wA,()=>wA(i))?Promise.resolve(n(r,r)).then(s=>{if(!s){const o=t(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(s=>{const o=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),s(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}),RUe=n=>(e,t)=>{n.set(e,t)},CUe=n=>(e,t)=>n.set(e,t),MUe=(n,e,t,r,i,s,o,a)=>(c,l)=>t(c).render(c,l).then(()=>Promise.all(Array.from(r(l)).map(u=>t(u).render(u,l)))).then(()=>i(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),DU(u)):e(s,()=>s(u))||a(u),n.add(u),u)),kUe={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},OUe=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=i(a),u={...kUe,...c},h=t(l,u),f=s(l),d=f?r():null;super(a,!1,h,d),this._pan=e(this,f,h.pan)}get pan(){return this._pan}},IUe=(n,e,t,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=t(a);const u=mu(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,h)}return s.set(c,l),u?await n(c,a.pan,l.pan):await r(c,a.pan,l.pan),Zx(l)?await i(a,c,l.inputs[0]):await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},NUe=n=>()=>{if(n===null)return!1;try{new n({length:1,sampleRate:44100})}catch{return!1}return!0},PUe=(n,e)=>async()=>{if(n===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),r=new e(1,128,44100),i=URL.createObjectURL(t);let s=!1,o=!1;try{await r.audioWorklet.addModule(i);const a=new n(r,"a",{numberOfOutputs:0}),c=r.createOscillator();a.port.onmessage=()=>s=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await r.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(i)}return s&&!o},DUe=(n,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),r=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{t.oncomplete=()=>{r.disconnect(),i(t.currentTime!==0)},t.startRendering()})},LUe=()=>new DOMException("","UnknownError"),UUe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},BUe=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...UUe,...l},f=t(u,h),p=s(u)?r():null;super(c,!0,f,p),this._isCurveNullified=!1,this._nativeWaveShaperNode=f,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},FUe=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!mu(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=n(o,l)}return r.set(o,a),Zx(a)?await t(s,o,a.inputs[0]):await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},jUe=()=>typeof window>"u"?null:window,zUe=(n,e)=>t=>{t.copyFromChannel=(r,i,s=0)=>{const o=n(s),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=r.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)r[h]=l[h+o]},t.copyToChannel=(r,i,s=0)=>{const o=n(s),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=r.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)l[h+o]=r[h]}},HUe=n=>e=>{e.copyFromChannel=(t=>(r,i,s=0)=>{const o=n(s),a=n(i);if(o<e.length)return t.call(e,r,a,o)})(e.copyFromChannel),e.copyToChannel=(t=>(r,i,s=0)=>{const o=n(s),a=n(i);if(o<e.length)return t.call(e,r,a,o)})(e.copyToChannel)},VUe=n=>(e,t)=>{const r=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=r),n(e,"buffer",i=>()=>{const s=i.call(e);return s===r?null:s},i=>s=>i.call(e,s===null?r:s))},GUe=(n,e)=>(t,r)=>{r.channelCount=1,r.channelCountMode="explicit",Object.defineProperty(r,"channelCount",{get:()=>1,set:()=>{throw n()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:()=>{throw n()}});const i=t.createBufferSource();e(r,()=>{const a=r.numberOfInputs;for(let c=0;c<a;c+=1)i.connect(r,0,c)},()=>i.disconnect(r))},Vee=(n,e,t)=>n.copyFromChannel===void 0?n.getChannelData(t)[0]:(n.copyFromChannel(e,t),e[0]),Gee=n=>{if(n===null)return!1;const e=n.length;return e%2!==0?n[Math.floor(e/2)]!==0:n[e/2-1]+n[e/2]!==0},bR=(n,e,t,r)=>{let i=n;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:s,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(n,e,{get:t(s),set:r(o)})},$Ue=n=>({...n,outputChannelCount:n.outputChannelCount!==void 0?n.outputChannelCount:n.numberOfInputs===1&&n.numberOfOutputs===1?[n.channelCount]:Array.from({length:n.numberOfOutputs},()=>1)}),WUe=n=>({...n,channelCount:n.numberOfOutputs}),qUe=n=>{const{imag:e,real:t}=n;return e===void 0?t===void 0?{...n,imag:[0,0],real:[0,0]}:{...n,imag:Array.from(t,()=>0),real:t}:t===void 0?{...n,imag:e,real:Array.from(e,()=>0)}:{...n,imag:e,real:t}},$ee=(n,e,t)=>{try{n.setValueAtTime(e,t)}catch(r){if(r.code!==9)throw r;$ee(n,e,t+1e-7)}},YUe=n=>{const e=n.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},KUe=n=>{const e=n.createBufferSource(),t=n.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},XUe=n=>{const e=n.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},jU=n=>{const e=n.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},Wee=n=>{const e=n.createBuffer(1,1,44100),t=n.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},zU=n=>{const e=n.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},ZUe=n=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(n)}finally{e.close(),t.close()}},JUe=n=>{n.start=(e=>(t=0,r=0,i)=>{const s=n.buffer,o=s===null?r:Math.min(s.duration,r);s!==null&&o>s.duration-.5/n.context.sampleRate?e.call(n,t,0,0):e.call(n,t,o,i)})(n.start)},qee=(n,e)=>{const t=e.createGain();n.connect(t);const r=(i=>()=>{i.call(n,t),n.removeEventListener("ended",r)})(n.disconnect);n.addEventListener("ended",r),Jx(n,t),n.stop=(i=>{let s=!1;return(o=0)=>{if(s)try{i.call(n,o)}catch{t.gain.setValueAtTime(0,o)}else i.call(n,o),s=!0}})(n.stop)},Qx=(n,e)=>t=>{const r={value:n};return Object.defineProperties(t,{currentTarget:r,target:r}),typeof e=="function"?e.call(n,t):e.handleEvent.call(n,t)},QUe=y4e(zb),e8e=w4e(zb),t8e=U5e(HO),Yee=new WeakMap,n8e=t6e(Yee),Np=d5e(new Map,new WeakMap),l0=jUe(),Kee=O6e(Np,S0),HU=e6e(Bu),Ll=TUe(Bu,HU,bb),r8e=k4e(Kee,yo,Ll),so=i6e(zO),__=iUe(l0),ks=S6e(__),Xee=new WeakMap,Zee=q5e(Qx),SR=D6e(l0),VU=_6e(SR),GU=v6e(l0),Jee=y6e(l0),AA=U6e(l0),Va=t5e(b4e(wee),T4e(QUe,e8e,uk,t8e,hk,Bu,n8e,pR,yo,zb,Zg,bb,GC),Np,f6e(f4,hk,Bu,yo,TA,Zg),S0,VO,$u,N5e(uk,f4,Bu,yo,TA,so,Zg,ks),j5e(Xee,Bu,xp),Zee,so,VU,GU,Jee,ks,AA),i8e=M4e(Va,r8e,S0,Kee,so,ks),$U=new WeakSet,WH=I6e(l0),Qee=A5e(new Uint32Array(1)),WU=zUe(Qee,S0),qU=HUe(Qee),ete=I4e($U,Np,$u,WH,__,NUe(WH),WU,qU),GO=A4e(Wh),tte=wUe(HU,gR,bb),E0=b5e(tte),eT=P6e(GO,Np,YUe,KUe,XUe,jU,Wee,zU,JUe,VUe(bR),qee),x0=xUe(n6e(gR),tte),s8e=D4e(E0,eT,yo,x0,Ll),Pp=n5e(S4e(Aee),Xee,PU,r5e,d4e,p4e,m4e,g4e,_4e,l4,xee,SR,$ee),o8e=P4e(Va,s8e,Pp,hl,eT,so,ks,Qx),a8e=G4e(Va,$4e,S0,hl,L6e(Wh,bR),so,ks,Ll),c8e=f5e(E0,jee,yo,x0,Ll),Hb=CUe(Yee),l8e=h5e(Va,Pp,c8e,VO,jee,so,ks,Hb),sy=M6e(zb,GU),u8e=GUe(hl,sy),oy=G6e(SR,u8e),h8e=g5e(oy,yo,Ll),f8e=m5e(Va,h8e,oy,so,ks),d8e=y5e(vR,yo,Ll),p8e=v5e(Va,d8e,vR,so,ks,WUe),m8e=q6e(GO,eT,Wh,sy),tT=W6e(GO,Np,m8e,jU,zU),g8e=w5e(E0,tT,yo,x0,Ll),_8e=T5e(Va,Pp,g8e,tT,so,ks,Qx),nte=Y6e($u,bR),v8e=M5e(nte,yo,Ll),y8e=C5e(Va,v8e,nte,so,ks,Hb),b8e=L5e(E0,zee,yo,x0,Ll),S8e=D5e(Va,Pp,b8e,zee,so,ks,Hb),rte=K6e($u),E8e=G5e(E0,rte,yo,x0,Ll),x8e=V5e(Va,Pp,E8e,rte,$u,so,ks,Hb),T8e=J5e(E0,Wh,yo,x0,Ll),w8e=Z5e(Va,Pp,T8e,Wh,so,ks),A8e=Q6e(VO,hl,yR,$u),$O=AUe(Np,Wh,yR,DUe(Wh,__)),R8e=h6e(eT,yo,__,Ll,$O),C8e=X6e(A8e),M8e=l6e(Va,C8e,R8e,so,ks,Hb),k8e=W4e(Pp,oy,tT,yR,$u,Vee,ks,bR),ite=new WeakMap,O8e=C6e(a8e,k8e,Zee,ks,ite,Qx),ste=sUe(GO,Np,jU,Wee,zU,qee),I8e=_Ue(E0,ste,yo,x0,Ll),N8e=gUe(Va,Pp,ste,I8e,so,ks,Qx),ote=E5e(eT),P8e=fUe(ote,hl,Wh,Gee,sy),WO=hUe(ote,hl,P8e,Gee,sy,SR,bR),D8e=aUe(uk,hl,oy,Wh,yR,WO,$u,hk,Vee,sy),ate=oUe(D8e),L8e=bUe(E0,oy,tT,Wh,ate,yo,__,x0,Ll,$O),U8e=yUe(Va,Pp,ate,L8e,so,ks,Hb),B8e=cUe(S0),F8e=EUe(B8e,so,new WeakSet,qUe),j8e=uUe(oy,vR,Wh,WO,$u,sy),cte=lUe(j8e,$u),z8e=IUe(E0,cte,yo,x0,Ll),H8e=OUe(Va,Pp,cte,z8e,so,ks),V8e=FUe(WO,yo,Ll),G8e=BUe(Va,hl,WO,V8e,so,ks,Hb),lte=E6e(l0),YU=Y5e(l0),ute=new WeakMap,$8e=s6e(ute,__),W8e=lte?x4e(Np,$u,W5e(l0),YU,K5e(v4e),so,$8e,ks,AA,new WeakMap,new WeakMap,PUe(AA,__),l0):void 0,q8e=b6e(VU,ks),Y8e=I5e($U,Np,O5e,$5e,new WeakSet,so,q8e,ck,wA,WU,qU),hte=l5e(W8e,i8e,ete,o8e,l8e,f8e,p8e,_8e,y8e,Y8e,S8e,x8e,w8e,M8e,O8e,N8e,U8e,F8e,H8e,G8e),K8e=x6e(Va,eUe,so,ks),X8e=w6e(Va,tUe,so,ks),Z8e=A6e(Va,nUe,so,ks),J8e=rUe(hl,ks),Q8e=R6e(Va,J8e,so),eBe=V4e(hte,hl,$u,LUe,K8e,X8e,Z8e,Q8e,SR),KU=o6e(ite),tBe=R4e(KU),fte=S5e(S0),nBe=B5e(KU),dte=z5e(S0),pte=new WeakMap,rBe=Q5e(pte,xp),iBe=V6e(fte,S0,hl,oy,vR,tT,Wh,yR,$u,dte,YU,rBe,sy),sBe=F6e(hl,iBe,Wh,$u,sy),oBe=c5e(E0,fte,eT,oy,vR,tT,Wh,nBe,dte,YU,yo,AA,__,x0,Ll,$O),aBe=r6e(ute),cBe=RUe(pte),qH=lte?s5e(tBe,Va,Pp,oBe,sBe,Bu,aBe,so,ks,AA,$Ue,cBe,ZUe,Qx):void 0,lBe=k5e($u,__),uBe=MUe($U,Np,HU,KU,$O,ck,WU,qU),hBe=pUe(hte,Np,hl,lBe,uBe),fBe=d6e(zO,VU),dBe=p6e(NU,GU),pBe=m6e(PU,Jee),mBe=g6e(zO,ks);function Of(n){return n===void 0}function mi(n){return n!==void 0}function gBe(n){return typeof n=="function"}function Tp(n){return typeof n=="number"}function Lv(n){return Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object}function mte(n){return typeof n=="boolean"}function Fh(n){return Array.isArray(n)}function s_(n){return typeof n=="string"}function G2(n){return s_(n)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(n)}function Ar(n,e){if(!n)throw new Error(e)}function Ed(n,e,t=1/0){if(!(e<=n&&n<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${n}`)}function gte(n){!n.isOffline&&n.state!=="running"&&qO('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let _te=!1,YH=!1;function KH(n){_te=n}function _Be(n){Of(n)&&_te&&!YH&&(YH=!0,qO("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let vte=console;function vBe(...n){vte.log(...n)}function qO(...n){vte.warn(...n)}function yBe(n){return new eBe(n)}function bBe(n,e,t){return new hBe(n,e,t)}const Ef=typeof self=="object"?self:null,SBe=Ef&&(Ef.hasOwnProperty("AudioContext")||Ef.hasOwnProperty("webkitAudioContext"));function EBe(n,e,t){return Ar(mi(qH),"AudioWorkletNode only works in a secure context (https or localhost)"),new(n instanceof Ef?.BaseAudioContext?Ef?.AudioWorkletNode:qH)(n,e,t)}var _4=function(n,e){return _4=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},_4(n,e)};function YO(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");_4(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var mk=function(){return mk=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},mk.apply(this,arguments)};function yte(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function Os(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function bte(n,e){return function(t,r){e(t,r,n)}}function Ste(n,e,t,r,i,s){function o(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var a=r.kind,c=a==="getter"?"get":a==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,u=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,d=t.length-1;d>=0;d--){var p={};for(var _ in r)p[_]=_==="access"?{}:r[_];for(var _ in r.access)p.access[_]=r.access[_];p.addInitializer=function(m){if(f)throw new TypeError("Cannot add initializers after decoration has completed");s.push(o(m||null))};var g=(0,t[d])(a==="accessor"?{get:u.get,set:u.set}:u[c],p);if(a==="accessor"){if(g===void 0)continue;if(g===null||typeof g!="object")throw new TypeError("Object expected");(h=o(g.get))&&(u.get=h),(h=o(g.set))&&(u.set=h),(h=o(g.init))&&i.unshift(h)}else(h=o(g))&&(a==="field"?i.unshift(h):u[c]=h)}l&&Object.defineProperty(l,r.name,u),f=!0}function Ete(n,e,t){for(var r=arguments.length>2,i=0;i<e.length;i++)t=r?e[i].call(n,t):e[i].call(n);return r?t:void 0}function xte(n){return typeof n=="symbol"?n:"".concat(n)}function Tte(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function wte(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function ro(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function ER(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(t=0)),t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var KO=Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]});function Ate(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&KO(e,n,t)}function gk(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Vb(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function Rte(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(Vb(arguments[e]));return n}function Cte(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function RA(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}function Cx(n){return this instanceof Cx?(this.v=n,this):new Cx(n)}function Mte(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(d){return function(p){return Promise.resolve(p).then(d,h)}}function a(d,p){r[d]&&(i[d]=function(_){return new Promise(function(g,m){s.push([d,_,g,m])>1||c(d,_)})},p&&(i[d]=p(i[d])))}function c(d,p){try{l(r[d](p))}catch(_){f(s[0][3],_)}}function l(d){d.value instanceof Cx?Promise.resolve(d.value.v).then(u,h):f(s[0][2],d)}function u(d){c("next",d)}function h(d){c("throw",d)}function f(d,p){d(p),s.shift(),s.length&&c(s[0][0],s[0][1])}}function kte(n){var e,t;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=n[i]?function(o){return(t=!t)?{value:Cx(n[i](o)),done:!1}:s?s(o):o}:s}}function Ote(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof gk=="function"?gk(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){o=n[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function Ite(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var xBe=Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e},v4=function(n){return v4=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},v4(n)};function Nte(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t=v4(n),r=0;r<t.length;r++)t[r]!=="default"&&KO(e,n,t[r]);return xBe(e,n),e}function Pte(n){return n&&n.__esModule?n:{default:n}}function Dte(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}function Lte(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t}function Ute(n,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?e===n:n.has(e)}function Bte(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,i;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(i=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(s){return Promise.reject(s)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e}var TBe=typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r};function Fte(n){function e(s){n.error=n.hasError?new TBe(s,n.error,"An error was suppressed during disposal."):s,n.hasError=!0}var t,r=0;function i(){for(;t=n.stack.pop();)try{if(!t.async&&r===1)return r=0,n.stack.push(t),Promise.resolve().then(i);if(t.dispose){var s=t.dispose.call(t.value);if(t.async)return r|=2,Promise.resolve(s).then(i,function(o){return e(o),i()})}else r|=1}catch(o){e(o)}if(r===1)return n.hasError?Promise.reject(n.error):Promise.resolve();if(n.hasError)throw n.error}return i()}function jte(n,e){return typeof n=="string"&&/^\.\.?\//.test(n)?n.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,r,i,s,o){return r?e?".jsx":".js":i&&(!s||!o)?t:i+s+"."+o.toLowerCase()+"js"}):n}const wBe={__extends:YO,__assign:mk,__rest:yte,__decorate:Os,__param:bte,__esDecorate:Ste,__runInitializers:Ete,__propKey:xte,__setFunctionName:Tte,__metadata:wte,__awaiter:ro,__generator:ER,__createBinding:KO,__exportStar:Ate,__values:gk,__read:Vb,__spread:Rte,__spreadArrays:Cte,__spreadArray:RA,__await:Cx,__asyncGenerator:Mte,__asyncDelegator:kte,__asyncValues:Ote,__makeTemplateObject:Ite,__importStar:Nte,__importDefault:Pte,__classPrivateFieldGet:Dte,__classPrivateFieldSet:Lte,__classPrivateFieldIn:Ute,__addDisposableResource:Bte,__disposeResources:Fte,__rewriteRelativeImportExtension:jte},ABe=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:Bte,get __assign(){return mk},__asyncDelegator:kte,__asyncGenerator:Mte,__asyncValues:Ote,__await:Cx,__awaiter:ro,__classPrivateFieldGet:Dte,__classPrivateFieldIn:Ute,__classPrivateFieldSet:Lte,__createBinding:KO,__decorate:Os,__disposeResources:Fte,__esDecorate:Ste,__exportStar:Ate,__extends:YO,__generator:ER,__importDefault:Pte,__importStar:Nte,__makeTemplateObject:Ite,__metadata:wte,__param:bte,__propKey:xte,__read:Vb,__rest:yte,__rewriteRelativeImportExtension:jte,__runInitializers:Ete,__setFunctionName:Tte,__spread:Rte,__spreadArray:RA,__spreadArrays:Cte,__values:gk,default:wBe},Symbol.toStringTag,{value:"Module"}));class RBe{constructor(e,t,r,i){this._callback=e,this._type=t,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=r,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),r=new Worker(t);r.onmessage=this._callback.bind(this),this._worker=r}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var t;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((t=this._worker)===null||t===void 0||t.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function Sb(n){return pBe(n)}function Uv(n){return dBe(n)}function $C(n){return mBe(n)}function bE(n){return fBe(n)}function CBe(n){return n instanceof ete}function MBe(n,e){return n==="value"||Sb(e)||Uv(e)||CBe(e)}function Bv(n,...e){if(!e.length)return n;const t=e.shift();if(Lv(n)&&Lv(t))for(const r in t)MBe(r,t[r])?n[r]=t[r]:Lv(t[r])?(n[r]||Object.assign(n,{[r]:{}}),Bv(n[r],t[r])):Object.assign(n,{[r]:t[r]});return Bv(n,...e)}function kBe(n,e){return n.length===e.length&&n.every((t,r)=>e[r]===t)}function jn(n,e,t=[],r){const i={},s=Array.from(e);if(Lv(s[0])&&r&&!Reflect.has(s[0],r)&&(Object.keys(s[0]).some(a=>Reflect.has(n,a))||(Bv(i,{[r]:s[0]}),t.splice(t.indexOf(r),1),s.shift())),s.length===1&&Lv(s[0]))Bv(i,s[0]);else for(let o=0;o<t.length;o++)mi(s[o])&&(i[t[o]]=s[o]);return Bv(n,i)}function OBe(n){return n.constructor.getDefaults()}function Qm(n,e){return Of(n)?e:n}function rl(n,e){return e.forEach(t=>{Reflect.has(n,t)&&delete n[t]}),n}class v_{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Ef&&this.toString()===Ef.TONE_DEBUG_CLASS)&&vBe(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}v_.version=Eee;const XU=1e-6;function Mx(n,e){return n>e+XU}function y4(n,e){return Mx(n,e)||dp(n,e)}function _k(n,e){return n+XU<e}function dp(n,e){return Math.abs(n-e)<XU}function IBe(n,e,t){return Math.max(Math.min(n,t),e)}class Rd extends v_{constructor(){super(),this.name="Timeline",this._timeline=[];const e=jn(Rd.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(Ar(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];Ar(y4(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const r=this._search(e,t);return r!==-1?this._timeline[r]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const r=this._search(e,t);return r+1<this._timeline.length?this._timeline[r+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const r=this._search(e);return r-1>=0?this._timeline[r-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(dp(this._timeline[t].time,e)){for(let r=t;r>=0&&dp(this._timeline[r].time,e);r--)t=r;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&y4(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let r=0;const i=this._timeline.length;let s=i;if(i>0&&this._timeline[i-1][t]<=e)return i-1;for(;r<s;){let o=Math.floor(r+(s-r)/2);const a=this._timeline[o],c=this._timeline[o+1];if(dp(a[t],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(dp(u[t],e))o=l;else break}return o}else{if(_k(a[t],e)&&Mx(c[t],e))return o;Mx(a[t],e)?s=o:r=o+1}}return-1}_iterate(e,t=0,r=this._timeline.length-1){this._timeline.slice(t,r+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const r=this._search(e);return r!==-1&&this._iterate(t,0,r),this}forEachAfter(e,t){const r=this._search(e);return this._iterate(t,r+1),this}forEachBetween(e,t,r){let i=this._search(e),s=this._search(t);return i!==-1&&s!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[s].time===t&&(s-=1),this._iterate(r,i,s)):i===-1&&this._iterate(r,0,s),this}forEachFrom(e,t){let r=this._search(e);for(;r>=0&&this._timeline[r].time>=e;)r--;return this._iterate(t,r+1),this}forEachAtTime(e,t){const r=this._search(e);if(r!==-1&&dp(this._timeline[r].time,e)){let i=r;for(let s=r;s>=0&&dp(this._timeline[s].time,e);s--)i=s;this._iterate(s=>{t(s)},i,r)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const zte=[];function XO(n){zte.push(n)}function NBe(n){zte.forEach(e=>e(n))}const Hte=[];function ZO(n){Hte.push(n)}function PBe(n){Hte.forEach(e=>e(n))}class xR extends v_{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(i=>{Of(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(t)}),this}once(e,t){const r=(...i)=>{t(...i),this.off(e,r)};return this.on(e,r),this}off(e,t){return e.split(/\W+/).forEach(i=>{if(Of(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(Of(t))this._events[i]=[];else{const s=this._events[i];for(let o=s.length-1;o>=0;o--)s[o]===t&&s.splice(o,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const r=this._events[e].slice(0);for(let i=0,s=r.length;i<s;i++)r[i].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const r=Object.getOwnPropertyDescriptor(xR.prototype,t);Object.defineProperty(e.prototype,t,r)})}dispose(){return super.dispose(),this._events=void 0,this}}class Vte extends xR{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class nT extends Vte{constructor(){var e,t;super(),this.name="Context",this._constants=new Map,this._timeouts=new Rd,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const r=jn(nT.getDefaults(),arguments,["context"]);r.context?(this._context=r.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=yBe({latencyHint:r.latencyHint}),this._latencyHint=r.latencyHint),this._ticker=new RBe(this.emit.bind(this,"tick"),r.clockSource,r.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((t=arguments[0])===null||t===void 0)&&t.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=r.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(NBe(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,r){return this._context.createBuffer(e,t,r)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,r){return this._context.createPeriodicWave(e,t,r)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return Ar(bE(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return Ar(bE(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return Ar(bE(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){Ar(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){Ar(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){Ar(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){Ar(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return EBe(this.rawContext,e,t)}addAudioWorkletModule(e){return ro(this,void 0,void 0,function*(){Ar(mi(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return ro(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return bE(this._context)?this._context.resume():Promise.resolve()}close(){return ro(this,void 0,void 0,function*(){bE(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&PBe(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),r=t.getChannelData(0);for(let s=0;s<r.length;s++)r[s]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=t,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();this._timeouts.forEachBefore(e,t=>{t.callback(),this._timeouts.remove(t)})}setTimeout(e,t){this._timeoutIds++;const r=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:r+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const r=++this._timeoutIds,i=()=>{const s=this.now();this._timeouts.add({callback:()=>{e(),i()},id:r,time:s+t})};return i(),r}}class DBe extends Vte{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,r){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,r){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return ro(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function pi(n,e){Fh(e)?e.forEach(t=>pi(n,t)):Object.defineProperty(n,e,{enumerable:!0,writable:!1})}function TR(n,e){Fh(e)?e.forEach(t=>TR(n,t)):Object.defineProperty(n,e,{writable:!0})}const ns=()=>{};class Ms extends v_{constructor(){super(),this.name="ToneAudioBuffer",this.onload=ns;const e=jn(Ms.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,s_(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:ns,onload:ns,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:_o().sampleRate}set(e){return e instanceof Ms?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return ro(this,void 0,void 0,function*(){const t=Ms.load(e).then(r=>{this.set(r),this.onload(this)});Ms.downloads.push(t);try{yield t}finally{const r=Ms.downloads.indexOf(t);Ms.downloads.splice(r,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=Fh(e)&&e[0].length>0,r=t?e.length:1,i=t?e[0].length:e.length,s=_o(),o=s.createBuffer(r,i,s.sampleRate),a=!t&&r===1?[e]:e;for(let c=0;c<r;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(Tp(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const r=this.numberOfChannels;for(let i=0;i<r;i++){const s=this.toArray(i);for(let o=0;o<s.length;o++)t[o]+=s[o]}t=t.map(i=>i/r),this.fromArray(t)}return this}toArray(e){if(Tp(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let r=0;r<this.numberOfChannels;r++)t[r]=this.getChannelData(r);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){Ar(this.loaded,"Buffer is not loaded");const r=Math.floor(e*this.sampleRate),i=Math.floor(t*this.sampleRate);Ar(r<i,"The start time must be less than the end time");const s=i-r,o=_o().createBuffer(this.numberOfChannels,s,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(r,i),a);return new Ms(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new Ms().fromArray(e)}static fromUrl(e){return ro(this,void 0,void 0,function*(){return yield new Ms().load(e)})}static load(e){return ro(this,void 0,void 0,function*(){const t=Ms.baseUrl===""||Ms.baseUrl.endsWith("/")?Ms.baseUrl:Ms.baseUrl+"/",r=yield fetch(t+e);if(!r.ok)throw new Error(`could not load url: ${e}`);const i=yield r.arrayBuffer();return yield _o().decodeAudioData(i)})}static supportsType(e){const t=e.split("."),r=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+r)!==""}static loaded(){return ro(this,void 0,void 0,function*(){for(yield Promise.resolve();Ms.downloads.length;)yield Ms.downloads[0]})}}Ms.baseUrl="";Ms.downloads=[];class wR extends nT{constructor(){super({clockSource:"offline",context:$C(arguments[0])?arguments[0]:bBe(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:$C(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=$C(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return ro(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const r=Math.floor(this.sampleRate/128);e&&t%r===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(){return ro(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new Ms(t)})}close(){return Promise.resolve()}}const Gte=new DBe;let z1=Gte;function _o(){return z1===Gte&&SBe&&vk(new nT),z1}function vk(n,e=!1){e&&z1.dispose(),bE(n)?z1=new nT(n):$C(n)?z1=new wR(n):z1=n}function LBe(){return z1.resume()}if(Ef&&!Ef.TONE_SILENCE_LOGGING){const e=` * Tone.js v${Eee} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function $te(n){return Math.pow(10,n/20)}function Wte(n){return 20*(Math.log(n)/Math.LN10)}function qte(n){return Math.pow(2,n/12)}let JO=440;function UBe(){return JO}function BBe(n){JO=n}function H1(n){return Math.round(Yte(n))}function Yte(n){return 69+12*Math.log2(n/JO)}function Kte(n){return JO*Math.pow(2,(n-69)/12)}class ZU extends v_{constructor(e,t,r){super(),this.defaultUnits="s",this._val=t,this._units=r,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const r=parseInt(e,10),i=t==="."?1.5:1;return r===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/r)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,r)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i+=this._beatsToUnits(parseFloat(t))),r&&r!=="0"&&(i+=this._beatsToUnits(parseFloat(r)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof ZU&&this.fromType(this._val),Of(this._val))return this._noArg();if(s_(this._val)&&Of(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(Lv(this._val)){let e=0;for(const t in this._val)if(mi(this._val[t])){const r=this._val[t],i=new this.constructor(this.context,t).valueOf()*r;e+=i}return e}if(mi(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return s_(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class xd extends ZU{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new xd(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const r=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),a=Math.round(i/r)*r-i;return i+a*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let s=1;s<9;s++){const o=Math.pow(2,s);t.push(o+"n."),t.push(o+"n"),t.push(o+"t")}t.push("0");let r=t[0],i=new xd(this.context,t[0]).toSeconds();return t.forEach(s=>{const o=new xd(this.context,s).toSeconds();Math.abs(o-e)<Math.abs(i-e)&&(r=s,i=o)}),r}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const r=Math.floor(t/this._getTimeSignature());let i=t%1*4;t=Math.floor(t)%this._getTimeSignature();const s=i.toString();return s.length>3&&(i=parseFloat(parseFloat(s).toFixed(3))),[r,t,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return H1(this.toFrequency())}_now(){return this.context.now()}}function tl(n,e){return new xd(_o(),n,e)}class Ph extends xd{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return UBe()}static set A4(e){BBe(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:Ph.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,t){const i=FBe[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?i:Ph.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,r){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i*=this._beatsToUnits(parseFloat(t))),r&&r!=="0"&&(i*=this._beatsToUnits(parseFloat(r)/4)),i}}})}transpose(e){return new Ph(this.context,this.valueOf()*qte(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return H1(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/Ph.A4);let r=Math.round(12*t)+57;const i=Math.floor(r/12);return i<0&&(r+=-12*i),jBe[r%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return Kte(e)}static ftom(e){return H1(e)}}const FBe={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},jBe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function XH(n,e){return new Ph(_o(),n,e)}class qE extends xd{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class hu extends v_{constructor(){super();const e=jn(hu.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:_o()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return _Be(e),new xd(this.context,e).toSeconds()}toFrequency(e){return new Ph(this.context,e).toFrequency()}toTicks(e){return new qE(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(r=>{Of(e[r])&&delete t[r]}),t}get(){const e=OBe(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const r=this[t];mi(r)&&mi(r.value)&&mi(r.setValueAtTime)?e[t]=r.value:r instanceof hu?e[t]=r._getPartialProperties(e[t]):Fh(r)||Tp(r)||s_(r)||mte(r)?e[t]=r:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&mi(this[t])&&(this[t]&&mi(this[t].value)&&mi(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof hu?this[t].set(e[t]):this[t]=e[t])}),this}}class AR extends Rd{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,r){return Ed(t,0),this.add(Object.assign({},r,{state:e,time:t})),this}getLastState(e,t){const r=this._search(t);for(let i=r;i>=0;i--){const s=this._timeline[i];if(s.state===e)return s}}getNextState(e,t){const r=this._search(t);if(r!==-1)for(let i=r;i<this._timeline.length;i++){const s=this._timeline[i];if(s.state===e)return s}}}class $r extends hu{constructor(){const e=jn($r.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,Ar(mi(e.param)&&(Sb(e.param)||e.param instanceof $r),"param must be an AudioParam");!Sb(e.param);)e.param=e.param._param;this._swappable=mi(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Rd(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,mi(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(hu.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return mi(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return mi(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return mi(this.maxValue)&&mi(this.minValue)&&Ed(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?$te(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?Wte(e):e}setValueAtTime(e,t){const r=this.toSeconds(t),i=this._fromType(e);return Ar(isFinite(i)&&isFinite(r),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,r),this._events.add({time:r,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,r),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),r=this._events.getAfter(t),i=this._events.get(t);let s=this._initialValue;if(i===null)s=this._initialValue;else if(i.type==="setTargetAtTime"&&(r===null||r.type==="setValueAtTime")){const o=this._events.getBefore(i.time);let a;o===null?a=this._initialValue:a=o.value,i.type==="setTargetAtTime"&&(s=this._exponentialApproach(i.time,a,i.value,i.constant,t))}else if(r===null)s=i.value;else if(r.type==="linearRampToValueAtTime"||r.type==="exponentialRampToValueAtTime"){let o=i.value;if(i.type==="setTargetAtTime"){const a=this._events.getBefore(i.time);a===null?o=this._initialValue:o=a.value}r.type==="linearRampToValueAtTime"?s=this._linearInterpolate(i.time,o,r.time,r.value,t):s=this._exponentialInterpolate(i.time,o,r.time,r.value,t)}else s=i.value;return this._toType(s)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const r=this._fromType(e),i=this.toSeconds(t);return Ar(isFinite(r)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(r),this._events.add({time:i,type:"linearRampToValueAtTime",value:r}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(r,i),this}exponentialRampToValueAtTime(e,t){let r=this._fromType(e);r=dp(r,0)?this._minOutput:r,this._assertRange(r);const i=this.toSeconds(t);return Ar(isFinite(r)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:r}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(r,i),this}exponentialRampTo(e,t,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialRampToValueAtTime(e,r+this.toSeconds(t)),this}linearRampTo(e,t,r){return r=this.toSeconds(r),this.setRampPoint(r),this.linearRampToValueAtTime(e,r+this.toSeconds(t)),this}targetRampTo(e,t,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialApproachValueAtTime(e,r,t),this}exponentialApproachValueAtTime(e,t,r){t=this.toSeconds(t),r=this.toSeconds(r);const i=Math.log(r+1)/Math.log(200);return this.setTargetAtTime(e,t,i),this.cancelAndHoldAtTime(t+r*.9),this.linearRampToValueAtTime(e,t+r),this}setTargetAtTime(e,t,r){const i=this._fromType(e);Ar(isFinite(r)&&r>0,"timeConstant must be a number greater than 0");const s=this.toSeconds(t);return this._assertRange(i),Ar(isFinite(i)&&isFinite(s),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:r,time:s,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,s,r),this._param.setTargetAtTime(i,s,r),this}setValueCurveAtTime(e,t,r,i=1){r=this.toSeconds(r),t=this.toSeconds(t);const s=this._fromType(e[0])*i;this.setValueAtTime(this._toType(s),t);const o=r/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*i;this.linearRampToValueAtTime(this._toType(c),t+a*o)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return Ar(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),r=this._fromType(this.getValueAtTime(t));Ar(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+r);const i=this._events.get(t),s=this._events.getAfter(t);return i&&dp(i.time,t)?s?(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):s&&(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time),s.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(r),t):s.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(r),t)),this._events.add({time:t,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,t),this}rampTo(e,t=.1,r){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,r):this.linearRampTo(e,t,r),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const r=this._events.get(t);if(r&&r.type==="setTargetAtTime"){const i=this._events.getAfter(r.time),s=i?i.time:t+2,o=(s-t)/10;for(let a=t;a<s;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){Ar(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,r,i,s){return r+(t-r)*Math.exp(-(s-e)/i)}_linearInterpolate(e,t,r,i,s){return t+(i-t)*((s-e)/(r-e))}_exponentialInterpolate(e,t,r,i,s){return t*Math.pow(i/t,(s-e)/(r-e))}}class Hn extends hu{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return mi(this.input)?Sb(this.input)||this.input instanceof $r?1:this.input.numberOfInputs:0}get numberOfOutputs(){return mi(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return mi(e)&&(e instanceof Hn||Uv(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(r=>{r.channelCount=e.channelCount,r.channelCountMode=e.channelCountMode,r.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();Ar(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,r=0){return wp(this,e,t,r),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return qO("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,r=0){return Xte(this,e,t,r),this}chain(...e){return Eb(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),mi(this.input)&&(this.input instanceof Hn?this.input.dispose():Uv(this.input)&&this.input.disconnect()),mi(this.output)&&(this.output instanceof Hn?this.output.dispose():Uv(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Eb(...n){const e=n.shift();n.reduce((t,r)=>(t instanceof Hn?t.connect(r):Uv(t)&&wp(t,r),r),e)}function wp(n,e,t=0,r=0){for(Ar(mi(n),"Cannot connect from undefined node"),Ar(mi(e),"Cannot connect to undefined node"),(e instanceof Hn||Uv(e))&&Ar(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Ar(n.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof Hn||e instanceof $r;)mi(e.input)&&(e=e.input);for(;n instanceof Hn;)mi(n.output)&&(n=n.output);Sb(e)?n.connect(e,t):n.connect(e,t,r)}function Xte(n,e,t=0,r=0){if(mi(e))for(;e instanceof Hn;)e=e.input;for(;!Uv(n);)mi(n.output)&&(n=n.output);Sb(e)?n.disconnect(e,t):Uv(e)?n.disconnect(e,t,r):n.disconnect()}class Pr extends Hn{constructor(){const e=jn(Pr.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new $r({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),pi(this,"gain")}static getDefaults(){return Object.assign(Hn.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class kx extends Hn{constructor(e){super(e),this.onended=ns,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Pr({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const r=this.toSeconds(t);return this._startTime!==-1&&r>=this._startTime&&(this._stopTime===-1||r<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(Hn.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:ns})}_startGain(e,t=1){Ar(this._startTime===-1,"Source cannot be started more than once");const r=this.toSeconds(this._fadeIn);return this._startTime=e+r,this._startTime=Math.max(this._startTime,this.context.currentTime),r>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+r):this._gainNode.gain.exponentialApproachValueAtTime(t,e,r)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){Ar(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.now()),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const r=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+r),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==ns&&(this.onended(this),this.onended=ns,!this.context.isOffline)){const e=()=>this.dispose();typeof requestIdleCallback<"u"?requestIdleCallback(e):setTimeout(e,10)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Ar(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=ns,this}}class JU extends kx{constructor(){const e=jn(JU.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),wp(this._source,this._gainNode),this.offset=new $r({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(kx.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class xi extends Hn{constructor(){const e=jn(xi.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new JU({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(Hn.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,r=0){return QO(this,e,t,r),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,r){return this._param.exponentialRampTo(e,t,r),this}linearRampTo(e,t,r){return this._param.linearRampTo(e,t,r),this}targetRampTo(e,t,r){return this._param.targetRampTo(e,t,r),this}exponentialApproachValueAtTime(e,t,r){return this._param.exponentialApproachValueAtTime(e,t,r),this}setTargetAtTime(e,t,r){return this._param.setTargetAtTime(e,t,r),this}setValueCurveAtTime(e,t,r,i){return this._param.setValueCurveAtTime(e,t,r,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,r){return this._param.rampTo(e,t,r),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function QO(n,e,t,r){(e instanceof $r||Sb(e)||e instanceof xi&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof xi&&(e.overridden=!0)),wp(n,e,t,r)}class QU extends $r{constructor(){const e=jn(QU.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new Rd(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign($r.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,r){t=this.toSeconds(t),this.setRampPoint(t);const i=this._fromType(e),s=this._events.get(t),o=Math.round(Math.max(1/r,1));for(let a=0;a<=o;a++){const c=r*a+t,l=this._exponentialApproach(s.time,s.value,i,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,t){const r=this.toSeconds(t);super.setValueAtTime(e,t);const i=this._events.get(r),s=this._events.previousEvent(i),o=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,t){const r=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const i=this._events.get(r),s=this._events.previousEvent(i),o=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const r=this._fromType(e),i=this._events.get(t),s=Math.round(Math.max((t-i.time)*10,1)),o=(t-i.time)/s;for(let a=0;a<=s;a++){const c=o*a+i.time,l=this._exponentialInterpolate(i.time,i.value,t,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Of(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const r=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(t));const s=this._events.get(t);return s&&s.time===t&&s.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(r+i)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),r=this._events.get(t);return Math.max(this._getTicksUntilEvent(r,t),0)}getDurationOfTicks(e,t){const r=this.toSeconds(t),i=this.getTicksAtTime(t);return this.getTimeOfTick(i+e)-r}getTimeOfTick(e){const t=this._events.get(e,"ticks"),r=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&r&&r.type==="linearRampToValueAtTime"&&t.value!==r.value){const i=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(r.time))-i)/(r.time-t.time),a=Math.sqrt(Math.pow(i,2)-2*o*(t.ticks-e)),c=(-i+a)/o,l=(-i-a)/o;return(c>0?c:l)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const r=this.toSeconds(t),i=this.toSeconds(e),s=this.getTicksAtTime(r);return this.getTicksAtTime(r+i)-s}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class e8 extends xi{constructor(){const e=jn(e8.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new QU({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(xi.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class t8 extends hu{constructor(){const e=jn(t8.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new AR,this._tickOffset=new Rd,this._ticksAtTime=new Rd,this._secondsAtTime=new Rd,this.frequency=new e8({context:this.context,units:e.units,value:e.frequency}),pi(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},hu.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const r=this.toSeconds(e);return this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),mi(t)&&this.setTicksAtTime(t,r),this._ticksAtTime.cancel(r),this._secondsAtTime.cancel(r)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const r=this._state.get(t);r&&r.time>0&&(this._tickOffset.cancel(r.time),this._state.cancel(r.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),r=this._state.getLastState("stopped",t),i=this._ticksAtTime.get(t),s={state:"paused",time:t};this._state.add(s);let o=i||r,a=i?i.ticks:0,c=null;return this._state.forEachBetween(o.time,t+this.sampleTime,l=>{let u=o.time;const h=this._tickOffset.get(l.time);h&&h.time>=o.time&&(a=h.ticks,u=h.time),o.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!==s.time&&(c={state:l.state,time:l.time,ticks:a})),o=l}),this._state.remove(s),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),r=this.frequency.timeToTicks(e,t);this.setTicksAtTime(r,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),r={state:"paused",time:e};this._state.add(r);const i=this._secondsAtTime.get(e);let s=i||t,o=i?i.seconds:0,a=null;return this._state.forEachBetween(s.time,e+this.sampleTime,c=>{let l=s.time;const u=this._tickOffset.get(c.time);u&&u.time>=s.time&&(o=u.seconds,l=u.time),s.state==="started"&&c.state!=="started"&&(o+=c.time-l,c.time!==r.time&&(a={state:c.state,time:c.time,seconds:o})),s=c}),this._state.remove(r),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const r=this._tickOffset.get(t),i=this._state.get(t),s=Math.max(r.time,i.time),o=this.frequency.getTicksAtTime(s)+e-r.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,t,r){let i=this._state.get(e);this._state.forEachBetween(e,t,o=>{i&&i.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),o.time-this.sampleTime,r),i=o});let s=null;if(i&&i.state==="started"){const o=Math.max(i.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(i.time),l=a-c;let u=Math.ceil(l)-l;u=dp(u,1)?0:u;let h=this.frequency.getTimeOfTick(a+u);for(;h<t;){try{r(h,Math.round(this.getTicksAtTime(h)))}catch(f){s=f;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(s)throw s;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class e3 extends hu{constructor(){const e=jn(e3.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=ns,this._lastUpdate=0,this._state=new AR("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new t8({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,pi(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(hu.getDefaults(),{callback:ns,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){gte(this.context);const r=this.toSeconds(e);return this.log("start",r),this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),this._tickSource.start(r,t),r<this._lastUpdate&&this.emit("start",r,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const r=this.toSeconds(t),i=this.getTicksAtTime(r);return this._tickSource.getTimeOfTick(i+e,r)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,r=>{switch(r.state){case"started":const i=this._tickSource.getTicksAtTime(r.time);this.emit("start",r.time,i);break;case"stopped":r.time!==0&&this.emit("stop",r.time);break;case"paused":this.emit("pause",r.time);break}}),this._tickSource.forEachTickBetween(e,t,(r,i)=>{this.callback(r,i)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}xR.mixin(e3);class Ox extends Hn{constructor(){const e=jn(Ox.getDefaults(),arguments,["delayTime","maxDelay"]);super(e),this.name="Delay";const t=this.toSeconds(e.maxDelay);this._maxDelay=Math.max(t,this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(t),this.delayTime=new $r({context:this.context,param:this._delayNode.delayTime,units:"time",value:e.delayTime,minValue:0,maxValue:this.maxDelay}),pi(this,"delayTime")}static getDefaults(){return Object.assign(Hn.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class Th extends Hn{constructor(){const e=jn(Th.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new Pr({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,pi(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(Hn.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class n8 extends Hn{constructor(){const e=jn(n8.getDefaults(),arguments);super(e),this.name="Destination",this.input=new Th({context:this.context}),this.output=new Pr({context:this.context}),this.volume=this.input.volume,Eb(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(Hn.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),Eb(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}XO(n=>{n.destination=new n8({context:n})});ZO(n=>{n.destination.dispose()});class zBe extends Hn{constructor(){super(...arguments),this.name="Listener",this.positionX=new $r({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new $r({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new $r({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new $r({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new $r({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new $r({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new $r({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new $r({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new $r({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(Hn.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}XO(n=>{n.listener=new zBe({context:n})});ZO(n=>{n.listener.dispose()});function HBe(n,e){return ro(this,arguments,void 0,function*(t,r,i=2,s=_o().sampleRate){const o=_o(),a=new wR(i,r,s);vk(a),yield t(a);const c=a.render();vk(o);const l=yield c;return new Ms(l)})}class r8 extends v_{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=jn(r8.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const r=e.urls[t];this.add(t,r,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:ns,onload:ns,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return Ar(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,r=ns,i=ns){return s_(t)?(this.baseUrl&&t.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new Ms(this.baseUrl+t,r,i))):this._buffers.set(e.toString(),new Ms(t,r,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class yk extends Ph{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return H1(super._frequencyToUnits(e))}_ticksToUnits(e){return H1(super._ticksToUnits(e))}_beatsToUnits(e){return H1(super._beatsToUnits(e))}_secondsToUnits(e){return H1(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return Kte(this.toMidi())}transpose(e){return new yk(this.context,this.toMidi()+e)}}class wc extends qE{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class VBe extends hu{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Rd,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;this._events.forEachBefore(e+this.anticipation,t=>{e-t.time<=this.expiration&&t.callback(),this._events.remove(t)}),this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}XO(n=>{n.draw=new VBe({context:n})});ZO(n=>{n.draw.dispose()});class GBe extends v_{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){Ar(mi(e.time),"Events must have a time property"),Ar(mi(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new $Be(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const r of t)if(r.event===e){this._removeNode(r),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let r,i=null;if(t>0)if(e.left.right===null)r=e.left,r.right=e.right,i=r;else{for(r=e.left.right;r.right!==null;)r=r.right;r.parent&&(r.parent.right=r.left,i=r.parent,r.left=e.left,r.right=e.right)}else if(e.right.left===null)r=e.right,r.left=e.left,i=r;else{for(r=e.right.left;r.left!==null;)r=r.left;r.parent&&(r.parent.left=r.right,i=r.parent,r.left=e.left,r.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=r:e.parent.right=r:this._setRoot(r),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const t=e.parent,r=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),t!==null?r?t.left=i:t.right=i:this._setRoot(i)}_rotateRight(e){const t=e.parent,r=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),t!==null?r?t.left=i:t.right=i:this._setRoot(i)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let r=t[0];for(let i=1;i<t.length;i++)t[i].low>r.low&&(r=t[i]);return r.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(r=>t.push(r)),t.forEach(r=>{r.event&&e(r.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const r=[];this._root.search(e,r),r.forEach(i=>{i.event&&t(i.event)})}return this}forEachFrom(e,t){if(this._root!==null){const r=[];this._root.searchAfter(e,r),r.forEach(i=>{i.event&&t(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class $Be{constructor(e,t,r){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=r,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class WBe extends v_{constructor(e){super(),this.name="TimelineValue",this._timeline=new Rd({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class Ap extends Hn{constructor(){super(jn(Ap.getDefaults(),arguments,["context"]))}connect(e,t=0,r=0){return QO(this,e,t,r),this}}class ay extends Ap{constructor(){const e=jn(ay.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,Fh(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):gBe(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(xi.getDefaults(),{length:1024})}setMap(e,t=1024){const r=new Float32Array(t);for(let i=0,s=t;i<s;i++){const o=i/(s-1)*2-1;r[i]=e(o,i)}return this.curve=r,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(r=>r.includes(e));Ar(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class t3 extends Ap{constructor(){const e=jn(t3.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new ay({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(Ap.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Yv{constructor(e,t){this.id=Yv._eventId++,this._remainderTime=0;const r=Object.assign(Yv.getDefaults(),t);this.transport=e,this.callback=r.callback,this._once=r.once,this.time=Math.floor(r.time),this._remainderTime=r.time-this.time}static getDefaults(){return{callback:ns,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const t=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*t),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}Yv._eventId=0;class i8 extends Yv{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const r=Object.assign(i8.getDefaults(),t);this.duration=r.duration,this._interval=r.interval,this._nextTick=r.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Yv.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return _k(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new wc(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){_k(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new wc(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const t=this.transport.getTicksAtTime(e);Mx(t,this.time)&&(this._nextTick=this.floatTime+Math.ceil((t-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class n3 extends hu{constructor(){const e=jn(n3.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new WBe(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Rd,this._repeatedEvents=new GBe,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new e3({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),pi(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(hu.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const r=t%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(r*Math.PI)*this._swingAmount;e+=new wc(this.context,this._swingTicks*2/3).toSeconds()*i}KH(!0),this._timeline.forEachAtTime(t,r=>r.invoke(e)),KH(!1)}schedule(e,t){const r=new Yv(this,{callback:e,time:new qE(this.context,t).toTicks()});return this._addEvent(r,this._timeline)}scheduleRepeat(e,t,r,i=1/0){const s=new i8(this,{callback:e,duration:new xd(this.context,i).toTicks(),interval:new xd(this.context,t).toTicks(),time:new qE(this.context,r).toTicks()});return this._addEvent(s,this._repeatedEvents)}scheduleOnce(e,t){const r=new Yv(this,{callback:e,once:!0,time:new qE(this.context,t).toTicks()});return this._addEvent(r,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,r=>this.clear(r.id)),this._repeatedEvents.forEachFrom(t,r=>this.clear(r.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new wc(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){this.context.resume();let r;return mi(t)&&(r=this.toTicks(t)),this._clock.start(e,r),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){Fh(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new xd(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new xd(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new wc(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new wc(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),r=this._clock.frequency.timeToTicks(e,t);this.ticks=r}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const r=this._clock.getTicksAtTime(t),i=this._clock.frequency.getDurationOfTicks(Math.ceil(r)-r,t),s=t+i;this.emit("stop",s),this._clock.setTicksAtTime(e,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this.emit("ticks",t),this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),r=this.getTicksAtTime(t),i=e-r%e;return this._clock.nextTickTime(i,t)}}syncSignal(e,t){const r=this.now();let i=this.bpm,s=1/(60/i.getValueAtTime(r)/this.PPQ),o=[];if(e.units==="time"){const c=.015625/s,l=new Pr(c),u=new t3(-1),h=new Pr(c);i.chain(l,u,h),i=h,s=1/s,o=[l,u,h]}t||(e.getValueAtTime(r)!==0?t=e.getValueAtTime(r)/s:t=0);const a=new Pr(t);return i.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const r=this._syncedSignals[t];r.signal===e&&(r.nodes.forEach(i=>i.dispose()),r.signal.value=r.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),TR(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}xR.mixin(n3);XO(n=>{n.transport=new n3({context:n})});ZO(n=>{n.transport.dispose()});class Ea extends Hn{constructor(e){super(e),this.input=void 0,this._state=new AR("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=ns,this._syncedStop=ns,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Th({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,pi(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(Hn.getDefaults(),{mute:!1,onstop:ns,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,r){let i=Of(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")Ar(Mx(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,t,r);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const s=this._state.get(i);s&&(s.offset=this.toSeconds(Qm(t,0)),s.duration=r?this.toSeconds(r):void 0);const o=this.context.transport.schedule(a=>{this._start(a,t,r)},i);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else gte(this.context),this._start(i,t,r);return this}stop(e){let t=Of(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||mi(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const r=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(r)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,r){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,r)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(Mx(t,0)){const r=this._state.get(t);if(r&&r.state==="started"&&r.time!==t){const i=t-this.toSeconds(r.time);let s;r.duration&&(s=this.toSeconds(r.duration)-i),this._start(e,this.toSeconds(r.offset)+i,s)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=ns,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class RR extends kx{constructor(){const e=jn(RR.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,wp(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new $r({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new Ms(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(kx.getDefaults(),{url:new Ms,loop:!1,loopEnd:0,loopStart:0,onload:ns,onerror:ns,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,r,i=1){Ar(this.buffer.loaded,"buffer is either not set or not loaded");const s=this.toSeconds(e);this._startGain(s,i),this.loop?t=Qm(t,this.loopStart):t=Qm(t,0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;y4(o,a)&&(o=(o-c)%l+c),dp(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,_k(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(s,o)),mi(r)){let a=this.toSeconds(r);a=Math.max(a,0),this.stop(s+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class xb extends Ea{constructor(){const e=jn(xb.getDefaults(),arguments,["type"]);super(e),this.name="Noise",this._source=null,this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Ea.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(Ar(e in ZH,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const t=ZH[this._type];this._source=new RR({url:t,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(t.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const QS=44100*5,mP=2,Og={brown:null,pink:null,white:null},ZH={get brown(){if(!Og.brown){const n=[];for(let e=0;e<mP;e++){const t=new Float32Array(QS);n[e]=t;let r=0;for(let i=0;i<QS;i++){const s=Math.random()*2-1;t[i]=(r+.02*s)/1.02,r=t[i],t[i]*=3.5}}Og.brown=new Ms().fromArray(n)}return Og.brown},get pink(){if(!Og.pink){const n=[];for(let e=0;e<mP;e++){const t=new Float32Array(QS);n[e]=t;let r,i,s,o,a,c,l;r=i=s=o=a=c=l=0;for(let u=0;u<QS;u++){const h=Math.random()*2-1;r=.99886*r+h*.0555179,i=.99332*i+h*.0750759,s=.969*s+h*.153852,o=.8665*o+h*.3104856,a=.55*a+h*.5329522,c=-.7616*c-h*.016898,t[u]=r+i+s+o+a+c+l+h*.5362,t[u]*=.11,l=h*.115926}}Og.pink=new Ms().fromArray(n)}return Og.pink},get white(){if(!Og.white){const n=[];for(let e=0;e<mP;e++){const t=new Float32Array(QS);n[e]=t;for(let r=0;r<QS;r++)t[r]=Math.random()*2-1}Og.white=new Ms().fromArray(n)}return Og.white}};function Gb(n,e){return ro(this,void 0,void 0,function*(){const t=e/n.context.sampleRate,r=new wR(1,t,n.context.sampleRate);return new n.constructor(Object.assign(n.get(),{frequency:2/t,detune:0,context:r})).toDestination().start(0),(yield r.render()).getChannelData(0)})}class s8 extends kx{constructor(){const e=jn(s8.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],wp(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new $r({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new $r({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),pi(this,["frequency","detune"])}static getDefaults(){return Object.assign(kx.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Xo extends Ea{constructor(){const e=jn(Xo.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new xi({context:this.context,units:"frequency",value:e.frequency}),pi(this,"frequency"),this.detune=new xi({context:this.context,units:"cents",value:e.detune}),pi(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(Ea.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),r=new s8({context:this.context,onended:()=>this.onstop(this)});this._oscillator=r,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Xo._periodicWaveCache.find(t=>t.phase===this._phase&&kBe(t.partials,this._partials));{const e=Xo._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const r=this._getCachedPeriodicWave();if(mi(r)){const{partials:i,wave:s}=r;this._wave=s,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,s]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(i,s);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Xo._periodicWaveCache.push({imag:s,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),Xo._periodicWaveCache.length>100&&Xo._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Ed(e,0);let t=this._type;const r=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(r&&(t=r[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const i=new Float32Array(e);this._partials.forEach((s,o)=>i[o]=s),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,t){let i=2048;const s=new Float32Array(i),o=new Float32Array(i);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,i=a,this._partials.length===0)return[s,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),i=a):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(s[c]=-u*Math.sin(t*c),o[c]=u*Math.cos(t*c)):(s[c]=0,o[c]=0)}return[s,o]}_inverseFFT(e,t,r){let i=0;const s=e.length;for(let o=0;o<s;o++)i+=e[o]*Math.cos(o*r)+t[o]*Math.sin(o*r);return i}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let r=0;const i=Math.PI*2,s=32;for(let o=0;o<s;o++)r=Math.max(this._inverseFFT(e,t,o/s*i),r);return IBe(-this._inverseFFT(e,t,this._phase)/r,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return ro(this,arguments,void 0,function*(e=1024){return Gb(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Xo._periodicWaveCache=[];class o8 extends Ap{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new ay({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class su extends xi{constructor(){const e=jn(su.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new Pr({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(xi.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class r3 extends Ea{constructor(){const e=jn(r3.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new o8({context:this.context}),this._modulationNode=new Pr({context:this.context}),this._carrier=new Xo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Xo({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new su({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),pi(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Xo.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return ro(this,arguments,void 0,function*(e=1024){return Gb(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class CR extends Ea{constructor(){const e=jn(CR.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new Pr({context:this.context,gain:0}),this._carrier=new Xo({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new xi({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Xo({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new su({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new su({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),pi(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Xo.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return ro(this,arguments,void 0,function*(e=1024){return Gb(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class MR extends Ea{constructor(){const e=jn(MR.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new Pr({context:this.context,gain:0}),this._thresh=new ay({context:this.context,mapping:t=>t<=0?-1:1}),this.width=new xi({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Xo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),pi(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Ea.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return ro(this,arguments,void 0,function*(e=1024){return Gb(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class i3 extends Ea{constructor(){const e=jn(i3.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new xi({context:this.context,units:"frequency",value:e.frequency}),this.detune=new xi({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,pi(this,["frequency","detune"])}static getDefaults(){return Object.assign(Xo.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,r=e/(this._oscillators.length-1);this._forEach((i,s)=>i.detune.value=t+r*s)}}get count(){return this._oscillators.length}set count(e){if(Ed(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const r=new Xo({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):ns});this.type==="custom"&&(r.partials=this._partials),this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.detune.overridden=!1,r.connect(this.output),this._oscillators[t]=r}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,r)=>t.phase=this._phase+r/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(){return ro(this,arguments,void 0,function*(e=1024){return Gb(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class s3 extends Ea{constructor(){const e=jn(s3.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new su({context:this.context,value:2}),this._pulse=new MR({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Xo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),pi(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Ea.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return ro(this,arguments,void 0,function*(e=1024){return Gb(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const JH={am:r3,fat:i3,fm:CR,oscillator:Xo,pulse:MR,pwm:s3};class Ym extends Ea{constructor(){const e=jn(Ym.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new xi({context:this.context,units:"frequency",value:e.frequency}),this.detune=new xi({context:this.context,units:"cents",value:e.detune}),pi(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Xo.getDefaults(),CR.getDefaults(),r3.getDefaults(),i3.getDefaults(),MR.getDefaults(),s3.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=JH[e],r=this.now();if(this._oscillator){const i=this._oscillator;i.stop(r),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(r)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof JH[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&Tp(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&Tp(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&s_(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return ro(this,arguments,void 0,function*(e=1024){return Gb(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class a8 extends xi{constructor(){super(jn(a8.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new Pr({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,Eb(this._constantSource,this._sum)}static getDefaults(){return Object.assign(xi.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class Ix extends Ap{constructor(){const e=jn(Ix.getDefaults(),arguments,["min","max"]);super(e),this.name="Scale",this._mult=this.input=new su({context:this.context,value:e.max-e.min}),this._add=this.output=new a8({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Ap.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class c8 extends Ap{constructor(){super(jn(c8.getDefaults(),arguments)),this.name="Zero",this._gain=new Pr({context:this.context}),this.output=this._gain,this.input=void 0,wp(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),Xte(this.context.getConstant(0),this._gain),this}}class Nx extends Hn{constructor(){const e=jn(Nx.getDefaults(),arguments,["frequency","min","max"]);super(e),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=$r.prototype._fromType,this._toType=$r.prototype._toType,this._is=$r.prototype._is,this._clampValue=$r.prototype._clampValue,this._oscillator=new Xo(e),this.frequency=this._oscillator.frequency,this._amplitudeGain=new Pr({context:this.context,gain:e.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new xi({context:this.context,units:"audioRange",value:0}),this._zeros=new c8({context:this.context}),this._a2g=new o8({context:this.context}),this._scaler=this.output=new Ix({context:this.context,max:e.max,min:e.min}),this.units=e.units,this.min=e.min,this.max=e.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),pi(this,["amplitude","frequency"]),this.phase=e.phase}static getDefaults(){return Object.assign(Xo.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}stop(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(e){e=this._fromType(e),this._scaler.min=e}get max(){return this._toType(this._scaler.max)}set max(e){e=this._fromType(e),this._scaler.max=e}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(e){this._oscillator.partials=e,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e,this._setStoppedValue()}get units(){return this._units}set units(e){const t=this.min,r=this.max;this._units=e,this.min=t,this.max=r}get state(){return this._oscillator.state}connect(e,t,r){return(e instanceof $r||e instanceof xi)&&(this.convert=e.convert,this.units=e.units),QO(this,e,t,r),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function Zte(n,e=1/0){const t=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(s){Ed(s,n,e),t.set(this,s)}})}}function y_(n,e=1/0){const t=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(s){Ed(this.toSeconds(s),n,e),t.set(this,s)}})}}class kR extends Ea{constructor(){const e=jn(kR.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new Ms({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Ea.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:ns,onerror:ns,playbackRate:1,reverse:!1})}load(e){return ro(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=ns){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,r){return super.start(e,t,r),this}_start(e,t,r){this._loop?t=Qm(t,this._loopStart):t=Qm(t,0);const i=this.toSeconds(t),s=r;r=Qm(r,Math.max(this._buffer.duration-i,0));let o=this.toSeconds(r);o=o/this._playbackRate,e=this.toSeconds(e);const a=new RR({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&Of(s)?a.start(e,i):a.start(e,i,o-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(r=>r.stop(t))}restart(e,t,r){return super.restart(e,t,r),this}_restart(e,t,r){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,t,r)}seek(e,t){const r=this.toSeconds(t);if(this._state.getValueAtTime(r)==="started"){const i=this.toSeconds(e);this._stop(r),this._start(r,i)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Ed(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Ed(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),r=this._state.getNextState("stopped",t);r&&r.implicitEnd&&(this._state.cancel(r.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Os([y_(0)],kR.prototype,"fadeIn",void 0);Os([y_(0)],kR.prototype,"fadeOut",void 0);class qBe extends Ap{constructor(){super(...arguments),this.name="Abs",this._abs=new ay({context:this.context,mapping:e=>Math.abs(e)<.001?0:Math.abs(e)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class YBe extends Ap{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new ay({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class l8 extends Ix{constructor(){const e=jn(l8.getDefaults(),arguments,["min","max","exponent"]);super(e),this.name="ScaleExp",this.input=this._exp=new t3({context:this.context,value:e.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(Ix.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(e){this._exp.value=e}dispose(){return super.dispose(),this._exp.dispose(),this}}class Ol extends Hn{constructor(){const e=jn(Ol.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new xi({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(Hn.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(s_(e))return e;{let r;for(r in $2)if($2[r][t]===e)return r;return e}}_setCurve(e,t,r){if(s_(r)&&Reflect.has($2,r)){const i=$2[r];Lv(i)?e!=="_decayCurve"&&(this[e]=i[t]):this[e]=i}else if(Fh(r)&&e!=="_decayCurve")this[e]=r;else throw new Error("Envelope: invalid curve: "+r)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/i;i=(1-o)/a}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,i,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,i,t)}if(s&&this.sustain<1){const a=t*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,s+c):this._sig.exponentialApproachValueAtTime(a,c,s)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const r=this.toSeconds(this.release);r<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,r,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,r,e):(Ar(Fh(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,r,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,r=1){return t=this.toSeconds(t),this.triggerAttack(t,r),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,r=0){return QO(this,e,t,r),this}asArray(){return ro(this,arguments,void 0,function*(e=1024){const t=e/this.context.sampleRate,r=new wR(1,t,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),s=i+this.toSeconds(this.release),o=s*.1,a=s+o,c=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/a,decay:t*this.toSeconds(this.decay)/a,release:t*this.toSeconds(this.release)/a,context:r}));return c._sig.toDestination(),c.triggerAttackRelease(t*(i+o)/a,0),(yield r.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}Os([y_(0)],Ol.prototype,"attack",void 0);Os([y_(0)],Ol.prototype,"decay",void 0);Os([Zte(0,1)],Ol.prototype,"sustain",void 0);Os([y_(0)],Ol.prototype,"release",void 0);const $2=(()=>{let e,t;const r=[];for(e=0;e<128;e++)r[e]=Math.sin(e/127*(Math.PI/2));const i=[],s=6.4;for(e=0;e<127;e++){t=e/127;const f=Math.sin(t*(Math.PI*2)*s-Math.PI/2)+1;i[e]=f/10+t*.83}i[127]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/127*a)/a;const c=[];for(e=0;e<128;e++)t=e/127,c[e]=.5*(1-Math.cos(Math.PI*t));const l=[];for(e=0;e<128;e++){t=e/127;const f=Math.pow(t,3)*4+.2,d=Math.cos(f*Math.PI*2*t);l[e]=Math.abs(d*(1-t))}function u(f){const d=new Array(f.length);for(let p=0;p<f.length;p++)d[p]=1-f[p];return d}function h(f){return f.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:r,Out:h(r)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class u0 extends Hn{constructor(){const e=jn(u0.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t),this._volume=this.output=new Th({context:this.context,volume:e.volume}),this.volume=this._volume.volume,pi(this,"volume")}static getDefaults(){return Object.assign(Hn.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const r=this["_original_"+e]=this[e];this[e]=(...i)=>{const s=i[t],o=this.context.transport.schedule(a=>{i[t]=a,r.apply(this,i)},s);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,t,r,i){const s=this.toSeconds(r),o=this.toSeconds(t);return this.triggerAttack(e,s,i),this.triggerRelease(s+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class If extends u0{constructor(){const e=jn(If.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(u0.getDefaults(),{detune:0,onsilence:ns,portamento:0})}triggerAttack(e,t,r=1){this.log("triggerAttack",e,t,r);const i=this.toSeconds(t);return this._triggerEnvelopeAttack(i,r),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const r=this.toSeconds(t),i=e instanceof Ph?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(r)>.05){const s=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,s,r)}else this.frequency.setValueAtTime(i,r);return this}}Os([y_(0)],If.prototype,"portamento",void 0);class o3 extends Ol{constructor(){super(jn(o3.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Pr({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class sc extends If{constructor(){const e=jn(sc.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new Ym(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new o3(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),pi(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(If.getDefaults(),{envelope:Object.assign(rl(Ol.getDefaults(),Object.keys(Hn.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(rl(Ym.getDefaults(),[...Object.keys(Ea.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const r=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+r+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class bk extends If{constructor(){const e=jn(bk.getDefaults(),arguments);super(e),this.name="ModulationSynth",this._carrier=new sc({context:this.context,oscillator:e.oscillator,envelope:e.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new sc({context:this.context,oscillator:e.modulation,envelope:e.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new xi({context:this.context,units:"frequency"}),this.detune=new xi({context:this.context,value:e.detune,units:"cents"}),this.harmonicity=new su({context:this.context,value:e.harmonicity,minValue:0}),this._modulationNode=new Pr({context:this.context,gain:0}),pi(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(If.getDefaults(),{harmonicity:3,oscillator:Object.assign(rl(Ym.getDefaults(),[...Object.keys(Ea.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(rl(Ol.getDefaults(),Object.keys(Hn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(rl(Ym.getDefaults(),[...Object.keys(Ea.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(rl(Ol.getDefaults(),Object.keys(Hn.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(e,t){this._carrier._triggerEnvelopeAttack(e,t),this._modulator._triggerEnvelopeAttack(e,t)}_triggerEnvelopeRelease(e){return this._carrier._triggerEnvelopeRelease(e),this._modulator._triggerEnvelopeRelease(e),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class Px extends Hn{constructor(){const e=jn(Px.getDefaults(),arguments,["frequency","type"]);super(e),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new $r({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new $r({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new $r({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new $r({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(Hn.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){Ar(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const t=new Float32Array(e);for(let o=0;o<e;o++){const c=Math.pow(o/e,2)*19980+20;t[o]=c}const r=new Float32Array(e),i=new Float32Array(e),s=this.context.createBiquadFilter();return s.type=this.type,s.Q.value=this.Q.value,s.frequency.value=this.frequency.value,s.gain.value=this.gain.value,s.getFrequencyResponse(t,r,i),r}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class il extends Hn{constructor(){const e=jn(il.getDefaults(),arguments,["frequency","type","rolloff"]);super(e),this.name="Filter",this.input=new Pr({context:this.context}),this.output=new Pr({context:this.context}),this._filters=[],this._filters=[],this.Q=new xi({context:this.context,units:"positive",value:e.Q}),this.frequency=new xi({context:this.context,units:"frequency",value:e.frequency}),this.detune=new xi({context:this.context,units:"cents",value:e.detune}),this.gain=new xi({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,pi(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(Hn.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){Ar(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(r=>r.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const t=Tp(e)?e:parseInt(e,10),r=[-12,-24,-48,-96];let i=r.indexOf(t);Ar(i!==-1,`rolloff can only be ${r.join(", ")}`),i+=1,this._rolloff=t,this.input.disconnect(),this._filters.forEach(s=>s.disconnect()),this._filters=new Array(i);for(let s=0;s<i;s++){const o=new Px({context:this.context});o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[s]=o}this._internalChannels=this._filters,Eb(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const t=new Px({context:this.context,frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),r=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{t.getFrequencyResponse(e).forEach((s,o)=>r[o]*=s)}),t.dispose(),r}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),TR(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class u8 extends bk{constructor(){const e=jn(u8.getDefaults(),arguments);super(e),this.name="FMSynth",this.modulationIndex=new su({context:this.context,value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(bk.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}const QH=[1,1.483,1.932,2.546,2.63,3.897];class h8 extends If{constructor(){const e=jn(h8.getDefaults(),arguments);super(e),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[],this.detune=new xi({context:this.context,units:"cents",value:e.detune}),this.frequency=new xi({context:this.context,units:"frequency"}),this._amplitude=new Pr({context:this.context,gain:0}).connect(this.output),this._highpass=new il({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let t=0;t<QH.length;t++){const r=new CR({context:this.context,harmonicity:e.harmonicity,modulationIndex:e.modulationIndex,modulationType:"square",onstop:t===0?()=>this.onsilence(this):ns,type:"square"});r.connect(this._highpass),this._oscillators[t]=r;const i=new su({context:this.context,value:QH[t]});this._freqMultipliers[t]=i,this.frequency.chain(i,r.frequency),this.detune.connect(r.detune)}this._filterFreqScaler=new Ix({context:this.context,max:7e3,min:this.toFrequency(e.resonance)}),this.envelope=new Ol({attack:e.envelope.attack,attackCurve:"linear",context:this.context,decay:e.envelope.decay,release:e.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=e.octaves,this.octaves=e.octaves}static getDefaults(){return Bv(If.getDefaults(),{envelope:Object.assign(rl(Ol.getDefaults(),Object.keys(Hn.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(e,t=1){return this.envelope.triggerAttack(e,t),this._oscillators.forEach(r=>r.start(e)),this.envelope.sustain===0&&this._oscillators.forEach(r=>{r.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))}),this}_triggerEnvelopeRelease(e){return this.envelope.triggerRelease(e),this._oscillators.forEach(t=>t.stop(e+this.toSeconds(this.envelope.release))),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(e){this._oscillators.forEach(t=>t.modulationIndex.value=e)}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(e){this._oscillators.forEach(t=>t.harmonicity.value=e)}get resonance(){return this._filterFreqScaler.min}set resonance(e){this._filterFreqScaler.min=this.toFrequency(e),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,e)}dispose(){return super.dispose(),this._oscillators.forEach(e=>e.dispose()),this._freqMultipliers.forEach(e=>e.dispose()),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class rT extends sc{constructor(){const e=jn(rT.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,pi(this,["oscillator","envelope"])}static getDefaults(){return Bv(If.getDefaults(),sc.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const r=this.toSeconds(t),i=this.toFrequency(e instanceof Ph?e.toFrequency():e),s=i*this.octaves;return this.oscillator.frequency.setValueAtTime(s,r),this.oscillator.frequency.exponentialRampToValueAtTime(i,r+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Os([Zte(0)],rT.prototype,"octaves",void 0);Os([y_(0)],rT.prototype,"pitchDecay",void 0);class wv extends u0{constructor(){const e=jn(wv.getDefaults(),arguments);super(e),this.name="NoiseSynth",this.noise=new xb(Object.assign({context:this.context},e.noise)),this.envelope=new o3(Object.assign({context:this.context},e.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(u0.getDefaults(),{envelope:Object.assign(rl(Ol.getDefaults(),Object.keys(Hn.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(rl(xb.getDefaults(),Object.keys(Ea.getDefaults())),{type:"white"})})}triggerAttack(e,t=1){return e=this.toSeconds(e),this.envelope.triggerAttack(e,t),this.noise.start(e),this.envelope.sustain===0&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(e,t,r=1){return t=this.toSeconds(t),e=this.toSeconds(e),this.triggerAttack(t,r),this.triggerRelease(t+e),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const Jte=new Set;function f8(n){Jte.add(n)}function Qte(n,e){const t=`registerProcessor("${n}", ${e})`;Jte.add(t)}const KBe=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;f8(KBe);const XBe=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;f8(XBe);const ZBe=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;f8(ZBe);const JBe="feedback-comb-filter",QBe=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;Qte(JBe,QBe);class d8 extends Hn{constructor(){const e=jn(d8.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OnePoleFilter",this._frequency=e.frequency,this._type=e.type,this.input=new Pr({context:this.context}),this.output=new Pr({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(Hn.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const e=this._filter,t=this.toFrequency(this._frequency),r=1/(2*Math.PI*t);if(this._type==="lowpass"){const i=1/(r*this.context.sampleRate),s=i-1;this._filter=this.context.createIIRFilter([i,0],[1,s])}else{const i=1/(r*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,i])}this.input.chain(this._filter,this.output),e&&this.context.setTimeout(()=>{this.disposed||(this.input.disconnect(e),e.disconnect())},this.blockTime)}get frequency(){return this._frequency}set frequency(e){this._frequency=e,this._createFilter()}get type(){return this._type}set type(e){this._type=e,this._createFilter()}getFrequencyResponse(e=128){const t=new Float32Array(e);for(let s=0;s<e;s++){const a=Math.pow(s/e,2)*19980+20;t[s]=a}const r=new Float32Array(e),i=new Float32Array(e);return this._filter.getFrequencyResponse(t,r,i),r}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class p8 extends u0{constructor(){const e=jn(p8.getDefaults(),arguments,["voice","options"]);super(e),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=i=>this.releaseAll(i),Ar(!Tp(e.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const t=e.voice.getDefaults();this.options=Object.assign(t,e.options),this.voice=e.voice,this.maxPolyphony=e.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const r=this._voices.indexOf(this._dummyVoice);this._voices.splice(r,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(u0.getDefaults(),{maxPolyphony:32,options:{},voice:sc})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(e){this._availableVoices.push(e);const t=this._activeVoices.findIndex(r=>r.voice===e);this._activeVoices.splice(t,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return Ar(e instanceof If,"Voice must extend Monophonic class"),e.connect(this.output),this._voices.push(e),e}else qO("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const e=this._availableVoices.shift(),t=this._voices.indexOf(e);this._voices.splice(t,1),this.context.isOffline||e.dispose()}}_triggerAttack(e,t,r){e.forEach(i=>{const s=new yk(this.context,i).toMidi(),o=this._getNextAvailableVoice();o&&(o.triggerAttack(i,t,r),this._activeVoices.push({midi:s,voice:o,released:!1}),this.log("triggerAttack",i,t))})}_triggerRelease(e,t){e.forEach(r=>{const i=new yk(this.context,r).toMidi(),s=this._activeVoices.find(({midi:o,released:a})=>o===i&&!a);s&&(s.voice.triggerRelease(t),s.released=!0,this.log("triggerRelease",r,t))})}_scheduleEvent(e,t,r,i){Ar(!this.disposed,"Synth was already disposed"),r<=this.now()?e==="attack"?this._triggerAttack(t,r,i):this._triggerRelease(t,r):this.context.setTimeout(()=>{this.disposed||this._scheduleEvent(e,t,r,i)},r-this.now())}triggerAttack(e,t,r){Array.isArray(e)||(e=[e]);const i=this.toSeconds(t);return this._scheduleEvent("attack",e,i,r),this}triggerRelease(e,t){Array.isArray(e)||(e=[e]);const r=this.toSeconds(t);return this._scheduleEvent("release",e,r),this}triggerAttackRelease(e,t,r,i){const s=this.toSeconds(r);if(this.triggerAttack(e,s,i),Fh(t)){Ar(Fh(e),"If the duration is an array, the notes must also be an array"),e=e;for(let o=0;o<e.length;o++){const a=t[Math.min(o,t.length-1)],c=this.toSeconds(a);Ar(c>0,"The duration must be greater than 0"),this.triggerRelease(e[o],s+c)}}else{const o=this.toSeconds(t);Ar(o>0,"The duration must be greater than 0"),this.triggerRelease(e,s+o)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(e){const t=rl(e,["onsilence","context"]);return this.options=Bv(this.options,t),this._voices.forEach(r=>r.set(t)),this._dummyVoice.set(t),this}get(){return this._dummyVoice.get()}releaseAll(e){const t=this.toSeconds(e);return this._activeVoices.forEach(({voice:r})=>{r.triggerRelease(t)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(e=>e.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class OR extends u0{constructor(){const e=jn(OR.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const t={};Object.keys(e.urls).forEach(r=>{const i=parseInt(r,10);if(Ar(G2(r)||Tp(i)&&isFinite(i),`url key is neither a note or midi pitch: ${r}`),G2(r)){const s=new Ph(this.context,r).toMidi();t[s]=e.urls[r]}else Tp(i)&&isFinite(i)&&(t[i]=e.urls[i])}),this._buffers=new r8({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(u0.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:ns,onerror:ns,release:.1,urls:{}})}_findClosest(e){let r=0;for(;r<96;){if(this._buffers.has(e+r))return-r;if(this._buffers.has(e-r))return r;r++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,r=1){return this.log("triggerAttack",e,t,r),Array.isArray(e)||(e=[e]),e.forEach(i=>{const s=Yte(new Ph(this.context,i).toFrequency()),o=Math.round(s),a=s-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),h=qte(c+a),f=new RR({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);f.start(t,0,u.duration/h,r),Fh(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(f),f.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const d=this._activeSources.get(o),p=d.indexOf(f);p!==-1&&d.splice(p,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(r=>{const i=new Ph(this.context,r).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const s=this._activeSources.get(i);t=this.toSeconds(t),s.forEach(o=>{o.stop(t)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(r=>{for(;r.length;)r.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,r,i=1){const s=this.toSeconds(r);return this.triggerAttack(e,s,i),Fh(t)?(Ar(Fh(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=t[Math.min(a,t.length-1)];this.triggerRelease(o,s+this.toSeconds(c))})):this.triggerRelease(e,s+this.toSeconds(t)),this}add(e,t,r){if(Ar(G2(e)||isFinite(e),`note must be a pitch or midi: ${e}`),G2(e)){const i=new Ph(this.context,e).toMidi();this._buffers.add(i,t,r)}else this._buffers.add(e,t,r);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}Os([y_(0)],OR.prototype,"attack",void 0);Os([y_(0)],OR.prototype,"release",void 0);class IE extends hu{constructor(){const e=jn(IE.getDefaults(),arguments,["callback","value"]);super(e),this.name="ToneEvent",this._state=new AR("stopped"),this._startOffset=0,this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._playbackRate=e.playbackRate,this._probability=e.probability,this._humanize=e.humanize,this.mute=e.mute,this._playbackRate=e.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(hu.getDefaults(),{callback:ns,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(e=-1){this._state.forEachFrom(e,t=>{let r;if(t.state==="started"){t.id!==-1&&this.context.transport.clear(t.id);const i=t.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||Tp(this._loop)&&this._loop>1){r=1/0,Tp(this._loop)&&(r=this._loop*this._getLoopDuration());const s=this._state.getAfter(i);s!==null&&(r=Math.min(r,s.time-i)),r!==1/0&&(r=new wc(this.context,r));const o=new wc(this.context,this._getLoopDuration());t.id=this.context.transport.scheduleRepeat(this._tick.bind(this),o,new wc(this.context,i),r)}else t.id=this.context.transport.schedule(this._tick.bind(this),new wc(this.context,i))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e}get probability(){return this._probability}set probability(e){this._probability=e}get humanize(){return this._humanize}set humanize(e){this._humanize=e}start(e){const t=this.toTicks(e);return this._state.getValueAtTime(t)==="stopped"&&(this._state.add({id:-1,state:"started",time:t}),this._rescheduleEvents(t)),this}stop(e){this.cancel(e);const t=this.toTicks(e);if(this._state.getValueAtTime(t)==="started"){this._state.setStateAtTime("stopped",t,{id:-1});const r=this._state.getBefore(t);let i=t;r!==null&&(i=r.time),this._rescheduleEvents(i)}return this}cancel(e){e=Qm(e,-1/0);const t=this.toTicks(e);return this._state.forEachFrom(t,r=>{this.context.transport.clear(r.id)}),this._state.cancel(t),this}_tick(e){const t=this.context.transport.getTicksAtTime(e);if(!this.mute&&this._state.getValueAtTime(t)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let r=.02;mte(this.humanize)||(r=this.toSeconds(this.humanize)),e+=(Math.random()*2-1)*r}this.callback(e,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(e){this._loop=e,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._rescheduleEvents()}get loopEnd(){return new wc(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._rescheduleEvents()}get loopStart(){return new wc(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const e=this.context.transport.ticks,t=this._state.get(e);if(t!==null&&t.state==="started"){const r=this._getLoopDuration();return(e-t.time)%r/r}else return 0}else return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class CA extends IE{constructor(){const e=jn(CA.getDefaults(),arguments,["callback","events"]);super(e),this.name="Part",this._state=new AR("stopped"),this._events=new Set,this._state.increasing=!0,e.events.forEach(t=>{Fh(t)?this.add(t[0],t[1]):this.add(t)})}static getDefaults(){return Object.assign(IE.getDefaults(),{events:[]})}start(e,t){const r=this.toTicks(e);if(this._state.getValueAtTime(r)!=="started"){t=Qm(t,this._loop?this._loopStart:0),this._loop?t=Qm(t,this._loopStart):t=Qm(t,0);const i=this.toTicks(t);this._state.add({id:-1,offset:i,state:"started",time:r}),this._forEach(s=>{this._startNote(s,r,i)})}return this}_startNote(e,t,r){t-=r,this._loop?e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd?(e.startOffset<r&&(t+=this._getLoopDuration()),e.start(new wc(this.context,t))):e.startOffset<this._loopStart&&e.startOffset>=r&&(e.loop=!1,e.start(new wc(this.context,t))):e.startOffset>=r&&e.start(new wc(this.context,t))}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e,this._forEach(t=>{t.startOffset+=this._startOffset})}stop(e){const t=this.toTicks(e);return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._forEach(r=>{r.stop(e)}),this}at(e,t){const r=new qE(this.context,e).toTicks(),i=new wc(this.context,1).toSeconds(),s=this._events.values();let o=s.next();for(;!o.done;){const a=o.value;if(Math.abs(r-a.startOffset)<i)return mi(t)&&(a.value=t),a;o=s.next()}return mi(t)?(this.add(e,t),this.at(e)):null}add(e,t){e instanceof Object&&Reflect.has(e,"time")&&(t=e,e=t.time);const r=this.toTicks(e);let i;return t instanceof IE?(i=t,i.callback=this._tick.bind(this)):i=new IE({callback:this._tick.bind(this),context:this.context,value:t}),i.startOffset=r,i.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(i),this._restartEvent(i),this}_restartEvent(e){this._state.forEach(t=>{t.state==="started"?this._startNote(e,t.time,t.offset):e.stop(new wc(this.context,t.time))})}remove(e,t){return Lv(e)&&e.hasOwnProperty("time")&&(t=e,e=t.time),e=this.toTicks(e),this._events.forEach(r=>{r.startOffset===e&&(Of(t)||mi(t)&&r.value===t)&&(this._events.delete(r),r.dispose())}),this}clear(){return this._forEach(e=>e.dispose()),this._events.clear(),this}cancel(e){return this._forEach(t=>t.cancel(e)),this._state.cancel(this.toTicks(e)),this}_forEach(e){return this._events&&this._events.forEach(t=>{t instanceof CA?t._forEach(e):e(t)}),this}_setAll(e,t){this._forEach(r=>{r[e]=t})}_tick(e,t){this.mute||this.callback(e,t)}_testLoopBoundries(e){this._loop&&(e.startOffset<this._loopStart||e.startOffset>=this._loopEnd)?e.cancel(0):e.state==="stopped"&&this._restartEvent(e)}get probability(){return this._probability}set probability(e){this._probability=e,this._setAll("probability",e)}get humanize(){return this._humanize}set humanize(e){this._humanize=e,this._setAll("humanize",e)}get loop(){return this._loop}set loop(e){this._loop=e,this._forEach(t=>{t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.loop=e,this._testLoopBoundries(t)})}get loopEnd(){return new wc(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._forEach(t=>{t.loopEnd=e,this._testLoopBoundries(t)})}get loopStart(){return new wc(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._forEach(t=>{t.loopStart=this.loopStart,this._testLoopBoundries(t)})}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._setAll("playbackRate",e)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}class a3 extends Hn{constructor(){const e=jn(a3.getDefaults(),arguments,["fade"]);super(e),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new YBe({context:this.context}),this.a=new Pr({context:this.context,gain:0}),this.b=new Pr({context:this.context,gain:0}),this.output=new Pr({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new xi({context:this.context,units:"normalRange",value:e.fade}),pi(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",wp(this._split,this.a.gain,0),wp(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(Hn.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}let fu=class extends Hn{constructor(e){super(e),this.name="Effect",this._dryWet=new a3({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new Pr({context:this.context}),this.effectReturn=new Pr({context:this.context}),this.input=new Pr({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],pi(this,"wet")}static getDefaults(){return Object.assign(Hn.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}};class eV extends fu{constructor(e){super(e),this.name="LFOEffect",this._lfo=new Nx({context:this.context,frequency:e.frequency,amplitude:e.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=e.type,pi(this,["frequency","depth"])}static getDefaults(){return Object.assign(fu.getDefaults(),{frequency:1,type:"sine",depth:1})}start(e){return this._lfo.start(e),this}stop(e){return this._lfo.stop(e),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class m8 extends eV{constructor(){const e=jn(m8.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);super(e),this.name="AutoFilter",this.filter=new il(Object.assign(e.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=e.octaves,this.baseFrequency=e.baseFrequency}static getDefaults(){return Object.assign(eV.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(e){this._lfo.min=this.toFrequency(e),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._lfo.max=this._lfo.min*Math.pow(2,e)}dispose(){return super.dispose(),this.filter.dispose(),this}}class g8 extends Hn{constructor(){const e=jn(g8.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new $r({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",pi(this,"pan")}static getDefaults(){return Object.assign(Hn.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class _8 extends Hn{constructor(){const e=jn(_8.getDefaults(),arguments,["smoothing"]);super(e),this.name="Follower",this._abs=this.input=new qBe({context:this.context}),this._lowpass=this.output=new d8({context:this.context,frequency:1/this.toSeconds(e.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=e.smoothing}static getDefaults(){return Object.assign(Hn.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(e){this._smoothing=e,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class v8 extends fu{constructor(){const e=jn(v8.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);super(e),this.name="AutoWah",this._follower=new _8({context:this.context,smoothing:e.follower}),this._sweepRange=new l8({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(e.baseFrequency),this._octaves=e.octaves,this._inputBoost=new Pr({context:this.context}),this._bandpass=new il({context:this.context,rolloff:-48,frequency:0,Q:e.Q}),this._peaking=new il({context:this.context,type:"peaking"}),this._peaking.gain.value=e.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=e.sensitivity,pi(this,["gain","Q"])}static getDefaults(){return Object.assign(fu.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(e){this._follower.smoothing=e}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){this._baseFrequency=this.toFrequency(e),this._setSweepRange()}get sensitivity(){return Wte(1/this._inputBoost.gain.value)}set sensitivity(e){this._inputBoost.gain.value=1/$te(e)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}const eFe="bit-crusher",tFe=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;Qte(eFe,tFe);class c3 extends Hn{constructor(){const e=jn(c3.getDefaults(),arguments,["channels"]);super(e),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(e.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(Hn.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class IR extends Hn{constructor(){const e=jn(IR.getDefaults(),arguments,["channels"]);super(e),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(Hn.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class tV extends Hn{constructor(e){super(e),this.name="StereoEffect",this.input=new Pr({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new a3({context:this.context,fade:e.wet}),this.wet=this._dryWet.fade,this._split=new c3({context:this.context,channels:2}),this._merge=new IR({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),pi(this,["wet"])}connectEffectLeft(...e){this._split.connect(e[0],0,0),Eb(...e),wp(e[e.length-1],this._merge,0,0)}connectEffectRight(...e){this._split.connect(e[0],1,0),Eb(...e),wp(e[e.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(Hn.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class nV extends tV{constructor(e){super(e),this.feedback=new xi({context:this.context,value:e.feedback,units:"normalRange"}),this._feedbackL=new Pr({context:this.context}),this._feedbackR=new Pr({context:this.context}),this._feedbackSplit=new c3({context:this.context,channels:2}),this._feedbackMerge=new IR({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),pi(this,["feedback"])}static getDefaults(){return Object.assign(tV.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class y8 extends nV{constructor(){const e=jn(y8.getDefaults(),arguments,["frequency","delayTime","depth"]);super(e),this.name="Chorus",this._depth=e.depth,this._delayTime=e.delayTime/1e3,this._lfoL=new Nx({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new Nx({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._delayNodeL=new Ox({context:this.context}),this._delayNodeR=new Ox({context:this.context}),this.frequency=this._lfoL.frequency,pi(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=e.type,this.spread=e.spread}static getDefaults(){return Object.assign(nV.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(e){this._depth=e;const t=this._delayTime*e;this._lfoL.min=Math.max(this._delayTime-t,0),this._lfoL.max=this._delayTime+t,this._lfoR.min=Math.max(this._delayTime-t,0),this._lfoR.max=this._delayTime+t}get delayTime(){return this._delayTime*1e3}set delayTime(e){this._delayTime=e/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(e){this._lfoL.type=e,this._lfoR.type=e}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}start(e){return this._lfoL.start(e),this._lfoR.start(e),this}stop(e){return this._lfoL.stop(e),this._lfoR.stop(e),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class MA extends fu{constructor(){const e=jn(MA.getDefaults(),arguments,["distortion"]);super(e),this.name="Distortion",this._shaper=new ay({context:this.context,length:4096}),this._distortion=e.distortion,this.connectEffect(this._shaper),this.distortion=e.distortion,this.oversample=e.oversample}static getDefaults(){return Object.assign(fu.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(e){this._distortion=e;const t=e*100,r=Math.PI/180;this._shaper.setMap(i=>Math.abs(i)<.001?0:(3+t)*i*20*r/(Math.PI+t*Math.abs(i)))}get oversample(){return this._shaper.oversample}set oversample(e){this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.dispose(),this}}class rV extends fu{constructor(e){super(e),this.name="FeedbackEffect",this._feedbackGain=new Pr({context:this.context,gain:e.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,pi(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(fu.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class b8 extends rV{constructor(){const e=jn(b8.getDefaults(),arguments,["delayTime","feedback"]);super(e),this.name="FeedbackDelay",this._delayNode=new Ox({context:this.context,delayTime:e.delayTime,maxDelay:e.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),pi(this,"delayTime")}static getDefaults(){return Object.assign(rV.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class S8 extends fu{constructor(){const e=jn(S8.getDefaults(),arguments,["decay"]);super(e),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const t=this.toSeconds(e.decay);Ed(t,.001),this._decay=t;const r=this.toSeconds(e.preDelay);Ed(r,0),this._preDelay=r,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(fu.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),Ed(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),Ed(e,0),this._preDelay=e,this.generate()}generate(){return ro(this,void 0,void 0,function*(){const e=this.ready,t=new wR(2,this._decay+this._preDelay,this.context.sampleRate),r=new xb({context:t}),i=new xb({context:t}),s=new IR({context:t});r.connect(s,0,0),i.connect(s,0,1);const o=new Pr({context:t}).toDestination();s.connect(o),r.start(0),i.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const a=t.render();return this.ready=a.then(ns),yield e,this._convolver.buffer=(yield a).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class l3 extends fu{constructor(){const e=jn(l3.getDefaults(),arguments,["frequency","depth"]);super(e),this.name="Vibrato",this._delayNode=new Ox({context:this.context,delayTime:0,maxDelay:e.maxDelay}),this._lfo=new Nx({context:this.context,type:e.type,min:0,max:e.maxDelay,frequency:e.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=e.depth,pi(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(fu.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class nc extends Hn{constructor(){const e=jn(nc.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new Pr({context:this.context}),nc._allSolos.has(this.context)||nc._allSolos.set(this.context,new Set),nc._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(Hn.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),nc._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){nc._soloed.has(this.context)||nc._soloed.set(this.context,new Set),nc._soloed.get(this.context).add(this)}_removeSolo(){nc._soloed.has(this.context)&&nc._soloed.get(this.context).delete(this)}_isSoloed(){return nc._soloed.has(this.context)&&nc._soloed.get(this.context).has(this)}_noSolos(){return!nc._soloed.has(this.context)||nc._soloed.has(this.context)&&nc._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),nc._allSolos.get(this.context).delete(this),this._removeSolo(),this}}nc._allSolos=new Map;nc._soloed=new Map;class E8 extends Hn{constructor(){const e=jn(E8.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new g8({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Th({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,pi(this,["pan","volume"])}static getDefaults(){return Object.assign(Hn.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class wh extends Hn{constructor(){const e=jn(wh.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new nc({solo:e.solo,context:this.context}),this._panVol=this.output=new E8({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),pi(this,["pan","volume"])}static getDefaults(){return Object.assign(Hn.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return wh.buses.has(e)||wh.buses.set(e,new Pr({context:this.context})),wh.buses.get(e)}send(e,t=0){const r=this._getBus(e),i=new Pr({context:this.context,units:"decibels",gain:t});return this.connect(i),i.connect(r),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}wh.buses=new Map;class x8 extends Hn{constructor(){const e=jn(x8.getDefaults(),arguments,["lowFrequency","highFrequency"]);super(e),this.name="MultibandSplit",this.input=new Pr({context:this.context}),this.output=void 0,this.low=new il({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new il({context:this.context,frequency:0,type:"highpass"}),this.mid=new il({context:this.context,frequency:0,type:"lowpass"}),this.high=new il({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high],this.lowFrequency=new xi({context:this.context,units:"frequency",value:e.lowFrequency}),this.highFrequency=new xi({context:this.context,units:"frequency",value:e.highFrequency}),this.Q=new xi({context:this.context,units:"positive",value:e.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),pi(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(Hn.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),TR(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class T8 extends Hn{constructor(){const e=jn(T8.getDefaults(),arguments,["threshold","ratio"]);super(e),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new $r({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:e.threshold}),this.attack=new $r({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:e.attack}),this.release=new $r({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:e.release}),this.knee=new $r({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:e.knee}),this.ratio=new $r({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:e.ratio}),pi(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(Hn.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class Lw extends Hn{constructor(){const e=jn(Lw.getDefaults(),arguments,["low","mid","high"]);super(e),this.name="EQ3",this.output=new Pr({context:this.context}),this._internalChannels=[],this.input=this._multibandSplit=new x8({context:this.context,highFrequency:e.highFrequency,lowFrequency:e.lowFrequency}),this._lowGain=new Pr({context:this.context,gain:e.low,units:"decibels"}),this._midGain=new Pr({context:this.context,gain:e.mid,units:"decibels"}),this._highGain=new Pr({context:this.context,gain:e.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),pi(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(Hn.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),TR(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}_o().transport;function b4(){return _o().transport}_o().destination;_o().destination;function nFe(){return _o().destination}_o().listener;_o().draw;_o();function ene(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function tne(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var nne=[0,2,4,-1,1,3,5],rne=nne.map(n=>Math.floor(n*7/12));function ine(n){const{step:e,alt:t,oct:r,dir:i=1}=n,s=nne[e]+7*t;if(r===void 0)return[i*s];const o=r-rne[e]-4*t;return[i*s,i*o]}var rFe=[3,0,4,1,5,2,6];function iFe(n){const[e,t,r]=n,i=rFe[sFe(e)],s=Math.floor((e+1)/7);if(t===void 0)return{step:i,alt:s,dir:r};const o=t+4*s+rne[i];return{step:i,alt:s,oct:o,dir:r}}function sFe(n){const e=(n+1)%7;return e<0?7+e:e}var iV=(n,e)=>Array(Math.abs(e)+1).join(n),S4=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),oFe="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",aFe="(AA|A|P|M|m|d|dd)([-+]?\\d+)",cFe=new RegExp("^"+oFe+"|"+aFe+"$");function lFe(n){const e=cFe.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var sV={};function Sk(n){return typeof n=="string"?sV[n]||(sV[n]=uFe(n)):tne(n)?Sk(fFe(n)):ene(n)?Sk(n.name):S4}var oV=[0,2,4,5,7,9,11],sne="PMMPPMM";function uFe(n){const e=lFe(n);if(e[0]==="")return S4;const t=+e[0],r=e[1],i=(Math.abs(t)-1)%7,s=sne[i];if(s==="M"&&r==="P")return S4;const o=s==="M"?"majorable":"perfectable",a=""+t+r,c=t<0?-1:1,l=t===8||t===-8?t:c*(i+1),u=hFe(o,r),h=Math.floor((Math.abs(t)-1)/7),f=c*(oV[i]+u+12*h),d=(c*(oV[i]+u)%12+12)%12,p=ine({step:i,alt:u,oct:h,dir:c});return{empty:!1,name:a,num:t,q:r,step:i,alt:u,dir:c,type:o,simple:l,semitones:f,chroma:d,coord:p,oct:h}}function hFe(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function fFe(n){const{step:e,alt:t,oct:r=0,dir:i}=n;if(!i)return"";const s=e+1+7*r,o=s===0?e+1:s,a=i<0?"-":"",c=sne[e]==="M"?"majorable":"perfectable";return a+o+dFe(c,t)}function dFe(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?iV("A",e):iV("d",n==="perfectable"?e:e+1)}var aV=(n,e)=>Array(Math.abs(e)+1).join(n),one=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),cV=new Map,pFe=n=>"CDEFGAB".charAt(n),mFe=n=>n<0?aV("b",-n):aV("#",n),gFe=n=>n[0]==="b"?-n.length:n.length;function kA(n){const e=JSON.stringify(n),t=cV.get(e);if(t)return t;const r=typeof n=="string"?SFe(n):tne(n)?kA(EFe(n)):ene(n)?kA(n.name):one;return cV.set(e,r),r}var _Fe=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function vFe(n){const e=_Fe.exec(n);return e?[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]:["","","",""]}function yFe(n){return kA(iFe(n))}var bFe=(n,e)=>(n%e+e)%e,gP=[0,2,4,5,7,9,11];function SFe(n){const e=vFe(n);if(e[0]===""||e[3]!=="")return one;const t=e[0],r=e[1],i=e[2],s=(t.charCodeAt(0)+3)%7,o=gFe(r),a=i.length?+i:void 0,c=ine({step:s,alt:o,oct:a}),l=t+r+i,u=t+r,h=(gP[s]+o+120)%12,f=a===void 0?bFe(gP[s]+o,12)-1188:gP[s]+o+12*(a+1),d=f>=0&&f<=127?f:null,p=a===void 0?null:Math.pow(2,(f-69)/12)*440;return{empty:!1,acc:r,alt:o,chroma:h,coord:c,freq:p,height:f,letter:t,midi:d,name:l,oct:a,pc:u,step:s}}function EFe(n){const{step:e,alt:t,oct:r}=n,i=pFe(e);if(!i)return"";const s=i+mFe(t);return r||r===0?s+r:s}function ane(n,e){const t=kA(n),r=Array.isArray(e)?e:Sk(e).coord;if(t.empty||!r||r.length<2)return"";const i=t.coord,s=i.length===1?[i[0]+r[0]]:[i[0]+r[0],i[1]+r[1]];return yFe(s).name}function cne(n,e){const t=e.length,r=(n%t+t)%t;return e.slice(r,t).concat(e.slice(0,r))}var Tb={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},lne=n=>Number(n).toString(2).padStart(12,"0"),lV=n=>parseInt(n,2),xFe=/^[01]{12}$/;function une(n){return xFe.test(n)}var TFe=n=>typeof n=="number"&&n>=0&&n<=4095,wFe=n=>n&&une(n.chroma),uV={[Tb.chroma]:Tb};function hne(n){const e=une(n)?n:TFe(n)?lne(n):Array.isArray(n)?kFe(n):wFe(n)?n.chroma:Tb.chroma;return uV[e]=uV[e]||MFe(e)}var AFe=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function RFe(n){const e=[];for(let t=0;t<12;t++)n.charAt(t)==="1"&&e.push(AFe[t]);return e}function CFe(n){const e=n.split("");return e.map((t,r)=>cne(r,e).join(""))}function MFe(n){const e=lV(n),t=CFe(n).map(lV).filter(s=>s>=2048).sort()[0],r=lne(t),i=RFe(n);return{empty:!1,name:"",setNum:e,chroma:n,normalized:r,intervals:i}}function kFe(n){if(n.length===0)return Tb.chroma;let e;const t=[0,0,0,0,0,0,0,0,0,0,0,0];for(let r=0;r<n.length;r++)e=kA(n[r]),e.empty&&(e=Sk(n[r])),e.empty||(t[e.chroma]=1);return t.join("")}var OFe=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7  ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 #4 #11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -7 m -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim  o"],["1P 3m 5d 7d","diminished seventh","dim7 7 o7"],["1P 3m 5d 7m","half-diminished","m7b5  -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],IFe=OFe;({...Tb});var fne=[],WC={};function NFe(n,e,t){const r=DFe(n),i={...hne(n),name:t||"",quality:r,intervals:n,aliases:e};fne.push(i),i.name&&(WC[i.name]=i),WC[i.setNum]=i,WC[i.chroma]=i,i.aliases.forEach(s=>PFe(i,s))}function PFe(n,e){WC[e]=n}function DFe(n){const e=t=>n.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}IFe.forEach(([n,e,t])=>NFe(n.split(" "),t.split(" "),e));fne.sort((n,e)=>n.setNum-e.setNum);var LFe=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],UFe=LFe,BFe={...Tb,intervals:[],aliases:[]},Uw={};function FFe(n){return Uw[n]||BFe}function jFe(n,e,t=[]){const r={...hne(n),name:e,intervals:n,aliases:t};return Uw[r.name]=r,Uw[r.setNum]=r,Uw[r.chroma]=r,r.aliases.forEach(i=>zFe(r,i)),r}function zFe(n,e){Uw[e]=n}UFe.forEach(([n,e,...t])=>jFe(n.split(" "),e,t));var HFe=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],VFe=HFe;VFe.forEach(([n,e,t])=>void 0);var GFe=ane;function $Fe(n,e){return GFe(n,[0,e])}var w8=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],hV={...Tb,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},WFe=w8.map(qFe),E4={};WFe.forEach(n=>{E4[n.name]=n,n.aliases.forEach(e=>{E4[e]=n})});function dne(n){return typeof n=="string"?E4[n.toLowerCase()]||hV:n&&n.name?dne(n.name):hV}function qFe(n){const[e,t,r,i,s,o,a]=n,c=a?[a]:[],l=Number(t).toString(2);return{empty:!1,intervals:FFe(i).intervals,modeNum:e,chroma:l,normalized:l,name:i,setNum:t,alt:r,triad:s,seventh:o,aliases:c}}function pne(n){return(e,t)=>{const r=dne(e);if(r.empty)return[];const i=cne(r.modeNum,n),s=r.intervals.map(o=>ane(t,o));return i.map((o,a)=>s[a]+o)}}pne(w8.map(n=>n[4]));pne(w8.map(n=>n[5]));function YFe(n,e){const t=new Lw(-6,6,10).connect(n),r=new il(8e3,"highpass",-12);r.connect(t);const i=new wv;i.set({envelope:{attack:.001,decay:.05,sustain:.001,release:.05}}),i.connect(r);function s(be,Pe){i.triggerAttackRelease(be,Pe)}const o=new Lw(-6,3,8).connect(n),a=new il(6e3,"highpass",-12);a.connect(o);const c=new wv;c.set({envelope:{attack:.001,decay:.2,sustain:.1,release:.3}}),c.connect(a);function l(be,Pe){c.triggerAttackRelease(be,Pe)}function u(be){s("16n",be)}function h(be){l("8n",be)}const f=new il(350,"bandpass").connect(n),d=new Pr().connect(f);d.gain.value=0;const p=new p8().connect(d);p.volume.value=16,p.maxPolyphony=8,p.set({envelope:{attack:.001,decay:.01,sustain:.1,release:.1},oscillator:{type:"square"}});function _(be,Pe){const $e=tl("64n").toSeconds()+tl(be).toSeconds();d.gain.setValueAtTime(.5,Pe),d.gain.exponentialRampToValueAtTime(.01,$e+Pe),p.triggerAttackRelease([800,540],be,Pe)}const g=new Lw(-10,10,-1).connect(n);g.connect(e);const m=new il(800,"highpass",-12);m.connect(g);const b=new wv;b.set({envelope:{attack:.01,decay:.1,sustain:.1,release:.1}}),b.connect(m);function y(be,Pe){b.triggerAttackRelease(be,Pe)}const x=new MA().connect(n);x.set({distortion:.666});const T=new sc;T.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),T.connect(x);const k=new il;k.set({type:"highpass",frequency:1e4}),k.connect(x);const R=new wv;R.set({envelope:{attack:.01,decay:.1,sustain:0,release:.1}}),R.connect(k);function P(be,Pe){const $e=tl("512n").toSeconds(),tt=tl("32n").toSeconds();T.triggerAttackRelease(1e4,be,Pe,1),T.frequency.exponentialRampToValueAtTime(300,Pe+$e),T.frequency.exponentialRampToValueAtTime(100,Pe+tt),R.triggerAttackRelease("8n",Pe,.333),R.volume.setValueAtTime(1,Pe),R.volume.exponentialRampToValueAtTime(0,Pe+tl("32n").toSeconds())}const B=new il;B.set({type:"bandpass",frequency:256,Q:.17}),B.connect(n);const U=new sc;U.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),U.connect(B);const z=new sc;z.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),z.connect(B);function I(be,Pe){U.triggerAttackRelease(2e3,be,Pe),U.frequency.exponentialRampToValueAtTime(1e3,Pe+tl("32n").toSeconds()),z.triggerAttackRelease(999,be,Pe),z.frequency.exponentialRampToValueAtTime(888,Pe+tl("256n").toSeconds())}const L=new MA().connect(n);L.set({distortion:.876});const M=new sc;M.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),M.connect(L);const F=new il;F.set({type:"highpass",frequency:1e4}),F.connect(L);const Z=new wv;Z.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}}),Z.connect(F);function $(be,Pe){const $e=tl("512n").toSeconds(),tt=tl("32n").toSeconds();M.triggerAttackRelease(1e4,be,Pe,1),M.frequency.exponentialRampToValueAtTime(150,Pe+$e),M.frequency.exponentialRampToValueAtTime(100,Pe+tt),Z.triggerAttackRelease("8n",Pe,.25),Z.volume.setValueAtTime(1,Pe),Z.volume.exponentialRampToValueAtTime(0,Pe+tl("32n").toSeconds())}const Y=new sc().connect(n);Y.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"sawtooth"}});const Q=new sc().connect(n);Y.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"triangle"}});const q=new wv().connect(n);q.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}});function V(be,Pe){const $e=tl("256n").toSeconds(),tt=tl(be).toSeconds()-$e;Y.triggerAttackRelease("C4",tt,Pe,1),Y.frequency.exponentialRampToValueAtTime(XH("C0").toFrequency(),Pe+tt),Q.triggerAttackRelease("C5",tt,Pe,.5),Q.frequency.exponentialRampToValueAtTime(XH("C0").toFrequency(),Pe+tt);const qe=tl("4n").toSeconds();q.triggerAttackRelease("8n",Pe),q.volume.setValueAtTime(1,Pe),q.volume.exponentialRampToValueAtTime(0,Pe+qe)}const K=new il;K.set({type:"bandpass",frequency:256,Q:.17}),K.connect(n);const ne=new sc;ne.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),ne.connect(K);const ie=new sc;ie.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),ie.connect(K);function ae(be,Pe){ne.triggerAttackRelease(2e3,be,Pe),ne.frequency.exponentialRampToValueAtTime(100,Pe+tl("32n").toSeconds()),ie.triggerAttackRelease(699,be,Pe),ie.frequency.exponentialRampToValueAtTime(399,Pe+tl("256n").toSeconds())}const Te=new rT().connect(n);Te.set({octaves:8,volume:8,pitchDecay:.125}),Te.connect(e);function Ie(be){Te.triggerAttackRelease("C1","8n",be)}return{ticktrigger:u,tweettrigger:h,cowbelltrigger:_,claptrigger:y,hisnaretrigger:P,hiwoodblocktrigger:I,lowsnaretrigger:$,lowtomtrigger:V,lowwoodblocktrigger:ae,basstrigger:Ie}}const KFe="data:text/javascript;base64,Ly8gQSBkb3duc2FtcGxpbmcvZGVncmFkaW5nIHByb2Nlc3NpbmcgZWZmZWN0Ci8vIFNhbXBsZSBhbmQgaG9sZHMgdGhlIHNpZ25hbCBiYXNlZCBvbiBhbiBpbmNyZW1lbnRpbmcgY291bnRlcgovLyB3cml0dGVuIGJ5IFRpbW8gSG9vZ2xhbmQsIChjKSAyMDIzLCB3d3cudGltb2hvb2dsYW5kLmNvbQovLwoKY2xhc3MgU3ludGhGQ3J1c2hXb3JrbGV0UHJvY2Vzc29yIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29yIHsKICBzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCkgewogICAgcmV0dXJuIFsKICAgICAgewogICAgICAgIG5hbWU6ICdyYXRlJywKICAgICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgICAgbWluVmFsdWU6IDEsCiAgICAgICAgbWF4VmFsdWU6IDUxMiwKICAgICAgfSwKICAgIF0KICB9CgogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIoKQogICAgLy8gdGhlIGZyYW1lIGNvdW50ZXIKICAgIHRoaXMuY291bnQgPSAwCiAgICAvLyBzYW1wbGUgYW5kIGhvbGQgdmFyaWFibGUgYXJyYXkKICAgIHRoaXMuc2FoID0gW10KICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXQogICAgY29uc3Qgb3V0cHV0ID0gb3V0cHV0c1swXQoKICAgIC8vIGNoZWNrIGZvciBkYXRhCiAgICBpZiAoIWlucHV0WzBdIHx8ICFpbnB1dFsxXSB8fCAhb3V0cHV0WzBdIHx8ICFvdXRwdXRbMV0pIHsKICAgICAgcmV0dXJuIHRydWUKICAgIH0KCiAgICAvLyBmb3IgdGhlIGxlbmd0aCBvZiB0aGUgc2FtcGxlIGFycmF5IChnZW5lcmFsbHkgMTI4KQogICAgY29uc3QgcmF0ZSA9IHBhcmFtZXRlcnMucmF0ZVswXQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dFswXS5sZW5ndGg7IGkrKykgewogICAgICAvLyBmb3IgZXZlcnkgY2hhbm5lbAogICAgICBmb3IgKGxldCBjaGFubmVsID0gMDsgY2hhbm5lbCA8IGlucHV0Lmxlbmd0aDsgKytjaGFubmVsKSB7CiAgICAgICAgLy8gaWYgY291bnRlciBlcXVhbHMgMCwgc2FtcGxlIGFuZCBob2xkCiAgICAgICAgaWYgKHRoaXMuY291bnQgJSByYXRlID09PSAwKSB7CiAgICAgICAgICB0aGlzLnNhaFtjaGFubmVsXSA9IGlucHV0W2NoYW5uZWxdW2ldCiAgICAgICAgfQogICAgICAgIC8vIG91dHB1dCB0aGUgY3VycmVudGx5IGhlbGQgc2FtcGxlCiAgICAgICAgb3V0cHV0W2NoYW5uZWxdW2ldID0gdGhpcy5zYWhbY2hhbm5lbF0KICAgICAgfQogICAgICAvLyBpbmNyZW1lbnQgc2FtcGxlIGNvdW50ZXIKICAgICAgdGhpcy5jb3VudCsrCiAgICB9CiAgICByZXR1cm4gdHJ1ZQogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ2ZjcnVzaHByb2Nlc3NvcicsIFN5bnRoRkNydXNoV29ya2xldFByb2Nlc3NvcikK";class A8 extends fu{name="FrequencyCrusher";rate;_audioworkletnode=this.context.createAudioWorkletNode("fcrushprocessor");constructor(){const e=jn(A8.getDefaults(),arguments,["rate"]);super(e),this.rate=new $r({context:this.context,param:this._audioworkletnode.parameters.get("rate"),value:e.rate,minValue:1,maxValue:512}),this.connectEffect(this._audioworkletnode)}static getDefaults(){return Object.assign(fu.getDefaults(),{rate:64})}dispose(){return super.dispose(),this._audioworkletnode.disconnect(),this}}function XFe(){return _o().rawContext.audioWorklet.addModule(KFe)}function ga(n){return 20*Math.log10(n)-35}function ZFe(){const n=new S8,e=Us(n.get()),t=new b8,r=Us(t.get()),i=new m8,s=Us(i.get()),o=new MA,a=Us(o.get()),c=new l3,l=Us(c.get()),u=new A8,h=Us(u.get()),f=new v8,d=Us(f.get());function p(){n.set({...e,wet:1}),t.set({...r,wet:1,delayTime:"8n",maxDelay:"8n",feedback:.666}),i.set({...s,wet:1,depth:.5,frequency:3,octaves:5}),o.set({...a,wet:1,oversample:"4x"}),c.set({...l,wet:1,depth:0,maxDelay:.5}),u.set({...h,wet:1,rate:32}),f.set({...d,wet:1})}function _(){return{fc:Us(u.get()),echo:Us(t.get()),reverb:Us(n.get()),autofilter:Us(i.get()),vibrato:Us(c.get()),distortion:Us(o.get())}}function g(b){u.set(b.fc),t.set(b.echo),n.set(b.reverb),i.set(b.autofilter),c.set(b.vibrato),o.set(b.distortion)}function m(){u.dispose(),t.dispose(),n.dispose(),i.dispose(),c.dispose(),o.dispose()}return p(),{fc:u,echo:t,reverb:n,autofilter:i,vibrato:c,distortion:o,applyreset:p,getreplay:_,setreplay:g,autowah:f,fcrush:u,distort:o,destroy:m}}function W2(n){const e=_o().isOffline?"offline":"",t=new wh(ga(0)),r=new wh(ga(0)),i=new wh(ga(0)),s=new wh(ga(0)),o=new wh(ga(0)),a=new wh(ga(0)),c=new wh(ga(0));t.receive(`${e}fc${n}`),r.receive(`${e}echo${n}`),i.receive(`${e}reverb${n}`),s.receive(`${e}autofilter${n}`),o.receive(`${e}vibrato${n}`),a.receive(`${e}distortion${n}`),c.receive(`${e}autowah${n}`);const l=new wh;l.send(`${e}fc${n}`),l.send(`${e}echo${n}`),l.send(`${e}reverb${n}`),l.send(`${e}autofilter${n}`),l.send(`${e}vibrato${n}`),l.send(`${e}distortion${n}`),l.send(`${e}autowah${n}`);function u(){return{fc:t.volume.value,echo:r.volume.value,reverb:i.volume.value,autofilter:s.volume.value,vibrato:o.volume.value,distortion:a.volume.value,autowah:c.volume.value}}function h(p){t.volume.value=p.fc,r.volume.value=p.echo,i.volume.value=p.reverb,s.volume.value=p.autofilter,o.volume.value=p.vibrato,a.volume.value=p.distortion,c.volume.value=p.autowah}function f(){t.volume.value=ga(0),r.volume.value=ga(0),i.volume.value=ga(0),s.volume.value=ga(0),o.volume.value=ga(0),a.volume.value=ga(0),c.volume.value=ga(0)}function d(){t.dispose(),r.dispose(),i.dispose(),s.dispose(),o.dispose(),a.dispose(),c.dispose(),l.dispose()}return{sendtofx:l,fc:t,echo:r,reverb:i,autofilter:s,vibrato:o,distortion:a,autowah:c,fcrush:t,distort:a,getreplay:u,setreplay:h,applyreset:f,destroy:d}}function JFe(n){return new Int8Array(n)}function QFe(n){return new Int16Array(n)}function mne(n){return new Int32Array(n)}function gne(n){return new Float32Array(n)}function e7e(n){return new Float64Array(n)}function _ne(n){if(n.length==1)return gne(n[0]);var e=n[0];n=n.slice(1);for(var t=[],r=0;r<e;r++)t.push(_ne(n));return t}function vne(n){if(n.length==1)return mne(n[0]);var e=n[0];n=n.slice(1);for(var t=[],r=0;r<e;r++)t.push(vne(n));return t}function yne(n){if(n.length==1)return QFe(n[0]);var e=n[0];n=n.slice(1);for(var t=[],r=0;r<e;r++)t.push(yne(n));return t}function bne(n){if(n.length==1)return new Array(n[0]);var e=n[0];n=n.slice(1);for(var t=[],r=0;r<e;r++)t.push(bne(n));return t}var Sne={};Sne.fill=function(n,e,t,r){if(arguments.length==2)for(var i=0;i<n.length;i++)n[i]=arguments[1];else for(var i=e;i<t;i++)n[i]=r};var NR={};NR.arraycopy=function(n,e,t,r,i){for(var s=e+i;e<s;)t[r++]=n[e++]};NR.out={};NR.out.println=function(n){console.log(n)};NR.out.printf=function(){console.log.apply(console,arguments)};var u3={};u3.SQRT2=1.4142135623730951;u3.FAST_LOG10=function(n){return Math.log10(n)};u3.FAST_LOG10_X=function(n,e){return Math.log10(n)*e};function o_(n){this.ordinal=n}o_.short_block_allowed=new o_(0);o_.short_block_coupled=new o_(1);o_.short_block_dispensed=new o_(2);o_.short_block_forced=new o_(3);var Ene={};Ene.MAX_VALUE=34028235e31;function Nf(n){this.ordinal=n}Nf.vbr_off=new Nf(0);Nf.vbr_mt=new Nf(1);Nf.vbr_rh=new Nf(2);Nf.vbr_abr=new Nf(3);Nf.vbr_mtrh=new Nf(4);Nf.vbr_default=Nf.vbr_mtrh;var t7e=function(n){},Lo={System:NR,VbrMode:Nf,Float:Ene,ShortBlock:o_,Util:u3,Arrays:Sne,new_array_n:bne,new_byte:JFe,new_double:e7e,new_float:gne,new_float_n:_ne,new_int:mne,new_int_n:vne,new_short_n:yne,assert:t7e},_P,fV;function n7e(){if(fV)return _P;fV=1;var n=Lo,e=n.System,t=n.Util,r=n.Arrays,i=n.new_float,s=gu();function o(){var a=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*t.SQRT2*.5/2384e-9,.017876148*t.SQRT2*.5/2384e-9,.003134727*t.SQRT2*.5/2384e-9,.002457142*t.SQRT2*.5/2384e-9,971317e-9*t.SQRT2*.5/2384e-9,218868e-9*t.SQRT2*.5/2384e-9,101566e-9*t.SQRT2*.5/2384e-9,13828e-9*t.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],c=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],l=c[s.SHORT_TYPE],u=c[s.SHORT_TYPE],h=c[s.SHORT_TYPE],f=c[s.SHORT_TYPE],d=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function p(m,b,y){for(var x=10,T=b+238-14-286,k=-15;k<0;k++){var R,P,B;R=a[x+-10],P=m[T+-224]*R,B=m[b+224]*R,R=a[x+-9],P+=m[T+-160]*R,B+=m[b+160]*R,R=a[x+-8],P+=m[T+-96]*R,B+=m[b+96]*R,R=a[x+-7],P+=m[T+-32]*R,B+=m[b+32]*R,R=a[x+-6],P+=m[T+32]*R,B+=m[b+-32]*R,R=a[x+-5],P+=m[T+96]*R,B+=m[b+-96]*R,R=a[x+-4],P+=m[T+160]*R,B+=m[b+-160]*R,R=a[x+-3],P+=m[T+224]*R,B+=m[b+-224]*R,R=a[x+-2],P+=m[b+-256]*R,B-=m[T+256]*R,R=a[x+-1],P+=m[b+-192]*R,B-=m[T+192]*R,R=a[x+0],P+=m[b+-128]*R,B-=m[T+128]*R,R=a[x+1],P+=m[b+-64]*R,B-=m[T+64]*R,R=a[x+2],P+=m[b+0]*R,B-=m[T+0]*R,R=a[x+3],P+=m[b+64]*R,B-=m[T+-64]*R,R=a[x+4],P+=m[b+128]*R,B-=m[T+-128]*R,R=a[x+5],P+=m[b+192]*R,B-=m[T+-192]*R,P*=a[x+6],R=B-P,y[30+k*2]=B+P,y[31+k*2]=a[x+7]*R,x+=18,b--,T++}{var P,B,U,z;B=m[b+-16]*a[x+-10],P=m[b+-32]*a[x+-2],B+=(m[b+-48]-m[b+16])*a[x+-9],P+=m[b+-96]*a[x+-1],B+=(m[b+-80]+m[b+48])*a[x+-8],P+=m[b+-160]*a[x+0],B+=(m[b+-112]-m[b+80])*a[x+-7],P+=m[b+-224]*a[x+1],B+=(m[b+-144]+m[b+112])*a[x+-6],P-=m[b+32]*a[x+2],B+=(m[b+-176]-m[b+144])*a[x+-5],P-=m[b+96]*a[x+3],B+=(m[b+-208]+m[b+176])*a[x+-4],P-=m[b+160]*a[x+4],B+=(m[b+-240]-m[b+208])*a[x+-3],P-=m[b+224],U=P-B,z=P+B,B=y[14],P=y[15]-B,y[31]=z+B,y[30]=U+P,y[15]=U-P,y[14]=z-B}{var I;I=y[28]-y[0],y[0]+=y[28],y[28]=I*a[x+-36+7],I=y[29]-y[1],y[1]+=y[29],y[29]=I*a[x+-36+7],I=y[26]-y[2],y[2]+=y[26],y[26]=I*a[x+-72+7],I=y[27]-y[3],y[3]+=y[27],y[27]=I*a[x+-72+7],I=y[24]-y[4],y[4]+=y[24],y[24]=I*a[x+-108+7],I=y[25]-y[5],y[5]+=y[25],y[25]=I*a[x+-108+7],I=y[22]-y[6],y[6]+=y[22],y[22]=I*t.SQRT2,I=y[23]-y[7],y[7]+=y[23],y[23]=I*t.SQRT2-y[7],y[7]-=y[6],y[22]-=y[7],y[23]-=y[22],I=y[6],y[6]=y[31]-I,y[31]=y[31]+I,I=y[7],y[7]=y[30]-I,y[30]=y[30]+I,I=y[22],y[22]=y[15]-I,y[15]=y[15]+I,I=y[23],y[23]=y[14]-I,y[14]=y[14]+I,I=y[20]-y[8],y[8]+=y[20],y[20]=I*a[x+-180+7],I=y[21]-y[9],y[9]+=y[21],y[21]=I*a[x+-180+7],I=y[18]-y[10],y[10]+=y[18],y[18]=I*a[x+-216+7],I=y[19]-y[11],y[11]+=y[19],y[19]=I*a[x+-216+7],I=y[16]-y[12],y[12]+=y[16],y[16]=I*a[x+-252+7],I=y[17]-y[13],y[13]+=y[17],y[17]=I*a[x+-252+7],I=-y[20]+y[24],y[20]+=y[24],y[24]=I*a[x+-216+7],I=-y[21]+y[25],y[21]+=y[25],y[25]=I*a[x+-216+7],I=y[4]-y[8],y[4]+=y[8],y[8]=I*a[x+-216+7],I=y[5]-y[9],y[5]+=y[9],y[9]=I*a[x+-216+7],I=y[0]-y[12],y[0]+=y[12],y[12]=I*a[x+-72+7],I=y[1]-y[13],y[1]+=y[13],y[13]=I*a[x+-72+7],I=y[16]-y[28],y[16]+=y[28],y[28]=I*a[x+-72+7],I=-y[17]+y[29],y[17]+=y[29],y[29]=I*a[x+-72+7],I=t.SQRT2*(y[2]-y[10]),y[2]+=y[10],y[10]=I,I=t.SQRT2*(y[3]-y[11]),y[3]+=y[11],y[11]=I,I=t.SQRT2*(-y[18]+y[26]),y[18]+=y[26],y[26]=I-y[18],I=t.SQRT2*(-y[19]+y[27]),y[19]+=y[27],y[27]=I-y[19],I=y[2],y[19]-=y[3],y[3]-=I,y[2]=y[31]-I,y[31]+=I,I=y[3],y[11]-=y[19],y[18]-=I,y[3]=y[30]-I,y[30]+=I,I=y[18],y[27]-=y[11],y[19]-=I,y[18]=y[15]-I,y[15]+=I,I=y[19],y[10]-=I,y[19]=y[14]-I,y[14]+=I,I=y[10],y[11]-=I,y[10]=y[23]-I,y[23]+=I,I=y[11],y[26]-=I,y[11]=y[22]-I,y[22]+=I,I=y[26],y[27]-=I,y[26]=y[7]-I,y[7]+=I,I=y[27],y[27]=y[6]-I,y[6]+=I,I=t.SQRT2*(y[0]-y[4]),y[0]+=y[4],y[4]=I,I=t.SQRT2*(y[1]-y[5]),y[1]+=y[5],y[5]=I,I=t.SQRT2*(y[16]-y[20]),y[16]+=y[20],y[20]=I,I=t.SQRT2*(y[17]-y[21]),y[17]+=y[21],y[21]=I,I=-t.SQRT2*(y[8]-y[12]),y[8]+=y[12],y[12]=I-y[8],I=-t.SQRT2*(y[9]-y[13]),y[9]+=y[13],y[13]=I-y[9],I=-t.SQRT2*(y[25]-y[29]),y[25]+=y[29],y[29]=I-y[25],I=-t.SQRT2*(y[24]+y[28]),y[24]-=y[28],y[28]=I-y[24],I=y[24]-y[16],y[24]=I,I=y[20]-I,y[20]=I,I=y[28]-I,y[28]=I,I=y[25]-y[17],y[25]=I,I=y[21]-I,y[21]=I,I=y[29]-I,y[29]=I,I=y[17]-y[1],y[17]=I,I=y[9]-I,y[9]=I,I=y[25]-I,y[25]=I,I=y[5]-I,y[5]=I,I=y[21]-I,y[21]=I,I=y[13]-I,y[13]=I,I=y[29]-I,y[29]=I,I=y[1]-y[0],y[1]=I,I=y[16]-I,y[16]=I,I=y[17]-I,y[17]=I,I=y[8]-I,y[8]=I,I=y[9]-I,y[9]=I,I=y[24]-I,y[24]=I,I=y[25]-I,y[25]=I,I=y[4]-I,y[4]=I,I=y[5]-I,y[5]=I,I=y[20]-I,y[20]=I,I=y[21]-I,y[21]=I,I=y[12]-I,y[12]=I,I=y[13]-I,y[13]=I,I=y[28]-I,y[28]=I,I=y[29]-I,y[29]=I,I=y[0],y[0]+=y[31],y[31]-=I,I=y[1],y[1]+=y[30],y[30]-=I,I=y[16],y[16]+=y[15],y[15]-=I,I=y[17],y[17]+=y[14],y[14]-=I,I=y[8],y[8]+=y[23],y[23]-=I,I=y[9],y[9]+=y[22],y[22]-=I,I=y[24],y[24]+=y[7],y[7]-=I,I=y[25],y[25]+=y[6],y[6]-=I,I=y[4],y[4]+=y[27],y[27]-=I,I=y[5],y[5]+=y[26],y[26]-=I,I=y[20],y[20]+=y[11],y[11]-=I,I=y[21],y[21]+=y[10],y[10]-=I,I=y[12],y[12]+=y[19],y[19]-=I,I=y[13],y[13]+=y[18],y[18]-=I,I=y[28],y[28]+=y[3],y[3]-=I,I=y[29],y[29]+=y[2],y[2]-=I}}function _(m,b){for(var y=0;y<3;y++){var x,T,k,R,P,B;R=m[b+6]*c[s.SHORT_TYPE][0]-m[b+15],x=m[b+0]*c[s.SHORT_TYPE][2]-m[b+9],T=R+x,k=R-x,R=m[b+15]*c[s.SHORT_TYPE][0]+m[b+6],x=m[b+9]*c[s.SHORT_TYPE][2]+m[b+0],P=R+x,B=-R+x,x=(m[b+3]*c[s.SHORT_TYPE][1]-m[b+12])*2069978111953089e-26,R=(m[b+12]*c[s.SHORT_TYPE][1]+m[b+3])*2069978111953089e-26,m[b+0]=T*190752519173728e-25+x,m[b+15]=-P*190752519173728e-25+R,k=k*.8660254037844387*1907525191737281e-26,P=P*.5*1907525191737281e-26+R,m[b+3]=k-P,m[b+6]=k+P,T=T*.5*1907525191737281e-26-x,B=B*.8660254037844387*1907525191737281e-26,m[b+9]=T+B,m[b+12]=T-B,b++}}function g(m,b,y){var x,T;{var k,R,P,B,U,z,I,L;k=y[17]-y[9],P=y[15]-y[11],B=y[14]-y[12],U=y[0]+y[8],z=y[1]+y[7],I=y[2]+y[6],L=y[3]+y[5],m[b+17]=U+I-L-(z-y[4]),T=(U+I-L)*u[19]+(z-y[4]),x=(k-P-B)*u[18],m[b+5]=x+T,m[b+6]=x-T,R=(y[16]-y[10])*u[18],z=z*u[19]+y[4],x=k*u[12]+R+P*u[13]+B*u[14],T=-U*u[16]+z-I*u[17]+L*u[15],m[b+1]=x+T,m[b+2]=x-T,x=k*u[13]-R-P*u[14]+B*u[12],T=-U*u[17]+z-I*u[15]+L*u[16],m[b+9]=x+T,m[b+10]=x-T,x=k*u[14]-R+P*u[12]-B*u[13],T=U*u[15]-z+I*u[16]-L*u[17],m[b+13]=x+T,m[b+14]=x-T}{var M,F,Z,$,Y,Q,q,V;M=y[8]-y[0],Z=y[6]-y[2],$=y[5]-y[3],Y=y[17]+y[9],Q=y[16]+y[10],q=y[15]+y[11],V=y[14]+y[12],m[b+0]=Y+q+V+(Q+y[13]),x=(Y+q+V)*u[19]-(Q+y[13]),T=(M-Z+$)*u[18],m[b+11]=x+T,m[b+12]=x-T,F=(y[7]-y[1])*u[18],Q=y[13]-Q*u[19],x=Y*u[15]-Q+q*u[16]+V*u[17],T=M*u[14]+F+Z*u[12]+$*u[13],m[b+3]=x+T,m[b+4]=x-T,x=-Y*u[17]+Q-q*u[15]-V*u[16],T=M*u[13]+F-Z*u[14]-$*u[12],m[b+7]=x+T,m[b+8]=x-T,x=-Y*u[16]+Q-q*u[17]-V*u[15],T=M*u[12]-F+Z*u[13]-$*u[14],m[b+15]=x+T,m[b+16]=x-T}}this.mdct_sub48=function(m,b,y){for(var x=b,T=286,k=0;k<m.channels_out;k++){for(var R=0;R<m.mode_gr;R++){for(var P,B=m.l3_side.tt[R][k],U=B.xr,z=0,I=m.sb_sample[k][1-R],L=0,M=0;M<18/2;M++)for(p(x,T,I[L]),p(x,T+32,I[L+1]),L+=2,T+=64,P=1;P<32;P+=2)I[L-1][P]*=-1;for(P=0;P<32;P++,z+=18){var F=B.block_type,Z=m.sb_sample[k][R],$=m.sb_sample[k][1-R];if(B.mixed_block_flag!=0&&P<2&&(F=0),m.amp_filter[P]<1e-12)r.fill(U,z+0,z+18,0);else{if(m.amp_filter[P]<1)for(var M=0;M<18;M++)$[M][d[P]]*=m.amp_filter[P];if(F==s.SHORT_TYPE){for(var M=-12/4;M<0;M++){var Y=c[s.SHORT_TYPE][M+3];U[z+M*3+9]=Z[9+M][d[P]]*Y-Z[8-M][d[P]],U[z+M*3+18]=Z[14-M][d[P]]*Y+Z[15+M][d[P]],U[z+M*3+10]=Z[15+M][d[P]]*Y-Z[14-M][d[P]],U[z+M*3+19]=$[2-M][d[P]]*Y+$[3+M][d[P]],U[z+M*3+11]=$[3+M][d[P]]*Y-$[2-M][d[P]],U[z+M*3+20]=$[8-M][d[P]]*Y+$[9+M][d[P]]}_(U,z)}else{for(var Q=i(18),M=-36/4;M<0;M++){var q,V;q=c[F][M+27]*$[M+9][d[P]]+c[F][M+36]*$[8-M][d[P]],V=c[F][M+9]*Z[M+9][d[P]]-c[F][M+18]*Z[8-M][d[P]],Q[M+9]=q-V*l[3+M+9],Q[M+18]=q*l[3+M+9]+V}g(U,z,Q)}}if(F!=s.SHORT_TYPE&&P!=0)for(var M=7;M>=0;--M){var K,ne;K=U[z+M]*h[20+M]+U[z+-1-M]*f[28+M],ne=U[z+M]*f[28+M]-U[z+-1-M]*h[20+M],U[z+-1-M]=K,U[z+M]=ne}}}if(x=y,T=286,m.mode_gr==1)for(var ie=0;ie<18;ie++)e.arraycopy(m.sb_sample[k][1][ie],0,m.sb_sample[k][0][ie],0,32)}}}return _P=o,_P}var vP,dV;function xne(){if(dV)return vP;dV=1;var n=gu(),e=Lo,t=e.System,r=e.new_float,i=e.new_float_n;function s(){this.l=r(n.SBMAX_l),this.s=i([n.SBMAX_s,3]);var o=this;this.assign=function(a){t.arraycopy(a.l,0,o.l,0,n.SBMAX_l);for(var c=0;c<n.SBMAX_s;c++)for(var l=0;l<3;l++)o.s[c][l]=a.s[c][l]}}return vP=s,vP}var yP,pV;function r7e(){if(pV)return yP;pV=1;var n=xne();function e(){this.thm=new n,this.en=new n}return yP=e,yP}function Rp(n){var e=n;this.ordinal=function(){return e}}Rp.STEREO=new Rp(0);Rp.JOINT_STEREO=new Rp(1);Rp.DUAL_CHANNEL=new Rp(2);Rp.MONO=new Rp(3);Rp.NOT_SET=new Rp(4);var PR=Rp,bP,mV;function gu(){if(mV)return bP;mV=1;var n=Lo,e=n.System,t=n.VbrMode,r=n.new_array_n,i=n.new_float,s=n.new_float_n,o=n.new_int,a=n.assert;c.ENCDELAY=576,c.POSTDELAY=1152,c.MDCTDELAY=48,c.FFTOFFSET=224+c.MDCTDELAY,c.DECDELAY=528,c.SBLIMIT=32,c.CBANDS=64,c.SBPSY_l=21,c.SBPSY_s=12,c.SBMAX_l=22,c.SBMAX_s=13,c.PSFB21=6,c.PSFB12=6,c.BLKSIZE=1024,c.HBLKSIZE=c.BLKSIZE/2+1,c.BLKSIZE_s=256,c.HBLKSIZE_s=c.BLKSIZE_s/2+1,c.NORM_TYPE=0,c.START_TYPE=1,c.SHORT_TYPE=2,c.STOP_TYPE=3,c.MPG_MD_LR_LR=0,c.MPG_MD_LR_I=1,c.MPG_MD_MS_LR=2,c.MPG_MD_MS_I=3,c.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function c(){var l=n7e(),u=r7e(),h=PR,f=c.FFTOFFSET,d=c.MPG_MD_MS_LR,p=null;this.psy=null;var _=null,g=null,m=null;this.setModules=function(k,R,P,B){p=k,this.psy=R,_=R,g=B,m=P};var b=new l;function y(k){var R,P;if(k.ATH.useAdjust==0){k.ATH.adjust=1;return}if(P=k.loudness_sq[0][0],R=k.loudness_sq[1][0],k.channels_out==2?(P+=k.loudness_sq[0][1],R+=k.loudness_sq[1][1]):(P+=P,R+=R),k.mode_gr==2&&(P=Math.max(P,R)),P*=.5,P*=k.ATH.aaSensitivityP,P>.03125)k.ATH.adjust>=1?k.ATH.adjust=1:k.ATH.adjust<k.ATH.adjustLimit&&(k.ATH.adjust=k.ATH.adjustLimit),k.ATH.adjustLimit=1;else{var B=31.98*P+625e-6;k.ATH.adjust>=B?(k.ATH.adjust*=B*.075+.925,k.ATH.adjust<B&&(k.ATH.adjust=B)):k.ATH.adjustLimit>=B?k.ATH.adjust=B:k.ATH.adjust<k.ATH.adjustLimit&&(k.ATH.adjust=k.ATH.adjustLimit),k.ATH.adjustLimit=B}}function x(k){var R,P;for(a(0<=k.bitrate_index&&k.bitrate_index<16),a(0<=k.mode_ext&&k.mode_ext<4),k.bitrate_stereoMode_Hist[k.bitrate_index][4]++,k.bitrate_stereoMode_Hist[15][4]++,k.channels_out==2&&(k.bitrate_stereoMode_Hist[k.bitrate_index][k.mode_ext]++,k.bitrate_stereoMode_Hist[15][k.mode_ext]++),R=0;R<k.mode_gr;++R)for(P=0;P<k.channels_out;++P){var B=k.l3_side.tt[R][P].block_type|0;k.l3_side.tt[R][P].mixed_block_flag!=0&&(B=4),k.bitrate_blockType_Hist[k.bitrate_index][B]++,k.bitrate_blockType_Hist[k.bitrate_index][5]++,k.bitrate_blockType_Hist[15][B]++,k.bitrate_blockType_Hist[15][5]++}}function T(k,R){var P=k.internal_flags,B,U;if(P.lame_encode_frame_init==0){var z,I,L=i(2014),M=i(2014);for(P.lame_encode_frame_init=1,z=0,I=0;z<286+576*(1+P.mode_gr);++z)z<576*P.mode_gr?(L[z]=0,P.channels_out==2&&(M[z]=0)):(L[z]=R[0][I],P.channels_out==2&&(M[z]=R[1][I]),++I);for(U=0;U<P.mode_gr;U++)for(B=0;B<P.channels_out;B++)P.l3_side.tt[U][B].block_type=c.SHORT_TYPE;b.mdct_sub48(P,L,M),a(576>=c.FFTOFFSET),a(P.mf_size>=c.BLKSIZE+k.framesize-c.FFTOFFSET),a(P.mf_size>=512+k.framesize-32)}}this.lame_encode_mp3_frame=function(k,R,P,B,U,z){var I,L=r([2,2]);L[0][0]=new u,L[0][1]=new u,L[1][0]=new u,L[1][1]=new u;var M=r([2,2]);M[0][0]=new u,M[0][1]=new u,M[1][0]=new u,M[1][1]=new u;var F,Z=[null,null],$=k.internal_flags,Y=s([2,4]),Q=[.5,.5],q=[[0,0],[0,0]],V=[[0,0],[0,0]],K,ne,ie;if(Z[0]=R,Z[1]=P,$.lame_encode_frame_init==0&&T(k,Z),$.padding=0,($.slot_lag-=$.frac_SpF)<0&&($.slot_lag+=k.out_samplerate,$.padding=1),$.psymodel!=0){var ae,Te=[null,null],Ie=0,be=o(2);for(ie=0;ie<$.mode_gr;ie++){for(ne=0;ne<$.channels_out;ne++)Te[ne]=Z[ne],Ie=576+ie*576-c.FFTOFFSET;if(k.VBR==t.vbr_mtrh||k.VBR==t.vbr_mt?ae=_.L3psycho_anal_vbr(k,Te,Ie,ie,L,M,q[ie],V[ie],Y[ie],be):ae=_.L3psycho_anal_ns(k,Te,Ie,ie,L,M,q[ie],V[ie],Y[ie],be),ae!=0)return-4;for(k.mode==h.JOINT_STEREO&&(Q[ie]=Y[ie][2]+Y[ie][3],Q[ie]>0&&(Q[ie]=Y[ie][3]/Q[ie])),ne=0;ne<$.channels_out;ne++){var Pe=$.l3_side.tt[ie][ne];Pe.block_type=be[ne],Pe.mixed_block_flag=0}}}else for(ie=0;ie<$.mode_gr;ie++)for(ne=0;ne<$.channels_out;ne++)$.l3_side.tt[ie][ne].block_type=c.NORM_TYPE,$.l3_side.tt[ie][ne].mixed_block_flag=0,V[ie][ne]=q[ie][ne]=700;if(y($),b.mdct_sub48($,Z[0],Z[1]),$.mode_ext=c.MPG_MD_LR_LR,k.force_ms)$.mode_ext=c.MPG_MD_MS_LR;else if(k.mode==h.JOINT_STEREO){var $e=0,tt=0;for(ie=0;ie<$.mode_gr;ie++)for(ne=0;ne<$.channels_out;ne++)$e+=V[ie][ne],tt+=q[ie][ne];if($e<=1*tt){var qe=$.l3_side.tt[0],ut=$.l3_side.tt[$.mode_gr-1];qe[0].block_type==qe[1].block_type&&ut[0].block_type==ut[1].block_type&&($.mode_ext=c.MPG_MD_MS_LR)}}if($.mode_ext==d?(F=M,K=V):(F=L,K=q),k.analysis&&$.pinfo!=null)for(ie=0;ie<$.mode_gr;ie++)for(ne=0;ne<$.channels_out;ne++)$.pinfo.ms_ratio[ie]=$.ms_ratio[ie],$.pinfo.ms_ener_ratio[ie]=Q[ie],$.pinfo.blocktype[ie][ne]=$.l3_side.tt[ie][ne].block_type,$.pinfo.pe[ie][ne]=K[ie][ne],e.arraycopy($.l3_side.tt[ie][ne].xr,0,$.pinfo.xr[ie][ne],0,576),$.mode_ext==d&&($.pinfo.ers[ie][ne]=$.pinfo.ers[ie][ne+2],e.arraycopy($.pinfo.energy[ie][ne+2],0,$.pinfo.energy[ie][ne],0,$.pinfo.energy[ie][ne].length));if(k.VBR==t.vbr_off||k.VBR==t.vbr_abr){var te,Ne;for(te=0;te<18;te++)$.nsPsy.pefirbuf[te]=$.nsPsy.pefirbuf[te+1];for(Ne=0,ie=0;ie<$.mode_gr;ie++)for(ne=0;ne<$.channels_out;ne++)Ne+=K[ie][ne];for($.nsPsy.pefirbuf[18]=Ne,Ne=$.nsPsy.pefirbuf[9],te=0;te<9;te++)Ne+=($.nsPsy.pefirbuf[te]+$.nsPsy.pefirbuf[18-te])*c.fircoef[te];for(Ne=670*5*$.mode_gr*$.channels_out/Ne,ie=0;ie<$.mode_gr;ie++)for(ne=0;ne<$.channels_out;ne++)K[ie][ne]*=Ne}if($.iteration_loop.iteration_loop(k,K,Q,F),p.format_bitstream(k),I=p.copy_buffer($,B,U,z,1),k.bWriteVbrTag&&g.addVbrFrame(k),k.analysis&&$.pinfo!=null){for(ne=0;ne<$.channels_out;ne++){var Be;for(Be=0;Be<f;Be++)$.pinfo.pcmdata[ne][Be]=$.pinfo.pcmdata[ne][Be+k.framesize];for(Be=f;Be<1600;Be++)$.pinfo.pcmdata[ne][Be]=Z[ne][Be-f]}m.set_frame_pinfo(k,F)}return x($),I}}return bP=c,bP}var Tne=Lo,gV=Tne.Util,_V=Tne.new_float,Pa=gu();function i7e(){var n=_V(Pa.BLKSIZE),e=_V(Pa.BLKSIZE_s/2),t=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function r(s,o,a){var c=0,l,u,h;a<<=1;var f=o+a;l=4;do{var d,p,_,g,m,b,y;y=l>>1,g=l,m=l<<1,b=m+g,l=m<<1,u=o,h=u+y;do{var x,T,k,R;T=s[u+0]-s[u+g],x=s[u+0]+s[u+g],R=s[u+m]-s[u+b],k=s[u+m]+s[u+b],s[u+m]=x-k,s[u+0]=x+k,s[u+b]=T-R,s[u+g]=T+R,T=s[h+0]-s[h+g],x=s[h+0]+s[h+g],R=gV.SQRT2*s[h+b],k=gV.SQRT2*s[h+m],s[h+m]=x-k,s[h+0]=x+k,s[h+b]=T-R,s[h+g]=T+R,h+=l,u+=l}while(u<f);for(p=t[c+0],d=t[c+1],_=1;_<y;_++){var P,B;P=1-2*d*d,B=2*d*p,u=o+_,h=o+g-_;do{var U,z,I,x,T,L,k,M,R,F;z=B*s[u+g]-P*s[h+g],U=P*s[u+g]+B*s[h+g],T=s[u+0]-U,x=s[u+0]+U,L=s[h+0]-z,I=s[h+0]+z,z=B*s[u+b]-P*s[h+b],U=P*s[u+b]+B*s[h+b],R=s[u+m]-U,k=s[u+m]+U,F=s[h+m]-z,M=s[h+m]+z,z=d*k-p*F,U=p*k+d*F,s[u+m]=x-U,s[u+0]=x+U,s[h+b]=L-z,s[h+g]=L+z,z=p*M-d*R,U=d*M+p*R,s[h+m]=I-U,s[h+0]=I+U,s[u+b]=T-z,s[u+g]=T+z,h+=l,u+=l}while(u<f);P=p,p=P*t[c+0]-d*t[c+1],d=P*t[c+1]+d*t[c+0]}c+=2}while(l<a)}var i=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(s,o,a,c,l){for(var u=0;u<3;u++){var h=Pa.BLKSIZE_s/2,f=65535&576/3*(u+1),d=Pa.BLKSIZE_s/8-1;do{var p,_,g,m,b,y=i[d<<2]&255;p=e[y]*c[a][l+y+f],b=e[127-y]*c[a][l+y+f+128],_=p-b,p=p+b,g=e[y+64]*c[a][l+y+f+64],b=e[63-y]*c[a][l+y+f+192],m=g-b,g=g+b,h-=4,o[u][h+0]=p+g,o[u][h+2]=p-g,o[u][h+1]=_+m,o[u][h+3]=_-m,p=e[y+1]*c[a][l+y+f+1],b=e[126-y]*c[a][l+y+f+129],_=p-b,p=p+b,g=e[y+65]*c[a][l+y+f+65],b=e[62-y]*c[a][l+y+f+193],m=g-b,g=g+b,o[u][h+Pa.BLKSIZE_s/2+0]=p+g,o[u][h+Pa.BLKSIZE_s/2+2]=p-g,o[u][h+Pa.BLKSIZE_s/2+1]=_+m,o[u][h+Pa.BLKSIZE_s/2+3]=_-m}while(--d>=0);r(o[u],h,Pa.BLKSIZE_s/2)}},this.fft_long=function(s,o,a,c,l){var u=Pa.BLKSIZE/8-1,h=Pa.BLKSIZE/2;do{var f,d,p,_,g,m=i[u]&255;f=n[m]*c[a][l+m],g=n[m+512]*c[a][l+m+512],d=f-g,f=f+g,p=n[m+256]*c[a][l+m+256],g=n[m+768]*c[a][l+m+768],_=p-g,p=p+g,h-=4,o[h+0]=f+p,o[h+2]=f-p,o[h+1]=d+_,o[h+3]=d-_,f=n[m+1]*c[a][l+m+1],g=n[m+513]*c[a][l+m+513],d=f-g,f=f+g,p=n[m+257]*c[a][l+m+257],g=n[m+769]*c[a][l+m+769],_=p-g,p=p+g,o[h+Pa.BLKSIZE/2+0]=f+p,o[h+Pa.BLKSIZE/2+2]=f-p,o[h+Pa.BLKSIZE/2+1]=d+_,o[h+Pa.BLKSIZE/2+3]=d-_}while(--u>=0);r(o,h,Pa.BLKSIZE/2)},this.init_fft=function(s){for(var o=0;o<Pa.BLKSIZE;o++)n[o]=.42-.5*Math.cos(2*Math.PI*(o+.5)/Pa.BLKSIZE)+.08*Math.cos(4*Math.PI*(o+.5)/Pa.BLKSIZE);for(var o=0;o<Pa.BLKSIZE_s/2;o++)e[o]=.5*(1-Math.cos(2*Math.PI*(o+.5)/Pa.BLKSIZE_s))}}var s7e=i7e,b_=Lo,eE=b_.VbrMode,vV=b_.Float,tE=b_.ShortBlock,vh=b_.Util,o7e=b_.Arrays,tc=b_.new_float,cd=b_.new_float_n,p1=b_.new_int,Gr=b_.assert,a7e=s7e,zt=gu();function c7e(){var n=PR,e=new a7e,t=2.302585092994046,r=2,i=16,s=2,o=16,a=.34,c=1/(14752*14752)/(zt.BLKSIZE/2),l=.01,u=.8,h=.6,f=.3,d=3.5,p=21,_=.2302585093;function g(W,le){for(var Se=0,Ae=0;Ae<zt.BLKSIZE/2;++Ae)Se+=W[Ae]*le.ATH.eql_w[Ae];return Se*=c,Se}function m(W,le,Se,Ae,ye,ve,Xe,Me,Ve,je,We){var ct=W.internal_flags;if(Ve<2)e.fft_long(ct,Ae[ye],Ve,je,We),e.fft_short(ct,ve[Xe],Ve,je,We);else if(Ve==2){for(var Fe=zt.BLKSIZE-1;Fe>=0;--Fe){var rt=Ae[ye+0][Fe],it=Ae[ye+1][Fe];Ae[ye+0][Fe]=(rt+it)*vh.SQRT2*.5,Ae[ye+1][Fe]=(rt-it)*vh.SQRT2*.5}for(var St=2;St>=0;--St)for(var Fe=zt.BLKSIZE_s-1;Fe>=0;--Fe){var rt=ve[Xe+0][St][Fe],it=ve[Xe+1][St][Fe];ve[Xe+0][St][Fe]=(rt+it)*vh.SQRT2*.5,ve[Xe+1][St][Fe]=(rt-it)*vh.SQRT2*.5}}le[0]=Ae[ye+0][0],le[0]*=le[0];for(var Fe=zt.BLKSIZE/2-1;Fe>=0;--Fe){var at=Ae[ye+0][zt.BLKSIZE/2-Fe],Yt=Ae[ye+0][zt.BLKSIZE/2+Fe];le[zt.BLKSIZE/2-Fe]=(at*at+Yt*Yt)*.5}for(var St=2;St>=0;--St){Se[St][0]=ve[Xe+0][St][0],Se[St][0]*=Se[St][0];for(var Fe=zt.BLKSIZE_s/2-1;Fe>=0;--Fe){var at=ve[Xe+0][St][zt.BLKSIZE_s/2-Fe],Yt=ve[Xe+0][St][zt.BLKSIZE_s/2+Fe];Se[St][zt.BLKSIZE_s/2-Fe]=(at*at+Yt*Yt)*.5}}{for(var sn=0,Fe=11;Fe<zt.HBLKSIZE;Fe++)sn+=le[Fe];ct.tot_ener[Ve]=sn}if(W.analysis){for(var Fe=0;Fe<zt.HBLKSIZE;Fe++)ct.pinfo.energy[Me][Ve][Fe]=ct.pinfo.energy_save[Ve][Fe],ct.pinfo.energy_save[Ve][Fe]=le[Fe];ct.pinfo.pe[Me][Ve]=ct.pe[Ve]}W.athaa_loudapprox==2&&Ve<2&&(ct.loudness_sq[Me][Ve]=ct.loudness_sq_save[Ve],ct.loudness_sq_save[Ve]=g(le,ct))}var b=8,y=23,x=15,T,k,R,P=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function B(){T=Math.pow(10,(b+1)/16),k=Math.pow(10,(y+1)/16),R=Math.pow(10,x/10)}var U=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],z=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],I=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function L(W,le,Se,Ae,ye,ve){var Xe;if(le>W)if(le<W*k)Xe=le/W;else return W+le;else{if(W>=le*k)return W+le;Xe=W/le}if(W+=le,Ae+3<=6){if(Xe>=T)return W;var Me=0|vh.FAST_LOG10_X(Xe,16);return W*z[Me]}var Me=0|vh.FAST_LOG10_X(Xe,16);if(le=ye.ATH.cb_l[Se]*ye.ATH.adjust,W<R*le){if(W>le){var Ve,je;return Ve=1,Me<=13&&(Ve=I[Me]),je=vh.FAST_LOG10_X(W/le,10/15),W*((U[Me]-Ve)*je+Ve)}return Me>13?W:W*I[Me]}return W*U[Me]}var M=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function F(W,le,Se){var Ae;if(W<0&&(W=0),le<0&&(le=0),W<=0)return le;if(le<=0)return W;if(le>W?Ae=le/W:Ae=W/le,-2<=Se&&Se<=2){if(Ae>=T)return W+le;var ye=0|vh.FAST_LOG10_X(Ae,16);return(W+le)*M[ye]}return Ae<k?W+le:(W<le&&(W=le),W)}function Z(W,le){var Se=W.internal_flags;if(Se.channels_out>1){for(var Ae=0;Ae<zt.SBMAX_l;Ae++){var ye=Se.thm[0].l[Ae],ve=Se.thm[1].l[Ae];Se.thm[0].l[Ae]+=ve*le,Se.thm[1].l[Ae]+=ye*le}for(var Ae=0;Ae<zt.SBMAX_s;Ae++)for(var Xe=0;Xe<3;Xe++){var ye=Se.thm[0].s[Ae][Xe],ve=Se.thm[1].s[Ae][Xe];Se.thm[0].s[Ae][Xe]+=ve*le,Se.thm[1].s[Ae][Xe]+=ye*le}}}function $(W){for(var le=0;le<zt.SBMAX_l;le++)if(!(W.thm[0].l[le]>1.58*W.thm[1].l[le]||W.thm[1].l[le]>1.58*W.thm[0].l[le])){var Se=W.mld_l[le]*W.en[3].l[le],Ae=Math.max(W.thm[2].l[le],Math.min(W.thm[3].l[le],Se));Se=W.mld_l[le]*W.en[2].l[le];var ye=Math.max(W.thm[3].l[le],Math.min(W.thm[2].l[le],Se));W.thm[2].l[le]=Ae,W.thm[3].l[le]=ye}for(var le=0;le<zt.SBMAX_s;le++)for(var ve=0;ve<3;ve++)if(!(W.thm[0].s[le][ve]>1.58*W.thm[1].s[le][ve]||W.thm[1].s[le][ve]>1.58*W.thm[0].s[le][ve])){var Se=W.mld_s[le]*W.en[3].s[le][ve],Ae=Math.max(W.thm[2].s[le][ve],Math.min(W.thm[3].s[le][ve],Se));Se=W.mld_s[le]*W.en[2].s[le][ve];var ye=Math.max(W.thm[3].s[le][ve],Math.min(W.thm[2].s[le][ve],Se));W.thm[2].s[le][ve]=Ae,W.thm[3].s[le][ve]=ye}}function Y(W,le,Se){var Ae=le,ye=Math.pow(10,Se);le*=2,Ae*=2;for(var ve=0;ve<zt.SBMAX_l;ve++){var Xe,Me,Ve,je;if(je=W.ATH.cb_l[W.bm_l[ve]]*ye,Xe=Math.min(Math.max(W.thm[0].l[ve],je),Math.max(W.thm[1].l[ve],je)),Me=Math.max(W.thm[2].l[ve],je),Ve=Math.max(W.thm[3].l[ve],je),Xe*le<Me+Ve){var We=Xe*Ae/(Me+Ve);Me*=We,Ve*=We}W.thm[2].l[ve]=Math.min(Me,W.thm[2].l[ve]),W.thm[3].l[ve]=Math.min(Ve,W.thm[3].l[ve])}ye*=zt.BLKSIZE_s/zt.BLKSIZE;for(var ve=0;ve<zt.SBMAX_s;ve++)for(var ct=0;ct<3;ct++){var Xe,Me,Ve,je;if(je=W.ATH.cb_s[W.bm_s[ve]]*ye,Xe=Math.min(Math.max(W.thm[0].s[ve][ct],je),Math.max(W.thm[1].s[ve][ct],je)),Me=Math.max(W.thm[2].s[ve][ct],je),Ve=Math.max(W.thm[3].s[ve][ct],je),Xe*le<Me+Ve){var We=Xe*le/(Me+Ve);Me*=We,Ve*=We}W.thm[2].s[ve][ct]=Math.min(W.thm[2].s[ve][ct],Me),W.thm[3].s[ve][ct]=Math.min(W.thm[3].s[ve][ct],Ve)}}function Q(W,le,Se,Ae,ye){var ve,Xe,Me=0,Ve=0;for(ve=Xe=0;ve<zt.SBMAX_s;++Xe,++ve){for(var je=W.bo_s[ve],We=W.npart_s,ct=je<We?je:We;Xe<ct;)Gr(le[Xe]>=0),Gr(Se[Xe]>=0),Me+=le[Xe],Ve+=Se[Xe],Xe++;if(W.en[Ae].s[ve][ye]=Me,W.thm[Ae].s[ve][ye]=Ve,Xe>=We){++ve;break}Gr(le[Xe]>=0),Gr(Se[Xe]>=0);{var Fe=W.PSY.bo_s_weight[ve],rt=1-Fe;Me=Fe*le[Xe],Ve=Fe*Se[Xe],W.en[Ae].s[ve][ye]+=Me,W.thm[Ae].s[ve][ye]+=Ve,Me=rt*le[Xe],Ve=rt*Se[Xe]}}for(;ve<zt.SBMAX_s;++ve)W.en[Ae].s[ve][ye]=0,W.thm[Ae].s[ve][ye]=0}function q(W,le,Se,Ae){var ye,ve,Xe=0,Me=0;for(ye=ve=0;ye<zt.SBMAX_l;++ve,++ye){for(var Ve=W.bo_l[ye],je=W.npart_l,We=Ve<je?Ve:je;ve<We;)Gr(le[ve]>=0),Gr(Se[ve]>=0),Xe+=le[ve],Me+=Se[ve],ve++;if(W.en[Ae].l[ye]=Xe,W.thm[Ae].l[ye]=Me,ve>=je){++ye;break}Gr(le[ve]>=0),Gr(Se[ve]>=0);{var ct=W.PSY.bo_l_weight[ye],Fe=1-ct;Xe=ct*le[ve],Me=ct*Se[ve],W.en[Ae].l[ye]+=Xe,W.thm[Ae].l[ye]+=Me,Xe=Fe*le[ve],Me=Fe*Se[ve]}}for(;ye<zt.SBMAX_l;++ye)W.en[Ae].l[ye]=0,W.thm[Ae].l[ye]=0}function V(W,le,Se,Ae,ye,ve){var Xe=W.internal_flags,Me,Ve;for(Ve=Me=0;Ve<Xe.npart_s;++Ve){for(var je=0,We=Xe.numlines_s[Ve],ct=0;ct<We;++ct,++Me){var Fe=le[ve][Me];je+=Fe}Se[Ve]=je}for(Gr(Ve==Xe.npart_s),Me=Ve=0;Ve<Xe.npart_s;Ve++){var rt=Xe.s3ind_s[Ve][0],it=Xe.s3_ss[Me++]*Se[rt];for(++rt;rt<=Xe.s3ind_s[Ve][1];)it+=Xe.s3_ss[Me]*Se[rt],++Me,++rt;{var St=s*Xe.nb_s1[ye][Ve];Ae[Ve]=Math.min(it,St)}if(Xe.blocktype_old[ye&1]==zt.SHORT_TYPE){var St=o*Xe.nb_s2[ye][Ve],at=Ae[Ve];Ae[Ve]=Math.min(St,at)}Xe.nb_s2[ye][Ve]=Xe.nb_s1[ye][Ve],Xe.nb_s1[ye][Ve]=it,Gr(Ae[Ve]>=0)}for(;Ve<=zt.CBANDS;++Ve)Se[Ve]=0,Ae[Ve]=0}function K(W,le,Se,Ae){var ye=W.internal_flags;W.short_blocks==tE.short_block_coupled&&!(le[0]!=0&&le[1]!=0)&&(le[0]=le[1]=0);for(var ve=0;ve<ye.channels_out;ve++)Ae[ve]=zt.NORM_TYPE,W.short_blocks==tE.short_block_dispensed&&(le[ve]=1),W.short_blocks==tE.short_block_forced&&(le[ve]=0),le[ve]!=0?(Gr(ye.blocktype_old[ve]!=zt.START_TYPE),ye.blocktype_old[ve]==zt.SHORT_TYPE&&(Ae[ve]=zt.STOP_TYPE)):(Ae[ve]=zt.SHORT_TYPE,ye.blocktype_old[ve]==zt.NORM_TYPE&&(ye.blocktype_old[ve]=zt.START_TYPE),ye.blocktype_old[ve]==zt.STOP_TYPE&&(ye.blocktype_old[ve]=zt.SHORT_TYPE)),Se[ve]=ye.blocktype_old[ve],ye.blocktype_old[ve]=Ae[ve]}function ne(W,le,Se){return Se>=1?W:Se<=0?le:le>0?Math.pow(W/le,Se)*le:0}var ie=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function ae(W,le){for(var Se=309.07,Ae=0;Ae<zt.SBMAX_s-1;Ae++)for(var ye=0;ye<3;ye++){var ve=W.thm.s[Ae][ye];if(ve>0){var Xe=ve*le,Me=W.en.s[Ae][ye];Me>Xe&&(Me>Xe*1e10?Se+=ie[Ae]*(10*t):Se+=ie[Ae]*vh.FAST_LOG10(Me/Xe))}}return Se}var Te=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function Ie(W,le){for(var Se=281.0575,Ae=0;Ae<zt.SBMAX_l-1;Ae++){var ye=W.thm.l[Ae];if(ye>0){var ve=ye*le,Xe=W.en.l[Ae];Xe>ve&&(Xe>ve*1e10?Se+=Te[Ae]*(10*t):Se+=Te[Ae]*vh.FAST_LOG10(Xe/ve))}}return Se}function be(W,le,Se,Ae,ye){var ve,Xe;for(ve=Xe=0;ve<W.npart_l;++ve){var Me=0,Ve=0,je;for(je=0;je<W.numlines_l[ve];++je,++Xe){var We=le[Xe];Me+=We,Ve<We&&(Ve=We)}Se[ve]=Me,Ae[ve]=Ve,ye[ve]=Me*W.rnumlines_l[ve],Gr(W.rnumlines_l[ve]>=0),Gr(Se[ve]>=0),Gr(Ae[ve]>=0),Gr(ye[ve]>=0)}}function Pe(W,le,Se,Ae){var ye=P.length-1,ve=0,Xe=Se[ve]+Se[ve+1];if(Xe>0){var Me=le[ve];Me<le[ve+1]&&(Me=le[ve+1]),Gr(W.numlines_l[ve]+W.numlines_l[ve+1]-1>0),Xe=20*(Me*2-Xe)/(Xe*(W.numlines_l[ve]+W.numlines_l[ve+1]-1));var Ve=0|Xe;Ve>ye&&(Ve=ye),Ae[ve]=Ve}else Ae[ve]=0;for(ve=1;ve<W.npart_l-1;ve++)if(Xe=Se[ve-1]+Se[ve]+Se[ve+1],Xe>0){var Me=le[ve-1];Me<le[ve]&&(Me=le[ve]),Me<le[ve+1]&&(Me=le[ve+1]),Gr(W.numlines_l[ve-1]+W.numlines_l[ve]+W.numlines_l[ve+1]-1>0),Xe=20*(Me*3-Xe)/(Xe*(W.numlines_l[ve-1]+W.numlines_l[ve]+W.numlines_l[ve+1]-1));var Ve=0|Xe;Ve>ye&&(Ve=ye),Ae[ve]=Ve}else Ae[ve]=0;if(Gr(ve==W.npart_l-1),Xe=Se[ve-1]+Se[ve],Xe>0){var Me=le[ve-1];Me<le[ve]&&(Me=le[ve]),Gr(W.numlines_l[ve-1]+W.numlines_l[ve]-1>0),Xe=20*(Me*2-Xe)/(Xe*(W.numlines_l[ve-1]+W.numlines_l[ve]-1));var Ve=0|Xe;Ve>ye&&(Ve=ye),Ae[ve]=Ve}else Ae[ve]=0;Gr(ve==W.npart_l-1)}var $e=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(W,le,Se,Ae,ye,ve,Xe,Me,Ve,je){var We=W.internal_flags,ct=cd([2,zt.BLKSIZE]),Fe=cd([2,3,zt.BLKSIZE_s]),rt=tc(zt.CBANDS+1),it=tc(zt.CBANDS+1),St=tc(zt.CBANDS+2),at=p1(2),Yt=p1(2),sn,Rt,Ut,_t,Ht,_n,jt,mn,Rn=cd([2,576]),Un,qi=p1(zt.CBANDS+2),oi=p1(zt.CBANDS+2);for(o7e.fill(oi,0),sn=We.channels_out,W.mode==n.JOINT_STEREO&&(sn=4),W.VBR==eE.vbr_off?Un=We.ResvMax==0?0:We.ResvSize/We.ResvMax*.5:W.VBR==eE.vbr_rh||W.VBR==eE.vbr_mtrh||W.VBR==eE.vbr_mt?Un=.6:Un=1,Rt=0;Rt<We.channels_out;Rt++){var _i=le[Rt],ys=Se+576-350-p+192;for(_t=0;_t<576;_t++){var Is,Ui;for(Is=_i[ys+_t+10],Ui=0,Ht=0;Ht<(p-1)/2-1;Ht+=2)Is+=$e[Ht]*(_i[ys+_t+Ht]+_i[ys+_t+p-Ht]),Ui+=$e[Ht+1]*(_i[ys+_t+Ht+1]+_i[ys+_t+p-Ht-1]);Rn[Rt][_t]=Is+Ui}ye[Ae][Rt].en.assign(We.en[Rt]),ye[Ae][Rt].thm.assign(We.thm[Rt]),sn>2&&(ve[Ae][Rt].en.assign(We.en[Rt+2]),ve[Ae][Rt].thm.assign(We.thm[Rt+2]))}for(Rt=0;Rt<sn;Rt++){var us,hs,Le=tc(12),mt=[0,0,0,0],Ct=tc(12),Ot=1,yt,Qt=tc(zt.CBANDS),Sn=tc(zt.CBANDS),an=[0,0,0,0],Dn=tc(zt.HBLKSIZE),or=cd([3,zt.HBLKSIZE_s]);for(Gr(We.npart_s<=zt.CBANDS),Gr(We.npart_l<=zt.CBANDS),_t=0;_t<3;_t++)Le[_t]=We.nsPsy.last_en_subshort[Rt][_t+6],Gr(We.nsPsy.last_en_subshort[Rt][_t+4]>0),Ct[_t]=Le[_t]/We.nsPsy.last_en_subshort[Rt][_t+4],mt[0]+=Le[_t];if(Rt==2)for(_t=0;_t<576;_t++){var rr,zn;rr=Rn[0][_t],zn=Rn[1][_t],Rn[0][_t]=rr+zn,Rn[1][_t]=rr-zn}{var dr=Rn[Rt&1],Ur=0;for(_t=0;_t<9;_t++){for(var rs=Ur+64,Rr=1;Ur<rs;Ur++)Rr<Math.abs(dr[Ur])&&(Rr=Math.abs(dr[Ur]));We.nsPsy.last_en_subshort[Rt][_t]=Le[_t+3]=Rr,mt[1+_t/3]+=Rr,Rr>Le[_t+3-2]?(Gr(Le[_t+3-2]>0),Rr=Rr/Le[_t+3-2]):Le[_t+3-2]>Rr*10?Rr=Le[_t+3-2]/(Rr*10):Rr=0,Ct[_t+3]=Rr}}if(W.analysis){var Dr=Ct[0];for(_t=1;_t<12;_t++)Dr<Ct[_t]&&(Dr=Ct[_t]);We.pinfo.ers[Ae][Rt]=We.pinfo.ers_save[Rt],We.pinfo.ers_save[Rt]=Dr}for(yt=Rt==3?We.nsPsy.attackthre_s:We.nsPsy.attackthre,_t=0;_t<12;_t++)an[_t/3]==0&&Ct[_t]>yt&&(an[_t/3]=_t%3+1);for(_t=1;_t<4;_t++){var Qn;mt[_t-1]>mt[_t]?(Gr(mt[_t]>0),Qn=mt[_t-1]/mt[_t]):(Gr(mt[_t-1]>0),Qn=mt[_t]/mt[_t-1]),Qn<1.7&&(an[_t]=0,_t==1&&(an[0]=0))}for(an[0]!=0&&We.nsPsy.lastAttacks[Rt]!=0&&(an[0]=0),(We.nsPsy.lastAttacks[Rt]==3||an[0]+an[1]+an[2]+an[3]!=0)&&(Ot=0,an[1]!=0&&an[0]!=0&&(an[1]=0),an[2]!=0&&an[1]!=0&&(an[2]=0),an[3]!=0&&an[2]!=0&&(an[3]=0)),Rt<2?Yt[Rt]=Ot:Ot==0&&(Yt[0]=Yt[1]=0),Ve[Rt]=We.tot_ener[Rt],hs=Fe,us=ct,m(W,Dn,or,us,Rt&1,hs,Rt&1,Ae,Rt,le,Se),be(We,Dn,rt,Qt,Sn),Pe(We,Qt,Sn,qi),mn=0;mn<3;mn++){var pr,On;for(V(W,or,it,St,Rt,mn),Q(We,it,St,Rt,mn),jt=0;jt<zt.SBMAX_s;jt++){if(On=We.thm[Rt].s[jt][mn],On*=u,an[mn]>=2||an[mn+1]==1){var Fs=mn!=0?mn-1:2,Rr=ne(We.thm[Rt].s[jt][Fs],On,h*Un);On=Math.min(On,Rr)}if(an[mn]==1){var Fs=mn!=0?mn-1:2,Rr=ne(We.thm[Rt].s[jt][Fs],On,f*Un);On=Math.min(On,Rr)}else if(mn!=0&&an[mn-1]==3||mn==0&&We.nsPsy.lastAttacks[Rt]==3){var Fs=mn!=2?mn+1:0,Rr=ne(We.thm[Rt].s[jt][Fs],On,f*Un);On=Math.min(On,Rr)}pr=Le[mn*3+3]+Le[mn*3+4]+Le[mn*3+5],Le[mn*3+5]*6<pr&&(On*=.5,Le[mn*3+4]*6<pr&&(On*=.5)),We.thm[Rt].s[jt][mn]=On}}for(We.nsPsy.lastAttacks[Rt]=an[2],_n=0,Ut=0;Ut<We.npart_l;Ut++){for(var So=We.s3ind[Ut][0],js=rt[So]*P[qi[So]],Qo=We.s3_ll[_n++]*js;++So<=We.s3ind[Ut][1];)js=rt[So]*P[qi[So]],Qo=L(Qo,We.s3_ll[_n++]*js,So,So-Ut,We);Qo*=.158489319246111,We.blocktype_old[Rt&1]==zt.SHORT_TYPE?St[Ut]=Qo:St[Ut]=ne(Math.min(Qo,Math.min(r*We.nb_1[Rt][Ut],i*We.nb_2[Rt][Ut])),Qo,Un),We.nb_2[Rt][Ut]=We.nb_1[Rt][Ut],We.nb_1[Rt][Ut]=Qo}for(;Ut<=zt.CBANDS;++Ut)rt[Ut]=0,St[Ut]=0;q(We,rt,St,Rt)}if((W.mode==n.STEREO||W.mode==n.JOINT_STEREO)&&W.interChRatio>0&&Z(W,W.interChRatio),W.mode==n.JOINT_STEREO){var Ci;$(We),Ci=W.msfix,Math.abs(Ci)>0&&Y(We,Ci,W.ATHlower*We.ATH.adjust)}for(K(W,Yt,je,at),Rt=0;Rt<sn;Rt++){var xn,bs=0,$n,fs;Rt>1?(xn=Me,bs=-2,$n=zt.NORM_TYPE,(je[0]==zt.SHORT_TYPE||je[1]==zt.SHORT_TYPE)&&($n=zt.SHORT_TYPE),fs=ve[Ae][Rt-2]):(xn=Xe,bs=0,$n=je[Rt],fs=ye[Ae][Rt]),$n==zt.SHORT_TYPE?xn[bs+Rt]=ae(fs,We.masking_lower):xn[bs+Rt]=Ie(fs,We.masking_lower),W.analysis&&(We.pinfo.pe[Ae][Rt]=xn[bs+Rt])}return 0};function tt(W,le,Se,Ae,ye,ve,Xe,Me){var Ve=W.internal_flags;if(Ae<2)e.fft_long(Ve,Xe[Me],Ae,le,Se);else if(Ae==2)for(var je=zt.BLKSIZE-1;je>=0;--je){var We=Xe[Me+0][je],ct=Xe[Me+1][je];Xe[Me+0][je]=(We+ct)*vh.SQRT2*.5,Xe[Me+1][je]=(We-ct)*vh.SQRT2*.5}ve[0]=Xe[Me+0][0],ve[0]*=ve[0];for(var je=zt.BLKSIZE/2-1;je>=0;--je){var Fe=Xe[Me+0][zt.BLKSIZE/2-je],rt=Xe[Me+0][zt.BLKSIZE/2+je];ve[zt.BLKSIZE/2-je]=(Fe*Fe+rt*rt)*.5}{for(var it=0,je=11;je<zt.HBLKSIZE;je++)it+=ve[je];Ve.tot_ener[Ae]=it}if(W.analysis){for(var je=0;je<zt.HBLKSIZE;je++)Ve.pinfo.energy[ye][Ae][je]=Ve.pinfo.energy_save[Ae][je],Ve.pinfo.energy_save[Ae][je]=ve[je];Ve.pinfo.pe[ye][Ae]=Ve.pe[Ae]}}function qe(W,le,Se,Ae,ye,ve,Xe,Me){var Ve=W.internal_flags;if(ye==0&&Ae<2&&e.fft_short(Ve,Xe[Me],Ae,le,Se),Ae==2)for(var je=zt.BLKSIZE_s-1;je>=0;--je){var We=Xe[Me+0][ye][je],ct=Xe[Me+1][ye][je];Xe[Me+0][ye][je]=(We+ct)*vh.SQRT2*.5,Xe[Me+1][ye][je]=(We-ct)*vh.SQRT2*.5}ve[ye][0]=Xe[Me+0][ye][0],ve[ye][0]*=ve[ye][0];for(var je=zt.BLKSIZE_s/2-1;je>=0;--je){var Fe=Xe[Me+0][ye][zt.BLKSIZE_s/2-je],rt=Xe[Me+0][ye][zt.BLKSIZE_s/2+je];ve[ye][zt.BLKSIZE_s/2-je]=(Fe*Fe+rt*rt)*.5}}function ut(W,le,Se,Ae){var ye=W.internal_flags;W.athaa_loudapprox==2&&Se<2&&(ye.loudness_sq[le][Se]=ye.loudness_sq_save[Se],ye.loudness_sq_save[Se]=g(Ae,ye))}var te=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function Ne(W,le,Se,Ae,ye,ve,Xe,Me,Ve,je){for(var We=cd([2,576]),ct=W.internal_flags,Fe=ct.channels_out,rt=W.mode==n.JOINT_STEREO?4:Fe,it=0;it<Fe;it++){firbuf=le[it];for(var St=Se+576-350-p+192,at=0;at<576;at++){var Yt,sn;Yt=firbuf[St+at+10],sn=0;for(var Rt=0;Rt<(p-1)/2-1;Rt+=2)Yt+=te[Rt]*(firbuf[St+at+Rt]+firbuf[St+at+p-Rt]),sn+=te[Rt+1]*(firbuf[St+at+Rt+1]+firbuf[St+at+p-Rt-1]);We[it][at]=Yt+sn}ye[Ae][it].en.assign(ct.en[it]),ye[Ae][it].thm.assign(ct.thm[it]),rt>2&&(ve[Ae][it].en.assign(ct.en[it+2]),ve[Ae][it].thm.assign(ct.thm[it+2]))}for(var it=0;it<rt;it++){var Ut=tc(12),_t=tc(12),Ht=[0,0,0,0],_n=We[it&1],jt=0,mn=it==3?ct.nsPsy.attackthre_s:ct.nsPsy.attackthre,Rn=1;if(it==2)for(var at=0,Rt=576;Rt>0;++at,--Rt){var Un=We[0][at],qi=We[1][at];We[0][at]=Un+qi,We[1][at]=Un-qi}for(var at=0;at<3;at++)_t[at]=ct.nsPsy.last_en_subshort[it][at+6],Gr(ct.nsPsy.last_en_subshort[it][at+4]>0),Ut[at]=_t[at]/ct.nsPsy.last_en_subshort[it][at+4],Ht[0]+=_t[at];for(var at=0;at<9;at++){for(var oi=jt+64,_i=1;jt<oi;jt++)_i<Math.abs(_n[jt])&&(_i=Math.abs(_n[jt]));ct.nsPsy.last_en_subshort[it][at]=_t[at+3]=_i,Ht[1+at/3]+=_i,_i>_t[at+3-2]?(Gr(_t[at+3-2]>0),_i=_i/_t[at+3-2]):_t[at+3-2]>_i*10?_i=_t[at+3-2]/(_i*10):_i=0,Ut[at+3]=_i}for(var at=0;at<3;++at){var ys=_t[at*3+3]+_t[at*3+4]+_t[at*3+5],Is=1;_t[at*3+5]*6<ys&&(Is*=.5,_t[at*3+4]*6<ys&&(Is*=.5)),Me[it][at]=Is}if(W.analysis){for(var Ui=Ut[0],at=1;at<12;at++)Ui<Ut[at]&&(Ui=Ut[at]);ct.pinfo.ers[Ae][it]=ct.pinfo.ers_save[it],ct.pinfo.ers_save[it]=Ui}for(var at=0;at<12;at++)Ve[it][at/3]==0&&Ut[at]>mn&&(Ve[it][at/3]=at%3+1);for(var at=1;at<4;at++){var us=Ht[at-1],hs=Ht[at],Le=Math.max(us,hs);Le<4e4&&us<1.7*hs&&hs<1.7*us&&(at==1&&Ve[it][0]<=Ve[it][at]&&(Ve[it][0]=0),Ve[it][at]=0)}Ve[it][0]<=ct.nsPsy.lastAttacks[it]&&(Ve[it][0]=0),(ct.nsPsy.lastAttacks[it]==3||Ve[it][0]+Ve[it][1]+Ve[it][2]+Ve[it][3]!=0)&&(Rn=0,Ve[it][1]!=0&&Ve[it][0]!=0&&(Ve[it][1]=0),Ve[it][2]!=0&&Ve[it][1]!=0&&(Ve[it][2]=0),Ve[it][3]!=0&&Ve[it][2]!=0&&(Ve[it][3]=0)),it<2?je[it]=Rn:Rn==0&&(je[0]=je[1]=0),Xe[it]=ct.tot_ener[it]}}function Be(W,le,Se){if(Se==0)for(var Ae=0;Ae<W.npart_s;Ae++)W.nb_s2[le][Ae]=W.nb_s1[le][Ae],W.nb_s1[le][Ae]=0}function De(W,le){for(var Se=0;Se<W.npart_l;Se++)W.nb_2[le][Se]=W.nb_1[le][Se],W.nb_1[le][Se]=0}function Oe(W,le,Se,Ae){var ye=P.length-1,ve=0,Xe=Se[ve]+Se[ve+1];if(Xe>0){var Me=le[ve];Me<le[ve+1]&&(Me=le[ve+1]),Gr(W.numlines_s[ve]+W.numlines_s[ve+1]-1>0),Xe=20*(Me*2-Xe)/(Xe*(W.numlines_s[ve]+W.numlines_s[ve+1]-1));var Ve=0|Xe;Ve>ye&&(Ve=ye),Ae[ve]=Ve}else Ae[ve]=0;for(ve=1;ve<W.npart_s-1;ve++)if(Xe=Se[ve-1]+Se[ve]+Se[ve+1],Gr(ve+1<W.npart_s),Xe>0){var Me=le[ve-1];Me<le[ve]&&(Me=le[ve]),Me<le[ve+1]&&(Me=le[ve+1]),Gr(W.numlines_s[ve-1]+W.numlines_s[ve]+W.numlines_s[ve+1]-1>0),Xe=20*(Me*3-Xe)/(Xe*(W.numlines_s[ve-1]+W.numlines_s[ve]+W.numlines_s[ve+1]-1));var Ve=0|Xe;Ve>ye&&(Ve=ye),Ae[ve]=Ve}else Ae[ve]=0;if(Gr(ve==W.npart_s-1),Xe=Se[ve-1]+Se[ve],Xe>0){var Me=le[ve-1];Me<le[ve]&&(Me=le[ve]),Gr(W.numlines_s[ve-1]+W.numlines_s[ve]-1>0),Xe=20*(Me*2-Xe)/(Xe*(W.numlines_s[ve-1]+W.numlines_s[ve]-1));var Ve=0|Xe;Ve>ye&&(Ve=ye),Ae[ve]=Ve}else Ae[ve]=0;Gr(ve==W.npart_s-1)}function ue(W,le,Se,Ae,ye,ve){var Xe=W.internal_flags,Me=new float[zt.CBANDS],Ve=tc(zt.CBANDS),je,We,ct,Fe=new int[zt.CBANDS];for(ct=We=0;ct<Xe.npart_s;++ct){var rt=0,it=0,St=Xe.numlines_s[ct];for(je=0;je<St;++je,++We){var at=le[ve][We];rt+=at,it<at&&(it=at)}Se[ct]=rt,Me[ct]=it,Ve[ct]=rt/St,Gr(Ve[ct]>=0)}for(Gr(ct==Xe.npart_s);ct<zt.CBANDS;++ct)Me[ct]=0,Ve[ct]=0;for(Oe(Xe,Me,Ve,Fe),We=ct=0;ct<Xe.npart_s;ct++){var Yt=Xe.s3ind_s[ct][0],sn=Xe.s3ind_s[ct][1],Rt,Ut,_t,Ht,_n;for(Rt=Fe[Yt],Ut=1,Ht=Xe.s3_ss[We]*Se[Yt]*P[Fe[Yt]],++We,++Yt;Yt<=sn;)Rt+=Fe[Yt],Ut+=1,_t=Xe.s3_ss[We]*Se[Yt]*P[Fe[Yt]],Ht=F(Ht,_t,Yt-ct),++We,++Yt;Rt=(1+2*Rt)/(2*Ut),_n=P[Rt]*.5,Ht*=_n,Ae[ct]=Ht,Xe.nb_s2[ye][ct]=Xe.nb_s1[ye][ct],Xe.nb_s1[ye][ct]=Ht,_t=Me[ct],_t*=Xe.minval_s[ct],_t*=_n,Ae[ct]>_t&&(Ae[ct]=_t),Xe.masking_lower>1&&(Ae[ct]*=Xe.masking_lower),Ae[ct]>Se[ct]&&(Ae[ct]=Se[ct]),Xe.masking_lower<1&&(Ae[ct]*=Xe.masking_lower),Gr(Ae[ct]>=0)}for(;ct<zt.CBANDS;++ct)Se[ct]=0,Ae[ct]=0}function _e(W,le,Se,Ae,ye){var ve=tc(zt.CBANDS),Xe=tc(zt.CBANDS),Me=p1(zt.CBANDS+2),Ve;be(W,le,Se,ve,Xe),Pe(W,ve,Xe,Me);var je=0;for(Ve=0;Ve<W.npart_l;Ve++){var We,ct,Fe,rt,it=W.s3ind[Ve][0],St=W.s3ind[Ve][1],at=0,Yt=0;for(at=Me[it],Yt+=1,ct=W.s3_ll[je]*Se[it]*P[Me[it]],++je,++it;it<=St;)at+=Me[it],Yt+=1,We=W.s3_ll[je]*Se[it]*P[Me[it]],rt=F(ct,We,it-Ve),ct=rt,++je,++it;if(at=(1+2*at)/(2*Yt),Fe=P[at]*.5,ct*=Fe,W.blocktype_old[ye&1]==zt.SHORT_TYPE){var sn=r*W.nb_1[ye][Ve];sn>0?Ae[Ve]=Math.min(ct,sn):Ae[Ve]=Math.min(ct,Se[Ve]*f)}else{var Rt=i*W.nb_2[ye][Ve],Ut=r*W.nb_1[ye][Ve],sn;Rt<=0&&(Rt=ct),Ut<=0&&(Ut=ct),W.blocktype_old[ye&1]==zt.NORM_TYPE?sn=Math.min(Ut,Rt):sn=Ut,Ae[Ve]=Math.min(ct,sn)}W.nb_2[ye][Ve]=W.nb_1[ye][Ve],W.nb_1[ye][Ve]=ct,We=ve[Ve],We*=W.minval_l[Ve],We*=Fe,Ae[Ve]>We&&(Ae[Ve]=We),W.masking_lower>1&&(Ae[Ve]*=W.masking_lower),Ae[Ve]>Se[Ve]&&(Ae[Ve]=Se[Ve]),W.masking_lower<1&&(Ae[Ve]*=W.masking_lower),Gr(Ae[Ve]>=0)}for(;Ve<zt.CBANDS;++Ve)Se[Ve]=0,Ae[Ve]=0}function we(W,le){var Se=W.internal_flags;W.short_blocks==tE.short_block_coupled&&!(le[0]!=0&&le[1]!=0)&&(le[0]=le[1]=0);for(var Ae=0;Ae<Se.channels_out;Ae++)W.short_blocks==tE.short_block_dispensed&&(le[Ae]=1),W.short_blocks==tE.short_block_forced&&(le[Ae]=0)}function pe(W,le,Se){for(var Ae=W.internal_flags,ye=0;ye<Ae.channels_out;ye++){var ve=zt.NORM_TYPE;le[ye]!=0?(Gr(Ae.blocktype_old[ye]!=zt.START_TYPE),Ae.blocktype_old[ye]==zt.SHORT_TYPE&&(ve=zt.STOP_TYPE)):(ve=zt.SHORT_TYPE,Ae.blocktype_old[ye]==zt.NORM_TYPE&&(Ae.blocktype_old[ye]=zt.START_TYPE),Ae.blocktype_old[ye]==zt.STOP_TYPE&&(Ae.blocktype_old[ye]=zt.SHORT_TYPE)),Se[ye]=Ae.blocktype_old[ye],Ae.blocktype_old[ye]=ve}}function ze(W,le,Se,Ae,ye,ve,Xe){for(var Me=ve*2,Ve=ve>0?Math.pow(10,ye):1,je,We,ct=0;ct<Xe;++ct){var Fe=W[2][ct],rt=W[3][ct],it=le[0][ct],St=le[1][ct],at=le[2][ct],Yt=le[3][ct];if(it<=1.58*St&&St<=1.58*it){var sn=Se[ct]*rt,Rt=Se[ct]*Fe;We=Math.max(at,Math.min(Yt,sn)),je=Math.max(Yt,Math.min(at,Rt))}else We=at,je=Yt;if(ve>0){var Ut,_t,Ht=Ae[ct]*Ve;if(Ut=Math.min(Math.max(it,Ht),Math.max(St,Ht)),at=Math.max(We,Ht),Yt=Math.max(je,Ht),_t=at+Yt,_t>0&&Ut*Me<_t){var _n=Ut*Me/_t;at*=_n,Yt*=_n}We=Math.min(at,We),je=Math.min(Yt,je)}We>Fe&&(We=Fe),je>rt&&(je=rt),le[2][ct]=We,le[3][ct]=je}}this.L3psycho_anal_vbr=function(W,le,Se,Ae,ye,ve,Xe,Me,Ve,je){var We=W.internal_flags,ct,Fe,rt=tc(zt.HBLKSIZE),it=cd([3,zt.HBLKSIZE_s]),St=cd([2,zt.BLKSIZE]),at=cd([2,3,zt.BLKSIZE_s]),Yt=cd([4,zt.CBANDS]),sn=cd([4,zt.CBANDS]),Rt=cd([4,3]),Ut=.6,_t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Ht=p1(2),_n=W.mode==n.JOINT_STEREO?4:We.channels_out;Ne(W,le,Se,Ae,ye,ve,Ve,Rt,_t,Ht),we(W,Ht);{for(var jt=0;jt<_n;jt++){var mn=jt&1;ct=St,tt(W,le,Se,jt,Ae,rt,ct,mn),ut(W,Ae,jt,rt),Ht[mn]!=0?_e(We,rt,Yt[jt],sn[jt],jt):De(We,jt)}Ht[0]+Ht[1]==2&&W.mode==n.JOINT_STEREO&&ze(Yt,sn,We.mld_cb_l,We.ATH.cb_l,W.ATHlower*We.ATH.adjust,W.msfix,We.npart_l);for(var jt=0;jt<_n;jt++){var mn=jt&1;Ht[mn]!=0&&q(We,Yt[jt],sn[jt],jt)}}{for(var Rn=0;Rn<3;Rn++){for(var jt=0;jt<_n;++jt){var mn=jt&1;Ht[mn]!=0?Be(We,jt,Rn):(Fe=at,qe(W,le,Se,jt,Rn,it,Fe,mn),ue(W,it,Yt[jt],sn[jt],jt,Rn))}Ht[0]+Ht[1]==0&&W.mode==n.JOINT_STEREO&&ze(Yt,sn,We.mld_cb_s,We.ATH.cb_s,W.ATHlower*We.ATH.adjust,W.msfix,We.npart_s);for(var jt=0;jt<_n;++jt){var mn=jt&1;Ht[mn]==0&&Q(We,Yt[jt],sn[jt],jt,Rn)}}for(var jt=0;jt<_n;jt++){var mn=jt&1;if(Ht[mn]==0)for(var Un=0;Un<zt.SBMAX_s;Un++){for(var qi=tc(3),Rn=0;Rn<3;Rn++){var oi=We.thm[jt].s[Un][Rn];if(oi*=u,_t[jt][Rn]>=2||_t[jt][Rn+1]==1){var _i=Rn!=0?Rn-1:2,ys=ne(We.thm[jt].s[Un][_i],oi,h*Ut);oi=Math.min(oi,ys)}else if(_t[jt][Rn]==1){var _i=Rn!=0?Rn-1:2,ys=ne(We.thm[jt].s[Un][_i],oi,f*Ut);oi=Math.min(oi,ys)}else if(Rn!=0&&_t[jt][Rn-1]==3||Rn==0&&We.nsPsy.lastAttacks[jt]==3){var _i=Rn!=2?Rn+1:0,ys=ne(We.thm[jt].s[Un][_i],oi,f*Ut);oi=Math.min(oi,ys)}oi*=Rt[jt][Rn],qi[Rn]=oi}for(var Rn=0;Rn<3;Rn++)We.thm[jt].s[Un][Rn]=qi[Rn]}}}for(var jt=0;jt<_n;jt++)We.nsPsy.lastAttacks[jt]=_t[jt][2];pe(W,Ht,je);for(var jt=0;jt<_n;jt++){var Is,Ui,us,hs;jt>1?(Is=Me,Ui=-2,us=zt.NORM_TYPE,(je[0]==zt.SHORT_TYPE||je[1]==zt.SHORT_TYPE)&&(us=zt.SHORT_TYPE),hs=ve[Ae][jt-2]):(Is=Xe,Ui=0,us=je[jt],hs=ye[Ae][jt]),us==zt.SHORT_TYPE?Is[Ui+jt]=ae(hs,We.masking_lower):Is[Ui+jt]=Ie(hs,We.masking_lower),W.analysis&&(We.pinfo.pe[Ae][jt]=Is[Ui+jt])}return 0};function Ze(W,le){var Se=W,Ae;return Se>=0?Ae=-Se*27:Ae=Se*le,Ae<=-72?0:Math.exp(Ae*_)}function Je(W){var le=0,Se=0;{var Ae=0,ye,ve;for(Ae=0;Ze(Ae,W)>1e-20;Ae-=1);for(ye=Ae,ve=0;Math.abs(ve-ye)>1e-12;)Ae=(ve+ye)/2,Ze(Ae,W)>0?ve=Ae:ye=Ae;le=ye}{var Ae=0,ye,ve;for(Ae=0;Ze(Ae,W)>1e-20;Ae+=1);for(ye=0,ve=Ae;Math.abs(ve-ye)>1e-12;)Ae=(ve+ye)/2,Ze(Ae,W)>0?ye=Ae:ve=Ae;Se=ve}{var Xe=0,Me=1e3,Ve;for(Ve=0;Ve<=Me;++Ve){var Ae=le+Ve*(Se-le)/Me,je=Ze(Ae,W);Xe+=je}{var We=(Me+1)/(Xe*(Se-le));return We}}}function nt(W){var le,Se,Ae,ye;return le=W,le>=0?le*=3:le*=1.5,le>=.5&&le<=2.5?(ye=le-.5,Se=8*(ye*ye-2*ye)):Se=0,le+=.474,Ae=15.811389+7.5*le-17.5*Math.sqrt(1+le*le),Ae<=-60?0:(le=Math.exp((Se+Ae)*_),le/=.6609193,le)}function Pt(W){return W<0&&(W=0),W=W*.001,13*Math.atan(.76*W)+3.5*Math.atan(W*W/(7.5*7.5))}function vt(W,le,Se,Ae,ye,ve,Xe,Me,Ve,je,We,ct){var Fe=tc(zt.CBANDS+1),rt=Me/(ct>15?2*576:384),it=p1(zt.HBLKSIZE),St;Me/=Ve;var at=0,Yt=0;for(St=0;St<zt.CBANDS;St++){var sn,Rt;for(sn=Pt(Me*at),Fe[St]=Me*at,Rt=at;Pt(Me*Rt)-sn<a&&Rt<=Ve/2;Rt++);for(W[St]=Rt-at,Yt=St+1;at<Rt;)Gr(at<zt.HBLKSIZE),it[at++]=St;if(at>Ve/2){at=Ve/2,++St;break}}Gr(St<zt.CBANDS),Fe[St]=Me*at;for(var Ut=0;Ut<ct;Ut++){var _t,Ht,_n,jt,mn;_n=je[Ut],jt=je[Ut+1],_t=0|Math.floor(.5+We*(_n-.5)),_t<0&&(_t=0),Ht=0|Math.floor(.5+We*(jt-.5)),Ht>Ve/2&&(Ht=Ve/2),Se[Ut]=(it[_t]+it[Ht])/2,le[Ut]=it[Ht];var Rn=rt*jt;Xe[Ut]=(Rn-Fe[le[Ut]])/(Fe[le[Ut]+1]-Fe[le[Ut]]),Xe[Ut]<0?Xe[Ut]=0:Xe[Ut]>1&&(Xe[Ut]=1),mn=Pt(Me*je[Ut]*We),mn=Math.min(mn,15.5)/15.5,ve[Ut]=Math.pow(10,1.25*(1-Math.cos(Math.PI*mn))-2.5)}at=0;for(var Un=0;Un<Yt;Un++){var qi=W[Un],sn,oi;sn=Pt(Me*at),oi=Pt(Me*(at+qi-1)),Ae[Un]=.5*(sn+oi),sn=Pt(Me*(at-.5)),oi=Pt(Me*(at+qi-.5)),ye[Un]=oi-sn,at+=qi}return Yt}function At(W,le,Se,Ae,ye,ve){var Xe=cd([zt.CBANDS,zt.CBANDS]),Me,Ve=0;if(ve)for(var je=0;je<le;je++)for(Me=0;Me<le;Me++){var We=nt(Se[je]-Se[Me])*Ae[Me];Xe[je][Me]=We*ye[je]}else for(Me=0;Me<le;Me++)for(var ct=15+Math.min(21/Se[Me],12),Fe=Je(ct),je=0;je<le;je++){var We=Fe*Ze(Se[je]-Se[Me],ct)*Ae[Me];Xe[je][Me]=We*ye[je]}for(var je=0;je<le;je++){for(Me=0;Me<le&&!(Xe[je][Me]>0);Me++);for(W[je][0]=Me,Me=le-1;Me>0&&!(Xe[je][Me]>0);Me--);W[je][1]=Me,Ve+=W[je][1]-W[je][0]+1}for(var rt=tc(Ve),it=0,je=0;je<le;je++)for(Me=W[je][0];Me<=W[je][1];Me++)rt[it++]=Xe[je][Me];return rt}function Re(W){var le=Pt(W);return le=Math.min(le,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*le))-2.5)}this.psymodel_init=function(W){var le=W.internal_flags,Se,Ae=!0,ye=13,ve=24,Xe=0,Me=0,Ve=-8.25,je=-4.5,We=tc(zt.CBANDS),ct=tc(zt.CBANDS),Fe=tc(zt.CBANDS),rt=W.out_samplerate;switch(W.experimentalZ){default:case 0:Ae=!0;break;case 1:Ae=!(W.VBR==eE.vbr_mtrh||W.VBR==eE.vbr_mt);break;case 2:Ae=!1;break;case 3:ye=8,Xe=-1.75,Me=-.0125,Ve=-8.25,je=-2.25;break}for(le.ms_ener_ratio_old=.25,le.blocktype_old[0]=le.blocktype_old[1]=zt.NORM_TYPE,Se=0;Se<4;++Se){for(var at=0;at<zt.CBANDS;++at)le.nb_1[Se][at]=1e20,le.nb_2[Se][at]=1e20,le.nb_s1[Se][at]=le.nb_s2[Se][at]=1;for(var it=0;it<zt.SBMAX_l;it++)le.en[Se].l[it]=1e20,le.thm[Se].l[it]=1e20;for(var at=0;at<3;++at){for(var it=0;it<zt.SBMAX_s;it++)le.en[Se].s[it][at]=1e20,le.thm[Se].s[it][at]=1e20;le.nsPsy.lastAttacks[Se]=0}for(var at=0;at<9;at++)le.nsPsy.last_en_subshort[Se][at]=10}for(le.loudness_sq_save[0]=le.loudness_sq_save[1]=0,le.npart_l=vt(le.numlines_l,le.bo_l,le.bm_l,We,ct,le.mld_l,le.PSY.bo_l_weight,rt,zt.BLKSIZE,le.scalefac_band.l,zt.BLKSIZE/(2*576),zt.SBMAX_l),Gr(le.npart_l<zt.CBANDS),Se=0;Se<le.npart_l;Se++){var St=Xe;We[Se]>=ye&&(St=Me*(We[Se]-ye)/(ve-ye)+Xe*(ve-We[Se])/(ve-ye)),Fe[Se]=Math.pow(10,St/10),le.numlines_l[Se]>0?le.rnumlines_l[Se]=1/le.numlines_l[Se]:le.rnumlines_l[Se]=0}le.s3_ll=At(le.s3ind,le.npart_l,We,ct,Fe,Ae);var at=0;for(Se=0;Se<le.npart_l;Se++){var Yt;Yt=vV.MAX_VALUE;for(var sn=0;sn<le.numlines_l[Se];sn++,at++){var Rt=rt*at/(1e3*zt.BLKSIZE),Ut;Ut=this.ATHformula(Rt*1e3,W)-20,Ut=Math.pow(10,.1*Ut),Ut*=le.numlines_l[Se],Yt>Ut&&(Yt=Ut)}le.ATH.cb_l[Se]=Yt,Yt=-20+We[Se]*20/10,Yt>6&&(Yt=100),Yt<-15&&(Yt=-15),Yt-=8,le.minval_l[Se]=Math.pow(10,Yt/10)*le.numlines_l[Se]}for(le.npart_s=vt(le.numlines_s,le.bo_s,le.bm_s,We,ct,le.mld_s,le.PSY.bo_s_weight,rt,zt.BLKSIZE_s,le.scalefac_band.s,zt.BLKSIZE_s/384,zt.SBMAX_s),Gr(le.npart_s<zt.CBANDS),at=0,Se=0;Se<le.npart_s;Se++){var Yt,St=Ve;We[Se]>=ye&&(St=je*(We[Se]-ye)/(ve-ye)+Ve*(ve-We[Se])/(ve-ye)),Fe[Se]=Math.pow(10,St/10),Yt=vV.MAX_VALUE;for(var sn=0;sn<le.numlines_s[Se];sn++,at++){var Rt=rt*at/(1e3*zt.BLKSIZE_s),Ut;Ut=this.ATHformula(Rt*1e3,W)-20,Ut=Math.pow(10,.1*Ut),Ut*=le.numlines_s[Se],Yt>Ut&&(Yt=Ut)}le.ATH.cb_s[Se]=Yt,Yt=-7+We[Se]*7/12,We[Se]>12&&(Yt*=1+Math.log(1+Yt)*3.1),We[Se]<12&&(Yt*=1+Math.log(1-Yt)*2.3),Yt<-15&&(Yt=-15),Yt-=8,le.minval_s[Se]=Math.pow(10,Yt/10)*le.numlines_s[Se]}le.s3_ss=At(le.s3ind_s,le.npart_s,We,ct,Fe,Ae),B(),e.init_fft(le),le.decay=Math.exp(-1*t/(l*rt/192));{var _t;_t=d,W.exp_nspsytune&2&&(_t=1),Math.abs(W.msfix)>0&&(_t=W.msfix),W.msfix=_t;for(var Ht=0;Ht<le.npart_l;Ht++)le.s3ind[Ht][1]>le.npart_l-1&&(le.s3ind[Ht][1]=le.npart_l-1)}var _n=576*le.mode_gr/rt;if(le.ATH.decay=Math.pow(10,-12/10*_n),le.ATH.adjust=.01,le.ATH.adjustLimit=1,Gr(le.bo_l[zt.SBMAX_l-1]<=le.npart_l),Gr(le.bo_s[zt.SBMAX_s-1]<=le.npart_s),W.ATHtype!=-1){var Rt,jt=W.out_samplerate/zt.BLKSIZE,mn=0;for(Rt=0,Se=0;Se<zt.BLKSIZE/2;++Se)Rt+=jt,le.ATH.eql_w[Se]=1/Math.pow(10,this.ATHformula(Rt,W)/10),mn+=le.ATH.eql_w[Se];for(mn=1/mn,Se=zt.BLKSIZE/2;--Se>=0;)le.ATH.eql_w[Se]*=mn}{for(var Ht=at=0;Ht<le.npart_s;++Ht)for(Se=0;Se<le.numlines_s[Ht];++Se)++at;for(var Ht=at=0;Ht<le.npart_l;++Ht)for(Se=0;Se<le.numlines_l[Ht];++Se)++at}for(at=0,Se=0;Se<le.npart_l;Se++){var Rt=rt*(at+le.numlines_l[Se]/2)/(1*zt.BLKSIZE);le.mld_cb_l[Se]=Re(Rt),at+=le.numlines_l[Se]}for(;Se<zt.CBANDS;++Se)le.mld_cb_l[Se]=1;for(at=0,Se=0;Se<le.npart_s;Se++){var Rt=rt*(at+le.numlines_s[Se]/2)/(1*zt.BLKSIZE_s);le.mld_cb_s[Se]=Re(Rt),at+=le.numlines_s[Se]}for(;Se<zt.CBANDS;++Se)le.mld_cb_s[Se]=1;return 0};function ce(W,le){W<-.3&&(W=3410),W/=1e3,W=Math.max(.1,W);var Se=3.64*Math.pow(W,-.8)-6.8*Math.exp(-.6*Math.pow(W-3.4,2))+6*Math.exp(-.15*Math.pow(W-8.7,2))+(.6+.04*le)*.001*Math.pow(W,4);return Se}this.ATHformula=function(W,le){var Se;switch(le.ATHtype){case 0:Se=ce(W,9);break;case 1:Se=ce(W,-1);break;case 2:Se=ce(W,0);break;case 3:Se=ce(W,1)+6;break;case 4:Se=ce(W,le.ATHcurve);break;default:Se=ce(W,0);break}return Se}}var l7e=c7e,u7e=PR;function h7e(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=u7e.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var f7e=h7e,d7e=gu(),wne={};wne.SFBMAX=d7e.SBMAX_s*3;var h3=wne,Ane=Lo,p7e=Ane.new_float,m1=Ane.new_int,SP=h3;function m7e(){this.xr=p7e(576),this.l3_enc=m1(576),this.scalefac=m1(SP.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=m1(3),this.subblock_gain=m1(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=m1(SP.SFBMAX),this.window=m1(SP.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=m1(4),this.max_nonzero_coeff=0;var n=this;function e(r){return new Int32Array(r)}function t(r){return new Float32Array(r)}this.assign=function(r){n.xr=t(r.xr),n.l3_enc=e(r.l3_enc),n.scalefac=e(r.scalefac),n.xrpow_max=r.xrpow_max,n.part2_3_length=r.part2_3_length,n.big_values=r.big_values,n.count1=r.count1,n.global_gain=r.global_gain,n.scalefac_compress=r.scalefac_compress,n.block_type=r.block_type,n.mixed_block_flag=r.mixed_block_flag,n.table_select=e(r.table_select),n.subblock_gain=e(r.subblock_gain),n.region0_count=r.region0_count,n.region1_count=r.region1_count,n.preflag=r.preflag,n.scalefac_scale=r.scalefac_scale,n.count1table_select=r.count1table_select,n.part2_length=r.part2_length,n.sfb_lmax=r.sfb_lmax,n.sfb_smin=r.sfb_smin,n.psy_lmax=r.psy_lmax,n.sfbmax=r.sfbmax,n.psymax=r.psymax,n.sfbdivide=r.sfbdivide,n.width=e(r.width),n.window=e(r.window),n.count1bits=r.count1bits,n.sfb_partition_table=r.sfb_partition_table.slice(0),n.slen=e(r.slen),n.max_nonzero_coeff=r.max_nonzero_coeff}}var R8=m7e,g7e=Lo,yV=g7e.new_int,_7e=R8;function v7e(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[yV(4),yV(4)];for(var n=0;n<2;n++)for(var e=0;e<2;e++)this.tt[n][e]=new _7e}var y7e=v7e,Rne=Lo,q2=Rne.System,Y2=Rne.new_int,K2=gu();function b7e(n,e,t,r){this.l=Y2(1+K2.SBMAX_l),this.s=Y2(1+K2.SBMAX_s),this.psfb21=Y2(1+K2.PSFB21),this.psfb12=Y2(1+K2.PSFB12);var i=this.l,s=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],q2.arraycopy(this.arrL,0,i,0,Math.min(this.arrL.length,this.l.length)),q2.arraycopy(this.arrS,0,s,0,Math.min(this.arrS.length,this.s.length)),q2.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),q2.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var Cne=b7e,C8=Lo,EP=C8.new_float,S7e=C8.new_float_n,E7e=C8.new_int,bV=gu();function x7e(){this.last_en_subshort=S7e([4,9]),this.lastAttacks=E7e(4),this.pefirbuf=EP(19),this.longfact=EP(bV.SBMAX_l),this.shortfact=EP(bV.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var T7e=x7e;function w7e(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var A7e=w7e,iT=Lo,R7e=iT.new_byte,C7e=iT.new_double,ld=iT.new_float,g1=iT.new_float_n,op=iT.new_int,X2=iT.new_int_n,M7e=y7e,k7e=Cne,O7e=T7e,I7e=A7e,SV=xne(),ma=gu(),N7e=h3;Jg.MFSIZE=3*1152+ma.ENCDELAY-ma.MDCTDELAY;Jg.MAX_HEADER_BUF=256;Jg.MAX_BITS_PER_CHANNEL=4095;Jg.MAX_BITS_PER_GRANULE=7680;Jg.BPC=320;function Jg(){var n=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=g1([2,Jg.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new M7e,this.ms_ratio=ld(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=op(2),this.CurrentStep=op(2),this.masking_lower=0,this.bv_scf=op(576),this.pseudohalf=op(N7e.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*Jg.BPC+1),this.itime=C7e(2),this.sideinfo_len=0,this.sb_sample=g1([2,2,18,ma.SBLIMIT]),this.amp_filter=ld(32);function e(){this.write_timing=0,this.ptr=0,this.buf=R7e(n)}this.header=new Array(Jg.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new k7e,this.minval_l=ld(ma.CBANDS),this.minval_s=ld(ma.CBANDS),this.nb_1=g1([4,ma.CBANDS]),this.nb_2=g1([4,ma.CBANDS]),this.nb_s1=g1([4,ma.CBANDS]),this.nb_s2=g1([4,ma.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=ld(4),this.loudness_sq=g1([2,2]),this.loudness_sq_save=ld(2),this.mld_l=ld(ma.SBMAX_l),this.mld_s=ld(ma.SBMAX_s),this.bm_l=op(ma.SBMAX_l),this.bo_l=op(ma.SBMAX_l),this.bm_s=op(ma.SBMAX_s),this.bo_s=op(ma.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=X2([ma.CBANDS,2]),this.s3ind_s=X2([ma.CBANDS,2]),this.numlines_s=op(ma.CBANDS),this.numlines_l=op(ma.CBANDS),this.rnumlines_l=ld(ma.CBANDS),this.mld_cb_l=ld(ma.CBANDS),this.mld_cb_s=ld(ma.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=ld(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=op(2),this.nsPsy=new O7e,this.VBR_seek_table=new I7e,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=X2([16,5]),this.bitrate_blockType_Hist=X2([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var t=0;t<this.en.length;t++)this.en[t]=new SV;for(var t=0;t<this.thm.length;t++)this.thm[t]=new SV;for(var t=0;t<this.header.length;t++)this.header[t]=new e}var f3=Jg,P7e=Lo,_1=P7e.new_float,v1=gu();function D7e(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=_1(v1.SBMAX_l),this.s=_1(v1.SBMAX_s),this.psfb21=_1(v1.PSFB21),this.psfb12=_1(v1.PSFB12),this.cb_l=_1(v1.CBANDS),this.cb_s=_1(v1.CBANDS),this.eql_w=_1(v1.BLKSIZE/2)}var L7e=D7e,Mne=Lo,yh=Mne.System,EV=Mne.Arrays;xa.STEPS_per_dB=100;xa.MAX_dB=120;xa.GAIN_NOT_ENOUGH_SAMPLES=-24601;xa.GAIN_ANALYSIS_ERROR=0;xa.GAIN_ANALYSIS_OK=1;xa.INIT_GAIN_ANALYSIS_ERROR=0;xa.INIT_GAIN_ANALYSIS_OK=1;xa.YULE_ORDER=10;xa.MAX_ORDER=xa.YULE_ORDER;xa.MAX_SAMP_FREQ=48e3;xa.RMS_WINDOW_TIME_NUMERATOR=1;xa.RMS_WINDOW_TIME_DENOMINATOR=20;xa.MAX_SAMPLES_PER_WINDOW=xa.MAX_SAMP_FREQ*xa.RMS_WINDOW_TIME_NUMERATOR/xa.RMS_WINDOW_TIME_DENOMINATOR+1;function xa(){var n=64.82,e=.95,t=xa.RMS_WINDOW_TIME_NUMERATOR,r=xa.RMS_WINDOW_TIME_DENOMINATOR,i=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function o(h,f,d,p,_,g){for(;_--!=0;)d[p]=1e-10+h[f+0]*g[0]-d[p-1]*g[1]+h[f-1]*g[2]-d[p-2]*g[3]+h[f-2]*g[4]-d[p-3]*g[5]+h[f-3]*g[6]-d[p-4]*g[7]+h[f-4]*g[8]-d[p-5]*g[9]+h[f-5]*g[10]-d[p-6]*g[11]+h[f-6]*g[12]-d[p-7]*g[13]+h[f-7]*g[14]-d[p-8]*g[15]+h[f-8]*g[16]-d[p-9]*g[17]+h[f-9]*g[18]-d[p-10]*g[19]+h[f-10]*g[20],++p,++f}function a(h,f,d,p,_,g){for(;_--!=0;)d[p]=h[f+0]*g[0]-d[p-1]*g[1]+h[f-1]*g[2]-d[p-2]*g[3]+h[f-2]*g[4],++p,++f}function c(h,f){for(var d=0;d<MAX_ORDER;d++)h.linprebuf[d]=h.lstepbuf[d]=h.loutbuf[d]=h.rinprebuf[d]=h.rstepbuf[d]=h.routbuf[d]=0;switch(0|f){case 48e3:h.reqindex=0;break;case 44100:h.reqindex=1;break;case 32e3:h.reqindex=2;break;case 24e3:h.reqindex=3;break;case 22050:h.reqindex=4;break;case 16e3:h.reqindex=5;break;case 12e3:h.reqindex=6;break;case 11025:h.reqindex=7;break;case 8e3:h.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return h.sampleWindow=0|(f*t+r-1)/r,h.lsum=0,h.rsum=0,h.totsamp=0,EV.ill(h.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(h,f){return c(h,f)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(h.linpre=MAX_ORDER,h.rinpre=MAX_ORDER,h.lstep=MAX_ORDER,h.rstep=MAX_ORDER,h.lout=MAX_ORDER,h.rout=MAX_ORDER,EV.fill(h.B,0),INIT_GAIN_ANALYSIS_OK)};function l(h){return h*h}this.AnalyzeSamples=function(h,f,d,p,_,g,m){var b,y,x,T,k,R,P;if(g==0)return GAIN_ANALYSIS_OK;switch(P=0,k=g,m){case 1:p=f,_=d;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(g<MAX_ORDER?(yh.arraycopy(f,d,h.linprebuf,MAX_ORDER,g),yh.arraycopy(p,_,h.rinprebuf,MAX_ORDER,g)):(yh.arraycopy(f,d,h.linprebuf,MAX_ORDER,MAX_ORDER),yh.arraycopy(p,_,h.rinprebuf,MAX_ORDER,MAX_ORDER));k>0;){R=k>h.sampleWindow-h.totsamp?h.sampleWindow-h.totsamp:k,P<MAX_ORDER?(b=h.linpre+P,y=h.linprebuf,x=h.rinpre+P,T=h.rinprebuf,R>MAX_ORDER-P&&(R=MAX_ORDER-P)):(b=d+P,y=f,x=_+P,T=p),o(y,b,h.lstepbuf,h.lstep+h.totsamp,R,i[h.reqindex]),o(T,x,h.rstepbuf,h.rstep+h.totsamp,R,i[h.reqindex]),a(h.lstepbuf,h.lstep+h.totsamp,h.loutbuf,h.lout+h.totsamp,R,s[h.reqindex]),a(h.rstepbuf,h.rstep+h.totsamp,h.routbuf,h.rout+h.totsamp,R,s[h.reqindex]),b=h.lout+h.totsamp,y=h.loutbuf,x=h.rout+h.totsamp,T=h.routbuf;for(var B=R%8;B--!=0;)h.lsum+=l(y[b++]),h.rsum+=l(T[x++]);for(B=R/8;B--!=0;)h.lsum+=l(y[b+0])+l(y[b+1])+l(y[b+2])+l(y[b+3])+l(y[b+4])+l(y[b+5])+l(y[b+6])+l(y[b+7]),b+=8,h.rsum+=l(T[x+0])+l(T[x+1])+l(T[x+2])+l(T[x+3])+l(T[x+4])+l(T[x+5])+l(T[x+6])+l(T[x+7]),x+=8;if(k-=R,P+=R,h.totsamp+=R,h.totsamp==h.sampleWindow){var U=xa.STEPS_per_dB*10*Math.log10((h.lsum+h.rsum)/h.totsamp*.5+1e-37),z=U<=0?0:0|U;z>=h.A.length&&(z=h.A.length-1),h.A[z]++,h.lsum=h.rsum=0,yh.arraycopy(h.loutbuf,h.totsamp,h.loutbuf,0,MAX_ORDER),yh.arraycopy(h.routbuf,h.totsamp,h.routbuf,0,MAX_ORDER),yh.arraycopy(h.lstepbuf,h.totsamp,h.lstepbuf,0,MAX_ORDER),yh.arraycopy(h.rstepbuf,h.totsamp,h.rstepbuf,0,MAX_ORDER),h.totsamp=0}if(h.totsamp>h.sampleWindow)return GAIN_ANALYSIS_ERROR}return g<MAX_ORDER?(yh.arraycopy(h.linprebuf,g,h.linprebuf,0,MAX_ORDER-g),yh.arraycopy(h.rinprebuf,g,h.rinprebuf,0,MAX_ORDER-g),yh.arraycopy(f,d,h.linprebuf,MAX_ORDER-g,g),yh.arraycopy(p,_,h.rinprebuf,MAX_ORDER-g,g)):(yh.arraycopy(f,d+g-MAX_ORDER,h.linprebuf,0,MAX_ORDER),yh.arraycopy(p,_+g-MAX_ORDER,h.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function u(h,f){var d,p=0;for(d=0;d<f;d++)p+=h[d];if(p==0)return GAIN_NOT_ENOUGH_SAMPLES;var _=0|Math.ceil(p*(1-e));for(d=f;d-- >0&&!((_-=h[d])<=0););return n-d/xa.STEPS_per_dB}this.GetTitleGain=function(h){for(var f=u(h.A,h.A.length),d=0;d<h.A.length;d++)h.B[d]+=h.A[d],h.A[d]=0;for(var d=0;d<MAX_ORDER;d++)h.linprebuf[d]=h.lstepbuf[d]=h.loutbuf[d]=h.rinprebuf[d]=h.rstepbuf[d]=h.routbuf[d]=0;return h.totsamp=0,h.lsum=h.rsum=0,f}}var kne=xa,One=Lo,nE=One.new_float,xV=One.new_int,bh=kne;function U7e(){this.linprebuf=nE(bh.MAX_ORDER*2),this.linpre=0,this.lstepbuf=nE(bh.MAX_SAMPLES_PER_WINDOW+bh.MAX_ORDER),this.lstep=0,this.loutbuf=nE(bh.MAX_SAMPLES_PER_WINDOW+bh.MAX_ORDER),this.lout=0,this.rinprebuf=nE(bh.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=nE(bh.MAX_SAMPLES_PER_WINDOW+bh.MAX_ORDER),this.rstep=0,this.routbuf=nE(bh.MAX_SAMPLES_PER_WINDOW+bh.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=xV(0|bh.STEPS_per_dB*bh.MAX_dB),this.B=xV(0|bh.STEPS_per_dB*bh.MAX_dB)}var B7e=U7e;function F7e(n){this.bits=n}var Ine=F7e,M8=Lo,TV=M8.new_float,j7e=M8.new_int,wV=M8.assert,z7e=Ine,AV=gu(),H7e=h3,V7e=f3;function G7e(n){var e=n;this.quantize=e,this.iteration_loop=function(t,r,i,s){var o=t.internal_flags,a=TV(H7e.SFBMAX),c=TV(576),l=j7e(2),u=0,h,f=o.l3_side,d=new z7e(u);this.quantize.rv.ResvFrameBegin(t,d),u=d.bits;for(var p=0;p<o.mode_gr;p++){h=this.quantize.qupvt.on_pe(t,r,l,u,p,p),o.mode_ext==AV.MPG_MD_MS_LR&&(this.quantize.ms_convert(o.l3_side,p),this.quantize.qupvt.reduce_side(l,i[p],u,h));for(var _=0;_<o.channels_out;_++){var g,m,b=f.tt[p][_];b.block_type!=AV.SHORT_TYPE?(g=0,m=o.PSY.mask_adjust-g):(g=0,m=o.PSY.mask_adjust_short-g),o.masking_lower=Math.pow(10,m*.1),this.quantize.init_outer_loop(o,b),this.quantize.init_xrpow(o,b,c)&&(this.quantize.qupvt.calc_xmin(t,s[p][_],b,a),this.quantize.outer_loop(t,b,a,c,_,l[_])),this.quantize.iteration_finish_one(o,p,_),wV(b.part2_3_length<=V7e.MAX_BITS_PER_CHANNEL),wV(b.part2_3_length<=l[_])}}this.quantize.rv.ResvFrameEnd(o,u)}}var $7e=G7e;function Pi(n,e,t,r){this.xlen=n,this.linmax=e,this.table=t,this.hlen=r}var nn={};nn.t1HB=[1,1,1,0];nn.t2HB=[1,2,1,3,1,1,3,2,0];nn.t3HB=[3,2,1,1,1,1,3,2,0];nn.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];nn.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];nn.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];nn.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];nn.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];nn.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];nn.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];nn.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];nn.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];nn.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];nn.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];nn.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];nn.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];nn.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];nn.t1l=[1,4,3,5];nn.t2l=[1,4,7,4,5,7,6,7,8];nn.t3l=[2,3,7,4,4,7,6,7,8];nn.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];nn.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];nn.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];nn.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];nn.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];nn.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];nn.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];nn.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];nn.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];nn.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];nn.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];nn.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];nn.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];nn.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10];nn.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8];nn.ht=[new Pi(0,0,null,null),new Pi(2,0,nn.t1HB,nn.t1l),new Pi(3,0,nn.t2HB,nn.t2l),new Pi(3,0,nn.t3HB,nn.t3l),new Pi(0,0,null,null),new Pi(4,0,nn.t5HB,nn.t5l),new Pi(4,0,nn.t6HB,nn.t6l),new Pi(6,0,nn.t7HB,nn.t7l),new Pi(6,0,nn.t8HB,nn.t8l),new Pi(6,0,nn.t9HB,nn.t9l),new Pi(8,0,nn.t10HB,nn.t10l),new Pi(8,0,nn.t11HB,nn.t11l),new Pi(8,0,nn.t12HB,nn.t12l),new Pi(16,0,nn.t13HB,nn.t13l),new Pi(0,0,null,nn.t16_5l),new Pi(16,0,nn.t15HB,nn.t15l),new Pi(1,1,nn.t16HB,nn.t16l),new Pi(2,3,nn.t16HB,nn.t16l),new Pi(3,7,nn.t16HB,nn.t16l),new Pi(4,15,nn.t16HB,nn.t16l),new Pi(6,63,nn.t16HB,nn.t16l),new Pi(8,255,nn.t16HB,nn.t16l),new Pi(10,1023,nn.t16HB,nn.t16l),new Pi(13,8191,nn.t16HB,nn.t16l),new Pi(4,15,nn.t24HB,nn.t24l),new Pi(5,31,nn.t24HB,nn.t24l),new Pi(6,63,nn.t24HB,nn.t24l),new Pi(7,127,nn.t24HB,nn.t24l),new Pi(8,255,nn.t24HB,nn.t24l),new Pi(9,511,nn.t24HB,nn.t24l),new Pi(11,2047,nn.t24HB,nn.t24l),new Pi(13,8191,nn.t24HB,nn.t24l),new Pi(0,0,nn.t32HB,nn.t32l),new Pi(0,0,nn.t33HB,nn.t33l)];nn.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];nn.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];nn.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];nn.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];nn.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]];nn.scfsi_band=[0,6,11,16,21];var k8=nn,xP,RV;function Nne(){if(RV)return xP;RV=1;var n=Cne,e=Lo,t=e.VbrMode,r=e.Float,i=e.Util,s=e.new_float,o=e.new_int,a=e.assert,c=gu(),l=Ine,u=f3;h.Q_MAX=257,h.Q_MAX2=116,h.LARGE_BITS=1e5,h.IXMAX_VAL=8206;function h(){var f=O8(),d=null,p=null,_=null;this.setModules=function(F,Z,$){d=F,p=Z,_=$};function g(F){return a(0<=F+h.Q_MAX2&&F<h.Q_MAX),P[F+h.Q_MAX2]}this.IPOW20=function(F){return a(0<=F&&F<h.Q_MAX),B[F]};var m=2220446049250313e-31,b=h.IXMAX_VAL,y=b+2,x=h.Q_MAX,T=h.Q_MAX2;h.LARGE_BITS;var k=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var R=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=R,this.sfBandIndex=[new n([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var P=s(x+T+1),B=s(x),U=s(y),z=s(y);this.adj43=z;function I(F,Z){var $=_.ATHformula(Z,F);return $-=k,$=Math.pow(10,$/10+F.ATHlower),$}function L(F){for(var Z=F.internal_flags.ATH.l,$=F.internal_flags.ATH.psfb21,Y=F.internal_flags.ATH.s,Q=F.internal_flags.ATH.psfb12,q=F.internal_flags,V=F.out_samplerate,K=0;K<c.SBMAX_l;K++){var ne=q.scalefac_band.l[K],ie=q.scalefac_band.l[K+1];Z[K]=r.MAX_VALUE;for(var ae=ne;ae<ie;ae++){var Te=ae*V/1152,Ie=I(F,Te);Z[K]=Math.min(Z[K],Ie)}}for(var K=0;K<c.PSFB21;K++){var ne=q.scalefac_band.psfb21[K],ie=q.scalefac_band.psfb21[K+1];$[K]=r.MAX_VALUE;for(var ae=ne;ae<ie;ae++){var Te=ae*V/1152,Ie=I(F,Te);$[K]=Math.min($[K],Ie)}}for(var K=0;K<c.SBMAX_s;K++){var ne=q.scalefac_band.s[K],ie=q.scalefac_band.s[K+1];Y[K]=r.MAX_VALUE;for(var ae=ne;ae<ie;ae++){var Te=ae*V/384,Ie=I(F,Te);Y[K]=Math.min(Y[K],Ie)}Y[K]*=q.scalefac_band.s[K+1]-q.scalefac_band.s[K]}for(var K=0;K<c.PSFB12;K++){var ne=q.scalefac_band.psfb12[K],ie=q.scalefac_band.psfb12[K+1];Q[K]=r.MAX_VALUE;for(var ae=ne;ae<ie;ae++){var Te=ae*V/384,Ie=I(F,Te);Q[K]=Math.min(Q[K],Ie)}Q[K]*=q.scalefac_band.s[13]-q.scalefac_band.s[12]}if(F.noATH){for(var K=0;K<c.SBMAX_l;K++)Z[K]=1e-20;for(var K=0;K<c.PSFB21;K++)$[K]=1e-20;for(var K=0;K<c.SBMAX_s;K++)Y[K]=1e-20;for(var K=0;K<c.PSFB12;K++)Q[K]=1e-20}q.ATH.floor=10*Math.log10(I(F,-1))}this.iteration_init=function(F){var Z=F.internal_flags,$=Z.l3_side,Y;if(Z.iteration_init_init==0){for(Z.iteration_init_init=1,$.main_data_begin=0,L(F),U[0]=0,Y=1;Y<y;Y++)U[Y]=Math.pow(Y,4/3);for(Y=0;Y<y-1;Y++)z[Y]=Y+1-Math.pow(.5*(U[Y]+U[Y+1]),.75);for(z[Y]=.5,Y=0;Y<x;Y++)B[Y]=Math.pow(2,(Y-210)*-.1875);for(Y=0;Y<=x+T;Y++)P[Y]=Math.pow(2,(Y-210-T)*.25);d.huffman_init(Z);{var Q,q,V,K;for(Y=F.exp_nspsytune>>2&63,Y>=32&&(Y-=64),Q=Math.pow(10,Y/4/10),Y=F.exp_nspsytune>>8&63,Y>=32&&(Y-=64),q=Math.pow(10,Y/4/10),Y=F.exp_nspsytune>>14&63,Y>=32&&(Y-=64),V=Math.pow(10,Y/4/10),Y=F.exp_nspsytune>>20&63,Y>=32&&(Y-=64),K=V*Math.pow(10,Y/4/10),Y=0;Y<c.SBMAX_l;Y++){var ne;Y<=6?ne=Q:Y<=13?ne=q:Y<=20?ne=V:ne=K,Z.nsPsy.longfact[Y]=ne}for(Y=0;Y<c.SBMAX_s;Y++){var ne;Y<=5?ne=Q:Y<=10?ne=q:Y<=11?ne=V:ne=K,Z.nsPsy.shortfact[Y]=ne}}}},this.on_pe=function(F,Z,$,Y,Q,q){var V=F.internal_flags,K=0,ne,ie=o(2),ae,Te=new l(K),Ie=p.ResvMaxBits(F,Y,Te,q);K=Te.bits;var be=K+Ie;for(be>u.MAX_BITS_PER_GRANULE&&(be=u.MAX_BITS_PER_GRANULE),ne=0,ae=0;ae<V.channels_out;++ae)$[ae]=Math.min(u.MAX_BITS_PER_CHANNEL,K/V.channels_out),ie[ae]=0|$[ae]*Z[Q][ae]/700-$[ae],ie[ae]>Y*3/4&&(ie[ae]=Y*3/4),ie[ae]<0&&(ie[ae]=0),ie[ae]+$[ae]>u.MAX_BITS_PER_CHANNEL&&(ie[ae]=Math.max(0,u.MAX_BITS_PER_CHANNEL-$[ae])),ne+=ie[ae];if(ne>Ie)for(ae=0;ae<V.channels_out;++ae)ie[ae]=Ie*ie[ae]/ne;for(ae=0;ae<V.channels_out;++ae)$[ae]+=ie[ae],Ie-=ie[ae];for(ne=0,ae=0;ae<V.channels_out;++ae)ne+=$[ae];if(ne>u.MAX_BITS_PER_GRANULE){var Pe=0;for(ae=0;ae<V.channels_out;++ae)$[ae]*=u.MAX_BITS_PER_GRANULE,$[ae]/=ne,Pe+=$[ae]}return be},this.reduce_side=function(F,Z,$,Y){a(F[0]+F[1]<=u.MAX_BITS_PER_GRANULE);var Q=.33*(.5-Z)/.5;Q<0&&(Q=0),Q>.5&&(Q=.5);var q=0|Q*.5*(F[0]+F[1]);q>u.MAX_BITS_PER_CHANNEL-F[0]&&(q=u.MAX_BITS_PER_CHANNEL-F[0]),q<0&&(q=0),F[1]>=125&&(F[1]-q>125?(F[0]<$&&(F[0]+=q),F[1]-=q):(F[0]+=F[1]-125,F[1]=125)),q=F[0]+F[1],q>Y&&(F[0]=Y*F[0]/q,F[1]=Y*F[1]/q),a(F[0]<=u.MAX_BITS_PER_CHANNEL),a(F[1]<=u.MAX_BITS_PER_CHANNEL),a(F[0]+F[1]<=u.MAX_BITS_PER_GRANULE)},this.athAdjust=function(F,Z,$){var Y=90.30873362,Q=94.82444863,q=i.FAST_LOG10_X(Z,10),V=F*F,K=0;return q-=$,V>1e-20&&(K=1+i.FAST_LOG10_X(V,10/Y)),K<0&&(K=0),q*=K,q+=$+Y-Q,Math.pow(10,.1*q)},this.calc_xmin=function(F,Z,$,Y){var Q=0,q=F.internal_flags,V,K=0,ne=0,ie=q.ATH,ae=$.xr,Te=F.VBR==t.vbr_mtrh?1:0,Ie=q.masking_lower;for((F.VBR==t.vbr_mtrh||F.VBR==t.vbr_mt)&&(Ie=1),V=0;V<$.psy_lmax;V++){var be,Pe,$e,tt,qe,ut;F.VBR==t.vbr_rh||F.VBR==t.vbr_mtrh?Pe=athAdjust(ie.adjust,ie.l[V],ie.floor):Pe=ie.adjust*ie.l[V],qe=$.width[V],$e=Pe/qe,tt=m,ut=qe>>1,be=0;do{var te,Ne;te=ae[K]*ae[K],be+=te,tt+=te<$e?te:$e,K++,Ne=ae[K]*ae[K],be+=Ne,tt+=Ne<$e?Ne:$e,K++}while(--ut>0);if(be>Pe&&ne++,V==c.SBPSY_l){var Be=Pe*q.nsPsy.longfact[V];tt<Be&&(tt=Be)}if(Te!=0&&(Pe=tt),!F.ATHonly){var De=Z.en.l[V];if(De>0){var Be;Be=be*Z.thm.l[V]*Ie/De,Te!=0&&(Be*=q.nsPsy.longfact[V]),Pe<Be&&(Pe=Be)}}Te!=0?Y[Q++]=Pe:Y[Q++]=Pe*q.nsPsy.longfact[V]}var Oe=575;if($.block_type!=c.SHORT_TYPE)for(var ue=576;ue--!=0&&f.EQ(ae[ue],0);)Oe=ue;$.max_nonzero_coeff=Oe;for(var _e=$.sfb_smin;V<$.psymax;_e++,V+=3){var qe,we,pe;for(F.VBR==t.vbr_rh||F.VBR==t.vbr_mtrh?pe=athAdjust(ie.adjust,ie.s[_e],ie.floor):pe=ie.adjust*ie.s[_e],qe=$.width[V],we=0;we<3;we++){var be=0,Pe,$e,tt,ut=qe>>1;$e=pe/qe,tt=m;do{var te,Ne;te=ae[K]*ae[K],be+=te,tt+=te<$e?te:$e,K++,Ne=ae[K]*ae[K],be+=Ne,tt+=Ne<$e?Ne:$e,K++}while(--ut>0);if(be>pe&&ne++,_e==c.SBPSY_s){var Be=pe*q.nsPsy.shortfact[_e];tt<Be&&(tt=Be)}if(Te!=0?Pe=tt:Pe=pe,!F.ATHonly&&!F.ATHshort){var De=Z.en.s[_e][we];if(De>0){var Be;Be=be*Z.thm.s[_e][we]*Ie/De,Te!=0&&(Be*=q.nsPsy.shortfact[_e]),Pe<Be&&(Pe=Be)}}Te!=0?Y[Q++]=Pe:Y[Q++]=Pe*q.nsPsy.shortfact[_e]}F.useTemporal&&(Y[Q-3]>Y[Q-3+1]&&(Y[Q-3+1]+=(Y[Q-3]-Y[Q-3+1])*q.decay),Y[Q-3+1]>Y[Q-3+2]&&(Y[Q-3+2]+=(Y[Q-3+1]-Y[Q-3+2])*q.decay))}return ne};function M(F){this.s=F}this.calc_noise_core=function(F,Z,$,Y){var Q=0,q=Z.s,V=F.l3_enc;if(q>F.count1)for(;$--!=0;){var K;K=F.xr[q],q++,Q+=K*K,K=F.xr[q],q++,Q+=K*K}else if(q>F.big_values){var ne=s(2);for(ne[0]=0,ne[1]=Y;$--!=0;){var K;K=Math.abs(F.xr[q])-ne[V[q]],q++,Q+=K*K,K=Math.abs(F.xr[q])-ne[V[q]],q++,Q+=K*K}}else for(;$--!=0;){var K;K=Math.abs(F.xr[q])-U[V[q]]*Y,q++,Q+=K*K,K=Math.abs(F.xr[q])-U[V[q]]*Y,q++,Q+=K*K}return Z.s=q,Q},this.calc_noise=function(F,Z,$,Y,Q){var q=0,V=0,K,ne,ie=0,ae=0,Te=0,Ie=-20,be=0,Pe=F.scalefac,$e=0;for(Y.over_SSD=0,K=0;K<F.psymax;K++){var tt=F.global_gain-(Pe[$e++]+(F.preflag!=0?R[K]:0)<<F.scalefac_scale+1)-F.subblock_gain[F.window[K]]*8,qe=0;if(Q!=null&&Q.step[K]==tt)qe=Q.noise[K],be+=F.width[K],$[q++]=qe/Z[V++],qe=Q.noise_log[K];else{var ut=g(tt);if(ne=F.width[K]>>1,be+F.width[K]>F.max_nonzero_coeff){var te;te=F.max_nonzero_coeff-be+1,te>0?ne=te>>1:ne=0}var Ne=new M(be);qe=this.calc_noise_core(F,Ne,ne,ut),be=Ne.s,Q!=null&&(Q.step[K]=tt,Q.noise[K]=qe),qe=$[q++]=qe/Z[V++],qe=i.FAST_LOG10(Math.max(qe,1e-20)),Q!=null&&(Q.noise_log[K]=qe)}if(Q!=null&&(Q.global_gain=F.global_gain),Te+=qe,qe>0){var Be;Be=Math.max(0|qe*10+.5,1),Y.over_SSD+=Be*Be,ie++,ae+=qe}Ie=Math.max(Ie,qe)}return Y.over_count=ie,Y.tot_noise=Te,Y.over_noise=ae,Y.max_noise=Ie,ie},this.set_pinfo=function(F,Z,$,Y,Q){var q=F.internal_flags,V,K,ne,ie,ae,Te=Z.scalefac_scale==0?.5:1,Ie=Z.scalefac,be=s(L3Side.SFBMAX),Pe=s(L3Side.SFBMAX),$e=new CalcNoiseResult;calc_xmin(F,$,Z,be),calc_noise(Z,be,Pe,$e,null);var tt=0;for(K=Z.sfb_lmax,Z.block_type!=c.SHORT_TYPE&&Z.mixed_block_flag==0&&(K=22),V=0;V<K;V++){var qe=q.scalefac_band.l[V],ut=q.scalefac_band.l[V+1],te=ut-qe;for(ie=0;tt<ut;tt++)ie+=Z.xr[tt]*Z.xr[tt];ie/=te,ae=1e15,q.pinfo.en[Y][Q][V]=ae*ie,q.pinfo.xfsf[Y][Q][V]=ae*be[V]*Pe[V]/te,$.en.l[V]>0&&!F.ATHonly?ie=ie/$.en.l[V]:ie=0,q.pinfo.thr[Y][Q][V]=ae*Math.max(ie*$.thm.l[V],q.ATH.l[V]),q.pinfo.LAMEsfb[Y][Q][V]=0,Z.preflag!=0&&V>=11&&(q.pinfo.LAMEsfb[Y][Q][V]=-Te*R[V]),V<c.SBPSY_l&&(a(Ie[V]>=0),q.pinfo.LAMEsfb[Y][Q][V]-=Te*Ie[V])}if(Z.block_type==c.SHORT_TYPE)for(K=V,V=Z.sfb_smin;V<c.SBMAX_s;V++)for(var qe=q.scalefac_band.s[V],ut=q.scalefac_band.s[V+1],te=ut-qe,Ne=0;Ne<3;Ne++){for(ie=0,ne=qe;ne<ut;ne++)ie+=Z.xr[tt]*Z.xr[tt],tt++;ie=Math.max(ie/te,1e-20),ae=1e15,q.pinfo.en_s[Y][Q][3*V+Ne]=ae*ie,q.pinfo.xfsf_s[Y][Q][3*V+Ne]=ae*be[K]*Pe[K]/te,$.en.s[V][Ne]>0?ie=ie/$.en.s[V][Ne]:ie=0,(F.ATHonly||F.ATHshort)&&(ie=0),q.pinfo.thr_s[Y][Q][3*V+Ne]=ae*Math.max(ie*$.thm.s[V][Ne],q.ATH.s[V]),q.pinfo.LAMEsfb_s[Y][Q][3*V+Ne]=-2*Z.subblock_gain[Ne],V<c.SBPSY_s&&(q.pinfo.LAMEsfb_s[Y][Q][3*V+Ne]-=Te*Ie[K]),K++}q.pinfo.LAMEqss[Y][Q]=Z.global_gain,q.pinfo.LAMEmainbits[Y][Q]=Z.part2_3_length+Z.part2_length,q.pinfo.LAMEsfbits[Y][Q]=Z.part2_length,q.pinfo.over[Y][Q]=$e.over_count,q.pinfo.max_noise[Y][Q]=$e.max_noise*10,q.pinfo.over_noise[Y][Q]=$e.over_noise*10,q.pinfo.tot_noise[Y][Q]=$e.tot_noise*10,q.pinfo.over_SSD[Y][Q]=$e.over_SSD}}return xP=h,xP}var TP,CV;function Pne(){if(CV)return TP;CV=1;var n=Lo,e=n.System,t=n.Arrays,r=n.new_int,i=n.assert,s=gu(),o=k8,a=R8,c=Nne();function l(){var u=null;this.qupvt=null,this.setModules=function(q){this.qupvt=q,u=q};function h(q){this.bits=0|q}var f=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function d(q,V,K,ne,ie,ae){var Te=.5946/V;for(q=q>>1;q--!=0;)ie[ae++]=Te>K[ne++]?0:1,ie[ae++]=Te>K[ne++]?0:1}function p(q,V,K,ne,ie,ae){q=q>>1;var Te=q%2;for(q=q>>1;q--!=0;){var Ie,be,Pe,$e,tt,qe,ut,te;Ie=K[ne++]*V,be=K[ne++]*V,tt=0|Ie,Pe=K[ne++]*V,qe=0|be,$e=K[ne++]*V,ut=0|Pe,Ie+=u.adj43[tt],te=0|$e,be+=u.adj43[qe],ie[ae++]=0|Ie,Pe+=u.adj43[ut],ie[ae++]=0|be,$e+=u.adj43[te],ie[ae++]=0|Pe,ie[ae++]=0|$e}if(Te!=0){var Ie,be,tt,qe;Ie=K[ne++]*V,be=K[ne++]*V,tt=0|Ie,qe=0|be,Ie+=u.adj43[tt],be+=u.adj43[qe],ie[ae++]=0|Ie,ie[ae++]=0|be}}function _(q,V,K,ne,ie){var ae,Te,Ie=0,be,Pe=0,$e=0,tt=0,qe=V,ut=0,te=qe,Ne=0,Be=q,De=0;for(be=ie!=null&&ne.global_gain==ie.global_gain,ne.block_type==s.SHORT_TYPE?Te=38:Te=21,ae=0;ae<=Te;ae++){var Oe=-1;if((be||ne.block_type==s.NORM_TYPE)&&(Oe=ne.global_gain-(ne.scalefac[ae]+(ne.preflag!=0?u.pretab[ae]:0)<<ne.scalefac_scale+1)-ne.subblock_gain[ne.window[ae]]*8),i(ne.width[ae]>=0),be&&ie.step[ae]==Oe)Pe!=0&&(p(Pe,K,Be,De,te,Ne),Pe=0),$e!=0&&(d($e,K,Be,De,te,Ne),$e=0);else{var ue=ne.width[ae];if(Ie+ne.width[ae]>ne.max_nonzero_coeff){var _e;_e=ne.max_nonzero_coeff-Ie+1,t.fill(V,ne.max_nonzero_coeff,576,0),ue=_e,ue<0&&(ue=0),ae=Te+1}if(Pe==0&&$e==0&&(te=qe,Ne=ut,Be=q,De=tt),ie!=null&&ie.sfb_count1>0&&ae>=ie.sfb_count1&&ie.step[ae]>0&&Oe>=ie.step[ae]?(Pe!=0&&(p(Pe,K,Be,De,te,Ne),Pe=0,te=qe,Ne=ut,Be=q,De=tt),$e+=ue):($e!=0&&(d($e,K,Be,De,te,Ne),$e=0,te=qe,Ne=ut,Be=q,De=tt),Pe+=ue),ue<=0){$e!=0&&(d($e,K,Be,De,te,Ne),$e=0),Pe!=0&&(p(Pe,K,Be,De,te,Ne),Pe=0);break}}ae<=Te&&(ut+=ne.width[ae],tt+=ne.width[ae],Ie+=ne.width[ae])}Pe!=0&&(p(Pe,K,Be,De,te,Ne),Pe=0),$e!=0&&(d($e,K,Be,De,te,Ne),$e=0)}function g(q,V,K){var ne=0,ie=0;do{var ae=q[V++],Te=q[V++];ne<ae&&(ne=ae),ie<Te&&(ie=Te)}while(V<K);return ne<ie&&(ne=ie),ne}function m(q,V,K,ne,ie,ae){var Te=o.ht[ne].xlen*65536+o.ht[ie].xlen,Ie=0,be;do{var Pe=q[V++],$e=q[V++];Pe!=0&&(Pe>14&&(Pe=15,Ie+=Te),Pe*=16),$e!=0&&($e>14&&($e=15,Ie+=Te),Pe+=$e),Ie+=o.largetbl[Pe]}while(V<K);return be=Ie&65535,Ie>>=16,Ie>be&&(Ie=be,ne=ie),ae.bits+=Ie,ne}function b(q,V,K,ne){var ie=0,ae=o.ht[1].hlen;do{var Te=q[V+0]*2+q[V+1];V+=2,ie+=ae[Te]}while(V<K);return ne.bits+=ie,1}function y(q,V,K,ne,ie){var ae=0,Te,Ie=o.ht[ne].xlen,be;ne==2?be=o.table23:be=o.table56;do{var Pe=q[V+0]*Ie+q[V+1];V+=2,ae+=be[Pe]}while(V<K);return Te=ae&65535,ae>>=16,ae>Te&&(ae=Te,ne++),ie.bits+=ae,ne}function x(q,V,K,ne,ie){var ae=0,Te=0,Ie=0,be=o.ht[ne].xlen,Pe=o.ht[ne].hlen,$e=o.ht[ne+1].hlen,tt=o.ht[ne+2].hlen;do{var qe=q[V+0]*be+q[V+1];V+=2,ae+=Pe[qe],Te+=$e[qe],Ie+=tt[qe]}while(V<K);var ut=ne;return ae>Te&&(ae=Te,ut++),ae>Ie&&(ae=Ie,ut=ne+2),ie.bits+=ae,ut}var T=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function k(q,V,K,ne){var ie=g(q,V,K);switch(ie){case 0:return ie;case 1:return b(q,V,K,ne);case 2:case 3:return y(q,V,K,T[ie-1],ne);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return x(q,V,K,T[ie-1],ne);default:if(ie>c.IXMAX_VAL)return ne.bits=c.LARGE_BITS,-1;ie-=15;var ae;for(ae=24;ae<32&&!(o.ht[ae].linmax>=ie);ae++);var Te;for(Te=ae-8;Te<24&&!(o.ht[Te].linmax>=ie);Te++);return m(q,V,K,Te,ae,ne)}}this.noquant_count_bits=function(q,V,K){var ne=V.l3_enc,ie=Math.min(576,V.max_nonzero_coeff+2>>1<<1);for(K!=null&&(K.sfb_count1=0);ie>1&&!(ne[ie-1]|ne[ie-2]);ie-=2);V.count1=ie;for(var ae=0,Te=0;ie>3;ie-=4){var Ie;if(((ne[ie-1]|ne[ie-2]|ne[ie-3]|ne[ie-4])&2147483647)>1)break;Ie=((ne[ie-4]*2+ne[ie-3])*2+ne[ie-2])*2+ne[ie-1],ae+=o.t32l[Ie],Te+=o.t33l[Ie]}var be=ae;if(V.count1table_select=0,ae>Te&&(be=Te,V.count1table_select=1),V.count1bits=be,V.big_values=ie,ie==0)return be;if(V.block_type==s.SHORT_TYPE)ae=3*q.scalefac_band.s[3],ae>V.big_values&&(ae=V.big_values),Te=V.big_values;else if(V.block_type==s.NORM_TYPE){if(ae=V.region0_count=q.bv_scf[ie-2],Te=V.region1_count=q.bv_scf[ie-1],i(ae+Te+2<s.SBPSY_l),Te=q.scalefac_band.l[ae+Te+2],ae=q.scalefac_band.l[ae+1],Te<ie){var Pe=new h(be);V.table_select[2]=k(ne,Te,ie,Pe),be=Pe.bits}}else V.region0_count=7,V.region1_count=s.SBMAX_l-1-7-1,ae=q.scalefac_band.l[8],Te=ie,ae>Te&&(ae=Te);if(ae=Math.min(ae,ie),Te=Math.min(Te,ie),0<ae){var Pe=new h(be);V.table_select[0]=k(ne,0,ae,Pe),be=Pe.bits}if(ae<Te){var Pe=new h(be);V.table_select[1]=k(ne,ae,Te,Pe),be=Pe.bits}if(q.use_best_huffman==2&&(V.part2_3_length=be,best_huffman_divide(q,V),be=V.part2_3_length),K!=null&&V.block_type==s.NORM_TYPE){for(var $e=0;q.scalefac_band.l[$e]<V.big_values;)$e++;K.sfb_count1=$e}return be},this.count_bits=function(q,V,K,ne){var ie=K.l3_enc,ae=c.IXMAX_VAL/u.IPOW20(K.global_gain);if(K.xrpow_max>ae)return c.LARGE_BITS;if(_(V,ie,u.IPOW20(K.global_gain),K,ne),q.substep_shaping&2)for(var Te=0,Ie=K.global_gain+K.scalefac_scale,be=.634521682242439/u.IPOW20(Ie),Pe=0;Pe<K.sfbmax;Pe++){var $e=K.width[Pe];if(q.pseudohalf[Pe]==0)Te+=$e;else{var tt;for(tt=Te,Te+=$e;tt<Te;++tt)ie[tt]=V[tt]>=be?ie[tt]:0}}return this.noquant_count_bits(q,K,ne)};function R(q,V,K,ne,ie,ae,Te){for(var Ie=V.big_values,be=0;be<=22;be++)ne[be]=c.LARGE_BITS;for(var be=0;be<16;be++){var Pe=q.scalefac_band.l[be+1];if(Pe>=Ie)break;var $e=0,tt=new h($e),qe=k(K,0,Pe,tt);$e=tt.bits;for(var ut=0;ut<8;ut++){var te=q.scalefac_band.l[be+ut+2];if(te>=Ie)break;var Ne=$e;tt=new h(Ne);var Be=k(K,Pe,te,tt);Ne=tt.bits,ne[be+ut]>Ne&&(ne[be+ut]=Ne,ie[be+ut]=be,ae[be+ut]=qe,Te[be+ut]=Be)}}}function P(q,V,K,ne,ie,ae,Te,Ie){for(var be=V.big_values,Pe=2;Pe<s.SBMAX_l+1;Pe++){var $e=q.scalefac_band.l[Pe];if($e>=be)break;var tt=ie[Pe-2]+V.count1bits;if(K.part2_3_length<=tt)break;var qe=new h(tt),ut=k(ne,$e,be,qe);tt=qe.bits,!(K.part2_3_length<=tt)&&(K.assign(V),K.part2_3_length=tt,K.region0_count=ae[Pe-2],K.region1_count=Pe-2-ae[Pe-2],K.table_select[0]=Te[Pe-2],K.table_select[1]=Ie[Pe-2],K.table_select[2]=ut)}}this.best_huffman_divide=function(q,V){var K=new a,ne=V.l3_enc,ie=r(23),ae=r(23),Te=r(23),Ie=r(23);if(!(V.block_type==s.SHORT_TYPE&&q.mode_gr==1)){K.assign(V),V.block_type==s.NORM_TYPE&&(R(q,V,ne,ie,ae,Te,Ie),P(q,K,V,ne,ie,ae,Te,Ie));var be=K.big_values;if(!(be==0||(ne[be-2]|ne[be-1])>1)&&(be=V.count1+2,!(be>576))){K.assign(V),K.count1=be;for(var Pe=0,$e=0;be>K.big_values;be-=4){var tt=((ne[be-4]*2+ne[be-3])*2+ne[be-2])*2+ne[be-1];Pe+=o.t32l[tt],$e+=o.t33l[tt]}if(K.big_values=be,K.count1table_select=0,Pe>$e&&(Pe=$e,K.count1table_select=1),K.count1bits=Pe,K.block_type==s.NORM_TYPE)P(q,K,V,ne,ie,ae,Te,Ie);else{if(K.part2_3_length=Pe,Pe=q.scalefac_band.l[8],Pe>be&&(Pe=be),Pe>0){var qe=new h(K.part2_3_length);K.table_select[0]=k(ne,0,Pe,qe),K.part2_3_length=qe.bits}if(be>Pe){var qe=new h(K.part2_3_length);K.table_select[1]=k(ne,Pe,be,qe),K.part2_3_length=qe.bits}V.part2_3_length>K.part2_3_length&&V.assign(K)}}}};var B=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],U=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],z=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],I=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];l.slen1_tab=z,l.slen2_tab=I;function L(q,V){for(var K,ne=V.tt[1][q],ie=V.tt[0][q],ae=0;ae<o.scfsi_band.length-1;ae++){for(K=o.scfsi_band[ae];K<o.scfsi_band[ae+1]&&!(ie.scalefac[K]!=ne.scalefac[K]&&ne.scalefac[K]>=0);K++);if(K==o.scfsi_band[ae+1]){for(K=o.scfsi_band[ae];K<o.scfsi_band[ae+1];K++)ne.scalefac[K]=-1;V.scfsi[q][ae]=1}}var Te=0,Ie=0;for(K=0;K<11;K++)ne.scalefac[K]!=-1&&(Ie++,Te<ne.scalefac[K]&&(Te=ne.scalefac[K]));for(var be=0,Pe=0;K<s.SBPSY_l;K++)ne.scalefac[K]!=-1&&(Pe++,be<ne.scalefac[K]&&(be=ne.scalefac[K]));for(var ae=0;ae<16;ae++)if(Te<B[ae]&&be<U[ae]){var $e=z[ae]*Ie+I[ae]*Pe;ne.part2_length>$e&&(ne.part2_length=$e,ne.scalefac_compress=ae)}}this.best_scalefac_store=function(q,V,K,ne){var ie=ne.tt[V][K],ae,Te,Ie,be,Pe=0;for(Ie=0,ae=0;ae<ie.sfbmax;ae++){var $e=ie.width[ae];for(Ie+=$e,be=-$e;be<0&&ie.l3_enc[be+Ie]==0;be++);be==0&&(ie.scalefac[ae]=Pe=-2)}if(ie.scalefac_scale==0&&ie.preflag==0){var tt=0;for(ae=0;ae<ie.sfbmax;ae++)ie.scalefac[ae]>0&&(tt|=ie.scalefac[ae]);if(!(tt&1)&&tt!=0){for(ae=0;ae<ie.sfbmax;ae++)ie.scalefac[ae]>0&&(ie.scalefac[ae]>>=1);ie.scalefac_scale=Pe=1}}if(ie.preflag==0&&ie.block_type!=s.SHORT_TYPE&&q.mode_gr==2){for(ae=11;ae<s.SBPSY_l&&!(ie.scalefac[ae]<u.pretab[ae]&&ie.scalefac[ae]!=-2);ae++);if(ae==s.SBPSY_l){for(ae=11;ae<s.SBPSY_l;ae++)ie.scalefac[ae]>0&&(ie.scalefac[ae]-=u.pretab[ae]);ie.preflag=Pe=1}}for(Te=0;Te<4;Te++)ne.scfsi[K][Te]=0;for(q.mode_gr==2&&V==1&&ne.tt[0][K].block_type!=s.SHORT_TYPE&&ne.tt[1][K].block_type!=s.SHORT_TYPE&&(L(K,ne),Pe=0),ae=0;ae<ie.sfbmax;ae++)ie.scalefac[ae]==-2&&(ie.scalefac[ae]=0);Pe!=0&&(q.mode_gr==2?this.scale_bitcount(ie):this.scale_bitcount_lsf(q,ie))};function M(q,V){for(var K=0;K<V;++K)if(q[K]<0)return!1;return!0}var F=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],Z=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],$=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(q){var V,K,ne=0,ie=0,ae,Te=q.scalefac;if(i(M(Te,q.sfbmax)),q.block_type==s.SHORT_TYPE)ae=F,q.mixed_block_flag!=0&&(ae=Z);else if(ae=$,q.preflag==0){for(K=11;K<s.SBPSY_l&&!(Te[K]<u.pretab[K]);K++);if(K==s.SBPSY_l)for(q.preflag=1,K=11;K<s.SBPSY_l;K++)Te[K]-=u.pretab[K]}for(K=0;K<q.sfbdivide;K++)ne<Te[K]&&(ne=Te[K]);for(;K<q.sfbmax;K++)ie<Te[K]&&(ie=Te[K]);for(q.part2_length=c.LARGE_BITS,V=0;V<16;V++)ne<B[V]&&ie<U[V]&&q.part2_length>ae[V]&&(q.part2_length=ae[V],q.scalefac_compress=V);return q.part2_length==c.LARGE_BITS};var Y=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(q,V){var K,ne,ie,ae,Te,Ie,be,Pe,$e=r(4),tt=V.scalefac;for(V.preflag!=0?K=2:K=0,be=0;be<4;be++)$e[be]=0;if(V.block_type==s.SHORT_TYPE){ne=1;var qe=u.nr_of_sfb_block[K][ne];for(Pe=0,ie=0;ie<4;ie++)for(ae=qe[ie]/3,be=0;be<ae;be++,Pe++)for(Te=0;Te<3;Te++)tt[Pe*3+Te]>$e[ie]&&($e[ie]=tt[Pe*3+Te])}else{ne=0;var qe=u.nr_of_sfb_block[K][ne];for(Pe=0,ie=0;ie<4;ie++)for(ae=qe[ie],be=0;be<ae;be++,Pe++)tt[Pe]>$e[ie]&&($e[ie]=tt[Pe])}for(Ie=!1,ie=0;ie<4;ie++)$e[ie]>Y[K][ie]&&(Ie=!0);if(!Ie){var ut,te,Ne,Be;for(V.sfb_partition_table=u.nr_of_sfb_block[K][ne],ie=0;ie<4;ie++)V.slen[ie]=Q[$e[ie]];switch(ut=V.slen[0],te=V.slen[1],Ne=V.slen[2],Be=V.slen[3],K){case 0:V.scalefac_compress=(ut*5+te<<4)+(Ne<<2)+Be;break;case 1:V.scalefac_compress=400+(ut*5+te<<2)+Ne;break;case 2:V.scalefac_compress=500+ut*3+te;break;default:e.err.printf(`intensity stereo not implemented yet
`);break}}if(!Ie)for(i(V.sfb_partition_table!=null),V.part2_length=0,ie=0;ie<4;ie++)V.part2_length+=V.slen[ie]*V.sfb_partition_table[ie];return Ie};var Q=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(q){for(var V=2;V<=576;V+=2){for(var K=0,ne;q.scalefac_band.l[++K]<V;);for(ne=f[K][0];q.scalefac_band.l[ne+1]>V;)ne--;for(ne<0&&(ne=f[K][0]),q.bv_scf[V-2]=ne,ne=f[K][1];q.scalefac_band.l[ne+q.bv_scf[V-2]+2]>V;)ne--;ne<0&&(ne=f[K][1]),q.bv_scf[V-1]=ne}}}return TP=l,TP}var wP,MV;function O8(){if(MV)return wP;MV=1;var n=Lo,e=n.System,t=n.Arrays,r=n.new_byte,i=n.new_float_n,s=n.new_int,o=n.assert,a=Pne(),c=k8,l=gu(),u=f3;h.EQ=function(f,d){return Math.abs(f)>Math.abs(d)?Math.abs(f-d)<=Math.abs(f)*1e-6:Math.abs(f-d)<=Math.abs(d)*1e-6},h.NEQ=function(f,d){return!h.EQ(f,d)};function h(){var f=I8(),d=this,p=32773,_=null,g=null,m=null,b=null;this.setModules=function(V,K,ne,ie){_=V,g=K,m=ne,b=ie};var y=null,x=0,T=0,k=0;this.getframebits=function(V){var K=V.internal_flags,ne;K.bitrate_index!=0?ne=c.bitrate_table[V.version][K.bitrate_index]:ne=V.brate;var ie=0|(V.version+1)*72e3*ne/V.out_samplerate+K.padding;return 8*ie};function R(V){e.arraycopy(V.header[V.w_ptr].buf,0,y,T,V.sideinfo_len),T+=V.sideinfo_len,x+=V.sideinfo_len*8,V.w_ptr=V.w_ptr+1&u.MAX_HEADER_BUF-1}function P(V,K,ne){for(;ne>0;){var ie;k==0&&(k=8,T++,o(T<f.LAME_MAXMP3BUFFER),o(V.header[V.w_ptr].write_timing>=x),V.header[V.w_ptr].write_timing==x&&R(V),y[T]=0),ie=Math.min(ne,k),ne-=ie,k-=ie,y[T]|=K>>ne<<k,x+=ie}}function B(V,K,ne){for(;ne>0;){var ie;k==0&&(k=8,T++,o(T<f.LAME_MAXMP3BUFFER),y[T]=0),ie=Math.min(ne,k),ne-=ie,k-=ie,y[T]|=K>>ne<<k,x+=ie}}function U(V,K){var ne=V.internal_flags,ie;if(K>=8&&(P(ne,76,8),K-=8),K>=8&&(P(ne,65,8),K-=8),K>=8&&(P(ne,77,8),K-=8),K>=8&&(P(ne,69,8),K-=8),K>=32){var ae=m.getLameShortVersion();if(K>=32)for(ie=0;ie<ae.length&&K>=8;++ie)K-=8,P(ne,ae.charAt(ie),8)}for(;K>=1;K-=1)P(ne,ne.ancillary_flag,1),ne.ancillary_flag^=V.disable_reservoir?0:1}function z(V,K,ne){for(var ie=V.header[V.h_ptr].ptr;ne>0;){var ae=Math.min(ne,8-(ie&7));ne-=ae,V.header[V.h_ptr].buf[ie>>3]|=K>>ne<<8-(ie&7)-ae,ie+=ae}V.header[V.h_ptr].ptr=ie}function I(V,K){V<<=8;for(var ne=0;ne<8;ne++)V<<=1,K<<=1,(K^V)&65536&&(K^=p);return K}this.CRC_writeheader=function(V,K){var ne=65535;ne=I(K[2]&255,ne),ne=I(K[3]&255,ne);for(var ie=6;ie<V.sideinfo_len;ie++)ne=I(K[ie]&255,ne);K[4]=byte(ne>>8),K[5]=byte(ne&255)};function L(V,K){var ne=V.internal_flags,ie,ae,Te;if(ie=ne.l3_side,ne.header[ne.h_ptr].ptr=0,t.fill(ne.header[ne.h_ptr].buf,0,ne.sideinfo_len,0),V.out_samplerate<16e3?z(ne,4094,12):z(ne,4095,12),z(ne,V.version,1),z(ne,1,2),z(ne,V.error_protection?0:1,1),z(ne,ne.bitrate_index,4),z(ne,ne.samplerate_index,2),z(ne,ne.padding,1),z(ne,V.extension,1),z(ne,V.mode.ordinal(),2),z(ne,ne.mode_ext,2),z(ne,V.copyright,1),z(ne,V.original,1),z(ne,V.emphasis,2),V.error_protection&&z(ne,0,16),V.version==1){for(o(ie.main_data_begin>=0),z(ne,ie.main_data_begin,9),ne.channels_out==2?z(ne,ie.private_bits,3):z(ne,ie.private_bits,5),Te=0;Te<ne.channels_out;Te++){var Ie;for(Ie=0;Ie<4;Ie++)z(ne,ie.scfsi[Te][Ie],1)}for(ae=0;ae<2;ae++)for(Te=0;Te<ne.channels_out;Te++){var be=ie.tt[ae][Te];z(ne,be.part2_3_length+be.part2_length,12),z(ne,be.big_values/2,9),z(ne,be.global_gain,8),z(ne,be.scalefac_compress,4),be.block_type!=l.NORM_TYPE?(z(ne,1,1),z(ne,be.block_type,2),z(ne,be.mixed_block_flag,1),be.table_select[0]==14&&(be.table_select[0]=16),z(ne,be.table_select[0],5),be.table_select[1]==14&&(be.table_select[1]=16),z(ne,be.table_select[1],5),z(ne,be.subblock_gain[0],3),z(ne,be.subblock_gain[1],3),z(ne,be.subblock_gain[2],3)):(z(ne,0,1),be.table_select[0]==14&&(be.table_select[0]=16),z(ne,be.table_select[0],5),be.table_select[1]==14&&(be.table_select[1]=16),z(ne,be.table_select[1],5),be.table_select[2]==14&&(be.table_select[2]=16),z(ne,be.table_select[2],5),o(0<=be.region0_count&&be.region0_count<16),o(0<=be.region1_count&&be.region1_count<8),z(ne,be.region0_count,4),z(ne,be.region1_count,3)),z(ne,be.preflag,1),z(ne,be.scalefac_scale,1),z(ne,be.count1table_select,1)}}else for(o(ie.main_data_begin>=0),z(ne,ie.main_data_begin,8),z(ne,ie.private_bits,ne.channels_out),ae=0,Te=0;Te<ne.channels_out;Te++){var be=ie.tt[ae][Te];z(ne,be.part2_3_length+be.part2_length,12),z(ne,be.big_values/2,9),z(ne,be.global_gain,8),z(ne,be.scalefac_compress,9),be.block_type!=l.NORM_TYPE?(z(ne,1,1),z(ne,be.block_type,2),z(ne,be.mixed_block_flag,1),be.table_select[0]==14&&(be.table_select[0]=16),z(ne,be.table_select[0],5),be.table_select[1]==14&&(be.table_select[1]=16),z(ne,be.table_select[1],5),z(ne,be.subblock_gain[0],3),z(ne,be.subblock_gain[1],3),z(ne,be.subblock_gain[2],3)):(z(ne,0,1),be.table_select[0]==14&&(be.table_select[0]=16),z(ne,be.table_select[0],5),be.table_select[1]==14&&(be.table_select[1]=16),z(ne,be.table_select[1],5),be.table_select[2]==14&&(be.table_select[2]=16),z(ne,be.table_select[2],5),o(0<=be.region0_count&&be.region0_count<16),o(0<=be.region1_count&&be.region1_count<8),z(ne,be.region0_count,4),z(ne,be.region1_count,3)),z(ne,be.scalefac_scale,1),z(ne,be.count1table_select,1)}V.error_protection&&CRC_writeheader(ne,ne.header[ne.h_ptr].buf);{var Pe=ne.h_ptr;o(ne.header[Pe].ptr==ne.sideinfo_len*8),ne.h_ptr=Pe+1&u.MAX_HEADER_BUF-1,ne.header[ne.h_ptr].write_timing=ne.header[Pe].write_timing+K,ne.h_ptr==ne.w_ptr&&e.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function M(V,K){var ne=c.ht[K.count1table_select+32],ie,ae=0,Te=K.big_values,Ie=K.big_values;for(o(K.count1table_select<2),ie=(K.count1-K.big_values)/4;ie>0;--ie){var be=0,Pe=0,$e;$e=K.l3_enc[Te+0],$e!=0&&(Pe+=8,K.xr[Ie+0]<0&&be++),$e=K.l3_enc[Te+1],$e!=0&&(Pe+=4,be*=2,K.xr[Ie+1]<0&&be++),$e=K.l3_enc[Te+2],$e!=0&&(Pe+=2,be*=2,K.xr[Ie+2]<0&&be++),$e=K.l3_enc[Te+3],$e!=0&&(Pe++,be*=2,K.xr[Ie+3]<0&&be++),Te+=4,Ie+=4,P(V,be+ne.table[Pe],ne.hlen[Pe]),ae+=ne.hlen[Pe]}return ae}function F(V,K,ne,ie,ae){var Te=c.ht[K],Ie=0;if(K==0)return Ie;for(var be=ne;be<ie;be+=2){var Pe=0,$e=0,tt=Te.xlen,qe=Te.xlen,ut=0,te=ae.l3_enc[be],Ne=ae.l3_enc[be+1];if(te!=0&&(ae.xr[be]<0&&ut++,Pe--),K>15){if(te>14){var Be=te-15;o(Be<=Te.linmax),ut|=Be<<1,$e=tt,te=15}if(Ne>14){var De=Ne-15;o(De<=Te.linmax),ut<<=tt,ut|=De,$e+=tt,Ne=15}qe=16}Ne!=0&&(ut<<=1,ae.xr[be+1]<0&&ut++,Pe--),te=te*qe+Ne,$e-=Pe,Pe+=Te.hlen[te],P(V,Te.table[te],Pe),P(V,ut,$e),Ie+=Pe+$e}return Ie}function Z(V,K){var ne=3*V.scalefac_band.s[3];ne>K.big_values&&(ne=K.big_values);var ie=F(V,K.table_select[0],0,ne,K);return ie+=F(V,K.table_select[1],ne,K.big_values,K),ie}function $(V,K){var ne,ie,ae,Te;ne=K.big_values;var Ie=K.region0_count+1;return o(Ie<V.scalefac_band.l.length),ae=V.scalefac_band.l[Ie],Ie+=K.region1_count+1,o(Ie<V.scalefac_band.l.length),Te=V.scalefac_band.l[Ie],ae>ne&&(ae=ne),Te>ne&&(Te=ne),ie=F(V,K.table_select[0],0,ae,K),ie+=F(V,K.table_select[1],ae,Te,K),ie+=F(V,K.table_select[2],Te,ne,K),ie}function Y(V){var K,ne,ie,ae,Te=0,Ie=V.internal_flags,be=Ie.l3_side;if(V.version==1)for(K=0;K<2;K++)for(ne=0;ne<Ie.channels_out;ne++){var Pe=be.tt[K][ne],$e=a.slen1_tab[Pe.scalefac_compress],tt=a.slen2_tab[Pe.scalefac_compress];for(ae=0,ie=0;ie<Pe.sfbdivide;ie++)Pe.scalefac[ie]!=-1&&(P(Ie,Pe.scalefac[ie],$e),ae+=$e);for(;ie<Pe.sfbmax;ie++)Pe.scalefac[ie]!=-1&&(P(Ie,Pe.scalefac[ie],tt),ae+=tt);o(ae==Pe.part2_length),Pe.block_type==l.SHORT_TYPE?ae+=Z(Ie,Pe):ae+=$(Ie,Pe),ae+=M(Ie,Pe),o(ae==Pe.part2_3_length+Pe.part2_length),Te+=ae}else for(K=0,ne=0;ne<Ie.channels_out;ne++){var Pe=be.tt[K][ne],qe,ut,te=0;if(o(Pe.sfb_partition_table!=null),ae=0,ie=0,ut=0,Pe.block_type==l.SHORT_TYPE){for(;ut<4;ut++){var Ne=Pe.sfb_partition_table[ut]/3,Be=Pe.slen[ut];for(qe=0;qe<Ne;qe++,ie++)P(Ie,Math.max(Pe.scalefac[ie*3+0],0),Be),P(Ie,Math.max(Pe.scalefac[ie*3+1],0),Be),P(Ie,Math.max(Pe.scalefac[ie*3+2],0),Be),te+=3*Be}ae+=Z(Ie,Pe)}else{for(;ut<4;ut++){var Ne=Pe.sfb_partition_table[ut],Be=Pe.slen[ut];for(qe=0;qe<Ne;qe++,ie++)P(Ie,Math.max(Pe.scalefac[ie],0),Be),te+=Be}ae+=$(Ie,Pe)}ae+=M(Ie,Pe),o(ae==Pe.part2_3_length),o(te==Pe.part2_length),Te+=te+ae}return Te}function Q(){this.total=0}function q(V,K){var ne=V.internal_flags,ie,ae,Te,Ie,be;return be=ne.w_ptr,Ie=ne.h_ptr-1,Ie==-1&&(Ie=u.MAX_HEADER_BUF-1),ie=ne.header[Ie].write_timing-x,K.total=ie,ie>=0&&(ae=1+Ie-be,Ie<be&&(ae=1+Ie-be+u.MAX_HEADER_BUF),ie-=ae*8*ne.sideinfo_len),Te=d.getframebits(V),ie+=Te,K.total+=Te,K.total%8!=0?K.total=1+K.total/8:K.total=K.total/8,K.total+=T+1,ie<0&&e.err.println(`strange error flushing buffer ... 
`),ie}this.flush_bitstream=function(V){var K=V.internal_flags,ne,ie,ae=K.h_ptr-1;if(ae==-1&&(ae=u.MAX_HEADER_BUF-1),ne=K.l3_side,!((ie=q(V,new Q))<0)){if(U(V,ie),o(K.header[ae].write_timing+this.getframebits(V)==x),K.ResvSize=0,ne.main_data_begin=0,K.findReplayGain){var Te=_.GetTitleGain(K.rgdata);o(NEQ(Te,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),K.RadioGain=Math.floor(Te*10+.5)|0}K.findPeakSample&&(K.noclipGainChange=Math.ceil(Math.log10(K.PeakSample/32767)*20*10)|0,K.noclipGainChange>0&&(EQ(V.scale,1)||EQ(V.scale,0))?K.noclipScale=Math.floor(32767/K.PeakSample*100)/100:K.noclipScale=-1)}},this.add_dummy_byte=function(V,K,ne){for(var ie=V.internal_flags,ae;ne-- >0;)for(B(ie,K,8),ae=0;ae<u.MAX_HEADER_BUF;++ae)ie.header[ae].write_timing+=8},this.format_bitstream=function(V){var K=V.internal_flags,ne;ne=K.l3_side;var ie=this.getframebits(V);U(V,ne.resvDrain_pre),L(V,ie);var ae=8*K.sideinfo_len;if(ae+=Y(V),U(V,ne.resvDrain_post),ae+=ne.resvDrain_post,ne.main_data_begin+=(ie-ae)/8,q(V,new Q)!=K.ResvSize&&e.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),ne.main_data_begin*8!=K.ResvSize&&(e.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*ne.main_data_begin,K.ResvSize,ne.resvDrain_post,ne.resvDrain_pre,8*K.sideinfo_len,ae-ne.resvDrain_post-8*K.sideinfo_len,ae,ae%8,ie),e.err.println("This is a fatal error.  It has several possible causes:"),e.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),e.err.println(" 9%%  Your system is overclocked"),e.err.println(" 1%%  bug in LAME encoding library"),K.ResvSize=ne.main_data_begin*8),x>1e9){var Te;for(Te=0;Te<u.MAX_HEADER_BUF;++Te)K.header[Te].write_timing-=x;x=0}return 0},this.copy_buffer=function(V,K,ne,ie,ae){var Te=T+1;if(Te<=0)return 0;if(ie!=0&&Te>ie)return-1;if(e.arraycopy(y,0,K,ne,Te),T=-1,k=0,ae!=0){var Ie=s(1);if(Ie[0]=V.nMusicCRC,b.updateMusicCRC(Ie,K,ne,Te),V.nMusicCRC=Ie[0],Te>0&&(V.VBR_seek_table.nBytesWritten+=Te),V.decode_on_the_fly){for(var be=i([2,1152]),Pe=Te,$e=-1,tt;$e!=0;)if($e=g.hip_decode1_unclipped(V.hip,K,ne,Pe,be[0],be[1]),Pe=0,$e==-1&&($e=0),$e>0){if(V.findPeakSample){for(tt=0;tt<$e;tt++)be[0][tt]>V.PeakSample?V.PeakSample=be[0][tt]:-be[0][tt]>V.PeakSample&&(V.PeakSample=-be[0][tt]);if(V.channels_out>1)for(tt=0;tt<$e;tt++)be[1][tt]>V.PeakSample?V.PeakSample=be[1][tt]:-be[1][tt]>V.PeakSample&&(V.PeakSample=-be[1][tt])}if(V.findReplayGain&&_.AnalyzeSamples(V.rgdata,be[0],0,be[1],0,$e,V.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return Te},this.init_bit_stream_w=function(V){y=r(f.LAME_MAXMP3BUFFER),V.h_ptr=V.w_ptr=0,V.header[V.h_ptr].write_timing=0,T=-1,k=0,x=0}}return wP=h,wP}var AP,kV;function I8(){if(kV)return AP;kV=1;var n=Lo,e=n.System,t=n.VbrMode,r=n.ShortBlock,i=n.new_float,s=n.new_int_n,o=n.new_short_n,a=n.assert,c=l7e,l=f7e,u=f3,h=L7e,f=B7e,d=$7e,p=O8(),_=k8,g=gu();function m(){var b=PR,y=this,x=128*1024;m.V9=410,m.V8=420,m.V7=430,m.V6=440,m.V5=450,m.V4=460,m.V3=470,m.V2=480,m.V1=490,m.V0=500,m.R3MIX=1e3,m.STANDARD=1001,m.EXTREME=1002,m.INSANE=1003,m.STANDARD_FAST=1004,m.EXTREME_FAST=1005,m.MEDIUM=1006,m.MEDIUM_FAST=1007;var T=16384+x;m.LAME_MAXMP3BUFFER=T;var k,R,P,B,U,z=new c,I,L,M;this.enc=new g,this.setModules=function(ue,_e,we,pe,ze,Ze,Je,nt,Pt){k=ue,R=_e,P=we,B=pe,U=ze,I=Ze,L=nt,M=Pt,this.enc.setModules(R,z,B,I)};function F(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=i(g.SBMAX_l),this.bo_s_weight=i(g.SBMAX_s)}function Z(){this.lowerlimit=0}function $(ue,_e){this.lowpass=_e}var Y=4294479419;function Q(ue){var _e;return ue.class_id=Y,_e=ue.internal_flags=new u,ue.mode=b.NOT_SET,ue.original=1,ue.in_samplerate=44100,ue.num_channels=2,ue.num_samples=-1,ue.bWriteVbrTag=!0,ue.quality=-1,ue.short_blocks=null,_e.subblock_gain=-1,ue.lowpassfreq=0,ue.highpassfreq=0,ue.lowpasswidth=-1,ue.highpasswidth=-1,ue.VBR=t.vbr_off,ue.VBR_q=4,ue.ATHcurve=-1,ue.VBR_mean_bitrate_kbps=128,ue.VBR_min_bitrate_kbps=0,ue.VBR_max_bitrate_kbps=0,ue.VBR_hard_min=0,_e.VBR_min_bitrate=1,_e.VBR_max_bitrate=13,ue.quant_comp=-1,ue.quant_comp_short=-1,ue.msfix=-1,_e.resample_ratio=1,_e.OldValue[0]=180,_e.OldValue[1]=180,_e.CurrentStep[0]=4,_e.CurrentStep[1]=4,_e.masking_lower=1,_e.nsPsy.attackthre=-1,_e.nsPsy.attackthre_s=-1,ue.scale=-1,ue.athaa_type=-1,ue.ATHtype=-1,ue.athaa_loudapprox=-1,ue.athaa_sensitivity=0,ue.useTemporal=null,ue.interChRatio=-1,_e.mf_samples_to_encode=g.ENCDELAY+g.POSTDELAY,ue.encoder_padding=0,_e.mf_size=g.ENCDELAY-g.MDCTDELAY,ue.findReplayGain=!1,ue.decode_on_the_fly=!1,_e.decode_on_the_fly=!1,_e.findReplayGain=!1,_e.findPeakSample=!1,_e.RadioGain=0,_e.AudiophileGain=0,_e.noclipGainChange=0,_e.noclipScale=-1,ue.preset=0,ue.write_id3tag_automatic=!0,0}this.lame_init=function(){var ue=new l;return Q(ue),ue.lame_allocated_gfp=1,ue};function q(ue){return ue>1?0:ue<=0?1:Math.cos(Math.PI/2*ue)}this.nearestBitrateFullIndex=function(ue){var _e=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],we=0,pe=0,ze=0,Ze=0;Ze=_e[16],ze=16,pe=_e[16],we=16;for(var Je=0;Je<16;Je++)if(Math.max(ue,_e[Je+1])!=ue){Ze=_e[Je+1],ze=Je+1,pe=_e[Je],we=Je;break}return Ze-ue>ue-pe?we:ze};function V(ue,_e){var we=44100;return _e>=48e3?we=48e3:_e>=44100?we=44100:_e>=32e3?we=32e3:_e>=24e3?we=24e3:_e>=22050?we=22050:_e>=16e3?we=16e3:_e>=12e3?we=12e3:_e>=11025?we=11025:_e>=8e3&&(we=8e3),ue==-1?we:(ue<=15960&&(we=44100),ue<=15250&&(we=32e3),ue<=11220&&(we=24e3),ue<=9970&&(we=22050),ue<=7230&&(we=16e3),ue<=5420&&(we=12e3),ue<=4510&&(we=11025),ue<=3970&&(we=8e3),_e<we?_e>44100?48e3:_e>32e3?44100:_e>24e3?32e3:_e>22050?24e3:_e>16e3?22050:_e>12e3?16e3:_e>11025?12e3:_e>8e3?11025:8e3:we)}function K(ue,_e){switch(ue){case 44100:return _e.version=1,0;case 48e3:return _e.version=1,1;case 32e3:return _e.version=1,2;case 22050:return _e.version=0,0;case 24e3:return _e.version=0,1;case 16e3:return _e.version=0,2;case 11025:return _e.version=0,0;case 12e3:return _e.version=0,1;case 8e3:return _e.version=0,2;default:return _e.version=0,-1}}function ne(ue,_e,we){we<16e3&&(_e=2);for(var pe=_.bitrate_table[_e][1],ze=2;ze<=14;ze++)_.bitrate_table[_e][ze]>0&&Math.abs(_.bitrate_table[_e][ze]-ue)<Math.abs(pe-ue)&&(pe=_.bitrate_table[_e][ze]);return pe}function ie(ue,_e,we){we<16e3&&(_e=2);for(var pe=0;pe<=14;pe++)if(_.bitrate_table[_e][pe]>0&&_.bitrate_table[_e][pe]==ue)return pe;return-1}function ae(ue,_e){var we=[new $(8,2e3),new $(16,3700),new $(24,3900),new $(32,5500),new $(40,7e3),new $(48,7500),new $(56,1e4),new $(64,11e3),new $(80,13500),new $(96,15100),new $(112,15600),new $(128,17e3),new $(160,17500),new $(192,18600),new $(224,19400),new $(256,19700),new $(320,20500)],pe=y.nearestBitrateFullIndex(_e);ue.lowerlimit=we[pe].lowpass}function Te(ue){var _e=ue.internal_flags,we=32,pe=-1;if(_e.lowpass1>0){for(var ze=999,Ze=0;Ze<=31;Ze++){var Je=Ze/31;Je>=_e.lowpass2&&(we=Math.min(we,Ze)),_e.lowpass1<Je&&Je<_e.lowpass2&&(ze=Math.min(ze,Ze))}ze==999?_e.lowpass1=(we-.75)/31:_e.lowpass1=(ze-.75)/31,_e.lowpass2=we/31}if(_e.highpass2>0&&_e.highpass2<.9*(.75/31)&&(_e.highpass1=0,_e.highpass2=0,e.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),_e.highpass2>0){for(var nt=-1,Ze=0;Ze<=31;Ze++){var Je=Ze/31;Je<=_e.highpass1&&(pe=Math.max(pe,Ze)),_e.highpass1<Je&&Je<_e.highpass2&&(nt=Math.max(nt,Ze))}_e.highpass1=pe/31,nt==-1?_e.highpass2=(pe+.75)/31:_e.highpass2=(nt+.75)/31}for(var Ze=0;Ze<32;Ze++){var Pt,vt,Je=Ze/31;_e.highpass2>_e.highpass1?Pt=q((_e.highpass2-Je)/(_e.highpass2-_e.highpass1+1e-20)):Pt=1,_e.lowpass2>_e.lowpass1?vt=q((Je-_e.lowpass1)/(_e.lowpass2-_e.lowpass1+1e-20)):vt=1,_e.amp_filter[Ze]=Pt*vt}}function Ie(ue){var _e=ue.internal_flags;switch(ue.quality){default:case 9:_e.psymodel=0,_e.noise_shaping=0,_e.noise_shaping_amp=0,_e.noise_shaping_stop=0,_e.use_best_huffman=0,_e.full_outer_loop=0;break;case 8:ue.quality=7;case 7:_e.psymodel=1,_e.noise_shaping=0,_e.noise_shaping_amp=0,_e.noise_shaping_stop=0,_e.use_best_huffman=0,_e.full_outer_loop=0;break;case 6:_e.psymodel=1,_e.noise_shaping==0&&(_e.noise_shaping=1),_e.noise_shaping_amp=0,_e.noise_shaping_stop=0,_e.subblock_gain==-1&&(_e.subblock_gain=1),_e.use_best_huffman=0,_e.full_outer_loop=0;break;case 5:_e.psymodel=1,_e.noise_shaping==0&&(_e.noise_shaping=1),_e.noise_shaping_amp=0,_e.noise_shaping_stop=0,_e.subblock_gain==-1&&(_e.subblock_gain=1),_e.use_best_huffman=0,_e.full_outer_loop=0;break;case 4:_e.psymodel=1,_e.noise_shaping==0&&(_e.noise_shaping=1),_e.noise_shaping_amp=0,_e.noise_shaping_stop=0,_e.subblock_gain==-1&&(_e.subblock_gain=1),_e.use_best_huffman=1,_e.full_outer_loop=0;break;case 3:_e.psymodel=1,_e.noise_shaping==0&&(_e.noise_shaping=1),_e.noise_shaping_amp=1,_e.noise_shaping_stop=1,_e.subblock_gain==-1&&(_e.subblock_gain=1),_e.use_best_huffman=1,_e.full_outer_loop=0;break;case 2:_e.psymodel=1,_e.noise_shaping==0&&(_e.noise_shaping=1),_e.substep_shaping==0&&(_e.substep_shaping=2),_e.noise_shaping_amp=1,_e.noise_shaping_stop=1,_e.subblock_gain==-1&&(_e.subblock_gain=1),_e.use_best_huffman=1,_e.full_outer_loop=0;break;case 1:_e.psymodel=1,_e.noise_shaping==0&&(_e.noise_shaping=1),_e.substep_shaping==0&&(_e.substep_shaping=2),_e.noise_shaping_amp=2,_e.noise_shaping_stop=1,_e.subblock_gain==-1&&(_e.subblock_gain=1),_e.use_best_huffman=1,_e.full_outer_loop=0;break;case 0:_e.psymodel=1,_e.noise_shaping==0&&(_e.noise_shaping=1),_e.substep_shaping==0&&(_e.substep_shaping=2),_e.noise_shaping_amp=2,_e.noise_shaping_stop=1,_e.subblock_gain==-1&&(_e.subblock_gain=1),_e.use_best_huffman=1,_e.full_outer_loop=0;break}}function be(ue){var _e=ue.internal_flags;ue.frameNum=0,ue.write_id3tag_automatic&&L.id3tag_write_v2(ue),_e.bitrate_stereoMode_Hist=s([16,5]),_e.bitrate_blockType_Hist=s([16,6]),_e.PeakSample=0,ue.bWriteVbrTag&&I.InitVbrTag(ue)}this.lame_init_params=function(ue){var _e=ue.internal_flags;if(_e.Class_ID=0,_e.ATH==null&&(_e.ATH=new h),_e.PSY==null&&(_e.PSY=new F),_e.rgdata==null&&(_e.rgdata=new f),_e.channels_in=ue.num_channels,_e.channels_in==1&&(ue.mode=b.MONO),_e.channels_out=ue.mode==b.MONO?1:2,_e.mode_ext=g.MPG_MD_MS_LR,ue.mode==b.MONO&&(ue.force_ms=!1),ue.VBR==t.vbr_off&&ue.VBR_mean_bitrate_kbps!=128&&ue.brate==0&&(ue.brate=ue.VBR_mean_bitrate_kbps),ue.VBR==t.vbr_off||ue.VBR==t.vbr_mtrh||ue.VBR==t.vbr_mt||(ue.free_format=!1),ue.VBR==t.vbr_off&&ue.brate==0&&p.EQ(ue.compression_ratio,0)&&(ue.compression_ratio=11.025),ue.VBR==t.vbr_off&&ue.compression_ratio>0&&(ue.out_samplerate==0&&(ue.out_samplerate=map2MP3Frequency(int(.97*ue.in_samplerate))),ue.brate=0|ue.out_samplerate*16*_e.channels_out/(1e3*ue.compression_ratio),_e.samplerate_index=K(ue.out_samplerate,ue),ue.free_format||(ue.brate=ne(ue.brate,ue.version,ue.out_samplerate))),ue.out_samplerate!=0&&(ue.out_samplerate<16e3?(ue.VBR_mean_bitrate_kbps=Math.max(ue.VBR_mean_bitrate_kbps,8),ue.VBR_mean_bitrate_kbps=Math.min(ue.VBR_mean_bitrate_kbps,64)):ue.out_samplerate<32e3?(ue.VBR_mean_bitrate_kbps=Math.max(ue.VBR_mean_bitrate_kbps,8),ue.VBR_mean_bitrate_kbps=Math.min(ue.VBR_mean_bitrate_kbps,160)):(ue.VBR_mean_bitrate_kbps=Math.max(ue.VBR_mean_bitrate_kbps,32),ue.VBR_mean_bitrate_kbps=Math.min(ue.VBR_mean_bitrate_kbps,320))),ue.lowpassfreq==0){var we=16e3;switch(ue.VBR){case t.vbr_off:{var pe=new Z;ae(pe,ue.brate),we=pe.lowerlimit;break}case t.vbr_abr:{var pe=new Z;ae(pe,ue.VBR_mean_bitrate_kbps),we=pe.lowerlimit;break}case t.vbr_rh:{var ze=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=ue.VBR_q&&ue.VBR_q<=9){var Ze=ze[ue.VBR_q],Je=ze[ue.VBR_q+1],nt=ue.VBR_q_frac;we=linear_int(Ze,Je,nt)}else we=19500;break}default:{var ze=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=ue.VBR_q&&ue.VBR_q<=9){var Ze=ze[ue.VBR_q],Je=ze[ue.VBR_q+1],nt=ue.VBR_q_frac;we=linear_int(Ze,Je,nt)}else we=19500}}ue.mode==b.MONO&&(ue.VBR==t.vbr_off||ue.VBR==t.vbr_abr)&&(we*=1.5),ue.lowpassfreq=we|0}if(ue.out_samplerate==0&&(2*ue.lowpassfreq>ue.in_samplerate&&(ue.lowpassfreq=ue.in_samplerate/2),ue.out_samplerate=V(ue.lowpassfreq|0,ue.in_samplerate)),ue.lowpassfreq=Math.min(20500,ue.lowpassfreq),ue.lowpassfreq=Math.min(ue.out_samplerate/2,ue.lowpassfreq),ue.VBR==t.vbr_off&&(ue.compression_ratio=ue.out_samplerate*16*_e.channels_out/(1e3*ue.brate)),ue.VBR==t.vbr_abr&&(ue.compression_ratio=ue.out_samplerate*16*_e.channels_out/(1e3*ue.VBR_mean_bitrate_kbps)),ue.bWriteVbrTag||(ue.findReplayGain=!1,ue.decode_on_the_fly=!1,_e.findPeakSample=!1),_e.findReplayGain=ue.findReplayGain,_e.decode_on_the_fly=ue.decode_on_the_fly,_e.decode_on_the_fly&&(_e.findPeakSample=!0),_e.findReplayGain&&k.InitGainAnalysis(_e.rgdata,ue.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return ue.internal_flags=null,-6;switch(_e.decode_on_the_fly&&!ue.decode_only&&(_e.hip!=null&&M.hip_decode_exit(_e.hip),_e.hip=M.hip_decode_init()),_e.mode_gr=ue.out_samplerate<=24e3?1:2,ue.framesize=576*_e.mode_gr,ue.encoder_delay=g.ENCDELAY,_e.resample_ratio=ue.in_samplerate/ue.out_samplerate,ue.VBR){case t.vbr_mt:case t.vbr_rh:case t.vbr_mtrh:{var Pt=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];ue.compression_ratio=Pt[ue.VBR_q]}break;case t.vbr_abr:ue.compression_ratio=ue.out_samplerate*16*_e.channels_out/(1e3*ue.VBR_mean_bitrate_kbps);break;default:ue.compression_ratio=ue.out_samplerate*16*_e.channels_out/(1e3*ue.brate);break}if(ue.mode==b.NOT_SET&&(ue.mode=b.JOINT_STEREO),ue.highpassfreq>0?(_e.highpass1=2*ue.highpassfreq,ue.highpasswidth>=0?_e.highpass2=2*(ue.highpassfreq+ue.highpasswidth):_e.highpass2=2*ue.highpassfreq,_e.highpass1/=ue.out_samplerate,_e.highpass2/=ue.out_samplerate):(_e.highpass1=0,_e.highpass2=0),ue.lowpassfreq>0?(_e.lowpass2=2*ue.lowpassfreq,ue.lowpasswidth>=0?(_e.lowpass1=2*(ue.lowpassfreq-ue.lowpasswidth),_e.lowpass1<0&&(_e.lowpass1=0)):_e.lowpass1=2*ue.lowpassfreq,_e.lowpass1/=ue.out_samplerate,_e.lowpass2/=ue.out_samplerate):(_e.lowpass1=0,_e.lowpass2=0),Te(ue),_e.samplerate_index=K(ue.out_samplerate,ue),_e.samplerate_index<0)return ue.internal_flags=null,-1;if(ue.VBR==t.vbr_off){if(ue.free_format)_e.bitrate_index=0;else if(ue.brate=ne(ue.brate,ue.version,ue.out_samplerate),_e.bitrate_index=ie(ue.brate,ue.version,ue.out_samplerate),_e.bitrate_index<=0)return ue.internal_flags=null,-1}else _e.bitrate_index=1;ue.analysis&&(ue.bWriteVbrTag=!1),_e.pinfo!=null&&(ue.bWriteVbrTag=!1),R.init_bit_stream_w(_e);for(var vt=_e.samplerate_index+3*ue.version+6*(ue.out_samplerate<16e3?1:0),At=0;At<g.SBMAX_l+1;At++)_e.scalefac_band.l[At]=B.sfBandIndex[vt].l[At];for(var At=0;At<g.PSFB21+1;At++){var Re=(_e.scalefac_band.l[22]-_e.scalefac_band.l[21])/g.PSFB21,ce=_e.scalefac_band.l[21]+At*Re;_e.scalefac_band.psfb21[At]=ce}_e.scalefac_band.psfb21[g.PSFB21]=576;for(var At=0;At<g.SBMAX_s+1;At++)_e.scalefac_band.s[At]=B.sfBandIndex[vt].s[At];for(var At=0;At<g.PSFB12+1;At++){var Re=(_e.scalefac_band.s[13]-_e.scalefac_band.s[12])/g.PSFB12,ce=_e.scalefac_band.s[12]+At*Re;_e.scalefac_band.psfb12[At]=ce}_e.scalefac_band.psfb12[g.PSFB12]=192,ue.version==1?_e.sideinfo_len=_e.channels_out==1?21:36:_e.sideinfo_len=_e.channels_out==1?13:21,ue.error_protection&&(_e.sideinfo_len+=2),be(ue),_e.Class_ID=Y;{var W;for(W=0;W<19;W++)_e.nsPsy.pefirbuf[W]=700*_e.mode_gr*_e.channels_out;ue.ATHtype==-1&&(ue.ATHtype=4)}switch(a(ue.VBR_q<=9),a(ue.VBR_q>=0),ue.VBR){case t.vbr_mt:ue.VBR=t.vbr_mtrh;case t.vbr_mtrh:{ue.useTemporal==null&&(ue.useTemporal=!1),P.apply_preset(ue,500-ue.VBR_q*10,0),ue.quality<0&&(ue.quality=LAME_DEFAULT_QUALITY),ue.quality<5&&(ue.quality=0),ue.quality>5&&(ue.quality=5),_e.PSY.mask_adjust=ue.maskingadjust,_e.PSY.mask_adjust_short=ue.maskingadjust_short,ue.experimentalY?_e.sfb21_extra=!1:_e.sfb21_extra=ue.out_samplerate>44e3,_e.iteration_loop=new VBRNewIterationLoop(U);break}case t.vbr_rh:{P.apply_preset(ue,500-ue.VBR_q*10,0),_e.PSY.mask_adjust=ue.maskingadjust,_e.PSY.mask_adjust_short=ue.maskingadjust_short,ue.experimentalY?_e.sfb21_extra=!1:_e.sfb21_extra=ue.out_samplerate>44e3,ue.quality>6&&(ue.quality=6),ue.quality<0&&(ue.quality=LAME_DEFAULT_QUALITY),_e.iteration_loop=new VBROldIterationLoop(U);break}default:{var le;_e.sfb21_extra=!1,ue.quality<0&&(ue.quality=LAME_DEFAULT_QUALITY),le=ue.VBR,le==t.vbr_off&&(ue.VBR_mean_bitrate_kbps=ue.brate),P.apply_preset(ue,ue.VBR_mean_bitrate_kbps,0),ue.VBR=le,_e.PSY.mask_adjust=ue.maskingadjust,_e.PSY.mask_adjust_short=ue.maskingadjust_short,le==t.vbr_off?_e.iteration_loop=new d(U):_e.iteration_loop=new ABRIterationLoop(U);break}}if(a(ue.scale>=0),ue.VBR!=t.vbr_off){if(_e.VBR_min_bitrate=1,_e.VBR_max_bitrate=14,ue.out_samplerate<16e3&&(_e.VBR_max_bitrate=8),ue.VBR_min_bitrate_kbps!=0&&(ue.VBR_min_bitrate_kbps=ne(ue.VBR_min_bitrate_kbps,ue.version,ue.out_samplerate),_e.VBR_min_bitrate=ie(ue.VBR_min_bitrate_kbps,ue.version,ue.out_samplerate),_e.VBR_min_bitrate<0)||ue.VBR_max_bitrate_kbps!=0&&(ue.VBR_max_bitrate_kbps=ne(ue.VBR_max_bitrate_kbps,ue.version,ue.out_samplerate),_e.VBR_max_bitrate=ie(ue.VBR_max_bitrate_kbps,ue.version,ue.out_samplerate),_e.VBR_max_bitrate<0))return-1;ue.VBR_min_bitrate_kbps=_.bitrate_table[ue.version][_e.VBR_min_bitrate],ue.VBR_max_bitrate_kbps=_.bitrate_table[ue.version][_e.VBR_max_bitrate],ue.VBR_mean_bitrate_kbps=Math.min(_.bitrate_table[ue.version][_e.VBR_max_bitrate],ue.VBR_mean_bitrate_kbps),ue.VBR_mean_bitrate_kbps=Math.max(_.bitrate_table[ue.version][_e.VBR_min_bitrate],ue.VBR_mean_bitrate_kbps)}return ue.tune&&(_e.PSY.mask_adjust+=ue.tune_value_a,_e.PSY.mask_adjust_short+=ue.tune_value_a),Ie(ue),a(ue.scale>=0),ue.athaa_type<0?_e.ATH.useAdjust=3:_e.ATH.useAdjust=ue.athaa_type,_e.ATH.aaSensitivityP=Math.pow(10,ue.athaa_sensitivity/-10),ue.short_blocks==null&&(ue.short_blocks=r.short_block_allowed),ue.short_blocks==r.short_block_allowed&&(ue.mode==b.JOINT_STEREO||ue.mode==b.STEREO)&&(ue.short_blocks=r.short_block_coupled),ue.quant_comp<0&&(ue.quant_comp=1),ue.quant_comp_short<0&&(ue.quant_comp_short=0),ue.msfix<0&&(ue.msfix=0),ue.exp_nspsytune=ue.exp_nspsytune|1,ue.internal_flags.nsPsy.attackthre<0&&(ue.internal_flags.nsPsy.attackthre=c.NSATTACKTHRE),ue.internal_flags.nsPsy.attackthre_s<0&&(ue.internal_flags.nsPsy.attackthre_s=c.NSATTACKTHRE_S),a(ue.scale>=0),ue.scale<0&&(ue.scale=1),ue.ATHtype<0&&(ue.ATHtype=4),ue.ATHcurve<0&&(ue.ATHcurve=4),ue.athaa_loudapprox<0&&(ue.athaa_loudapprox=2),ue.interChRatio<0&&(ue.interChRatio=0),ue.useTemporal==null&&(ue.useTemporal=!0),_e.slot_lag=_e.frac_SpF=0,ue.VBR==t.vbr_off&&(_e.slot_lag=_e.frac_SpF=(ue.version+1)*72e3*ue.brate%ue.out_samplerate|0),B.iteration_init(ue),z.psymodel_init(ue),a(ue.scale>=0),0};function Pe(ue,_e){(ue.in_buffer_0==null||ue.in_buffer_nsamples<_e)&&(ue.in_buffer_0=i(_e),ue.in_buffer_1=i(_e),ue.in_buffer_nsamples=_e)}this.lame_encode_flush=function(ue,_e,we,pe){var ze=ue.internal_flags,Ze=o([2,1152]),Je=0,nt,Pt,vt,At,Re=ze.mf_samples_to_encode-g.POSTDELAY,ce=$e(ue);if(ze.mf_samples_to_encode<1)return 0;for(nt=0,ue.in_samplerate!=ue.out_samplerate&&(Re+=16*ue.out_samplerate/ue.in_samplerate),vt=ue.framesize-Re%ue.framesize,vt<576&&(vt+=ue.framesize),ue.encoder_padding=vt,At=(Re+vt)/ue.framesize;At>0&&Je>=0;){var W=ce-ze.mf_size,le=ue.frameNum;W*=ue.in_samplerate,W/=ue.out_samplerate,W>1152&&(W=1152),W<1&&(W=1),Pt=pe-nt,pe==0&&(Pt=0),Je=this.lame_encode_buffer(ue,Ze[0],Ze[1],W,_e,we,Pt),we+=Je,nt+=Je,At-=le!=ue.frameNum?1:0}if(ze.mf_samples_to_encode=0,Je<0||(Pt=pe-nt,pe==0&&(Pt=0),R.flush_bitstream(ue),Je=R.copy_buffer(ze,_e,we,Pt,1),Je<0))return Je;if(we+=Je,nt+=Je,Pt=pe-nt,pe==0&&(Pt=0),ue.write_id3tag_automatic){if(L.id3tag_write_v1(ue),Je=R.copy_buffer(ze,_e,we,Pt,0),Je<0)return Je;nt+=Je}return nt},this.lame_encode_buffer=function(ue,_e,we,pe,ze,Ze,Je){var nt=ue.internal_flags,Pt=[null,null];if(nt.Class_ID!=Y)return-3;if(pe==0)return 0;Pe(nt,pe),Pt[0]=nt.in_buffer_0,Pt[1]=nt.in_buffer_1;for(var vt=0;vt<pe;vt++)Pt[0][vt]=_e[vt],nt.channels_in>1&&(Pt[1][vt]=we[vt]);return tt(ue,Pt[0],Pt[1],pe,ze,Ze,Je)};function $e(ue){var _e=g.BLKSIZE+ue.framesize-g.FFTOFFSET;return _e=Math.max(_e,512+ue.framesize-32),_e}function tt(ue,_e,we,pe,ze,Ze,Je){var nt=ue.internal_flags,Pt=0,vt,At,Re,ce,W,le=[null,null],Se=[null,null];if(nt.Class_ID!=Y)return-3;if(pe==0)return 0;if(W=R.copy_buffer(nt,ze,Ze,Je,0),W<0)return W;if(Ze+=W,Pt+=W,Se[0]=_e,Se[1]=we,p.NEQ(ue.scale,0)&&p.NEQ(ue.scale,1))for(At=0;At<pe;++At)Se[0][At]*=ue.scale,nt.channels_out==2&&(Se[1][At]*=ue.scale);if(p.NEQ(ue.scale_left,0)&&p.NEQ(ue.scale_left,1))for(At=0;At<pe;++At)Se[0][At]*=ue.scale_left;if(p.NEQ(ue.scale_right,0)&&p.NEQ(ue.scale_right,1))for(At=0;At<pe;++At)Se[1][At]*=ue.scale_right;if(ue.num_channels==2&&nt.channels_out==1)for(At=0;At<pe;++At)Se[0][At]=.5*(Se[0][At]+Se[1][At]),Se[1][At]=0;ce=$e(ue),le[0]=nt.mfbuf[0],le[1]=nt.mfbuf[1];for(var Ae=0;pe>0;){var ye=[null,null],ve=0,Xe=0;ye[0]=Se[0],ye[1]=Se[1];var Me=new ut;if(Oe(ue,le,ye,Ae,pe,Me),ve=Me.n_in,Xe=Me.n_out,nt.findReplayGain&&!nt.decode_on_the_fly&&k.AnalyzeSamples(nt.rgdata,le[0],nt.mf_size,le[1],nt.mf_size,Xe,nt.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(pe-=ve,Ae+=ve,nt.channels_out==2,nt.mf_size+=Xe,a(nt.mf_size<=u.MFSIZE),nt.mf_samples_to_encode<1&&(nt.mf_samples_to_encode=g.ENCDELAY+g.POSTDELAY),nt.mf_samples_to_encode+=Xe,nt.mf_size>=ce){var Ve=Je-Pt;if(Je==0&&(Ve=0),vt=qe(ue,le[0],le[1],ze,Ze,Ve),vt<0)return vt;for(Ze+=vt,Pt+=vt,nt.mf_size-=ue.framesize,nt.mf_samples_to_encode-=ue.framesize,Re=0;Re<nt.channels_out;Re++)for(At=0;At<nt.mf_size;At++)le[Re][At]=le[Re][At+ue.framesize]}}return Pt}function qe(ue,_e,we,pe,ze,Ze){var Je=y.enc.lame_encode_mp3_frame(ue,_e,we,pe,ze,Ze);return ue.frameNum++,Je}function ut(){this.n_in=0,this.n_out=0}function te(){this.num_used=0}function Ne(ue,_e){return _e!=0?Ne(_e,ue%_e):ue}function Be(ue,_e,we){var pe=Math.PI*_e;ue/=we,ue<0&&(ue=0),ue>1&&(ue=1);var ze=ue-.5,Ze=.42-.5*Math.cos(2*ue*Math.PI)+.08*Math.cos(4*ue*Math.PI);return Math.abs(ze)<1e-9?pe/Math.PI:Ze*Math.sin(we*pe*ze)/(Math.PI*we*ze)}function De(ue,_e,we,pe,ze,Ze,Je,nt,Pt){var vt=ue.internal_flags,At,Re=0,ce,W=ue.out_samplerate/Ne(ue.out_samplerate,ue.in_samplerate);W>u.BPC&&(W=u.BPC);var le=Math.abs(vt.resample_ratio-Math.floor(.5+vt.resample_ratio))<1e-4?1:0,Se=1/vt.resample_ratio;Se>1&&(Se=1);var Ae=31;Ae%2==0&&--Ae,Ae+=le;var ye=Ae+1;if(vt.fill_buffer_resample_init==0){for(vt.inbuf_old[0]=i(ye),vt.inbuf_old[1]=i(ye),At=0;At<=2*W;++At)vt.blackfilt[At]=i(ye);for(vt.itime[0]=0,vt.itime[1]=0,Re=0;Re<=2*W;Re++){var ve=0,Xe=(Re-W)/(2*W);for(At=0;At<=Ae;At++)ve+=vt.blackfilt[Re][At]=Be(At-Xe,Se,Ae);for(At=0;At<=Ae;At++)vt.blackfilt[Re][At]/=ve}vt.fill_buffer_resample_init=1}var Me=vt.inbuf_old[Pt];for(ce=0;ce<pe;ce++){var Ve,je;if(Ve=ce*vt.resample_ratio,Re=0|Math.floor(Ve-vt.itime[Pt]),Ae+Re-Ae/2>=Je)break;var Xe=Ve-vt.itime[Pt]-(Re+.5*(Ae%2));je=0|Math.floor(Xe*2*W+W+.5);var We=0;for(At=0;At<=Ae;++At){var ct=0|At+Re-Ae/2,Fe;Fe=ct<0?Me[ye+ct]:ze[Ze+ct],We+=Fe*vt.blackfilt[je][At]}_e[we+ce]=We}if(nt.num_used=Math.min(Je,Ae+Re-Ae/2),vt.itime[Pt]+=nt.num_used-ce*vt.resample_ratio,nt.num_used>=ye)for(At=0;At<ye;At++)Me[At]=ze[Ze+nt.num_used+At-ye];else{var rt=ye-nt.num_used;for(At=0;At<rt;++At)Me[At]=Me[At+nt.num_used];for(Re=0;At<ye;++At,++Re)Me[At]=ze[Ze+Re];a(Re==nt.num_used)}return ce}function Oe(ue,_e,we,pe,ze,Ze){var Je=ue.internal_flags;if(Je.resample_ratio<.9999||Je.resample_ratio>1.0001)for(var nt=0;nt<Je.channels_out;nt++){var Pt=new te;Ze.n_out=De(ue,_e[nt],Je.mf_size,ue.framesize,we[nt],pe,ze,Pt,nt),Ze.n_in=Pt.num_used}else{Ze.n_out=Math.min(ue.framesize,ze),Ze.n_in=Ze.n_out;for(var vt=0;vt<Ze.n_out;++vt)_e[0][Je.mf_size+vt]=we[0][pe+vt],Je.channels_out==2&&(_e[1][Je.mf_size+vt]=we[1][pe+vt])}}}return AP=m,AP}var W7e=Lo,Em=W7e.VbrMode;function q7e(){var n=I8();function e(u,h,f,d,p,_,g,m,b,y,x,T,k,R,P){this.vbr_q=u,this.quant_comp=h,this.quant_comp_s=f,this.expY=d,this.st_lrm=p,this.st_s=_,this.masking_adj=g,this.masking_adj_short=m,this.ath_lower=b,this.ath_curve=y,this.ath_sensitivity=x,this.interch=T,this.safejoint=k,this.sfb21mod=R,this.msfix=P}function t(u,h,f,d,p,_,g,m,b,y,x,T,k,R){this.quant_comp=h,this.quant_comp_s=f,this.safejoint=d,this.nsmsfix=p,this.st_lrm=_,this.st_s=g,this.nsbass=m,this.scale=b,this.masking_adj=y,this.ath_lower=x,this.ath_curve=T,this.interch=k,this.sfscale=R}var r;this.setModules=function(u){r=u};var i=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],s=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function o(u,h,f){var d=u.VBR==Em.vbr_rh?i:s,p=u.VBR_q_frac,_=d[h],g=d[h+1],m=_;_.st_lrm=_.st_lrm+p*(g.st_lrm-_.st_lrm),_.st_s=_.st_s+p*(g.st_s-_.st_s),_.masking_adj=_.masking_adj+p*(g.masking_adj-_.masking_adj),_.masking_adj_short=_.masking_adj_short+p*(g.masking_adj_short-_.masking_adj_short),_.ath_lower=_.ath_lower+p*(g.ath_lower-_.ath_lower),_.ath_curve=_.ath_curve+p*(g.ath_curve-_.ath_curve),_.ath_sensitivity=_.ath_sensitivity+p*(g.ath_sensitivity-_.ath_sensitivity),_.interch=_.interch+p*(g.interch-_.interch),_.msfix=_.msfix+p*(g.msfix-_.msfix),l(u,m.vbr_q),f!=0?u.quant_comp=m.quant_comp:Math.abs(u.quant_comp- -1)>0||(u.quant_comp=m.quant_comp),f!=0?u.quant_comp_short=m.quant_comp_s:Math.abs(u.quant_comp_short- -1)>0||(u.quant_comp_short=m.quant_comp_s),m.expY!=0&&(u.experimentalY=m.expY!=0),f!=0?u.internal_flags.nsPsy.attackthre=m.st_lrm:Math.abs(u.internal_flags.nsPsy.attackthre- -1)>0||(u.internal_flags.nsPsy.attackthre=m.st_lrm),f!=0?u.internal_flags.nsPsy.attackthre_s=m.st_s:Math.abs(u.internal_flags.nsPsy.attackthre_s- -1)>0||(u.internal_flags.nsPsy.attackthre_s=m.st_s),f!=0?u.maskingadjust=m.masking_adj:Math.abs(u.maskingadjust-0)>0||(u.maskingadjust=m.masking_adj),f!=0?u.maskingadjust_short=m.masking_adj_short:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=m.masking_adj_short),f!=0?u.ATHlower=-m.ath_lower/10:Math.abs(-u.ATHlower*10-0)>0||(u.ATHlower=-m.ath_lower/10),f!=0?u.ATHcurve=m.ath_curve:Math.abs(u.ATHcurve- -1)>0||(u.ATHcurve=m.ath_curve),f!=0?u.athaa_sensitivity=m.ath_sensitivity:Math.abs(u.athaa_sensitivity- -1)>0||(u.athaa_sensitivity=m.ath_sensitivity),m.interch>0&&(f!=0?u.interChRatio=m.interch:Math.abs(u.interChRatio- -1)>0||(u.interChRatio=m.interch)),m.safejoint>0&&(u.exp_nspsytune=u.exp_nspsytune|m.safejoint),m.sfb21mod>0&&(u.exp_nspsytune=u.exp_nspsytune|m.sfb21mod<<20),f!=0?u.msfix=m.msfix:Math.abs(u.msfix- -1)>0||(u.msfix=m.msfix),f==0&&(u.VBR_q=h,u.VBR_q_frac=p)}var a=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function c(u,h,f){var d=h,p=r.nearestBitrateFullIndex(h);if(u.VBR=Em.vbr_abr,u.VBR_mean_bitrate_kbps=d,u.VBR_mean_bitrate_kbps=Math.min(u.VBR_mean_bitrate_kbps,320),u.VBR_mean_bitrate_kbps=Math.max(u.VBR_mean_bitrate_kbps,8),u.brate=u.VBR_mean_bitrate_kbps,u.VBR_mean_bitrate_kbps>320&&(u.disable_reservoir=!0),a[p].safejoint>0&&(u.exp_nspsytune=u.exp_nspsytune|2),a[p].sfscale>0&&(u.internal_flags.noise_shaping=2),Math.abs(a[p].nsbass)>0){var _=int(a[p].nsbass*4);_<0&&(_+=64),u.exp_nspsytune=u.exp_nspsytune|_<<2}return f!=0?u.quant_comp=a[p].quant_comp:Math.abs(u.quant_comp- -1)>0||(u.quant_comp=a[p].quant_comp),f!=0?u.quant_comp_short=a[p].quant_comp_s:Math.abs(u.quant_comp_short- -1)>0||(u.quant_comp_short=a[p].quant_comp_s),f!=0?u.msfix=a[p].nsmsfix:Math.abs(u.msfix- -1)>0||(u.msfix=a[p].nsmsfix),f!=0?u.internal_flags.nsPsy.attackthre=a[p].st_lrm:Math.abs(u.internal_flags.nsPsy.attackthre- -1)>0||(u.internal_flags.nsPsy.attackthre=a[p].st_lrm),f!=0?u.internal_flags.nsPsy.attackthre_s=a[p].st_s:Math.abs(u.internal_flags.nsPsy.attackthre_s- -1)>0||(u.internal_flags.nsPsy.attackthre_s=a[p].st_s),f!=0?u.scale=a[p].scale:Math.abs(u.scale- -1)>0||(u.scale=a[p].scale),f!=0?u.maskingadjust=a[p].masking_adj:Math.abs(u.maskingadjust-0)>0||(u.maskingadjust=a[p].masking_adj),a[p].masking_adj>0?f!=0?u.maskingadjust_short=a[p].masking_adj*.9:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=a[p].masking_adj*.9):f!=0?u.maskingadjust_short=a[p].masking_adj*1.1:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=a[p].masking_adj*1.1),f!=0?u.ATHlower=-a[p].ath_lower/10:Math.abs(-u.ATHlower*10-0)>0||(u.ATHlower=-a[p].ath_lower/10),f!=0?u.ATHcurve=a[p].ath_curve:Math.abs(u.ATHcurve- -1)>0||(u.ATHcurve=a[p].ath_curve),f!=0?u.interChRatio=a[p].interch:Math.abs(u.interChRatio- -1)>0||(u.interChRatio=a[p].interch),h}this.apply_preset=function(u,h,f){switch(h){case n.R3MIX:{h=n.V3,u.VBR=Em.vbr_mtrh;break}case n.MEDIUM:{h=n.V4,u.VBR=Em.vbr_rh;break}case n.MEDIUM_FAST:{h=n.V4,u.VBR=Em.vbr_mtrh;break}case n.STANDARD:{h=n.V2,u.VBR=Em.vbr_rh;break}case n.STANDARD_FAST:{h=n.V2,u.VBR=Em.vbr_mtrh;break}case n.EXTREME:{h=n.V0,u.VBR=Em.vbr_rh;break}case n.EXTREME_FAST:{h=n.V0,u.VBR=Em.vbr_mtrh;break}case n.INSANE:return h=320,u.preset=h,c(u,h,f),u.VBR=Em.vbr_off,h}switch(u.preset=h,h){case n.V9:return o(u,9,f),h;case n.V8:return o(u,8,f),h;case n.V7:return o(u,7,f),h;case n.V6:return o(u,6,f),h;case n.V5:return o(u,5,f),h;case n.V4:return o(u,4,f),h;case n.V3:return o(u,3,f),h;case n.V2:return o(u,2,f),h;case n.V1:return o(u,1,f),h;case n.V0:return o(u,0,f),h}return 8<=h&&h<=320?c(u,h,f):(u.preset=0,h)};function l(u,h){var f=0;return 0>h&&(f=-1,h=0),9<h&&(f=-1,h=9),u.VBR_q=h,u.VBR_q_frac=0,f}}var Y7e=q7e;function K7e(){this.setModules=function(n,e){}}var X7e=K7e;function Z7e(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var J7e=Z7e,Dne=Lo,OV=Dne.new_float,Q7e=Dne.new_int;function e9e(){this.global_gain=0,this.sfb_count1=0,this.step=Q7e(39),this.noise=OV(39),this.noise_log=OV(39)}var t9e=e9e,sT=Lo,pv=sT.System,IV=sT.VbrMode,RP=sT.Util,rE=sT.Arrays,KT=sT.new_float,XT=sT.assert,n9e=X7e,CP=J7e,r9e=t9e,Di=gu(),NV=R8,PV=h3;function i9e(){var n;this.rv=null;var e;this.qupvt=null;var t,r=new n9e,i;this.setModules=function(m,b,y,x){n=m,e=b,this.rv=b,t=y,this.qupvt=y,i=x,r.setModules(t,i)},this.ms_convert=function(m,b){for(var y=0;y<576;++y){var x=m.tt[b][0].xr[y],T=m.tt[b][1].xr[y];m.tt[b][0].xr[y]=(x+T)*(RP.SQRT2*.5),m.tt[b][1].xr[y]=(x-T)*(RP.SQRT2*.5)}};function s(m,b,y,x){x=0;for(var T=0;T<=y;++T){var k=Math.abs(m.xr[T]);x+=k,b[T]=Math.sqrt(k*Math.sqrt(k)),b[T]>m.xrpow_max&&(m.xrpow_max=b[T])}return x}this.init_xrpow=function(m,b,y){var x=0,T=0|b.max_nonzero_coeff;if(b.xrpow_max=0,rE.fill(y,T,576,0),x=s(b,y,T,x),x>1e-20){var k=0;m.substep_shaping&2&&(k=1);for(var R=0;R<b.psymax;R++)m.pseudohalf[R]=k;return!0}return rE.fill(b.l3_enc,0,576,0),!1};function o(m,b){var y=m.ATH,x=b.xr;if(b.block_type!=Di.SHORT_TYPE)for(var T=!1,k=Di.PSFB21-1;k>=0&&!T;k--){var R=m.scalefac_band.psfb21[k],P=m.scalefac_band.psfb21[k+1],B=t.athAdjust(y.adjust,y.psfb21[k],y.floor);m.nsPsy.longfact[21]>1e-12&&(B*=m.nsPsy.longfact[21]);for(var U=P-1;U>=R;U--)if(Math.abs(x[U])<B)x[U]=0;else{T=!0;break}}else for(var z=0;z<3;z++)for(var T=!1,k=Di.PSFB12-1;k>=0&&!T;k--){var R=m.scalefac_band.s[12]*3+(m.scalefac_band.s[13]-m.scalefac_band.s[12])*z+(m.scalefac_band.psfb12[k]-m.scalefac_band.psfb12[0]),P=R+(m.scalefac_band.psfb12[k+1]-m.scalefac_band.psfb12[k]),I=t.athAdjust(y.adjust,y.psfb12[k],y.floor);m.nsPsy.shortfact[12]>1e-12&&(I*=m.nsPsy.shortfact[12]);for(var U=P-1;U>=R;U--)if(Math.abs(x[U])<I)x[U]=0;else{T=!0;break}}}this.init_outer_loop=function(m,b){b.part2_3_length=0,b.big_values=0,b.count1=0,b.global_gain=210,b.scalefac_compress=0,b.table_select[0]=0,b.table_select[1]=0,b.table_select[2]=0,b.subblock_gain[0]=0,b.subblock_gain[1]=0,b.subblock_gain[2]=0,b.subblock_gain[3]=0,b.region0_count=0,b.region1_count=0,b.preflag=0,b.scalefac_scale=0,b.count1table_select=0,b.part2_length=0,b.sfb_lmax=Di.SBPSY_l,b.sfb_smin=Di.SBPSY_s,b.psy_lmax=m.sfb21_extra?Di.SBMAX_l:Di.SBPSY_l,b.psymax=b.psy_lmax,b.sfbmax=b.sfb_lmax,b.sfbdivide=11;for(var y=0;y<Di.SBMAX_l;y++)b.width[y]=m.scalefac_band.l[y+1]-m.scalefac_band.l[y],b.window[y]=3;if(b.block_type==Di.SHORT_TYPE){var x=KT(576);b.sfb_smin=0,b.sfb_lmax=0,b.mixed_block_flag!=0&&(b.sfb_smin=3,b.sfb_lmax=m.mode_gr*2+4),b.psymax=b.sfb_lmax+3*((m.sfb21_extra?Di.SBMAX_s:Di.SBPSY_s)-b.sfb_smin),b.sfbmax=b.sfb_lmax+3*(Di.SBPSY_s-b.sfb_smin),b.sfbdivide=b.sfbmax-18,b.psy_lmax=b.sfb_lmax;var T=m.scalefac_band.l[b.sfb_lmax];pv.arraycopy(b.xr,0,x,0,576);for(var y=b.sfb_smin;y<Di.SBMAX_s;y++)for(var k=m.scalefac_band.s[y],R=m.scalefac_band.s[y+1],P=0;P<3;P++)for(var B=k;B<R;B++)b.xr[T++]=x[3*B+P];for(var U=b.sfb_lmax,y=b.sfb_smin;y<Di.SBMAX_s;y++)b.width[U]=b.width[U+1]=b.width[U+2]=m.scalefac_band.s[y+1]-m.scalefac_band.s[y],b.window[U]=0,b.window[U+1]=1,b.window[U+2]=2,U+=3}b.count1bits=0,b.sfb_partition_table=t.nr_of_sfb_block[0][0],b.slen[0]=0,b.slen[1]=0,b.slen[2]=0,b.slen[3]=0,b.max_nonzero_coeff=575,rE.fill(b.scalefac,0),o(m,b)};function a(m){this.ordinal=m}a.BINSEARCH_NONE=new a(0),a.BINSEARCH_UP=new a(1),a.BINSEARCH_DOWN=new a(2);function c(m,b,y,x,T){var k,R=m.CurrentStep[x],P=!1,B=m.OldValue[x],U=a.BINSEARCH_NONE;for(b.global_gain=B,y-=b.part2_length;;){var z;if(k=i.count_bits(m,T,b,null),R==1||k==y)break;k>y?(U==a.BINSEARCH_DOWN&&(P=!0),P&&(R/=2),U=a.BINSEARCH_UP,z=R):(U==a.BINSEARCH_UP&&(P=!0),P&&(R/=2),U=a.BINSEARCH_DOWN,z=-R),b.global_gain+=z,b.global_gain<0&&(b.global_gain=0,P=!0),b.global_gain>255&&(b.global_gain=255,P=!0)}for(XT(b.global_gain>=0),XT(b.global_gain<256);k>y&&b.global_gain<255;)b.global_gain++,k=i.count_bits(m,T,b,null);return m.CurrentStep[x]=B-b.global_gain>=4?4:2,m.OldValue[x]=b.global_gain,b.part2_3_length=k,k}this.trancate_smallspectrums=function(m,b,y,x){var T=KT(PV.SFBMAX);if(!(!(m.substep_shaping&4)&&b.block_type==Di.SHORT_TYPE||m.substep_shaping&128)){t.calc_noise(b,y,T,new CP,null);for(var R=0;R<576;R++){var k=0;b.l3_enc[R]!=0&&(k=Math.abs(b.xr[R])),x[R]=k}var R=0,P=8;b.block_type==Di.SHORT_TYPE&&(P=6);do{var B,U,z,I,L=b.width[P];if(R+=L,!(T[P]>=1)&&(rE.sort(x,R-L,L),!BitStream.EQ(x[R-1],0))){B=(1-T[P])*y[P],U=0,I=0;do{var M;for(z=1;I+z<L&&!BitStream.NEQ(x[I+R-L],x[I+R+z-L]);z++);if(M=x[I+R-L]*x[I+R-L]*z,B<M){I!=0&&(U=x[I+R-L-1]);break}B-=M,I+=z}while(I<L);if(!BitStream.EQ(U,0))do Math.abs(b.xr[R-L])<=U&&(b.l3_enc[R-L]=0);while(--L>0)}}while(++P<b.psymax);b.part2_3_length=i.noquant_count_bits(m,b,null)}};function l(m){for(var b=0;b<m.sfbmax;b++)if(m.scalefac[b]+m.subblock_gain[m.window[b]]==0)return!1;return!0}function u(m){return RP.FAST_LOG10(.368+.632*m*m*m)}function h(m,b){for(var y=1e-37,x=0;x<b.psymax;x++)y+=u(m[x]);return Math.max(1e-20,y)}function f(m,b,y,x,T){var k;switch(m){default:case 9:{b.over_count>0?(k=y.over_SSD<=b.over_SSD,y.over_SSD==b.over_SSD&&(k=y.bits<b.bits)):k=y.max_noise<0&&y.max_noise*10+y.bits<=b.max_noise*10+b.bits;break}case 0:k=y.over_count<b.over_count||y.over_count==b.over_count&&y.over_noise<b.over_noise||y.over_count==b.over_count&&BitStream.EQ(y.over_noise,b.over_noise)&&y.tot_noise<b.tot_noise;break;case 8:y.max_noise=h(T,x);case 1:k=y.max_noise<b.max_noise;break;case 2:k=y.tot_noise<b.tot_noise;break;case 3:k=y.tot_noise<b.tot_noise&&y.max_noise<b.max_noise;break;case 4:k=y.max_noise<=0&&b.max_noise>.2||y.max_noise<=0&&b.max_noise<0&&b.max_noise>y.max_noise-.2&&y.tot_noise<b.tot_noise||y.max_noise<=0&&b.max_noise>0&&b.max_noise>y.max_noise-.2&&y.tot_noise<b.tot_noise+b.over_noise||y.max_noise>0&&b.max_noise>-.05&&b.max_noise>y.max_noise-.1&&y.tot_noise+y.over_noise<b.tot_noise+b.over_noise||y.max_noise>0&&b.max_noise>-.1&&b.max_noise>y.max_noise-.15&&y.tot_noise+y.over_noise+y.over_noise<b.tot_noise+b.over_noise+b.over_noise;break;case 5:k=y.over_noise<b.over_noise||BitStream.EQ(y.over_noise,b.over_noise)&&y.tot_noise<b.tot_noise;break;case 6:k=y.over_noise<b.over_noise||BitStream.EQ(y.over_noise,b.over_noise)&&(y.max_noise<b.max_noise||BitStream.EQ(y.max_noise,b.max_noise)&&y.tot_noise<=b.tot_noise);break;case 7:k=y.over_count<b.over_count||y.over_noise<b.over_noise;break}return b.over_count==0&&(k=k&&y.bits<b.bits),k}function d(m,b,y,x,T){var k=m.internal_flags,R;b.scalefac_scale==0?R=1.2968395546510096:R=1.6817928305074292;for(var P=0,B=0;B<b.sfbmax;B++)P<y[B]&&(P=y[B]);var U=k.noise_shaping_amp;switch(U==3&&(T?U=2:U=1),U){case 2:break;case 1:P>1?P=Math.pow(P,.5):P*=.95;break;case 0:default:P>1?P=1:P*=.95;break}for(var z=0,B=0;B<b.sfbmax;B++){var I=b.width[B],L;if(z+=I,!(y[B]<P)){if(k.substep_shaping&2&&(k.pseudohalf[B]=k.pseudohalf[B]==0?1:0,k.pseudohalf[B]==0&&k.noise_shaping_amp==2))return;for(b.scalefac[B]++,L=-I;L<0;L++)x[z+L]*=R,x[z+L]>b.xrpow_max&&(b.xrpow_max=x[z+L]);if(k.noise_shaping_amp==2)return}}}function p(m,b){for(var y=1.2968395546510096,x=0,T=0;T<m.sfbmax;T++){var k=m.width[T],R=m.scalefac[T];if(m.preflag!=0&&(R+=t.pretab[T]),x+=k,R&1){R++;for(var P=-k;P<0;P++)b[x+P]*=y,b[x+P]>m.xrpow_max&&(m.xrpow_max=b[x+P])}m.scalefac[T]=R>>1}m.preflag=0,m.scalefac_scale=1}function _(m,b,y){var x,T=b.scalefac;for(x=0;x<b.sfb_lmax;x++)if(T[x]>=16)return!0;for(var k=0;k<3;k++){var R=0,P=0;for(x=b.sfb_lmax+k;x<b.sfbdivide;x+=3)R<T[x]&&(R=T[x]);for(;x<b.sfbmax;x+=3)P<T[x]&&(P=T[x]);if(!(R<16&&P<8)){if(b.subblock_gain[k]>=7)return!0;b.subblock_gain[k]++;var B=m.scalefac_band.l[b.sfb_lmax];for(x=b.sfb_lmax+k;x<b.sfbmax;x+=3){var U,z=b.width[x],I=T[x];if(I=I-(4>>b.scalefac_scale),I>=0){T[x]=I,B+=z*3;continue}T[x]=0;{var L=210+(I<<b.scalefac_scale+1);U=t.IPOW20(L)}B+=z*(k+1);for(var M=-z;M<0;M++)y[B+M]*=U,y[B+M]>b.xrpow_max&&(b.xrpow_max=y[B+M]);B+=z*(3-k-1)}{var U=t.IPOW20(202);B+=b.width[x]*(k+1);for(var M=-b.width[x];M<0;M++)y[B+M]*=U,y[B+M]>b.xrpow_max&&(b.xrpow_max=y[B+M])}}}return!1}function g(m,b,y,x,T){var k=m.internal_flags;d(m,b,y,x,T);var R=l(b);return R?!1:(k.mode_gr==2?R=i.scale_bitcount(b):R=i.scale_bitcount_lsf(k,b),R?(k.noise_shaping>1&&(rE.fill(k.pseudohalf,0),b.scalefac_scale==0?(p(b,x),R=!1):b.block_type==Di.SHORT_TYPE&&k.subblock_gain>0&&(R=_(k,b,x)||l(b))),R||(k.mode_gr==2?R=i.scale_bitcount(b):R=i.scale_bitcount_lsf(k,b)),!R):!0)}this.outer_loop=function(m,b,y,x,T,k){var R=m.internal_flags,P=new NV,B=KT(576),U=KT(PV.SFBMAX),z=new CP,I,L=new r9e,M=9999999,F=!1,Z=!1,$=0;if(c(R,b,k,T,x),R.noise_shaping==0)return 100;t.calc_noise(b,y,U,z,L),z.bits=b.part2_3_length,P.assign(b);var Y=0;for(pv.arraycopy(x,0,B,0,576);!F;){do{var Q=new CP,q,V=255;if(R.substep_shaping&2?q=20:q=3,R.sfb21_extra&&(U[P.sfbmax]>1||P.block_type==Di.SHORT_TYPE&&(U[P.sfbmax+1]>1||U[P.sfbmax+2]>1))||!g(m,P,U,x,Z))break;P.scalefac_scale!=0&&(V=254);var K=k-P.part2_length;if(K<=0)break;for(;(P.part2_3_length=i.count_bits(R,x,P,L))>K&&P.global_gain<=V;)P.global_gain++;if(P.global_gain>V)break;if(z.over_count==0){for(;(P.part2_3_length=i.count_bits(R,x,P,L))>M&&P.global_gain<=V;)P.global_gain++;if(P.global_gain>V)break}if(t.calc_noise(P,y,U,Q,L),Q.bits=P.part2_3_length,b.block_type!=Di.SHORT_TYPE?I=m.quant_comp:I=m.quant_comp_short,I=f(I,z,Q,P,U)?1:0,I!=0)M=b.part2_3_length,z=Q,b.assign(P),Y=0,pv.arraycopy(x,0,B,0,576);else if(R.full_outer_loop==0&&(++Y>q&&z.over_count==0||R.noise_shaping_amp==3&&Z&&Y>30||R.noise_shaping_amp==3&&Z&&P.global_gain-$>15))break}while(P.global_gain+P.scalefac_scale<255);R.noise_shaping_amp==3?Z?F=!0:(P.assign(b),pv.arraycopy(B,0,x,0,576),Y=0,$=P.global_gain,Z=!0):F=!0}return XT(b.global_gain+b.scalefac_scale<=255),m.VBR==IV.vbr_rh||m.VBR==IV.vbr_mtrh?pv.arraycopy(B,0,x,0,576):R.substep_shaping&1&&trancate_smallspectrums(R,b,y,x),z.over_count},this.iteration_finish_one=function(m,b,y){var x=m.l3_side,T=x.tt[b][y];i.best_scalefac_store(m,b,y,x),m.use_best_huffman==1&&i.best_huffman_divide(m,T),e.ResvAdjust(m,T)},this.VBR_encode_granule=function(m,b,y,x,T,k,R){var P=m.internal_flags,B=new NV,U=KT(576),z=R,I=R+1,L=(R+k)/2,M,F,Z=0,$=P.sfb21_extra;XT(z<=LameInternalFlags.MAX_BITS_PER_CHANNEL),rE.fill(B.l3_enc,0);do L>z-42?P.sfb21_extra=!1:P.sfb21_extra=$,F=outer_loop(m,b,y,x,T,L),F<=0?(Z=1,I=b.part2_3_length,B.assign(b),pv.arraycopy(x,0,U,0,576),R=I-32,M=R-k,L=(R+k)/2):(k=L+32,M=R-k,L=(R+k)/2,Z!=0&&(Z=2,b.assign(B),pv.arraycopy(U,0,x,0,576)));while(M>12);P.sfb21_extra=$,Z==2&&pv.arraycopy(B.l3_enc,0,b.l3_enc,0,576),XT(b.part2_3_length<=z)},this.get_framebits=function(m,b){var y=m.internal_flags;y.bitrate_index=y.VBR_min_bitrate;var x=n.getframebits(m);y.bitrate_index=1,x=n.getframebits(m);for(var T=1;T<=y.VBR_max_bitrate;T++){y.bitrate_index=T;var k=new MeanBits(x);b[T]=e.ResvFrameBegin(m,k),x=k.bits}},this.VBR_old_prepare=function(m,b,y,x,T,k,R,P,B){var U=m.internal_flags,z,I=0,L=1,M=0;U.bitrate_index=U.VBR_max_bitrate;var F=e.ResvFrameBegin(m,new MeanBits(0))/U.mode_gr;get_framebits(m,k);for(var Z=0;Z<U.mode_gr;Z++){var $=t.on_pe(m,b,P[Z],F,Z,0);U.mode_ext==Di.MPG_MD_MS_LR&&(ms_convert(U.l3_side,Z),t.reduce_side(P[Z],y[Z],F,$));for(var Y=0;Y<U.channels_out;++Y){var Q=U.l3_side.tt[Z][Y];Q.block_type!=Di.SHORT_TYPE?(I=1.28/(1+Math.exp(3.5-b[Z][Y]/300))-.05,z=U.PSY.mask_adjust-I):(I=2.56/(1+Math.exp(3.5-b[Z][Y]/300))-.14,z=U.PSY.mask_adjust_short-I),U.masking_lower=Math.pow(10,z*.1),init_outer_loop(U,Q),B[Z][Y]=t.calc_xmin(m,x[Z][Y],Q,T[Z][Y]),B[Z][Y]!=0&&(L=0),R[Z][Y]=126,M+=P[Z][Y]}}for(var Z=0;Z<U.mode_gr;Z++)for(var Y=0;Y<U.channels_out;Y++)M>k[U.VBR_max_bitrate]&&(P[Z][Y]*=k[U.VBR_max_bitrate],P[Z][Y]/=M),R[Z][Y]>P[Z][Y]&&(R[Z][Y]=P[Z][Y]);return L},this.bitpressure_strategy=function(m,b,y,x){for(var T=0;T<m.mode_gr;T++)for(var k=0;k<m.channels_out;k++){for(var R=m.l3_side.tt[T][k],P=b[T][k],B=0,U=0;U<R.psy_lmax;U++)P[B++]*=1+.029*U*U/Di.SBMAX_l/Di.SBMAX_l;if(R.block_type==Di.SHORT_TYPE)for(var U=R.sfb_smin;U<Di.SBMAX_s;U++)P[B++]*=1+.029*U*U/Di.SBMAX_s/Di.SBMAX_s,P[B++]*=1+.029*U*U/Di.SBMAX_s/Di.SBMAX_s,P[B++]*=1+.029*U*U/Di.SBMAX_s/Di.SBMAX_s;x[T][k]=0|Math.max(y[T][k],.9*x[T][k])}},this.VBR_new_prepare=function(m,b,y,x,T,k){var R=m.internal_flags,P=1,B=0,U=0,z;if(m.free_format){R.bitrate_index=0;var I=new MeanBits(B);z=e.ResvFrameBegin(m,I),B=I.bits,T[0]=z}else{R.bitrate_index=R.VBR_max_bitrate;var I=new MeanBits(B);e.ResvFrameBegin(m,I),B=I.bits,get_framebits(m,T),z=T[R.VBR_max_bitrate]}for(var L=0;L<R.mode_gr;L++){t.on_pe(m,b,k[L],B,L,0),R.mode_ext==Di.MPG_MD_MS_LR&&ms_convert(R.l3_side,L);for(var M=0;M<R.channels_out;++M){var F=R.l3_side.tt[L][M];R.masking_lower=Math.pow(10,R.PSY.mask_adjust*.1),init_outer_loop(R,F),t.calc_xmin(m,y[L][M],F,x[L][M])!=0&&(P=0),U+=k[L][M]}}for(var L=0;L<R.mode_gr;L++)for(var M=0;M<R.channels_out;M++)U>z&&(k[L][M]*=z,k[L][M]/=U);return P},this.calc_target_bits=function(m,b,y,x,T,k){var R=m.internal_flags,P=R.l3_side,B,U,z,I,L=0;R.bitrate_index=R.VBR_max_bitrate;var M=new MeanBits(L);for(k[0]=e.ResvFrameBegin(m,M),L=M.bits,R.bitrate_index=1,L=n.getframebits(m)-R.sideinfo_len*8,T[0]=L/(R.mode_gr*R.channels_out),L=m.VBR_mean_bitrate_kbps*m.framesize*1e3,R.substep_shaping&1&&(L*=1.09),L/=m.out_samplerate,L-=R.sideinfo_len*8,L/=R.mode_gr*R.channels_out,B=.93+.07*(11-m.compression_ratio)/(11-5.5),B<.9&&(B=.9),B>1&&(B=1),U=0;U<R.mode_gr;U++){var F=0;for(z=0;z<R.channels_out;z++){if(x[U][z]=int(B*L),b[U][z]>700){var Z=int((b[U][z]-700)/1.4),$=P.tt[U][z];x[U][z]=int(B*L),$.block_type==Di.SHORT_TYPE&&Z<L/2&&(Z=L/2),Z>L*3/2?Z=L*3/2:Z<0&&(Z=0),x[U][z]+=Z}x[U][z]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(x[U][z]=LameInternalFlags.MAX_BITS_PER_CHANNEL),F+=x[U][z]}if(F>LameInternalFlags.MAX_BITS_PER_GRANULE)for(z=0;z<R.channels_out;++z)x[U][z]*=LameInternalFlags.MAX_BITS_PER_GRANULE,x[U][z]/=F}if(R.mode_ext==Di.MPG_MD_MS_LR)for(U=0;U<R.mode_gr;U++)t.reduce_side(x[U],y[U],L*R.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(I=0,U=0;U<R.mode_gr;U++)for(z=0;z<R.channels_out;z++)x[U][z]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(x[U][z]=LameInternalFlags.MAX_BITS_PER_CHANNEL),I+=x[U][z];if(I>k[0])for(U=0;U<R.mode_gr;U++)for(z=0;z<R.channels_out;z++)x[U][z]*=k[0],x[U][z]/=I}}var s9e=i9e,o9e=Lo,DV=o9e.assert;function a9e(){var n;this.setModules=function(e){n=e},this.ResvFrameBegin=function(e,t){var r=e.internal_flags,i,s=r.l3_side,o=n.getframebits(e);t.bits=(o-r.sideinfo_len*8)/r.mode_gr;var a=8*256*r.mode_gr-8;e.brate>320?i=8*int(e.brate*1e3/(e.out_samplerate/1152)/8+.5):(i=8*1440,e.strict_ISO&&(i=8*int(32e4/(e.out_samplerate/1152)/8+.5))),r.ResvMax=i-o,r.ResvMax>a&&(r.ResvMax=a),(r.ResvMax<0||e.disable_reservoir)&&(r.ResvMax=0);var c=t.bits*r.mode_gr+Math.min(r.ResvSize,r.ResvMax);return c>i&&(c=i),DV(r.ResvMax%8==0),DV(r.ResvMax>=0),s.resvDrain_pre=0,r.pinfo!=null&&(r.pinfo.mean_bits=t.bits/2,r.pinfo.resvsize=r.ResvSize),c},this.ResvMaxBits=function(e,t,r,i){var s=e.internal_flags,o,a=s.ResvSize,c=s.ResvMax;i!=0&&(a+=t),s.substep_shaping&1&&(c*=.9),r.bits=t,a*10>c*9?(o=a-c*9/10,r.bits+=o,s.substep_shaping|=128):(o=0,s.substep_shaping&=127,!e.disable_reservoir&&!(s.substep_shaping&1)&&(r.bits-=.1*t));var l=a<s.ResvMax*6/10?a:s.ResvMax*6/10;return l-=o,l<0&&(l=0),l},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(e,t){var r,i=e.l3_side;e.ResvSize+=t*e.mode_gr;var s=0;i.resvDrain_post=0,i.resvDrain_pre=0,(r=e.ResvSize%8)!=0&&(s+=r),r=e.ResvSize-s-e.ResvMax,r>0&&(s+=r);{var o=Math.min(i.main_data_begin*8,s)/8;i.resvDrain_pre+=8*o,s-=8*o,e.ResvSize-=8*o,i.main_data_begin-=o}i.resvDrain_post+=s,e.ResvSize-=s}}var c9e=a9e;function l9e(){var n="http://www.mp3dev.org/",e=3,t=98,r=4,i=0,s=93;this.getLameVersion=function(){return e+"."+t+"."+r},this.getLameShortVersion=function(){return e+"."+t+"."+r},this.getLameVeryShortVersion=function(){return"LAME"+e+"."+t+"r"},this.getPsyVersion=function(){return i+"."+s},this.getLameUrl=function(){return n},this.getLameOsBitness=function(){return"32bits"}}var u9e=l9e,oT=Lo,h9e=oT.System,MP=oT.VbrMode,LV=oT.ShortBlock,f9e=oT.Arrays,Z2=oT.new_byte,d9e=oT.assert;OA.NUMTOCENTRIES=100;OA.MAXFRAMESIZE=2880;function OA(){var n,e,t;this.setModules=function(L,M,F){n=L,e=M,t=F};var r=1,i=2,s=4,o=8,a=OA.NUMTOCENTRIES,c=OA.MAXFRAMESIZE,l=a+4+4+4+4+4,u=l+9+1+1+8+1+1+3+1+1+2+4+2+2,h=128,f=64,d=32,p=null,_="Xing",g="Info",m=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function b(L,M){if(L.nVbrNumFrames++,L.sum+=M,L.seen++,!(L.seen<L.want)&&(L.pos<L.size&&(L.bag[L.pos]=L.sum,L.pos++,L.seen=0),L.pos==L.size)){for(var F=1;F<L.size;F+=2)L.bag[F/2]=L.bag[F];L.want*=2,L.pos/=2}}function y(L,M){if(!(L.pos<=0))for(var F=1;F<a;++F){var Z=F/a,$,Y,Q=0|Math.floor(Z*L.pos);Q>L.pos-1&&(Q=L.pos-1),$=L.bag[Q],Y=L.sum;var q=0|256*$/Y;q>255&&(q=255),M[F]=255&q}}this.addVbrFrame=function(L){var M=L.internal_flags,F=Tables.bitrate_table[L.version][M.bitrate_index];d9e(M.VBR_seek_table.bag!=null),b(M.VBR_seek_table,F)};function x(L,M){var F=L[M+0]&255;return F<<=8,F|=L[M+1]&255,F<<=8,F|=L[M+2]&255,F<<=8,F|=L[M+3]&255,F}function T(L,M,F){L[M+0]=255&(F>>24&255),L[M+1]=255&(F>>16&255),L[M+2]=255&(F>>8&255),L[M+3]=255&(F&255)}function k(L,M,F){L[M+0]=255&(F>>8&255),L[M+1]=255&(F&255)}function R(L,M){return new String(L,M,_.length(),p).equals(_)||new String(L,M,g.length(),p).equals(g)}function P(L,M,F){return 255&(L<<M|F&~(-1<<M))}function B(L,M){var F=L.internal_flags;M[0]=P(M[0],8,255),M[1]=P(M[1],3,7),M[1]=P(M[1],1,L.out_samplerate<16e3?0:1),M[1]=P(M[1],1,L.version),M[1]=P(M[1],2,1),M[1]=P(M[1],1,L.error_protection?0:1),M[2]=P(M[2],4,F.bitrate_index),M[2]=P(M[2],2,F.samplerate_index),M[2]=P(M[2],1,0),M[2]=P(M[2],1,L.extension),M[3]=P(M[3],2,L.mode.ordinal()),M[3]=P(M[3],2,F.mode_ext),M[3]=P(M[3],1,L.copyright),M[3]=P(M[3],1,L.original),M[3]=P(M[3],2,L.emphasis),M[0]=255;var Z=255&(M[1]&241),$;L.version==1?$=h:L.out_samplerate<16e3?$=d:$=f,L.VBR==MP.vbr_off&&($=L.brate);var Y;L.free_format?Y=0:Y=255&16*n.BitrateIndex($,L.version,L.out_samplerate),L.version==1?(M[1]=255&(Z|10),Z=255&(M[2]&13),M[2]=255&(Y|Z)):(M[1]=255&(Z|2),Z=255&(M[2]&13),M[2]=255&(Y|Z))}this.getVbrTag=function(L){var M=new VBRTagData,F=0;M.flags=0;var Z=L[F+1]>>3&1,$=L[F+2]>>2&3,Y=L[F+3]>>6&3,Q=L[F+2]>>4&15;if(Q=Tables.bitrate_table[Z][Q],L[F+1]>>4==14?M.samprate=Tables.samplerate_table[2][$]:M.samprate=Tables.samplerate_table[Z][$],Z!=0?Y!=3?F+=36:F+=21:Y!=3?F+=21:F+=13,!R(L,F))return null;F+=4,M.hId=Z;var q=M.flags=x(L,F);if(F+=4,q&r&&(M.frames=x(L,F),F+=4),q&i&&(M.bytes=x(L,F),F+=4),q&s){if(M.toc!=null)for(var V=0;V<a;V++)M.toc[V]=L[F+V];F+=a}M.vbrScale=-1,q&o&&(M.vbrScale=x(L,F),F+=4),M.headersize=(Z+1)*72e3*Q/M.samprate,F+=21;var K=L[F+0]<<4;K+=L[F+1]>>4;var ne=(L[F+1]&15)<<8;return ne+=L[F+2]&255,(K<0||K>3e3)&&(K=-1),(ne<0||ne>3e3)&&(ne=-1),M.encDelay=K,M.encPadding=ne,M},this.InitVbrTag=function(L){var M=L.internal_flags,F;L.version==1?F=h:L.out_samplerate<16e3?F=d:F=f,L.VBR==MP.vbr_off&&(F=L.brate);var Z=(L.version+1)*72e3*F/L.out_samplerate,$=M.sideinfo_len+u;if(M.VBR_seek_table.TotalFrameSize=Z,Z<$||Z>c){L.bWriteVbrTag=!1;return}M.VBR_seek_table.nVbrNumFrames=0,M.VBR_seek_table.nBytesWritten=0,M.VBR_seek_table.sum=0,M.VBR_seek_table.seen=0,M.VBR_seek_table.want=1,M.VBR_seek_table.pos=0,M.VBR_seek_table.bag==null&&(M.VBR_seek_table.bag=new int[400],M.VBR_seek_table.size=400);var Y=Z2(c);B(L,Y);for(var Q=M.VBR_seek_table.TotalFrameSize,q=0;q<Q;++q)e.add_dummy_byte(L,Y[q]&255,1)};function U(L,M){var F=M^L;return M=M>>8^m[F&255],M}this.updateMusicCRC=function(L,M,F,Z){for(var $=0;$<Z;++$)L[0]=U(M[F+$],L[0])};function z(L,M,F,Z,$){var Y=L.internal_flags,Q=0,q=L.encoder_delay,V=L.encoder_padding,K=100-10*L.VBR_q-L.quality,ne=t.getLameVeryShortVersion(),ie,ae=0,Te,Ie=[1,5,3,2,4,0,3],be=0|(L.lowpassfreq/100+.5>255?255:L.lowpassfreq/100+.5),Pe=0,$e=0,tt=0,qe=L.internal_flags.noise_shaping,ut=0,te=0,Ne=0,Be=0,De=0,Oe=(L.exp_nspsytune&1)!=0,ue=(L.exp_nspsytune&2)!=0,_e=!1,we=!1,pe=L.internal_flags.nogap_total,ze=L.internal_flags.nogap_current,Ze=L.ATHtype,Je=0,nt;switch(L.VBR){case vbr_abr:nt=L.VBR_mean_bitrate_kbps;break;case vbr_off:nt=L.brate;break;default:nt=L.VBR_min_bitrate_kbps}switch(L.VBR.ordinal()<Ie.length?ie=Ie[L.VBR.ordinal()]:ie=0,Te=16*ae+ie,Y.findReplayGain&&(Y.RadioGain>510&&(Y.RadioGain=510),Y.RadioGain<-510&&(Y.RadioGain=-510),$e=8192,$e|=3072,Y.RadioGain>=0?$e|=Y.RadioGain:($e|=512,$e|=-Y.RadioGain)),Y.findPeakSample&&(Pe=Math.abs(0|Y.PeakSample/32767*Math.pow(2,23)+.5)),pe!=-1&&(ze>0&&(we=!0),ze<pe-1&&(_e=!0)),Je=Ze+((Oe?1:0)<<4)+((ue?1:0)<<5)+((_e?1:0)<<6)+((we?1:0)<<7),K<0&&(K=0),L.mode){case MONO:ut=0;break;case STEREO:ut=1;break;case DUAL_CHANNEL:ut=2;break;case JOINT_STEREO:L.force_ms?ut=4:ut=3;break;case NOT_SET:default:ut=7;break}L.in_samplerate<=32e3?Ne=0:L.in_samplerate==48e3?Ne=2:L.in_samplerate>48e3?Ne=3:Ne=1,(L.short_blocks==LV.short_block_forced||L.short_blocks==LV.short_block_dispensed||L.lowpassfreq==-1&&L.highpassfreq==-1||L.scale_left<L.scale_right||L.scale_left>L.scale_right||L.disable_reservoir&&L.brate<320||L.noATH||L.ATHonly||Ze==0||L.in_samplerate<=32e3)&&(te=1),Be=qe+(ut<<2)+(te<<5)+(Ne<<6),De=Y.nMusicCRC,T(F,Z+Q,K),Q+=4;for(var Pt=0;Pt<9;Pt++)F[Z+Q+Pt]=255&ne.charAt(Pt);Q+=9,F[Z+Q]=255&Te,Q++,F[Z+Q]=255&be,Q++,T(F,Z+Q,Pe),Q+=4,k(F,Z+Q,$e),Q+=2,k(F,Z+Q,tt),Q+=2,F[Z+Q]=255&Je,Q++,nt>=255?F[Z+Q]=255:F[Z+Q]=255&nt,Q++,F[Z+Q]=255&q>>4,F[Z+Q+1]=255&(q<<4)+(V>>8),F[Z+Q+2]=255&V,Q+=3,F[Z+Q]=255&Be,Q++,F[Z+Q++]=0,k(F,Z+Q,L.preset),Q+=2,T(F,Z+Q,M),Q+=4,k(F,Z+Q,De),Q+=2;for(var vt=0;vt<Q;vt++)$=U(F[Z+vt],$);return k(F,Z+Q,$),Q+=2,Q}function I(L){L.seek(0);var M=Z2(10);L.readFully(M);var F;return new String(M,"ISO-8859-1").startsWith("ID3")?F=0:F=((M[6]&127)<<21|(M[7]&127)<<14|(M[8]&127)<<7|M[9]&127)+M.length,F}this.getLameTagFrame=function(L,M){var F=L.internal_flags;if(!L.bWriteVbrTag||F.Class_ID!=Lame.LAME_ID||F.VBR_seek_table.pos<=0)return 0;if(M.length<F.VBR_seek_table.TotalFrameSize)return F.VBR_seek_table.TotalFrameSize;f9e.fill(M,0,F.VBR_seek_table.TotalFrameSize,0),B(L,M);var Z=Z2(a);if(L.free_format)for(var $=1;$<a;++$)Z[$]=255&255*$/100;else y(F.VBR_seek_table,Z);var Y=F.sideinfo_len;L.error_protection&&(Y-=2),L.VBR==MP.vbr_off?(M[Y++]=255&g.charAt(0),M[Y++]=255&g.charAt(1),M[Y++]=255&g.charAt(2),M[Y++]=255&g.charAt(3)):(M[Y++]=255&_.charAt(0),M[Y++]=255&_.charAt(1),M[Y++]=255&_.charAt(2),M[Y++]=255&_.charAt(3)),T(M,Y,r+i+s+o),Y+=4,T(M,Y,F.VBR_seek_table.nVbrNumFrames),Y+=4;var Q=F.VBR_seek_table.nBytesWritten+F.VBR_seek_table.TotalFrameSize;T(M,Y,0|Q),Y+=4,h9e.arraycopy(Z,0,M,Y,Z.length),Y+=Z.length,L.error_protection&&e.CRC_writeheader(F,M);for(var q=0,$=0;$<Y;$++)q=U(M[$],q);return Y+=z(L,Q,M,Y,q),F.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(L,M){var F=L.internal_flags;if(F.VBR_seek_table.pos<=0||(M.seek(M.length()),M.length()==0))return-1;var Z=I(M);M.seek(Z);var $=Z2(c),Y=getLameTagFrame(L,$);return Y>$.length?-1:(Y<1||M.write($,0,Y),0)}}var p9e=OA,Lne=Lo,UV=Lne.new_byte,m9e=Lne.assert,g9e=I8(),_9e=Y7e,v9e=kne,y9e=Nne(),b9e=s9e,S9e=Pne(),E9e=c9e,x9e=PR,T9e=O8();gu();var w9e=u9e,A9e=p9e;function R9e(){this.setModules=function(n,e){}}function C9e(){this.setModules=function(n,e,t){}}function M9e(){}function k9e(){this.setModules=function(n,e){}}function O9e(n,e,t){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),n=1,e=44100,t=128);var r=new g9e,i=new R9e,s=new v9e,o=new T9e,a=new _9e,c=new y9e,l=new b9e,u=new A9e,h=new w9e,f=new k9e,d=new E9e,p=new S9e,_=new C9e,g=new M9e;r.setModules(s,o,a,c,l,u,h,f,g),o.setModules(s,g,h,u),f.setModules(o,h),a.setModules(r),l.setModules(o,d,c,p),c.setModules(p,d,r.enc.psy),d.setModules(o),p.setModules(c),u.setModules(r,o,h),i.setModules(_,g),_.setModules(h,f,a);var m=r.lame_init();m.num_channels=n,m.in_samplerate=e,m.brate=t,m.mode=x9e.STEREO,m.quality=3,m.bWriteVbrTag=!1,m.disable_reservoir=!0,m.write_id3tag_automatic=!1,r.lame_init_params(m);var b=1152,y=0|1.25*b+7200,x=UV(y);this.encodeBuffer=function(T,k){n==1&&(k=T),m9e(T.length==k.length),T.length>b&&(b=T.length,y=0|1.25*b+7200,x=UV(y));var R=r.lame_encode_buffer(m,T,k,T.length,x,0,y);return new Int8Array(x.subarray(0,R))},this.flush=function(){var T=r.lame_encode_flush(m,x,0,y);return new Int8Array(x.subarray(0,T))}}function Um(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function d3(n){return n.charCodeAt(0)<<24|n.charCodeAt(1)<<16|n.charCodeAt(2)<<8|n.charCodeAt(3)}Um.RIFF=d3("RIFF");Um.WAVE=d3("WAVE");Um.fmt_=d3("fmt ");Um.data=d3("data");Um.readHeader=function(n){var e=new Um,t=n.getUint32(0,!1);if(Um.RIFF==t&&(n.getUint32(4,!0),Um.WAVE==n.getUint32(8,!1)&&Um.fmt_==n.getUint32(12,!1))){var r=n.getUint32(16,!0),i=20;switch(r){case 16:case 18:e.channels=n.getUint16(i+2,!0),e.sampleRate=n.getUint32(i+4,!0);break;default:throw"extended fmt chunk not implemented"}i+=r;for(var s=Um.data,o=0;s!=t&&(t=n.getUint32(i,!1),o=n.getUint32(i+4,!0),s!=t);)i+=o+8;return e.dataLen=o,e.dataOffset=i+8,e}};var I9e=O9e;async function N9e(n){const e=Qr(),t=n.getChannelData(0),r=n.sampleRate,i=new I9e(1,r,128),s=1152,o=[];for(let c=0;c<t.length;c+=s){o.length%64===0&&Nr(Ke,e,`encoding chunk (${c}/${t.length})`);const l=new Int16Array(s);for(let h=0;h<s;h++)c+h<t.length&&(l[h]=t[c+h]<0?t[c+h]*32768:t[c+h]*32767);const u=i.encodeBuffer(l);u.length>0&&o.push(u),o.length%16===0&&await Mh(10)}const a=i.flush();return a.length>0&&o.push(a),Nr(Ke,e,`total chunks ${o.length+1}`),await Mh(100),new Uint8Array(o.reduce((c,l)=>{const u=new Uint8Array(c.length+l.length);return u.set(c,0),u.set(l,c.length),u},new Uint8Array(0)))}const BV=4,P9e={a:1,b:2,c:3,d:4,e:5,f:6,g:7,x:8,A:1,B:2,C:3,D:4,E:5,F:6,G:7,X:8,"#":9,"!":10,y:13,t:14,s:15,i:16,q:17,h:18,w:19,Y:13,T:14,S:15,I:16,Q:17,H:18,W:19,3:20,".":21,"+":11,"-":12,0:22,1:23,2:24,p:25,4:26,5:27,6:29,7:28,8:30,9:31},Une="64n";function D9e(n){return tl({[Une]:n}).toNotation()}function L9e(n){return tl({[Une]:n}).toSeconds()}function U9e(n,e,t,r=!0){let i=e,s=4,o=2,a="",c="";const l=[];function u(){c="",a="",i+=L9e(o)}function h(){const f=D9e(o);c===null?(l.push([i,[n,f,c]]),u()):Xt(c)?(l.push([i,[n,f,c]]),u()):c.startsWith("#")?(l.push([i,[n,f,c]]),u()):c!==""&&(l.push([i,[n,f,`${c}${a}${s}`]]),u())}if(rn(t))c=t;else for(let f=0;f<t.length;++f){switch(t[f]){case 9:case 10:break;default:h();break}switch(t[f]){case 1:c="A";break;case 2:c="B";break;case 3:c="C";break;case 4:c="D";break;case 5:c="E";break;case 6:c="F";break;case 7:c="G";break;case 8:c=null;break;case 9:a+="#";break;case 10:a+="b";break;case 11:s<8&&++s;break;case 12:s>0&&--s;break;case 13:o=1;break;case 14:o=2;break;case 15:o=4;break;case 16:o=8;break;case 17:o=16;break;case 18:o=32;break;case 19:o=64;break;case 20:o=Math.round(o/3);break;case 21:o=Math.round(o*3/2);break;case 22:c=0;break;case 23:c=1;break;case 24:c=2;break;case 25:c=3;break;case 26:c=4;break;case 27:c=5;break;case 29:c=6;break;case 28:c=7;break;case 30:c=8;break;case 31:c=9;break}}return h(),r&&l.push([i,[n,"8n",-1]]),l}function FV(n){const e=[],t=n.split(";");for(let r=0;r<t.length;++r){const i=[],s=t[r];for(let o=0;o<s.length;++o){const a=P9e[s[o]];fe(a)&&i.push(a)}e.push(i)}return e}const B9e="/assets/sidechainworklet-4DrJ3CKW.js";class N8 extends fu{name="SidechainCompressor";threshold;ratio;attack;release;mix;makeupGain;sidechain=new Pr;_audioworkletnode=this.context.createAudioWorkletNode("sidechaincompressorprocessor",{numberOfInputs:2,outputChannelCount:[2]});constructor(){const e=jn(N8.getDefaults(),arguments,["threshold","ratio","attack","release","mix","makeupGain"]);super(e),this.threshold=new $r({context:this.context,param:this._audioworkletnode.parameters.get("threshold"),value:e.threshold,minValue:-128,maxValue:0}),this.ratio=new $r({context:this.context,param:this._audioworkletnode.parameters.get("ratio"),value:e.ratio,minValue:1,maxValue:128}),this.attack=new $r({context:this.context,param:this._audioworkletnode.parameters.get("attack"),value:e.attack,minValue:1e-4,maxValue:128}),this.release=new $r({context:this.context,param:this._audioworkletnode.parameters.get("release"),value:e.release,minValue:1e-4,maxValue:128}),this.mix=new $r({context:this.context,param:this._audioworkletnode.parameters.get("mix"),value:e.mix,minValue:0,maxValue:1}),this.makeupGain=new $r({context:this.context,param:this._audioworkletnode.parameters.get("makeupGain"),value:e.makeupGain,minValue:-128,maxValue:60}),this.connectEffect(this._audioworkletnode),this.sidechain.connect(this._audioworkletnode,0,1)}static getDefaults(){return Object.assign(fu.getDefaults(),{threshold:-28,ratio:4,attack:.005,release:.005,mix:1,makeupGain:0})}dispose(){return super.dispose(),this._audioworkletnode.disconnect(),this}}function F9e(){return _o().rawContext.audioWorklet.addModule(B9e)}class P8 extends If{name="AlgoSynth";_operator1;_operator2;_operator3;_operator4;_modulation1;_modulation2;_modulation3;oscillator1;oscillator2;oscillator3;oscillator4;envelope1;envelope2;envelope3;envelope4;frequency;detune;modulationindex1;modulationindex2;modulationindex3;harmonicity1;harmonicity2;harmonicity3;constructor(){const e=jn(P8.getDefaults(),arguments);switch(super(e),this._operator1=new sc({context:this.context,oscillator:e.oscillator1,envelope:e.envelope1,volume:-10}),this.oscillator1=this._operator1.oscillator,this.envelope1=this._operator1.envelope,this._operator2=new sc({context:this.context,oscillator:e.oscillator2,envelope:e.envelope2,volume:-10}),this.oscillator2=this._operator2.oscillator,this.envelope2=this._operator2.envelope,this._operator3=new sc({context:this.context,oscillator:e.oscillator3,envelope:e.envelope3,volume:-10}),this.oscillator3=this._operator3.oscillator,this.envelope3=this._operator3.envelope,this._operator4=new sc({context:this.context,oscillator:e.oscillator4,envelope:e.envelope4,onsilence:()=>this.onsilence(this),volume:-10}),this.oscillator4=this._operator4.oscillator,this.envelope4=this._operator4.envelope,this.frequency=new xi({context:this.context,units:"frequency"}),this.detune=new xi({context:this.context,value:e.detune,units:"cents"}),this.harmonicity1=new su({context:this.context,value:e.harmonicity1,minValue:0}),this.harmonicity2=new su({context:this.context,value:e.harmonicity2,minValue:0}),this.harmonicity3=new su({context:this.context,value:e.harmonicity3,minValue:0}),this.modulationindex1=new su({context:this.context,value:e.modulationindex1}),this.modulationindex2=new su({context:this.context,value:e.modulationindex2}),this.modulationindex3=new su({context:this.context,value:e.modulationindex3}),this._modulation1=new Pr({context:this.context,gain:0}),this._modulation2=new Pr({context:this.context,gain:0}),this._modulation3=new Pr({context:this.context,gain:0}),this.frequency.chain(this.harmonicity1,this._operator1.frequency),this.frequency.chain(this.harmonicity2,this._operator2.frequency),this.frequency.chain(this.harmonicity3,this._operator3.frequency),this.frequency.connect(this._operator4.frequency),this.frequency.chain(this.modulationindex1,this._modulation1),this.frequency.chain(this.modulationindex2,this._modulation2),this.frequency.chain(this.modulationindex3,this._modulation3),this.detune.fan(this._operator1.detune,this._operator2.detune,this._operator3.detune,this._operator4.detune),e.algorithm){case 0:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator2.frequency),this._operator2.connect(this._modulation2.gain),this._modulation2.connect(this._operator3.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 1:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator3.frequency),this._operator2.connect(this._modulation2.gain),this._modulation2.connect(this._operator3.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 2:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator4.frequency),this._operator2.connect(this._modulation2.gain),this._modulation2.connect(this._operator3.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 3:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator4.frequency),this._operator2.connect(this._modulation2.gain),this._modulation2.connect(this._operator4.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 4:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator2.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 5:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator2.frequency),this._operator1.connect(this._modulation2.gain),this._modulation2.connect(this._operator3.frequency),this._operator1.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 6:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator2.frequency);break}switch(e.algorithm){case 0:case 1:case 2:case 3:this._operator4.connect(this.output);break;case 4:this._operator2.connect(this.output),this._operator4.connect(this.output);break;case 5:case 6:this._operator2.connect(this.output),this._operator3.connect(this.output),this._operator4.connect(this.output);break;case 7:this._operator1.connect(this.output),this._operator2.connect(this.output),this._operator3.connect(this.output),this._operator4.connect(this.output);break}pi(this,["harmonicity1","harmonicity2","harmonicity3","modulationindex1","modulationindex2","modulationindex3","oscillator1","oscillator2","oscillator3","oscillator4","envelope1","envelope2","envelope3","envelope4","frequency","detune"])}static getDefaults(){return Object.assign(If.getDefaults(),{algorithm:0,harmonicity1:2,harmonicity2:2,harmonicity3:2,modulationindex1:1,modulationindex2:1,modulationindex3:1,oscillator1:Object.assign(rl(Ym.getDefaults(),[...Object.keys(Ea.getDefaults()),"frequency","detune"]),{type:"sine"}),oscillator2:Object.assign(rl(Ym.getDefaults(),[...Object.keys(Ea.getDefaults()),"frequency","detune"]),{type:"sine"}),oscillator3:Object.assign(rl(Ym.getDefaults(),[...Object.keys(Ea.getDefaults()),"frequency","detune"]),{type:"sine"}),oscillator4:Object.assign(rl(Ym.getDefaults(),[...Object.keys(Ea.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope1:Object.assign(rl(Ol.getDefaults(),Object.keys(Hn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),envelope2:Object.assign(rl(Ol.getDefaults(),Object.keys(Hn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),envelope3:Object.assign(rl(Ol.getDefaults(),Object.keys(Hn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),envelope4:Object.assign(rl(Ol.getDefaults(),Object.keys(Hn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5})})}_triggerEnvelopeAttack(e,t){this._operator1._triggerEnvelopeAttack(e,t),this._operator2._triggerEnvelopeAttack(e,t),this._operator3._triggerEnvelopeAttack(e,t),this._operator4._triggerEnvelopeAttack(e,t)}_triggerEnvelopeRelease(e){return this._operator1._triggerEnvelopeRelease(e),this._operator2._triggerEnvelopeRelease(e),this._operator3._triggerEnvelopeRelease(e),this._operator4._triggerEnvelopeRelease(e),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope4.getValueAtTime(e)}dispose(){return super.dispose(),this.harmonicity1.dispose(),this.harmonicity2.dispose(),this.harmonicity3.dispose(),this.modulationindex1.dispose(),this.modulationindex2.dispose(),this.modulationindex3.dispose(),this._operator1.dispose(),this._operator2.dispose(),this._operator3.dispose(),this._operator4.dispose(),this._modulation1?.dispose(),this._modulation2?.dispose(),this._modulation3?.dispose(),this.frequency.dispose(),this.detune.dispose(),this}}var si=(n=>(n[n.SYNTH=0]="SYNTH",n[n.RETRO_NOISE=1]="RETRO_NOISE",n[n.BUZZ_NOISE=2]="BUZZ_NOISE",n[n.CLANG_NOISE=3]="CLANG_NOISE",n[n.METALLIC_NOISE=4]="METALLIC_NOISE",n[n.BELLS=5]="BELLS",n[n.DOOT=6]="DOOT",n[n.ALGO_SYNTH=7]="ALGO_SYNTH",n))(si||{});const jV=131072;function j9e(n){const e=_o().createBuffer(1,jV,_o().sampleRate);let t=1;const r=e.getChannelData(0);for(let i=0;i<jV;i++){n===4?r[i]=(t&1)*4*(Math.random()*14+1)-8:r[i]=(t&1)*2-1;let s=t>>1;if((t+s&1)==1)switch(n){default:case 1:s+=16384;break;case 3:s+=32768;break;case 2:s+=40;break;case 4:s+=60;break}t=s}return e}function Ig(n,e){let t,r;function i(){switch(t?.type){case 0:{t.synth.set({...r,envelope:{...r.envelope,attack:.01,decay:.01,sustain:.5,release:.01},oscillator:{...r.oscillator,type:"square"}});break}case 1:{t.synth.set({...r,attack:.01,decay:.01,sustain:.5,release:.01});break}case 5:{t.synth.set({...r,harmonicity:1.5,modulationIndex:30,oscillator:{type:"sine"},modulation:{type:"square"},envelope:{attack:.01,decay:3,sustain:.3,release:6},modulationEnvelope:{attack:.5,decay:1,sustain:.2,release:4}});break}case 6:{t.synth.set({...r});break}case 7:{t.synth.set({...r});break}}}function s(){return{type:t?.type,synth:t?.synth.get(),algo:t?.type===7?t?.algo:0}}function o(c){t?.synth.set(c.synth)}function a(){t?.synth.dispose()}switch(n){case 0:return t={type:n,synth:new sc},r=Us(t.synth.get()),i(),{source:t,applyreset:i,getreplay:s,setreplay:o,destroy:a};case 1:case 2:case 3:case 4:return t={type:n,synth:new OR({volume:-44,urls:{C4:j9e(n)}}),filter1:new Px({type:"lowshelf",gain:-32,frequency:440}),filter2:new Px({type:"highshelf",gain:32,frequency:440})},r=Us(t.synth.get()),i(),{source:t,applyreset:i,getreplay:s,setreplay:o,destroy:a};case 5:return t={type:5,synth:new u8,sparkle:new h8({volume:-16,envelope:{attack:.001,decay:1.4,release:.321},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5})},r=Us(t.synth.get()),i(),{source:t,applyreset:i,getreplay:s,setreplay:o,destroy:a};case 6:return t={type:n,synth:new rT},r=Us(t.synth.get()),i(),{source:t,applyreset:i,getreplay:s,setreplay:o,destroy:a};case 7:return t={type:n,synth:new P8({algorithm:e}),algo:e},r=Us(t.synth.get()),i(),{source:t,applyreset:i,getreplay:s,setreplay:o,destroy:a}}}async function Bne(){await XFe(),await F9e()}function Fne(){const n=nFe(),e=new Th;e.connect(n);let t;_o().isOffline||(t=_o().createMediaStreamDestination(),e.connect(t));const r=new Pr,i=new l3({maxDelay:.005,frequency:.125,depth:.3,type:"square",wet:.1}),s=new y8({frequency:.01,delayTime:7,depth:.7,type:"sawtooth",spread:128,wet:.5});s.start();const o=new xb({type:"pink",volume:-50}),a=new Th,c=new o8,l=new Xo(Math.PI*.25,"sine");l.chain(c,a.volume),l.start(),o.start(),o.chain(a,s),i.chain(s,e);const u=new T8({threshold:-28,ratio:4,attack:.003,release:.15,knee:30});r.chain(u,i);const h=new N8({threshold:-42,ratio:4,attack:.005,release:.005,mix:.777,makeupGain:24});h.connect(r);const f=new Th(-12),d=new Th(-32),p=new Th(ga(20));p.connect(h);const _=new Th(ga(100));_.connect(r);const g=new Th;g.connect(r),g.connect(f);const m=new Th;m.connect(r),m.connect(f),f.connect(h.sidechain),d.connect(h.sidechain);const b=[Ig(si.SYNTH,0),Ig(si.SYNTH,0),Ig(si.SYNTH,0),Ig(si.SYNTH,0),Ig(si.SYNTH,0),Ig(si.SYNTH,0),Ig(si.SYNTH,0),Ig(si.SYNTH,0)],y=ZFe(),x=[W2(1),W2(2),W2(3),W2(4)];for(let qe=0;qe<x.length;++qe){const ut=x[qe],Ne=qe<2?p:g;ut.sendtofx.connect(Ne),ut.fc.chain(y.fc,Ne),ut.echo.chain(y.echo,Ne),ut.reverb.chain(y.reverb,Ne),ut.autofilter.chain(y.autofilter,Ne),ut.vibrato.chain(y.vibrato,Ne),ut.distortion.chain(y.distortion,Ne),ut.autowah.chain(y.autowah,Ne)}function T(qe){return qe<4?Math.floor(qe/2):2}function k(qe){const ut=T(qe);if(fe(b[qe])){switch(b[qe].source.type){case si.RETRO_NOISE:case si.BUZZ_NOISE:case si.CLANG_NOISE:case si.METALLIC_NOISE:break;default:b[qe].source.synth.connect(x[ut].sendtofx);break}switch(b[qe].source.type){case si.RETRO_NOISE:case si.BUZZ_NOISE:case si.CLANG_NOISE:case si.METALLIC_NOISE:b[qe].source.synth.chain(b[qe].source.filter1,b[qe].source.filter2,x[ut].sendtofx);break;case si.BELLS:{b[qe].source.sparkle.connect(x[ut].sendtofx);break}}}}for(let qe=0;qe<b.length;++qe)k(qe);function R(qe,ut,te){const Ne=b[qe]?.source.type===si.ALGO_SYNTH?b[qe]?.source.algo:0;b[qe]?.source.type===ut&&Ne===te||(b[qe]?.source.synth.dispose(),b[qe]=Ig(ut,te),k(qe))}const P=YFe(_,d);let B=new CA(Z),U=0,z=0,I=[];function L(qe,ut,te){qe.forEach((Ne,Be)=>{R(Be,Ne.type,Ne.algo),b[Be].setreplay(Ne)}),y.setreplay(ut),te.forEach((Ne,Be)=>{x[Be].setreplay(Ne)})}function M(){I=[],U=0,z=0}function F(qe){if(I.length){const ut=Qr(),te=I.map(ze=>{const[Ze]=ze;return Ze}),Ne=Math.min(...te),Be=Math.max(...te),De=Math.ceil(Be-Ne+5),Oe=[];for(let ze=0;ze<I.length;++ze){const[Ze,Je]=I[ze];Oe.push([Ze-Ne+.1,Je])}const ue=b.map(ze=>ze.getreplay()),_e=y.getreplay(),we=x.map(ze=>ze.getreplay());let pe;HBe(async({transport:ze})=>{Nr(Ke,ut,"create synth"),await Bne(),pe=Fne(),Nr(Ke,ut,"synth waiting for setup"),await Mh(2e3),pe.setplayvolume(80),pe.applyreplay(ue,_e,we),pe.synthreplay(Oe,Be),Nr(Ke,ut,"rendering audio"),ze.start(0)},De).then(ze=>(Nr(Ke,ut,"rendering complete, exporting mp3"),N9e(ze))).then(ze=>{const Ze=document.createElement("a");Ze.href=URL.createObjectURL(new Blob([ze],{type:"audio/mp3"})),Ze.download=`${qe||s6()}.mp3`,Nr(Ke,ut,`saving file ${Ze.download}`),Ze.click(),pe?.destroy()}).catch(ze=>{ur(Ke,ut,"synthrecord",ze)})}M()}function Z(qe,ut){if(ut===null)return;if(z>0){const Oe=Math.round(qe/z*100);Oe!==U&&(U=Oe,Nr(Ke,Qr(),`${Oe}%`))}else I.push([qe,ut]);const[te,Ne,Be]=ut,De=T(te);if(rn(Be)&&fe(b[te])&&fe(x[De])){switch(b[te].source.type){case si.BELLS:b[te].source.synth.detune.value=Nu(-3,3),b[te].source.sparkle.triggerAttackRelease($Fe(Be,2),Ne,qe);break}b[te].source.synth.triggerAttackRelease(Be,Ne,qe);const Oe=b[te].source.synth.toSeconds(Ne),ue="128n",_e=b[te].source.synth.toSeconds(ue);y.vibrato.depth.rampTo(1,"2n",qe),y.vibrato.depth.rampTo(0,ue,qe+Oe-_e),y.vibrato.frequency.rampTo(5,"4n",qe),y.vibrato.frequency.rampTo(1,ue,qe+Oe-_e)}if(Xt(Be))switch(Be){case 0:P.ticktrigger(qe);break;case 1:P.tweettrigger(qe);break;case 2:P.cowbelltrigger(Ne,qe);break;case 3:P.claptrigger(Ne,qe);break;case 4:P.hisnaretrigger(Ne,qe);break;case 5:P.hiwoodblocktrigger(Ne,qe);break;case 6:P.lowsnaretrigger(Ne,qe);break;case 7:P.lowtomtrigger(Ne,qe);break;case 8:P.lowwoodblocktrigger(Ne,qe);break;case 9:P.basstrigger(qe);break;case-1:--q,q===0&&(B.clear(),Q=-1);break}}function $(qe,ut,te,Ne=!0){let Be=ut;const De=U9e(qe,ut,te,Ne),Oe=De[De.length-1];fe(Oe)&&(Be=Math.max(Be,Oe[0]));for(let ue=0;ue<De.length;++ue){const[_e,we]=De[ue];B.add(_e,we)}return Be}function Y(qe,ut){U=0,z=ut;for(let te=0;te<qe.length;++te){const[Ne,Be]=qe[te];B.add(Ne,Be)}}let Q=-1,q=0,V=BV;function K(qe){const ut=FV(qe);Q===-1&&(Q=b4().now()),q+=ut.length;const te=Q;for(let Ne=0;Ne<ut.length&&Ne<b.length;++Ne){const Be=$(Ne,te,ut[Ne]);Q=Math.max(Q,Be)}}function ne(qe,ut){const te=FV(qe),Ne=tl(ut||"+0.05").toSeconds();for(let Be=0;Be<te.length;++Be)$(V++,Ne,te[Be],!1),V>=b.length&&(V=BV)}function ie(){B.clear(),Q=-1,q=0}function ae(qe){ie(),b4().bpm.setValueAtTime(qe,0),B=new CA(Z),B.start(0)}function Te(qe){e.volume.value=ga(qe*.25)}function Ie(qe){g.volume.value=ga(qe)}function be(qe){new kR(qe).connect(m).start(0)}function Pe(qe){m.volume.value=qe}Pe(25),Te(80),Ie(100),B.start(0),y.autofilter.start();function $e(){b.forEach((qe,ut)=>{const te=qe.source.type===si.ALGO_SYNTH?qe.source.algo:0;R(ut,si.SYNTH,te),qe.applyreset(),qe.source.synth.set({oscillator:{type:"square"}})}),x.forEach(qe=>qe.applyreset()),y.applyreset()}function tt(){b.forEach(qe=>qe.destroy()),x.forEach(qe=>qe.destroy()),y.destroy(),e.dispose()}return{destroy:tt,broadcastdestination:t,addplay:K,addbgplay:ne,stopplay:ie,applyreset:$e,applyreplay:L,synthrecord:F,synthflush:M,synthreplay:Y,addaudiobuffer:be,setbpm:ae,setplayvolume:Te,setbgplayvolume:Ie,setttsvolume:Pe,SOURCE:b,FX:x,FXCHAIN:y,changesource:R}}const z9e=/(am|fm|fat)*(sine|square|triangle|sawtooth|custom)[0-9]+/,H9e=/(am|fm|fat)*(sine|square|triangle|sawtooth|custom)[0-9]*/;function V9e(n,e){if(rn(n)){const t=Jn(n);if(z9e.test(t))return Xn(e);switch(t){case"pwm":case"pulse":case"retro":case"buzz":case"clang":case"metallic":case"bells":case"doot":case"algo0":case"algo1":case"algo2":case"algo3":case"algo4":case"algo5":case"algo6":case"algo7":return!0;default:return H9e.test(t)}}return!1}function G9e(n,e,t,r,i){if(!fe(e))return;const s=e.SOURCE[t];if(!fe(s)){ur(Ke,n,"synth",`unknown voice ${t}`);return}switch(r){case"restart":{e.applyreset();return}case"vol":case"volume":Xt(i)&&(s.source.synth.volume.value=i);return;case"port":case"portamento":if(Xt(i))switch(s.source.type){case si.SYNTH:s.source.synth.portamento=i;break;case si.ALGO_SYNTH:s.source.synth.portamento=i;break;case si.RETRO_NOISE:ur(Ke,n,"synth","portamento for retro synth not supported");break}return;case"env":case"envelope":if(Xn(i)){const[o,a,c,l]=i;s.source.synth.set({envelope:{attack:o,decay:a,sustain:c,release:l}})}return;default:if(rn(r)){if(V9e(r,i)){switch(r){case"retro":e.changesource(t,si.RETRO_NOISE,0);break;case"buzz":e.changesource(t,si.BUZZ_NOISE,0);break;case"clang":e.changesource(t,si.CLANG_NOISE,0);break;case"metallic":e.changesource(t,si.METALLIC_NOISE,0);break;case"bells":e.changesource(t,si.BELLS,0);break;case"doot":e.changesource(t,si.DOOT,0);break;case"algo0":e.changesource(t,si.ALGO_SYNTH,0);break;case"algo1":e.changesource(t,si.ALGO_SYNTH,1);break;case"algo2":e.changesource(t,si.ALGO_SYNTH,2);break;case"algo3":e.changesource(t,si.ALGO_SYNTH,3);break;case"algo4":e.changesource(t,si.ALGO_SYNTH,4);break;case"algo5":e.changesource(t,si.ALGO_SYNTH,5);break;case"algo6":e.changesource(t,si.ALGO_SYNTH,6);break;case"algo7":e.changesource(t,si.ALGO_SYNTH,7);break;default:e.changesource(t,si.SYNTH,0),s.source.synth.set({oscillator:{type:r}}),Xn(i)&&s.source.synth.set({oscillator:{type:r,partials:i,partialCount:i.length}}),Xt(i)&&s.source.synth.set({oscillator:{type:r,partials:[i],partialCount:1}});break}return}switch(s.source.type){case si.SYNTH:{switch(s.source.synth.get().oscillator.type){case"pwm":switch(r){case"modfreq":case"modulationfrequency":Xt(i)&&s.source.synth.set({oscillator:{modulationFrequency:i}});return}break;case"pulse":switch(r){case"width":Xt(i)&&s.source.synth.set({oscillator:{width:i}});return}break;case"custom":case"sine":case"square":case"triangle":case"sawtooth":switch(r){case"phase":Xt(i)&&s.source.synth.set({oscillator:{phase:i}});return}break;case"amcustom":case"amsine":case"amsquare":case"amtriangle":case"amsawtooth":switch(r){case"harmonicity":Xt(i)&&s.source.synth.set({oscillator:{harmonicity:i}});return;case"modtype":case"modulationtype":rn(i)&&s.source.synth.set({oscillator:{modulationType:i}});return;case"modenv":case"modulationenvelope":if(Xn(i)){const[a,c,l,u]=i;s.source.synth.set({oscillator:{modulationEnvelope:{attack:a,decay:c,sustain:l,release:u}}});return}break}break;case"fmcustom":case"fmsine":case"fmsquare":case"fmtriangle":case"fmsawtooth":switch(r){case"harmonicity":if(Xt(i)){s.source.synth.set({oscillator:{harmonicity:i}});return}break;case"modindex":if(Xt(i)){s.source.synth.set({oscillator:{modulationIndex:i}});return}break;case"modtype":if(rn(i)){s.source.synth.set({oscillator:{modulationType:i}});return}break;case"modenv":if(Xn(i)){const[a,c,l,u]=i;s.source.synth.set({oscillator:{modulationEnvelope:{attack:a,decay:c,sustain:l,release:u}}});return}break}break;case"fatcustom":case"fatsine":case"fatsquare":case"fattriangle":case"fatsawtooth":switch(r){case"count":if(Xt(i)){s.source.synth.set({oscillator:{count:i}});return}break;case"phase":if(Xt(i)){s.source.synth.set({oscillator:{phase:i}});return}break;case"spread":if(Xt(i)){s.source.synth.set({oscillator:{spread:i}});return}break}break}return}case si.ALGO_SYNTH:{switch(r){case"harmonicity":if(Xt(i)){s.source.synth.set({harmonicity1:i,harmonicity2:i,harmonicity3:i});return}break;case"harmonicity1":if(Xt(i)){s.source.synth.set({harmonicity1:i});return}break;case"harmonicity2":if(Xt(i)){s.source.synth.set({harmonicity2:i});return}break;case"harmonicity3":if(Xt(i)){s.source.synth.set({harmonicity3:i});return}break;case"modindex":if(Xt(i)){s.source.synth.set({modulationindex1:i,modulationindex2:i,modulationindex3:i});return}break;case"modindex1":if(Xt(i)){s.source.synth.set({modulationindex1:i});return}break;case"modindex2":if(Xt(i)){s.source.synth.set({modulationindex2:i});return}break;case"modindex3":if(Xt(i)){s.source.synth.set({modulationindex3:i});return}break;case"osc1":if(rn(i)){s.source.synth.set({oscillator1:{type:i}});return}break;case"osc2":if(rn(i)){s.source.synth.set({oscillator2:{type:i}});return}break;case"osc3":if(rn(i)){s.source.synth.set({oscillator3:{type:i}});return}break;case"osc4":if(rn(i)){s.source.synth.set({oscillator4:{type:i}});return}break;case"env1":case"envelope1":if(Xn(i)){const[o,a,c,l]=i;s.source.synth.set({envelope1:{attack:o,decay:a,sustain:c,release:l}});return}break;case"env2":case"envelope2":if(Xn(i)){const[o,a,c,l]=i;s.source.synth.set({envelope2:{attack:o,decay:a,sustain:c,release:l}});return}break;case"env3":case"envelope3":if(Xn(i)){const[o,a,c,l]=i;s.source.synth.set({envelope3:{attack:o,decay:a,sustain:c,release:l}});return}break;case"env4":case"envelope4":if(Xn(i)){const[o,a,c,l]=i;s.source.synth.set({envelope4:{attack:o,decay:a,sustain:c,release:l}});return}break}return}}ur(Ke,n,"synth",`unknown config ${r}`)}break}}function $9e(n,e,t,r,i){if(!fe(e)||t<0||t>=e.FX.length){ur(Ke,n,"synth",`index ${t} out of bounds`);return}const s=e.FXCHAIN.autofilter;switch(r){case"type":if(rn(i)){s.set({filter:{type:i}});return}break;case"q":if(Xt(i)){s.set({filter:{Q:i}});return}break;case"depth":if(Xt(i)){s.set({depth:i});return}break;case"frequency":if(Xt(i)){s.set({frequency:i});return}break;case"octaves":if(Xt(i)){s.set({octaves:i});return}break}ur(Ke,n,"kind",`unknown autofilter ${r} or ${i}`)}function W9e(n,e,t,r,i){if(!fe(e))return;if(t<0||t>=e.FX.length){ur(Ke,n,"synth",`index ${t} out of bounds`);return}const s=e.FXCHAIN.autowah;switch(r){case"basefrequency":if(Xt(i)){s.set({baseFrequency:i});return}break;case"octaves":if(Xt(i)){s.set({octaves:i});return}break;case"sensitivity":if(Xt(i)){s.set({sensitivity:i});return}break;case"gain":if(Xt(i)){s.set({gain:i});return}break;case"follower":if(Xt(i)){s.set({follower:i});return}break}ur(Ke,n,"synth",`unknown autowah config ${r} with ${i}`)}function q9e(n,e,t,r,i){if(!fe(e)||t<0||t>=e.FX.length){ur(Ke,n,"synth",`index ${t} out of bounds`);return}const s=e.FXCHAIN.distortion;switch(r){case"distortion":if(Xt(i)){s.set({distortion:i});return}break;case"oversample":if(rn(i)){s.set({oversample:i});return}break}ur(Ke,n,"kind",`unknown distortion ${r} or ${i}`)}function Y9e(n,e,t,r,i){if(!fe(e)||t<0||t>=e.FX.length){ur(Ke,n,"synth",`index ${t} out of bounds`);return}const s=e.FXCHAIN.echo;switch(r){case"delaytime":if(Xt(i)){s.set({delayTime:i});return}break;case"feedback":if(Xt(i)){s.set({feedback:i});return}break}ur(Ke,n,"kind",`unknown echo ${r} or ${i}`)}function K9e(n,e,t,r,i){if(!fe(e)||t<0||t>=e.FX.length){ur(Ke,n,"synth",`index ${t} out of bounds`);return}const s=e.FXCHAIN.fcrush;switch(r){case"rate":if(Xt(i)){s.set({rate:i});return}break}ur(Ke,n,"kind",`unknown fcrush ${r} or ${i}`)}function X9e(n,e,t,r,i){if(!fe(e)||t<0||t>=e.FX.length){ur(Ke,n,"synth",`index ${t} out of bounds`);return}const s=e.FXCHAIN.reverb;switch(r){case"decay":if(Xt(i)){s.set({decay:i});return}break;case"predelay":if(Xt(i)){s.set({preDelay:i});return}break}ur(Ke,n,"kind",`unknown reverb ${r} or ${i}`)}function Z9e(n,e,t,r,i){if(!fe(e))return;if(t<0||t>=e.FX.length){ur(Ke,n,"synth",`index ${t} out of bounds`);return}const s=e.FXCHAIN.vibrato;switch(r){case"maxdelay":if(Xt(i)){s.set({maxDelay:i});return}break}ur(Ke,n,"synth",`unknown vibrato config ${r} with ${i}`)}function J9e(n,e,t,r,i,s){if(!fe(e))return;if(t<0||t>=e.FX.length){ur(Ke,n,"synth",`index ${t} out of bounds`);return}const o=e.FX[t][r];if(fe(o)){switch(i){case"on":switch(r){case"vibrato":case"autofilter":o.volume.value=ga(80);break;default:o.volume.value=ga(30);break}break;case"off":o.volume.value=ga(0);break;default:if(Xt(i))o.volume.value=ga(i);else switch(r){case"fc":case"fcrush":K9e(n,e,t,i,s);break;case"echo":Y9e(n,e,t,i,s);break;case"autofilter":$9e(n,e,t,i,s);break;case"reverb":X9e(n,e,t,i,s);break;case"distort":case"distortion":q9e(n,e,t,i,s);break;case"vibrato":Z9e(n,e,t,i,s);break;case"autowah":W9e(n,e,t,i,s);break}break}return}ur(Ke,n,"synth",`unknown fx ${r}`)}let kP=Promise,jne=n=>{let e=0,t=0,r,i,s,o,a=()=>{e--,--t?c():o=s?.()},c=()=>{if(r&&e<n){e++;let l=r;r=r.a,l.p().then(u=>(l.b(u),a()),u=>(l.c(u),a()))}};return{add(l){let u={p:l},h=new kP((f,d)=>{u.b=f,u.c=d});return r?i=i.a=u:i=r=u,t++,c(),h},done:()=>t?o||(o=new kP(l=>s=l)):kP.resolve(),clear(){r=i=null,t=e},active:()=>e,size:()=>t}},D8="piper",zne="";function Q9e(n,e){D8=n,zne=e}function eje(n){return _o().decodeAudioData(n)}async function Hne(n,e,t){return new Promise(r=>{const i=y0(Ko(),[],s=>{s.target==="heavy:ttsrequest"&&s.data&&eje(s.data).then(r).catch(console.error),ub.disconnect(i)},Ke.session());YSe(i,n,D8,zne,e,t)})}function tje(n,e){return new Promise(t=>{const r=y0(Ko(),[],i=>{i.target==="heavy:ttsinfo"&&i.data&&t(i.data),ub.disconnect(r)},Ke.session());qSe(r,n,D8,e)})}async function nje(n,e,t){if(t.trim()==="")return;const r=await Hne(n,e,t);fe(r)&&AY(Ke,n,r)}const Vne=jne(1);async function rje(n,e){AY(Ke,n,e);const t=Math.max(1e3,Math.round(e.duration*1e3));await Mh(t)}const Gne=jne(1);async function ije(n,e,t){const r=await Hne(n,e,t);Vne.add(async()=>{fe(r)&&await rje(n,r)}).catch(console.error)}function sje(n,e,t){Gne.add(async()=>{await ije(n,e,t)}).catch(console.error)}function oje(){Vne.clear(),Gne.clear()}const aje=Date.now(),Ua={get value(){return(Date.now()-aje)/1e3%1e6}},cje=120;let $ne=0;function Wne(n){$ne=cje/n}const lje=136;Wne(lje);const aT={get value(){return $ne}};function cy(n){const e=n.clone();return e.uniforms.time=Ua,e.uniforms.interval=aT,e}let J2=!1,qC=!1;function DR(){qC||J2||(J2=!0,vk(new nT({latencyHint:"playback"}),!0),LBe().then(()=>{if(!qC){try{const n=navigator;fe(n.audioSession)&&(n.audioSession.type="playback")}catch{}return Bne().then(()=>{J2=!1,qC=!0,ZSe(Ug,Qr())})}}).catch(n=>{J2=!1,ur(Ug,Qr(),"audio",n.toString())}))}let Rl;function uje(){return Rl?.broadcastdestination}const Ug=y0("synth",[],n=>{if(!Ug.session(n)||(qC&&!fe(Rl)&&(Rl=Fne(),b4().start()),!fe(Rl)))return;const e=Qr();switch(n.target){case"audioenabled":if(n.player!==e)return;break}const t=Jr.getState().gadget.board;switch(n.target){case"audioenabled":Qi(Ug,n.player,"audio is enabled!"),to(Ug,n.player,async()=>{await Mh(2e3),Uh(Ug,n.player,void 0,"text","audio:enabled","")});break;case"bpm":if(Xt(n.data)){const r=Math.round(n.data);Rl.setbpm(r),Wne(r)}break;case"playvolume":Xt(n.data)&&Rl.setplayvolume(n.data);break;case"bgplayvolume":Xt(n.data)&&Rl.setbgplayvolume(n.data);break;case"ttsvolume":Xt(n.data)&&Rl.setttsvolume(n.data);break;case"audiobuffer":fe(n.data)&&Rl.addaudiobuffer(n.data);break;case"play":if(Xn(n.data)){const[r,i]=n.data;(r===""||r===t)&&(i.trim()===""?Rl.stopplay():Rl.addplay(i))}break;case"bgplay":if(Xn(n.data)){const[r,i,s]=n.data;(r===""||r===t)&&Rl.addbgplay(i,s)}break;case"restart":Rl?.applyreset();break;case"voice":if(Xn(n.data)){const[r,i,s]=n.data;G9e(n.player,Rl,r,i,s)}break;case"voicefx":if(Xn(n.data)){const[r,i,s,o]=n.data;J9e(n.player,Rl,r,i,s,o)}break;case"record":rn(n.data)&&Rl.synthrecord(n.data);break;case"flush":Rl.synthflush();break;case"tts":to(Ug,n.player,async()=>{if(Xn(n.data)){const[r,i,s]=n.data;s.trim()!==""&&(r===""||r===t)&&await nje(n.player,i,s)}});break;case"ttsinfo":to(Ug,n.player,async()=>{if(rn(n.data)){const r=await tje(n.player,n.data);if(Xn(r))for(let i=0;i<r.length;i++)Nr(Ug,n.player,`$WHITE${r[i]}`)}});break;case"ttsengine":if(Xn(n.data)){const[r,i]=n.data;Q9e(r,i)}break;case"ttsqueue":if(Xn(n.data)){const[r,i,s]=n.data;s.trim()!==""&&(r===""||r===t)&&sje(n.player,i,s)}break;case"ttsclearqueue":oje();break}});function Ek(){return Ek=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ek.apply(null,arguments)}var hje=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return r/Math.atan(1/t)*Math.atan(Math.sin(2*Math.PI*e*i)/t)},fje=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)};function kl(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:fje,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,c="velocity_"+e;if(n.__damp===void 0&&(n.__damp={}),n.__damp[c]===void 0&&(n.__damp[c]=0),Math.abs(n[e]-t)<=a)return n[e]=t,!1;r=Math.max(1e-4,r);var l=2/r,u=o(l*i),h=n[e]-t,f=t,d=s*r;h=Math.min(Math.max(h,-d),d),t=n[e]-h;var p=(n.__damp[c]+l*h)*i;n.__damp[c]=(n.__damp[c]-l*p)*u;var _=t+(h+p)*u;return f-n[e]>0==_>f&&(_=f,n.__damp[c]=(_-f)/i),n[e]=_,!0}function OP(n,e,t,r,i,s,o,a){return kl(n,e,n[e]+eSe(n[e],t),r,i,s,o,a)}var iE=new Lt,zV,HV,VV;function Kv(n,e,t,r,i,s,o){return typeof e=="number"?iE.setScalar(e):Array.isArray(e)?iE.set(e[0],e[1],e[2]):iE.copy(e),zV=kl(n,"x",iE.x,t,r,i,s,o),HV=kl(n,"y",iE.y,t,r,i,s,o),VV=kl(n,"z",iE.z,t,r,i,s,o),zV||HV||VV}var ZT=new t0,GV,$V,WV;function x4(n,e,t,r,i,s,o){return Array.isArray(e)?ZT.set(e[0],e[1],e[2],e[3]):ZT.copy(e),GV=OP(n,"x",ZT.x,t,r,i,s,o),$V=OP(n,"y",ZT.y,t,r,i,s,o),WV=OP(n,"z",ZT.z,t,r,i,s,o),GV||$V||WV}const qV=n=>Symbol.iterator in n,YV=n=>"entries"in n,KV=(n,e)=>{const t=n instanceof Map?n:new Map(n.entries()),r=e instanceof Map?e:new Map(e.entries());if(t.size!==r.size)return!1;for(const[i,s]of t)if(!Object.is(s,r.get(i)))return!1;return!0},dje=(n,e)=>{const t=n[Symbol.iterator](),r=e[Symbol.iterator]();let i=t.next(),s=r.next();for(;!i.done&&!s.done;){if(!Object.is(i.value,s.value))return!1;i=t.next(),s=r.next()}return!!i.done&&!!s.done};function pje(n,e){return Object.is(n,e)?!0:typeof n!="object"||n===null||typeof e!="object"||e===null||Object.getPrototypeOf(n)!==Object.getPrototypeOf(e)?!1:qV(n)&&qV(e)?YV(n)&&YV(e)?KV(n,e):dje(n,e):KV({entries:()=>Object.entries(n)},{entries:()=>Object.entries(e)})}function Uc(n){const e=Tf.useRef(void 0);return t=>{const r=n(t);return pje(e.current,r)?e.current:e.current=r}}function qne(n,e,t){const r=cl(d=>d.size),i=cl(d=>d.viewport),s=typeof n=="number"?n:r.width*i.dpr,o=typeof e=="number"?e:r.height*i.dpr,a=(typeof n=="number"?t:n)||{},{samples:c=0,depth:l,...u}=a,h=l??a.depthBuffer,f=Qe.useMemo(()=>{const d=new Nl(s,o,{minFilter:ou,magFilter:ou,type:Jv,...u});return h&&(d.depthTexture=new Vk(s,o,mp)),d.samples=c,d},[]);return Qe.useLayoutEffect(()=>{f.setSize(s,o),c&&(f.samples=c)},[c,f,s,o]),Qe.useEffect(()=>()=>f.dispose(),[]),f}const mje=n=>typeof n=="function",gje=Qe.forwardRef(({envMap:n,resolution:e=256,frames:t=1/0,children:r,makeDefault:i,...s},o)=>{const a=cl(({set:g})=>g),c=cl(({camera:g})=>g),l=cl(({size:g})=>g),u=Qe.useRef(null);Qe.useImperativeHandle(o,()=>u.current,[]);const h=Qe.useRef(null),f=qne(e);Qe.useLayoutEffect(()=>{s.manual||u.current.updateProjectionMatrix()},[l,s]),Qe.useLayoutEffect(()=>{u.current.updateProjectionMatrix()}),Qe.useLayoutEffect(()=>{if(i){const g=c;return a(()=>({camera:u.current})),()=>a(()=>({camera:g}))}},[u,i,a]);let d=0,p=null;const _=mje(r);return l_(g=>{_&&(t===1/0||d<t)&&(h.current.visible=!1,g.gl.setRenderTarget(f),p=g.scene.background,n&&(g.scene.background=n),g.gl.render(g.scene,u.current),g.scene.background=p,g.gl.setRenderTarget(null),h.current.visible=!0,d++)}),Qe.createElement(Qe.Fragment,null,Qe.createElement("orthographicCamera",Ek({left:l.width/-2,right:l.width/2,top:l.height/2,bottom:l.height/-2,ref:u},s),!_&&r),Qe.createElement("group",{ref:h},_&&r(f.texture)))});var YC={exports:{}},_je=YC.exports,XV;function vje(){return XV||(XV=1,(function(n,e){(function(t,r){n.exports=r()})(_je,function(){var t=function(){function r(d){return o.appendChild(d.dom),d}function i(d){for(var p=0;p<o.children.length;p++)o.children[p].style.display=p===d?"block":"none";s=d}var s=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(d){d.preventDefault(),i(++s%o.children.length)},!1);var a=(performance||Date).now(),c=a,l=0,u=r(new t.Panel("FPS","#0ff","#002")),h=r(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var f=r(new t.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:o,addPanel:r,showPanel:i,begin:function(){a=(performance||Date).now()},end:function(){l++;var d=(performance||Date).now();if(h.update(d-a,200),d>c+1e3&&(u.update(1e3*l/(d-c),100),c=d,l=0,f)){var p=performance.memory;f.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return d},update:function(){a=this.end()},domElement:o,setMode:i}};return t.Panel=function(r,i,s){var o=1/0,a=0,c=Math.round,l=c(window.devicePixelRatio||1),u=80*l,h=48*l,f=3*l,d=2*l,p=3*l,_=15*l,g=74*l,m=30*l,b=document.createElement("canvas");b.width=u,b.height=h,b.style.cssText="width:80px;height:48px";var y=b.getContext("2d");return y.font="bold "+9*l+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=s,y.fillRect(0,0,u,h),y.fillStyle=i,y.fillText(r,f,d),y.fillRect(p,_,g,m),y.fillStyle=s,y.globalAlpha=.9,y.fillRect(p,_,g,m),{dom:b,update:function(x,T){o=Math.min(o,x),a=Math.max(a,x),y.fillStyle=s,y.globalAlpha=1,y.fillRect(0,0,u,_),y.fillStyle=i,y.fillText(c(x)+" "+r+" ("+c(o)+"-"+c(a)+")",f,d),y.drawImage(b,p+l,_,g-l,m,p,_,g-l,m),y.fillRect(p+g-l,_,l,m),y.fillStyle=s,y.globalAlpha=.9,y.fillRect(p+g-l,_,l,c((1-x/T)*m))}}},t})})(YC)),YC.exports}var yje=vje();const bje=Dl(yje);function IP(n,e,t,r){return new(t||(t=Promise))((function(i,s){function o(l){try{c(r.next(l))}catch(u){s(u)}}function a(l){try{c(r.throw(l))}catch(u){s(u)}}function c(l){var u;l.done?i(l.value):(u=l.value,u instanceof t?u:new t((function(h){h(u)}))).then(o,a)}c((r=r.apply(n,[])).next())}))}const Sje=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function ZV(n){return n=n.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const Yne=typeof window>"u",Mm=(()=>{if(Yne)return;const{userAgent:n,platform:e,maxTouchPoints:t}=window.navigator,r=/(iphone|ipod|ipad)/i.test(n),i=e==="iPad"||e==="MacIntel"&&t>0&&!window.MSStream;return{isIpad:i,isMobile:/android/i.test(n)||r||i,isSafari12:/Version\/12.+Safari/.test(n),isFirefox:/Firefox/.test(n)}})();function Eje(n,e,t){if(!t)return[e];const r=(function(l){const u=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,h=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,f=l.createShader(35633),d=l.createShader(35632),p=l.createProgram();if(!(d&&f&&p))return;l.shaderSource(f,u),l.shaderSource(d,h),l.compileShader(f),l.compileShader(d),l.attachShader(p,f),l.attachShader(p,d),l.linkProgram(p),l.detachShader(p,f),l.detachShader(p,d),l.deleteShader(f),l.deleteShader(d),l.useProgram(p);const _=l.createBuffer();l.bindBuffer(34962,_),l.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const g=l.getAttribLocation(p,"aPosition");l.vertexAttribPointer(g,3,5126,!1,0,0),l.enableVertexAttribArray(g),l.clearColor(1,1,1,1),l.clear(16384),l.viewport(0,0,1,1),l.drawArrays(4,0,3);const m=new Uint8Array(4);return l.readPixels(0,0,1,1,6408,5121,m),l.deleteProgram(p),l.deleteBuffer(_),m.join("")})(n),i="801621810",s="8016218135",o="80162181161",a=Mm?.isIpad?[["a7",o,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",i,15],["a12x",i,15],["a12z",i,15],["a14",i,15],["a15",i,15],["m1",i,15],["m2",i,15]]:[["a7",o,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",i,15],["a12",i,15],["a13",i,15],["a14",i,15],["a15",i,15],["a16",i,15],["a17",i,15]];let c;return r==="80162181255"?c=a.filter((([,,l])=>l>=14)):(c=a.filter((([,l])=>l===r)),c.length||(c=a)),c.map((([l])=>`apple ${l} gpu`))}class JV extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}const NP=[],QV=[];function xje(n,e){if(n===e)return 0;const t=n;n.length>e.length&&(n=e,e=t);let r=n.length,i=e.length;for(;r>0&&n.charCodeAt(~-r)===e.charCodeAt(~-i);)r--,i--;let s,o=0;for(;o<r&&n.charCodeAt(o)===e.charCodeAt(o);)o++;if(r-=o,i-=o,r===0)return i;let a,c,l=0,u=0,h=0;for(;u<r;)QV[u]=n.charCodeAt(o+u),NP[u]=++u;for(;h<i;)for(s=e.charCodeAt(o+h),a=h++,l=h,u=0;u<r;u++)c=s===QV[u]?a:a+1,a=NP[u],l=NP[u]=a>l?c>l?l+1:c:c>a?a+1:c;return l}function Tje(n){return n!=null}const wje=({mobileTiers:n=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:t={},glContext:r,failIfMajorPerformanceCaveat:i=!1,benchmarksURL:s="https://unpkg.com/detect-gpu@5.0.70/dist/benchmarks"}={})=>IP(void 0,void 0,void 0,(function*(){const o={};if(Yne)return{tier:0,type:"SSR"};const{isIpad:a=!!Mm?.isIpad,isMobile:c=!!Mm?.isMobile,screenSize:l=window.screen,loadBenchmarks:u=(T=>IP(void 0,void 0,void 0,(function*(){const k=yield fetch(`${s}/${T}`).then((R=>R.json()));if(parseInt(k.shift().split(".")[0],10)<4)throw new JV("Detect GPU benchmark data is out of date. Please update to version 4x");return k})))}=t;let{renderer:h}=t;const f=(T,k,R,P,B)=>({device:B,fps:P,gpu:R,isMobile:c,tier:T,type:k});let d,p="";if(h)h=ZV(h),d=[h];else{const T=r||(function(R,P=!1){const B={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:P,powerPreference:"high-performance",stencil:!1};R&&delete B.powerPreference;const U=window.document.createElement("canvas"),z=U.getContext("webgl",B)||U.getContext("experimental-webgl",B);return z??void 0})(Mm?.isSafari12,i);if(!T)return f(0,"WEBGL_UNSUPPORTED");const k=Mm?.isFirefox?null:T.getExtension("WEBGL_debug_renderer_info");if(h=k?T.getParameter(k.UNMASKED_RENDERER_WEBGL):T.getParameter(T.RENDERER),!h)return f(1,"FALLBACK");p=h,h=ZV(h),d=(function(R,P,B){return P==="apple gpu"?Eje(R,P,B):[P]})(T,h,c)}const _=(yield Promise.all(d.map((function(T){var k;return IP(this,void 0,void 0,(function*(){const R=(ne=>{const ie=c?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const ae of ie)if(ne.includes(ae))return ae})(T);if(!R)return;const P=`${c?"m":"d"}-${R}${a?"-ipad":""}.json`,B=o[P]=(k=o[P])!==null&&k!==void 0?k:u(P);let U;try{U=yield B}catch(ne){if(ne instanceof JV)throw ne;return}const z=(function(ne){var ie;const ae=(ne=ne.replace(/\([^)]+\)/,"")).match(/\d+/)||ne.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(ie=ae?.join("").replace(/\W|amd/g,""))!==null&&ie!==void 0?ie:""})(T);let I=U.filter((([,ne])=>ne===z));I.length||(I=U.filter((([ne])=>ne.includes(T))));const L=I.length;if(L===0)return;const M=T.split(/[.,()\[\]/\s]/g).sort().filter(((ne,ie,ae)=>ie===0||ne!==ae[ie-1])).join(" ");let F,[Z,,,,$]=L>1?I.map((ne=>[ne,xje(M,ne[2])])).sort((([,ne],[,ie])=>ne-ie))[0][0]:I[0],Y=Number.MAX_VALUE;const{devicePixelRatio:Q}=window,q=l.width*Q*l.height*Q;for(const ne of $){const[ie,ae]=ne,Te=ie*ae,Ie=Math.abs(q-Te);Ie<Y&&(Y=Ie,F=ne)}if(!F)return;const[,,V,K]=F;return[Y,V,Z,K]}))})))).filter(Tje).sort((([T=Number.MAX_VALUE,k],[R=Number.MAX_VALUE,P])=>T===R?k-P:T-R));if(!_.length){const T=Sje.find((k=>h.includes(k)));return T?f(0,"BLOCKLISTED",T):f(1,"FALLBACK",`${h} (${p})`)}const[,g,m,b]=_[0];if(g===-1)return f(0,"BLOCKLISTED",m,g,b);const y=c?n:e;let x=0;for(let T=0;T<y.length;T++)g>=y[T]&&(x=T);return f(x,"BENCHMARK",m,g,b)})),Aje=n=>yW(()=>wje(n),["useDetectGPU"]);function Rje(n,e){const t=n+"Geometry";return Qe.forwardRef(({args:r,children:i,...s},o)=>{const a=Qe.useRef(null);return Qe.useImperativeHandle(o,()=>a.current),Qe.useLayoutEffect(()=>void e?.(a.current)),Qe.createElement("mesh",Ek({ref:a},s),Qe.createElement(t,{attach:"geometry",args:r}),i)})}const Cje=Rje("plane");var PP=1/1e3,Mje=1e3,kje=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*PP}get fixedDelta(){return this._fixedDelta*PP}set fixedDelta(n){this._fixedDelta=n*Mje}get elapsed(){return this._elapsed*PP}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Oje=(()=>{const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),t=new h0;return t.setAttribute("position",new Dh(n,3)),t.setAttribute("uv",new Dh(e,2)),t})(),qh=class T4{static get fullscreenGeometry(){return Oje}constructor(e="Pass",t=new uM,r=new o5){this.name=e,this.renderer=null,this.scene=t,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new wf(T4.fullscreenGeometry,e),t.frustumCulled=!1,this.scene===null&&(this.scene=new uM),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=wb){}render(e,t,r,i,s){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,r){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Nl||t instanceof Rb||t instanceof kc||t instanceof T4)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},Ije=class extends qh{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,t,r,i){const s=n.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},Nje=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,LR="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Kne=class extends io{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new on(null),opacity:new on(1)},blending:Il,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Nje,vertexShader:LR})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},Xne=class extends qh{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new Kne,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new Nl(1,1,{minFilter:ou,magFilter:ou,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,t,r,i){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==Do?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":n!==null&&n.outputColorSpace===Oi&&(this.renderTarget.texture.colorSpace=Oi))}},eG=new gi,Zne=class extends qh{constructor(n=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,t){this.color=n,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,t,r,i){const s=this.overrideClearColor,o=this.overrideClearAlpha,a=n.getClearAlpha(),c=s!==null,l=o>=0;c?(n.getClearColor(eG),n.setClearColor(s,l?o:a)):l&&n.setClearAlpha(o),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),c?n.setClearColor(eG,a):l&&n.setClearAlpha(a)}},Pje=class extends qh{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new Zne(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,t,r,i){const s=n.getContext(),o=n.state.buffers,a=this.scene,c=this.camera,l=this.clearPass,u=this.inverted?0:1,h=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.stencil.setFunc(s.ALWAYS,u,4294967295),o.stencil.setClear(h),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(n,null):(l.render(n,e),l.render(n,t))),this.renderToScreen?(n.setRenderTarget(null),n.render(a,c)):(n.setRenderTarget(e),n.render(a,c),n.setRenderTarget(t),n.render(a,c)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(s.EQUAL,1,4294967295),o.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.stencil.setLocked(!0)}},Jne=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:r=!1,multisampling:i=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,r,s,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Xne,this.depthTexture=null,this.passes=[],this.timer=new kje,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,r=this.multisampling;r>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):r!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const t=e.getSize(new Nn),r=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===Do&&e.outputColorSpace===Oi&&(this.inputBuffer.texture.colorSpace=Oi,this.outputBuffer.texture.colorSpace=Oi,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const s of this.passes)s.initialize(e,r,i)}}replaceRenderer(e,t=!0){const r=this.renderer,i=r.domElement.parentNode;return this.setRenderer(e),t&&i!==null&&(i.removeChild(r.domElement),i.appendChild(e.domElement)),r}createDepthTexture(){const e=this.depthTexture=new Vk;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=tx,e.type=ex):e.type=jv,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,r,i){const s=this.renderer,o=s===null?new Nn:s.getDrawingBufferSize(new Nn),a={minFilter:ou,magFilter:ou,stencilBuffer:t,depthBuffer:e,type:r},c=new Nl(o.width,o.height,a);return i>0&&(c.ignoreDepthForMultisampleCopy=!1,c.samples=i),r===Do&&s!==null&&s.outputColorSpace===Oi&&(c.texture.colorSpace=Oi),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const r=this.passes,i=this.renderer,s=i.getDrawingBufferSize(new Nn),o=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(s.width,s.height),e.initialize(i,o,a),this.autoRenderToScreen&&(r.length>0&&(r[r.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?r.splice(t,0,e):r.push(e),this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(e of r)e.setDepthTexture(c)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,r=t.indexOf(e);if(r!==-1&&t.splice(r,1).length>0){if(this.depthTexture!==null){const o=(c,l)=>c||l.needsDepthTexture;t.reduce(o,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&r===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,r=this.copyPass;let i=this.inputBuffer,s=this.outputBuffer,o=!1,a,c,l;e===void 0&&(this.timer.update(),e=this.timer.getDelta());for(const u of this.passes)u.enabled&&(u.render(t,i,s,e,o),u.needsSwap&&(o&&(r.renderToScreen=u.renderToScreen,a=t.getContext(),c=t.state.buffers.stencil,c.setFunc(a.NOTEQUAL,1,4294967295),r.render(t,i,s,e,o),c.setFunc(a.EQUAL,1,4294967295)),l=i,i=s,s=l),u instanceof Pje?o=!0:u instanceof Ije&&(o=!1))}setSize(e,t,r){const i=this.renderer,s=i.getSize(new Nn);(e===void 0||t===void 0)&&(e=s.width,t=s.height),(s.width!==e||s.height!==t)&&i.setSize(e,t,r);const o=i.getDrawingBufferSize(new Nn);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),qh.fullscreenGeometry.dispose()}},Fu={NONE:0,DEPTH:1,CONVOLUTION:2},$i={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Dje=class{constructor(){this.shaderParts=new Map([[$i.FRAGMENT_HEAD,null],[$i.FRAGMENT_MAIN_UV,null],[$i.FRAGMENT_MAIN_IMAGE,null],[$i.VERTEX_HEAD,null],[$i.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Fu.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=t_}},DP=!1,tG=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Ba:t=this.materialsFlatShadedDoubleSide;break;case ol:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Ba:t=this.materialsDoubleSide;break;case ol:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof io))return n.clone();const e=n.uniforms,t=new Map;for(const i in e){const s=e[i].value;s.isRenderTargetTexture&&(e[i].value=null,t.set(i,s))}const r=n.clone();for(const i of t)e[i[0]].value=i[1],r.uniforms[i[0]].value=i[1];return r}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const t of e)t.uniforms=Object.assign({},n.uniforms),t.side=e_;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.side=ol,r}),this.materialsDoubleSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.side=Ba,r}),this.materialsFlatShaded=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r.side=ol,r}),this.materialsFlatShadedDoubleSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r.side=Ba,r})}}render(n,e,t){const r=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,DP){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,t);for(const s of i)s[0].material=s[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,t),e.overrideMaterial=i}n.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return DP}static set workaroundEnabled(n){DP=n}},mv=-1,Af=class extends c_{constructor(n,e=mv,t=mv,r=1){super(),this.resizable=n,this.baseSize=new Nn(1,1),this.preferredSize=new Nn(e,t),this.target=this.preferredSize,this.s=r,this.effectiveSize=new Nn,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,t=this.effectiveSize,r=this.scale;e.width!==mv?t.width=e.width:e.height!==mv?t.width=Math.round(e.height*(n.width/Math.max(n.height,1))):t.width=Math.round(n.width*r),e.height!==mv?t.height=e.height:e.width!==mv?t.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):t.height=Math.round(n.height*r)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(mv),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return mv}},ui={ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Lje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb,y.a),opacity);}",Uje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,y.a*opacity);}",Bje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb)*0.5,y.a),opacity);}",Fje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.xy,xHSL.z));return mix(x,vec4(z,y.a),opacity);}",jje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/b)),vec3(1.0),step(1.0,a));return mix(x,vec4(z,y.a),opacity);}",zje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(x,vec4(z,y.a),opacity);}",Hje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb,y.rgb),y.a),opacity);}",Vje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(abs(x.rgb-y.rgb),y.a),opacity);}",Gje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb/max(y.rgb,1e-12),y.a),opacity);}",$je="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb-2.0*x.rgb*y.rgb),y.a),opacity);}",Wje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=min(x.rgb,1.0);vec3 b=min(y.rgb,1.0);vec3 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(x,vec4(z,y.a),opacity);}",qje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(step(1.0,x.rgb+y.rgb),y.a),opacity);}",Yje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.x,xHSL.yz));return mix(x,vec4(z,y.a),opacity);}",Kje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-y.rgb,y.a),opacity);}",Xje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(y.rgb*(1.0-x.rgb),y.a),opacity);}",Zje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb,y.rgb),y.a),opacity);}",Jje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(y.rgb+x.rgb-1.0,0.0,1.0),y.a),opacity);}",Qje="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb+y.rgb,1.0),y.a),opacity);}",eze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(2.0*y.rgb+x.rgb-1.0,0.0,1.0),y.a),opacity);}",tze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.xy,yHSL.z));return mix(x,vec4(z,y.a),opacity);}",nze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb*y.rgb,y.a),opacity);}",rze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-abs(1.0-x.rgb-y.rgb),y.a),opacity);}",ize="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",sze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(2.0*y.rgb*x.rgb,1.0-2.0*(1.0-y.rgb)*(1.0-x.rgb),step(0.5,x.rgb));return mix(x,vec4(z,y.a),opacity);}",oze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 y2=2.0*y.rgb;vec3 z=mix(mix(y2,x.rgb,step(0.5*x.rgb,y.rgb)),max(y2-1.0,vec3(0.0)),step(x.rgb,y2-1.0));return mix(x,vec4(z,y.a),opacity);}",aze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(min(x.rgb*x.rgb/max(1.0-y.rgb,1e-12),1.0),y.rgb,step(1.0,y.rgb));return mix(x,vec4(z,y.a),opacity);}",cze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.x,yHSL.y,xHSL.z));return mix(x,vec4(z,y.a),opacity);}",lze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb-min(x.rgb*y.rgb,1.0),y.a),opacity);}",uze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb;vec3 b=y.rgb;vec3 y2=2.0*b;vec3 w=step(0.5,b);vec3 c=a-(1.0-y2)*a*(1.0-a);vec3 d=mix(a+(y2-1.0)*(sqrt(a)-a),a+(y2-1.0)*a*((16.0*a-12.0)*a+3.0),w*(1.0-step(0.25,a)));vec3 z=mix(c,d,w);return mix(x,vec4(z,y.a),opacity);}",hze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",fze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb+y.rgb-1.0,0.0),y.a),opacity);}",dze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(max(1.0-min((1.0-x.rgb)/(2.0*y.rgb),1.0),0.0),min(x.rgb/(2.0*(1.0-y.rgb)),1.0),step(0.5,y.rgb));return mix(x,vec4(z,y.a),opacity);}",pze=new Map([[ui.ADD,Lje],[ui.ALPHA,Uje],[ui.AVERAGE,Bje],[ui.COLOR,Fje],[ui.COLOR_BURN,jje],[ui.COLOR_DODGE,zje],[ui.DARKEN,Hje],[ui.DIFFERENCE,Vje],[ui.DIVIDE,Gje],[ui.DST,null],[ui.EXCLUSION,$je],[ui.HARD_LIGHT,Wje],[ui.HARD_MIX,qje],[ui.HUE,Yje],[ui.INVERT,Kje],[ui.INVERT_RGB,Xje],[ui.LIGHTEN,Zje],[ui.LINEAR_BURN,Jje],[ui.LINEAR_DODGE,Qje],[ui.LINEAR_LIGHT,eze],[ui.LUMINOSITY,tze],[ui.MULTIPLY,nze],[ui.NEGATION,rze],[ui.NORMAL,ize],[ui.OVERLAY,sze],[ui.PIN_LIGHT,oze],[ui.REFLECT,aze],[ui.SATURATION,cze],[ui.SCREEN,lze],[ui.SOFT_LIGHT,uze],[ui.SRC,hze],[ui.SUBTRACT,fze],[ui.VIVID_LIGHT,dze]]),mze=class extends c_{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new on(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return pze.get(this.blendFunction)}},Id=class extends c_{constructor(n,e,{attributes:t=Fu.NONE,blendFunction:r=ui.NORMAL,defines:i=new Map,uniforms:s=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=n,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=a,this.defines=i,this.uniforms=s,this.extensions=o,this.blendMode=new mze(r),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=t_,this._outputColorSpace=Bm}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,e=wb){}update(n,e,t){}setSize(n,e){}initialize(n,e,t){}dispose(){for(const n of Object.keys(this)){const e=this[n];(e instanceof Nl||e instanceof Rb||e instanceof kc||e instanceof qh)&&this[n].dispose()}}},UR={MEDIUM:2,LARGE:3,VERY_LARGE:4},gze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,_ze="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",vze=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],yze=class extends io{constructor(n=new Zo){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new on(null),texelSize:new on(new Zo),scale:new on(1),kernel:new on(0)},blending:Il,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:gze,vertexShader:_ze}),this.setTexelSize(n.x,n.y),this.kernelSize=UR.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return vze[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e,n*.5,e*.5)}setSize(n,e){const t=1/n,r=1/e;this.uniforms.texelSize.value.set(t,r,t*.5,r*.5)}},Qne=class extends qh{constructor({kernelSize:n=UR.MEDIUM,resolutionScale:e=.5,width:t=Af.AUTO_SIZE,height:r=Af.AUTO_SIZE,resolutionX:i=t,resolutionY:s=r}={}){super("KawaseBlurPass"),this.renderTargetA=new Nl(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new Af(this,i,s,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new yze,this._blurMaterial.kernelSize=n,this.copyMaterial=new Kne}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,r,i){const s=this.scene,o=this.camera,a=this.renderTargetA,c=this.renderTargetB,l=this.blurMaterial,u=l.kernelSequence;let h=e;this.fullscreenMaterial=l;for(let f=0,d=u.length;f<d;++f){const p=(f&1)===0?a:c;l.kernel=u[f],l.inputBuffer=h.texture,n.setRenderTarget(p),n.render(s,o),h=p}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,n.setRenderTarget(this.renderToScreen?null:t),n.render(s,o)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const r=t.width,i=t.height;this.renderTargetA.setSize(r,i),this.renderTargetB.setSize(r,i),this.blurMaterial.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==Do?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):n!==null&&n.outputColorSpace===Oi&&(this.renderTargetA.texture.colorSpace=Oi,this.renderTargetB.texture.colorSpace=Oi))}static get AUTO_SIZE(){return Af.AUTO_SIZE}},bze=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);float mask=1.0;
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);mask=low*high;
#elif defined(THRESHOLD)
mask=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=texel*mask;
#else
gl_FragColor=vec4(l*mask);
#endif
}`,Sze=class extends io{constructor(n=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:FA.replace(/\D+/g,"")},uniforms:{inputBuffer:new on(null),threshold:new on(0),smoothing:new on(1),range:new on(null)},blending:Il,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:bze,vertexShader:LR}),this.colorOutput=n,this.luminanceRange=e}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},Eze=class extends qh{constructor({renderTarget:n,luminanceRange:e,colorOutput:t,resolutionScale:r=1,width:i=Af.AUTO_SIZE,height:s=Af.AUTO_SIZE,resolutionX:o=i,resolutionY:a=s}={}){super("LuminancePass"),this.fullscreenMaterial=new Sze(t,e),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Nl(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new Af(this,o,a,r);c.addEventListener("change",l=>this.setSize(c.baseWidth,c.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,e,t,r,i){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}initialize(n,e,t){t!==void 0&&t!==Do&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},xze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Tze="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",wze=class extends io{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new on(null),texelSize:new on(new Nn)},blending:Il,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:xze,vertexShader:Tze})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Aze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,Rze="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",Cze=class extends io{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new on(null),supportBuffer:new on(null),texelSize:new on(new Nn),radius:new on(.85)},blending:Il,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Aze,vertexShader:Rze})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Mze=class extends qh{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Nl(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new wze,this.upsamplingMaterial=new Cze,this.resolution=new Nn}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<n;++t){const r=e.clone();r.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(r)}this.upsamplingMipmaps.push(e);for(let t=1,r=n-1;t<r;++t){const i=e.clone();i.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(i)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,e,t,r,i){const{scene:s,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:c}=this,{downsamplingMipmaps:l,upsamplingMipmaps:u}=this;let h=e;this.fullscreenMaterial=a;for(let f=0,d=l.length;f<d;++f){const p=l[f];a.setSize(h.width,h.height),a.inputBuffer=h.texture,n.setRenderTarget(p),n.render(s,o),h=p}this.fullscreenMaterial=c;for(let f=u.length-1;f>=0;--f){const d=u[f];c.setSize(h.width,h.height),c.inputBuffer=h.texture,c.supportBuffer=l[f].texture,n.setRenderTarget(d),n.render(s,o),h=d}}setSize(n,e){const t=this.resolution;t.set(n,e);let r=t.width,i=t.height;for(let s=0,o=this.downsamplingMipmaps.length;s<o;++s)r=Math.round(r*.5),i=Math.round(i*.5),this.downsamplingMipmaps[s].setSize(r,i),s<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[s].setSize(r,i)}initialize(n,e,t){if(t!==void 0){const r=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const i of r)i.texture.type=t;if(t!==Do)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(n!==null&&n.outputColorSpace===Oi)for(const i of r)i.texture.colorSpace=Oi}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},kze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,max(inputColor.a,texel.a));}`,Oze=class extends Id{constructor({blendFunction:n=ui.SCREEN,luminanceThreshold:e=1,luminanceSmoothing:t=.03,mipmapBlur:r=!0,intensity:i=1,radius:s=.85,levels:o=8,kernelSize:a=UR.LARGE,resolutionScale:c=.5,width:l=Af.AUTO_SIZE,height:u=Af.AUTO_SIZE,resolutionX:h=l,resolutionY:f=u}={}){super("BloomEffect",kze,{blendFunction:n,uniforms:new Map([["map",new on(null)],["intensity",new on(i)]])}),this.renderTarget=new Nl(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new Qne({kernelSize:a}),this.luminancePass=new Eze({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new Mze,this.mipmapBlurPass.enabled=r,this.mipmapBlurPass.radius=s,this.mipmapBlurPass.levels=o,this.uniforms.get("map").value=r?this.mipmapBlurPass.texture:this.renderTarget.texture;const d=this.resolution=new Af(this,h,f,c);d.addEventListener("change",p=>this.setSize(d.baseWidth,d.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,e,t){const r=this.renderTarget,i=this.luminancePass;i.enabled?(i.render(n,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,i.renderTarget):this.blurPass.render(n,i.renderTarget,r)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,e):this.blurPass.render(n,e,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(n,e),this.mipmapBlurPass.setSize(n,e)}initialize(n,e,t){this.blurPass.initialize(n,e,t),this.luminancePass.initialize(n,e,t),this.mipmapBlurPass.initialize(n,e,t),t!==void 0&&(this.renderTarget.texture.type=t,n!==null&&n.outputColorSpace===Oi&&(this.renderTarget.texture.colorSpace=Oi))}},NE={RED:0,GREEN:1,BLUE:2,ALPHA:3},L8={DISCARD:0,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},Ize=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,Q2=class extends io{constructor(n=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:n?"2":"1"},uniforms:{inputBuffer:new on(null),cocBuffer:new on(null),texelSize:new on(new Nn),kernel64:new on(null),kernel16:new on(null),scale:new on(1)},blending:Il,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ize,vertexShader:LR}),e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set cocBuffer(n){this.uniforms.cocBuffer.value=n}setCoCBuffer(n){this.uniforms.cocBuffer.value=n}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(n){return this.scale}setScale(n){this.scale=n}generateKernel(){const n=2.39996323,e=new Float64Array(128),t=new Float64Array(32);let r=0,i=0;for(let s=0,o=Math.sqrt(80);s<80;++s){const a=s*n,c=Math.sqrt(s)/o,l=c*Math.cos(a),u=c*Math.sin(a);s%5===0?(t[i++]=l,t[i++]=u):(e[r++]=l,e[r++]=u)}this.uniforms.kernel64.value=e,this.uniforms.kernel16.value=t}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}};function nG(n,e,t){return n*(e-t)-e}function w4(n,e,t){return Math.min(Math.max((n+e)/(e-t),0),1)}var Nze=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,Pze=class extends io{constructor(n){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new on(null),focusDistance:new on(0),focusRange:new on(0),cameraNear:new on(.3),cameraFar:new on(1e3)},blending:Il,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Nze,vertexShader:LR}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(n)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=wb){this.depthBuffer=n,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(n){this.uniforms.focusDistance.value=n}get worldFocusDistance(){return-nG(this.focusDistance,this.near,this.far)}set worldFocusDistance(n){this.focusDistance=w4(-n,this.near,this.far)}getFocusDistance(n){this.uniforms.focusDistance.value=n}setFocusDistance(n){this.uniforms.focusDistance.value=n}get focalLength(){return this.focusRange}set focalLength(n){this.focusRange=n}get focusRange(){return this.uniforms.focusRange.value}set focusRange(n){this.uniforms.focusRange.value=n}get worldFocusRange(){return-nG(this.focusRange,this.near,this.far)}set worldFocusRange(n){this.focusRange=w4(-n,this.near,this.far)}getFocalLength(n){return this.focusRange}setFocalLength(n){this.focusRange=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof Ou?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Dze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,Lze=class extends io{constructor(n=null){super({name:"MaskMaterial",uniforms:{maskTexture:new on(n),inputBuffer:new on(null),strength:new on(1)},blending:Il,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Dze,vertexShader:LR}),this.colorChannel=NE.RED,this.maskFunction=L8.DISCARD}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set maskTexture(n){this.uniforms.maskTexture.value=n,delete this.defines.MASK_PRECISION_HIGH,n.type!==Do&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(n){this.maskTexture=n}set colorChannel(n){this.defines.COLOR_CHANNEL=n.toFixed(0),this.needsUpdate=!0}setColorChannel(n){this.colorChannel=n}set maskFunction(n){this.defines.MASK_FUNCTION=n.toFixed(0),this.needsUpdate=!0}setMaskFunction(n){this.maskFunction=n}get inverted(){return this.defines.INVERTED!==void 0}set inverted(n){this.inverted&&!n?delete this.defines.INVERTED:n&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get strength(){return this.uniforms.strength.value}set strength(n){this.uniforms.strength.value=n}getStrength(){return this.strength}setStrength(n){this.strength=n}},sE=class extends qh{constructor(n,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=e}setInput(n){this.input=n}render(n,e,t,r,i){const s=this.fullscreenMaterial.uniforms;e!==null&&s!==void 0&&s[this.input]!==void 0&&(s[this.input].value=e.texture),n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}initialize(n,e,t){t!==void 0&&t!==Do&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Uze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,Bze=class extends Id{constructor(n,{blendFunction:e,worldFocusDistance:t,worldFocusRange:r,focusDistance:i=0,focalLength:s=.1,focusRange:o=s,bokehScale:a=1,resolutionScale:c=1,width:l=Af.AUTO_SIZE,height:u=Af.AUTO_SIZE,resolutionX:h=l,resolutionY:f=u}={}){super("DepthOfFieldEffect",Uze,{blendFunction:e,attributes:Fu.DEPTH,uniforms:new Map([["nearColorBuffer",new on(null)],["farColorBuffer",new on(null)],["nearCoCBuffer",new on(null)],["farCoCBuffer",new on(null)],["scale",new on(1)]])}),this.camera=n,this.renderTarget=new Nl(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new sE(new Pze(n));const d=this.cocMaterial;d.focusDistance=i,d.focusRange=o,t!==void 0&&(d.worldFocusDistance=t),r!==void 0&&(d.worldFocusRange=r),this.blurPass=new Qne({resolutionScale:c,resolutionX:h,resolutionY:f,kernelSize:UR.MEDIUM}),this.maskPass=new sE(new Lze(this.renderTargetCoC.texture));const p=this.maskPass.fullscreenMaterial;p.colorChannel=NE.GREEN,this.maskFunction=L8.MULTIPLY_RGB,this.bokehNearBasePass=new sE(new Q2(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new sE(new Q2(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new sE(new Q2(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new sE(new Q2(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const _=this.resolution=new Af(this,h,f,c);_.addEventListener("change",g=>this.setSize(_.baseWidth,_.baseHeight)),this.bokehScale=a}set mainCamera(n){this.camera=n,this.cocMaterial.copyCameraSettings(n)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(n){this.maskFunction!==n&&(this.defines.set("MASK_FUNCTION",n.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=n,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(n){this.bokehNearBasePass.fullscreenMaterial.scale=n,this.bokehNearFillPass.fullscreenMaterial.scale=n,this.bokehFarBasePass.fullscreenMaterial.scale=n,this.bokehFarFillPass.fullscreenMaterial.scale=n,this.maskPass.fullscreenMaterial.strength=n,this.uniforms.get("scale").value=n}getBokehScale(){return this.bokehScale}setBokehScale(n){this.bokehScale=n}getTarget(){return this.target}setTarget(n){this.target=n}calculateFocusDistance(n){const e=this.camera,t=e.position.distanceTo(n);return w4(-t,e.near,e.far)}setDepthTexture(n,e=wb){this.cocMaterial.depthBuffer=n,this.cocMaterial.depthPacking=e}update(n,e,t){const r=this.renderTarget,i=this.renderTargetCoC,s=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(this.target!==null){const a=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=a}this.cocPass.render(n,null,i),this.blurPass.render(n,i,s),this.maskPass.render(n,e,o),this.bokehFarBasePass.render(n,o,r),this.bokehFarFillPass.render(n,r,this.renderTargetFar),this.bokehNearBasePass.render(n,e,r),this.bokehNearFillPass.render(n,r,this.renderTargetNear)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const r=t.width,i=t.height;this.cocPass.setSize(n,e),this.blurPass.setSize(n,e),this.maskPass.setSize(n,e),this.renderTargetFar.setSize(n,e),this.renderTargetCoC.setSize(n,e),this.renderTargetMasked.setSize(n,e),this.renderTarget.setSize(r,i),this.renderTargetNear.setSize(r,i),this.renderTargetCoCBlurred.setSize(r,i),this.bokehNearBasePass.fullscreenMaterial.setSize(n,e),this.bokehNearFillPass.fullscreenMaterial.setSize(n,e),this.bokehFarBasePass.fullscreenMaterial.setSize(n,e),this.bokehFarFillPass.fullscreenMaterial.setSize(n,e)}initialize(n,e,t){this.cocPass.initialize(n,e,t),this.maskPass.initialize(n,e,t),this.bokehNearBasePass.initialize(n,e,t),this.bokehNearFillPass.initialize(n,e,t),this.bokehFarBasePass.initialize(n,e,t),this.bokehFarFillPass.initialize(n,e,t),this.blurPass.initialize(n,e,Do),n.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),t!==void 0&&(this.renderTarget.texture.type=t,this.renderTargetNear.texture.type=t,this.renderTargetFar.texture.type=t,this.renderTargetMasked.texture.type=t,n!==null&&n.outputColorSpace===Oi&&(this.renderTarget.texture.colorSpace=Oi,this.renderTargetNear.texture.colorSpace=Oi,this.renderTargetFar.texture.colorSpace=Oi,this.renderTargetMasked.texture.colorSpace=Oi))}},Cv={DISABLED:0,SPORADIC:1,CONSTANT_MILD:2,CONSTANT_WILD:3};function Fze(n,e,t){const r=new Map([[jA,1],[e5,2],[Du,4]]);let i;if(r.has(e)||console.error("Invalid noise texture format"),t===Do){i=new Uint8Array(n*r.get(e));for(let s=0,o=i.length;s<o;++s)i[s]=Math.random()*255+.5}else{i=new Float32Array(n*r.get(e));for(let s=0,o=i.length;s<o;++s)i[s]=Math.random()}return i}var rG=class extends Hk{constructor(n,e,t=jA,r=Do){super(Fze(n*e,t,r),n,e,t,r),this.needsUpdate=!0}},jze="uniform lowp sampler2D perturbationMap;uniform bool active;uniform float columns;uniform float random;uniform vec2 seeds;uniform vec2 distortion;void mainUv(inout vec2 uv){if(active){if(uv.y<distortion.x+columns&&uv.y>distortion.x-columns*random){float sx=clamp(ceil(seeds.x),0.0,1.0);uv.y=sx*(1.0-(uv.y+distortion.y))+(1.0-sx)*distortion.y;}if(uv.x<distortion.y+columns&&uv.x>distortion.y-columns*random){float sy=clamp(ceil(seeds.y),0.0,1.0);uv.x=sy*distortion.x+(1.0-sy)*(1.0-(uv.x+distortion.x));}vec2 normal=texture2D(perturbationMap,uv*random*random).rg;uv+=normal*seeds*(random*0.2);}}",eC="Glitch.Generated";function Sh(n,e){return n+Math.random()*(e-n)}var zze=class extends Id{constructor({chromaticAberrationOffset:n=null,delay:e=new Nn(1.5,3.5),duration:t=new Nn(.6,1),strength:r=new Nn(.3,1),columns:i=.05,ratio:s=.85,perturbationMap:o=null,dtSize:a=64}={}){if(super("GlitchEffect",jze,{uniforms:new Map([["perturbationMap",new on(null)],["columns",new on(i)],["active",new on(!1)],["random",new on(1)],["seeds",new on(new Nn)],["distortion",new on(new Nn)]])}),o===null){const c=new rG(a,a,Du);c.name=eC,this.perturbationMap=c}else this.perturbationMap=o;this.time=0,this.distortion=this.uniforms.get("distortion").value,this.delay=e,this.duration=t,this.breakPoint=new Nn(Sh(this.delay.x,this.delay.y),Sh(this.duration.x,this.duration.y)),this.strength=r,this.mode=Cv.SPORADIC,this.ratio=s,this.chromaticAberrationOffset=n}get seeds(){return this.uniforms.get("seeds").value}get active(){return this.uniforms.get("active").value}isActive(){return this.active}get minDelay(){return this.delay.x}set minDelay(n){this.delay.x=n}getMinDelay(){return this.delay.x}setMinDelay(n){this.delay.x=n}get maxDelay(){return this.delay.y}set maxDelay(n){this.delay.y=n}getMaxDelay(){return this.delay.y}setMaxDelay(n){this.delay.y=n}get minDuration(){return this.duration.x}set minDuration(n){this.duration.x=n}getMinDuration(){return this.duration.x}setMinDuration(n){this.duration.x=n}get maxDuration(){return this.duration.y}set maxDuration(n){this.duration.y=n}getMaxDuration(){return this.duration.y}setMaxDuration(n){this.duration.y=n}get minStrength(){return this.strength.x}set minStrength(n){this.strength.x=n}getMinStrength(){return this.strength.x}setMinStrength(n){this.strength.x=n}get maxStrength(){return this.strength.y}set maxStrength(n){this.strength.y=n}getMaxStrength(){return this.strength.y}setMaxStrength(n){this.strength.y=n}getMode(){return this.mode}setMode(n){this.mode=n}getGlitchRatio(){return 1-this.ratio}setGlitchRatio(n){this.ratio=Math.min(Math.max(1-n,0),1)}get columns(){return this.uniforms.get("columns").value}set columns(n){this.uniforms.get("columns").value=n}getGlitchColumns(){return this.columns}setGlitchColumns(n){this.columns=n}getChromaticAberrationOffset(){return this.chromaticAberrationOffset}setChromaticAberrationOffset(n){this.chromaticAberrationOffset=n}get perturbationMap(){return this.uniforms.get("perturbationMap").value}set perturbationMap(n){const e=this.perturbationMap;e!==null&&e.name===eC&&e.dispose(),n.minFilter=n.magFilter=cu,n.wrapS=n.wrapT=aM,n.generateMipmaps=!1,this.uniforms.get("perturbationMap").value=n}getPerturbationMap(){return this.perturbationMap}setPerturbationMap(n){this.perturbationMap=n}generatePerturbationMap(n=64){const e=new rG(n,n,Du);return e.name=eC,e}update(n,e,t){const r=this.mode,i=this.breakPoint,s=this.chromaticAberrationOffset,o=this.strength;let a=this.time,c=!1,l=0,u=0,h;r!==Cv.DISABLED&&(r===Cv.SPORADIC&&(a+=t,h=a>i.x,a>=i.x+i.y&&(i.set(Sh(this.delay.x,this.delay.y),Sh(this.duration.x,this.duration.y)),a=0)),l=Math.random(),this.uniforms.get("random").value=l,h&&l>this.ratio||r===Cv.CONSTANT_WILD?(c=!0,l*=o.y*.03,u=Sh(-Math.PI,Math.PI),this.seeds.set(Sh(-o.y,o.y),Sh(-o.y,o.y)),this.distortion.set(Sh(0,1),Sh(0,1))):(h||r===Cv.CONSTANT_MILD)&&(c=!0,l*=o.x*.03,u=Sh(-Math.PI,Math.PI),this.seeds.set(Sh(-o.x,o.x),Sh(-o.x,o.x)),this.distortion.set(Sh(0,1),Sh(0,1))),this.time=a),s!==null&&(c?s.set(Math.cos(u),Math.sin(u)).multiplyScalar(l):s.set(0,0)),this.uniforms.get("active").value=c}dispose(){const n=this.perturbationMap;n!==null&&n.name===eC&&n.dispose()}},ere=class extends qh{constructor(n,e,t=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new Zne,this.overrideMaterialManager=t===null?null:new tG(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new tG(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,t,r,i){const s=this.scene,o=this.camera,a=this.selection,c=o.layers.mask,l=s.background,u=n.shadowMap.autoUpdate,h=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,s,o):n.render(s,o),o.layers.mask=c,s.background=l,n.shadowMap.autoUpdate=u}},SE={DEFAULT:0,ESKIL:1},Hze=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*(1.0+time)));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,Vze=class extends Id{constructor({blendFunction:n=ui.SCREEN,premultiply:e=!1}={}){super("NoiseEffect",Hze,{blendFunction:n}),this.premultiply=e}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(n){this.premultiply!==n&&(n?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(n){this.premultiply=n}},Gze=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,$ze=class extends Id{constructor({blendFunction:n,eskil:e=!1,technique:t=e?SE.ESKIL:SE.DEFAULT,offset:r=.5,darkness:i=.5}={}){super("VignetteEffect",Gze,{blendFunction:n,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new on(r)],["darkness",new on(i)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(n){this.technique!==n&&(this.defines.set("VIGNETTE_TECHNIQUE",n.toFixed(0)),this.setChanged())}get eskil(){return this.technique===SE.ESKIL}set eskil(n){this.technique=n?SE.ESKIL:SE.DEFAULT}getTechnique(){return this.technique}setTechnique(n){this.technique=n}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}get darkness(){return this.uniforms.get("darkness").value}set darkness(n){this.uniforms.get("darkness").value=n}getDarkness(){return this.darkness}setDarkness(n){this.darkness=n}},Wze=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,qze="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Yze=class extends io{constructor(n,e,t,r,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:FA.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new on(null),depthBuffer:new on(null),resolution:new on(new Nn),texelSize:new on(new Nn),cameraNear:new on(.3),cameraFar:new on(1e3),aspect:new on(1),time:new on(0)},blending:Il,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),n&&this.setShaderParts(n),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(r)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=wb){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=Wze.replace($i.FRAGMENT_HEAD,n.get($i.FRAGMENT_HEAD)||"").replace($i.FRAGMENT_MAIN_UV,n.get($i.FRAGMENT_MAIN_UV)||"").replace($i.FRAGMENT_MAIN_IMAGE,n.get($i.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=qze.replace($i.VERTEX_HEAD,n.get($i.VERTEX_HEAD)||"").replace($i.VERTEX_MAIN_SUPPORT,n.get($i.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof Ou?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms;t.resolution.value.set(n,e),t.texelSize.value.set(1/n,1/e),t.aspect.value=n/e}static get Section(){return $i}};function iG(n,e,t){for(const r of e){const i="$1"+n+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(s,i))}}function Kze(n,e,t){let r=e.getFragmentShader(),i=e.getVertexShader();const s=r!==void 0&&/mainImage/.test(r),o=r!==void 0&&/mainUv/.test(r);if(t.attributes|=e.getAttributes(),r===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&(t.attributes&Fu.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!s&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=t.shaderParts;let l=c.get($i.FRAGMENT_HEAD)||"",u=c.get($i.FRAGMENT_MAIN_UV)||"",h=c.get($i.FRAGMENT_MAIN_IMAGE)||"",f=c.get($i.VERTEX_HEAD)||"",d=c.get($i.VERTEX_MAIN_SUPPORT)||"";const p=new Set,_=new Set;if(o&&(u+=`	${n}MainUv(UV);
`,t.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const b=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);d+=`	${n}MainSupport(`,d+=b?`vUv);
`:`);
`;for(const y of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const x of y[1].split(/\s*,\s*/))t.varyings.add(x),p.add(x),_.add(x);for(const y of i.matchAll(a))_.add(y[1])}for(const b of r.matchAll(a))_.add(b[1]);for(const b of e.defines.keys())_.add(b.replace(/\([\w\s,]*\)/g,""));for(const b of e.uniforms.keys())_.add(b);_.delete("while"),_.delete("for"),_.delete("if"),e.uniforms.forEach((b,y)=>t.uniforms.set(n+y.charAt(0).toUpperCase()+y.slice(1),b)),e.defines.forEach((b,y)=>t.defines.set(n+y.charAt(0).toUpperCase()+y.slice(1),b));const g=new Map([["fragment",r],["vertex",i]]);iG(n,_,t.defines),iG(n,_,g),r=g.get("fragment"),i=g.get("vertex");const m=e.blendMode;if(t.blendModes.set(m.blendFunction,m),s){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(h+=e.inputColorSpace===Oi?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==Bm?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const b=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;h+=`${n}MainImage(color0, UV, `,(t.attributes&Fu.DEPTH)!==0&&b.test(r)&&(h+="depth, ",t.readDepth=!0),h+=`color1);
	`;const y=n+"BlendOpacity";t.uniforms.set(y,m.opacity),h+=`color0 = blend${m.blendFunction}(color0, color1, ${y});

	`,l+=`uniform float ${y};

`}if(l+=r+`
`,i!==null&&(f+=i+`
`),c.set($i.FRAGMENT_HEAD,l),c.set($i.FRAGMENT_MAIN_UV,u),c.set($i.FRAGMENT_MAIN_IMAGE,h),c.set($i.VERTEX_HEAD,f),c.set($i.VERTEX_MAIN_SUPPORT,d),e.extensions!==null)for(const b of e.extensions)t.extensions.add(b)}}var tre=class extends qh{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new Yze(null,null,null,n),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new Dje;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===ui.DST)n.attributes|=o.getAttributes()&Fu.DEPTH;else{if((n.attributes&o.getAttributes()&Fu.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${o.name})`);Kze("e"+e++,o,n)}let t=n.shaderParts.get($i.FRAGMENT_HEAD),r=n.shaderParts.get($i.FRAGMENT_MAIN_IMAGE),i=n.shaderParts.get($i.FRAGMENT_MAIN_UV);const s=/\bblend\b/g;for(const o of n.blendModes.values())t+=o.getShaderCode().replace(s,`blend${o.blendFunction}`)+`
`;(n.attributes&Fu.DEPTH)!==0?(n.readDepth&&(r=`float depth = readDepth(UV);

	`+r),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===Oi&&(r+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set($i.FRAGMENT_HEAD,t),n.shaderParts.set($i.FRAGMENT_MAIN_IMAGE,r),n.shaderParts.set($i.FRAGMENT_MAIN_UV,i);for(const[o,a]of n.shaderParts)a!==null&&n.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=wb){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(n,e)}render(n,e,t,r,i){for(const s of this.effects)s.update(n,e,r);if(!this.skipRendering||this.renderToScreen){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,s.time+=r*this.timeScale,n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const t of this.effects)t.setSize(n,e)}initialize(n,e,t){this.renderer=n;for(const r of this.effects)r.initialize(n,e,t);this.updateMaterial(),t!==void 0&&t!==Do&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}};function Bw(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}new Nn;new Nn;function nre(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var ud=function n(e,t,r){var i=this;nre(this,n),Bw(this,"dot2",function(s,o){return i.x*s+i.y*o}),Bw(this,"dot3",function(s,o,a){return i.x*s+i.y*o+i.z*a}),this.x=e,this.y=t,this.z=r},Xze=[new ud(1,1,0),new ud(-1,1,0),new ud(1,-1,0),new ud(-1,-1,0),new ud(1,0,1),new ud(-1,0,1),new ud(1,0,-1),new ud(-1,0,-1),new ud(0,1,1),new ud(0,-1,1),new ud(0,1,-1),new ud(0,-1,-1)],sG=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],oG=new Array(512),aG=new Array(512),Zze=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var t=0;t<256;t++){var r;t&1?r=sG[t]^e&255:r=sG[t]^e>>8&255,oG[t]=oG[t+256]=r,aG[t]=aG[t+256]=Xze[r%12]}};Zze(0);function Jze(n){if(typeof n=="number")n=Math.abs(n);else if(typeof n=="string"){var e=n;n=0;for(var t=0;t<e.length;t++)n=(n+(t+1)*(e.charCodeAt(t)%96))%2147483647}return n===0&&(n=311),n}function cG(n){var e=Jze(n);return function(){var t=e*48271%2147483647;return e=t,t/2147483647}}var Qze=function n(e){var t=this;nre(this,n),Bw(this,"seed",0),Bw(this,"init",function(r){t.seed=r,t.value=cG(r)}),Bw(this,"value",cG(this.seed)),this.init(e)};new Qze(Math.random());const U8=Qe.createContext(null);let eHe=0;const lG=new WeakMap,cT=(n,e)=>function({blendFunction:t=e?.blendFunction,opacity:r=e?.opacity,...i}){let s=lG.get(n);if(!s){const c=`@react-three/postprocessing/${n.name}-${eHe++}`;kW({[c]:n}),lG.set(n,s=c)}const o=cl(c=>c.camera),a=Tf.useMemo(()=>[...e?.args??[],...i.args??[{...e,...i}]],[JSON.stringify(i)]);return xe.jsx(s,{camera:o,"blendMode-blendFunction":t,"blendMode-opacity-value":r,...i,args:a})},tC=(n,e)=>{const t=n[e];return Tf.useMemo(()=>typeof t=="number"?new Nn(t,t):t?new Nn(...t):new Nn,[t])},B8=Qe.forwardRef(function({blendFunction:n,worldFocusDistance:e,worldFocusRange:t,focusDistance:r,focusRange:i,focalLength:s,bokehScale:o,resolutionScale:a,resolutionX:c,resolutionY:l,width:u,height:h,target:f,depthTexture:d,...p},_){const{camera:g}=Qe.useContext(U8),m=f!=null,b=Qe.useMemo(()=>{const y=new Bze(g,{blendFunction:n,worldFocusDistance:e,worldFocusRange:t,focusDistance:r,focusRange:i,focalLength:s,bokehScale:o,resolutionScale:a,resolutionX:c,resolutionY:l,width:u,height:h});m&&(y.target=new Lt),d&&y.setDepthTexture(d.texture,d.packing);const x=y.maskPass;return x.maskFunction=L8.MULTIPLY_RGB_SET_ALPHA,y},[g,n,e,t,r,i,s,o,a,c,l,u,h,m,d]);return Qe.useEffect(()=>()=>{b.dispose()},[b]),xe.jsx("primitive",{...p,ref:_,object:b,target:f})}),tHe=cT(Oze,{blendFunction:0}),nHe=Qe.forwardRef(function({active:n=!0,...e},t){const r=cl(l=>l.invalidate),i=tC(e,"delay"),s=tC(e,"duration"),o=tC(e,"strength"),a=tC(e,"chromaticAberrationOffset"),c=Qe.useMemo(()=>new zze({...e,delay:i,duration:s,strength:o,chromaticAberrationOffset:a}),[i,s,e,o,a]);return Qe.useLayoutEffect(()=>{c.mode=n?e.mode||Cv.SPORADIC:Cv.DISABLED,r()},[n,c,r,e.mode]),Qe.useEffect(()=>()=>{c.dispose?.()},[c]),xe.jsx("primitive",{ref:t,object:c,dispose:null})}),rHe=cT(Vze,{blendFunction:5}),iHe=cT($ze);var Nd=typeof window<"u"?window:{screen:{},navigator:{}},Dx=(Nd.matchMedia||(function(){return{matches:!1}})).bind(Nd),sHe={get passive(){return!0}},rre=function(){};Nd.addEventListener&&Nd.addEventListener("p",rre,sHe);Nd.removeEventListener&&Nd.removeEventListener("p",rre,!1);var F8="ontouchstart"in Nd,oHe="TouchEvent"in Nd,aHe=F8||oHe&&Dx("(any-pointer: coarse)").matches,uG=(Nd.navigator.maxTouchPoints||0)>0||aHe,ire=Nd.navigator.userAgent||"",cHe=Dx("(pointer: coarse)").matches&&/iPad|Macintosh/.test(ire)&&Math.min(Nd.screen.width||0,Nd.screen.height||0)>=768,sre=(Dx("(pointer: coarse)").matches||!Dx("(pointer: fine)").matches&&F8)&&!/Windows.*Firefox/.test(ire),lHe=Dx("(any-pointer: fine)").matches||Dx("(any-hover: hover)").matches||cHe||!F8,A4=uG&&(lHe||!sre)?"hybrid":uG?"touchOnly":"mouseOnly",uHe=A4==="mouseOnly"?"mouse":A4==="touchOnly"||sre?"touch":"mouse";const hHe=`  
vec3 halftone(vec3 texcolor, vec2 st, float frequency) {
  float n = 0.1 * snoise(st * 200.0); // Fractal noise
  n += 0.05 * snoise(st * 400.0);
  n += 0.025 * snoise(st * 800.0);

  // Perform a rough RGB-to-CMYK conversion
  vec4 cmyk;
  // CMY = 1-RGB
  cmyk.xyz = 1.0 - texcolor;
  // Black generation: K = min(C,M,Y)
  cmyk.w = min(cmyk.x, min(cmyk.y, cmyk.z)); 
  // Grey component replacement: subtract K from CMY
  cmyk.xyz -= cmyk.w; 

  // K based modifier
  float flex = pow(cmyk.w, 3.11);

  // Distance to nearest point in a grid of
  // (frequency x frequency) points over the unit square
  
  float t = 0.1 + 0.1 * n + 0.11 * flex + 0.1 * cmyk.y;

  // K component: 45 degrees screen angle
  vec2 Kst = frequency * mat2(0.707, -0.707, 0.707, 0.707) * st;
  vec2 Kuv = 2.0 * fract(Kst) - 1.0; 
  float k = aastep(0.0, sqrt(cmyk.w) + t - length(Kuv) + n);
  
  // C component: 15 degrees screen angle
  vec2 Cst = frequency*mat2(0.966, -0.259, 0.259, 0.966) * st;
  vec2 Cuv = 2.0 * fract(Cst) - 1.0;
  float c = aastep(0.0, sqrt(cmyk.x) + t - length(Cuv) + n);
  
  // M component: -15 degrees screen angle
  vec2 Mst = frequency * mat2(0.966, 0.259, -0.259, 0.966) * st;
  vec2 Muv = 2.0 * fract(Mst) - 1.0;
  float m = aastep(0.0, sqrt(cmyk.y) + t - length(Muv) + n);

  // Y component: 0 degrees screen angle
  vec2 Yst = frequency * st; // 0 deg 
  vec2 Yuv = 2.0 * fract(Yst) - 1.0;
  float y = aastep(0.0, sqrt(cmyk.z) + t - length(Yuv) + n);

  // CMY screen in RGB
  vec3 black = vec3(n + 0.01);
  vec3 rgbscreen = 1.0 - vec3(c,m,y) + n;
  
  // Blend in K for final color
  vec3 factor = mix(rgbscreen, black, 1.1 * k + 0.3 * n);

  // Blend with og color
  return mix(factor, texcolor, 0.777);
}

vec3 halftone(vec3 texcolor, vec2 st) {
  return halftone(texcolor, st, 412.321);
}
`,fHe=`
float blendLighten(float base, float blend) {
	return max(blend,base);
}

vec3 blendLighten(vec3 base, vec3 blend) {
	return vec3(blendLighten(base.r,blend.r),blendLighten(base.g,blend.g),blendLighten(base.b,blend.b));
}

vec3 blendLighten(vec3 base, vec3 blend, float opacity) {
	return (blendLighten(base, blend) * opacity + base * (1.0 - opacity));
}

float blendDarken(float base, float blend) {
	return min(blend,base);
}

vec3 blendDarken(vec3 base, vec3 blend) {
	return vec3(blendDarken(base.r,blend.r),blendDarken(base.g,blend.g),blendDarken(base.b,blend.b));
}

vec3 blendDarken(vec3 base, vec3 blend, float opacity) {
	return (blendDarken(base, blend) * opacity + base * (1.0 - opacity));
}
`,dHe=`
float aastep(float threshold, float value) {
  float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;
  return smoothstep(threshold-afwidth, threshold+afwidth, value);
}
`,lT=`
//
// Description : Array and textureless GLSL 2D simplex noise function.
//      Author : Ian McEwan, Ashima Arts.
//  Maintainer : ijm
//     Lastmod : 20110822 (ijm)
//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.
//               Distributed under the MIT License. See LICENSE file.
//               https://github.com/ashima/webgl-noise
//

vec3 mod289(vec3 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec2 mod289(vec2 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec3 permute(vec3 x) {
  return mod289(((x*34.0)+1.0)*x);
}

float snoise(vec2 v) {
  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0
                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)
                     -0.577350269189626,  // -1.0 + 2.0 * C.x
                      0.024390243902439); // 1.0 / 41.0
// First corner
  vec2 i  = floor(v + dot(v, C.yy) );
  vec2 x0 = v -   i + dot(i, C.xx);

// Other corners
  vec2 i1;
  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0
  //i1.y = 1.0 - i1.x;
  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
  // x0 = x0 - 0.0 + 0.0 * C.xx ;
  // x1 = x0 - i1 + 1.0 * C.xx ;
  // x2 = x0 - 1.0 + 2.0 * C.xx ;
  vec4 x12 = x0.xyxy + C.xxzz;
  x12.xy -= i1;

// Permutations
  i = mod289(i); // Avoid truncation effects in permutation
  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
    + i.x + vec3(0.0, i1.x, 1.0 ));

  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);
  m = m*m ;
  m = m*m ;

// Gradients: 41 points uniformly over a line, mapped onto a diamond.
// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)

  vec3 x = 2.0 * fract(p * C.www) - 1.0;
  vec3 h = abs(x) - 0.5;
  vec3 ox = floor(x + 0.5);
  vec3 a0 = x - ox;

// Normalise gradients implicitly by scaling m
// Approximation of: m *= inversesqrt( a0*a0 + h*h );
  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );

// Compute final noise value at P
  vec3 g;
  g.x  = a0.x  * x0.x  + h.x  * x0.y;
  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
  return 130.0 * dot(m, g);
}
`,pHe=`
#ifdef ASPECT_CORRECTION
	uniform float scale;
#else
	uniform mat3 uvTransform;
#endif

varying vec2 vUv2;

void mainSupport(const in vec2 uv) {
	#ifdef ASPECT_CORRECTION
		vUv2 = uv * vec2(aspect, 1.0) * scale;
	#else
		vUv2 = (uvTransform * vec3(uv, 1.0)).xy;
	#endif
}
`,mHe=`
uniform float viewheight;
uniform sampler2D splat;

${fHe}
${dHe}
${lT}
${hHe}

float rectdistance(vec2 uv) {
  vec2 tl = vec2(-1.0);
  vec2 br = vec2(1.0);
  vec2 d = max(tl - uv, uv - br);
  return abs(length(max(vec2(0.0), d)) + min(0.0, max(d.x, d.y)));
}

vec2 bendy(const in vec2 xn, float dn, float sn) {
  // config
  float distortion = 0.0173 + dn; // 0.0173, 0.511
  float scale = 0.991 + sn; // 1.0, 0.7
  // calc
  vec3 xDistorted = vec3((1.0 + vec2(distortion, distortion) * dot(xn, xn)) * xn, 1.0);
  mat3 kk = mat3(
    vec3(1.0, 0.0, 0.0),
    vec3(0.0, 1.0, 0.0),
    vec3(0.0, 0.0, 1.0)
  );
  return (kk * xDistorted).xy * scale;
}

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
	#ifdef UV_TRANSFORM
		vec4 bright = texture2D(splat, vUv2);
		vec4 dark = texture2D(splat, 1.0 - vUv2);
	#else
		vec4 bright = texture2D(splat, uv);
		vec4 dark = texture2D(splat, 1.0 - uv);
	#endif
  
  float n = 0.1 * snoise(uv.st * 200.0); // Fractal noise
  n += 0.05 * snoise(uv.st * 400.0);
  n += 0.025 * snoise(uv.st * 800.0);

  vec2 xn = 2.0 * (uv.st - 0.5);
  float fz = 0.005;
  vec2 edge = bendy(xn, fz * n, -fz * n);
  vec2 bent = edge.xy * 0.5 + 0.5;

  float edgetime = time * 0.3;
  float edgetime2 = time * 2.0;
  vec2 edgewiggle = vec2(cos(edgetime) * 0.1, sin(edgetime) * 0.096);
  vec2 edgewiggle2 = vec2(cos(edgetime2) * 0.005, sin(edgetime2) * 0.005);
  vec2 edgeshine = vec2(edge.x * 5.0 + 3.5, edge.y - 0.3) + edgewiggle + edgewiggle2;
  vec2 edgeshine2 = vec2(edge.x, edge.y * 2.0 - 0.5) + edgewiggle + edgewiggle2;
  vec2 edgeshine3 = vec2(edge.x * 3.0 - 2.1, edge.y + 0.3) + edgewiggle + edgewiggle2;
  
  float dx = rectdistance(xn);
  float bx = rectdistance(edge);
  float ex = rectdistance(edgeshine);
  float ex2 = rectdistance(edgeshine2);
  float ex3 = rectdistance(edgeshine3);

  // apply shape
  float doot = max(abs(edge.x), abs(edge.y));
  if (doot < 1.0) {
    // display
    outputColor = texture2D(inputBuffer, bent);

    // apply scratches
    outputColor.rgb = blendLighten(outputColor.rgb, bright.rgb, 0.079);
    outputColor.rgb = blendDarken(outputColor.rgb, dark.rgb, 0.0666);

    // apply halftones
    outputColor.rgb = halftone(outputColor.rgb, uv.st);
  
  } else if (doot > 1.004) {
    // display shell
    // rbgb 205 205 193
    vec3 matte = vec3(205.0 / 255.0, 205.0 / 255.0, 193.0 / 255.0);
    vec3 dkmatte = mix(matte, vec3(0.0), 0.5);
    float mx = pow(1.0 - bx, 16.0) + n;
    outputColor = vec4(mix(matte, dkmatte, mx), inputColor.a);

  } else {
    // border
    outputColor = vec4(mix(vec3(0.0), outputColor.rgb, 0.5), inputColor.a);
  }

  // apply reflection shine
  if (doot < 0.98) {
    float vvv = 0.34;
    if (edge.x > -0.9 && edge.x < -0.5 && edge.y > -0.5) {
      float sh = clamp(0.0, vvv, ex + n * 0.333);
      float ratio = pow(sh, 5.0) * 6.0 * abs(cos(bx * 3.0)) * (6.0 + sin(edgetime));
      vec3 shade = mix(outputColor.rgb, vec3(1.0), ratio * 0.333);
      outputColor = vec4(shade, inputColor.a);
    }
    if (edge.y > -0.3 && edge.y < 0.7) {
      float sh = clamp(0.0, vvv, ex2 + n * 0.15);
      float ratio = pow(sh, 5.0) * 6.0 * abs(cos(dx * 3.0)) * (4.0 + cos(edgetime * 1.5));
      vec3 shade = mix(outputColor.rgb, vec3(1.0), ratio * 0.333);
      outputColor = vec4(shade, inputColor.a);
    }
    if (edge.x > 0.4 && edge.y < 0.8) {
      float sh = clamp(0.0, vvv, ex3 + n * 0.25);
      float ratio = pow(sh, 5.0) * 6.0 * abs(cos(bx * 2.0)) * (3.0 + sin(-edgetime));
      vec3 shade = mix(outputColor.rgb, vec3(1.0), ratio * 0.333);
      outputColor = vec4(shade, inputColor.a);
    }
  }

  // apply inner shade
  if (doot >= 0.5 && doot < 1.0) {
    float sh = clamp(0.0, 1.0, 1.0 - bx - 0.7);
    vec3 shade = mix(outputColor.rgb, vec3(0.0), pow(sh, 4.0));
    outputColor = vec4(shade, inputColor.a);
  }

  // apply outer shade
  if (doot >= 0.97) {
    float sh = clamp(0.0, 1.0, bx * 24.0);
    vec3 dkout = mix(vec3(0.0), outputColor.rgb, 0.81);
    vec3 shade = mix(dkout, outputColor.rgb, sh);
    outputColor = vec4(shade, inputColor.a);
  }
}
`;class gHe extends Id{constructor({splat:e,viewheight:t}={}){super("CRTShapeEffect",mHe,{blendFunction:ui.NORMAL,attributes:Fu.CONVOLUTION,defines:new Map([["TEXEL","texel"],["TEXTURE_PRECISION_HIGH","1"]]),uniforms:new Map([["splat",new on(e)],["viewheight",new on(t??128)]])})}get splat(){return this.uniforms.get("splat")?.value}set splat(e){const{splat:t,uniforms:r,defines:i}=this,s=r.get("splat"),o=r.get("uvTransform");t!==e&&s&&o&&(s.value=e,o.value=e.matrix,i.delete("TEXTURE_PRECISION_HIGH"),e!==null&&(e.matrixAutoUpdate?(i.set("UV_TRANSFORM","1"),this.setVertexShader(pHe)):(i.delete("UV_TRANSFORM"),this.setVertexShader(null)),e.type!==Do&&i.set("TEXTURE_PRECISION_HIGH","1"),(t===null||t?.type!==e.type)&&this.setChanged()))}getTexture(){return this.splat}setTexture(e){this.splat=e}get aspectCorrection(){return this.defines.has("ASPECT_CORRECTION")}set aspectCorrection(e){this.aspectCorrection!==e&&(e?this.defines.set("ASPECT_CORRECTION","1"):this.defines.delete("ASPECT_CORRECTION"),this.setChanged())}get uvTransform(){return!!this.splat?.matrixAutoUpdate}set uvTransform(e){const t=this.splat;fe(t)&&(t.matrixAutoUpdate=e)}setTextureSwizzleRGBA(e,t=e,r=e,i=e){const s="rgba";let o="";(e!==NE.RED||t!==NE.GREEN||r!==NE.BLUE||i!==NE.ALPHA)&&(o=[".",s[e],s[t],s[r],s[i]].join("")),this.defines.set("TEXEL","texel"+o),this.setChanged()}update(){this.splat?.matrixAutoUpdate&&this.splat.updateMatrix()}}const _He=cT(gHe);function R4(n){const e=new Set;function t(s){NSe(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),ub.invoke(s))}const r=y0("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),n(s))});function i(){ub.disconnect(r)}return{forward:t,disconnect:i}}function vHe(n){switch(n.target){case"tick":case"tock":case"ready":return!0}return!1}function yHe(n){switch(n.target){case"log":case"chat":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const e=Vv(n.target);switch(e.target){case"vm":case"heavy":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"heavy":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}function bHe(n){switch(n.target){case"tick":case"tock":case"second":return!0}return!1}function C4(n){const e=Vv(n.target);switch(e.target){case"vm":case"modem":case"gadgetserver":return!0}switch(e.path){case"sync":case"desync":case"joinack":return!0}return!1}function hG(n){switch(n.target){case"tick":case"tock":case"second":return!1;case"ready":return!0;default:switch(Vv(n.target).target){case"heavy":return!0}}return!1}function SHe(n){return new Worker("/assets/heavyspace-CThsdM_e.js",{name:n?.name})}function EHe(n){return new Worker("/assets/simspace-Bo6utybL.js",{name:n?.name})}function xHe(n){return new Worker("/assets/stubspace-DtuHWWGn.js",{name:n?.name})}let xm,ap,M4;function THe(n=!1){if(fe(ap))return;PSe(Ke),xm=new SHe,ap=n?new xHe:new EHe;const{forward:e,disconnect:t}=R4(s=>{C4(s)&&fe(ap)&&ap.postMessage(s),hG(s)&&fe(xm)&&xm.postMessage(s)});function r(s){const o=s.data;return C4(o)&&fe(ap)&&ap.postMessage(o),e(o)}xm.addEventListener("message",r);function i(s){const o=s.data;return hG(o)&&fe(xm)&&xm.postMessage(o),e(o)}ap.addEventListener("message",i),M4=()=>{t(),fe(xm)&&(xm.removeEventListener("message",r),xm.terminate()),xm=void 0,fe(ap)&&(ap.removeEventListener("message",i),ap.terminate()),ap=void 0}}function wHe(){M4?.(),M4=void 0}function AHe(n,e,t,r){const i=e*t*4;for(let s=0,o=0;s<i;++o)n.image.data[s]=r[o]*255,s+=4;return n.needsUpdate=!0,n}function RHe(n,e){const t=new Uint8Array(4*n*e);return new Hk(t,n,e)}const CHe=new io({transparent:!1,side:Ba,uniforms:{color:{value:new gi(0,0,0)},data:{value:null}},vertexShader:`
      precision highp float;
      varying vec2 vUv;
    
      void main() {
        vec4 mvPosition = vec4(position, 1.0);
        #ifdef USE_INSTANCING
        	mvPosition = instanceMatrix * mvPosition;
        #endif        
        mvPosition = modelViewMatrix * mvPosition;
        gl_Position = projectionMatrix * mvPosition;
        
        vUv = uv;
      }
    `,fragmentShader:`
      precision highp float;
      uniform vec3 color;
      uniform sampler2D data;
  
      varying vec2 vUv;

      // adapted from https://www.shadertoy.com/view/Mlt3z8
      float bayerDither2x2( vec2 v ) {
        return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
      }

      float bayerDither4x4( vec2 v ) {
        vec2 P1 = mod( v, 2.0 );
        vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
        return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
      }

      void main() {
        float alpha = texture2D(data, vUv).r;
        if (alpha < 1.0) {
          vec2 ditherCoord = floor( mod( gl_FragCoord.xy, 4.0 ) );
          if ( bayerDither4x4( ditherCoord ) / 16.0 >= alpha ) {
            discard;
          }
        }

        gl_FragColor.rgba = vec4(color.xyz, 1.0);
      }
    `});function MHe(){return cy(CHe)}const kHe=new io({transparent:!1,side:Ba,uniforms:{time:Ua,smoothrate:new on(tR),color:{value:new gi(0,0,0)},alpha:{value:1}},vertexShader:`
    precision highp float;
    attribute float visible;
    attribute vec3 nowposition;
    attribute mat4 lastmatrix;
    
    uniform float smoothrate;
    uniform float time;
  
    varying float vVisible;
  
    void main() {       
      vec4 mvPosition = vec4(position, 1.0);
      
      vec4 mvNowPosition = instanceMatrix * mvPosition;
      vec4 mvLastPosition = lastmatrix * mvPosition;

      float deltaPosition = clamp((time - nowposition.z) * smoothrate, 0.0, 1.0);
      mvPosition = mix(mvLastPosition, mvNowPosition, deltaPosition);

      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;
      
      vVisible = visible;
    }
    `,fragmentShader:`
    precision highp float;
    uniform vec3 color;
    uniform float alpha;

    varying float vVisible;

    // adapted from https://www.shadertoy.com/view/Mlt3z8
    float bayerDither2x2( vec2 v ) {
      return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
    }

    float bayerDither4x4( vec2 v ) {
      vec2 P1 = mod( v, 2.0 );
      vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
      return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
    }

    void main() {
      if (vVisible == 0.0) {
        discard;
      }
      if (alpha < 1.0) {
        vec2 ditherCoord = floor( mod( gl_FragCoord.xy, 4.0 ) );
        if ( bayerDither4x4( ditherCoord ) / 16.0 >= alpha ) {
          discard;
        }
      }

      gl_FragColor.rgba = vec4(color.xyz, 1.0);
    }
    `});function OHe(){return cy(kHe)}const ku=[0,1,0],Hm=[1,1,0],Sf=[1,0,0],Vm=[0,0,0],IHe=new Float32Array([...ku,...Sf,...Hm,...ku,...Vm,...Sf]),ore=new Float32Array([...ku.slice(0,2),...Sf.slice(0,2),...Hm.slice(0,2),...ku.slice(0,2),...Vm.slice(0,2),...Sf.slice(0,2)]);function NHe(n,e,t,r,i,s){const o=e*t*4;for(let a=0,c=0;a<o;++c){const l=r[c]??0;n.image.data[a++]=l%Fa,n.image.data[a++]=Math.floor(l/Fa),n.image.data[a++]=i[c]??16,n.image.data[a++]=s[c]??16}return n.needsUpdate=!0,n}function PHe(n,e){const t=new Uint8Array(4*n*e),r=new Hk(t,n,e,zk,Do);return r.internalFormat="RGBA8UI",r}function j8(n,e){const t=n*An.DRAW_CHAR_WIDTH(),r=e*An.DRAW_CHAR_HEIGHT();return{position:IHe.map((s,o)=>{switch(o%3){case 0:return s*t;case 1:return s*r;default:return s}}),uv:ore}}const fG=[0,1,1],LP=[1,1,1],nC=[1,0,1],UP=[0,0,1],DHe=new Float32Array([...ku,...LP,...Hm,...ku,...fG,...LP,...Vm,...nC,...Sf,...Vm,...UP,...nC,...Hm,...nC,...Sf,...Hm,...LP,...nC,...ku,...UP,...Vm,...ku,...fG,...UP]),LHe=new Float32Array([...ku.slice(0,2),...Sf.slice(0,2),...Hm.slice(0,2),...ku.slice(0,2),...Vm.slice(0,2),...Sf.slice(0,2),...ku.slice(0,2),...Sf.slice(0,2),...Hm.slice(0,2),...ku.slice(0,2),...Vm.slice(0,2),...Sf.slice(0,2),...Hm.slice(0,2),...Vm.slice(0,2),...ku.slice(0,2),...Hm.slice(0,2),...Sf.slice(0,2),...Vm.slice(0,2),...ku.slice(0,2),...Sf.slice(0,2),...Hm.slice(0,2),...ku.slice(0,2),...Vm.slice(0,2),...Sf.slice(0,2)]);function UHe(n,e){const t=n*An.DRAW_CHAR_WIDTH(),r=e*An.DRAW_CHAR_HEIGHT();return{position:DHe.map((s,o)=>{switch(o%3){case 0:return s*t;case 1:return s*r;default:return s*r}}),uv:LHe}}const dG=[-.5,0,0],BHe=[.5,0,0],pG=[.5,0,1],FHe=[-.5,0,1],jHe=new Float32Array([...dG,...pG,...BHe,...dG,...FHe,...pG]);function zHe(){const n=An.DRAW_CHAR_WIDTH(),e=An.DRAW_CHAR_HEIGHT();return{position:jHe.map((r,i)=>{switch(i%3){case 0:return r*n;case 1:return r*e;default:return r*e}}),uv:ore}}const HHe=vx(Cb(Ob)),mG=Dm(Mb(kb)),VHe=new io({transparent:!1,side:Ba,uniforms:{time:Ua,interval:aT,palette:new on(HHe),map:new on(mG),alt:new on(mG),data:new on(null),size:new on(new Nn),step:new on(new Nn),flip:new on(!0)},vertexShader:`
    precision highp float;
    varying vec2 vUv;
    void main() {
      vec4 mvPosition = vec4(position, 1.0);
      #ifdef USE_INSTANCING
      	mvPosition = instanceMatrix * mvPosition;
      #endif        
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;
      vUv = uv;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform usampler2D data;
    uniform vec3 palette[16];
    uniform vec2 size;
    uniform vec2 step;
    uniform bool flip;
    varying vec2 vUv;

    ${lT}

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vUv * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }

    void main() {
      uvec4 tiledata = texture(data, vUv);
      int colori = int(tiledata.z);
      int bgi = int(tiledata.w);

      vec2 charPosition = mod(vUv, size) / size;
      vec2 uv = vec2(charPosition.x * step.x, charPosition.y * step.y);
      
      vec3 color;
      if (colori > 31) {
        vec3 bg = palette[bgi];
        color = palette[colori - 33];
        float cycle = mod(time * 2.5, interval * 2.0) / interval;
        color = mix(bg, color, cyclefromtime());
      } else {
        color = palette[colori % 16];
      }

      uv.x += step.x * float(tiledata.x);
      uv.y += step.y * float(tiledata.y);
      if (flip) {
        uv.y = 1.0 - uv.y;
      }

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture(alt, uv).rgb : texture(map, uv).rgb;

      if (blip.r == 0.0) {
        if (bgi >= ${Bt.ONCLEAR}) {
          discard;
        }
        color = palette[bgi];
      }

      gl_FragColor.rgb = color;
      gl_FragColor.a = 1.0;
    }
  `});function GHe(){return cy(VHe)}function p3({width:n,height:e,alphas:t}){const[r]=Qe.useState(()=>MHe());Qe.useEffect(()=>{r.uniforms.data.value=RHe(n,e)},[r.uniforms.data,n,e]),Qe.useEffect(()=>{AHe(r.uniforms.data.value,n,e,t)},[r,r.uniforms.data.value,n,e,t]);const{position:i,uv:s}=Qe.useMemo(()=>j8(n,e),[n,e]);return xe.jsxs("mesh",{children:[xe.jsx("primitive",{object:r,attach:"material"}),xe.jsxs("bufferGeometry",{children:[xe.jsx("bufferAttribute",{attach:"attributes-position",args:[i,3]}),xe.jsx("bufferAttribute",{attach:"attributes-uv",args:[s,2]})]})]})}function $He({width:n,height:e,alpha:t}){const r=Qe.useMemo(()=>new Array(n*e).fill(t),[n,e,t]);return xe.jsx(p3,{width:n,height:e,alphas:r})}const JT=new yce,y1=new Nn;function m3({width:n,height:e,top:t,left:r,right:i,bottom:s,scale:o=.125,alpha:a=.25}){const c=Qe.useMemo(()=>{const l=new Array(n*e);JT.min.x=r,JT.min.y=t,JT.max.x=i,JT.max.y=s,y1.x=0,y1.y=0;for(let u=0;u<l.length;++u)l[u]=tW.smootherstep(1-JT.distanceToPoint(y1)*o,0,1)*a,++y1.x,y1.x>=n&&(y1.x=0,++y1.y);return l},[n,e,t,r,i,s,o,a]);return xe.jsx(p3,{width:n,height:e,alphas:c})}function gG(){}const WHe=Tf.forwardRef(function({args:e,children:t,...r},i){const s=Tf.useRef(null);return Tf.useImperativeHandle(i,()=>s.current),xe.jsxs("mesh",{ref:s,...r,children:[xe.jsx("planeGeometry",{attach:"geometry",args:e}),t]})}),e0=Tf.forwardRef(function({blocking:e=!1,cursor:t="default",x:r=0,y:i=0,z:s=0,width:o=1,height:a=1,opacity:c=1,visible:l=!0,color:u="white",...h},f){const d=o*.5,p=a*.5,_=[(r+d)*An.DRAW_CHAR_WIDTH(),(i+p)*An.DRAW_CHAR_HEIGHT(),s];return xe.jsx(WHe,{ref:f,args:[o*An.DRAW_CHAR_WIDTH(),a*An.DRAW_CHAR_HEIGHT()],userData:{blocking:e,cursor:t},onClick:e?gG:void 0,onPointerMove:e?gG:void 0,position:_,...h,children:xe.jsx("meshBasicMaterial",{color:u,opacity:c,visible:l,transparent:c!==1})})}),qHe=vx(Cb(Ob)),_G=Dm(Mb(kb));function yp({width:n,height:e,char:t,color:r,bg:i,fliptexture:s=!0,alwaysdefaults:o=!1}){const a=za(b=>b.palettedata),c=za(b=>b.charsetdata),l=za(b=>b.altcharsetdata),u=o?qHe:a,h=o?_G:c,f=o?_G:l,[d]=Qe.useState(()=>GHe()),{width:p=0,height:_=0}=h?.image??{};Qe.useEffect(()=>{n===0||e===0||(d.uniforms.data.value=PHe(n,e))},[d.uniforms.data,n,e]),Qe.useEffect(()=>{n===0||e===0||NHe(d.uniforms.data.value,n,e,t,r,i)},[d.uniforms.data.value,n,e,t,r,i]),Qe.useEffect(()=>{n===0||e===0||!h||(d.uniforms.map.value=h,d.uniforms.alt.value=f??h,d.uniforms.palette.value=u,d.uniforms.size.value.x=1/n,d.uniforms.size.value.y=1/e,d.uniforms.step.value.x=1/Math.round(p/ja),d.uniforms.step.value.y=1/Math.round(_/Oc),d.uniforms.flip.value=s,d.needsUpdate=!0)},[u,h,f,d,n,e,p,_,s]);const{position:g,uv:m}=Qe.useMemo(()=>j8(n,e),[n,e]);return xe.jsxs("mesh",{children:[xe.jsxs("bufferGeometry",{children:[xe.jsx("bufferAttribute",{attach:"attributes-position",args:[g,3]}),xe.jsx("bufferAttribute",{attach:"attributes-uv",args:[m,2]})]}),xe.jsx("primitive",{object:d,attach:"material"})]})}function $b({store:n,children:e}){return xe.jsx(mU.Provider,{value:n,children:e})}function Wb({width:n,height:e}){const t=Qe.useContext(mU),[r,i,s]=pU(t,Uc(o=>[o.char,o.color,o.bg,o.render]));return n>0&&e>0&&xe.jsx(yp,{char:r.slice(),color:i.slice(),bg:s.slice(),width:n,height:e})}function z8({x:n,y:e,width:t,height:r,debug:i,...s}){const o=An.DRAW_CHAR_WIDTH(),a=An.DRAW_CHAR_HEIGHT();return xe.jsx(Cje,{...s,args:[t*o,r*a],position:[(n??0)*o+t*o*.5,(e??0)*a+r*a*.5,0],children:xe.jsx("meshBasicMaterial",{transparent:!0,opacity:i?.7:0,color:"red"})})}function Eh({x:n,y:e,letters:t,onToggle:r}){const i=pu(),[s,o]=Qe.useState(!1),a=Qe.useCallback(()=>o(!1),[o]);if(i.x=n,i.y=e,qr(s?"$176$176$176$176$176":"$178$178$178$178$178",i,!1),i.x=n,i.y=e+1,qr(s?"$176$177$177$177$176":"$178$177$177$177$178",i,!1),i.x=n,i.y=e+2,qr(s?"$176$176$176$176$176":"$178$178$178$178$178",i,!1),t){const l=b0(t,1e4,1)?.measuredwidth??t.length;i.x=n+Math.round(2.5-l*.5),i.y=e,qr(t,i,!1)}return xe.jsx(z8,{x:n,y:e,width:5,height:3,onPointerDown:()=>{r(),o(!0)},onPointerUp:a,onPointerLeave:a,onPointerCancel:a})}function YHe({width:n,height:e}){const{keyboardalt:t,keyboardctrl:r,keyboardshift:i}=Sd(),s=n-18,o=n-12,a=n-6,c=1,l=Math.floor(e*.5)-2,u=e-4,h=Math.round(n*.5)-3,f=Qr();return xe.jsxs(xe.Fragment,{children:[xe.jsx(Eh,{x:0,y:c,letters:r?bA.toUpperCase():bA.toLowerCase(),onToggle:()=>{r?tr(0,wt.CTRL):fr(0,wt.CTRL),Sd.setState({keyboardctrl:!r})}}),xe.jsx(Eh,{x:6,y:c+1,letters:t?"ALT":"alt",onToggle:()=>{t?tr(0,wt.ALT):fr(0,wt.ALT),Sd.setState({keyboardalt:!t})}}),xe.jsx(Eh,{x:12,y:c,letters:i?"SHIFT":"shift",onToggle:()=>{i?tr(0,wt.SHIFT):fr(0,wt.SHIFT),Sd.setState({keyboardshift:!i})}}),xe.jsx(Eh,{x:s,y:c,letters:"tab",onToggle:()=>{fr(0,wt.MENU_BUTTON),tr(0,wt.MENU_BUTTON)}}),xe.jsx(Eh,{x:o,y:c+1,letters:"enter",onToggle:()=>{fr(0,wt.OK_BUTTON),tr(0,wt.OK_BUTTON)}}),xe.jsx(Eh,{x:a,y:c,letters:"esc",onToggle:()=>{fr(0,wt.CANCEL_BUTTON),tr(0,wt.CANCEL_BUTTON)}}),xe.jsx(Eh,{x:1,y:u-1,letters:"?",onToggle:()=>{lb(Ke,f)}}),xe.jsx(Eh,{x:7,y:u,letters:"#",onToggle:()=>{lb(Ke,f,"#")}}),xe.jsx(Eh,{x:13,y:u-1,letters:"c",onToggle:()=>{e6(Ke,f,"")}}),xe.jsx(Eh,{x:a,y:u-1,letters:"$meta+p",onToggle:()=>{r6(Ke,f)}}),xe.jsx(Eh,{x:h,y:c,letters:"$24",onToggle:()=>{fr(0,wt.MOVE_UP),tr(0,wt.MOVE_UP)}}),xe.jsx(Eh,{x:h,y:u,letters:"$25",onToggle:()=>{fr(0,wt.MOVE_DOWN),tr(0,wt.MOVE_DOWN)}}),xe.jsx(Eh,{x:n-5,y:l,letters:"$26",onToggle:()=>{fr(0,wt.MOVE_RIGHT),tr(0,wt.MOVE_RIGHT)}}),xe.jsx(Eh,{x:0,y:l,letters:"$27",onToggle:()=>{fr(0,wt.MOVE_LEFT),tr(0,wt.MOVE_LEFT)}})]})}function are(){tr(0,wt.MOVE_UP),tr(0,wt.MOVE_DOWN),tr(0,wt.MOVE_LEFT),tr(0,wt.MOVE_RIGHT)}function KHe(n){const{keyboardshift:e,keyboardctrl:t,keyboardalt:r}=Sd.getState();switch(r?fr(0,wt.ALT):tr(0,wt.ALT),t?fr(0,wt.CTRL):tr(0,wt.CTRL),e?fr(0,wt.SHIFT):tr(0,wt.SHIFT),are(),n){case 0:fr(0,wt.MOVE_LEFT);break;case 45:fr(0,wt.MOVE_UP),fr(0,wt.MOVE_LEFT);break;case 90:fr(0,wt.MOVE_UP);break;case 135:fr(0,wt.MOVE_UP),fr(0,wt.MOVE_RIGHT);break;case 180:fr(0,wt.MOVE_RIGHT);break;case 225:fr(0,wt.MOVE_DOWN),fr(0,wt.MOVE_RIGHT);break;case 270:fr(0,wt.MOVE_DOWN);break;case 315:fr(0,wt.MOVE_DOWN),fr(0,wt.MOVE_LEFT);break;case 360:fr(0,wt.MOVE_LEFT);break}}const XHe=wx/1e3,QT=new Nn,xk=new Lt;function BP(n,e){const t=An.DRAW_CHAR_WIDTH(),r=An.DRAW_CHAR_HEIGHT(),i=xk.x+t*.5,s=xk.y+r*.5;return{cx:Math.floor(n*.5)+Math.floor(i/t),cy:Math.floor(e*.5)+Math.floor(s/r)}}const ZHe=4;function JHe({width:n,height:e,onUp:t,onDrawStick:r}){const[i]=Qe.useState({startx:-1,starty:-1,tipx:-1,tipy:-1,pointerid:-1,inputacc:wx});function s(){i.startx=-1,i.starty=-1,i.tipx=-1,i.tipy=-1,i.pointerid=-1,t(),are()}return l_((o,a)=>{if(i.inputacc+=a,i.inputacc>=XHe&&i.pointerid!==-1){i.inputacc=0;const{cx:c,cy:l}=BP(n,e);if(QT.set(i.startx-c,i.starty-l),QT.length()>ZHe){const u=K5(lY(QT.angle()),45);KHe(u)}}}),xe.jsx(z8,{width:n,height:e,onPointerDown:o=>{if(i.pointerid===-1){o.intersections[0].object.worldToLocal(xk.copy(o.intersections[0].point));const{cx:a,cy:c}=BP(n,e);i.startx=a,i.starty=c,i.tipx=-1,i.tipy=-1,i.pointerid=o.pointerId,i.inputacc=wx}},onPointerMove:o=>{if(o.pointerId===i.pointerid&&o.intersections[0]){o.intersections[0].object.worldToLocal(xk.copy(o.intersections[0].point));const{cx:a,cy:c}=BP(n,e);QT.set(i.startx-a,i.starty-c),QT.length()>2&&(i.tipx=a,i.tipy=c,r(i.startx,i.starty,i.tipx,i.tipy))}},onPointerUp:s,onPointerLeave:s,onPointerCancel:s})}const b1=new Nn,QHe=177,eVe=Bt.WHITE,tVe=Bt.DKPURPLE,vG="tap to toggle ";function nVe({width:n,height:e,onReset:t}){const r=pu();UO(r,QHe,eVe,tVe);const i=Math.floor(n*.333),s=Math.round(n*.666);for(let o=1;o<e;++o)for(let a=i;a<=s;++a)Yo(r,n,e,a,o,{char:176});for(let o=0;o<n;++o){const a=o-(n-vG.length);Yo(r,n,e,o,0,{char:a<0?32:vG.charCodeAt(a),color:Bt.WHITE,bg:Bt.ONCLEAR})}return xe.jsxs(xe.Fragment,{children:[xe.jsx("group",{position:[0,-4*An.DRAW_CHAR_HEIGHT(),-1],children:xe.jsx(m3,{width:n,height:5,left:0,top:6,right:n-1,bottom:6,alpha:.45})}),xe.jsx(z8,{x:0,y:-3,width:n,height:4,onPointerDown:()=>{Sd.setState(o=>({...o,sidebaropen:!o.sidebaropen}))}}),xe.jsx(YHe,{width:n,height:e}),xe.jsx(JHe,{width:n,height:e,onUp:t,onDrawStick:(o,a,c,l)=>{for(let d=0;d<11;++d)r.x=o-5,r.y=a-5+d,qr("$dkblue$177$177$177$177$177$177$177$177$177$177$177",r,!1);const u=4;b1.x=c-o,b1.y=l-a;const h=K5(lY(b1.angle()),45),f=cY(h);b1.x=Math.cos(f)*u,b1.y=Math.sin(f)*u;for(let d=0;d<3;++d)r.x=o+Math.round(b1.x)-1,r.y=a+Math.round(b1.y)-1+d,qr("$dkblue$219$219$219",r,!1)}})]})}function rVe({width:n,height:e}){const[t,r]=Qe.useState(0),i=S_(),s=Fb(n,e,32,Bt.WHITE,Bt.DKPURPLE),o={...g_(n,e,Bt.WHITE,Bt.DKPURPLE),...s.getState()};return i.cols<10||i.rows<10?null:xe.jsxs($b,{store:s,children:[xe.jsx(uR.Provider,{value:o,children:xe.jsx(nVe,{width:n,height:e,onReset:()=>{r(Math.random())}},t)}),xe.jsx(Wb,{width:n,height:e})]})}const cre=Qe.createContext({cols:1,rows:1,marginx:1,marginy:1});function S_(){return Qe.useContext(cre)}function iVe({children:n}){const{viewport:e}=cl(),{width:t,height:r}=e.getCurrentViewport(),{saferows:i,islandscape:s,showtouchcontrols:o}=Sd(),a=t/An.DRAW_CHAR_WIDTH();let c=Math.floor(a);const l=r/An.DRAW_CHAR_HEIGHT();let u=Math.floor(l);const h=(t-c*An.DRAW_CHAR_WIDTH())*.5,f=(r-u*An.DRAW_CHAR_HEIGHT())*.5;let d=0,p=0;const _=Math.round(a);let g=Math.round(l);if(o)if(s)d=5*An.DRAW_CHAR_WIDTH(),c-=10;else{i<u?u=i:u=u-20;const m=u-1;g-=u,p=m*An.DRAW_CHAR_HEIGHT()}return Qe.useEffect(()=>{Sd.setState(m=>({...m,insetcols:_,insetrows:g}))},[_,g]),xe.jsx(cre.Provider,{value:{cols:c,rows:u,marginx:h,marginy:f},children:c>=10&&u>=10&&xe.jsx("group",{"scale-x":-1,"rotation-z":Math.PI,children:xe.jsxs("group",{position:[t*-.5+h,r*-.5+f,0],children:[xe.jsx("group",{position:[d,0,0],children:n}),o&&xe.jsx("group",{position:[0,p,3],children:xe.jsx(rVe,{width:_,height:g},_*g)})]})})})}const E_=Qe.createContext({sendmessage(){},sendclose(){},didclose(){}}),yG={input:{color:"$white",active:"$yellow"}};function _u(n){return n?yG.input.active:yG.input.color}function H8(n,e){return`vm:${n}:${e}`}function xw(n,e,t=0,r=""){return`${n.substring(0,e)}${r}${n.substring(e+t)}`}function Wu(n,e,t){fe(e)&&(t.x=n?1:0,t.y=e,t.disablewrap=!0)}const bv=32,lre=8,k4=new Lt;function sVe(){const n=An.DRAW_CHAR_WIDTH(),e=An.DRAW_CHAR_HEIGHT(),t=Math.floor(k4.x/n),r=Math.floor(k4.y/e);return{x:Math.round(bv*.5+t),y:Math.round(lre*.5+r)}}function oVe({sidebar:n,chip:e,row:t,label:r,args:i,context:s}){Wu(n,t,s);const[o]=[_p(i[0],"")],a=Qv(e,o),l=aR(a)??0,u=Pf(),[h,f]=Qe.useState(!1);Qe.useLayoutEffect(()=>{f(!0)},[]);const d=`${l}`.padStart(3,"0"),p=r.trim(),_=s.x-1,g=s.y+2,m=[`$green${p} ${d}
$white`];for(let B=0;B<256;++B)if(B%bv===0&&m.push(`
`),B===l){const U=u?"$green$onwhite":"$white$ongreen";m.push(`${U}$${B}$white$ondkblue`)}else m.push(`$${B}`);m.push(`

`),m.push(`$greenpress C to copy ${d}`),m.push(`

`),m.push(`$greenpress B to copy bits of ${d}`);const b=m.join("");qr(b,s,!0);const y=Qe.useContext(E_),x=Qe.useCallback(()=>{l>=bv&&Pu(a,l-bv)},[a,l]),T=Qe.useCallback(()=>{l>0&&Pu(a,l-1)},[a,l]),k=Qe.useCallback(()=>{l<255&&Pu(a,l+1)},[a,l]),R=Qe.useCallback(()=>{l<=255-bv&&Pu(a,l+bv)},[a,l]),P=Qe.useCallback(()=>{y.sendclose()},[y]);return xe.jsx("group",{position:[_*An.DRAW_CHAR_WIDTH(),g*An.DRAW_CHAR_HEIGHT(),1],children:h&&xe.jsxs(iy,{blockhotkeys:!0,children:[xe.jsx(e0,{x:1,blocking:!0,visible:!1,cursor:"pointer",width:bv,height:lre,onClick:B=>{B.intersections[0].object.worldToLocal(k4.copy(B.intersections[0].point));const U=bd(sVe(),bv);U>=0&&U<=255&&(Pu(a,U),y.sendclose())}}),xe.jsx(bo,{MOVE_LEFT:T,MOVE_UP:x,MOVE_RIGHT:k,MOVE_DOWN:R,OK_BUTTON:P,CANCEL_BUTTON:P,keydown:B=>{switch(B.key.toLowerCase()){case"c":ux(Ke,Qr(),`${l}`),y.sendclose();break;case"b":{const{charset:z}=za.getState();let I="";const L=Rpe(z,l);for(let M=0;M<L.length;++M)M%8===0&&(I+=`@char${l} `),I+=L[M]?"X":"-",M%8===7&&(I+=`
`);ux(Ke,Qr(),I),y.sendclose();break}}}})]})})}const EE=8,ure=2,O4=new Lt;function aVe(){const n=An.DRAW_CHAR_WIDTH(),e=An.DRAW_CHAR_HEIGHT(),t=Math.floor(O4.x/n),r=Math.floor(O4.y/e);return{x:Math.round(EE*.5+t),y:Math.round(ure*.5+r)}}function cVe(n){switch(n){case"dkyellow":return", brown";case"ltgray":return", ltgrey, gray, grey";case"dkgray":return", dkgrey, ltblack";case"ondkyellow":return", onbrown";case"onltgray":return", onltgrey, ongray, ongrey";case"ondkgray":return", ondkgrey, onltblack";case"bldkyellow":return", blbrown";case"blltgray":return", blltgrey, blgray, blgrey";case"bldkgray":return", bldkgrey, blltblack"}return""}const lVe=[...cx(0,15),...cx(33,48)],uVe=[...cx(0,15),32];function bG({sidebar:n,chip:e,row:t,label:r,args:i,context:s,isbg:o=!1}){Wu(n,t,s);const[a]=[_p(i[0],"")],c=Qv(e,a),u=aR(c)??0,h=Pf(),[f,d]=Qe.useState(!1);Qe.useLayoutEffect(()=>{d(!0)},[]);const p=o?uVe:lVe,_=p.indexOf(u),g=`${u}`.padStart(2,"0"),m=r.trim(),b=(Bt[u]||Bt[Bt.BLACK]).toLowerCase(),y=cVe(b).padEnd(32," "),x=s.x-1,T=s.y+2,k=[`$green${m} ${g} ${b}${y}
$white`];for(let M=0;M<p.length;++M){M%EE===0&&k.push(`
`);const F=p[M],Z=(Bt[F]||Bt[Bt.BLACK]).toLowerCase();if(F===u)if(h){const $=M%16<8?"white":"black";k.push(F>32?"$onwhite$219":`$${$}$219`)}else k.push(`$onblack$${Z}$219`);else k.push(`$onblack$${Z}$219`)}k.push("$white"),k.push(`

`),k.push(`$greenpress C to copy ${g}`),k.push(`

`),k.push(`$greenpress B to copy bits of ${g}`),qr(k.join(""),s,!0);const R=Qe.useContext(E_),P=Qe.useCallback(M=>{const F=p[Ri(M,0,p.length-1)];Pu(c,F)},[p,c]),B=Qe.useCallback(()=>{P(_-EE)},[P,_]),U=Qe.useCallback(()=>{P(_-1)},[P,_]),z=Qe.useCallback(()=>{P(_+1)},[P,_]),I=Qe.useCallback(()=>{P(_+EE)},[P,_]),L=Qe.useCallback(()=>{R.sendclose()},[R]);return xe.jsx("group",{position:[x*An.DRAW_CHAR_WIDTH(),T*An.DRAW_CHAR_HEIGHT(),1],children:f&&xe.jsxs(iy,{blockhotkeys:!0,children:[xe.jsx(e0,{x:1,blocking:!0,visible:!1,cursor:"pointer",width:EE,height:ure,onClick:M=>{M.intersections[0].object.worldToLocal(O4.copy(M.intersections[0].point));const F=aVe(),Z=bd(F,EE);Z>=0&&Z<=16&&(Pu(c,Z),R.sendclose())}}),xe.jsx(bo,{MOVE_LEFT:U,MOVE_UP:B,MOVE_RIGHT:z,MOVE_DOWN:I,OK_BUTTON:L,CANCEL_BUTTON:L,keydown:M=>{switch(M.key.toLowerCase()){case"c":ux(Ke,Qr(),`${u}`),R.sendclose();break;case"b":{if(u!==Bt.ONCLEAR){const Z=u<Bt.ONCLEAR?u:u-Bt.BLBLACK,$=za.getState().palettedata?.[Z],Y=Math.round(($?.r??0)*255),Q=Math.round(($?.g??0)*255),q=Math.round(($?.b??0)*255),V=`@color${Z} ${Y} ${Q} ${q}`;ux(Ke,Qr(),V),R.sendclose()}break}}}})]})})}function hVe({sidebar:n,item:e,row:t,context:r}){Wu(n,t,r);const i=Ip(r),s=hU(e);if(fe(s)){const o=i.width-3,c=b0(s,o,3)?.measuredwidth??1,l=Ri(Math.floor(o*.5-c*.5),0,o);qr(`${" ".repeat(l)}$WHITE${s}${fe(t)?`
`:""}`,r,!0)}else qr(`${e}${fe(t)?`
`:""}`,r,!0);return null}function fVe({sidebar:n,row:e,active:t,label:r,args:i,context:s}){const o=Qe.useContext(E_),a=Qe.useCallback(()=>{const[,...l]=i;ux(Ke,Qr(),l.join(" ")),o.sendclose()},[i,o]),c=_u(!!t);return Wu(n,e,s),qr(`  $purple$16 $yellowCOPYIT ${c}${r}`,s,!0),t&&xe.jsx(bo,{OK_BUTTON:a})}function dVe({sidebar:n,chip:e,row:t,active:r,label:i,args:s,context:o}){Wu(n,t,o);const[a,c,l,u,...h]=s.map(y=>_p(y,"")),f=l||` ${c.toUpperCase()} `,d=_u(r),p=o.x-.25,_=o.y-.25,g=`${o.iseven?"$black$onltgray":"$black$ondkcyan"}${f}${d}$onclear ${i}${fe(t)?`
`:""}`;qr(g,o,!0);const m=Qe.useContext(E_),b=Qe.useCallback(()=>{m.sendmessage(H8(e,a),h),u||m.sendclose()},[e,m,a,u,h]);return xe.jsxs("group",{position:[p*An.DRAW_CHAR_WIDTH(),_*An.DRAW_CHAR_HEIGHT(),1],children:[xe.jsx(e0,{visible:!1,width:f.length+.5,height:1.5,blocking:!0,onClick:b}),r&&xe.jsx(bo,{OK_BUTTON:b}),c&&xe.jsx(tb,{hotkey:c,children:b})]})}function pVe({sidebar:n,chip:e,row:t,active:r,label:i,args:s,context:o}){Wu(n,t,o);const a=s.map(d=>_p(d,"")),[c,...l]=a,u=_u(r);qr(`  $purple$16 ${u}${i}
`,o,!0);const h=Qe.useContext(E_),f=Qe.useCallback(()=>{h.sendmessage(H8(e,c),l),h.sendclose()},[h,e,c,l]);return r&&xe.jsx(bo,{OK_BUTTON:f})}const rC=-111111;function mVe({sidebar:n,chip:e,row:t,active:r,label:i,args:s,context:o}){Wu(n,t,o);const[a,c,l]=[_p(s[0],""),j1(s[1],rC),j1(s[2],rC)];let u,h;c===rC?(u=0,h=31):l===rC?(u=0,h=c):(u=c,h=l);const f=Qv(e,a),d=aR(f),p=d??0,_=Pf(),[g,m]=Qe.useState(""),[b,y]=Qe.useState(0),[x,T]=Qe.useState(!1);let k=`${p}`;const R=i.trim(),P=_u(r);x&&(k=_?xw(g,b,1,"$219+"):g),o.writefullwidth=32,qr(` # ${P}${R} $green${k}`,o,!1),o.writefullwidth=void 0;const B=Qe.useCallback(I=>{const L=I.alt?10:1;Pu(f,Math.min(h,p+L))},[h,p,f]),U=Qe.useCallback(I=>{const L=I.alt?10:1;Pu(f,Math.max(u,p-L))},[u,p,f]),z=Qe.useCallback(()=>{T(I=>{const L=!I;if(L){const M=`${d}`;m(M),y(M.length)}else{const M=parseFloat(g),F=isNaN(M)?0:M;Pu(a,Math.min(h,Math.max(u,F)))}return L})},[h,u,g,a,d]);return d!==void 0&&xe.jsxs(xe.Fragment,{children:[r&&!x&&xe.jsx(bo,{MOVE_LEFT:U,MOVE_RIGHT:B,OK_BUTTON:z}),x&&xe.jsxs(iy,{blockhotkeys:!0,children:[xe.jsx(tb,{hotkey:"ctrl+c",children:()=>{console.info("copy")}}),xe.jsx(tb,{hotkey:"ctrl+v",children:()=>{console.info("paste")}}),xe.jsx(tb,{hotkey:"ctrl+a",children:()=>{console.info("select all")}}),xe.jsx(bo,{MOVE_LEFT:()=>{y(I=>Math.max(0,I-1))},MOVE_RIGHT:()=>{y(I=>Math.min(g.length,I+1))},CANCEL_BUTTON:z,OK_BUTTON:z,keydown:I=>{switch(Jn(I.key)){case"delete":g.length>0&&m(L=>xw(L,b,1));break;case"backspace":b>0&&(m(L=>xw(L,b-1,1)),y(L=>Math.max(0,L-1)));break}I.key.length===1&&g.length<o.width*.5&&(m(L=>xw(L,b,0,I.key)),y(L=>L+1))}})]})]})}function gVe({sidebar:n,row:e,active:t,label:r,args:i,context:s}){const o=Qe.useCallback(()=>{const[,c,...l]=i,u=l.join(" "),h=Qr();setTimeout(()=>{switch(c){case"wiki":to(Ke,h,async()=>{const f=await gU(u);AU(h,f)});break;case"inline":window.location.href=u;break;default:window.open(`${c} ${u}`.trim(),"_blank");break}},100)},[i]),a=_u(!!t);return Wu(n,e,s),qr(`  $purple$16 $yellowOPENIT ${a}${r}`,s,!0),t&&xe.jsx(bo,{OK_BUTTON:o})}function _Ve({sidebar:n,chip:e,row:t,active:r,label:i,args:s,context:o}){Wu(n,t,o);const[a,c,l]=[_p(s[0],""),_p(s[1],""),_p(s[2],"")];let u,h;c===""?(u="L ",h=" H"):l===""?(u="L ",h=` ${c}`):(u=`${c} `,h=` ${l}`);const f=0,d=8,p=Qv(e,a),g=aR(p)??0,m=Pf(),b=i.trim(),y=_u(r);qr(`$red $29 ${y}${b} `,o,!1);const T=xw("----:----",g,1,`$green${r?m?"$26":"$27":"$4"}${y}`).replaceAll("-","$7").replaceAll(":","$9");qr(`${y}${u}${T}${h} $green${g+1}`,o,!1);const k=Qe.useCallback(P=>{const B=P.alt?10:1;Pu(p,Math.min(d,g+B))},[d,g,p]),R=Qe.useCallback(P=>{const B=P.alt?10:1;Pu(p,Math.max(f,g-B))},[f,g,p]);return xe.jsx(xe.Fragment,{children:r&&xe.jsx(bo,{MOVE_LEFT:R,MOVE_RIGHT:k})})}function vVe({sidebar:n,row:e,active:t,label:r,args:i,context:s}){const o=Qe.useContext(E_),a=Qe.useCallback(()=>{const[,...l]=i;o.sendclose(),setTimeout(()=>{e6(Ke,Qr(),l.join(" "))},1e3)},[i,o]),c=_u(!!t);return Wu(n,e,s),qr(`  $purple$16 $cyanRUNIT ${c}${r}`,s,!0),t&&xe.jsx(bo,{OK_BUTTON:a})}function yVe({sidebar:n,chip:e,row:t,active:r,label:i,args:s,context:o}){Wu(n,t,o);const[a,...c]=[_p(s[0],""),...s.slice(1)],l=[],u=[];for(let T=0;T<c.length;T+=2)l.push(c[T]),u.push(c[T+1]);const h=Qv(e,a),d=`${aR(h)??0}`;let p=u.indexOf(d);p<0&&(p=0);const _=Pf(),g=i.trim(),m=_u(r);qr(`$dkred ? ${m}${g} `,o,!1);const b=r?_?"$26":"$27":"/";qr(`${p+1}$green${b}${m}${u.length}`,o,!1),o.writefullwidth=32,qr(` $green${l[p]}`,o,!1),o.writefullwidth=void 0;const y=Qe.useCallback(()=>{const T=Math.max(0,p-1),k=parseFloat(u[T]);Number.isInteger(k)&&Pu(h,k)},[p,h]),x=Qe.useCallback(()=>{const T=Math.min(u.length-1,p+1),k=parseFloat(u[T]);Number.isInteger(k)&&Pu(h,k)},[p,h]);return xe.jsx(xe.Fragment,{children:r&&xe.jsx(bo,{MOVE_LEFT:y,MOVE_RIGHT:x})})}function bVe({sidebar:n,chip:e,row:t,active:r,label:i,args:s,context:o}){Wu(n,t,o);const a=_p(s[0],""),c=Qv(e,a),l=oQ(c),u=l?.toJSON()??"",h=Pf(),[f,d]=Qe.useState(0),[p,_]=Qe.useState(!1),[g,m]=Qe.useState(void 0),b=`${u} `,y=i.trim(),x=_u(r);qr(`$green $20 ${x}${y} $green`,o,!1);const T=o.x,R=o.y*o.width;o.writefullwidth=32,qr(`${b}`,o,!1),o.writefullwidth=void 0;const P=fe(g),B=o.width-T-2,U=P?Math.min(g,f):f;let z=P?Math.max(g,f):f;P&&(z!==U&&z===f&&--z,xx(T+U+R,T+z+R,15,8,o)),p&&h&&LO(T+f+R,"",o);function I(){fe(l)&&(d(U),m(void 0),l.delete(U,z-U+1))}return xe.jsxs(xe.Fragment,{children:[r&&xe.jsx(bo,{OK_BUTTON:()=>{l&&(_(!0),d(l.length),m(void 0))}}),p&&xe.jsx(iy,{blockhotkeys:!0,children:xe.jsx(bo,{MOVE_LEFT:L=>{L.shift?fe(g)||m(Ri(f-1,0,u.length)):m(void 0),d(M=>Ri(M-1,0,u.length))},MOVE_RIGHT:L=>{L.shift?fe(g)||m(f):m(void 0),d(M=>Ri(M+1,0,u.length))},CANCEL_BUTTON:()=>{_(!1),d(u.length),m(void 0)},OK_BUTTON:()=>_(!1),keydown:L=>{if(!l)return;const{key:M}=L,F=Jn(M),Z={alt:L.altKey,ctrl:vb?L.metaKey:L.ctrlKey,shift:L.shiftKey},$=l.toJSON();switch(F){case"delete":P?I():$.length>0&&l.delete(f,1);break;case"backspace":P?I():f>0&&(l.delete(f-1,1),d(Y=>Math.max(0,Y-1)));break;default:if(Z.ctrl)switch(F){case"a":m(0),d($.length);break;case"c":fe(ya())&&ya().writeText(l.toJSON()).catch(Y=>console.error(Y));break;case"v":fe(ya())&&ya().readText().then(Y=>{P&&I(),l.insert(f,Y),d(f+Y.length)}).catch(Y=>console.error(Y));break;case"x":fe(ya())&&ya().writeText(l.toJSON()).then(()=>I()).catch(Y=>console.error(Y));break}else Z.alt||L.key.length===1&&$.length<B&&(l.insert(f,L.key),d(Y=>Y+1));break}}})})]})}function SVe({sidebar:n,row:e,active:t,label:r,args:i,context:s}){const{setviewimage:o}=za(),a=Qe.useCallback(()=>{const[,...l]=i,u=l.join(" ");o(u)},[o,i]),c=_u(!!t);return Wu(n,e,s),qr(`  $purple$16 $cyanVIEWIT ${c}${r}`,s,!0),t&&xe.jsx(bo,{OK_BUTTON:a})}function EVe({chip:n,row:e,active:t,label:r,args:i,context:s}){Wu(!1,e,s);const[o]=[_p(i[0],"")],a="z",c=` ${a.toUpperCase()} `,l=_u(t),u=s.x-.25,h=s.y-.25;qr(`${s.iseven?"$black$onltgray":"$black$ondkcyan"}${c}${l}$onclear ${r}${fe(e)?`
`:""}`,s,!0);const f=Qe.useContext(E_),d=Qe.useCallback(()=>{f.sendmessage(H8(n,o),[])},[f,n,o]);return xe.jsxs("group",{position:[u*An.DRAW_CHAR_WIDTH(),h*An.DRAW_CHAR_HEIGHT(),1],children:[xe.jsx(e0,{visible:!1,width:c.length+.5,height:1.5,blocking:!0,onClick:d}),t&&xe.jsx(bo,{OK_BUTTON:d}),xe.jsx(tb,{hotkey:a,children:d})]})}function xVe({sidebar:n,row:e,item:t,active:r}){const i=Qr(),s=pu();if(Wu(n,e,s),s.iseven=s.y%2===0,typeof t=="string")return xe.jsx(hVe,{sidebar:n,player:i,item:t,row:e,context:s});if(Xn(t)){const[o,a,c,l,...u]=t;if(typeof o!="string"||typeof a!="string"||typeof c!="string")return null;const h={sidebar:n,player:i,chip:o,row:e,active:r,label:a,args:[c,...u],context:s},f=rn(l)?l:"";switch(Jn(f)){default:case"hyperlink":return xe.jsx(pVe,{...h});case"hk":case"hotkey":return xe.jsx(dVe,{...h});case"rn":case"range":return xe.jsx(_Ve,{...h});case"sl":case"select":return xe.jsx(yVe,{...h});case"nm":case"number":return xe.jsx(mVe,{...h});case"tx":case"text":return xe.jsx(bVe,{...h});case"copyit":return xe.jsx(fVe,{...h});case"openit":return xe.jsx(gVe,{...h});case"viewit":return xe.jsx(SVe,{...h});case"runit":return xe.jsx(vVe,{...h});case"zssedit":return xe.jsx(EVe,{...h});case"charedit":return xe.jsx(oVe,{...h});case"coloredit":return xe.jsx(bG,{...h});case"bgedit":return xe.jsx(bG,{isbg:!0,...h})}}return null}function hre({inline:n=!1,xmargin:e=1,ymargin:t=1,selected:r=-1,width:i,height:s,color:o,bg:a,text:c}){const l=Fb(i,s,0,o,a),u=l.getState(),h={...g_(i,s,o,a,t,e,i-e-1,s-t),...l.getState(),x:e,y:t};return UO(u,0,o,a),xe.jsxs($b,{store:l,children:[xe.jsx(Wb,{width:i,height:s}),xe.jsx(uR.Provider,{value:h,children:c.map((f,d)=>xe.jsx(xVe,{row:n?void 0:d,item:f,active:d===r,sidebar:e!==0},d))})]})}const SG=4,TVe=vb?.25:.5;function wVe(n){const e=Ri(n,-SG,SG);return Math.floor(e*TVe)}function V8({debug:n=!1,disabled:e=!1,blocking:t=!0,cursor:r="pointer",x:i=0,y:s=0,width:o=30,height:a=10,children:c,onClick:l,onScroll:u,...h}){return xe.jsxs("group",{...h,children:[xe.jsx(e0,{blocking:t,cursor:r,visible:n,x:i,y:s,width:o,height:a,onClick:l,onWheel:f=>{e||u?.(wVe(f.deltaY))}}),c]})}const AVe=2,RVe=14,fre=RVe*AVe;function CVe(n){return K5(n,fre*.5)}function MVe(n,e,t,r,i=1.235){function s(a){return hje(a,r)}kl(n.userData,e,t,i,r,fre*12,s),n.position[e]=CVe(n.userData[e]);const o=t-n.position.y;return Math.abs(o)<.1}function kVe({name:n,width:e,height:t,context:r}){const i=qQ();for(let c=1;c<e-1;++c)c>2&&c<e-1&&Yo(i,e,t,c,1,{char:205,color:15}),Yo(i,e,t,c,t-1,{char:205,color:15});Yo(i,e,t,e-2,0,{char:196,color:15}),Yo(i,e,t,1,0,{char:205,color:15}),Yo(i,e,t,2,0,{char:187,color:15}),Yo(i,e,t,2,1,{char:200,color:15});for(let c=1;c<t-1;++c)Yo(i,e,t,0,c,{char:179,color:15}),Yo(i,e,t,e-1,c,{char:179,color:15});for(let c=2;c<t-1;++c)Yo(i,e,t,1,c,{char:0,color:15}),Yo(i,e,t,e-2,c,{char:0,color:15});Yo(i,e,t,0,0,{char:213,color:15}),Yo(i,e,t,e-1,0,{char:191,color:15}),Yo(i,e,t,e-1,1,{char:181,color:15}),Yo(i,e,t,0,t-1,{char:212,color:15}),Yo(i,e,t,e-1,t-1,{char:190,color:15});const s=` ${n} `,a=b0(s,e,t)?.x??s.length;return r.x=Math.round(e*.5),r.x-=Math.round(a*.5),r.y++,qr(s,r,!0),null}function OVe({store:n,children:e}){return xe.jsx($Q.Provider,{value:n,children:e})}function IVe({width:n,height:e}){const t=Qe.useContext($Q),[r]=pU(t,Uc(i=>[i.dither,i.render]));return n>0&&e>0&&xe.jsx(p3,{alphas:r.slice(),width:n,height:e})}function EG({x:n,y:e,color:t,on:r=232,off:i=7,alt:s}){const o=Pf(),a=qQ(),c=Qe.useRef(0),l=fe(s)?c.current%2===0?r:s:r;return Yo(a,a.width,a.height,n,e,{char:o?l:i,color:t}),a.changed(),o&&++c.current,null}function NVe({row:n,width:e,height:t,panelwidth:r,panelheight:i,children:s}){const o=UDe(r,i,0),a=[.001,.05,.1,.2],c=.4,{dither:l}=o.getState();LDe(l);for(let u=0;u<r;++u){aP(l,r,i,u,n,c);for(let h=0;h<a.length;++h){const f=a.length-h;aP(l,r,i,u,n-f,a[h]),aP(l,r,i,u,n+f,a[h])}}return xe.jsxs(xe.Fragment,{children:[xe.jsx(Wb,{width:e,height:t}),xe.jsxs("group",{position:[2*An.DRAW_CHAR_WIDTH(),2*An.DRAW_CHAR_HEIGHT(),0],children:[xe.jsx(OVe,{store:o,children:xe.jsx(IVe,{width:r,height:i})}),s,xe.jsx(EG,{x:1,y:1}),xe.jsx(EG,{x:1,y:2+n,on:26,alt:27,off:45,color:12})]})]})}function G8({line:n,color:e,margin:t,y:r,leftedge:i,rightedge:s,context:o}){const a=Pf(),l=`$${(Bt[e]??"").toLowerCase()}${n.replaceAll(`
`,"").trim()}`,h=b0(l,1e4,1)?.measuredwidth??1,[f,d]=Qe.useState(0);Qe.useEffect(()=>{d(p=>a?p:(p-1)%h)},[a,h]),o.disablewrap=!0,o.active.leftedge=t,o.active.rightedge=s-t;for(let p=i+t+f;p<=s;p+=h)o.x=p,o.y=r,qr(l,o,!1);return o.active.leftedge=0,o.active.rightedge=s,o.disablewrap=!1,null}function PVe({width:n,height:e,color:t,bg:r,text:i,shouldclose:s}){const{viewport:o}=cl(),a=n-3,c=e-3,l=Fb(n,e,0,t,r),u=Qe.useContext(E_),h=i.length-1,f=Jr(P=>P.gadget.scrollname??""),d={...g_(n,e,t,r,0,0,n,e),...l.getState()},[p,_]=Qe.useState(()=>{const P=i.findIndex(B=>Xn(B));return P>=0&&P<=8?P:0});let g=p-Math.floor(c*.5);g=Math.min(i.length-c,g),g=Math.max(0,g);const m=i.slice(g,g+c),b=p-g,y=Qe.useRef(null),x=Qe.useCallback(()=>{s&&u.didclose()},[s,u]),T=Qe.useCallback(P=>{const B=P.ctrl?h:P.alt?10:1;_(U=>Math.max(0,U-B))},[_,h]),k=Qe.useCallback(P=>{const B=P.ctrl?h:P.alt?10:1;_(U=>Math.min(h,U+B))},[_,h]),R=Qe.useCallback(P=>{_(B=>Ri(Math.round(B+P),0,h))},[_,h]);return Qe.useEffect(()=>{if(y.current&&!s){const P=o.height;y.current.position.y=P,y.current.userData.y=P,y.current.userData.vy=0}},[s]),l_(Qe.useCallback((P,B)=>{if(fe(y.current)){const U=s?e*2*-An.DRAW_CHAR_HEIGHT():0;MVe(y.current,"y",U,B)&&x()}},[s,x,e])),xe.jsxs("group",{ref:y,"position-y":1e6,children:[xe.jsx(V8,{blocking:!0,x:0,y:0,width:n,height:e,onScroll:P=>R(P*.5)}),xe.jsxs(iy,{children:[xe.jsx(bo,{MOVE_UP:T,MOVE_DOWN:k,CANCEL_BUTTON:u.sendclose}),xe.jsxs($b,{store:l,children:[xe.jsx(kVe,{name:f,width:n,height:e,context:d}),xe.jsx(G8,{margin:3,color:Bt.BLUE,y:0,leftedge:0,rightedge:n,line:`
keys: $whiteup/down$green.SCROLL UP/DOWN 
$whiteesc/cancel$green.CLOSE SCROLL 
$whiteenter$green.ACTION ON SELECTED LINE 
$whitealt+up/down$green.JUMP 10 LINES 
$white$meta+up/down$green.JUMP TOP/BOTTOM $blue
`,context:d}),xe.jsx(NVe,{row:b,width:n,height:e,panelwidth:a,panelheight:c,children:xe.jsx(hre,{width:a,height:c,xmargin:0,ymargin:0,color:t,bg:Bt.ONCLEAR,text:m,selected:b})})]})]})]})}function DVe(){const n=xv(Uc(r=>r.pts)),e=Fb(dn,_r,0,Bt.BLBLACK,Bt.ONCLEAR),t=e.getState();UO(t,32,Bt.BLBLACK,Bt.ONCLEAR);for(let r=0;r<n.length;++r){const i=n[r];Yo(t,dn,_r,i.x,i.y,{char:177})}return xe.jsx("group",{"position-z":100,children:xe.jsx($b,{store:e,children:xe.jsx(Wb,{width:dn,height:_r})})})}const Tk=new Lt;function xG(){const n=An.DRAW_CHAR_WIDTH(),e=An.DRAW_CHAR_HEIGHT(),t=Math.floor(Tk.x/n),r=Math.floor((Tk.y+e*.5)/e);return{x:t,y:_r*.5+r}}function LVe(){const n=as(u=>u.inspector),[e,t]=xv(Uc(u=>[u.cursor,u.select])),r=OM(e??0,dn),i=OM(t??e??0,dn),s={x:Math.min(r.x,i.x),y:Math.min(r.y,i.y)},o={x:Math.max(r.x,i.x),y:Math.max(r.y,i.y)},a=o.x-s.x+1,c=o.y-s.y+1;function l(){Xt(xv.getState().cursor)&&AEe(Ke,Qr(),s,o),xv.setState(()=>({cursor:void 0,select:void 0}))}return xe.jsxs(xe.Fragment,{children:[n&&xe.jsx(e0,{visible:!0,opacity:0,color:"black",x:0,y:0,z:-1,width:dn,height:_r,cursor:"pointer",onPointerDown:u=>{u.intersections[0].object.worldToLocal(Tk.copy(u.intersections[0].point));const h=xG();xv.setState(()=>({cursor:bd(h,dn)}))},onPointerMove:u=>{if(fe(xv.getState().cursor)){u.intersections[0].object.worldToLocal(Tk.copy(u.intersections[0].point));const h=xG();xv.setState(()=>({select:bd(h,dn)}))}},onPointerUp:l,onPointerOut:l,onPointerCancel:l}),fe(e)&&xe.jsxs(xe.Fragment,{children:[xe.jsx(e0,{x:s.x+.25,y:s.y+.25,z:100,width:a-.5,height:c-.5,color:"black",opacity:.3}),xe.jsx(e0,{x:s.x,y:s.y,z:101,width:a,height:c,color:"white",opacity:.25})]})]})}function UVe(){return as(e=>e.inspector)&&xe.jsxs(xe.Fragment,{children:[xe.jsx(LVe,{}),xe.jsx(DVe,{})]})}function $8(n,e){const t=Qe.useMemo(()=>Array.from({length:e},()=>({id:"",x:0,y:0,char:0,color:0,bg:0,stat:0})),[e]),r=Qe.useMemo(()=>{const i={};for(let c=0;c<n.length;++c)i[n[c].id]=n[c];const s=new Set(t.map(c=>c.id));let o=0,a=0;for(let c=0;c<e;++c)if(t[c].id){const l=i[t[c].id];fe(l)?(t[c]={...l},a=Math.max(c,a)):t[c].id=""}else if(o<n.length){for(;s.has(n[o]?.id)===!0;)++o;o<n.length&&(t[c]={...n[o++]},a=Math.max(c,a))}return a},[n,e,t]);return[t,r]}const dre=vx(Cb(Ob)),wk=Dm(Mb(kb)),BVe=new io({transparent:!1,side:Ba,uniforms:{time:Ua,interval:aT,smoothrate:new on(tR),palette:new on(dre),map:new on(wk),alt:new on(wk),dpr:new on(1),screenwidth:new on(1),screenheight:new on(1),pointSize:new on(new Nn),rows:new on(1),step:new on(new Nn),size:new on(new Nn),pixel:new on(new Nn),flip:new on(!0)},vertexShader:`
    precision highp float;
    attribute float visible;
    attribute vec4 display;
    attribute vec3 lastposition;
    attribute vec2 lastcolor;
    attribute vec2 lastbg;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec2 pointSize;
    uniform vec3 palette[16];
    uniform float dpr;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;

    ${lT}

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(index) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = palette[int(index)];
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vDisplay.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }

    void main() {
      vVisible = visible;

      float deltaPosition = animDelta(lastposition.z, smoothrate, 1.0);
      vec2 animPosition = mix(lastposition.xy, position.xy, deltaPosition);

      float deltaColor = animDelta(lastcolor.y, smoothrate, 1.0);
      int sourceColori = int(round(lastcolor.x));
      int destColori = int(round(display.z));

      vec3 sourceColor;
      if (sourceColori > 32) {
        sourceColor = palette[sourceColori - 33];
      } else {
        sourceColor = palette[sourceColori % 16];
      }

      vec3 destColor;
      if (destColori > 32) {
        destColor = palette[destColori - 33];
      } else {
        destColor = palette[destColori % 16];
      }

      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastbg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastbg.x);
      vec4 destBg = bgFromIndex(display.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      if (destColori > 31) {
        vColor = mix(vBg.rgb, vColor, cyclefromtime());
      }

      vDisplay.xy = display.xy;

      animPosition *= pointSize;
      animPosition += pointSize * 0.5;
      animPosition.x -= 1.0;

      vec4 mvPosition = vec4(animPosition, 0.0, 1.0);
      #ifdef USE_INSTANCING
      	mvPosition = instanceMatrix * mvPosition;
      #endif        
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;

      // this handles things being scaled
      gl_PointSize = pointSize.y * modelViewMatrix[0][0] * dpr;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform float rows;
    uniform vec2 step;
    uniform vec2 size;
    uniform vec2 pixel;
    uniform vec2 pointSize;
    uniform bool flip;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;

    void main() {
      float xscale = pointSize.y / pointSize.x;
      float xpadding = (pointSize.y - pointSize.x) / pointSize.y;
      float px = gl_PointCoord.x * xscale - xpadding;      
      if (vVisible == 0.0 || px < 0.0 || px > 1.0) {
        discard;
      }
      float py = gl_PointCoord.y;
      if (flip) {
        py = 1.0 - py;
      }

      vec2 idx = vec2(px, py) * size * pixel;
      vec2 lookup = vec2(vDisplay.x, rows - vDisplay.y) * step * pixel;
      vec2 uv = lookup + idx + vec2(1.0, 1.0) * pixel;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 0.001) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
        gl_FragColor.a = 1.0;
      }
    }
  `});function FVe(){return cy(BVe)}const jVe=new io({transparent:!1,side:Ba,uniforms:{time:Ua,interval:aT,smoothrate:new on(tR),palette:new on(dre),map:new on(wk),alt:new on(wk),dpr:new on(1),screenwidth:new on(1),screenheight:new on(1),pointSize:{value:new Nn(1,1)},rows:new on(1),step:new on(new Nn),size:new on(new Nn),pixel:new on(new Nn),flip:new on(!0)},vertexShader:`
    precision highp float;
    attribute float visible;
    attribute vec4 display;
    attribute vec3 lastposition;
    attribute vec2 lastcolor;
    attribute vec2 lastbg;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec2 pointSize;
    uniform vec3 palette[16];
    uniform float dpr;
    uniform float screenwidth;
    uniform float screenheight;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;

    ${lT}

    float PI = radians(180.0);

    vec3 colorFromIndex(float index) {
      return palette[int(index)];
    }

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(index) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = colorFromIndex(index);
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vDisplay.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }

    void main() {
      vVisible = visible;

      float deltaPosition = animDelta(lastposition.z, smoothrate, 1.0);
      vec2 animPosition = mix(lastposition.xy, position.xy, deltaPosition);

      float deltaColor = animDelta(lastcolor.y, smoothrate, 1.0);
      int sourceColori = int(round(lastcolor.x));
      int destColori = int(round(display.z));

      vec3 sourceColor;
      if (sourceColori > 32) {
        sourceColor = palette[sourceColori - 33];
      } else {
        sourceColor = palette[sourceColori % 16];
      }

      vec3 destColor;
      if (destColori > 32) {
        destColor = palette[destColori - 33];
      } else {
        destColor = palette[destColori % 16];
      }

      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastbg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastbg.x);
      vec4 destBg = bgFromIndex(display.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      if (destColori > 31) {
        vColor = mix(vBg.rgb, vColor, cyclefromtime());
      }

      vDisplay.xy = display.xy;

      animPosition *= pointSize;
      animPosition += pointSize * 0.5;
      animPosition.x -= 1.0;

      // model space
      vec4 mvPosition = vec4(animPosition, 0.0, 1.0);
      #ifdef USE_INSTANCING
        mvPosition = instanceMatrix * mvPosition;
      #endif
      mvPosition = modelViewMatrix * mvPosition;
  
      // transform to screenspace 
      gl_Position = projectionMatrix * mvPosition;

      // this handles things being scaled
      float fov = 2.0 * atan(1.0 / projectionMatrix[1][1]) * 180.0 / PI;
      float heightOfNearPlane = screenheight / (2.0 * tan(0.5 * fov * PI / 180.0));
      gl_PointSize = (heightOfNearPlane * pointSize.y) / gl_Position.w;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform float rows;
    uniform vec2 step;
    uniform vec2 size;
    uniform vec2 pixel;
    uniform vec2 pointSize;
    uniform bool flip;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;

    void main() {
      float xscale = pointSize.y / pointSize.x;
      float xpadding = (pointSize.y - pointSize.x) / pointSize.y;
      float px = gl_PointCoord.x * xscale - xpadding;      
      
      if (vVisible == 0.0 || px < 0.0 || px > 1.0) {
        discard;
      }
      
      float py = gl_PointCoord.y;
      if (flip) {
        py = 1.0 - py;
      }

      vec2 idx = vec2(px, py) * size * pixel;
      vec2 lookup = vec2(vDisplay.x, rows - vDisplay.y) * step * pixel;
      vec2 uv = lookup + idx + vec2(1.0, 1.0) * pixel;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 0.001) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
        gl_FragColor.a = 1.0;
      }
    }
  `});function zVe(){return cy(jVe)}function IA({sprites:n,scale:e=1,withbillboards:t=!1,limit:r=f0}){const{viewport:i}=cl(),s=za($=>$.palettedata),o=za($=>$.spritecharsetdata),a=za($=>$.spritealtcharsetdata),c=Qe.useMemo(()=>t?zVe():FVe(),[t]),{width:l=0,height:u=0}=o?.image??{};Qe.useEffect(()=>{if(!o)return;const $=ja+2,Y=Oc+2,Q=Math.round(u/Y);c.uniforms.palette.value=s,c.uniforms.map.value=o,c.uniforms.alt.value=a??o,c.uniforms.dpr.value=e,c.uniforms.screenwidth.value=i.width,c.uniforms.screenheight.value=i.height,c.uniforms.rows.value=Q-1,c.uniforms.step.value.x=$,c.uniforms.step.value.y=Y,c.uniforms.size.value.x=ja,c.uniforms.size.value.y=Oc,c.uniforms.pixel.value.x=1/l,c.uniforms.pixel.value.y=1/u,c.uniforms.pointSize.value.x=An.DRAW_CHAR_WIDTH(),c.uniforms.pointSize.value.y=An.DRAW_CHAR_HEIGHT(),c.uniforms.flip.value=!1,c.needsUpdate=!0},[s,o,a,c,l,u,i.width,i.height,e]);const[h,f]=Qe.useState(),[d,p]=$8(n,r),_=Qe.useMemo(()=>new Uint8Array(r),[r]),g=Qe.useMemo(()=>new Float32Array(r*3),[r]),m=Qe.useMemo(()=>new Float32Array(r*3),[r]),b=Qe.useMemo(()=>new Float32Array(r*4),[r]),y=Qe.useMemo(()=>new Float32Array(r*2),[r]),x=Qe.useMemo(()=>new Float32Array(r*2),[r]),[T,k]=Qe.useState(),[R,P]=Qe.useState(),[B,U]=Qe.useState(),[z,I]=Qe.useState(),[L,M]=Qe.useState(),[F,Z]=Qe.useState();return Qe.useEffect(()=>{if(!(!fe(h)||!fe(T)||!fe(R)||!fe(B)||!fe(z)||!fe(L)||!fe(F))){for(let $=0;$<d.length;++$){const Y=d[$];if(Y.id)if(T.getX($)===0)R.setXY($,Y.x,Y.y),z.setXYZW($,Y.char%Fa,Math.floor(Y.char/Fa),Y.color,Y.bg),B.setXYZ($,Y.x,Y.y,Ua.value),L.setXY($,Y.color,Ua.value),F.setXY($,Y.bg,Ua.value),T.setX($,1),T.needsUpdate=!0,R.needsUpdate=!0,z.needsUpdate=!0,B.needsUpdate=!0,L.needsUpdate=!0,F.needsUpdate=!0;else{(R.getX($)!==Y.x||R.getY($)!==Y.y)&&(B.setXYZ($,R.getX($),R.getY($),Ua.value),R.setXY($,Y.x,Y.y),B.needsUpdate=!0,R.needsUpdate=!0);const q=Y.char%Fa,V=Math.floor(Y.char/Fa);(z.getX($)!==q||z.getY($)!==V)&&(z.setXY($,q,V),z.needsUpdate=!0),z.getZ($)!==Y.color&&(L.setXY($,z.getZ($),Ua.value),z.setZ($,Y.color),L.needsUpdate=!0,z.needsUpdate=!0),z.getW($)!==Y.bg&&(F.setXY($,z.getW($),Ua.value),z.setW($,Y.bg),F.needsUpdate=!0,z.needsUpdate=!0)}else T.getX($)&&(T.setX($,0),T.needsUpdate=!0)}h.computeBoundingBox(),h.computeBoundingSphere()}},[h,n,d,p,T,R,z,B,L,F]),xe.jsxs("points",{frustumCulled:!1,children:[xe.jsxs("bufferGeometry",{ref:f,children:[xe.jsx("bufferAttribute",{ref:k,attach:"attributes-visible",name:"visible",args:[_,1]}),xe.jsx("bufferAttribute",{ref:P,attach:"attributes-position",name:"position",args:[g,3]}),xe.jsx("bufferAttribute",{ref:U,attach:"attributes-lastposition",name:"lastpositiona",args:[m,3]}),xe.jsx("bufferAttribute",{ref:I,attach:"attributes-display",name:"display",args:[b,4]}),xe.jsx("bufferAttribute",{ref:M,attach:"attributes-lastcolor",name:"lastcolor",args:[y,2]}),xe.jsx("bufferAttribute",{ref:Z,attach:"attributes-lastbg",name:"lastbg",args:[x,2]})]}),xe.jsx("primitive",{object:c,attach:"material"})]})}function nb({id:n,z:e,from:t}){const r=Jr(Uc(i=>i.gadget[t]?.find(s=>s.id===n)));switch(r?.type){default:case es.BLANK:case es.MEDIA:return null;case es.TILES:return xe.jsx("group",{position:[0,0,e],children:xe.jsx(yp,{width:r.width,height:r.height,char:r.char,color:r.color,bg:r.bg})},r.id);case es.SPRITES:return xe.jsx("group",{position:[0,0,e],children:xe.jsx(IA,{sprites:r.sprites})},r.id);case es.DITHER:return xe.jsx("group",{position:[0,0,e],children:xe.jsx(p3,{width:r.width,height:r.height,alphas:r.alphas})},r.id)}}const TG=n=>(n.getAttributes()&Fu.CONVOLUTION)===Fu.CONVOLUTION,HVe=Qe.memo(Qe.forwardRef(({children:n,camera:e,width:t,height:r},i)=>{const{gl:s,scene:o}=cl(),[a]=Qe.useMemo(()=>{const u=new Jne(s,{depthBuffer:!0,stencilBuffer:!1,multisampling:0,frameBufferType:Jv});return u.autoRenderToScreen=!1,u.addPass(new ere(o,e)),[u]},[e,s,o]);l_((u,h)=>{a.setSize(t,r),a.render(h)},1);const c=Qe.useRef(null);Qe.useLayoutEffect(()=>{const u=[],h=c.current.__r3f;if(h&&a){const f=h.children;for(let d=0;d<f.length;d++){const p=f[d].object;if(p instanceof Id){const _=[p];if(!TG(p)){let m=null;for(;(m=f[d+1]?.object)instanceof Id&&!TG(m);)_.push(m),d++}const g=new tre(e,..._);u.push(g)}else p instanceof qh&&u.push(p)}for(const d of u)a?.addPass(d)}return()=>{for(const f of u)a?.removePass(f)}},[a,n,e]);const l=Qe.useMemo(()=>({composer:a,normalPass:null,downSamplingPass:null,resolutionScale:void 0,camera:e,scene:o}),[a,e,o]);return Qe.useImperativeHandle(i,()=>a,[a]),xe.jsx(U8.Provider,{value:l,children:xe.jsx("group",{ref:c,children:n})})})),VVe=Qe.forwardRef(function({children:e,fbo:t,...r},i){const[s]=Qe.useState(()=>new uM);return Qe.useImperativeHandle(i,()=>t,[t]),xe.jsxs(xe.Fragment,{children:[Wde(xe.jsxs(xe.Fragment,{children:[e,xe.jsx("group",{onPointerOver:()=>null})]}),s),xe.jsx("primitive",{object:t.texture,...r})]})});function GVe({fbo:n,effects:e}){const{mood:t}=za(),[r]=Qe.useState(()=>new Xne(n,!0));return Qe.useEffect(()=>()=>{r.dispose()},[r]),xe.jsxs(xe.Fragment,{children:[t.includes("dark")&&xe.jsxs(Qe.Fragment,{children:[xe.jsx(nHe,{delay:new Nn(10,120),duration:new Nn(.1,3),strength:new Nn(0,.15),mode:Cv.SPORADIC,active:!0,ratio:.5}),xe.jsx(rHe,{opacity:.5,premultiply:!0,blendFunction:ui.DARKEN})]},"mood"),t.includes("bright")&&xe.jsx(Qe.Fragment,{children:xe.jsx(tHe,{intensity:.111,mipmapBlur:!1,luminanceThreshold:.5,luminanceSmoothing:.001,kernelSize:UR.VERY_LARGE})},"mood"),e,xe.jsx("primitive",{object:r,dispose:null})]})}function g3({camera:n,viewwidth:e,viewheight:t,effects:r,children:i}){const{mood:s}=za(),{viewport:o}=cl(),a=qne(e*o.dpr,t*o.dpr,{samples:0,stencilBuffer:!1,depthBuffer:!0,generateMipmaps:!1}),c=e*.5,l=t*.5;return xe.jsx(xe.Fragment,{children:xe.jsxs("mesh",{position:[c,l,0],children:[xe.jsx("planeGeometry",{args:[e,t]}),xe.jsx("meshBasicMaterial",{transparent:!0,children:xe.jsxs(VVe,{attach:"map",fbo:a,children:[i,xe.jsx(HVe,{camera:n,width:e,height:t,children:xe.jsx(GVe,{fbo:a,effects:r})},s)]})})]})})}function $Ve({width:n,height:e}){const{viewport:t}=cl(),r=S_(),i=An.DRAW_CHAR_WIDTH(),s=An.DRAW_CHAR_HEIGHT(),o=n*An.DRAW_CHAR_WIDTH(),a=e*An.DRAW_CHAR_HEIGHT(),c=Qe.useRef(null),l=Qe.useRef(null),u=Qe.useRef(null),h=Qe.useRef(null),f=Qe.useRef(null),[,d]=Qe.useState(!1);Qe.useLayoutEffect(()=>d(!0),[]),l_((y,x)=>{if(!c.current||!h.current||!u.current||!l.current||!f.current)return;const T=zx(Jr.getState().gadget.layers??[]),k=.05,R=Jr.getState().gadget.board;fe(c.current.userData.focusx)||(c.current.userData={focusx:T.focusx,focusy:T.focusy,tfocusx:T.focusx,tfocusy:T.focusy,currentboard:R},u.current.scale.setScalar(T.viewscale));const P=c.current.userData??{},B=(P.focusx+.5)*i,U=(P.focusy+.5)*s;Kv(u.current.scale,T.viewscale,k,x),Kv(l.current.position,[-B,-U,0],k,x);const z=u.current.scale.x,I=dn*i,L=_r*s;if(o>I*z)P.tfocusx=dn*.5;else{const M=o*.5/(i*z),F=dn-M;P.tfocusx=Ri(T.focusx,M-1,F+.25)}if(a>L*z)P.tfocusy=_r*.5;else{const M=a*.5/(s*z),F=_r-M;P.tfocusy=Ri(T.focusy,M-1,F)}R!==P.currentboard?(P.focusx=P.tfocusx,P.focusy=P.tfocusy,P.currentboard=R,l.current.position.set(-((P.focusx+.5)*i),-((P.focusy+.5)*s),0)):(kl(P,"focusx",P.tfocusx,k),kl(P,"focusy",P.tfocusy,k)),h.current.position.x=l.current.position.x,h.current.position.y=l.current.position.y,f.current.scale.setScalar(z)}),Jr(y=>y.gadget.over?.length??0),Jr(y=>y.gadget.under?.length??0),Jr(y=>y.gadget.layers?.length??0);const{over:p=[],under:_=[],layers:g=[]}=Jr.getState().gadget,m=t.width*-.5+r.marginx,b=t.height*.5-r.marginy;return xe.jsxs(xe.Fragment,{children:[xe.jsx("group",{position:[o*.5,a*.5,1],children:xe.jsx("group",{ref:f,children:xe.jsx("group",{ref:h,children:xe.jsx(UVe,{})})})}),xe.jsx("orthographicCamera",{ref:c,left:o*-.5,right:o*.5,top:a*-.5,bottom:a*.5,near:.1,far:2e3,position:[0,0,1e3],onUpdate:y=>y.updateProjectionMatrix()}),c.current&&xe.jsx(g3,{camera:c.current,viewwidth:o,viewheight:a,effects:xe.jsx(xe.Fragment,{}),children:xe.jsx("group",{position:[m,b,0],children:xe.jsx("group",{ref:u,children:xe.jsxs("group",{ref:l,children:[_.map((y,x)=>xe.jsx(nb,{from:"under",id:y.id,z:1+x*2},y.id)),g.map((y,x)=>xe.jsx(nb,{from:"layers",id:y.id,z:1+_.length+x*2},y.id)),p.map((y,x)=>xe.jsx(nb,{from:"over",id:y.id,z:1+_.length+g.length+x*2},y.id))]})})})})]})}const WVe=`
float qinticIn(float t) {
  return pow(t, 5.0);
}

void mainImage(const in vec4 inputColor, const in vec2 uv, const in float depth, out vec4 outputColor) {
	float viewZ = perspectiveDepthToViewZ(depth, cameraNear, cameraFar);
	float linearDepth = 1.0 - viewZToOrthographicDepth(viewZ, cameraNear, cameraFar);
  float moddedDepth = qinticIn(linearDepth);
  float shade = clamp(moddedDepth, 0.0, 1.0);
  outputColor = vec4(vec3(shade), inputColor.a);
}
`;class qVe extends Id{constructor(){super("DepthFogEffect",WVe,{blendFunction:ui.MULTIPLY,attributes:Fu.DEPTH})}update(){}}const YVe=cT(qVe),pre=vx(Cb(Ob)),Ak=Dm(Mb(kb)),KVe=new io({transparent:!1,side:Ba,uniforms:{time:Ua,interval:aT,palette:new on(pre),map:new on(Ak),alt:new on(Ak),cols:new on(1),step:new on(new Nn)},vertexShader:`
    precision highp float;
    uniform float time;
    uniform float interval;

    varying vec2 vUv;
    varying vec3 vColor;

    void main() {
      vUv = uv;
    
      vec4 mvPosition = vec4(position, 1.0);
      #ifdef USE_INSTANCING
        vColor.xyz = instanceColor.xyz;
      	mvPosition = instanceMatrix * mvPosition;
      #endif        
      
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform vec3 palette[16];
    uniform vec2 step;
    uniform float cols;

    varying vec2 vUv;
    varying vec3 vColor;

    ${lT}

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(gl_FragCoord.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }
      
    void main() {
      // r = char, g = color, b = bg
      int tc = int(round(cols));
      int ti = int(round(vColor.r));
      float tx = float(ti % tc);
      float ty = floor(float(ti) / cols);

      int colori = int(round(vColor.g));
      int bgi = int(round(vColor.b));

      vec3 color;
      if (colori > 31) {
        vec3 bg = palette[bgi];
        color = palette[colori - 33];
        float cycle = mod(time * 2.5, interval * 2.0) / interval;
        color = mix(bg, color, cyclefromtime());
      } else {
        color = palette[colori % 16];
      }

      vec3 bg = palette[bgi];

      vec2 uv = vUv * step + vec2(tx * step.x, ty * step.y);
      uv.y = 1.0 - uv.y;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture(alt, uv).rgb : texture(map, uv).rgb;

      if (blip.r == 0.0) {
        if (bgi >= ${Bt.ONCLEAR}) {
          discard;
        }
        color = palette[bgi];
      }

      gl_FragColor.rgb = color;
      gl_FragColor.a = 1.0;
    }
  `});function XVe(){return cy(KVe)}const ZVe=new io({transparent:!1,side:Ba,uniforms:{time:Ua,interval:aT,smoothrate:new on(tR),palette:new on(pre),map:new on(Ak),alt:new on(Ak),cols:new on(1),step:new on(new Nn),flip:new on(!0)},vertexShader:`
    precision highp float;
    attribute float visible;
    attribute vec3 nowposition;
    attribute mat4 lastmatrix;
    attribute vec4 display;
    attribute vec2 lastcolor;
    attribute vec2 lastbg;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec3 palette[16];

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;
    varying vec2 vUv;

    ${lT}

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(round(index)) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = palette[int(round(index))];
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vDisplay.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }
      
    void main() {
      vec4 mvPosition = vec4(position, 1.0);
      
      vec4 mvNowPosition = instanceMatrix * mvPosition;
      vec4 mvLastPosition = lastmatrix * mvPosition;

      float deltaPosition = clamp((time - nowposition.z) * smoothrate, 0.0, 1.0);
      mvPosition = mix(mvLastPosition, mvNowPosition, deltaPosition);

      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;

      vUv = uv;
    
      float deltaColor = animDelta(lastcolor.y, smoothrate, 1.0);
      int sourceColori = int(round(lastcolor.x));
      int destColori = int(round(display.z));

      vec3 sourceColor;
      if (sourceColori > 32) {
        sourceColor = palette[sourceColori - 33];
      } else {
        sourceColor = palette[sourceColori % 16];
      }

      vec3 destColor;
      if (destColori > 32) {
        destColor = palette[destColori - 33];
      } else {
        destColor = palette[destColori % 16];
      }

      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastbg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastbg.x);
      vec4 destBg = bgFromIndex(display.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      if (destColori > 31) {
        vColor = mix(vBg.rgb, vColor, cyclefromtime());
      }

      vDisplay.xy = vec2(round(display.x), round(display.y));

      vVisible = visible;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform vec3 palette[16];
    uniform vec2 step;
    uniform float cols;
    uniform bool flip;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;
    varying vec2 vUv;
      
    void main() {
      if (vVisible == 0.0) {
        discard;
      }

      vec2 uv = vUv * step + vec2(vDisplay.x * step.x, vDisplay.y * step.y);
      if (flip) {
        uv.y = 1.0 - uv.y;
      }

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 0.001) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
      }
      gl_FragColor.a = 1.0;
    }
  `});function JVe(){return cy(ZVe)}const QVe=new io({transparent:!1,side:Ba,uniforms:{color:{value:new gi(0,0,0)},data:{value:null}},vertexShader:`
    precision highp float;
    varying float vAlpha;
  
    void main() {
      vec4 mvPosition = vec4(position, 1.0);
      #ifdef USE_INSTANCING
        vAlpha = instanceColor.x;
        mvPosition = instanceMatrix * mvPosition;
      #endif        
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;
    }
    `,fragmentShader:`
    precision highp float;
    uniform vec3 color;
    uniform sampler2D data;

    varying float vAlpha;

    // adapted from https://www.shadertoy.com/view/Mlt3z8
    float bayerDither2x2( vec2 v ) {
      return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
    }

    float bayerDither4x4( vec2 v ) {
      vec2 P1 = mod( v, 2.0 );
      vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
      return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
    }

    void main() {
      if (vAlpha < 1.0) {
        vec2 ditherCoord = floor( mod( gl_FragCoord.xy, 4.0 ) );
        if ( bayerDither4x4( ditherCoord ) / 16.0 >= vAlpha ) {
          discard;
        }
      }

      gl_FragColor.rgba = vec4(color.xyz, 1.0);
    }
    `});function eGe(){return cy(QVe)}const _f=new al;function FP({sprites:n,facing:e,children:t,limit:r=f0}){const i=za(Y=>Y.palettedata),s=za(Y=>Y.charsetdata),o=za(Y=>Y.altcharsetdata),[a]=Qe.useState(()=>JVe()),[c,l]=$8(n,r),{width:u=0,height:h=0}=s?.image??{};Qe.useEffect(()=>{a.uniforms.map.value=s,a.uniforms.alt.value=o??s,a.uniforms.palette.value=i;const Y=Math.round(u/ja),Q=Math.round(h/Oc);a.uniforms.cols.value=Y,a.uniforms.step.value.x=1/Y,a.uniforms.step.value.y=1/Q,a.needsUpdate=!0},[i,s,o,a,u,h]);const{position:f,uv:d}=Qe.useMemo(()=>zHe(),[]),[p,_]=Qe.useState(),g=Qe.useMemo(()=>new Uint8Array(r),[r]),m=Qe.useMemo(()=>new Float32Array(r*3),[r]),b=Qe.useMemo(()=>new Float32Array(r*16),[r]),y=Qe.useMemo(()=>new Float32Array(r*4),[r]),x=Qe.useMemo(()=>new Float32Array(r*2),[r]),T=Qe.useMemo(()=>new Float32Array(r*2),[r]),[k,R]=Qe.useState(),[P,B]=Qe.useState(),[U,z]=Qe.useState(),[I,L]=Qe.useState(),[M,F]=Qe.useState(),[Z,$]=Qe.useState();return Qe.useEffect(()=>{if(!fe(p)||!fe(k)||!fe(P)||!fe(U)||!fe(I)||!fe(M)||!fe(Z))return;const Y=An.DRAW_CHAR_HEIGHT();for(let Q=0;Q<c.length;++Q){const q=c[Q];if(q.id){const[V,K,ne]=t(q.x,q.y);if(k.getX(Q)===0)_f.rotation.set(0,0,e),_f.position.set(V,K,ne),_f.updateMatrix(),p.setMatrixAt(Q,_f.matrix),_f.position.set(V,K,ne+Y*-.8),_f.updateMatrix(),U.set(_f.matrix.toArray(),Q*16),P.setXYZ(Q,V,K,Ua.value),I.setXYZW(Q,q.char%Fa,Math.floor(q.char/Fa),q.color,q.bg),M.setXY(Q,q.color,Ua.value),Z.setXY(Q,q.bg,Ua.value),k.setX(Q,1),k.needsUpdate=!0,P.needsUpdate=!0,U.needsUpdate=!0,I.needsUpdate=!0,M.needsUpdate=!0,Z.needsUpdate=!0,p.instanceMatrix.needsUpdate=!0;else{(P.getX(Q)!==V||P.getY(Q)!==K||p.userData.facing!==e)&&(p.getMatrixAt(Q,_f.matrix),U.set(_f.matrix.toArray(),Q*16),P.setXYZ(Q,V,K,Ua.value),_f.rotation.set(0,0,e),_f.position.set(V,K,ne),_f.updateMatrix(),p.setMatrixAt(Q,_f.matrix),U.needsUpdate=!0,P.needsUpdate=!0,p.instanceMatrix.needsUpdate=!0);const ae=q.char%Fa,Te=Math.floor(q.char/Fa);(I.getX(Q)!==ae||I.getY(Q)!==Te)&&(I.setXY(Q,ae,Te),I.needsUpdate=!0),I.getZ(Q)!==q.color&&(M.setXY(Q,I.getZ(Q),Ua.value),I.setZ(Q,q.color),M.needsUpdate=!0,I.needsUpdate=!0),I.getW(Q)!==q.bg&&(Z.setXY(Q,I.getW(Q),Ua.value),I.setW(Q,q.bg),Z.needsUpdate=!0,I.needsUpdate=!0)}}else k.getX(Q)&&(k.setX(Q,0),k.needsUpdate=!0)}p.userData.facing=e,p.computeBoundingBox(),p.computeBoundingSphere(),p.visible=!!p.count},[n,c,e,l,p,k,U]),xe.jsxs("instancedMesh",{ref:_,args:[void 0,void 0,r],children:[xe.jsxs("bufferGeometry",{children:[xe.jsx("bufferAttribute",{attach:"attributes-position",args:[f,3]}),xe.jsx("bufferAttribute",{attach:"attributes-uv",args:[d,2]}),xe.jsx("instancedBufferAttribute",{ref:R,name:"visible",usage:Bg,attach:"attributes-visible",args:[g,1]}),xe.jsx("instancedBufferAttribute",{ref:B,name:"nowposition",usage:Bg,attach:"attributes-nowposition",args:[m,3]}),xe.jsx("instancedBufferAttribute",{ref:z,name:"lastmatrix",usage:Bg,attach:"attributes-lastmatrix",args:[b,16]}),xe.jsx("instancedBufferAttribute",{ref:L,name:"display",usage:Bg,attach:"attributes-display",args:[y,4]}),xe.jsx("instancedBufferAttribute",{ref:F,name:"lastcolor",usage:Bg,attach:"attributes-lastcolor",args:[x,2]}),xe.jsx("instancedBufferAttribute",{ref:$,name:"lastbg",usage:Bg,attach:"attributes-lastbg",args:[T,2]})]}),xe.jsx("primitive",{object:a,attach:"material"})]})}function W8(n,e,t,r){return{char:n.map((i,s)=>{switch(r[s]){case kn.ISSWIM:case kn.ISSOLID:return 0}return Math.abs(i)}),color:e.map((i,s)=>{switch(r[s]){case kn.ISSWIM:case kn.ISSOLID:return Bt.ONCLEAR}return i}),bg:t.map((i,s)=>{switch(r[s]){case kn.ISSWIM:return Bt.ONCLEAR;case kn.ISSOLID:return Bt.BLACK}return i})}}function q8(n,e,t,r){return{char:n.map((i,s)=>{switch(r[s]){case kn.ISSOLID:return Math.abs(i)}return 0}),color:e,bg:t.map((i,s)=>{switch(r[s]){case kn.ISSOLID:return i}return Bt.ONCLEAR})}}function Y8(n,e,t,r){return{char:n.map((i,s)=>{switch(r[s]){case kn.ISSWIM:return Math.abs(i)}return 0}),color:e,bg:t.map((i,s)=>{switch(r[s]){case kn.ISSWIM:return i}return Bt.ONCLEAR})}}function tGe(n,e,t,r){return{char:n.map((i,s)=>{switch(r[s]){case kn.ISSWIM:case kn.ISSOLID:return 0}return n[s]<0?0:i}),color:e,bg:t.map((i,s)=>{switch(r[s]){case kn.ISSWIM:case kn.ISSOLID:return Bt.ONCLEAR}return n[s]<0?Bt.ONCLEAR:i})}}function mre(n,e,t,r){return{char:n.map((i,s)=>r[s]===kn.ISSWIM?0:176),color:e.map((i,s)=>r[s]===kn.ISSWIM?0:Bt.DKGRAY),bg:t.map((i,s)=>r[s]===kn.ISSWIM?Bt.ONCLEAR:Bt.BLACK)}}function nGe(n,e,t,r){return{char:n.map((i,s)=>{switch(r[s]){case kn.ISSWIM:case kn.ISSOLID:return 0}return n[s]<0?0:176}),color:e.map((i,s)=>{switch(r[s]){case kn.ISSWIM:case kn.ISSOLID:return 0}return n[s]<0?0:Bt.DKGRAY}),bg:t.map((i,s)=>{switch(r[s]){case kn.ISSWIM:case kn.ISSOLID:return Bt.ONCLEAR}return n[s]<0?Bt.ONCLEAR:Bt.BLACK})}}const jP=new al,wG=new gi;function K8({width:n,alphas:e,limit:t=f0}){const[r]=Qe.useState(()=>eGe()),i=An.DRAW_CHAR_WIDTH(),s=An.DRAW_CHAR_HEIGHT(),[o,a]=Qe.useState();Qe.useEffect(()=>{if(!fe(o))return;let l=0;const u=8/14;for(let h=0;h<e.length;++h){const f=OM(h,n),d=e[h];d!==0&&(jP.position.set((f.x+.5)*i-(1-u),(f.y+.5)*s,s*-.5),jP.updateMatrix(),o.setMatrixAt(l,jP.matrix),wG.set(d,0,0),o.setColorAt(l,wG),++l)}o.count=l,o.instanceMatrix.needsUpdate=!0,fe(o.instanceColor)&&(o.instanceColor.needsUpdate=!0),o.computeBoundingBox(),o.computeBoundingSphere(),o.visible=!!o.count},[o,e,n,i,s]);const c=.1;return xe.jsxs("instancedMesh",{ref:a,args:[void 0,void 0,t],children:[xe.jsx("boxGeometry",{args:[i-c,s-c,s*2.5]}),xe.jsx("primitive",{object:r,attach:"material"})]})}const zP=new al,AG=new gi;function Km({width:n,char:e,color:t,bg:r,partial:i,limit:s=f0}){const o=za(g=>g.palettedata),a=za(g=>g.charsetdata),c=za(g=>g.altcharsetdata),[l]=Qe.useState(()=>XVe()),{width:u=0,height:h=0}=a?.image??{};Qe.useEffect(()=>{l.uniforms.map.value=a,l.uniforms.alt.value=c??a,l.uniforms.palette.value=o;const g=Math.round(u/ja),m=Math.round(h/Oc);l.uniforms.cols.value=g,l.uniforms.step.value.x=1/g,l.uniforms.step.value.y=1/m,l.needsUpdate=!0},[o,a,c,l,u,h]);const{position:f,uv:d}=Qe.useMemo(()=>{const g=UHe(1,1);return i&&(g.position=g.position.map((m,b)=>b%3===2?m*i:m),g.uv=g.uv.map((m,b)=>b%2===1?m*i:m)),g},[i]),[p,_]=Qe.useState();return Qe.useEffect(()=>{if(!fe(p))return;const g=An.DRAW_CHAR_WIDTH(),m=An.DRAW_CHAR_HEIGHT();let b=0,y=0,x=0;for(let T=0;T<e.length;++T)e[T]===0&&r[T]===Bt.ONCLEAR||(zP.position.set(b*g,y*m,0),zP.updateMatrix(),p.setMatrixAt(x,zP.matrix),AG.set(e[T],t[T],r[T]),p.setColorAt(x,AG),++x),++b,b>=n&&(b=0,++y);p.count=x,p.instanceMatrix.needsUpdate=!0,fe(p.instanceColor)&&(p.instanceColor.needsUpdate=!0),p.computeBoundingBox(),p.computeBoundingSphere(),p.visible=!!p.count},[p,e,t,r,n]),xe.jsxs("instancedMesh",{ref:_,args:[void 0,void 0,s],children:[xe.jsxs("bufferGeometry",{children:[xe.jsx("bufferAttribute",{attach:"attributes-position",args:[f,3]}),xe.jsx("bufferAttribute",{attach:"attributes-uv",args:[d,2]})]}),xe.jsx("primitive",{object:l,attach:"material"})]})}const cp=new al;function X8({sprites:n,children:e,alpha:t=.5,limit:r=f0}){const[i,s]=Qe.useState(),[o,a]=Qe.useState(),[c,l]=Qe.useState(),[u,h]=Qe.useState(),[f]=Qe.useState(()=>OHe()),[d,p]=$8(n,r);Qe.useLayoutEffect(()=>{f.uniforms.alpha.value=t},[f,t]);const{position:_,uv:g}=Qe.useMemo(()=>j8(1,1),[]),m=Qe.useMemo(()=>new Uint8Array(r),[r]),b=Qe.useMemo(()=>new Float32Array(r*3),[r]),y=Qe.useMemo(()=>new Float32Array(r*16),[r]);return Qe.useEffect(()=>{if(!fe(i)||!fe(o)||!fe(c)||!fe(u))return;const x=8/14;for(let T=0;T<d.length;++T){const k=d[T];if(k.id){const[R,P,B]=e(k.x,k.y);o.getX(T)===0?(cp.scale.set(1,x,1),cp.position.set(R,P,B),cp.updateMatrix(),i.setMatrixAt(T,cp.matrix),u.set(cp.matrix.toArray(),T*16),c.setXYZ(T,R,P,Ua.value),o.setX(T,1),u.needsUpdate=!0,c.needsUpdate=!0,o.needsUpdate=!0,i.instanceMatrix.needsUpdate=!0):(c.getX(T)!==R||c.getY(T)!==P)&&(i.getMatrixAt(T,cp.matrix),u.set(cp.matrix.toArray(),T*16),c.setXYZ(T,R,P,Ua.value),cp.scale.set(1,x,1),cp.position.set(R,P,B),cp.updateMatrix(),i.setMatrixAt(T,cp.matrix),u.needsUpdate=!0,c.needsUpdate=!0,i.instanceMatrix.needsUpdate=!0)}else o.getX(T)&&(o.setX(T,0),o.needsUpdate=!0)}i.computeBoundingBox(),i.computeBoundingSphere(),i.visible=!!i.count},[n,d,p,i,o,c,u]),xe.jsxs("instancedMesh",{ref:s,args:[void 0,void 0,r],children:[xe.jsxs("bufferGeometry",{children:[xe.jsx("bufferAttribute",{attach:"attributes-position",args:[_,3]}),xe.jsx("bufferAttribute",{attach:"attributes-uv",args:[g,2]}),xe.jsx("instancedBufferAttribute",{ref:a,name:"visible",usage:Bg,attach:"attributes-visible",args:[m,1]}),xe.jsx("instancedBufferAttribute",{ref:l,name:"nowposition",usage:Bg,attach:"attributes-nowposition",args:[b,3]}),xe.jsx("instancedBufferAttribute",{ref:h,name:"lastmatrix",usage:Bg,attach:"attributes-lastmatrix",args:[y,16]})]}),xe.jsx("primitive",{object:f,attach:"material"})]})}function oE({id:n,z:e,from:t,layers:r,multi:i=!1}){const s=Qr(),o=Jr(Uc(u=>{if(fe(t))return u.gadget[t]?.find(h=>h.id===n);if(fe(r))return r.find(h=>h.id===n)})),a=An.DRAW_CHAR_WIDTH(),c=An.DRAW_CHAR_HEIGHT(),l=zx(Jr.getState().gadget.layers??[]);switch(o?.type){default:case es.BLANK:case es.MEDIA:return null;case es.TILES:{const u=W8(o.char,o.color,o.bg,o.stats),h=q8(o.char,o.color,o.bg,o.stats),f=Y8(o.char,o.color,o.bg,o.stats),d=tGe(o.char,o.color,o.bg,o.stats),p=mre(o.char,o.color,o.bg,o.stats),_=nGe(o.char,o.color,o.bg,o.stats);return xe.jsx(xe.Fragment,{children:xe.jsxs("group",{position:[0,0,e],children:[xe.jsx(yp,{width:o.width,height:o.height,char:u.char,color:u.color,bg:u.bg}),xe.jsx("group",{"position-z":c*-.25,children:xe.jsx(yp,{width:o.width,height:o.height,char:f.char,color:f.color,bg:f.bg})}),!i&&xe.jsx("group",{"position-z":c*-.25,children:xe.jsx(Km,{width:dn,char:p.char,color:p.color,bg:p.bg,partial:.25})}),xe.jsx("group",{"position-z":.5,children:xe.jsx(Km,{width:dn,char:h.char,color:h.color,bg:h.bg})}),xe.jsx("group",{"position-z":c+.5,children:xe.jsx(yp,{width:o.width,height:o.height,char:d.char,color:d.color,bg:d.bg})}),!i&&xe.jsxs("group",{"position-z":c+.5,children:[xe.jsx(Km,{width:dn,char:_.char,color:_.color,bg:_.bg,partial:.5}),xe.jsx(Km,{width:dn,char:h.char,color:h.color,bg:h.bg})]})]},o.id)})}case es.SPRITES:{const u=.5714285714285714,h=o.sprites.filter(_=>{switch(_.stat){case kn.ISSWIM:case kn.ISBULLET:return!1;default:return _.pid!==s}}),f=o.sprites.filter(_=>_.stat===kn.ISBULLET),d=o.sprites.filter(_=>_.stat===kn.ISSWIM),p=o.sprites.filter(_=>{switch(_.stat){case kn.ISSWIM:case kn.ISGHOST:return!1;default:return _.pid!==s}});return xe.jsxs("group",{position:[0,0,e],children:[xe.jsx(FP,{sprites:h,facing:l.facing,children:(_,g)=>[(_+.5)*a,(g+.5)*c,c*-.5]}),xe.jsx(FP,{sprites:f,facing:l.facing,children:(_,g)=>[(_+.5)*a,(g+.5)*c,c*-.75]}),xe.jsx(FP,{sprites:d,facing:l.facing,children:(_,g)=>[(_+.5)*a,(g+.5)*c,c*-1.25]}),xe.jsx(X8,{sprites:p,children:(_,g)=>[_*a,(g+.5-u*.5)*c,c*-.5+.5]})]},o.id)}case es.DITHER:return xe.jsx("group",{position:[0,0,e],children:xe.jsx(K8,{alphas:o.alphas,width:dn})},o.id)}}function aE(n){switch(n.type){case es.TILES:return 0;case es.DITHER:return An.DRAW_CHAR_HEIGHT()+1;case es.SPRITES:return An.DRAW_CHAR_HEIGHT()*.5}return 0}function rGe(n){switch(n){case Ic.NEAR:return 25;default:case Ic.MID:return 75;case Ic.FAR:return 110}}const PE=[],DE=[],LE=[];for(let n=0;n<_r;++n)for(let e=0;e<dn;++e)e===0||e===dn-1||n===0||n===_r-1?(PE.push(32),DE.push(Bt.BLACK),LE.push(Bt.BLACK)):(PE.push(0),DE.push(0),LE.push(Bt.ONCLEAR));function iGe({width:n,height:e}){const{viewport:t}=cl(),r=S_(),i=An.DRAW_CHAR_WIDTH(),s=An.DRAW_CHAR_HEIGHT(),o=n*i,a=e*s,c=dn*i,l=Qe.useRef(null),u=Qe.useRef(null),h=Qe.useRef(null),f=Qe.useRef(null),[,d]=Qe.useState(!1);Qe.useLayoutEffect(()=>{d(!0)},[]),l_((z,I)=>{if(!l.current||!u.current||!h.current||!f.current)return;const L=zx(Jr.getState().gadget.layers??[]),M=.05,F=.111,Z=Jr.getState().gadget.board;fe(f.current.userData.focusx)||(f.current.userData={focusx:L.focusx,focusy:L.focusy,lfocusx:L.focusx,lfocusy:L.focusy,facing:L.facing,lfacing:L.facing,sway:0,vsway:0,lean:0,vlean:0,currentboard:Z});const $=f.current.userData??{},Y=($.focusx+.5)*i,Q=($.focusy+.5)*s;if($.lfocusx!==L.focusx||$.lfocusy!==L.focusy){const Te=$.lfocusx-L.focusx,Ie=$.lfocusy-L.focusy;switch(Math.round(L.facing/(Math.PI*.5))){default:case 0:$.vsway=Ie*7,$.vlean=Te*.02;break;case 1:$.vsway=-Te*7,$.vlean=Ie*.02;break;case 2:$.vsway=-Ie*7,$.vlean=-Te*.02;break;case 3:$.vsway=Te*7,$.vlean=-Ie*.02;break}$.lfocusx=L.focusx,$.lfocusy=L.focusy}if($.lfacing!==L.facing){let ie=L.facing-$.lfacing;ie<-Math.PI?ie+=Math.PI*2:ie>Math.PI&&(ie+=Math.PI*-2);const ae=.02;$.vlean=ie*ae,$.lfacing=L.facing}Kv(l.current.position,[Y,-Q,512+s*.55],M,I),x4(u.current.rotation,[0,0,Math.PI-L.facing],M,I),x4(f.current.rotation,[Math.PI*-.49,0,$.lean],M,I);const q=1.2,V=Math.sin($.sway)*q,K=Math.abs(Math.sin($.sway)*q);if(Kv(f.current.position,[V,0,K],M,I),$.sway+=$.vsway*I,kl(f.current.userData,"vsway",0,F),kl(f.current.userData,"lean",$.vlean,F),kl(f.current.userData,"vlean",0,F),Z!==$.currentboard){$.sway=0,$.vsway=0,$.lean=0,$.vlean=0,$.focusx=L.focusx,$.focusy=L.focusy,$.lfocusx=$.focusx,$.lfocusy=$.focusy,$.currentboard=Z;const ie=($.focusx+.5)*i,ae=($.focusy+.5)*s;l.current.position.set(ie,-ae,512+s*.5);const Te=Math.sin($.sway)*q,Ie=Math.abs(Math.sin($.sway)*q);f.current.position.set(Te,0,Ie),f.current.rotation.set(Math.PI*-.49,0,$.lean)}else kl(f.current.userData,"focusx",L.focusx,M),kl(f.current.userData,"focusy",L.focusy,M);kl(f.current,"fov",rGe(L.viewscale),M,I),f.current.updateProjectionMatrix();const ne=Ri(o/c,1,10);h.current.position.x=o-c*ne,h.current.position.y=0,h.current.scale.setScalar(ne)}),Jr(z=>z.gadget.over?.length??0),Jr(z=>z.gadget.under?.length??0),Jr(z=>z.gadget.layers?.length??0);const{gadget:p,gadgetlayercache:_}=Jr.getState(),{over:g=[],under:m=[],layers:b=[]}=p,y=_[p.exiteast]??[],x=_[p.exitwest]??[],T=_[p.exitnorth]??[],k=_[p.exitsouth]??[],R=g.length>0,P=m.length*2+2,B=t.width*-.5+r.marginx,U=t.height*.5-r.marginy;return xe.jsxs(xe.Fragment,{children:[xe.jsx("group",{ref:l,children:xe.jsx("group",{ref:u,children:xe.jsx("perspectiveCamera",{ref:f,near:.1,far:3e3,aspect:-o/a,position:[0,s*-.5,0]})})}),xe.jsx("group",{ref:h,children:m.map((z,I)=>xe.jsx(nb,{from:"under",id:z.id,z:I*2},z.id))}),xe.jsx("group",{"position-z":P,children:f.current&&xe.jsx(g3,{camera:f.current,viewwidth:o,viewheight:a,effects:xe.jsxs(xe.Fragment,{children:[xe.jsx(B8,{worldFocusDistance:200,worldFocusRange:500,bokehScale:3}),xe.jsx(YVe,{})]}),children:xe.jsxs("group",{position:[B,U,0],children:[b.map(z=>xe.jsx(oE,{id:z.id,from:"layers",z:aE(z),multi:R},z.id)),g.map(z=>xe.jsx(oE,{from:"over",id:z.id,z:aE(z)+s+1,multi:R},z.id)),xe.jsx("group",{position:[dn*i,0,0],children:y.length?xe.jsx(xe.Fragment,{children:y.map(z=>xe.jsx(oE,{id:z.id,layers:y,z:aE(z),multi:R},z.id))}):xe.jsx("group",{"scale-z":2,children:xe.jsx(Km,{width:dn,char:PE,color:DE,bg:LE})})}),xe.jsx("group",{position:[dn*-i,0,0],children:x.length?xe.jsx(xe.Fragment,{children:x.map(z=>xe.jsx(oE,{id:z.id,layers:x,z:aE(z),multi:R},z.id))}):xe.jsx("group",{"scale-z":2,children:xe.jsx(Km,{width:dn,char:PE,color:DE,bg:LE})})}),xe.jsx("group",{position:[0,_r*-s,0],children:T.length?xe.jsx(xe.Fragment,{children:T.map(z=>xe.jsx(oE,{id:z.id,layers:T,z:aE(z),multi:R},z.id))}):xe.jsx("group",{"scale-z":2,children:xe.jsx(Km,{width:dn,char:PE,color:DE,bg:LE})})}),xe.jsx("group",{position:[0,_r*s,0],children:k.length?xe.jsx(xe.Fragment,{children:k.map(z=>xe.jsx(oE,{id:z.id,layers:k,z:aE(z),multi:R},z.id))}):xe.jsx("group",{"scale-z":2,children:xe.jsx(Km,{width:dn,char:PE,color:DE,bg:LE})})})]})})})]})}function cE({id:n,z:e,from:t,layers:r}){const i=Jr(Uc(a=>{if(fe(t))return a.gadget[t]?.find(c=>c.id===n);if(fe(r))return r.find(c=>c.id===n)})),s=An.DRAW_CHAR_WIDTH(),o=An.DRAW_CHAR_HEIGHT();switch(i?.type){default:case es.BLANK:case es.MEDIA:return null;case es.TILES:{const a=W8(i.char,i.color,i.bg,i.stats),c=q8(i.char,i.color,i.bg,i.stats),l=Y8(i.char,i.color,i.bg,i.stats),u=mre(i.char,i.color,i.bg,i.stats);return xe.jsx(xe.Fragment,{children:xe.jsxs("group",{position:[0,0,e],children:[xe.jsx(yp,{width:i.width,height:i.height,char:a.char,color:a.color,bg:a.bg}),xe.jsx("group",{"position-z":o*-.5,children:xe.jsx(yp,{width:i.width,height:i.height,char:l.char,color:l.color,bg:l.bg})}),t!=="over"&&xe.jsx("group",{"position-z":o*-1,children:xe.jsx(Km,{width:dn,char:u.char,color:u.color,bg:u.bg})}),xe.jsx(Km,{width:dn,char:c.char.map(h=>h!==0?219:0),color:c.color,bg:c.bg}),xe.jsx("group",{"position-z":o+1,children:xe.jsx(yp,{width:i.width,height:i.height,char:c.char,color:c.color,bg:c.bg})})]},i.id)})}case es.SPRITES:{const a=fe(r),c=i.sprites.filter(h=>h.stat!==kn.ISSWIM&&(!a||!h.pid)),l=i.sprites.filter(h=>h.stat===kn.ISSWIM&&(!a||!h.pid)),u=c.filter(h=>h.stat!==kn.ISGHOST);return xe.jsxs("group",{position:[0,0,e],children:[xe.jsx(X8,{sprites:u,limit:f0,children:(h,f)=>[h*s,(f+.25)*o,o*-.75+.5]}),xe.jsx(IA,{sprites:c,scale:1.25}),xe.jsx("group",{"position-z":o*-1,children:xe.jsx(IA,{sprites:l,scale:1.25})})]},i.id)}case es.DITHER:return xe.jsx("group",{position:[0,0,e],children:xe.jsx(K8,{alphas:i.alphas,width:dn})},i.id)}}function lE(n){switch(n.type){case es.TILES:return 0;case es.DITHER:return An.DRAW_CHAR_HEIGHT();case es.SPRITES:return An.DRAW_CHAR_HEIGHT()*.75}return 0}function sGe(n){switch(n){case Ic.NEAR:return 3;default:case Ic.MID:return 1.75;case Ic.FAR:return 1}}function oGe({width:n,height:e}){const{viewport:t}=cl(),r=S_(),i=An.DRAW_CHAR_WIDTH(),s=An.DRAW_CHAR_HEIGHT(),o=n*i,a=e*s,c=dn*i,l=_r*s,u=Qe.useRef(null),h=Qe.useRef(null),f=Qe.useRef(null),d=Qe.useRef(null),p=Qe.useRef(null),[,_]=Qe.useState(!1);Qe.useLayoutEffect(()=>{_(!0)},[]),l_((I,L)=>{if(!u.current||!h.current||!f.current||!d.current||!p.current)return;const M=zx(Jr.getState().gadget.layers??[]),F=.05,Z=Jr.getState().gadget.board;fe(d.current.userData.focusx)||(d.current.userData={focusx:M.focusx,focusy:M.focusy,facing:M.facing,currentboard:Z},u.current.scale.setScalar(M.viewscale));const $=d.current.userData??{},Y=($.focusx+.5)*i,Q=($.focusy+.5)*s;switch(Kv(u.current.scale,sGe(M.viewscale),F,L),Kv(f.current.position,[-Y,-Q,0],F,L),Z!==$.currentboard?($.focusx=M.focusx,$.focusy=M.focusy,$.currentboard=Z,f.current.position.set(-(($.focusx+.5)*i),-(($.focusy+.5)*s),0)):(kl(d.current.userData,"focusx",M.focusx,F),kl(d.current.userData,"focusy",M.focusy,F)),M.viewscale){case Ic.NEAR:p.current.bokehScale=5,p.current.cocMaterial.worldFocusRange=1e3,p.current.cocMaterial.worldFocusDistance=1e3;break;default:case Ic.MID:p.current.bokehScale=5,p.current.cocMaterial.worldFocusRange=1e3,p.current.cocMaterial.worldFocusDistance=1e3;break;case Ic.FAR:p.current.bokehScale=5,p.current.cocMaterial.worldFocusRange=1500,p.current.cocMaterial.worldFocusDistance=1e3;break}d.current.updateProjectionMatrix();const q=Ri(o/c,1,10),V=Ri(a/l,1,10),K=Math.max(q,V),ne=c*K,ie=l*K;h.current.position.x=o-ne,h.current.position.y=a-ie,h.current.scale.setScalar(K)}),Jr(I=>I.gadget.over?.length??0),Jr(I=>I.gadget.under?.length??0),Jr(I=>I.gadget.layers?.length??0);const{gadget:g,gadgetlayercache:m}=Jr.getState(),{over:b=[],under:y=[],layers:x=[]}=g,T=m[g.exiteast]??[],k=m[g.exitwest]??[],R=m[g.exitnorth]??[],P=m[g.exitsouth]??[],B=y.length*2+2,U=t.width*-.5+r.marginx,z=t.height*.5-r.marginy;return xe.jsxs(xe.Fragment,{children:[xe.jsxs("group",{"position-z":B,children:[xe.jsx("orthographicCamera",{ref:d,left:o*-.5,right:o*.5,top:a*-.5,bottom:a*.5,near:.1,far:2e3,position:[0,0,1e3]}),d.current&&xe.jsx(g3,{camera:d.current,viewwidth:o,viewheight:a,effects:xe.jsx(xe.Fragment,{children:xe.jsx(B8,{ref:p})}),children:xe.jsx("group",{position:[U,z,-500],children:xe.jsx("group",{rotation:[Math.PI*.25,0,Math.PI*-.25],children:xe.jsx("group",{ref:u,children:xe.jsxs("group",{ref:f,children:[x.map(I=>xe.jsx(cE,{id:I.id,from:"layers",z:lE(I)},I.id)),b.map(I=>xe.jsx(cE,{from:"over",id:I.id,z:lE(I)+s+1},I.id)),T.length&&xe.jsx("group",{position:[dn*i,0,0],children:T.map(I=>xe.jsx(cE,{id:I.id,layers:T,z:lE(I)},I.id))}),k.length&&xe.jsx("group",{position:[dn*-i,0,0],children:k.map(I=>xe.jsx(cE,{id:I.id,layers:k,z:lE(I)},I.id))}),R.length&&xe.jsx("group",{position:[0,_r*-s,0],children:R.map(I=>xe.jsx(cE,{id:I.id,layers:R,z:lE(I)},I.id))}),P.length&&xe.jsx("group",{position:[0,_r*s,0],children:P.map(I=>xe.jsx(cE,{id:I.id,layers:P,z:lE(I)},I.id))})]})})})})})]}),xe.jsx("group",{ref:h,children:y.map((I,L)=>xe.jsx(nb,{from:"under",id:I.id,z:L*2},I.id))})]})}const aGe=Cb(Ob),cGe=Mb(kb);function lGe(){const n=Jr(e=>e.gadget.id);return Qe.useEffect(()=>{const e=Jr.getState().gadget.layers??[];let t=aGe,r=cGe,i;const s=za.getState();for(let o=0;e&&o<e.length;++o){const a=e[o];if(a.type===es.MEDIA)switch(a.mime){case"image/palette":Xn(a.media)&&(t=_I(Kw,Spe,a.media));break;case"image/charset":Xn(a.media)&&(r=_I(Fa*ja,u7*Oc,a.media));break;case"image/altcharset":Xn(a.media)&&(i=_I(Fa*ja,u7*Oc,a.media));break;case"text/mood":rn(a.media)&&s.setmood(a.media);break;case"text/players":rn(a.media);break}s.setpalette(t),s.setcharset(r),s.setaltcharset(i)}},[n]),null}function ew({id:n,z:e,from:t,layers:r}){const i=Jr(Uc(a=>{if(fe(t))return a.gadget[t]?.find(c=>c.id===n);if(fe(r))return r.find(c=>c.id===n)})),s=An.DRAW_CHAR_WIDTH(),o=An.DRAW_CHAR_HEIGHT();switch(i?.type){default:case es.BLANK:case es.MEDIA:return null;case es.TILES:{const a=W8(i.char,i.color,i.bg,i.stats),c=q8(i.char,i.color,i.bg,i.stats),l=Y8(i.char,i.color,i.bg,i.stats);return xe.jsxs("group",{position:[0,0,e],children:[xe.jsx(yp,{width:i.width,height:i.height,char:a.char,color:a.color,bg:a.bg}),xe.jsx("group",{"position-z":o*-.25,children:xe.jsx(yp,{width:i.width,height:i.height,char:l.char,color:l.color,bg:l.bg})}),xe.jsx("group",{"position-z":o*.25,children:xe.jsx(yp,{width:i.width,height:i.height,char:c.char,color:c.color,bg:c.bg})})]},i.id)}case es.SPRITES:{const a=fe(r),c=i.sprites.filter(h=>h.stat!==kn.ISSWIM&&(!a||!h.pid)),l=i.sprites.filter(h=>h.stat===kn.ISSWIM&&(!a||!h.pid)),u=c.filter(h=>h.stat!==kn.ISGHOST);return xe.jsxs("group",{position:[0,0,e],children:[xe.jsx(X8,{sprites:u,limit:f0,children:(h,f)=>[h*s,(f+.5)*o,o*-.5+.5]}),xe.jsx(IA,{sprites:c,withbillboards:!0}),xe.jsx("group",{"position-z":o*-.5,children:xe.jsx(IA,{sprites:l,withbillboards:!0})})]},i.id)}case es.DITHER:return xe.jsx("group",{position:[0,0,e+1],children:xe.jsx(K8,{alphas:i.alphas,width:dn})})}}function uE(n){switch(n.type){case es.TILES:return 0;case es.DITHER:return An.DRAW_CHAR_HEIGHT()+1;case es.SPRITES:return An.DRAW_CHAR_HEIGHT()*.5}return 0}function uGe(n){switch(n){case Ic.NEAR:return-128;default:case Ic.MID:return 128;case Ic.FAR:return 512}}function hGe(n){switch(n){case Ic.NEAR:return .888;default:case Ic.MID:return .777;case Ic.FAR:return .444}}function fGe({width:n,height:e}){const{viewport:t}=cl(),r=S_(),i=An.DRAW_CHAR_WIDTH(),s=An.DRAW_CHAR_HEIGHT(),o=n*i,a=e*s,c=dn*i,l=_r*s,u=Qe.useRef(null),h=Qe.useRef(null),f=Qe.useRef(null),d=Qe.useRef(null),p=Qe.useRef(null),[,_]=Qe.useState(!1);Qe.useLayoutEffect(()=>{_(!0)},[]),l_((I,L)=>{if(!u.current||!h.current||!f.current||!d.current||!p.current)return;const M=zx(Jr.getState().gadget.layers??[]),F=.05,Z=Jr.getState().gadget.board;fe(d.current.userData.focusx)||(d.current.userData={focusx:M.focusx,focusy:M.focusy,currentboard:Z});const $=d.current.userData??{},Y=($.focusx+.5)*i,Q=($.focusy+.5)*s;switch(Kv(d.current.position,[0,0,uGe(M.viewscale)],F,L),x4(u.current.rotation,[hGe(M.viewscale),0,0],F,L),Kv(f.current.position,[-Y,-Q,0],F,L),Z!==$.currentboard?($.focusx=M.focusx,$.focusy=M.focusy,$.currentboard=Z,f.current.position.set(-(($.focusx+.5)*i),-(($.focusy+.5)*s),0)):(kl(d.current.userData,"focusx",M.focusx,F),kl(d.current.userData,"focusy",M.focusy,F)),M.viewscale){case Ic.NEAR:p.current.bokehScale=10,p.current.cocMaterial.worldFocusRange=1200,p.current.cocMaterial.worldFocusDistance=350;break;default:case Ic.MID:p.current.bokehScale=10,p.current.cocMaterial.worldFocusRange=1700,p.current.cocMaterial.worldFocusDistance=800;break;case Ic.FAR:p.current.bokehScale=10,p.current.cocMaterial.worldFocusRange=1700,p.current.cocMaterial.worldFocusDistance=1100;break}d.current.rotation.z=Math.PI,d.current.updateProjectionMatrix();const q=Ri(o/c,1,10),V=Ri(a/l,1,10),K=Math.max(q,V),ne=c*K,ie=l*K;h.current.position.x=o-ne,h.current.position.y=a-ie,h.current.scale.setScalar(K)}),Jr(I=>I.gadget.over?.length??0),Jr(I=>I.gadget.under?.length??0),Jr(I=>I.gadget.layers?.length??0);const{gadget:g,gadgetlayercache:m}=Jr.getState(),{over:b=[],under:y=[],layers:x=[]}=g,T=m[g.exiteast]??[],k=m[g.exitwest]??[],R=m[g.exitnorth]??[],P=m[g.exitsouth]??[],B=y.length*2+2,U=t.width*-.5+r.marginx,z=t.height*.5-r.marginy;return xe.jsxs(xe.Fragment,{children:[xe.jsx("perspectiveCamera",{ref:d,near:.1,far:2e3,aspect:-o/a}),xe.jsx("group",{"position-z":B,children:d.current&&xe.jsx(g3,{camera:d.current,viewwidth:o,viewheight:a,effects:xe.jsx(xe.Fragment,{children:xe.jsx(B8,{ref:p})}),children:xe.jsx("group",{position:[U,z,-1e3],children:xe.jsx("group",{ref:u,children:xe.jsxs("group",{ref:f,children:[x.map(I=>xe.jsx(ew,{id:I.id,from:"layers",z:uE(I)},I.id)),b.map(I=>xe.jsx(nb,{from:"over",id:I.id,z:uE(I)+s*1.125},I.id)),T.length&&xe.jsx("group",{position:[dn*i,0,0],children:T.map(I=>xe.jsx(ew,{id:I.id,layers:T,z:uE(I)},I.id))}),k.length&&xe.jsx("group",{position:[dn*-i,0,0],children:k.map(I=>xe.jsx(ew,{id:I.id,layers:k,z:uE(I)},I.id))}),R.length&&xe.jsx("group",{position:[0,_r*-s,0],children:R.map(I=>xe.jsx(ew,{id:I.id,layers:R,z:uE(I)},I.id))}),P.length&&xe.jsx("group",{position:[0,_r*s,0],children:P.map(I=>xe.jsx(ew,{id:I.id,layers:P,z:uE(I)},I.id))})]})})})})}),xe.jsx("group",{ref:h,children:y.map((I,L)=>xe.jsx(nb,{from:"under",id:I.id,z:L*2},I.id))})]})}function dGe({width:n,height:e}){const t=Fb(n,e,0,Bt.WHITE,Bt.ONCLEAR),r=Jr(s=>s.gadget.tickers),i=Qe.useMemo(()=>({...g_(n,e,Bt.WHITE,Bt.BLACK),...t.getState()}),[n,e,t]);if(fe(r)){i.x=0,i.y=e-1,i.disablewrap=!0;const s=t.getState();UO(s,0,Bt.WHITE,Bt.ONCLEAR);for(let o=0;o<r.length;++o){const a=r[o];qr(a,i,!1),i.x=0,i.y--}}return xe.jsx($b,{store:t,children:xe.jsx(Wb,{width:n,height:e})})}function S1(n,e,t){let r=0;t.alt&&(r|=v5),t.ctrl&&(r|=y5),t.shift&&(r|=b5),lu(n)&&NY(Ke,n,e,r)}function pGe({width:n,height:e}){const t=Qr();Jr(Uc(i=>[i.gadget.id,i.gadget.board,i.gadget.layers?.length??0]));const r=Jr(i=>zx(i.gadget.layers??[]).graphics);return xe.jsxs(xe.Fragment,{children:[xe.jsx(bo,{MOVE_LEFT:i=>S1(t,wt.MOVE_LEFT,i),MOVE_RIGHT:i=>S1(t,wt.MOVE_RIGHT,i),MOVE_UP:i=>S1(t,wt.MOVE_UP,i),MOVE_DOWN:i=>S1(t,wt.MOVE_DOWN,i),OK_BUTTON:i=>S1(t,wt.OK_BUTTON,i),CANCEL_BUTTON:i=>S1(t,wt.CANCEL_BUTTON,i),MENU_BUTTON:i=>S1(t,wt.MENU_BUTTON,i),keydown:i=>{const s=Jn(i.key),o=fR(i),a=Qr();switch(s){case"c":e6(Ke,a,"");break;case"@":case"2":lb(Ke,a,"@");break;case"#":case"3":lb(Ke,a,"#");break;case"p":o.ctrl&&r6(Ke,a);break;case"a":o.ctrl&&REe(Ke,a);break}}}),xe.jsx(lGe,{}),r==="flat"&&xe.jsx($Ve,{width:n,height:e}),r==="mode7"&&xe.jsx(fGe,{width:n,height:e}),r==="iso"&&xe.jsx(oGe,{width:n,height:e}),r==="fpv"&&xe.jsx(iGe,{width:n,height:e}),xe.jsx("group",{"position-z":512,children:xe.jsx(dGe,{width:Math.floor(n),height:Math.floor(e)})})]})}function RG({rect:n,shouldclose:e=!1}){switch(n.type){case 0:return xe.jsx("group",{"position-z":512,children:xe.jsx(hre,{width:n.width,height:n.height,color:14,bg:1,text:n.text,ymargin:0})});case 1:return xe.jsx(PVe,{width:n.width,height:n.height,color:14,bg:1,text:n.text,shouldclose:e});case 2:return xe.jsx(pGe,{width:n.width,height:n.height})}return null}const hE=20;function mGe(){const n=S_(),{islandscape:e,sidebaropen:t,showtouchcontrols:r}=Sd(),i=Jr(bH(d=>d.gadget.scroll??[])),s=i.length===0,[o,a]=Qe.useState(!1),c=Jr(bH(d=>d.gadget.sidebar??[]));if(n.cols<10||n.rows<10)return null;const l={name:"main",type:2,x:0,y:0,text:[],width:n.cols,height:n.rows},u=[];if(c.length)if(r)if(e){const d=t?hE+5:hE,p=t?hE:4,_={name:"sidebar",type:0,x:l.x+l.width-p,y:l.y,width:d,height:l.height,text:c};l.width-=p,u.push(_)}else{const p=t?15:4,_={name:"sidebar",type:0,x:0,y:l.y+l.height-p,width:l.width,height:15,text:c};l.height-=p,u.push(_)}else{const d={name:"sidebar",type:0,x:l.x+l.width-hE,y:l.y,width:hE,height:l.height,text:c};l.width-=hE,u.push(d)}const h={name:"scroll",type:1,x:0,y:0,width:Ri(50,40,l.width-2),height:Ri(20,8,l.height-2),text:i};h.x=l.x+Math.floor((l.width-h.width)*.5),h.y=l.y+Math.floor((l.height-h.height)*.5),!s&&!o&&a(!0),u.unshift(l);const f=Qr();return xe.jsxs(E_.Provider,{value:{sendmessage(d,p){Ke.emit(f,d,p)},sendclose(){WSe(Ke,f)},didclose(){a(!1)}},children:[xe.jsx("group",{position:[-An.DRAW_CHAR_WIDTH(),-An.DRAW_CHAR_HEIGHT(),-524],children:xe.jsx(e0,{visible:!0,color:new gi(.076,.076,0),width:n.cols+2,height:n.rows+2})}),xe.jsx("group",{position:[0,0,-512],children:u.map(d=>xe.jsx("group",{position:[d.x*An.DRAW_CHAR_WIDTH(),d.y*An.DRAW_CHAR_HEIGHT(),0],children:xe.jsx(RG,{rect:d})},d.name))}),o&&xe.jsxs(Tf.Fragment,{children:[xe.jsx("group",{position:[0,0,800],children:xe.jsx($He,{width:n.cols,height:n.rows,alpha:.14})}),xe.jsx("group",{position:[h.x*An.DRAW_CHAR_WIDTH(),h.y*An.DRAW_CHAR_HEIGHT(),900],children:xe.jsx(RG,{rect:h,shouldclose:s})})]},"scroll")]})}const gGe=250,_Ge=249,Rk=Bt.BLUE,vGe=Bt.WHITE,yGe=Bt.DKGRAY,Z8=Bt.BLACK;function uT(n){return n?Bt.ONCLEAR:Bt.DKBLUE}function bGe(n){return Math.round(n*.5)}const gre=Qe.createContext({sendmessage(){}});function Qg(n,e,t,r){const i=Ip(r);r.iseven=r.y%2===0,r.active.bg=n?Z8:r.reset.bg,r.active.leftedge=i.left,r.active.rightedge=i.right,r.active.topedge=i.top,r.active.bottomedge=i.bottom,r.x=r.active.leftedge+e,r.y=r.active.topedge+t}function N1(n,e,t,r,i,s,o,a){const c=Ip(i);i.iseven=i.y%2===0,i.active.color=Bt.WHITE,i.active.bg=i.reset.bg,i.active.leftedge=c.left+s,i.active.rightedge=c.right-s,i.active.topedge=c.top+o,i.active.bottomedge=c.bottom-a,i.x=i.active.leftedge+t,i.y=i.active.topedge+r}function SGe(n){let e=0;return n.split(/\r?\n/).map(r=>{const i=e,s=`${r}
`;return e+=s.length,{start:i,code:s,end:i+r.length}})}function EGe(n){return n.reduce((e,t)=>{const r=t.code.length;return r>e?r:e},0)}function _re(n,e){for(let t=0;t<e.length;++t)if(n<=e[t].end)return t;return e.length-1}function J8({bump:n}){const e=pu(),t=Ip(e),{quickterminal:r}=as(),i=uT(r);if(n&&t.top++,r){for(let s=t.top;s<=t.bottom;++s)for(let o=t.left;o<=t.right;++o)Yo(e,e.width,e.height,o,s,{char:0,color:Rk,bg:i});return null}for(let s=t.top;s<=t.bottom;++s)for(let o=t.left;o<=t.right;++o){let a=0;(o+s)%2===0&&(a=Math.abs(Math.round(Math.cos(o*s*.01)))?gGe:_Ge),Yo(e,e.width,e.height,o,s,{char:a,color:Rk,bg:i})}return null}const HP=Bt.WHITE,Fw=Bt.GREEN,Da=Bt.YELLOW,xGe=Bt.CYAN,bf=Bt.DKGREEN,CG=Bt.DKCYAN,TGe=Bt.GREEN,KC=Bt.DKPURPLE,vre=Bt.WHITE,wGe=Bt.LTGRAY,AGe=Bt.DKGRAY,MG=Bt.DKRED,RGe=Bt.DKRED,VP=Bt.DKYELLOW,CGe={[tA.tokenTypeIdx??0]:HP,[VY.tokenTypeIdx??0]:HP,[GY.tokenTypeIdx??0]:HP,[hb.tokenTypeIdx??0]:KC,[Fg.tokenTypeIdx??0]:Da,[nA.tokenTypeIdx??0]:Fw,[rA.tokenTypeIdx??0]:xGe,[hx.tokenTypeIdx??0]:RGe,[iA.tokenTypeIdx??0]:Da,[a6.tokenTypeIdx??0]:Da,[Ta.tokenTypeIdx??0]:Fw,[Iw.tokenTypeIdx??0]:Fw,[RE.tokenTypeIdx??0]:vre,[c6.tokenTypeIdx??0]:Da,[l6.tokenTypeIdx??0]:Da,[u6.tokenTypeIdx??0]:Da,[h6.tokenTypeIdx??0]:Da,[f6.tokenTypeIdx??0]:Da,[d6.tokenTypeIdx??0]:Da,[IM.tokenTypeIdx??0]:VP,[NM.tokenTypeIdx??0]:VP,[PM.tokenTypeIdx??0]:VP,[DM.tokenTypeIdx??0]:Da,[LM.tokenTypeIdx??0]:Da,[p6.tokenTypeIdx??0]:Da,[m6.tokenTypeIdx??0]:Da,[q1.tokenTypeIdx??0]:Da,[g6.tokenTypeIdx??0]:Da,[_6.tokenTypeIdx??0]:Da,[sA.tokenTypeIdx??0]:Da,[v6.tokenTypeIdx??0]:Da,[y6.tokenTypeIdx??0]:Da,[b6.tokenTypeIdx??0]:TGe,[Y1.tokenTypeIdx??0]:bf,[K1.tokenTypeIdx??0]:CG,[UM.tokenTypeIdx??0]:CG,[X1.tokenTypeIdx??0]:bf,[S6.tokenTypeIdx??0]:bf,[E6.tokenTypeIdx??0]:bf,[x6.tokenTypeIdx??0]:bf,[T6.tokenTypeIdx??0]:bf,[w6.tokenTypeIdx??0]:bf,[A6.tokenTypeIdx??0]:bf};Bt.DKPURPLE;const MGe=Bt.DKYELLOW,kGe=Bt.DKPURPLE,OGe=Bt.CYAN,IGe=Bt.DKCYAN,NGe=Bt.RED,PGe=Bt.WHITE,DGe=Bt.LTGRAY,LGe=Bt.YELLOW,yre=new Map;function lp(n,e){yre.set(n,e)}function kG(n){const e=[];let t=0;for(let r=0;r<n.length;++r){switch(n[r]){case";":t=0;break;case" ":break;default:t===0&&(t=1);break;case"#":t===0&&(t=2);break}switch(t){case 0:e.push(Bt.LTGRAY);break;case 1:e.push(FGe(n[r]));break;case 2:e.push(Bt.CYAN);break}}return e.push(Bt.BLUE),e}function UGe(n){if(n.startsWith("play ")){const e=new Array(5).fill(bf);return e.push(...kG(n.slice(5))),e}else if(n.startsWith("bgplay ")){const e=new Array(7).fill(bf);return e.push(...kG(n.slice(7))),e}return yre.get(n)??Bt.GREEN}const qb=Bt.GREEN,BGe=Bt.DKGREEN,T0=Bt.PURPLE,Yb=Bt.DKCYAN,bre=Bt.CYAN,Sre=Bt.YELLOW,Ere=Bt.DKYELLOW,xre=new Map;function Wi(n,e){xre.set(n,e)}function FGe(n){return xre.get(n)??Bt.GREEN}function jGe(){const n=pu(),e=Ip(n),[t,r,i]=as(Uc(m=>[m.quickterminal,m.editor.type,m.editor.title])),s=Bt.WHITE,o=uT(t);for(let m=e.top;m<e.bottom;++m)Yo(n,n.width,n.height,e.left,m,{char:179,color:s,bg:o}),Yo(n,n.width,n.height,e.right,m,{char:179,color:s,bg:o});N1(!1,!1,0,0,n,0,0,0),qr("$213$205$187",n,!0),N1(!1,!1,n.width-3,0,n,0,0,0),qr("$196$196$191",n,!0);const a="$205".repeat(e.width-2);N1(!1,!1,0,e.height-1,n,0,0,0),qr(`$212${a}$190`,n,!0);const c=Pf(),l="$205".repeat(e.width-4);N1(!1,!1,0,1,n,0,0,0),qr(`$179$${c?"7":"232"}$200${l}$181`,n,!0);const h=` ${`$blue[${r}] `}$green${i}$white `,d=b0(h,e.width,e.height)?.measuredwidth??1,p=e.width-2,_=2+Math.round(p*.5)-Math.round(d*.5);N1(!1,!1,_,1,n,0,0,0),qr(h,n,!0);const g=vb?`shift+${bA}+z`:`${bA}+y`;return xe.jsx(G8,{margin:3,color:Bt.BLUE,y:e.top,leftedge:0,rightedge:e.width-1,line:`
keys: $whiteesc/cancel$green.CLOSE 
$whitetab$green.CHANGE LAYOUT 
$whitehold shift$green.SELECT TEXT 
$whitealt+up/down$green.JUMP 10 LINES 
$whitealt+left/right$green.JUMP 10 COLS 
$white$meta+up/down$green.JUMP TOP/BOTTOM 
$white$meta+left/right$green.JUMP TO START/END OF LINE 
$white$meta+a$green.SELECT ALL 
$white$meta+c$green.COPY 
$white$meta+x$green.CUT 
$white$meta+v$green.PASTE 
$white$meta+z$green.UNDO 
$white${g}$green.REDO 
$white$meta+p$green.RUN SELECTED CODE 
$white$meta+h$green.OPEN HELPSCROLL $blue
    `,context:n})}const OG=32;function zGe({xcursor:n,ycursor:e,xoffset:t,yoffset:r,rows:i,codepage:s}){const o=Pf(),a=pu(),c=ru(),l=Qr(),u=Qe.useRef(void 0),h=Ip(a),f=fe(s)?s.toJSON():"",d=i.length-1,p=n+1-t,_=e+2-r;if(fe(s)){const Y=u.current?.x!==p||u.current?.y!==_;if(o||Y){const Q=h.left+p,q=h.top+_;if(q>h.top+1&&q<h.bottom&&Q>h.left&&Q<h.right){const V=Q+q*a.width;LO(V,"",a),xx(V,V,Bt.WHITE,Bt.DKBLUE,a)}}}u.current={x:p,y:_};const g=i[d].end,m=i[e];let b=c.cursor,y=c.cursor,x=!1;fe(c.select)&&(x=!0,b=Math.min(c.cursor,c.select),y=Math.max(c.cursor,c.select),c.cursor!==c.select&&--y);const T=y-b+1,k=x?f.substring(b,y+1):"";function R(Y){Y?fe(c.select)||ru.setState({select:c.cursor}):ru.setState({select:void 0})}const P=Qe.useCallback(function(Y){ru.setState(Q=>{const q=_re(Y,i),V=Y-i[q].start,K=h.width-8,ne=h.height-4,ie=Math.round(K*.5),ae=Math.round(ne*.5),Te=Math.round(K*.25),be=Math.abs(V-(Q.xscroll+ie))<Te?Q.xscroll:V-ie,Pe=q-ae,$e=EGe(i),tt=(Math.round($e/OG)+1)*OG,qe=i.length-ne;return{xscroll:Math.round(Ri(be,0,tt)),yscroll:Math.round(Ri(Pe,0,qe))}})},[i,h.width,h.height]),B=Qe.useCallback(function(Y,Q,q){Q>0&&s?.delete(Y,Q),fe(q)&&s?.insert(Y,q);const V=Y+(q??"").length;P(V),ru.setState({cursor:V,select:void 0})},[s,P]),U=Qe.useCallback(function(Y,Q,q){Q>0&&s?.delete(Y,Q),fe(q)&&s?.insert(Y,q);const V=Y+(q??"").length;P(V),ru.setState({cursor:V})},[s,P]);function z(){if(x){const Y=k.split(`
`);for(let Q=0;Q<Y.length;++Q){const q=Y[Q],V=q.trim();V.startsWith("'")?Y[Q]=q.replace(/' ?/,""):V&&(Y[Q]=`' ${q}`)}B(b,T,Y.join(`
`))}}function I(Y=!0){if(x){const Q=k.split(`
`);for(let q=0;q<Q.length;++q){const V=Q[q];Y?Q[q].startsWith(" ")&&(Q[q]=V.substring(1)):Q[q]=` ${V}`}U(b,T,Q.join(`
`))}}function L(){x&&(P(b),ru.setState({cursor:b}),B(b,T))}function M(){P(g),ru.setState({cursor:g,select:void 0})}const F=Qe.useCallback(function(Y){ru.setState(()=>{const Q=Ri(Y,0,g);return P(Q),{cursor:Q}})},[g,P]),Z=Qe.useCallback(function(Y){ru.setState(()=>{let Q=0;const q=Math.round(e+Y);if(q<0)Q=0;else if(q>d)Q=g;else{const V=i[q];Q=V.start+Math.min(n,V.code.length-1)}return P(Q),{cursor:Q}})},[g,i,d,n,e,P]),$=Qe.useMemo(()=>s?new PAe(s):void 0,[s]);return Qe.useEffect(()=>{function Y(q){q.stackItem.meta.set("cursor",c.cursor)}function Q(q){if(q.stackItem.meta.has("cursor")){const V=q.stackItem.meta.get("cursor");P(V),ru.setState({cursor:V})}}return $?.on("stack-item-added",Y),$?.on("stack-item-popped",Q),()=>{$?.off("stack-item-added",Y),$?.off("stack-item-popped",Q)}},[$,c.cursor,P]),xe.jsxs(xe.Fragment,{children:[xe.jsx(V8,{blocking:!0,x:h.left,y:h.top,width:h.width,height:h.height,onClick:()=>{document.getElementById("touchtext")?.focus()},onScroll:Y=>Z(Y*.75)}),xe.jsx(bo,{MOVE_LEFT:Y=>{R(Y.shift),Y.ctrl?F(m.start):F(c.cursor-(Y.alt?10:1))},MOVE_RIGHT:Y=>{R(Y.shift),Y.ctrl?F(m.end):F(c.cursor+(Y.alt?10:1))},MOVE_UP:Y=>{R(Y.shift),Y.ctrl?F(0):Z(Y.alt?-10:-1)},MOVE_DOWN:Y=>{R(Y.shift),Y.ctrl?F(g):Z(Y.alt?10:1)},OK_BUTTON:()=>{if(fe(s)){s.insert(c.cursor,`
`);const Y=c.cursor+1;P(Y),ru.setState({cursor:Y})}},CANCEL_BUTTON:Y=>{Y.shift||Y.alt||Y.ctrl?Ow(Ke,l):mEe(Ke,l)},MENU_BUTTON:Y=>{CY(Ke,l,!Y.shift)},keydown:Y=>{if(!fe(s))return;const{key:Q}=Y,q=Jn(Q),V=fR(Y);switch(q){case"delete":x?L():B(c.cursor,1);break;case"backspace":x?L():f.length>0&&B(Math.max(c.cursor-1,0),1);break;default:if(V.ctrl)switch(q){case"z":vb&&V.shift?$?.redo():$?.undo();break;case"y":vb||$?.redo();break;case"a":P(g),ru.setState({cursor:g,select:0});break;case"c":fe(ya())?ya().writeText(k).catch(K=>ur(Ke,l,"clipboard",K)):M();break;case"v":fe(ya())?ya().readText().then(K=>{const ne=K.replaceAll("\r","");x?B(b,T,ne):B(c.cursor,0,ne)}).catch(K=>ur(Ke,l,"clipboard",K)):M();break;case"x":fe(ya())&&x?ya().writeText(k).then(()=>L()).catch(K=>ur(Ke,l,"clipboard",K)):M();break;case"p":x?($m(Ke,l,k),Qi(Ke,l,`running $WHITE${k.substring(0,16)}...$BLUE`)):($m(Ke,l,m.code),Qi(Ke,l,`running $WHITE${m.code.substring(0,16)}...$BLUE`));break;case"'":z();break}else if(!V.alt){if(Y.key.length===1)if(x)Y.key==="'"?z():Y.key===" "?I(Y.shiftKey):B(b,T,Y.key);else{const K=c.cursor+Y.key.length;s.insert(c.cursor,Y.key),P(K),ru.setState({cursor:K})}}break}}})]})}function IG(n){const[e]=n.substring(1).split(";");return e.split(" ")}let XC;function up(n){const e=aPe(xQ(n));Object.keys(e).filter(r=>!!r).length?XC=e:console.error(n)}function HGe({ycursor:n,xoffset:e,yoffset:t,rows:r,codepage:i}){const s=Pf(),o=pu(),a=ru(),{quickterminal:c}=as(),l=Qe.useMemo(()=>{if(r.length){const g=r[r.length-1];return[...r,{code:"",start:g.end+1,end:g.end+1}]}return[]},[r]);if(!fe(i)){const g=(s?"|":"-").repeat(3);return N1(!1,!1,0,0,o,1,2,1),qr(` ${g} LOADING ${g}`,o,!0),null}const u=o.width-2,h=Ip(o);h.right=u-1;let f=a.cursor,d=a.cursor,p=!1;fe(a.select)&&(p=!0,f=Math.min(a.cursor,a.select),d=Math.max(a.cursor,a.select),a.cursor!==a.select&&--d);const _=h.left+1-4;N1(!1,!1,-e,-t,o,1,2,1);for(let g=0;g<l.length;++g){if(o.y<=h.top+1){++o.y;continue}const m=l[g],b=l[g-1],y=g===n,x=g-1===n,T=m.code.replaceAll(`
`,""),k=_-e;o.x=k,o.iseven=o.y%2===0,o.active.color=Bt.WHITE,o.active.bg=y?Z8:uT(c),o.disablewrap=!0,o.active.rightedge=u;const R=`${g+1}`.padStart(3," ");i4(`${g<r.length?R:"   "} ${T} `,o,!1);const P=1+o.y*o.width;ad(P,h.right,-e-4,-e,wGe,o.active.bg,o),$T(P,h.right,-e+20,-e+20,Bt.DKCYAN,o),$T(P,h.right,-e+36,-e+36,Bt.DKCYAN,o),$T(P,h.right,-e+46,-e+46,Bt.DKCYAN,o);let B=-1;const U=Ri(a.cursor-m.start,1,m.end-m.start);if(fe(m.tokens))for(let I=0;I<m.tokens.length;++I){const L=m.tokens[I];y&&U>=(L.startColumn??1)&&U<=(L.endColumn??1)&&(B=I);const M=(L.startColumn??1)-1-e,F=(L.endColumn??1)-1-e,Z=CGe[L.tokenTypeIdx];if(fe(Z))switch(Z){case KC:{const $=IG(L.image);switch(IL("",$,!!L.payload).type){case Pn.BOARD:case Pn.LOADER:case Pn.OBJECT:case Pn.TERRAIN:case Pn.CHARSET:case Pn.PALETTE:{ad(P,h.right,M,F,KC,o.active.bg,o);break}case Pn.CONST:case Pn.RANGE:case Pn.SELECT:case Pn.NUMBER:case Pn.TEXT:case Pn.HOTKEY:case Pn.COPYIT:case Pn.OPENIT:case Pn.ZSSEDIT:case Pn.CHAREDIT:case Pn.COLOREDIT:{const[Q]=$;ad(P,h.right,M,M+Q.length,KC,o.active.bg,o),$.length>1&&ad(P,h.right,M+Q.length+1,F,vre,o.active.bg,o);break}default:ad(P,h.right,M,F,Bt.DKRED,o.active.bg,o);break}break}case Da:{ad(P,h.right,M,M,Z,o.active.bg,o),M!==F&&ad(P,h.right,M+1,F,Fw,o.active.bg,o);break}case Fw:{const $=UGe(L.image);if(Xn($))for(let Y=0;Y<$.length;++Y)ad(P,h.right,M+Y,F+Y,$[Y],o.active.bg,o);else ad(P,h.right,M,F,$,o.active.bg,o);break}default:ad(P,h.right,M,F,Z,o.active.bg,o);break}}if(p&&m.start<=d&&m.end>=f){const I=Math.max(m.start,f)-m.start-e,L=Math.min(m.end,d)-m.start-e,M=h.width-3,F=Math.max(0,I),Z=Math.min(M,L);F<=M&&Z>=_&&ad(P,h.right,F,Z,vGe,yGe,o)}if(y&&fe(m.tokens)){let I;if(fe(m.asts)){for(let L=0;L<(m.asts?.length??0);++L)m.asts[L].type===Mn.IF&&(I=m.asts[L]);fe(I)||(I=m.asts.find(L=>U<=(L.endColumn??0)))}XC=void 0;for(let L=B;L>=0;--L){const M=m.tokens[L-1],F=m.tokens[L],Z=m.tokens[L+1];switch(F.tokenTypeIdx){case Fg.tokenTypeIdx:case K1.tokenTypeIdx:case Y1.tokenTypeIdx:case X1.tokenTypeIdx:case hb.tokenTypeIdx:case hx.tokenTypeIdx:case rA.tokenTypeIdx:case iA.tokenTypeIdx:case sA.tokenTypeIdx:case q1.tokenTypeIdx:case nA.tokenTypeIdx:if(F.tokenTypeIdx===q1.tokenTypeIdx&&(!fe(I)||F.startColumn!==I.startColumn))continue;break;default:continue}switch(F.tokenTypeIdx){case Fg.tokenTypeIdx:{up(`editor:command:${Z.image}`);break}case K1.tokenTypeIdx:{up("editor:command:do");break}case Y1.tokenTypeIdx:{up(M.tokenTypeIdx===X1.tokenTypeIdx?"editor:command:elseif":"editor:command:if");break}case X1.tokenTypeIdx:{up(Z.tokenTypeIdx===Y1.tokenTypeIdx?"editor:command:elseif":"editor:command:else");break}case hb.tokenTypeIdx:{const $=IG(F.image),Y=IL("",$,!!F.payload);up(`editor:stat:${Ev(Y.type)}`);break}case hx.tokenTypeIdx:{up("editor:label");break}case rA.tokenTypeIdx:{up("editor:comment");break}case iA.tokenTypeIdx:{up("editor:hyperlink");break}case sA.tokenTypeIdx:{up("editor:shorttry");break}case q1.tokenTypeIdx:{up("editor:shortgo");break}case nA.tokenTypeIdx:{up("editor:text");break}}break}rn(XC?.desc)&&qr(XC.desc,o,!1)}const[z]=m.errors??[];if(x&&fe(b.errors)){o.x=k;const[I]=b.errors,L=`${I.message}`.replaceAll(`
`," ");i4(L,o,!1),ad(P,h.right,0,L.length-1,Bt.WHITE,MG,o)}else if(fe(z)){const I=3+(z.column??1),L=z.length??1;$T(P,h.right,0,2,MG,o),$T(P,h.right,I,I+L-1,AGe,o)}if(++o.y,o.y>=h.bottom)break}return o.disablewrap=!1,o.active.rightedge=o.width,null}function GP(n){switch(n){case"stat":case"text":case"hyperlink":return!1;default:return!0}}Wi("a",qb);Wi("b",qb);Wi("c",qb);Wi("d",qb);Wi("e",qb);Wi("f",qb);Wi("g",qb);Wi("x",BGe);Wi("#",Ere);Wi("!",Ere);Wi("y",Yb);Wi("t",Yb);Wi("s",Yb);Wi("i",Yb);Wi("q",Yb);Wi("h",Yb);Wi("w",Yb);Wi("3",bre);Wi(".",bre);Wi("+",Sre);Wi("-",Sre);Wi("0",T0);Wi("1",T0);Wi("2",T0);Wi("p",T0);Wi("4",T0);Wi("5",T0);Wi("6",T0);Wi("7",T0);Wi("8",T0);Wi("9",T0);Wi(";",Da);function NG(){const n=Qr(),[e]=as(Uc(T=>[T.editor])),[t,r,i,s,o,a,c,l,u,h,f]=Jr(Uc(T=>[T.zsswords.cli,T.zsswords.loader,T.zsswords.runtime,T.zsswords.flags,T.zsswords.stats,T.zsswords.kinds,T.zsswords.altkinds,T.zsswords.colors,T.zsswords.dirs,T.zsswords.dirmods,T.zsswords.exprs]));Qe.useEffect(()=>{t.filter(GP).forEach(T=>lp(T,bf)),r.filter(GP).forEach(T=>lp(T,bf)),i.filter(GP).forEach(T=>lp(T,bf)),s.forEach(T=>lp(T,MGe)),o.forEach(T=>lp(T,kGe)),a.forEach(T=>lp(T,OGe)),c.forEach(T=>lp(T,IGe)),l.forEach(T=>lp(T,NGe)),u.forEach(T=>lp(T,PGe)),h.forEach(T=>lp(T,DGe)),f.forEach(T=>lp(T,LGe))},[t,r,i,s,o,a,c,l,u,h,f]);const d=ru(),p=oQ(PY(e.book,e.path));Qe.useEffect(()=>(CEe(Ke,n,e.book,e.path),()=>{MEe(Ke,n,e.book,e.path)}),[e.book,e.path,n]);const _=fe(p)?p.toJSON():"",g=SGe(_),m=_re(d.cursor,g),b=d.cursor-g[m].start,y=BZ(_);if(fe(y.tokens)){let T=!0;for(let k=0;k<y.tokens.length;++k){const R=y.tokens[k];R.tokenTypeIdx===hb.tokenTypeIdx&&(R.payload=T,T=!1);const P=g[(R.startLine??1)-1];fe(P)&&(P.tokens=P.tokens??[],P.tokens.push(R))}}if(y?.ast?.type===Mn.PROGRAM){QZ(y.ast);const T=[];for(let k=1;k<y.ast.lines.length;++k)T.push(y.ast.lines[k]);for(;T.length;){const k=T.pop();if(Xt(k?.type)){switch(k.type){case Mn.LINE:case Mn.IF:if(Xt(k.startLine)){const P=g[k.startLine-1];P.asts=P.asts??[],P.asts.unshift(k)}break}const R=n0(k);for(let P=0;P<R.length;++P){const B=R[P],U=k[B];Xn(U)?T.push(...U):typeof U=="object"&&T.push(U)}}}}if(fe(y.errors))for(let T=0;T<y.errors.length;++T){const k=y.errors[T],R=g[(k.line??1)-1];fe(R)&&(R.errors=R.errors??[],R.errors.push(k))}const x={rows:g,xcursor:b,ycursor:m,codepage:p,xoffset:-4+d.xscroll,yoffset:d.yscroll};return xe.jsxs(xe.Fragment,{children:[xe.jsx(J8,{bump:!0}),xe.jsx(jGe,{}),xe.jsx(HGe,{...x}),xe.jsx(zGe,{...x})]})}function VGe(n,e,t,r){const i=n.slice(0,e),s=n.slice(e+t);return`${i}${r??""}${s}`}function GGe(n){const[e,t]=n.split(":"),r=fe(t);return[r?e:"self",r?t:n]}const $Ge=self.SpeechRecognition??self.webkitSpeechRecognition??self.mozSpeechRecognition??self.msSpeechRecognition??self.oSpeechRecognition;class WGe{recognition;constructor(e,t,r,i=navigator.language){if(!("webkitSpeechRecognition"in window))throw new Error("This browser doesn't support speech recognition. Try Google Chrome.");this.recognition=new $Ge,this.recognition.interimResults=!!r,this.recognition.lang=i;let s="";this.recognition.onresult=o=>{let a="";for(let c=o.resultIndex;c<o.results.length;c+=1){const l=o.results[c][0].transcript;o.results[c].isFinal?(s+=l,e(s),s=""):this.recognition.interimResults&&(a+=l,r(a))}},this.recognition.onend=()=>{t()}}startListening(){this.recognition.start()}stopListening(){this.recognition.stop()}}function qGe({quickterminal:n,voice2text:e,tapeycursor:t,logrowtotalheight:r}){const i=Pf(),s=pu(),o=Ji(),[a]=as(Uc(L=>[L.editor.open])),c=Qr(),l=Ip(s),u=o.buffer[o.bufferindex];let h=o.xcursor,f=o.xcursor,d=!1;fe(o.xselect)&&fe(o.yselect)&&(d=!0,h=Math.min(o.xcursor,o.xselect),f=Math.max(o.xcursor,o.xselect),o.xcursor!==o.xselect&&--f);const p=f-h+1,_=o.ycursor===0,g=d?u.substring(h,f+1):u,m=Qe.useCallback((L,M,F)=>{o.bufferindex>0&&Ji.setState({bufferindex:0}),o.buffer[0]=VGe(u,L,M,F),Ji.setState({buffer:o.buffer,xselect:void 0,xcursor:L+(F??"").length})},[u,o.buffer,o.bufferindex]),b=Qe.useCallback(L=>{o.bufferindex>0&&Ji.setState({bufferindex:0}),o.buffer[0]=L,Ji.setState({buffer:o.buffer,xselect:void 0,xcursor:L.length})},[o.buffer,o.bufferindex]),y=l.bottom-l.top-(a?0:2),x=Qe.useCallback(L=>{Ji.setState(M=>{const F=Ri(Math.round(M.ycursor+L),0,r),Z=Ri(F-Math.round(y*.5),0,r-y);return{ycursor:F,scroll:Z}})},[r,y]);function T(L){const M=o.buffer.length-1,F=Ri(L,0,M);Ji.setState({bufferindex:F,scroll:0,xcursor:o.buffer[F].length,ycursor:0,xselect:void 0,yselect:void 0})}function k(L){L?fe(o.xselect)||Ji.setState({xselect:o.xcursor,yselect:o.ycursor}):Ji.setState({xselect:void 0,yselect:void 0})}function R(){fe(o.xselect)&&(Ji.setState({xcursor:h,xselect:void 0,yselect:void 0}),m(h,p))}const P=Qe.useCallback(()=>{Ji.setState({scroll:0,xcursor:u.length,ycursor:0,xselect:void 0,yselect:void 0})},[u.length]);if(s.reset.bg=uT(n),!n){Qg(!1,0,0,s);const L="$DKCYANmain:0.85.21 bug fixes (#603)",M=b0(L,l.width,1);s.x=l.width-(M?.measuredwidth??0)-1,qr(L,s,!0)}const B="$196",z="$205".repeat(l.width-6);Qg(!1,0,l.height-2,s),s.active.color=Bt.WHITE,qr(`  ${B}${z}${B}  `,s,!0);const I=u.padEnd(l.width," ");if(Qg(!1,0,l.height-1,s),s.active.color=Bt.WHITE,i4(I,s,!0),fe(o.xselect)&&fe(o.yselect)&&o.xcursor!==o.xselect){const L=Math.min(o.xcursor,o.xselect),M=Math.min(o.ycursor,o.yselect),F=Math.max(o.xcursor,o.xselect)-1,Z=Math.max(o.ycursor,o.yselect);for(let $=M;$<=Z;++$){const Y=L+(l.bottom-$)*l.width,Q=F+(l.bottom-$)*l.width;xx(Y,Q,15,8,s)}}if(i){const L=l.left+o.xcursor,M=l.top+t;if(M>=l.top&&M<=l.bottom&&L>=l.left&&L<=l.right){const F=L+M*s.width;LO(F,"",s),xx(F,F,Bt.WHITE,s.reset.bg,s)}}return Qe.useEffect(()=>{let L;if(!e||!n)return;const{buffer:M,bufferindex:F}=Ji.getState(),Z=M[F];if(Z!=="")return;function $(q){b(`${Z}${q}`),setTimeout(()=>{const{buffer:V,bufferindex:K}=Ji.getState(),ne=V[K],ie=["",ne,...V.slice(1).filter(ae=>ae!==ne)].filter(ae=>ae.includes("#broadcast")===!1);yH(ie).catch(ae=>ur(Ke,c,"terminalinput",ae.message)),Ji.setState({xcursor:0,bufferindex:0,xselect:void 0,yselect:void 0,buffer:ie}),$m(Ke,c,ne),Ow(Ke,c)},512)}function Y(){}function Q(q){b(`${Z}${q}`)}try{L=new WGe($,Y,Q),L?.startListening()}catch(q){console.error(q.message)}return()=>{L?.stopListening(),L=void 0}},[]),xe.jsxs(xe.Fragment,{children:[xe.jsx(V8,{blocking:!0,x:l.left,y:l.top,width:l.width,height:l.height,onClick:()=>{document.getElementById("touchtext")?.focus()},onScroll:L=>{k(!1),x(-L)}}),xe.jsx(bo,{MOVE_LEFT:L=>{k(L.shift),L.ctrl?Ji.setState({xcursor:0}):Ji.setState({xcursor:Ri(o.xcursor-(L.alt?10:1),0,l.right)})},MOVE_RIGHT:L=>{k(L.shift),L.ctrl?Ji.setState({xcursor:_?u.length:l.right}):Ji.setState({xcursor:Ri(o.xcursor+(L.alt?10:1),0,l.right)})},MOVE_UP:L=>{L.ctrl?T(o.bufferindex+1):(k(L.shift),x(L.alt?10:1))},MOVE_DOWN:L=>{L.ctrl?T(o.bufferindex-1):(k(L.shift),x(-(L.alt?10:1)))},OK_BUTTON:()=>{const L=d?g:u;if(L.length)if(_){const{buffer:M}=Ji.getState(),F=["",L,...M.slice(1).filter(Z=>Z!==L)].filter(Z=>Z.includes("#broadcast")===!1);yH(F).catch(Z=>ur(Ke,c,"terminalinput",Z.message)),Ji.setState({xcursor:0,bufferindex:0,xselect:void 0,yselect:void 0,buffer:F}),$m(Ke,c,L),n&&Ow(Ke,c)}else P()},CANCEL_BUTTON:()=>{Ow(Ke,c)},MENU_BUTTON:L=>{CY(Ke,c,!L.shift)},keydown:L=>{const{key:M}=L,F=Jn(M),Z=fR(L);switch(F){case"delete":_?d?R():u.length>0&&m(o.xcursor,1):P();break;case"backspace":_?d?R():o.xcursor>0&&m(o.xcursor-1,1):P();break;default:if(Z.ctrl)switch(F){case"p":r6(Ke,c);break;case"a":Ji.setState({xselect:0,yselect:0,xcursor:u.length,ycursor:0});break;case"c":_&&fe(ya())?ya().writeText(g).catch($=>console.error($)):P();break;case"v":_&&fe(ya())?ya().readText().then($=>{try{const Q=JSON.parse($);if(rn(Q.exported)&&fe(Q.data)){Uh(Ke,c,void 0,"json",`file:${Q.exported}`,JSON.stringify(Q));return}}catch(Q){console.error(Q)}const Y=$.replaceAll("\r","");d?m(h,p,Y):m(o.xcursor,0,Y)}).catch($=>console.error($)):P();break;case"x":_&&fe(ya())?ya().writeText(g).then(()=>R()).catch($=>console.error($)):P();break}else Z.alt||L.key.length===1&&(_&&o.xcursor<=u.length?d?(m(h,p,L.key),Ji.setState({xselect:void 0})):m(o.xcursor,0,L.key):P());break}}})]})}function YGe({active:n,prefix:e,label:t,words:r,y:i}){const s=pu(),o=Qe.useCallback(()=>{const[,...c]=r;ux(Ke,Qr(),c.join(" "))},[r]),a=_u(!!n);return Qg(!!n,0,i,s),qr(`${e} $purple$16 $yellowCOPYIT ${a}${t}`,s,!0),n&&xe.jsx(bo,{OK_BUTTON:o})}function KGe({active:n,prefix:e,label:t,words:r,y:i}){const s=pu(),o=Qe.useContext(gre),a=Qe.useCallback(()=>{const[l,...u]=r;setTimeout(()=>{o.sendmessage(l,u)},100)},[r,o]),c=_u(!!n);return Qg(!!n,0,i,s),qr(`${e} $purple$16 ${c}${t}`,s,!0),n&&xe.jsx(bo,{OK_BUTTON:a})}function XGe({active:n,prefix:e,label:t,words:r,y:i}){const s=pu(),o=Qe.useCallback(()=>{const[,c,...l]=r,u=l.join(" "),h=Qr();setTimeout(()=>{switch(c){case"wiki":to(Ke,h,async()=>{const f=await gU(u);AU(h,f)});break;case"inline":window.location.href=u;break;default:window.open(`${c} ${u}`.trim(),"_blank");break}},100)},[r]),a=_u(!!n);return Qg(!!n,0,i,s),qr(`${e} $purple$16 $yellowOPENIT ${a}${t}`,s,!0),n&&xe.jsx(bo,{OK_BUTTON:o})}function ZGe({active:n,prefix:e,label:t,words:r,y:i}){const s=pu(),o=Qe.useCallback(()=>{const[,...c]=r;lb(Ke,Qr(),c.join(" "))},[r]),a=_u(!!n);return Qg(!!n,0,i,s),qr(`${e} $purple$16 $CYANRUNIT ${a}${t}`,s,!0),n&&xe.jsx(bo,{OK_BUTTON:o})}function JGe({active:n,prefix:e,label:t,words:r,y:i}){const s=pu(),{setviewimage:o}=za(),a=Qe.useCallback(()=>{const[,...l]=r,u=l.join(" ");setTimeout(()=>o(u),100)},[o,r]),c=_u(!!n);return Qg(!!n,0,i,s),qr(`${e} $purple$16 $CYANVIEWIT ${c}${t}`,s,!0),n&&xe.jsx(bo,{OK_BUTTON:a})}function Tre({active:n,text:e,y:t}){const r=pu(),{quickterminal:i}=as(),s=Ip(r),o=e.startsWith("!");Qg(!!n,0,t,r),r.reset.bg=n?Z8:uT(i),r.active.bottomedge=s.bottom;const a=hU(e);if(fe(a)){const c=s.width-3,u=b0(a,c,3)?.measuredwidth??1,h=Ri(Math.floor(c*.5-u*.5),0,c);qr(`${" ".repeat(h)}$WHITE${a}`,r,!0)}else qr(o?"":e,r,!0);if(o){const[c,...l]=e.slice(1).split("!"),u=`${l.join("!")}`;let h="PRESS ME";const f=[],d=Xx(u,!0);for(let m=0;m<d.tokens.length;m++){const b=d.tokens[m];switch(b.tokenType){case DO:h=b.image.slice(1);break;default:f.push(b.image);break}}const[p,..._]=f,g={active:n,prefix:c,label:h,words:_,y:t};switch(Jn(p)){case"copyit":return xe.jsx(YGe,{...g,words:f});case"openit":return xe.jsx(XGe,{...g,words:f});case"viewit":return xe.jsx(JGe,{...g,words:f});case"runit":return xe.jsx(ZGe,{...g,words:f});default:case"hyperlink":return xe.jsx(KGe,{...g,words:f});case"hk":case"hotkey":return null;case"rn":case"range":return null;case"sl":case"select":return null;case"nm":case"number":return null;case"tx":case"text":return null;case"zssedit":return null;case"charedit":return null;case"coloredit":return null}}return null}function QGe({active:n,text:e,y:t}){return Pf(),xe.jsx(Tre,{active:n,text:e,y:t})}function e$e(n,e,t){return n.startsWith("!")?1:b0(n,e,t)?.y??1}function t$e(){const[n]=as(Uc(f=>[f.editor.open])),e=as(Uc(f=>f.terminal.logs)),t=pu(),r=Ji(),i=Ip(t),s=t.width-1,o=e.map(f=>e$e(f,s,i.height)),a=i.bottom-i.top-(n?0:2);let c=a+1;const l=o.map(f=>(c-=f,c)),u=i.bottom-r.ycursor+r.scroll,h=e.map((f,d)=>{const p=l[d]+r.scroll,_=o[d],g=p+_;return g<0||p<0||p>a?null:[d,f,p,!n&&u>=p&&u<g]}).filter(f=>f!==null);return xe.jsx(xe.Fragment,{children:xe.jsx(uR.Provider,{value:t,children:h.map(([f,d,p,_])=>_?xe.jsx(QGe,{active:!0,text:d,y:p},f):xe.jsx(Tre,{text:d,y:p},f))})})}function n$e(n,e,t){return n.startsWith("!")?1:b0(n,e,t)?.y??1}function PG(){const n=Qr(),{quickterminal:e}=as(),[t]=as(Uc(d=>[d.editor.open])),r=as(Uc(d=>d.terminal.logs)),[i,s]=Qe.useState(void 0);Qe.useLayoutEffect(()=>{to(Ke,Qr(),async()=>{const d=await HC("voice2text");s(d==="on")})},[]);const o=pu(),a=Ji(),c=Ip(o),l=o.width-1,u=r.map(d=>n$e(d,l,c.height));let h=0;u.forEach(d=>{h+=d}),++h;const f=c.bottom-a.ycursor+a.scroll;return xe.jsxs(xe.Fragment,{children:[xe.jsx(J8,{}),xe.jsxs(gre.Provider,{value:{sendmessage(d,p){const[_,g]=GGe(d);if(_==="self"){const m=`#${g} ${p.join(" ")}`;$m(Ke,n,m)}else Ke.emit(n,`${_}:${g}`,p)}},children:[xe.jsx(t$e,{}),!t&&i!==void 0&&xe.jsx(qGe,{quickterminal:e,voice2text:i,tapeycursor:f,logrowtotalheight:h})]})]})}function iC({quickterminal:n,top:e,left:t,width:r,height:i,children:s}){const o=uT(n),a=Fb(r,i,0,Rk,o),c=Qe.useMemo(()=>({...g_(r,i,Rk,o),...a.getState()}),[o,r,i,a]);return xe.jsxs($b,{store:a,children:[xe.jsxs(uR.Provider,{value:c,children:[xe.jsx(J8,{}),s]}),xe.jsx("group",{position:[t*An.DRAW_CHAR_WIDTH(),e*An.DRAW_CHAR_HEIGHT(),0],children:xe.jsx(Wb,{width:r,height:i})})]})}function r$e({quickterminal:n,top:e,width:t,height:r}){const[i,s]=as(Uc(o=>[o.layout,o.editor.open]));if(s)switch(i){case vd.SPLIT_X:{const o=bGe(t);return xe.jsxs(Qe.Fragment,{children:[xe.jsx(iC,{quickterminal:n,top:e,left:0,width:o,height:r,children:xe.jsx(NG,{})}),xe.jsx(iC,{quickterminal:n,top:e,left:o,width:t-o,height:r,children:xe.jsx(PG,{})})]},"layout")}default:return xe.jsx(iC,{quickterminal:n,top:e,left:0,width:t,height:r,children:xe.jsx(NG,{})},"layout")}return xe.jsx(iC,{quickterminal:n,top:e,left:0,width:t,height:r,children:xe.jsx(PG,{})},"layout")}function i$e(){const n=S_(),[e,t,r,i]=as(Uc(l=>[l.layout,l.quickterminal,l.terminal.open,l.editor.open]));let s=0,o=n.rows;switch(e){case vd.TOP:o=Math.floor(n.rows*.5);break;case vd.BOTTOM:o=Math.ceil(n.rows*.5),s=n.rows-o;break;default:case vd.FULL:break}if(n.cols<10||n.rows<10)return null;const a=Qr(),c=t||r||i;return xe.jsxs(xe.Fragment,{children:[c&&xe.jsx(m3,{width:n.cols,height:n.rows,top:s,left:0,right:n.cols-1,bottom:s+o-1,alpha:t?.666:.333}),c?xe.jsx(iy,{blockhotkeys:!0,children:xe.jsx(r$e,{quickterminal:t,top:s,width:n.cols,height:o})}):xe.jsxs(xe.Fragment,{children:[xe.jsx(tb,{hotkey:"Shift+?",althotkey:"/",children:()=>lb(Ke,a)}),xe.jsx(tb,{hotkey:"`",children:()=>lb(Ke,a)})]})]})}const s$e=`
// CRT Emulation
// by Mattias

vec3 sample_(sampler2D tex, vec2 tc) {
	vec3 s = pow(texture2D(tex, tc).rgb, vec3(2.0));
	return s;
}

vec3 blur(sampler2D tex, vec2 tc, float offs) {
	vec4 xoffs = offs * vec4(-2.0, -1.0, 1.0, 2.0) * texelSize.x * 0.01;
	vec4 yoffs = offs * vec4(-2.0, -1.0, 1.0, 2.0) * texelSize.y * 0.001;
	
	vec3 color = vec3(0.0, 0.0, 0.0);
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.x)) * 0.00366;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.x)) * 0.01465;
	color += sample_(tex, tc + vec2(    0.0, yoffs.x)) * 0.02564;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.x)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.x)) * 0.00366;
	
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.y)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.y)) * 0.05861;
	color += sample_(tex, tc + vec2(    0.0, yoffs.y)) * 0.09524;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.y)) * 0.05861;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.y)) * 0.01465;
	
	color += sample_(tex, tc + vec2(xoffs.x, 0.0)) * 0.02564;
	color += sample_(tex, tc + vec2(xoffs.y, 0.0)) * 0.09524;
	color += sample_(tex, tc + vec2(    0.0, 0.0)) * 0.15018;
	color += sample_(tex, tc + vec2(xoffs.z, 0.0)) * 0.09524;
	color += sample_(tex, tc + vec2(xoffs.w, 0.0)) * 0.02564;
	
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.z)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.z)) * 0.05861;
	color += sample_(tex, tc + vec2(    0.0, yoffs.z)) * 0.09524;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.z)) * 0.05861;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.z)) * 0.01465;
	
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.w)) * 0.00366;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.w)) * 0.01465;
	color += sample_(tex, tc + vec2(    0.0, yoffs.w)) * 0.02564;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.w)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.w)) * 0.00366;

	return color;
}

float rand(vec2 co) {
  float a = 12.9898;
  float b = 78.233;
  float c = 43758.5453;
  float dt = dot(co.xy, vec2(a, b));
  float sn = mod(dt, 3.14);
  return fract(sin(sn) * c);
}

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
  vec3 col;  
  col.r = 1.0 * blur(inputBuffer, vec2(uv.x + 0.0009, uv.y + 0.0009), 1.2).x + 0.005;
  col.g = 1.0 * blur(inputBuffer, vec2(uv.x + 0.000, uv.y - 0.0015), 1.2).y + 0.005;
  col.b = 1.0 * blur(inputBuffer, vec2(uv.x - 0.0015, uv.y + 0.000), 1.2).z + 0.005;  

  col.r += 0.2 * blur(inputBuffer, vec2(uv.x + 0.0009, uv.y + 0.0009), 2.25).x - 0.005;
  col.g += 0.2 * blur(inputBuffer, vec2(uv.x + 0.000, uv.y - 0.0015), 1.75).y - 0.005;
  col.b += 0.2 * blur(inputBuffer, vec2(uv.x - 0.0015, uv.y + 0.000), 1.25).z - 0.005;
  
  float ghs = 0.05;
	float gphase = 0.371 * sin(time * 0.1);
	col.r += ghs * (1.0 - 0.299) * blur(inputBuffer, gphase * vec2(0.01, -0.027) + vec2(uv.x + 0.001, uv.y + 0.001), 7.0).x;
  col.g += ghs * (1.0 - 0.587) * blur(inputBuffer, gphase * vec2(-0.022, -0.02) + vec2(uv.x + 0.000, uv.y - 0.002), 5.0).y;
  col.b += ghs * (1.0 - 0.114) * blur(inputBuffer, gphase * vec2(-0.02, -0.0) + vec2(uv.x - 0.002, uv.y + 0.000), 3.0).z;

  col = clamp(col * 0.4 + 0.6 * col * 1.0, 0.0, 1.0);
	col = mix(col, col * col * col * col * col * col, 0.5) * 3.8;

	float scans = clamp(0.35 + 0.15 * sin(3.5 * (time * 0.125) + uv.y * resolution.y * 1.5), 0.0, 1.0);
	float s = pow(scans, 0.999);
	col = col * vec3(s);

  col *= 1.0 + 0.0015 * sin(500.0 * time);
  col *= 1.0 - 0.15 * vec3(clamp((mod(uv.x * texelSize.x, 2.0) - 1.0) * 2.0, 0.0, 1.0));
	
  col *= vec3(1.0) - 0.25 * vec3(
   rand(uv + 0.0001 * time), 
   rand(uv + 0.0001 * time + 0.3), 
   rand(uv + 0.0001 * time + 0.5));
	col = pow(col, vec3(0.45));

  outputColor = vec4(col.rgb, 1.0);
}
`;class o$e extends Id{constructor(){super("ScanlinesEffect",s$e,{blendFunction:ui.NORMAL,attributes:Fu.CONVOLUTION,defines:new Map([]),uniforms:new Map([])})}update(){}}const a$e=cT(o$e),DG=n=>(n.getAttributes()&Fu.CONVOLUTION)===Fu.CONVOLUTION,c$e=Qe.memo(Qe.forwardRef(({children:n,width:e,height:t},r)=>{const{gl:i,scene:s,camera:o}=cl(),[a]=Qe.useMemo(()=>{const u=new Jne(i,{depthBuffer:!0,stencilBuffer:!1,multisampling:0,frameBufferType:Jv});return u.addPass(new ere(s,o)),[u]},[o,i,s]);l_((u,h)=>{const f=i.autoClear;i.autoClear=!0,a.setSize(e,t),a.render(h),i.autoClear=f},2);const c=Qe.useRef(null);Qe.useLayoutEffect(()=>{const u=[],h=c.current.__r3f;if(h&&a){const f=h.children;for(let d=0;d<f.length;d++){const p=f[d].object;if(p instanceof Id){const _=[p];if(!DG(p)){let m=null;for(;(m=f[d+1]?.object)instanceof Id&&!DG(m);)_.push(m),d++}const g=new tre(o,..._);u.push(g)}else p instanceof qh&&u.push(p)}for(const d of u)a?.addPass(d)}return()=>{for(const f of u)a?.removePass(f)}},[a,n,o]);const l=Qe.useMemo(()=>({composer:a,normalPass:null,downSamplingPass:null,resolutionScale:void 0,camera:o,scene:s}),[a,o,s]);return Qe.useImperativeHandle(r,()=>a,[a]),xe.jsx(U8.Provider,{value:l,children:xe.jsx("group",{ref:c,children:n})})}));function l$e({context:n}){return xe.jsx("group",{position:[0,0,999],children:xe.jsx(Wb,{width:n.width,height:n.height})})}function LG({toast:n}){const e=S_(),t=Fb(e.cols,1,0,Bt.GREEN,Bt.ONCLEAR),r={...g_(e.cols,1,Bt.GREEN,Bt.ONCLEAR,0,0,e.cols-1,1),...t.getState()};if(e.cols<10||e.rows<10)return null;const i=e.cols-1;return xe.jsx($b,{store:t,children:n&&xe.jsxs(xe.Fragment,{children:[xe.jsx(G8,{margin:1,color:Bt.YELLOW,y:0,leftedge:0,rightedge:i,line:`${n}$32$19$32`,context:r}),xe.jsx("group",{position:[0,0,998],children:xe.jsx(m3,{alpha:.4,width:e.cols,height:10,top:0,left:0,right:i,bottom:0})}),xe.jsx(l$e,{context:r})]})})}function u$e({url:n,drawwidth:e,drawheight:t}){const r=d5(gce,n);Qe.useEffect(()=>{r.flipY=!0,HQ(r)},[r]);const{width:i=1,height:s=1}=r?.image??{},o=Math.min(e/i,t/s),a=i*o,c=s*o;return xe.jsxs("mesh",{children:[xe.jsx("planeGeometry",{args:[a,c]}),xe.jsx("meshBasicMaterial",{map:r})]})}function h$e(){const n=S_(),{viewimage:e,setviewimage:t}=za();if(n.cols<10||n.rows<10)return null;const r=n.cols-1,i=n.rows-1,s=(n.cols-4)*An.DRAW_CHAR_WIDTH(),o=(n.rows-2)*An.DRAW_CHAR_HEIGHT(),a=n.cols*An.DRAW_CHAR_WIDTH()*.5,c=n.rows*An.DRAW_CHAR_HEIGHT()*.5;return e&&xe.jsxs(iy,{children:[xe.jsx(bo,{CANCEL_BUTTON:()=>t("")}),xe.jsxs("group",{position:[0,0,998],children:[xe.jsx(m3,{alpha:.4,width:n.cols,height:n.rows,top:0,left:0,right:r,bottom:i}),xe.jsx("group",{position:[a,c,1],"scale-x":-1,"rotation-z":Math.PI,children:xe.jsx(Qe.Suspense,{fallback:null,children:xe.jsx(u$e,{url:e,drawwidth:s,drawheight:o})})})]})]})}var tw={},nw={},rw={},UG;function f$e(){if(UG)return rw;UG=1,Object.defineProperty(rw,"__esModule",{value:!0}),rw.Slice=void 0;let n=class{constructor(t,r,i,s){this.uint8=t,this.view=r,this.start=i,this.end=s}subarray(){return this.uint8.subarray(this.start,this.end)}};return rw.Slice=n,rw}var BG;function d$e(){if(BG)return nw;BG=1,Object.defineProperty(nw,"__esModule",{value:!0}),nw.Writer=void 0;const n=f$e(),e=new Uint8Array([]),t=new DataView(e.buffer),r=typeof Qs=="function",i=r?Qs.prototype.utf8Write:null,s=r?Qs.from:null,o=typeof TextEncoder<"u"?new TextEncoder:null;let a=class{constructor(l=64*1024){this.allocSize=l,this.view=t,this.x0=0,this.x=0,this.uint8=new Uint8Array(l),this.size=l,this.view=new DataView(this.uint8.buffer)}grow(l){const u=this.x0,h=this.x,f=this.uint8,d=new Uint8Array(l),p=new DataView(d.buffer),_=f.subarray(u,h);d.set(_,0),this.x=h-u,this.x0=0,this.uint8=d,this.size=l,this.view=p}ensureCapacity(l){const u=this.size,h=u-this.x;if(h<l){const f=u-this.x0,d=l-h,p=f+d;this.grow(p<=this.allocSize?this.allocSize:p*2)}}move(l){this.ensureCapacity(l),this.x+=l}reset(){this.x0=this.x}newBuffer(l){const u=this.uint8=new Uint8Array(l);this.size=l,this.view=new DataView(u.buffer),this.x=this.x0=0}flush(){const l=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,l}flushSlice(){const l=new n.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,l}u8(l){this.ensureCapacity(1),this.uint8[this.x++]=l}u16(l){this.ensureCapacity(2),this.view.setUint16(this.x,l),this.x+=2}u32(l){this.ensureCapacity(4),this.view.setUint32(this.x,l),this.x+=4}i32(l){this.ensureCapacity(4),this.view.setInt32(this.x,l),this.x+=4}u64(l){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(l)),this.x+=8}f64(l){this.ensureCapacity(8),this.view.setFloat64(this.x,l),this.x+=8}u8u16(l,u){this.ensureCapacity(3);let h=this.x;this.uint8[h++]=l,this.uint8[h++]=u>>>8,this.uint8[h++]=u&255,this.x=h}u8u32(l,u){this.ensureCapacity(5);let h=this.x;this.uint8[h++]=l,this.view.setUint32(h,u),this.x=h+4}u8u64(l,u){this.ensureCapacity(9);let h=this.x;this.uint8[h++]=l,this.view.setBigUint64(h,BigInt(u)),this.x=h+8}u8f32(l,u){this.ensureCapacity(5);let h=this.x;this.uint8[h++]=l,this.view.setFloat32(h,u),this.x=h+4}u8f64(l,u){this.ensureCapacity(9);let h=this.x;this.uint8[h++]=l,this.view.setFloat64(h,u),this.x=h+8}buf(l,u){this.ensureCapacity(u);const h=this.x;this.uint8.set(l,h),this.x=h+u}utf8(l){const u=l.length*4;if(u<168)return this.utf8Native(l);if(i){const h=i.call(this.uint8,l,this.x,u);return this.x+=h,h}else if(s){const h=this.uint8,f=h.byteOffset+this.x,p=s(h.buffer).subarray(f,f+u).write(l,0,u,"utf8");return this.x+=p,p}else if(u>1024&&o){const h=o.encodeInto(l,this.uint8.subarray(this.x,this.x+u)).written;return this.x+=h,h}return this.utf8Native(l)}utf8Native(l){const u=l.length,h=this.uint8;let f=this.x,d=0;for(;d<u;){let _=l.charCodeAt(d++);if((_&4294967168)===0){h[f++]=_;continue}else if((_&4294965248)===0)h[f++]=_>>6&31|192;else{if(_>=55296&&_<=56319&&d<u){const g=l.charCodeAt(d);(g&64512)===56320&&(d++,_=((_&1023)<<10)+(g&1023)+65536)}(_&4294901760)===0?(h[f++]=_>>12&15|224,h[f++]=_>>6&63|128):(h[f++]=_>>18&7|240,h[f++]=_>>12&63|128,h[f++]=_>>6&63|128)}h[f++]=_&63|128}const p=f-this.x;return this.x=f,p}ascii(l){const u=l.length;this.ensureCapacity(u);const h=this.uint8;let f=this.x,d=0;for(;d<u;)h[f++]=l.charCodeAt(d++);this.x=f}};return nw.Writer=a,nw}var FG;function p$e(){if(FG)return tw;FG=1,Object.defineProperty(tw,"__esModule",{value:!0}),tw.MsgPackEncoderFast=void 0;const n=d$e();let e=class{constructor(r=new n.Writer){this.writer=r}encode(r){return this.writer.reset(),this.writeAny(r),this.writer.flush()}encodeAny(r){this.writeAny(r)}writeAny(r){switch(r){case null:return this.writer.u8(192);case!1:return this.writer.u8(194);case!0:return this.writer.u8(195)}if(r instanceof Array)return this.writeArr(r);switch(typeof r){case"number":return this.writeNumber(r);case"string":return this.writeStr(r);case"object":return this.writeObj(r)}}encodeFloat64(r){this.writeFloat(r)}writeNull(){return this.writer.u8(192)}writeFloat(r){this.writer.u8f64(203,r)}u32(r){const i=this.writer;this.writer.ensureCapacity(5);const s=i.uint8;r<=127?s[i.x++]=r:r<=65535?(s[i.x++]=205,i.view.setUint16(i.x,r),i.x+=2):r<=4294967295?(s[i.x++]=206,i.view.setUint32(i.x,r),i.x+=4):this.writeFloat(r)}n32(r){const i=this.writer;this.writer.ensureCapacity(5);const s=i.uint8;r>=-32?s[i.x++]=256+r:r>=-32768?(s[i.x++]=209,i.view.setInt16(i.x,r),i.x+=2):r>=-2147483648?(s[i.x++]=210,i.view.setInt32(i.x,r),i.x+=4):this.writeFloat(r)}encodeNumber(r){this.writeNumber(r)}writeNumber(r){if(r>>>0===r)return this.u32(r);if(r>>0===r)return this.n32(r);this.writeFloat(r)}writeInteger(r){if(r>=0){if(r<=4294967295)return this.u32(r);if(r>-2147483648)return this.n32(r)}this.writeFloat(r)}writeUInteger(r){if(r<=4294967295)return this.u32(r);this.writeFloat(r)}encodeNull(){this.writer.u8(192)}encodeTrue(){this.writer.u8(195)}encodeFalse(){this.writer.u8(194)}encodeBoolean(r){this.writeBoolean(r)}writeBoolean(r){r?this.writer.u8(195):this.writer.u8(194)}encodeStringHeader(r){this.writeStrHdr(r)}writeStrHdr(r){r<=31?this.writer.u8(160|r):r<=255?this.writer.u16(55552+r):r<=65535?this.writer.u8u16(218,r):this.writer.u8u32(219,r)}encodeString(r){this.writeStr(r)}writeStr(r){const i=this.writer,o=r.length*4;i.ensureCapacity(5+o);const a=i.uint8;let c=i.x;o<=31?i.x++:o<=255?(a[i.x++]=217,c=i.x,i.x++):o<=65535?(a[i.x++]=218,c=i.x,i.x+=2):(a[i.x++]=219,c=i.x,i.x+=4);const l=this.writer.utf8(r);o<=31?a[c]=160|l:o<=255?a[c]=l:o<=65535?i.view.setUint16(c,l):i.view.setUint32(c,l)}encodeAsciiString(r){this.writeAsciiStr(r)}writeAsciiStr(r){this.writeStrHdr(r.length),this.writer.ascii(r)}encodeArrayHeader(r){this.writeArrHdr(r)}encodeArray(r){this.writeArr(r)}writeArrHdr(r){r<=15?this.writer.u8(144|r):r<=65535?this.writer.u8u16(220,r):r<=4294967295&&this.writer.u8u32(221,r)}writeArr(r){const i=r.length;i<=15?this.writer.u8(144|i):i<=65535?this.writer.u8u16(220,i):i<=4294967295&&this.writer.u8u32(221,i);for(let s=0;s<i;s++)this.writeAny(r[s])}encodeObjectHeader(r){this.writeObjHdr(r)}encodeObject(r){this.writeObj(r)}writeObjHdr(r){r<=15?this.writer.u8(128|r):r<=65535?this.writer.u8u16(222,r):r<=4294967295&&this.writer.u8u32(223,r)}writeObj(r){const i=Object.keys(r),s=i.length;this.writeObjHdr(s);for(let o=0;o<s;o++){const a=i[o];this.writeStr(a),this.writeAny(r[a])}}encodeExtHeader(r,i){switch(i){case 1:this.writer.u16(54272|r);break;case 2:this.writer.u16(54528|r);break;case 4:this.writer.u16(54784|r);break;case 8:this.writer.u16(55040|r);break;case 16:this.writer.u16(55296|r);break;default:i<=255?(this.writer.u16(50944|i),this.writer.u8(r)):i<=65535?(this.writer.u8u16(200,i),this.writer.u8(r)):i<=4294967295&&(this.writer.u8u32(201,i),this.writer.u8(r))}}encodeExt(r){const{tag:i,val:s}=r,o=s.length;this.encodeExtHeader(i,o),this.writer.buf(s,o)}encodeBinaryHeader(r){this.writeBinHdr(r)}encodeBinary(r){this.writeBin(r)}writeBinHdr(r){r<=255?this.writer.u16(50176|r):r<=65535?this.writer.u8u16(197,r):r<=4294967295&&this.writer.u8u32(198,r)}writeBin(r){const i=r.length;this.writeBinHdr(i),this.writer.buf(r,i)}};return tw.MsgPackEncoderFast=e,tw}p$e();var En;(function(n){n[n.add=0]="add",n[n.remove=1]="remove",n[n.replace=2]="replace",n[n.copy=3]="copy",n[n.move=4]="move",n[n.test=5]="test",n[n.str_ins=6]="str_ins",n[n.str_del=7]="str_del",n[n.flip=8]="flip",n[n.inc=9]="inc",n[n.split=10]="split",n[n.merge=11]="merge",n[n.extend=12]="extend",n[n.contains=30]="contains",n[n.defined=31]="defined",n[n.ends=32]="ends",n[n.in=33]="in",n[n.less=34]="less",n[n.matches=35]="matches",n[n.more=36]="more",n[n.starts=37]="starts",n[n.undefined=38]="undefined",n[n.test_type=39]="test_type",n[n.test_string=40]="test_string",n[n.test_string_len=41]="test_string_len",n[n.type=42]="type",n[n.and=43]="and",n[n.not=44]="not",n[n.or=45]="or"})(En||(En={}));class Df{path;from;constructor(e){this.path=e}}var $P={};const Kb=j$(ABe);var WP={},jG;function m$e(){return jG||(jG=1,Object.defineProperty(WP,"__esModule",{value:!0})),WP}var qP={},zG;function wre(){return zG||(zG=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.isInteger=n.isRoot=n.toPath=void 0,n.unescapeComponent=s,n.escapeComponent=o,n.parseJsonPointer=a,n.formatJsonPointer=c,n.isChild=u,n.isPathEqual=h,n.parent=d,n.isValidIndex=p;const e=/~1/g,t=/~0/g,r=/~/g,i=/\//g;function s(g){return g.indexOf("~")===-1?g:g.replace(e,"/").replace(t,"~")}function o(g){return g.indexOf("/")===-1&&g.indexOf("~")===-1?g:g.replace(r,"~0").replace(i,"~1")}function a(g){return g?g.slice(1).split("/").map(s):[]}function c(g){return(0,n.isRoot)(g)?"":"/"+g.map(m=>o(String(m))).join("/")}const l=g=>typeof g=="string"?a(g):g;n.toPath=l;function u(g,m){if(g.length>=m.length)return!1;for(let b=0;b<g.length;b++)if(g[b]!==m[b])return!1;return!0}function h(g,m){if(g.length!==m.length)return!1;for(let b=0;b<g.length;b++)if(g[b]!==m[b])return!1;return!0}const f=g=>!g.length;n.isRoot=f;function d(g){if(g.length<1)throw new Error("NO_PARENT");return g.slice(0,g.length-1)}function p(g){if(typeof g=="number")return!0;const m=Number.parseInt(g,10);return String(m)===g&&m>=0}const _=g=>{const m=g.length;let b=0,y;for(;b<m;){if(y=g.charCodeAt(b),y>=48&&y<=57){b++;continue}return!1}return!0};n.isInteger=_})(qP)),qP}var YP={},HG;function g$e(){return HG||(HG=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.validatePath=n.validateJsonPointer=void 0;const e=i=>{if(typeof i=="string"){if(i){if(i[0]!=="/")throw new Error("POINTER_INVALID");if(i.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,n.validatePath)(i)};n.validateJsonPointer=e;const{isArray:t}=Array,r=i=>{if(!t(i))throw new Error("Invalid path.");if(i.length>256)throw new Error("Path too long.");for(const s of i)switch(typeof s){case"string":case"number":continue;default:throw new Error("Invalid path step.")}};n.validatePath=r})(YP)),YP}var iw={},sw={},VG;function Q8(){if(VG)return sw;VG=1,Object.defineProperty(sw,"__esModule",{value:!0}),sw.hasOwnProperty=void 0;const n=Object.prototype.hasOwnProperty;function e(t,r){return n.call(t,r)}return sw.hasOwnProperty=e,sw}var GG;function _$e(){if(GG)return iw;GG=1,Object.defineProperty(iw,"__esModule",{value:!0}),iw.get=void 0;const n=Q8(),e=(t,r)=>{const i=r.length;let s;if(!i)return t;for(let o=0;o<i;o++)if(s=r[o],t instanceof Array){if(typeof s!="number"){if(s==="-")return;const a=~~s;if(""+a!==s)return;s=a}t=t[s]}else if(typeof t=="object"){if(!t||!(0,n.hasOwnProperty)(t,s))return;t=t[s]}else return;return t};return iw.get=e,iw}var hp={},$G;function v$e(){if($G)return hp;$G=1,Object.defineProperty(hp,"__esModule",{value:!0}),hp.isObjectReference=hp.isArrayEnd=hp.isArrayReference=hp.find=void 0;const n=Q8(),{isArray:e}=Array,t=(o,a)=>{const c=a.length;if(!c)return{val:o};let l,u;for(let f=0;f<c;f++)if(l=o,u=a[f],e(l)){const d=l.length;if(u==="-")u=d;else if(typeof u=="string"){const p=~~u;if(""+p!==u)throw new Error("INVALID_INDEX");if(u=p,u<0)throw new Error("INVALID_INDEX")}o=l[u]}else if(typeof l=="object"&&l)o=(0,n.hasOwnProperty)(l,u)?l[u]:void 0;else throw new Error("NOT_FOUND");return{val:o,obj:l,key:u}};hp.find=t;const r=o=>e(o.obj)&&typeof o.key=="number";hp.isArrayReference=r;const i=o=>o.obj.length===o.key;hp.isArrayEnd=i;const s=o=>typeof o.obj=="object"&&typeof o.key=="string";return hp.isObjectReference=s,hp}var KP={},ow={},WG;function y$e(){if(WG)return ow;WG=1,Object.defineProperty(ow,"__esModule",{value:!0}),ow.findByPointer=void 0;const n=Q8(),e=wre(),{isArray:t}=Array,r=(i,s)=>{if(!i)return{val:s};let o,a,c=0,l=1;for(;c>-1;)if(c=i.indexOf("/",l),a=c>-1?i.substring(l,c):i.substring(l),l=c+1,o=s,t(o)){const u=o.length;if(a==="-")a=u;else{const h=~~a;if(""+h!==a)throw new Error("INVALID_INDEX");if(a=h,a<0)throw"INVALID_INDEX"}s=o[a]}else if(typeof o=="object"&&o)a=(0,e.unescapeComponent)(a),s=(0,n.hasOwnProperty)(o,a)?o[a]:void 0;else throw"NOT_FOUND";return{val:s,obj:o,key:a}};return ow.findByPointer=r,ow}var qG;function b$e(){return qG||(qG=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),Kb.__exportStar(y$e(),n)})(KP)),KP}var YG;function S$e(){return YG||(YG=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0});const e=Kb;e.__exportStar(m$e(),n),e.__exportStar(wre(),n),e.__exportStar(g$e(),n),e.__exportStar(_$e(),n),e.__exportStar(v$e(),n),e.__exportStar(b$e(),n)})($P)),$P}var Yn=S$e(),XP={},KG;function E$e(){return KG||(KG=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.clone=void 0;const{isArray:e}=Array,t=Object.keys,r=i=>{if(!i)return i;if(e(i)){const s=[],o=i.length;for(let a=0;a<o;a++)s.push((0,n.clone)(i[a]));return s}else if(typeof i=="object"){const s=t(i),o=s.length,a={};for(let c=0;c<o;c++){const l=s[c];a[l]=(0,n.clone)(i[l])}return a}return i};n.clone=r})(XP)),XP}var eB=E$e();class tB extends Df{value;constructor(e,t){super(e),this.value=t}op(){return"add"}code(){return En.add}apply(e){const{val:t,key:r,obj:i}=Yn.find(e,this.path),s=eB.clone(this.value);if(!i)e=s;else if(typeof r=="string")i[r]=s;else{const o=i.length;if(r<o)i.splice(r,0,s);else{if(r>o)throw new Error("INVALID_INDEX");i.push(s)}}return{doc:e,old:t}}toJson(e){return{op:"add",path:Yn.formatJsonPointer(this.path),value:this.value}}toCompact(e,t){return[t?"add":En.add,this.path,this.value]}}class Are extends Df{oldValue;constructor(e,t){super(e),this.oldValue=t}op(){return"remove"}code(){return En.remove}apply(e){const t=Yn.find(e,this.path);if(t.val===void 0)throw new Error("NOT_FOUND");return Yn.isObjectReference(t)?delete t.obj[t.key]:Yn.isArrayReference(t)?t.val!==void 0&&t.obj.splice(t.key,1):e=null,{doc:e,old:t.val}}toJson(e){const t={op:"remove",path:Yn.formatJsonPointer(this.path)};return this.oldValue!==void 0&&(t.oldValue=this.oldValue),t}toCompact(e,t){const r=t?"remove":En.remove;return this.oldValue===void 0?[r,this.path]:[r,this.path,this.oldValue]}}class x$e extends Df{value;oldValue;constructor(e,t,r){super(e),this.value=t,this.oldValue=r}op(){return"replace"}code(){return En.replace}apply(e){const t=Yn.find(e,this.path);if(t.val===void 0)throw new Error("NOT_FOUND");const r=eB.clone(this.value);return Yn.isObjectReference(t)||Yn.isArrayReference(t)?t.obj[t.key]=r:e=r,{doc:e,old:t.val}}toJson(e){const t={op:"replace",path:Yn.formatJsonPointer(this.path),value:this.value};return this.oldValue!==void 0&&(t.oldValue=this.oldValue),t}toCompact(e,t){const r=t?"replace":En.replace;return this.oldValue===void 0?[r,this.path,this.value]:[r,this.path,this.value,this.oldValue]}}class T$e extends Df{from;constructor(e,t){super(e),this.from=t}op(){return"move"}code(){return En.move}apply(e){const t=new Are(Yn.toPath(this.from),void 0).apply(e);return new tB(this.path,t.old).apply(t.doc)}toJson(e){return{op:"move",path:Yn.formatJsonPointer(this.path),from:Yn.formatJsonPointer(this.from)}}toCompact(e,t){return[t?"move":En.move,this.path,this.from]}}class w$e extends Df{from;constructor(e,t){super(e),this.from=t}op(){return"copy"}code(){return En.copy}apply(e){const{val:t}=Yn.find(e,this.from);if(t===void 0)throw new Error("NOT_FOUND");return new tB(this.path,eB.clone(t)).apply(e)}toJson(e){return{op:"copy",path:Yn.formatJsonPointer(this.path),from:Yn.formatJsonPointer(this.from)}}toCompact(e,t){return[t?"copy":En.copy,this.path,this.from]}}class qu extends Df{apply(e){if(!this.test(e))throw new Error("TEST");return{doc:e}}}var ZP={},JP={},XG;function A$e(){return XG||(XG=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.deepEqual=void 0;const e=Array.isArray,t=Object.prototype,r=(i,s)=>{if(i===s)return!0;let o=0,a=0;if(e(i)){if(!e(s)||(o=i.length,o!==s.length))return!1;for(a=o;a--!==0;)if(!(0,n.deepEqual)(i[a],s[a]))return!1;return!0}if(i&&s&&typeof i=="object"&&typeof s=="object"){e:{if(i.__proto__===t)break e;if(i instanceof Uint8Array){if(!(s instanceof Uint8Array))return!1;const l=i.length;if(l!==s.length)return!1;for(let u=0;u<l;u++)if(i[u]!==s[u])return!1;return!0}}const c=Object.keys(i);if(o=c.length,o!==Object.keys(s).length||e(s))return!1;for(a=o;a--!==0;){const l=c[a];if(!(0,n.deepEqual)(i[l],s[l]))return!1}return!0}return!1};n.deepEqual=r})(JP)),JP}var ZG;function R$e(){return ZG||(ZG=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),Kb.__exportStar(A$e(),n)})(ZP)),ZP}var Rre=R$e();class C$e extends qu{value;not;constructor(e,t,r){super(e),this.value=t,this.not=r}op(){return"test"}code(){return En.test}test(e){const{val:t}=Yn.find(e,this.path);if(t===void 0)return!!this.not;const r=Rre.deepEqual(t,this.value);return this.not?!r:r}toJson(e){const t={op:"test",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.not&&(t.not=this.not),t}toCompact(e,t){const r=e?this.path.slice(e.path.length):this.path,i=t?"test":En.test;return this.not?[i,r,this.value,1]:[i,r,this.value]}}class M$e extends Df{op(){return"flip"}code(){return En.flip}apply(e){const t=Yn.find(e,this.path);return t.obj?t.obj[t.key]=!t.val:e=!t.val,{doc:e,old:t.val}}toJson(e){return{op:"flip",path:Yn.formatJsonPointer(this.path)}}toCompact(e,t){return[t?"flip":En.flip,this.path]}}class k$e extends Df{inc;constructor(e,t){super(e),this.inc=t}op(){return"inc"}code(){return En.inc}apply(e){const t=Yn.find(e,this.path),r=this.inc+Number(t.val);return t.obj?t.obj[t.key]=r:e=r,{doc:e,old:t.val}}toJson(e){return{op:"inc",path:Yn.formatJsonPointer(this.path),inc:this.inc}}toCompact(e,t){return[t?"inc":En.inc,this.path,this.inc]}}class O$e extends Df{pos;str;constructor(e,t,r){super(e),this.pos=t,this.str=r}op(){return"str_ins"}code(){return En.str_ins}apply(e){const{val:t,key:r,obj:i}=Yn.find(e,this.path);if(typeof t!="string"){if(t!==void 0)throw new Error("NOT_A_STRING");if(this.pos!==0)throw new Error("POS")}const s=typeof t=="string"?t:"",o=Math.min(this.pos,s.length),a=s.slice(0,o),c=s.slice(o),l=a+this.str+c;return i?i[r]=l:e=l,{doc:e,old:t}}toJson(e){return{op:"str_ins",path:Yn.formatJsonPointer(this.path),pos:this.pos,str:this.str}}toCompact(e,t){return[t?"str_ins":En.str_ins,this.path,this.pos,this.str]}}class JG extends Df{pos;str;len;constructor(e,t,r,i){super(e),this.pos=t,this.str=r,this.len=i}op(){return"str_del"}code(){return En.str_del}deleteLength(){return typeof this.str=="string"?this.str.length:this.len}apply(e){const{val:t,key:r,obj:i}=Yn.find(e,this.path);if(typeof t!="string")throw new Error("NOT_A_STRING");const s=t.length,o=Math.min(this.pos,t.length),a=Math.min(o,s),c=this.str!==void 0?this.str.length:this.len,l=Math.min(o+c,s),u=t.slice(0,a),h=t.substr(l),f=u+h;return i?i[r]=f:e=f,{doc:e,old:t}}toJson(e){return typeof this.str=="string"?{op:"str_del",path:Yn.formatJsonPointer(this.path),pos:this.pos,str:this.str}:{op:"str_del",path:Yn.formatJsonPointer(this.path),pos:this.pos,len:this.len}}toCompact(e,t){const r=t?"str_del":En.str_del;return typeof this.str=="string"?[r,this.path,this.pos,this.str]:[r,this.path,this.pos,0,this.len]}}const{isArray:I$e}=Array,I4=n=>!!n&&typeof n=="object"&&typeof n.text=="string",N4=n=>!!n&&typeof n=="object"&&I$e(n.children),N$e=(n,e)=>{const t=new RegExp(n,e?"i":void 0);return r=>t.test(r)};class P$e extends Df{pos;props;constructor(e,t,r){super(e),this.pos=t,this.props=r}op(){return"split"}code(){return En.split}apply(e){const t=Yn.find(e,this.path);if(t.val===void 0)throw new Error("NOT_FOUND");const r=this.split(t.val);return Yn.isObjectReference(t)?t.obj[t.key]=r:Yn.isArrayReference(t)?(t.obj[t.key]=r[0],t.obj.splice(t.key+1,0,r[1])):e=r,{doc:e,old:t.val}}split(e){if(typeof e=="string"){const{pos:t,props:r}=this,i=e.slice(0,t),s=e.slice(t);return r?[{...r,text:i},{...r,text:s}]:[i,s]}else if(I4(e)){const{pos:t,props:r}=this,i=e.text.slice(0,t),s=e.text.slice(t);return[{...e,...r,text:i},{...e,...r,text:s}]}else if(N4(e)){const{pos:t,props:r}=this,i=e.children.slice(0,t),s=e.children.slice(t);return[{...e,...r,children:i},{...e,...r,children:s}]}else if(typeof e=="number"){const{pos:t}=this;return[t,e-t]}else return[e,e]}toJson(e){const t={op:"split",path:Yn.formatJsonPointer(this.path),pos:this.pos};return this.props&&(t.props=this.props),t}toCompact(e,t){const r=t?"split":En.split;return this.props?[r,this.path,this.pos,this.props]:[r,this.path,this.pos]}}class D$e extends Df{pos;props;constructor(e,t,r){super(e),this.pos=t,this.props=r}op(){return"merge"}code(){return En.merge}apply(e){const t=Yn.find(e,this.path);if(!Yn.isArrayReference(t))throw new Error("INVALID_TARGET");if(t.key<=0)throw new Error("INVALID_KEY");const r=t.obj[t.key-1],i=t.obj[t.key],s=this.merge(r,i);return t.obj[t.key-1]=s,t.obj.splice(t.key,1),{doc:e,old:[r,i]}}merge(e,t){return typeof e=="string"&&typeof t=="string"||typeof e=="number"&&typeof t=="number"?e+t:I4(e)&&I4(t)?{...e,...t,text:e.text+t.text}:N4(e)&&N4(t)?{...e,...t,children:[...e.children,...t.children]}:[e,t]}toJson(e){const t={op:"merge",path:Yn.formatJsonPointer(this.path),pos:this.pos};return this.props&&(t.props=this.props),t}toCompact(e,t){const r=t?"merge":En.merge;return this.props?[r,this.path,this.pos,this.props]:[r,this.path,this.pos]}}const{isArray:L$e}=Array;class U$e extends Df{props;deleteNull;constructor(e,t,r){super(e),this.props=t,this.deleteNull=r}op(){return"extend"}code(){return En.extend}apply(e){const t=Yn.find(e,this.path);return Yn.isArrayReference(t)?t.val!==void 0&&(t.obj[t.key]=this.extend(t.val)):Yn.isObjectReference(t)?t.obj[t.key]=this.extend(t.val):e=this.extend(e),{doc:e}}extend(e){if(L$e(e)||typeof e!="object"||!e)return e;for(const[t,r]of Object.entries(this.props)){if(t==="__proto__")throw new Error("NO_PROTO");if(r===null&&this.deleteNull){delete e[t];continue}e[t]=r}return e}toJson(e){const t={op:"extend",path:Yn.formatJsonPointer(this.path),props:this.props};return this.deleteNull&&(t.deleteNull=this.deleteNull),t}toCompact(e,t){const r=t?"extend":En.extend;return this.deleteNull?[r,this.path,this.props,1]:[r,this.path,this.props]}}class B$e extends qu{op(){return"defined"}code(){return En.defined}test(e){const{val:t}=Yn.find(e,this.path);return t!==void 0}toJson(e){return{op:"defined",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path)}}toCompact(e,t){return[t?"defined":En.defined,e?this.path.slice(e.path.length):this.path]}}class F$e extends qu{op(){return"undefined"}code(){return En.undefined}test(e){try{const{val:t}=Yn.find(e,this.path);return t===void 0}catch(t){if(t.message==="NOT_FOUND")return!0;throw t}}toJson(e){return{op:"undefined",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path)}}toCompact(e,t){return[t?"undefined":En.undefined,e?this.path.slice(e.path.length):this.path]}}const{isArray:j$e}=Array;class z$e extends qu{type;constructor(e,t){super(e),this.type=t}op(){return"test_type"}code(){return En.test_type}test(e){const{val:t}=Yn.find(e,this.path);return t===null?this.type.indexOf("null")>-1:j$e(t)?this.type.indexOf("array")>-1:this.type.indexOf(typeof t)>-1||typeof t=="number"&&t===Math.round(t)&&this.type.indexOf("integer")>-1}toJson(e){return{op:"test_type",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),type:this.type}}toCompact(e,t){return[t?"test_type":En.test_type,e?this.path.slice(e.path.length):this.path,this.type]}}class H$e extends qu{pos;str;not;constructor(e,t,r,i){super(e),this.pos=t,this.str=r,this.not=i}op(){return"test_string"}code(){return En.test_string}test(e){const{val:t}=Yn.find(e,this.path);if(typeof t!="string")return!1;const r=t.length,i=Math.min(this.pos,r),s=Math.min(this.pos+this.str.length,r),o=t.substring(i,s)===this.str;return this.not?!o:o}toJson(e){const t={op:"test_string",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),pos:this.pos,str:this.str};return this.not&&(t.not=this.not),t}toCompact(e,t){const r=t?"test_string":En.test_string,i=e?this.path.slice(e.path.length):this.path;return this.not?[r,i,this.pos,this.str,1]:[r,i,this.pos,this.str]}}class V$e extends qu{len;not;constructor(e,t,r){super(e),this.len=t,this.not=r}op(){return"test_string_len"}code(){return En.test_string_len}test(e){const{val:t}=Yn.find(e,this.path);if(typeof t!="string")return!1;const i=t.length>=this.len;return this.not?!i:i}toJson(e){const t={op:"test_string_len",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),len:this.len};return this.not&&(t.not=this.not),t}toCompact(e,t){const r=t?"test_string_len":En.test_string_len,i=e?this.path.slice(e.path.length):this.path;return this.not?[r,i,this.len,1]:[r,i,this.len]}}class G$e extends qu{value;ignore_case;constructor(e,t,r){super(e),this.value=t,this.ignore_case=r}op(){return"contains"}code(){return En.contains}test(e){const{val:t}=Yn.find(e,this.path);if(typeof t!="string")return!1;const r=this.ignore_case?t.toLowerCase():t,i=this.ignore_case?this.value.toLowerCase():this.value;return r.indexOf(i)>-1}toJson(e){const t={op:"contains",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(t.ignore_case=this.ignore_case),t}toCompact(e,t){const r=t?"contains":En.contains;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}class $$e extends qu{value;ignore_case;constructor(e,t,r){super(e),this.value=t,this.ignore_case=r}op(){return"ends"}code(){return En.ends}test(e){const{val:t}=Yn.find(e,this.path);if(typeof t!="string")return!1;const r=this.ignore_case?t.toLowerCase():t,i=this.ignore_case?this.value.toLowerCase():this.value;return r.endsWith(i)}toJson(e){const t={op:"ends",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(t.ignore_case=this.ignore_case),t}toCompact(e,t){const r=t?"ends":En.ends;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}class W$e extends qu{value;ignore_case;constructor(e,t,r){super(e),this.value=t,this.ignore_case=r}op(){return"starts"}code(){return En.starts}test(e){const{val:t}=Yn.find(e,this.path);if(typeof t!="string")return!1;const r=this.ignore_case?t.toLowerCase():t,i=this.ignore_case?this.value.toLowerCase():this.value;return r.startsWith(i)}toJson(e){const t={op:"starts",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(t.ignore_case=this.ignore_case),t}toCompact(e,t){const r=t?"starts":En.starts;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}class q$e extends qu{value;constructor(e,t){super(e),this.value=t}op(){return"in"}code(){return En.in}test(e){const{val:t}=Yn.find(e,this.path);for(const r of this.value)if(Rre.deepEqual(t,r))return!0;return!1}toJson(e){return{op:"in",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,t){return[t?"in":En.in,e?this.path.slice(e.path.length):this.path,this.value]}}class Y$e extends qu{value;constructor(e,t){super(e),this.value=t}op(){return"less"}code(){return En.less}test(e){const{val:t}=Yn.find(e,this.path);return typeof t!="number"?!1:t<this.value}toJson(e){return{op:"less",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,t){return[t?"less":En.less,e?this.path.slice(e.path.length):this.path,this.value]}}class K$e extends qu{value;constructor(e,t){super(e),this.value=t}op(){return"more"}code(){return En.more}test(e){const{val:t}=Yn.find(e,this.path);return typeof t!="number"?!1:t>this.value}toJson(e){return{op:"more",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,t){return[t?"more":En.more,e?this.path.slice(e.path.length):this.path,this.value]}}class nB extends qu{ops;constructor(e,t){super(e),this.ops=t}}class X$e extends nB{ops;constructor(e,t){super(e,t),this.ops=t}op(){return"and"}code(){return En.and}test(e){for(const t of this.ops)if(!t.test(e))return!1;return!0}toJson(e){return{op:"and",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),apply:this.ops.map(r=>r.toJson(this))}}toCompact(e,t){return[t?"and":En.and,e?this.path.slice(e.path.length):this.path,this.ops.map(i=>i.toCompact(this,t))]}}class Z$e extends nB{ops;constructor(e,t){super(e,t),this.ops=t}op(){return"or"}code(){return En.or}test(e){for(const t of this.ops)if(t.test(e))return!0;return!1}toJson(e){return{op:"or",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),apply:this.ops.map(r=>r.toJson(this))}}toCompact(e,t){return[t?"or":En.or,e?this.path.slice(e.path.length):this.path,this.ops.map(i=>i.toCompact(this,t))]}}class J$e extends nB{ops;constructor(e,t){super(e,t),this.ops=t}op(){return"not"}code(){return En.not}test(e){for(const t of this.ops)if(t.test(e))return!1;return!0}toJson(e){return{op:"not",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),apply:this.ops.map(r=>r.toJson(this))}}toCompact(e,t){return[t?"not":En.not,e?this.path.slice(e.path.length):this.path,this.ops.map(i=>i.toCompact(this,t))]}}class Q$e extends qu{value;ignore_case;matcher;constructor(e,t,r,i){super(e),this.value=t,this.ignore_case=r,this.matcher=i(t,r)}op(){return"matches"}code(){return En.matches}test(e){const{val:t}=Yn.find(e,this.path);return typeof t!="string"?!1:this.matcher(t)}toJson(e){const t={op:"matches",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(t.ignore_case=this.ignore_case),t}toCompact(e,t){const r=t?"matches":En.matches;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}const{isArray:eWe}=Array;class tWe extends qu{value;constructor(e,t){super(e),this.value=t}op(){return"type"}code(){return En.type}test(e){const{val:t}=Yn.find(e,this.path);return t===null?this.value==="null":eWe(t)?this.value==="array":typeof t===this.value||typeof t=="number"&&t===Math.round(t)&&this.value==="integer"}toJson(e){return{op:"type",path:Yn.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,t){return[t?"type":En.type,e?this.path.slice(e.path.length):this.path,this.value]}}var aw={},cw={},QG;function nWe(){if(QG)return cw;QG=1,Object.defineProperty(cw,"__esModule",{value:!0}),cw.JsonPackExtension=void 0;let n=class{constructor(t,r){this.tag=t,this.val=r}};return cw.JsonPackExtension=n,cw}var lw={},uw={},sC={},E1={},e$;function rWe(){if(e$)return E1;e$=1,Object.defineProperty(E1,"__esModule",{value:!0}),E1.decodeAsciiMax15=E1.decodeAscii=void 0;const n=String.fromCharCode,e=(r,i,s)=>{const o=[];for(let a=0;a<s;a++){const c=r[i++];if(c&128)return;o.push(c)}return n.apply(String,o)};E1.decodeAscii=e;const t=(r,i,s)=>{if(s<4)if(s<2){if(s===0)return"";{const o=r[i++];if((o&128)>1){i-=1;return}return n(o)}}else{const o=r[i++],a=r[i++];if((o&128)>0||(a&128)>0){i-=2;return}if(s<3)return n(o,a);const c=r[i++];if((c&128)>0){i-=3;return}return n(o,a,c)}else{const o=r[i++],a=r[i++],c=r[i++],l=r[i++];if((o&128)>0||(a&128)>0||(c&128)>0||(l&128)>0){i-=4;return}if(s<6){if(s===4)return n(o,a,c,l);{const u=r[i++];if((u&128)>0){i-=5;return}return n(o,a,c,l,u)}}else if(s<8){const u=r[i++],h=r[i++];if((u&128)>0||(h&128)>0){i-=6;return}if(s<7)return n(o,a,c,l,u,h);const f=r[i++];if((f&128)>0){i-=7;return}return n(o,a,c,l,u,h,f)}else{const u=r[i++],h=r[i++],f=r[i++],d=r[i++];if((u&128)>0||(h&128)>0||(f&128)>0||(d&128)>0){i-=8;return}if(s<10){if(s===8)return n(o,a,c,l,u,h,f,d);{const p=r[i++];if((p&128)>0){i-=9;return}return n(o,a,c,l,u,h,f,d,p)}}else if(s<12){const p=r[i++],_=r[i++];if((p&128)>0||(_&128)>0){i-=10;return}if(s<11)return n(o,a,c,l,u,h,f,d,p,_);const g=r[i++];if((g&128)>0){i-=11;return}return n(o,a,c,l,u,h,f,d,p,_,g)}else{const p=r[i++],_=r[i++],g=r[i++],m=r[i++];if((p&128)>0||(_&128)>0||(g&128)>0||(m&128)>0){i-=12;return}if(s<14){if(s===12)return n(o,a,c,l,u,h,f,d,p,_,g,m);{const b=r[i++];if((b&128)>0){i-=13;return}return n(o,a,c,l,u,h,f,d,p,_,g,m,b)}}else{const b=r[i++],y=r[i++];if((b&128)>0||(y&128)>0){i-=14;return}if(s<15)return n(o,a,c,l,u,h,f,d,p,_,g,m,b,y);const x=r[i++];if((x&128)>0){i-=15;return}return n(o,a,c,l,u,h,f,d,p,_,g,m,b,y,x)}}}}};return E1.decodeAsciiMax15=t,E1}var oC={},t$;function iWe(){if(t$)return oC;t$=1,Object.defineProperty(oC,"__esModule",{value:!0});const n=String.fromCharCode;return oC.default=(e,t,r)=>{let i=t;const s=i+r,o=[];for(;i<s;){let a=e[i++];if((a&128)!==0){const c=e[i++]&63;if((a&224)===192)a=(a&31)<<6|c;else{const l=e[i++]&63;if((a&240)===224)a=(a&31)<<12|c<<6|l;else if((a&248)===240){const u=e[i++]&63;let h=(a&7)<<18|c<<12|l<<6|u;if(h>65535){h-=65536;const f=h>>>10&1023|55296;a=56320|h&1023,o.push(f)}else a=h}}}o.push(a)}return n.apply(String,o)},oC}var n$;function sWe(){if(n$)return sC;n$=1,Object.defineProperty(sC,"__esModule",{value:!0});const n=Kb,e=rWe(),t=n.__importDefault(iWe()),r=typeof Qs<"u",i=r?Qs.prototype.utf8Slice:null,s=r?Qs.from:null,o=(u,h,f)=>(0,e.decodeAsciiMax15)(u,h,f)??(0,t.default)(u,h,f),a=(u,h,f)=>(0,e.decodeAscii)(u,h,f)??(0,t.default)(u,h,f),c=i?(u,h,f)=>i.call(u,h,h+f):s?(u,h,f)=>s(u).subarray(h,h+f).toString("utf8"):t.default,l=(u,h,f)=>f<16?o(u,h,f):f<32?a(u,h,f):c(u,h,f);return sC.default=l,sC}var r$;function oWe(){if(r$)return uw;r$=1,Object.defineProperty(uw,"__esModule",{value:!0}),uw.decodeUtf8=void 0;const e=Kb.__importDefault(sWe());return uw.decodeUtf8=e.default,uw}var i$;function aWe(){if(i$)return lw;i$=1,Object.defineProperty(lw,"__esModule",{value:!0}),lw.Reader=void 0;const n=oWe();let e=class{constructor(){this.uint8=new Uint8Array([]),this.view=new DataView(this.uint8.buffer),this.x=0}reset(r){this.x=0,this.uint8=r,this.view=new DataView(r.buffer,r.byteOffset,r.length)}peek(){return this.view.getUint8(this.x)}peak(){return this.peek()}skip(r){this.x+=r}buf(r){const i=this.x+r,s=this.uint8.subarray(this.x,i);return this.x=i,s}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let r=this.x;const i=(this.uint8[r++]<<8)+this.uint8[r++];return this.x=r,i}i16(){const r=this.view.getInt16(this.x);return this.x+=2,r}u32(){const r=this.view.getUint32(this.x);return this.x+=4,r}i32(){const r=this.view.getInt32(this.x);return this.x+=4,r}u64(){const r=this.view.getBigUint64(this.x);return this.x+=8,r}i64(){const r=this.view.getBigInt64(this.x);return this.x+=8,r}f32(){const r=this.x;return this.x+=4,this.view.getFloat32(r)}f64(){const r=this.x;return this.x+=8,this.view.getFloat64(r)}utf8(r){const i=this.x;return this.x+=r,(0,n.decodeUtf8)(this.uint8,i,r)}ascii(r){const i=this.uint8;let s="";const o=this.x+r;for(let a=this.x;a<o;a++)s+=String.fromCharCode(i[a]);return this.x=o,s}};return lw.Reader=e,lw}var aC={},hw={},cC={},s$;function cWe(){if(s$)return cC;s$=1,Object.defineProperty(cC,"__esModule",{value:!0});const n=String.fromCharCode;return cC.default=(e,t,r)=>{let i=t;const s=i+r;let o="";for(;i<s;){const a=e[i++];if((a&128)===0){o+=n(a);continue}const c=e[i++]&63;if((a&224)===192){o+=n((a&31)<<6|c);continue}const l=e[i++]&63;if((a&240)===224){o+=n((a&31)<<12|c<<6|l);continue}if((a&248)===240){const u=e[i++]&63;let h=(a&7)<<18|c<<12|l<<6|u;if(h>65535){h-=65536;const f=h>>>10&1023|55296;h=56320|h&1023,o+=n(f,h)}else o+=n(h)}else o+=n(a)}return o},cC}var o$;function lWe(){if(o$)return hw;o$=1,Object.defineProperty(hw,"__esModule",{value:!0}),hw.CachedUtf8Decoder=void 0;const e=Kb.__importDefault(cWe());let t=1+Math.round(Math.random()*((-1>>>0)-1));function r(o,a){return t^=t<<13,t^=t>>>17,t^=t<<5,(t>>>0)%(a-o+1)+o}class i{constructor(a,c){this.bytes=a,this.value=c}}let s=class{constructor(){this.caches=[];for(let a=0;a<31;a++)this.caches.push([])}get(a,c,l){const u=this.caches[l-1],h=u.length;e:for(let f=0;f<h;f++){const d=u[f],p=d.bytes;for(let _=0;_<l;_++)if(p[_]!==a[c+_])continue e;return d.value}return null}store(a,c){const l=this.caches[a.length-1],u=new i(a,c);l.length>=16?l[r(0,15)]=u:l.push(u)}decode(a,c,l){if(!l)return"";const u=this.get(a,c,l);if(u!==null)return u;const h=(0,e.default)(a,c,l),f=Uint8Array.prototype.slice.call(a,c,c+l);return this.store(f,h),h}};return hw.CachedUtf8Decoder=s,hw}var a$;function uWe(){if(a$)return aC;a$=1,Object.defineProperty(aC,"__esModule",{value:!0});const n=lWe();return aC.default=new n.CachedUtf8Decoder,aC}var c$;function hWe(){if(c$)return aw;c$=1,Object.defineProperty(aw,"__esModule",{value:!0}),aw.MsgPackDecoderFast=void 0;const n=Kb,e=nWe(),t=aWe(),r=n.__importDefault(uWe());let i=class{constructor(o=new t.Reader,a=r.default){this.reader=o,this.keyDecoder=a}decode(o){return this.reader.reset(o),this.readAny()}read(o){return this.reader.reset(o),this.readAny()}val(){return this.readAny()}readAny(){const o=this.reader,a=o.u8();if(a>=224)return a-256;if(a<=191)return a<144?a<=127?a:this.obj(a&15):a<160?this.arr(a&15):o.utf8(a&31);if(a<=208)return a<=200?a<=196?a<=194?a===194?!1:a===192?null:void 0:a===196?o.buf(o.u8()):!0:a<=198?a===198?o.buf(o.u32()):o.buf(o.u16()):a===200?this.ext(o.u16()):this.ext(o.u8()):a<=204?a<=202?a===202?o.f32():this.ext(o.u32()):a===204?o.u8():o.f64():a<=206?a===206?o.u32():o.u16():a===208?o.i8():o.u32()*4294967296+o.u32();if(a<=216)return a<=212?a<=210?a===210?o.i32():o.i16():a===212?this.ext(1):o.i32()*4294967296+o.u32():a<=214?a===214?this.ext(4):this.ext(2):a===216?this.ext(16):this.ext(8);switch(a){case 217:return o.utf8(o.u8());case 218:return o.utf8(o.u16());case 219:return o.utf8(o.u32());case 220:return this.arr(o.u16());case 221:return this.arr(o.u32());case 222:return this.obj(o.u16());case 223:return this.obj(o.u32())}}str(){const o=this.reader,a=o.u8();if(a>>5===5)return o.utf8(a&31);switch(a){case 217:return o.utf8(o.u8());case 218:return o.utf8(o.u16());case 219:return o.utf8(o.u32())}}obj(o){const a={};for(let c=0;c<o;c++){const l=this.key();if(l==="__proto__")throw 6;a[l]=this.readAny()}return a}key(){const o=this.reader,a=o.view.getUint8(o.x);if(a>=160&&a<=191){const c=a&31,l=this.keyDecoder.decode(o.uint8,o.x+1,c);return o.x+=1+c,l}else if(a===217){const c=o.view.getUint8(o.x+1);if(c<32){const l=this.keyDecoder.decode(o.uint8,o.x+2,c);return o.x+=2+c,l}}switch(o.x++,a){case 217:return o.utf8(o.u8());case 218:return o.utf8(o.u16());case 219:return o.utf8(o.u32());default:return""}}arr(o){const a=[];for(let c=0;c<o;c++)a.push(this.readAny());return a}ext(o){const a=this.reader,c=a.u8(),l=a.x+o,u=a.uint8.subarray(a.x,l);return a.x=l,new e.JsonPackExtension(c,u)}back(o){this.reader.x-=o}};return aw.MsgPackDecoderFast=i,aw}var fWe=hWe();class dWe extends fWe.MsgPackDecoderFast{options;constructor(e){super(),this.options=e}decode(e){return this.reader.reset(e),this.decodePatch()}decodePatch(){const e=this.decodeArrayHeader(),t=[];for(let r=0;r<e;r++)t.push(this.decodeOp(void 0));return t}decodeOp(e){const t=this.decodeArrayHeader();switch(this.reader.u8()){case En.add:{const i=this.decodeArray(),s=this.val();return new tB(i,s)}case En.and:{const i=this.decodePath(e),s=this.decodeArrayHeader(),o=[],a=new X$e(i,o);for(let c=0;c<s;c++)o.push(this.decodeOp(a));return a}case En.contains:{const i=this.decodePath(e),s=this.decodeString(),o=t>3;return new G$e(i,s,o)}case En.copy:{const i=this.decodeArray(),s=this.decodeArray();return new w$e(i,s)}case En.defined:{const i=this.decodePath(e);return new B$e(i)}case En.ends:{const i=this.decodePath(e),s=this.decodeString(),o=t>3;return new $$e(i,s,o)}case En.extend:{const i=this.decodeArray(),s=this.decodeObject(),o=t>3;return new U$e(i,s,o)}case En.flip:{const i=this.decodeArray();return new M$e(i)}case En.in:{const i=this.decodePath(e),s=this.decodeArray();return new q$e(i,s)}case En.inc:{const i=this.decodePath(e),s=this.val();return new k$e(i,s)}case En.less:{const i=this.decodePath(e),s=this.val();return new Y$e(i,s)}case En.matches:{const i=this.decodePath(e),s=this.decodeString(),o=t>3;return new Q$e(i,s,o,this.options.createMatcher||N$e)}case En.merge:{const i=t>3,s=this.decodeArray(),o=this.val(),a=i?this.decodeObject():null;return new D$e(s,o,a)}case En.more:{const i=this.decodePath(e),s=this.val();return new K$e(i,s)}case En.move:{const i=this.decodeArray(),s=this.decodeArray();return new T$e(i,s)}case En.not:{const i=this.decodePath(e),s=this.decodeArrayHeader(),o=[],a=new J$e(i,o);for(let c=0;c<s;c++)o.push(this.decodeOp(a));return a}case En.or:{const i=this.decodePath(e),s=this.decodeArrayHeader(),o=[],a=new Z$e(i,o);for(let c=0;c<s;c++)o.push(this.decodeOp(a));return a}case En.remove:{const i=this.decodeArray(),o=t>2?this.val():void 0;return new Are(i,o)}case En.replace:{const i=this.decodeArray(),s=this.val(),a=t>3?this.val():void 0;return new x$e(i,s,a)}case En.split:{const i=this.decodeArray(),s=this.val(),a=t>3?this.decodeObject():null;return new P$e(i,s,a)}case En.starts:{const i=t>3,s=this.decodePath(e),o=this.decodeString();return new W$e(s,o,i)}case En.str_del:{const i=t<5,s=this.decodeArray(),o=this.val();if(i){const a=this.decodeString();return new JG(s,o,a,void 0)}else{this.reader.u8();const a=this.val();return new JG(s,o,void 0,a)}}case En.str_ins:{const i=this.decodeArray(),s=this.val(),o=this.decodeString();return new O$e(i,s,o)}case En.test:{const i=t>3,s=this.decodePath(e),o=this.val();return new C$e(s,o,i)}case En.test_string:{const i=t>4,s=this.decodePath(e),o=this.val(),a=this.decodeString();return new H$e(s,o,a,i)}case En.test_string_len:{const i=t>3,s=this.decodePath(e),o=this.val();return new V$e(s,o,i)}case En.test_type:{const i=this.decodePath(e),s=this.decodeArray();return new z$e(i,s)}case En.type:{const i=this.decodePath(e),s=this.decodeString();return new tWe(i,s)}case En.undefined:{const i=this.decodePath(e);return new F$e(i)}}throw new Error("OP_UNKNOWN")}decodePath(e){const t=this.decodeArray();return e?[...e.path,...t]:t}decodeObject(){const e=this.reader,t=e.u8();return t<=191?this.obj(t&15):t===222?this.obj(e.u16()):this.obj(e.u32())}decodeArray(){const e=this.reader,t=e.u8();return t<159?this.arr(t&15):t===220?this.arr(e.u16()):this.arr(e.u32())}decodeArrayHeader(){const e=this.reader,t=e.u8();return t<159?t&15:t===220?e.u16():e.u32()}decodeString(){const e=this.reader,t=e.u8();return t<=191?e.utf8(t&31):t===217?e.utf8(e.u8()):t===218?e.utf8(e.u16()):e.utf8(e.u32())}}function pWe(n){const e=[],t=n.length;for(let r=0;r<t;r++)e.push(n[r].toJson());return e}var Cre=(n=>(n[n.id=0]="id",n[n.x=1]="x",n[n.y=2]="y",n[n.char=3]="char",n[n.color=4]="color",n[n.bg=5]="bg",n[n.stat=6]="stat",n[n.pid=7]="pid",n))(Cre||{});function mWe(n){return o6(n,Cre)}var Mre=(n=>(n[n.id=0]="id",n[n.type=1]="type",n[n.tag=2]="tag",n[n.width=3]="width",n[n.height=4]="height",n[n.char=5]="char",n[n.color=6]="color",n[n.bg=7]="bg",n[n.stats=8]="stats",n[n.sprites=9]="sprites",n[n.alphas=10]="alphas",n[n.mime=11]="mime",n[n.media=12]="media",n[n.focusx=13]="focusx",n[n.focusy=14]="focusy",n[n.focusid=15]="focusid",n[n.viewscale=16]="viewscale",n[n.graphics=17]="graphics",n[n.facing=18]="facing",n))(Mre||{});function gWe(n){return o6(n,Mre,{sprites:e=>e.map(mWe)})}var kre=(n=>(n[n.id=0]="id",n[n.board=1]="board",n[n.over=2]="over",n[n.under=3]="under",n[n.layers=4]="layers",n[n.tickers=5]="tickers",n[n.scrollname=6]="scrollname",n[n.scroll=7]="scroll",n[n.sidebar=8]="sidebar",n))(kre||{});function l$(n){return o6(n,kre,{layers:e=>e.map(gWe)})}const _We=new dWe({}),u$=y0("gadgetclient",[],n=>{if(!u$.session(n)||n.player!==Qr())return;const{desync:e}=Jr.getState();switch(n.target){case"paint":{const t=l$(n.data);Jr.setState({desync:!1,gadget:t,slim:n.data});break}case"patch":e||Jr.setState(t=>{let r;try{const i=_We.decode(n.data),s=pWe(i),o=qk(Us(t.slim),s,!0,!0),a=l$(o.newDocument);return{...t,gadget:a,gadgetlayercache:{...t.gadgetlayercache,[a?.board??""]:a?.layers??[]},slim:o.newDocument}}catch(i){r=i}return fe(r)?(u$.reply(n,"desync"),{...t,desync:!0}):t});break}}),rB=Object.prototype.toString.call(typeof oc<"u"?oc:0)==="[object process]";var gv,Sr;(function(n){n[n.CRITICAL=0]="CRITICAL",n[n.ERROR=1]="ERROR",n[n.WARNING=2]="WARNING",n[n.INFO=3]="INFO",n[n.DEBUG=4]="DEBUG",n[n.TRACE=7]="TRACE"})(Sr||(Sr={}));function iB(n){if(typeof n=="number"){if(Object.prototype.hasOwnProperty.call(Sr,n))return n;var e=Object.keys(Sr).map(function(r){return parseInt(r,10)}).filter(function(r){return!isNaN(r)&&r<n});return e.length?Math.max.apply(Math,e):Sr.WARNING}var t=n.replace(/\d+$/,"").toUpperCase();if(!Object.prototype.hasOwnProperty.call(Sr,t))throw new Error("Unknown log level string: ".concat(n));return Sr[t]}var vWe=rB?console.log.bind(console):console.debug.bind(console),Ore=(gv={},gv[Sr.CRITICAL]=console.error.bind(console),gv[Sr.ERROR]=console.error.bind(console),gv[Sr.WARNING]=console.warn.bind(console),gv[Sr.INFO]=console.info.bind(console),gv[Sr.DEBUG]=vWe.bind(console),gv[Sr.TRACE]=console.trace.bind(console),gv);function ly(n){return function(e,t){Object.defineProperty(e,t,{get:function(){},set:function(r){Object.defineProperty(this,t,{value:r,writable:!0,enumerable:n})},enumerable:n})}}function P4(n){return ro(this,void 0,Promise,function(){return ER(this,function(e){switch(e.label){case 0:return typeof n!="function"?[3,2]:[4,n()];case 1:return[2,e.sent()];case 2:return[2,n]}})})}function yWe(n){return typeof n=="function"?n():n}function Ire(n){var e,t,r;return ER(this,function(i){switch(i.label){case 0:e=0,t=1,i.label=1;case 1:return e<n?[4,e]:[3,3];case 2:return i.sent(),r=Vb([t,e+t],2),e=r[0],t=r[1],[3,1];case 3:return[4,n];case 4:return i.sent(),[3,3];case 5:return[2]}})}function lC(n,e){return Object.assign.apply(Object,RA([{}],Vb(n.map(e)),!1))}function D4(n,e){Object.entries(n).forEach(function(t){var r=Vb(t,2),i=r[0],s=r[1];return e(s,i)})}function Nre(n){return n==null}function NA(n,e){return Nre(n)?null:e(n)}function Pre(n,e){return Nre(n)?void 0:e(n)}function bWe(n){return ro(this,void 0,Promise,function(){return ER(this,function(e){switch(e.label){case 0:return[4,new Promise(function(t){return setTimeout(t,n)})];case 1:return e.sent(),[2]}})})}function L4(){var n,e,t=new Promise(function(r,i){n=r,e=i});return{promise:t,resolve:n,reject:e}}function SWe(n,e,t){if(typeof n=="number"&&(n=n.toString()),e=e-n.length,e<=0)return n;t===void 0&&(t=" ");var r="";do(e&1)===1&&(r+=t),e>>=1,e&&(t+=t);while(e);return r+n}function rb(n,e,t){var r=n.split(e);return r.length<=t?r:RA(RA([],Vb(r.slice(0,t-1)),!1),[r.slice(t-1).join(e)],!1)}var EWe={},QP,eD,Ck=typeof oc>"u"?[]:(eD=(QP=EWe.LOGGING)===null||QP===void 0?void 0:QP.split(";").map(function(n){var e=n.split("=",2),t=e[0],r=e[1];return r?[t==="default"?void 0:t.split(":"),iB(r)]:null}).filter(function(n){return!!n}).sort(function(n,e){var t,r,i=n[0],s=e[0];return((t=s?.length)!==null&&t!==void 0?t:0)-((r=i?.length)!==null&&r!==void 0?r:0)}))!==null&&eD!==void 0?eD:[],tD=Ck.findIndex(function(n){var e=n[0];return!e}),Dre=void 0;tD!==-1&&(Dre=Ck[tD][1],Ck.splice(tD));function xWe(n,e){return e.length<=n.length&&e.every(function(t,r){return t===n[r]})}function Lre(n){for(var e=n.split(":"),t=0,r=Ck;t<r.length;t++){var i=r[t],s=i[0],o=i[1];if(xWe(e,s))return o}return Dre}var Ure=(function(){function n(e){var t=e.name,r=e.minLevel,i=e.emoji,s=i===void 0?!1:i,o=e.colors,a=e.timestamps,c=a===void 0?rB:a,l,u;this._name=t,this._minLevel=(u=(l=Pre(r,function(h){return iB(h)}))!==null&&l!==void 0?l:Lre(t))!==null&&u!==void 0?u:Sr.WARNING,this._emoji=s,this._colors=o,this._timestamps=c}return n.prototype.crit=function(e){this.log(Sr.CRITICAL,e)},n.prototype.error=function(e){this.log(Sr.ERROR,e)},n.prototype.warn=function(e){this.log(Sr.WARNING,e)},n.prototype.info=function(e){this.log(Sr.INFO,e)},n.prototype.debug=function(e){this.log(Sr.DEBUG,e)},n.prototype.trace=function(e){this.log(Sr.TRACE,e)},n})(),TWe=(function(n){YO(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.log=function(t,r){if(!(t>this._minLevel)){var i=Ore[t],s="[".concat(this._name,"] ").concat(r);this._timestamps&&(s="[".concat(new Date().toISOString(),"] ").concat(r)),i(s)}},e})(Ure),wWe=(function(){function n(e){var t=e.name,r=e.minLevel,i=e.custom,s;this._minLevel=(s=Pre(r,function(o){return iB(o)}))!==null&&s!==void 0?s:Lre(t),this._override=typeof i=="function"?{log:i}:i}return n.prototype.log=function(e,t){this._shouldLog(e)&&this._override.log(e,t)},n.prototype.crit=function(e){this._override.crit?this._shouldLog(Sr.CRITICAL)&&this._override.crit(e):this.log(Sr.CRITICAL,e)},n.prototype.error=function(e){this._override.error?this._shouldLog(Sr.ERROR)&&this._override.error(e):this.log(Sr.ERROR,e)},n.prototype.warn=function(e){this._override.warn?this._shouldLog(Sr.WARNING)&&this._override.warn(e):this.log(Sr.WARNING,e)},n.prototype.info=function(e){this._override.info?this._shouldLog(Sr.INFO)&&this._override.info(e):this.log(Sr.INFO,e)},n.prototype.debug=function(e){this._override.debug?this._shouldLog(Sr.DEBUG)&&this._override.debug(e):this.log(Sr.DEBUG,e)},n.prototype.trace=function(e){this._override.trace?this._shouldLog(Sr.TRACE)&&this._override.trace(e):this.log(Sr.TRACE,e)},n.prototype._shouldLog=function(e){return this._minLevel===void 0||this._minLevel>=e},n})(),_v,vv,yv,AWe=(_v={},_v[Sr.CRITICAL]="",_v[Sr.ERROR]="",_v[Sr.WARNING]=" ",_v[Sr.INFO]=" ",_v[Sr.DEBUG]="",_v[Sr.TRACE]="",_v),RWe={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,blackBright:90,redBright:91,greenBright:92,yellowBright:93,blueBright:94,magentaBright:95,cyanBright:96,whiteBright:97},CWe={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgBlackBright:100,bgRedBright:101,bgGreenBright:102,bgYellowBright:103,bgBlueBright:104,bgMagentaBright:105,bgCyanBright:106,bgWhiteBright:107};function _3(n,e,t){return function(r){return"\x1B[".concat(n,"m").concat(t?t(r):r,"\x1B[").concat(e,"m")}}function Gm(n){return _3(RWe[n],39)}function fw(n,e){return _3(CWe[n],49,e)}var MWe=(vv={},vv[Sr.CRITICAL]=Gm("red"),vv[Sr.ERROR]=Gm("redBright"),vv[Sr.WARNING]=Gm("yellow"),vv[Sr.INFO]=Gm("blue"),vv[Sr.DEBUG]=Gm("magenta"),vv[Sr.TRACE]=_3(0,0),vv),h$=(yv={},yv[Sr.CRITICAL]=fw("bgRed",Gm("white")),yv[Sr.ERROR]=fw("bgRedBright",Gm("white")),yv[Sr.WARNING]=fw("bgYellow",Gm("black")),yv[Sr.INFO]=fw("bgBlue",Gm("white")),yv[Sr.DEBUG]=fw("bgMagenta",Gm("black")),yv[Sr.TRACE]=_3(7,27),yv),kWe=(function(n){YO(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.log=function(t,r){var i,s,o;if(!(t>this._minLevel)){var a=Ore[t],c="";if(this._timestamps&&(c+="[".concat(new Date().toISOString(),"] ")),this._emoji){var l=AWe[t];c+="".concat(l," ")}var u=(o=(i=this._colors)!==null&&i!==void 0?i:(s=oc.stdout)===null||s===void 0?void 0:s.isTTY)!==null&&o!==void 0?o:!0;u?c+="".concat(h$[t](this._name)," ").concat(h$[t](Sr[t])," ").concat(MWe[t](r)):c+="[".concat(this._name,":").concat(Sr[t].toLowerCase(),"] ").concat(r),a(c)}},e})(Ure);function v3(n){return n.custom?new wWe(n):rB?new kWe(n):new TWe(n)}let Bre=class extends Error{constructor(...e){var t;super(...e),Object.setPrototypeOf(this,new.target.prototype),(t=Error.captureStackTrace)===null||t===void 0||t.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}};class Mk extends Bre{}class Fre extends Bre{}class OWe{constructor({logger:e,bucketSize:t,timeFrame:r,doRequest:i,getPartitionKey:s}){this._partitionedQueue=new Map,this._usedFromBucket=new Map,this._counterTimers=new Set,this._paused=!1,this._destroyed=!1,this._logger=v3({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=t,this._timeFrame=r,this._callback=i,this._partitionKeyCallback=s}async request(e,t){return await new Promise((r,i)=>{var s,o;if(this._destroyed){i(new Mk("Rate limiter was destroyed"));return}const a={req:e,resolve:r,reject:i,limitReachedBehavior:(s=t?.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"},c=this._partitionKeyCallback(e),l=(o=this._usedFromBucket.get(c))!==null&&o!==void 0?o:0;if(l>=this._bucketSize||this._paused)switch(a.limitReachedBehavior){case"enqueue":{const u=this._getPartitionedQueue(c);u.push(a),l+u.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${u.length}`):this._logger.info(`Enqueueing request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused; queue size is ${u.length}`);break}case"null":{a.resolve(null),this._paused?this._logger.info(`Returning null for request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused`):this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, dropping request and returning null`);break}case"throw":{a.reject(new Fre(`Request dropped because ${this._paused?"the rate limiter is paused":`the rate limit for ${c?`partition ${c}`:"default partition"} was reached`}`));break}default:throw new Error("this should never happen")}else this._runRequest(a,c)})}clear(){this._partitionedQueue.clear()}pause(){this._paused=!0}resume(){this._paused=!1;for(const e of this._partitionedQueue.keys())this._runNextRequest(e)}destroy(){this._paused=!1,this._destroyed=!0,this._counterTimers.forEach(e=>{clearTimeout(e)});for(const e of this._partitionedQueue.values())for(const t of e)t.reject(new Mk("Rate limiter was destroyed"));this._partitionedQueue.clear()}_getPartitionedQueue(e){if(this._partitionedQueue.has(e))return this._partitionedQueue.get(e);const t=[];return this._partitionedQueue.set(e,t),t}async _runRequest(e,t){var r;const i=this._getPartitionedQueue(t);this._logger.debug(`doing a request for ${t?`partition ${t}`:"default partition"}, new queue length is ${i.length}`),this._usedFromBucket.set(t,((r=this._usedFromBucket.get(t))!==null&&r!==void 0?r:0)+1);const{req:s,resolve:o,reject:a}=e;try{o(await this._callback(s))}catch(c){a(c)}finally{const c=setTimeout(()=>{this._counterTimers.delete(c);const l=this._usedFromBucket.get(t)-1;this._usedFromBucket.set(t,l),i.length&&l<this._bucketSize&&this._runNextRequest(t)},this._timeFrame);this._counterTimers.add(c)}}_runNextRequest(e){if(this._paused)return;const r=this._getPartitionedQueue(e).shift();r&&this._runRequest(r,e)}}class U4{constructor({logger:e,bucketSize:t,timeFrame:r,doRequest:i}){this._queue=[],this._usedFromBucket=0,this._counterTimers=new Set,this._paused=!1,this._destroyed=!1,this._logger=v3({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=t,this._timeFrame=r,this._callback=i}async request(e,t){return await new Promise((r,i)=>{var s;if(this._destroyed){i(new Mk("Rate limiter was destroyed"));return}const o={req:e,resolve:r,reject:i,limitReachedBehavior:(s=t?.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"};if(this._usedFromBucket>=this._bucketSize||this._paused)switch(o.limitReachedBehavior){case"enqueue":{this._queue.push(o),this._usedFromBucket+this._queue.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${this._queue.length}`):this._logger.info(`Enqueueing request because the rate limiter is paused; queue size is ${this._queue.length}`);break}case"null":{o.resolve(null),this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`),this._paused?this._logger.info("Returning null for request because the rate limiter is paused"):this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`);break}case"throw":{o.reject(new Fre(`Request dropped because ${this._paused?"the rate limiter is paused":"the rate limit was reached"}`));break}default:throw new Error("this should never happen")}else this._runRequest(o)})}clear(){this._queue=[]}pause(){this._paused=!0}resume(){this._paused=!1,this._runNextRequest()}destroy(){this._paused=!1,this._destroyed=!0,this._counterTimers.forEach(e=>{clearTimeout(e)});for(const e of this._queue)e.reject(new Mk("Rate limiter was destroyed"));this._queue=[]}async _runRequest(e){this._logger.debug(`doing a request, new queue length is ${this._queue.length}`),this._usedFromBucket+=1;const{req:t,resolve:r,reject:i}=e;try{r(await this._callback(t))}catch(s){i(s)}finally{const s=setTimeout(()=>{this._counterTimers.delete(s),this._usedFromBucket-=1,this._queue.length&&this._usedFromBucket<this._bucketSize&&this._runNextRequest()},this._timeFrame);this._counterTimers.add(s)}}_runNextRequest(){if(this._paused)return;const e=this._queue.shift();e&&this._runRequest(e)}}class IWe extends U4{constructor(e,t){super({...t,async doRequest(r,i){return await e.request(r,i)}})}}class NWe{constructor(e,t,r,i=!1){this.owner=e,this.event=t,this.listener=r,this._internal=i}unbind(){this.owner.removeListener(this)}}class BR{constructor(){this._eventListeners=new Map,this._internalEventListeners=new Map}on(e,t){return this._addListener(!1,e,t)}addListener(e,t){return this._addListener(!1,e,t)}removeListener(e,t){this._removeListener(!1,e,t)}registerEvent(){const e=t=>this.addListener(e,t);return e}emit(e,...t){if(this._eventListeners.has(e))for(const r of this._eventListeners.get(e))r(...t);if(this._internalEventListeners.has(e))for(const r of this._internalEventListeners.get(e))r(...t)}registerInternalEvent(){const e=t=>this.addInternalListener(e,t);return e}addInternalListener(e,t){return this._addListener(!0,e,t)}removeInternalListener(e,t){this._removeListener(!0,e,t)}_addListener(e,t,r){const i=e?this._eventListeners:this._internalEventListeners;return i.has(t)?i.get(t).push(r):i.set(t,[r]),new NWe(this,t,r,e)}_removeListener(e,t,r){const i=e?this._eventListeners:this._internalEventListeners;if(!t)i.clear();else if(typeof t=="object"){const s=t;this._removeListener(s._internal,s.event,s.listener)}else{const s=t;if(i.has(s))if(r){const o=i.get(s);let a=0;for(;(a=o.indexOf(r))!==-1;)o.splice(a,1)}else i.delete(s)}}}const PWe=6e4;function DWe(n){return NA(n.expiresIn,e=>n.obtainmentTimestamp+e*1e3-PWe)}function ZC(n){var e;return(e=NA(DWe(n),t=>Date.now()>t))!==null&&e!==void 0?e:!1}var Tw={exports:{}},LWe=Tw.exports,f$;function UWe(){return f$||(f$=1,(function(n,e){var t=typeof self<"u"?self:LWe,r=(function(){function s(){this.fetch=!1,this.DOMException=t.DOMException}return s.prototype=t,new s})();(function(s){(function(o){var a={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function c(M){return M&&DataView.prototype.isPrototypeOf(M)}if(a.arrayBuffer)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(M){return M&&l.indexOf(Object.prototype.toString.call(M))>-1};function h(M){if(typeof M!="string"&&(M=String(M)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(M))throw new TypeError("Invalid character in header field name");return M.toLowerCase()}function f(M){return typeof M!="string"&&(M=String(M)),M}function d(M){var F={next:function(){var Z=M.shift();return{done:Z===void 0,value:Z}}};return a.iterable&&(F[Symbol.iterator]=function(){return F}),F}function p(M){this.map={},M instanceof p?M.forEach(function(F,Z){this.append(Z,F)},this):Array.isArray(M)?M.forEach(function(F){this.append(F[0],F[1])},this):M&&Object.getOwnPropertyNames(M).forEach(function(F){this.append(F,M[F])},this)}p.prototype.append=function(M,F){M=h(M),F=f(F);var Z=this.map[M];this.map[M]=Z?Z+", "+F:F},p.prototype.delete=function(M){delete this.map[h(M)]},p.prototype.get=function(M){return M=h(M),this.has(M)?this.map[M]:null},p.prototype.has=function(M){return this.map.hasOwnProperty(h(M))},p.prototype.set=function(M,F){this.map[h(M)]=f(F)},p.prototype.forEach=function(M,F){for(var Z in this.map)this.map.hasOwnProperty(Z)&&M.call(F,this.map[Z],Z,this)},p.prototype.keys=function(){var M=[];return this.forEach(function(F,Z){M.push(Z)}),d(M)},p.prototype.values=function(){var M=[];return this.forEach(function(F){M.push(F)}),d(M)},p.prototype.entries=function(){var M=[];return this.forEach(function(F,Z){M.push([Z,F])}),d(M)},a.iterable&&(p.prototype[Symbol.iterator]=p.prototype.entries);function _(M){if(M.bodyUsed)return Promise.reject(new TypeError("Already read"));M.bodyUsed=!0}function g(M){return new Promise(function(F,Z){M.onload=function(){F(M.result)},M.onerror=function(){Z(M.error)}})}function m(M){var F=new FileReader,Z=g(F);return F.readAsArrayBuffer(M),Z}function b(M){var F=new FileReader,Z=g(F);return F.readAsText(M),Z}function y(M){for(var F=new Uint8Array(M),Z=new Array(F.length),$=0;$<F.length;$++)Z[$]=String.fromCharCode(F[$]);return Z.join("")}function x(M){if(M.slice)return M.slice(0);var F=new Uint8Array(M.byteLength);return F.set(new Uint8Array(M)),F.buffer}function T(){return this.bodyUsed=!1,this._initBody=function(M){this._bodyInit=M,M?typeof M=="string"?this._bodyText=M:a.blob&&Blob.prototype.isPrototypeOf(M)?this._bodyBlob=M:a.formData&&FormData.prototype.isPrototypeOf(M)?this._bodyFormData=M:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(M)?this._bodyText=M.toString():a.arrayBuffer&&a.blob&&c(M)?(this._bodyArrayBuffer=x(M.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(M)||u(M))?this._bodyArrayBuffer=x(M):this._bodyText=M=Object.prototype.toString.call(M):this._bodyText="",this.headers.get("content-type")||(typeof M=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(M)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var M=_(this);if(M)return M;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?_(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(m)}),this.text=function(){var M=_(this);if(M)return M;if(this._bodyBlob)return b(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(y(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(B)}),this.json=function(){return this.text().then(JSON.parse)},this}var k=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function R(M){var F=M.toUpperCase();return k.indexOf(F)>-1?F:M}function P(M,F){F=F||{};var Z=F.body;if(M instanceof P){if(M.bodyUsed)throw new TypeError("Already read");this.url=M.url,this.credentials=M.credentials,F.headers||(this.headers=new p(M.headers)),this.method=M.method,this.mode=M.mode,this.signal=M.signal,!Z&&M._bodyInit!=null&&(Z=M._bodyInit,M.bodyUsed=!0)}else this.url=String(M);if(this.credentials=F.credentials||this.credentials||"same-origin",(F.headers||!this.headers)&&(this.headers=new p(F.headers)),this.method=R(F.method||this.method||"GET"),this.mode=F.mode||this.mode||null,this.signal=F.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&Z)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Z)}P.prototype.clone=function(){return new P(this,{body:this._bodyInit})};function B(M){var F=new FormData;return M.trim().split("&").forEach(function(Z){if(Z){var $=Z.split("="),Y=$.shift().replace(/\+/g," "),Q=$.join("=").replace(/\+/g," ");F.append(decodeURIComponent(Y),decodeURIComponent(Q))}}),F}function U(M){var F=new p,Z=M.replace(/\r?\n[\t ]+/g," ");return Z.split(/\r?\n/).forEach(function($){var Y=$.split(":"),Q=Y.shift().trim();if(Q){var q=Y.join(":").trim();F.append(Q,q)}}),F}T.call(P.prototype);function z(M,F){F||(F={}),this.type="default",this.status=F.status===void 0?200:F.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in F?F.statusText:"OK",this.headers=new p(F.headers),this.url=F.url||"",this._initBody(M)}T.call(z.prototype),z.prototype.clone=function(){return new z(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},z.error=function(){var M=new z(null,{status:0,statusText:""});return M.type="error",M};var I=[301,302,303,307,308];z.redirect=function(M,F){if(I.indexOf(F)===-1)throw new RangeError("Invalid status code");return new z(null,{status:F,headers:{location:M}})},o.DOMException=s.DOMException;try{new o.DOMException}catch{o.DOMException=function(F,Z){this.message=F,this.name=Z;var $=Error(F);this.stack=$.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function L(M,F){return new Promise(function(Z,$){var Y=new P(M,F);if(Y.signal&&Y.signal.aborted)return $(new o.DOMException("Aborted","AbortError"));var Q=new XMLHttpRequest;function q(){Q.abort()}Q.onload=function(){var V={status:Q.status,statusText:Q.statusText,headers:U(Q.getAllResponseHeaders()||"")};V.url="responseURL"in Q?Q.responseURL:V.headers.get("X-Request-URL");var K="response"in Q?Q.response:Q.responseText;Z(new z(K,V))},Q.onerror=function(){$(new TypeError("Network request failed"))},Q.ontimeout=function(){$(new TypeError("Network request failed"))},Q.onabort=function(){$(new o.DOMException("Aborted","AbortError"))},Q.open(Y.method,Y.url,!0),Y.credentials==="include"?Q.withCredentials=!0:Y.credentials==="omit"&&(Q.withCredentials=!1),"responseType"in Q&&a.blob&&(Q.responseType="blob"),Y.headers.forEach(function(V,K){Q.setRequestHeader(K,V)}),Y.signal&&(Y.signal.addEventListener("abort",q),Q.onreadystatechange=function(){Q.readyState===4&&Y.signal.removeEventListener("abort",q)}),Q.send(typeof Y._bodyInit>"u"?null:Y._bodyInit)})}return L.polyfill=!0,s.fetch||(s.fetch=L,s.Headers=p,s.Request=P,s.Response=z),o.Headers=p,o.Request=P,o.Response=z,o.fetch=L,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=r;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,n.exports=e})(Tw,Tw.exports)),Tw.exports}var jre=UWe();const BWe=Dl(jre);var nD,d$;function sB(){if(d$)return nD;d$=1;var n=Object.prototype.hasOwnProperty,e=Array.isArray,t=(function(){for(var d=[],p=0;p<256;++p)d.push("%"+((p<16?"0":"")+p.toString(16)).toUpperCase());return d})(),r=function(p){for(;p.length>1;){var _=p.pop(),g=_.obj[_.prop];if(e(g)){for(var m=[],b=0;b<g.length;++b)typeof g[b]<"u"&&m.push(g[b]);_.obj[_.prop]=m}}},i=function(p,_){for(var g=_&&_.plainObjects?Object.create(null):{},m=0;m<p.length;++m)typeof p[m]<"u"&&(g[m]=p[m]);return g},s=function d(p,_,g){if(!_)return p;if(typeof _!="object"){if(e(p))p.push(_);else if(p&&typeof p=="object")(g&&(g.plainObjects||g.allowPrototypes)||!n.call(Object.prototype,_))&&(p[_]=!0);else return[p,_];return p}if(!p||typeof p!="object")return[p].concat(_);var m=p;return e(p)&&!e(_)&&(m=i(p,g)),e(p)&&e(_)?(_.forEach(function(b,y){if(n.call(p,y)){var x=p[y];x&&typeof x=="object"&&b&&typeof b=="object"?p[y]=d(x,b,g):p.push(b)}else p[y]=b}),p):Object.keys(_).reduce(function(b,y){var x=_[y];return n.call(b,y)?b[y]=d(b[y],x,g):b[y]=x,b},m)},o=function(p,_){return Object.keys(_).reduce(function(g,m){return g[m]=_[m],g},p)},a=function(d,p,_){var g=d.replace(/\+/g," ");if(_==="iso-8859-1")return g.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(g)}catch{return g}},c=function(p,_,g){if(p.length===0)return p;var m=p;if(typeof p=="symbol"?m=Symbol.prototype.toString.call(p):typeof p!="string"&&(m=String(p)),g==="iso-8859-1")return escape(m).replace(/%u[0-9a-f]{4}/gi,function(T){return"%26%23"+parseInt(T.slice(2),16)+"%3B"});for(var b="",y=0;y<m.length;++y){var x=m.charCodeAt(y);if(x===45||x===46||x===95||x===126||x>=48&&x<=57||x>=65&&x<=90||x>=97&&x<=122){b+=m.charAt(y);continue}if(x<128){b=b+t[x];continue}if(x<2048){b=b+(t[192|x>>6]+t[128|x&63]);continue}if(x<55296||x>=57344){b=b+(t[224|x>>12]+t[128|x>>6&63]+t[128|x&63]);continue}y+=1,x=65536+((x&1023)<<10|m.charCodeAt(y)&1023),b+=t[240|x>>18]+t[128|x>>12&63]+t[128|x>>6&63]+t[128|x&63]}return b},l=function(p){for(var _=[{obj:{o:p},prop:"o"}],g=[],m=0;m<_.length;++m)for(var b=_[m],y=b.obj[b.prop],x=Object.keys(y),T=0;T<x.length;++T){var k=x[T],R=y[k];typeof R=="object"&&R!==null&&g.indexOf(R)===-1&&(_.push({obj:y,prop:k}),g.push(R))}return r(_),p},u=function(p){return Object.prototype.toString.call(p)==="[object RegExp]"},h=function(p){return!p||typeof p!="object"?!1:!!(p.constructor&&p.constructor.isBuffer&&p.constructor.isBuffer(p))},f=function(p,_){return[].concat(p,_)};return nD={arrayToObject:i,assign:o,combine:f,compact:l,decode:a,encode:c,isBuffer:h,isRegExp:u,merge:s},nD}var rD,p$;function zre(){if(p$)return rD;p$=1;var n=String.prototype.replace,e=/%20/g,t=sB(),r={RFC1738:"RFC1738",RFC3986:"RFC3986"};return rD=t.assign({default:r.RFC3986,formatters:{RFC1738:function(i){return n.call(i,e,"+")},RFC3986:function(i){return String(i)}}},r),rD}var iD,m$;function FWe(){if(m$)return iD;m$=1;var n=sB(),e=zre(),t=Object.prototype.hasOwnProperty,r={brackets:function(p){return p+"[]"},comma:"comma",indices:function(p,_){return p+"["+_+"]"},repeat:function(p){return p}},i=Array.isArray,s=Array.prototype.push,o=function(d,p){s.apply(d,i(p)?p:[p])},a=Date.prototype.toISOString,c=e.default,l={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:n.encode,encodeValuesOnly:!1,format:c,formatter:e.formatters[c],indices:!1,serializeDate:function(p){return a.call(p)},skipNulls:!1,strictNullHandling:!1},u=function(p){return typeof p=="string"||typeof p=="number"||typeof p=="boolean"||typeof p=="symbol"||typeof p=="bigint"},h=function d(p,_,g,m,b,y,x,T,k,R,P,B,U){var z=p;if(typeof x=="function"?z=x(_,z):z instanceof Date?z=R(z):g==="comma"&&i(z)&&(z=z.join(",")),z===null){if(m)return y&&!B?y(_,l.encoder,U,"key"):_;z=""}if(u(z)||n.isBuffer(z)){if(y){var I=B?_:y(_,l.encoder,U,"key");return[P(I)+"="+P(y(z,l.encoder,U,"value"))]}return[P(_)+"="+P(String(z))]}var L=[];if(typeof z>"u")return L;var M;if(i(x))M=x;else{var F=Object.keys(z);M=T?F.sort(T):F}for(var Z=0;Z<M.length;++Z){var $=M[Z];b&&z[$]===null||(i(z)?o(L,d(z[$],typeof g=="function"?g(_,$):_,g,m,b,y,x,T,k,R,P,B,U)):o(L,d(z[$],_+(k?"."+$:"["+$+"]"),g,m,b,y,x,T,k,R,P,B,U)))}return L},f=function(p){if(!p)return l;if(p.encoder!==null&&p.encoder!==void 0&&typeof p.encoder!="function")throw new TypeError("Encoder has to be a function.");var _=p.charset||l.charset;if(typeof p.charset<"u"&&p.charset!=="utf-8"&&p.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var g=e.default;if(typeof p.format<"u"){if(!t.call(e.formatters,p.format))throw new TypeError("Unknown format option provided.");g=p.format}var m=e.formatters[g],b=l.filter;return(typeof p.filter=="function"||i(p.filter))&&(b=p.filter),{addQueryPrefix:typeof p.addQueryPrefix=="boolean"?p.addQueryPrefix:l.addQueryPrefix,allowDots:typeof p.allowDots>"u"?l.allowDots:!!p.allowDots,charset:_,charsetSentinel:typeof p.charsetSentinel=="boolean"?p.charsetSentinel:l.charsetSentinel,delimiter:typeof p.delimiter>"u"?l.delimiter:p.delimiter,encode:typeof p.encode=="boolean"?p.encode:l.encode,encoder:typeof p.encoder=="function"?p.encoder:l.encoder,encodeValuesOnly:typeof p.encodeValuesOnly=="boolean"?p.encodeValuesOnly:l.encodeValuesOnly,filter:b,formatter:m,serializeDate:typeof p.serializeDate=="function"?p.serializeDate:l.serializeDate,skipNulls:typeof p.skipNulls=="boolean"?p.skipNulls:l.skipNulls,sort:typeof p.sort=="function"?p.sort:null,strictNullHandling:typeof p.strictNullHandling=="boolean"?p.strictNullHandling:l.strictNullHandling}};return iD=function(d,p){var _=d,g=f(p),m,b;typeof g.filter=="function"?(b=g.filter,_=b("",_)):i(g.filter)&&(b=g.filter,m=b);var y=[];if(typeof _!="object"||_===null)return"";var x;p&&p.arrayFormat in r?x=p.arrayFormat:p&&"indices"in p?x=p.indices?"indices":"repeat":x="indices";var T=r[x];m||(m=Object.keys(_)),g.sort&&m.sort(g.sort);for(var k=0;k<m.length;++k){var R=m[k];g.skipNulls&&_[R]===null||o(y,h(_[R],R,T,g.strictNullHandling,g.skipNulls,g.encode?g.encoder:null,g.filter,g.sort,g.allowDots,g.serializeDate,g.formatter,g.encodeValuesOnly,g.charset))}var P=y.join(g.delimiter),B=g.addQueryPrefix===!0?"?":"";return g.charsetSentinel&&(g.charset==="iso-8859-1"?B+="utf8=%26%2310003%3B&":B+="utf8=%E2%9C%93&"),P.length>0?B+P:""},iD}var jWe=FWe();const Hre=Dl(jWe);var sD,g$;function zWe(){if(g$)return sD;g$=1;var n=sB(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},i=function(d){return d.replace(/&#(\d+);/g,function(p,_){return String.fromCharCode(parseInt(_,10))})},s=function(d,p){return d&&typeof d=="string"&&p.comma&&d.indexOf(",")>-1?d.split(","):d},o=function(p,_){if(t(p)){for(var g=[],m=0;m<p.length;m+=1)g.push(_(p[m]));return g}return _(p)},a="utf8=%26%2310003%3B",c="utf8=%E2%9C%93",l=function(p,_){var g={},m=_.ignoreQueryPrefix?p.replace(/^\?/,""):p,b=_.parameterLimit===1/0?void 0:_.parameterLimit,y=m.split(_.delimiter,b),x=-1,T,k=_.charset;if(_.charsetSentinel)for(T=0;T<y.length;++T)y[T].indexOf("utf8=")===0&&(y[T]===c?k="utf-8":y[T]===a&&(k="iso-8859-1"),x=T,T=y.length);for(T=0;T<y.length;++T)if(T!==x){var R=y[T],P=R.indexOf("]="),B=P===-1?R.indexOf("="):P+1,U,z;B===-1?(U=_.decoder(R,r.decoder,k,"key"),z=_.strictNullHandling?null:""):(U=_.decoder(R.slice(0,B),r.decoder,k,"key"),z=o(s(R.slice(B+1),_),function(I){return _.decoder(I,r.decoder,k,"value")})),z&&_.interpretNumericEntities&&k==="iso-8859-1"&&(z=i(z)),R.indexOf("[]=")>-1&&(z=t(z)?[z]:z),e.call(g,U)?g[U]=n.combine(g[U],z):g[U]=z}return g},u=function(d,p,_,g){for(var m=g?p:s(p,_),b=d.length-1;b>=0;--b){var y,x=d[b];if(x==="[]"&&_.parseArrays)y=[].concat(m);else{y=_.plainObjects?Object.create(null):{};var T=x.charAt(0)==="["&&x.charAt(x.length-1)==="]"?x.slice(1,-1):x,k=parseInt(T,10);!_.parseArrays&&T===""?y={0:m}:!isNaN(k)&&x!==T&&String(k)===T&&k>=0&&_.parseArrays&&k<=_.arrayLimit?(y=[],y[k]=m):y[T]=m}m=y}return m},h=function(p,_,g,m){if(p){var b=g.allowDots?p.replace(/\.([^.[]+)/g,"[$1]"):p,y=/(\[[^[\]]*])/,x=/(\[[^[\]]*])/g,T=g.depth>0&&y.exec(b),k=T?b.slice(0,T.index):b,R=[];if(k){if(!g.plainObjects&&e.call(Object.prototype,k)&&!g.allowPrototypes)return;R.push(k)}for(var P=0;g.depth>0&&(T=x.exec(b))!==null&&P<g.depth;){if(P+=1,!g.plainObjects&&e.call(Object.prototype,T[1].slice(1,-1))&&!g.allowPrototypes)return;R.push(T[1])}return T&&R.push("["+b.slice(T.index)+"]"),u(R,_,g,m)}},f=function(p){if(!p)return r;if(p.decoder!==null&&p.decoder!==void 0&&typeof p.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof p.charset<"u"&&p.charset!=="utf-8"&&p.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var _=typeof p.charset>"u"?r.charset:p.charset;return{allowDots:typeof p.allowDots>"u"?r.allowDots:!!p.allowDots,allowPrototypes:typeof p.allowPrototypes=="boolean"?p.allowPrototypes:r.allowPrototypes,arrayLimit:typeof p.arrayLimit=="number"?p.arrayLimit:r.arrayLimit,charset:_,charsetSentinel:typeof p.charsetSentinel=="boolean"?p.charsetSentinel:r.charsetSentinel,comma:typeof p.comma=="boolean"?p.comma:r.comma,decoder:typeof p.decoder=="function"?p.decoder:r.decoder,delimiter:typeof p.delimiter=="string"||n.isRegExp(p.delimiter)?p.delimiter:r.delimiter,depth:typeof p.depth=="number"||p.depth===!1?+p.depth:r.depth,ignoreQueryPrefix:p.ignoreQueryPrefix===!0,interpretNumericEntities:typeof p.interpretNumericEntities=="boolean"?p.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof p.parameterLimit=="number"?p.parameterLimit:r.parameterLimit,parseArrays:p.parseArrays!==!1,plainObjects:typeof p.plainObjects=="boolean"?p.plainObjects:r.plainObjects,strictNullHandling:typeof p.strictNullHandling=="boolean"?p.strictNullHandling:r.strictNullHandling}};return sD=function(d,p){var _=f(p);if(d===""||d===null||typeof d>"u")return _.plainObjects?Object.create(null):{};for(var g=typeof d=="string"?l(d,_):d,m=_.plainObjects?Object.create(null):{},b=Object.keys(g),y=0;y<b.length;++y){var x=b[y],T=h(x,g[x],_,typeof d=="string");m=n.merge(m,T,_)}return n.compact(m)},sD}zWe();zre();const xE=Symbol("twurpleRawData");class HWe{constructor(e){this[xE]=e}}class Xb extends Error{constructor(e,t){var r;super(e,t),Object.setPrototypeOf(this,new.target.prototype),(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}}function FR(n,e,t){return r=>{const i=t?function(){return`[${e}#${this[t]} - please check https://twurple.js.org/reference/${n}/classes/${e}.html for available properties]`}:function(){return`[${e} - please check https://twurple.js.org/reference/${n}/classes/${e}.html for available properties]`};Object.defineProperty(r.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:i,enumerable:!1})}}class _$ extends Xb{constructor(e){super(`${e} - this should never happen, please file a bug in the GitHub issue tracker`)}}function Ng(n){return typeof n=="string"?n:typeof n=="number"?n.toString(10):n.id}class Vre extends Xb{constructor(e,t,r,i,s,o){super(`Encountered HTTP status code ${e}: ${t}

URL: ${r}
Method: ${i}
Body:
${!o&&s.length>150?`${s.slice(0,147)}...`:s}`),this._statusCode=e,this._url=r,this._method=i,this._body=s}get statusCode(){return this._statusCode}get url(){return this._url}get method(){return this._method}get body(){return this._body}}async function VWe(n,e){var t;if(!n.ok){const r=n.headers.get("Content-Type")==="application/json",i=r?JSON.stringify(await n.json(),null,2):await n.text(),s=Hre(e.query,{arrayFormat:"repeat",addQueryPrefix:!0}),o=`${e.url}${s}`;throw new Vre(n.status,n.statusText,o,(t=e.method)!==null&&t!==void 0?t:"GET",i,r)}}async function GWe(n){if(n.status===204)return;const e=await n.text();if(e)return JSON.parse(e)}function $We(n,e,t){switch(e){case"helix":return`https://api.twitch.tv/helix/${n.replace(/^\//,"")}`;case"auth":return`https://id.twitch.tv/oauth2/${n.replace(/^\//,"")}`;case"custom":return n;default:return n}}async function WWe(n,e,t,r,i={},s){var o,a;const c=(o=n.type)!==null&&o!==void 0?o:"helix",l=$We(n.url,c),u=Hre(n.query,{arrayFormat:"repeat",addQueryPrefix:!0}),h=new jre.Headers({Accept:"application/json"});let f;n.jsonBody&&(f=JSON.stringify(n.jsonBody),h.append("Content-Type","application/json")),e&&c!=="auth"&&h.append("Client-ID",e),t&&h.append("Authorization",`${c==="helix"?"Bearer":"OAuth"} ${t}`);const d={...i,method:(a=n.method)!==null&&a!==void 0?a:"GET",headers:h,body:f};return await BWe(`${l}${u}`,d)}async function y3(n,e,t,r,i={}){const s=await WWe(n,e,t,r,i);return await VWe(s,n),await GWe(s)}class YE extends Xb{constructor(e){super("Invalid token supplied",e)}}class JC extends Xb{}function qWe(n,e,t,r){return{grant_type:"authorization_code",client_id:n,client_secret:e,code:t,redirect_uri:r}}function YWe(n,e){return{grant_type:"client_credentials",client_id:n,client_secret:e}}function KWe(n,e,t){return{grant_type:"refresh_token",client_id:n,client_secret:e,refresh_token:t}}let B4=class extends HWe{constructor(e){super(e),this._obtainmentDate=new Date}get clientId(){return this[xE].client_id}get userId(){var e;return(e=this[xE].user_id)!==null&&e!==void 0?e:null}get userName(){var e;return(e=this[xE].login)!==null&&e!==void 0?e:null}get scopes(){return this[xE].scopes}get expiryDate(){return NA(this[xE].expires_in,e=>new Date(this._obtainmentDate.getTime()+e*1e3))}};B4=Os([FR("auth","TokenInfo","clientId")],B4);function oB(n){var e,t;return{accessToken:n.access_token,refreshToken:n.refresh_token||null,scope:(e=n.scope)!==null&&e!==void 0?e:[],expiresIn:(t=n.expires_in)!==null&&t!==void 0?t:null,obtainmentTimestamp:Date.now()}}async function XWe(n,e,t,r){return oB(await y3({type:"auth",url:"token",method:"POST",query:qWe(n,e,t,r)}))}async function ZWe(n,e){return oB(await y3({type:"auth",url:"token",method:"POST",query:YWe(n,e)}))}async function v$(n,e,t){return oB(await y3({type:"auth",url:"token",method:"POST",query:KWe(n,e,t)}))}async function PA(n,e){try{const t=await y3({type:"auth",url:"validate"},e,n);return new B4(t)}catch(t){throw t instanceof Vre&&t.statusCode===401?new YE({cause:t}):t}}const JWe=new Map([["channel_commercial",["channel:edit:commercial"]],["channel_editor",["channel:manage:broadcast"]],["channel_read",["channel:read:stream_key"]],["channel_subscriptions",["channel:read:subscriptions"]],["user_blocks_read",["user:read:blocked_users"]],["user_blocks_edit",["user:manage:blocked_users"]],["user_follows_edit",["user:edit:follows"]],["user_read",["user:read:email"]],["user_subscriptions",["user:read:subscriptions"]],["user:edit:broadcast",["channel:manage:broadcast","channel:manage:extensions"]]]);function QWe(n,e){if(e?.length){const t=new Set(n.flatMap(r=>{var i;return[r,...(i=JWe.get(r))!==null&&i!==void 0?i:[]]}));if(e.every(r=>!t.has(r))){const r=e.join(", ");throw new Error(`This token does not have any of the requested scopes (${r}) and can not be upgraded.
If you need dynamically upgrading scopes, please implement the AuthProvider interface accordingly:

	https://twurple.js.org/reference/auth/interfaces/AuthProvider.html`)}}}function QC(n,e){for(const t of e)QWe(n,t)}async function eqe(n,e,t,r,i){if(i?.length||!t){const s=await PA(e,n);if(!s.userId)throw new Error("Trying to use an app access token as a user access token");const o=r??s.scopes;return i&&QC(o,i.filter(a=>!!a)),[o,s.userId]}return[r,t]}class y${constructor(e){this._newTokenScopeSets=[],this._newTokenPromise=null,this._queuedScopeSets=[],this._queueExecutor=null,this._queuePromise=null,this._executor=e}async fetch(...e){var t;const r=e.filter(a=>!!a);if(this._newTokenPromise){if(!r.length)return await this._newTokenPromise;if(this._queueExecutor?this._queuedScopeSets.push(...r):this._queuedScopeSets=[...r],!this._queuePromise){const{promise:a,resolve:c,reject:l}=L4();this._queuePromise=a,this._queueExecutor=async()=>{var u;if(this._queuePromise){this._newTokenScopeSets=this._queuedScopeSets,this._queuedScopeSets=[],this._newTokenPromise=this._queuePromise,this._queuePromise=null,this._queueExecutor=null;try{c(await this._executor(this._newTokenScopeSets))}catch(h){l(h)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],(u=this._queueExecutor)===null||u===void 0||u.call(this)}}}}return await this._queuePromise}this._newTokenScopeSets=[...r];const{promise:i,resolve:s,reject:o}=L4();this._newTokenPromise=i;try{s(await this._executor(this._newTokenScopeSets))}catch(a){o(a)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],(t=this._queueExecutor)===null||t===void 0||t.call(this)}return await i}}class b$ extends Xb{constructor(e){super(`The user context for the user ${e} has been disabled.
This happened because the access token became invalid (e.g. by expiry) and refreshing it failed (e.g. because the account's password was changed).

Use .addUser(), .addUserForToken() or .addUserForCode() for the same user context to re-enable the user with a new, valid token.`),this.userId=e}}class tqe extends Xb{constructor(e){super(`User ${e} was removed while trying to fetch a token.

Make sure you're not executing any actions when you want to remove a user.`),this.userId=e}}class nqe extends Xb{constructor(e){super(`Unknown intent: ${e}`),this.intent=e}}let Xv=class extends BR{constructor(e){var t;super(),this._userAccessTokens=new Map,this._userTokenFetchers=new Map,this._intentToUserId=new Map,this._userIdToIntents=new Map,this._cachedRefreshFailures=new Set,this.onRefresh=this.registerEvent(),this.onRefreshFailure=this.registerEvent(),this._clientId=e.clientId,this._clientSecret=e.clientSecret,this._redirectUri=e.redirectUri,this._appImpliedScopes=(t=e.appImpliedScopes)!==null&&t!==void 0?t:[],this._appTokenFetcher=new y$(async r=>await this._fetchAppToken(r))}addUser(e,t,r){const i=Ng(e);if(!t.refreshToken)throw new Error(`Trying to add user ${i} without refresh token`);this._cachedRefreshFailures.delete(i),this._userAccessTokens.set(i,{...t,userId:i}),this._userTokenFetchers.has(i)||this._userTokenFetchers.set(i,new y$(async s=>await this._fetchUserToken(i,s))),r&&this.addIntentsToUser(e,r)}async addUserForToken(e,t){let r=null;if(e.accessToken&&!ZC(e))try{const a=await PA(e.accessToken);r=[e,a]}catch(a){if(!(a instanceof YE))throw a}if(!r){if(!e.refreshToken)throw new YE;const a=await v$(this._clientId,this._clientSecret,e.refreshToken),c=await PA(a.accessToken);this.emit(this.onRefresh,c.userId,a),r=[a,c]}const[i,s]=r;if(!s.userId)throw new JC("Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.");const o=i.scope?i:{...i,scope:s.scopes};return this.addUser(s.userId,o,t),s.userId}async addUserForCode(e,t){if(!this._redirectUri)throw new Error("This method requires you to pass a `redirectUri` as a configuration property");const r=await XWe(this._clientId,this._clientSecret,e,this._redirectUri);return await this.addUserForToken(r,t)}hasUser(e){return this._userTokenFetchers.has(Ng(e))}removeUser(e){const t=Ng(e);if(this._userIdToIntents.has(t)){const r=this._userIdToIntents.get(t);for(const i of r)this._intentToUserId.delete(i);this._userIdToIntents.delete(t)}this._userAccessTokens.delete(t),this._userTokenFetchers.delete(t),this._cachedRefreshFailures.delete(t)}addIntentsToUser(e,t){const r=Ng(e);if(!this._userAccessTokens.has(r))throw new Error("Trying to add intents to a user that was not added to this provider");for(const i of t)this._intentToUserId.has(i)&&this._userIdToIntents.get(this._intentToUserId.get(i)).delete(i),this._intentToUserId.set(i,r),this._userIdToIntents.has(r)?this._userIdToIntents.get(r).add(i):this._userIdToIntents.set(r,new Set([i]))}getIntentsForUser(e){const t=Ng(e);return this._userIdToIntents.has(t)?Array.from(this._userIdToIntents.get(t)):[]}removeIntents(e){var t;for(const r of e)if(this._intentToUserId.has(r)){const i=this._intentToUserId.get(r);(t=this._userIdToIntents.get(i))===null||t===void 0||t.delete(r),this._intentToUserId.delete(r)}}async refreshAccessTokenForUser(e){const t=Ng(e);if(this._cachedRefreshFailures.has(t))throw new b$(t);const r=this._userAccessTokens.get(t);if(!r)throw new Error("Trying to refresh token for user that was not added to the provider");const i=await this._refreshUserTokenWithCallback(t,r.refreshToken);return this._checkIntermediateUserRemoval(t),this._userAccessTokens.set(t,{...i,userId:t}),this.emit(this.onRefresh,t,i),{...i,userId:t}}async refreshAccessTokenForIntent(e){if(!this._intentToUserId.has(e))throw new nqe(e);const t=this._intentToUserId.get(e);return await this.refreshAccessTokenForUser(t)}get clientId(){return this._clientId}getCurrentScopesForUser(e){var t;const r=this._userAccessTokens.get(Ng(e));if(!r)throw new Error("Trying to get scopes for user that was not added to the provider");return(t=r.scope)!==null&&t!==void 0?t:[]}async getAccessTokenForUser(e,...t){const r=Ng(e),i=this._userTokenFetchers.get(r);if(!i)return null;if(this._cachedRefreshFailures.has(r))throw new b$(r);return QC(this.getCurrentScopesForUser(r),t.filter(Boolean)),await i.fetch(...t)}async getAccessTokenForIntent(e,...t){if(!this._intentToUserId.has(e))return null;const r=this._intentToUserId.get(e),i=await this.getAccessTokenForUser(r,...t);if(!i)throw new _$(`Found intent ${e} corresponding to user ID ${r} but no token was found`);return{...i,userId:r}}async getAnyAccessToken(e){if(e){const t=Ng(e);if(this._userAccessTokens.has(t)){const r=await this.getAccessTokenForUser(t);if(!r)throw new _$(`Token for user ID ${t} exists but nothing was returned by getAccessTokenForUser`);return{...r,userId:t}}}return await this.getAppAccessToken()}async getAppAccessToken(e=!1){return e&&(this._appAccessToken=void 0),await this._appTokenFetcher.fetch(...this._appImpliedScopes.map(t=>[t]))}_checkIntermediateUserRemoval(e){if(!this._userTokenFetchers.has(e))throw this._cachedRefreshFailures.delete(e),new tqe(e)}async _fetchUserToken(e,t){const r=this._userAccessTokens.get(e);if(!r)throw new Error("Trying to get token for user that was not added to the provider");if(r.accessToken&&!ZC(r))try{if(r.scope)return QC(r.scope,t),r;const[s=[]]=await eqe(this._clientId,r.accessToken,e,r.scope,t),o={...r,scope:s};return this._checkIntermediateUserRemoval(e),this._userAccessTokens.set(e,o),o}catch(s){if(!(s instanceof YE))throw s}this._checkIntermediateUserRemoval(e);const i=await this.refreshAccessTokenForUser(e);return QC(i.scope,t),i}async _refreshUserTokenWithCallback(e,t){try{return await v$(this.clientId,this._clientSecret,t)}catch(r){throw this._cachedRefreshFailures.add(e),this.emit(this.onRefreshFailure,e,r),r}}async _fetchAppToken(e){if(e.length>0)for(const t of e)if(this._appImpliedScopes.length){if(t.every(r=>!this._appImpliedScopes.includes(r)))throw new Error(`One of the scopes ${t.join(", ")} requested but only the scope ${this._appImpliedScopes.join(", ")} is implied`)}else throw new Error(`One of the scopes ${t.join(", ")} requested but the client credentials flow does not support scopes`);return!this._appAccessToken||ZC(this._appAccessToken)?await this._refreshAppToken():this._appAccessToken}async _refreshAppToken(){return this._appAccessToken=await ZWe(this._clientId,this._clientSecret)}};Os([ly(!1)],Xv.prototype,"_clientSecret",void 0);Os([ly(!1)],Xv.prototype,"_userAccessTokens",void 0);Os([ly(!1)],Xv.prototype,"_userTokenFetchers",void 0);Os([ly(!1)],Xv.prototype,"_appAccessToken",void 0);Os([ly(!1)],Xv.prototype,"_appTokenFetcher",void 0);Xv=Os([FR("auth","RefreshingAuthProvider","clientId")],Xv);class rqe extends BR{constructor({lineBased:e,logger:t,additionalOptions:r}={}){super(),this._currentLine="",this._connecting=!1,this._connected=!1,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._lineBased=e??!1,this._logger=t,this._additionalOptions=r}get isConnecting(){return this._connecting}get isConnected(){return this._connected}sendLine(e){this._connected&&(e=e.replace(/[\0\r\n]/g,""),this.sendRaw(`${e}\r
`))}assumeExternalDisconnect(){var e;(e=this._logger)===null||e===void 0||e.trace("AbstractConnection assumeExternalDisconnect"),this._connected=!1,this._connecting=!1,this.clearSocket(),this.emit(this.onDisconnect,!1)}receiveRaw(e){var t,r;if(!this._lineBased){this.emit(this.onReceive,e);return}const i=e.split(`\r
`);if(this._currentLine+=(t=i.shift())!==null&&t!==void 0?t:"",i.length){this.emit(this.onReceive,this._currentLine),this._currentLine=(r=i.pop())!==null&&r!==void 0?r:"";for(const s of i)this.emit(this.onReceive,s)}}}class iqe{constructor(){throw new Error("DirectConnection is not implemented in a browser environment")}}class sqe extends BR{constructor(e,t,r={}){var i;super(),this._type=e,this._target=t,this._config=r,this._retryLimit=1/0,this._initialRetryLimit=3,this._connecting=!1,this._connectionRetryCount=0,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._retryLimit=(i=r.retryLimit)!==null&&i!==void 0?i:1/0,this._logger=r.logger}get isConnected(){var e,t;return(t=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnected)!==null&&t!==void 0?t:!1}get isConnecting(){var e,t;return(t=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnecting)!==null&&t!==void 0?t:this._connecting}get hasSocket(){var e,t;return(t=(e=this._currentConnection)===null||e===void 0?void 0:e.hasSocket)!==null&&t!==void 0?t:!1}sendLine(e){var t;(t=this._currentConnection)===null||t===void 0||t.sendLine(e)}connect(){if(this._currentConnection||this._connecting)throw new Error("Connection already present");this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(!0)}disconnect(){var e;if((e=this._logger)===null||e===void 0||e.trace(`PersistentConnection disconnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`),this._connecting=!1,this._currentConnection){const t=this._currentConnection;this._currentConnection=void 0,t.disconnect()}}assumeExternalDisconnect(){var e,t;(e=this._logger)===null||e===void 0||e.trace("PersistentConnection assumeExternalDisconnect"),(t=this._currentConnection)===null||t===void 0||t.assumeExternalDisconnect()}reconnect(){this._reconnect(!0)}acknowledgeSuccessfulReconnect(){this._previousConnection&&(this._previousConnection.disconnect(),this._previousConnection=void 0)}_startTryingToConnect(e=!1){this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(e)}_tryConnect(e=!1){var t,r;(t=this._logger)===null||t===void 0||t.trace(`PersistentConnection tryConnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`);const i=e?this._initialRetryLimit:this._retryLimit;(r=this._retryTimerGenerator)!==null&&r!==void 0||(this._retryTimerGenerator=Ire(120));const s=this._currentConnection=new this._type(yWe(this._target),this._config);s.onReceive(o=>this.emit(this.onReceive,o)),s.onConnect(()=>{this.emit(this.onConnect),this._connecting=!1,this._retryTimerGenerator=void 0}),s.onDisconnect((o,a)=>{var c,l,u;if(this.emit(this.onDisconnect,o,a),o)this.emit(this.onEnd,!0),this._connecting=!1,this._retryTimerGenerator=void 0,s.disconnect(),this._currentConnection===s&&(this._currentConnection=void 0),this._previousConnection===s&&(this._previousConnection=void 0);else if(this._connecting){if((c=this._logger)===null||c===void 0||c.debug(`Connection error caught: ${(l=a?.message)!==null&&l!==void 0?l:"unknown error"}`),this._connectionRetryCount>=i)return;this._connectionRetryCount++;const h=this._retryTimerGenerator.next().value;h!==0&&((u=this._logger)===null||u===void 0||u.info(`Retrying in ${h} seconds`)),setTimeout(()=>{var f;this._connecting&&((f=this._logger)===null||f===void 0||f.info(e?"Retrying connection":"Trying to reconnect"),this._tryConnect())},h*1e3)}else this._reconnect()}),s.connect()}_reconnect(e=!1){e&&this._config.overlapManualReconnect?(this._previousConnection=this._currentConnection,this._currentConnection=void 0):this.disconnect(),this._startTryingToConnect(e)}}var TE=null;typeof WebSocket<"u"?TE=WebSocket:typeof MozWebSocket<"u"?TE=MozWebSocket:typeof Vg<"u"?TE=Vg.WebSocket||Vg.MozWebSocket:typeof window<"u"?TE=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(TE=self.WebSocket||self.MozWebSocket);class oqe extends rqe{constructor(e,t){if(super(t),this._socket=null,this._closingOnDemand=!1,e.hostName&&e.port)this._url=`ws${e.secure?"s":""}://${e.hostName}:${e.port}`;else if(e.url)this._url=e.url;else throw new Error("WebSocketConnection requires either hostName & port or url to be set")}get hasSocket(){return!!this._socket}sendRaw(e){var t;(t=this._socket)===null||t===void 0||t.send(e)}connect(){var e,t;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection connect"),this._connecting=!0,this._socket=new TE(this._url,(t=this._additionalOptions)===null||t===void 0?void 0:t.wsOptions),this._socket.onopen=()=>{var r;(r=this._logger)===null||r===void 0||r.trace("WebSocketConnection onOpen"),this._connected=!0,this._connecting=!1,this._closingOnDemand=!1,this.emit(this.onConnect)},this._socket.onmessage=({data:r})=>{this.receiveRaw(r.toString())},this._socket.onerror=r=>{var i;(i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onError message:${r.message}`)},this._socket.onclose=r=>{var i;const s=this._connected,o=this._connecting;if((i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onClose wasConnected:${s.toString()} wasConnecting:${o.toString()} closingOnDemand:${this._closingOnDemand.toString()} wasClean:${r.wasClean.toString()}`),this._connected=!1,this._connecting=!1,this._closingOnDemand)this._closingOnDemand=!1,this.emit(this.onDisconnect,!0),this.emit(this.onEnd,!0);else{const a=new Error(`[${r.code}] ${r.reason}`);this.emit(this.onDisconnect,!1,a),this.emit(this.onEnd,!1,a)}this.clearSocket()}}disconnect(){var e,t;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection disconnect"),this._closingOnDemand=!0,(t=this._socket)===null||t===void 0||t.close()}clearSocket(){this._socket&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onerror=null,this._socket.onclose=null,this._socket=null)}}function jw(n){var e,t,r;if(Array.isArray(n)){for(t=Array(e=n.length);e--;)t[e]=(r=n[e])&&typeof r=="object"?jw(r):r;return t}if(Object.prototype.toString.call(n)==="[object Object]"){t={};for(e in n)e==="__proto__"?Object.defineProperty(t,e,{value:jw(n[e]),configurable:!0,enumerable:!0,writable:!0}):t[e]=(r=n[e])&&typeof r=="object"?jw(r):r;return t}return n}const aqe={name:"away-notify"};class kk extends Error{constructor(e,t,r){super(`command "${e}" expected ${t} or more parameters, got ${r}`),this._command=e,this._expectedParams=t,this._actualParams=r,Object.setPrototypeOf(this,kk.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,kk)}get command(){return this._command}get expectedParams(){return this._expectedParams}get actualParams(){return this._actualParams}}class Ok extends Error{constructor(e,t,r,i){var s;super(`required parameter "${t}" did not validate against ${(s=r.type)!==null&&s!==void 0?s:"regex"} validation: "${i}"`),this._command=e,this._paramName=t,this._paramSpec=r,this._givenValue=i,Object.setPrototypeOf(this,Ok.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ok)}get command(){return this._command}get paramName(){return this._paramName}get paramSpec(){return this._paramSpec}get givenValue(){return this._givenValue}}const KE={channelTypes:"#&",supportedUserModes:"iwso",supportedChannelModes:{prefix:"ov",list:"b",alwaysWithParam:"ovk",paramWhenSet:"l",noParam:"imnpst"},prefixes:[{modeChar:"v",prefix:"+"},{modeChar:"o",prefix:"@"}]};var oD={exports:{}},S$;function cqe(){return S$||(S$=1,(function(n){n.exports=e=>{if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},n.exports.default=n.exports})(oD)),oD.exports}var lqe=cqe();const uqe=Dl(lqe);function F4(n,e="#&"){return new RegExp(`^[${uqe(e)}][^ \b\0
\r,]+$`).test(n)}const E$={0:"\0",n:`
`,r:"\r","":""};function x$(n){if(!n.startsWith("")||(n=n.substring(1),n.endsWith("")&&(n=n.slice(0,-1)),!n))return!1;n=n.replace(/\x10(.)/,(r,i)=>i in E$?E$[i]:"");let[e,t=""]=rb(n," ",2);return e=e?e.toUpperCase():"",{command:e,params:t}}const hqe={"\\":"\\",";":":","\n":"n","\r":"r"," ":"s"};function fqe(n){return n.replace(/[\\;\n\r ]/g,e=>`\\${hqe[e]}`)}function dqe(n){let e=`${n.nick}`;return n.user&&(e+=`!${n.user}`),n.host&&(e+=`@${n.host}`),e}function pqe(n,e,t,r,i=KE,s=!1){const o=new n(n.COMMAND,void 0,{serverProperties:i}),a={};if(o._paramSpec&&D4(o._paramSpec,(c,l)=>{if(!(s&&c.noServer)&&!(!s&&c.noClient)){if(l in e){const u=e[l];if(u!==void 0){if(n.checkParam(u,c,i))a[l]={value:u,trailing:!!c.trailing};else if(!c.optional)throw new Error(`required parameter "${l}" did not suit requirements: "${u}"`)}}if(!(l in a)&&!c.optional)throw new Error(`required parameter "${l}" not found in command "${n.COMMAND}"`)}}),o._parsedParams=a,o._paramSpec)for(const c of Object.keys(o._paramSpec))Object.defineProperty(o,c,{get(){var l,u;return(u=(l=this._parsedParams)===null||l===void 0?void 0:l[c])===null||u===void 0?void 0:u.value}});return o._initPrefixAndTags(t,r),o}class en{static checkParam(e,t,r=KE){return!(t.type==="channel"&&!F4(e,r.channelTypes)||t.type==="channelList"&&!e.split(",").every(s=>F4(s,r.channelTypes))||t.match&&!t.match.test(e))}constructor(e,{params:t,tags:r,prefix:i,rawLine:s}={},{serverProperties:o=KE,isServer:a=!1,shouldParseParams:c=!0}={},l){this._params=[],this._serverProperties=KE,this._paramSpec=l,this._command=e,this._params=t,this._tags=r??new Map,this._prefix=i,this._serverProperties=o,this._raw=s,c&&this.parseParams(a)}getMinParamCount(e=!1){return this._paramSpec?Object.values(this._paramSpec).filter(t=>t.noServer&&e||t.noClient&&!e?!1:!t.optional).length:0}get paramCount(){var e,t;return(t=(e=this._params)===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0}prefixToString(){return this._prefix?dqe(this._prefix):""}tagsToString(){return[...this._tags.entries()].map(([e,t])=>t?`${e}=${fqe(t)}`:e).join(";")}toString(e=!1,t=!1){const i=[t?this._buildCommandFromRawParams():this._buildCommandFromNamedParams()];if(e){const o=this.prefixToString();o&&i.unshift(`:${o}`)}const s=this.tagsToString();return s&&i.unshift(`@${s}`),i.join(" ")}_initPrefixAndTags(e,t){this._prefix=e,t&&(this._tags=t)}parseParams(e=!1){if(this._params){let t=this.getMinParamCount(e);if(t>this._params.length)throw new kk(this._command,t,this._params.length);const r=this._paramSpec;if(!r)return;let i=0;const s={};for(const[o,a]of Object.entries(r)){if(a.noServer&&e||a.noClient&&!e)continue;if(this._params.length-i<=t){if(a.optional)continue;if(this._params.length-i!==t)throw new Error("not enough parameters left for required parameters parsing (this is a library bug)")}let c=this._params[i];if(!c){if(a.optional)break;throw new Error("unexpected parameter underflow")}if(a.rest){const l=[];for(;this._params[i]&&!this._params[i].trailing;)l.push(this._params[i].value),++i;if(!l.length){if(a.optional)continue;throw new Error(`no parameters left for required rest parameter "${o}"`)}c={value:l.join(" "),trailing:!1}}if(en.checkParam(c.value,a))s[o]={...c},a.optional||--t,a.rest||++i;else if(!a.optional)throw new Ok(this._command,o,a,c.value);if(a.trailing)break}if(this._parsedParams=s,this._paramSpec)for(const o of Object.keys(this._paramSpec))Object.defineProperty(this,o,{get(){var a,c;return(c=(a=this._parsedParams)===null||a===void 0?void 0:a[o])===null||c===void 0?void 0:c.value}})}}get rawParamValues(){var e,t;return(t=(e=this._params)===null||e===void 0?void 0:e.map(r=>r.value))!==null&&t!==void 0?t:[]}get prefix(){return this._prefix}get command(){return this._command}get tags(){return this._tags}get rawLine(){return this._raw}isResponseTo(e){return!1}endsResponseTo(e){return!1}_acceptsInReplyCollection(e){return e.isResponseTo(this)}_buildCommandFromNamedParams(){const e=this._paramSpec?Object.keys(this._paramSpec):[];return[this._command,...e.map(t=>{var r;const i=(r=this._parsedParams)===null||r===void 0?void 0:r[t];if(i)return(i.trailing?":":"")+i.value}).filter(t=>t!==void 0)].join(" ")}_buildCommandFromRawParams(){var e,t;return[this._command,...(t=(e=this._params)===null||e===void 0?void 0:e.map(r=>`${r.trailing?":":""}${r.value}`))!==null&&t!==void 0?t:[]].join(" ")}}en.COMMAND="";en.SUPPORTS_CAPTURE=!1;class Gre extends en{constructor(e,t,r){super(e,t,r,{reference:{},type:{optional:!0},additionalParams:{optional:!0}})}}Gre.COMMAND="BATCH";const mqe={name:"batch",messageTypes:[Gre],usesTags:!0},gqe={name:"cap-notify"};class $re extends en{constructor(e,t,r){super(e,t,r,{newUser:{},newHost:{}})}}$re.COMMAND="CHGHOST";const _qe={name:"chghost",messageTypes:[$re]},vqe={name:"invite-notify"};class Wre extends en{}Wre.COMMAND="ACK";const yqe={name:"labeled-response",messageTypes:[Wre],usesTags:!0},bqe={name:"message-tags",usesTags:!0},Sqe={name:"multi-prefix"},Eqe=Object.freeze(Object.defineProperty({__proto__:null,AwayNotify:aqe,Batch:mqe,CapNotify:gqe,ChgHost:_qe,InviteNotify:vqe,LabeledResponse:yqe,MessageTags:bqe,MultiPrefix:Sqe},Symbol.toStringTag,{value:"Module"}));class xqe{constructor(e,t,...r){this._client=e,this._originalMessage=t,this._messages=[],this._endEventHandlers=new Map,this._types=new Set(r)}untilEvent(e){this._cleanEndEventHandler(e);const t=this._client.on(e,()=>this.end());this._endEventHandlers.set(e,t)}async promise(){return this._promise||(this._promise=new Promise(e=>{this._promiseResolve=e})),await this._promise}collect(e){return this._originalMessage._acceptsInReplyCollection(e)?(this._messages.push(e),e.endsResponseTo(this._originalMessage)&&this.end(),!0):!1}end(){this._client.stopCollect(this),this._cleanEndEventHandlers(),this._promiseResolve&&this._promiseResolve(this._messages)}_cleanEndEventHandlers(){this._endEventHandlers.forEach(e=>{this._client.removeListener(e)}),this._endEventHandlers.clear()}_cleanEndEventHandler(e){this._endEventHandlers.has(e)&&(this._client.removeListener(this._endEventHandlers.get(e)),this._endEventHandlers.delete(e))}}class aB extends en{constructor(e,t,r){super(e,t,r,{password:{}})}}aB.COMMAND="PASS";class zw extends en{constructor(e,t,r){super(e,t,r,{nick:{}})}}zw.COMMAND="NICK";class cB extends en{constructor(e,t,r){super(e,t,r,{user:{},mode:{},unused:{},realName:{trailing:!0}})}}cB.COMMAND="USER";class qre extends en{constructor(e,t,r){super(e,t,r,{name:{},password:{}})}}qre.COMMAND="OPER";class lB extends en{constructor(e,t,r){super(e,t,r,{text:{trailing:!0,optional:!0}})}}lB.COMMAND="QUIT";class Yre extends en{constructor(e,t,r){super(e,t,r,{server:{},reason:{trailing:!0}})}}Yre.COMMAND="SQUIT";class DA extends en{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},key:{optional:!0}})}}DA.COMMAND="JOIN";class LA extends en{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},reason:{trailing:!0,optional:!0}})}}LA.COMMAND="PART";class Ik extends Error{constructor(e){super(`Unknown channel mode character ${e}`),this._char=e,Object.setPrototypeOf(this,Ik.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ik)}get char(){return this._char}}class Kre extends en{constructor(e,t,r){super(e,t,r,{target:{},modes:{rest:!0,optional:!0}})}get isChannel(){return F4(this.target,this._serverProperties.channelTypes)}separate(){const e=[],t=this.modes;if(!t)throw new Error("can't separate a channel mode request, just set actions");const r=t.split(" "),i=r.shift();let s="add";for(const o of i){let a=s;switch(o){case"+":{s="add";break}case"-":{s="remove";break}default:{let c=!1,l=!0;if(this.isChannel){if(this._serverProperties.supportedChannelModes.alwaysWithParam.includes(o)||this._serverProperties.supportedChannelModes.prefix.includes(o))c=!0;else if(this._serverProperties.supportedChannelModes.paramWhenSet.includes(o))s==="add"&&(c=!0);else if(this._serverProperties.supportedChannelModes.list.includes(o))r.length?c=!0:a="getList";else if(!this._serverProperties.supportedChannelModes.noParam.includes(o))throw new Ik(o)}else l=this._serverProperties.supportedUserModes.includes(o);if(c&&!r.length)continue;e.push({prefix:this._prefix,action:a,letter:o,param:c?r.shift():void 0,known:l})}}}return e}}Kre.COMMAND="MODE";class Xre extends en{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},newTopic:{optional:!0,trailing:!0}})}}Xre.COMMAND="TOPIC";class jR extends en{constructor(e,t,r){super(e,t,r,{channel:{type:"channelList",optional:!0}})}}jR.COMMAND="NAMES";jR.SUPPORTS_CAPTURE=!0;class Zre extends en{constructor(e,t,r){super(e,t,r,{channel:{optional:!0},server:{optional:!0}})}}Zre.COMMAND="LIST";class Jre extends en{constructor(e,t,r){super(e,t,r,{target:{},channel:{type:"channel"}})}}Jre.COMMAND="INVITE";class Qre extends en{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},target:{},reason:{trailing:!0,optional:!0}})}}Qre.COMMAND="KICK";class eie extends en{constructor(e,t,r){super(e,t,r,{server:{optional:!0}})}}eie.COMMAND="TIME";class UA extends en{constructor(e,t,r){super(e,t,r,{target:{},text:{trailing:!0}})}}UA.COMMAND="PRIVMSG";class b3 extends en{constructor(e,t,r){super(e,t,r,{target:{},text:{trailing:!0}})}}b3.COMMAND="NOTICE";class S3 extends en{constructor(e,t,r){super(e,t,r,{mask:{},flags:{optional:!0},extendedMask:{optional:!0,trailing:!0}})}}S3.COMMAND="WHO";class tie extends en{constructor(e,t,r){super(e,t,r,{server:{optional:!0},nickMask:{}})}}tie.COMMAND="WHOIS";class nie extends en{constructor(e,t,r){super(e,t,r,{nick:{},count:{optional:!0},server:{optional:!0}})}}nie.COMMAND="WHOWAS";class rie extends en{constructor(e,t,r){super(e,t,r,{target:{},reason:{trailing:!0,optional:!0}})}}rie.COMMAND="KILL";class Nk extends en{constructor(e,t,r){super(e,t,r,{text:{trailing:!0}})}}Nk.COMMAND="PING";class Pk extends en{constructor(e,t,r){super(e,t,r,{server:{noClient:!0},text:{trailing:!0}})}}Pk.COMMAND="PONG";class iie extends en{constructor(e,t,r){super(e,t,r,{text:{trailing:!0}})}}iie.COMMAND="ERROR";class sie extends en{constructor(e,t,r){super(e,t,r,{text:{trailing:!0,optional:!0}})}}sie.COMMAND="AWAY";class oie extends en{}oie.COMMAND="REHASH";class aie extends en{}aie.COMMAND="RESTART";class cie extends en{constructor(e,t,r){super(e,t,r,{text:{trailing:!0}})}}cie.COMMAND="WALLOPS";class lie extends en{constructor(e,t,r){super(e,t,r,{nicks:{rest:!0}})}}lie.COMMAND="USERHOST";class uie extends en{constructor(e,t,r){super(e,t,r,{nicks:{rest:!0}})}}uie.COMMAND="ISON";class pd extends en{constructor(e,t,r){super(e,t,r,{target:{match:/^(?:[a-z_\-\[\]\\^{}|`][a-z0-9_\-\[\]\\^{}|`]+|\*)$/i,optional:!0,noClient:!0},subCommand:{match:/^(?:LS|LIST|REQ|ACK|NAK|END|NEW|DEL)$/i},version:{match:/^\d+$/,optional:!0},continued:{match:/^\*$/,optional:!0},capabilities:{trailing:!0,optional:!0}})}isResponseTo(e){if(!(e instanceof pd))return!1;switch(this.subCommand){case"ACK":case"NAK":return e.subCommand==="REQ"&&e.capabilities===this.capabilities.trim();case"LS":case"LIST":return e.subCommand===this.subCommand;default:return!1}}endsResponseTo(e){if(!(e instanceof pd))return!1;switch(this.subCommand){case"LS":case"LIST":return!this.continued;default:return!0}}}pd.COMMAND="CAP";pd.SUPPORTS_CAPTURE=!0;class hie extends en{constructor(e,t,r){super(e,t,r,{target:{}})}}hie.COMMAND="TAGMSG";const fie=Object.freeze(Object.defineProperty({__proto__:null,Away:sie,CapabilityNegotiation:pd,ChannelInvite:Jre,ChannelJoin:DA,ChannelKick:Qre,ChannelList:Zre,ChannelPart:LA,ClientQuit:lB,ErrorMessage:iie,IsOnQuery:uie,Kill:rie,Mode:Kre,Names:jR,NickChange:zw,Notice:b3,OperLogin:qre,Password:aB,Ping:Nk,Pong:Pk,PrivateMessage:UA,Rehash:oie,Restart:aie,ServerQuit:Yre,TagMessage:hie,Time:eie,Topic:Xre,UserHostQuery:lie,UserRegistration:cB,Wallops:cie,WhoIsQuery:tie,WhoQuery:S3,WhoWasQuery:nie},Symbol.toStringTag,{value:"Module"}));class uB extends en{constructor(e,t,r){super(e,t,r,{me:{},welcomeText:{trailing:!0}})}}uB.COMMAND="001";class die extends en{constructor(e,t,r){super(e,t,r,{me:{},yourHost:{trailing:!0}})}}die.COMMAND="002";class pie extends en{constructor(e,t,r){super(e,t,r,{me:{},createdText:{trailing:!0}})}}pie.COMMAND="003";class hB extends en{constructor(e,t,r){super(e,t,r,{me:{},serverName:{},version:{},userModes:{},channelModes:{},channelModesWithParam:{optional:!0}})}}hB.COMMAND="004";class fB extends en{constructor(e,t,r){super(e,t,r,{me:{},supports:{rest:!0},suffix:{trailing:!0}})}}fB.COMMAND="005";class mie extends en{constructor(e,t,r){super(e,t,r,{me:{},modes:{}})}}mie.COMMAND="221";class gie extends en{constructor(e,t,r){super(e,t,r,{me:{},nick:{},text:{trailing:!0}})}}gie.COMMAND="301";class _ie extends en{constructor(e,t,r){super(e,t,r,{me:{},hosts:{trailing:!0}})}}_ie.COMMAND="302";class vie extends en{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}vie.COMMAND="305";class yie extends en{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}yie.COMMAND="306";class bie extends en{constructor(e,t,r){super(e,t,r,{me:{},nick:{},username:{},host:{},_unused:{},realname:{trailing:!0}})}}bie.COMMAND="311";class Sie extends en{constructor(e,t,r){super(e,t,r,{me:{},query:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof S3}endsResponseTo(){return!0}}Sie.COMMAND="315";class Eie extends en{constructor(e,t,r){super(e,t,r,{me:{},nickMask:{},suffix:{trailing:!0}})}}Eie.COMMAND="318";class xie extends en{constructor(e,t,r){super(e,t,r,{me:{},nick:{},channels:{trailing:!0}})}}xie.COMMAND="319";class Tie extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},memberCount:{},topic:{trailing:!0}})}}Tie.COMMAND="322";class wie extends en{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}wie.COMMAND="323";class Aie extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},modes:{rest:!0}})}}Aie.COMMAND="324";class Rie extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Rie.COMMAND="331";class Cie extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},topic:{trailing:!0}})}}Cie.COMMAND="332";class Mie extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},who:{},ts:{}})}}Mie.COMMAND="333";class kie extends en{constructor(e,t,r){super(e,t,r,{me:{},nick:{},channel:{type:"channel"}})}}kie.COMMAND="341";class Oie extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}Oie.COMMAND="348";class Iie extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Iie.COMMAND="349";class Nie extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{},user:{},host:{},server:{},nick:{},flags:{},hopsAndRealName:{trailing:!0}})}get isAway(){return this.flags.includes("G")}get isOper(){return this.flags.includes("*")}get isBot(){return this.flags.includes("B")}isResponseTo(e){return e instanceof S3}}Nie.COMMAND="352";class Pie extends en{constructor(e,t,r){super(e,t,r,{me:{},channelType:{},channel:{type:"channel"},names:{trailing:!0}})}isResponseTo(e){return e instanceof jR}}Pie.COMMAND="353";class Die extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof jR}endsResponseTo(){return!0}}Die.COMMAND="366";class Lie extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}Lie.COMMAND="367";class Uie extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Uie.COMMAND="368";class Bie extends en{constructor(e,t,r){super(e,t,r,{me:{},line:{trailing:!0}})}}Bie.COMMAND="372";class Fie extends en{constructor(e,t,r){super(e,t,r,{me:{},line:{trailing:!0}})}}Fie.COMMAND="375";class dB extends en{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}dB.COMMAND="376";class jie extends en{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}jie.COMMAND="381";class zie extends en{constructor(e,t,r){super(e,t,r,{me:{},server:{optional:!0},timestamp:{trailing:!0}})}}zie.COMMAND="391";class Hie extends en{constructor(e,t,r){super(e,t,r,{me:{},nick:{},suffix:{trailing:!0}})}}Hie.COMMAND="401";class Vie extends en{constructor(e,t,r){super(e,t,r,{me:{},server:{},suffix:{trailing:!0}})}}Vie.COMMAND="402";class Gie extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{},suffix:{trailing:!0}})}}Gie.COMMAND="403";class $ie extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}$ie.COMMAND="404";class Wie extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Wie.COMMAND="405";class qie extends en{constructor(e,t,r){super(e,t,r,{me:{},subCommand:{},suffix:{trailing:!0}})}}qie.COMMAND="410";class Yie extends en{constructor(e,t,r){super(e,t,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command===this.originalCommand}endsResponseTo(){return!0}}Yie.COMMAND="421";class pB extends en{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}pB.COMMAND="422";class Kie extends en{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Kie.COMMAND="431";class Xie extends en{constructor(e,t,r){super(e,t,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Xie.COMMAND="432";class Zie extends en{constructor(e,t,r){super(e,t,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Zie.COMMAND="433";class Jie extends en{constructor(e,t,r){super(e,t,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Jie.COMMAND="436";class Qie extends en{constructor(e,t,r){super(e,t,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Qie.COMMAND="441";class ese extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}ese.COMMAND="442";class tse extends en{constructor(e,t,r){super(e,t,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}tse.COMMAND="443";class nse extends en{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}nse.COMMAND="451";class rse extends en{constructor(e,t,r){super(e,t,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}}rse.COMMAND="461";class mB extends en{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}mB.COMMAND="462";class ise extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}ise.COMMAND="471";class sse extends en{constructor(e,t,r){super(e,t,r,{me:{},char:{},suffix:{trailing:!0}})}}sse.COMMAND="472";class ose extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}ose.COMMAND="473";class ase extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}ase.COMMAND="474";class cse extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}cse.COMMAND="475";class lse extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{},suffix:{trailing:!0}})}}lse.COMMAND="479";class use extends en{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}use.COMMAND="481";class hse extends en{constructor(e,t,r){super(e,t,r,{me:{},channel:{},suffix:{trailing:!0}})}}hse.COMMAND="482";class fse extends en{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}fse.COMMAND="491";class dse extends en{constructor(e,t,r){super(e,t,r,{me:{},modeChar:{optional:!0,match:/^\w$/},suffix:{trailing:!0}})}}dse.COMMAND="501";class pse extends en{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}pse.COMMAND="502";const mse=Object.freeze(Object.defineProperty({__proto__:null,Error401NoSuchNick:Hie,Error402NoSuchServer:Vie,Error403NoSuchChannel:Gie,Error404CanNotSendToChan:$ie,Error405TooManyChannels:Wie,Error410InvalidCapCmd:qie,Error421UnknownCommand:Yie,Error422NoMotd:pB,Error431NoNickNameGiven:Kie,Error432ErroneusNickname:Xie,Error433NickNameInUse:Zie,Error436NickCollision:Jie,Error441UserNotInChannel:Qie,Error442NotOnChannel:ese,Error443UserOnChannel:tse,Error451NotRegistered:nse,Error461NeedMoreParams:rse,Error462AlreadyRegistered:mB,Error471ChannelIsFull:ise,Error472UnknownMode:sse,Error473InviteOnlyChan:ose,Error474BannedFromChan:ase,Error475BadChannelKey:cse,Error479BadChanName:lse,Error481NoPrivileges:use,Error482ChanOpPrivsNeeded:hse,Error491NoOperHost:fse,Error501UmodeUnknownFlag:dse,Error502UsersDontMatch:pse,Reply001Welcome:uB,Reply002YourHost:die,Reply003Created:pie,Reply004ServerInfo:hB,Reply005Isupport:fB,Reply221UmodeIs:mie,Reply301Away:gie,Reply302UserHost:_ie,Reply305UnAway:vie,Reply306NowAway:yie,Reply311WhoisUser:bie,Reply315EndOfWho:Sie,Reply318EndOfWhois:Eie,Reply319WhoisChannels:xie,Reply322List:Tie,Reply323ListEnd:wie,Reply324ChannelModeIs:Aie,Reply331NoTopic:Rie,Reply332Topic:Cie,Reply333TopicWhoTime:Mie,Reply341Inviting:kie,Reply348ExceptList:Oie,Reply349EndOfExceptList:Iie,Reply352WhoReply:Nie,Reply353NamesReply:Pie,Reply366EndOfNames:Die,Reply367BanList:Lie,Reply368EndOfBanList:Uie,Reply372Motd:Bie,Reply375MotdStart:Fie,Reply376EndOfMotd:dB,Reply381YoureOper:jie,Reply391Time:zie},Symbol.toStringTag,{value:"Module"})),Tqe=new Map([...Object.values(fie),...Object.values(mse)].map(n=>[n.COMMAND,n]));function wqe(n){const[e,t]=rb(n,"!",2);if(t){const[r,i]=rb(t,"@",2);return i?{nick:e,user:r,host:i}:{nick:e,host:r}}return{nick:e}}const T$={":":";",n:`
`,r:"\r",s:" "};function Aqe(n){const e=new Map,t=n.split(";");for(const r of t){const[i,s]=rb(r,"=",2);i!==""&&e.set(i,s?s.replace(/\\(.?)/g,(o,a)=>Object.prototype.hasOwnProperty.call(T$,a)?T$[a]:a):"")}return e}function Rqe(n,e=KE,t=Tqe,r=!1,i=[],s=!0){const o=n.split(" ");let a,c;const l=[];let u,h;for(;o.length;){if([a]=o,a.startsWith("@")&&!u&&!c&&!h)u=Aqe(a.slice(1));else if(a.startsWith(":"))if(!h&&!c)a.length>1&&(h=wqe(a.slice(1)));else{l.push({value:o.join(" ").slice(1),trailing:!0});break}else c?l.push({value:a,trailing:!1}):c=a.toUpperCase();o.shift()}if(u||(u=new Map),!c)throw new Error(`line without command received: ${n}`);s&&(s=!i.includes(c));let f=en;return t.has(c)&&(f=t.get(c)),new f(c,{params:l,tags:u,prefix:h,rawLine:n},{serverProperties:e,isServer:r,shouldParseParams:s})}class gse extends BR{constructor(e){super(),this._registered=!1,this._supportsCapabilities=!0,this._events=new Map,this._registeredMessageTypes=new Map,this.onConnect=this.registerEvent(),this.onRegister=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onPrivmsg=this.registerEvent(),this.onAction=this.registerEvent(),this.onNotice=this.registerEvent(),this.onNickChange=this.registerEvent(),this.onCtcp=this.registerEvent(),this.onCtcpReply=this.registerEvent(),this.onPasswordError=this.registerEvent(),this.onAnyMessage=this.registerEvent(),this._serverProperties=jw(KE),this._supportedFeatures={},this._collectors=[],this._clientCapabilities=new Map,this._serverCapabilities=new Map,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._hasRegisteredBefore=!1,this._channelsFromLastRegister=new Set,this._initialConnectionSetupDone=!1;const{connection:t,credentials:r,channels:i,channelTypes:s,webSocket:o,logger:a={}}=e;this._options=e;const{pingOnInactivity:c=60,pingTimeout:l=10}=t;this._pingOnInactivity=c,this._pingTimeout=l,this._currentNick=r.nick,this._logger=v3({name:"ircv3",emoji:!0,...a}),this.registerCoreMessageTypes();const{hostName:u,secure:h,reconnect:f=!0}=t,d={hostName:u,port:this.port,secure:h},p={lineBased:!0,logger:this._logger,additionalOptions:e.connectionOptions},_=o?oqe:iqe;f?this._connection=new sqe(_,d,p):this._connection=new _(p,this._logger,e.connectionOptions);for(const g of Object.values(Eqe))this.addCapability(g);this.addInternalListener(this.onRegister,async()=>{const g=this._hasRegisteredBefore,m=this._channelsFromLastRegister;this._hasRegisteredBefore=!0,this._channelsFromLastRegister=new Set;const b=g&&this._options.rejoinChannelsOnReconnect?m:await P4(i);if(b)for(const y of b)this.join(y)}),this.onTypedMessage(pd,async({subCommand:g,capabilities:m})=>{const b=m.split(" ");switch(g.toUpperCase()){case"NEW":{this._logger.debug(`Server registered new capabilities: ${b.join(", ")}`);const y=lC(b,T=>{if(!T)return{};const[k,R]=rb(T,"=",2);return{[k]:{name:k,param:R||!0}}});for(const[T,k]of Object.entries(y))this._serverCapabilities.set(T,k);const x=Object.keys(y);await this._negotiateCapabilities(Array.from(this._clientCapabilities.entries()).filter(([T])=>x.includes(T)).map(([,T])=>T));break}case"DEL":{this._logger.debug(`Server removed capabilities: ${b.join(", ")}`);for(const y of b)this._serverCapabilities.delete(y),this._negotiatedCapabilities.delete(y)}}}),this.onTypedMessage(Nk,({text:g})=>{this.sendMessage(Pk,{text:g})}),this.onTypedMessage(uB,({me:g})=>this._handleReceivedClientNick(g)),this.onTypedMessage(hB,({userModes:g})=>{g&&(this._serverProperties.supportedUserModes=g)}),this.onTypedMessage(fB,({supports:g})=>{const m=lC(g.split(" "),b=>{const[y,x]=rb(b,"=",2);return{[y]:x||!0}});this._supportedFeatures={...this._supportedFeatures,...m}}),this.onTypedMessage(dB,({me:g})=>{this._registered||(this._handleReceivedClientNick(g),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(pB,({me:g})=>{this._registered||(this._handleReceivedClientNick(g),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(mB,({me:g})=>{this._registered||(this._logger.warn("We thought we're not registered yet, but we actually are"),this._handleReceivedClientNick(g),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(UA,g=>{var m;const{target:b,text:y}=g,x=x$(y),T=(m=g.prefix)===null||m===void 0?void 0:m.nick;x?x.command==="ACTION"?this.emit(this.onAction,b,T,x.params,g):this.emit(this.onCtcp,b,T,x.command,x.params,g):this.emit(this.onPrivmsg,b,T,y,g)}),this.onTypedMessage(zw,g=>{var m;const{nick:b}=g,y=(m=g.prefix)===null||m===void 0?void 0:m.nick;y===this._currentNick&&(this._currentNick=b),this.emit(this.onNickChange,y,b,g)}),this.onTypedMessage(b3,g=>{var m;const{target:b,text:y}=g,x=x$(y),T=(m=g.prefix)===null||m===void 0?void 0:m.nick;x&&this.emit(this.onCtcpReply,b,T,x.command,x.params,g),this.emit(this.onNotice,b,T,y,g)}),this._options.manuallyAcknowledgeJoins||this.onTypedMessage(DA,({channel:g,prefix:m})=>{m?.nick===this._currentNick&&this.acknowledgeJoin(g)}),this.onTypedMessage(LA,g=>{var m;((m=g.prefix)===null||m===void 0?void 0:m.nick)===this._currentNick&&(this._currentChannels.delete(g.channel),this._channelsFromLastRegister.delete(g.channel))}),this.addInternalListener(this.onRegister,()=>this._startPingCheckTimer()),this._desiredNick=r.nick,this._userName=r.userName,this._realName=r.realName,s&&(this._serverProperties.channelTypes=s)}receiveLine(e){var t;this._logger.debug(`Received message: ${e}`);let r;try{r=Rqe(e,this._serverProperties,this._registeredMessageTypes,!0,this._options.nonConformingCommands)}catch(i){this._logger.error(`Error parsing message: ${i.message}`),this._logger.trace((t=i.stack)!==null&&t!==void 0?t:"No stack available");return}this._logger.trace(`Parsed message: ${JSON.stringify(r)}`),this._startPingCheckTimer(),this.emit(this.onAnyMessage,r),this._handleEvents(r)}get serverProperties(){return jw(this._serverProperties)}get port(){const{webSocket:e,connection:{port:t,secure:r}}=this._options;return t||(e?r?443:80:r?6697:6667)}pingCheck(){const e=Date.now(),t=e.toString(),r=this.onTypedMessage(Pk,i=>{const{text:s}=i;s===t&&(this._logger.debug(`Current ping: ${Date.now()-e}ms`),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),this.removeMessageListener(r))});this._pingTimeoutTimer=setTimeout(()=>{this.removeMessageListener(r),this._options.connection.reconnect===!1?this._logger.error(`Disconnecting because the last ping took over ${this._pingTimeout} seconds`):this._logger.warn(`Reconnecting because the last ping took over ${this._pingTimeout} seconds`),this._connection.assumeExternalDisconnect()},this._pingTimeout*1e3),this.sendMessage(Nk,{text:t})}reconnect(e){this.quit(e),this.connect()}registerMessageType(e){e.COMMAND!==""&&(this._logger.trace(`Registering message type ${e.COMMAND}`),this._registeredMessageTypes.set(e.COMMAND.toUpperCase(),e))}knowsCommand(e){return this._registeredMessageTypes.has(e.toUpperCase())}getCommandClass(e){return this._registeredMessageTypes.get(e.toUpperCase())}acknowledgeJoin(e){this._currentChannels.add(e),this._channelsFromLastRegister.add(e)}connect(){this._supportsCapabilities=!1,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._currentNick=this._desiredNick,this._setupConnection(),this._logger.info(`Connecting to ${this._options.connection.hostName}:${this.port}`),this._connection.connect()}addCapability(e){if(this._clientCapabilities.set(e.name,e),e.messageTypes)for(const t of Object.values(e.messageTypes))this.registerMessageType(t)}async registerCapability(e){return this.addCapability(e),this._serverCapabilities.has(e.name)?await this._negotiateCapabilities([e]):[]}send(e){this.sendRaw(e.toString())}sendRaw(e){this._connection.isConnected&&(this._logger.debug(`Sending message: ${e}`),this._connection.sendLine(e))}onNamedMessage(e,t,r){this._events.has(e)||this._events.set(e,new Map);const i=this._events.get(e);if(!r)do r=`${e}:${SWe(Math.random()*1e4,4,"0")}`;while(i.has(r));return i.set(r,t),r}onTypedMessage(e,t,r){return this.onNamedMessage(e.COMMAND,t,r)}removeMessageListener(e){const[t]=e.split(":");this._events.has(t)&&this._events.get(t).delete(e)}createMessage(e,t,r){const i=r?new Map(Object.entries(r)):void 0;return pqe(e,t,void 0,i,this.serverProperties)}sendMessage(e,t,r){this.send(this.createMessage(e,t,r))}async sendMessageAndCaptureReply(e,t){if(!e.SUPPORTS_CAPTURE)throw new Error(`The command "${e.COMMAND}" does not support reply capture`);const r=this.createMessage(e,t),i=this.collect(r).promise();return this.send(r),await i}get isConnected(){return this._connection.isConnected}get isConnecting(){return this._connection.isConnecting}get isRegistered(){return this._registered}get currentNick(){return this._currentNick}get currentChannels(){return Array.from(this._currentChannels)}collect(e,...t){const r=new xqe(this,e,...t);return this._collectors.push(r),r}stopCollect(e){this._collectors.splice(this._collectors.findIndex(t=>t===e),1)}join(e,t){this.sendMessage(DA,{channel:e,key:t})}part(e){this.sendMessage(LA,{channel:e})}quit(e){this.sendMessage(lB,{text:e}),this.quitAbruptly()}quitAbruptly(){this._registered=!1,this._connection.disconnect()}say(e,t,r={}){this.sendMessage(UA,{target:e,text:t},r)}sendCtcp(e,t,r){this.say(e,`${t.toUpperCase()} ${r}`)}action(e,t){this.sendCtcp(e,"ACTION",t)}changeNick(e){this._currentNick!==e&&(this._desiredNick=e,this.isRegistered&&this.sendMessage(zw,{nick:e}))}registerCoreMessageTypes(){D4(fie,e=>{this.registerMessageType(e)}),D4(mse,e=>{this.registerMessageType(e)})}async _negotiateCapabilityBatch(e){return await Promise.all(e.filter(t=>t.length).map(async t=>await this._negotiateCapabilities(t)))}async _negotiateCapabilities(e){const t=lC(e,o=>({[o.name]:o})),i=(await this.sendMessageAndCaptureReply(pd,{subCommand:"REQ",capabilities:e.map(o=>o.name).join(" ")})).shift();if(!i)throw new Error("capability negotiation failed unexpectedly without any reply");if(!(i instanceof pd))throw new Error(`capability negotiation failed unexpectedly with "${i.command}" command`);const s=i.capabilities.split(" ").filter(o=>o);if(i.subCommand==="ACK"){this._logger.debug(`Successfully negotiated capabilities: ${s.join(", ")}`);const o=s.map(a=>t[a]);for(const a of o){const c=this._clientCapabilities.get(a.name);c.param=a.param,this._negotiatedCapabilities.set(c.name,c)}return o}return this._logger.warn(`Failed to negotiate capabilities: ${s.join(", ")}`),new Error("capabilities failed to negotiate")}_setupConnection(){this._initialConnectionSetupDone||(this._connection.onConnect(async()=>{var e,t;this._logger.info(`Connection to server ${this._options.connection.hostName}:${this.port} established`),this.emit(this.onConnect),this._logger.debug("Determining connection password");try{const[r]=await Promise.all([P4(this._options.credentials.password),this.sendMessageAndCaptureReply(pd,{subCommand:"LS",version:"302"}).then(async i=>{if(!i.length||!(i[0]instanceof pd))return this._logger.debug("Server does not support capabilities"),[];this._supportsCapabilities=!0;const s=i.map(a=>lC(a.capabilities.split(" "),c=>{if(!c)return{};const[l,u]=rb(c,"=",2);return{[l]:{name:l,param:u||!0}}}));this._serverCapabilities=new Map(Object.entries(Object.assign({},...s))),this._logger.debug(`Capabilities supported by server: ${Array.from(this._serverCapabilities.keys()).join(", ")}`);const o=s.map(a=>{const c=Object.keys(a);return Array.from(this._clientCapabilities.entries()).filter(([l])=>c.includes(l)).map(([,l])=>l)});return await this._negotiateCapabilityBatch(o)}).then(()=>{this.sendMessage(pd,{subCommand:"END"})})]);r&&this.sendMessage(aB,{password:r}),this.sendMessage(zw,{nick:this._desiredNick}),this.sendMessage(cB,{user:(e=this._userName)!==null&&e!==void 0?e:this._desiredNick,mode:"8",unused:"*",realName:(t=this._realName)!==null&&t!==void 0?t:this._desiredNick})}catch(r){this.emit(this.onPasswordError,r),this.quit()}}),this._initialConnectionSetupDone=!0,this._connection.onReceive(e=>{this.receiveLine(e)}),this._connection.onDisconnect((e,t)=>{var r;if(this._registered=!1,this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),e)this._logger.info("Disconnected");else{const i=(r=this._options.connection.reconnect)!==null&&r!==void 0?r:!0,s=t?`Disconnected unexpectedly: ${t.message}`:"Disconnected unexpectedly";i?this._logger.warn(`${s}; trying to reconnect`):this._logger.error(s)}this.emit(this.onDisconnect,e,t)}),this._connection.onEnd(e=>{e||this._logger.warn("No further retries will be made")}))}_handleReceivedClientNick(e){this._currentNick!==e&&(this._currentNick!==""&&this._logger.warn(`Mismatching nicks: passed ${this._currentNick}, but you're actually ${e}`),this._currentNick=e)}_handleEvents(e){this._collectors.some(r=>r.collect(e));const t=this._events.get(e.constructor.COMMAND);if(t)for(const r of t.values())r(e)}_startPingCheckTimer(){this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._connection.isConnected?this._pingCheckTimer=setTimeout(()=>this.pingCheck(),this._pingOnInactivity*1e3):this._pingCheckTimer=void 0}}Os([ly(!1)],gse.prototype,"_options",void 0);class gB extends en{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},user:{trailing:!0,optional:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get channelId(){return this._tags.get("room-id")}get targetUserId(){var e;return(e=this._tags.get("target-user-id"))!==null&&e!==void 0?e:null}}gB.COMMAND="CLEARCHAT";class _se extends en{}_se.COMMAND="RECONNECT";class _B extends en{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"}})}}_B.COMMAND="ROOMSTATE";function Cqe(n){switch(typeof n){case"undefined":return"";case"object":{if(n===null)return"";if("cacheKey"in n)return n.cacheKey;const e=JSON.stringify(n);if(e!=="{}")return e}default:return n.toString()}}function vse(n,e,t){return[n,...e.map(Cqe)].join("/")+(t?"/":"")}const Pg=Symbol("cache");function Mqe(n){var e,t;return t=class extends n{constructor(){super(...arguments),this[e]=new Map}getFromCache(r){if(this._cleanCache(),this[Pg].has(r)){const i=this[Pg].get(r);if(i)return i.value}}setCache(r,i,s){this[Pg].set(r,{value:i,expires:Date.now()+s*1e3})}removeFromCache(r,i){const s=this._getInternalCacheKey(r,i);i?this[Pg].forEach((o,a)=>{a.startsWith(s)&&this[Pg].delete(a)}):this[Pg].delete(s)}_cleanCache(){const r=Date.now();this[Pg].forEach((i,s)=>{i.expires<r&&this[Pg].delete(s)})}_getInternalCacheKey(r,i){if(typeof r=="string"){let s=r;return s.endsWith("/")||(s+="/"),s}else{const s=r.shift();return vse(s,r,i)}}},e=Pg,t}function yse(n=1/0){return function(e,t,r){if(r.get){const i=r.get;r.get=function(){const s=vse(t,[]),o=this.getFromCache(s);if(o)return o;const a=i.call(this);return this.setCache(s,a,n),a}}return r}}var eM;let Zv=eM=class{constructor(e,t){this._userName=e.toLowerCase(),this._userData=t?new Map(t):new Map}static _parseBadgesLike(e){return e?new Map(e.split(",").map(t=>{const r=t.indexOf("/");return r===-1?[t,""]:[t.slice(0,r),t.slice(r+1)]})):new Map}get userName(){return this._userName}get displayName(){var e;return(e=this._userData.get("display-name"))!==null&&e!==void 0?e:this._userName}get color(){return this._userData.get("color")}get badges(){const e=this._userData.get("badges");return eM._parseBadgesLike(e)}get badgeInfo(){const e=this._userData.get("badge-info");return eM._parseBadgesLike(e)}get userId(){return this._userData.get("user-id")}get userType(){return this._userData.get("user-type")}get isBroadcaster(){return this.badges.has("broadcaster")}get isSubscriber(){return this.badges.has("subscriber")||this.isFounder}get isFounder(){return this.badges.has("founder")}get isMod(){return this.badges.has("moderator")}get isVip(){const e=this._userData.get("vip");return e!=null&&e!=="0"}get isArtist(){return this.badges.has("artist-badge")}};Os([ly(!1)],Zv.prototype,"_userData",void 0);Os([yse()],Zv.prototype,"badges",null);Os([yse()],Zv.prototype,"badgeInfo",null);Zv=eM=Os([Mqe,FR("chat","ChatUser","userId")],Zv);function vB(n){return n?new Map(n.split("/").map(e=>{const[t,r]=e.split(":",2);return r?[t,r.split(",")]:null}).filter(e=>e!==null)):new Map}class yB extends en{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},text:{trailing:!0,optional:!0}})}get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new Zv(this._tags.get("login"),this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get emoteOffsets(){return vB(this._tags.get("emotes"))}}yB.COMMAND="USERNOTICE";class bse extends en{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"}})}}bse.COMMAND="USERSTATE";class bB extends en{constructor(e,t,r){super(e,t,r,{target:{},text:{trailing:!0}})}get userInfo(){return new Zv(this._prefix.nick,this._tags)}get emoteOffsets(){return vB(this._tags.get("emotes"))}}bB.COMMAND="WHISPER";const kqe={name:"twitch.tv/commands",messageTypes:[gB,_se,_B,yB,bse,bB]},Oqe={name:"twitch.tv/membership"};class SB extends en{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},text:{trailing:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userName(){return this._tags.get("login")}get channelId(){return this._tags.get("room-id")}get targetMessageId(){return this._tags.get("target-msg-id")}}SB.COMMAND="CLEARMSG";class Sse extends en{}Sse.COMMAND="GLOBALUSERSTATE";const Iqe={name:"twitch.tv/tags",messageTypes:[Sse,SB]},Nqe=["ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","TEN"];let Dk=class extends UA{get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new Zv(this._prefix.nick,this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get isCheer(){return this._tags.has("bits")}get isRedemption(){return!!this._tags.get("custom-reward-id")}get rewardId(){return this._tags.get("custom-reward-id")||null}get isFirst(){return this._tags.get("first-msg")==="1"}get isReturningChatter(){return this._tags.get("returning-chatter")==="1"}get isHighlight(){return this._tags.get("msg-id")==="highlighted-message"}get isReply(){return this._tags.has("reply-parent-msg-id")}get parentMessageId(){var e;return(e=this._tags.get("reply-parent-msg-id"))!==null&&e!==void 0?e:null}get parentMessageText(){var e;return(e=this._tags.get("reply-parent-msg-body"))!==null&&e!==void 0?e:null}get parentMessageUserId(){var e;return(e=this._tags.get("reply-parent-user-id"))!==null&&e!==void 0?e:null}get parentMessageUserName(){var e;return(e=this._tags.get("reply-parent-user-login"))!==null&&e!==void 0?e:null}get parentMessageUserDisplayName(){var e;return(e=this._tags.get("reply-parent-display-name"))!==null&&e!==void 0?e:null}get threadMessageId(){var e;return(e=this._tags.get("reply-thread-parent-msg-id"))!==null&&e!==void 0?e:null}get threadMessageUserId(){var e;return(e=this._tags.get("reply-thread-parent-user-id"))!==null&&e!==void 0?e:null}get bits(){var e;return Number((e=this._tags.get("bits"))!==null&&e!==void 0?e:0)}get emoteOffsets(){return vB(this._tags.get("emotes"))}get isHypeChat(){return this._tags.has("pinned-chat-paid-amount")}get hypeChatAmount(){return NA(this._tags.get("pinned-chat-paid-amount"),Number)}get hypeChatDecimalPlaces(){return NA(this._tags.get("pinned-chat-paid-exponent"),Number)}get hypeChatLocalizedAmount(){const e=this.hypeChatAmount;return e?e/10**this.hypeChatDecimalPlaces:null}get hypeChatCurrency(){var e;return(e=this._tags.get("pinned-chat-paid-currency"))!==null&&e!==void 0?e:null}get hypeChatLevel(){const e=this._tags.get("pinned-chat-paid-level");return e?Nqe.indexOf(e)+1:null}get hypeChatIsSystemMessage(){const e=this._tags.get("pinned-chat-paid-is-system-message");return e?!!Number(e):null}};Dk=Os([FR("chat","ChatMessage","id")],Dk);function Pqe(n){return n instanceof Dk?n.tags.get("id"):n}function w$(n,e){if(n.length<=e)return[n];n=n.trim();const t=[];let r=0,i=e;for(;r<n.length;){let s=n.lastIndexOf(" ",i);(s===-1||s<=r||n.length-r+1<=e)&&(s=r+e);const o=n.slice(r,s).trim();o.length&&t.push(o),r=s+(n[s]===" "?1:0),i=r+e}return t}const Dqe=/^[a-z0-9][a-z0-9_]{0,24}$/;function bc(n){const e=n.replace(/^#/,"").toLowerCase();if(!Dqe.test(e))throw new Error(`"${e}" is not a valid user or channel name. It must be at most 25 characters long, can only include letters, numbers and underscores, and can not start with an underscore.`);return e}function uC(n){return`#${bc(n)}`}var j4;let Lk=j4=class extends BR{constructor(e={}){var t,r,i,s,o,a,c;if(e.authProvider&&!e.authProvider.getAccessTokenForIntent)throw new JC("You can not connect to chat using an AuthProvider that does not support intents.\nTo get an anonymous, read-only connection, please don't pass an `AuthProvider` at all.\nTo get a read-write connection, please provide an auth provider that provides user access tokens via intents, such as `RefreshingAuthProvider`.");super(),this._authVerified=!1,this._authRetryCount=0,this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onTimeout=this.registerEvent(),this.onBan=this.registerEvent(),this.onBitsBadgeUpgrade=this.registerEvent(),this.onChatClear=this.registerEvent(),this.onEmoteOnly=this.registerEvent(),this.onFollowersOnly=this.registerEvent(),this.onJoin=this.registerEvent(),this.onJoinFailure=this.registerEvent(),this.onPart=this.registerEvent(),this.onMessageRemove=this.registerEvent(),this.onUniqueChat=this.registerEvent(),this.onRaid=this.registerEvent(),this.onRaidCancel=this.registerEvent(),this.onRitual=this.registerEvent(),this.onSlow=this.registerEvent(),this.onSubsOnly=this.registerEvent(),this.onSub=this.registerEvent(),this.onResub=this.registerEvent(),this.onSubGift=this.registerEvent(),this.onCommunitySub=this.registerEvent(),this.onSubExtend=this.registerEvent(),this.onRewardGift=this.registerEvent(),this.onPrimePaidUpgrade=this.registerEvent(),this.onGiftPaidUpgrade=this.registerEvent(),this.onPrimeCommunityGift=this.registerEvent(),this.onStandardPayForward=this.registerEvent(),this.onCommunityPayForward=this.registerEvent(),this.onAnnouncement=this.registerEvent(),this.onWhisper=this.registerEvent(),this.onNoPermission=this.registerEvent(),this.onMessageRatelimit=this.registerEvent(),this.onAuthenticationSuccess=this.registerEvent(),this.onAuthenticationFailure=this.registerEvent(),this.onTokenFetchFailure=this.registerEvent(),this.onMessageFailed=this.registerEvent(),this.onMessage=this.registerEvent(),this.onAction=this.registerEvent(),this._onJoinResult=this.registerInternalEvent(),this._ircClient=new gse({connection:{hostName:(t=e.hostName)!==null&&t!==void 0?t:!((r=e.webSocket)!==null&&r!==void 0)||r?"irc-ws.chat.twitch.tv":"irc.chat.twitch.tv",secure:(i=e.ssl)!==null&&i!==void 0?i:!0},credentials:{nick:"",password:async()=>await this._getAuthToken()},webSocket:(s=e.webSocket)!==null&&s!==void 0?s:!0,connectionOptions:e.connectionOptions,logger:{name:"twurple:chat:irc",...e.logger},nonConformingCommands:["004"],manuallyAcknowledgeJoins:!0,rejoinChannelsOnReconnect:e.rejoinChannelsOnReconnect}),this._ircClient.onDisconnect((l,u)=>{var h,f,d,p;(h=this._messageRateLimiter)===null||h===void 0||h.clear(),(f=this._messageRateLimiter)===null||f===void 0||f.pause(),(d=this._joinRateLimiter)===null||d===void 0||d.clear(),(p=this._joinRateLimiter)===null||p===void 0||p.pause(),this.emit(this.onDisconnect,l,u)}),this._ircClient.registerMessageType(Dk),this._chatLogger=v3({name:"twurple:chat:twitch",...e.logger}),this._authProvider=e.authProvider,this._useLegacyScopes=!!e.legacyScopes,this._readOnly=!!e.readOnly,this._authIntents=[...(o=e.authIntents)!==null&&o!==void 0?o:[],"chat"],this._isAlwaysMod=(a=e.isAlwaysMod)!==null&&a!==void 0?a:!1,this._botLevel=(c=e.botLevel)!==null&&c!==void 0?c:"none",this._ircClient.addCapability(Iqe),this._ircClient.addCapability(kqe),e.requestMembershipEvents&&this._ircClient.addCapability(Oqe),this._ircClient.onConnect(()=>{this.emit(this.onConnect)}),this._ircClient.onRegister(async()=>{var l,u;(l=this._messageRateLimiter)===null||l===void 0||l.resume(),(u=this._joinRateLimiter)===null||u===void 0||u.resume(),this._authVerified=!0,this._authRetryTimer=void 0,this._authRetryCount=0,this.emit(this.onAuthenticationSuccess);const h=await P4(e.channels);h&&await Promise.all(h.map(async f=>{var d;try{await this.join(f)}catch(p){this._chatLogger.warn(`Failed to join configured channel ${f}; original message: ${(d=p?.message)!==null&&d!==void 0?d:p}`)}}))}),this._ircClient.onPasswordError(l=>{this._chatLogger.error(`Error fetching a token for connecting to the server: ${l.message}`),this.emit(this.onTokenFetchFailure,l)}),this._ircClient.onPrivmsg((l,u,h,f)=>{u!=="jtv"&&this.emit(this.onMessage,bc(l),u,h,f)}),this._ircClient.onAction((l,u,h,f)=>{this.emit(this.onAction,bc(l),u,h,f)}),this.addInternalListener(this._onJoinResult,(l,u,h)=>{h?this.emit(this.onJoinFailure,bc(l),h):this._ircClient.acknowledgeJoin(l)}),this._ircClient.onTypedMessage(gB,l=>{const{channel:u,user:h,tags:f}=l,d=bc(u);if(h){const p=f.get("ban-duration");p===void 0?this.emit(this.onBan,d,h,l):this.emit(this.onTimeout,d,h,Number(p),l)}else this.emit(this.onChatClear,d,l)}),this._ircClient.onTypedMessage(SB,l=>{const{channel:u,targetMessageId:h}=l;this.emit(this.onMessageRemove,bc(u),h,l)}),this._ircClient.onTypedMessage(DA,({prefix:l,channel:u})=>{this.emit(this.onJoin,bc(u),l.nick)}),this._ircClient.onTypedMessage(LA,({prefix:l,channel:u})=>{this.emit(this.onPart,bc(u),l.nick)}),this._ircClient.onTypedMessage(_B,({channel:l,tags:u})=>{let h=!1;if(u.has("subs-only")&&u.has("slow")&&(this.emit(this._onJoinResult,l,u),h=!0),!h){const f=bc(l);if(u.has("slow")){const d=Number(u.get("slow"));d?this.emit(this.onSlow,f,!0,d):this.emit(this.onSlow,f,!1)}if(u.has("followers-only")){const d=Number(u.get("followers-only"));d===-1?this.emit(this.onFollowersOnly,f,!1):this.emit(this.onFollowersOnly,f,!0,d)}}}),this._ircClient.onTypedMessage(yB,l=>{const{channel:u,text:h,tags:f}=l,d=f.get("msg-id"),p=bc(u);switch(d){case"sub":case"resub":{const _=d==="sub"?this.onSub:this.onResub,g=f.get("msg-param-sub-plan"),m=f.get("msg-param-streak-months"),b={userId:f.get("user-id"),displayName:f.get("display-name"),plan:g,planName:f.get("msg-param-sub-plan-name"),isPrime:g==="Prime",months:Number(f.get("msg-param-cumulative-months")),streak:m?Number(m):void 0,message:h};if(f.get("msg-param-was-gifted")==="true"){const x=f.get("msg-param-anon-gift")==="true",T=Number(f.get("msg-param-gift-months")),k=Number(f.get("msg-param-gift-month-being-redeemed"));x?b.originalGiftInfo={anonymous:!0,duration:T,redeemedMonth:k}:b.originalGiftInfo={anonymous:!1,duration:T,redeemedMonth:k,userId:f.get("msg-param-gifter-id"),userName:f.get("msg-param-gifter-login"),userDisplayName:f.get("msg-param-gifter-name")}}this.emit(_,p,f.get("login"),b,l);break}case"subgift":{const _=f.get("msg-param-sub-plan"),g=f.get("login"),m=g==="ananonymousgifter",b={userId:f.get("msg-param-recipient-id"),displayName:f.get("msg-param-recipient-display-name"),gifter:m?void 0:g,gifterUserId:m?void 0:f.get("user-id"),gifterDisplayName:m?void 0:f.get("display-name"),gifterGiftCount:m?void 0:Number(f.get("msg-param-sender-count")),giftDuration:Number(f.get("msg-param-gift-months")),plan:_,planName:f.get("msg-param-sub-plan-name"),isPrime:_==="Prime",months:Number(f.get("msg-param-months"))};this.emit(this.onSubGift,p,f.get("msg-param-recipient-user-name"),b,l);break}case"submysterygift":{const _=f.get("login"),g=_==="ananonymousgifter",m={gifter:g?void 0:_,gifterUserId:g?void 0:f.get("user-id"),gifterDisplayName:g?void 0:f.get("display-name"),gifterGiftCount:g?void 0:Number(f.get("msg-param-sender-count")),count:Number(f.get("msg-param-mass-gift-count")),plan:f.get("msg-param-sub-plan")};this.emit(this.onCommunitySub,p,f.get("login"),m,l);break}case"primepaidupgrade":{const _={userId:f.get("user-id"),displayName:f.get("display-name"),plan:f.get("msg-param-sub-plan")};this.emit(this.onPrimePaidUpgrade,p,f.get("login"),_,l);break}case"giftpaidupgrade":{const _={userId:f.get("user-id"),displayName:f.get("display-name"),gifter:f.get("msg-param-sender-login"),gifterDisplayName:f.get("msg-param-sender-name")};this.emit(this.onGiftPaidUpgrade,p,f.get("login"),_,l);break}case"standardpayforward":{const _=f.get("msg-param-prior-gifter-anonymous")==="true",g={userId:f.get("user-id"),displayName:f.get("display-name"),originalGifterUserId:_?void 0:f.get("msg-param-prior-gifter-id"),originalGifterDisplayName:_?void 0:f.get("msg-param-prior-gifter-display-name"),recipientUserId:f.get("msg-param-recipient-id"),recipientDisplayName:f.get("msg-param-recipient-display-name")};this.emit(this.onStandardPayForward,p,f.get("login"),g,l);break}case"communitypayforward":{const _=f.get("msg-param-prior-gifter-anonymous")==="true",g={userId:f.get("user-id"),displayName:f.get("display-name"),originalGifterUserId:_?void 0:f.get("msg-param-prior-gifter-id"),originalGifterDisplayName:_?void 0:f.get("msg-param-prior-gifter-display-name")};this.emit(this.onCommunityPayForward,p,f.get("login"),g,l);break}case"primecommunitygiftreceived":{const _={name:f.get("msg-param-gift-name"),gifter:f.get("login"),gifterDisplayName:f.get("display-name")};this.emit(this.onPrimeCommunityGift,p,f.get("msg-param-recipient"),_,l);break}case"raid":{const _={displayName:f.get("msg-param-displayName"),viewerCount:Number(f.get("msg-param-viewerCount"))};this.emit(this.onRaid,p,f.get("login"),_,l);break}case"unraid":{this.emit(this.onRaidCancel,p,l);break}case"ritual":{const _={ritualName:f.get("msg-param-ritual-name"),message:h};this.emit(this.onRitual,p,f.get("login"),_,l);break}case"bitsbadgetier":{const _={displayName:f.get("display-name"),threshold:Number(f.get("msg-param-threshold"))};this.emit(this.onBitsBadgeUpgrade,p,f.get("login"),_,l);break}case"extendsub":{const _={userId:f.get("user-id"),displayName:f.get("display-name"),plan:f.get("msg-param-sub-plan"),months:Number(f.get("msg-param-cumulative-months")),endMonth:Number(f.get("msg-param-sub-benefit-end-month"))};this.emit(this.onSubExtend,p,f.get("login"),_,l);break}case"rewardgift":{const _={domain:f.get("msg-param-domain"),gifterId:f.get("user-id"),gifterDisplayName:f.get("display-name"),count:Number(f.get("msg-param-selected-count")),gifterGiftCount:Number(f.get("msg-param-total-reward-count")),triggerType:f.get("msg-param-trigger-type")};this.emit(this.onRewardGift,p,f.get("login"),_,l);break}case"announcement":{const _={color:f.get("msg-param-color")};this.emit(this.onAnnouncement,p,f.get("login"),_,l);break}default:this._chatLogger.warn(`Unrecognized usernotice ID: ${d}`)}}),this._ircClient.onTypedMessage(bB,l=>{this.emit(this.onWhisper,l.prefix.nick,l.text,l)}),this._ircClient.onTypedMessage(b3,async({target:l,text:u,tags:h})=>{const f=h.get("msg-id");switch(f){case"emote_only_on":{this.emit(this.onEmoteOnly,bc(l),!0);break}case"emote_only_off":{this.emit(this.onEmoteOnly,bc(l),!1);break}case"msg_channel_suspended":case"msg_banned":{this.emit(this._onJoinResult,l,void 0,f);break}case"r9k_on":{this.emit(this.onUniqueChat,bc(l),!0);break}case"r9k_off":{this.emit(this.onUniqueChat,bc(l),!1);break}case"subs_on":{this.emit(this.onSubsOnly,bc(l),!0);break}case"subs_off":{this.emit(this.onSubsOnly,bc(l),!1);break}case"cmds_available":break;case"followers_on":case"followers_on_zero":case"followers_off":case"slow_on":case"slow_off":break;case"timeout_success":break;case"unrecognized_cmd":break;case"no_permission":{this.emit(this.onNoPermission,bc(l),u);break}case"msg_ratelimit":{this.emit(this.onMessageRatelimit,bc(l),u);break}case"msg_duplicate":case"msg_emoteonly":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_subsonly":case"msg_slowmode":case"msg_r9k":case"msg_verified_email":case"msg_timedout":case"msg_rejected_mandatory":case"msg_channel_blocked":{this.emit(this.onMessageFailed,bc(l),f);break}case void 0:{if(u==="Login authentication failed"||u==="Improperly formatted AUTH"||u==="Invalid NICK"){this._authVerified=!1,this._authRetryTimer||(this._authRetryTimer=Ire(120),this._authRetryCount=0);const d=this._authRetryTimer.next().value,p=++this._authRetryCount;this.emit(this.onAuthenticationFailure,u,p),d!==0&&this._chatLogger.info(`Retrying authentication in ${d} seconds`),await bWe(d*1e3),this._ircClient.reconnect()}break}default:f.startsWith("usage_")||this._chatLogger.warn(`Unrecognized notice ID: '${f}'`)}})}connect(){this._authProvider||this._ircClient.changeNick(j4._generateJustinfanNick()),this._initializeRateLimiters(),this._ircClient.connect()}get irc(){return this._ircClient}get isConnected(){return this._ircClient.isConnected}get isConnecting(){return this._ircClient.isConnecting}get currentChannels(){return this._ircClient.currentChannels}async say(e,t,r={},i){const s={};r.replyTo&&(s["reply-parent-msg-id"]=Pqe(r.replyTo));const o=w$(t,500);await Promise.all(o.map(async a=>await this._messageRateLimiter.request({type:"say",channel:uC(e),text:a,tags:s},i)))}async action(e,t,r){const i=w$(t,490);await Promise.all(i.map(async s=>await this._messageRateLimiter.request({type:"action",channel:uC(e),text:s},r)))}async join(e){await this._joinRateLimiter.request(uC(e))}part(e){this._ircClient.part(uC(e))}quit(){var e,t,r,i;(t=(e=this._messageRateLimiter)===null||e===void 0?void 0:e.destroy)===null||t===void 0||t.call(e),(i=(r=this._joinRateLimiter)===null||r===void 0?void 0:r.destroy)===null||i===void 0||i.call(r),this._messageRateLimiter=void 0,this._joinRateLimiter=void 0,this._ircClient.quitAbruptly()}reconnect(){this.quit(),this.connect()}async _getAuthToken(){var e,t;if(!this._authProvider){this._chatLogger.debug("No authProvider given; connecting anonymously");return}if(this._authToken&&!ZC(this._authToken)&&this._authVerified)return this._chatLogger.debug("AccessToken assumed to be correct from last connection"),`oauth:${this._authToken.accessToken}`;const r=this._getNecessaryScopes();let i,s=!1;for(const o of this._authIntents){try{if(this._authToken=await this._authProvider.getAccessTokenForIntent(o,r),!this._authToken)continue;s=!0;const a=await PA(this._authToken.accessToken);if(!a.userName)throw new JC("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(a.userName),`oauth:${this._authToken.accessToken}`}catch(a){a instanceof YE?i=a:this._chatLogger.error(`Retrieving an access token failed: ${a.message}`)}this._chatLogger.warn("No valid token available; trying to refresh");try{if(this._authToken=await((t=(e=this._authProvider).refreshAccessTokenForIntent)===null||t===void 0?void 0:t.call(e,o)),this._authToken){const a=await PA(this._authToken.accessToken);if(!a.userName)throw new JC("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(a.userName),`oauth:${this._authToken.accessToken}`}}catch(a){a instanceof YE?i=a:this._chatLogger.error(`Refreshing the access token failed: ${a.message}`)}}throw this._authVerified=!1,i??new Error(s?"Could not retrieve a valid token":`None of the queried intents (${this._authIntents.join(", ")}) are known by the auth provider${this._authProvider instanceof Xv?".\nPlease add one of these to the user you want to connect with using the `addIntentToUser` method or the additional parameter to `addUser` or `addUserForToken`.":""}`)}_getNecessaryScopes(){return this._useLegacyScopes?["chat_login"]:this._readOnly?["chat:read"]:["chat:read","chat:edit"]}static _generateJustinfanNick(){return`justinfan${Math.floor(Math.random()*1e5).toString().padStart(5,"0")}`}_initializeRateLimiters(){const e=async({type:r,text:i,channel:s,tags:o})=>{r==="say"?this._ircClient.say(s,i,o):this._ircClient.action(s,i)},t=async r=>{const{promise:i,resolve:s,reject:o}=L4();let a;const c=this.addInternalListener(this._onJoinResult,(l,u,h)=>{l===r&&(clearTimeout(a),h?o(h):s(),this.removeListener(c))});a=setTimeout(()=>{this.removeListener(c),this.emit(this._onJoinResult,r,void 0,"twurple_timeout"),o(new Error(`Did not receive a reply to join ${r} in time; assuming that the join failed`))},1e4),this._ircClient.join(r),await i};if(this._isAlwaysMod)this._messageRateLimiter=new U4({bucketSize:this._botLevel==="verified"?7500:100,timeFrame:32e3,doRequest:e});else{let r=20;this._botLevel==="verified"?r=7500:this._botLevel==="known"&&(r=50),this._messageRateLimiter=new IWe(new OWe({bucketSize:1,timeFrame:1200,logger:{minLevel:Sr.ERROR},doRequest:e,getPartitionKey:({channel:i})=>i}),{bucketSize:r,timeFrame:32e3})}this._joinRateLimiter=new U4({bucketSize:this._botLevel==="verified"?2e3:20,timeFrame:11e3,doRequest:t}),this._messageRateLimiter.pause(),this._joinRateLimiter.pause()}};Os([ly(!1)],Lk.prototype,"_authProvider",void 0);Lk=j4=Os([FR("chat","ChatClient")],Lk);var aD={exports:{}},A$;function Lqe(){return A$||(A$=1,(function(n,e){(function(t,r){n.exports=r()})(self,(()=>(()=>{var t={2505:(o,a,c)=>{o.exports=c(8015)},5592:(o,a,c)=>{var l=c(9516),u=c(7522),h=c(3948),f=c(9106),d=c(9615),p=c(2012),_=c(4202),g=c(4896),m=c(5845),b=c(8563),y=c(5656);o.exports=function(x){return new Promise((function(T,k){var R,P=x.data,B=x.headers,U=x.responseType;function z(){x.cancelToken&&x.cancelToken.unsubscribe(R),x.signal&&x.signal.removeEventListener("abort",R)}l.isFormData(P)&&l.isStandardBrowserEnv()&&delete B["Content-Type"];var I=new XMLHttpRequest;if(x.auth){var L=x.auth.username||"",M=x.auth.password?unescape(encodeURIComponent(x.auth.password)):"";B.Authorization="Basic "+btoa(L+":"+M)}var F=d(x.baseURL,x.url);function Z(){if(I){var Q="getAllResponseHeaders"in I?p(I.getAllResponseHeaders()):null,q={data:U&&U!=="text"&&U!=="json"?I.response:I.responseText,status:I.status,statusText:I.statusText,headers:Q,config:x,request:I};u((function(V){T(V),z()}),(function(V){k(V),z()}),q),I=null}}if(I.open(x.method.toUpperCase(),f(F,x.params,x.paramsSerializer),!0),I.timeout=x.timeout,"onloadend"in I?I.onloadend=Z:I.onreadystatechange=function(){I&&I.readyState===4&&(I.status!==0||I.responseURL&&I.responseURL.indexOf("file:")===0)&&setTimeout(Z)},I.onabort=function(){I&&(k(new m("Request aborted",m.ECONNABORTED,x,I)),I=null)},I.onerror=function(){k(new m("Network Error",m.ERR_NETWORK,x,I,I)),I=null},I.ontimeout=function(){var Q=x.timeout?"timeout of "+x.timeout+"ms exceeded":"timeout exceeded",q=x.transitional||g;x.timeoutErrorMessage&&(Q=x.timeoutErrorMessage),k(new m(Q,q.clarifyTimeoutError?m.ETIMEDOUT:m.ECONNABORTED,x,I)),I=null},l.isStandardBrowserEnv()){var $=(x.withCredentials||_(F))&&x.xsrfCookieName?h.read(x.xsrfCookieName):void 0;$&&(B[x.xsrfHeaderName]=$)}"setRequestHeader"in I&&l.forEach(B,(function(Q,q){P===void 0&&q.toLowerCase()==="content-type"?delete B[q]:I.setRequestHeader(q,Q)})),l.isUndefined(x.withCredentials)||(I.withCredentials=!!x.withCredentials),U&&U!=="json"&&(I.responseType=x.responseType),typeof x.onDownloadProgress=="function"&&I.addEventListener("progress",x.onDownloadProgress),typeof x.onUploadProgress=="function"&&I.upload&&I.upload.addEventListener("progress",x.onUploadProgress),(x.cancelToken||x.signal)&&(R=function(Q){I&&(k(!Q||Q&&Q.type?new b:Q),I.abort(),I=null)},x.cancelToken&&x.cancelToken.subscribe(R),x.signal&&(x.signal.aborted?R():x.signal.addEventListener("abort",R))),P||(P=null);var Y=y(F);Y&&["http","https","file"].indexOf(Y)===-1?k(new m("Unsupported protocol "+Y+":",m.ERR_BAD_REQUEST,x)):I.send(P)}))}},8015:(o,a,c)=>{var l=c(9516),u=c(9012),h=c(5155),f=c(5343),d=(function p(_){var g=new h(_),m=u(h.prototype.request,g);return l.extend(m,h.prototype,g),l.extend(m,g),m.create=function(b){return p(f(_,b))},m})(c(7412));d.Axios=h,d.CanceledError=c(8563),d.CancelToken=c(3191),d.isCancel=c(3864),d.VERSION=c(9641).version,d.toFormData=c(6440),d.AxiosError=c(5845),d.Cancel=d.CanceledError,d.all=function(p){return Promise.all(p)},d.spread=c(7980),d.isAxiosError=c(5019),o.exports=d,o.exports.default=d},3191:(o,a,c)=>{var l=c(8563);function u(h){if(typeof h!="function")throw new TypeError("executor must be a function.");var f;this.promise=new Promise((function(p){f=p}));var d=this;this.promise.then((function(p){if(d._listeners){var _,g=d._listeners.length;for(_=0;_<g;_++)d._listeners[_](p);d._listeners=null}})),this.promise.then=function(p){var _,g=new Promise((function(m){d.subscribe(m),_=m})).then(p);return g.cancel=function(){d.unsubscribe(_)},g},h((function(p){d.reason||(d.reason=new l(p),f(d.reason))}))}u.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},u.prototype.subscribe=function(h){this.reason?h(this.reason):this._listeners?this._listeners.push(h):this._listeners=[h]},u.prototype.unsubscribe=function(h){if(this._listeners){var f=this._listeners.indexOf(h);f!==-1&&this._listeners.splice(f,1)}},u.source=function(){var h;return{token:new u((function(f){h=f})),cancel:h}},o.exports=u},8563:(o,a,c)=>{var l=c(5845);function u(h){l.call(this,h??"canceled",l.ERR_CANCELED),this.name="CanceledError"}c(9516).inherits(u,l,{__CANCEL__:!0}),o.exports=u},3864:o=>{o.exports=function(a){return!(!a||!a.__CANCEL__)}},5155:(o,a,c)=>{var l=c(9516),u=c(9106),h=c(3471),f=c(4490),d=c(5343),p=c(9615),_=c(4841),g=_.validators;function m(b){this.defaults=b,this.interceptors={request:new h,response:new h}}m.prototype.request=function(b,y){typeof b=="string"?(y=y||{}).url=b:y=b||{},(y=d(this.defaults,y)).method?y.method=y.method.toLowerCase():this.defaults.method?y.method=this.defaults.method.toLowerCase():y.method="get";var x=y.transitional;x!==void 0&&_.assertOptions(x,{silentJSONParsing:g.transitional(g.boolean),forcedJSONParsing:g.transitional(g.boolean),clarifyTimeoutError:g.transitional(g.boolean)},!1);var T=[],k=!0;this.interceptors.request.forEach((function(L){typeof L.runWhen=="function"&&L.runWhen(y)===!1||(k=k&&L.synchronous,T.unshift(L.fulfilled,L.rejected))}));var R,P=[];if(this.interceptors.response.forEach((function(L){P.push(L.fulfilled,L.rejected)})),!k){var B=[f,void 0];for(Array.prototype.unshift.apply(B,T),B=B.concat(P),R=Promise.resolve(y);B.length;)R=R.then(B.shift(),B.shift());return R}for(var U=y;T.length;){var z=T.shift(),I=T.shift();try{U=z(U)}catch(L){I(L);break}}try{R=f(U)}catch(L){return Promise.reject(L)}for(;P.length;)R=R.then(P.shift(),P.shift());return R},m.prototype.getUri=function(b){b=d(this.defaults,b);var y=p(b.baseURL,b.url);return u(y,b.params,b.paramsSerializer)},l.forEach(["delete","get","head","options"],(function(b){m.prototype[b]=function(y,x){return this.request(d(x||{},{method:b,url:y,data:(x||{}).data}))}})),l.forEach(["post","put","patch"],(function(b){function y(x){return function(T,k,R){return this.request(d(R||{},{method:b,headers:x?{"Content-Type":"multipart/form-data"}:{},url:T,data:k}))}}m.prototype[b]=y(),m.prototype[b+"Form"]=y(!0)})),o.exports=m},5845:(o,a,c)=>{var l=c(9516);function u(d,p,_,g,m){Error.call(this),this.message=d,this.name="AxiosError",p&&(this.code=p),_&&(this.config=_),g&&(this.request=g),m&&(this.response=m)}l.inherits(u,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var h=u.prototype,f={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(d){f[d]={value:d}})),Object.defineProperties(u,f),Object.defineProperty(h,"isAxiosError",{value:!0}),u.from=function(d,p,_,g,m,b){var y=Object.create(h);return l.toFlatObject(d,y,(function(x){return x!==Error.prototype})),u.call(y,d.message,p,_,g,m),y.name=d.name,b&&Object.assign(y,b),y},o.exports=u},3471:(o,a,c)=>{var l=c(9516);function u(){this.handlers=[]}u.prototype.use=function(h,f,d){return this.handlers.push({fulfilled:h,rejected:f,synchronous:!!d&&d.synchronous,runWhen:d?d.runWhen:null}),this.handlers.length-1},u.prototype.eject=function(h){this.handlers[h]&&(this.handlers[h]=null)},u.prototype.forEach=function(h){l.forEach(this.handlers,(function(f){f!==null&&h(f)}))},o.exports=u},9615:(o,a,c)=>{var l=c(9137),u=c(4680);o.exports=function(h,f){return h&&!l(f)?u(h,f):f}},4490:(o,a,c)=>{var l=c(9516),u=c(2881),h=c(3864),f=c(7412),d=c(8563);function p(_){if(_.cancelToken&&_.cancelToken.throwIfRequested(),_.signal&&_.signal.aborted)throw new d}o.exports=function(_){return p(_),_.headers=_.headers||{},_.data=u.call(_,_.data,_.headers,_.transformRequest),_.headers=l.merge(_.headers.common||{},_.headers[_.method]||{},_.headers),l.forEach(["delete","get","head","post","put","patch","common"],(function(g){delete _.headers[g]})),(_.adapter||f.adapter)(_).then((function(g){return p(_),g.data=u.call(_,g.data,g.headers,_.transformResponse),g}),(function(g){return h(g)||(p(_),g&&g.response&&(g.response.data=u.call(_,g.response.data,g.response.headers,_.transformResponse))),Promise.reject(g)}))}},5343:(o,a,c)=>{var l=c(9516);o.exports=function(u,h){h=h||{};var f={};function d(y,x){return l.isPlainObject(y)&&l.isPlainObject(x)?l.merge(y,x):l.isPlainObject(x)?l.merge({},x):l.isArray(x)?x.slice():x}function p(y){return l.isUndefined(h[y])?l.isUndefined(u[y])?void 0:d(void 0,u[y]):d(u[y],h[y])}function _(y){if(!l.isUndefined(h[y]))return d(void 0,h[y])}function g(y){return l.isUndefined(h[y])?l.isUndefined(u[y])?void 0:d(void 0,u[y]):d(void 0,h[y])}function m(y){return y in h?d(u[y],h[y]):y in u?d(void 0,u[y]):void 0}var b={url:_,method:_,data:_,baseURL:g,transformRequest:g,transformResponse:g,paramsSerializer:g,timeout:g,timeoutMessage:g,withCredentials:g,adapter:g,responseType:g,xsrfCookieName:g,xsrfHeaderName:g,onUploadProgress:g,onDownloadProgress:g,decompress:g,maxContentLength:g,maxBodyLength:g,beforeRedirect:g,transport:g,httpAgent:g,httpsAgent:g,cancelToken:g,socketPath:g,responseEncoding:g,validateStatus:m};return l.forEach(Object.keys(u).concat(Object.keys(h)),(function(y){var x=b[y]||p,T=x(y);l.isUndefined(T)&&x!==m||(f[y]=T)})),f}},7522:(o,a,c)=>{var l=c(5845);o.exports=function(u,h,f){var d=f.config.validateStatus;f.status&&d&&!d(f.status)?h(new l("Request failed with status code "+f.status,[l.ERR_BAD_REQUEST,l.ERR_BAD_RESPONSE][Math.floor(f.status/100)-4],f.config,f.request,f)):u(f)}},2881:(o,a,c)=>{var l=c(9516),u=c(7412);o.exports=function(h,f,d){var p=this||u;return l.forEach(d,(function(_){h=_.call(p,h,f)})),h}},7412:(o,a,c)=>{var l=c(9516),u=c(7018),h=c(5845),f=c(4896),d=c(6440),p={"Content-Type":"application/x-www-form-urlencoded"};function _(b,y){!l.isUndefined(b)&&l.isUndefined(b["Content-Type"])&&(b["Content-Type"]=y)}var g,m={transitional:f,adapter:((typeof XMLHttpRequest<"u"||typeof oc<"u"&&Object.prototype.toString.call(oc)==="[object process]")&&(g=c(5592)),g),transformRequest:[function(b,y){if(u(y,"Accept"),u(y,"Content-Type"),l.isFormData(b)||l.isArrayBuffer(b)||l.isBuffer(b)||l.isStream(b)||l.isFile(b)||l.isBlob(b))return b;if(l.isArrayBufferView(b))return b.buffer;if(l.isURLSearchParams(b))return _(y,"application/x-www-form-urlencoded;charset=utf-8"),b.toString();var x,T=l.isObject(b),k=y&&y["Content-Type"];if((x=l.isFileList(b))||T&&k==="multipart/form-data"){var R=this.env&&this.env.FormData;return d(x?{"files[]":b}:b,R&&new R)}return T||k==="application/json"?(_(y,"application/json"),(function(P,B,U){if(l.isString(P))try{return(B||JSON.parse)(P),l.trim(P)}catch(z){if(z.name!=="SyntaxError")throw z}return(U||JSON.stringify)(P)})(b)):b}],transformResponse:[function(b){var y=this.transitional||m.transitional,x=y&&y.silentJSONParsing,T=y&&y.forcedJSONParsing,k=!x&&this.responseType==="json";if(k||T&&l.isString(b)&&b.length)try{return JSON.parse(b)}catch(R){if(k)throw R.name==="SyntaxError"?h.from(R,h.ERR_BAD_RESPONSE,this,null,this.response):R}return b}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:c(1534)},validateStatus:function(b){return b>=200&&b<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};l.forEach(["delete","get","head"],(function(b){m.headers[b]={}})),l.forEach(["post","put","patch"],(function(b){m.headers[b]=l.merge(p)})),o.exports=m},4896:o=>{o.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},9641:o=>{o.exports={version:"0.27.2"}},9012:o=>{o.exports=function(a,c){return function(){for(var l=new Array(arguments.length),u=0;u<l.length;u++)l[u]=arguments[u];return a.apply(c,l)}}},9106:(o,a,c)=>{var l=c(9516);function u(h){return encodeURIComponent(h).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}o.exports=function(h,f,d){if(!f)return h;var p;if(d)p=d(f);else if(l.isURLSearchParams(f))p=f.toString();else{var _=[];l.forEach(f,(function(m,b){m!=null&&(l.isArray(m)?b+="[]":m=[m],l.forEach(m,(function(y){l.isDate(y)?y=y.toISOString():l.isObject(y)&&(y=JSON.stringify(y)),_.push(u(b)+"="+u(y))})))})),p=_.join("&")}if(p){var g=h.indexOf("#");g!==-1&&(h=h.slice(0,g)),h+=(h.indexOf("?")===-1?"?":"&")+p}return h}},4680:o=>{o.exports=function(a,c){return c?a.replace(/\/+$/,"")+"/"+c.replace(/^\/+/,""):a}},3948:(o,a,c)=>{var l=c(9516);o.exports=l.isStandardBrowserEnv()?{write:function(u,h,f,d,p,_){var g=[];g.push(u+"="+encodeURIComponent(h)),l.isNumber(f)&&g.push("expires="+new Date(f).toGMTString()),l.isString(d)&&g.push("path="+d),l.isString(p)&&g.push("domain="+p),_===!0&&g.push("secure"),document.cookie=g.join("; ")},read:function(u){var h=document.cookie.match(new RegExp("(^|;\\s*)("+u+")=([^;]*)"));return h?decodeURIComponent(h[3]):null},remove:function(u){this.write(u,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},9137:o=>{o.exports=function(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}},5019:(o,a,c)=>{var l=c(9516);o.exports=function(u){return l.isObject(u)&&u.isAxiosError===!0}},4202:(o,a,c)=>{var l=c(9516);o.exports=l.isStandardBrowserEnv()?(function(){var u,h=/(msie|trident)/i.test(navigator.userAgent),f=document.createElement("a");function d(p){var _=p;return h&&(f.setAttribute("href",_),_=f.href),f.setAttribute("href",_),{href:f.href,protocol:f.protocol?f.protocol.replace(/:$/,""):"",host:f.host,search:f.search?f.search.replace(/^\?/,""):"",hash:f.hash?f.hash.replace(/^#/,""):"",hostname:f.hostname,port:f.port,pathname:f.pathname.charAt(0)==="/"?f.pathname:"/"+f.pathname}}return u=d(window.location.href),function(p){var _=l.isString(p)?d(p):p;return _.protocol===u.protocol&&_.host===u.host}})():function(){return!0}},7018:(o,a,c)=>{var l=c(9516);o.exports=function(u,h){l.forEach(u,(function(f,d){d!==h&&d.toUpperCase()===h.toUpperCase()&&(u[h]=f,delete u[d])}))}},1534:o=>{o.exports=null},2012:(o,a,c)=>{var l=c(9516),u=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];o.exports=function(h){var f,d,p,_={};return h&&l.forEach(h.split(`
`),(function(g){if(p=g.indexOf(":"),f=l.trim(g.substr(0,p)).toLowerCase(),d=l.trim(g.substr(p+1)),f){if(_[f]&&u.indexOf(f)>=0)return;_[f]=f==="set-cookie"?(_[f]?_[f]:[]).concat([d]):_[f]?_[f]+", "+d:d}})),_}},5656:o=>{o.exports=function(a){var c=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return c&&c[1]||""}},7980:o=>{o.exports=function(a){return function(c){return a.apply(null,c)}}},6440:(o,a,c)=>{var l=c(9516);o.exports=function(u,h){h=h||new FormData;var f=[];function d(p){return p===null?"":l.isDate(p)?p.toISOString():l.isArrayBuffer(p)||l.isTypedArray(p)?typeof Blob=="function"?new Blob([p]):Qs.from(p):p}return(function p(_,g){if(l.isPlainObject(_)||l.isArray(_)){if(f.indexOf(_)!==-1)throw Error("Circular reference detected in "+g);f.push(_),l.forEach(_,(function(m,b){if(!l.isUndefined(m)){var y,x=g?g+"."+b:b;if(m&&!g&&typeof m=="object"){if(l.endsWith(b,"{}"))m=JSON.stringify(m);else if(l.endsWith(b,"[]")&&(y=l.toArray(m)))return void y.forEach((function(T){!l.isUndefined(T)&&h.append(x,d(T))}))}p(m,x)}})),f.pop()}else h.append(g,d(_))})(u),h}},4841:(o,a,c)=>{var l=c(9641).version,u=c(5845),h={};["object","boolean","number","function","string","symbol"].forEach((function(d,p){h[d]=function(_){return typeof _===d||"a"+(p<1?"n ":" ")+d}}));var f={};h.transitional=function(d,p,_){function g(m,b){return"[Axios v"+l+"] Transitional option '"+m+"'"+b+(_?". "+_:"")}return function(m,b,y){if(d===!1)throw new u(g(b," has been removed"+(p?" in "+p:"")),u.ERR_DEPRECATED);return p&&!f[b]&&(f[b]=!0,console.warn(g(b," has been deprecated since v"+p+" and will be removed in the near future"))),!d||d(m,b,y)}},o.exports={assertOptions:function(d,p,_){if(typeof d!="object")throw new u("options must be an object",u.ERR_BAD_OPTION_VALUE);for(var g=Object.keys(d),m=g.length;m-- >0;){var b=g[m],y=p[b];if(y){var x=d[b],T=x===void 0||y(x,b,d);if(T!==!0)throw new u("option "+b+" must be "+T,u.ERR_BAD_OPTION_VALUE)}else if(_!==!0)throw new u("Unknown option "+b,u.ERR_BAD_OPTION)}},validators:h}},9516:(o,a,c)=>{var l,u=c(9012),h=Object.prototype.toString,f=(l=Object.create(null),function(I){var L=h.call(I);return l[L]||(l[L]=L.slice(8,-1).toLowerCase())});function d(I){return I=I.toLowerCase(),function(L){return f(L)===I}}function p(I){return Array.isArray(I)}function _(I){return I===void 0}var g=d("ArrayBuffer");function m(I){return I!==null&&typeof I=="object"}function b(I){if(f(I)!=="object")return!1;var L=Object.getPrototypeOf(I);return L===null||L===Object.prototype}var y=d("Date"),x=d("File"),T=d("Blob"),k=d("FileList");function R(I){return h.call(I)==="[object Function]"}var P=d("URLSearchParams");function B(I,L){if(I!=null)if(typeof I!="object"&&(I=[I]),p(I))for(var M=0,F=I.length;M<F;M++)L.call(null,I[M],M,I);else for(var Z in I)Object.prototype.hasOwnProperty.call(I,Z)&&L.call(null,I[Z],Z,I)}var U,z=(U=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(I){return U&&I instanceof U});o.exports={isArray:p,isArrayBuffer:g,isBuffer:function(I){return I!==null&&!_(I)&&I.constructor!==null&&!_(I.constructor)&&typeof I.constructor.isBuffer=="function"&&I.constructor.isBuffer(I)},isFormData:function(I){var L="[object FormData]";return I&&(typeof FormData=="function"&&I instanceof FormData||h.call(I)===L||R(I.toString)&&I.toString()===L)},isArrayBufferView:function(I){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(I):I&&I.buffer&&g(I.buffer)},isString:function(I){return typeof I=="string"},isNumber:function(I){return typeof I=="number"},isObject:m,isPlainObject:b,isUndefined:_,isDate:y,isFile:x,isBlob:T,isFunction:R,isStream:function(I){return m(I)&&R(I.pipe)},isURLSearchParams:P,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:B,merge:function I(){var L={};function M($,Y){b(L[Y])&&b($)?L[Y]=I(L[Y],$):b($)?L[Y]=I({},$):p($)?L[Y]=$.slice():L[Y]=$}for(var F=0,Z=arguments.length;F<Z;F++)B(arguments[F],M);return L},extend:function(I,L,M){return B(L,(function(F,Z){I[Z]=M&&typeof F=="function"?u(F,M):F})),I},trim:function(I){return I.trim?I.trim():I.replace(/^\s+|\s+$/g,"")},stripBOM:function(I){return I.charCodeAt(0)===65279&&(I=I.slice(1)),I},inherits:function(I,L,M,F){I.prototype=Object.create(L.prototype,F),I.prototype.constructor=I,M&&Object.assign(I.prototype,M)},toFlatObject:function(I,L,M){var F,Z,$,Y={};L=L||{};do{for(Z=(F=Object.getOwnPropertyNames(I)).length;Z-- >0;)Y[$=F[Z]]||(L[$]=I[$],Y[$]=!0);I=Object.getPrototypeOf(I)}while(I&&(!M||M(I,L))&&I!==Object.prototype);return L},kindOf:f,kindOfTest:d,endsWith:function(I,L,M){I=String(I),(M===void 0||M>I.length)&&(M=I.length),M-=L.length;var F=I.indexOf(L,M);return F!==-1&&F===M},toArray:function(I){if(!I)return null;var L=I.length;if(_(L))return null;for(var M=new Array(L);L-- >0;)M[L]=I[L];return M},isTypedArray:z,isFileList:k}},6880:function(o){o.exports=(function(a){var c={};function l(u){if(c[u])return c[u].exports;var h=c[u]={i:u,l:!1,exports:{}};return a[u].call(h.exports,h,h.exports,l),h.l=!0,h.exports}return l.m=a,l.c=c,l.d=function(u,h,f){l.o(u,h)||Object.defineProperty(u,h,{enumerable:!0,get:f})},l.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},l.t=function(u,h){if(1&h&&(u=l(u)),8&h||4&h&&typeof u=="object"&&u&&u.__esModule)return u;var f=Object.create(null);if(l.r(f),Object.defineProperty(f,"default",{enumerable:!0,value:u}),2&h&&typeof u!="string")for(var d in u)l.d(f,d,(function(p){return u[p]}).bind(null,d));return f},l.n=function(u){var h=u&&u.__esModule?function(){return u.default}:function(){return u};return l.d(h,"a",h),h},l.o=function(u,h){return Object.prototype.hasOwnProperty.call(u,h)},l.p="",l(l.s=90)})({17:function(a,c,l){c.__esModule=!0,c.default=void 0;var u=l(18),h=(function(){function f(){}return f.getFirstMatch=function(d,p){var _=p.match(d);return _&&_.length>0&&_[1]||""},f.getSecondMatch=function(d,p){var _=p.match(d);return _&&_.length>1&&_[2]||""},f.matchAndReturnConst=function(d,p,_){if(d.test(p))return _},f.getWindowsVersionName=function(d){switch(d){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},f.getMacOSVersionName=function(d){var p=d.split(".").splice(0,2).map((function(_){return parseInt(_,10)||0}));if(p.push(0),p[0]===10)switch(p[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},f.getAndroidVersionName=function(d){var p=d.split(".").splice(0,2).map((function(_){return parseInt(_,10)||0}));if(p.push(0),!(p[0]===1&&p[1]<5))return p[0]===1&&p[1]<6?"Cupcake":p[0]===1&&p[1]>=6?"Donut":p[0]===2&&p[1]<2?"Eclair":p[0]===2&&p[1]===2?"Froyo":p[0]===2&&p[1]>2?"Gingerbread":p[0]===3?"Honeycomb":p[0]===4&&p[1]<1?"Ice Cream Sandwich":p[0]===4&&p[1]<4?"Jelly Bean":p[0]===4&&p[1]>=4?"KitKat":p[0]===5?"Lollipop":p[0]===6?"Marshmallow":p[0]===7?"Nougat":p[0]===8?"Oreo":p[0]===9?"Pie":void 0},f.getVersionPrecision=function(d){return d.split(".").length},f.compareVersions=function(d,p,_){_===void 0&&(_=!1);var g=f.getVersionPrecision(d),m=f.getVersionPrecision(p),b=Math.max(g,m),y=0,x=f.map([d,p],(function(T){var k=b-f.getVersionPrecision(T),R=T+new Array(k+1).join(".0");return f.map(R.split("."),(function(P){return new Array(20-P.length).join("0")+P})).reverse()}));for(_&&(y=b-Math.min(g,m)),b-=1;b>=y;){if(x[0][b]>x[1][b])return 1;if(x[0][b]===x[1][b]){if(b===y)return 0;b-=1}else if(x[0][b]<x[1][b])return-1}},f.map=function(d,p){var _,g=[];if(Array.prototype.map)return Array.prototype.map.call(d,p);for(_=0;_<d.length;_+=1)g.push(p(d[_]));return g},f.find=function(d,p){var _,g;if(Array.prototype.find)return Array.prototype.find.call(d,p);for(_=0,g=d.length;_<g;_+=1){var m=d[_];if(p(m,_))return m}},f.assign=function(d){for(var p,_,g=d,m=arguments.length,b=new Array(m>1?m-1:0),y=1;y<m;y++)b[y-1]=arguments[y];if(Object.assign)return Object.assign.apply(Object,[d].concat(b));var x=function(){var T=b[p];typeof T=="object"&&T!==null&&Object.keys(T).forEach((function(k){g[k]=T[k]}))};for(p=0,_=b.length;p<_;p+=1)x();return d},f.getBrowserAlias=function(d){return u.BROWSER_ALIASES_MAP[d]},f.getBrowserTypeByAlias=function(d){return u.BROWSER_MAP[d]||""},f})();c.default=h,a.exports=c.default},18:function(a,c,l){c.__esModule=!0,c.ENGINE_MAP=c.OS_MAP=c.PLATFORMS_MAP=c.BROWSER_MAP=c.BROWSER_ALIASES_MAP=void 0,c.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},c.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},c.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},c.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},c.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(91))&&u.__esModule?u:{default:u},f=l(18);function d(_,g){for(var m=0;m<g.length;m++){var b=g[m];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(_,b.key,b)}}var p=(function(){function _(){}var g,m,b;return _.getParser=function(y,x){if(x===void 0&&(x=!1),typeof y!="string")throw new Error("UserAgent should be a string");return new h.default(y,x)},_.parse=function(y){return new h.default(y).getResult()},g=_,b=[{key:"BROWSER_MAP",get:function(){return f.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return f.ENGINE_MAP}},{key:"OS_MAP",get:function(){return f.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return f.PLATFORMS_MAP}}],(m=null)&&d(g.prototype,m),b&&d(g,b),_})();c.default=p,a.exports=c.default},91:function(a,c,l){c.__esModule=!0,c.default=void 0;var u=_(l(92)),h=_(l(93)),f=_(l(94)),d=_(l(95)),p=_(l(17));function _(m){return m&&m.__esModule?m:{default:m}}var g=(function(){function m(y,x){if(x===void 0&&(x=!1),y==null||y==="")throw new Error("UserAgent parameter can't be empty");this._ua=y,this.parsedResult={},x!==!0&&this.parse()}var b=m.prototype;return b.getUA=function(){return this._ua},b.test=function(y){return y.test(this._ua)},b.parseBrowser=function(){var y=this;this.parsedResult.browser={};var x=p.default.find(u.default,(function(T){if(typeof T.test=="function")return T.test(y);if(T.test instanceof Array)return T.test.some((function(k){return y.test(k)}));throw new Error("Browser's test function is not valid")}));return x&&(this.parsedResult.browser=x.describe(this.getUA())),this.parsedResult.browser},b.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},b.getBrowserName=function(y){return y?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},b.getBrowserVersion=function(){return this.getBrowser().version},b.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},b.parseOS=function(){var y=this;this.parsedResult.os={};var x=p.default.find(h.default,(function(T){if(typeof T.test=="function")return T.test(y);if(T.test instanceof Array)return T.test.some((function(k){return y.test(k)}));throw new Error("Browser's test function is not valid")}));return x&&(this.parsedResult.os=x.describe(this.getUA())),this.parsedResult.os},b.getOSName=function(y){var x=this.getOS().name;return y?String(x).toLowerCase()||"":x||""},b.getOSVersion=function(){return this.getOS().version},b.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},b.getPlatformType=function(y){y===void 0&&(y=!1);var x=this.getPlatform().type;return y?String(x).toLowerCase()||"":x||""},b.parsePlatform=function(){var y=this;this.parsedResult.platform={};var x=p.default.find(f.default,(function(T){if(typeof T.test=="function")return T.test(y);if(T.test instanceof Array)return T.test.some((function(k){return y.test(k)}));throw new Error("Browser's test function is not valid")}));return x&&(this.parsedResult.platform=x.describe(this.getUA())),this.parsedResult.platform},b.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},b.getEngineName=function(y){return y?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},b.parseEngine=function(){var y=this;this.parsedResult.engine={};var x=p.default.find(d.default,(function(T){if(typeof T.test=="function")return T.test(y);if(T.test instanceof Array)return T.test.some((function(k){return y.test(k)}));throw new Error("Browser's test function is not valid")}));return x&&(this.parsedResult.engine=x.describe(this.getUA())),this.parsedResult.engine},b.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},b.getResult=function(){return p.default.assign({},this.parsedResult)},b.satisfies=function(y){var x=this,T={},k=0,R={},P=0;if(Object.keys(y).forEach((function(Z){var $=y[Z];typeof $=="string"?(R[Z]=$,P+=1):typeof $=="object"&&(T[Z]=$,k+=1)})),k>0){var B=Object.keys(T),U=p.default.find(B,(function(Z){return x.isOS(Z)}));if(U){var z=this.satisfies(T[U]);if(z!==void 0)return z}var I=p.default.find(B,(function(Z){return x.isPlatform(Z)}));if(I){var L=this.satisfies(T[I]);if(L!==void 0)return L}}if(P>0){var M=Object.keys(R),F=p.default.find(M,(function(Z){return x.isBrowser(Z,!0)}));if(F!==void 0)return this.compareVersion(R[F])}},b.isBrowser=function(y,x){x===void 0&&(x=!1);var T=this.getBrowserName().toLowerCase(),k=y.toLowerCase(),R=p.default.getBrowserTypeByAlias(k);return x&&R&&(k=R.toLowerCase()),k===T},b.compareVersion=function(y){var x=[0],T=y,k=!1,R=this.getBrowserVersion();if(typeof R=="string")return y[0]===">"||y[0]==="<"?(T=y.substr(1),y[1]==="="?(k=!0,T=y.substr(2)):x=[],y[0]===">"?x.push(1):x.push(-1)):y[0]==="="?T=y.substr(1):y[0]==="~"&&(k=!0,T=y.substr(1)),x.indexOf(p.default.compareVersions(R,T,k))>-1},b.isOS=function(y){return this.getOSName(!0)===String(y).toLowerCase()},b.isPlatform=function(y){return this.getPlatformType(!0)===String(y).toLowerCase()},b.isEngine=function(y){return this.getEngineName(!0)===String(y).toLowerCase()},b.is=function(y,x){return x===void 0&&(x=!1),this.isBrowser(y,x)||this.isOS(y)||this.isPlatform(y)},b.some=function(y){var x=this;return y===void 0&&(y=[]),y.some((function(T){return x.is(T)}))},m})();c.default=g,a.exports=c.default},92:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=/version\/(\d+(\.?_?\d+)+)/i,d=[{test:[/googlebot/i],describe:function(p){var _={name:"Googlebot"},g=h.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,p)||h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/opera/i],describe:function(p){var _={name:"Opera"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/opr\/|opios/i],describe:function(p){var _={name:"Opera"},g=h.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,p)||h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/SamsungBrowser/i],describe:function(p){var _={name:"Samsung Internet for Android"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/Whale/i],describe:function(p){var _={name:"NAVER Whale Browser"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/MZBrowser/i],describe:function(p){var _={name:"MZ Browser"},g=h.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/focus/i],describe:function(p){var _={name:"Focus"},g=h.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/swing/i],describe:function(p){var _={name:"Swing"},g=h.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/coast/i],describe:function(p){var _={name:"Opera Coast"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(p){var _={name:"Opera Touch"},g=h.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/yabrowser/i],describe:function(p){var _={name:"Yandex Browser"},g=h.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/ucbrowser/i],describe:function(p){var _={name:"UC Browser"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/Maxthon|mxios/i],describe:function(p){var _={name:"Maxthon"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/epiphany/i],describe:function(p){var _={name:"Epiphany"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/puffin/i],describe:function(p){var _={name:"Puffin"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/sleipnir/i],describe:function(p){var _={name:"Sleipnir"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/k-meleon/i],describe:function(p){var _={name:"K-Meleon"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/micromessenger/i],describe:function(p){var _={name:"WeChat"},g=h.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/qqbrowser/i],describe:function(p){var _={name:/qqbrowserlite/i.test(p)?"QQ Browser Lite":"QQ Browser"},g=h.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/msie|trident/i],describe:function(p){var _={name:"Internet Explorer"},g=h.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/\sedg\//i],describe:function(p){var _={name:"Microsoft Edge"},g=h.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/edg([ea]|ios)/i],describe:function(p){var _={name:"Microsoft Edge"},g=h.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/vivaldi/i],describe:function(p){var _={name:"Vivaldi"},g=h.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/seamonkey/i],describe:function(p){var _={name:"SeaMonkey"},g=h.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/sailfish/i],describe:function(p){var _={name:"Sailfish"},g=h.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,p);return g&&(_.version=g),_}},{test:[/silk/i],describe:function(p){var _={name:"Amazon Silk"},g=h.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/phantom/i],describe:function(p){var _={name:"PhantomJS"},g=h.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/slimerjs/i],describe:function(p){var _={name:"SlimerJS"},g=h.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(p){var _={name:"BlackBerry"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/(web|hpw)[o0]s/i],describe:function(p){var _={name:"WebOS Browser"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/bada/i],describe:function(p){var _={name:"Bada"},g=h.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/tizen/i],describe:function(p){var _={name:"Tizen"},g=h.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/qupzilla/i],describe:function(p){var _={name:"QupZilla"},g=h.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/firefox|iceweasel|fxios/i],describe:function(p){var _={name:"Firefox"},g=h.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/electron/i],describe:function(p){var _={name:"Electron"},g=h.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/MiuiBrowser/i],describe:function(p){var _={name:"Miui"},g=h.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/chromium/i],describe:function(p){var _={name:"Chromium"},g=h.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/chrome|crios|crmo/i],describe:function(p){var _={name:"Chrome"},g=h.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/GSA/i],describe:function(p){var _={name:"Google Search"},g=h.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:function(p){var _=!p.test(/like android/i),g=p.test(/android/i);return _&&g},describe:function(p){var _={name:"Android Browser"},g=h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/playstation 4/i],describe:function(p){var _={name:"PlayStation 4"},g=h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/safari|applewebkit/i],describe:function(p){var _={name:"Safari"},g=h.default.getFirstMatch(f,p);return g&&(_.version=g),_}},{test:[/.*/i],describe:function(p){var _=p.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:h.default.getFirstMatch(_,p),version:h.default.getSecondMatch(_,p)}}}];c.default=d,a.exports=c.default},93:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=l(18),d=[{test:[/Roku\/DVP/],describe:function(p){var _=h.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,p);return{name:f.OS_MAP.Roku,version:_}}},{test:[/windows phone/i],describe:function(p){var _=h.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.WindowsPhone,version:_}}},{test:[/windows /i],describe:function(p){var _=h.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,p),g=h.default.getWindowsVersionName(_);return{name:f.OS_MAP.Windows,version:_,versionName:g}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(p){var _={name:f.OS_MAP.iOS},g=h.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,p);return g&&(_.version=g),_}},{test:[/macintosh/i],describe:function(p){var _=h.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,p).replace(/[_\s]/g,"."),g=h.default.getMacOSVersionName(_),m={name:f.OS_MAP.MacOS,version:_};return g&&(m.versionName=g),m}},{test:[/(ipod|iphone|ipad)/i],describe:function(p){var _=h.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,p).replace(/[_\s]/g,".");return{name:f.OS_MAP.iOS,version:_}}},{test:function(p){var _=!p.test(/like android/i),g=p.test(/android/i);return _&&g},describe:function(p){var _=h.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,p),g=h.default.getAndroidVersionName(_),m={name:f.OS_MAP.Android,version:_};return g&&(m.versionName=g),m}},{test:[/(web|hpw)[o0]s/i],describe:function(p){var _=h.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,p),g={name:f.OS_MAP.WebOS};return _&&_.length&&(g.version=_),g}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(p){var _=h.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,p)||h.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,p)||h.default.getFirstMatch(/\bbb(\d+)/i,p);return{name:f.OS_MAP.BlackBerry,version:_}}},{test:[/bada/i],describe:function(p){var _=h.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.Bada,version:_}}},{test:[/tizen/i],describe:function(p){var _=h.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.Tizen,version:_}}},{test:[/linux/i],describe:function(){return{name:f.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:f.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(p){var _=h.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.PlayStation4,version:_}}}];c.default=d,a.exports=c.default},94:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=l(18),d=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(p){var _=h.default.getFirstMatch(/(can-l01)/i,p)&&"Nova",g={type:f.PLATFORMS_MAP.mobile,vendor:"Huawei"};return _&&(g.model=_),g}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet}}},{test:function(p){var _=p.test(/ipod|iphone/i),g=p.test(/like (ipod|iphone)/i);return _&&!g},describe:function(p){var _=h.default.getFirstMatch(/(ipod|iphone)/i,p);return{type:f.PLATFORMS_MAP.mobile,vendor:"Apple",model:_}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:f.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:f.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getBrowserName(!0)==="blackberry"},describe:function(){return{type:f.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(p){return p.getBrowserName(!0)==="bada"},describe:function(){return{type:f.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getBrowserName()==="windows phone"},describe:function(){return{type:f.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(p){var _=Number(String(p.getOSVersion()).split(".")[0]);return p.getOSName(!0)==="android"&&_>=3},describe:function(){return{type:f.PLATFORMS_MAP.tablet}}},{test:function(p){return p.getOSName(!0)==="android"},describe:function(){return{type:f.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getOSName(!0)==="macos"},describe:function(){return{type:f.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(p){return p.getOSName(!0)==="windows"},describe:function(){return{type:f.PLATFORMS_MAP.desktop}}},{test:function(p){return p.getOSName(!0)==="linux"},describe:function(){return{type:f.PLATFORMS_MAP.desktop}}},{test:function(p){return p.getOSName(!0)==="playstation 4"},describe:function(){return{type:f.PLATFORMS_MAP.tv}}},{test:function(p){return p.getOSName(!0)==="roku"},describe:function(){return{type:f.PLATFORMS_MAP.tv}}}];c.default=d,a.exports=c.default},95:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=l(18),d=[{test:function(p){return p.getBrowserName(!0)==="microsoft edge"},describe:function(p){if(/\sedg\//i.test(p))return{name:f.ENGINE_MAP.Blink};var _=h.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,p);return{name:f.ENGINE_MAP.EdgeHTML,version:_}}},{test:[/trident/i],describe:function(p){var _={name:f.ENGINE_MAP.Trident},g=h.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:function(p){return p.test(/presto/i)},describe:function(p){var _={name:f.ENGINE_MAP.Presto},g=h.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:function(p){var _=p.test(/gecko/i),g=p.test(/like gecko/i);return _&&!g},describe:function(p){var _={name:f.ENGINE_MAP.Gecko},g=h.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:f.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(p){var _={name:f.ENGINE_MAP.WebKit},g=h.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,p);return g&&(_.version=g),_}}];c.default=d,a.exports=c.default}})},228:o=>{var a=Object.prototype.hasOwnProperty,c="~";function l(){}function u(p,_,g){this.fn=p,this.context=_,this.once=g||!1}function h(p,_,g,m,b){if(typeof g!="function")throw new TypeError("The listener must be a function");var y=new u(g,m||p,b),x=c?c+_:_;return p._events[x]?p._events[x].fn?p._events[x]=[p._events[x],y]:p._events[x].push(y):(p._events[x]=y,p._eventsCount++),p}function f(p,_){--p._eventsCount==0?p._events=new l:delete p._events[_]}function d(){this._events=new l,this._eventsCount=0}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(c=!1)),d.prototype.eventNames=function(){var p,_,g=[];if(this._eventsCount===0)return g;for(_ in p=this._events)a.call(p,_)&&g.push(c?_.slice(1):_);return Object.getOwnPropertySymbols?g.concat(Object.getOwnPropertySymbols(p)):g},d.prototype.listeners=function(p){var _=c?c+p:p,g=this._events[_];if(!g)return[];if(g.fn)return[g.fn];for(var m=0,b=g.length,y=new Array(b);m<b;m++)y[m]=g[m].fn;return y},d.prototype.listenerCount=function(p){var _=c?c+p:p,g=this._events[_];return g?g.fn?1:g.length:0},d.prototype.emit=function(p,_,g,m,b,y){var x=c?c+p:p;if(!this._events[x])return!1;var T,k,R=this._events[x],P=arguments.length;if(R.fn){switch(R.once&&this.removeListener(p,R.fn,void 0,!0),P){case 1:return R.fn.call(R.context),!0;case 2:return R.fn.call(R.context,_),!0;case 3:return R.fn.call(R.context,_,g),!0;case 4:return R.fn.call(R.context,_,g,m),!0;case 5:return R.fn.call(R.context,_,g,m,b),!0;case 6:return R.fn.call(R.context,_,g,m,b,y),!0}for(k=1,T=new Array(P-1);k<P;k++)T[k-1]=arguments[k];R.fn.apply(R.context,T)}else{var B,U=R.length;for(k=0;k<U;k++)switch(R[k].once&&this.removeListener(p,R[k].fn,void 0,!0),P){case 1:R[k].fn.call(R[k].context);break;case 2:R[k].fn.call(R[k].context,_);break;case 3:R[k].fn.call(R[k].context,_,g);break;case 4:R[k].fn.call(R[k].context,_,g,m);break;default:if(!T)for(B=1,T=new Array(P-1);B<P;B++)T[B-1]=arguments[B];R[k].fn.apply(R[k].context,T)}}return!0},d.prototype.on=function(p,_,g){return h(this,p,_,g,!1)},d.prototype.once=function(p,_,g){return h(this,p,_,g,!0)},d.prototype.removeListener=function(p,_,g,m){var b=c?c+p:p;if(!this._events[b])return this;if(!_)return f(this,b),this;var y=this._events[b];if(y.fn)y.fn!==_||m&&!y.once||g&&y.context!==g||f(this,b);else{for(var x=0,T=[],k=y.length;x<k;x++)(y[x].fn!==_||m&&!y[x].once||g&&y[x].context!==g)&&T.push(y[x]);T.length?this._events[b]=T.length===1?T[0]:T:f(this,b)}return this},d.prototype.removeAllListeners=function(p){var _;return p?(_=c?c+p:p,this._events[_]&&f(this,_)):(this._events=new l,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=c,d.EventEmitter=d,o.exports=d},8954:function(o){var a;a=()=>(()=>{var c={228:h=>{var f=Object.prototype.hasOwnProperty,d="~";function p(){}function _(y,x,T){this.fn=y,this.context=x,this.once=T||!1}function g(y,x,T,k,R){if(typeof T!="function")throw new TypeError("The listener must be a function");var P=new _(T,k||y,R),B=d?d+x:x;return y._events[B]?y._events[B].fn?y._events[B]=[y._events[B],P]:y._events[B].push(P):(y._events[B]=P,y._eventsCount++),y}function m(y,x){--y._eventsCount==0?y._events=new p:delete y._events[x]}function b(){this._events=new p,this._eventsCount=0}Object.create&&(p.prototype=Object.create(null),new p().__proto__||(d=!1)),b.prototype.eventNames=function(){var y,x,T=[];if(this._eventsCount===0)return T;for(x in y=this._events)f.call(y,x)&&T.push(d?x.slice(1):x);return Object.getOwnPropertySymbols?T.concat(Object.getOwnPropertySymbols(y)):T},b.prototype.listeners=function(y){var x=d?d+y:y,T=this._events[x];if(!T)return[];if(T.fn)return[T.fn];for(var k=0,R=T.length,P=new Array(R);k<R;k++)P[k]=T[k].fn;return P},b.prototype.listenerCount=function(y){var x=d?d+y:y,T=this._events[x];return T?T.fn?1:T.length:0},b.prototype.emit=function(y,x,T,k,R,P){var B=d?d+y:y;if(!this._events[B])return!1;var U,z,I=this._events[B],L=arguments.length;if(I.fn){switch(I.once&&this.removeListener(y,I.fn,void 0,!0),L){case 1:return I.fn.call(I.context),!0;case 2:return I.fn.call(I.context,x),!0;case 3:return I.fn.call(I.context,x,T),!0;case 4:return I.fn.call(I.context,x,T,k),!0;case 5:return I.fn.call(I.context,x,T,k,R),!0;case 6:return I.fn.call(I.context,x,T,k,R,P),!0}for(z=1,U=new Array(L-1);z<L;z++)U[z-1]=arguments[z];I.fn.apply(I.context,U)}else{var M,F=I.length;for(z=0;z<F;z++)switch(I[z].once&&this.removeListener(y,I[z].fn,void 0,!0),L){case 1:I[z].fn.call(I[z].context);break;case 2:I[z].fn.call(I[z].context,x);break;case 3:I[z].fn.call(I[z].context,x,T);break;case 4:I[z].fn.call(I[z].context,x,T,k);break;default:if(!U)for(M=1,U=new Array(L-1);M<L;M++)U[M-1]=arguments[M];I[z].fn.apply(I[z].context,U)}}return!0},b.prototype.on=function(y,x,T){return g(this,y,x,T,!1)},b.prototype.once=function(y,x,T){return g(this,y,x,T,!0)},b.prototype.removeListener=function(y,x,T,k){var R=d?d+y:y;if(!this._events[R])return this;if(!x)return m(this,R),this;var P=this._events[R];if(P.fn)P.fn!==x||k&&!P.once||T&&P.context!==T||m(this,R);else{for(var B=0,U=[],z=P.length;B<z;B++)(P[B].fn!==x||k&&!P[B].once||T&&P[B].context!==T)&&U.push(P[B]);U.length?this._events[R]=U.length===1?U[0]:U:m(this,R)}return this},b.prototype.removeAllListeners=function(y){var x;return y?(x=d?d+y:y,this._events[x]&&m(this,x)):(this._events=new p,this._eventsCount=0),this},b.prototype.off=b.prototype.removeListener,b.prototype.addListener=b.prototype.on,b.prefixed=d,b.EventEmitter=b,h.exports=b},1549:(h,f,d)=>{var p=d(2032),_=d(3862),g=d(6721),m=d(2749),b=d(5749);function y(x){var T=-1,k=x==null?0:x.length;for(this.clear();++T<k;){var R=x[T];this.set(R[0],R[1])}}y.prototype.clear=p,y.prototype.delete=_,y.prototype.get=g,y.prototype.has=m,y.prototype.set=b,h.exports=y},79:(h,f,d)=>{var p=d(3702),_=d(80),g=d(4739),m=d(8655),b=d(1175);function y(x){var T=-1,k=x==null?0:x.length;for(this.clear();++T<k;){var R=x[T];this.set(R[0],R[1])}}y.prototype.clear=p,y.prototype.delete=_,y.prototype.get=g,y.prototype.has=m,y.prototype.set=b,h.exports=y},8223:(h,f,d)=>{var p=d(6110)(d(9325),"Map");h.exports=p},3661:(h,f,d)=>{var p=d(3040),_=d(7670),g=d(289),m=d(4509),b=d(2949);function y(x){var T=-1,k=x==null?0:x.length;for(this.clear();++T<k;){var R=x[T];this.set(R[0],R[1])}}y.prototype.clear=p,y.prototype.delete=_,y.prototype.get=g,y.prototype.has=m,y.prototype.set=b,h.exports=y},7217:(h,f,d)=>{var p=d(79),_=d(1420),g=d(938),m=d(3605),b=d(9817),y=d(945);function x(T){var k=this.__data__=new p(T);this.size=k.size}x.prototype.clear=_,x.prototype.delete=g,x.prototype.get=m,x.prototype.has=b,x.prototype.set=y,h.exports=x},1873:(h,f,d)=>{var p=d(9325).Symbol;h.exports=p},7828:(h,f,d)=>{var p=d(9325).Uint8Array;h.exports=p},1033:h=>{h.exports=function(f,d,p){switch(p.length){case 0:return f.call(d);case 1:return f.call(d,p[0]);case 2:return f.call(d,p[0],p[1]);case 3:return f.call(d,p[0],p[1],p[2])}return f.apply(d,p)}},695:(h,f,d)=>{var p=d(8096),_=d(2428),g=d(6449),m=d(3656),b=d(361),y=d(7167),x=Object.prototype.hasOwnProperty;h.exports=function(T,k){var R=g(T),P=!R&&_(T),B=!R&&!P&&m(T),U=!R&&!P&&!B&&y(T),z=R||P||B||U,I=z?p(T.length,String):[],L=I.length;for(var M in T)!k&&!x.call(T,M)||z&&(M=="length"||B&&(M=="offset"||M=="parent")||U&&(M=="buffer"||M=="byteLength"||M=="byteOffset")||b(M,L))||I.push(M);return I}},7805:(h,f,d)=>{var p=d(3360),_=d(5288);h.exports=function(g,m,b){(b!==void 0&&!_(g[m],b)||b===void 0&&!(m in g))&&p(g,m,b)}},6547:(h,f,d)=>{var p=d(3360),_=d(5288),g=Object.prototype.hasOwnProperty;h.exports=function(m,b,y){var x=m[b];g.call(m,b)&&_(x,y)&&(y!==void 0||b in m)||p(m,b,y)}},6025:(h,f,d)=>{var p=d(5288);h.exports=function(_,g){for(var m=_.length;m--;)if(p(_[m][0],g))return m;return-1}},3360:(h,f,d)=>{var p=d(3243);h.exports=function(_,g,m){g=="__proto__"&&p?p(_,g,{configurable:!0,enumerable:!0,value:m,writable:!0}):_[g]=m}},9344:(h,f,d)=>{var p=d(3805),_=Object.create,g=(function(){function m(){}return function(b){if(!p(b))return{};if(_)return _(b);m.prototype=b;var y=new m;return m.prototype=void 0,y}})();h.exports=g},6649:(h,f,d)=>{var p=d(3221)();h.exports=p},2552:(h,f,d)=>{var p=d(1873),_=d(659),g=d(9350),m=p?p.toStringTag:void 0;h.exports=function(b){return b==null?b===void 0?"[object Undefined]":"[object Null]":m&&m in Object(b)?_(b):g(b)}},7534:(h,f,d)=>{var p=d(2552),_=d(346);h.exports=function(g){return _(g)&&p(g)=="[object Arguments]"}},5083:(h,f,d)=>{var p=d(1882),_=d(7296),g=d(3805),m=d(7473),b=/^\[object .+?Constructor\]$/,y=Function.prototype,x=Object.prototype,T=y.toString,k=x.hasOwnProperty,R=RegExp("^"+T.call(k).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");h.exports=function(P){return!(!g(P)||_(P))&&(p(P)?R:b).test(m(P))}},4901:(h,f,d)=>{var p=d(2552),_=d(294),g=d(346),m={};m["[object Float32Array]"]=m["[object Float64Array]"]=m["[object Int8Array]"]=m["[object Int16Array]"]=m["[object Int32Array]"]=m["[object Uint8Array]"]=m["[object Uint8ClampedArray]"]=m["[object Uint16Array]"]=m["[object Uint32Array]"]=!0,m["[object Arguments]"]=m["[object Array]"]=m["[object ArrayBuffer]"]=m["[object Boolean]"]=m["[object DataView]"]=m["[object Date]"]=m["[object Error]"]=m["[object Function]"]=m["[object Map]"]=m["[object Number]"]=m["[object Object]"]=m["[object RegExp]"]=m["[object Set]"]=m["[object String]"]=m["[object WeakMap]"]=!1,h.exports=function(b){return g(b)&&_(b.length)&&!!m[p(b)]}},2903:(h,f,d)=>{var p=d(3805),_=d(5527),g=d(181),m=Object.prototype.hasOwnProperty;h.exports=function(b){if(!p(b))return g(b);var y=_(b),x=[];for(var T in b)(T!="constructor"||!y&&m.call(b,T))&&x.push(T);return x}},5250:(h,f,d)=>{var p=d(7217),_=d(7805),g=d(6649),m=d(2824),b=d(3805),y=d(7241),x=d(4974);h.exports=function T(k,R,P,B,U){k!==R&&g(R,(function(z,I){if(U||(U=new p),b(z))m(k,R,I,P,T,B,U);else{var L=B?B(x(k,I),z,I+"",k,R,U):void 0;L===void 0&&(L=z),_(k,I,L)}}),y)}},2824:(h,f,d)=>{var p=d(7805),_=d(3290),g=d(1961),m=d(3007),b=d(5529),y=d(2428),x=d(6449),T=d(3693),k=d(3656),R=d(1882),P=d(3805),B=d(1331),U=d(7167),z=d(4974),I=d(9884);h.exports=function(L,M,F,Z,$,Y,Q){var q=z(L,F),V=z(M,F),K=Q.get(V);if(K)p(L,F,K);else{var ne=Y?Y(q,V,F+"",L,M,Q):void 0,ie=ne===void 0;if(ie){var ae=x(V),Te=!ae&&k(V),Ie=!ae&&!Te&&U(V);ne=V,ae||Te||Ie?x(q)?ne=q:T(q)?ne=m(q):Te?(ie=!1,ne=_(V,!0)):Ie?(ie=!1,ne=g(V,!0)):ne=[]:B(V)||y(V)?(ne=q,y(q)?ne=I(q):P(q)&&!R(q)||(ne=b(V))):ie=!1}ie&&(Q.set(V,ne),$(ne,V,Z,Y,Q),Q.delete(V)),p(L,F,ne)}}},9302:(h,f,d)=>{var p=d(3488),_=d(6757),g=d(2865);h.exports=function(m,b){return g(_(m,b,p),m+"")}},9570:(h,f,d)=>{var p=d(7334),_=d(3243),g=d(3488),m=_?function(b,y){return _(b,"toString",{configurable:!0,enumerable:!1,value:p(y),writable:!0})}:g;h.exports=m},8096:h=>{h.exports=function(f,d){for(var p=-1,_=Array(f);++p<f;)_[p]=d(p);return _}},7301:h=>{h.exports=function(f){return function(d){return f(d)}}},9653:(h,f,d)=>{var p=d(7828);h.exports=function(_){var g=new _.constructor(_.byteLength);return new p(g).set(new p(_)),g}},3290:(h,f,d)=>{h=d.nmd(h);var p=d(9325),_=f&&!f.nodeType&&f,g=_&&h&&!h.nodeType&&h,m=g&&g.exports===_?p.Buffer:void 0,b=m?m.allocUnsafe:void 0;h.exports=function(y,x){if(x)return y.slice();var T=y.length,k=b?b(T):new y.constructor(T);return y.copy(k),k}},1961:(h,f,d)=>{var p=d(9653);h.exports=function(_,g){var m=g?p(_.buffer):_.buffer;return new _.constructor(m,_.byteOffset,_.length)}},3007:h=>{h.exports=function(f,d){var p=-1,_=f.length;for(d||(d=Array(_));++p<_;)d[p]=f[p];return d}},1791:(h,f,d)=>{var p=d(6547),_=d(3360);h.exports=function(g,m,b,y){var x=!b;b||(b={});for(var T=-1,k=m.length;++T<k;){var R=m[T],P=y?y(b[R],g[R],R,b,g):void 0;P===void 0&&(P=g[R]),x?_(b,R,P):p(b,R,P)}return b}},5481:(h,f,d)=>{var p=d(9325)["__core-js_shared__"];h.exports=p},999:(h,f,d)=>{var p=d(9302),_=d(6800);h.exports=function(g){return p((function(m,b){var y=-1,x=b.length,T=x>1?b[x-1]:void 0,k=x>2?b[2]:void 0;for(T=g.length>3&&typeof T=="function"?(x--,T):void 0,k&&_(b[0],b[1],k)&&(T=x<3?void 0:T,x=1),m=Object(m);++y<x;){var R=b[y];R&&g(m,R,y,T)}return m}))}},3221:h=>{h.exports=function(f){return function(d,p,_){for(var g=-1,m=Object(d),b=_(d),y=b.length;y--;){var x=b[f?y:++g];if(p(m[x],x,m)===!1)break}return d}}},3243:(h,f,d)=>{var p=d(6110),_=(function(){try{var g=p(Object,"defineProperty");return g({},"",{}),g}catch{}})();h.exports=_},4840:(h,f,d)=>{var p=typeof d.g=="object"&&d.g&&d.g.Object===Object&&d.g;h.exports=p},2651:(h,f,d)=>{var p=d(4218);h.exports=function(_,g){var m=_.__data__;return p(g)?m[typeof g=="string"?"string":"hash"]:m.map}},6110:(h,f,d)=>{var p=d(5083),_=d(392);h.exports=function(g,m){var b=_(g,m);return p(b)?b:void 0}},8879:(h,f,d)=>{var p=d(4335)(Object.getPrototypeOf,Object);h.exports=p},659:(h,f,d)=>{var p=d(1873),_=Object.prototype,g=_.hasOwnProperty,m=_.toString,b=p?p.toStringTag:void 0;h.exports=function(y){var x=g.call(y,b),T=y[b];try{y[b]=void 0;var k=!0}catch{}var R=m.call(y);return k&&(x?y[b]=T:delete y[b]),R}},392:h=>{h.exports=function(f,d){return f?.[d]}},2032:(h,f,d)=>{var p=d(1042);h.exports=function(){this.__data__=p?p(null):{},this.size=0}},3862:h=>{h.exports=function(f){var d=this.has(f)&&delete this.__data__[f];return this.size-=d?1:0,d}},6721:(h,f,d)=>{var p=d(1042),_=Object.prototype.hasOwnProperty;h.exports=function(g){var m=this.__data__;if(p){var b=m[g];return b==="__lodash_hash_undefined__"?void 0:b}return _.call(m,g)?m[g]:void 0}},2749:(h,f,d)=>{var p=d(1042),_=Object.prototype.hasOwnProperty;h.exports=function(g){var m=this.__data__;return p?m[g]!==void 0:_.call(m,g)}},5749:(h,f,d)=>{var p=d(1042);h.exports=function(_,g){var m=this.__data__;return this.size+=this.has(_)?0:1,m[_]=p&&g===void 0?"__lodash_hash_undefined__":g,this}},5529:(h,f,d)=>{var p=d(9344),_=d(8879),g=d(5527);h.exports=function(m){return typeof m.constructor!="function"||g(m)?{}:p(_(m))}},361:h=>{var f=/^(?:0|[1-9]\d*)$/;h.exports=function(d,p){var _=typeof d;return!!(p=p??9007199254740991)&&(_=="number"||_!="symbol"&&f.test(d))&&d>-1&&d%1==0&&d<p}},6800:(h,f,d)=>{var p=d(5288),_=d(4894),g=d(361),m=d(3805);h.exports=function(b,y,x){if(!m(x))return!1;var T=typeof y;return!!(T=="number"?_(x)&&g(y,x.length):T=="string"&&y in x)&&p(x[y],b)}},4218:h=>{h.exports=function(f){var d=typeof f;return d=="string"||d=="number"||d=="symbol"||d=="boolean"?f!=="__proto__":f===null}},7296:(h,f,d)=>{var p,_=d(5481),g=(p=/[^.]+$/.exec(_&&_.keys&&_.keys.IE_PROTO||""))?"Symbol(src)_1."+p:"";h.exports=function(m){return!!g&&g in m}},5527:h=>{var f=Object.prototype;h.exports=function(d){var p=d&&d.constructor;return d===(typeof p=="function"&&p.prototype||f)}},3702:h=>{h.exports=function(){this.__data__=[],this.size=0}},80:(h,f,d)=>{var p=d(6025),_=Array.prototype.splice;h.exports=function(g){var m=this.__data__,b=p(m,g);return!(b<0||(b==m.length-1?m.pop():_.call(m,b,1),--this.size,0))}},4739:(h,f,d)=>{var p=d(6025);h.exports=function(_){var g=this.__data__,m=p(g,_);return m<0?void 0:g[m][1]}},8655:(h,f,d)=>{var p=d(6025);h.exports=function(_){return p(this.__data__,_)>-1}},1175:(h,f,d)=>{var p=d(6025);h.exports=function(_,g){var m=this.__data__,b=p(m,_);return b<0?(++this.size,m.push([_,g])):m[b][1]=g,this}},3040:(h,f,d)=>{var p=d(1549),_=d(79),g=d(8223);h.exports=function(){this.size=0,this.__data__={hash:new p,map:new(g||_),string:new p}}},7670:(h,f,d)=>{var p=d(2651);h.exports=function(_){var g=p(this,_).delete(_);return this.size-=g?1:0,g}},289:(h,f,d)=>{var p=d(2651);h.exports=function(_){return p(this,_).get(_)}},4509:(h,f,d)=>{var p=d(2651);h.exports=function(_){return p(this,_).has(_)}},2949:(h,f,d)=>{var p=d(2651);h.exports=function(_,g){var m=p(this,_),b=m.size;return m.set(_,g),this.size+=m.size==b?0:1,this}},1042:(h,f,d)=>{var p=d(6110)(Object,"create");h.exports=p},181:h=>{h.exports=function(f){var d=[];if(f!=null)for(var p in Object(f))d.push(p);return d}},6009:(h,f,d)=>{h=d.nmd(h);var p=d(4840),_=f&&!f.nodeType&&f,g=_&&h&&!h.nodeType&&h,m=g&&g.exports===_&&p.process,b=(function(){try{return g&&g.require&&g.require("util").types||m&&m.binding&&m.binding("util")}catch{}})();h.exports=b},9350:h=>{var f=Object.prototype.toString;h.exports=function(d){return f.call(d)}},4335:h=>{h.exports=function(f,d){return function(p){return f(d(p))}}},6757:(h,f,d)=>{var p=d(1033),_=Math.max;h.exports=function(g,m,b){return m=_(m===void 0?g.length-1:m,0),function(){for(var y=arguments,x=-1,T=_(y.length-m,0),k=Array(T);++x<T;)k[x]=y[m+x];x=-1;for(var R=Array(m+1);++x<m;)R[x]=y[x];return R[m]=b(k),p(g,this,R)}}},9325:(h,f,d)=>{var p=d(4840),_=typeof self=="object"&&self&&self.Object===Object&&self,g=p||_||Function("return this")();h.exports=g},4974:h=>{h.exports=function(f,d){if((d!=="constructor"||typeof f[d]!="function")&&d!="__proto__")return f[d]}},2865:(h,f,d)=>{var p=d(9570),_=d(1811)(p);h.exports=_},1811:h=>{var f=Date.now;h.exports=function(d){var p=0,_=0;return function(){var g=f(),m=16-(g-_);if(_=g,m>0){if(++p>=800)return arguments[0]}else p=0;return d.apply(void 0,arguments)}}},1420:(h,f,d)=>{var p=d(79);h.exports=function(){this.__data__=new p,this.size=0}},938:h=>{h.exports=function(f){var d=this.__data__,p=d.delete(f);return this.size=d.size,p}},3605:h=>{h.exports=function(f){return this.__data__.get(f)}},9817:h=>{h.exports=function(f){return this.__data__.has(f)}},945:(h,f,d)=>{var p=d(79),_=d(8223),g=d(3661);h.exports=function(m,b){var y=this.__data__;if(y instanceof p){var x=y.__data__;if(!_||x.length<199)return x.push([m,b]),this.size=++y.size,this;y=this.__data__=new g(x)}return y.set(m,b),this.size=y.size,this}},7473:h=>{var f=Function.prototype.toString;h.exports=function(d){if(d!=null){try{return f.call(d)}catch{}try{return d+""}catch{}}return""}},7334:h=>{h.exports=function(f){return function(){return f}}},5288:h=>{h.exports=function(f,d){return f===d||f!=f&&d!=d}},3488:h=>{h.exports=function(f){return f}},2428:(h,f,d)=>{var p=d(7534),_=d(346),g=Object.prototype,m=g.hasOwnProperty,b=g.propertyIsEnumerable,y=p((function(){return arguments})())?p:function(x){return _(x)&&m.call(x,"callee")&&!b.call(x,"callee")};h.exports=y},6449:h=>{var f=Array.isArray;h.exports=f},4894:(h,f,d)=>{var p=d(1882),_=d(294);h.exports=function(g){return g!=null&&_(g.length)&&!p(g)}},3693:(h,f,d)=>{var p=d(4894),_=d(346);h.exports=function(g){return _(g)&&p(g)}},3656:(h,f,d)=>{h=d.nmd(h);var p=d(9325),_=d(9935),g=f&&!f.nodeType&&f,m=g&&h&&!h.nodeType&&h,b=m&&m.exports===g?p.Buffer:void 0,y=(b?b.isBuffer:void 0)||_;h.exports=y},1882:(h,f,d)=>{var p=d(2552),_=d(3805);h.exports=function(g){if(!_(g))return!1;var m=p(g);return m=="[object Function]"||m=="[object GeneratorFunction]"||m=="[object AsyncFunction]"||m=="[object Proxy]"}},294:h=>{h.exports=function(f){return typeof f=="number"&&f>-1&&f%1==0&&f<=9007199254740991}},3805:h=>{h.exports=function(f){var d=typeof f;return f!=null&&(d=="object"||d=="function")}},346:h=>{h.exports=function(f){return f!=null&&typeof f=="object"}},1331:(h,f,d)=>{var p=d(2552),_=d(8879),g=d(346),m=Function.prototype,b=Object.prototype,y=m.toString,x=b.hasOwnProperty,T=y.call(Object);h.exports=function(k){if(!g(k)||p(k)!="[object Object]")return!1;var R=_(k);if(R===null)return!0;var P=x.call(R,"constructor")&&R.constructor;return typeof P=="function"&&P instanceof P&&y.call(P)==T}},7167:(h,f,d)=>{var p=d(4901),_=d(7301),g=d(6009),m=g&&g.isTypedArray,b=m?_(m):p;h.exports=b},7241:(h,f,d)=>{var p=d(695),_=d(2903),g=d(4894);h.exports=function(m){return g(m)?p(m,!0):_(m)}},6924:(h,f,d)=>{var p=d(5250),_=d(999)((function(g,m,b,y){p(g,m,b,y)}));h.exports=_},9935:h=>{h.exports=function(){return!1}},9884:(h,f,d)=>{var p=d(1791),_=d(7241);h.exports=function(g){return p(g,_(g))}},4355:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.CriteriaInputs=f.BooleanComparisonSchema=void 0;var p=d(4713);f.BooleanComparisonSchema={comparison:{type:"string",required:!0},format:{type:"string",required:!0},value:{type:"string",required:!1}};var _=(function(){function g(m){this.inputs=m}return g.prototype.matches=function(m,b){if(b.length===0)return{success:!0,matched:!1};var y=this.inputs[m];if(y===void 0)return{success:!0,matched:!1};for(var x=0,T=b;x<T.length;x++){var k=T[x],R=this.matchSingleFilter(m,y,k);if(!R.success)return R;if(R.matched)return{success:!0,matched:!0}}return{success:!0,matched:!1}},g.prototype.matchSingleFilter=function(m,b,y){return this.isPrimitiveFilter(y)?this.matchPrimitive(b,y):this.isComparatorFilter(y)?this.matchComparator(m,b,y):{success:!1,error:"Invalid filter type for property ".concat(m)}},g.prototype.matchPrimitive=function(m,b){return typeof m!=typeof b?{success:!0,matched:!1}:typeof m=="string"&&typeof b=="string"?{success:!0,matched:(0,p.matchesWithWildcard)(m,b)}:{success:!0,matched:m===b}},g.prototype.matchComparator=function(m,b,y){var x=y.comparison,T=y.format,k=y.value;return this.isValidComparisonOperator(x)?T==="semver"?this.matchSemverComparator(b,x,k):T==="number"?this.matchNumberComparator(b,x,k):{success:!1,error:"Unknown comparator format: ".concat(T)}:{success:!1,error:"Invalid comparison operator: ".concat(x)}},g.prototype.matchSemverComparator=function(m,b,y){if(typeof m!="string")return{success:!1,error:"Input value must be string for semver comparison"};var x=(0,p.compareSemvers)(m,y);return x===void 0?{success:!1,error:'Invalid semver: input="'.concat(m,'", filter="').concat(y,'"')}:{success:!0,matched:this.evaluateComparison(x,b)}},g.prototype.matchNumberComparator=function(m,b,y){if(typeof m!="number")return{success:!1,error:"Input value must be number for number comparison"};var x,T=parseFloat(y);return isNaN(T)?{success:!1,error:"Invalid number in filter: ".concat(y)}:(x=m<T?-1:m>T?1:0,{success:!0,matched:this.evaluateComparison(x,b)})},g.prototype.evaluateComparison=function(m,b){switch(b){case"<":return m<0;case"<=":return m<=0;case">":return m>0;case">=":return m>=0;case"==":return m===0;case"!=":return m!==0;default:return!1}},g.prototype.isPrimitiveFilter=function(m){return typeof m=="string"||typeof m=="number"||typeof m=="boolean"},g.prototype.isComparatorFilter=function(m){return typeof m=="object"&&m!==null&&"comparison"in m&&"format"in m&&"value"in m},g.prototype.isValidComparisonOperator=function(m){return["<","<=",">",">=","==","!="].includes(m)},g})();f.CriteriaInputs=_},5185:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.CriteriaParser=f.DeviceConfigCriteriaConfigSchema=f.DeviceConfigCriteriaSchema=f.DeviceConfigRulesSchema=void 0;var p=d(4293);f.DeviceConfigRulesSchema={},f.DeviceConfigCriteriaSchema={version:{type:"number",required:!0},rules:{type:"object",required:!0,config:{schema:f.DeviceConfigRulesSchema}}},f.DeviceConfigCriteriaConfigSchema={criteria:{type:"object",required:!0,config:{schema:f.DeviceConfigCriteriaSchema}},payload:{type:"object",required:!0,config:{schema:{}}}};var _=(function(){function g(){}return Object.defineProperty(g,"CURRENT_VERSION",{get:function(){return this.SUPPORTED_VERSION},enumerable:!1,configurable:!0}),g.evaluateCriteria=function(m,b){if(!m.criteria)return(0,p.err)("Missing criteria object");var y=m.criteria;if(y.version!==this.SUPPORTED_VERSION)return(0,p.ok)({matched:!1});if(!y.rules)return(0,p.err)("Missing rules in criteria");var x=y.rules;if(Object.keys(x).length===0)return(0,p.ok)({matched:!0,payload:m.payload});for(var T=0,k=Object.entries(x);T<k.length;T++){var R=k[T],P=R[0],B=R[1],U=b.matches(P,B);if(!U.success)return(0,p.err)(U.error||"Match evaluation failed");if(!U.matched)return(0,p.ok)({matched:!1})}return(0,p.ok)({matched:!0,payload:m.payload})},g.matchingPayloads=function(m,b){for(var y=[],x=[],T=0,k=m;T<k.length;T++){var R=k[T],P=this.evaluateCriteria(R,b);P.ok?P.value.matched&&P.value.payload!==void 0&&y.push(P.value.payload):x.push(P.error)}return x.length>0?(0,p.err)(x):(0,p.ok)({payloads:y})},g.matches=function(m,b,y){return y.matches(m,b)},g.SUPPORTED_VERSION=1,g})();f.CriteriaParser=_},4713:(h,f)=>{function d(p){if(p&&typeof p=="string"){var _=p.split("+")[0];if(_){var g=_.split("-"),m=g[0],b=g.slice(1);if(m){var y=m.split(".");if(!(y.length===0||y.length>3||y.some((function(I){return I===""||!/^\d+$/.test(I)})))){var x=y.map((function(I){return parseInt(I,10)})),T=x[0],k=T===void 0?0:T,R=x[1],P=R===void 0?0:R,B=x[2],U={major:k,minor:P,patch:B===void 0?0:B};if(b.length>0){var z=b.join("-");z&&(U.prerelease=z.split("."))}return U}}}}}Object.defineProperty(f,"__esModule",{value:!0}),f.compareSemvers=f.parseSemver=f.matchesWithWildcard=void 0,f.matchesWithWildcard=function(p,_){if(_==="*")return!0;if(_.endsWith("*")){var g=_.slice(0,-1);return p.indexOf(g)===0}return p===_},f.parseSemver=d,f.compareSemvers=function(p,_){var g=d(p),m=d(_);if(g&&m){if(g.major!==m.major)return g.major>m.major?1:-1;if(g.minor!==m.minor)return g.minor>m.minor?1:-1;if(g.patch!==m.patch)return g.patch>m.patch?1:-1;var b=g.prerelease&&g.prerelease.length>0,y=m.prerelease&&m.prerelease.length>0;if(b&&!y)return-1;if(!b&&y)return 1;if(!b&&!y)return 0;for(var x=g.prerelease,T=m.prerelease,k=Math.max(x.length,T.length),R=0;R<k;R++){var P=x[R],B=T[R];if(P===void 0)return-1;if(B===void 0)return 1;var U=/^\d+$/.test(P),z=/^\d+$/.test(B);if(U&&z){var I=parseInt(P,10),L=parseInt(B,10);if(I!==L)return I>L?1:-1}else{if(U&&!z)return-1;if(!U&&z)return 1;if(P!==B)return P>B?1:-1}}return 0}}},6270:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DeviceConfigRulesSchema=f.DeviceConfigCriteriaSchema=f.DeviceConfigCriteriaConfigSchema=f.CriteriaParser=f.BooleanComparisonSchema=f.CriteriaInputs=f.compareSemvers=f.parseSemver=f.matchesWithWildcard=void 0;var p=d(4713);Object.defineProperty(f,"matchesWithWildcard",{enumerable:!0,get:function(){return p.matchesWithWildcard}}),Object.defineProperty(f,"parseSemver",{enumerable:!0,get:function(){return p.parseSemver}}),Object.defineProperty(f,"compareSemvers",{enumerable:!0,get:function(){return p.compareSemvers}});var _=d(4355);Object.defineProperty(f,"CriteriaInputs",{enumerable:!0,get:function(){return _.CriteriaInputs}}),Object.defineProperty(f,"BooleanComparisonSchema",{enumerable:!0,get:function(){return _.BooleanComparisonSchema}});var g=d(5185);Object.defineProperty(f,"CriteriaParser",{enumerable:!0,get:function(){return g.CriteriaParser}}),Object.defineProperty(f,"DeviceConfigCriteriaConfigSchema",{enumerable:!0,get:function(){return g.DeviceConfigCriteriaConfigSchema}}),Object.defineProperty(f,"DeviceConfigCriteriaSchema",{enumerable:!0,get:function(){return g.DeviceConfigCriteriaSchema}}),Object.defineProperty(f,"DeviceConfigRulesSchema",{enumerable:!0,get:function(){return g.DeviceConfigRulesSchema}})},7094:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DefaultClock=f.DefaultStorage=f.DefaultAnalytics=f.DefaultTrace=f.getDefaultConfigRefreshOptions=f.getDefaultCommonAnalytics=f.DEFAULT_INITIAL_DELAY_SECONDS=f.DEFAULT_HTTP_TIMEOUT_SECONDS=f.DEFAULT_STOP_REFRESH_AFTER_SECONDS=f.DEFAULT_MAX_AGE_CACHE_SECONDS=f.DEFAULT_RETRY_INTERVAL_SECONDS=f.DEFAULT_RETRY_COUNT=f.DEFAULT_REFRESH_INTERVAL_SECONDS=f.STORAGE_PREFIX_KEY=f.ENCODING_BASE64=f.STATE_KEY=f.DATA_KEY=void 0;var p=d(3259),_=d(4811);f.DATA_KEY="data",f.STATE_KEY="state",f.ENCODING_BASE64="base64",f.STORAGE_PREFIX_KEY="amazon_ivs_device_config_v1_",f.DEFAULT_REFRESH_INTERVAL_SECONDS=(0,p.minutesToSeconds)(15),f.DEFAULT_RETRY_COUNT=3,f.DEFAULT_RETRY_INTERVAL_SECONDS=10,f.DEFAULT_MAX_AGE_CACHE_SECONDS=(0,p.daysToSeconds)(3),f.DEFAULT_STOP_REFRESH_AFTER_SECONDS=(0,p.hoursToSeconds)(2),f.DEFAULT_HTTP_TIMEOUT_SECONDS=15,f.DEFAULT_INITIAL_DELAY_SECONDS=5,f.getDefaultCommonAnalytics=function(){return{client_sdk:"unknown",env:_.DeviceConfigEnv.PROD}},f.getDefaultConfigRefreshOptions=function(){return{refreshIntervalSeconds:f.DEFAULT_REFRESH_INTERVAL_SECONDS,retryCount:f.DEFAULT_RETRY_COUNT,retryIntervalSeconds:f.DEFAULT_RETRY_INTERVAL_SECONDS,maxCacheAgeSeconds:f.DEFAULT_MAX_AGE_CACHE_SECONDS,stopRefreshAfterSeconds:f.DEFAULT_STOP_REFRESH_AFTER_SECONDS,canRefreshNow:function(){return!0}}};var g=(function(){function x(T){this.enableConsoleLog=T}return x.prototype.onTrace=function(T){this.enableConsoleLog&&console.log("DeviceConfig trace: "+T)},x})();f.DefaultTrace=g;var m=(function(){function x(T){this.enableConsoleLog=T}return x.prototype.onValue=function(T){this.enableConsoleLog&&console.log("DeviceConfig analytics value:  ".concat(T))},x.prototype.onError=function(T){this.enableConsoleLog&&console.error("DeviceConfig analytics error: ".concat(T))},x.prototype.onTrace=function(T){this.enableConsoleLog&&console.log("DeviceConfig analytics trace: ".concat(T))},x.prototype.onAssignment=function(T){this.enableConsoleLog&&console.log("DeviceConfig analytics assignment: ".concat(T))},x})();f.DefaultAnalytics=m;var b=(function(){function x(T,k){this.prefix=T,this.storage=k}return x.prototype.getJson=function(T){var k=this.prefix+"_"+T;try{var R=this.storage.getItem(k);if(R)return JSON.parse(R)}catch(P){console.error("Error getting local storage key ".concat(k)+P)}return null},x.prototype.setJson=function(T,k){var R=this.prefix+"_"+T;try{this.storage.setItem(R,JSON.stringify(k))}catch(P){console.error("Error setting local storage key ".concat(R,": ")+P)}},x})();f.DefaultStorage=b;var y=(function(){function x(){}return x.prototype.getMillis=function(){return Date.now()},x})();f.DefaultClock=y},9225:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.BucketAssignmentManager=f.PERCENTAGE_SUM_TOLERANCE=void 0;var p=d(8177),_=d(4293),g=d(5234);f.PERCENTAGE_SUM_TOLERANCE=.001;var m=(function(){function b(){}return b.prototype.roll=function(y){var x=(0,p.getSecureRandom)();return x.method!==p.SecureRandomMethod.CRYPTO_RANDOM_VALUES&&y.push({type:g.RolloutWarningType.NON_IDEAL_RANDOM_GENERATED,context:{details:x.method}}),x.value},b.prototype.assignVariant=function(y,x){var T=[],k=this.validateRollout(y,T);return k.ok?x&&y["rollout-id"]===x.rolloutId?(0,_.ok)({variant:x.assignedVariant,shouldUpdateState:!1,warnings:T}):y["force-redistribute"]?this.performInitialAssignment(y,T):x?this.performStickyAssignment(y,x,T):this.performInitialAssignment(y,T):k},b.prototype.validateRollout=function(y,x){var T=y.variants;if(T.length===0)return(0,_.err)("Empty variants array");var k=this.calculateTotalPercentage(T,x);return Math.abs(k-1)>f.PERCENTAGE_SUM_TOLERANCE?(0,_.err)("Variant percentages don't sum to 1.0 within ".concat(f.PERCENTAGE_SUM_TOLERANCE," tolerance (got ").concat(k,")")):(0,_.ok)(y)},b.prototype.calculateTotalPercentage=function(y,x){return y.reduce((function(T,k){var R=Object.values(k);return R.length>1&&x.push({type:g.RolloutWarningType.UNEXPECTED_VARIANT_PROPERTIES,context:{details:"Found more than 1 value for variant: ".concat(R)}}),T+R[0]}),0)},b.prototype.performInitialAssignment=function(y,x){var T=this.roll(x),k=this.selectVariantFromRoll(y.variants,T);return(0,_.ok)({variant:k,shouldUpdateState:!0,warnings:x})},b.prototype.performStickyAssignment=function(y,x,T){var k=x.assignedVariant,R=x.rolloutConfig,P=this.getVariantPercentage(y.variants,k),B=this.getVariantPercentage(R.variants,k);if(!P.ok)return this.performInitialAssignment(y,T);var U=P.value;if(!B.ok||U>=B.value)return B.ok||T.push({type:g.RolloutWarningType.PREVIOUS_VARIANT_NOT_FOUND,context:{details:"Previous variant not found: ".concat(k)}}),(0,_.ok)({variant:k,shouldUpdateState:!0,warnings:T});var z=U/B.value;if(this.roll(T)<=z)return(0,_.ok)({variant:k,shouldUpdateState:!0,warnings:T});var I=this.calculateFreeCapacity(y.variants,R.variants),L=this.roll(T),M=this.selectVariantFromRoll(I,L);return(0,_.ok)({variant:M,shouldUpdateState:!0,warnings:T})},b.prototype.getVariantPercentage=function(y,x){for(var T=0,k=y;T<k.length;T++){var R=k[T];if(R[x]!==void 0)return(0,_.ok)(R[x])}return(0,_.err)("variant not found")},b.prototype.selectVariantFromRoll=function(y,x){for(var T=0,k=0,R=y;k<R.length;k++){var P=R[k],B=Object.entries(P)[0],U=B[0];if(x<=(T+=B[1]))return U}return Object.keys(y[y.length-1])[0]},b.prototype.calculateFreeCapacity=function(y,x){for(var T,k=[],R=0,P=y;R<P.length;R++){var B=P[R],U=Object.entries(B)[0],z=U[0],I=U[1],L=this.getVariantPercentage(x,z),M=0;L.ok&&(M=L.value),I>M&&k.push(((T={})[z]=I-M,T))}return k},b})();f.BucketAssignmentManager=m},5234:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.RolloutManager=f.RolloutWarningType=void 0;var p,_=d(2570),g=d(9225),m=d(8177),b=d(4293);(function(x){x.STORAGE_INITIAL_LOAD_FAILED="STORAGE_INITIAL_LOAD_FAILED",x.STORAGE_INITIAL_LOAD_VERSION_MISMATCH="STORAGE_INITIAL_LOAD_VERSION_MISMATCH",x.STORAGE_INITIAL_SAVE_FAILED="STORAGE_INITIAL_SAVE_FAILED",x.STORAGE_SAVE_FAILED="STORAGE_SAVE_FAILED",x.UNEXPECTED_VARIANT_PROPERTIES="UNEXPECTED_VARIANT_PROPERTIES",x.PREVIOUS_VARIANT_NOT_FOUND="PREVIOUS_VARIANT_NOT_FOUND",x.NON_IDEAL_UUID_GENERATED="NON_IDEAL_UUID_GENERATED",x.NON_IDEAL_RANDOM_GENERATED="NON_IDEAL_RANDOM_GENERATED"})(p||(f.RolloutWarningType=p={}));var y=(function(){function x(T){this.rolloutStateManager=new _.LocalStorageRolloutStateManager(T),this.bucketAssignmentManager=new g.BucketAssignmentManager}return x.prototype.getVariantAssignment=function(T){var k=[],R=T["feature-id"],P=this.rolloutStateManager.getRolloutState(R),B=P.state,U=P.warnings;k.push.apply(k,U);var z=this.bucketAssignmentManager.assignVariant(T,B);if(!z.ok)return(0,b.err)(z.error);k.push.apply(k,z.value.warnings);var I=B?.trackingId;if(!I){var L=(0,m.generateUuid)(),M=L.value,F=L.method;I=M,F!==m.UuidMethod.CRYPTO_RANDOM_UUID&&k.push({type:p.NON_IDEAL_UUID_GENERATED,context:{details:F}})}if(z.value.shouldUpdateState){var Z={rolloutId:T["rollout-id"],assignedVariant:z.value.variant,rolloutConfig:T,trackingId:I},$=this.rolloutStateManager.setRolloutState(R,Z);k.push.apply(k,$.warnings)}return(0,b.ok)({variant:z.value.variant,featureId:R,rolloutId:T["rollout-id"],trackingId:I,warnings:k})},x})();f.RolloutManager=y},7974:(h,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DeviceConfigRolloutSchema=f.DeviceConfigRolloutVariantSchema=void 0,f.DeviceConfigRolloutVariantSchema={},f.DeviceConfigRolloutSchema={variants:{type:"array",required:!0,items:{type:"object",required:!0,config:{schema:f.DeviceConfigRolloutVariantSchema}}},"feature-id":{type:"string",required:!0},"rollout-id":{type:"number",required:!0},"force-redistribute":{type:"boolean",required:!1},version:{type:"number",required:!0}}},2570:function(h,f,d){var p=this&&this.__spreadArray||function(m,b,y){if(y||arguments.length===2)for(var x,T=0,k=b.length;T<k;T++)!x&&T in b||(x||(x=Array.prototype.slice.call(b,0,T)),x[T]=b[T]);return m.concat(x||Array.prototype.slice.call(b))};Object.defineProperty(f,"__esModule",{value:!0}),f.LocalStorageRolloutStateManager=f.DEVICE_CONFIG_STORAGE_VERSION=void 0;var _=d(5234);f.DEVICE_CONFIG_STORAGE_VERSION=1;var g=(function(){function m(b){this.storageKey=(function(k){return"_amazon_ivs_dc_".concat(k,"_b8e4f7c1")})(b);var y=this.loadStorage(),x=y.storage,T=y.warnings;this.storage=x,this.loadWarnings=T}return m.prototype.getRolloutState=function(b){var y;return{state:((y=this.storage.features[b])===null||y===void 0?void 0:y.rolloutState)||null,warnings:p([],this.loadWarnings,!0)}},m.prototype.setRolloutState=function(b,y){return this.storage.features[b]||(this.storage.features[b]={}),this.storage.features[b].rolloutState=y,this.saveStorage()},m.prototype.loadStorage=function(){var b=[];try{var y=localStorage.getItem(this.storageKey);if(y){var x=JSON.parse(y);if(typeof x=="object"){if(x.version===f.DEVICE_CONFIG_STORAGE_VERSION)return{storage:x,warnings:b};b.push({type:_.RolloutWarningType.STORAGE_INITIAL_LOAD_VERSION_MISMATCH,context:{details:"Expected version ".concat(f.DEVICE_CONFIG_STORAGE_VERSION,", but got ").concat(x.version)}})}}}catch(k){b.push({type:_.RolloutWarningType.STORAGE_INITIAL_LOAD_FAILED,context:{error:k}})}var T={version:f.DEVICE_CONFIG_STORAGE_VERSION,features:{}};try{localStorage.setItem(this.storageKey,JSON.stringify(T))}catch(k){b.push({type:_.RolloutWarningType.STORAGE_INITIAL_SAVE_FAILED,context:{error:k}})}return{storage:T,warnings:b}},m.prototype.saveStorage=function(){try{return localStorage.setItem(this.storageKey,JSON.stringify(this.storage)),{warnings:[]}}catch(b){return{warnings:[{type:_.RolloutWarningType.STORAGE_SAVE_FAILED,context:{error:b}}]}}},m})();f.LocalStorageRolloutStateManager=g},3259:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.daysToSeconds=f.hoursToSeconds=f.minutesToSeconds=f.secondsToMillis=f.createPropertyMap=void 0;var p=d(4811);f.createPropertyMap=function(_){return new Map(Object.entries(_).map((function(g){var m=g[0],b=g[1];return[m,new p.Property(m,typeof b=="string"?p.ValueType.STRING:typeof b=="number"?p.ValueType.NUMBER:typeof b=="boolean"?p.ValueType.BOOLEAN:p.ValueType.JSON,typeof b=="string"?b:void 0,typeof b=="number"?b:void 0,typeof b=="boolean"?b:void 0,typeof b=="object"?JSON.stringify(b):void 0,m)]})))},f.secondsToMillis=function(_){return 1e3*_},f.minutesToSeconds=function(_){return 60*_},f.hoursToSeconds=function(_){return 60*_*60},f.daysToSeconds=function(_){return 60*_*60*24}},3723:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.WindowPropertyOverrider=void 0;var p=d(3259);f.WindowPropertyOverrider=function(_){return{getPropertyOverride:function(g){var m,b,y;if(((b=_?.AMAZON_IVS_DEVICE_CONFIG)===null||b===void 0?void 0:b.enableOverrides)===!0&&((y=_.AMAZON_IVS_DEVICE_CONFIG.propertyOverrides)===null||y===void 0?void 0:y[g])!==void 0){var x=_.AMAZON_IVS_DEVICE_CONFIG.propertyOverrides;return(0,p.createPropertyMap)((m={},m[g]=x[g],m)).get(g)}}}}},1743:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(y,x,T,k){k===void 0&&(k=T);var R=Object.getOwnPropertyDescriptor(x,T);R&&!("get"in R?!x.__esModule:R.writable||R.configurable)||(R={enumerable:!0,get:function(){return x[T]}}),Object.defineProperty(y,k,R)}:function(y,x,T,k){k===void 0&&(k=T),y[k]=x[T]}),_=this&&this.__setModuleDefault||(Object.create?function(y,x){Object.defineProperty(y,"default",{enumerable:!0,value:x})}:function(y,x){y.default=x}),g=this&&this.__importStar||function(y){if(y&&y.__esModule)return y;var x={};if(y!=null)for(var T in y)T!=="default"&&Object.prototype.hasOwnProperty.call(y,T)&&p(x,y,T);return _(x,y),x};Object.defineProperty(f,"__esModule",{value:!0}),f.validateSchemaAndReturn=f.validateSchema=void 0;var m=g(d(4293));function b(y,x){var T;if(y==null)return m.err("value is undefined or null");if(typeof y!="object")return m.err("value is not an object");for(var k=y,R=0,P=Object.entries(x);R<P.length;R++){var B=P[R],U=B[0],z=B[1];if(z.type==="object"){if(z.required&&!(U in k))return m.err("".concat(U," is required in schema"));if(k[U]&&!(F=b(k[U],(T=z?.config)===null||T===void 0?void 0:T.schema)).ok)return m.err("".concat(U," ").concat(F.error))}else if(z.type==="array"){if(z.required&&!(U in k))return m.err("".concat(U," is required in schema"));if(U in k){if(!Array.isArray(k[U]))return m.err("".concat(U," is not an array"));if(z.items)for(var I=0,L=k[U];I<L.length;I++){var M=L[I];if(z.items.type==="string"||z.items.type==="number"||z.items.type==="boolean"){if(typeof M!==z.items.type)return m.err("".concat(M," in ").concat(U," is not an ").concat(z.items.type))}else if(z.items.type==="object"&&z.items.config){var F;if(!(F=b(M,z.items.config.schema)).ok)return F}}}}else{if(z.required&&!(U in k))return m.err("".concat(U," is required in schema"));if(U in k&&typeof k[U]!==z.type)return m.err("".concat(U," is not of type ").concat(z.type))}}return m.ok(!0)}f.validateSchema=b,f.validateSchemaAndReturn=function(y,x){var T=b(y,x);return T.ok?m.ok(y):m.err(T.error)}},3840:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.validateSchema=void 0;var p=d(1743);Object.defineProperty(f,"validateSchema",{enumerable:!0,get:function(){return p.validateSchema}})},4811:function(h,f,d){var p,_=this&&this.__extends||(p=function(T,k){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,P){R.__proto__=P}||function(R,P){for(var B in P)Object.prototype.hasOwnProperty.call(P,B)&&(R[B]=P[B])},p(T,k)},function(T,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function R(){this.constructor=T}p(T,k),T.prototype=k===null?Object.create(k):(R.prototype=k.prototype,new R)});Object.defineProperty(f,"__esModule",{value:!0}),f.HttpError=f.StateHolder=f.Property=f.ValueType=f.DeviceConfigEnv=void 0;var g,m,b=d(7094);(function(T){T.BETA="beta",T.PROD="prod",T.CUSTOM="custom"})(g||(f.DeviceConfigEnv=g={})),(function(T){T[T.STRING=0]="STRING",T[T.NUMBER=1]="NUMBER",T[T.BOOLEAN=2]="BOOLEAN",T[T.JSON=3]="JSON"})(m||(f.ValueType=m={})),f.Property=function(T,k,R,P,B,U,z,I){switch(this.name=T,this.type=k,this.valueString=R,this.valueNumber=P,this.valueBoolean=B,this.valueJson=U,this.valueAnalytics=z,this.type){case m.STRING:I===b.ENCODING_BASE64&&R&&(this.valueString=atob(R));break;case m.JSON:I===b.ENCODING_BASE64&&U&&(this.valueJson=atob(U))}};var y=(function(){function T(k,R){var P;this.storage=k,this.key=R,this.state=(P=k.getJson(R))!==null&&P!==void 0?P:{}}return T.prototype.getState=function(){return this.state},T.prototype.setState=function(k){Object.assign(this.state,k),this.storage.setJson(this.key,this.state)},T})();f.StateHolder=y;var x=(function(T){function k(R){return T.call(this,R)||this}return _(k,T),k})(Error);f.HttpError=x},363:function(h,f,d){var p=this&&this.__assign||function(){return p=Object.assign||function(L){for(var M,F=1,Z=arguments.length;F<Z;F++)for(var $ in M=arguments[F])Object.prototype.hasOwnProperty.call(M,$)&&(L[$]=M[$]);return L},p.apply(this,arguments)},_=this&&this.__spreadArray||function(L,M,F){if(F||arguments.length===2)for(var Z,$=0,Y=M.length;$<Y;$++)!Z&&$ in M||(Z||(Z=Array.prototype.slice.call(M,0,$)),Z[$]=M[$]);return L.concat(Z||Array.prototype.slice.call(M))};Object.defineProperty(f,"__esModule",{value:!0}),f.DeviceConfigPropertyHolder=f.DeviceConfigManager=void 0;var g=d(4478),m=d(6270),b=d(4355),y=d(7094),x=d(3259),T=d(1743),k=d(3723),R=d(5234),P=d(7974),B=d(4811),U=(function(){function L(M,F){var Z,$,Y,Q;if(!F.fileKey)throw new Error("options.fileKey cannot be empty");var q=(Z=F.clock)!==null&&Z!==void 0?Z:new y.DefaultClock,V=q.getMillis();switch(this.context=M,this.fileKey=F.fileKey,this.env=F.standardEnv,F.standardEnv){case B.DeviceConfigEnv.BETA:this.fetchServer="beta.ivs-device-config-beta.live-video.net";break;case B.DeviceConfigEnv.PROD:this.fetchServer="prod.ivs-device-config.live-video.net";break;case B.DeviceConfigEnv.CUSTOM:if(!F.customServer)throw new Error("Custom env requires options.customServer");this.fetchServer=F.customServer;break;default:throw new Error("Invalid value for standardEnv: ".concat(F.standardEnv))}this.trace=($=F.trace)!==null&&$!==void 0?$:new y.DefaultTrace(F.enableConsoleLog),this.fetch=(Y=F.fetch)!==null&&Y!==void 0?Y:new I(M),this.storage=new y.DefaultStorage(y.STORAGE_PREFIX_KEY+F.fileKey,M.localStorage),this.state=new B.StateHolder(this.storage,y.STATE_KEY),this.refresh=p(p({},(0,y.getDefaultConfigRefreshOptions)()),F.refresh),this.emitMetrics=F.emitMetrics,this.analyticsProperties=(Q=F.analyticsProperties)!==null&&Q!==void 0?Q:(0,y.getDefaultCommonAnalytics)(),this.enableConsoleLog=F.enableConsoleLog,this.clock=q,this.isInitialRefreshDone=!1;var K=0,ne=this.state.getState();ne&&ne.fetchServer===this.fetchServer&&ne.lastFetchWhenMs&&(K=ne.lastFetchWhenMs);var ie,ae=q.getMillis(),Te=(ae-K)/1e3;if(Te<=this.refresh.maxCacheAgeSeconds){var Ie=this.storage.getJson(y.DATA_KEY);Ie&&Ie.fetchServer===this.fetchServer&&this.setData(Ie.json)}this.lastUseMs=ae,Te>=this.refresh.refreshIntervalSeconds||K==0?ie=0:(ie=Math.round(this.refresh.refreshIntervalSeconds-Te),this.isInitialRefreshDone=!0),ie<5&&(ie=y.DEFAULT_INITIAL_DELAY_SECONDS),this.trace.onTrace("Will start refresh in "+ie+" seconds"),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*ie);var be=q.getMillis();this.initialLoadTime=be-V}return L.getInstance=function(M,F){try{if(!(M.fetch&&M.setTimeout&&M.clearTimeout&&M.localStorage))return void console.log("Context needs to provide fetch, setTimeout, clearTimeout, localStorage")}catch(Z){return void console.error("Error checking for context properties "+Z)}if(this.gInstance){if(this.gInstance.fileKey!=F.fileKey)throw new Error("Existing instance has file key ".concat(this.gInstance.fileKey,", now asking for ").concat(F.fileKey));return this.gInstance}return this.gInstance=new L(M,F),this.gInstance},L.prototype.getConfigurationHolder=function(M){var F,Z,$,Y=this.clock.getMillis();this.lastUseMs=Y;var Q=(F=M.analytics)!==null&&F!==void 0?F:new y.DefaultAnalytics(this.enableConsoleLog),q=0,V=this.state.getState();return V&&V.fetchServer===this.fetchServer&&V.lastFetchWhenMs&&(q=V.lastFetchWhenMs),(Y-q)/1e3<=this.refresh.maxCacheAgeSeconds?new z(Q,this.analyticsProperties,this.properties,q,this.clock,this.fileKey,(Z=this.enableConsoleLog)!==null&&Z!==void 0&&Z):new z(Q,this.analyticsProperties,void 0,0,this.clock,this.fileKey,($=this.enableConsoleLog)!==null&&$!==void 0&&$)},L.prototype.getFetchUrl=function(){var M="https://".concat(this.fetchServer,"/").concat(this.fileKey,".json"),F=new URL(M);return F.searchParams.set("version","1.0"),F},L.clearInstance=function(){var M;(M=this.gInstance)===null||M===void 0||M.clearInstanceImpl(),this.gInstance=void 0},L.prototype.clearInstanceImpl=function(){this.context.clearTimeout(this.fetchTask),this.fetchTask=void 0,this.context.clearTimeout(this.retryTask),this.retryTask=void 0},L.prototype.startRefresh=function(){var M=this;this.trace.onTrace("Starting refresh request"),this.fetchTask=void 0,this.retryTask&&(this.context.clearTimeout(this.retryTask),this.retryTask=void 0),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*this.refresh.refreshIntervalSeconds);var F=this.clock.getMillis();if((F-this.lastUseMs)/1e3>this.refresh.stopRefreshAfterSeconds)this.trace.onTrace("Will not refresh due to refresh timeout");else if(!this.isInitialRefreshDone||this.refresh.canRefreshNow()){this.isInitialRefreshDone=!0;var Z={};this.fetchData().then((function($){M.processResponse($,Z,F),M.emitMetricsImpl(Z)})).catch((function($){M.exceptionMetrics(Z,$),M.emitMetricsImpl(Z),M.trace.onTrace("Fetch error: "+$),M.refresh.retryCount>0&&M.scheduleRetry(1)}))}else this.trace.onTrace("Will not refresh due to callback having returned false")},L.prototype.fetchData=function(){var M=this.getFetchUrl(),F=new Headers,Z=this.state.getState();return Z.fetchServer===this.fetchServer&&(Z.lastFetchWhenFullMs&&this.clock.getMillis()-Z.lastFetchWhenFullMs>1e3*(0,x.hoursToSeconds)(24)?this.trace.onTrace("Forcing full refresh"):this.properties&&Z.lastFetchEtagHeader&&F.set("If-None-Match",Z.lastFetchEtagHeader)),this.fetch.fetchUrl(M,F)},L.prototype.processResponse=function(M,F,Z){var $={fetchServer:this.fetchServer,lastFetchWhenMs:this.clock.getMillis()},Y=M.headers.get("etag");if(Y&&($.lastFetchEtagHeader=Y),M.status<300&&M.json)if(this.setData(M.json)){this.trace.onTrace("Successfully parsed fetched data"),this.storage.setJson(y.DATA_KEY,{fetchServer:this.fetchServer,json:M.json});var Q=this.clock.getMillis();$.lastFetchWhenFullMs=Q,this.state.setState($),F.success_new_data_count=1,F.fetch_duration_average=Math.max(0,Q-Z)}else F.fail_invalid_data_count=1;else{if(M.status!==304){var q="Unexpected http fetch status: "+M.status;throw this.trace.onTrace(q),new B.HttpError(q)}this.trace.onTrace("Server said no change in data"),Q=this.clock.getMillis(),$.lastFetchWhenMs=Q,this.state.setState($),F.success_no_change_count=1,F.fetch_duration_average=Math.max(0,Q-Z)}},L.prototype.scheduleRetry=function(M){var F=this;this.retryTask&&this.context.clearTimeout(this.retryTask);var Z=M*this.refresh.retryIntervalSeconds;this.retryTask=this.context.setTimeout((function(){F.retryTask=void 0,F.fetchRetry(M)}),1e3*Z)},L.prototype.fetchRetry=function(M){var F=this;this.trace.onTrace("Starting retry request ".concat(M,"..."));var Z={},$=this.clock.getMillis();this.fetchData().then((function(Y){F.processResponse(Y,Z,$),F.emitMetricsImpl(Z)})).catch((function(Y){F.exceptionMetrics(Z,Y),F.emitMetricsImpl(Z),F.trace.onTrace("Fetch error: "+Y),F.refresh.retryCount>M&&F.scheduleRetry(M+1)}))},L.prototype.setData=function(M){if(!M)return!1;if(M.version!=="1.0")return this.trace.onTrace("Data version is not 1.0, not applying"),!1;var F=M.properties;if(!F||!Array.isArray(F))return this.trace.onTrace("Data properties is not an array, not applying"),!1;for(var Z=new Map,$=0,Y=F;$<Y.length;$++){var Q=Y[$];if(Q.name&&Q.type&&this.isValidValueType(Q.type)){if(Q.value_string&&typeof Q.value_string!="string"){this.trace.onTrace("Invalid type of value.value_string "+typeof Q.value_string);continue}if(Q.value_number&&typeof Q.value_number!="number"){this.trace.onTrace("Invalid type of value.value_number "+typeof Q.value_number);continue}if(Q.value_boolean&&typeof Q.value_boolean!="boolean"){this.trace.onTrace("Invalid type of value.value_boolean "+typeof Q.value_boolean);continue}if(Q.value_json&&typeof Q.value_json!="string"){this.trace.onTrace("Invalid type of value.value_json "+typeof Q.value_json);continue}if(Q.value_analytics&&typeof Q.value_analytics!="string"){this.trace.onTrace("Invalid type of item.value_analytics "+typeof Q.value_analytics);continue}var q=new B.Property(Q.name,this.parseValueType(Q.type),Q.value_string,Q.value_number,Q.value_boolean,Q.value_json,Q.value_analytics,Q.encoding);Z.set(q.name,q)}}return Z.size!=0&&(this.properties=Z,!0)},L.prototype.isValidValueType=function(M){return M==="string"||M==="number"||M==="boolean"||M=="json"},L.prototype.parseValueType=function(M){switch(M){case"string":return B.ValueType.STRING;case"number":return B.ValueType.NUMBER;case"boolean":return B.ValueType.BOOLEAN;case"json":return B.ValueType.JSON;default:throw new Error("Unsupported value type ".concat(M))}},L.prototype.emitMetricsImpl=function(M){var F,Z,$,Y,Q,q,V=p(p({},this.analyticsProperties),{initial_load_time:this.initialLoadTime,fetch_attempt_count:1,fetch_duration_average:(F=M.fetch_duration_average)!==null&&F!==void 0?F:0,success_no_change_count:(Z=M.success_no_change_count)!==null&&Z!==void 0?Z:0,success_new_data_count:($=M.success_new_data_count)!==null&&$!==void 0?$:0,fail_exception_count:(Y=M.fail_exception_count)!==null&&Y!==void 0?Y:0,fail_http_error_count:(Q=M.fail_http_error_count)!==null&&Q!==void 0?Q:0,fail_invalid_data_count:(q=M.fail_invalid_data_count)!==null&&q!==void 0?q:0});this.emitMetrics(V)},L.prototype.exceptionMetrics=function(M,F){F instanceof B.HttpError||typeof F?.message=="string"&&F.message.indexOf("http error")===0?M.fail_http_error_count=1:M.fail_exception_count=1},L})();f.DeviceConfigManager=U;var z=(function(){function L(M,F,Z,$,Y,Q,q){q===void 0&&(q=!1);var V=this;this.emitValue=function(K,ne){V.analytics.onValue(p(p({},V.analyticsProperties),{key_name:K,value:"".concat(ne),fetched_seconds_ago:V.getFetchedSecondsAgo()}))},this.emitTrace=function(K,ne){V.analytics.onTrace(p(p({},V.analyticsProperties),{key_name:K,message:ne}))},this.emitError=function(K,ne){V.analytics.onError(p(p({},V.analyticsProperties),{key_name:K,message:ne}))},this.emitAssignment=function(K){var ne=K.warnings.map((function(ie){return ie.type})).join(",");V.analytics.onAssignment(p(p({},V.analyticsProperties),{assignment:K.variant,feature_id:K.featureId,rollout_id:K.rolloutId,tracking_id:K.trackingId,warnings:ne}))},this.analytics=M,this.analyticsProperties=F,this.properties=Z,this.dataFetchedWhenMs=$,this.clock=Y,this.fileKey=Q,this.enableConsoleLog=q,this.overrider=(0,k.WindowPropertyOverrider)(window)}return L.prototype.getSize=function(){return this.properties?this.properties.size:-1},L.prototype.getProperty=function(M){var F=this.overrider.getPropertyOverride(M);if(F)return this.debugLog("Using override for key: ".concat(M)),F;if(this.properties){var Z=this.properties.get(M);if(Z)return Z;this.emitError(M,"No property exists for key name")}else this.emitTrace(M,"No properties, local cache is expired")},L.prototype.getStringValue=function(M){var F,Z,$=this.getProperty(M);if($){if($.type===B.ValueType.STRING){var Y=(F=$.valueString)!==null&&F!==void 0?F:"";return this.emitValue($.name,(Z=$.valueAnalytics)!==null&&Z!==void 0?Z:Y),Y}this.emitError($.name,"Type is not a string")}},L.prototype.getNumberValue=function(M){var F,Z,$=this.getProperty(M);if($){if($.type===B.ValueType.NUMBER){var Y=(F=$.valueNumber)!==null&&F!==void 0?F:0;return this.emitValue($.name,(Z=$.valueAnalytics)!==null&&Z!==void 0?Z:Y),Y}this.emitError($.name,"Type is not a number")}},L.prototype.getBooleanValue=function(M){var F,Z,$=this.getProperty(M);if($){if($.type===B.ValueType.BOOLEAN){var Y=(F=$.valueBoolean)!==null&&F!==void 0&&F;return this.emitValue($.name,(Z=$.valueAnalytics)!==null&&Z!==void 0?Z:Y),Y}this.emitError($.name,"Type is not a boolean")}},L.prototype.getJsonValue=function(M){var F,Z,$=this.getProperty(M);if($)if($.type===B.ValueType.JSON){var Y=(F=$.valueAnalytics)!==null&&F!==void 0?F:"",Q=$.valueJson;if(Q)try{var q=JSON.parse(Q);return this.emitValue($.name,(Z=$.valueAnalytics)!==null&&Z!==void 0?Z:q),q}catch{return void this.emitError($.name,"JSON parse error")}else this.emitValue($.name,Y)}else this.emitError($.name,"Type is not JSON")},L.prototype.getResolvedConfigForPropertyKey=function(M){var F=M.key,Z=M.context,$=M.schema,Y=M.trace,Q=Y!==void 0&&Y,q=this.getJsonValue(F);if(q!==void 0)if(q.length!==0){for(var V=[],K=0,ne=q;K<ne.length;K++){var ie=ne[K];(qe=(0,T.validateSchema)(ie,m.DeviceConfigCriteriaConfigSchema)).ok?V.push(ie):this.emitError(F,"Criteria structure invalid: ".concat(qe.error))}for(var ae=new b.CriteriaInputs(Z),Te=[],Ie=0,be=V;Ie<be.length;Ie++)ie=be[Ie],(qe=m.CriteriaParser.evaluateCriteria(ie,ae)).ok?qe.value.matched&&Te.push(qe.value.payload):this.emitError(F,qe.error);if(Te.length!==0){for(var Pe=[],$e=0,tt=Te;$e<tt.length;$e++){var qe;ie=tt[$e],(qe=(0,T.validateSchema)(ie,$)).ok?Pe.push(ie):this.emitError(F,"Payload structure invalid: ".concat(qe.error))}var ut=g.mergeConfigs.apply(void 0,_([{}],Pe,!1)),te=JSON.stringify(ut);return this.emitValue(F,"Resolved: ".concat(te)),ut}if(Q){var Ne=V.length;this.emitTrace(F,"No matches from ".concat(Ne," payloads"))}}else Q&&this.emitTrace(F,"No payloads exist for key")},L.prototype.getResolvedExperimentForPropertyKeys=function(M){for(var F=M.keys,Z=M.context,$=M.trace,Y=$!==void 0&&$,Q={},q=new R.RolloutManager(this.fileKey),V=0,K=F;V<K.length;V++){var ne=K[V];Q[ne]=this.processExperimentKey(ne,Z,Y,q)}return Q},L.prototype.processExperimentKey=function(M,F,Z,$){var Y=this.getJsonValue(M);if(Y!==void 0)if(Y.length!==0){for(var Q=[],q=0,V=Y;q<V.length;q++){var K=V[q],ne=(0,T.validateSchema)(K,m.DeviceConfigCriteriaConfigSchema);ne.ok?Q.push(K):this.emitError(M,"Criteria structure invalid: ".concat(ne.error))}var ie=this.getMatchedCriteria(Q,F,M),ae=this.validateMatchedPayloads(ie,M),Te=this.selectPayload(ae);if(Te){var Ie=$.getVariantAssignment(Te);if(Ie.ok){var be=Ie.value;return this.emitAssignment(be),Z&&this.emitTrace(M,"Experiment variant assigned: ".concat(be.variant)),be}this.emitError(M,"Experiment assignment failed: ".concat(Ie.error))}else Z&&this.emitTrace(M,"No matching criteria from ".concat(Q.length," experiment payloads"))}else Z&&this.emitTrace(M,"No experiment payloads exist for key")},L.prototype.getMatchedCriteria=function(M,F,Z){for(var $=new b.CriteriaInputs(F),Y=[],Q=0,q=M;Q<q.length;Q++){var V=q[Q],K=m.CriteriaParser.evaluateCriteria(V,$);K.ok?K.value.matched&&Y.push(K.value.payload):this.emitError(Z,K.error)}return Y},L.prototype.validateMatchedPayloads=function(M,F){for(var Z=[],$=0,Y=M;$<Y.length;$++){var Q=Y[$];if(Q){var q=(0,T.validateSchemaAndReturn)(Q,P.DeviceConfigRolloutSchema);q.ok?Z.push(q.value):this.emitError(F,"Rollout payload invalid: ".concat(q.error))}}return Z},L.prototype.selectPayload=function(M){return M.length>0?M[0]:void 0},L.prototype.getFetchedSecondsAgo=function(){if(this.dataFetchedWhenMs)return(this.clock.getMillis()-this.dataFetchedWhenMs)/1e3},L.prototype.debugLog=function(M){this.enableConsoleLog&&console.log("[DeviceConfig] ".concat(M))},L})();f.DeviceConfigPropertyHolder=z;var I=(function(){function L(M){this.context=M}return L.prototype.fetchUrl=function(M,F){var Z=this,$={headers:F,cache:"no-store"},Y=null;if(typeof AbortController<"u"){var Q=new AbortController;Y=this.context.setTimeout((function(){return Q.abort()}),1e3*y.DEFAULT_HTTP_TIMEOUT_SECONDS),$.signal=Q.signal}return new Promise((function(q,V){Z.context.fetch(M,$).then((function(K){if(K.status>=400)V(new B.HttpError("http error ".concat(K.status,", ").concat(K.statusText)));else{var ne={status:K.status,headers:K.headers};K.json().then((function(ie){ne.json=ie,q(ne)})).catch((function(){q(ne)}))}})).catch((function(K){V(K)})).finally((function(){Y&&Z.context.clearTimeout(Y)}))}))},L})()},3864:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(g,m,b,y){y===void 0&&(y=b);var x=Object.getOwnPropertyDescriptor(m,b);x&&!("get"in x?!m.__esModule:x.writable||x.configurable)||(x={enumerable:!0,get:function(){return m[b]}}),Object.defineProperty(g,y,x)}:function(g,m,b,y){y===void 0&&(y=b),g[y]=m[b]}),_=this&&this.__exportStar||function(g,m){for(var b in g)b==="default"||Object.prototype.hasOwnProperty.call(m,b)||p(m,g,b)};Object.defineProperty(f,"__esModule",{value:!0}),_(d(363),f),_(d(4811),f),_(d(7094),f),_(d(3259),f),_(d(3840),f),_(d(6270),f)},9456:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(g,m,b,y){y===void 0&&(y=b);var x=Object.getOwnPropertyDescriptor(m,b);x&&!("get"in x?!m.__esModule:x.writable||x.configurable)||(x={enumerable:!0,get:function(){return m[b]}}),Object.defineProperty(g,y,x)}:function(g,m,b,y){y===void 0&&(y=b),g[y]=m[b]}),_=this&&this.__exportStar||function(g,m){for(var b in g)b==="default"||Object.prototype.hasOwnProperty.call(m,b)||p(m,g,b)};Object.defineProperty(f,"__esModule",{value:!0}),_(d(8903),f)},8903:function(h,f,d){var p=this&&this.__spreadArray||function(m,b,y){if(y||arguments.length===2)for(var x,T=0,k=b.length;T<k;T++)!x&&T in b||(x||(x=Array.prototype.slice.call(b,0,T)),x[T]=b[T]);return m.concat(x||Array.prototype.slice.call(b))};Object.defineProperty(f,"__esModule",{value:!0}),f.TypedEmitter=void 0;var _=d(228),g=(function(){function m(b){var y;this.emitter=new _.EventEmitter,this.propagateErrors=(y=b?.propagateErrors)!==null&&y!==void 0&&y}return m.prototype.on=function(b,y){y.call=this.wrapCall(b,y),this.emitter.on(b,y)},m.prototype.off=function(b,y){this.emitter.off(b,y)},m.prototype.emit=function(b){for(var y,x=[],T=1;T<arguments.length;T++)x[T-1]=arguments[T];(y=this.emitter).emit.apply(y,p([b],x,!1))},m.prototype.removeAllListeners=function(){this.emitter.removeAllListeners()},m.prototype.wrapCall=function(b,y){var x=this;return function(T){for(var k=[],R=1;R<arguments.length;R++)k[R-1]=arguments[R];if(x.propagateErrors)y.apply(T,k);else try{y.apply(T,k)}catch(U){var P="Error in callback for ".concat(b),B=y.name;return B&&(P+=" for function ".concat(B)),void console.error(P,U)}}},m})();f.TypedEmitter=g},5987:function(h,f,d){var p,_=this&&this.__extends||(p=function(k,R){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,B){P.__proto__=B}||function(P,B){for(var U in B)Object.prototype.hasOwnProperty.call(B,U)&&(P[U]=B[U])},p(k,R)},function(k,R){if(typeof R!="function"&&R!==null)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");function P(){this.constructor=k}p(k,R),k.prototype=R===null?Object.create(R):(P.prototype=R.prototype,new P)}),g=this&&this.__createBinding||(Object.create?function(k,R,P,B){B===void 0&&(B=P);var U=Object.getOwnPropertyDescriptor(R,P);U&&!("get"in U?!R.__esModule:U.writable||U.configurable)||(U={enumerable:!0,get:function(){return R[P]}}),Object.defineProperty(k,B,U)}:function(k,R,P,B){B===void 0&&(B=P),k[B]=R[P]}),m=this&&this.__setModuleDefault||(Object.create?function(k,R){Object.defineProperty(k,"default",{enumerable:!0,value:R})}:function(k,R){k.default=R}),b=this&&this.__importStar||function(k){if(k&&k.__esModule)return k;var R={};if(k!=null)for(var P in k)P!=="default"&&Object.prototype.hasOwnProperty.call(k,P)&&g(R,k,P);return m(R,k),R};Object.defineProperty(f,"__esModule",{value:!0}),f.createFsm=f.FsmWildcardState=f.RejectedTransitionError=f.InvalidStateTransitionError=void 0;var y=b(d(4293)),x=(function(k){function R(P,B){var U=k.call(this,"Invalid transition from '".concat(B,"' via event '").concat(P,"'"))||this;return U.name="InvalidStateTransitionError",U}return _(R,k),R})(Error);f.InvalidStateTransitionError=x;var T=(function(k){function R(P,B,U){var z=k.call(this,"Transition from '".concat(B,"' via event '").concat(P,"' was rejected for: ").concat(U))||this;return z.name="RejectedTransitionError",z}return _(R,k),R})(Error);f.RejectedTransitionError=T,f.FsmWildcardState="*",f.createFsm=function(k){var R,P=k.transitions,B=k.callbacks,U=k.initialState,z=function(I){var L,M=(L=P[I])===null||L===void 0?void 0:L.from;return!!M&&(typeof M=="string"?M===f.FsmWildcardState:M.includes(U))};return{canTransition:z,transition:function(I,L){var M,F,Z,$,Y,Q;if(!z(I))return y.err(new x(String(U),String(I)));var q=P[I];return q.shouldTransition===void 0||q.shouldTransition(U)?((F=(M=B?.[U])===null||M===void 0?void 0:M.onExiting)===null||F===void 0||F.call(M),(Z=B?.onStateExiting)===null||Z===void 0||Z.call(B,U),R=U,U=q.to,(Y=($=B?.[U])===null||$===void 0?void 0:$.onChanged)===null||Y===void 0||Y.call($,R,L),(Q=B?.onStateChanged)===null||Q===void 0||Q.call(B,R,U,L),y.ok(U)):y.err(new T(String(U),String(I),"shouldTransition returned false"))},previousState:function(){return R},currentState:function(){return U}}}},8156:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(g,m,b,y){y===void 0&&(y=b);var x=Object.getOwnPropertyDescriptor(m,b);x&&!("get"in x?!m.__esModule:x.writable||x.configurable)||(x={enumerable:!0,get:function(){return m[b]}}),Object.defineProperty(g,y,x)}:function(g,m,b,y){y===void 0&&(y=b),g[y]=m[b]}),_=this&&this.__exportStar||function(g,m){for(var b in g)b==="default"||Object.prototype.hasOwnProperty.call(m,b)||p(m,g,b)};Object.defineProperty(f,"__esModule",{value:!0}),f.VERSION=void 0,f.VERSION="0.10.0",_(d(3864),f),_(d(9456),f),_(d(5987),f),_(d(9266),f),_(d(6925),f)},6925:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(g,m,b,y){y===void 0&&(y=b);var x=Object.getOwnPropertyDescriptor(m,b);x&&!("get"in x?!m.__esModule:x.writable||x.configurable)||(x={enumerable:!0,get:function(){return m[b]}}),Object.defineProperty(g,y,x)}:function(g,m,b,y){y===void 0&&(y=b),g[y]=m[b]}),_=this&&this.__exportStar||function(g,m){for(var b in g)b==="default"||Object.prototype.hasOwnProperty.call(m,b)||p(m,g,b)};Object.defineProperty(f,"__esModule",{value:!0}),_(d(6166),f),_(d(7612),f),_(d(7056),f),_(d(8139),f),_(d(3877),f)},6166:function(h,f,d){var p=this&&this.__assign||function(){return p=Object.assign||function(k){for(var R,P=1,B=arguments.length;P<B;P++)for(var U in R=arguments[P])Object.prototype.hasOwnProperty.call(R,U)&&(k[U]=R[U]);return k},p.apply(this,arguments)},_=this&&this.__spreadArray||function(k,R,P){if(P||arguments.length===2)for(var B,U=0,z=R.length;U<z;U++)!B&&U in R||(B||(B=Array.prototype.slice.call(R,0,U)),B[U]=R[U]);return k.concat(B||Array.prototype.slice.call(R))};Object.defineProperty(f,"__esModule",{value:!0}),f.getLogConfig=f.setLogConfig=f.setLogConfigByLevel=f.extractLogConfig=void 0;var g=d(7612),m=d(7056),b=d(8139),y=d(4478),x={enabled:!1,levels:{debug:!0,log:!0,info:!0,warn:!0,error:!0},targets:[(0,m.createConsoleLogTarget)()],categories:{}},T=Object.keys(x);f.extractLogConfig=function(k){var R={};if(Object.keys(k).some((function(I){return T.includes(I)}))){for(var P=0,B=T;P<B.length;P++){var U=B[P];if(k[U]!==void 0){var z=k[U];R[U]=z}}return R}},f.setLogConfigByLevel=function(k){var R=k.enabled||x.enabled,P=k.targets||x.targets,B={debug:!1,log:!1,info:!1,warn:!1,error:!1},U=function(z,I){for(var L=0,M=z;L<M.length;L++){var F=M[L];B[F]=I}};switch(k.level){case"debug":U(["debug","log","info","warn","error"],R);break;case"log":U(["log","info","warn","error"],R);break;case"info":U(["info","warn","error"],!0);break;case"warn":U(["warn","error"],!0);break;case"error":U(["error"],!0)}(0,f.setLogConfig)({enabled:R,levels:B,targets:P})},f.setLogConfig=function(k){var R=(0,y.mergeConfigs)(x,k);R&&(x=R,g.defaultLogEmitter.emit(b.LogEventType.CONFIG_UPDATED,x))},f.getLogConfig=function(){return{enabled:x.enabled,levels:p({},x.levels),targets:_([],x.targets,!0),categories:p({},x.categories)}}},7612:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.defaultLogEmitter=void 0;var p=d(9456);f.defaultLogEmitter=new p.TypedEmitter({})},7056:function(h,f,d){var p=this&&this.__spreadArray||function(g,m,b){if(b||arguments.length===2)for(var y,x=0,T=m.length;x<T;x++)!y&&x in m||(y||(y=Array.prototype.slice.call(m,0,x)),y[x]=m[x]);return g.concat(y||Array.prototype.slice.call(m))};Object.defineProperty(f,"__esModule",{value:!0}),f.createEventLogTarget=f.createConsoleLogTarget=void 0;var _=d(8139);f.createConsoleLogTarget=function(){return{handleMessage:function(g){for(var m=[],b=1;b<arguments.length;b++)m[b-1]=arguments[b];console[g].apply(console,m)}}},f.createEventLogTarget=function(g){return{handleMessage:function(m){for(var b=[],y=1;y<arguments.length;y++)b[y-1]=arguments[y];g.emit.apply(g,p([_.LogEventType.MESSAGE_LOGGED,m],b,!1))}}}},8139:(h,f)=>{var d;Object.defineProperty(f,"__esModule",{value:!0}),f.LogEventType=void 0,(function(p){p.CONFIG_UPDATED="logConfigUpdated",p.MESSAGE_LOGGED="messageLogged"})(d||(f.LogEventType=d={}))},3877:function(h,f,d){var p=this&&this.__assign||function(){return p=Object.assign||function(T){for(var k,R=1,P=arguments.length;R<P;R++)for(var B in k=arguments[R])Object.prototype.hasOwnProperty.call(k,B)&&(T[B]=k[B]);return T},p.apply(this,arguments)},_=this&&this.__spreadArray||function(T,k,R){if(R||arguments.length===2)for(var P,B=0,U=k.length;B<U;B++)!P&&B in k||(P||(P=Array.prototype.slice.call(k,0,B)),P[B]=k[B]);return T.concat(P||Array.prototype.slice.call(k))};Object.defineProperty(f,"__esModule",{value:!0}),f.createLogger=void 0;var g=d(4478),m=d(6166),b=d(7612),y=d(8139),x=function(T,k){return(0,g.mergeConfigs)(T,k)||T};f.createLogger=function(T){var k=T.name,R=T.category,P=T.parent,B=(0,m.extractLogConfig)(T)||{},U=x((0,m.getLogConfig)(),B);b.defaultLogEmitter.on(y.LogEventType.CONFIG_UPDATED,(function(F){U=x(F,B||{})}));var z=function(F){for(var Z=[],$=1;$<arguments.length;$++)Z[$-1]=arguments[$];if(P&&!P.canLog(F)||!L(F))return!1;for(var Y=I(),Q=new Date().toTimeString().split(" ")[0],q=_(["".concat(Q," - (").concat(Y,")")],Z,!0),V=0,K=U.targets;V<K.length;V++){var ne=K[V];ne.handleMessage.apply(ne,_([F],q,!1))}return!0},I=function(){return P?"".concat(P.getName()," | ").concat(k):k},L=function(F){return!(!U.enabled||!U.levels[F]||U.targets.length===0||R!==void 0&&!U.categories[R])},M={debug:function(){for(var F=[],Z=0;Z<arguments.length;Z++)F[Z]=arguments[Z];return z.apply(void 0,_(["debug"],F,!1))},log:function(){for(var F=[],Z=0;Z<arguments.length;Z++)F[Z]=arguments[Z];return z.apply(void 0,_(["log"],F,!1))},info:function(){for(var F=[],Z=0;Z<arguments.length;Z++)F[Z]=arguments[Z];return z.apply(void 0,_(["info"],F,!1))},warn:function(){for(var F=[],Z=0;Z<arguments.length;Z++)F[Z]=arguments[Z];return z.apply(void 0,_(["warn"],F,!1))},error:function(){for(var F=[],Z=0;Z<arguments.length;Z++)F[Z]=arguments[Z];return z.apply(void 0,_(["error"],F,!1))},getName:I,canLog:L,getChildLogger:function(F){return(0,f.createLogger)(p(p({},F),{parent:M}))},setConfig:function(F){U=x(U,B=F)}};return M}},8177:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(R,P,B,U){U===void 0&&(U=B);var z=Object.getOwnPropertyDescriptor(P,B);z&&!("get"in z?!P.__esModule:z.writable||z.configurable)||(z={enumerable:!0,get:function(){return P[B]}}),Object.defineProperty(R,U,z)}:function(R,P,B,U){U===void 0&&(U=B),R[U]=P[B]}),_=this&&this.__setModuleDefault||(Object.create?function(R,P){Object.defineProperty(R,"default",{enumerable:!0,value:P})}:function(R,P){R.default=P}),g=this&&this.__importStar||function(R){if(R&&R.__esModule)return R;var P={};if(R!=null)for(var B in R)B!=="default"&&Object.prototype.hasOwnProperty.call(R,B)&&p(P,R,B);return _(P,R),P},m=this&&this.__awaiter||function(R,P,B,U){return new(B||(B=Promise))((function(z,I){function L(Z){try{F(U.next(Z))}catch($){I($)}}function M(Z){try{F(U.throw(Z))}catch($){I($)}}function F(Z){var $;Z.done?z(Z.value):($=Z.value,$ instanceof B?$:new B((function(Y){Y($)}))).then(L,M)}F((U=U.apply(R,P||[])).next())}))},b=this&&this.__generator||function(R,P){var B,U,z,I,L={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return I={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function M(F){return function(Z){return(function($){if(B)throw new TypeError("Generator is already executing.");for(;I&&(I=0,$[0]&&(L=0)),L;)try{if(B=1,U&&(z=2&$[0]?U.return:$[0]?U.throw||((z=U.return)&&z.call(U),0):U.next)&&!(z=z.call(U,$[1])).done)return z;switch(U=0,z&&($=[2&$[0],z.value]),$[0]){case 0:case 1:z=$;break;case 4:return L.label++,{value:$[1],done:!1};case 5:L.label++,U=$[1],$=[0];continue;case 7:$=L.ops.pop(),L.trys.pop();continue;default:if(!((z=(z=L.trys).length>0&&z[z.length-1])||$[0]!==6&&$[0]!==2)){L=0;continue}if($[0]===3&&(!z||$[1]>z[0]&&$[1]<z[3])){L.label=$[1];break}if($[0]===6&&L.label<z[1]){L.label=z[1],z=$;break}if(z&&L.label<z[2]){L.label=z[2],L.ops.push($);break}z[2]&&L.ops.pop(),L.trys.pop();continue}$=P.call(R,L)}catch(Y){$=[6,Y],U=0}finally{B=z=0}if(5&$[0])throw $[1];return{value:$[0]?$[1]:void 0,done:!0}})([F,Z])}}};Object.defineProperty(f,"__esModule",{value:!0}),f.generateUuid=f.getSecureRandom=f.UuidMethod=f.SecureRandomMethod=f.hashProperty=void 0;var y,x,T=g(d(4293));function k(){if(typeof crypto<"u"&&crypto.getRandomValues)try{var R=new Uint32Array(1);return crypto.getRandomValues(R),{value:R[0]/4294967296,method:y.CRYPTO_RANDOM_VALUES}}catch{}return{value:Math.random(),method:y.MATH_RANDOM}}f.hashProperty=function(R){return m(void 0,void 0,void 0,(function(){var P,B,U,z,I;return b(this,(function(L){switch(L.label){case 0:if(typeof crypto>"u")return[2,T.err("WebCrypto is unsupported, skipping hash")];if(typeof(crypto==null?void 0:crypto.subtle.digest)!="function")return[2,T.err("WebCrypto subtle.digest does not exist, possible insecure origin")];L.label=1;case 1:return L.trys.push([1,3,,4]),P=new TextEncoder().encode(R),[4,crypto.subtle.digest("SHA-256",P)];case 2:return B=L.sent(),U=Array.from(new Uint8Array(B)),z=U.map((function(M){return M.toString(16).padStart(2,"0")})).join(""),[2,T.ok({key:R,hash:z})];case 3:return I=L.sent(),[2,T.err("Unable to hash rule: ".concat(I))];case 4:return[2]}}))}))},(function(R){R.CRYPTO_RANDOM_VALUES="crypto-random-values",R.MATH_RANDOM="math-random"})(y||(f.SecureRandomMethod=y={})),(function(R){R.CRYPTO_RANDOM_UUID="crypto-random-uuid",R.MANUAL_CRYPTO_RANDOM_VALUES="manual-crypto-random-values",R.MANUAL_MATH_RANDOM="manual-math-random"})(x||(f.UuidMethod=x={})),f.getSecureRandom=k,f.generateUuid=function(){if(typeof crypto<"u"&&crypto.randomUUID)try{return{value:crypto.randomUUID(),method:x.CRYPTO_RANDOM_UUID}}catch{}for(var R="0123456789abcdef",P="",B=x.MANUAL_CRYPTO_RANDOM_VALUES,U=0;U<36;U++)if(U===8||U===13||U===18||U===23)P+="-";else if(U===14)P+="4";else if(U===19)(z=k()).method===y.MATH_RANDOM&&(B=x.MANUAL_MATH_RANDOM),P+=R[Math.floor(4*z.value)+8];else{var z;(z=k()).method===y.MATH_RANDOM&&(B=x.MANUAL_MATH_RANDOM),P+=R[Math.floor(16*z.value)]}return{value:P,method:B}}},9266:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(g,m,b,y){y===void 0&&(y=b);var x=Object.getOwnPropertyDescriptor(m,b);x&&!("get"in x?!m.__esModule:x.writable||x.configurable)||(x={enumerable:!0,get:function(){return m[b]}}),Object.defineProperty(g,y,x)}:function(g,m,b,y){y===void 0&&(y=b),g[y]=m[b]}),_=this&&this.__exportStar||function(g,m){for(var b in g)b==="default"||Object.prototype.hasOwnProperty.call(m,b)||p(m,g,b)};Object.defineProperty(f,"__esModule",{value:!0}),_(d(8177),f),_(d(3012),f),_(d(4293),f)},4478:function(h,f,d){var p=this&&this.__spreadArray||function(b,y,x){if(x||arguments.length===2)for(var T,k=0,R=y.length;k<R;k++)!T&&k in y||(T||(T=Array.prototype.slice.call(y,0,k)),T[k]=y[k]);return b.concat(T||Array.prototype.slice.call(y))},_=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(f,"__esModule",{value:!0}),f.mergeConfigs=void 0;var g=_(d(6924)),m=function(b,y){if(Array.isArray(b))return y};f.mergeConfigs=function(b){for(var y=[],x=1;x<arguments.length;x++)y[x-1]=arguments[x];var T=y.map((function(k){return k==null||typeof k!="object"})).filter(Boolean).length>0;if(typeof b=="object"&&!T)return g.default.apply(void 0,p(p([{},b],y,!1),[m],!1))}},4293:(h,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.getErr=f.getOk_or=f.getOk=f.isNotOk=f.isOk=f.err=f.ok=void 0,f.ok=function(d){return{ok:!0,value:d}},f.err=function(d){return{ok:!1,error:d}},f.isOk=function(d){return d.ok===!0},f.isNotOk=function(d){return!(0,f.isOk)(d)},f.getOk=function(d){if(d.ok===!0)return d.value},f.getOk_or=function(d,p){return d.ok===!0?d.value:p},f.getErr=function(d){if(d.ok!==!0)return d.error}},3012:(h,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.timedThrottle=void 0,f.timedThrottle=function(d,p){var _=0;return function(){for(var g=[],m=0;m<arguments.length;m++)g[m]=arguments[m];var b=Date.now();b-_>=p&&(_=b,d.apply(this,g))}}}},l={};function u(h){var f=l[h];if(f!==void 0)return f.exports;var d=l[h]={id:h,loaded:!1,exports:{}};return c[h].call(d.exports,d,d.exports,u),d.loaded=!0,d.exports}return u.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),u.nmd=h=>(h.paths=[],h.children||(h.children=[]),h),u(8156)})(),o.exports=a()},1549:(o,a,c)=>{var l=c(2032),u=c(3862),h=c(6721),f=c(2749),d=c(5749);function p(_){var g=-1,m=_==null?0:_.length;for(this.clear();++g<m;){var b=_[g];this.set(b[0],b[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=f,p.prototype.set=d,o.exports=p},79:(o,a,c)=>{var l=c(3702),u=c(80),h=c(4739),f=c(8655),d=c(1175);function p(_){var g=-1,m=_==null?0:_.length;for(this.clear();++g<m;){var b=_[g];this.set(b[0],b[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=f,p.prototype.set=d,o.exports=p},8223:(o,a,c)=>{var l=c(6110)(c(9325),"Map");o.exports=l},3661:(o,a,c)=>{var l=c(3040),u=c(7670),h=c(289),f=c(4509),d=c(2949);function p(_){var g=-1,m=_==null?0:_.length;for(this.clear();++g<m;){var b=_[g];this.set(b[0],b[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=f,p.prototype.set=d,o.exports=p},7217:(o,a,c)=>{var l=c(79),u=c(1420),h=c(938),f=c(3605),d=c(9817),p=c(945);function _(g){var m=this.__data__=new l(g);this.size=m.size}_.prototype.clear=u,_.prototype.delete=h,_.prototype.get=f,_.prototype.has=d,_.prototype.set=p,o.exports=_},1873:(o,a,c)=>{var l=c(9325).Symbol;o.exports=l},7828:(o,a,c)=>{var l=c(9325).Uint8Array;o.exports=l},1033:o=>{o.exports=function(a,c,l){switch(l.length){case 0:return a.call(c);case 1:return a.call(c,l[0]);case 2:return a.call(c,l[0],l[1]);case 3:return a.call(c,l[0],l[1],l[2])}return a.apply(c,l)}},695:(o,a,c)=>{var l=c(8096),u=c(2428),h=c(6449),f=c(3656),d=c(361),p=c(7167),_=Object.prototype.hasOwnProperty;o.exports=function(g,m){var b=h(g),y=!b&&u(g),x=!b&&!y&&f(g),T=!b&&!y&&!x&&p(g),k=b||y||x||T,R=k?l(g.length,String):[],P=R.length;for(var B in g)!m&&!_.call(g,B)||k&&(B=="length"||x&&(B=="offset"||B=="parent")||T&&(B=="buffer"||B=="byteLength"||B=="byteOffset")||d(B,P))||R.push(B);return R}},7805:(o,a,c)=>{var l=c(3360),u=c(5288);o.exports=function(h,f,d){(d!==void 0&&!u(h[f],d)||d===void 0&&!(f in h))&&l(h,f,d)}},6547:(o,a,c)=>{var l=c(3360),u=c(5288),h=Object.prototype.hasOwnProperty;o.exports=function(f,d,p){var _=f[d];h.call(f,d)&&u(_,p)&&(p!==void 0||d in f)||l(f,d,p)}},6025:(o,a,c)=>{var l=c(5288);o.exports=function(u,h){for(var f=u.length;f--;)if(l(u[f][0],h))return f;return-1}},3360:(o,a,c)=>{var l=c(3243);o.exports=function(u,h,f){h=="__proto__"&&l?l(u,h,{configurable:!0,enumerable:!0,value:f,writable:!0}):u[h]=f}},9344:(o,a,c)=>{var l=c(3805),u=Object.create,h=(function(){function f(){}return function(d){if(!l(d))return{};if(u)return u(d);f.prototype=d;var p=new f;return f.prototype=void 0,p}})();o.exports=h},6649:(o,a,c)=>{var l=c(3221)();o.exports=l},2552:(o,a,c)=>{var l=c(1873),u=c(659),h=c(9350),f=l?l.toStringTag:void 0;o.exports=function(d){return d==null?d===void 0?"[object Undefined]":"[object Null]":f&&f in Object(d)?u(d):h(d)}},7534:(o,a,c)=>{var l=c(2552),u=c(346);o.exports=function(h){return u(h)&&l(h)=="[object Arguments]"}},5083:(o,a,c)=>{var l=c(1882),u=c(7296),h=c(3805),f=c(7473),d=/^\[object .+?Constructor\]$/,p=Function.prototype,_=Object.prototype,g=p.toString,m=_.hasOwnProperty,b=RegExp("^"+g.call(m).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");o.exports=function(y){return!(!h(y)||u(y))&&(l(y)?b:d).test(f(y))}},4901:(o,a,c)=>{var l=c(2552),u=c(294),h=c(346),f={};f["[object Float32Array]"]=f["[object Float64Array]"]=f["[object Int8Array]"]=f["[object Int16Array]"]=f["[object Int32Array]"]=f["[object Uint8Array]"]=f["[object Uint8ClampedArray]"]=f["[object Uint16Array]"]=f["[object Uint32Array]"]=!0,f["[object Arguments]"]=f["[object Array]"]=f["[object ArrayBuffer]"]=f["[object Boolean]"]=f["[object DataView]"]=f["[object Date]"]=f["[object Error]"]=f["[object Function]"]=f["[object Map]"]=f["[object Number]"]=f["[object Object]"]=f["[object RegExp]"]=f["[object Set]"]=f["[object String]"]=f["[object WeakMap]"]=!1,o.exports=function(d){return h(d)&&u(d.length)&&!!f[l(d)]}},2903:(o,a,c)=>{var l=c(3805),u=c(5527),h=c(181),f=Object.prototype.hasOwnProperty;o.exports=function(d){if(!l(d))return h(d);var p=u(d),_=[];for(var g in d)(g!="constructor"||!p&&f.call(d,g))&&_.push(g);return _}},5250:(o,a,c)=>{var l=c(7217),u=c(7805),h=c(6649),f=c(2824),d=c(3805),p=c(7241),_=c(4974);o.exports=function g(m,b,y,x,T){m!==b&&h(b,(function(k,R){if(T||(T=new l),d(k))f(m,b,R,y,g,x,T);else{var P=x?x(_(m,R),k,R+"",m,b,T):void 0;P===void 0&&(P=k),u(m,R,P)}}),p)}},2824:(o,a,c)=>{var l=c(7805),u=c(3290),h=c(1961),f=c(3007),d=c(5529),p=c(2428),_=c(6449),g=c(3693),m=c(3656),b=c(1882),y=c(3805),x=c(1331),T=c(7167),k=c(4974),R=c(9884);o.exports=function(P,B,U,z,I,L,M){var F=k(P,U),Z=k(B,U),$=M.get(Z);if($)l(P,U,$);else{var Y=L?L(F,Z,U+"",P,B,M):void 0,Q=Y===void 0;if(Q){var q=_(Z),V=!q&&m(Z),K=!q&&!V&&T(Z);Y=Z,q||V||K?_(F)?Y=F:g(F)?Y=f(F):V?(Q=!1,Y=u(Z,!0)):K?(Q=!1,Y=h(Z,!0)):Y=[]:x(Z)||p(Z)?(Y=F,p(F)?Y=R(F):y(F)&&!b(F)||(Y=d(Z))):Q=!1}Q&&(M.set(Z,Y),I(Y,Z,z,L,M),M.delete(Z)),l(P,U,Y)}}},9302:(o,a,c)=>{var l=c(3488),u=c(6757),h=c(2865);o.exports=function(f,d){return h(u(f,d,l),f+"")}},9570:(o,a,c)=>{var l=c(7334),u=c(3243),h=c(3488),f=u?function(d,p){return u(d,"toString",{configurable:!0,enumerable:!1,value:l(p),writable:!0})}:h;o.exports=f},8096:o=>{o.exports=function(a,c){for(var l=-1,u=Array(a);++l<a;)u[l]=c(l);return u}},7301:o=>{o.exports=function(a){return function(c){return a(c)}}},9653:(o,a,c)=>{var l=c(7828);o.exports=function(u){var h=new u.constructor(u.byteLength);return new l(h).set(new l(u)),h}},3290:(o,a,c)=>{o=c.nmd(o);var l=c(9325),u=a&&!a.nodeType&&a,h=u&&o&&!o.nodeType&&o,f=h&&h.exports===u?l.Buffer:void 0,d=f?f.allocUnsafe:void 0;o.exports=function(p,_){if(_)return p.slice();var g=p.length,m=d?d(g):new p.constructor(g);return p.copy(m),m}},1961:(o,a,c)=>{var l=c(9653);o.exports=function(u,h){var f=h?l(u.buffer):u.buffer;return new u.constructor(f,u.byteOffset,u.length)}},3007:o=>{o.exports=function(a,c){var l=-1,u=a.length;for(c||(c=Array(u));++l<u;)c[l]=a[l];return c}},1791:(o,a,c)=>{var l=c(6547),u=c(3360);o.exports=function(h,f,d,p){var _=!d;d||(d={});for(var g=-1,m=f.length;++g<m;){var b=f[g],y=p?p(d[b],h[b],b,d,h):void 0;y===void 0&&(y=h[b]),_?u(d,b,y):l(d,b,y)}return d}},5481:(o,a,c)=>{var l=c(9325)["__core-js_shared__"];o.exports=l},999:(o,a,c)=>{var l=c(9302),u=c(6800);o.exports=function(h){return l((function(f,d){var p=-1,_=d.length,g=_>1?d[_-1]:void 0,m=_>2?d[2]:void 0;for(g=h.length>3&&typeof g=="function"?(_--,g):void 0,m&&u(d[0],d[1],m)&&(g=_<3?void 0:g,_=1),f=Object(f);++p<_;){var b=d[p];b&&h(f,b,p,g)}return f}))}},3221:o=>{o.exports=function(a){return function(c,l,u){for(var h=-1,f=Object(c),d=u(c),p=d.length;p--;){var _=d[a?p:++h];if(l(f[_],_,f)===!1)break}return c}}},3243:(o,a,c)=>{var l=c(6110),u=(function(){try{var h=l(Object,"defineProperty");return h({},"",{}),h}catch{}})();o.exports=u},4840:(o,a,c)=>{var l=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g;o.exports=l},2651:(o,a,c)=>{var l=c(4218);o.exports=function(u,h){var f=u.__data__;return l(h)?f[typeof h=="string"?"string":"hash"]:f.map}},6110:(o,a,c)=>{var l=c(5083),u=c(392);o.exports=function(h,f){var d=u(h,f);return l(d)?d:void 0}},8879:(o,a,c)=>{var l=c(4335)(Object.getPrototypeOf,Object);o.exports=l},659:(o,a,c)=>{var l=c(1873),u=Object.prototype,h=u.hasOwnProperty,f=u.toString,d=l?l.toStringTag:void 0;o.exports=function(p){var _=h.call(p,d),g=p[d];try{p[d]=void 0;var m=!0}catch{}var b=f.call(p);return m&&(_?p[d]=g:delete p[d]),b}},392:o=>{o.exports=function(a,c){return a?.[c]}},2032:(o,a,c)=>{var l=c(1042);o.exports=function(){this.__data__=l?l(null):{},this.size=0}},3862:o=>{o.exports=function(a){var c=this.has(a)&&delete this.__data__[a];return this.size-=c?1:0,c}},6721:(o,a,c)=>{var l=c(1042),u=Object.prototype.hasOwnProperty;o.exports=function(h){var f=this.__data__;if(l){var d=f[h];return d==="__lodash_hash_undefined__"?void 0:d}return u.call(f,h)?f[h]:void 0}},2749:(o,a,c)=>{var l=c(1042),u=Object.prototype.hasOwnProperty;o.exports=function(h){var f=this.__data__;return l?f[h]!==void 0:u.call(f,h)}},5749:(o,a,c)=>{var l=c(1042);o.exports=function(u,h){var f=this.__data__;return this.size+=this.has(u)?0:1,f[u]=l&&h===void 0?"__lodash_hash_undefined__":h,this}},5529:(o,a,c)=>{var l=c(9344),u=c(8879),h=c(5527);o.exports=function(f){return typeof f.constructor!="function"||h(f)?{}:l(u(f))}},361:o=>{var a=/^(?:0|[1-9]\d*)$/;o.exports=function(c,l){var u=typeof c;return!!(l=l??9007199254740991)&&(u=="number"||u!="symbol"&&a.test(c))&&c>-1&&c%1==0&&c<l}},6800:(o,a,c)=>{var l=c(5288),u=c(4894),h=c(361),f=c(3805);o.exports=function(d,p,_){if(!f(_))return!1;var g=typeof p;return!!(g=="number"?u(_)&&h(p,_.length):g=="string"&&p in _)&&l(_[p],d)}},4218:o=>{o.exports=function(a){var c=typeof a;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?a!=="__proto__":a===null}},7296:(o,a,c)=>{var l,u=c(5481),h=(l=/[^.]+$/.exec(u&&u.keys&&u.keys.IE_PROTO||""))?"Symbol(src)_1."+l:"";o.exports=function(f){return!!h&&h in f}},5527:o=>{var a=Object.prototype;o.exports=function(c){var l=c&&c.constructor;return c===(typeof l=="function"&&l.prototype||a)}},3702:o=>{o.exports=function(){this.__data__=[],this.size=0}},80:(o,a,c)=>{var l=c(6025),u=Array.prototype.splice;o.exports=function(h){var f=this.__data__,d=l(f,h);return!(d<0)&&(d==f.length-1?f.pop():u.call(f,d,1),--this.size,!0)}},4739:(o,a,c)=>{var l=c(6025);o.exports=function(u){var h=this.__data__,f=l(h,u);return f<0?void 0:h[f][1]}},8655:(o,a,c)=>{var l=c(6025);o.exports=function(u){return l(this.__data__,u)>-1}},1175:(o,a,c)=>{var l=c(6025);o.exports=function(u,h){var f=this.__data__,d=l(f,u);return d<0?(++this.size,f.push([u,h])):f[d][1]=h,this}},3040:(o,a,c)=>{var l=c(1549),u=c(79),h=c(8223);o.exports=function(){this.size=0,this.__data__={hash:new l,map:new(h||u),string:new l}}},7670:(o,a,c)=>{var l=c(2651);o.exports=function(u){var h=l(this,u).delete(u);return this.size-=h?1:0,h}},289:(o,a,c)=>{var l=c(2651);o.exports=function(u){return l(this,u).get(u)}},4509:(o,a,c)=>{var l=c(2651);o.exports=function(u){return l(this,u).has(u)}},2949:(o,a,c)=>{var l=c(2651);o.exports=function(u,h){var f=l(this,u),d=f.size;return f.set(u,h),this.size+=f.size==d?0:1,this}},1042:(o,a,c)=>{var l=c(6110)(Object,"create");o.exports=l},181:o=>{o.exports=function(a){var c=[];if(a!=null)for(var l in Object(a))c.push(l);return c}},6009:(o,a,c)=>{o=c.nmd(o);var l=c(4840),u=a&&!a.nodeType&&a,h=u&&o&&!o.nodeType&&o,f=h&&h.exports===u&&l.process,d=(function(){try{var p=h&&h.require&&h.require("util").types;return p||f&&f.binding&&f.binding("util")}catch{}})();o.exports=d},9350:o=>{var a=Object.prototype.toString;o.exports=function(c){return a.call(c)}},4335:o=>{o.exports=function(a,c){return function(l){return a(c(l))}}},6757:(o,a,c)=>{var l=c(1033),u=Math.max;o.exports=function(h,f,d){return f=u(f===void 0?h.length-1:f,0),function(){for(var p=arguments,_=-1,g=u(p.length-f,0),m=Array(g);++_<g;)m[_]=p[f+_];_=-1;for(var b=Array(f+1);++_<f;)b[_]=p[_];return b[f]=d(m),l(h,this,b)}}},9325:(o,a,c)=>{var l=c(4840),u=typeof self=="object"&&self&&self.Object===Object&&self,h=l||u||Function("return this")();o.exports=h},4974:o=>{o.exports=function(a,c){if((c!=="constructor"||typeof a[c]!="function")&&c!="__proto__")return a[c]}},2865:(o,a,c)=>{var l=c(9570),u=c(1811)(l);o.exports=u},1811:o=>{var a=Date.now;o.exports=function(c){var l=0,u=0;return function(){var h=a(),f=16-(h-u);if(u=h,f>0){if(++l>=800)return arguments[0]}else l=0;return c.apply(void 0,arguments)}}},1420:(o,a,c)=>{var l=c(79);o.exports=function(){this.__data__=new l,this.size=0}},938:o=>{o.exports=function(a){var c=this.__data__,l=c.delete(a);return this.size=c.size,l}},3605:o=>{o.exports=function(a){return this.__data__.get(a)}},9817:o=>{o.exports=function(a){return this.__data__.has(a)}},945:(o,a,c)=>{var l=c(79),u=c(8223),h=c(3661);o.exports=function(f,d){var p=this.__data__;if(p instanceof l){var _=p.__data__;if(!u||_.length<199)return _.push([f,d]),this.size=++p.size,this;p=this.__data__=new h(_)}return p.set(f,d),this.size=p.size,this}},7473:o=>{var a=Function.prototype.toString;o.exports=function(c){if(c!=null){try{return a.call(c)}catch{}try{return c+""}catch{}}return""}},7334:o=>{o.exports=function(a){return function(){return a}}},5288:o=>{o.exports=function(a,c){return a===c||a!=a&&c!=c}},3488:o=>{o.exports=function(a){return a}},2428:(o,a,c)=>{var l=c(7534),u=c(346),h=Object.prototype,f=h.hasOwnProperty,d=h.propertyIsEnumerable,p=l((function(){return arguments})())?l:function(_){return u(_)&&f.call(_,"callee")&&!d.call(_,"callee")};o.exports=p},6449:o=>{var a=Array.isArray;o.exports=a},4894:(o,a,c)=>{var l=c(1882),u=c(294);o.exports=function(h){return h!=null&&u(h.length)&&!l(h)}},3693:(o,a,c)=>{var l=c(4894),u=c(346);o.exports=function(h){return u(h)&&l(h)}},3656:(o,a,c)=>{o=c.nmd(o);var l=c(9325),u=c(9935),h=a&&!a.nodeType&&a,f=h&&o&&!o.nodeType&&o,d=f&&f.exports===h?l.Buffer:void 0,p=(d?d.isBuffer:void 0)||u;o.exports=p},1882:(o,a,c)=>{var l=c(2552),u=c(3805);o.exports=function(h){if(!u(h))return!1;var f=l(h);return f=="[object Function]"||f=="[object GeneratorFunction]"||f=="[object AsyncFunction]"||f=="[object Proxy]"}},294:o=>{o.exports=function(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=9007199254740991}},3805:o=>{o.exports=function(a){var c=typeof a;return a!=null&&(c=="object"||c=="function")}},346:o=>{o.exports=function(a){return a!=null&&typeof a=="object"}},1331:(o,a,c)=>{var l=c(2552),u=c(8879),h=c(346),f=Function.prototype,d=Object.prototype,p=f.toString,_=d.hasOwnProperty,g=p.call(Object);o.exports=function(m){if(!h(m)||l(m)!="[object Object]")return!1;var b=u(m);if(b===null)return!0;var y=_.call(b,"constructor")&&b.constructor;return typeof y=="function"&&y instanceof y&&p.call(y)==g}},7167:(o,a,c)=>{var l=c(4901),u=c(7301),h=c(6009),f=h&&h.isTypedArray,d=f?u(f):l;o.exports=d},7241:(o,a,c)=>{var l=c(695),u=c(2903),h=c(4894);o.exports=function(f){return h(f)?l(f,!0):u(f)}},2543:function(o,a,c){var l;o=c.nmd(o),(function(){var u,h="Expected a function",f="__lodash_hash_undefined__",d="__lodash_placeholder__",p=16,_=32,g=64,m=128,b=256,y=1/0,x=9007199254740991,T=NaN,k=4294967295,R=[["ary",m],["bind",1],["bindKey",2],["curry",8],["curryRight",p],["flip",512],["partial",_],["partialRight",g],["rearg",b]],P="[object Arguments]",B="[object Array]",U="[object Boolean]",z="[object Date]",I="[object Error]",L="[object Function]",M="[object GeneratorFunction]",F="[object Map]",Z="[object Number]",$="[object Object]",Y="[object Promise]",Q="[object RegExp]",q="[object Set]",V="[object String]",K="[object Symbol]",ne="[object WeakMap]",ie="[object ArrayBuffer]",ae="[object DataView]",Te="[object Float32Array]",Ie="[object Float64Array]",be="[object Int8Array]",Pe="[object Int16Array]",$e="[object Int32Array]",tt="[object Uint8Array]",qe="[object Uint8ClampedArray]",ut="[object Uint16Array]",te="[object Uint32Array]",Ne=/\b__p \+= '';/g,Be=/\b(__p \+=) '' \+/g,De=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Oe=/&(?:amp|lt|gt|quot|#39);/g,ue=/[&<>"']/g,_e=RegExp(Oe.source),we=RegExp(ue.source),pe=/<%-([\s\S]+?)%>/g,ze=/<%([\s\S]+?)%>/g,Ze=/<%=([\s\S]+?)%>/g,Je=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nt=/^\w*$/,Pt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,vt=/[\\^$.*+?()[\]{}|]/g,At=RegExp(vt.source),Re=/^\s+/,ce=/\s/,W=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,le=/\{\n\/\* \[wrapped with (.+)\] \*/,Se=/,? & /,Ae=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ye=/[()=,{}\[\]\/\s]/,ve=/\\(\\)?/g,Xe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Me=/\w*$/,Ve=/^[-+]0x[0-9a-f]+$/i,je=/^0b[01]+$/i,We=/^\[object .+?Constructor\]$/,ct=/^0o[0-7]+$/i,Fe=/^(?:0|[1-9]\d*)$/,rt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,it=/($^)/,St=/['\n\r\u2028\u2029\\]/g,at="\\ud800-\\udfff",Yt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",sn="\\u2700-\\u27bf",Rt="a-z\\xdf-\\xf6\\xf8-\\xff",Ut="A-Z\\xc0-\\xd6\\xd8-\\xde",_t="\\ufe0e\\ufe0f",Ht="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",_n="[']",jt="["+at+"]",mn="["+Ht+"]",Rn="["+Yt+"]",Un="\\d+",qi="["+sn+"]",oi="["+Rt+"]",_i="[^"+at+Ht+Un+sn+Rt+Ut+"]",ys="\\ud83c[\\udffb-\\udfff]",Is="[^"+at+"]",Ui="(?:\\ud83c[\\udde6-\\uddff]){2}",us="[\\ud800-\\udbff][\\udc00-\\udfff]",hs="["+Ut+"]",Le="\\u200d",mt="(?:"+oi+"|"+_i+")",Ct="(?:"+hs+"|"+_i+")",Ot="(?:['](?:d|ll|m|re|s|t|ve))?",yt="(?:['](?:D|LL|M|RE|S|T|VE))?",Qt="(?:"+Rn+"|"+ys+")?",Sn="["+_t+"]?",an=Sn+Qt+("(?:"+Le+"(?:"+[Is,Ui,us].join("|")+")"+Sn+Qt+")*"),Dn="(?:"+[qi,Ui,us].join("|")+")"+an,or="(?:"+[Is+Rn+"?",Rn,Ui,us,jt].join("|")+")",rr=RegExp(_n,"g"),zn=RegExp(Rn,"g"),dr=RegExp(ys+"(?="+ys+")|"+or+an,"g"),Ur=RegExp([hs+"?"+oi+"+"+Ot+"(?="+[mn,hs,"$"].join("|")+")",Ct+"+"+yt+"(?="+[mn,hs+mt,"$"].join("|")+")",hs+"?"+mt+"+"+Ot,hs+"+"+yt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Un,Dn].join("|"),"g"),rs=RegExp("["+Le+at+Yt+_t+"]"),Rr=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Dr=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Qn=-1,pr={};pr[Te]=pr[Ie]=pr[be]=pr[Pe]=pr[$e]=pr[tt]=pr[qe]=pr[ut]=pr[te]=!0,pr[P]=pr[B]=pr[ie]=pr[U]=pr[ae]=pr[z]=pr[I]=pr[L]=pr[F]=pr[Z]=pr[$]=pr[Q]=pr[q]=pr[V]=pr[ne]=!1;var On={};On[P]=On[B]=On[ie]=On[ae]=On[U]=On[z]=On[Te]=On[Ie]=On[be]=On[Pe]=On[$e]=On[F]=On[Z]=On[$]=On[Q]=On[q]=On[V]=On[K]=On[tt]=On[qe]=On[ut]=On[te]=!0,On[I]=On[L]=On[ne]=!1;var Fs={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},So=parseFloat,js=parseInt,Qo=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g,Ci=typeof self=="object"&&self&&self.Object===Object&&self,xn=Qo||Ci||Function("return this")(),bs=a&&!a.nodeType&&a,$n=bs&&o&&!o.nodeType&&o,fs=$n&&$n.exports===bs,ac=fs&&Qo.process,is=(function(){try{var Nt=$n&&$n.require&&$n.require("util").types;return Nt||ac&&ac.binding&&ac.binding("util")}catch{}})(),cc=is&&is.isArrayBuffer,Dd=is&&is.isDate,x_=is&&is.isMap,w0=is&&is.isRegExp,T_=is&&is.isSet,A0=is&&is.isTypedArray;function wa(Nt,Kt,Zt){switch(Zt.length){case 0:return Nt.call(Kt);case 1:return Nt.call(Kt,Zt[0]);case 2:return Nt.call(Kt,Zt[0],Zt[1]);case 3:return Nt.call(Kt,Zt[0],Zt[1],Zt[2])}return Nt.apply(Kt,Zt)}function uy(Nt,Kt,Zt,In){for(var wr=-1,Br=Nt==null?0:Nt.length;++wr<Br;){var Hs=Nt[wr];Kt(In,Hs,Zt(Hs),Nt)}return In}function Bc(Nt,Kt){for(var Zt=-1,In=Nt==null?0:Nt.length;++Zt<In&&Kt(Nt[Zt],Zt,Nt)!==!1;);return Nt}function hy(Nt,Kt){for(var Zt=Nt==null?0:Nt.length;Zt--&&Kt(Nt[Zt],Zt,Nt)!==!1;);return Nt}function w_(Nt,Kt){for(var Zt=-1,In=Nt==null?0:Nt.length;++Zt<In;)if(!Kt(Nt[Zt],Zt,Nt))return!1;return!0}function Ul(Nt,Kt){for(var Zt=-1,In=Nt==null?0:Nt.length,wr=0,Br=[];++Zt<In;){var Hs=Nt[Zt];Kt(Hs,Zt,Nt)&&(Br[wr++]=Hs)}return Br}function Dp(Nt,Kt){return!!(Nt!=null&&Nt.length)&&fl(Nt,Kt,0)>-1}function R0(Nt,Kt,Zt){for(var In=-1,wr=Nt==null?0:Nt.length;++In<wr;)if(Zt(Kt,Nt[In]))return!0;return!1}function ds(Nt,Kt){for(var Zt=-1,In=Nt==null?0:Nt.length,wr=Array(In);++Zt<In;)wr[Zt]=Kt(Nt[Zt],Zt,Nt);return wr}function lc(Nt,Kt){for(var Zt=-1,In=Kt.length,wr=Nt.length;++Zt<In;)Nt[wr+Zt]=Kt[Zt];return Nt}function Lf(Nt,Kt,Zt,In){var wr=-1,Br=Nt==null?0:Nt.length;for(In&&Br&&(Zt=Nt[++wr]);++wr<Br;)Zt=Kt(Zt,Nt[wr],wr,Nt);return Zt}function uc(Nt,Kt,Zt,In){var wr=Nt==null?0:Nt.length;for(In&&wr&&(Zt=Nt[--wr]);wr--;)Zt=Kt(Zt,Nt[wr],wr,Nt);return Zt}function Bl(Nt,Kt){for(var Zt=-1,In=Nt==null?0:Nt.length;++Zt<In;)if(Kt(Nt[Zt],Zt,Nt))return!0;return!1}var fy=C0("length");function Yu(Nt,Kt,Zt){var In;return Zt(Nt,(function(wr,Br,Hs){if(Kt(wr,Br,Hs))return In=Br,!1})),In}function Ku(Nt,Kt,Zt,In){for(var wr=Nt.length,Br=Zt+(In?1:-1);In?Br--:++Br<wr;)if(Kt(Nt[Br],Br,Nt))return Br;return-1}function fl(Nt,Kt,Zt){return Kt==Kt?(function(In,wr,Br){for(var Hs=Br-1,yu=In.length;++Hs<yu;)if(In[Hs]===wr)return Hs;return-1})(Nt,Kt,Zt):Ku(Nt,A_,Zt)}function Zn(Nt,Kt,Zt,In){for(var wr=Zt-1,Br=Nt.length;++wr<Br;)if(In(Nt[wr],Kt))return wr;return-1}function A_(Nt){return Nt!=Nt}function R_(Nt,Kt){var Zt=Nt==null?0:Nt.length;return Zt?Xu(Nt,Kt)/Zt:T}function C0(Nt){return function(Kt){return Kt==null?u:Kt[Nt]}}function Yh(Nt){return function(Kt){return Nt==null?u:Nt[Kt]}}function C_(Nt,Kt,Zt,In,wr){return wr(Nt,(function(Br,Hs,yu){Zt=In?(In=!1,Br):Kt(Zt,Br,Hs,yu)})),Zt}function Xu(Nt,Kt){for(var Zt,In=-1,wr=Nt.length;++In<wr;){var Br=Kt(Nt[In]);Br!==u&&(Zt=Zt===u?Br:Zt+Br)}return Zt}function ea(Nt,Kt){for(var Zt=-1,In=Array(Nt);++Zt<Nt;)In[Zt]=Kt(Zt);return In}function M_(Nt){return Nt&&Nt.slice(0,pn(Nt)+1).replace(Re,"")}function hc(Nt){return function(Kt){return Nt(Kt)}}function k_(Nt,Kt){return ds(Kt,(function(Zt){return Nt[Zt]}))}function Kh(Nt,Kt){return Nt.has(Kt)}function Eo(Nt,Kt){for(var Zt=-1,In=Nt.length;++Zt<In&&fl(Kt,Nt[Zt],0)>-1;);return Zt}function ta(Nt,Kt){for(var Zt=Nt.length;Zt--&&fl(Kt,Nt[Zt],0)>-1;);return Zt}var O_=Yh({:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"}),vu=Yh({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Ss(Nt){return"\\"+Fs[Nt]}function na(Nt){return rs.test(Nt)}function I_(Nt){var Kt=-1,Zt=Array(Nt.size);return Nt.forEach((function(In,wr){Zt[++Kt]=[wr,In]})),Zt}function Lp(Nt,Kt){return function(Zt){return Nt(Kt(Zt))}}function Fl(Nt,Kt){for(var Zt=-1,In=Nt.length,wr=0,Br=[];++Zt<In;){var Hs=Nt[Zt];Hs!==Kt&&Hs!==d||(Nt[Zt]=d,Br[wr++]=Zt)}return Br}function Ga(Nt){var Kt=-1,Zt=Array(Nt.size);return Nt.forEach((function(In){Zt[++Kt]=In})),Zt}function zs(Nt){var Kt=-1,Zt=Array(Nt.size);return Nt.forEach((function(In){Zt[++Kt]=[In,In]})),Zt}function Zu(Nt){return na(Nt)?(function(Kt){for(var Zt=dr.lastIndex=0;dr.test(Kt);)++Zt;return Zt})(Nt):fy(Nt)}function ra(Nt){return na(Nt)?(function(Kt){return Kt.match(dr)||[]})(Nt):(function(Kt){return Kt.split("")})(Nt)}function pn(Nt){for(var Kt=Nt.length;Kt--&&ce.test(Nt.charAt(Kt)););return Kt}var eS=Yh({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),Up=(function Nt(Kt){var Zt,In=(Kt=Kt==null?xn:Up.defaults(xn.Object(),Kt,Up.pick(xn,Dr))).Array,wr=Kt.Date,Br=Kt.Error,Hs=Kt.Function,yu=Kt.Math,Yi=Kt.Object,Ju=Kt.RegExp,Xh=Kt.String,Fc=Kt.TypeError,Bp=In.prototype,M0=Hs.prototype,Zh=Yi.prototype,Qu=Kt["__core-js_shared__"],Uo=M0.toString,Ti=Zh.hasOwnProperty,dy=0,N_=(Zt=/[^.]+$/.exec(Qu&&Qu.keys&&Qu.keys.IE_PROTO||""))?"Symbol(src)_1."+Zt:"",Uf=Zh.toString,py=Uo.call(Yi),jc=xn._,k0=Ju("^"+Uo.call(Ti).replace(vt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Vs=fs?Kt.Buffer:u,Es=Kt.Symbol,Fp=Kt.Uint8Array,Vi=Vs?Vs.allocUnsafe:u,O0=Lp(Yi.getPrototypeOf,Yi),jp=Yi.create,zp=Zh.propertyIsEnumerable,Ld=Bp.splice,I0=Es?Es.isConcatSpreadable:u,Jh=Es?Es.iterator:u,Ii=Es?Es.toStringTag:u,eh=(function(){try{var w=Hr(Yi,"defineProperty");return w({},"",{}),w}catch{}})(),tS=Kt.clearTimeout!==xn.clearTimeout&&Kt.clearTimeout,my=wr&&wr.now!==xn.Date.now&&wr.now,N0=Kt.setTimeout!==xn.setTimeout&&Kt.setTimeout,bu=yu.ceil,P0=yu.floor,Hp=Yi.getOwnPropertySymbols,Bf=Vs?Vs.isBuffer:u,Aa=Kt.isFinite,P_=Bp.join,nS=Lp(Yi.keys,Yi),xo=yu.max,To=yu.min,D_=wr.now,L_=Kt.parseInt,D0=yu.random,vn=Bp.reverse,ln=Hr(Kt,"DataView"),fn=Hr(Kt,"Map"),$a=Hr(Kt,"Promise"),zr=Hr(Kt,"Set"),Yr=Hr(Kt,"WeakMap"),Wa=Hr(Yi,"create"),th=Yr&&new Yr,wo={},L0=Kd(ln),Ra=Kd(fn),gy=Kd($a),jl=Kd(zr),Ud=Kd(Yr),dl=Es?Es.prototype:u,Qh=dl?dl.valueOf:u,U0=dl?dl.toString:u;function Ue(w){if(Ki(w)&&!cr(w)&&!(w instanceof Mr)){if(w instanceof ia)return w;if(Ti.call(w,"__wrapped__"))return Uy(w)}return new ia(w)}var Ff=(function(){function w(){}return function(D){if(!os(D))return{};if(jp)return jp(D);w.prototype=D;var J=new w;return w.prototype=u,J}})();function zl(){}function ia(w,D){this.__wrapped__=w,this.__actions__=[],this.__chain__=!!D,this.__index__=0,this.__values__=u}function Mr(w){this.__wrapped__=w,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=k,this.__views__=[]}function ef(w){var D=-1,J=w==null?0:w.length;for(this.clear();++D<J;){var ge=w[D];this.set(ge[0],ge[1])}}function nh(w){var D=-1,J=w==null?0:w.length;for(this.clear();++D<J;){var ge=w[D];this.set(ge[0],ge[1])}}function pl(w){var D=-1,J=w==null?0:w.length;for(this.clear();++D<J;){var ge=w[D];this.set(ge[0],ge[1])}}function jf(w){var D=-1,J=w==null?0:w.length;for(this.__data__=new pl;++D<J;)this.add(w[D])}function fc(w){var D=this.__data__=new nh(w);this.size=D.size}function _y(w,D){var J=cr(w),ge=!J&&Gl(w),ke=!J&&!ge&&Jf(w),Ge=!J&&!ge&&!ke&&ua(w),st=J||ge||ke||Ge,dt=st?ea(w.length,Xh):[],xt=dt.length;for(var Gt in w)!D&&!Ti.call(w,Gt)||st&&(Gt=="length"||ke&&(Gt=="offset"||Gt=="parent")||Ge&&(Gt=="buffer"||Gt=="byteLength"||Gt=="byteOffset")||Ao(Gt,xt))||dt.push(Gt);return dt}function U_(w){var D=w.length;return D?w[H_(0,D-1)]:u}function vy(w,D){return Q0(mc(w),tf(D,0,w.length))}function Bo(w){return Q0(mc(w))}function B0(w,D,J){(J!==u&&!_c(w[D],J)||J===u&&!(D in w))&&ml(w,D,J)}function zf(w,D,J){var ge=w[D];Ti.call(w,D)&&_c(ge,J)&&(J!==u||D in w)||ml(w,D,J)}function qa(w,D){for(var J=w.length;J--;)if(_c(w[J][0],D))return J;return-1}function F0(w,D,J,ge){return gl(w,(function(ke,Ge,st){D(ge,ke,J(ke),st)})),ge}function Ya(w,D){return w&&vl(D,xs(D),w)}function ml(w,D,J){D=="__proto__"&&eh?eh(w,D,{configurable:!0,enumerable:!0,value:J,writable:!0}):w[D]=J}function j0(w,D){for(var J=-1,ge=D.length,ke=In(ge),Ge=w==null;++J<ge;)ke[J]=Ge?u:am(w,D[J]);return ke}function tf(w,D,J){return w==w&&(J!==u&&(w=w<=J?w:J),D!==u&&(w=w>=D?w:D)),w}function zc(w,D,J,ge,ke,Ge){var st,dt=1&D,xt=2&D,Gt=4&D;if(J&&(st=ke?J(w,ge,ke,Ge):J(w)),st!==u)return st;if(!os(w))return w;var Wt=cr(w);if(Wt){if(st=(function(Vt){var tn=Vt.length,nr=new Vt.constructor(tn);return tn&&typeof Vt[0]=="string"&&Ti.call(Vt,"index")&&(nr.index=Vt.index,nr.input=Vt.input),nr})(w),!dt)return mc(w,st)}else{var un=Ca(w),Vn=un==L||un==M;if(Jf(w))return yr(w,dt);if(un==$||un==P||Vn&&!ke){if(st=xt||Vn?{}:Py(w),!dt)return xt?(function(Vt,tn){return vl(Vt,Eu(Vt),tn)})(w,(function(Vt,tn){return Vt&&vl(tn,Ws(tn),Vt)})(st,w)):(function(Vt,tn){return vl(Vt,X_(Vt),tn)})(w,Ya(st,w))}else{if(!On[un])return ke?w:{};st=(function(Vt,tn,nr){var Jt=Vt.constructor;switch(tn){case ie:return Vd(Vt);case U:case z:return new Jt(+Vt);case ae:return(function(Tn,Gn){var bn=Gn?Vd(Tn.buffer):Tn.buffer;return new Tn.constructor(bn,Tn.byteOffset,Tn.byteLength)})(Vt,nr);case Te:case Ie:case be:case Pe:case $e:case tt:case qe:case ut:case te:return Ay(Vt,nr);case F:return new Jt;case Z:case V:return new Jt(Vt);case Q:return(function(Tn){var Gn=new Tn.constructor(Tn.source,Me.exec(Tn));return Gn.lastIndex=Tn.lastIndex,Gn})(Vt);case q:return new Jt;case K:return Cn=Vt,Qh?Yi(Qh.call(Cn)):{}}var Cn})(w,un,dt)}}Ge||(Ge=new fc);var qn=Ge.get(w);if(qn)return qn;Ge.set(w,st),Za(w)?w.forEach((function(Vt){st.add(zc(Vt,D,J,Vt,w,Ge))})):Zd(w)&&w.forEach((function(Vt,tn){st.set(tn,zc(Vt,D,J,tn,w,Ge))}));var sr=Wt?u:(Gt?xt?Y_:Xf:xt?Ws:xs)(w);return Bc(sr||w,(function(Vt,tn){sr&&(Vt=w[tn=Vt]),zf(st,tn,zc(Vt,D,J,tn,w,Ge))})),st}function Gs(w,D,J){var ge=J.length;if(w==null)return!ge;for(w=Yi(w);ge--;){var ke=J[ge],Ge=D[ke],st=w[ke];if(st===u&&!(ke in w)||!Ge(st))return!1}return!0}function Hf(w,D,J){if(typeof w!="function")throw new Fc(h);return X0((function(){w.apply(u,J)}),D)}function Vf(w,D,J,ge){var ke=-1,Ge=Dp,st=!0,dt=w.length,xt=[],Gt=D.length;if(!dt)return xt;J&&(D=ds(D,hc(J))),ge?(Ge=R0,st=!1):D.length>=200&&(Ge=Kh,st=!1,D=new jf(D));e:for(;++ke<dt;){var Wt=w[ke],un=J==null?Wt:J(Wt);if(Wt=ge||Wt!==0?Wt:0,st&&un==un){for(var Vn=Gt;Vn--;)if(D[Vn]===un)continue e;xt.push(Wt)}else Ge(D,un,ge)||xt.push(Wt)}return xt}Ue.templateSettings={escape:pe,evaluate:ze,interpolate:Ze,variable:"",imports:{_:Ue}},Ue.prototype=zl.prototype,Ue.prototype.constructor=Ue,ia.prototype=Ff(zl.prototype),ia.prototype.constructor=ia,Mr.prototype=Ff(zl.prototype),Mr.prototype.constructor=Mr,ef.prototype.clear=function(){this.__data__=Wa?Wa(null):{},this.size=0},ef.prototype.delete=function(w){var D=this.has(w)&&delete this.__data__[w];return this.size-=D?1:0,D},ef.prototype.get=function(w){var D=this.__data__;if(Wa){var J=D[w];return J===f?u:J}return Ti.call(D,w)?D[w]:u},ef.prototype.has=function(w){var D=this.__data__;return Wa?D[w]!==u:Ti.call(D,w)},ef.prototype.set=function(w,D){var J=this.__data__;return this.size+=this.has(w)?0:1,J[w]=Wa&&D===u?f:D,this},nh.prototype.clear=function(){this.__data__=[],this.size=0},nh.prototype.delete=function(w){var D=this.__data__,J=qa(D,w);return!(J<0)&&(J==D.length-1?D.pop():Ld.call(D,J,1),--this.size,!0)},nh.prototype.get=function(w){var D=this.__data__,J=qa(D,w);return J<0?u:D[J][1]},nh.prototype.has=function(w){return qa(this.__data__,w)>-1},nh.prototype.set=function(w,D){var J=this.__data__,ge=qa(J,w);return ge<0?(++this.size,J.push([w,D])):J[ge][1]=D,this},pl.prototype.clear=function(){this.size=0,this.__data__={hash:new ef,map:new(fn||nh),string:new ef}},pl.prototype.delete=function(w){var D=K_(this,w).delete(w);return this.size-=D?1:0,D},pl.prototype.get=function(w){return K_(this,w).get(w)},pl.prototype.has=function(w){return K_(this,w).has(w)},pl.prototype.set=function(w,D){var J=K_(this,w),ge=J.size;return J.set(w,D),this.size+=J.size==ge?0:1,this},jf.prototype.add=jf.prototype.push=function(w){return this.__data__.set(w,f),this},jf.prototype.has=function(w){return this.__data__.has(w)},fc.prototype.clear=function(){this.__data__=new nh,this.size=0},fc.prototype.delete=function(w){var D=this.__data__,J=D.delete(w);return this.size=D.size,J},fc.prototype.get=function(w){return this.__data__.get(w)},fc.prototype.has=function(w){return this.__data__.has(w)},fc.prototype.set=function(w,D){var J=this.__data__;if(J instanceof nh){var ge=J.__data__;if(!fn||ge.length<199)return ge.push([w,D]),this.size=++J.size,this;J=this.__data__=new pl(ge)}return J.set(w,D),this.size=J.size,this};var gl=$_(Ns),B_=$_(H0,!0);function F_(w,D){var J=!0;return gl(w,(function(ge,ke,Ge){return J=!!D(ge,ke,Ge)})),J}function Bd(w,D,J){for(var ge=-1,ke=w.length;++ge<ke;){var Ge=w[ge],st=D(Ge);if(st!=null&&(dt===u?st==st&&!ao(st):J(st,dt)))var dt=st,xt=Ge}return xt}function vr(w,D){var J=[];return gl(w,(function(ge,ke,Ge){D(ge,ke,Ge)&&J.push(ge)})),J}function Fo(w,D,J,ge,ke){var Ge=-1,st=w.length;for(J||(J=cS),ke||(ke=[]);++Ge<st;){var dt=w[Ge];D>0&&J(dt)?D>1?Fo(dt,D-1,J,ge,ke):lc(ke,dt):ge||(ke[ke.length]=dt)}return ke}var z0=Cy(),rS=Cy(!0);function Ns(w,D){return w&&z0(w,D,xs)}function H0(w,D){return w&&rS(w,D,xs)}function Vp(w,D){return Ul(D,(function(J){return vc(w[J])}))}function Gf(w,D){for(var J=0,ge=(D=nf(D,w)).length;w!=null&&J<ge;)w=w[xu(D[J++])];return J&&J==ge?w:u}function Fd(w,D,J){var ge=D(w);return cr(w)?ge:lc(ge,J(w))}function sa(w){return w==null?w===u?"[object Undefined]":"[object Null]":Ii&&Ii in Yi(w)?(function(D){var J=Ti.call(D,Ii),ge=D[Ii];try{D[Ii]=u;var ke=!0}catch{}var Ge=Uf.call(D);return ke&&(J?D[Ii]=ge:delete D[Ii]),Ge})(w):(function(D){return Uf.call(D)})(w)}function Gp(w,D){return w>D}function $p(w,D){return w!=null&&Ti.call(w,D)}function hT(w,D){return w!=null&&D in Yi(w)}function j_(w,D,J){for(var ge=J?R0:Dp,ke=w[0].length,Ge=w.length,st=Ge,dt=In(Ge),xt=1/0,Gt=[];st--;){var Wt=w[st];st&&D&&(Wt=ds(Wt,hc(D))),xt=To(Wt.length,xt),dt[st]=!J&&(D||ke>=120&&Wt.length>=120)?new jf(st&&Wt):u}Wt=w[0];var un=-1,Vn=dt[0];e:for(;++un<ke&&Gt.length<xt;){var qn=Wt[un],sr=D?D(qn):qn;if(qn=J||qn!==0?qn:0,!(Vn?Kh(Vn,sr):ge(Gt,sr,J))){for(st=Ge;--st;){var Vt=dt[st];if(!(Vt?Kh(Vt,sr):ge(w[st],sr,J)))continue e}Vn&&Vn.push(sr),Gt.push(qn)}}return Gt}function Hc(w,D,J){var ge=(w=lh(w,D=nf(D,w)))==null?w:w[xu(oo(D))];return ge==null?u:wa(ge,w,J)}function yy(w){return Ki(w)&&sa(w)==P}function Si(w,D,J,ge,ke){return w===D||(w==null||D==null||!Ki(w)&&!Ki(D)?w!=w&&D!=D:(function(Ge,st,dt,xt,Gt,Wt){var un=cr(Ge),Vn=cr(st),qn=un?B:Ca(Ge),sr=Vn?B:Ca(st),Vt=(qn=qn==P?$:qn)==$,tn=(sr=sr==P?$:sr)==$,nr=qn==sr;if(nr&&Jf(Ge)){if(!Jf(st))return!1;un=!0,Vt=!1}if(nr&&!Vt)return Wt||(Wt=new fc),un||ua(Ge)?Iy(Ge,st,dt,xt,Gt,Wt):(function(bn,wn,Vr,Zi,fa,Ei,ti){switch(Vr){case ae:if(bn.byteLength!=wn.byteLength||bn.byteOffset!=wn.byteOffset)return!1;bn=bn.buffer,wn=wn.buffer;case ie:return!(bn.byteLength!=wn.byteLength||!Ei(new Fp(bn),new Fp(wn)));case U:case z:case Z:return _c(+bn,+wn);case I:return bn.name==wn.name&&bn.message==wn.message;case Q:case V:return bn==wn+"";case F:var da=I_;case q:var qc=1&Zi;if(da||(da=Ga),bn.size!=wn.size&&!qc)return!1;var Jd=ti.get(bn);if(Jd)return Jd==wn;Zi|=2,ti.set(bn,wn);var Ja=Iy(da(bn),da(wn),Zi,fa,Ei,ti);return ti.delete(bn),Ja;case K:if(Qh)return Qh.call(bn)==Qh.call(wn)}return!1})(Ge,st,qn,dt,xt,Gt,Wt);if(!(1&dt)){var Jt=Vt&&Ti.call(Ge,"__wrapped__"),Cn=tn&&Ti.call(st,"__wrapped__");if(Jt||Cn){var Tn=Jt?Ge.value():Ge,Gn=Cn?st.value():st;return Wt||(Wt=new fc),Gt(Tn,Gn,dt,xt,Wt)}}return nr?(Wt||(Wt=new fc),(function(bn,wn,Vr,Zi,fa,Ei){var ti=1&Vr,da=Xf(bn),qc=da.length,Jd=Xf(wn),Ja=Jd.length;if(qc!=Ja&&!ti)return!1;for(var mh=qc;mh--;){var Yc=da[mh];if(!(ti?Yc in wn:Ti.call(wn,Yc)))return!1}var Tl=Ei.get(bn),sv=Ei.get(wn);if(Tl&&sv)return Tl==wn&&sv==bn;var hm=!0;Ei.set(bn,wn),Ei.set(wn,bn);for(var lo=ti;++mh<qc;){var hf=bn[Yc=da[mh]],pa=wn[Yc];if(Zi)var _g=ti?Zi(pa,hf,Yc,wn,bn,Ei):Zi(hf,pa,Yc,bn,wn,Ei);if(!(_g===u?hf===pa||fa(hf,pa,Vr,Zi,Ei):_g)){hm=!1;break}lo||(lo=Yc=="constructor")}if(hm&&!lo){var gh=bn.constructor,ff=wn.constructor;gh==ff||!("constructor"in bn)||!("constructor"in wn)||typeof gh=="function"&&gh instanceof gh&&typeof ff=="function"&&ff instanceof ff||(hm=!1)}return Ei.delete(bn),Ei.delete(wn),hm})(Ge,st,dt,xt,Gt,Wt)):!1})(w,D,J,ge,Si,ke))}function rh(w,D,J,ge){var ke=J.length,Ge=ke,st=!ge;if(w==null)return!Ge;for(w=Yi(w);ke--;){var dt=J[ke];if(st&&dt[2]?dt[1]!==w[dt[0]]:!(dt[0]in w))return!1}for(;++ke<Ge;){var xt=(dt=J[ke])[0],Gt=w[xt],Wt=dt[1];if(st&&dt[2]){if(Gt===u&&!(xt in w))return!1}else{var un=new fc;if(ge)var Vn=ge(Gt,Wt,xt,w,D,un);if(!(Vn===u?Si(Wt,Gt,3,ge,un):Vn))return!1}}return!0}function by(w){return!(!os(w)||(D=w,N_&&N_ in D))&&(vc(w)?k0:We).test(Kd(w));var D}function Sy(w){return typeof w=="function"?w:w==null?Ni:typeof w=="object"?cr(w)?ih(w[0],w[1]):z_(w):n1(w)}function Ey(w){if(!K0(w))return nS(w);var D=[];for(var J in Yi(w))Ti.call(w,J)&&J!="constructor"&&D.push(J);return D}function iS(w){if(!os(w))return(function(ke){var Ge=[];if(ke!=null)for(var st in Yi(ke))Ge.push(st);return Ge})(w);var D=K0(w),J=[];for(var ge in w)(ge!="constructor"||!D&&Ti.call(w,ge))&&J.push(ge);return J}function xy(w,D){return w<D}function Wp(w,D){var J=-1,ge=$c(w)?In(w.length):[];return gl(w,(function(ke,Ge,st){ge[++J]=D(ke,Ge,st)})),ge}function z_(w){var D=ah(w);return D.length==1&&D[0][2]?ch(D[0][0],D[0][1]):function(J){return J===w||rh(J,w,D)}}function ih(w,D){return Jp(w)&&Zf(D)?ch(xu(w),D):function(J){var ge=am(J,w);return ge===u&&ge===D?lg(J,w):Si(D,ge,3)}}function jd(w,D,J,ge,ke){w!==D&&z0(D,(function(Ge,st){if(ke||(ke=new fc),os(Ge))(function(xt,Gt,Wt,un,Vn,qn,sr){var Vt=qd(xt,Wt),tn=qd(Gt,Wt),nr=sr.get(tn);if(nr)return void B0(xt,Wt,nr);var Jt=qn?qn(Vt,tn,Wt+"",xt,Gt,sr):u,Cn=Jt===u;if(Cn){var Tn=cr(tn),Gn=!Tn&&Jf(tn),bn=!Tn&&!Gn&&ua(tn);Jt=tn,Tn||Gn||bn?cr(Vt)?Jt=Vt:Ps(Vt)?Jt=mc(Vt):Gn?(Cn=!1,Jt=yr(tn,!0)):bn?(Cn=!1,Jt=Ay(tn,!0)):Jt=[]:sf(tn)||Gl(tn)?(Jt=Vt,Gl(Vt)?Jt=Wl(Vt):os(Vt)&&!vc(Vt)||(Jt=Py(tn))):Cn=!1}Cn&&(sr.set(tn,Jt),Vn(Jt,tn,un,qn,sr),sr.delete(tn)),B0(xt,Wt,Jt)})(w,D,st,J,jd,ge,ke);else{var dt=ge?ge(qd(w,st),Ge,st+"",w,D,ke):u;dt===u&&(dt=Ge),B0(w,st,dt)}}),Ws)}function qp(w,D){var J=w.length;if(J)return Ao(D+=D<0?J:0,J)?w[D]:u}function Su(w,D,J){D=D.length?ds(D,(function(Ge){return cr(Ge)?function(st){return Gf(st,Ge.length===1?Ge[0]:Ge)}:Ge})):[Ni];var ge=-1;D=ds(D,hc(lr()));var ke=Wp(w,(function(Ge,st,dt){var xt=ds(D,(function(Gt){return Gt(Ge)}));return{criteria:xt,index:++ge,value:Ge}}));return(function(Ge,st){var dt=Ge.length;for(Ge.sort(st);dt--;)Ge[dt]=Ge[dt].value;return Ge})(ke,(function(Ge,st){return(function(dt,xt,Gt){for(var Wt=-1,un=dt.criteria,Vn=xt.criteria,qn=un.length,sr=Gt.length;++Wt<qn;){var Vt=Wf(un[Wt],Vn[Wt]);if(Vt)return Wt>=sr?Vt:Vt*(Gt[Wt]=="desc"?-1:1)}return dt.index-xt.index})(Ge,st,J)}))}function Ty(w,D,J){for(var ge=-1,ke=D.length,Ge={};++ge<ke;){var st=D[ge],dt=Gf(w,st);J(dt,st)&&Yp(Ge,nf(st,w),dt)}return Ge}function zd(w,D,J,ge){var ke=ge?Zn:fl,Ge=-1,st=D.length,dt=w;for(w===D&&(D=mc(D)),J&&(dt=ds(w,hc(J)));++Ge<st;)for(var xt=0,Gt=D[Ge],Wt=J?J(Gt):Gt;(xt=ke(dt,Wt,xt,ge))>-1;)dt!==w&&Ld.call(dt,xt,1),Ld.call(w,xt,1);return w}function V0(w,D){for(var J=w?D.length:0,ge=J-1;J--;){var ke=D[J];if(J==ge||ke!==Ge){var Ge=ke;Ao(ke)?Ld.call(w,ke,1):wy(w,ke)}}return w}function H_(w,D){return w+P0(D0()*(D-w+1))}function yn(w,D){var J="";if(!w||D<1||D>x)return J;do D%2&&(J+=w),(D=P0(D/2))&&(w+=w);while(D);return J}function Kr(w,D){return Z0(Qp(w,D,Ni),w+"")}function sS(w){return U_(ql(w))}function oS(w,D){var J=ql(w);return Q0(J,tf(D,0,J.length))}function Yp(w,D,J,ge){if(!os(w))return w;for(var ke=-1,Ge=(D=nf(D,w)).length,st=Ge-1,dt=w;dt!=null&&++ke<Ge;){var xt=xu(D[ke]),Gt=J;if(xt==="__proto__"||xt==="constructor"||xt==="prototype")return w;if(ke!=st){var Wt=dt[xt];(Gt=ge?ge(Wt,xt,dt):u)===u&&(Gt=os(Wt)?Wt:Ao(D[ke+1])?[]:{})}zf(dt,xt,Gt),dt=dt[xt]}return w}var G0=th?function(w,D){return th.set(w,D),w}:Ni,ai=eh?function(w,D){return eh(w,"toString",{configurable:!0,enumerable:!1,value:td(D),writable:!0})}:Ni;function Hd(w){return Q0(ql(w))}function ps(w,D,J){var ge=-1,ke=w.length;D<0&&(D=-D>ke?0:ke+D),(J=J>ke?ke:J)<0&&(J+=ke),ke=D>J?0:J-D>>>0,D>>>=0;for(var Ge=In(ke);++ge<ke;)Ge[ge]=w[ge+D];return Ge}function oa(w,D){var J;return gl(w,(function(ge,ke,Ge){return!(J=D(ge,ke,Ge))})),!!J}function $0(w,D,J){var ge=0,ke=w==null?ge:w.length;if(typeof D=="number"&&D==D&&ke<=2147483647){for(;ge<ke;){var Ge=ge+ke>>>1,st=w[Ge];st!==null&&!ao(st)&&(J?st<=D:st<D)?ge=Ge+1:ke=Ge}return ke}return dc(w,D,Ni,J)}function dc(w,D,J,ge){var ke=0,Ge=w==null?0:w.length;if(Ge===0)return 0;for(var st=(D=J(D))!=D,dt=D===null,xt=ao(D),Gt=D===u;ke<Ge;){var Wt=P0((ke+Ge)/2),un=J(w[Wt]),Vn=un!==u,qn=un===null,sr=un==un,Vt=ao(un);if(st)var tn=ge||sr;else tn=Gt?sr&&(ge||Vn):dt?sr&&Vn&&(ge||!qn):xt?sr&&Vn&&!qn&&(ge||!Vt):!qn&&!Vt&&(ge?un<=D:un<D);tn?ke=Wt+1:Ge=Wt}return To(Ge,4294967294)}function $f(w,D){for(var J=-1,ge=w.length,ke=0,Ge=[];++J<ge;){var st=w[J],dt=D?D(st):st;if(!J||!_c(dt,xt)){var xt=dt;Ge[ke++]=st===0?0:st}}return Ge}function hr(w){return typeof w=="number"?w:ao(w)?T:+w}function aa(w){if(typeof w=="string")return w;if(cr(w))return ds(w,aa)+"";if(ao(w))return U0?U0.call(w):"";var D=w+"";return D=="0"&&1/w==-1/0?"-0":D}function _l(w,D,J){var ge=-1,ke=Dp,Ge=w.length,st=!0,dt=[],xt=dt;if(J)st=!1,ke=R0;else if(Ge>=200){var Gt=D?null:aS(w);if(Gt)return Ga(Gt);st=!1,ke=Kh,xt=new jf}else xt=D?[]:dt;e:for(;++ge<Ge;){var Wt=w[ge],un=D?D(Wt):Wt;if(Wt=J||Wt!==0?Wt:0,st&&un==un){for(var Vn=xt.length;Vn--;)if(xt[Vn]===un)continue e;D&&xt.push(un),dt.push(Wt)}else ke(xt,un,J)||(xt!==dt&&xt.push(un),dt.push(Wt))}return dt}function wy(w,D){return(w=lh(w,D=nf(D,w)))==null||delete w[xu(oo(D))]}function W0(w,D,J,ge){return Yp(w,D,J(Gf(w,D)),ge)}function ms(w,D,J,ge){for(var ke=w.length,Ge=ge?ke:-1;(ge?Ge--:++Ge<ke)&&D(w[Ge],Ge,w););return J?ps(w,ge?0:Ge,ge?Ge+1:ke):ps(w,ge?Ge+1:0,ge?ke:Ge)}function sh(w,D){var J=w;return J instanceof Mr&&(J=J.value()),Lf(D,(function(ge,ke){return ke.func.apply(ke.thisArg,lc([ge],ke.args))}),J)}function Kp(w,D,J){var ge=w.length;if(ge<2)return ge?_l(w[0]):[];for(var ke=-1,Ge=In(ge);++ke<ge;)for(var st=w[ke],dt=-1;++dt<ge;)dt!=ke&&(Ge[ke]=Vf(Ge[ke]||st,w[dt],D,J));return _l(Fo(Ge,1),D,J)}function pc(w,D,J){for(var ge=-1,ke=w.length,Ge=D.length,st={};++ge<ke;){var dt=ge<Ge?D[ge]:u;J(st,w[ge],dt)}return st}function $t(w){return Ps(w)?w:[]}function $s(w){return typeof w=="function"?w:Ni}function nf(w,D){return cr(w)?w:Jp(w,D)?[w]:Ly(Xr(w))}var V_=Kr;function Hl(w,D,J){var ge=w.length;return J=J===u?ge:J,!D&&J>=ge?w:ps(w,D,J)}var G_=tS||function(w){return xn.clearTimeout(w)};function yr(w,D){if(D)return w.slice();var J=w.length,ge=Vi?Vi(J):new w.constructor(J);return w.copy(ge),ge}function Vd(w){var D=new w.constructor(w.byteLength);return new Fp(D).set(new Fp(w)),D}function Ay(w,D){var J=D?Vd(w.buffer):w.buffer;return new w.constructor(J,w.byteOffset,w.length)}function Wf(w,D){if(w!==D){var J=w!==u,ge=w===null,ke=w==w,Ge=ao(w),st=D!==u,dt=D===null,xt=D==D,Gt=ao(D);if(!dt&&!Gt&&!Ge&&w>D||Ge&&st&&xt&&!dt&&!Gt||ge&&st&&xt||!J&&xt||!ke)return 1;if(!ge&&!Ge&&!Gt&&w<D||Gt&&J&&ke&&!ge&&!Ge||dt&&J&&ke||!st&&ke||!xt)return-1}return 0}function Xp(w,D,J,ge){for(var ke=-1,Ge=w.length,st=J.length,dt=-1,xt=D.length,Gt=xo(Ge-st,0),Wt=In(xt+Gt),un=!ge;++dt<xt;)Wt[dt]=D[dt];for(;++ke<st;)(un||ke<Ge)&&(Wt[J[ke]]=w[ke]);for(;Gt--;)Wt[dt++]=w[ke++];return Wt}function Ry(w,D,J,ge){for(var ke=-1,Ge=w.length,st=-1,dt=J.length,xt=-1,Gt=D.length,Wt=xo(Ge-dt,0),un=In(Wt+Gt),Vn=!ge;++ke<Wt;)un[ke]=w[ke];for(var qn=ke;++xt<Gt;)un[qn+xt]=D[xt];for(;++st<dt;)(Vn||ke<Ge)&&(un[qn+J[st]]=w[ke++]);return un}function mc(w,D){var J=-1,ge=w.length;for(D||(D=In(ge));++J<ge;)D[J]=w[J];return D}function vl(w,D,J,ge){var ke=!J;J||(J={});for(var Ge=-1,st=D.length;++Ge<st;){var dt=D[Ge],xt=ge?ge(J[dt],w[dt],dt,J,w):u;xt===u&&(xt=w[dt]),ke?ml(J,dt,xt):zf(J,dt,xt)}return J}function oh(w,D){return function(J,ge){var ke=cr(J)?uy:F0,Ge=D?D():{};return ke(J,w,lr(ge,2),Ge)}}function qf(w){return Kr((function(D,J){var ge=-1,ke=J.length,Ge=ke>1?J[ke-1]:u,st=ke>2?J[2]:u;for(Ge=w.length>3&&typeof Ge=="function"?(ke--,Ge):u,st&&ca(J[0],J[1],st)&&(Ge=ke<3?u:Ge,ke=1),D=Yi(D);++ge<ke;){var dt=J[ge];dt&&w(D,dt,ge,Ge)}return D}))}function $_(w,D){return function(J,ge){if(J==null)return J;if(!$c(J))return w(J,ge);for(var ke=J.length,Ge=D?ke:-1,st=Yi(J);(D?Ge--:++Ge<ke)&&ge(st[Ge],Ge,st)!==!1;);return J}}function Cy(w){return function(D,J,ge){for(var ke=-1,Ge=Yi(D),st=ge(D),dt=st.length;dt--;){var xt=st[w?dt:++ke];if(J(Ge[xt],xt,Ge)===!1)break}return D}}function W_(w){return function(D){var J=na(D=Xr(D))?ra(D):u,ge=J?J[0]:D.charAt(0),ke=J?Hl(J,1).join(""):D.slice(1);return ge[w]()+ke}}function Gd(w){return function(D){return Lf(Bi(Qy(D).replace(rr,"")),w,"")}}function Yf(w){return function(){var D=arguments;switch(D.length){case 0:return new w;case 1:return new w(D[0]);case 2:return new w(D[0],D[1]);case 3:return new w(D[0],D[1],D[2]);case 4:return new w(D[0],D[1],D[2],D[3]);case 5:return new w(D[0],D[1],D[2],D[3],D[4]);case 6:return new w(D[0],D[1],D[2],D[3],D[4],D[5]);case 7:return new w(D[0],D[1],D[2],D[3],D[4],D[5],D[6])}var J=Ff(w.prototype),ge=w.apply(J,D);return os(ge)?ge:J}}function q_(w){return function(D,J,ge){var ke=Yi(D);if(!$c(D)){var Ge=lr(J,3);D=xs(D),J=function(dt){return Ge(ke[dt],dt,ke)}}var st=w(D,J,ge);return st>-1?ke[Ge?D[st]:st]:u}}function Zp(w){return bl((function(D){var J=D.length,ge=J,ke=ia.prototype.thru;for(w&&D.reverse();ge--;){var Ge=D[ge];if(typeof Ge!="function")throw new Fc(h);if(ke&&!st&&ss(Ge)=="wrapper")var st=new ia([],!0)}for(ge=st?ge:J;++ge<J;){var dt=ss(Ge=D[ge]),xt=dt=="wrapper"?Ny(Ge):u;st=xt&&Wd(xt[0])&&xt[1]==424&&!xt[4].length&&xt[9]==1?st[ss(xt[0])].apply(st,xt[3]):Ge.length==1&&Wd(Ge)?st[dt]():st.thru(Ge)}return function(){var Gt=arguments,Wt=Gt[0];if(st&&Gt.length==1&&cr(Wt))return st.plant(Wt).value();for(var un=0,Vn=J?D[un].apply(this,Gt):Wt;++un<J;)Vn=D[un].call(this,Vn);return Vn}}))}function Kf(w,D,J,ge,ke,Ge,st,dt,xt,Gt){var Wt=D&m,un=1&D,Vn=2&D,qn=24&D,sr=512&D,Vt=Vn?u:Yf(w);return function tn(){for(var nr=arguments.length,Jt=In(nr),Cn=nr;Cn--;)Jt[Cn]=arguments[Cn];if(qn)var Tn=Sl(tn),Gn=(function(Zi,fa){for(var Ei=Zi.length,ti=0;Ei--;)Zi[Ei]===fa&&++ti;return ti})(Jt,Tn);if(ge&&(Jt=Xp(Jt,ge,ke,qn)),Ge&&(Jt=Ry(Jt,Ge,st,qn)),nr-=Gn,qn&&nr<Gt){var bn=Fl(Jt,Tn);return Gc(w,D,Kf,tn.placeholder,J,Jt,bn,dt,xt,Gt-nr)}var wn=un?J:this,Vr=Vn?wn[w]:w;return nr=Jt.length,dt?Jt=(function(Zi,fa){for(var Ei=Zi.length,ti=To(fa.length,Ei),da=mc(Zi);ti--;){var qc=fa[ti];Zi[ti]=Ao(qc,Ei)?da[qc]:u}return Zi})(Jt,dt):sr&&nr>1&&Jt.reverse(),Wt&&xt<nr&&(Jt.length=xt),this&&this!==xn&&this instanceof tn&&(Vr=Vt||Yf(Vr)),Vr.apply(wn,Jt)}}function My(w,D){return function(J,ge){return(function(ke,Ge,st,dt){return Ns(ke,(function(xt,Gt,Wt){Ge(dt,st(xt),Gt,Wt)})),dt})(J,w,D(ge),{})}}function q0(w,D){return function(J,ge){var ke;if(J===u&&ge===u)return D;if(J!==u&&(ke=J),ge!==u){if(ke===u)return ge;typeof J=="string"||typeof ge=="string"?(J=aa(J),ge=aa(ge)):(J=hr(J),ge=hr(ge)),ke=w(J,ge)}return ke}}function yl(w){return bl((function(D){return D=ds(D,hc(lr())),Kr((function(J){var ge=this;return w(D,(function(ke){return wa(ke,ge,J)}))}))}))}function Vc(w,D){var J=(D=D===u?" ":aa(D)).length;if(J<2)return J?yn(D,w):D;var ge=yn(D,bu(w/Zu(D)));return na(D)?Hl(ra(ge),0,w).join(""):ge.slice(0,w)}function jo(w){return function(D,J,ge){return ge&&typeof ge!="number"&&ca(D,J,ge)&&(J=ge=u),D=$l(D),J===u?(J=D,D=0):J=$l(J),(function(ke,Ge,st,dt){for(var xt=-1,Gt=xo(bu((Ge-ke)/(st||1)),0),Wt=In(Gt);Gt--;)Wt[dt?Gt:++xt]=ke,ke+=st;return Wt})(D,J,ge=ge===u?D<J?1:-1:$l(ge),w)}}function Vl(w){return function(D,J){return typeof D=="string"&&typeof J=="string"||(D=Lr(D),J=Lr(J)),w(D,J)}}function Gc(w,D,J,ge,ke,Ge,st,dt,xt,Gt){var Wt=8&D;D|=Wt?_:g,4&(D&=~(Wt?g:_))||(D&=-4);var un=[w,D,ke,Wt?Ge:u,Wt?st:u,Wt?u:Ge,Wt?u:st,dt,xt,Gt],Vn=J.apply(u,un);return Wd(w)&&Yd(Vn,un),Vn.placeholder=ge,J0(Vn,w,D)}function Y0(w){var D=yu[w];return function(J,ge){if(J=Lr(J),(ge=ge==null?0:To(ir(ge),292))&&Aa(J)){var ke=(Xr(J)+"e").split("e");return+((ke=(Xr(D(ke[0]+"e"+(+ke[1]+ge)))+"e").split("e"))[0]+"e"+(+ke[1]-ge))}return D(J)}}var aS=zr&&1/Ga(new zr([,-0]))[1]==y?function(w){return new zr(w)}:xl;function Ka(w){return function(D){var J=Ca(D);return J==F?I_(D):J==q?zs(D):(function(ge,ke){return ds(ke,(function(Ge){return[Ge,ge[Ge]]}))})(D,w(D))}}function gc(w,D,J,ge,ke,Ge,st,dt){var xt=2&D;if(!xt&&typeof w!="function")throw new Fc(h);var Gt=ge?ge.length:0;if(Gt||(D&=-97,ge=ke=u),st=st===u?st:xo(ir(st),0),dt=dt===u?dt:ir(dt),Gt-=ke?ke.length:0,D&g){var Wt=ge,un=ke;ge=ke=u}var Vn=xt?u:Ny(w),qn=[w,D,J,ge,ke,Wt,un,Ge,st,dt];if(Vn&&(function(Vt,tn){var nr=Vt[1],Jt=tn[1],Cn=nr|Jt,Tn=Cn<131,Gn=Jt==m&&nr==8||Jt==m&&nr==b&&Vt[7].length<=tn[8]||Jt==384&&tn[7].length<=tn[8]&&nr==8;if(!Tn&&!Gn)return Vt;1&Jt&&(Vt[2]=tn[2],Cn|=1&nr?0:4);var bn=tn[3];if(bn){var wn=Vt[3];Vt[3]=wn?Xp(wn,bn,tn[4]):bn,Vt[4]=wn?Fl(Vt[3],d):tn[4]}(bn=tn[5])&&(wn=Vt[5],Vt[5]=wn?Ry(wn,bn,tn[6]):bn,Vt[6]=wn?Fl(Vt[5],d):tn[6]),(bn=tn[7])&&(Vt[7]=bn),Jt&m&&(Vt[8]=Vt[8]==null?tn[8]:To(Vt[8],tn[8])),Vt[9]==null&&(Vt[9]=tn[9]),Vt[0]=tn[0],Vt[1]=Cn})(qn,Vn),w=qn[0],D=qn[1],J=qn[2],ge=qn[3],ke=qn[4],!(dt=qn[9]=qn[9]===u?xt?0:w.length:xo(qn[9]-Gt,0))&&24&D&&(D&=-25),D&&D!=1)sr=D==8||D==p?(function(Vt,tn,nr){var Jt=Yf(Vt);return function Cn(){for(var Tn=arguments.length,Gn=In(Tn),bn=Tn,wn=Sl(Cn);bn--;)Gn[bn]=arguments[bn];var Vr=Tn<3&&Gn[0]!==wn&&Gn[Tn-1]!==wn?[]:Fl(Gn,wn);return(Tn-=Vr.length)<nr?Gc(Vt,tn,Kf,Cn.placeholder,u,Gn,Vr,u,u,nr-Tn):wa(this&&this!==xn&&this instanceof Cn?Jt:Vt,this,Gn)}})(w,D,dt):D!=_&&D!=33||ke.length?Kf.apply(u,qn):(function(Vt,tn,nr,Jt){var Cn=1&tn,Tn=Yf(Vt);return function Gn(){for(var bn=-1,wn=arguments.length,Vr=-1,Zi=Jt.length,fa=In(Zi+wn),Ei=this&&this!==xn&&this instanceof Gn?Tn:Vt;++Vr<Zi;)fa[Vr]=Jt[Vr];for(;wn--;)fa[Vr++]=arguments[++bn];return wa(Ei,Cn?nr:this,fa)}})(w,D,J,ge);else var sr=(function(Vt,tn,nr){var Jt=1&tn,Cn=Yf(Vt);return function Tn(){return(this&&this!==xn&&this instanceof Tn?Cn:Vt).apply(Jt?nr:this,arguments)}})(w,D,J);return J0((Vn?G0:Yd)(sr,qn),w,D)}function ky(w,D,J,ge){return w===u||_c(w,Zh[J])&&!Ti.call(ge,J)?D:w}function Oy(w,D,J,ge,ke,Ge){return os(w)&&os(D)&&(Ge.set(D,w),jd(w,D,u,Oy,Ge),Ge.delete(D)),w}function fT(w){return sf(w)?u:w}function Iy(w,D,J,ge,ke,Ge){var st=1&J,dt=w.length,xt=D.length;if(dt!=xt&&!(st&&xt>dt))return!1;var Gt=Ge.get(w),Wt=Ge.get(D);if(Gt&&Wt)return Gt==D&&Wt==w;var un=-1,Vn=!0,qn=2&J?new jf:u;for(Ge.set(w,D),Ge.set(D,w);++un<dt;){var sr=w[un],Vt=D[un];if(ge)var tn=st?ge(Vt,sr,un,D,w,Ge):ge(sr,Vt,un,w,D,Ge);if(tn!==u){if(tn)continue;Vn=!1;break}if(qn){if(!Bl(D,(function(nr,Jt){if(!Kh(qn,Jt)&&(sr===nr||ke(sr,nr,J,ge,Ge)))return qn.push(Jt)}))){Vn=!1;break}}else if(sr!==Vt&&!ke(sr,Vt,J,ge,Ge)){Vn=!1;break}}return Ge.delete(w),Ge.delete(D),Vn}function bl(w){return Z0(Qp(w,u,uS),w+"")}function Xf(w){return Fd(w,xs,X_)}function Y_(w){return Fd(w,Ws,Eu)}var Ny=th?function(w){return th.get(w)}:xl;function ss(w){for(var D=w.name+"",J=wo[D],ge=Ti.call(wo,D)?J.length:0;ge--;){var ke=J[ge],Ge=ke.func;if(Ge==null||Ge==w)return ke.name}return D}function Sl(w){return(Ti.call(Ue,"placeholder")?Ue:w).placeholder}function lr(){var w=Ue.iteratee||cf;return w=w===cf?Sy:w,arguments.length?w(arguments[0],arguments[1]):w}function K_(w,D){var J,ge,ke=w.__data__;return((ge=typeof(J=D))=="string"||ge=="number"||ge=="symbol"||ge=="boolean"?J!=="__proto__":J===null)?ke[typeof D=="string"?"string":"hash"]:ke.map}function ah(w){for(var D=xs(w),J=D.length;J--;){var ge=D[J],ke=w[ge];D[J]=[ge,ke,Zf(ke)]}return D}function Hr(w,D){var J=(function(ge,ke){return ge==null?u:ge[ke]})(w,D);return by(J)?J:u}var X_=Hp?function(w){return w==null?[]:(w=Yi(w),Ul(Hp(w),(function(D){return zp.call(w,D)})))}:Ys,Eu=Hp?function(w){for(var D=[];w;)lc(D,X_(w)),w=O0(w);return D}:Ys,Ca=sa;function $d(w,D,J){for(var ge=-1,ke=(D=nf(D,w)).length,Ge=!1;++ge<ke;){var st=xu(D[ge]);if(!(Ge=w!=null&&J(w,st)))break;w=w[st]}return Ge||++ge!=ke?Ge:!!(ke=w==null?0:w.length)&&ka(ke)&&Ao(st,ke)&&(cr(w)||Gl(w))}function Py(w){return typeof w.constructor!="function"||K0(w)?{}:Ff(O0(w))}function cS(w){return cr(w)||Gl(w)||!!(I0&&w&&w[I0])}function Ao(w,D){var J=typeof w;return!!(D=D??x)&&(J=="number"||J!="symbol"&&Fe.test(w))&&w>-1&&w%1==0&&w<D}function ca(w,D,J){if(!os(J))return!1;var ge=typeof D;return!!(ge=="number"?$c(J)&&Ao(D,J.length):ge=="string"&&D in J)&&_c(J[D],w)}function Jp(w,D){if(cr(w))return!1;var J=typeof w;return!(J!="number"&&J!="symbol"&&J!="boolean"&&w!=null&&!ao(w))||nt.test(w)||!Je.test(w)||D!=null&&w in Yi(D)}function Wd(w){var D=ss(w),J=Ue[D];if(typeof J!="function"||!(D in Mr.prototype))return!1;if(w===J)return!0;var ge=Ny(J);return!!ge&&w===ge[0]}(ln&&Ca(new ln(new ArrayBuffer(1)))!=ae||fn&&Ca(new fn)!=F||$a&&Ca($a.resolve())!=Y||zr&&Ca(new zr)!=q||Yr&&Ca(new Yr)!=ne)&&(Ca=function(w){var D=sa(w),J=D==$?w.constructor:u,ge=J?Kd(J):"";if(ge)switch(ge){case L0:return ae;case Ra:return F;case gy:return Y;case jl:return q;case Ud:return ne}return D});var Dy=Qu?vc:uf;function K0(w){var D=w&&w.constructor;return w===(typeof D=="function"&&D.prototype||Zh)}function Zf(w){return w==w&&!os(w)}function ch(w,D){return function(J){return J!=null&&J[w]===D&&(D!==u||w in Yi(J))}}function Qp(w,D,J){return D=xo(D===u?w.length-1:D,0),function(){for(var ge=arguments,ke=-1,Ge=xo(ge.length-D,0),st=In(Ge);++ke<Ge;)st[ke]=ge[D+ke];ke=-1;for(var dt=In(D+1);++ke<D;)dt[ke]=ge[ke];return dt[D]=J(st),wa(w,this,dt)}}function lh(w,D){return D.length<2?w:Gf(w,ps(D,0,-1))}function qd(w,D){if((D!=="constructor"||typeof w[D]!="function")&&D!="__proto__")return w[D]}var Yd=em(G0),X0=N0||function(w,D){return xn.setTimeout(w,D)},Z0=em(ai);function J0(w,D,J){var ge=D+"";return Z0(w,(function(ke,Ge){var st=Ge.length;if(!st)return ke;var dt=st-1;return Ge[dt]=(st>1?"& ":"")+Ge[dt],Ge=Ge.join(st>2?", ":" "),ke.replace(W,`{
/* [wrapped with `+Ge+`] */
`)})(ge,(function(ke,Ge){return Bc(R,(function(st){var dt="_."+st[0];Ge&st[1]&&!Dp(ke,dt)&&ke.push(dt)})),ke.sort()})((function(ke){var Ge=ke.match(le);return Ge?Ge[1].split(Se):[]})(ge),J)))}function em(w){var D=0,J=0;return function(){var ge=D_(),ke=16-(ge-J);if(J=ge,ke>0){if(++D>=800)return arguments[0]}else D=0;return w.apply(u,arguments)}}function Q0(w,D){var J=-1,ge=w.length,ke=ge-1;for(D=D===u?ge:D;++J<D;){var Ge=H_(J,ke),st=w[Ge];w[Ge]=w[J],w[J]=st}return w.length=D,w}var Ly=(function(w){var D=fh(w,(function(ge){return J.size===500&&J.clear(),ge})),J=D.cache;return D})((function(w){var D=[];return w.charCodeAt(0)===46&&D.push(""),w.replace(Pt,(function(J,ge,ke,Ge){D.push(ke?Ge.replace(ve,"$1"):ge||J)})),D}));function xu(w){if(typeof w=="string"||ao(w))return w;var D=w+"";return D=="0"&&1/w==-1/0?"-0":D}function Kd(w){if(w!=null){try{return Uo.call(w)}catch{}try{return w+""}catch{}}return""}function Uy(w){if(w instanceof Mr)return w.clone();var D=new ia(w.__wrapped__,w.__chain__);return D.__actions__=mc(w.__actions__),D.__index__=w.__index__,D.__values__=w.__values__,D}var By=Kr((function(w,D){return Ps(w)?Vf(w,Fo(D,1,Ps,!0)):[]})),Fy=Kr((function(w,D){var J=oo(D);return Ps(J)&&(J=u),Ps(w)?Vf(w,Fo(D,1,Ps,!0),lr(J,2)):[]})),tm=Kr((function(w,D){var J=oo(D);return Ps(J)&&(J=u),Ps(w)?Vf(w,Fo(D,1,Ps,!0),u,J):[]}));function Z_(w,D,J){var ge=w==null?0:w.length;if(!ge)return-1;var ke=J==null?0:ir(J);return ke<0&&(ke=xo(ge+ke,0)),Ku(w,lr(D,3),ke)}function lS(w,D,J){var ge=w==null?0:w.length;if(!ge)return-1;var ke=ge-1;return J!==u&&(ke=ir(J),ke=J<0?xo(ge+ke,0):To(ke,ge-1)),Ku(w,lr(D,3),ke,!0)}function uS(w){return w!=null&&w.length?Fo(w,1):[]}function hS(w){return w&&w.length?w[0]:u}var dT=Kr((function(w){var D=ds(w,$t);return D.length&&D[0]===w[0]?j_(D):[]})),jy=Kr((function(w){var D=oo(w),J=ds(w,$t);return D===oo(J)?D=u:J.pop(),J.length&&J[0]===w[0]?j_(J,lr(D,2)):[]})),zy=Kr((function(w){var D=oo(w),J=ds(w,$t);return(D=typeof D=="function"?D:u)&&J.pop(),J.length&&J[0]===w[0]?j_(J,u,D):[]}));function oo(w){var D=w==null?0:w.length;return D?w[D-1]:u}var fS=Kr(Hy);function Hy(w,D){return w&&w.length&&D&&D.length?zd(w,D):w}var pT=bl((function(w,D){var J=w==null?0:w.length,ge=j0(w,D);return V0(w,ds(D,(function(ke){return Ao(ke,J)?+ke:ke})).sort(Wf)),ge}));function Vy(w){return w==null?w:vn.call(w)}var mT=Kr((function(w){return _l(Fo(w,1,Ps,!0))})),gT=Kr((function(w){var D=oo(w);return Ps(D)&&(D=u),_l(Fo(w,1,Ps,!0),lr(D,2))})),_T=Kr((function(w){var D=oo(w);return D=typeof D=="function"?D:u,_l(Fo(w,1,Ps,!0),u,D)}));function Gy(w){if(!w||!w.length)return[];var D=0;return w=Ul(w,(function(J){if(Ps(J))return D=xo(J.length,D),!0})),ea(D,(function(J){return ds(w,C0(J))}))}function dS(w,D){if(!w||!w.length)return[];var J=Gy(w);return D==null?J:ds(J,(function(ge){return wa(D,u,ge)}))}var vT=Kr((function(w,D){return Ps(w)?Vf(w,D):[]})),yT=Kr((function(w){return Kp(Ul(w,Ps))})),J_=Kr((function(w){var D=oo(w);return Ps(D)&&(D=u),Kp(Ul(w,Ps),lr(D,2))})),nm=Kr((function(w){var D=oo(w);return D=typeof D=="function"?D:u,Kp(Ul(w,Ps),u,D)})),rm=Kr(Gy),im=Kr((function(w){var D=w.length,J=D>1?w[D-1]:u;return J=typeof J=="function"?(w.pop(),J):u,dS(w,J)}));function zo(w){var D=Ue(w);return D.__chain__=!0,D}function uh(w,D){return D(w)}var hh=bl((function(w){var D=w.length,J=D?w[0]:0,ge=this.__wrapped__,ke=function(Ge){return j0(Ge,w)};return!(D>1||this.__actions__.length)&&ge instanceof Mr&&Ao(J)?((ge=ge.slice(J,+J+(D?1:0))).__actions__.push({func:uh,args:[ke],thisArg:u}),new ia(ge,this.__chain__).thru((function(Ge){return D&&!Ge.length&&Ge.push(u),Ge}))):this.thru(ke)})),eg=oh((function(w,D,J){Ti.call(w,J)?++w[J]:ml(w,J,1)})),pS=q_(Z_),mS=q_(lS);function tg(w,D){return(cr(w)?Bc:gl)(w,lr(D,3))}function $y(w,D){return(cr(w)?hy:B_)(w,lr(D,3))}var gS=oh((function(w,D,J){Ti.call(w,J)?w[J].push(D):ml(w,J,[D])})),ng=Kr((function(w,D,J){var ge=-1,ke=typeof D=="function",Ge=$c(w)?In(w.length):[];return gl(w,(function(st){Ge[++ge]=ke?wa(D,st,J):Hc(st,D,J)})),Ge})),_S=oh((function(w,D,J){ml(w,J,D)}));function rf(w,D){return(cr(w)?ds:Wp)(w,lr(D,3))}var Wy=oh((function(w,D,J){w[J?0:1].push(D)}),(function(){return[[],[]]})),vS=Kr((function(w,D){if(w==null)return[];var J=D.length;return J>1&&ca(w,D[0],D[1])?D=[]:J>2&&ca(D[0],D[1],D[2])&&(D=[D[0]]),Su(w,Fo(D,1),[])})),Ro=my||function(){return xn.Date.now()};function Q_(w,D,J){return D=J?u:D,D=w&&D==null?w.length:D,gc(w,m,u,u,u,u,D)}function qy(w,D){var J;if(typeof D!="function")throw new Fc(h);return w=ir(w),function(){return--w>0&&(J=D.apply(this,arguments)),w<=1&&(D=u),J}}var ev=Kr((function(w,D,J){var ge=1;if(J.length){var ke=Fl(J,Sl(ev));ge|=_}return gc(w,ge,D,J,ke)})),tv=Kr((function(w,D,J){var ge=3;if(J.length){var ke=Fl(J,Sl(tv));ge|=_}return gc(D,ge,w,J,ke)}));function nv(w,D,J){var ge,ke,Ge,st,dt,xt,Gt=0,Wt=!1,un=!1,Vn=!0;if(typeof w!="function")throw new Fc(h);function qn(Jt){var Cn=ge,Tn=ke;return ge=ke=u,Gt=Jt,st=w.apply(Tn,Cn)}function sr(Jt){var Cn=Jt-xt;return xt===u||Cn>=D||Cn<0||un&&Jt-Gt>=Ge}function Vt(){var Jt=Ro();if(sr(Jt))return tn(Jt);dt=X0(Vt,(function(Cn){var Tn=D-(Cn-xt);return un?To(Tn,Ge-(Cn-Gt)):Tn})(Jt))}function tn(Jt){return dt=u,Vn&&ge?qn(Jt):(ge=ke=u,st)}function nr(){var Jt=Ro(),Cn=sr(Jt);if(ge=arguments,ke=this,xt=Jt,Cn){if(dt===u)return(function(Tn){return Gt=Tn,dt=X0(Vt,D),Wt?qn(Tn):st})(xt);if(un)return G_(dt),dt=X0(Vt,D),qn(xt)}return dt===u&&(dt=X0(Vt,D)),st}return D=Lr(D)||0,os(J)&&(Wt=!!J.leading,Ge=(un="maxWait"in J)?xo(Lr(J.maxWait)||0,D):Ge,Vn="trailing"in J?!!J.trailing:Vn),nr.cancel=function(){dt!==u&&G_(dt),Gt=0,ge=xt=ke=dt=u},nr.flush=function(){return dt===u?st:tn(Ro())},nr}var rg=Kr((function(w,D){return Hf(w,1,D)})),Xd=Kr((function(w,D,J){return Hf(w,Lr(D)||0,J)}));function fh(w,D){if(typeof w!="function"||D!=null&&typeof D!="function")throw new Fc(h);var J=function(){var ge=arguments,ke=D?D.apply(this,ge):ge[0],Ge=J.cache;if(Ge.has(ke))return Ge.get(ke);var st=w.apply(this,ge);return J.cache=Ge.set(ke,st)||Ge,st};return J.cache=new(fh.Cache||pl),J}function Ma(w){if(typeof w!="function")throw new Fc(h);return function(){var D=arguments;switch(D.length){case 0:return!w.call(this);case 1:return!w.call(this,D[0]);case 2:return!w.call(this,D[0],D[1]);case 3:return!w.call(this,D[0],D[1],D[2])}return!w.apply(this,D)}}fh.Cache=pl;var la=V_((function(w,D){var J=(D=D.length==1&&cr(D[0])?ds(D[0],hc(lr())):ds(Fo(D,1),hc(lr()))).length;return Kr((function(ge){for(var ke=-1,Ge=To(ge.length,J);++ke<Ge;)ge[ke]=D[ke].call(this,ge[ke]);return wa(w,this,ge)}))})),ig=Kr((function(w,D){var J=Fl(D,Sl(ig));return gc(w,_,u,D,J)})),sg=Kr((function(w,D){var J=Fl(D,Sl(sg));return gc(w,g,u,D,J)})),og=bl((function(w,D){return gc(w,b,u,u,u,D)}));function _c(w,D){return w===D||w!=w&&D!=D}var ag=Vl(Gp),yS=Vl((function(w,D){return w>=D})),Gl=yy((function(){return arguments})())?yy:function(w){return Ki(w)&&Ti.call(w,"callee")&&!zp.call(w,"callee")},cr=In.isArray,bS=cc?hc(cc):function(w){return Ki(w)&&sa(w)==ie};function $c(w){return w!=null&&ka(w.length)&&!vc(w)}function Ps(w){return Ki(w)&&$c(w)}var Jf=Bf||uf,bT=Dd?hc(Dd):function(w){return Ki(w)&&sa(w)==z};function Yy(w){if(!Ki(w))return!1;var D=sa(w);return D==I||D=="[object DOMException]"||typeof w.message=="string"&&typeof w.name=="string"&&!sf(w)}function vc(w){if(!os(w))return!1;var D=sa(w);return D==L||D==M||D=="[object AsyncFunction]"||D=="[object Proxy]"}function Xa(w){return typeof w=="number"&&w==ir(w)}function ka(w){return typeof w=="number"&&w>-1&&w%1==0&&w<=x}function os(w){var D=typeof w;return w!=null&&(D=="object"||D=="function")}function Ki(w){return w!=null&&typeof w=="object"}var Zd=x_?hc(x_):function(w){return Ki(w)&&Ca(w)==F};function cg(w){return typeof w=="number"||Ki(w)&&sa(w)==Z}function sf(w){if(!Ki(w)||sa(w)!=$)return!1;var D=O0(w);if(D===null)return!0;var J=Ti.call(D,"constructor")&&D.constructor;return typeof J=="function"&&J instanceof J&&Uo.call(J)==py}var Wc=w0?hc(w0):function(w){return Ki(w)&&sa(w)==Q},Za=T_?hc(T_):function(w){return Ki(w)&&Ca(w)==q};function dh(w){return typeof w=="string"||!cr(w)&&Ki(w)&&sa(w)==V}function ao(w){return typeof w=="symbol"||Ki(w)&&sa(w)==K}var ua=A0?hc(A0):function(w){return Ki(w)&&ka(w.length)&&!!pr[sa(w)]},Co=Vl(xy),sm=Vl((function(w,D){return w<=D}));function of(w){if(!w)return[];if($c(w))return dh(w)?ra(w):mc(w);if(Jh&&w[Jh])return(function(J){for(var ge,ke=[];!(ge=J.next()).done;)ke.push(ge.value);return ke})(w[Jh]());var D=Ca(w);return(D==F?I_:D==q?Ga:ql)(w)}function $l(w){return w?(w=Lr(w))===y||w===-1/0?17976931348623157e292*(w<0?-1:1):w==w?w:0:w===0?w:0}function ir(w){var D=$l(w),J=D%1;return D==D?J?D-J:D:0}function Oa(w){return w?tf(ir(w),0,k):0}function Lr(w){if(typeof w=="number")return w;if(ao(w))return T;if(os(w)){var D=typeof w.valueOf=="function"?w.valueOf():w;w=os(D)?D+"":D}if(typeof w!="string")return w===0?w:+w;w=M_(w);var J=je.test(w);return J||ct.test(w)?js(w.slice(2),J?2:8):Ve.test(w)?T:+w}function Wl(w){return vl(w,Ws(w))}function Xr(w){return w==null?"":aa(w)}var Ky=qf((function(w,D){if(K0(D)||$c(D))vl(D,xs(D),w);else for(var J in D)Ti.call(D,J)&&zf(w,J,D[J])})),El=qf((function(w,D){vl(D,Ws(D),w)})),ph=qf((function(w,D,J,ge){vl(D,Ws(D),w,ge)})),Xy=qf((function(w,D,J,ge){vl(D,xs(D),w,ge)})),rv=bl(j0),om=Kr((function(w,D){w=Yi(w);var J=-1,ge=D.length,ke=ge>2?D[2]:u;for(ke&&ca(D[0],D[1],ke)&&(ge=1);++J<ge;)for(var Ge=D[J],st=Ws(Ge),dt=-1,xt=st.length;++dt<xt;){var Gt=st[dt],Wt=w[Gt];(Wt===u||_c(Wt,Zh[Gt])&&!Ti.call(w,Gt))&&(w[Gt]=Ge[Gt])}return w})),Zy=Kr((function(w){return w.push(u,Oy),wa(yc,u,w)}));function am(w,D,J){var ge=w==null?u:Gf(w,D);return ge===u?J:ge}function lg(w,D){return w!=null&&$d(w,D,hT)}var cm=My((function(w,D,J){D!=null&&typeof D.toString!="function"&&(D=Uf.call(D)),w[D]=J}),td(Ni)),ug=My((function(w,D,J){D!=null&&typeof D.toString!="function"&&(D=Uf.call(D)),Ti.call(w,D)?w[D].push(J):w[D]=[J]}),lr),Jy=Kr(Hc);function xs(w){return $c(w)?_y(w):Ey(w)}function Ws(w){return $c(w)?_y(w,!0):iS(w)}var co=qf((function(w,D,J){jd(w,D,J)})),yc=qf((function(w,D,J,ge){jd(w,D,J,ge)})),Xi=bl((function(w,D){var J={};if(w==null)return J;var ge=!1;D=ds(D,(function(Ge){return Ge=nf(Ge,w),ge||(ge=Ge.length>1),Ge})),vl(w,Y_(w),J),ge&&(J=zc(J,7,fT));for(var ke=D.length;ke--;)wy(J,D[ke]);return J})),hg=bl((function(w,D){return w==null?{}:(function(J,ge){return Ty(J,ge,(function(ke,Ge){return lg(J,Ge)}))})(w,D)}));function fg(w,D){if(w==null)return{};var J=ds(Y_(w),(function(ge){return[ge]}));return D=lr(D),Ty(w,J,(function(ge,ke){return D(ge,ke[0])}))}var dg=Ka(xs),Qf=Ka(Ws);function ql(w){return w==null?[]:k_(w,xs(w))}var pg=Gd((function(w,D,J){return D=D.toLowerCase(),w+(J?ed(D):D)}));function ed(w){return Fr(Xr(w).toLowerCase())}function Qy(w){return(w=Xr(w))&&w.replace(rt,O_).replace(zn,"")}var lm=Gd((function(w,D,J){return w+(J?"-":"")+D.toLowerCase()})),iv=Gd((function(w,D,J){return w+(J?" ":"")+D.toLowerCase()})),Yl=W_("toLowerCase"),Kl=Gd((function(w,D,J){return w+(J?"_":"")+D.toLowerCase()})),vi=Gd((function(w,D,J){return w+(J?" ":"")+Fr(D)})),af=Gd((function(w,D,J){return w+(J?" ":"")+D.toUpperCase()})),Fr=W_("toUpperCase");function Bi(w,D,J){return w=Xr(w),(D=J?u:D)===u?(function(ge){return Rr.test(ge)})(w)?(function(ge){return ge.match(Ur)||[]})(w):(function(ge){return ge.match(Ae)||[]})(w):w.match(D)||[]}var gs=Kr((function(w,D){try{return wa(w,u,D)}catch(J){return Yy(J)?J:new Br(J)}})),ha=bl((function(w,D){return Bc(D,(function(J){J=xu(J),ml(w,J,ev(w[J],w))})),w}));function td(w){return function(){return w}}var nd=Zp(),mg=Zp(!0);function Ni(w){return w}function cf(w){return Sy(typeof w=="function"?w:zc(w,1))}var SS=Kr((function(w,D){return function(J){return Hc(J,w,D)}})),e1=Kr((function(w,D){return function(J){return Hc(w,J,D)}}));function Fi(w,D,J){var ge=xs(D),ke=Vp(D,ge);J!=null||os(D)&&(ke.length||!ge.length)||(J=D,D=w,w=this,ke=Vp(D,xs(D)));var Ge=!(os(J)&&"chain"in J&&!J.chain),st=vc(w);return Bc(ke,(function(dt){var xt=D[dt];w[dt]=xt,st&&(w.prototype[dt]=function(){var Gt=this.__chain__;if(Ge||Gt){var Wt=w(this.__wrapped__);return(Wt.__actions__=mc(this.__actions__)).push({func:xt,args:arguments,thisArg:w}),Wt.__chain__=Gt,Wt}return xt.apply(w,lc([this.value()],arguments))})})),w}function xl(){}var lf=yl(ds),rd=yl(w_),t1=yl(Bl);function n1(w){return Jp(w)?C0(xu(w)):(function(D){return function(J){return Gf(J,D)}})(w)}var ES=jo(),qs=jo(!0);function Ys(){return[]}function uf(){return!1}var Ts=q0((function(w,D){return w+D}),0),Ia=Y0("ceil"),ST=q0((function(w,D){return w/D}),1),gg=Y0("floor"),um,ci=q0((function(w,D){return w*D}),1),Ho=Y0("round"),Xl=q0((function(w,D){return w-D}),0);return Ue.after=function(w,D){if(typeof D!="function")throw new Fc(h);return w=ir(w),function(){if(--w<1)return D.apply(this,arguments)}},Ue.ary=Q_,Ue.assign=Ky,Ue.assignIn=El,Ue.assignInWith=ph,Ue.assignWith=Xy,Ue.at=rv,Ue.before=qy,Ue.bind=ev,Ue.bindAll=ha,Ue.bindKey=tv,Ue.castArray=function(){if(!arguments.length)return[];var w=arguments[0];return cr(w)?w:[w]},Ue.chain=zo,Ue.chunk=function(w,D,J){D=(J?ca(w,D,J):D===u)?1:xo(ir(D),0);var ge=w==null?0:w.length;if(!ge||D<1)return[];for(var ke=0,Ge=0,st=In(bu(ge/D));ke<ge;)st[Ge++]=ps(w,ke,ke+=D);return st},Ue.compact=function(w){for(var D=-1,J=w==null?0:w.length,ge=0,ke=[];++D<J;){var Ge=w[D];Ge&&(ke[ge++]=Ge)}return ke},Ue.concat=function(){var w=arguments.length;if(!w)return[];for(var D=In(w-1),J=arguments[0],ge=w;ge--;)D[ge-1]=arguments[ge];return lc(cr(J)?mc(J):[J],Fo(D,1))},Ue.cond=function(w){var D=w==null?0:w.length,J=lr();return w=D?ds(w,(function(ge){if(typeof ge[1]!="function")throw new Fc(h);return[J(ge[0]),ge[1]]})):[],Kr((function(ge){for(var ke=-1;++ke<D;){var Ge=w[ke];if(wa(Ge[0],this,ge))return wa(Ge[1],this,ge)}}))},Ue.conforms=function(w){return(function(D){var J=xs(D);return function(ge){return Gs(ge,D,J)}})(zc(w,1))},Ue.constant=td,Ue.countBy=eg,Ue.create=function(w,D){var J=Ff(w);return D==null?J:Ya(J,D)},Ue.curry=function w(D,J,ge){var ke=gc(D,8,u,u,u,u,u,J=ge?u:J);return ke.placeholder=w.placeholder,ke},Ue.curryRight=function w(D,J,ge){var ke=gc(D,p,u,u,u,u,u,J=ge?u:J);return ke.placeholder=w.placeholder,ke},Ue.debounce=nv,Ue.defaults=om,Ue.defaultsDeep=Zy,Ue.defer=rg,Ue.delay=Xd,Ue.difference=By,Ue.differenceBy=Fy,Ue.differenceWith=tm,Ue.drop=function(w,D,J){var ge=w==null?0:w.length;return ge?ps(w,(D=J||D===u?1:ir(D))<0?0:D,ge):[]},Ue.dropRight=function(w,D,J){var ge=w==null?0:w.length;return ge?ps(w,0,(D=ge-(D=J||D===u?1:ir(D)))<0?0:D):[]},Ue.dropRightWhile=function(w,D){return w&&w.length?ms(w,lr(D,3),!0,!0):[]},Ue.dropWhile=function(w,D){return w&&w.length?ms(w,lr(D,3),!0):[]},Ue.fill=function(w,D,J,ge){var ke=w==null?0:w.length;return ke?(J&&typeof J!="number"&&ca(w,D,J)&&(J=0,ge=ke),(function(Ge,st,dt,xt){var Gt=Ge.length;for((dt=ir(dt))<0&&(dt=-dt>Gt?0:Gt+dt),(xt=xt===u||xt>Gt?Gt:ir(xt))<0&&(xt+=Gt),xt=dt>xt?0:Oa(xt);dt<xt;)Ge[dt++]=st;return Ge})(w,D,J,ge)):[]},Ue.filter=function(w,D){return(cr(w)?Ul:vr)(w,lr(D,3))},Ue.flatMap=function(w,D){return Fo(rf(w,D),1)},Ue.flatMapDeep=function(w,D){return Fo(rf(w,D),y)},Ue.flatMapDepth=function(w,D,J){return J=J===u?1:ir(J),Fo(rf(w,D),J)},Ue.flatten=uS,Ue.flattenDeep=function(w){return w!=null&&w.length?Fo(w,y):[]},Ue.flattenDepth=function(w,D){return w!=null&&w.length?Fo(w,D=D===u?1:ir(D)):[]},Ue.flip=function(w){return gc(w,512)},Ue.flow=nd,Ue.flowRight=mg,Ue.fromPairs=function(w){for(var D=-1,J=w==null?0:w.length,ge={};++D<J;){var ke=w[D];ge[ke[0]]=ke[1]}return ge},Ue.functions=function(w){return w==null?[]:Vp(w,xs(w))},Ue.functionsIn=function(w){return w==null?[]:Vp(w,Ws(w))},Ue.groupBy=gS,Ue.initial=function(w){return w!=null&&w.length?ps(w,0,-1):[]},Ue.intersection=dT,Ue.intersectionBy=jy,Ue.intersectionWith=zy,Ue.invert=cm,Ue.invertBy=ug,Ue.invokeMap=ng,Ue.iteratee=cf,Ue.keyBy=_S,Ue.keys=xs,Ue.keysIn=Ws,Ue.map=rf,Ue.mapKeys=function(w,D){var J={};return D=lr(D,3),Ns(w,(function(ge,ke,Ge){ml(J,D(ge,ke,Ge),ge)})),J},Ue.mapValues=function(w,D){var J={};return D=lr(D,3),Ns(w,(function(ge,ke,Ge){ml(J,ke,D(ge,ke,Ge))})),J},Ue.matches=function(w){return z_(zc(w,1))},Ue.matchesProperty=function(w,D){return ih(w,zc(D,1))},Ue.memoize=fh,Ue.merge=co,Ue.mergeWith=yc,Ue.method=SS,Ue.methodOf=e1,Ue.mixin=Fi,Ue.negate=Ma,Ue.nthArg=function(w){return w=ir(w),Kr((function(D){return qp(D,w)}))},Ue.omit=Xi,Ue.omitBy=function(w,D){return fg(w,Ma(lr(D)))},Ue.once=function(w){return qy(2,w)},Ue.orderBy=function(w,D,J,ge){return w==null?[]:(cr(D)||(D=D==null?[]:[D]),cr(J=ge?u:J)||(J=J==null?[]:[J]),Su(w,D,J))},Ue.over=lf,Ue.overArgs=la,Ue.overEvery=rd,Ue.overSome=t1,Ue.partial=ig,Ue.partialRight=sg,Ue.partition=Wy,Ue.pick=hg,Ue.pickBy=fg,Ue.property=n1,Ue.propertyOf=function(w){return function(D){return w==null?u:Gf(w,D)}},Ue.pull=fS,Ue.pullAll=Hy,Ue.pullAllBy=function(w,D,J){return w&&w.length&&D&&D.length?zd(w,D,lr(J,2)):w},Ue.pullAllWith=function(w,D,J){return w&&w.length&&D&&D.length?zd(w,D,u,J):w},Ue.pullAt=pT,Ue.range=ES,Ue.rangeRight=qs,Ue.rearg=og,Ue.reject=function(w,D){return(cr(w)?Ul:vr)(w,Ma(lr(D,3)))},Ue.remove=function(w,D){var J=[];if(!w||!w.length)return J;var ge=-1,ke=[],Ge=w.length;for(D=lr(D,3);++ge<Ge;){var st=w[ge];D(st,ge,w)&&(J.push(st),ke.push(ge))}return V0(w,ke),J},Ue.rest=function(w,D){if(typeof w!="function")throw new Fc(h);return Kr(w,D=D===u?D:ir(D))},Ue.reverse=Vy,Ue.sampleSize=function(w,D,J){return D=(J?ca(w,D,J):D===u)?1:ir(D),(cr(w)?vy:oS)(w,D)},Ue.set=function(w,D,J){return w==null?w:Yp(w,D,J)},Ue.setWith=function(w,D,J,ge){return ge=typeof ge=="function"?ge:u,w==null?w:Yp(w,D,J,ge)},Ue.shuffle=function(w){return(cr(w)?Bo:Hd)(w)},Ue.slice=function(w,D,J){var ge=w==null?0:w.length;return ge?(J&&typeof J!="number"&&ca(w,D,J)?(D=0,J=ge):(D=D==null?0:ir(D),J=J===u?ge:ir(J)),ps(w,D,J)):[]},Ue.sortBy=vS,Ue.sortedUniq=function(w){return w&&w.length?$f(w):[]},Ue.sortedUniqBy=function(w,D){return w&&w.length?$f(w,lr(D,2)):[]},Ue.split=function(w,D,J){return J&&typeof J!="number"&&ca(w,D,J)&&(D=J=u),(J=J===u?k:J>>>0)?(w=Xr(w))&&(typeof D=="string"||D!=null&&!Wc(D))&&!(D=aa(D))&&na(w)?Hl(ra(w),0,J):w.split(D,J):[]},Ue.spread=function(w,D){if(typeof w!="function")throw new Fc(h);return D=D==null?0:xo(ir(D),0),Kr((function(J){var ge=J[D],ke=Hl(J,0,D);return ge&&lc(ke,ge),wa(w,this,ke)}))},Ue.tail=function(w){var D=w==null?0:w.length;return D?ps(w,1,D):[]},Ue.take=function(w,D,J){return w&&w.length?ps(w,0,(D=J||D===u?1:ir(D))<0?0:D):[]},Ue.takeRight=function(w,D,J){var ge=w==null?0:w.length;return ge?ps(w,(D=ge-(D=J||D===u?1:ir(D)))<0?0:D,ge):[]},Ue.takeRightWhile=function(w,D){return w&&w.length?ms(w,lr(D,3),!1,!0):[]},Ue.takeWhile=function(w,D){return w&&w.length?ms(w,lr(D,3)):[]},Ue.tap=function(w,D){return D(w),w},Ue.throttle=function(w,D,J){var ge=!0,ke=!0;if(typeof w!="function")throw new Fc(h);return os(J)&&(ge="leading"in J?!!J.leading:ge,ke="trailing"in J?!!J.trailing:ke),nv(w,D,{leading:ge,maxWait:D,trailing:ke})},Ue.thru=uh,Ue.toArray=of,Ue.toPairs=dg,Ue.toPairsIn=Qf,Ue.toPath=function(w){return cr(w)?ds(w,xu):ao(w)?[w]:mc(Ly(Xr(w)))},Ue.toPlainObject=Wl,Ue.transform=function(w,D,J){var ge=cr(w),ke=ge||Jf(w)||ua(w);if(D=lr(D,4),J==null){var Ge=w&&w.constructor;J=ke?ge?new Ge:[]:os(w)&&vc(Ge)?Ff(O0(w)):{}}return(ke?Bc:Ns)(w,(function(st,dt,xt){return D(J,st,dt,xt)})),J},Ue.unary=function(w){return Q_(w,1)},Ue.union=mT,Ue.unionBy=gT,Ue.unionWith=_T,Ue.uniq=function(w){return w&&w.length?_l(w):[]},Ue.uniqBy=function(w,D){return w&&w.length?_l(w,lr(D,2)):[]},Ue.uniqWith=function(w,D){return D=typeof D=="function"?D:u,w&&w.length?_l(w,u,D):[]},Ue.unset=function(w,D){return w==null||wy(w,D)},Ue.unzip=Gy,Ue.unzipWith=dS,Ue.update=function(w,D,J){return w==null?w:W0(w,D,$s(J))},Ue.updateWith=function(w,D,J,ge){return ge=typeof ge=="function"?ge:u,w==null?w:W0(w,D,$s(J),ge)},Ue.values=ql,Ue.valuesIn=function(w){return w==null?[]:k_(w,Ws(w))},Ue.without=vT,Ue.words=Bi,Ue.wrap=function(w,D){return ig($s(D),w)},Ue.xor=yT,Ue.xorBy=J_,Ue.xorWith=nm,Ue.zip=rm,Ue.zipObject=function(w,D){return pc(w||[],D||[],zf)},Ue.zipObjectDeep=function(w,D){return pc(w||[],D||[],Yp)},Ue.zipWith=im,Ue.entries=dg,Ue.entriesIn=Qf,Ue.extend=El,Ue.extendWith=ph,Fi(Ue,Ue),Ue.add=Ts,Ue.attempt=gs,Ue.camelCase=pg,Ue.capitalize=ed,Ue.ceil=Ia,Ue.clamp=function(w,D,J){return J===u&&(J=D,D=u),J!==u&&(J=(J=Lr(J))==J?J:0),D!==u&&(D=(D=Lr(D))==D?D:0),tf(Lr(w),D,J)},Ue.clone=function(w){return zc(w,4)},Ue.cloneDeep=function(w){return zc(w,5)},Ue.cloneDeepWith=function(w,D){return zc(w,5,D=typeof D=="function"?D:u)},Ue.cloneWith=function(w,D){return zc(w,4,D=typeof D=="function"?D:u)},Ue.conformsTo=function(w,D){return D==null||Gs(w,D,xs(D))},Ue.deburr=Qy,Ue.defaultTo=function(w,D){return w==null||w!=w?D:w},Ue.divide=ST,Ue.endsWith=function(w,D,J){w=Xr(w),D=aa(D);var ge=w.length,ke=J=J===u?ge:tf(ir(J),0,ge);return(J-=D.length)>=0&&w.slice(J,ke)==D},Ue.eq=_c,Ue.escape=function(w){return(w=Xr(w))&&we.test(w)?w.replace(ue,vu):w},Ue.escapeRegExp=function(w){return(w=Xr(w))&&At.test(w)?w.replace(vt,"\\$&"):w},Ue.every=function(w,D,J){var ge=cr(w)?w_:F_;return J&&ca(w,D,J)&&(D=u),ge(w,lr(D,3))},Ue.find=pS,Ue.findIndex=Z_,Ue.findKey=function(w,D){return Yu(w,lr(D,3),Ns)},Ue.findLast=mS,Ue.findLastIndex=lS,Ue.findLastKey=function(w,D){return Yu(w,lr(D,3),H0)},Ue.floor=gg,Ue.forEach=tg,Ue.forEachRight=$y,Ue.forIn=function(w,D){return w==null?w:z0(w,lr(D,3),Ws)},Ue.forInRight=function(w,D){return w==null?w:rS(w,lr(D,3),Ws)},Ue.forOwn=function(w,D){return w&&Ns(w,lr(D,3))},Ue.forOwnRight=function(w,D){return w&&H0(w,lr(D,3))},Ue.get=am,Ue.gt=ag,Ue.gte=yS,Ue.has=function(w,D){return w!=null&&$d(w,D,$p)},Ue.hasIn=lg,Ue.head=hS,Ue.identity=Ni,Ue.includes=function(w,D,J,ge){w=$c(w)?w:ql(w),J=J&&!ge?ir(J):0;var ke=w.length;return J<0&&(J=xo(ke+J,0)),dh(w)?J<=ke&&w.indexOf(D,J)>-1:!!ke&&fl(w,D,J)>-1},Ue.indexOf=function(w,D,J){var ge=w==null?0:w.length;if(!ge)return-1;var ke=J==null?0:ir(J);return ke<0&&(ke=xo(ge+ke,0)),fl(w,D,ke)},Ue.inRange=function(w,D,J){return D=$l(D),J===u?(J=D,D=0):J=$l(J),(function(ge,ke,Ge){return ge>=To(ke,Ge)&&ge<xo(ke,Ge)})(w=Lr(w),D,J)},Ue.invoke=Jy,Ue.isArguments=Gl,Ue.isArray=cr,Ue.isArrayBuffer=bS,Ue.isArrayLike=$c,Ue.isArrayLikeObject=Ps,Ue.isBoolean=function(w){return w===!0||w===!1||Ki(w)&&sa(w)==U},Ue.isBuffer=Jf,Ue.isDate=bT,Ue.isElement=function(w){return Ki(w)&&w.nodeType===1&&!sf(w)},Ue.isEmpty=function(w){if(w==null)return!0;if($c(w)&&(cr(w)||typeof w=="string"||typeof w.splice=="function"||Jf(w)||ua(w)||Gl(w)))return!w.length;var D=Ca(w);if(D==F||D==q)return!w.size;if(K0(w))return!Ey(w).length;for(var J in w)if(Ti.call(w,J))return!1;return!0},Ue.isEqual=function(w,D){return Si(w,D)},Ue.isEqualWith=function(w,D,J){var ge=(J=typeof J=="function"?J:u)?J(w,D):u;return ge===u?Si(w,D,u,J):!!ge},Ue.isError=Yy,Ue.isFinite=function(w){return typeof w=="number"&&Aa(w)},Ue.isFunction=vc,Ue.isInteger=Xa,Ue.isLength=ka,Ue.isMap=Zd,Ue.isMatch=function(w,D){return w===D||rh(w,D,ah(D))},Ue.isMatchWith=function(w,D,J){return J=typeof J=="function"?J:u,rh(w,D,ah(D),J)},Ue.isNaN=function(w){return cg(w)&&w!=+w},Ue.isNative=function(w){if(Dy(w))throw new Br("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return by(w)},Ue.isNil=function(w){return w==null},Ue.isNull=function(w){return w===null},Ue.isNumber=cg,Ue.isObject=os,Ue.isObjectLike=Ki,Ue.isPlainObject=sf,Ue.isRegExp=Wc,Ue.isSafeInteger=function(w){return Xa(w)&&w>=-9007199254740991&&w<=x},Ue.isSet=Za,Ue.isString=dh,Ue.isSymbol=ao,Ue.isTypedArray=ua,Ue.isUndefined=function(w){return w===u},Ue.isWeakMap=function(w){return Ki(w)&&Ca(w)==ne},Ue.isWeakSet=function(w){return Ki(w)&&sa(w)=="[object WeakSet]"},Ue.join=function(w,D){return w==null?"":P_.call(w,D)},Ue.kebabCase=lm,Ue.last=oo,Ue.lastIndexOf=function(w,D,J){var ge=w==null?0:w.length;if(!ge)return-1;var ke=ge;return J!==u&&(ke=(ke=ir(J))<0?xo(ge+ke,0):To(ke,ge-1)),D==D?(function(Ge,st,dt){for(var xt=dt+1;xt--;)if(Ge[xt]===st)return xt;return xt})(w,D,ke):Ku(w,A_,ke,!0)},Ue.lowerCase=iv,Ue.lowerFirst=Yl,Ue.lt=Co,Ue.lte=sm,Ue.max=function(w){return w&&w.length?Bd(w,Ni,Gp):u},Ue.maxBy=function(w,D){return w&&w.length?Bd(w,lr(D,2),Gp):u},Ue.mean=function(w){return R_(w,Ni)},Ue.meanBy=function(w,D){return R_(w,lr(D,2))},Ue.min=function(w){return w&&w.length?Bd(w,Ni,xy):u},Ue.minBy=function(w,D){return w&&w.length?Bd(w,lr(D,2),xy):u},Ue.stubArray=Ys,Ue.stubFalse=uf,Ue.stubObject=function(){return{}},Ue.stubString=function(){return""},Ue.stubTrue=function(){return!0},Ue.multiply=ci,Ue.nth=function(w,D){return w&&w.length?qp(w,ir(D)):u},Ue.noConflict=function(){return xn._===this&&(xn._=jc),this},Ue.noop=xl,Ue.now=Ro,Ue.pad=function(w,D,J){w=Xr(w);var ge=(D=ir(D))?Zu(w):0;if(!D||ge>=D)return w;var ke=(D-ge)/2;return Vc(P0(ke),J)+w+Vc(bu(ke),J)},Ue.padEnd=function(w,D,J){w=Xr(w);var ge=(D=ir(D))?Zu(w):0;return D&&ge<D?w+Vc(D-ge,J):w},Ue.padStart=function(w,D,J){w=Xr(w);var ge=(D=ir(D))?Zu(w):0;return D&&ge<D?Vc(D-ge,J)+w:w},Ue.parseInt=function(w,D,J){return J||D==null?D=0:D&&(D=+D),L_(Xr(w).replace(Re,""),D||0)},Ue.random=function(w,D,J){if(J&&typeof J!="boolean"&&ca(w,D,J)&&(D=J=u),J===u&&(typeof D=="boolean"?(J=D,D=u):typeof w=="boolean"&&(J=w,w=u)),w===u&&D===u?(w=0,D=1):(w=$l(w),D===u?(D=w,w=0):D=$l(D)),w>D){var ge=w;w=D,D=ge}if(J||w%1||D%1){var ke=D0();return To(w+ke*(D-w+So("1e-"+((ke+"").length-1))),D)}return H_(w,D)},Ue.reduce=function(w,D,J){var ge=cr(w)?Lf:C_,ke=arguments.length<3;return ge(w,lr(D,4),J,ke,gl)},Ue.reduceRight=function(w,D,J){var ge=cr(w)?uc:C_,ke=arguments.length<3;return ge(w,lr(D,4),J,ke,B_)},Ue.repeat=function(w,D,J){return D=(J?ca(w,D,J):D===u)?1:ir(D),yn(Xr(w),D)},Ue.replace=function(){var w=arguments,D=Xr(w[0]);return w.length<3?D:D.replace(w[1],w[2])},Ue.result=function(w,D,J){var ge=-1,ke=(D=nf(D,w)).length;for(ke||(ke=1,w=u);++ge<ke;){var Ge=w==null?u:w[xu(D[ge])];Ge===u&&(ge=ke,Ge=J),w=vc(Ge)?Ge.call(w):Ge}return w},Ue.round=Ho,Ue.runInContext=Nt,Ue.sample=function(w){return(cr(w)?U_:sS)(w)},Ue.size=function(w){if(w==null)return 0;if($c(w))return dh(w)?Zu(w):w.length;var D=Ca(w);return D==F||D==q?w.size:Ey(w).length},Ue.snakeCase=Kl,Ue.some=function(w,D,J){var ge=cr(w)?Bl:oa;return J&&ca(w,D,J)&&(D=u),ge(w,lr(D,3))},Ue.sortedIndex=function(w,D){return $0(w,D)},Ue.sortedIndexBy=function(w,D,J){return dc(w,D,lr(J,2))},Ue.sortedIndexOf=function(w,D){var J=w==null?0:w.length;if(J){var ge=$0(w,D);if(ge<J&&_c(w[ge],D))return ge}return-1},Ue.sortedLastIndex=function(w,D){return $0(w,D,!0)},Ue.sortedLastIndexBy=function(w,D,J){return dc(w,D,lr(J,2),!0)},Ue.sortedLastIndexOf=function(w,D){if(w!=null&&w.length){var J=$0(w,D,!0)-1;if(_c(w[J],D))return J}return-1},Ue.startCase=vi,Ue.startsWith=function(w,D,J){return w=Xr(w),J=J==null?0:tf(ir(J),0,w.length),D=aa(D),w.slice(J,J+D.length)==D},Ue.subtract=Xl,Ue.sum=function(w){return w&&w.length?Xu(w,Ni):0},Ue.sumBy=function(w,D){return w&&w.length?Xu(w,lr(D,2)):0},Ue.template=function(w,D,J){var ge=Ue.templateSettings;J&&ca(w,D,J)&&(D=u),w=Xr(w),D=ph({},D,ge,ky);var ke,Ge,st=ph({},D.imports,ge.imports,ky),dt=xs(st),xt=k_(st,dt),Gt=0,Wt=D.interpolate||it,un="__p += '",Vn=Ju((D.escape||it).source+"|"+Wt.source+"|"+(Wt===Ze?Xe:it).source+"|"+(D.evaluate||it).source+"|$","g"),qn="//# sourceURL="+(Ti.call(D,"sourceURL")?(D.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Qn+"]")+`
`;w.replace(Vn,(function(tn,nr,Jt,Cn,Tn,Gn){return Jt||(Jt=Cn),un+=w.slice(Gt,Gn).replace(St,Ss),nr&&(ke=!0,un+=`' +
__e(`+nr+`) +
'`),Tn&&(Ge=!0,un+=`';
`+Tn+`;
__p += '`),Jt&&(un+=`' +
((__t = (`+Jt+`)) == null ? '' : __t) +
'`),Gt=Gn+tn.length,tn})),un+=`';
`;var sr=Ti.call(D,"variable")&&D.variable;if(sr){if(ye.test(sr))throw new Br("Invalid `variable` option passed into `_.template`")}else un=`with (obj) {
`+un+`
}
`;un=(Ge?un.replace(Ne,""):un).replace(Be,"$1").replace(De,"$1;"),un="function("+(sr||"obj")+`) {
`+(sr?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ke?", __e = _.escape":"")+(Ge?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+un+`return __p
}`;var Vt=gs((function(){return Hs(dt,qn+"return "+un).apply(u,xt)}));if(Vt.source=un,Yy(Vt))throw Vt;return Vt},Ue.times=function(w,D){if((w=ir(w))<1||w>x)return[];var J=k,ge=To(w,k);D=lr(D),w-=k;for(var ke=ea(ge,D);++J<w;)D(J);return ke},Ue.toFinite=$l,Ue.toInteger=ir,Ue.toLength=Oa,Ue.toLower=function(w){return Xr(w).toLowerCase()},Ue.toNumber=Lr,Ue.toSafeInteger=function(w){return w?tf(ir(w),-9007199254740991,x):w===0?w:0},Ue.toString=Xr,Ue.toUpper=function(w){return Xr(w).toUpperCase()},Ue.trim=function(w,D,J){if((w=Xr(w))&&(J||D===u))return M_(w);if(!w||!(D=aa(D)))return w;var ge=ra(w),ke=ra(D);return Hl(ge,Eo(ge,ke),ta(ge,ke)+1).join("")},Ue.trimEnd=function(w,D,J){if((w=Xr(w))&&(J||D===u))return w.slice(0,pn(w)+1);if(!w||!(D=aa(D)))return w;var ge=ra(w);return Hl(ge,0,ta(ge,ra(D))+1).join("")},Ue.trimStart=function(w,D,J){if((w=Xr(w))&&(J||D===u))return w.replace(Re,"");if(!w||!(D=aa(D)))return w;var ge=ra(w);return Hl(ge,Eo(ge,ra(D))).join("")},Ue.truncate=function(w,D){var J=30,ge="...";if(os(D)){var ke="separator"in D?D.separator:ke;J="length"in D?ir(D.length):J,ge="omission"in D?aa(D.omission):ge}var Ge=(w=Xr(w)).length;if(na(w)){var st=ra(w);Ge=st.length}if(J>=Ge)return w;var dt=J-Zu(ge);if(dt<1)return ge;var xt=st?Hl(st,0,dt).join(""):w.slice(0,dt);if(ke===u)return xt+ge;if(st&&(dt+=xt.length-dt),Wc(ke)){if(w.slice(dt).search(ke)){var Gt,Wt=xt;for(ke.global||(ke=Ju(ke.source,Xr(Me.exec(ke))+"g")),ke.lastIndex=0;Gt=ke.exec(Wt);)var un=Gt.index;xt=xt.slice(0,un===u?dt:un)}}else if(w.indexOf(aa(ke),dt)!=dt){var Vn=xt.lastIndexOf(ke);Vn>-1&&(xt=xt.slice(0,Vn))}return xt+ge},Ue.unescape=function(w){return(w=Xr(w))&&_e.test(w)?w.replace(Oe,eS):w},Ue.uniqueId=function(w){var D=++dy;return Xr(w)+D},Ue.upperCase=af,Ue.upperFirst=Fr,Ue.each=tg,Ue.eachRight=$y,Ue.first=hS,Fi(Ue,(um={},Ns(Ue,(function(w,D){Ti.call(Ue.prototype,D)||(um[D]=w)})),um),{chain:!1}),Ue.VERSION="4.17.21",Bc(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(w){Ue[w].placeholder=Ue})),Bc(["drop","take"],(function(w,D){Mr.prototype[w]=function(J){J=J===u?1:xo(ir(J),0);var ge=this.__filtered__&&!D?new Mr(this):this.clone();return ge.__filtered__?ge.__takeCount__=To(J,ge.__takeCount__):ge.__views__.push({size:To(J,k),type:w+(ge.__dir__<0?"Right":"")}),ge},Mr.prototype[w+"Right"]=function(J){return this.reverse()[w](J).reverse()}})),Bc(["filter","map","takeWhile"],(function(w,D){var J=D+1,ge=J==1||J==3;Mr.prototype[w]=function(ke){var Ge=this.clone();return Ge.__iteratees__.push({iteratee:lr(ke,3),type:J}),Ge.__filtered__=Ge.__filtered__||ge,Ge}})),Bc(["head","last"],(function(w,D){var J="take"+(D?"Right":"");Mr.prototype[w]=function(){return this[J](1).value()[0]}})),Bc(["initial","tail"],(function(w,D){var J="drop"+(D?"":"Right");Mr.prototype[w]=function(){return this.__filtered__?new Mr(this):this[J](1)}})),Mr.prototype.compact=function(){return this.filter(Ni)},Mr.prototype.find=function(w){return this.filter(w).head()},Mr.prototype.findLast=function(w){return this.reverse().find(w)},Mr.prototype.invokeMap=Kr((function(w,D){return typeof w=="function"?new Mr(this):this.map((function(J){return Hc(J,w,D)}))})),Mr.prototype.reject=function(w){return this.filter(Ma(lr(w)))},Mr.prototype.slice=function(w,D){w=ir(w);var J=this;return J.__filtered__&&(w>0||D<0)?new Mr(J):(w<0?J=J.takeRight(-w):w&&(J=J.drop(w)),D!==u&&(J=(D=ir(D))<0?J.dropRight(-D):J.take(D-w)),J)},Mr.prototype.takeRightWhile=function(w){return this.reverse().takeWhile(w).reverse()},Mr.prototype.toArray=function(){return this.take(k)},Ns(Mr.prototype,(function(w,D){var J=/^(?:filter|find|map|reject)|While$/.test(D),ge=/^(?:head|last)$/.test(D),ke=Ue[ge?"take"+(D=="last"?"Right":""):D],Ge=ge||/^find/.test(D);ke&&(Ue.prototype[D]=function(){var st=this.__wrapped__,dt=ge?[1]:arguments,xt=st instanceof Mr,Gt=dt[0],Wt=xt||cr(st),un=function(nr){var Jt=ke.apply(Ue,lc([nr],dt));return ge&&Vn?Jt[0]:Jt};Wt&&J&&typeof Gt=="function"&&Gt.length!=1&&(xt=Wt=!1);var Vn=this.__chain__,qn=!!this.__actions__.length,sr=Ge&&!Vn,Vt=xt&&!qn;if(!Ge&&Wt){st=Vt?st:new Mr(this);var tn=w.apply(st,dt);return tn.__actions__.push({func:uh,args:[un],thisArg:u}),new ia(tn,Vn)}return sr&&Vt?w.apply(this,dt):(tn=this.thru(un),sr?ge?tn.value()[0]:tn.value():tn)})})),Bc(["pop","push","shift","sort","splice","unshift"],(function(w){var D=Bp[w],J=/^(?:push|sort|unshift)$/.test(w)?"tap":"thru",ge=/^(?:pop|shift)$/.test(w);Ue.prototype[w]=function(){var ke=arguments;if(ge&&!this.__chain__){var Ge=this.value();return D.apply(cr(Ge)?Ge:[],ke)}return this[J]((function(st){return D.apply(cr(st)?st:[],ke)}))}})),Ns(Mr.prototype,(function(w,D){var J=Ue[D];if(J){var ge=J.name+"";Ti.call(wo,ge)||(wo[ge]=[]),wo[ge].push({name:D,func:J})}})),wo[Kf(u,2).name]=[{name:"wrapper",func:u}],Mr.prototype.clone=function(){var w=new Mr(this.__wrapped__);return w.__actions__=mc(this.__actions__),w.__dir__=this.__dir__,w.__filtered__=this.__filtered__,w.__iteratees__=mc(this.__iteratees__),w.__takeCount__=this.__takeCount__,w.__views__=mc(this.__views__),w},Mr.prototype.reverse=function(){if(this.__filtered__){var w=new Mr(this);w.__dir__=-1,w.__filtered__=!0}else(w=this.clone()).__dir__*=-1;return w},Mr.prototype.value=function(){var w=this.__wrapped__.value(),D=this.__dir__,J=cr(w),ge=D<0,ke=J?w.length:0,Ge=(function(Gn,bn,wn){for(var Vr=-1,Zi=wn.length;++Vr<Zi;){var fa=wn[Vr],Ei=fa.size;switch(fa.type){case"drop":Gn+=Ei;break;case"dropRight":bn-=Ei;break;case"take":bn=To(bn,Gn+Ei);break;case"takeRight":Gn=xo(Gn,bn-Ei)}}return{start:Gn,end:bn}})(0,ke,this.__views__),st=Ge.start,dt=Ge.end,xt=dt-st,Gt=ge?dt:st-1,Wt=this.__iteratees__,un=Wt.length,Vn=0,qn=To(xt,this.__takeCount__);if(!J||!ge&&ke==xt&&qn==xt)return sh(w,this.__actions__);var sr=[];e:for(;xt--&&Vn<qn;){for(var Vt=-1,tn=w[Gt+=D];++Vt<un;){var nr=Wt[Vt],Jt=nr.iteratee,Cn=nr.type,Tn=Jt(tn);if(Cn==2)tn=Tn;else if(!Tn){if(Cn==1)continue e;break e}}sr[Vn++]=tn}return sr},Ue.prototype.at=hh,Ue.prototype.chain=function(){return zo(this)},Ue.prototype.commit=function(){return new ia(this.value(),this.__chain__)},Ue.prototype.next=function(){this.__values__===u&&(this.__values__=of(this.value()));var w=this.__index__>=this.__values__.length;return{done:w,value:w?u:this.__values__[this.__index__++]}},Ue.prototype.plant=function(w){for(var D,J=this;J instanceof zl;){var ge=Uy(J);ge.__index__=0,ge.__values__=u,D?ke.__wrapped__=ge:D=ge;var ke=ge;J=J.__wrapped__}return ke.__wrapped__=w,D},Ue.prototype.reverse=function(){var w=this.__wrapped__;if(w instanceof Mr){var D=w;return this.__actions__.length&&(D=new Mr(this)),(D=D.reverse()).__actions__.push({func:uh,args:[Vy],thisArg:u}),new ia(D,this.__chain__)}return this.thru(Vy)},Ue.prototype.toJSON=Ue.prototype.valueOf=Ue.prototype.value=function(){return sh(this.__wrapped__,this.__actions__)},Ue.prototype.first=Ue.prototype.head,Jh&&(Ue.prototype[Jh]=function(){return this}),Ue})();xn._=Up,(l=(function(){return Up}).call(a,c,a,o))===u||(o.exports=l)}).call(this)},5364:(o,a,c)=>{var l=c(5250),u=c(999)((function(h,f,d){l(h,f,d)}));o.exports=u},9935:o=>{o.exports=function(){return!1}},9884:(o,a,c)=>{var l=c(1791),u=c(7241);o.exports=function(h){return l(h,u(h))}},5602:o=>{var a=o.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(c){return c.encoding?"rtpmap:%d %s/%s/%s":c.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(c){return c.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(c){return c.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(c){return"extmap:%d"+(c.direction?"/%s":"%v")+(c["encrypt-uri"]?" %s":"%v")+" %s"+(c.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(c){return c.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(c){var l="candidate:%s %d %s %d %s %d typ %s";return l+=c.raddr!=null?" raddr %s rport %d":"%v%v",l+=c.tcptype!=null?" tcptype %s":"%v",c.generation!=null&&(l+=" generation %d"),l+=c["network-id"]!=null?" network-id %d":"%v",l+=c["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(c){var l="ssrc:%d";return c.attribute!=null&&(l+=" %s",c.value!=null&&(l+=":%s")),l}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(c){return c.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(c){return c.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(c){return"imageattr:%s %s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(c){return"simulcast:%s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(c){return"ts-refclk:%s"+(c.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(c){var l="mediaclk:";return l+=c.id!=null?"id=%s %s":"%v%s",l+=c.mediaClockValue!=null?"=%s":"",l+=c.rateNumerator!=null?" rate=%s":"",l+=c.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(a).forEach((function(c){a[c].forEach((function(l){l.reg||(l.reg=/(.*)/),l.format||(l.format="%s")}))}))},7363:(o,a,c)=>{var l=c(5020),u=c(3804);a.M9=u,a.qg=l.parse,a.Sl=l.parseParams,l.parseFmtpConfig,l.parsePayloads,l.parseRemoteCandidates,l.parseImageAttributes,l.parseSimulcastStreamList},5020:(o,a,c)=>{var l=function(p){return String(Number(p))===p?Number(p):p},u=function(p,_,g){var m=p.name&&p.names;p.push&&!_[p.push]?_[p.push]=[]:m&&!_[p.name]&&(_[p.name]={});var b=p.push?{}:m?_[p.name]:_;(function(y,x,T,k){if(k&&!T)x[k]=l(y[1]);else for(var R=0;R<T.length;R+=1)y[R+1]!=null&&(x[T[R]]=l(y[R+1]))})(g.match(p.reg),b,p.names,p.name),p.push&&_[p.push].push(b)},h=c(5602),f=RegExp.prototype.test.bind(/^([a-z])=(.*)/);a.parse=function(p){var _={},g=[],m=_;return p.split(/(\r\n|\r|\n)/).filter(f).forEach((function(b){var y=b[0],x=b.slice(2);y==="m"&&(g.push({rtp:[],fmtp:[]}),m=g[g.length-1]);for(var T=0;T<(h[y]||[]).length;T+=1){var k=h[y][T];if(k.reg.test(x))return u(k,m,x)}})),_.media=g,_};var d=function(p,_){var g=_.split(/=(.+)/,2);return g.length===2?p[g[0]]=l(g[1]):g.length===1&&_.length>1&&(p[g[0]]=void 0),p};a.parseParams=function(p){return p.split(/;\s?/).reduce(d,{})},a.parseFmtpConfig=a.parseParams,a.parsePayloads=function(p){return p.toString().split(" ").map(Number)},a.parseRemoteCandidates=function(p){for(var _=[],g=p.split(" ").map(l),m=0;m<g.length;m+=3)_.push({component:g[m],ip:g[m+1],port:g[m+2]});return _},a.parseImageAttributes=function(p){return p.split(" ").map((function(_){return _.substring(1,_.length-1).split(",").reduce(d,{})}))},a.parseSimulcastStreamList=function(p){return p.split(";").map((function(_){return _.split(",").map((function(g){var m,b=!1;return g[0]!=="~"?m=l(g):(m=l(g.substring(1,g.length)),b=!0),{scid:m,paused:b}}))}))}},3804:(o,a,c)=>{var l=c(5602),u=/%[sdv%]/g,h=function(_){var g=1,m=arguments,b=m.length;return _.replace(u,(function(y){if(g>=b)return y;var x=m[g];switch(g+=1,y){case"%%":return"%";case"%s":return String(x);case"%d":return Number(x);case"%v":return""}}))},f=function(_,g,m){var b=[_+"="+(g.format instanceof Function?g.format(g.push?m:m[g.name]):g.format)];if(g.names)for(var y=0;y<g.names.length;y+=1){var x=g.names[y];g.name?b.push(m[g.name][x]):b.push(m[g.names[y]])}else b.push(m[g.name]);return h.apply(null,b)},d=["v","o","s","i","u","e","p","c","b","t","r","z","a"],p=["i","c","b","a"];o.exports=function(_,g){g=g||{},_.version==null&&(_.version=0),_.name==null&&(_.name=" "),_.media.forEach((function(x){x.payloads==null&&(x.payloads="")}));var m=g.outerOrder||d,b=g.innerOrder||p,y=[];return m.forEach((function(x){l[x].forEach((function(T){T.name in _&&_[T.name]!=null?y.push(f(x,T,_)):T.push in _&&_[T.push]!=null&&_[T.push].forEach((function(k){y.push(f(x,T,k))}))}))})),_.media.forEach((function(x){y.push(f("m",l.m[0],x)),b.forEach((function(T){l[T].forEach((function(k){k.name in x&&x[k.name]!=null?y.push(f(T,k,x)):k.push in x&&x[k.push]!=null&&x[k.push].forEach((function(R){y.push(f(T,k,R))}))}))}))})),y.join(`\r
`)+`\r
`}},7963:o=>{const a={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};a.localCName=a.generateIdentifier(),a.splitLines=function(c){return c.trim().split(`
`).map((l=>l.trim()))},a.splitSections=function(c){return c.split(`
m=`).map(((l,u)=>(u>0?"m="+l:l).trim()+`\r
`))},a.getDescription=function(c){const l=a.splitSections(c);return l&&l[0]},a.getMediaSections=function(c){const l=a.splitSections(c);return l.shift(),l},a.matchPrefix=function(c,l){return a.splitLines(c).filter((u=>u.indexOf(l)===0))},a.parseCandidate=function(c){let l;l=c.indexOf("a=candidate:")===0?c.substring(12).split(" "):c.substring(10).split(" ");const u={foundation:l[0],component:{1:"rtp",2:"rtcp"}[l[1]]||l[1],protocol:l[2].toLowerCase(),priority:parseInt(l[3],10),ip:l[4],address:l[4],port:parseInt(l[5],10),type:l[7]};for(let h=8;h<l.length;h+=2)switch(l[h]){case"raddr":u.relatedAddress=l[h+1];break;case"rport":u.relatedPort=parseInt(l[h+1],10);break;case"tcptype":u.tcpType=l[h+1];break;case"ufrag":u.ufrag=l[h+1],u.usernameFragment=l[h+1];break;default:u[l[h]]===void 0&&(u[l[h]]=l[h+1])}return u},a.writeCandidate=function(c){const l=[];l.push(c.foundation);const u=c.component;u==="rtp"?l.push(1):u==="rtcp"?l.push(2):l.push(u),l.push(c.protocol.toUpperCase()),l.push(c.priority),l.push(c.address||c.ip),l.push(c.port);const h=c.type;return l.push("typ"),l.push(h),h!=="host"&&c.relatedAddress&&c.relatedPort&&(l.push("raddr"),l.push(c.relatedAddress),l.push("rport"),l.push(c.relatedPort)),c.tcpType&&c.protocol.toLowerCase()==="tcp"&&(l.push("tcptype"),l.push(c.tcpType)),(c.usernameFragment||c.ufrag)&&(l.push("ufrag"),l.push(c.usernameFragment||c.ufrag)),"candidate:"+l.join(" ")},a.parseIceOptions=function(c){return c.substring(14).split(" ")},a.parseRtpMap=function(c){let l=c.substring(9).split(" ");const u={payloadType:parseInt(l.shift(),10)};return l=l[0].split("/"),u.name=l[0],u.clockRate=parseInt(l[1],10),u.channels=l.length===3?parseInt(l[2],10):1,u.numChannels=u.channels,u},a.writeRtpMap=function(c){let l=c.payloadType;c.preferredPayloadType!==void 0&&(l=c.preferredPayloadType);const u=c.channels||c.numChannels||1;return"a=rtpmap:"+l+" "+c.name+"/"+c.clockRate+(u!==1?"/"+u:"")+`\r
`},a.parseExtmap=function(c){const l=c.substring(9).split(" ");return{id:parseInt(l[0],10),direction:l[0].indexOf("/")>0?l[0].split("/")[1]:"sendrecv",uri:l[1],attributes:l.slice(2).join(" ")}},a.writeExtmap=function(c){return"a=extmap:"+(c.id||c.preferredId)+(c.direction&&c.direction!=="sendrecv"?"/"+c.direction:"")+" "+c.uri+(c.attributes?" "+c.attributes:"")+`\r
`},a.parseFmtp=function(c){const l={};let u;const h=c.substring(c.indexOf(" ")+1).split(";");for(let f=0;f<h.length;f++)u=h[f].trim().split("="),l[u[0].trim()]=u[1];return l},a.writeFmtp=function(c){let l="",u=c.payloadType;if(c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.parameters&&Object.keys(c.parameters).length){const h=[];Object.keys(c.parameters).forEach((f=>{c.parameters[f]!==void 0?h.push(f+"="+c.parameters[f]):h.push(f)})),l+="a=fmtp:"+u+" "+h.join(";")+`\r
`}return l},a.parseRtcpFb=function(c){const l=c.substring(c.indexOf(" ")+1).split(" ");return{type:l.shift(),parameter:l.join(" ")}},a.writeRtcpFb=function(c){let l="",u=c.payloadType;return c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.rtcpFeedback&&c.rtcpFeedback.length&&c.rtcpFeedback.forEach((h=>{l+="a=rtcp-fb:"+u+" "+h.type+(h.parameter&&h.parameter.length?" "+h.parameter:"")+`\r
`})),l},a.parseSsrcMedia=function(c){const l=c.indexOf(" "),u={ssrc:parseInt(c.substring(7,l),10)},h=c.indexOf(":",l);return h>-1?(u.attribute=c.substring(l+1,h),u.value=c.substring(h+1)):u.attribute=c.substring(l+1),u},a.parseSsrcGroup=function(c){const l=c.substring(13).split(" ");return{semantics:l.shift(),ssrcs:l.map((u=>parseInt(u,10)))}},a.getMid=function(c){const l=a.matchPrefix(c,"a=mid:")[0];if(l)return l.substring(6)},a.parseFingerprint=function(c){const l=c.substring(14).split(" ");return{algorithm:l[0].toLowerCase(),value:l[1].toUpperCase()}},a.getDtlsParameters=function(c,l){return{role:"auto",fingerprints:a.matchPrefix(c+l,"a=fingerprint:").map(a.parseFingerprint)}},a.writeDtlsParameters=function(c,l){let u="a=setup:"+l+`\r
`;return c.fingerprints.forEach((h=>{u+="a=fingerprint:"+h.algorithm+" "+h.value+`\r
`})),u},a.parseCryptoLine=function(c){const l=c.substring(9).split(" ");return{tag:parseInt(l[0],10),cryptoSuite:l[1],keyParams:l[2],sessionParams:l.slice(3)}},a.writeCryptoLine=function(c){return"a=crypto:"+c.tag+" "+c.cryptoSuite+" "+(typeof c.keyParams=="object"?a.writeCryptoKeyParams(c.keyParams):c.keyParams)+(c.sessionParams?" "+c.sessionParams.join(" "):"")+`\r
`},a.parseCryptoKeyParams=function(c){if(c.indexOf("inline:")!==0)return null;const l=c.substring(7).split("|");return{keyMethod:"inline",keySalt:l[0],lifeTime:l[1],mkiValue:l[2]?l[2].split(":")[0]:void 0,mkiLength:l[2]?l[2].split(":")[1]:void 0}},a.writeCryptoKeyParams=function(c){return c.keyMethod+":"+c.keySalt+(c.lifeTime?"|"+c.lifeTime:"")+(c.mkiValue&&c.mkiLength?"|"+c.mkiValue+":"+c.mkiLength:"")},a.getCryptoParameters=function(c,l){return a.matchPrefix(c+l,"a=crypto:").map(a.parseCryptoLine)},a.getIceParameters=function(c,l){const u=a.matchPrefix(c+l,"a=ice-ufrag:")[0],h=a.matchPrefix(c+l,"a=ice-pwd:")[0];return u&&h?{usernameFragment:u.substring(12),password:h.substring(10)}:null},a.writeIceParameters=function(c){let l="a=ice-ufrag:"+c.usernameFragment+`\r
a=ice-pwd:`+c.password+`\r
`;return c.iceLite&&(l+=`a=ice-lite\r
`),l},a.parseRtpParameters=function(c){const l={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},u=a.splitLines(c)[0].split(" ");l.profile=u[2];for(let f=3;f<u.length;f++){const d=u[f],p=a.matchPrefix(c,"a=rtpmap:"+d+" ")[0];if(p){const _=a.parseRtpMap(p),g=a.matchPrefix(c,"a=fmtp:"+d+" ");switch(_.parameters=g.length?a.parseFmtp(g[0]):{},_.rtcpFeedback=a.matchPrefix(c,"a=rtcp-fb:"+d+" ").map(a.parseRtcpFb),l.codecs.push(_),_.name.toUpperCase()){case"RED":case"ULPFEC":l.fecMechanisms.push(_.name.toUpperCase())}}}a.matchPrefix(c,"a=extmap:").forEach((f=>{l.headerExtensions.push(a.parseExtmap(f))}));const h=a.matchPrefix(c,"a=rtcp-fb:* ").map(a.parseRtcpFb);return l.codecs.forEach((f=>{h.forEach((d=>{f.rtcpFeedback.find((p=>p.type===d.type&&p.parameter===d.parameter))||f.rtcpFeedback.push(d)}))})),l},a.writeRtpDescription=function(c,l){let u="";u+="m="+c+" ",u+=l.codecs.length>0?"9":"0",u+=" "+(l.profile||"UDP/TLS/RTP/SAVPF")+" ",u+=l.codecs.map((f=>f.preferredPayloadType!==void 0?f.preferredPayloadType:f.payloadType)).join(" ")+`\r
`,u+=`c=IN IP4 0.0.0.0\r
`,u+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,l.codecs.forEach((f=>{u+=a.writeRtpMap(f),u+=a.writeFmtp(f),u+=a.writeRtcpFb(f)}));let h=0;return l.codecs.forEach((f=>{f.maxptime>h&&(h=f.maxptime)})),h>0&&(u+="a=maxptime:"+h+`\r
`),l.headerExtensions&&l.headerExtensions.forEach((f=>{u+=a.writeExtmap(f)})),u},a.parseRtpEncodingParameters=function(c){const l=[],u=a.parseRtpParameters(c),h=u.fecMechanisms.indexOf("RED")!==-1,f=u.fecMechanisms.indexOf("ULPFEC")!==-1,d=a.matchPrefix(c,"a=ssrc:").map((b=>a.parseSsrcMedia(b))).filter((b=>b.attribute==="cname")),p=d.length>0&&d[0].ssrc;let _;const g=a.matchPrefix(c,"a=ssrc-group:FID").map((b=>b.substring(17).split(" ").map((y=>parseInt(y,10)))));g.length>0&&g[0].length>1&&g[0][0]===p&&(_=g[0][1]),u.codecs.forEach((b=>{if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){let y={ssrc:p,codecPayloadType:parseInt(b.parameters.apt,10)};p&&_&&(y.rtx={ssrc:_}),l.push(y),h&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:p,mechanism:f?"red+ulpfec":"red"},l.push(y))}})),l.length===0&&p&&l.push({ssrc:p});let m=a.matchPrefix(c,"b=");return m.length&&(m=m[0].indexOf("b=TIAS:")===0?parseInt(m[0].substring(7),10):m[0].indexOf("b=AS:")===0?1e3*parseInt(m[0].substring(5),10)*.95-16e3:void 0,l.forEach((b=>{b.maxBitrate=m}))),l},a.parseRtcpParameters=function(c){const l={},u=a.matchPrefix(c,"a=ssrc:").map((d=>a.parseSsrcMedia(d))).filter((d=>d.attribute==="cname"))[0];u&&(l.cname=u.value,l.ssrc=u.ssrc);const h=a.matchPrefix(c,"a=rtcp-rsize");l.reducedSize=h.length>0,l.compound=h.length===0;const f=a.matchPrefix(c,"a=rtcp-mux");return l.mux=f.length>0,l},a.writeRtcpParameters=function(c){let l="";return c.reducedSize&&(l+=`a=rtcp-rsize\r
`),c.mux&&(l+=`a=rtcp-mux\r
`),c.ssrc!==void 0&&c.cname&&(l+="a=ssrc:"+c.ssrc+" cname:"+c.cname+`\r
`),l},a.parseMsid=function(c){let l;const u=a.matchPrefix(c,"a=msid:");if(u.length===1)return l=u[0].substring(7).split(" "),{stream:l[0],track:l[1]};const h=a.matchPrefix(c,"a=ssrc:").map((f=>a.parseSsrcMedia(f))).filter((f=>f.attribute==="msid"));return h.length>0?(l=h[0].value.split(" "),{stream:l[0],track:l[1]}):void 0},a.parseSctpDescription=function(c){const l=a.parseMLine(c),u=a.matchPrefix(c,"a=max-message-size:");let h;u.length>0&&(h=parseInt(u[0].substring(19),10)),isNaN(h)&&(h=65536);const f=a.matchPrefix(c,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substring(12),10),protocol:l.fmt,maxMessageSize:h};const d=a.matchPrefix(c,"a=sctpmap:");if(d.length>0){const p=d[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:h}}},a.writeSctpDescription=function(c,l){let u=[];return u=c.protocol!=="DTLS/SCTP"?["m="+c.kind+" 9 "+c.protocol+" "+l.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+l.port+`\r
`]:["m="+c.kind+" 9 "+c.protocol+" "+l.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+l.port+" "+l.protocol+` 65535\r
`],l.maxMessageSize!==void 0&&u.push("a=max-message-size:"+l.maxMessageSize+`\r
`),u.join("")},a.generateSessionId=function(){return Math.random().toString().substr(2,22)},a.writeSessionBoilerplate=function(c,l,u){let h;const f=l!==void 0?l:2;return h=c||a.generateSessionId(),`v=0\r
o=`+(u||"thisisadapterortc")+" "+h+" "+f+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},a.getDirection=function(c,l){const u=a.splitLines(c);for(let h=0;h<u.length;h++)switch(u[h]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return u[h].substring(2)}return l?a.getDirection(l):"sendrecv"},a.getKind=function(c){return a.splitLines(c)[0].split(" ")[0].substring(2)},a.isRejected=function(c){return c.split(" ",2)[1]==="0"},a.parseMLine=function(c){const l=a.splitLines(c)[0].substring(2).split(" ");return{kind:l[0],port:parseInt(l[1],10),protocol:l[2],fmt:l.slice(3).join(" ")}},a.parseOLine=function(c){const l=a.matchPrefix(c,"o=")[0].substring(2).split(" ");return{username:l[0],sessionId:l[1],sessionVersion:parseInt(l[2],10),netType:l[3],addressType:l[4],address:l[5]}},a.isValidSDP=function(c){if(typeof c!="string"||c.length===0)return!1;const l=a.splitLines(c);for(let u=0;u<l.length;u++)if(l[u].length<2||l[u].charAt(1)!=="=")return!1;return!0},o.exports=a},5512:o=>{o.exports=function(a,c,l,u){var h=self||window;try{try{var f;try{f=new h.Blob([a])}catch{(f=new(h.BlobBuilder||h.WebKitBlobBuilder||h.MozBlobBuilder||h.MSBlobBuilder)).append(a),f=f.getBlob()}var d=h.URL||h.webkitURL,p=d.createObjectURL(f),_=new h[c](p,l);return d.revokeObjectURL(p),_}catch{return new h[c]("data:application/javascript,".concat(encodeURIComponent(a)),l)}}catch{if(!u)throw Error("Inline worker is not supported");return new h[c](u,l)}}},8630:(o,a,c)=>{var l;(function(u){(function(){var h=typeof globalThis=="object"?globalThis:typeof c.g=="object"?c.g:typeof self=="object"?self:typeof this=="object"?this:(function(){try{return Function("return this;")()}catch{}})()||(function(){try{return(0,eval)("(function() { return this; })()")}catch{}})(),f=d(u);function d(p,_){return function(g,m){Object.defineProperty(p,g,{configurable:!0,writable:!0,value:m}),_&&_(g,m)}}h.Reflect!==void 0&&(f=d(h.Reflect,f)),(function(p,_){var g=Object.prototype.hasOwnProperty,m=typeof Symbol=="function",b=m&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",y=m&&Symbol.iterator!==void 0?Symbol.iterator:"@@iterator",x=typeof Object.create=="function",T={__proto__:[]}instanceof Array,k=!x&&!T,R={create:x?function(){return ct(Object.create(null))}:T?function(){return ct({__proto__:null})}:function(){return ct({})},has:k?function(Fe,rt){return g.call(Fe,rt)}:function(Fe,rt){return rt in Fe},get:k?function(Fe,rt){return g.call(Fe,rt)?Fe[rt]:void 0}:function(Fe,rt){return Fe[rt]}},P=Object.getPrototypeOf(Function),B=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ve(),U=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:je(),z=typeof WeakMap=="function"?WeakMap:We(),I=m?Symbol.for("@reflect-metadata:registry"):void 0,L=ye(),M=ve(L);function F(Fe,rt,it,St){if(Ne(it)){if(!Ze(Fe))throw new TypeError;if(!nt(rt))throw new TypeError;return ae(Fe,rt)}if(!Ze(Fe))throw new TypeError;if(!Oe(rt))throw new TypeError;if(!Oe(St)&&!Ne(St)&&!Be(St))throw new TypeError;return Be(St)&&(St=void 0),Te(Fe,rt,it=ze(it),St)}function Z(Fe,rt){function it(St,at){if(!Oe(St))throw new TypeError;if(!Ne(at)&&!Pt(at))throw new TypeError;tt(Fe,rt,St,at)}return it}function $(Fe,rt,it,St){if(!Oe(it))throw new TypeError;return Ne(St)||(St=ze(St)),tt(Fe,rt,it,St)}function Y(Fe,rt,it){if(!Oe(rt))throw new TypeError;return Ne(it)||(it=ze(it)),Ie(Fe,rt,it)}function Q(Fe,rt,it){if(!Oe(rt))throw new TypeError;return Ne(it)||(it=ze(it)),be(Fe,rt,it)}function q(Fe,rt,it){if(!Oe(rt))throw new TypeError;return Ne(it)||(it=ze(it)),Pe(Fe,rt,it)}function V(Fe,rt,it){if(!Oe(rt))throw new TypeError;return Ne(it)||(it=ze(it)),$e(Fe,rt,it)}function K(Fe,rt){if(!Oe(Fe))throw new TypeError;return Ne(rt)||(rt=ze(rt)),qe(Fe,rt)}function ne(Fe,rt){if(!Oe(Fe))throw new TypeError;return Ne(rt)||(rt=ze(rt)),ut(Fe,rt)}function ie(Fe,rt,it){if(!Oe(rt))throw new TypeError;if(Ne(it)||(it=ze(it)),!Oe(rt))throw new TypeError;Ne(it)||(it=ze(it));var St=Me(rt,it,!1);return!Ne(St)&&St.OrdinaryDeleteMetadata(Fe,rt,it)}function ae(Fe,rt){for(var it=Fe.length-1;it>=0;--it){var St=(0,Fe[it])(rt);if(!Ne(St)&&!Be(St)){if(!nt(St))throw new TypeError;rt=St}}return rt}function Te(Fe,rt,it,St){for(var at=Fe.length-1;at>=0;--at){var Yt=(0,Fe[at])(rt,it,St);if(!Ne(Yt)&&!Be(Yt)){if(!Oe(Yt))throw new TypeError;St=Yt}}return St}function Ie(Fe,rt,it){if(be(Fe,rt,it))return!0;var St=Se(rt);return!Be(St)&&Ie(Fe,St,it)}function be(Fe,rt,it){var St=Me(rt,it,!1);return!Ne(St)&&we(St.OrdinaryHasOwnMetadata(Fe,rt,it))}function Pe(Fe,rt,it){if(be(Fe,rt,it))return $e(Fe,rt,it);var St=Se(rt);return Be(St)?void 0:Pe(Fe,St,it)}function $e(Fe,rt,it){var St=Me(rt,it,!1);if(!Ne(St))return St.OrdinaryGetOwnMetadata(Fe,rt,it)}function tt(Fe,rt,it,St){Me(it,St,!0).OrdinaryDefineOwnMetadata(Fe,rt,it,St)}function qe(Fe,rt){var it=ut(Fe,rt),St=Se(Fe);if(St===null)return it;var at=qe(St,rt);if(at.length<=0)return it;if(it.length<=0)return at;for(var Yt=new U,sn=[],Rt=0,Ut=it;Rt<Ut.length;Rt++){var _t=Ut[Rt];Yt.has(_t)||(Yt.add(_t),sn.push(_t))}for(var Ht=0,_n=at;Ht<_n.length;Ht++)_t=_n[Ht],Yt.has(_t)||(Yt.add(_t),sn.push(_t));return sn}function ut(Fe,rt){var it=Me(Fe,rt,!1);return it?it.OrdinaryOwnMetadataKeys(Fe,rt):[]}function te(Fe){if(Fe===null)return 1;switch(typeof Fe){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Fe===null?1:6;default:return 6}}function Ne(Fe){return Fe===void 0}function Be(Fe){return Fe===null}function De(Fe){return typeof Fe=="symbol"}function Oe(Fe){return typeof Fe=="object"?Fe!==null:typeof Fe=="function"}function ue(Fe,rt){switch(te(Fe)){case 0:case 1:case 2:case 3:case 4:case 5:return Fe}var it="string",St=At(Fe,b);if(St!==void 0){var at=St.call(Fe,it);if(Oe(at))throw new TypeError;return at}return _e(Fe)}function _e(Fe,rt){var it,St;{var at=Fe.toString;if(Je(at)&&!Oe(St=at.call(Fe))||Je(it=Fe.valueOf)&&!Oe(St=it.call(Fe)))return St}throw new TypeError}function we(Fe){return!!Fe}function pe(Fe){return""+Fe}function ze(Fe){var rt=ue(Fe);return De(rt)?rt:pe(rt)}function Ze(Fe){return Array.isArray?Array.isArray(Fe):Fe instanceof Object?Fe instanceof Array:Object.prototype.toString.call(Fe)==="[object Array]"}function Je(Fe){return typeof Fe=="function"}function nt(Fe){return typeof Fe=="function"}function Pt(Fe){switch(te(Fe)){case 3:case 4:return!0;default:return!1}}function vt(Fe,rt){return Fe===rt||Fe!=Fe&&rt!=rt}function At(Fe,rt){var it=Fe[rt];if(it!=null){if(!Je(it))throw new TypeError;return it}}function Re(Fe){var rt=At(Fe,y);if(!Je(rt))throw new TypeError;var it=rt.call(Fe);if(!Oe(it))throw new TypeError;return it}function ce(Fe){return Fe.value}function W(Fe){var rt=Fe.next();return!rt.done&&rt}function le(Fe){var rt=Fe.return;rt&&rt.call(Fe)}function Se(Fe){var rt=Object.getPrototypeOf(Fe);if(typeof Fe!="function"||Fe===P||rt!==P)return rt;var it=Fe.prototype,St=it&&Object.getPrototypeOf(it);if(St==null||St===Object.prototype)return rt;var at=St.constructor;return typeof at!="function"||at===Fe?rt:at}function Ae(){var Fe,rt,it,St;Ne(I)||_.Reflect===void 0||I in _.Reflect||typeof _.Reflect.defineMetadata!="function"||(Fe=Xe(_.Reflect));var at=new z,Yt={registerProvider:sn,getProvider:Ut,setProvider:Ht};return Yt;function sn(_n){if(!Object.isExtensible(Yt))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case Fe===_n:break;case Ne(rt):rt=_n;break;case rt===_n:break;case Ne(it):it=_n;break;case it===_n:break;default:St===void 0&&(St=new U),St.add(_n)}}function Rt(_n,jt){if(!Ne(rt)){if(rt.isProviderFor(_n,jt))return rt;if(!Ne(it)){if(it.isProviderFor(_n,jt))return rt;if(!Ne(St))for(var mn=Re(St);;){var Rn=W(mn);if(!Rn)return;var Un=ce(Rn);if(Un.isProviderFor(_n,jt))return le(mn),Un}}}if(!Ne(Fe)&&Fe.isProviderFor(_n,jt))return Fe}function Ut(_n,jt){var mn,Rn=at.get(_n);return Ne(Rn)||(mn=Rn.get(jt)),Ne(mn)&&(Ne(mn=Rt(_n,jt))||(Ne(Rn)&&(Rn=new B,at.set(_n,Rn)),Rn.set(jt,mn))),mn}function _t(_n){if(Ne(_n))throw new TypeError;return rt===_n||it===_n||!Ne(St)&&St.has(_n)}function Ht(_n,jt,mn){if(!_t(mn))throw new Error("Metadata provider not registered.");var Rn=Ut(_n,jt);if(Rn!==mn){if(!Ne(Rn))return!1;var Un=at.get(_n);Ne(Un)&&(Un=new B,at.set(_n,Un)),Un.set(jt,mn)}return!0}}function ye(){var Fe;return!Ne(I)&&Oe(_.Reflect)&&Object.isExtensible(_.Reflect)&&(Fe=_.Reflect[I]),Ne(Fe)&&(Fe=Ae()),!Ne(I)&&Oe(_.Reflect)&&Object.isExtensible(_.Reflect)&&Object.defineProperty(_.Reflect,I,{enumerable:!1,configurable:!1,writable:!1,value:Fe}),Fe}function ve(Fe){var rt=new z,it={isProviderFor:function(_t,Ht){var _n=rt.get(_t);return!Ne(_n)&&_n.has(Ht)},OrdinaryDefineOwnMetadata:sn,OrdinaryHasOwnMetadata:at,OrdinaryGetOwnMetadata:Yt,OrdinaryOwnMetadataKeys:Rt,OrdinaryDeleteMetadata:Ut};return L.registerProvider(it),it;function St(_t,Ht,_n){var jt=rt.get(_t),mn=!1;if(Ne(jt)){if(!_n)return;jt=new B,rt.set(_t,jt),mn=!0}var Rn=jt.get(Ht);if(Ne(Rn)){if(!_n)return;if(Rn=new B,jt.set(Ht,Rn),!Fe.setProvider(_t,Ht,it))throw jt.delete(Ht),mn&&rt.delete(_t),new Error("Wrong provider for target.")}return Rn}function at(_t,Ht,_n){var jt=St(Ht,_n,!1);return!Ne(jt)&&we(jt.has(_t))}function Yt(_t,Ht,_n){var jt=St(Ht,_n,!1);if(!Ne(jt))return jt.get(_t)}function sn(_t,Ht,_n,jt){St(_n,jt,!0).set(_t,Ht)}function Rt(_t,Ht){var _n=[],jt=St(_t,Ht,!1);if(Ne(jt))return _n;for(var mn=Re(jt.keys()),Rn=0;;){var Un=W(mn);if(!Un)return _n.length=Rn,_n;var qi=ce(Un);try{_n[Rn]=qi}catch(oi){try{le(mn)}finally{throw oi}}Rn++}}function Ut(_t,Ht,_n){var jt=St(Ht,_n,!1);if(Ne(jt)||!jt.delete(_t))return!1;if(jt.size===0){var mn=rt.get(Ht);Ne(mn)||(mn.delete(_n),mn.size===0&&rt.delete(mn))}return!0}}function Xe(Fe){var rt=Fe.defineMetadata,it=Fe.hasOwnMetadata,St=Fe.getOwnMetadata,at=Fe.getOwnMetadataKeys,Yt=Fe.deleteMetadata,sn=new z;return{isProviderFor:function(Rt,Ut){var _t=sn.get(Rt);return!(Ne(_t)||!_t.has(Ut))||!!at(Rt,Ut).length&&(Ne(_t)&&(_t=new U,sn.set(Rt,_t)),_t.add(Ut),!0)},OrdinaryDefineOwnMetadata:rt,OrdinaryHasOwnMetadata:it,OrdinaryGetOwnMetadata:St,OrdinaryOwnMetadataKeys:at,OrdinaryDeleteMetadata:Yt}}function Me(Fe,rt,it){var St=L.getProvider(Fe,rt);if(!Ne(St))return St;if(it){if(L.setProvider(Fe,rt,M))return M;throw new Error("Illegal state.")}}function Ve(){var Fe={},rt=[],it=(function(){function sn(Rt,Ut,_t){this._index=0,this._keys=Rt,this._values=Ut,this._selector=_t}return sn.prototype["@@iterator"]=function(){return this},sn.prototype[y]=function(){return this},sn.prototype.next=function(){var Rt=this._index;if(Rt>=0&&Rt<this._keys.length){var Ut=this._selector(this._keys[Rt],this._values[Rt]);return Rt+1>=this._keys.length?(this._index=-1,this._keys=rt,this._values=rt):this._index++,{value:Ut,done:!1}}return{value:void 0,done:!0}},sn.prototype.throw=function(Rt){throw this._index>=0&&(this._index=-1,this._keys=rt,this._values=rt),Rt},sn.prototype.return=function(Rt){return this._index>=0&&(this._index=-1,this._keys=rt,this._values=rt),{value:Rt,done:!0}},sn})();return(function(){function sn(){this._keys=[],this._values=[],this._cacheKey=Fe,this._cacheIndex=-2}return Object.defineProperty(sn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),sn.prototype.has=function(Rt){return this._find(Rt,!1)>=0},sn.prototype.get=function(Rt){var Ut=this._find(Rt,!1);return Ut>=0?this._values[Ut]:void 0},sn.prototype.set=function(Rt,Ut){var _t=this._find(Rt,!0);return this._values[_t]=Ut,this},sn.prototype.delete=function(Rt){var Ut=this._find(Rt,!1);if(Ut>=0){for(var _t=this._keys.length,Ht=Ut+1;Ht<_t;Ht++)this._keys[Ht-1]=this._keys[Ht],this._values[Ht-1]=this._values[Ht];return this._keys.length--,this._values.length--,vt(Rt,this._cacheKey)&&(this._cacheKey=Fe,this._cacheIndex=-2),!0}return!1},sn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Fe,this._cacheIndex=-2},sn.prototype.keys=function(){return new it(this._keys,this._values,St)},sn.prototype.values=function(){return new it(this._keys,this._values,at)},sn.prototype.entries=function(){return new it(this._keys,this._values,Yt)},sn.prototype["@@iterator"]=function(){return this.entries()},sn.prototype[y]=function(){return this.entries()},sn.prototype._find=function(Rt,Ut){if(!vt(this._cacheKey,Rt)){this._cacheIndex=-1;for(var _t=0;_t<this._keys.length;_t++)if(vt(this._keys[_t],Rt)){this._cacheIndex=_t;break}}return this._cacheIndex<0&&Ut&&(this._cacheIndex=this._keys.length,this._keys.push(Rt),this._values.push(void 0)),this._cacheIndex},sn})();function St(sn,Rt){return sn}function at(sn,Rt){return Rt}function Yt(sn,Rt){return[sn,Rt]}}function je(){return(function(){function Fe(){this._map=new B}return Object.defineProperty(Fe.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Fe.prototype.has=function(rt){return this._map.has(rt)},Fe.prototype.add=function(rt){return this._map.set(rt,rt),this},Fe.prototype.delete=function(rt){return this._map.delete(rt)},Fe.prototype.clear=function(){this._map.clear()},Fe.prototype.keys=function(){return this._map.keys()},Fe.prototype.values=function(){return this._map.keys()},Fe.prototype.entries=function(){return this._map.entries()},Fe.prototype["@@iterator"]=function(){return this.keys()},Fe.prototype[y]=function(){return this.keys()},Fe})()}function We(){var Fe=16,rt=R.create(),it=St();return(function(){function Ut(){this._key=St()}return Ut.prototype.has=function(_t){var Ht=at(_t,!1);return Ht!==void 0&&R.has(Ht,this._key)},Ut.prototype.get=function(_t){var Ht=at(_t,!1);return Ht!==void 0?R.get(Ht,this._key):void 0},Ut.prototype.set=function(_t,Ht){return at(_t,!0)[this._key]=Ht,this},Ut.prototype.delete=function(_t){var Ht=at(_t,!1);return Ht!==void 0&&delete Ht[this._key]},Ut.prototype.clear=function(){this._key=St()},Ut})();function St(){var Ut;do Ut="@@WeakMap@@"+Rt();while(R.has(rt,Ut));return rt[Ut]=!0,Ut}function at(Ut,_t){if(!g.call(Ut,it)){if(!_t)return;Object.defineProperty(Ut,it,{value:R.create()})}return Ut[it]}function Yt(Ut,_t){for(var Ht=0;Ht<_t;++Ht)Ut[Ht]=255*Math.random()|0;return Ut}function sn(Ut){if(typeof Uint8Array=="function"){var _t=new Uint8Array(Ut);return typeof crypto<"u"?crypto.getRandomValues(_t):typeof msCrypto<"u"?msCrypto.getRandomValues(_t):Yt(_t,Ut),_t}return Yt(new Array(Ut),Ut)}function Rt(){var Ut=sn(Fe);Ut[6]=79&Ut[6]|64,Ut[8]=191&Ut[8]|128;for(var _t="",Ht=0;Ht<Fe;++Ht){var _n=Ut[Ht];Ht!==4&&Ht!==6&&Ht!==8||(_t+="-"),_n<16&&(_t+="0"),_t+=_n.toString(16).toLowerCase()}return _t}}function ct(Fe){return Fe.__=void 0,delete Fe.__,Fe}p("decorate",F),p("metadata",Z),p("defineMetadata",$),p("hasMetadata",Y),p("hasOwnMetadata",Q),p("getMetadata",q),p("getOwnMetadata",V),p("getMetadataKeys",K),p("getOwnMetadataKeys",ne),p("deleteMetadata",ie)})(f,h),h.Reflect===void 0&&(h.Reflect=u)})()})(l||(l={}))}},r={};function i(o){var a=r[o];if(a!==void 0)return a.exports;var c=r[o]={id:o,loaded:!1,exports:{}};return t[o].call(c.exports,c,c.exports,i),c.loaded=!0,c.exports}i.n=o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return i.d(a,{a}),a},i.d=(o,a)=>{for(var c in a)i.o(a,c)&&!i.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:a[c]})},i.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),i.o=(o,a)=>Object.prototype.hasOwnProperty.call(o,a),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i.nmd=o=>(o.paths=[],o.children||(o.children=[]),o);var s={};return(()=>{i.r(s),i.d(s,{BASIC_FULL_HD_LANDSCAPE:()=>pr,BASIC_FULL_HD_PORTRAIT:()=>On,BASIC_LANDSCAPE:()=>Dr,BASIC_PORTRAIT:()=>Qn,BroadcastClientError:()=>ve,BroadcastClientEvents:()=>uc,ConnectionState:()=>Zn,Errors:()=>u,InitialLayerPreference:()=>ra,JitterBufferMinDelay:()=>Es,LOG_LEVEL:()=>W,LocalStageStream:()=>fa,LocalStageStreamEvents:()=>Cn,LogLevels:()=>W,RemoteStageStream:()=>mh,RemoteStageStreamEvents:()=>nr,SIMULCAST_DUPLICATE_LAYERS_CONFIGURED:()=>vS,SIMULCAST_LAYER_CONFIGURATION_CONFLICT:()=>rg,SIMULCAST_LAYER_INPUT_FRAMERATE_INSUFFICIENT:()=>Ma,SIMULCAST_LAYER_INPUT_RESOLUTION_INSUFFICIENT:()=>fh,SIMULCAST_LAYER_INVALID_TYPE:()=>rf,SIMULCAST_LAYER_ORIENTATION_MISMATCH:()=>Xd,SIMULCAST_MAX_LAYERS_EXCEEDED:()=>Wy,SIMULCAST_MAX_LAYER_BITRATE_EXCEEDED:()=>Ro,SIMULCAST_MAX_LAYER_DIMENSIONS_EXCEEDED:()=>tv,SIMULCAST_MAX_LAYER_FRAMERATE_EXCEEDED:()=>qy,SIMULCAST_MIN_LAYER_BITRATE_EXCEEDED:()=>Q_,SIMULCAST_MIN_LAYER_DIMENSIONS_EXCEEDED:()=>nv,SIMULCAST_MIN_LAYER_FRAMERATE_EXCEEDED:()=>ev,SIMULCAST_UNSUPPORTED:()=>_S,STAGE_MAX_AUDIO_BITRATE_KBPS:()=>em,STAGE_MAX_AUDIO_BITRATE_KBPS_DEFAULT:()=>Q0,STAGE_MAX_BITRATE:()=>ch,STAGE_MAX_FRAMERATE:()=>lh,STAGE_MAX_RESOLUTION:()=>Yd,STAGE_MIN_AUDIO_BITRATE_KBPS:()=>J0,STAGE_MIN_BITRATE:()=>Zf,STAGE_MIN_FRAMERATE:()=>Qp,STAGE_MIN_RESOLUTION:()=>qd,STANDARD_LANDSCAPE:()=>Fs,STANDARD_PORTRAIT:()=>So,SimulcastLayerPresets:()=>Jp,Stage:()=>ht,StageConnectionState:()=>Xi,StageErrorCategory:()=>J,StageErrorCode:()=>ge,StageEvents:()=>N,StageLeftReason:()=>Tt,StageParticipantPublishState:()=>wn,StageParticipantSubscribeState:()=>Vr,StageStream:()=>Gn,StageStreamLayerSelectedReason:()=>Jt,StreamType:()=>vr,SubscribeType:()=>Ho,__version:()=>H_,create:()=>V0,default:()=>qt,isSupported:()=>ce});var o={};i.r(o),i.d(o,{fixNegotiationNeeded:()=>Q,shimAddTrackRemoveTrack:()=>$,shimAddTrackRemoveTrackWithNative:()=>Z,shimGetDisplayMedia:()=>U,shimGetSendersWithDtmf:()=>L,shimGetStats:()=>M,shimGetUserMedia:()=>B,shimMediaStream:()=>z,shimOnTrack:()=>I,shimPeerConnection:()=>Y,shimSenderReceiverGetStats:()=>F});var a={};i.r(a),i.d(a,{shimAddTransceiver:()=>be,shimCreateAnswer:()=>tt,shimCreateOffer:()=>$e,shimGetDisplayMedia:()=>V,shimGetParameters:()=>Pe,shimGetUserMedia:()=>q,shimOnTrack:()=>K,shimPeerConnection:()=>ne,shimRTCDataChannel:()=>Ie,shimReceiverGetStats:()=>ae,shimRemoveStream:()=>Te,shimSenderGetStats:()=>ie});var c={};i.r(c),i.d(c,{shimAudioContext:()=>_e,shimCallbacksAPI:()=>te,shimConstraints:()=>Be,shimCreateOfferLegacy:()=>ue,shimGetUserMedia:()=>Ne,shimLocalStreamsAPI:()=>qe,shimRTCIceServerUrls:()=>De,shimRemoteStreamsAPI:()=>ut,shimTrackEventTransceiver:()=>Oe});var l={};i.r(l),i.d(l,{removeExtmapAllowMixed:()=>vt,shimAddIceCandidateNullOrEmpty:()=>At,shimConnectionState:()=>Pt,shimMaxMessageSize:()=>Je,shimParameterlessSetLocalDescription:()=>Re,shimRTCIceCandidate:()=>ze,shimRTCIceCandidateRelayProtocol:()=>Ze,shimSendThrowTypeError:()=>nt});var u={};i.r(u),i.d(u,{ADD_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>Fe,ADD_DEVICE_COMPOSITION_MISSING_ERROR:()=>ct,ADD_DEVICE_CONSTRAINTS_ERROR:()=>St,ADD_DEVICE_DEVICE_ERROR:()=>je,ADD_DEVICE_NAME_EXISTS_ERROR:()=>We,ADD_DEVICE_NAME_MISSING_ERROR:()=>rt,ADD_DEVICE_UNSUPPORTED:()=>it,BROADCAST_CONFIGURATION_ERROR:()=>Rn,BROADCAST_ERROR:()=>Xe,CAMERA_ERROR:()=>Me,CLIENT_INVALID_ERROR:()=>Is,EXCHANGE_POSITION_DEVICE_NOT_FOUND_ERROR:()=>_t,FAILED_TO_ADD_IMAGE_ERROR:()=>Ht,INGEST_ENDPOINT_TYPE_ERROR:()=>qi,INGEST_ENDPOINT_URL_ERROR:()=>oi,INPUT_ERROR:()=>Ve,INVALID_STREAM_KEY:()=>mn,LOGGER_TYPE_ERROR:()=>ys,LOG_LEVEL_TYPE_ERROR:()=>_i,NETWORK_RECONNECT_CONFIGURATION_ERROR:()=>Ui,NETWORK_RECONNECT_CONFIGURATION_INVALID_TIMEOUT_ERROR:()=>us,PEER_CONNECTION_ERROR:()=>jt,PEER_SETUP_ERROR:()=>_n,REMOVE_DEVICE_NOT_FOUND_ERROR:()=>at,REMOVE_IMAGE_NOT_FOUND_ERROR:()=>Yt,STAGE_TOKEN_TYPE_ERROR:()=>Le,STAGE_WHIP_OVERRIDE_ERROR:()=>mt,STREAM_CONFIGURATION_ERROR:()=>Un,STREAM_KEY_INVALID_CHAR_ERROR:()=>hs,UPDATE_VIDEO_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>Rt,UPDATE_VIDEO_DEVICE_COMPOSITION_MISSING_ERROR:()=>sn,UPDATE_VIDEO_DEVICE_COMPOSITION_NAME_NOT_FOUND_ERROR:()=>Ut});var h={};i.r(h),i.d(h,{BASIC_FULL_HD_LANDSCAPE:()=>pr,BASIC_FULL_HD_PORTRAIT:()=>On,BASIC_LANDSCAPE:()=>Dr,BASIC_PORTRAIT:()=>Qn,BroadcastClientError:()=>ve,BroadcastClientEvents:()=>uc,ConnectionState:()=>Zn,Errors:()=>u,LOG_LEVEL:()=>W,LogLevels:()=>W,STANDARD_LANDSCAPE:()=>Fs,STANDARD_PORTRAIT:()=>So,__version:()=>H_,create:()=>V0,isSupported:()=>ce});let f=!0,d=!0;function p(C,E,A){const O=C.match(E);return O&&O.length>=A&&parseInt(O[A],10)}function _(C,E,A){if(!C.RTCPeerConnection)return;const O=C.RTCPeerConnection.prototype,j=O.addEventListener;O.addEventListener=function(X,re){if(X!==E)return j.apply(this,arguments);const se=ee=>{const he=A(ee);he&&(re.handleEvent?re.handleEvent(he):re(he))};return this._eventMap=this._eventMap||{},this._eventMap[E]||(this._eventMap[E]=new Map),this._eventMap[E].set(re,se),j.apply(this,[X,se])};const H=O.removeEventListener;O.removeEventListener=function(X,re){if(X!==E||!this._eventMap||!this._eventMap[E])return H.apply(this,arguments);if(!this._eventMap[E].has(re))return H.apply(this,arguments);const se=this._eventMap[E].get(re);return this._eventMap[E].delete(re),this._eventMap[E].size===0&&delete this._eventMap[E],Object.keys(this._eventMap).length===0&&delete this._eventMap,H.apply(this,[X,se])},Object.defineProperty(O,"on"+E,{get(){return this["_on"+E]},set(X){this["_on"+E]&&(this.removeEventListener(E,this["_on"+E]),delete this["_on"+E]),X&&this.addEventListener(E,this["_on"+E]=X)},enumerable:!0,configurable:!0})}function g(C){return typeof C!="boolean"?new Error("Argument type: "+typeof C+". Please use a boolean."):(f=C,C?"adapter.js logging disabled":"adapter.js logging enabled")}function m(C){return typeof C!="boolean"?new Error("Argument type: "+typeof C+". Please use a boolean."):(d=!C,"adapter.js deprecation warnings "+(C?"disabled":"enabled"))}function b(){if(typeof window=="object"){if(f)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function y(C,E){d&&console.warn(C+" is deprecated, please use "+E+" instead.")}function x(C){return Object.prototype.toString.call(C)==="[object Object]"}function T(C){return x(C)?Object.keys(C).reduce((function(E,A){const O=x(C[A]),j=O?T(C[A]):C[A],H=O&&!Object.keys(j).length;return j===void 0||H?E:Object.assign(E,{[A]:j})}),{}):C}function k(C,E,A){E&&!A.has(E.id)&&(A.set(E.id,E),Object.keys(E).forEach((O=>{O.endsWith("Id")?k(C,C.get(E[O]),A):O.endsWith("Ids")&&E[O].forEach((j=>{k(C,C.get(j),A)}))})))}function R(C,E,A){const O=A?"outbound-rtp":"inbound-rtp",j=new Map;if(E===null)return j;const H=[];return C.forEach((X=>{X.type==="track"&&X.trackIdentifier===E.id&&H.push(X)})),H.forEach((X=>{C.forEach((re=>{re.type===O&&re.trackId===X.id&&k(C,re,j)}))})),j}const P=b;function B(C,E){const A=C&&C.navigator;if(!A.mediaDevices)return;const O=function(X){if(typeof X!="object"||X.mandatory||X.optional)return X;const re={};return Object.keys(X).forEach((se=>{if(se==="require"||se==="advanced"||se==="mediaSource")return;const ee=typeof X[se]=="object"?X[se]:{ideal:X[se]};ee.exact!==void 0&&typeof ee.exact=="number"&&(ee.min=ee.max=ee.exact);const he=function(Ee,Ce){return Ee?Ee+Ce.charAt(0).toUpperCase()+Ce.slice(1):Ce==="deviceId"?"sourceId":Ce};if(ee.ideal!==void 0){re.optional=re.optional||[];let Ee={};typeof ee.ideal=="number"?(Ee[he("min",se)]=ee.ideal,re.optional.push(Ee),Ee={},Ee[he("max",se)]=ee.ideal,re.optional.push(Ee)):(Ee[he("",se)]=ee.ideal,re.optional.push(Ee))}ee.exact!==void 0&&typeof ee.exact!="number"?(re.mandatory=re.mandatory||{},re.mandatory[he("",se)]=ee.exact):["min","max"].forEach((Ee=>{ee[Ee]!==void 0&&(re.mandatory=re.mandatory||{},re.mandatory[he(Ee,se)]=ee[Ee])}))})),X.advanced&&(re.optional=(re.optional||[]).concat(X.advanced)),re},j=function(X,re){if(E.version>=61)return re(X);if((X=JSON.parse(JSON.stringify(X)))&&typeof X.audio=="object"){const se=function(ee,he,Ee){he in ee&&!(Ee in ee)&&(ee[Ee]=ee[he],delete ee[he])};se((X=JSON.parse(JSON.stringify(X))).audio,"autoGainControl","googAutoGainControl"),se(X.audio,"noiseSuppression","googNoiseSuppression"),X.audio=O(X.audio)}if(X&&typeof X.video=="object"){let se=X.video.facingMode;se=se&&(typeof se=="object"?se:{ideal:se});const ee=E.version<66;if(se&&(se.exact==="user"||se.exact==="environment"||se.ideal==="user"||se.ideal==="environment")&&(!A.mediaDevices.getSupportedConstraints||!A.mediaDevices.getSupportedConstraints().facingMode||ee)){let he;if(delete X.video.facingMode,se.exact==="environment"||se.ideal==="environment"?he=["back","rear"]:se.exact!=="user"&&se.ideal!=="user"||(he=["front"]),he)return A.mediaDevices.enumerateDevices().then((Ee=>{let Ce=(Ee=Ee.filter((Ye=>Ye.kind==="videoinput"))).find((Ye=>he.some((gt=>Ye.label.toLowerCase().includes(gt)))));return!Ce&&Ee.length&&he.includes("back")&&(Ce=Ee[Ee.length-1]),Ce&&(X.video.deviceId=se.exact?{exact:Ce.deviceId}:{ideal:Ce.deviceId}),X.video=O(X.video),P("chrome: "+JSON.stringify(X)),re(X)}))}X.video=O(X.video)}return P("chrome: "+JSON.stringify(X)),re(X)},H=function(X){return E.version>=64?X:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[X.name]||X.name,message:X.message,constraint:X.constraint||X.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(A.getUserMedia=(function(X,re,se){j(X,(ee=>{A.webkitGetUserMedia(ee,re,(he=>{se&&se(H(he))}))}))}).bind(A),A.mediaDevices.getUserMedia){const X=A.mediaDevices.getUserMedia.bind(A.mediaDevices);A.mediaDevices.getUserMedia=function(re){return j(re,(se=>X(se).then((ee=>{if(se.audio&&!ee.getAudioTracks().length||se.video&&!ee.getVideoTracks().length)throw ee.getTracks().forEach((he=>{he.stop()})),new DOMException("","NotFoundError");return ee}),(ee=>Promise.reject(H(ee))))))}}}function U(C,E){C.navigator.mediaDevices&&"getDisplayMedia"in C.navigator.mediaDevices||C.navigator.mediaDevices&&(typeof E=="function"?C.navigator.mediaDevices.getDisplayMedia=function(A){return E(A).then((O=>{const j=A.video&&A.video.width,H=A.video&&A.video.height,X=A.video&&A.video.frameRate;return A.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:O,maxFrameRate:X||3}},j&&(A.video.mandatory.maxWidth=j),H&&(A.video.mandatory.maxHeight=H),C.navigator.mediaDevices.getUserMedia(A)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function z(C){C.MediaStream=C.MediaStream||C.webkitMediaStream}function I(C){if(typeof C=="object"&&C.RTCPeerConnection&&!("ontrack"in C.RTCPeerConnection.prototype)){Object.defineProperty(C.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(A){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=A)},enumerable:!0,configurable:!0});const E=C.RTCPeerConnection.prototype.setRemoteDescription;C.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=A=>{A.stream.addEventListener("addtrack",(O=>{let j;j=C.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((X=>X.track&&X.track.id===O.track.id)):{track:O.track};const H=new Event("track");H.track=O.track,H.receiver=j,H.transceiver={receiver:j},H.streams=[A.stream],this.dispatchEvent(H)})),A.stream.getTracks().forEach((O=>{let j;j=C.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((X=>X.track&&X.track.id===O.id)):{track:O};const H=new Event("track");H.track=O,H.receiver=j,H.transceiver={receiver:j},H.streams=[A.stream],this.dispatchEvent(H)}))},this.addEventListener("addstream",this._ontrackpoly)),E.apply(this,arguments)}}else _(C,"track",(E=>(E.transceiver||Object.defineProperty(E,"transceiver",{value:{receiver:E.receiver}}),E)))}function L(C){if(typeof C=="object"&&C.RTCPeerConnection&&!("getSenders"in C.RTCPeerConnection.prototype)&&"createDTMFSender"in C.RTCPeerConnection.prototype){const E=function(j,H){return{track:H,get dtmf(){return this._dtmf===void 0&&(H.kind==="audio"?this._dtmf=j.createDTMFSender(H):this._dtmf=null),this._dtmf},_pc:j}};if(!C.RTCPeerConnection.prototype.getSenders){C.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const j=C.RTCPeerConnection.prototype.addTrack;C.RTCPeerConnection.prototype.addTrack=function(X,re){let se=j.apply(this,arguments);return se||(se=E(this,X),this._senders.push(se)),se};const H=C.RTCPeerConnection.prototype.removeTrack;C.RTCPeerConnection.prototype.removeTrack=function(X){H.apply(this,arguments);const re=this._senders.indexOf(X);re!==-1&&this._senders.splice(re,1)}}const A=C.RTCPeerConnection.prototype.addStream;C.RTCPeerConnection.prototype.addStream=function(j){this._senders=this._senders||[],A.apply(this,[j]),j.getTracks().forEach((H=>{this._senders.push(E(this,H))}))};const O=C.RTCPeerConnection.prototype.removeStream;C.RTCPeerConnection.prototype.removeStream=function(j){this._senders=this._senders||[],O.apply(this,[j]),j.getTracks().forEach((H=>{const X=this._senders.find((re=>re.track===H));X&&this._senders.splice(this._senders.indexOf(X),1)}))}}else if(typeof C=="object"&&C.RTCPeerConnection&&"getSenders"in C.RTCPeerConnection.prototype&&"createDTMFSender"in C.RTCPeerConnection.prototype&&C.RTCRtpSender&&!("dtmf"in C.RTCRtpSender.prototype)){const E=C.RTCPeerConnection.prototype.getSenders;C.RTCPeerConnection.prototype.getSenders=function(){const A=E.apply(this,[]);return A.forEach((O=>O._pc=this)),A},Object.defineProperty(C.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function M(C){if(!C.RTCPeerConnection)return;const E=C.RTCPeerConnection.prototype.getStats;C.RTCPeerConnection.prototype.getStats=function(){const[A,O,j]=arguments;if(arguments.length>0&&typeof A=="function")return E.apply(this,arguments);if(E.length===0&&(arguments.length===0||typeof A!="function"))return E.apply(this,[]);const H=function(re){const se={};return re.result().forEach((ee=>{const he={id:ee.id,timestamp:ee.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[ee.type]||ee.type};ee.names().forEach((Ee=>{he[Ee]=ee.stat(Ee)})),se[he.id]=he})),se},X=function(re){return new Map(Object.keys(re).map((se=>[se,re[se]])))};if(arguments.length>=2){const re=function(se){O(X(H(se)))};return E.apply(this,[re,A])}return new Promise(((re,se)=>{E.apply(this,[function(ee){re(X(H(ee)))},se])})).then(O,j)}}function F(C){if(!(typeof C=="object"&&C.RTCPeerConnection&&C.RTCRtpSender&&C.RTCRtpReceiver))return;if(!("getStats"in C.RTCRtpSender.prototype)){const A=C.RTCPeerConnection.prototype.getSenders;A&&(C.RTCPeerConnection.prototype.getSenders=function(){const j=A.apply(this,[]);return j.forEach((H=>H._pc=this)),j});const O=C.RTCPeerConnection.prototype.addTrack;O&&(C.RTCPeerConnection.prototype.addTrack=function(){const j=O.apply(this,arguments);return j._pc=this,j}),C.RTCRtpSender.prototype.getStats=function(){const j=this;return this._pc.getStats().then((H=>R(H,j.track,!0)))}}if(!("getStats"in C.RTCRtpReceiver.prototype)){const A=C.RTCPeerConnection.prototype.getReceivers;A&&(C.RTCPeerConnection.prototype.getReceivers=function(){const O=A.apply(this,[]);return O.forEach((j=>j._pc=this)),O}),_(C,"track",(O=>(O.receiver._pc=O.srcElement,O))),C.RTCRtpReceiver.prototype.getStats=function(){const O=this;return this._pc.getStats().then((j=>R(j,O.track,!1)))}}if(!("getStats"in C.RTCRtpSender.prototype)||!("getStats"in C.RTCRtpReceiver.prototype))return;const E=C.RTCPeerConnection.prototype.getStats;C.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof C.MediaStreamTrack){const A=arguments[0];let O,j,H;return this.getSenders().forEach((X=>{X.track===A&&(O?H=!0:O=X)})),this.getReceivers().forEach((X=>(X.track===A&&(j?H=!0:j=X),X.track===A))),H||O&&j?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):O?O.getStats():j?j.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return E.apply(this,arguments)}}function Z(C){C.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((H=>this._shimmedLocalStreams[H][0]))};const E=C.RTCPeerConnection.prototype.addTrack;C.RTCPeerConnection.prototype.addTrack=function(H,X){if(!X)return E.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const re=E.apply(this,arguments);return this._shimmedLocalStreams[X.id]?this._shimmedLocalStreams[X.id].indexOf(re)===-1&&this._shimmedLocalStreams[X.id].push(re):this._shimmedLocalStreams[X.id]=[X,re],re};const A=C.RTCPeerConnection.prototype.addStream;C.RTCPeerConnection.prototype.addStream=function(H){this._shimmedLocalStreams=this._shimmedLocalStreams||{},H.getTracks().forEach((se=>{if(this.getSenders().find((ee=>ee.track===se)))throw new DOMException("Track already exists.","InvalidAccessError")}));const X=this.getSenders();A.apply(this,arguments);const re=this.getSenders().filter((se=>X.indexOf(se)===-1));this._shimmedLocalStreams[H.id]=[H].concat(re)};const O=C.RTCPeerConnection.prototype.removeStream;C.RTCPeerConnection.prototype.removeStream=function(H){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[H.id],O.apply(this,arguments)};const j=C.RTCPeerConnection.prototype.removeTrack;C.RTCPeerConnection.prototype.removeTrack=function(H){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},H&&Object.keys(this._shimmedLocalStreams).forEach((X=>{const re=this._shimmedLocalStreams[X].indexOf(H);re!==-1&&this._shimmedLocalStreams[X].splice(re,1),this._shimmedLocalStreams[X].length===1&&delete this._shimmedLocalStreams[X]})),j.apply(this,arguments)}}function $(C,E){if(!C.RTCPeerConnection)return;if(C.RTCPeerConnection.prototype.addTrack&&E.version>=65)return Z(C);const A=C.RTCPeerConnection.prototype.getLocalStreams;C.RTCPeerConnection.prototype.getLocalStreams=function(){const se=A.apply(this);return this._reverseStreams=this._reverseStreams||{},se.map((ee=>this._reverseStreams[ee.id]))};const O=C.RTCPeerConnection.prototype.addStream;C.RTCPeerConnection.prototype.addStream=function(se){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},se.getTracks().forEach((ee=>{if(this.getSenders().find((he=>he.track===ee)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[se.id]){const ee=new C.MediaStream(se.getTracks());this._streams[se.id]=ee,this._reverseStreams[ee.id]=se,se=ee}O.apply(this,[se])};const j=C.RTCPeerConnection.prototype.removeStream;function H(se,ee){let he=ee.sdp;return Object.keys(se._reverseStreams||[]).forEach((Ee=>{const Ce=se._reverseStreams[Ee],Ye=se._streams[Ce.id];he=he.replace(new RegExp(Ye.id,"g"),Ce.id)})),new RTCSessionDescription({type:ee.type,sdp:he})}C.RTCPeerConnection.prototype.removeStream=function(se){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},j.apply(this,[this._streams[se.id]||se]),delete this._reverseStreams[this._streams[se.id]?this._streams[se.id].id:se.id],delete this._streams[se.id]},C.RTCPeerConnection.prototype.addTrack=function(se,ee){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const he=[].slice.call(arguments,1);if(he.length!==1||!he[0].getTracks().find((Ce=>Ce===se)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((Ce=>Ce.track===se)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const Ee=this._streams[ee.id];if(Ee)Ee.addTrack(se),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const Ce=new C.MediaStream([se]);this._streams[ee.id]=Ce,this._reverseStreams[Ce.id]=ee,this.addStream(Ce)}return this.getSenders().find((Ce=>Ce.track===se))},["createOffer","createAnswer"].forEach((function(se){const ee=C.RTCPeerConnection.prototype[se],he={[se](){const Ee=arguments;return arguments.length&&typeof arguments[0]=="function"?ee.apply(this,[Ce=>{const Ye=H(this,Ce);Ee[0].apply(null,[Ye])},Ce=>{Ee[1]&&Ee[1].apply(null,Ce)},arguments[2]]):ee.apply(this,arguments).then((Ce=>H(this,Ce)))}};C.RTCPeerConnection.prototype[se]=he[se]}));const X=C.RTCPeerConnection.prototype.setLocalDescription;C.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(se,ee){let he=ee.sdp;return Object.keys(se._reverseStreams||[]).forEach((Ee=>{const Ce=se._reverseStreams[Ee],Ye=se._streams[Ce.id];he=he.replace(new RegExp(Ce.id,"g"),Ye.id)})),new RTCSessionDescription({type:ee.type,sdp:he})})(this,arguments[0]),X.apply(this,arguments)):X.apply(this,arguments)};const re=Object.getOwnPropertyDescriptor(C.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(C.RTCPeerConnection.prototype,"localDescription",{get(){const se=re.get.apply(this);return se.type===""?se:H(this,se)}}),C.RTCPeerConnection.prototype.removeTrack=function(se){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!se._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(se._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let ee;this._streams=this._streams||{},Object.keys(this._streams).forEach((he=>{this._streams[he].getTracks().find((Ee=>se.track===Ee))&&(ee=this._streams[he])})),ee&&(ee.getTracks().length===1?this.removeStream(this._reverseStreams[ee.id]):ee.removeTrack(se.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Y(C,E){!C.RTCPeerConnection&&C.webkitRTCPeerConnection&&(C.RTCPeerConnection=C.webkitRTCPeerConnection),C.RTCPeerConnection&&E.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(A){const O=C.RTCPeerConnection.prototype[A],j={[A](){return arguments[0]=new(A==="addIceCandidate"?C.RTCIceCandidate:C.RTCSessionDescription)(arguments[0]),O.apply(this,arguments)}};C.RTCPeerConnection.prototype[A]=j[A]}))}function Q(C,E){_(C,"negotiationneeded",(A=>{const O=A.target;if(!(E.version<72||O.getConfiguration&&O.getConfiguration().sdpSemantics==="plan-b")||O.signalingState==="stable")return A}))}function q(C,E){const A=C&&C.navigator,O=C&&C.MediaStreamTrack;if(A.getUserMedia=function(j,H,X){y("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),A.mediaDevices.getUserMedia(j).then(H,X)},!(E.version>55&&"autoGainControl"in A.mediaDevices.getSupportedConstraints())){const j=function(X,re,se){re in X&&!(se in X)&&(X[se]=X[re],delete X[re])},H=A.mediaDevices.getUserMedia.bind(A.mediaDevices);if(A.mediaDevices.getUserMedia=function(X){return typeof X=="object"&&typeof X.audio=="object"&&(X=JSON.parse(JSON.stringify(X)),j(X.audio,"autoGainControl","mozAutoGainControl"),j(X.audio,"noiseSuppression","mozNoiseSuppression")),H(X)},O&&O.prototype.getSettings){const X=O.prototype.getSettings;O.prototype.getSettings=function(){const re=X.apply(this,arguments);return j(re,"mozAutoGainControl","autoGainControl"),j(re,"mozNoiseSuppression","noiseSuppression"),re}}if(O&&O.prototype.applyConstraints){const X=O.prototype.applyConstraints;O.prototype.applyConstraints=function(re){return this.kind==="audio"&&typeof re=="object"&&(re=JSON.parse(JSON.stringify(re)),j(re,"autoGainControl","mozAutoGainControl"),j(re,"noiseSuppression","mozNoiseSuppression")),X.apply(this,[re])}}}}function V(C,E){C.navigator.mediaDevices&&"getDisplayMedia"in C.navigator.mediaDevices||C.navigator.mediaDevices&&(C.navigator.mediaDevices.getDisplayMedia=function(A){if(!A||!A.video){const O=new DOMException("getDisplayMedia without video constraints is undefined");return O.name="NotFoundError",O.code=8,Promise.reject(O)}return A.video===!0?A.video={mediaSource:E}:A.video.mediaSource=E,C.navigator.mediaDevices.getUserMedia(A)})}function K(C){typeof C=="object"&&C.RTCTrackEvent&&"receiver"in C.RTCTrackEvent.prototype&&!("transceiver"in C.RTCTrackEvent.prototype)&&Object.defineProperty(C.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ne(C,E){if(typeof C!="object"||!C.RTCPeerConnection&&!C.mozRTCPeerConnection)return;!C.RTCPeerConnection&&C.mozRTCPeerConnection&&(C.RTCPeerConnection=C.mozRTCPeerConnection),E.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(j){const H=C.RTCPeerConnection.prototype[j],X={[j](){return arguments[0]=new(j==="addIceCandidate"?C.RTCIceCandidate:C.RTCSessionDescription)(arguments[0]),H.apply(this,arguments)}};C.RTCPeerConnection.prototype[j]=X[j]}));const A={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},O=C.RTCPeerConnection.prototype.getStats;C.RTCPeerConnection.prototype.getStats=function(){const[j,H,X]=arguments;return O.apply(this,[j||null]).then((re=>{if(E.version<53&&!H)try{re.forEach((se=>{se.type=A[se.type]||se.type}))}catch(se){if(se.name!=="TypeError")throw se;re.forEach(((ee,he)=>{re.set(he,Object.assign({},ee,{type:A[ee.type]||ee.type}))}))}return re})).then(H,X)}}function ie(C){if(typeof C!="object"||!C.RTCPeerConnection||!C.RTCRtpSender||C.RTCRtpSender&&"getStats"in C.RTCRtpSender.prototype)return;const E=C.RTCPeerConnection.prototype.getSenders;E&&(C.RTCPeerConnection.prototype.getSenders=function(){const O=E.apply(this,[]);return O.forEach((j=>j._pc=this)),O});const A=C.RTCPeerConnection.prototype.addTrack;A&&(C.RTCPeerConnection.prototype.addTrack=function(){const O=A.apply(this,arguments);return O._pc=this,O}),C.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ae(C){if(typeof C!="object"||!C.RTCPeerConnection||!C.RTCRtpSender||C.RTCRtpSender&&"getStats"in C.RTCRtpReceiver.prototype)return;const E=C.RTCPeerConnection.prototype.getReceivers;E&&(C.RTCPeerConnection.prototype.getReceivers=function(){const A=E.apply(this,[]);return A.forEach((O=>O._pc=this)),A}),_(C,"track",(A=>(A.receiver._pc=A.srcElement,A))),C.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Te(C){C.RTCPeerConnection&&!("removeStream"in C.RTCPeerConnection.prototype)&&(C.RTCPeerConnection.prototype.removeStream=function(E){y("removeStream","removeTrack"),this.getSenders().forEach((A=>{A.track&&E.getTracks().includes(A.track)&&this.removeTrack(A)}))})}function Ie(C){C.DataChannel&&!C.RTCDataChannel&&(C.RTCDataChannel=C.DataChannel)}function be(C){if(typeof C!="object"||!C.RTCPeerConnection)return;const E=C.RTCPeerConnection.prototype.addTransceiver;E&&(C.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let A=arguments[1]&&arguments[1].sendEncodings;A===void 0&&(A=[]),A=[...A];const O=A.length>0;O&&A.forEach((H=>{if("rid"in H&&!/^[a-z0-9]{0,16}$/i.test(H.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in H&&!(parseFloat(H.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in H&&!(parseFloat(H.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const j=E.apply(this,arguments);if(O){const{sender:H}=j,X=H.getParameters();(!("encodings"in X)||X.encodings.length===1&&Object.keys(X.encodings[0]).length===0)&&(X.encodings=A,H.sendEncodings=A,this.setParametersPromises.push(H.setParameters(X).then((()=>{delete H.sendEncodings})).catch((()=>{delete H.sendEncodings}))))}return j})}function Pe(C){if(typeof C!="object"||!C.RTCRtpSender)return;const E=C.RTCRtpSender.prototype.getParameters;E&&(C.RTCRtpSender.prototype.getParameters=function(){const A=E.apply(this,arguments);return"encodings"in A||(A.encodings=[].concat(this.sendEncodings||[{}])),A})}function $e(C){if(typeof C!="object"||!C.RTCPeerConnection)return;const E=C.RTCPeerConnection.prototype.createOffer;C.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>E.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):E.apply(this,arguments)}}function tt(C){if(typeof C!="object"||!C.RTCPeerConnection)return;const E=C.RTCPeerConnection.prototype.createAnswer;C.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>E.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):E.apply(this,arguments)}}function qe(C){if(typeof C=="object"&&C.RTCPeerConnection){if("getLocalStreams"in C.RTCPeerConnection.prototype||(C.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in C.RTCPeerConnection.prototype)){const E=C.RTCPeerConnection.prototype.addTrack;C.RTCPeerConnection.prototype.addStream=function(A){this._localStreams||(this._localStreams=[]),this._localStreams.includes(A)||this._localStreams.push(A),A.getAudioTracks().forEach((O=>E.call(this,O,A))),A.getVideoTracks().forEach((O=>E.call(this,O,A)))},C.RTCPeerConnection.prototype.addTrack=function(A,...O){return O&&O.forEach((j=>{this._localStreams?this._localStreams.includes(j)||this._localStreams.push(j):this._localStreams=[j]})),E.apply(this,arguments)}}"removeStream"in C.RTCPeerConnection.prototype||(C.RTCPeerConnection.prototype.removeStream=function(E){this._localStreams||(this._localStreams=[]);const A=this._localStreams.indexOf(E);if(A===-1)return;this._localStreams.splice(A,1);const O=E.getTracks();this.getSenders().forEach((j=>{O.includes(j.track)&&this.removeTrack(j)}))})}}function ut(C){if(typeof C=="object"&&C.RTCPeerConnection&&("getRemoteStreams"in C.RTCPeerConnection.prototype||(C.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in C.RTCPeerConnection.prototype))){Object.defineProperty(C.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(A){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=A),this.addEventListener("track",this._onaddstreampoly=O=>{O.streams.forEach((j=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(j))return;this._remoteStreams.push(j);const H=new Event("addstream");H.stream=j,this.dispatchEvent(H)}))})}});const E=C.RTCPeerConnection.prototype.setRemoteDescription;C.RTCPeerConnection.prototype.setRemoteDescription=function(){const A=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(O){O.streams.forEach((j=>{if(A._remoteStreams||(A._remoteStreams=[]),A._remoteStreams.indexOf(j)>=0)return;A._remoteStreams.push(j);const H=new Event("addstream");H.stream=j,A.dispatchEvent(H)}))}),E.apply(A,arguments)}}}function te(C){if(typeof C!="object"||!C.RTCPeerConnection)return;const E=C.RTCPeerConnection.prototype,A=E.createOffer,O=E.createAnswer,j=E.setLocalDescription,H=E.setRemoteDescription,X=E.addIceCandidate;E.createOffer=function(se,ee){const he=arguments.length>=2?arguments[2]:arguments[0],Ee=A.apply(this,[he]);return ee?(Ee.then(se,ee),Promise.resolve()):Ee},E.createAnswer=function(se,ee){const he=arguments.length>=2?arguments[2]:arguments[0],Ee=O.apply(this,[he]);return ee?(Ee.then(se,ee),Promise.resolve()):Ee};let re=function(se,ee,he){const Ee=j.apply(this,[se]);return he?(Ee.then(ee,he),Promise.resolve()):Ee};E.setLocalDescription=re,re=function(se,ee,he){const Ee=H.apply(this,[se]);return he?(Ee.then(ee,he),Promise.resolve()):Ee},E.setRemoteDescription=re,re=function(se,ee,he){const Ee=X.apply(this,[se]);return he?(Ee.then(ee,he),Promise.resolve()):Ee},E.addIceCandidate=re}function Ne(C){const E=C&&C.navigator;if(E.mediaDevices&&E.mediaDevices.getUserMedia){const A=E.mediaDevices,O=A.getUserMedia.bind(A);E.mediaDevices.getUserMedia=j=>O(Be(j))}!E.getUserMedia&&E.mediaDevices&&E.mediaDevices.getUserMedia&&(E.getUserMedia=(function(A,O,j){E.mediaDevices.getUserMedia(A).then(O,j)}).bind(E))}function Be(C){return C&&C.video!==void 0?Object.assign({},C,{video:T(C.video)}):C}function De(C){if(!C.RTCPeerConnection)return;const E=C.RTCPeerConnection;C.RTCPeerConnection=function(A,O){if(A&&A.iceServers){const j=[];for(let H=0;H<A.iceServers.length;H++){let X=A.iceServers[H];X.urls===void 0&&X.url?(y("RTCIceServer.url","RTCIceServer.urls"),X=JSON.parse(JSON.stringify(X)),X.urls=X.url,delete X.url,j.push(X)):j.push(A.iceServers[H])}A.iceServers=j}return new E(A,O)},C.RTCPeerConnection.prototype=E.prototype,"generateCertificate"in E&&Object.defineProperty(C.RTCPeerConnection,"generateCertificate",{get:()=>E.generateCertificate})}function Oe(C){typeof C=="object"&&C.RTCTrackEvent&&"receiver"in C.RTCTrackEvent.prototype&&!("transceiver"in C.RTCTrackEvent.prototype)&&Object.defineProperty(C.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ue(C){const E=C.RTCPeerConnection.prototype.createOffer;C.RTCPeerConnection.prototype.createOffer=function(A){if(A){A.offerToReceiveAudio!==void 0&&(A.offerToReceiveAudio=!!A.offerToReceiveAudio);const O=this.getTransceivers().find((H=>H.receiver.track.kind==="audio"));A.offerToReceiveAudio===!1&&O?O.direction==="sendrecv"?O.setDirection?O.setDirection("sendonly"):O.direction="sendonly":O.direction==="recvonly"&&(O.setDirection?O.setDirection("inactive"):O.direction="inactive"):A.offerToReceiveAudio!==!0||O||this.addTransceiver("audio",{direction:"recvonly"}),A.offerToReceiveVideo!==void 0&&(A.offerToReceiveVideo=!!A.offerToReceiveVideo);const j=this.getTransceivers().find((H=>H.receiver.track.kind==="video"));A.offerToReceiveVideo===!1&&j?j.direction==="sendrecv"?j.setDirection?j.setDirection("sendonly"):j.direction="sendonly":j.direction==="recvonly"&&(j.setDirection?j.setDirection("inactive"):j.direction="inactive"):A.offerToReceiveVideo!==!0||j||this.addTransceiver("video",{direction:"recvonly"})}return E.apply(this,arguments)}}function _e(C){typeof C!="object"||C.AudioContext||(C.AudioContext=C.webkitAudioContext)}var we=i(7963),pe=i.n(we);function ze(C){if(!C.RTCIceCandidate||C.RTCIceCandidate&&"foundation"in C.RTCIceCandidate.prototype)return;const E=C.RTCIceCandidate;C.RTCIceCandidate=function(A){if(typeof A=="object"&&A.candidate&&A.candidate.indexOf("a=")===0&&((A=JSON.parse(JSON.stringify(A))).candidate=A.candidate.substring(2)),A.candidate&&A.candidate.length){const O=new E(A),j=pe().parseCandidate(A.candidate);for(const H in j)H in O||Object.defineProperty(O,H,{value:j[H]});return O.toJSON=function(){return{candidate:O.candidate,sdpMid:O.sdpMid,sdpMLineIndex:O.sdpMLineIndex,usernameFragment:O.usernameFragment}},O}return new E(A)},C.RTCIceCandidate.prototype=E.prototype,_(C,"icecandidate",(A=>(A.candidate&&Object.defineProperty(A,"candidate",{value:new C.RTCIceCandidate(A.candidate),writable:"false"}),A)))}function Ze(C){!C.RTCIceCandidate||C.RTCIceCandidate&&"relayProtocol"in C.RTCIceCandidate.prototype||_(C,"icecandidate",(E=>{if(E.candidate){const A=pe().parseCandidate(E.candidate.candidate);A.type==="relay"&&(E.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[A.priority>>24])}return E}))}function Je(C,E){if(!C.RTCPeerConnection)return;"sctp"in C.RTCPeerConnection.prototype||Object.defineProperty(C.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const A=C.RTCPeerConnection.prototype.setRemoteDescription;C.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,E.browser==="chrome"&&E.version>=76){const{sdpSemantics:O}=this.getConfiguration();O==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if((function(O){if(!O||!O.sdp)return!1;const j=pe().splitSections(O.sdp);return j.shift(),j.some((H=>{const X=pe().parseMLine(H);return X&&X.kind==="application"&&X.protocol.indexOf("SCTP")!==-1}))})(arguments[0])){const O=(function(se){const ee=se.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(ee===null||ee.length<2)return-1;const he=parseInt(ee[1],10);return he!=he?-1:he})(arguments[0]),j=(function(se){let ee=65536;return E.browser==="firefox"&&(ee=E.version<57?se===-1?16384:2147483637:E.version<60?E.version===57?65535:65536:2147483637),ee})(O),H=(function(se,ee){let he=65536;E.browser==="firefox"&&E.version===57&&(he=65535);const Ee=pe().matchPrefix(se.sdp,"a=max-message-size:");return Ee.length>0?he=parseInt(Ee[0].substring(19),10):E.browser==="firefox"&&ee!==-1&&(he=2147483637),he})(arguments[0],O);let X;X=j===0&&H===0?Number.POSITIVE_INFINITY:j===0||H===0?Math.max(j,H):Math.min(j,H);const re={};Object.defineProperty(re,"maxMessageSize",{get:()=>X}),this._sctp=re}return A.apply(this,arguments)}}function nt(C){if(!C.RTCPeerConnection||!("createDataChannel"in C.RTCPeerConnection.prototype))return;function E(O,j){const H=O.send;O.send=function(){const X=arguments[0],re=X.length||X.size||X.byteLength;if(O.readyState==="open"&&j.sctp&&re>j.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+j.sctp.maxMessageSize+" bytes)");return H.apply(O,arguments)}}const A=C.RTCPeerConnection.prototype.createDataChannel;C.RTCPeerConnection.prototype.createDataChannel=function(){const O=A.apply(this,arguments);return E(O,this),O},_(C,"datachannel",(O=>(E(O.channel,O.target),O)))}function Pt(C){if(!C.RTCPeerConnection||"connectionState"in C.RTCPeerConnection.prototype)return;const E=C.RTCPeerConnection.prototype;Object.defineProperty(E,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(E,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(A){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),A&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=A)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((A=>{const O=E[A];E[A]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=j=>{const H=j.target;if(H._lastConnectionState!==H.connectionState){H._lastConnectionState=H.connectionState;const X=new Event("connectionstatechange",j);H.dispatchEvent(X)}return j},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),O.apply(this,arguments)}}))}function vt(C,E){if(!C.RTCPeerConnection||E.browser==="chrome"&&E.version>=71||E.browser==="safari"&&E.version>=605)return;const A=C.RTCPeerConnection.prototype.setRemoteDescription;C.RTCPeerConnection.prototype.setRemoteDescription=function(O){if(O&&O.sdp&&O.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const j=O.sdp.split(`
`).filter((H=>H.trim()!=="a=extmap-allow-mixed")).join(`
`);C.RTCSessionDescription&&O instanceof C.RTCSessionDescription?arguments[0]=new C.RTCSessionDescription({type:O.type,sdp:j}):O.sdp=j}return A.apply(this,arguments)}}function At(C,E){if(!C.RTCPeerConnection||!C.RTCPeerConnection.prototype)return;const A=C.RTCPeerConnection.prototype.addIceCandidate;A&&A.length!==0&&(C.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(E.browser==="chrome"&&E.version<78||E.browser==="firefox"&&E.version<68||E.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():A.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Re(C,E){if(!C.RTCPeerConnection||!C.RTCPeerConnection.prototype)return;const A=C.RTCPeerConnection.prototype.setLocalDescription;A&&A.length!==0&&(C.RTCPeerConnection.prototype.setLocalDescription=function(){let O=arguments[0]||{};if(typeof O!="object"||O.type&&O.sdp)return A.apply(this,arguments);if(O={type:O.type,sdp:O.sdp},!O.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":O.type="offer";break;default:O.type="answer"}return O.sdp||O.type!=="offer"&&O.type!=="answer"?A.apply(this,[O]):(O.type==="offer"?this.createOffer:this.createAnswer).apply(this).then((j=>A.apply(this,[j])))})}(function({window:C}={},E={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const A=b,O=(function(H){const X={browser:null,version:null};if(H===void 0||!H.navigator||!H.navigator.userAgent)return X.browser="Not a browser.",X;const{navigator:re}=H;if(re.mozGetUserMedia)X.browser="firefox",X.version=p(re.userAgent,/Firefox\/(\d+)\./,1);else if(re.webkitGetUserMedia||H.isSecureContext===!1&&H.webkitRTCPeerConnection)X.browser="chrome",X.version=p(re.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!H.RTCPeerConnection||!re.userAgent.match(/AppleWebKit\/(\d+)\./))return X.browser="Not a supported browser.",X;X.browser="safari",X.version=p(re.userAgent,/AppleWebKit\/(\d+)\./,1),X.supportsUnifiedPlan=H.RTCRtpTransceiver&&"currentDirection"in H.RTCRtpTransceiver.prototype}return X})(C),j={browserDetails:O,commonShim:l,extractVersion:p,disableLog:g,disableWarnings:m,sdp:we};switch(O.browser){case"chrome":if(!o||!Y||!E.shimChrome)return A("Chrome shim is not included in this adapter release."),j;if(O.version===null)return A("Chrome shim can not determine version, not shimming."),j;A("adapter.js shimming chrome."),j.browserShim=o,At(C,O),Re(C),B(C,O),z(C),Y(C,O),I(C),$(C,O),L(C),M(C),F(C),Q(C,O),ze(C),Ze(C),Pt(C),Je(C,O),nt(C),vt(C,O);break;case"firefox":if(!a||!ne||!E.shimFirefox)return A("Firefox shim is not included in this adapter release."),j;A("adapter.js shimming firefox."),j.browserShim=a,At(C,O),Re(C),q(C,O),ne(C,O),K(C),Te(C),ie(C),ae(C),Ie(C),be(C),Pe(C),$e(C),tt(C),ze(C),Pt(C),Je(C,O),nt(C);break;case"safari":if(!c||!E.shimSafari)return A("Safari shim is not included in this adapter release."),j;A("adapter.js shimming safari."),j.browserShim=c,At(C,O),Re(C),De(C),ue(C),te(C),qe(C),ut(C),Oe(C),Ne(C),_e(C),ze(C),Ze(C),Je(C,O),nt(C),vt(C,O);break;default:A("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),i(8630);const ce=()=>typeof RTCPeerConnection=="function";var W,le;(function(C){C[C.TRACE=0]="TRACE",C[C.DEBUG=1]="DEBUG",C[C.INFO=2]="INFO",C[C.WARN=3]="WARN",C[C.ERROR=4]="ERROR",C[C.SILENT=5]="SILENT"})(W||(W={})),(function(C){C.TIME="Time",C.WEBRTC="WebRTC",C.EMITTER="Emitter",C.MEDIA="Media",C.SUBSCRIPTION="StageSubscription",C.PUBLICATION="StagePublication",C.CONNECTION="StageConnection",C.SOCKET="StageSocket",C.BROADCAST_STAGE_CLIENT="BroadcastStageClient",C.STAGE="Stage",C.REMOTE_PARTICIPANT="RemoteParticipant",C.LOCAL_PARTICIPANT="LocalParticipant",C.CONFIGURATION="Configuration",C.REMOTE_PLAYBACK="RemotePlaybackController",C.REMOTE_STAGE_STREAM="RemoteStageStream"})(le||(le={}));const Se=12e4,Ae=3e5,ye="no-rid";class ve extends Error{constructor({name:E,message:A,code:O,details:j,cause:H,params:X}){super(A),Error.captureStackTrace&&Error.captureStackTrace(this,ve),this.name=E||"BroadcastClientError",this.message=A,this.code=O,this.details=j,this.cause=H,this.params=X}}const Xe={name:"BroadcastError",code:1e3,message:"Unable to broadcast"},Me={name:"CameraError",code:2e3,message:"Camera could not be captured"},Ve={name:"InputError",code:3e3,message:"Input could not be attached"},je={name:"AddDeviceError",code:4e3,message:"Device is missing"},We={name:"AddDeviceNameExistsError",code:4001,message:"Name is already registered"},ct={name:"AddDeviceCompositionMissingError",code:4002,message:"VideoComposition is missing"},Fe={name:"AddDeviceCompositionIndexMissingError",code:4003,message:`VideoComposition's "index" property is missing`},rt={name:"AddDeviceNameMissingError",code:4004,message:"Name property is missing"},it={name:"AddDeviceUnsupported",code:4005,message:"Unsupported device"},St={name:"AddDeviceConstraintsError",code:4006,message:"Constraints error"},at={name:"RemoveDeviceNotFoundError",code:5e3,message:"Device not found"},Yt={name:"RemoveImageNotFoundError",code:6e3,message:"Image not found"},sn={name:"UpdateVideoDeviceCompositionMissingError",code:7e3,message:"VideoComposition is missing"},Rt={name:"UpdateVideoDeviceCompositionIndexMissingError",code:7001,message:`VideoComposition's "index" property is missing`},Ut={name:"UpdateVideoDeviceCompositionNameMissingError",code:7002,message:"Video device with that name is not found"},_t={name:"ExchangePositionDeviceNotFoundError",code:8e3,message:"Device with that name is not found"},Ht={name:"FailedToAddImageError",code:9e3,message:"Failed to add image"},_n={name:"PeerSetupError",code:1e4,message:"Unexpected return value from setup request"},jt={name:"PeerConnectionError",code:10001,message:"Peer connection has failed."},mn={name:"InvalidStreamKey",code:10003,message:"Invalid Stream Key."},Rn={name:"BroadcastConfigurationError",code:11e3,message:"Error when configuring broadcast client"},Un={name:"StreamConfigurationError",code:12e3,message:"Error when configuring stream"},qi={name:"IngestEndpointTypeError",code:13e3,message:"Ingest endpoint must be a string"},oi={name:"IngestEndpointUrlError",code:13001,message:"Ingest endpoint must be a valid https or rtmps URL"},_i={name:"LogLevelTypeError",code:14e3,message:"Log Level must be a valid integer between [0..5]"},ys={name:"LoggerTypeError",code:15e3,message:"Logger must be an object"},Is={name:"ClientInvalidError",code:16e3,message:"Client is no longer valid, possibly due to delete() invocation."},Ui={name:"NetworkReconnectConfigurationError",code:17e3,message:"Error when configuring network reconnect"},us={name:"NetworkReconnectConfigurationInvalidTimeoutError",code:17001,message:"Network reconnect timeout value must be a number between [10000, 300000]"},hs={name:"StreamKeyInvalidCharError",code:18e3,message:"Streamkey must contain only [A-Za-z0-9_-] characters"},Le={name:"StageTokenTypeError",code:19e3,message:"Stage token must be a string"},mt={name:"StageWhipUrlOverrideError",code:19001,message:"Stage WHIP override URL must be a string starting with http"};var Ct,Ot,yt,Qt,Sn,an,Dn,or,rr,zn=function(C,E,A,O){if(typeof E=="function"?C!==E||!O:!E.has(C))throw new TypeError("Cannot read private member from an object whose class did not declare it");return A==="m"?O:A==="a"?O.call(C):O?O.value:E.get(C)},dr=function(C,E,A,O,j){if(typeof E=="function"?C!==E||!0:!E.has(C))throw new TypeError("Cannot write private member to an object whose class did not declare it");return E.set(C,A),A};const Ur=1920,rs=1080,Rr=W.ERROR,Dr={maxResolution:{width:852,height:480},maxFramerate:30,maxBitrate:1500},Qn={maxResolution:{width:480,height:852},maxFramerate:30,maxBitrate:1500},pr={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:3500},On={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:3500},Fs={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:8500},So={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:8500},js={reconnect:!1,timeout:Se};function Qo(C){var E,A;if(typeof C!="string"&&C!==void 0)throw new ve(qi);if(C){if(C.startsWith("https"))return C;{const O=/(?<protocol>(rtmps|https):\/\/)?(?<id>.+)\.(?<environment>(?=\S*['-])([a-zA-Z'-]+))\.live-video\.net.*/.exec(C);if(((E=O?.groups)===null||E===void 0?void 0:E.protocol)==="rtmps"&&console.warn("rtmps server url detected; please pass in the ingest endpoint (no rtmps:// protocol) instead"),(A=O?.groups)===null||A===void 0?void 0:A.id)return`https://${O.groups.id}.webrtc.live-video.net:4443`;throw new ve(oi)}}return""}class Ci{constructor(E,A,O=Dr,j,H=js){this.LOG_LEVEL=W,this.BASIC_LANDSCAPE=Dr,this.BASIC_PORTRAIT=Qn,this.BASIC_FULL_HD_LANDSCAPE=pr,this.BASIC_FULL_HD_PORTRAIT=On,this.STANDARD_LANDSCAPE=Fs,this.STANDARD_PORTRAIT=So,Ct.set(this,void 0),Ot.set(this,void 0),yt.set(this,Dr),Qt.set(this,void 0),Sn.set(this,js),an.set(this,(X=>{if(!X)throw new ve(Object.assign(Object.assign({},Un),{details:"missing stream configuration"}));if(!(X.maxBitrate<=8500&&X.maxBitrate>=200))throw new ve(Object.assign(Object.assign({},Un),{details:"maxBitrate must be between 200 and 8500"}));if(!(X.maxFramerate<=60&&X.maxFramerate>=10))throw new ve(Object.assign(Object.assign({},Un),{details:"maxFramerate must be between 10 and 60"}));const re=X.maxResolution.width,se=X.maxResolution.height;if(re>Ur||se>Ur||re<160||se<160||re===Ur&&se>rs||se===Ur&&re>rs)throw new ve(Object.assign(Object.assign({},Un),{details:"maxResolution values must be between 1080x1920 or 1920x1080"}))})),Dn.set(this,(X=>{if(!X)return;const re=Number(X),se=Number.isInteger(re),ee=re>=W.TRACE,he=re<=W.SILENT;if(!se||!ee||!he)throw new ve(_i)})),or.set(this,(X=>{if(X&&typeof X!="object")throw new ve(ys)})),rr.set(this,(X=>{if(!X)return;if(typeof X!="object"||typeof X.reconnect!="boolean")throw new ve(Ui);const{timeout:re}=X;if(re!==void 0&&(Number.isNaN(re)||typeof re!="number"||re<1e4||re>Ae))throw new ve(us)})),zn(this,or,"f").call(this,j),zn(this,Dn,"f").call(this,A),zn(this,an,"f").call(this,O),dr(this,Ct,E),dr(this,Ot,A),dr(this,yt,O),dr(this,Qt,j),dr(this,Sn,H)}get ingestEndpoint(){return zn(this,Ct,"f")}set ingestEndpoint(E){dr(this,Ct,Qo(E))}get streamConfig(){return zn(this,yt,"f")}set streamConfig(E){zn(this,an,"f").call(this,E),dr(this,yt,E)}get logLevel(){return zn(this,Ot,"f")}set logLevel(E){zn(this,Dn,"f").call(this,E),dr(this,Ot,E)}get logger(){return zn(this,Qt,"f")}set logger(E){zn(this,or,"f").call(this,E),dr(this,Qt,E)}get networkReconnectConfig(){return zn(this,Sn,"f")}set networkReconnectConfig(E){zn(this,rr,"f").call(this,E),dr(this,Sn,E)}}Ct=new WeakMap,Ot=new WeakMap,yt=new WeakMap,Qt=new WeakMap,Sn=new WeakMap,an=new WeakMap,Dn=new WeakMap,or=new WeakMap,rr=new WeakMap;var xn,bs=i(228);(function(C){C.PUBLISHED_VIDEO_STATS="ivs_broadcast_webrtc_published_video_stats",C.PUBLISHED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_published_video_stats_window",C.PUBLISHED_AUDIO_STATS="ivs_broadcast_webrtc_published_audio_stats",C.PUBLISHED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_published_audio_stats_window",C.SUBSCRIBED_VIDEO_STATS="ivs_broadcast_webrtc_subscribed_video_stats",C.SUBSCRIBED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_video_stats_window",C.SUBSCRIBED_AUDIO_STATS="ivs_broadcast_webrtc_subscribed_audio_stats",C.SUBSCRIBED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_audio_stats_window",C.PUBLISH="ivs_broadcast_multihost_publish",C.UNPUBLISH="ivs_broadcast_multihost_unpublish",C.SUBSCRIBE="ivs_broadcast_multihost_subscribe",C.UNSUBSCRIBE="ivs_broadcast_multihost_unsubscribe",C.PUBLISH_STARTED="ivs_broadcast_multihost_publish_started",C.PUBLISH_FAILED="ivs_broadcast_multihost_publish_failed",C.PUBLISH_ENDED="ivs_broadcast_multihost_publish_ended",C.STATE_UPDATED="ivs_broadcast_multihost_event_state_updated",C.SUBSCRIBE_STARTED="ivs_broadcast_multihost_subscribe_started",C.SUBSCRIBE_FAILED="ivs_broadcast_multihost_subscribe_failed",C.SUBSCRIBE_ENDED="ivs_broadcast_multihost_subscribe_ended",C.FIRST_FRAME="ivs_broadcast_multihost_first_frame",C.JOIN="ivs_broadcast_multihost_join",C.JOIN_ATTEMPT="ivs_broadcast_multihost_event_connect_attempt",C.JOIN_ATTEMPT_FAILED="ivs_broadcast_multihost_event_connect_failed",C.JOIN_ENDED="ivs_broadcast_multihost_join_ended",C.LEAVE="ivs_broadcast_multihost_leave",C.REASSIGNMENT_REQUEST="ivs_broadcast_multihost_reassignment_request",C.SERVER_REQUEST="ivs_broadcast_multihost_server_request",C.TRACE="ivs_broadcast_stage_trace",C.ERROR="ivs_broadcast_error",C.MINUTE="ivs_broadcast_multihost_minute",C.CONNECTION_STATE="ivs_broadcast_webrtc_connection_state",C.ICE_GATHERING_STATE="ivs_broadcast_webrtc_gathering_state",C.EDP_CONNECTED="ivs_broadcast_multihost_event_connected",C.EDP_DISCONNECTED="ivs_broadcast_multihost_event_disconnected",C.EDP_PONG="ivs_broadcast_multihost_edp_rtt",C.SIMULCAST_LAYER_INFO="ivs_broadcast_simulcast_layer_info",C.MULTIHOST_CONFIGURATION="ivs_broadcast_multihost_configuration",C.MULTIHOST_SUBSCRIBE_CONFIGURATION="ivs_broadcast_multihost_subscribe_configuration",C.PLAYBACK_LAYER_REQUEST="ivs_broadcast_multihost_playback_layer_request",C.PLAYBACK_LAYER_STATE="ivs_broadcast_multihost_playback_layer_state",C.SELECTED_PAIR_CHANGE="ivs_broadcast_webrtc_selected_pair_change",C.ANALYTICS_HEALTH_REPORT="ivs_broadcast_analytics_health_report",C.DEVCONF_ERROR="ivs_devconf_error",C.DEVCONF_OPS_METRICS="ivs_devconf_ops_metrics",C.DEVCONF_TRACE="ivs_devconf_trace",C.DEVCONF_VALUE="ivs_devconf_value",C.DEVCONF_ROLLOUT_ASSIGNMENT="ivs_devconf_rollout_assignment"})(xn||(xn={}));class $n{constructor(E,A,O,j){this.event=E,this.properties={client_time:new Date().toISOString(),customer_id:A.customerId,device_software:window.navigator.userAgent,multihost_id:A.stageARN,participant_id:A.participantID,participant_user_id:A.userID,platform:"web",sdk_version:"1.31.1",stage_arn:A.stageARN,trace_id:O.value},A.attrGsRole&&(this.properties.token_attribute_0=A.attrGsRole),A.attrGsSessionId&&(this.properties.token_attribute_1=A.attrGsSessionId),this.critical=j}}class fs extends $n{constructor(E){super(xn.ERROR,E.token,E.traceId,!0),Object.assign(this.properties,{code:E.code,tag:E.tag,description:E.message,remote_participant_id:E.remoteParticipantId,request_uuid:E.requestUUID,is_nominal:E.nominal,is_fatal:E.fatal,details:E.details,location:E.location,event_count:E.count})}}function ac(C){const E=window.IVS_CLIENT_OVERRIDES;return typeof E=="object"?E[C]:C==="logLevel"?window.STAGES_LOG_LEVEL:C==="appLabel"?window.IVS_APP_LABEL:C==="whipUrl"?window.IVS_DATA_PLANE_ENDPOINT:void 0}function is(C){const E=ac(C);if(typeof E=="string")return E}function cc(C){const E=ac(C);if(typeof E=="boolean")return E}function Dd(C){const E=ac(C);if(typeof E=="number")return E;if(typeof E=="string"){const A=parseFloat(E);if(!isNaN(A))return A}}function x_(){const C=ac("logLevel");if(typeof C=="number"&&Object.values(W).includes(C))return C}function w0(){const C=is("appLabel");if(C!==void 0)return C.substring(0,64)}function T_(){return cc("disableXdp")}function A0(){return cc("preferMainProfile")}function wa(){return cc("enableInitialLayerOnSdp")}function uy(){return cc("disableAudioRtcpRsize")}var Bc=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};function hy(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(C=>{const E=16*Math.random()|0;return(C==="x"?E:3&E|8).toString(16)}))}function w_(C,E=A=>{}){Bc(this,void 0,void 0,(function*(){try{yield C()}catch(A){E(A)}}))}var Ul=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};function Dp(C,E,A={},O=""){return Ul(this,void 0,void 0,(function*(){const j=new XMLHttpRequest;return j.open(C,E,!0),A&&Object.keys(A).forEach((H=>{A.hasOwnProperty(H)&&j.setRequestHeader(H,A[H])})),new Promise(((H,X)=>{j.onreadystatechange=()=>{j.readyState===4&&(j.status>=200&&j.status<300?H(j.responseText):X(new Error(`Ingest ${C} ${E} responded ${j.status}
${j.responseText}`)))},j.send(O)}))}))}function R0(C){const E=Date.now();for(const O of C)O.properties.batch_time_millis=E;var A;return{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:`data=${A=JSON.stringify(C),btoa(encodeURIComponent(A).replace(/%([0-9A-F]{2})/g,((O,j)=>String.fromCharCode(+`0x${j}`))))}`}}class ds{send(E,A=!1){return Ul(this,void 0,void 0,(function*(){const{currentEndpoint:O}=Bo,{headers:j,body:H}=R0(E),X="eventSenderResult",re=E.length;if(A){const se=navigator.sendBeacon(O,H);Bo.trackEvent({type:X,success:se,count:re})}else w_((()=>Ul(this,void 0,void 0,(function*(){yield Dp("POST",O,j,H),Bo.trackEvent({type:X,success:!0,count:re})}))),(()=>{Bo.trackEvent({type:X,success:!1,count:re})}))}))}}var lc=i(2505),Lf=i.n(lc);const uc={CONNECTION_STATE_CHANGE:"connectionStateChange",ERROR:"clientError",ACTIVE_STATE_CHANGE:"activeStateChange"},Bl="connectionStateChange",fy="sdpNegotiated",Yu="clientError",Ku="seiMessageReceived",fl="transformError";var Zn;(function(C){C.CLOSED="closed",C.COMPLETED="completed",C.CONNECTED="connected",C.CONNECTING="connecting",C.DISCONNECTED="disconnected",C.FAILED="failed",C.IDLE="idle",C.NEW="new",C.NONE="none"})(Zn||(Zn={}));var A_=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};function R_(C,E){return A_(this,void 0,void 0,(function*(){C.validateStatus=O=>O>=200&&O<300||O===403;const A=yield Lf()(C);if(A.status===403){if(A.data.code===2003)throw new lc.AxiosError("Request failed with status code 403","ERR_BAD_REQUEST",C,A.request,A);return C.url===A.request.responseURL?(C.validateStatus=O=>O>=200&&O<300,Lf()(C)):(C.url=A.request.responseURL,E<5?R_(C,E+1):(C.validateStatus=O=>O>=200&&O<300,Lf()(C)))}return A}))}function C0(C){return A_(this,void 0,void 0,(function*(){return R_(C,0)}))}function Yh(){}function C_(C){switch(C){case"new":return Zn.NEW;case"closed":return Zn.CLOSED;case"disconnected":return Zn.DISCONNECTED;case"failed":return Zn.FAILED;case"idle":return Zn.IDLE;case"checking":case"connecting":return Zn.CONNECTING;case"completed":case"connected":return Zn.CONNECTED;default:throw new Error(`unknown connecion state: ${C}`)}}function Xu(C,E,A){let O=document.createElement(E);const j=()=>{O&&(O.removeEventListener("loadeddata",H),O.removeEventListener("error",j),O.srcObject=null,O.src="",O=null)},H=()=>{j(),A(E)};return O.addEventListener("loadeddata",H),O.addEventListener("error",j),O.srcObject=C,j}class ea{constructor(){this.emitter=new bs}hasListenersFor(E){return this.emitter.listenerCount(E)>0}on(E,A,O){A.call=(function(j,H){return function(X,...re){try{H.apply(X,re)}catch(se){let ee=`Error in callback for ${j}`;const he=H.name;return he&&(ee+=` for function ${he}`),void console.error(`${ee}
`,se)}}})(E,A),this.emitter.on(E,A,O)}off(E,A,O){this.emitter.off(E,A,O)}emit(E,...A){this.emitter.emit(E,...A)}removeAllListeners(){this.emitter.removeAllListeners()}}const M_="https://broadcast.stats.live-video.net/";class hc{constructor({totalEvents:E,totalEventsLost:A,windowedEvents:O,windowedEventsLost:j,currentEndpoint:H}){this.transformProperties=(re,se,ee,he,Ee)=>({total_events:re,total_events_lost:se,windowed_events:ee,windowed_events_lost:he,current_endpoint:Ee??M_});const X=this.transformProperties(E,A,O,j,H);this.data={event:xn.ANALYTICS_HEALTH_REPORT,properties:Object.assign({},X)}}}const k_={totalEvents:0,totalEventsSent:0,totalEventsLost:0,windowedEvents:0,windowedEventsSent:0,windowedEventsLost:0};var Kh,Eo;(function(C){C.ANALYTICS_EVENT="ANALYTICS_EVENT"})(Kh||(Kh={}));class ta extends ea{constructor(){super(),this.eventSenderMetrics=Object.assign({},k_),this.scheduleHealthReport=()=>{this.reportTimer=window.setTimeout(this.onHealthReportInterval,6e4)},this.onHealthReportInterval=()=>{const E=Object.assign({},this.eventSenderMetrics);if(this.eventSenderMetrics.windowedEvents===0?this.emptyWindows++:this.emptyWindows=0,this.emptyWindows>3)return window.clearTimeout(this.reportTimer),void(this.reportTimer=void 0);this.postHealthReport(E),this.eventSenderMetrics.windowedEvents=0,this.eventSenderMetrics.windowedEventsSent=0,this.eventSenderMetrics.windowedEventsLost=0,this.scheduleHealthReport()},this.emptyWindows=0}trackEventSendResult(E){const{count:A,success:O}=E;this.eventSenderMetrics.totalEvents+=A,this.eventSenderMetrics.windowedEvents+=A,O?(this.eventSenderMetrics.totalEventsSent+=A,this.eventSenderMetrics.windowedEventsSent+=A):(this.eventSenderMetrics.totalEventsLost+=A,this.eventSenderMetrics.windowedEventsLost+=A),this.isHealthReportScheduled()||this.scheduleHealthReport()}isHealthReportScheduled(){return typeof this.reportTimer=="number"}postHealthReport(E){const A=new hc(E);this.emit(Kh.ANALYTICS_EVENT,A)}}(function(C){C[C.EXCELLENT=4]="EXCELLENT",C[C.GOOD=3]="GOOD",C[C.NORMAL=2]="NORMAL",C[C.POOR=1]="POOR",C[C.DOWN=0]="DOWN"})(Eo||(Eo={}));var O_,vu,Ss,na;(function(C){C.NETWORK_QUALITY_CHANGE="networkQualityChange"})(O_||(O_={}));class I_ extends ea{constructor(){super(),this.lastNetworkStatus={},this.networkAssessment={networkQuality:Eo.NORMAL,reason:"no-data"},this.checkNetworkStatus=()=>{var E,A;const O=(E=navigator?.connection)!==null&&E!==void 0?E:{},j={downlink:O.downlink,effectiveType:O.effectiveType,rtt:O.rtt,isOnline:(A=navigator.onLine)===null||A===void 0||A};if(!this.isChangedNetworkStatus(this.lastNetworkStatus,j))return;this.lastNetworkStatus=j;const H=this.networkAssessment,X=(function(re){const{rtt:se,downlink:ee,isOnline:he}=re;if(!he)return{networkQuality:Eo.DOWN,reason:"offline"};if(typeof se!="number"||typeof ee!="number")return{networkQuality:Eo.NORMAL,reason:"no-data"};let Ee=0;se>800?Ee+=2:se>300&&(Ee+=1),ee<2.5?Ee+=2:ee<5&&(Ee+=1);const Ce="score";switch(Ee){case 4:return{networkQuality:Eo.POOR,reason:Ce};case 0:return{networkQuality:Eo.EXCELLENT,reason:Ce};default:return{networkQuality:Ee<=2?Eo.GOOD:Eo.NORMAL,reason:Ce}}})(j);H.networkQuality!==X.networkQuality&&this.emit(O_.NETWORK_QUALITY_CHANGE,H.networkQuality,X.networkQuality),this.networkAssessment=X},this.getNetworkQuality=()=>this.networkAssessment.networkQuality,this.setupWindowListeners(),this.checkNetworkStatus()}setupWindowListeners(){window.addEventListener("online",(()=>{this.checkNetworkStatus()})),window.addEventListener("offline",(()=>{this.checkNetworkStatus()})),window.navigator.connection&&window.navigator.connection.addEventListener("change",(()=>{this.checkNetworkStatus()}))}isChangedNetworkStatus(E,A){const{downlink:O,effectiveType:j,rtt:H,isOnline:X}=A;return E.effectiveType!==j||E.downlink!==O||E.rtt!==H||E.isOnline!==X}}(function(C){C.ANALYTICS_EVENT="ANALYTICS_EVENT",C.REFRESH="REFRESH"})(vu||(vu={})),(function(C){C.IDLE="idle",C.ACTIVATING="activating",C.ACTIVE="active",C.REFRESHING="refreshing",C.PAUSED="paused",C.DESTROYED="destroyed"})(Ss||(Ss={})),(function(C){C.INITIALIZE="initialize",C.REFRESH="refresh",C.ACTIVATE="activate",C.PAUSE="pause",C.DESTROY="destroy"})(na||(na={}));const Lp={[na.INITIALIZE]:{from:[Ss.IDLE],to:Ss.ACTIVATING},[na.REFRESH]:{from:[Ss.ACTIVATING,Ss.ACTIVE,Ss.PAUSED],to:Ss.REFRESHING},[na.ACTIVATE]:{from:[Ss.ACTIVATING,Ss.REFRESHING,Ss.PAUSED],to:Ss.ACTIVE},[na.PAUSE]:{from:[Ss.REFRESHING,Ss.ACTIVE],to:Ss.PAUSED},[na.DESTROY]:{from:[Ss.ACTIVE,Ss.PAUSED],to:Ss.DESTROYED}};var Fl,Ga;(function(C){C.STAGE_CONFIGURATION="stage_configuration",C.STAGE_SUBSCRIBE_CONFIGURATION="stage_subscribe_configuration",C.STAGE_LOCAL_STREAM_CONFIGURATION="stage_local_stream_configuration",C.BROADCAST_CONFIGURATION="broadcast_configuration"})(Fl||(Fl={})),(function(C){C.RT="real_time",C.LL="low_latency"})(Ga||(Ga={}));var zs,Zu,ra,pn=i(8954);class eS{constructor(E,A){this.transformProperties=(j,H)=>({sum:j.sum,median:j.median(),min:j.min,max:j.max,p90:j.percentile(.9),event_count:j.data.length,period:H});const O=this.transformProperties(E,A);this.data={event:zs.CONGESTION_TIME,properties:O}}}class Up{constructor(E,A,O){this.transformProperties=(H,X,re)=>({duration:(H.getTime()-(X?.getTime()||0))/1e3,ecn_negotiated:!1,ingest_session_id:re});const j=this.transformProperties(E,A,O);this.data={event:zs.CONNECTION_ESTABLISHED,properties:j}}}class Nt{constructor(E,A){this.transformProperties=(j,H)=>({sum:j.sum,median:j.median(),min:j.min,max:j.max,p90:j.percentile(.9),event_count:j.data.length,period:H});const O=this.transformProperties(E,A);this.data={event:zs.CONNECTION_RTT,properties:O}}}class Kt{constructor(E){this.transformProperties=()=>({}),this.data={event:xn.DEVCONF_ERROR,properties:E}}}class Zt{constructor(E){this.transformProperties=()=>({}),this.data={event:xn.DEVCONF_OPS_METRICS,properties:E}}}class In{constructor(E){this.transformProperties=()=>({}),this.data={event:xn.DEVCONF_ROLLOUT_ASSIGNMENT,properties:E}}}class wr{constructor(E){this.transformProperties=()=>({}),this.data={event:xn.DEVCONF_TRACE,properties:E}}}class Br{constructor(E){this.transformProperties=()=>({}),this.data={event:xn.DEVCONF_VALUE,properties:E}}}class Hs{constructor(E){this.transformProperties=O=>{var j;return{is_fatal:(j=O.isFatal)!==null&&j!==void 0&&j,value:O.value,code:O.code,description:O.description}};const A=this.transformProperties(E);this.data={event:zs.ERROR,properties:A}}}class yu{constructor(E,A){this.transformProperties=(j,H)=>({type:j,input_device_id:H.deviceId,position:H.facingMode||"unknown"});const O=this.transformProperties(E,A);this.data={event:zs.INPUT_DEVICE_ATTACHED,properties:O}}}class Yi{constructor(E,A){this.transformProperties=(j,H)=>({type:j,input_device_id:H.deviceId,position:H.facingMode||"unknown"});const O=this.transformProperties(E,A);this.data={event:zs.INPUT_DEVICE_DETACHED,properties:O}}}class Ju{constructor(E,A){this.transformProperties=(j,H)=>({sum:j.sum,median:j.median(),min:j.min,max:j.max,p90:j.percentile(.9),event_count:j.data.length,period:H});const O=this.transformProperties(E,A);this.data={event:zs.MEASURED_BITRATE,properties:O}}}class Xh{constructor(E,A){this.transformProperties=(j,H)=>({minutes_logged:Math.round((j.timestamp-H)/6e4)});const O=this.transformProperties(E,A);this.data={event:zs.MINUTE_BROADCAST,properties:O}}}class Fc{constructor(E,A){this.transformProperties=(j,H)=>({sum:j.sum,median:j.median(),min:j.min,max:j.max,p90:j.percentile(.9),event_count:j.data.length,period:H});const O=this.transformProperties(E,A);this.data={event:zs.RECOMMENDED_BITRATE,properties:O}}}class Bp{constructor(E){this.transformProperties=O=>({codec:O.mimeType,bitrate:0,sample_rate:O.clockRate,channel_count:O.channels});const A=this.transformProperties(E);this.data={event:zs.SESSION_AUDIO_ENCODER_CONFIGURED,properties:A}}}class M0{constructor(E){this.transformProperties=O=>({codec:"audio",bitrate:32e3,sample_rate:O.sampleRate,channel_count:O.channelCount});const A=this.transformProperties(E);this.data={event:zs.SESSION_AUDIO_PROPERTIES,properties:A}}}class Zh{constructor(E,A,O){this.transformProperties=(H,X,re)=>({codec:re.mimeType,codec_profile:X.profile,codec_level:X.level,rate_mode:"vbr",initial_bitrate:0,keyframe_interval:2,width:H.width,height:H.height,bframe_count:0,target_fps:H.frameRate});const j=this.transformProperties(E,A,O);this.data={event:zs.SESSION_VIDEO_ENCODER_CONFIGURED,properties:j}}}class Qu{constructor(E){this.transformProperties=O=>({codec:"video",initial_bitrate:32e3,min_bitrate:0,max_bitrate:0,keyframe_interval:2,width:O.width,height:O.height,auto_bitrate_enabled:!0,bframes_enabled:!1,target_fps:O.frameRate});const A=this.transformProperties(E);this.data={event:zs.SESSION_VIDEO_PROPERTIES,properties:A}}}class Uo{constructor(E,A){this.transformProperties=(j,H)=>({sum:j.sum,median:j.median(),min:j.min,max:j.max,p90:j.percentile(.9),event_count:j.data.length,period:H});const O=this.transformProperties(E,A);this.data={event:zs.SOURCE_AUDIO_LATENCY,properties:O}}}class Ti{constructor(E,A){this.transformProperties=(j,H)=>({sum:j.sum,median:j.median(),min:j.min,max:j.max,p90:j.percentile(.9),event_count:j.data.length,period:H});const O=this.transformProperties(E,A);this.data={event:zs.SOURCE_VIDEO_LATENCY,properties:O}}}class dy{constructor(E,A){this.transformProperties=({protocol:j,hostname:H,port:X},re)=>({protocol:j,endpoint_host:H,endpoint_port:X,reason:re});const O=this.transformProperties(E,A);this.data={event:zs.START_BROADCAST,properties:O}}}class N_{constructor(E){this.transformProperties=({protocol:O,hostname:j,port:H})=>({protocol:O,endpoint_host:j,endpoint_port:H});const A=this.transformProperties(E);this.data={event:zs.STOP_BROADCAST,properties:A}}}class Uf{constructor(E){this.transformProperties=O=>({bytes_sent:O.bytesSent,header_bytes_sent:O.headerBytesSent,nack_count:O.nackCount,packets_sent:O.packetsSent,retransmitted_bytes_sent:O.retransmittedBytesSent,retransmitted_packets_sent:O.retransmittedPacketsSent});const A=this.transformProperties(E);this.data={event:zs.WEBRTC_AUDIO_STATS,properties:A}}}class py{constructor(E){this.transformProperties=O=>({bytes_sent:O.bytesSent,fir_count:O.firCount,frames_encoded:O.framesEncoded,frames_sent:O.framesSent,header_bytes_sent:O.headerBytesSent,huge_frames_sent:O.hugeFramesSent,key_frames_encoded:O.keyFramesEncoded,nack_count:O.nackCount,packets_sent:O.packetsSent,pli_count:O.pliCount,quality_limitation_reason:O.qualityLimitationReason,quality_limitation_resolution_changes:O.qualityLimitationResolutionChanges,retransmitted_bytes_sent:O.retransmittedBytesSent,retransmitted_packets_sent:O.retransmittedPacketsSent,total_encode_time:O.totalEncodeTime,total_encoded_bytes_target:O.totalEncodedBytesTarget,total_packet_send_delay:O.totalPacketSendDelay});const A=this.transformProperties(E);this.data={event:zs.WEBRTC_VIDEO_STATS,properties:A}}}(function(C){C.START_BROADCAST="ivs_broadcast_start_broadcast",C.STOP_BROADCAST="ivs_broadcast_stop_broadcast",C.MINUTE_BROADCAST="ivs_broadcast_minute_broadcast",C.WEBRTC_AUDIO_STATS="ivs_broadcast_webrtc_audio_stats",C.WEBRTC_VIDEO_STATS="ivs_broadcast_webrtc_video_stats",C.WEBRTC_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_audio_stats_window",C.WEBRTC_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_video_stats_window",C.CONNECTION_ESTABLISHED="ivs_broadcast_connection_established",C.SESSION_VIDEO_PROPERTIES="ivs_broadcast_session_video_properties",C.SESSION_AUDIO_PROPERTIES="ivs_broadcast_session_audio_properties",C.SESSION_VIDEO_ENCODER_CONFIGURED="ivs_broadcast_session_video_encoder_configured",C.SESSION_AUDIO_ENCODER_CONFIGURED="ivs_broadcast_session_audio_encoder_configured",C.SOURCE_AUDIO_LATENCY="ivs_broadcast_source_audio_latency",C.SOURCE_VIDEO_LATENCY="ivs_broadcast_source_video_latency",C.INPUT_DEVICE_ATTACHED="ivs_broadcast_input_device_attached",C.INPUT_DEVICE_DETACHED="ivs_broadcast_input_device_detached",C.CONGESTION_TIME="ivs_broadcast_congestion_time",C.BUFFER_DURATION="ivs_broadcast_buffer_duration",C.MEASURED_BITRATE="ivs_broadcast_measured_bitrate",C.RECOMMENDED_BITRATE="ivs_broadcast_recommended_bitrate",C.CONNECTION_RTT="ivs_broadcast_connection_rtt",C.ERROR="ivs_broadcast_error"})(zs||(zs={})),(function(C){C.USER_INITIATED="user-initiated",C.NETWORK_DISCONNECT="network-disconnect"})(Zu||(Zu={})),(function(C){C.LOWEST_QUALITY="lowest_quality",C.HIGHEST_QUALITY="highest_quality"})(ra||(ra={}));var jc,k0,Vs,Es;(function(C){C.HI="hi",C.MID="mid",C.LOW="low"})(jc||(jc={})),(function(C){C.PORTRAIT="portrait",C.LANDSCAPE="landscape"})(k0||(k0={})),(function(C){C.VIDEO="video",C.AUDIO="audio"})(Vs||(Vs={})),(function(C){C.DEFAULT="default",C.LOW="low",C.MEDIUM="medium",C.HIGH="high"})(Es||(Es={}));const Fp={jitterBuffer:{type:"object",required:!1,config:{schema:{minDelayWhenPublishing:{type:"number",required:!1},minDelayWhenSubscribeOnly:{type:"number",required:!1}}}},inBandMessaging:{type:"object",required:!1,config:{schema:{enabled:{type:"boolean",required:!1}}}},simulcast:{type:"object",required:!1,config:{schema:{initialLayerPreference:{type:"string",required:!1},layerPollingEnabled:{type:"boolean",required:!1},layerPollingIntervalMs:{type:"number",required:!1}}}}};var Vi=i(2543);const O0=(function(){if(typeof URLSearchParams<"u"){const A=new URLSearchParams(window.location.search);return{get:O=>A.get(O),has:O=>A.has(O)}}const C=window.location.search.slice(1),E={};return C&&C.split("&").forEach((A=>{const[O,j]=A.split("=");E[decodeURIComponent(O)]=decodeURIComponent(j||"")})),{get:A=>{var O;return(O=E[A])!==null&&O!==void 0?O:null},has:A=>A in E}})();var jp,zp;const Ld=O0.get("ivs_dc_cnf_env")===pn.DeviceConfigEnv.BETA?pn.DeviceConfigEnv.BETA:pn.DeviceConfigEnv.PROD,I0=pn.DEFAULT_REFRESH_INTERVAL_SECONDS,Jh=Ld===pn.DeviceConfigEnv.BETA?10:I0,Ii="broadcast-web-v1",eh=((zp=(jp=window.location)===null||jp===void 0?void 0:jp.hostname)===null||zp===void 0?void 0:zp.indexOf("localhost"))>-1,tS=`amazon_ivs_device_config_v1_${Ii}_context`,my=()=>({[Ga.RT]:{customerIds:[],hosts:[]},[Ga.LL]:{customerIds:[],hosts:[]}});var N0=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};const bu=C=>{let E=(0,Vi.merge)(my(),C);const A=(()=>{try{const j=localStorage.getItem(tS);return j===null?pn.err("Key does not exist"):pn.ok(JSON.parse(j))}catch(j){return pn.err(`Error while parsing: ${j}`)}})();if(!A.ok)return E;const O=A.value;return E=Hp(Ga.RT,O[Ga.RT],E),E=Hp(Ga.LL,O[Ga.LL],E),E},P0=(C,E)=>C.hash===E.hash&&C.key===E.key,Hp=(C,E,A)=>{const O=Object.keys(A[C]);for(const j of O)A[C][j]=(0,Vi.uniqWith)([...E[j],...A[C][j]],P0);return A},Bf=(C,E,A)=>{const O=(0,Vi.cloneDeep)(C??{}),j=Object.assign(Object.assign({},O),{cFilter:O.customerId,hFilter:O.host});for(const H of A[E].customerIds)H.key===C.customerId&&(j.cFilter=H.hash);for(const H of A[E].hosts)H.key===C.host&&(j.hFilter=H.hash);return j},Aa=C=>C?{customer_id:C.customerId,session_id:C.sessionId}:{};var P_;(function(C){C.EXPERIMENT_FOOBAR="experiment_foobar"})(P_||(P_={}));var nS=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};class xo extends ea{constructor(E){var A,O;super(),this.onStateChanged=(j,H)=>{this.logger.log(`[onStateChanged] From ${j} to ${H}`)},this.handleRefresh=()=>{this.logger.log("[handleRefresh] Starting refresh trigger");const j=this.fsm.currentState()===Ss.ACTIVATING||this.fsm.currentState()===Ss.ACTIVE;return j?(this.logger.log("[handleRefresh] Starting refresh"),this.fsm.transition(na.REFRESH)):this.logger.log("[handleRefresh] Skipping refresh due to inactive state"),j},this.onMetricsEmitted=j=>{this.fsm.currentState()!==Ss.ACTIVATING&&this.fsm.currentState()!==Ss.REFRESHING||this.fsm.transition(na.ACTIVATE);const H=new Zt(Object.assign({},j));this.emit(vu.ANALYTICS_EVENT,H),this.emit(vu.REFRESH)},this.onConfigValue=(j,H)=>{const X=new Br(Object.assign(Object.assign({},j),Aa(H)));this.emit(vu.ANALYTICS_EVENT,X)},this.onConfigError=(j,H)=>{const X=new Kt(Object.assign(Object.assign({},j),Aa(H)));this.emit(vu.ANALYTICS_EVENT,X)},this.onConfigTrace=(j,H)=>{const X=new wr(Object.assign(Object.assign({},j),Aa(H)));this.emit(vu.ANALYTICS_EVENT,X)},this.onConfigAssignment=(j,H)=>{const X=new In(Object.assign(Object.assign({},j),Aa(H)));this.emit(vu.ANALYTICS_EVENT,X)},this.cacheContextForSource=(j,H)=>nS(this,void 0,void 0,(function*(){const X=yield(re=>N0(void 0,void 0,void 0,(function*(){const se={customerIds:[],hosts:[]};if(re.customerId){const ee=yield(0,pn.hashProperty)(re.customerId);if(!ee.ok)return pn.err(`customerId: ${ee.error}`);se.customerIds.push(ee.value)}if(re.host){const ee=yield(0,pn.hashProperty)(re.host);if(!ee.ok)return pn.err(`host: ${ee.error}`);se.hosts.push(ee.value)}return pn.ok(se)})))(H);X.ok?(this.context=Hp(j,X.value,this.context),(re=>{try{const se=JSON.stringify(re);return localStorage.setItem(tS,se),pn.ok(void 0)}catch(se){return pn.err(`Error while storing: ${se}`)}})(this.context)):this.logger.error("[cacheContextForSource] ",X.error)})),this.disableConfigRefresh=()=>{this.fsm.transition(na.PAUSE)},this.enableConfigRefresh=()=>{this.fsm.transition(na.ACTIVATE)},this.logger=(O={name:"GlobalConfigManager"},(0,pn.createLogger)(O)),this.logger.setConfig({enabled:!0,levels:{debug:!1,log:eh,info:eh,error:eh,warn:eh}}),this.context=bu(my()),this.overrides=Object.assign(Object.assign({},{refreshIntervalSeconds:Jh}),E),this.fsm=(0,pn.createFsm)({initialState:Ss.IDLE,transitions:Lp,callbacks:{onStateChanged:this.onStateChanged}}),this.manager=pn.DeviceConfigManager.getInstance(window,{fileKey:(A=is("fileKey"))!==null&&A!==void 0?A:Ii,standardEnv:Ld,refresh:{refreshIntervalSeconds:this.overrides.refreshIntervalSeconds,canRefreshNow:this.handleRefresh},fetch:this.overrides.refreshRequestHook,trace:{onTrace:j=>{this.logger.log("[onTrace] ",j)}},emitMetrics:this.onMetricsEmitted,analyticsProperties:{env:Ld,client_sdk:"broadcast-web"},enableConsoleLog:eh}),this.fsm.transition(na.INITIALIZE)}get state(){return this.fsm.currentState()}resolveExperimentsForSource(E,A){const O=Bf(A,E,this.context),j=this.getResolvedExperiments([P_.EXPERIMENT_FOOBAR],O);this.logger.info("[resolveExperimentContext]",j)}getRemoteStageSubscribeConfiguration(E){const A=Bf(E,Ga.RT,this.context);return this.getRemoteConfigurationForProperty(Fl.STAGE_SUBSCRIBE_CONFIGURATION,A,Fp)}getConfigurationHolder(E){var A;return(A=this.manager)===null||A===void 0?void 0:A.getConfigurationHolder({analytics:{onValue:O=>{this.onConfigValue(O,E)},onError:O=>{this.onConfigError(O,E)},onTrace:O=>{this.onConfigTrace(O,E)},onAssignment:O=>{this.onConfigAssignment(O,E)}}})}getRemoteConfigurationForProperty(E,A,O){const j=this.getConfigurationHolder(A);if(j)return j.getResolvedConfigForPropertyKey({key:E,context:A,schema:O,trace:eh});this.logger.error("[getRemoteConfigurationForProperty] No config manager is present")}getResolvedExperiments(E,A){const O=this.getConfigurationHolder(A);if(O)return O.getResolvedExperimentForPropertyKeys({keys:E,context:A,trace:eh});this.logger.error("[getResolvedExperiments] No config manager is present")}}var To=i(6880),D_=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};function L_(C){return D_(this,void 0,void 0,(function*(){const E=re=>{let se="";return re.architecture=="x86"&&re.bitness=="64"?se="; Win64; x64":re.architecture=="arm"?se="; ARM":re.wow64===!0&&(se="; WOW64"),`Windows NT ${(function(ee){const he=new Map([["0.3.0","6.3"],["0.2.0","6.2"],["0.1.0","6.1"]]),Ee=ee??"";return he.has(Ee)?he.get(Ee):"10.0"})(re.platformVersion)}${se}`},A=navigator.userAgentData;if(!A)return Promise.resolve(void 0);let O,j,H=!1;const X=new RegExp("AppleWebKit/537.36 \\(KHTML, like Gecko\\) (?:SamsungBrowser/[\\d.]+ )?Chrome/[\\d.]+ (Mobile )?Safari/537.36(?: Edg[A]?/[\\d.]+)?");return A.brands.forEach((re=>{re.brand=="Chromium"?(H=X.test(navigator.userAgent),O=parseFloat(re.version)):re.brand=="Samsung Internet"?j={brand:"Samsung Internet",version:re.version}:re.brand=="Microsoft Edge"&&(j={brand:"Microsoft Edge",version:re.version})})),!H||O&&O<100?Promise.resolve(void 0):new Promise((re=>{A.getHighEntropyValues(C).then((se=>{var ee,he,Ee,Ce,Ye;let gt={platform:(ee=navigator.userAgentData)===null||ee===void 0?void 0:ee.platform,version:O},ft=Object.assign(gt,se);ft=(et=>(et.architecture||(et.architecture="x86"),et.bitness||(et.bitness="64"),et.model||(et.model=""),et.platform||(et.platform="Windows"),et.platformVersion||(et.platformVersion="10.0"),et.wow64||(et.wow64=!1),et))(ft);let lt="Mozilla/5.0 (";if(["Chrome OS","Chromium OS"].includes((he=ft?.platform)!==null&&he!==void 0?he:"")?lt+=(et=>{let ot="";return et.bitness=="64"?et.architecture=="x86"?ot="x86_64":et.architecture=="arm"&&(ot="aarch64"):et.architecture=="arm"&&et.bitness=="32"&&(ot="armv7l"),ot==""?`X11; CrOS ${et.platformVersion}`:`X11; CrOS ${ot} ${et.platformVersion}`})(ft):ft.platform=="Windows"?lt+=E(ft):ft.platform=="macOS"?lt+=(et=>{var ot;let Mt="Macintosh; Intel Mac OS X ",gn=(ot=et.platformVersion)!==null&&ot!==void 0?ot:"";return gn.indexOf(".")>-1&&(gn=gn.split(".").join("_")),Mt+=gn,Mt})(ft):ft.platform=="Android"?lt+=(et=>{let ot="Linux; Android ";return ot+=et.platformVersion,et.model&&(ot+="; ",ot+=et.model),ot})(ft):lt+="X11; Linux x86_64",lt+=") AppleWebKit/537.36 (KHTML, like Gecko) Chrome/",lt+=D0((Ee=ft?.fullVersionList)!==null&&Ee!==void 0?Ee:[],gt.version,j),A.mobile&&(lt+=" Mobile"),lt+=" Safari/537.36",j?.brand==="Samsung Internet"){const et=D0((Ce=ft?.fullVersionList)!==null&&Ce!==void 0?Ce:[],void 0,j);lt=lt.replace(" Safari/537.36",` SamsungBrowser/${et} Safari/537.36`)}else if(j?.brand==="Microsoft Edge"){const et=D0((Ye=ft?.fullVersionList)!==null&&Ye!==void 0?Ye:[],void 0,j);lt+=` ${A.mobile?"EdgA":"Edg"}/${et}`}re(lt)})).catch((()=>{re(void 0)}))}))}))}function D0(C,E,A){var O,j;return A?((O=C?.find((H=>H.brand===A.brand)))===null||O===void 0?void 0:O.version)||`${A.version}.0.0.0`:((j=C?.find((H=>H.brand=="Google Chrome")))===null||j===void 0?void 0:j.version)||`${E}.0.0.0`}const vn="model",ln="type",fn="vendor",$a="console",zr="mobile",Yr="tablet",Wa="smarttv",th="wearable",wo="embedded",L0="Amazon",Ra="Apple",gy="ASUS",jl="Google",Ud="Huawei",dl="LG",Qh="Microsoft",U0="Motorola",Ue="Samsung",Ff="Sharp",zl="Sony",ia="Xiaomi",Mr="Zebra",ef=(C,E)=>{if(typeof C=="string")return C=C.replace(/^\s\s*/,""),E===void 0?C:C.substring(0,500)},nh=function(C,E){let A,O,j,H,X,re,se=0;for(;E&&se<E.length&&!X;){const ee=E[se],he=E[se+1];for(A=O=0;A<ee.length&&!X&&ee[A];){const Ee=ee[A++];if(X=typeof Ee.exec=="function"?Ee.exec(C):void 0,X)for(j=0;j<he.length;j++)re=X[++O],H=he[j],typeof H=="object"&&H.length>0?H.length===2?typeof H[1]=="function"?this[H[0]]=H[1].call(this,re):this[H[0]]=H[1]:H.length===3?typeof H[1]!="function"||H[1].exec&&H[1].test?this[H[0]]=typeof re=="string"?re.replace(H[1],H[2]):void 0:this[H[0]]=re?H[1].call(this,re,H[2]):void 0:H.length===4&&H[0]!==void 0&&(this[H[0]]=re?H[3].call(this,re.replace(H[1],H[2])):void 0):this[H]=re||void 0}se+=2}},pl={device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[vn,[fn,Ue],[ln,Yr]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[vn,[fn,Ue],[ln,zr]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[vn,[fn,Ra],[ln,zr]],[/\((ipad);[-\w),; ]+apple/i,/applecoremedia\/[\w.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[vn,[fn,Ra],[ln,Yr]],[/(macintosh);/i],[vn,[fn,Ra]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[vn,[fn,Ff],[ln,zr]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[vn,[fn,Ud],[ln,Yr]],[/(?:huawei|honor)([-\w ]+)[;)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[vn,[fn,Ud],[ln,zr]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[vn,/_/g," "],[fn,ia],[ln,zr]],[/oid[^)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[vn,/_/g," "],[fn,ia],[ln,Yr]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[vn,[fn,"OPPO"],[ln,zr]],[/\b(opd2\d{3}a?) bui/i],[vn,[fn,"OPPO"],[ln,Yr]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at]?)(?: bui|;|\))/i],[vn,[fn,"Vivo"],[ln,zr]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[vn,[fn,"Realme"],[ln,zr]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w() ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[vn,[fn,U0],[ln,zr]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[vn,[fn,U0],[ln,Yr]],[/((?=lg)?[vl]k-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[vn,[fn,dl],[ln,Yr]],[/(lm(?:-?f100[nv]?|-[\w.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[vn,[fn,dl],[ln,zr]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[vn,[fn,"Lenovo"],[ln,Yr]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w.]*)/i],[[vn,/_/g," "],[fn,"Nokia"],[ln,zr]],[/(pixel c)\b/i],[vn,[fn,jl],[ln,Yr]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[vn,[fn,jl],[ln,zr]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[vn,[fn,zl],[ln,zr]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[vn,"Xperia Tablet"],[fn,zl],[ln,Yr]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[vn,[fn,"OnePlus"],[ln,zr]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[vn,[fn,L0],[ln,Yr]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[vn,/(.+)/g,"Fire Phone $1"],[fn,L0],[ln,zr]],[/(playbook);[-\w),; ]+(rim)/i],[vn,fn,[ln,Yr]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[vn,[fn,"BlackBerry"],[ln,zr]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[vn,[fn,gy],[ln,Yr]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[vn,[fn,gy],[ln,zr]],[/(nexus 9)/i],[vn,[fn,"HTC"],[ln,Yr]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[fn,[vn,/_/g," "],[ln,zr]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[vn,[fn,"Acer"],[ln,Yr]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[vn,[fn,"Meizu"],[ln,zr]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[vn,[fn,"Ulefone"],[ln,zr]],[/(blackberry|benq|palm(?=-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[fn,vn,[ln,zr]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[fn,vn,[ln,Yr]],[/(surface duo)/i],[vn,[fn,Qh],[ln,Yr]],[/droid [\d.]+; (fp\du?)(?: b|\))/i],[vn,[fn,"Fairphone"],[ln,zr]],[/(u304aa)/i],[vn,[fn,"AT&T"],[ln,zr]],[/\bsie-(\w*)/i],[vn,[fn,"Siemens"],[ln,zr]],[/\b(rct\w+) b/i],[vn,[fn,"RCA"],[ln,Yr]],[/\b(venue[\d ]{2,7}) b/i],[vn,[fn,"Dell"],[ln,Yr]],[/\b(q(?:mv|ta)\w+) b/i],[vn,[fn,"Verizon"],[ln,Yr]],[/\b(?:barnes[& ]+noble |bn[rt])([\w+ ]*) b/i],[vn,[fn,"Barnes & Noble"],[ln,Yr]],[/\b(tm\d{3}\w+) b/i],[vn,[fn,"NuVision"],[ln,Yr]],[/\b(k88) b/i],[vn,[fn,"ZTE"],[ln,Yr]],[/\b(nx\d{3}j) b/i],[vn,[fn,"ZTE"],[ln,zr]],[/\b(gen\d{3}) b.+49h/i],[vn,[fn,"Swiss"],[ln,zr]],[/\b(zur\d{3}) b/i],[vn,[fn,"Swiss"],[ln,Yr]],[/\b((zeki)?tb.*\b) b/i],[vn,[fn,"Zeki"],[ln,Yr]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[fn,"Dragon Touch"],vn,[ln,Yr]],[/\b(ns-?\w{0,9}) b/i],[vn,[fn,"Insignia"],[ln,Yr]],[/\b((nxa|next)-?\w{0,9}) b/i],[vn,[fn,"NextBook"],[ln,Yr]],[/\b(xtreme_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[fn,"Voice"],vn,[ln,zr]],[/\b(lvtel-)?(v1[12]) b/i],[[fn,"LvTel"],vn,[ln,zr]],[/\b(ph-1) /i],[vn,[fn,"Essential"],[ln,zr]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[vn,[fn,"Envizen"],[ln,Yr]],[/\b(trio[-\w. ]+) b/i],[vn,[fn,"MachSpeed"],[ln,Yr]],[/\btu_(1491) b/i],[vn,[fn,"Rotor"],[ln,Yr]],[/(shield[\w ]+) b/i],[vn,[fn,"Nvidia"],[ln,Yr]],[/(sprint) (\w+)/i],[fn,vn,[ln,zr]],[/(kin\.[onetw]{3})/i],[[vn,/\./g," "],[fn,Qh],[ln,zr]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[vn,[fn,Mr],[ln,Yr]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[vn,[fn,Mr],[ln,zr]],[/smart-tv.+(samsung)/i],[fn,[ln,Wa]],[/hbbtv.+maple;(\d+)/i],[[vn,/^/,"SmartTV"],[fn,Ue],[ln,Wa]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[fn,dl],[ln,Wa]],[/(apple) ?tv/i],[fn,[vn,Ra+" TV"],[ln,Wa]],[/crkey/i],[[vn,"Chromecast"],[fn,jl],[ln,Wa]],[/droid.+aft(\w+)( bui|\))/i],[vn,[fn,L0],[ln,Wa]],[/\(dtv[);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[vn,[fn,Ff],[ln,Wa]],[/(bravia[\w ]+)( bui|\))/i],[vn,[fn,zl],[ln,Wa]],[/(mitv-\w{5}) bui/i],[vn,[fn,ia],[ln,Wa]],[/Hbbtv.*(technisat) (.*);/i],[fn,vn,[ln,Wa]],[/\b(roku)[\dx]*[)/]((?:dvp-)?[\d.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w+ ]*; *([\w\d][^;]*);([^;]*)/i],[[fn,ef],[vn,ef],[ln,Wa]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[ln,Wa]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[fn,vn,[ln,$a]],[/droid.+; (shield) bui/i],[vn,[fn,"Nvidia"],[ln,$a]],[/(playstation [345portablevi]+)/i],[vn,[fn,zl],[ln,$a]],[/\b(xbox(?: one)?(?!; xbox))[); ]/i],[vn,[fn,Qh],[ln,$a]],[/((pebble))app/i],[fn,vn,[ln,th]],[/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i],[vn,[fn,Ra],[ln,th]],[/droid.+; (glass) \d/i],[vn,[fn,jl],[ln,th]],[/droid.+; (wt63?0{2,3})\)/i],[vn,[fn,Mr],[ln,th]],[/(quest( \d| pro)?)/i],[vn,[fn,"Facebook"],[ln,th]],[/(tesla)(?: qtcarbrowser|\/[-\w.]+)/i],[fn,[ln,wo]],[/(aeobc)\b/i],[vn,[fn,L0],[ln,wo]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[vn,[ln,zr]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[vn,[ln,Yr]],[/\b((tablet|tab)[;/]|focus\/\d(?!.+mobile))/i],[[ln,Yr]],[/(phone|mobile(?:[;/]| [ \w/.]*safari)|pda(?=.+windows ce))/i],[[ln,zr]],[/(android[-\w. ]{0,9});.+buil/i],[vn,[fn,"Generic"]]]};var jf=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};function fc(C){const{globalSessionId:E,userAgent:A}=C,O=A??navigator.userAgent,j=To.getParser(O),H=(function(re){const se=/^(\d+)\.(\d+)\.(\d+)[+|-]?(.*)?$/.exec(re)||/^(\d+)\.(\d+)[+|-]?(.*)?$/.exec(re)||/^(\d+)$/.exec(re)||[];return{major:parseInt(se[1],10)||0,minor:parseInt(se[2],10)||0,patch:parseInt(se[3],10)||0}})(String(j.getBrowserVersion())),X=(re=>{var se;const ee={};return ee[fn]=void 0,ee[vn]=void 0,ee[ln]=void 0,nh.call(ee,(se=re??navigator.userAgent)!==null&&se!==void 0?se:"",pl.device),ee})(O);return{browser:navigator.appVersion,browser_family:j.getBrowserName().toLowerCase(),browser_version:`${H.major}.${H.minor}`,customer_id:"ivs",host:window.location.hostname,os_name:j.getOSName(),os_version:String(j.getOSVersion()),platform:"web",global_session_id:E,sdk_version:"1.31.1",user_agent:O,is_backgrounded:document?.visibilityState==="hidden",device_model:X.model,device_manufacturer:X.vendor,device_os_version:String(j.getOSVersion()),device_software:O}}function _y(C){return jf(this,void 0,void 0,(function*(){const E=yield(function(A=["architecture","bitness","model","platformVersion","fullVersionList"]){return D_(this,void 0,void 0,(function*(){try{const O=yield L_(A);return O??navigator.userAgent}catch{return navigator.userAgent}}))})();return fc(Object.assign(Object.assign({},C),{userAgent:E}))}))}var U_=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};class vy{constructor(){this.globalSessionId=hy(),this.currentGlobalEndpoint=M_,this.signalInternalUsage=()=>{this.usageReferences>0?this.configManager.enableConfigRefresh():this.configManager.disableConfigRefresh()},this.markSdkUsage=()=>{this.usageReferences++,this.signalInternalUsage()},this.removeSdkUsage=()=>{this.usageReferences=Math.max(0,this.usageReferences-1),this.signalInternalUsage()},this.usageReferences=0,this.healthReporter=new ta,this.networkMonitor=new I_,this.configManager=new xo,this.healthReporter.on(Kh.ANALYTICS_EVENT,(E=>{this.trackGlobalEvent(E)})),this.configManager.on(vu.ANALYTICS_EVENT,(E=>{this.trackGlobalEvent(E)})),this.configManager.on(vu.REFRESH,(()=>{this.signalInternalUsage()})),this.globalProperties=fc({globalSessionId:this.globalSessionId}),_y({globalSessionId:this.globalSessionId}).then((E=>{this.globalProperties=Object.assign(Object.assign({},this.globalProperties),E)})).catch(Yh)}updateGlobalProperties(){this.globalProperties=Object.assign(Object.assign({},this.globalProperties),{is_backgrounded:document?.visibilityState==="hidden"})}trackGlobalEvent(E){const A=this.getGlobalProperties();E.data.properties=Object.assign(Object.assign(Object.assign({},A),E.data.properties),{client_time:new Date().toISOString(),current_endpoint:this.currentEndpoint});const{headers:O,body:j}=R0([E.data]);w_((()=>U_(this,void 0,void 0,(function*(){yield Dp("POST",this.currentEndpoint,O,j)}))))}enrichContext(E){var A,O;return Object.assign({appLabel:(A=w0())!==null&&A!==void 0?A:"default",customerId:this.globalProperties.customer_id,host:this.globalProperties.host,browserFamily:this.globalProperties.browser_family,browserVersion:this.globalProperties.browser_version,osName:this.globalProperties.os_name,osVersion:this.globalProperties.os_version,userAgent:this.globalProperties.user_agent,sdkVersion:this.globalProperties.sdk_version,sessionId:(O=E.sessionId)!==null&&O!==void 0?O:""},E)}getGlobalSessionId(){return this.globalSessionId}getGlobalProperties(){return this.updateGlobalProperties(),this.globalProperties}set currentEndpoint(E){this.currentGlobalEndpoint=E}get currentEndpoint(){var E;return!((E=window.IVS_CLIENT_OVERRIDES)===null||E===void 0)&&E.analyticsPostUrl?window.IVS_CLIENT_OVERRIDES.analyticsPostUrl:this.currentGlobalEndpoint}trackEvent(E){E.type==="eventSenderResult"&&this.healthReporter.trackEventSendResult(E)}getNetworkQuality(){return this.networkMonitor.getNetworkQuality()}cacheRealTimeContext(E){const A=this.enrichContext(E);this.configManager.cacheContextForSource(Ga.RT,A).catch(Yh)}cacheLowLatencyContext(E){const A=this.enrichContext(E);this.configManager.cacheContextForSource(Ga.LL,A).catch(Yh)}resolveExperimentsForRealTimeContext(E){const A=this.enrichContext(E);this.configManager.resolveExperimentsForSource(Ga.RT,A)}getRemoteSubscribeConfig(E){const A=this.enrichContext(E);return this.configManager.getRemoteStageSubscribeConfiguration(A)}}window.IVS_CLIENT_GLOBAL_STATE||(window.IVS_CLIENT_GLOBAL_STATE={}),window.IVS_CLIENT_GLOBAL_STATE.session||(window.IVS_CLIENT_GLOBAL_STATE.session=new vy);const Bo=window.IVS_CLIENT_GLOBAL_STATE.session;function B0(C){if(!C)throw new Error("eventSender is not defined")}class zf{constructor(){this.sharedProperties={},this.eventSender={},this.queuedEvents=[],this.genSessionId();const E=w0();this.eventSender=new ds,this.initSharedProperties({appLabel:E}),this.errorReports=new Map}start(){this.flushInterval||(this.flushInterval=window.setInterval((()=>{this.queueAggregateErrors({force:!1}),this.flushEvents()}),1e3))}stop(E){let A=!1;clearInterval(this.flushInterval),this.flushInterval=void 0,this.queueAggregateErrors({force:!0}),E&&(this.queuedEvents=this.queuedEvents.filter((O=>O.critical)),A=!0),this.flushEvents(A),this.genSessionId()}trackEvent(E,A=!1){let O=this.sharedProperties;A&&(O={global_session_id:this.sharedProperties.global_session_id,session_id:this.sharedProperties.session_id,browser:this.sharedProperties.browser,browser_family:this.sharedProperties.browser_family,browser_version:this.sharedProperties.browser_version,os_name:this.sharedProperties.os_name,os_version:this.sharedProperties.os_version,is_backgrounded:this.sharedProperties.is_backgrounded}),document?.visibilityState==="hidden"&&(O.is_backgrounded=!0),"data"in E?(E.data.properties=Object.assign({},O,E.data.properties),this.queuedEvents.push(E.data)):(E.properties=Object.assign({},O,E.properties),this.queuedEvents.push(E))}trackEventNoSharedProps(E){this.trackEvent(E,!0)}trackErrorAndThrow(E){throw this.trackError(E),E}trackError(E){const A=`${E.code}${E.fatal}${E.nominal}${E.tag}${E.traceId.value}`,O=this.errorReports.get(A),j={error:E,queuedAt:Date.now(),count:0};return O?(O.count===0&&(O.error=E),O.count+=1,O.queuedAt+6e4<=Date.now()?(this.trackErrorReportIfNeeded(O),void this.errorReports.set(A,j)):void 0):(this.errorReports.set(A,j),void this.trackEvent(new fs(E)))}queueAggregateErrors({force:E=!1}){this.errorReports.forEach(((A,O)=>{const j=A.queuedAt+6e4;!E&&j>Date.now()||(this.trackErrorReportIfNeeded(A),this.errorReports.delete(O))}))}trackErrorReportIfNeeded(E){if(E.count===0)return;const A=E.error;A.count=E.count,this.trackEvent(new fs(A))}batchEvents(E){B0(this.eventSender);const A=E.map((O=>(O.data.properties=Object.assign({},this.sharedProperties,O.data.properties),O.data)));this.eventSender.send(A)}initSharedProperties({appLabel:E}){const A=Bo.getGlobalProperties();this.sharedProperties=Object.assign(Object.assign({},A),{session_id:this.sessionId}),E&&(this.sharedProperties.app_label=E)}genSessionId(){this.sessionId=hy(),this.sharedProperties.session_id=this.sessionId}flushEvents(E=!1){B0(this.eventSender),this.queuedEvents.length>0&&this.eventSender.send(this.queuedEvents,E),this.queuedEvents=[]}getSessionId(){return this.sessionId}}const qa={[W.INFO]:"#528bff",[W.WARN]:"#ffb31a",[W.DEBUG]:"#00f593",[W.ERROR]:"#ff4f4d",[W.TRACE]:"",[W.SILENT]:"",[le.TIME]:"#53535f",[le.WEBRTC]:"#0e9bd8",[le.SUBSCRIPTION]:"#ffc400",[le.CONNECTION]:"#ff5edb",[le.SOCKET]:"#8585ff",[le.EMITTER]:"#adadb8",[le.LOCAL_PARTICIPANT]:"#1DD21D",[le.STAGE]:"#EC9806",[le.REMOTE_PARTICIPANT]:"#0680EC",details:"#808080"},F0=({label:C})=>`background: ${qa[C]||"#333333"}; color: white; padding: 3px; margin-left: 3px;`,Ya=Object.entries(W),ml=(C,E,A)=>{const O=F0({label:C}),[j]=Ya.find((([,gt])=>gt===Number(C)))||[],H=`%c${j}`,X=F0({label:E}),re=`%c${E}`,se=F0({label:le.TIME}),ee=`%c[${new Date().toISOString()}]`,he=F0({label:"details"}),Ee=`%c[${A}]`,Ce=[ee,H,re],Ye=[se,O,X];return A&&(Ce.push(Ee),Ye.push(he)),[Ce.join(""),...Ye]},j0={debug(C){console.groupCollapsed(...ml(W.DEBUG,C.scope,C.label)),console.debug(C.msg,Object.assign(Object.assign({},C),{level:"debug"})),console.groupEnd()},info(C){console.groupCollapsed(...ml(W.INFO,C.scope,C.label)),console.info(C.msg,Object.assign(Object.assign({},C),{level:"info"})),console.groupEnd()},warn(C){console.groupCollapsed(...ml(W.WARN,C.scope,C.label)),console.warn(C.msg,Object.assign(Object.assign({},C),{level:"warn"})),console.groupEnd()},error(C){console.groupCollapsed(...ml(W.ERROR,C.scope,C.label)),console.error(C),console.groupEnd()}};var tf=function(C,E){var A={};for(var O in C)Object.prototype.hasOwnProperty.call(C,O)&&E.indexOf(O)<0&&(A[O]=C[O]);if(C!=null&&typeof Object.getOwnPropertySymbols=="function"){var j=0;for(O=Object.getOwnPropertySymbols(C);j<O.length;j++)E.indexOf(O[j])<0&&Object.prototype.propertyIsEnumerable.call(C,O[j])&&(A[O[j]]=C[O[j]])}return A};Object.entries(W);class zc{constructor(E=Rr,A=j0){this.logLevel=E,this.loggerInstance=A}debug(E){var A,O;this.logLevel>W.DEBUG||(O=(A=this.loggerInstance).debug)===null||O===void 0||O.call(A,JSON.parse(JSON.stringify(Object.assign(Object.assign({},E),{level:"debug"}))))}info(E){var A,O;this.logLevel>W.INFO||(O=(A=this.loggerInstance).info)===null||O===void 0||O.call(A,JSON.parse(JSON.stringify(Object.assign(Object.assign({},E),{level:"info"}))))}warn(E){var A,O;this.logLevel>W.WARN||(O=(A=this.loggerInstance).warn)===null||O===void 0||O.call(A,JSON.parse(JSON.stringify(Object.assign(Object.assign({},E),{level:"warn"}))))}error(E){var A,O,{err:j}=E,H=tf(E,["err"]);this.logLevel>W.ERROR||(O=(A=this.loggerInstance).error)===null||O===void 0||O.call(A,Object.assign({err:j},H))}}class Gs{constructor(E,A){this.logger=E,this.scope=A}debug(E){var A,O;(O=(A=this.logger).debug)===null||O===void 0||O.call(A,JSON.parse(JSON.stringify(Object.assign(Object.assign({},E),{scope:this.scope}))))}info(E){var A,O;(O=(A=this.logger).info)===null||O===void 0||O.call(A,JSON.parse(JSON.stringify(Object.assign(Object.assign({},E),{scope:this.scope}))))}warn(E){var A,O;(O=(A=this.logger).warn)===null||O===void 0||O.call(A,JSON.parse(JSON.stringify(Object.assign(Object.assign({},E),{scope:this.scope}))))}error(E){var A,O,{err:j}=E,H=tf(E,["err"]);(O=(A=this.logger).error)===null||O===void 0||O.call(A,Object.assign(Object.assign({err:j},H),{scope:this.scope}))}unwrap(){return this.logger}}class Hf{constructor(){this.min=0,this.max=0,this.sum=0,this.data=[]}push(E){(this.min===0||E<this.min)&&(this.min=E),E>=this.max&&(this.max=E),this.data.push(E),this.sum+=E}median(){this.data.sort();const E=this.data.length>>1;return this.data.length%2==0?this.data[E-1]+this.data[E]>>1:this.data[E]}percentile(E){if(this.data.length===0)return 0;if(E<=0)return this.data[0];if(E>=1)return this.data[this.data.length-1];const A=(this.data.length-1)*E,O=Math.floor(A),j=O+1,H=A%1;return j>=this.data.length?this.data[O]:this.data[O]*(1-H)+this.data[j]*H}}var Vf=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};class gl{constructor(E,A,O,j){this.peerClient=E,this.broadcastCanvasManager=A,this.analyticsTracker=j,this.logger=new Gs(O,le.EMITTER),this.previousBytesSent=0,this.startTimestamp=0,this.initializeSamples()}start(){this.logger.info({msg:"start emitter"}),this.collectSamplesTimerId=window.setInterval((()=>{this.collectSamples()}),1e3),this.trackSamplesTimerId=window.setInterval((()=>{this.trackSamples()}),3e4),this.trackPeerConnectionStatsTimerId=window.setInterval((()=>{this.trackPeerConnectionStats()}),6e4),this.trackSamples()}stop(){clearInterval(this.collectSamplesTimerId),clearInterval(this.trackSamplesTimerId),clearInterval(this.trackPeerConnectionStatsTimerId),this.collectSamplesTimerId=void 0,this.trackSamplesTimerId=void 0,this.trackPeerConnectionStatsTimerId=void 0}trackPeerConnectionStats(){return Vf(this,void 0,void 0,(function*(){(yield this.peerClient.getReports()).forEach((E=>{if(E.type==="outbound-rtp")switch(E.kind){case"audio":this.analyticsTracker.trackEvent(new Uf(E));break;case"video":{const A=new py(E),O=new Xh(E,this.startTimestamp);this.analyticsTracker.batchEvents([A,O]);break}default:this.logger.warn({msg:"unknown report kind: ",reportKind:E.kind})}}))}))}collectSamples(){return Vf(this,void 0,void 0,(function*(){let E=0;this.audioLatencySamples.push(this.broadcastCanvasManager.getAudioLatency()),this.videoLatencySamples.push(this.broadcastCanvasManager.getVideoLatency()),(yield this.peerClient.getReports()).forEach((O=>{switch(O.type){case"candidate-pair":O.nominated&&(this.rttSamples.push(O.currentRoundTripTime),this.recommendedBitrateSamples.push(O.availableOutgoingBitrate));break;case"outbound-rtp":E+=O.bytesSent||0,this.startTimestamp===0&&O.kind==="video"&&(this.startTimestamp=O.timestamp)}}));const A=8*Math.round(E-this.previousBytesSent);this.previousBytesSent=E,this.measuredBitrateSamples.push(A)}))}trackSamples(){const A=new Uo(this.audioLatencySamples,30),O=new Ti(this.videoLatencySamples,30),j=new eS(this.congestionTimeSamples,30),H=new Ju(this.measuredBitrateSamples,30),X=new Fc(this.recommendedBitrateSamples,30),re=new Nt(this.rttSamples,30);this.analyticsTracker.batchEvents([A,O,j,H,X,re]),this.initializeSamples()}initializeSamples(){this.audioLatencySamples=new Hf,this.videoLatencySamples=new Hf,this.congestionTimeSamples=new Hf,this.measuredBitrateSamples=new Hf,this.recommendedBitrateSamples=new Hf,this.rttSamples=new Hf}}const B_=C=>{const E=H=>{var X;return!((X=H.deviceId)===null||X===void 0)&&X.startsWith("web-contents-media-stream")?"tab":void 0},A=H=>{var X;return!((X=H.deviceId)===null||X===void 0)&&X.startsWith("window")&&H.displaySurface==="window"?"window":void 0},O=H=>{var X;return!((X=H.deviceId)===null||X===void 0)&&X.startsWith("screen")&&H.displaySurface==="monitor"?"screen":void 0};return(E(j=C)||A(j)||O(j)?void 0:"camera")||O(C)||A(C)||E(C)||"unknown";var j};function F_(C,E){return C.find((A=>A.kind===E))}function Bd(C){return C?.readyState==="live"}var vr;(function(C){C.VIDEO="video",C.AUDIO="audio"})(vr||(vr={}));class Fo{constructor(){this.mediaTracks=new Map([[vr.VIDEO,void 0],[vr.AUDIO,void 0]])}setTrack(E,A){this.mediaTracks.set(E,A)}getTrack(E){return this.mediaTracks.get(E)}}class z0{constructor(){this.levelAsymmetryAllowed=!1,this.packetisationMode=!1,this.profile="",this.level=0}extractVideoSdpFmtpLine(E){return E?(E.split("\r").join(";").split(`
`).join(";").split(" ").join(";").split(";").map((A=>A.trim())).filter(Boolean).forEach((A=>{const O=A.split("=");if(O.length===2)switch(O[0]){case"level-asymmetry-allowed":O[1]==="1"?this.levelAsymmetryAllowed=!0:this.levelAsymmetryAllowed=!1;break;case"packetization-mode":O[1]==="1"?this.packetisationMode=!0:this.packetisationMode=!1;break;case"profile-level-id":this.profile=this.getProfileFromId(O[1]),this.level=this.getLevelFromId(O[1])}})),{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}):{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}}getProfileFromId(E){const A=E.substr(0,2),O=E.substr(2,2);switch(A.substr(0,2)){case"42":return"baseline";case"4d":return"main";case"58":return"extended";case"64":return"high";case"6e":return O==="00"?"high 10":"high 10 intra";case"7a":return O==="00"?"high 42":"high 42 intra";case"f4":return O==="00"?"high 44":"high 44 intra";default:return"unknown"}}getLevelFromId(E){return parseInt(E.substr(4,2),16)}}function rS(C){return btoa(JSON.stringify(C))}var Ns,H0=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};(function(C){C.IDLE="idle",C.EXECUTING="executing",C.RECONNECTING="reconnecting"})(Ns||(Ns={}));class Vp{constructor(E,A=12e4,O,j){this.state=Ns.IDLE,this.failureCallback=()=>{},this.peerClient=E,this.timeout=A,this.logger=O,this.emitter=j}onFailure(E){this.failureCallback=E}setStartConfig(E,A){this.ingestEndpoint=E,this.streamKey=A}execute(){const{id:E}=this;this.state===Ns.IDLE&&(this.state=Ns.EXECUTING,this.emitter.emit(uc.CONNECTION_STATE_CHANGE,Zn.CONNECTING),this.logger.info({msg:"Starting execution of reconnect strategy.",id:E}),this.startTimeoutTimer(this.timeout),this.executeStrategy())}startTimeoutTimer(E){this.timeoutTimerId=window.setTimeout((()=>{this.state!==Ns.IDLE&&(this.logger.info({msg:"Reconnect strategy timed out."}),this.stop(),this.emitter.emit(uc.CONNECTION_STATE_CHANGE,Zn.FAILED),this.failureCallback())}),E)}stop(){this.state=Ns.IDLE,clearTimeout(this.timeoutTimerId),this.stopStrategy()}reconnect(){return H0(this,void 0,void 0,(function*(){if(this.ingestEndpoint&&this.streamKey){const E=this.peerClient.getConnectionState();try{this.logger.info({msg:"Attempting reconnect."}),E===Zn.CONNECTED?this.logger.info({msg:"Already connected! Stopping reconnect strategy."}):(yield this.peerClient.start(this.ingestEndpoint,this.streamKey),this.logger.info({msg:"Reconnect succeeded!"})),this.stop()}catch(A){throw this.logger.error({err:A}),A}}}))}isActive(){return this.state!==Ns.IDLE}}class Gf extends Vp{constructor(){super(...arguments),this.id="ExponentialBackoffStrategy"}executeStrategy(){let E=5e3;const A=()=>H0(this,void 0,void 0,(function*(){if(this.state===Ns.EXECUTING)try{this.state=Ns.RECONNECTING,yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed. Trying again in: ",nextRetry:E}),this.state=Ns.EXECUTING,this.currentTimeoutId=window.setTimeout(A,E),E*=2}}));this.currentTimeoutId=window.setTimeout(A,0)}stopStrategy(){clearTimeout(this.currentTimeoutId)}}class Fd extends Vp{constructor(){super(...arguments),this.id="NetworkApiStrategy",this.onConnectionChange=()=>H0(this,void 0,void 0,(function*(){if(navigator.onLine&&this.state===Ns.EXECUTING){this.state=Ns.RECONNECTING;try{yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed."}),this.state=Ns.EXECUTING}}}))}executeStrategy(){navigator.connection.addEventListener("change",this.onConnectionChange),this.onConnectionChange()}stopStrategy(){navigator.connection.removeEventListener("change",this.onConnectionChange)}}class sa{static create(E,A=js,O,j){const{reconnect:H,timeout:X}=A;if(H){const re=To.getParser(navigator.userAgent).getBrowserName().toLowerCase();return["edge","chrome"].includes(re)&&navigator.connection?new Fd(E,X,O,j):new Gf(E,X,O,j)}}}var Gp,$p=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))},hT=function(C,E,A,O){if(typeof E=="function"?C!==E||!O:!E.has(C))throw new TypeError("Cannot read private member from an object whose class did not declare it");return A==="m"?O:A==="a"?O.call(C):O?O.value:E.get(C)};const j_=C=>!!C;function Hc(C){if(!C)throw new Error("PeerConnection is not defined")}const yy={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",enableDtlsSrtp:{exact:!0},enableRtpDataChannels:{exact:!1},optional:[{googHighStartBitrate:{exact:0}},{googPayloadPadding:{exact:!0}},{googScreencastMinBitrate:{exact:100}},{googCpuOveruseDetection:{exact:!0}},{googCpuOveruseEncodeUsage:{exact:!0}},{googCpuUnderuseThreshold:{exact:55}},{googCpuOveruseThreshold:{exact:85}},{enableDscp:{exact:!0}}]};class Si{constructor(E,A,O,j,H){this.config=E,this.emitter=A,this.mediaStreamManager=O,this.analyticsTracker=H,this.establishConnection=(X,re)=>$p(this,void 0,void 0,(function*(){var se,ee,he;Hc(this.peerConnection);try{const Ee=yield this.peerConnection.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1});yield this.handleLocalDescription(Ee),yield this.sendSetupRequest(X,re,Ee)}catch(Ee){if(Ee instanceof Error){(se=(he=Ee).code)!==null&&se!==void 0||(he.code=_n.code);const Ce=new ve(Object.assign(Object.assign({},_n),{name:Ee.name,message:Ee.message,code:Ee?.code,cause:Ee}));throw!((ee=this.reconnectStrategy)===null||ee===void 0)&&ee.isActive()||this.handleError(Ee.code,Ee.message),this.stop(),Ce}}})),this.getSessionId=()=>this.ingestSessionId,this.getConnectionState=()=>{var X;if(!this.peerConnection)return Zn.NONE;const re=(X=this.reconnectStrategy)===null||X===void 0?void 0:X.isActive(),se=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;switch(se){case"new":return Zn.NEW;case"closed":return Zn.CLOSED;case"disconnected":return re?Zn.CONNECTING:Zn.DISCONNECTED;case"failed":return re?Zn.CONNECTING:Zn.FAILED;case"idle":return Zn.IDLE;case"checking":case"connecting":return Zn.CONNECTING;case"completed":case"connected":return Zn.CONNECTED;default:return this.logger.warn({msg:"Unhandled connection state:",rawState:se}),Zn.IDLE}},this.onConnectionStateChange=()=>{var X;const re=this.getConnectionState();switch(re){case Zn.CONNECTED:{this.emitter.emit(uc.CONNECTION_STATE_CHANGE,re);const se=new Date;this.analyticsTracker.trackEvent(new Up(se,this.connectionStartDate,this.ingestSessionId));const ee=this.mediaStreamManager.getTrack(vr.AUDIO),he=this.mediaStreamManager.getTrack(vr.VIDEO);if(he){const Ee=he.getSettings();this.analyticsTracker.trackEvent(new Qu(Ee))}if(ee){const Ee=ee.getSettings();this.analyticsTracker.trackEvent(new M0(Ee))}(((X=this.peerConnection)===null||X===void 0?void 0:X.getSenders())||[]).forEach((Ee=>{var Ce;(((Ce=Ee.getParameters())===null||Ce===void 0?void 0:Ce.codecs)||[]).forEach((Ye=>{var gt;switch((gt=Ee.track)===null||gt===void 0?void 0:gt.kind){case"video":{if(!he)break;const ft=new z0().extractVideoSdpFmtpLine(Ye.sdpFmtpLine),lt=he.getSettings();this.analyticsTracker.trackEvent(new Zh(lt,ft,Ye));break}case"audio":if(!ee)break;this.analyticsTracker.trackEvent(new Bp(Ye))}}))}));break}case Zn.CONNECTING:this.emitter.emit(uc.CONNECTION_STATE_CHANGE,re),this.connectionStartDate=new Date,this.disconnectionStartDate=void 0;break;case Zn.FAILED:this.reconnectStrategy?this.reconnectStrategy.execute():(this.emitter.emit(uc.CONNECTION_STATE_CHANGE,re),this.handleTerminalConnectionFailure());break;case Zn.DISCONNECTED:this.emitter.emit(uc.CONNECTION_STATE_CHANGE,re),this.disconnectionStartDate=new Date;break;default:this.emitter.emit(uc.CONNECTION_STATE_CHANGE,re)}},this.handleLocalDescription=X=>$p(this,void 0,void 0,(function*(){var re;return(re=this.peerConnection)===null||re===void 0?void 0:re.setLocalDescription(X)})),Gp.set(this,(X=>{if(typeof X!="string")throw new ve(qi);try{new URL(X)}catch{throw new ve(oi)}})),this.logger=new Gs(j,le.WEBRTC),this.createReconnectStrategy(E)}start(E,A){var O;return $p(this,void 0,void 0,(function*(){hT(this,Gp,"f").call(this,E);const j=[this.mediaStreamManager.getTrack(vr.VIDEO),this.mediaStreamManager.getTrack(vr.AUDIO)].filter(j_);if(this.createPeerConnection(),this.addTracks({tracks:j}),this.reconnectStrategy&&this.reconnectStrategy.setStartConfig(E,A),yield this.establishConnection(E,A),!((O=this.reconnectStrategy)===null||O===void 0)&&O.isActive()){const H=new URL(E);this.analyticsTracker.trackEvent(new dy({protocol:"webrtc",hostname:H.hostname,port:H.port},Zu.NETWORK_DISCONNECT))}}))}stop(){var E,A,O,j;this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stopStreamDataChannel&&this.stopStreamDataChannel.readyState==="open"&&this.stopStreamDataChannel.send(" "),[Zn.NEW,Zn.CONNECTING,Zn.CONNECTED].includes(this.getConnectionState())&&this.emitter.emit(uc.CONNECTION_STATE_CHANGE,Zn.CLOSED),(E=this.peerConnection)===null||E===void 0||E.close(),(A=this.peerConnection)===null||A===void 0||A.removeEventListener("connectionstatechange",this.onConnectionStateChange),(O=this.peerConnection)===null||O===void 0||O.removeEventListener("iceconnectionstatechange",this.onConnectionStateChange),this.ingestSessionId=void 0,(j=this.reconnectStrategy)===null||j===void 0||j.stop()}addTracks(E){var A;if(Hc(this.peerConnection),!E)return;const O=this.peerConnection.getSenders().map((H=>{var X;return(X=H.track)===null||X===void 0?void 0:X.id})),j=E.tracks.filter((H=>!O.includes(H.id)));for(const H of j)(A=this.peerConnection)===null||A===void 0||A.addTrack(H)}getReports(){var E;return $p(this,void 0,void 0,(function*(){try{const A=(yield(E=this.peerConnection)===null||E===void 0?void 0:E.getStats())||[],O=[];return A.forEach((j=>{O.push(j)})),O}catch{return[]}}))}sendSetupRequest(E,A,O){var j;return $p(this,void 0,void 0,(function*(){const H=yield fetch(`${E}/v1/offer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({offer:rS(O),streamKey:A},this.config.streamConfig))});if(!H.ok)throw(function(re){let se=new ve(Object.assign({},_n));return re?.code===1007&&(se=new ve(Object.assign({},mn))),re?.message&&(se.message=re.message),se})(yield H.json());const X=yield H.json();X?.answer&&(yield(j=this.peerConnection)===null||j===void 0?void 0:j.setRemoteDescription((function(re){return JSON.parse(atob(re))})(X.answer)),this.ingestSessionId=X.ingestSessionId)}))}handleTerminalConnectionFailure(){const E=new ve(jt);this.handleError(E.code,E.message)}handleError(E,A){this.analyticsTracker.trackEvent(new Hs({code:E,description:A,isFatal:!0})),this.emitter.emit(uc.ERROR,{code:E,message:A})}createPeerConnection(){var E;const A=this.getConnectionState(),O=A!==Zn.NONE,j=A!==Zn.CLOSED,H=(E=this.reconnectStrategy)===null||E===void 0?void 0:E.isActive();O&&j&&!H||(this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stateCheckInterval=window.setInterval((()=>{const X=this.getConnectionState();if(this.reconnectStrategy&&X===Zn.DISCONNECTED&&this.disconnectionStartDate){const re=Date.now()-this.disconnectionStartDate.getTime();this.logger.info({msg:"Time since disconnected:",timeSinceDisconnect:re}),re>1e4&&(this.disconnectionStartDate=void 0,this.reconnectStrategy.execute())}else X===Zn.CLOSED&&(this.handleTerminalConnectionFailure(),clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0)}),1e3),this.peerConnection=new RTCPeerConnection(yy),this.stopStreamDataChannel=this.peerConnection.createDataChannel("stopStream"),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onConnectionStateChange))}createReconnectStrategy(E){if(this.reconnectStrategy=sa.create(this,E.networkReconnectConfig,this.logger,this.emitter),this.reconnectStrategy){this.reconnectStrategy.onFailure(this.handleTerminalConnectionFailure.bind(this));const A=this.reconnectStrategy.id;this.logger.info({msg:"Using reconnect strategy:",strategyId:A})}}}Gp=new WeakMap;var rh,by,Sy=i(5364);(function(C){C.CONFIG="config",C.UPDATE="update",C.START="start",C.STOP="stop"})(rh||(rh={})),(function(C){C.VIDEO_SEND="video/send",C.VIDEO_RECEIVE="video/receive",C.INSERT_SEI="insertSei"})(by||(by={}));var Ey=i(5512),iS=i.n(Ey);function xy(){return iS()(`/*! For license information please see scheduler.worker.worker.js.LICENSE.txt */
(()=>{"use strict";var i,t;!function(i){i.CONFIG="config",i.UPDATE="update",i.START="start",i.STOP="stop"}(i||(i={})),function(i){i.VIDEO_SEND="video/send",i.VIDEO_RECEIVE="video/receive",i.INSERT_SEI="insertSei"}(t||(t={}));const s=self;const n=new class Scheduler{constructor(){this.config={frameRate:60,isRunning:!1}}setConfig(i){this.config=Object.assign(Object.assign({},this.config),i),this.config.isRunning&&(this.stop(),this.start())}start(){this.config.isRunning||(this.intervalId=setInterval((()=>{s.postMessage({type:i.UPDATE})}),1e3/this.config.frameRate),this.config.isRunning=!0)}stop(){this.config.isRunning&&(clearInterval(this.intervalId),this.intervalId=void 0,this.config.isRunning=!1)}};s.addEventListener("message",(function(t){var s;if(null===(s=null==t?void 0:t.data)||void 0===s?void 0:s.type)switch(t.data.type){case i.CONFIG:n.setConfig(t.data.payload||{});break;case i.START:n.start();break;case i.STOP:n.stop()}}))})();`,"Worker",void 0,void 0)}var Wp=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};class z_{constructor(E,A,O){this.config=E,this.mediaStreamManager=A,this.analyticsTracker=O,this.handleWorkerEvent=re=>{var se;((se=re.data)===null||se===void 0?void 0:se.type)===rh.UPDATE&&this.drawComposite()},this.mixer={video:[],audio:[]},this.schedulerWorker=new xy,this.running=!1,this.compositeEl=document.createElement("canvas"),this.compositeEl.height=this.config.streamConfig.maxResolution.height,this.compositeEl.width=this.config.streamConfig.maxResolution.width;const j=this.compositeEl.getContext("2d");if(j===null)throw new ve(Object.assign({},Xe));this.compositeContext=j,this.compositeStream=this.compositeEl.captureStream(typeof CanvasCaptureMediaStreamTrack!==void 0?0:30);const H=F_(this.compositeStream.getTracks(),vr.VIDEO);this.audioContext=new AudioContext,this.unlockAudioContext(),this.audioDestination=this.audioContext.createMediaStreamDestination(),this.setupSilence();const X=F_(this.audioDestination.stream.getTracks(),vr.AUDIO);H&&this.mediaStreamManager.setTrack(vr.VIDEO,H),X&&this.mediaStreamManager.setTrack(vr.AUDIO,X),this.schedulerWorker.addEventListener("message",this.handleWorkerEvent),this.schedulerWorker.postMessage({type:rh.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.previewElement=null,this.previewCtx=null,this.nextMix=new Date().getTime()}attachPreview(E){this.previewElement=E;const{width:A,height:O}=this.config.streamConfig.maxResolution;this.previewElement.width=A,this.previewElement.height=O,this.previewCtx=this.previewElement.getContext("2d")}detachPreview(){this.previewElement=null,this.previewCtx=null}setupSilence(){const E=this.audioContext.createConstantSource(),A=this.audioContext.createGain();A.gain.value=.001,E.connect(A),A.connect(this.audioDestination),E.start()}unlockAudioContext(){if(this.audioContext.state!=="suspended")return;const E=document.body,A=["touchstart","touchend","mousedown","keydown"],O=()=>{A.forEach((H=>{E.removeEventListener(H,j)}))},j=()=>{this.audioContext.resume().then(O)};A.forEach((H=>{E.addEventListener(H,j,!1)}))}getTracks(){return[this.mediaStreamManager.getTrack(vr.VIDEO),this.mediaStreamManager.getTrack(vr.AUDIO)]}getCanvasVideoTrack(){return this.mediaStreamManager.getTrack(vr.VIDEO)}getAudioInputDevice(E){if(typeof E!="string")return;const A=this.mixer.audio.find((O=>{if(O.name===E)return O.source}));return A?.source}getVideoInputDevice(E){if(typeof E=="string")return this.mixer.video.find((A=>A.name===E))}getCanvasDimensions(){return{height:this.compositeEl.height,width:this.compositeEl.width}}addVideoInputDevice(E,A,O){var j;return Wp(this,void 0,void 0,(function*(){if(typeof E!="object")throw new ve(Object.assign({},je));if(!A||typeof A!="string")throw new ve(Object.assign({},rt));if(this.mixer.video.some((Ce=>Ce.name===A)))throw new ve(Object.assign({},We));if(!O)throw new ve(Object.assign({},ct));if(typeof O.index!="number")throw new ve(Object.assign({},Fe));const H=(function(){const Ce=document.createElement("video");return Ce.autoplay=!0,Ce.muted=!0,Ce.setAttribute("playsinline",""),Ce.setAttribute("webkit-playsinline",""),Ce})(),X=E.getVideoTracks(),[re]=X;if(!X.length)throw new ve(Object.assign({},Me));const se=re.getConstraints(),ee=Sy({},se,{frameRate:this.config.streamConfig.maxFramerate});try{yield re.applyConstraints(ee)}catch(Ce){let Ye="Unknown constraints error";Ce instanceof Error&&(Ye=Ce.message),this.analyticsTracker.trackEvent(new Hs({description:`${St.message}: ${Ye}`,isFatal:!1,code:St.code}))}const he=()=>Wp(this,void 0,void 0,(function*(){let Ce=0;for(;Ce<5;)try{return void(yield H.play())}catch(Ye){if(!(Ye instanceof Error))throw new Error("unknown error trying to add video to broadcast");Ce++,yield new Promise((gt=>setTimeout(gt,150)))}throw new Error("Error playing video, tries exceeded")})),Ee=new MediaStream([re]);H.srcObject=Ee;try{yield he();const Ce={name:A,element:H,position:O,source:Ee,render:!0},Ye=((j=re.getSettings)===null||j===void 0?void 0:j.call(re))||{};this.analyticsTracker.trackEvent(new yu(B_(Ye),Ye)),this.mixer.video.push(Ce)}catch(Ce){throw new ve(Object.assign(Object.assign({},Me),{cause:Ce}))}}))}addImageSource(E,A,O){var j;return Wp(this,void 0,void 0,(function*(){if(!E)throw new ve(Object.assign({},je));if(!A||typeof A!="string")throw new ve(Object.assign({},rt));if(E.tagName==="image")throw new ve(Object.assign({},it));if(this.mixer.video.some((X=>X.name===A)))throw new ve(Object.assign({},We));if(!O)throw new ve(Object.assign({},ct));if(typeof O.index!="number")throw new ve(Object.assign({},Fe));if(E instanceof Image){const X=(j=E.src)===null||j===void 0?void 0:j.slice();try{const re=E.src?new URL(E.src):{};if(re.host&&re.hostname){const se=yield fetch(E.src).then((he=>Wp(this,void 0,void 0,(function*(){return he.blob()})))),ee=yield new Promise((he=>{const Ee=new FileReader;Ee.onload=()=>{he(Ee.result)},Ee.readAsDataURL(se)}));E.src=ee}}catch{throw new ve(Object.assign(Object.assign({},Ht),{params:{details:`Image URL: ${X}`}}))}}const H={name:A,element:E,position:O,render:!0};this.mixer.video.push(H)}))}addAudioInputDevice(E,A){return Wp(this,void 0,void 0,(function*(){if(typeof E!="object")throw new ve(Object.assign({},je));if(!A||typeof A!="string")throw new ve(Object.assign({},rt));if(this.mixer.audio.some((re=>re.name===A)))throw new ve(Object.assign({},We));const O=E.getAudioTracks();if(!O.length)throw new ve(Object.assign({},Ve));const j=this.audioContext.createMediaStreamSource(new MediaStream(O)),H=this.audioContext.createGain();H.gain.value=1,j.connect(H),H.connect(this.audioDestination);const X={name:A,source:E,audioTrackSource:j,gainNode:H};this.analyticsTracker.trackEvent(new yu("audio",{deviceId:E.id})),this.mixer.audio.push(X)}))}removeImage(E){const A=this.mixer.video.findIndex((O=>O.name===E));if(A<0)throw new ve(Object.assign({},Yt));this.mixer.video.splice(A,1)}removeVideoInputDevice(E){var A;const O=this.removeDevice(E,this.mixer.video);if(!O)throw new ve(Object.assign({},at));{const j=F_(O.source.getTracks(),vr.VIDEO);if(!j)throw new ve(Object.assign({},at));O.element.srcObject=null,j.stop();const H=((A=j?.getSettings)===null||A===void 0?void 0:A.call(j))||{};this.analyticsTracker.trackEvent(new Yi(B_(H),H))}}removeAudioInputDevice(E){const A=this.removeDevice(E,this.mixer.audio);if(A?.audioTrackSource){for(const O of A.source.getTracks())O.stop(),this.analyticsTracker.trackEvent(new Yi("audio",{deviceId:O.id}));A.gainNode.disconnect(this.audioDestination)}else if(!A)throw new ve(Object.assign({},at))}updateVideoDeviceComposition(E,A){if(!E||typeof E!="string")throw new ve(Object.assign({},Ut));if(!A)throw new ve(Object.assign({},sn));if(typeof A.index!="number")throw new ve(Object.assign({},Rt));this.mixer.video.forEach(((O,j)=>{O.name===E&&(O.position=A)}))}exchangeVideoDevicePositions(E,A){const O=this.getVideoInputDevice(E),j=this.getVideoInputDevice(A);if(!O)throw new ve(Object.assign(Object.assign({},_t),{params:{details:`device with name: "${E}" not found`}}));if(!j)throw new ve(Object.assign(Object.assign({},_t),{params:{details:`device with name: "${A}" not found`}}));const H=Object.assign({},O.position),X=Object.assign({},j.position);for(const re of this.mixer.video)re.name===E&&(ih(X.x)?re.position=Object.assign(Object.assign({},re.position),X):re.position={index:X.index}),re.name===A&&(ih(H.x)?re.position=Object.assign(Object.assign({},re.position),H):re.position={index:H.index})}start(){this.running||(this.running=!0,this.schedulerWorker.postMessage({type:rh.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.schedulerWorker.postMessage({type:rh.START}))}stop(){this.running&&(this.running=!1,this.schedulerWorker.removeEventListener("message",this.handleWorkerEvent))}isCapturing(){return this.running}getAudioLatency(){return this.audioContext.baseLatency}getVideoLatency(){var E;return((E=this.mediaStreamManager.getTrack(vr.VIDEO))===null||E===void 0?void 0:E.getConstraints().latency)||0}disableVideo(){this.mixer.video.forEach((E=>{E.render=!1}))}enableVideo(){this.mixer.video.forEach((E=>{E.render=!0}))}disableAudio(){this.mixer.audio.forEach((E=>{E.audioTrackSource&&(E.gainNode.gain.value=0)}))}enableAudio(){this.mixer.audio.forEach((E=>{E.audioTrackSource&&(E.gainNode.gain.value=1)}))}getDrawRegion(E,A,O){var j,H,X,re;let se=(j=E.position.x)!==null&&j!==void 0?j:0,ee=(H=E.position.y)!==null&&H!==void 0?H:0;const he=(X=E.position.width)!==null&&X!==void 0?X:A-se,Ee=(re=E.position.height)!==null&&re!==void 0?re:O-ee,Ce=he/Ee;let Ye=E.element.width,gt=E.element.height;E.element instanceof HTMLVideoElement&&(Ye=E.element.videoWidth,gt=E.element.videoHeight);const ft=Ye/gt;let lt=he,et=Ee;return ft>Ce?(lt=he,et=2*Math.round(he/ft/2),ee+=(Ee-et)/2):ft<Ce&&(et=Ee,lt=2*Math.round(Ee*ft/2),se+=(he-lt)/2),{x:se,y:ee,width:lt,height:et}}drawComposite(){if(!this.shouldMix(new Date))return;this.compositeContext.clearRect(0,0,this.compositeEl.width,this.compositeEl.height),this.drawBlackScreen();const E=this.mixer.video.filter((A=>A.render));E.sort(((A,O)=>A.position.index-O.position.index));for(const A of E){const{x:O,y:j,width:H,height:X}=this.getDrawRegion(A,this.compositeEl.width,this.compositeEl.height);this.compositeContext.drawImage(A.element,O,j,H,X)}this.previewElement&&this.previewCtx&&this.previewCtx.drawImage(this.compositeEl,0,0,this.previewElement.width,this.previewElement.height),this.requestCanvasCapture()}requestCanvasCapture(){typeof CanvasCaptureMediaStreamTrack!==void 0&&(typeof this.compositeStream.requestFrame=="function"?this.compositeStream.requestFrame():this.mediaStreamManager.getTrack(vr.VIDEO).requestFrame())}drawBlackScreen(){this.compositeContext.fillStyle="#000000",this.compositeContext.fillRect(0,0,this.compositeEl.width,this.compositeEl.height)}removeDevice(E,A){const O=A.findIndex((j=>(H=>H.name===E)(j)));if(!(O<0))return A.splice(O,1)[0]}shouldMix(E){if(E.getTime()<this.nextMix)return!1;for(;this.nextMix<=E.getTime();)this.nextMix+=1e3/this.config.streamConfig.maxFramerate;return!0}}function ih(C){return Number.isSafeInteger(C)}var jd,qp,Su=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))},Ty=function(C,E,A,O){if(typeof E=="function"?C!==E||!O:!E.has(C))throw new TypeError("Cannot read private member from an object whose class did not declare it");return A==="m"?O:A==="a"?O.call(C):O?O.value:E.get(C)};class zd{constructor(E){this.config=E,jd.add(this),this.emitter=new bs,this.isValid=!0,this.emitter.on(uc.ERROR,this.stopBroadcast),this.config.ingestEndpoint&&(this.url=new URL(this.config.ingestEndpoint)),this.analyticsTracker=new zf,this.mediaStreamManager=new Fo;const A=new zc(E.logLevel,E.logger);this.peerClient=new Si(this.config,this.emitter,this.mediaStreamManager,A,this.analyticsTracker),this.broadcastCanvasManager=new z_(E,this.mediaStreamManager,this.analyticsTracker),this.peerStatsTracker=new gl(this.peerClient,this.broadcastCanvasManager,A,this.analyticsTracker),this.broadcastCanvasManager.start(),Object.getOwnPropertyNames(zd.prototype).forEach((O=>{this[O]=new Proxy(this[O],{apply:(j,H,X)=>{if(!H.isValid)throw new ve(Object.assign({},Is));return Reflect.apply(j,H,X)}})})),window.addEventListener("beforeunload",(()=>{this.analyticsTracker.stop(!0)}))}delete(){this.isValid=!1,this.peerClient.stop(),this.broadcastCanvasManager.stop(),this.emitter.removeAllListeners()}startBroadcast(E,A){return Su(this,void 0,void 0,(function*(){Bo.markSdkUsage(),Ty(this,jd,"m",qp).call(this,E);const O=Qo(A||this.config.ingestEndpoint);this.analyticsTracker.start(),this.peerStatsTracker.start(),yield this.peerClient.start(O,E),this.emitter.emit(uc.ACTIVE_STATE_CHANGE,!0),this.url=new URL(O),this.url&&this.analyticsTracker.trackEvent(new dy({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port},Zu.USER_INITIATED))}))}stopBroadcast(){var E,A,O;this.url&&this.analyticsTracker.trackEvent(new N_({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port})),(E=this.peerStatsTracker)===null||E===void 0||E.stop(),(A=this.peerClient)===null||A===void 0||A.stop(),(O=this.emitter)===null||O===void 0||O.emit(uc.ACTIVE_STATE_CHANGE,!1)}getCanvasDimensions(){return this.broadcastCanvasManager.getCanvasDimensions()}addVideoInputDevice(E,A,O){return Su(this,void 0,void 0,(function*(){return this.broadcastCanvasManager.addVideoInputDevice(E,A,O)}))}addImageSource(E,A,O){return Su(this,void 0,void 0,(function*(){return this.broadcastCanvasManager.addImageSource(E,A,O)}))}addAudioInputDevice(E,A){return Su(this,void 0,void 0,(function*(){return this.broadcastCanvasManager.addAudioInputDevice(E,A)}))}removeVideoInputDevice(E){this.broadcastCanvasManager.removeVideoInputDevice(E)}removeAudioInputDevice(E){this.broadcastCanvasManager.removeAudioInputDevice(E)}removeImage(E){this.broadcastCanvasManager.removeImage(E)}updateVideoDeviceComposition(E,A){this.broadcastCanvasManager.updateVideoDeviceComposition(E,A)}exchangeVideoDevicePositions(E,A){this.broadcastCanvasManager.exchangeVideoDevicePositions(E,A)}getAudioInputDevice(E){return this.broadcastCanvasManager.getAudioInputDevice(E)}getVideoInputDevice(E){return this.broadcastCanvasManager.getVideoInputDevice(E)}getConnectionState(){return this.peerClient.getConnectionState()}getSessionId(){return this.peerClient.getSessionId()}on(E,A){this.emitter.on(E,A)}off(E,A){this.emitter.off(E,A)}getAudioContext(){return this.broadcastCanvasManager.audioContext}attachPreview(E){this.broadcastCanvasManager.attachPreview(E)}detachPreview(){this.broadcastCanvasManager.detachPreview()}disableVideo(){this.broadcastCanvasManager.disableVideo()}enableVideo(){this.broadcastCanvasManager.enableVideo()}disableAudio(){this.broadcastCanvasManager.disableAudio()}enableAudio(){this.broadcastCanvasManager.enableAudio()}}function V0(C){return new zd((function(E){const A=new Ci;return A.streamConfig=E.streamConfig,A.ingestEndpoint=E.ingestEndpoint,A.logger=E.logger,A.logLevel=E.logLevel,A.networkReconnectConfig=E.networkReconnectConfig,A})(C))}jd=new WeakSet,qp=function(C){if(typeof C!="string"||!/^[a-zA-Z0-9_-]+$/.test(C))throw new ve(hs)};const H_="1.31.1";var yn;(function(C){C.PUBLISH="publish",C.SUBSCRIBE="subscribe",C.JOIN="join",C.LEAVE="leave"})(yn||(yn={}));const Kr=2,sS="X-Stages-Options",oS="cap";class Yp extends $n{constructor(E){super(xn.LEAVE,E.token,E.traceId,!1),Object.assign(this.properties,{action:yn.LEAVE,event_endpoint:E.eventEndpoint,whip_endpoint:E.whipEndpoint,reason:E.reason}),this.critical=!0}}function G0(C){const E="0123456789abcdef";let A="";for(let O=0;O<C;O+=1)A+=E.charAt(Math.floor(16*Math.random()));return A}class ai{constructor(){const E=G0;this.value=`${E(8)}-${E(4)}-${E(4)}-${E(4)}-${E(12)}`}}function Hd(){return new ai}class ps{constructor(){const E=(Date.now()/1e3|0).toString(16);this.value=`1-${E}-${G0(24)}`}}function oa(){return new ps}var $0,dc,$f;(function(C){C.MESSAGE="message",C.RESPONSE="response"})($0||($0={})),(function(C){C.STAGE_DELETED="STAGE_DELETED",C.PARTICIPANT_DISCONNECTED="PARTICIPANT_DISCONNECTED",C.TOKEN_INVALID="TOKEN_INVALID",C.TOKEN_EXPIRED="TOKEN_EXPIRED",C.TOKEN_INVALID_SIGNATURE="TOKEN_INVALID_SIGNATURE",C.TOKEN_MISSING="TOKEN_MISSING",C.INTERNAL="INTERNAL",C.BAD_REQUEST="BAD_REQUEST"})(dc||(dc={})),(function(C){C[C.BAD_REQUEST=400]="BAD_REQUEST",C[C.UNAUTHORIZED=401]="UNAUTHORIZED",C[C.FORBIDDEN=403]="FORBIDDEN",C[C.NOT_FOUND=404]="NOT_FOUND",C[C.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR"})($f||($f={}));class hr extends ve{constructor({token:E,traceId:A,code:O,tag:j,location:H,message:X,details:re,remoteParticipantId:se,requestUUID:ee,fatal:he,nominal:Ee,action:Ce,count:Ye=1}){super({name:"StageClientError",message:X,code:O}),Error.captureStackTrace&&Error.captureStackTrace(this,hr),this.action=Ce,this.token=E,this.traceId=A,this.code=O,this.tag=j,this.location=H,this.message=X,this.details=re,this.remoteParticipantId=se,this.requestUUID=ee,this.fatal=he,this.nominal=Ee,this.count=Ye}}const aa="signalling_session",_l="webrtc_sink",wy="webrtc_unsink",W0="webrtc_source";function ms(C,E){switch(C){case yn.PUBLISH:return _l;case yn.SUBSCRIBE:return`webrtc_source:${E}`;default:return"unknown"}}function sh(C,E){var A,O,j,H;const X={code:C.code,message:`${C.message}: ${E.name} ${E.message}`,fatal:(A=C.fatal)!==null&&A!==void 0&&A,nominal:(O=C.nominal)!==null&&O!==void 0&&O};return E instanceof hr&&(X.fatal=(j=E.fatal)!==null&&j!==void 0&&j,X.nominal=(H=E.nominal)!==null&&H!==void 0&&H),X}function Kp(C,E){if(C===0)return $t.UNKNOWN_SERVER_ERROR;if(!(C<400))if(C>=400&&C<=403)switch(E){case pc.TokenExpired:return $t.EXPIRED_TOKEN;case pc.NoPermissions:return $t.TOKEN_PERMISSIONS_DENIED;case pc.StageAtCapacity:return $t.STAGE_AT_CAPACITY;case pc.NoMatchingCodec:return $t.NO_MATCHING_CODEC;default:return $t.UNKNOWN_SERVER_ERROR}else{if(C===404)return E===pc.RemoteStreamNotFound?$t.REMOTE_STREAM_NOT_FOUND:$t.UNKNOWN_SERVER_ERROR;if(C===412)return E===pc.AbortedMHCPError?$t.MHCP_ABORTED:$t.UNKNOWN_SERVER_ERROR;if(C===429)return E===pc.StageAuthThrottled?$t.STAGE_AUTH_THROTTLED:$t.WHIP_TOO_MANY_REQUESTS;if(C!==500)return $t.UNKNOWN_SERVER_ERROR;switch(E){case pc.InternalMHCPError:return $t.INTERNAL_MHCP_ERROR;case pc.UnreachableMHCP:return $t.UNREACHABLE_MHCP;case pc.InvalidSessionStatus:return $t.INVALID_SESSION_STATUS;default:return $t.INTERNAL_SERVER_ERROR}}}var pc;(function(C){C[C.Unspecified=2001]="Unspecified",C[C.TokenExpired=2002]="TokenExpired",C[C.NoPermissions=2003]="NoPermissions",C[C.RemoteStreamNotFound=2004]="RemoteStreamNotFound",C[C.StageAtCapacity=2005]="StageAtCapacity",C[C.InternalMHCPError=2006]="InternalMHCPError",C[C.UncategorizedMHCPError=2007]="UncategorizedMHCPError",C[C.UnreachableMHCP=2008]="UnreachableMHCP",C[C.InvalidSessionStatus=2010]="InvalidSessionStatus",C[C.PostWithoutOptions=2011]="PostWithoutOptions",C[C.AbortedMHCPError=2012]="AbortedMHCPError",C[C.StageAuthThrottled=2013]="StageAuthThrottled",C[C.NoMatchingCodec=2014]="NoMatchingCodec"})(pc||(pc={}));const $t={MALFORMED_TOKEN:{code:1e3,message:"Token is malformed",fatal:!0,nominal:!0},EXPIRED_TOKEN:{code:1001,message:"Token expired and is no longer valid",fatal:!0,nominal:!0},STAGE_DELETED:{code:1037,message:"Stage has been deleted",fatal:!0,nominal:!0},PARTICIPANT_DISCONNECTED:{code:1038,message:"Participant has been disconnected",fatal:!0,nominal:!0},JOIN_SERVER_INTERNAL_ERROR:{code:1039,message:"Internal server error during join",fatal:!1,nominal:!1},JOIN_SERVER_BAD_REQUEST:{code:1040,message:"Bad request during join",fatal:!0,nominal:!1},UNPUBLISH_FAILURE:{code:1013,message:"Failed to unpublish",fatal:!1,nominal:!1},UNSUBSCRIBE_FAILURE:{code:1014,message:"Failed to unsubscribe",fatal:!1,nominal:!1},PUBLISH_FAILURE:{code:1015,message:"Failed to publish",fatal:!1,nominal:!1},SUBSCRIBE_FAILURE:{code:1016,message:"Failed to subscribe",fatal:!1,nominal:!1},JOIN_FAILURE:{code:1017,message:"Failed to join",fatal:!0,nominal:!1},JOIN_TIMED_OUT:{code:1019,message:"Join timed out",fatal:!0,nominal:!1},PUBLISH_TIMED_OUT:{code:1020,message:"Publish timed out",fatal:!1,nominal:!1},SUBSCRIBE_TIMED_OUT:{code:1021,message:"Subscribe timed out",fatal:!1,nominal:!1},OPERATION_ABORTED:{code:1023,message:"Request aborted",fatal:!1,nominal:!0},STAGE_AT_CAPACITY:{code:1024,message:"Stage at capacity",fatal:!0,nominal:!0},INTERNAL_SERVER_ERROR:{code:1025,message:"Internal server error",fatal:!0,nominal:!1},TOKEN_PERMISSIONS_DENIED:{code:1026,message:"Token permissions are not valid for the operation",fatal:!0,nominal:!1},REMOTE_STREAM_NOT_FOUND:{code:1027,message:"Contributor group (PUBLISH) or remote stream (SUBSCRIBE) not found",fatal:!0,nominal:!1},INTERNAL_MHCP_ERROR:{code:1028,message:"Authorization failed due to internal MHCP error",fatal:!0,nominal:!1},UNREACHABLE_MHCP:{code:1030,message:"Authorization failed due to MHCP unreachable",fatal:!0,nominal:!1},INVALID_SESSION_STATUS:{code:1031,message:"Stream has already been published (PUBLISH) or subscribed to (SUBSCRIBE)",fatal:!0,nominal:!1},MHCP_ABORTED:{code:1033,message:"Publisher state conflict",fatal:!0,nominal:!1},STAGE_AUTH_THROTTLED:{code:1034,message:"Too many requests",fatal:!1,nominal:!1},NO_MATCHING_CODEC:{code:1035,message:"No matching codec found",fatal:!0,nominal:!1},UNKNOWN_SERVER_ERROR:{code:1099,message:"Service error code unknown or not found",fatal:!0,nominal:!1},XDP_CONNECTION_LOST:{code:1221,message:"Connection lost during SDP exchange",fatal:!1,nominal:!1},XDP_INVALID_ANSWER_MSG:{code:1222,message:"Invalid answer message received by client",fatal:!1,nominal:!1},XDP_TIMEOUT:{code:1223,message:"Failed to receive SDP answer within timeout period",fatal:!1,nominal:!1},XDP_UNEXPECTED_ERROR:{code:1224,message:"Unexpected error encountered",fatal:!1,nominal:!1},WEBSOCKET_MESSAGE_PARSE_FAILURE:{code:1204,message:"Failed to parse websocket message"},WHIP_TOO_MANY_REQUESTS:{code:1207,message:"WHIP endpoint received too many requests",fatal:!1,nominal:!1},WHIP_POST_FAILURE:{code:1502,message:"WHIP post failure",fatal:!1,nominal:!1},WHIP_DELETE_FAILURE:{code:1503,message:"WHIP delete failure",fatal:!1,nominal:!1},WHIP_URL_MISSING:{code:1504,message:"WHIP delete failure",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_FAILED:{code:1510,message:"Set layer request failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_THROTTLED:{code:1511,message:"Too many set layer requests",fatal:!1,nominal:!0},WHEP_GET_LAYER_STATE_FAILED:{code:1512,message:"Get layer state failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_GET_LAYER_STATE_THROTTLED:{code:1513,message:"Too many get layer state requests",fatal:!1,nominal:!0},EVENT_PLANE_WS_CREATE_FAILED:{code:1300,message:"Error creating WebSocket",fatal:!0,nominal:!1},EVENT_PLANE_WS_UNEXPECTED_CLOSE:{code:1302,message:"Unexpectedly not connected to event plane",fatal:!1,nominal:!1},EVENT_PLANE_PONG_TIMEOUT:{code:1304,message:"Pong timed out",fatal:!1,nominal:!1},EVENT_PLANE_WS_CLOSE_BEFORE_OPEN:{code:1305,message:"Connect attempt closed by server",fatal:!1,nominal:!1},PEER_CONNECTION_NETWORK_FAILURE:{code:1400,message:"PeerConnection is lost due to unknown network error",fatal:!1,nominal:!1},CREATE_OFFER_FAILURE:{code:1402,message:"Failed to set local description",fatal:!1,nominal:!1},CREATE_PEER_CONNECTION_FAILURE:{code:1403,message:"Failed to create a peer connection",fatal:!1,nominal:!1},ICE_CANDIDATE_ERROR:{code:1404,message:"ICE candidate error",fatal:!1,nominal:!1},SET_ANSWER_FAILURE:{code:1405,message:"Failed to set remote answer",fatal:!1,nominal:!1},NETWORK_FAILURE:{code:1406,message:"Failed due to network problem",fatal:!1,nominal:!1},SEI_INSERT_NOT_PUBLISHING_VIDEO:{code:1460,message:"SEI failed to insert due to not publishing video",fatal:!1,nominal:!0},SEI_INSERT_INBAND_NOT_ENABLED:{code:1461,message:"SEI failed to insert due to in-band messaging not being enabled",fatal:!1,nominal:!0},REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID:{code:1470,message:"Invalid participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID:{code:1471,message:"Invalid remote participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE:{code:1472,message:"Invalid subscriber peer connection state for reassignment",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS:{code:1473,message:"Request rejected because client is already processing a previous reassignment request",fatal:!1,nominal:!1},UNEXPECTED_ERROR:{code:9999,message:"Encountered unexpected error condition. Expected StageClientError type.",fatal:!1,nominal:!1},TRANSFORM_UNEXPECTED_ERROR:{code:1480,message:"Unexpected error occurred during transform execution",fatal:!1,nominal:!1},TRANSFORM_TOO_MANY_ERRORS:{code:1481,message:"Transformer encountered too many consecutive errors",fatal:!1,nominal:!1},TRANSFORM_NOT_SUPPORTED_BY_PLATFORM:{code:1482,message:"Transforms are not supported by this platform",fatal:!1,nominal:!1},CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR:{code:1490,message:"Unexpected error occurred when handling incompatible codecs",fatal:!1,nominal:!1}};var $s;(function(C){C.UNPUBLISH="unpublish",C.UNSUBSCRIBE="unsubscribe",C.UNLOAD="unload",C.CONNECTION_FAIL="connection fail",C.REASSIGNMENT="reassignment"})($s||($s={}));const nf="stageJoined",V_="stageParticipantJoined",Hl="stageParticipantLeft",G_="stageParticipantKicked",yr="stageParticipantUpdated",Vd="localPublishingChanged",Ay="stageRefresh",Wf="stateChange",Xp="error",Ry="reassignmentRequest",mc="incompatibleCodecs",vl="connectionStateChange",oh="mediaStreamCreated",qf="mediaStreamRemoved",$_="error",Cy="stageStreamSeiMessageReceived",W_="transformError",Gd="reassignmentStarted",Yf="reassignmentSuccess",q_="reassignmentFailed",Zp="open",Kf="closed",My="messageParseError",q0="refresh",yl="error",Vc="stageStateMessage",jo="sdpAnswer",Vl="disconnectMessage",Gc="reassignmentMessage",Y0="incompatibleCodecs",aS="ssu";function Ka(C){return A=(function(O){return O.replace(/-/g,"+").replace(/_/g,"/").padEnd(O.length+(4-O.length%4)%4,"=")})(C),window.atob(A);var A}class gc{constructor(E,A){var O;this.analyticsTracker=A,this.rawToken=E;const j=E.split(".");if(j.length!==3)throw Error(`Token format incorrect. length: ${j.length}`);try{this.header=JSON.parse(Ka(j[0]))}catch(re){const se=re instanceof Error?`: ${re.message}`:"";throw Error(`Error parsing Stage Token header${se}`)}try{this.claims=JSON.parse(Ka(j[1]))}catch(re){const se=re instanceof Error?`: ${re.message}`:"";throw Error(`Error parsing Stage Token claims${se}`)}this.signature=j[2];const{claims:H}=this;this.stageARN=H.resource,this.customerId=(O=(function(re){if(re.indexOf("arn:aws:")<0)return;const se=re.split(":");return se.length>=5?se[4]:void 0})(this.stageARN))!==null&&O!==void 0?O:"unknown",this.participantID=H.jti,this.eventsURL=H.events_url,this.whipURL=is("whipUrl")||H.whip_url,this.userID=H.user_id,this.expirationTime=H.exp,this.topic=H.topic,this.parseVersionFlags(H.version);const{attributes:X}=H;X&&(this.attrGsRole=X.gs_role,this.attrGsSessionId=X.gs_session_id)}getPublishEndpoint(){let E="";return this.whipURL&&this.participantID&&(E=`${this.whipURL}/publish/${this.participantID}`),E}getSubscribeEndpoint(E){let A="";return this.whipURL&&(A=`${this.whipURL}/subscribe/${E}`),A}assertTokenIsUnexpired(E,A,O,j){cc("disableTokenValidation")||(!this.expirationTime||Date.now()/1e3>=this.expirationTime)&&this.analyticsTracker.trackErrorAndThrow(new hr(Object.assign(Object.assign({},$t.EXPIRED_TOKEN),{action:yn.JOIN,location:O,tag:A,token:this,traceId:E,remoteParticipantId:j,message:$t.EXPIRED_TOKEN.message,details:`Token expired at ${this.expirationTime} and is no longer valid`})))}parseVersionFlags(E){if(!E)return;const A=E.split(".");A.length===2&&(this.versionFlags=parseInt(A[1],10))}shouldSendSilentAudio(){return this.versionFlags===void 0||!!(this.versionFlags&Kr)}}function ky(C,E){return new gc(C,E)}var Oy;(function(C){C.PUBLISH="publish",C.SUBSCRIBE="subscribe"})(Oy||(Oy={}));class fT{constructor(E,A){this.throttleDuration=0,this.throttled=!1,this.timeout=0,this.unthrottle=()=>{this.trailing&&this.trailingFn&&this.trailingFn(...this.trailingFnArgs),this.clear()},this.throttleDuration=E,this.trailing=!(A&&A.skipTrailing)}invoke(E,...A){return this.throttled?(this.trailingFn=E,this.trailingFnArgs=A,!1):(this.throttled=!0,this.timeout=window.setTimeout(this.unthrottle,this.throttleDuration),E(...A),!0)}clear(){clearTimeout(this.timeout),this.timeout=0,this.throttled=!1,delete this.trailingFn,delete this.trailingFnArgs}}class Iy extends $n{constructor(E,A,O,j,H,X,re,se){super(xn.SERVER_REQUEST,A,re,!0),Object.assign(this.properties,{action:E,http_method:j,remote_participant_id:X,request_uuid:H,url:O,transport:se})}}const bl="draft-ietf-wish-whip-04";class Xf extends $n{constructor(E,A,O,j,H){super(xn.TRACE,E,A,!1),Object.assign(this.properties,{action:j,message:O,remote_participant_id:H})}}class Y_ extends $n{constructor(E,A,O,j,H){super(xn.CONNECTION_STATE,A,O,!1),Object.assign(this.properties,{action:E,remote_participant_id:H,state:j})}}class Ny extends $n{constructor(E,A,O,j,H){super(xn.ICE_GATHERING_STATE,A,O,!1),Object.assign(this.properties,{action:E,remote_participant_id:H,state:j})}}var ss;(function(C){C.POST="post",C.CONNECTED="connected",C.ICE_GATHERING="icegathering",C.SDP_EXCHANGE="sdpExchange",C.SET_REMOTE_DESC="setRemoteDesc",C.PEER_CONNECTION="peerConnection"})(ss||(ss={}));const Sl="start",lr="stop";class K_{constructor(E,A){this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0,this.action=E,this.traceId=A}markActionStart(){this.markStart(ss.CONNECTED)}markPostStart(){this.markStart(ss.POST)}markPostStop(){this.markStop(ss.POST),this.postDuration=this.measure(ss.POST)}markIceGatheringStart(){this.markStart(ss.ICE_GATHERING)}markIceGatheringStop(){this.markStop(ss.ICE_GATHERING),this.timeToCandidate=this.measure(ss.ICE_GATHERING)}markActionStop(){this.markStop(ss.CONNECTED),this.timeToConnected=this.measure(ss.CONNECTED),this.markStop(ss.PEER_CONNECTION),this.peerConnectionDuration=this.measure(ss.PEER_CONNECTION)}markSetRemoteDescStart(){this.markStart(ss.SET_REMOTE_DESC)}markSetRemoteDescStop(){const E=ss.SET_REMOTE_DESC;this.markStop(E),this.setRemoteDescDuration=this.measure(E),this.markStart(ss.PEER_CONNECTION)}markSdpExchangeStart(){this.markStart(ss.SDP_EXCHANGE)}markSdpExchangeStop(){const E=ss.SDP_EXCHANGE;this.markStop(E),this.sdpExchangeDuration=this.measure(E)}setTransport(E){this.sdpExchangeTransport=E}markStart(E){this.marks[`${this.namespace}.${E}.${Sl}`]=performance.now()}markStop(E){this.marks[`${this.namespace}.${E}.${lr}`]=performance.now()}measure(E){const A=`${this.namespace}.${E}.${Sl}`,O=`${this.namespace}.${E}.${lr}`,j=this.marks[A],H=this.marks[O];return j===void 0||H===void 0?0:H-j}get namespace(){return`ivswb.peerclient.${this.action}.${this.traceId.value}`}getMeasurements(){const{optionsDuration:E,postDuration:A,timeToCandidate:O,timeToConnected:j,sdpExchangeDuration:H,sdpExchangeTransport:X,setRemoteDescDuration:re,peerConnectionDuration:se}=this;return{optionsDuration:E,postDuration:A,timeToCandidate:O,timeToConnected:j,sdpExchangeDuration:H,sdpExchangeTransport:X,setRemoteDescDuration:re,peerConnectionDuration:se}}resetMeasurements(E){this.traceId=E,this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0}}var ah=i(7363);class Hr{constructor(E){this.sdp=E}static splitLines(E){return E.trim().split(`
`).map((A=>A.trim()))}static splitSections(E){return E.split(`
m=`).map(((A,O)=>(O>0?`m=${A}`:A).trim()+Hr.CRLF))}getUniqueRtpHeaderExtensionId(E){const A=[];for(const j of E)if(/^a=extmap:/.test(j.trim())){const H=+j.split("a=extmap:")[1].split(" ")[0];A.includes(H)||A.push(H)}A.sort(((j,H)=>j-H));let O=0;for(const j of A){if(j-O>1)return O+1;O=j}return O===14?-1:O+1}withVideoLayersAllocationRtpHeaderExtension(E){const A="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00",O=E?E.getRtpHeaderExtensionId(A):-1,j=O===-1?this.getUniqueRtpHeaderExtensionId(Hr.splitLines(this.sdp)):O,H=Hr.splitSections(this.sdp),X=[];for(let se of H){if(/^m=video/.test(se)&&Hr.getRtpHeaderExtensionIdInSection(se,A)===-1){const ee=Hr.splitLines(se),he=[];if(j===-1||this.hasRtpHeaderExtensionId(j)){X.push(se);continue}for(const Ee of ee)if(he.push(Ee),/^a=sendrecv/.test(Ee.trim())){const Ce=`a=extmap:${j} ${A}`;he.push(Ce)}se=he.join(Hr.CRLF)+Hr.CRLF}else if(O!==-1&&/^m=video/.test(se)&&Hr.getRtpHeaderExtensionIdInSection(se,A)!==O){const ee=Hr.splitLines(se),he=[];for(const Ee of ee){if(/^a=extmap:/.test(Ee.trim())&&Ee.split("a=extmap:")[1].split(" ")[1]===A){if(!this.hasRtpHeaderExtensionId(O)){const Ce=`a=extmap:${O} ${A}`;he.push(Ce)}continue}he.push(Ee)}se=he.join(Hr.CRLF)+Hr.CRLF}X.push(se)}const re=X.join("");return new Hr(re)}withOpusAudioConfig(E,A){const O=ah.qg(this.sdp);for(const j of O.media)if(j.type==="audio"){const{payload:H}=j.rtp.find((ee=>ee.codec==="opus"));if(!H)continue;let X=j.fmtp.find((ee=>ee.payload===H));X||(X={payload:H,config:""});const re=ah.Sl(X.config);if(re.maxaveragebitrate=E,typeof A=="boolean"){const ee=A?1:0;re["sprop-stereo"]=ee,re.stereo=ee}let se="";for(const ee of Object.keys(re))se+=`${ee}=${re[ee]}; `;X.config=se.trim()}return new Hr(ah.M9(O))}withoutAudioRtcpRSize(){var E;const A=ah.qg(this.sdp);for(const O of A.media){if(O.type!=="audio")continue;const j=uy()!==void 0,H=(E=uy())!==null&&E!==void 0&&E;j&&(O.rtcpRsize=H?void 0:"rtcp-rsize")}return new Hr(ah.M9(A))}withFilteredCandidates(E){const A=ah.qg(this.sdp);return A.media.forEach((O=>{const j=O.candidates;if(j){const H=j.filter((X=>X.transport===E));O.candidates=H}})),new Hr(ah.M9(A))}static getRtpHeaderExtensionIdInSection(E,A){const O=Hr.splitLines(E);for(const j of O)if(/^a=extmap:/.test(j.trim())){const H=j.split("a=extmap:")[1].split(" "),X=+H[0];if(H[1]===A)return X}return-1}getRtpHeaderExtensionId(E){const A=Hr.splitSections(this.sdp);for(const O of A)if(/^m=video/.test(O)){const j=Hr.getRtpHeaderExtensionIdInSection(O,E);if(j!==-1)return j}return-1}hasRtpHeaderExtensionId(E){const A=Hr.splitLines(this.sdp);for(const O of A)if(/^a=extmap:/.test(O.trim())&&+O.split("a=extmap:")[1].split(" ")[0]===E)return!0;return!1}hasAudioNacksEnabled(){var E,A,O;return((O=(A=((E=ah.qg(this.sdp).media.filter((j=>j.type==="audio"))[0])!==null&&E!==void 0?E:{}).rtcpFb)===null||A===void 0?void 0:A.filter((j=>j.type==="nack")))!==null&&O!==void 0?O:[]).length>0}}function X_(C){const{config:E}=C;return[{maxBitrate:E.maxBitrateBps}]}Hr.CRLF=`\r
`,Hr.rfc7587LowestBitrate=6e3,Hr.rfc7587HighestBitrate=51e4;function Eu(C){return 1e3*C}const Ca=(C,...E)=>{const A=E.map((O=>typeof O!="object")).filter(Boolean).length>0;if(typeof C=="object"&&!A)return(0,Vi.merge)({},C,...E)},$d=C=>Py(C),Py=C=>(0,Vi.cloneDeep)(C),cS=C=>{switch(C){case ra.HIGHEST_QUALITY:return"highest";case ra.LOWEST_QUALITY:default:return"lowest"}},Ao=C=>Object.freeze(C),ca=Object.freeze({DEFAULT_1080:Ao({maxBitrateKbps:2500,maxFramerate:30,width:1920,height:1080}),INACTIVE:Ao({maxBitrateKbps:0,maxFramerate:0,width:0,height:0})}),Jp=Object.freeze({DEFAULT_720:Ao({maxBitrateKbps:2500,maxFramerate:30,width:1280,height:720}),DEFAULT_540:Ao({maxBitrateKbps:1400,maxFramerate:15,width:960,height:540}),DEFAULT_480:Ao({maxBitrateKbps:1100,maxFramerate:15,width:854,height:480}),DEFAULT_360:Ao({maxBitrateKbps:600,maxFramerate:15,width:640,height:360}),DEFAULT_270:Ao({maxBitrateKbps:350,maxFramerate:15,width:480,height:270}),DEFAULT_180:Ao({maxBitrateKbps:150,maxFramerate:15,width:320,height:180}),DEFAULT_160:Ao({maxBitrateKbps:120,maxFramerate:15,width:284,height:160})}),Wd=Object.freeze({HI:Ao(Object.assign({},Jp.DEFAULT_720)),MID:Ao(Object.assign(Object.assign({},Jp.DEFAULT_360),{maxBitrateKbps:700,maxFramerate:20})),LOW:Ao(Object.assign(Object.assign({},Jp.DEFAULT_180),{maxBitrateKbps:200,maxFramerate:15}))}),Dy=C=>({rid:C,active:!1,scaleFactor:K0(C),maxBitrateBps:Eu(ca.INACTIVE.maxBitrateKbps),maxFramerate:ca.INACTIVE.maxFramerate,width:ca.INACTIVE.width,height:ca.INACTIVE.height}),K0=C=>{switch(C){case jc.HI:return 1;case jc.MID:return 2;case jc.LOW:return 4;default:return 1}},Zf=50,ch=2500,Qp=10,lh=30,qd=160,Yd=1280,X0=720*Yd,Z0=16/9,J0=12,em=128,Q0=64,Ly={[Es.DEFAULT]:0,[Es.LOW]:50,[Es.MEDIUM]:150,[Es.HIGH]:250},xu={[Es.DEFAULT]:0,[Es.LOW]:100,[Es.MEDIUM]:200,[Es.HIGH]:300};function Kd(C){const{outbound:E,remoteInbound:A,networkQuality:O}=C;return{networkQuality:O,nackCount:E.nackCount,packetsSent:E.packetsSent,packetsLost:A?.packetsLost,retransmittedPacketsSent:E.retransmittedPacketsSent,bytesSent:E.bytesSent,headerBytesSent:E.headerBytesSent,retransmittedBytesSent:E.retransmittedBytesSent,totalPacketSendDelay:E.totalPacketSendDelay}}function Uy(C){var E,A,O;const{outbound:j,remoteInbound:H,networkQuality:X}=C;return{networkQuality:X,nackCount:j.nackCount,packetsSent:j.packetsSent,packetsLost:H?.packetsLost,retransmittedPacketsSent:j.retransmittedPacketsSent,bytesSent:j.bytesSent,headerBytesSent:j.headerBytesSent,retransmittedBytesSent:j.retransmittedBytesSent,totalPacketSendDelay:j.totalPacketSendDelay,firCount:j.firCount,pliCount:j.pliCount,framesEncoded:j.framesEncoded,keyFramesEncoded:j.keyFramesEncoded,totalEncodeTime:j.totalEncodeTime,totalEncodedBytesTarget:j.totalEncodedBytesTarget,framesSent:j.framesSent,hugeFramesSent:j.hugeFramesSent,active:((E=j.framesPerSecond)!==null&&E!==void 0?E:0)!==0,qualityLimitationReason:j.qualityLimitationReason,qualityLimitationResolutionChanges:j.qualityLimitationResolutionChanges,qualityLimitationCpuDuration:(A=j.qualityLimitationDurations)===null||A===void 0?void 0:A.cpu,qualityLimitationBandwidthDuration:(O=j.qualityLimitationDurations)===null||O===void 0?void 0:O.bandwidth,frameWidth:j.frameWidth,frameHeight:j.frameHeight,framesPerSecond:j.framesPerSecond,rid:j.rid,ssrc:j.ssrc}}function By(C,E){const A=new Map,O=new Map;for(const j of E.values())if(j.kind===C&&j.type==="outbound-rtp"&&j.ssrc){const H=j.rid||ye;O.set(j.ssrc,H);let X=A.get(H);X||(X={},A.set(H,X)),X.outbound=j}for(const j of E.values())if(j.kind===C&&j.type==="remote-inbound-rtp"&&j.ssrc){const H=O.get(j.ssrc)||ye,X=A.get(H);X&&(X.remoteInbound=j)}return A}function Fy(C,E){const A=new Map;for(const O of E.values())if(O.kind===C&&O.type==="inbound-rtp"){const j=O.rid||ye;A.set(j,{inbound:O})}return A}function tm(C,E){return C!==Eo.DOWN&&E!=null?E:C}const Z_=(C,E)=>{const A=[],O=Bo.getNetworkQuality(),j=By("audio",C);for(const H of j.values())if(H.outbound){const X=H.outbound.rid||ye,re=tm(O,E.get(X)),se=Kd({outbound:H.outbound,remoteInbound:H.remoteInbound,networkQuality:re});A.push(se)}if(A.length)return A},lS=(C,E)=>{const A=[],O=Bo.getNetworkQuality(),j=By("video",C);for(const H of j.values())if(H.outbound){const X=H.outbound.rid||ye,re=Uy({outbound:H.outbound,remoteInbound:H.remoteInbound});if(re.active){const se=tm(O,E.get(X));re.networkQuality=se}A.push(re)}if(A.length)return A},uS=(C,E)=>{const A=[],O=Bo.getNetworkQuality(),j=Fy("audio",C);for(const X of j.values())if(X.inbound){const re=X.inbound.id;if(!re)continue;const se=tm(O,E.get(re)),ee={networkQuality:(H={inbound:X.inbound,networkQuality:se}).networkQuality,nackCount:H.inbound.nackCount,packetsReceived:H.inbound.packetsReceived,packetsLost:H.inbound.packetsLost,packetsDiscarded:H.inbound.packetsDiscarded,bytesReceived:H.inbound.bytesReceived,headerBytesReceived:H.inbound.headerBytesReceived,jitterBufferDelay:H.inbound.jitterBufferDelay,jitterBufferEmittedCount:H.inbound.jitterBufferEmittedCount,jitter:H.inbound.jitter,totalSamplesReceived:H.inbound.totalSamplesReceived,concealedSamples:H.inbound.concealedSamples,silentConcealedSamples:H.inbound.silentConcealedSamples,concealmentEvents:H.inbound.concealmentEvents,insertedSamplesForDeceleration:H.inbound.insertedSamplesForDeceleration,removedSamplesForAcceleration:H.inbound.removedSamplesForAcceleration,audioLevel:H.inbound.audioLevel};A.push(ee)}var H;if(A.length)return A},hS=(C,E)=>{const A=[],O=Bo.getNetworkQuality(),j=Fy("video",C);for(const X of j.values())if(X.inbound){const re=X.inbound.id;if(!re)continue;const se={networkQuality:(H={inbound:X.inbound,networkQuality:tm(O,E.get(re))}).networkQuality,nackCount:H.inbound.nackCount,packetsReceived:H.inbound.packetsReceived,packetsLost:H.inbound.packetsLost,packetsDiscarded:H.inbound.packetsDiscarded,bytesReceived:H.inbound.bytesReceived,headerBytesReceived:H.inbound.headerBytesReceived,jitterBufferDelay:H.inbound.jitterBufferDelay,jitterBufferEmittedCount:H.inbound.jitterBufferEmittedCount,jitter:H.inbound.jitter,pliCount:H.inbound.pliCount,firCount:H.inbound.firCount,framesReceived:H.inbound.framesReceived,framesDecoded:H.inbound.framesDecoded,keyFramesDecoded:H.inbound.keyFramesDecoded,framesDropped:H.inbound.framesDropped,totalDecodeTime:H.inbound.totalDecodeTime,totalInterFrameDelay:H.inbound.totalInterFrameDelay,totalSquaredInterFrameDelay:H.inbound.totalSquaredInterFrameDelay,pauseCount:H.inbound.pauseCount,totalPausesDuration:H.inbound.totalPausesDuration,freezeCount:H.inbound.freezeCount,totalFreezesDuration:H.inbound.totalFreezesDuration,frameWidth:H.inbound.frameWidth,frameHeight:H.inbound.frameHeight,framesPerSecond:H.inbound.framesPerSecond,ssrc:H.inbound.ssrc};A.push(se)}var H;if(A.length)return A};var dT=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};const jy="H264",zy=C=>{const E=C?.split("/");if(E?.length===2)return E[1]},oo=(C,E)=>{const A=zy(C);if(C===void 0||A===void 0)return;const O={mimeSubtype:A};if(E){const j=(H=>{const X=H.split(";"),re=new Map;for(const se of X){const[ee,he]=se.split("=");re.set(ee,he)}return re})(E);switch(A){case jy:{const H=j.get("profile-level-id");H&&((X,re)=>{if(re.length<6)return;const se=re.substring(0,4),ee=parseInt(re.substring(4,6),16);X.profile=se,X.level=ee})(O,H);break}case"H265":((H,X)=>{const re=X.get("profile-id")||"0",se=X.get("tier-flag")||"0",ee=parseInt(X.get("level-id")||"0",10),he=[se,re].join("_");H.profile=he,H.level=ee})(O,j)}}return O},fS=(C,E)=>C.sort(((A,O)=>{if(zy(A.mimeType)===jy){const j=oo(A.mimeType,A.sdpFmtpLine);if(j?.profile===E)return-1}return 0})),Hy=(C,E)=>{var A;const O=oo(C.mimeType,C.sdpFmtpLine);return O?.mimeSubtype.toLowerCase()===E.mime.toLowerCase()&&((A=O?.profile)===null||A===void 0?void 0:A.toLowerCase().indexOf(E.config.toLowerCase()))===0},pT=(C,E)=>E.filter((A=>!A.mimeType.endsWith("rtx"))).filter((A=>A.mimeType.indexOf("packetization-mode=0")===-1)).find((A=>C.reduce(((O,j)=>O&&Hy(A,j)===!1),!0)));class Vy extends $n{constructor(E,A,O,j,H,X,re,se,ee){var he,Ee;super(xn.PUBLISHED_VIDEO_STATS,E,A,!1),Object.assign(this.properties,Object.assign({action:yn.PUBLISH,node:(he=O?.node)!==null&&he!==void 0?he:"",cluster:(Ee=O?.cluster)!==null&&Ee!==void 0?Ee:""},((Ce,Ye,gt,ft,lt,et)=>{var ot,Mt,gn,Bn,Wn,ar,br,kr,mr,Or,ni,ei,Er,jr,gr,xr,ri,ji,ws,As,Rs,Ks,Mo,ko,Oo,uo,ho,fo,Na,Xs,Xc,wl,Zc;const Tu=(Mt=(ot=Ce?.qualityLimitationDurations)===null||ot===void 0?void 0:ot.cpu)!==null&&Mt!==void 0?Mt:0,wu=(Bn=(gn=Ce?.qualityLimitationDurations)===null||gn===void 0?void 0:gn.bandwidth)!==null&&Bn!==void 0?Bn:0,Al=Math.max((Wn=Ce?.bytesSent)!==null&&Wn!==void 0?Wn:0,0),df=8*Al/(et??1),_h=Math.max((ar=Ye?.packetsLost)!==null&&ar!==void 0?ar:0,0),pf=Math.max((br=Ce?.packetsSent)!==null&&br!==void 0?br:0,0),id=_h/Math.max(pf,1),Zl=oo(ft?.mimeType,ft?.sdpFmtpLine);return{active:!!Ce?.framesPerSecond&&Ce.framesPerSecond!==0,bytes_sent:Al,codec_mime_type:Zl?.mimeSubtype,codec_profile:Zl?.profile,codec_level:Zl?.level,configured_bitrate:lt?.max_bitrate,connection_bandwidth:(mr=(kr=gt?.candidatePair)===null||kr===void 0?void 0:kr.availableOutgoingBitrate)!==null&&mr!==void 0?mr:0,encode_bitrate:df,encoder_implementation:(Or=Ce?.encoderImplementation)!==null&&Or!==void 0?Or:"unknown",fir_count:(ni=Ce?.firCount)!==null&&ni!==void 0?ni:0,fraction_packets_lost:id,frame_height:Math.max((ei=Ce?.frameHeight)!==null&&ei!==void 0?ei:0,0),frame_width:Math.max((Er=Ce?.frameWidth)!==null&&Er!==void 0?Er:0,0),frames_encoded:(jr=Ce?.framesEncoded)!==null&&jr!==void 0?jr:0,frames_per_second:Math.max((gr=Ce?.framesPerSecond)!==null&&gr!==void 0?gr:0,0),frames_sent:(xr=Ce?.framesSent)!==null&&xr!==void 0?xr:0,header_bytes_sent:(ri=Ce?.headerBytesSent)!==null&&ri!==void 0?ri:0,huge_frames_sent:(ji=Ce?.hugeFramesSent)!==null&&ji!==void 0?ji:0,key_frames_encoded:(ws=Ce?.keyFramesEncoded)!==null&&ws!==void 0?ws:0,nack_count:(As=Ce?.nackCount)!==null&&As!==void 0?As:0,packets_lost:_h,packets_sent:pf,power_efficient_encoder:(Rs=Ce?.powerEfficientEncoder)!==null&&Rs!==void 0&&Rs,pli_count:(Ks=Ce?.pliCount)!==null&&Ks!==void 0?Ks:0,quality_limitation_reason:(Mo=Ce?.qualityLimitationReason)!==null&&Mo!==void 0?Mo:"none",quality_limitation_resolution_changes:(ko=Ce?.qualityLimitationResolutionChanges)!==null&&ko!==void 0?ko:0,quality_limitation_cpu_duration:Tu,quality_limitation_bandwidth_duration:wu,retransmitted_bytes_sent:(Oo=Ce?.retransmittedBytesSent)!==null&&Oo!==void 0?Oo:0,retransmitted_packets_sent:(uo=Ce?.retransmittedPacketsSent)!==null&&uo!==void 0?uo:0,rid:(ho=Ce?.rid)!==null&&ho!==void 0?ho:ye,scalability_mode:(fo=Ce?.scalabilityMode)!==null&&fo!==void 0?fo:"unknown",target_bitrate:Math.max((Na=Ce?.targetBitrate)!==null&&Na!==void 0?Na:0,0),total_encode_time:(Xs=Ce?.totalEncodeTime)!==null&&Xs!==void 0?Xs:0,total_encoded_bytes_target:(Xc=Ce?.totalEncodedBytesTarget)!==null&&Xc!==void 0?Xc:0,total_packet_send_delay:(wl=Ce?.totalPacketSendDelay)!==null&&wl!==void 0?wl:0,protocol:(Zc=gt?.localCandidate)===null||Zc===void 0?void 0:Zc.protocol}})(j,H,X,re,se,ee)))}}class mT extends $n{constructor(E,A,O,j,H,X,re,se,ee,he,Ee,Ce){var Ye,gt,ft,lt;super(xn.PUBLISHED_VIDEO_STATS_WINDOW,E,A,!1);const et=Math.max(((Ye=j?.timestamp)!==null&&Ye!==void 0?Ye:0)-((gt=H?.timestamp)!==null&&gt!==void 0?gt:0),0);Object.assign(this.properties,Object.assign({action:yn.PUBLISH,node:(ft=O?.node)!==null&&ft!==void 0?ft:"",cluster:(lt=O?.cluster)!==null&&lt!==void 0?lt:"",window_size_ms:et},((ot,Mt,gn,Bn,Wn,ar,br,kr,mr,Or)=>{var ni,ei,Er,jr,gr,xr,ri,ji,ws,As,Rs,Ks,Mo,ko,Oo,uo,ho,fo,Na,Xs,Xc,wl,Zc,Tu,wu,Al,df,_h,pf,id,Zl,fm,vg,Qd,dm,yg,pm,mm,bg,gm,_m,vm,TS,wS,AS,RS,xT,TT,wT,AT,r1,CS,RT,ym;const x3=(ei=(ni=ot?.qualityLimitationDurations)===null||ni===void 0?void 0:ni.cpu)!==null&&ei!==void 0?ei:0,zR=(jr=(Er=Mt?.qualityLimitationDurations)===null||Er===void 0?void 0:Er.cpu)!==null&&jr!==void 0?jr:0,HR=(xr=(gr=ot?.qualityLimitationDurations)===null||gr===void 0?void 0:gr.bandwidth)!==null&&xr!==void 0?xr:0,doe=(ji=(ri=Mt?.qualityLimitationDurations)===null||ri===void 0?void 0:ri.bandwidth)!==null&&ji!==void 0?ji:0,RB=Math.max(((ws=ot?.bytesSent)!==null&&ws!==void 0?ws:0)-((As=Mt?.bytesSent)!==null&&As!==void 0?As:0),0),CB=typeof kr!="number"?1:kr/1e3,poe=8*RB/CB,MB=Math.max(((Rs=gn?.packetsLost)!==null&&Rs!==void 0?Rs:0)-((Ks=Bn?.packetsLost)!==null&&Ks!==void 0?Ks:0),0),kB=Math.max(((Mo=ot?.packetsSent)!==null&&Mo!==void 0?Mo:0)-((ko=Mt?.packetsSent)!==null&&ko!==void 0?ko:0),0),moe=MB/Math.max(kB,1),MS=oo(ar?.mimeType,ar?.sdpFmtpLine),goe=8*(Or||0)/CB;return{active:!!ot?.framesPerSecond&&ot?.framesPerSecond!==0,bytes_sent:RB,codec_mime_type:MS?.mimeSubtype,codec_profile:MS?.profile,codec_level:MS?.level,configured_bitrate:br?.max_bitrate,connection_bandwidth:(uo=(Oo=Wn?.candidatePair)===null||Oo===void 0?void 0:Oo.availableOutgoingBitrate)!==null&&uo!==void 0?uo:0,encode_bitrate:poe,encoder_implementation:(ho=ot?.encoderImplementation)!==null&&ho!==void 0?ho:"unknown",fir_count:Math.max(((fo=ot?.firCount)!==null&&fo!==void 0?fo:0)-((Na=Mt?.firCount)!==null&&Na!==void 0?Na:0),0),fraction_packets_lost:moe,frame_height:Math.max((Xs=ot?.frameHeight)!==null&&Xs!==void 0?Xs:0,0),frame_width:Math.max((Xc=ot?.frameWidth)!==null&&Xc!==void 0?Xc:0,0),frames_encoded:Math.max(((wl=ot?.framesEncoded)!==null&&wl!==void 0?wl:0)-((Zc=Mt?.framesEncoded)!==null&&Zc!==void 0?Zc:0),0),frames_per_second:Math.max((Tu=ot?.framesPerSecond)!==null&&Tu!==void 0?Tu:0,0),frames_sent:Math.max(((wu=ot?.framesSent)!==null&&wu!==void 0?wu:0)-((Al=Mt?.framesSent)!==null&&Al!==void 0?Al:0),0),header_bytes_sent:Math.max(((df=ot?.headerBytesSent)!==null&&df!==void 0?df:0)-((_h=Mt?.headerBytesSent)!==null&&_h!==void 0?_h:0),0),huge_frames_sent:Math.max(((pf=ot?.hugeFramesSent)!==null&&pf!==void 0?pf:0)-((id=Mt?.hugeFramesSent)!==null&&id!==void 0?id:0),0),key_frames_encoded:Math.max(((Zl=ot?.keyFramesEncoded)!==null&&Zl!==void 0?Zl:0)-((fm=Mt?.keyFramesEncoded)!==null&&fm!==void 0?fm:0),0),nack_count:Math.max(((vg=ot?.nackCount)!==null&&vg!==void 0?vg:0)-((Qd=Mt?.nackCount)!==null&&Qd!==void 0?Qd:0),0),packets_lost:MB,packets_sent:kB,power_efficient_encoder:(dm=ot?.powerEfficientEncoder)!==null&&dm!==void 0&&dm,pli_count:Math.max(((yg=ot?.pliCount)!==null&&yg!==void 0?yg:0)-((pm=Mt?.pliCount)!==null&&pm!==void 0?pm:0),0),quality_limitation_reason:(mm=ot?.qualityLimitationReason)!==null&&mm!==void 0?mm:"none",quality_limitation_resolution_changes:Math.max(((bg=ot?.qualityLimitationResolutionChanges)!==null&&bg!==void 0?bg:0)-((gm=Mt?.qualityLimitationResolutionChanges)!==null&&gm!==void 0?gm:0),0),quality_limitation_cpu_duration:Math.max(x3-zR,0),quality_limitation_bandwidth_duration:Math.max(HR-doe,0),retransmitted_bytes_sent:Math.max(((_m=ot?.retransmittedBytesSent)!==null&&_m!==void 0?_m:0)-((vm=Mt?.retransmittedBytesSent)!==null&&vm!==void 0?vm:0),0),rid:(TS=ot?.rid)!==null&&TS!==void 0?TS:ye,retransmitted_packets_sent:Math.max(((wS=ot?.retransmittedPacketsSent)!==null&&wS!==void 0?wS:0)-((AS=Mt?.retransmittedPacketsSent)!==null&&AS!==void 0?AS:0),0),scalability_mode:(RS=ot?.scalabilityMode)!==null&&RS!==void 0?RS:"unknown",target_bitrate:Math.max((xT=ot?.targetBitrate)!==null&&xT!==void 0?xT:0,0),total_encode_time:Math.max(((TT=ot?.totalEncodeTime)!==null&&TT!==void 0?TT:0)-((wT=Mt?.totalEncodeTime)!==null&&wT!==void 0?wT:0),0),total_encoded_bytes_target:Math.max(((AT=ot?.totalEncodedBytesTarget)!==null&&AT!==void 0?AT:0)-((r1=Mt?.totalEncodedBytesTarget)!==null&&r1!==void 0?r1:0),0),total_packet_send_delay:Math.max(((CS=ot?.totalPacketSendDelay)!==null&&CS!==void 0?CS:0)-((RT=Mt?.totalPacketSendDelay)!==null&&RT!==void 0?RT:0),0),sei_write_count:mr,sei_bytes_sent:Or,sei_bitrate:goe,protocol:(ym=Wn?.localCandidate)===null||ym===void 0?void 0:ym.protocol}})(j,H,X,re,se,ee,he,et,Ee,Ce)))}}class gT extends $n{constructor(E,A,O,j,H,X,re,se,ee,he){var Ee,Ce;super(xn.PUBLISHED_AUDIO_STATS,E,A,!1),Object.assign(this.properties,Object.assign({action:yn.PUBLISH,node:(Ee=O?.node)!==null&&Ee!==void 0?Ee:"",cluster:(Ce=O?.cluster)!==null&&Ce!==void 0?Ce:""},((Ye,gt,ft,lt,et,ot,Mt)=>{var gn,Bn,Wn,ar,br,kr,mr,Or,ni,ei,Er,jr,gr;const xr=Math.max((gn=Ye?.bytesSent)!==null&&gn!==void 0?gn:0,0),ri=8*xr/(ot??1),ji=Math.max((Bn=gt?.packetsLost)!==null&&Bn!==void 0?Bn:0,0),ws=Math.max((Wn=Ye?.packetsSent)!==null&&Wn!==void 0?Wn:0,0),As=ji/Math.max(ws,1),Rs=oo(lt?.mimeType,lt?.sdpFmtpLine);return{audio_nacks_enabled:(ar=Mt?.audioNacks)!==null&&ar!==void 0&&ar,bytes_sent:xr,codec_mime_type:Rs?.mimeSubtype,configured_bitrate:(br=et?.max_audio_bitrate_bps)!==null&&br!==void 0?br:0,connection_bandwidth:(mr=(kr=ft?.candidatePair)===null||kr===void 0?void 0:kr.availableOutgoingBitrate)!==null&&mr!==void 0?mr:0,encode_bitrate:ri,fraction_packets_lost:As,header_bytes_sent:(Or=Ye?.headerBytesSent)!==null&&Or!==void 0?Or:0,nack_count:(ni=Ye?.nackCount)!==null&&ni!==void 0?ni:0,packets_lost:ji,packets_sent:ws,retransmitted_bytes_sent:(ei=Ye?.retransmittedBytesSent)!==null&&ei!==void 0?ei:0,retransmitted_packets_sent:(Er=Ye?.retransmittedPacketsSent)!==null&&Er!==void 0?Er:0,target_bitrate:(jr=Ye?.targetBitrate)!==null&&jr!==void 0?jr:0,protocol:(gr=ft?.localCandidate)===null||gr===void 0?void 0:gr.protocol}})(j,H,X,re,se,ee,he)))}}class _T extends $n{constructor(E,A,O,j,H,X,re,se,ee,he,Ee){var Ce,Ye,gt,ft;super(xn.PUBLISHED_AUDIO_STATS_WINDOW,E,A,!1);const lt=Math.max(((Ce=j?.timestamp)!==null&&Ce!==void 0?Ce:0)-((Ye=H?.timestamp)!==null&&Ye!==void 0?Ye:0),0);Object.assign(this.properties,Object.assign({action:yn.PUBLISH,node:(gt=O?.node)!==null&&gt!==void 0?gt:"",cluster:(ft=O?.cluster)!==null&&ft!==void 0?ft:"",window_size_ms:lt},((et,ot,Mt,gn,Bn,Wn,ar,br,kr)=>{var mr,Or,ni,ei,Er,jr,gr,xr,ri,ji,ws,As,Rs,Ks,Mo,ko,Oo,uo,ho,fo,Na,Xs;const Xc=Math.max(((mr=et?.bytesSent)!==null&&mr!==void 0?mr:0)-((Or=ot?.bytesSent)!==null&&Or!==void 0?Or:0),0),wl=8*Xc/(typeof br!="number"?1:br/1e3),Zc=Math.max(((ni=Mt?.packetsLost)!==null&&ni!==void 0?ni:0)-((ei=gn?.packetsLost)!==null&&ei!==void 0?ei:0),0),Tu=Math.max(((Er=et?.packetsSent)!==null&&Er!==void 0?Er:0)-((jr=ot?.packetsSent)!==null&&jr!==void 0?jr:0),0),wu=Zc/Math.max(Tu,1),Al=oo(Wn?.mimeType,Wn?.sdpFmtpLine);return{audio_nacks_enabled:(gr=kr?.audioNacks)!==null&&gr!==void 0&&gr,bytes_sent:Xc,codec_mime_type:Al?.mimeSubtype,configured_bitrate:(xr=ar?.max_audio_bitrate_bps)!==null&&xr!==void 0?xr:0,connection_bandwidth:(ji=(ri=Bn?.candidatePair)===null||ri===void 0?void 0:ri.availableOutgoingBitrate)!==null&&ji!==void 0?ji:0,encode_bitrate:wl,fraction_packets_lost:wu,header_bytes_sent:Math.max(((ws=et?.headerBytesSent)!==null&&ws!==void 0?ws:0)-((As=ot?.headerBytesSent)!==null&&As!==void 0?As:0),0),nack_count:Math.max(((Rs=et?.nackCount)!==null&&Rs!==void 0?Rs:0)-((Ks=ot?.nackCount)!==null&&Ks!==void 0?Ks:0),0),packets_lost:Zc,packets_sent:Math.max(((Mo=et?.packetsSent)!==null&&Mo!==void 0?Mo:0)-((ko=ot?.packetsSent)!==null&&ko!==void 0?ko:0),0),retransmitted_bytes_sent:Math.max(((Oo=et?.retransmittedBytesSent)!==null&&Oo!==void 0?Oo:0)-((uo=ot?.retransmittedBytesSent)!==null&&uo!==void 0?uo:0),0),retransmitted_packets_sent:Math.max(((ho=et?.retransmittedPacketsSent)!==null&&ho!==void 0?ho:0)-((fo=ot?.retransmittedPacketsSent)!==null&&fo!==void 0?fo:0),0),target_bitrate:Math.max((Na=et?.targetBitrate)!==null&&Na!==void 0?Na:0,0),protocol:(Xs=Bn?.localCandidate)===null||Xs===void 0?void 0:Xs.protocol}})(j,H,X,re,se,ee,he,lt,Ee)))}}class Gy extends $n{constructor(E,A,O,j,H,X,re,se){var ee,he;super(xn.SUBSCRIBED_VIDEO_STATS,E,A,!1),Object.assign(this.properties,Object.assign({action:yn.SUBSCRIBE,node:(ee=j?.node)!==null&&ee!==void 0?ee:"",cluster:(he=j?.cluster)!==null&&he!==void 0?he:"",remote_participant_id:O},((Ee,Ce,Ye,gt)=>{var ft,lt,et,ot,Mt,gn,Bn,Wn,ar,br,kr,mr,Or,ni,ei,Er,jr,gr,xr,ri,ji,ws,As,Rs;let Ks=0;Ee?.jitterBufferDelay&&Ee?.jitterBufferEmittedCount&&Ee.jitterBufferEmittedCount>0&&(Ks=Ee.jitterBufferDelay/Ee.jitterBufferEmittedCount);const Mo=gt??1,ko=Math.max((ft=Ee?.bytesReceived)!==null&&ft!==void 0?ft:0,0),Oo=8*ko/Mo;let uo=0;Ee?.totalDecodeTime&&Ee?.framesDecoded&&(uo=Ee.totalDecodeTime/Math.max(Ee?.framesDecoded,1));const ho=Math.max((lt=Ee?.packetsLost)!==null&&lt!==void 0?lt:0,0),fo=Math.max((et=Ee?.packetsReceived)!==null&&et!==void 0?et:0,0),Na=ho/Math.max(fo+ho,1),Xs=oo(Ye?.mimeType,Ye?.sdpFmtpLine);return{bytes_received:ko,codec_mime_type:Xs?.mimeSubtype,codec_profile:Xs?.profile,codec_level:Xs?.level,connection_bandwidth:(Mt=(ot=Ce?.candidatePair)===null||ot===void 0?void 0:ot.availableIncomingBitrate)!==null&&Mt!==void 0?Mt:0,decode_bitrate:Oo,decoder_implementation:(gn=Ee?.decoderImplementation)!==null&&gn!==void 0?gn:"unknown",fir_count:Math.max((Bn=Ee?.firCount)!==null&&Bn!==void 0?Bn:0,0),fraction_packets_lost:Na,frame_decode_time_avg:uo,frame_height:Math.max((Wn=Ee?.frameHeight)!==null&&Wn!==void 0?Wn:0,0),frame_width:Math.max((ar=Ee?.frameWidth)!==null&&ar!==void 0?ar:0,0),frames_decoded:Math.max((br=Ee?.framesDecoded)!==null&&br!==void 0?br:0,0),frames_dropped:Math.max((kr=Ee?.framesDropped)!==null&&kr!==void 0?kr:0,0),frames_received:Math.max((mr=Ee?.framesReceived)!==null&&mr!==void 0?mr:0,0),freeze_count:Math.max((Or=Ee?.freezeCount)!==null&&Or!==void 0?Or:0,0),frames_rendered:Math.max((ni=Ee?.framesRendered)!==null&&ni!==void 0?ni:0,0),frames_per_second:Math.max((ei=Ee?.framesPerSecond)!==null&&ei!==void 0?ei:0,0),header_bytes_received:Math.max((Er=Ee?.headerBytesReceived)!==null&&Er!==void 0?Er:0,0),jitter_buffer_delay_avg:Ks,key_frames_decoded:Math.max((jr=Ee?.keyFramesDecoded)!==null&&jr!==void 0?jr:0,0),nack_count:Math.max((gr=Ee?.nackCount)!==null&&gr!==void 0?gr:0,0),packets_discarded:Math.max((xr=Ee?.packetsDiscarded)!==null&&xr!==void 0?xr:0,0),packets_lost:ho,packets_received:fo,pause_count:Math.max((ri=Ee?.pauseCount)!==null&&ri!==void 0?ri:0,0),pli_count:Math.max((ji=Ee?.pliCount)!==null&&ji!==void 0?ji:0,0),power_efficient_decoder:(ws=Ee?.powerEfficientDecoder)!==null&&ws!==void 0&&ws,total_freezes_duration:Math.max((As=Ee?.totalFreezesDuration)!==null&&As!==void 0?As:0,0),total_pauses_duration:Math.max((Rs=Ee?.totalPausesDuration)!==null&&Rs!==void 0?Rs:0,0)}})(H,X,re,se)))}}class dS extends $n{constructor(E,A,O,j,H,X,re,se,ee,he,Ee){var Ce,Ye,gt,ft;super(xn.SUBSCRIBED_VIDEO_STATS_WINDOW,E,A,!1);const lt=Math.max(((Ce=H?.timestamp)!==null&&Ce!==void 0?Ce:0)-((Ye=X?.timestamp)!==null&&Ye!==void 0?Ye:0),0);Object.assign(this.properties,Object.assign({action:yn.SUBSCRIBE,node:(gt=j?.node)!==null&&gt!==void 0?gt:"",cluster:(ft=j?.cluster)!==null&&ft!==void 0?ft:"",window_size_ms:lt,remote_participant_id:O},((et,ot,Mt,gn,Bn,Wn,ar,br)=>{var kr,mr,Or,ni,ei,Er,jr,gr,xr,ri,ji,ws,As,Rs,Ks,Mo,ko,Oo,uo,ho,fo,Na,Xs,Xc,wl,Zc,Tu,wu,Al,df,_h,pf,id,Zl,fm,vg,Qd,dm,yg,pm,mm,bg,gm,_m,vm;let TS=0,wS=0;if(et?.jitterBufferEmittedCount&&ot?.jitterBufferEmittedCount&&et.jitterBufferEmittedCount>ot.jitterBufferEmittedCount){et?.jitterBufferDelay&&ot?.jitterBufferDelay&&(TS=(et.jitterBufferDelay-ot.jitterBufferDelay)/(et.jitterBufferEmittedCount-ot.jitterBufferEmittedCount));const zR=ot?.jitterBufferMinimumDelay,HR=et?.jitterBufferMinimumDelay;zR&&HR&&(wS=(HR-zR)/(et.jitterBufferEmittedCount-ot.jitterBufferEmittedCount))}const AS=Math.max(((kr=et?.bytesReceived)!==null&&kr!==void 0?kr:0)-((mr=ot?.bytesReceived)!==null&&mr!==void 0?mr:0),0),RS=typeof Bn!="number"?1:Bn/1e3,xT=8*AS/RS,TT=Math.max(((Or=et?.totalDecodeTime)!==null&&Or!==void 0?Or:0)-((ni=ot?.totalDecodeTime)!==null&&ni!==void 0?ni:0),0),wT=Math.max(((ei=et?.framesDecoded)!==null&&ei!==void 0?ei:0)-((Er=ot?.framesDecoded)!==null&&Er!==void 0?Er:0),0),AT=TT/Math.max(wT,1),r1=Math.max(((jr=et?.packetsLost)!==null&&jr!==void 0?jr:0)-((gr=ot?.packetsLost)!==null&&gr!==void 0?gr:0),0),CS=Math.max(((xr=et?.packetsReceived)!==null&&xr!==void 0?xr:0)-((ri=ot?.packetsReceived)!==null&&ri!==void 0?ri:0),0),RT=r1/Math.max(CS+r1,1),ym=oo(gn?.mimeType,gn?.sdpFmtpLine),x3=8*(br||0)/RS;return{bytes_received:AS,codec_mime_type:ym?.mimeSubtype,codec_profile:ym?.profile,codec_level:ym?.level,connection_bandwidth:(ws=(ji=Mt?.candidatePair)===null||ji===void 0?void 0:ji.availableIncomingBitrate)!==null&&ws!==void 0?ws:0,decode_bitrate:xT,decoder_implementation:(As=et?.decoderImplementation)!==null&&As!==void 0?As:"unknown",fir_count:Math.max(((Rs=et?.firCount)!==null&&Rs!==void 0?Rs:0)-((Ks=ot?.firCount)!==null&&Ks!==void 0?Ks:0),0),fraction_packets_lost:RT,frame_decode_time_avg:AT,frame_height:Math.max((Mo=et?.frameHeight)!==null&&Mo!==void 0?Mo:0,0),frame_width:Math.max((ko=et?.frameWidth)!==null&&ko!==void 0?ko:0,0),frames_decoded:Math.max(((Oo=et?.framesDecoded)!==null&&Oo!==void 0?Oo:0)-((uo=ot?.framesDecoded)!==null&&uo!==void 0?uo:0),0),frames_dropped:Math.max(((ho=et?.framesDropped)!==null&&ho!==void 0?ho:0)-((fo=ot?.framesDropped)!==null&&fo!==void 0?fo:0),0),frames_received:Math.max(((Na=et?.framesReceived)!==null&&Na!==void 0?Na:0)-((Xs=ot?.framesReceived)!==null&&Xs!==void 0?Xs:0),0),freeze_count:Math.max(((Xc=et?.freezeCount)!==null&&Xc!==void 0?Xc:0)-((wl=ot?.freezeCount)!==null&&wl!==void 0?wl:0),0),frames_rendered:Math.max((Zc=et?.framesRendered)!==null&&Zc!==void 0?Zc:0,0),frames_per_second:Math.max((Tu=et?.framesPerSecond)!==null&&Tu!==void 0?Tu:0,0),header_bytes_received:Math.max(((wu=et?.headerBytesReceived)!==null&&wu!==void 0?wu:0)-((Al=ot?.headerBytesReceived)!==null&&Al!==void 0?Al:0),0),configured_jitter_buffer_min_delay_ms:Wn??0,jitter_buffer_min_obtainable_delay:wS,jitter_buffer_delay_avg:TS,key_frames_decoded:Math.max(((df=et?.keyFramesDecoded)!==null&&df!==void 0?df:0)-((_h=ot?.keyFramesDecoded)!==null&&_h!==void 0?_h:0),0),nack_count:Math.max(((pf=et?.nackCount)!==null&&pf!==void 0?pf:0)-((id=ot?.nackCount)!==null&&id!==void 0?id:0),0),packets_discarded:Math.max(((Zl=et?.packetsDiscarded)!==null&&Zl!==void 0?Zl:0)-((fm=ot?.packetsDiscarded)!==null&&fm!==void 0?fm:0),0),packets_lost:r1,packets_received:CS,pause_count:Math.max(((vg=et?.pauseCount)!==null&&vg!==void 0?vg:0)-((Qd=ot?.pauseCount)!==null&&Qd!==void 0?Qd:0),0),pli_count:Math.max(((dm=et?.pliCount)!==null&&dm!==void 0?dm:0)-((yg=ot?.pliCount)!==null&&yg!==void 0?yg:0),0),power_efficient_decoder:(pm=et?.powerEfficientDecoder)!==null&&pm!==void 0&&pm,total_freezes_duration:Math.max(((mm=et?.totalFreezesDuration)!==null&&mm!==void 0?mm:0)-((bg=ot?.totalFreezesDuration)!==null&&bg!==void 0?bg:0),0),total_pauses_duration:Math.max(((gm=et?.totalPausesDuration)!==null&&gm!==void 0?gm:0)-((_m=ot?.totalPausesDuration)!==null&&_m!==void 0?_m:0),0),sei_read_count:ar,sei_bytes_received:br,sei_bitrate:x3,protocol:(vm=Mt?.localCandidate)===null||vm===void 0?void 0:vm.protocol}})(H,X,re,se,lt,ee,he,Ee)))}}class vT extends $n{constructor(E,A,O,j,H,X,re,se,ee){var he,Ee;super(xn.SUBSCRIBED_AUDIO_STATS,E,A,!1),Object.assign(this.properties,Object.assign({action:yn.SUBSCRIBE,node:(he=j?.node)!==null&&he!==void 0?he:"",cluster:(Ee=j?.cluster)!==null&&Ee!==void 0?Ee:"",remote_participant_id:O},((Ce,Ye,gt,ft,lt)=>{var et,ot,Mt,gn,Bn,Wn,ar,br,kr,mr,Or,ni,ei,Er,jr,gr,xr,ri;let ji=0;Ce?.jitterBufferDelay&&Ce?.jitterBufferEmittedCount&&Ce.jitterBufferEmittedCount>0&&(ji=Ce.jitterBufferDelay/Ce.jitterBufferEmittedCount);const ws=ft??1,As=Math.max((et=Ce?.bytesReceived)!==null&&et!==void 0?et:0,0),Rs=8*As/ws,Ks=Math.max((ot=Ce?.packetsLost)!==null&&ot!==void 0?ot:0,0),Mo=Math.max((Mt=Ce?.packetsReceived)!==null&&Mt!==void 0?Mt:0,0),ko=Ks/Math.max(Mo+Ks,1),Oo=Math.max((gn=Ce?.concealedSamples)!==null&&gn!==void 0?gn:0,0),uo=Math.max((Bn=Ce?.totalSamplesReceived)!==null&&Bn!==void 0?Bn:0,0),ho=Oo/Math.max(uo,1),fo=oo(gt?.mimeType,gt?.sdpFmtpLine);return{audio_level:(Wn=Ce?.audioLevel)!==null&&Wn!==void 0?Wn:0,audio_nacks_enabled:(ar=lt?.audioNacks)!==null&&ar!==void 0&&ar,bytes_received:As,codec_mime_type:fo?.mimeSubtype,connection_bandwidth:(kr=(br=Ye?.candidatePair)===null||br===void 0?void 0:br.availableIncomingBitrate)!==null&&kr!==void 0?kr:0,concealed_samples:Oo,concealment_events:Math.max((mr=Ce?.concealmentEvents)!==null&&mr!==void 0?mr:0,0),silent_concealed_samples:Math.max((Or=Ce?.silentConcealedSamples)!==null&&Or!==void 0?Or:0,0),decode_bitrate:Rs,fraction_audio_concealed:ho,fraction_packets_lost:ko,header_bytes_received:Math.max((ni=Ce?.headerBytesReceived)!==null&&ni!==void 0?ni:0,0),inserted_samples_for_deceleration:Math.max((ei=Ce?.insertedSamplesForDeceleration)!==null&&ei!==void 0?ei:0,0),jitter_buffer_delay_avg:ji,packets_discarded:Math.max((Er=Ce?.packetsDiscarded)!==null&&Er!==void 0?Er:0,0),retransmitted_packets_received:Math.max((jr=Ce?.retransmittedPacketsReceived)!==null&&jr!==void 0?jr:0,0),retransmitted_bytes_received:Math.max((gr=Ce?.retransmittedBytesReceived)!==null&&gr!==void 0?gr:0,0),packets_lost:Ks,packets_received:Mo,nack_count:Math.max((xr=Ce?.nackCount)!==null&&xr!==void 0?xr:0,0),removed_samples_for_acceleration:Math.max((ri=Ce?.removedSamplesForAcceleration)!==null&&ri!==void 0?ri:0,0),total_samples_received:uo}})(H,X,re,se,ee)))}}class yT extends $n{constructor(E,A,O,j,H,X,re,se,ee,he){var Ee,Ce,Ye,gt;super(xn.SUBSCRIBED_AUDIO_STATS_WINDOW,E,A,!1);const ft=Math.max(((Ee=H?.timestamp)!==null&&Ee!==void 0?Ee:0)-((Ce=X?.timestamp)!==null&&Ce!==void 0?Ce:0),0);Object.assign(this.properties,Object.assign({action:yn.SUBSCRIBE,window_size_ms:ft,node:(Ye=j?.node)!==null&&Ye!==void 0?Ye:"",cluster:(gt=j?.cluster)!==null&&gt!==void 0?gt:"",remote_participant_id:O},((lt,et,ot,Mt,gn,Bn,Wn)=>{var ar,br,kr,mr,Or,ni,ei,Er,jr,gr,xr,ri,ji,ws,As,Rs,Ks,Mo,ko,Oo,uo,ho,fo,Na,Xs,Xc,wl,Zc,Tu,wu,Al,df,_h;let pf=0,id=0;if(lt?.jitterBufferEmittedCount&&et?.jitterBufferEmittedCount&&lt.jitterBufferEmittedCount>et.jitterBufferEmittedCount){lt?.jitterBufferDelay&&et?.jitterBufferDelay&&(pf=(lt.jitterBufferDelay-et.jitterBufferDelay)/(lt.jitterBufferEmittedCount-et.jitterBufferEmittedCount));const _m=et?.jitterBufferMinimumDelay,vm=lt?.jitterBufferMinimumDelay;_m&&vm&&(id=(vm-_m)/(lt.jitterBufferEmittedCount-et.jitterBufferEmittedCount))}const Zl=typeof gn!="number"?1:gn/1e3,fm=Math.max(((ar=lt?.bytesReceived)!==null&&ar!==void 0?ar:0)-((br=et?.bytesReceived)!==null&&br!==void 0?br:0),0),vg=8*fm/Zl,Qd=Math.max(((kr=lt?.packetsLost)!==null&&kr!==void 0?kr:0)-((mr=et?.packetsLost)!==null&&mr!==void 0?mr:0),0),dm=Math.max(((Or=lt?.packetsReceived)!==null&&Or!==void 0?Or:0)-((ni=et?.packetsReceived)!==null&&ni!==void 0?ni:0),0),yg=Qd/Math.max(dm+Qd,1),pm=Math.max(((ei=lt?.concealedSamples)!==null&&ei!==void 0?ei:0)-((Er=et?.concealedSamples)!==null&&Er!==void 0?Er:0),0),mm=Math.max(((jr=lt?.totalSamplesReceived)!==null&&jr!==void 0?jr:0)-((gr=et?.totalSamplesReceived)!==null&&gr!==void 0?gr:0),0),bg=pm/Math.max(mm,1),gm=oo(Mt?.mimeType,Mt?.sdpFmtpLine);return{audio_level:(xr=lt?.audioLevel)!==null&&xr!==void 0?xr:0,audio_nacks_enabled:(ri=Bn?.audioNacks)!==null&&ri!==void 0&&ri,bytes_received:fm,codec_mime_type:gm?.mimeSubtype,connection_bandwidth:(ws=(ji=ot?.candidatePair)===null||ji===void 0?void 0:ji.availableIncomingBitrate)!==null&&ws!==void 0?ws:0,decode_bitrate:vg,concealed_samples:pm,concealment_events:Math.max(((As=lt?.concealmentEvents)!==null&&As!==void 0?As:0)-((Rs=et?.concealmentEvents)!==null&&Rs!==void 0?Rs:0),0),silent_concealed_samples:Math.max(((Ks=lt?.silentConcealedSamples)!==null&&Ks!==void 0?Ks:0)-((Mo=et?.silentConcealedSamples)!==null&&Mo!==void 0?Mo:0),0),fraction_audio_concealed:bg,fraction_packets_lost:yg,header_bytes_received:Math.max(((ko=lt?.headerBytesReceived)!==null&&ko!==void 0?ko:0)-((Oo=et?.headerBytesReceived)!==null&&Oo!==void 0?Oo:0),0),inserted_samples_for_deceleration:Math.max(((uo=lt?.insertedSamplesForDeceleration)!==null&&uo!==void 0?uo:0)-((ho=et?.insertedSamplesForDeceleration)!==null&&ho!==void 0?ho:0),0),configured_jitter_buffer_min_delay_ms:Wn??0,jitter_buffer_min_obtainable_delay:id,jitter_buffer_delay_avg:pf,packets_discarded:Math.max(((fo=lt?.packetsDiscarded)!==null&&fo!==void 0?fo:0)-((Na=et?.packetsDiscarded)!==null&&Na!==void 0?Na:0),0),packets_lost:Qd,packets_received:dm,nack_count:Math.max(((Xs=lt?.nackCount)!==null&&Xs!==void 0?Xs:0)-((Xc=et?.nackCount)!==null&&Xc!==void 0?Xc:0),0),removed_samples_for_acceleration:Math.max(((wl=lt?.removedSamplesForAcceleration)!==null&&wl!==void 0?wl:0)-((Zc=et?.removedSamplesForAcceleration)!==null&&Zc!==void 0?Zc:0),0),retransmitted_packets_received:Math.max(((Tu=lt?.retransmittedPacketsReceived)!==null&&Tu!==void 0?Tu:0)-((wu=et?.retransmittedPacketsReceived)!==null&&wu!==void 0?wu:0),0),retransmitted_bytes_received:Math.max(((Al=lt?.retransmittedBytesReceived)!==null&&Al!==void 0?Al:0)-((df=et?.retransmittedBytesReceived)!==null&&df!==void 0?df:0),0),total_samples_received:mm,protocol:(_h=ot?.localCandidate)===null||_h===void 0?void 0:_h.protocol}})(H,X,re,se,ft,ee,he)))}}class J_ extends $n{constructor(E,A,O,j,H=yn.PUBLISH,X=!1,re=""){super(xn.SIMULCAST_LAYER_INFO,E,A,!1),Object.assign(this.properties,{rid:O,active:j,selected:X,source:H===yn.PUBLISH?"publisher":"subscriber",remote_participant_id:re})}}const nm=C=>{console.warn(`[IVS Stages] ${C}`)};var rm,im,zo;(function(C){C.Mobile="mobile",C.Tablet="tablet",C.Desktop="desktop",C.Tv="tv"})(rm||(rm={})),(function(C){C.IOS="iOS",C.MacOS="macOS",C.Windows="Windows",C.Android="Android"})(im||(im={})),(function(C){C.Safari="Safari",C.Firefox="Firefox",C.Chrome="Chrome",C.IE="Internet Explorer",C.Edge="Microsoft Edge"})(zo||(zo={}));const uh=(function(C){const E=hh(C);return{platform:{isMobile:eg(rm.Mobile,E),isTablet:eg(rm.Tablet,E),isDesktop:eg(rm.Desktop,E),isTv:eg(rm.Tv,E)},os:{name:mS(E),version:pS(E),isIOS:tg(im.IOS,E),isMacOS:tg(im.MacOS,E),isWindows:tg(im.Windows,E),isAndroid:tg(im.Android,E)},browser:{name:gS(E),version:$y(E),isSafari:ng(zo.Safari,E),isFirefox:ng(zo.Firefox,E),isChrome:ng(zo.Chrome,E),isIE:ng(zo.IE,E),isEdge:ng(zo.Edge,E)}}})(window.navigator.userAgent);function hh(C){try{return To.getParser(C||window.navigator.userAgent)}catch{}}function eg(C,E){return()=>(E||(E=hh()),!(!E||E.getPlatformType(!0)!==C.toLowerCase()))}function pS(C){return()=>(C||(C=hh()),C&&C.getOSVersion()||"")}function mS(C){return()=>(C||(C=hh()),C&&C.getOSName()||"")}function tg(C,E){return()=>(E||(E=hh()),!(!E||E.getOSName(!0)!==C.toLowerCase()))}function $y(C){return()=>(C||(C=hh()),C&&C.getBrowserVersion()||"")}function gS(C){return()=>(C||(C=hh()),C&&C.getBrowserName()||"")}function ng(C,E){return()=>(E||(E=hh()),!(!E||E.getBrowserName().toLowerCase()!==C.toLowerCase()))}const _S={name:"SimulcastUnsupported",message:`Simulcast is only supported on Chromium browsers at bitrates over ${Wd.MID.maxBitrateKbps}Kbps`,code:100},rf={name:"SimulcastLayerInvalidType",message:"Layer configuration is invalid: ",code:101},Wy={name:"SimulcastMaxLayersExceeded",message:"No more than 3 simulcast layers may be configured",code:102},vS={name:"SimulcastDuplicateLayersConfigured",message:"Two duplicate layers are configured. At minimum bitrate, framerate, or dimensions must differ",code:103},Ro={name:"SimulcastMaxLayerBitrateExceeded",message:`maxBitrateKbps cannot exceed ${ch} Kbps`,code:105},Q_={name:"SimulcastMinLayerBitrateExceeded",message:`maxBitrateKbps cannot be less than ${Zf} Kbps`,code:106},qy={name:"SimulcastMaxLayerFramerateExceeded",message:`maxFramerate cannot exceed ${lh} fps`,code:107},ev={name:"SimulcastMinLayerFramerateExceeded",message:`maxFramerate cannot be less than ${Qp} fps`,code:108},tv={name:"SimulcastMaxLayerDimensionsExceeded",message:`dimensions cannot exceed max resolution of ${Yd}x720`,code:109},nv={name:"SimulcastMinLayerDimensionsExceeded",message:`width or height cannot be lower than ${qd}`,code:110},rg={name:"SimulcastLayerConfigurationConflict",message:"Layer configuration conflict: ",code:111},Xd={name:"SimulcastLayerOrientationMismatch",message:"Layer orientation different from input video track: ",code:112},fh={name:"SimulcastLayerInputResolutionInsufficient",message:"Input video resolution is lower than the configured layer: ",code:113},Ma={name:"SimulcastLayerInputFramerateInsufficient",message:"Input video framerate is lower than the configured layer: ",code:114};class la extends Error{constructor({name:E,message:A,code:O,details:j,cause:H,params:X}){super(A),Error.captureStackTrace&&Error.captureStackTrace(this,la),this.name=E,this.message=A,this.code=O,this.details=j,this.cause=H,this.params=X}}const ig=C=>({rid:C.rid,active:C.active,scaleResolutionDownBy:C.scaleFactor,maxBitrate:C.maxBitrateBps,maxFramerate:C.maxFramerate}),sg=(C,E)=>C.width*C.height>E.width*E.height||C.maxBitrateKbps>E.maxBitrateKbps||C.maxFramerate>E.maxFramerate?1:og(C,E)?0:-1,og=(C,E)=>{if(typeof C!="object"||typeof E!="object")return!1;const A=Object.keys(C);for(const O of A)if(C[O]!==E[O])return!1;return!0},_c=C=>{const{width:E,height:A}=ag(C);return E*A},ag=C=>{const{height:E,width:A}=C;let O=Yd/Z0,j=Yd;return E!==void 0&&(O=E),A!==void 0&&(j=A),E&&!A&&(j=E*Z0),!E&&A&&(O=A/Z0),{height:O,width:j}},yS=C=>{const{width:E,height:A}=C;return E/A>=1?k0.LANDSCAPE:k0.PORTRAIT},Gl=(C,E,A)=>{var O;const j=(O=C.getSettings().frameRate)!==null&&O!==void 0?O:lh;return Object.assign(Object.assign({},A),{active:!0,height:E.height,width:E.width,maxBitrateBps:Eu(E.maxBitrateKbps),maxFramerate:Math.min(E.maxFramerate,j),scaleFactor:cr(E,C)})},cr=(C,E)=>{const A=_c(E.getSettings()),O=_c(C);if(O>=A)return 1;const j=1/Math.sqrt(O/A);return Math.max(j,1)},bS=C=>{if(typeof C!="object"){const E=Object.assign({},rf);throw E.message+=" is not an object",new la(E)}},$c=(C,E)=>{if(typeof C!="number"){const A=Object.assign({},rf);throw A.message+="maxBitrateKbps is not a number",new la(A)}if(C<Zf)throw new la(Object.assign({},Q_));if(C>ch)throw new la(Object.assign({},Ro));if(E&&C>E){const A=Object.assign({},rg);throw A.message+=`maxBitrateKbps cannot be greater than stage maxVideoBitrateKbps of ${E}`,new la(A)}},Ps=(C,E)=>{if(typeof C!="number"){const A=Object.assign({},rf);throw A.message+="maxFramerate is not a number",new la(A)}if(C<Qp)throw new la(Object.assign({},ev));if(C>lh)throw new la(Object.assign({},qy));if(E&&C>E){const A=Object.assign({},rg);throw A.message+=`maxFramerate cannot be greater than stage maxFramerate of ${E} `,new la(A)}},Jf=(C,E)=>{var A;if(typeof C!="number"||typeof E!="number"){const H=Object.assign({},rf);throw H.message+="width and height must be numbers",new la(H)}if(C<qd||E<qd)throw new la(Object.assign({},nv));const O=(A=cc("enable1080pResolution"))!==null&&A!==void 0&&A,j=O?1920:Yd;if(C>j||E>j)throw new la(Object.assign({},tv));if(C*E>(O?2073600:X0))throw new la(Object.assign({},tv))},bT=(C,E)=>{const A=ag(E.getSettings()),O=yS(A);O!==yS(C)&&nm(`${Xd.message}forcing orientation to ${O}`)},Yy=(C,E)=>{var A,O,j,H,X;let re=(0,Vi.cloneDeep)(E);const se=(A=re.simulcast)!==null&&A!==void 0?A:{},ee=!uh.browser.isChrome()&&!uh.browser.isEdge(),he=(j=(O=C.getSettings())===null||O===void 0?void 0:O.displaySurface)!==null&&j!==void 0&&j,Ee=(H=re.maxVideoBitrateKbps)!==null&&H!==void 0?H:ch,Ce=!(Array.isArray((X=E.simulcast)===null||X===void 0?void 0:X.layers)||!E.maxVideoBitrateKbps)&&Ee<Wd.MID.maxBitrateKbps;if(typeof se.enabled=="boolean"&&se.enabled&&(ee||he||Ce)){re.simulcast={enabled:!1};const{name:Ye,message:gt}=_S;nm(`${Ye}${gt}, disabling the feature`)}return re=((Ye,gt)=>{var ft,lt;const et=gt,ot=(ft=gt.simulcast)===null||ft===void 0?void 0:ft.layers;if(ot===void 0)return et;if(!Array.isArray(ot)){const Mt=Object.assign({},rf);throw Mt.message+=" layers is not an array",new la(Mt)}if(ot.length===0)return(lt=et.simulcast)===null||lt===void 0||delete lt.layers,et;if(ot.length>3)throw new la(Object.assign({},Wy));if((0,Vi.uniqWith)(ot,og).length!==ot.length)throw new la(Object.assign({},vS));for(const Mt of ot)bS(Mt),$c(Mt.maxBitrateKbps,gt.maxVideoBitrateKbps),Ps(Mt.maxFramerate,gt.maxFramerate),Jf(Mt.width,Mt.height),bT(Mt,Ye);return et})(C,re),re};function vc(C){return C.track.kind===Vs.AUDIO}function Xa(C){return C.track.kind===Vs.VIDEO&&typeof C.config=="object"}function ka(C){if(C!==void 0&&(C<Zf||C>ch))throw new Error(`Stage bitrate must be a number between ${Zf} kbps and ${ch} kbps inclusive`)}function os(C){return C!==void 0&&("maxBitrate"in C||"maxVideoBitrateKbps"in C||"maxFramerate"in C||"simulcast"in C||"inBandMessaging"in C||"minBitrate"in C)}function Ki(C,E){if(E===void 0)return E;let A=(0,Vi.cloneDeep)(E);return os(A)?(A.maxBitrate!==void 0&&(A.maxVideoBitrateKbps=A.maxBitrate,nm("maxBitrate is deprecated in favor of maxVideoBitrateKbps")),A=Yy(C,A),ka(A.maxVideoBitrateKbps),ka(A.minBitrate),(function(O){if(O!==void 0&&(O>lh||O<Qp))throw new Error(`Stage framerate must be between ${Qp} fps and ${lh} fps inclusive`)})(A.maxFramerate),(function(O){if(O!==void 0){if(typeof O!="object")throw new Error("In-band messaging config must be an object");if(typeof O.enabled!="boolean")throw new Error("In-band messaging config enabled property must be a boolean")}})(A.inBandMessaging)):((function(O){if(O!==void 0&&(O<J0||O>em))throw new Error(`Stage audio bitrate must be between ${J0} Kbps and ${em} Kbps inclusive`)})(A.maxAudioBitrateKbps),(function(O){if(O!==void 0&&typeof O!="boolean")throw new Error("Stage stereo prop must be a boolean")})(A.stereo)),A}const Zd=(C,E,A)=>{var O;const j={[jc.HI]:Dy(jc.HI),[jc.MID]:Dy(jc.MID),[jc.LOW]:Dy(jc.LOW)},H=E.simulcast,X=A?.simulcast;let re=H.layers.sort(sg);const se=(O=X?.layers)!==null&&O!==void 0?O:[],ee=re.length,he=se.length;return re=re.map((Ee=>{((Ye,gt)=>{const{width:ft,height:lt}=ag(gt.getSettings()),{width:et,height:ot}=Ye;if(et*ot>ft*lt){const Mt=`forcing layer of ${et}x${ot} to the input dimensions ${ft}x${lt}`,{name:gn,message:Bn}=fh;nm(`${gn}${Bn}${Mt}`)}})(Ee,C),((Ye,gt)=>{var ft;const lt=(ft=gt.getSettings().frameRate)!==null&&ft!==void 0?ft:lh,et=Ye.maxFramerate;if(et>lt){const ot=`forcing layer of ${et}fps to the input framerate of ${lt}`,{name:Mt,message:gn}=Ma;nm(`${Mt}${gn}${ot}`)}})(Ee,C);let Ce=((Ye,gt)=>{const{maxVideoBitrateKbps:ft}=gt,lt=Ye;return ft&&Ye.maxBitrateKbps>ft&&(lt.maxBitrateKbps=ft),lt})(Ee,E);return Ce=((Ye,gt)=>{const{maxFramerate:ft}=gt,lt=Ye;return ft&&Ye.maxFramerate>ft&&(lt.maxFramerate=ft),lt})(Ee,E),Ce})),(he===0||he===3)&&ee===3?(j.hi=Gl(C,re[2],j.hi),j.mid=Gl(C,re[1],j.mid),j.low=Gl(C,re[0],j.low),pn.ok(j)):he===1&&ee===1?(j.hi=Gl(C,re[0],j.hi),pn.ok(j)):he===2&&ee===2?(j.hi=Gl(C,re[1],j.hi),j.low=Gl(C,re[0],j.low),pn.ok(j)):pn.err(null)},cg=(C,E,A)=>{const O=E.simulcast,j=E.inBandMessaging,H=Eu(E.minBitrate),X=Eu(E.maxVideoBitrateKbps),re=E.maxFramerate;let se=[{maxBitrate:X,maxFramerate:re}];const ee=Zd(C,E,A??{});return O.enabled&&ee.ok&&(se=(he=>{const{hi:Ee,mid:Ce,low:Ye}=he;return[ig(Ye),ig(Ce),ig(Ee)]})(ee.value)),{track:C,config:{minBitrateBps:H,maxBitrateBps:X,maxFramerate:re,inBandMessagingEnabled:j.enabled,simulcastEnabled:O.enabled,simulcastLayers:ee.ok?ee.value:void 0,encodingLayers:se}}},sf=C=>{const E=C.mediaStreamTrack,A=C.normalizedConfig;let O={};const j=C.validatedExternalConfig;return os(j)&&(O=j),(function(H){return H.kind===Vs.AUDIO})(E)?((H,X)=>{const re={maxBitrateBps:Eu(X.maxAudioBitrateKbps)},se=X?.stereo;return typeof se=="boolean"&&(re.stereo=se),{track:H,config:re}})(E,A):cg(E,A,O)},Wc=(C,E)=>{const A={minBitrate:Zf,maxBitrate:ch,maxVideoBitrateKbps:ch,maxFramerate:lh,simulcast:{enabled:!1,layers:[Object.assign({},Wd.HI),Object.assign({},Wd.MID),Object.assign({},Wd.LOW)]},maxAudioBitrateKbps:Q0,stereo:!1,inBandMessaging:{enabled:!1}},O=(0,Vi.cloneDeep)(E),j=Object.assign(Object.assign({},A),O);return os(O)&&(O.simulcast&&(j.simulcast=Object.assign(Object.assign({},A.simulcast),O.simulcast)),O.inBandMessaging&&(j.inBandMessaging=Object.assign(Object.assign({},A.inBandMessaging),O.inBandMessaging))),j},Za=(C,E)=>{if(typeof C=="number")return C;const A=E?Ly:xu;return A[C]!==void 0?A[C]:0};class dh extends $n{constructor(E,A,O,j){super(xn.MULTIHOST_CONFIGURATION,E,A,!1),Object.assign(this.properties,Object.assign(Object.assign({},O),{action:j}))}}class ao extends $n{constructor(E,A,O,j,H){super(xn.MULTIHOST_SUBSCRIBE_CONFIGURATION,E,A,!1);const X={trigger:O,remote_participant_id:j,min_delay_when_publishing:Za(H.jitterBuffer.minDelayWhenPublishing,!0),min_delay_when_subscribe_only:Za(H.jitterBuffer.minDelayWhenSubscribeOnly,!1),in_band_messaging_enabled:H.inBandMessaging.enabled,simulcast_initial_layer_preference:H.simulcast.initialLayerPreference,simulcast_layer_poll_interval_ms:H.simulcast.layerPollingIntervalMs,simulcast_layer_poll_enabled:H.simulcast.layerPollingEnabled};Object.assign(this.properties,X)}}var ua=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};class Co{constructor(E,A,O,j,H){this.analyticsTracker=H,this.simulcastEnabled=!1,this.simulcastState={low:!1,mid:!1,hi:!1},this.sdp=new Hr(""),this.sdpFeatures={audioNacks:!1},this.multihostConfiguration=Co.defaultMultihostConfiguration(),this.prevOutboundVideoStats=new Map,this.prevInboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.sfuResource={node:"",cluster:""},this.connectionStartedTimestamp=Date.now(),this.seiStats={seiReadCnt:0,seiBytesRead:0,seiWriteCnt:0,seiBytesWritten:0},this.prevVideoReceiverTransformerStats={seiReadCnt:0,seiBytesRead:0},this.prevVideoSenderTransformerStats={seiWriteCnt:0,seiBytesWritten:0},this.vidNetworkQualityMap=new Map,this.audioNetworkQualityMap=new Map,this.onPeerConnectionStateChange=()=>{switch(this.getConnectionState()){case Zn.CONNECTED:this.connectionStartedTimestamp=Date.now(),this.setupIntervals();break;case Zn.FAILED:this.flushStats()}},this.action=E,this.token=A,this.traceId=O,this.identifier=j}static defaultMultihostConfiguration(){return{video_codec:"unknown",width:0,height:0,max_bitrate:0,min_bitrate:0,target_fps:0,echo_cancellation:!1,auto_gain:!1,noise_suppression:!1,enable_simulcast:!1,max_audio_bitrate_bps:Eu(em),hi_video_layer:"",mid_video_layer:"",low_video_layer:""}}set sdpAnswer(E){try{this.sdp=new Hr(E),this.sdpFeatures.audioNacks=this.sdp.hasAudioNacksEnabled()}catch{}}start(E,A=!1){this.peerConnection=E,this.simulcastEnabled=A,this.prevOutboundAudioStats=void 0,this.prevOutboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.peerConnection.addEventListener("connectionstatechange",this.onPeerConnectionStateChange)}stop(){var E;clearInterval(this.uploadStatsInterval),this.uploadStatsInterval=void 0,(E=this.peerConnection)===null||E===void 0||E.removeEventListener("connectionstatechange",this.onPeerConnectionStateChange)}updateSfuResource(E){this.sfuResource=E}updateMultihostConfiguration(E,A){var O,j,H,X,re,se,ee,he,Ee;return ua(this,void 0,void 0,(function*(){if(this.action!==yn.PUBLISH||!this.peerConnection)return;const Ce=Co.defaultMultihostConfiguration();if(A){const Ye=this.peerConnection.getSenders().filter((lt=>lt.track!==null&&lt.track.kind==="video"));let gt="unknown";Ye.length>0&&(yield Ye[0].getStats()).forEach((lt=>{if(lt.type==="codec"&&(Ce.video_codec=lt.mimeType,lt.sdpFmtpLine)){const et=lt.sdpFmtpLine.match(/profile-level-id=([a-f0-9]+)/);et&&et.length>0&&(gt=et[1])}}));const ft=A.track.getSettings();Ce.width=(O=ft.width)!==null&&O!==void 0?O:0,Ce.height=(j=ft.height)!==null&&j!==void 0?j:0,Ce.target_fps=(H=ft.frameRate)!==null&&H!==void 0?H:0,A.config?(Ce.max_bitrate=A.config.maxBitrateBps,Ce.min_bitrate=A.config.minBitrateBps,Ce.enable_simulcast=A.config.simulcastEnabled):(Ce.max_bitrate=Eu(ch),Ce.min_bitrate=Eu(Zf),Ce.enable_simulcast=!1),A.config.simulcastEnabled&&(Ce.hi_video_layer=this.mapLayerToMetric(gt,(X=A.config.simulcastLayers)===null||X===void 0?void 0:X.hi),Ce.mid_video_layer=this.mapLayerToMetric(gt,(re=A.config.simulcastLayers)===null||re===void 0?void 0:re.mid),Ce.low_video_layer=this.mapLayerToMetric(gt,(se=A.config.simulcastLayers)===null||se===void 0?void 0:se.low))}if(E){const Ye=E.track.getSettings();Ce.auto_gain=(ee=Ye.autoGainControl)!==null&&ee!==void 0&&ee,Ce.echo_cancellation=(he=Ye.echoCancellation)!==null&&he!==void 0&&he,Ce.noise_suppression=(Ee=Ye.noiseSuppression)!==null&&Ee!==void 0&&Ee,Ce.max_audio_bitrate_bps=E.config.maxBitrateBps,Ce.stereo=E.config.stereo}(0,Vi.isEqual)(Ce,this.multihostConfiguration)||(this.analyticsTracker.trackEventNoSharedProps(new dh(this.token,this.traceId,Ce,this.action)),this.multihostConfiguration=Ce)}))}resetTransformers(E,A){this.senderVideoTransformer=A,this.receiveVideoTransformer=E,this.prevVideoReceiverTransformerStats={seiReadCnt:0,seiBytesRead:0},this.prevVideoSenderTransformerStats={seiWriteCnt:0,seiBytesWritten:0}}getStats(E){var A;return ua(this,void 0,void 0,(function*(){const O=yield(A=this.peerConnection)===null||A===void 0?void 0:A.getStats(E),{action:j}=this;if(O)if(E.kind==="audio"){if(j===yn.PUBLISH)return{action:j,rawReport:O,stats:Z_(O,this.audioNetworkQualityMap)};if(j===yn.SUBSCRIBE)return{action:j,rawReport:O,stats:uS(O,this.audioNetworkQualityMap)}}else{if(j===yn.PUBLISH)return{action:j,rawReport:O,stats:lS(O,this.vidNetworkQualityMap)};if(j===yn.SUBSCRIBE)return{action:j,rawReport:O,stats:hS(O,this.vidNetworkQualityMap)}}}))}mapLayerToMetric(E,A){return!A||!A.active?"":`${`${A.height}x${A.width}`}_${`${A.maxFramerate}fps`}_${A.maxBitrateBps/1e3+"kbps"}_${E}`}updateJitterBufferMinDelay(E){this.jitterBufferMinDelayInMs=E}setupIntervals(){this.action===yn.PUBLISH&&this.simulcastEnabled&&!this.pollSimulcastLayerInterval&&(this.pollSimulcastLayers(),this.pollSimulcastLayerInterval=this.startInterval(this.pollSimulcastLayers,5e3)),this.uploadStatsInterval||(this.uploadStats(),this.uploadStatsInterval=this.startInterval(this.uploadStats,1e4))}startInterval(E,A){return setInterval(E.bind(this),A)}getConnectionState(){var E;if(!this.peerConnection)return Zn.NONE;const A=(E=this.peerConnection.connectionState)!==null&&E!==void 0?E:this.peerConnection.iceConnectionState;try{return C_(A)}catch{return Zn.IDLE}}pollSimulcastLayers(){var E;return ua(this,void 0,void 0,(function*(){if(this.getConnectionState()===Zn.CONNECTED){const A=yield(E=this.peerConnection)===null||E===void 0?void 0:E.getStats();if(!A)return;A.forEach((O=>{var j;if(O.type==="outbound-rtp"){const H=((j=O.framesPerSecond)!==null&&j!==void 0?j:0)!==0;switch(O.rid){case"low":H!==this.simulcastState.low&&(this.simulcastState.low=H,this.analyticsTracker.trackEventNoSharedProps(new J_(this.token,this.traceId,O.rid,H)));break;case"mid":H!==this.simulcastState.mid&&(this.simulcastState.mid=H,this.analyticsTracker.trackEventNoSharedProps(new J_(this.token,this.traceId,O.rid,H)));break;case"hi":H!==this.simulcastState.hi&&(this.simulcastState.hi=H,this.analyticsTracker.trackEventNoSharedProps(new J_(this.token,this.traceId,O.rid,H)))}}}))}}))}flushStats(){var E;return ua(this,void 0,void 0,(function*(){const A=yield(E=this.peerConnection)===null||E===void 0?void 0:E.getStats();A&&(this.action===yn.PUBLISH?this.uploadPublisherStats(A):this.action===yn.SUBSCRIBE&&this.uploadSubscriberStats(A))}))}uploadStats(){var E;return ua(this,void 0,void 0,(function*(){if(this.getConnectionState()===Zn.CONNECTED){const A=yield(E=this.peerConnection)===null||E===void 0?void 0:E.getStats();if(!A)return;this.action===yn.PUBLISH?this.uploadPublisherStats(A):this.action===yn.SUBSCRIBE&&this.uploadSubscriberStats(A)}}))}uploadPublisherStats(E){var A,O;const j={audio:{},video:[],candidateStats:{}},H=new Map,X=(Date.now()-this.connectionStartedTimestamp)/1e3,re=Object.assign({},this.multihostConfiguration),{seiWriteCnt:se,seiBytesWritten:ee}=this.updateAndDiffSeiPublishStatsSinceLastUpdate((A=this.senderVideoTransformer)===null||A===void 0?void 0:A.getSenderStats());if(this.seiStats.seiWriteCnt+=se,this.seiStats.seiBytesWritten+=ee,E.forEach((he=>{if(he.type==="outbound-rtp"){const Ee=E.get(he.remoteId),Ce=this.prevRemoteInboundStats.get(he.remoteId);switch(Ee&&this.prevRemoteInboundStats.set(Ee.id,Ee),he.kind){case"audio":j.audio=this.updateOutboundAudio(he),j.audio.remoteInbound=Ee,j.audio.prevRemoteInbound=Ce,j.audio.codec=H.get(he.codecId);break;case"video":j.video.push(Object.assign({},this.updateOutboundVideo(he),{remoteInbound:Ee,prevRemoteInbound:Ce,codec:H.get(he.codecId)}))}}he.type==="candidate-pair"&&he.nominated&&(j.candidateStats.candidatePair=he,j.candidateStats.localCandidate=E.get(he.localCandidateId),j.candidateStats.remoteCandidate=E.get(he.remoteCandidate)),he.type==="codec"&&H.set(he.id,he)})),j.video.forEach((he=>{var Ee,Ce;const{outbound:Ye,prevOutbound:gt}=he;if(!Ye)return;const ft=(Ce=(Ee=he.outbound)===null||Ee===void 0?void 0:Ee.rid)!==null&&Ce!==void 0?Ce:ye;this.updateNetworkQualityPublish(ft,this.vidNetworkQualityMap,Ye,gt)})),j.audio.outbound){const he=(O=j.audio.outbound.rid)!==null&&O!==void 0?O:ye;this.updateNetworkQualityPublish(he,this.audioNetworkQualityMap,j.audio.outbound,j.audio.prevOutbound)}this.analyticsTracker.trackEventNoSharedProps(new gT(this.token,this.traceId,this.sfuResource,j.audio.outbound,j.audio.remoteInbound,j.candidateStats,j.audio.codec,re,X,this.sdpFeatures)),j.audio.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new _T(this.token,this.traceId,this.sfuResource,j.audio.outbound,j.audio.prevOutbound,j.audio.remoteInbound,j.audio.prevRemoteInbound,j.candidateStats,j.audio.codec,re,this.sdpFeatures)),j.video.forEach((he=>{this.analyticsTracker.trackEventNoSharedProps(new Vy(this.token,this.traceId,this.sfuResource,he.outbound,he.remoteInbound,j.candidateStats,he.codec,re,X)),he.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new mT(this.token,this.traceId,this.sfuResource,he.outbound,he.prevOutbound,he.remoteInbound,he.prevRemoteInbound,j.candidateStats,he.codec,re,this.seiStats.seiWriteCnt,this.seiStats.seiBytesWritten))}))}updateNetworkQualityPublish(E,A,O,j){var H,X,re,se;let ee=0;const he=Bo.getNetworkQuality(),Ee=(H=O.packetsSent)!==null&&H!==void 0?H:0,Ce=(X=O.nackCount)!==null&&X!==void 0?X:0;if(j)if(he===Eo.DOWN)A.set(E,Eo.DOWN);else{ee=(Ce-((re=j?.nackCount)!==null&&re!==void 0?re:0))/(Ee-((se=j?.packetsSent)!==null&&se!==void 0?se:0));const Ye=this.convertLostRatioToQuality(ee);A.set(E,Ye)}else A.set(E,he)}updateNetworkQualitySubscribe(E,A,O){var j,H,X,re;let se=0;const ee=Bo.getNetworkQuality(),he=(j=A?.packetsReceived)!==null&&j!==void 0?j:0,Ee=(H=A?.nackCount)!==null&&H!==void 0?H:0;if(!A)return;const Ce=A.id;if(Ce)if(O)if(ee===Eo.DOWN)E.set(Ce,Eo.DOWN);else{se=(Ee-((X=O?.nackCount)!==null&&X!==void 0?X:0))/(he-((re=O?.packetsReceived)!==null&&re!==void 0?re:0));const Ye=this.convertLostRatioToQuality(se);E.set(Ce,Ye)}else E.set(Ce,ee)}uploadSubscriberStats(E){var A,O;const j={audio:{},video:{},candidateStats:{}},H=new Map,X=(Date.now()-this.connectionStartedTimestamp)/1e3,re=(A=this.jitterBufferMinDelayInMs)!==null&&A!==void 0?A:0,{seiReadCnt:se,seiBytesRead:ee}=this.updateAndDiffSeiSubscribeStatsSinceLastUpdate((O=this.receiveVideoTransformer)===null||O===void 0?void 0:O.getReceiverStats());this.seiStats.seiReadCnt+=se,this.seiStats.seiBytesRead+=ee,E.forEach((he=>{if(he.type==="inbound-rtp")switch(he.kind){case"audio":j.audio=this.updateInboundAudio(he),j.audio.codec=H.get(he.codecId),this.updateNetworkQualitySubscribe(this.audioNetworkQualityMap,j.audio.inbound,j.audio.prevInbound);break;case"video":j.video=this.updateInboundVideo(he),j.video.codec=H.get(he.codecId),this.updateNetworkQualitySubscribe(this.vidNetworkQualityMap,j.video.inbound,j.video.prevInbound)}he.type==="candidate-pair"&&he.nominated&&(j.candidateStats.candidatePair=he,j.candidateStats.localCandidate=E.get(he.localCandidateId),j.candidateStats.remoteCandidate=E.get(he.remoteCandidate)),he.type==="codec"&&H.set(he.id,he)})),this.analyticsTracker.trackEventNoSharedProps(new vT(this.token,this.traceId,this.identifier,this.sfuResource,j.audio.inbound,j.candidateStats,j.audio.codec,X,this.sdpFeatures)),j.audio.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new yT(this.token,this.traceId,this.identifier,this.sfuResource,j.audio.inbound,j.audio.prevInbound,j.candidateStats,j.audio.codec,this.sdpFeatures,re)),this.analyticsTracker.trackEventNoSharedProps(new Gy(this.token,this.traceId,this.identifier,this.sfuResource,j.video.inbound,j.candidateStats,j.video.codec,X)),j.video.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new dS(this.token,this.traceId,this.identifier,this.sfuResource,j.video.inbound,j.video.prevInbound,j.candidateStats,j.video.codec,re,this.seiStats.seiReadCnt,this.seiStats.seiBytesRead))}updateAndDiffSeiSubscribeStatsSinceLastUpdate(E){const A=this.prevVideoReceiverTransformerStats;if(!E)return{seiReadCnt:A.seiReadCnt,seiBytesRead:A.seiBytesRead};const O=E.seiReadCnt-A.seiReadCnt,j=E.seiBytesRead-A.seiBytesRead;return this.prevVideoReceiverTransformerStats={seiReadCnt:E.seiReadCnt,seiBytesRead:E.seiBytesRead},{seiReadCnt:O,seiBytesRead:j}}updateAndDiffSeiPublishStatsSinceLastUpdate(E){const A=this.prevVideoSenderTransformerStats;if(!E)return{seiWriteCnt:A.seiWriteCnt,seiBytesWritten:A.seiBytesWritten};const O=E.seiWriteCnt-A.seiWriteCnt,j=E.seiBytesWritten-A.seiBytesWritten;return this.prevVideoSenderTransformerStats={seiWriteCnt:E.seiWriteCnt,seiBytesWritten:E.seiBytesWritten},{seiWriteCnt:O,seiBytesWritten:j}}updateOutboundAudio(E){const A=E,O=this.prevOutboundAudioStats,j=E.id===O?.id?O:void 0;return this.prevOutboundAudioStats=E,{outbound:A,prevOutbound:j}}updateInboundAudio(E){const A=E,O=this.prevInboundAudioStats,j=E.id===O?.id?O:void 0;return this.prevInboundAudioStats=E,{inbound:A,prevInbound:j}}updateInboundVideo(E){const A=E,O=this.prevInboundVideoStats.get(ye),j=E.id===O?.id?O:void 0;return this.prevInboundVideoStats.set(ye,E),{inbound:A,prevInbound:j}}updateOutboundVideo(E){const A=E,O=this.getPrevOutboundVideo(E),j=E.id===O?.id?O:void 0;return this.setPrevVideoStat(E),{outbound:A,prevOutbound:j}}getPrevOutboundVideo(E){return this.simulcastEnabled&&E.rid&&this.prevOutboundVideoStats.has(E.rid)?this.prevOutboundVideoStats.get(E.rid):!this.simulcastEnabled&&this.prevOutboundVideoStats.has(ye)?this.prevOutboundVideoStats.get(ye):void 0}setPrevVideoStat(E){this.simulcastEnabled&&E.rid?this.prevOutboundVideoStats.set(E.rid,E):this.simulcastEnabled||this.prevOutboundVideoStats.set(ye,E)}convertLostRatioToQuality(E){return E<=0?Eo.EXCELLENT:E<=.01?Eo.GOOD:E<=.03?Eo.NORMAL:E<=.1?Eo.POOR:Eo.DOWN}}class sm extends $n{constructor(E,A,O,j,H){super(xn.MINUTE,E,A,!1),Object.assign(this.properties,{action:j?yn.PUBLISH:yn.SUBSCRIBE,is_publishing:j,minutes_logged:O,subscribed_number:H})}}class of extends $n{constructor(E){super(xn.PUBLISH,E.token,E.traceId,!1),Object.assign(this.properties,{action:yn.PUBLISH,remote_participant_id:E.token.participantID})}}class $l extends $n{constructor(E){super(xn.UNPUBLISH,E.token,E.traceId,!0),Object.assign(this.properties,{action:yn.PUBLISH,remote_participant_id:E.token.participantID})}}class ir extends $n{constructor(E){var A,O,j,H;super(xn.SUBSCRIBE,E.token,E.traceId,!1),Object.assign(this.properties,{action:yn.SUBSCRIBE,remote_participant_id:E.subscribedId,subscribed_id:E.subscribedId,is_edp_connected:E.isEdpConnected,is_reassignment:E.isReassignment,node:(O=(A=E.preAttemptSfuResource)===null||A===void 0?void 0:A.node)!==null&&O!==void 0?O:"",cluster:(H=(j=E.preAttemptSfuResource)===null||j===void 0?void 0:j.cluster)!==null&&H!==void 0?H:""})}}class Oa extends $n{constructor(E){super(xn.UNSUBSCRIBE,E.token,E.traceId,!0),Object.assign(this.properties,{action:yn.SUBSCRIBE,remote_participant_id:E.unsubscribedId,unsubscribed_id:E.unsubscribedId})}}class Lr extends $n{constructor(E){var A,O,j,H;super(xn.PUBLISH_STARTED,E.token,E.traceId,!1),Object.assign(this.properties,{action:yn.PUBLISH,options_duration:E.optionsDuration,post_duration:E.postDuration,remote_participant_id:E.token.participantID,time_to_candidate:E.timeToCandidate,total_duration:E.totalDuration,edp_initial_connect_duration:E.edpInitialConnectDuration,edp_initial_connect_retry_times:E.edpInitialConnectRetries,edp_initial_state_duration:E.edpInitialStateDuration,edp_state_update_count:E.edpStateUpdateCount,sdp_exchange_duration:E.sdpExchangeDuration,sdp_exchange_transport:E.sdpExchangeTransport,set_remote_desc_duration:E.setRemoteDescDuration,peer_connection_duration:E.peerConnectionDuration,node:(O=(A=E.sfuResource)===null||A===void 0?void 0:A.node)!==null&&O!==void 0?O:"",cluster:(H=(j=E.sfuResource)===null||j===void 0?void 0:j.cluster)!==null&&H!==void 0?H:"",publish_retry_times:E.publishRetries,total_duration_with_retries:E.totalDurationWithRetries,protocol:E.protocol})}}class Wl extends $n{constructor(E){super(xn.PUBLISH_FAILED,E.token,E.traceId,!1),Object.assign(this.properties,{action:yn.PUBLISH,code:E.code,message:E.message,fatal:E.fatal,nominal:E.nominal,protocol:E.protocol})}}class Xr extends $n{constructor(E){super(xn.PUBLISH_ENDED,E.token,E.traceId,!0),Object.assign(this.properties,{action:yn.PUBLISH,remote_participant_id:E.token.participantID,unpublish_successful:E.isUnpublishSuccessful,reason:E.reason,protocol:E.protocol})}}class Ky extends $n{constructor(E){var A,O,j,H;super(xn.SUBSCRIBE_STARTED,E.token,E.traceId,!1),Object.assign(this.properties,{action:yn.SUBSCRIBE,options_duration:E.optionsDuration,post_duration:E.postDuration,remote_participant_id:E.remoteParticipantId,time_to_candidate:E.timeToCandidate,total_duration:E.totalDuration,edp_initial_connect_duration:E.edpInitialConnectDuration,edp_initial_connect_retry_times:E.edpInitialConnectRetries,edp_initial_state_duration:E.edpInitialStateDuration,edp_initial_state_publishing_count:E.edpInitialStatePublishingCount,edp_state_update_count:E.edpStateUpdateCount,sdp_exchange_duration:E.sdpExchangeDuration,sdp_exchange_transport:E.sdpExchangeTransport,set_remote_desc_duration:E.setRemoteDescDuration,peer_connection_duration:E.peerConnectionDuration,node:(O=(A=E.sfuResource)===null||A===void 0?void 0:A.node)!==null&&O!==void 0?O:"",cluster:(H=(j=E.sfuResource)===null||j===void 0?void 0:j.cluster)!==null&&H!==void 0?H:"",total_duration_with_retries:E.totalDurationWithRetries,subscribe_retry_times:E.subscribeRetryTimes,is_reassignment:E.isReassignment,protocol:E.protocol})}}class El extends $n{constructor(E){super(xn.SUBSCRIBE_FAILED,E.token,E.traceId,!1),Object.assign(this.properties,{action:yn.SUBSCRIBE,remote_participant_id:E.remoteParticipantId,code:E.code,message:E.message,fatal:E.fatal,nominal:E.nominal,is_reassignment:E.isReassignment,protocol:E.protocol})}}class ph extends $n{constructor(E){super(xn.SUBSCRIBE_ENDED,E.token,E.traceId,!0),Object.assign(this.properties,{action:yn.SUBSCRIBE,remote_participant_id:E.remoteParticipantId,unsubscribe_successful:E.isUnsubscribeSuccessful,reason:E.reason,protocol:E.protocol}),this.critical=!0}}class Xy extends $n{constructor(E){super(xn.STATE_UPDATED,E.token,E.traceId,!1),Object.assign(this.properties,{audio_muted:E.isAudioMuted,is_disconnected:E.isDisconnected,is_publishing:E.isPublishing,other_participant_id:E.otherParticipantId,other_participant_user_id:E.otherParticipantUserId,video_stopped:E.isVideoStopped})}}class rv extends $n{constructor(E){var A,O,j,H,X;super(xn.FIRST_FRAME,E.token,E.traceId,!1),Object.assign(this.properties,{action:yn.SUBSCRIBE,remote_participant_id:E.remoteParticipantId,edp_initial_connect_duration:E.edpInitialConnectDuration,edp_initial_connect_retry_times:E.edpInitialConnectRetries,edp_initial_state_duration:E.edpInitialStateDuration,edp_initial_state_publishing_count:E.edpInitialStatePublishingCount,edp_state_update_count:E.edpStateUpdateCount,sdp_exchange_duration:E.sdpExchangeDuration,sdp_exchange_transport:E.sdpExchangeTransport,set_remote_desc_duration:E.setRemoteDescDuration,peer_connection_duration:E.peerConnectionDuration,node:(O=(A=E.sfuResource)===null||A===void 0?void 0:A.node)!==null&&O!==void 0?O:"",cluster:(H=(j=E.sfuResource)===null||j===void 0?void 0:j.cluster)!==null&&H!==void 0?H:"",video_was_paused:E.videoWasPaused,first_frame_duration:E.firstFrameDuration,total_duration_with_retries:E.totalDurationWithRetries,subscribe_retry_times:E.subscribeRetryTimes,media_type:E.mediaType,configured_jitter_buffer_min_delay_ms:(X=E.currentJitterBufferMinDelayInMs)!==null&&X!==void 0?X:0,protocol:E.protocol})}}class om extends $n{constructor(E){super(xn.EDP_PONG,E.token,E.traceId,!1),Object.assign(this.properties,{event_endpoint:E.eventEndpoint,protocol:E.protocol,edp_rtt:E.edpRttMs})}}class Zy extends $n{constructor(E){super(xn.JOIN,E.token,E.traceId,!1),Object.assign(this.properties,{action:yn.JOIN,event_endpoint:E.eventEndpoint,whip_endpoint:E.whipEndpoint})}}class am extends $n{constructor(E){super(xn.JOIN_ATTEMPT,E.token,E.traceId,!1),Object.assign(this.properties,{action:yn.JOIN,event_endpoint:E.eventEndpoint,whip_endpoint:E.whipEndpoint})}}class lg extends $n{constructor(E){super(xn.JOIN_ATTEMPT_FAILED,E.token,E.traceId,!1),Object.assign(this.properties,{action:yn.JOIN,event_endpoint:E.eventEndpoint,whip_endpoint:E.whipEndpoint,code:E.code,message:E.message,fatal:E.fatal,nominal:E.nominal,connect_retry_times:E.retryCnt})}}class cm extends $n{constructor(E){super(xn.EDP_DISCONNECTED,E.token,E.traceId,!1),Object.assign(this.properties,{event_endpoint:E.eventEndpoint,protocol:E.protocol}),this.critical=!0}}class ug extends $n{constructor(E){super(xn.EDP_CONNECTED,E.token,E.traceId,!1),Object.assign(this.properties,{event_endpoint:E.eventEndpoint,protocol:E.protocol,connect_retry_times:E.numRetries}),this.critical=!0}}class Jy{constructor(E,A,O){this.token=E,this.analyticsTracker=O,this.protocol="",this.connecting=!1,this.closing=!1,this.windowUnloading=!1,this.maxConnectRetries=6,this.connectionAttempts=0,this.latestSequenceNumber=0,this.nextConnectionAttemptId=0,this.connectTimeoutId=0,this.latestPingTimestamp=0,this.pingIntervalId=0,this.pongTimeoutId=0,this.pingIntervalMs=15e3,this.pongTimeoutMs=3e4,this.attemptConnect=re=>{this.latestSequenceNumber=0,this.traceId=re||oa(),this.connectionAttempts++,this.trackJoinAttempt(this.connectionAttempts);const{topic:se,rawToken:ee}=this.token;this.connecting=!0,this.closing=!1;try{const he=encodeURIComponent(this.traceId.value),Ee=`topic=${se}/publishers`,Ce=`traceid=${he}`,Ye="error_over_ws=1",gt=`${this.addr}?${Ye}&${Ee}&${Ce}`;this.socket=this.createWebSocket(gt,ee),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onopen=this.onOpen.bind(this),this.protocol=this.socket.protocol}catch(he){const Ee=he instanceof Error?he.message:void 0,Ce=this.createError($t.EVENT_PLANE_WS_CREATE_FAILED,Ee);this.trackJoinFailed(Ce,this.getRetryCount()),this.emitter.emit(yl,Ce)}},this.triggerSocketOpen=re=>{this.clearConnectionAttemptTimeouts();const se=this.getRetryCount();this.connectionAttempts=0,this.connecting=!1,this.trackJoinStarted(se),this.emitter.emit(Zp,{retryCnt:se,traceId:this.traceId,initialStageState:re}),this.pingIntervalId=window.setInterval(this.ping,this.pingIntervalMs)},this.ping=()=>{var re;if(this.logger.debug({msg:`${this.id}sending PING`}),!this.isSocketOpen()){const se=`${this.id} attempting to ping an unopened socket`;return this.logger.warn({msg:se}),void this.traceJoinOp(se)}this.latestPingTimestamp=performance.now(),this.pongTimeoutId===0&&(this.pongTimeoutId=window.setTimeout(this.pongTimedOut,this.pongTimeoutMs)),(re=this.socket)===null||re===void 0||re.send(JSON.stringify({type:"PING"}))},this.pongTimedOut=()=>{if(!this.isSocketOpen()){const se=`${this.id} attempting pong timeout on an unopened socket`;return this.logger.warn({msg:se}),void this.traceJoinOp(se)}this.logger.debug({msg:`${this.id} Pong timed out!`}),this.clearPingPongTracking();const re=this.createError($t.EVENT_PLANE_PONG_TIMEOUT);this.emitter.emit(yl,re)},this.beforeUnload=()=>{this.emitter.emit(Kf,"beforeunload"),this.windowUnloading=!0},this.sendSdpOffer=(re,se,ee,he,Ee,Ce,Ye,gt)=>{var ft;const lt={type:"aws:ivs:SDP_OFFER",payload:{whipUrl:se,requestId:he,traceId:ee,platform:"web",sdk:"1.31.1",whipVersion:bl,content:re,contentType:"application/sdp"}};Ee&&(lt.payload.forceNode=Ee),Ce&&(lt.payload.assignmentToken=Ce),Ye&&(lt.payload.multiCodec=Ye);const et=wa()===void 0,ot=wa()||et;gt&&ot&&(lt.payload.initialLayerPref=cS(gt)),(ft=this.socket)===null||ft===void 0||ft.send(JSON.stringify(lt))},this.checkNonFatalRetriesLimit=re=>{if(re.fatal||this.connectionAttempts<=this.maxConnectRetries)return pn.ok(!0);this.logger.debug({msg:`${this.id} maximum non-fatal retries of ${this.maxConnectRetries} exceeded`});const se=this.createError($t.JOIN_TIMED_OUT);return pn.err(se)},this.getRetryCount=()=>Math.max(this.connectionAttempts-1,0),this.trackSocketError=re=>{this.connecting&&this.trackJoinFailed(re,this.getRetryCount()),this.analyticsTracker.trackError(re)},this.trackJoinEnded=()=>{this.analyticsTracker.trackEventNoSharedProps(new cm({token:this.token,eventEndpoint:this.token.eventsURL,traceId:this.traceId,protocol:this.protocol}))},this.traceJoinOp=re=>{this.analyticsTracker.trackEventNoSharedProps(new Xf(this.token,this.traceId,re,yn.JOIN))},this.logger=new Gs(A,le.SOCKET),this.emitter=new bs.EventEmitter,this.traceId=oa(),this.id=`[${Hd().value}] `;const j=Dd("socketPingMs");j!==void 0&&(this.pingIntervalMs=j);const H=Dd("socketPongMs");H!==void 0&&(this.pongTimeoutMs=H);const X=Dd("socketConnectMaxRetries");X!==void 0&&(this.maxConnectRetries=X),window.addEventListener("beforeunload",this.beforeUnload)}connect(E,A,O=!1){this.close(),this.logger.debug({msg:`${this.id}connecting to ${this.addr}`}),this.addr=E,this.traceId=A,O&&!this.connecting&&(window.clearTimeout(this.connectTimeoutId),this.connectTimeoutId=window.setTimeout(this.connectTimedOut.bind(this),12e3)),this.attemptConnect(A)}send(E){var A;this.logger.debug({msg:`${this.id}sending ${JSON.stringify(E)}`}),this.logger.debug({msg:`${this.id}isReady called`}),this.isSocketOpen()?(A=this.socket)===null||A===void 0||A.send(JSON.stringify(E)):this.logger.warn({msg:"Trying to send data over stage socket that is not ready"})}close(){this.logger.debug({msg:`${this.id}closing`});const E=this.connecting,A=this.isSocketOpen(),O=this.socket&&this.socket.readyState===this.socket.CLOSING,j=this.getRetryCount();if(this.markSocketAsClosed(),this.clearPingPongTracking(),this.clearConnectionAttemptTimeouts(),this.connectionAttempts=0,this.socket){if(this.cleanupWebSocket(),A&&this.isStateMessageReceived())this.trackJoinEnded(),this.emitter.emit(Kf,"intentional-close");else if(E&&!O){const H=this.createError($t.OPERATION_ABORTED);this.trackJoinFailed(H,j),this.analyticsTracker.trackError(H),this.emitter.emit(yl,H)}}}markSocketAsClosed(){this.closing=!0,this.connecting=!1}removeAllListeners(){window.removeEventListener("beforeunload",this.beforeUnload),this.emitter.removeAllListeners()}createWebSocket(E,A){return new WebSocket(E,A)}cleanupWebSocket(){this.socket&&(this.socket.close(),this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.onopen=null,this.socket=void 0)}createError(E,A){return new hr(Object.assign({action:yn.JOIN,traceId:this.traceId,token:this.token,location:"StageSocket.connection",tag:aa,details:A},E))}on(E,A){this.emitter.on(E,A)}off(E,A){this.emitter.off(E,A)}onMessage(E){this.logger.debug({msg:`${this.id}received message: ${E.data}`});try{const A=JSON.parse(E.data);switch(A.type){case"STAGE_STATE":case"aws:ivs:STAGE_STATE":{const O=A.payload.sequenceNumber;O>this.latestSequenceNumber&&(this.latestSequenceNumber===0&&this.connectTimeoutId>0?(this.triggerSocketOpen(A),window.setTimeout((()=>{this.emitter.emit(Vc,A)}))):this.emitter.emit(Vc,A),this.latestSequenceNumber=O);break}case"PONG":window.clearTimeout(this.pongTimeoutId),this.pongTimeoutId=0,this.analyticsTracker.trackEventNoSharedProps(new om({token:this.token,eventEndpoint:this.token.eventsURL,protocol:this.protocol,traceId:this.traceId,edpRttMs:performance.now()-this.latestPingTimestamp}));break;case"REFRESH":this.emitter.emit(q0);break;case"aws:ivs:SDP_ANSWER":this.emitter.emit(jo,A.payload);break;case"aws:ivs:DISCONNECT":this.emitter.emit(Vl,A.payload);break;case"aws:ivs:REASSIGN":this.emitter.emit(Gc,A.payload);break;case"aws:ivs:INCOMPATIBLE_CODECS":this.emitter.emit(Y0,A.payload);break;case"aws:ivs:SSU":this.emitter.emit(aS,A.payload);break;case"aws:ivs:JOIN_ERROR":this.handleJoinError(A.payload);break;default:(0,Vi.noop)()}}catch(A){this.logger.debug({msg:`onMessage JSON Parse error: ${A}`}),this.emitter.emit(My,A)}}onError(E){this.logger.debug({msg:`${this.id}error: ${JSON.stringify(E)}`})}onClose(E){if(this.logger.debug({msg:`${this.id} onClose triggered with code (closing = ${this.closing}, connecting = ${this.connecting})`}),this.clearPingPongTracking(),this.closing)return void(this.closing=!1);if(this.windowUnloading)return;const A=`code: ${E?.code}, reason: ${E?.reason}, wasClean: ${E?.wasClean}`;if(this.connecting){const j=this.createError($t.EVENT_PLANE_WS_CLOSE_BEFORE_OPEN,A);return void this.handleSocketError(j)}this.logger.debug({msg:`${this.id}unexpected close`}),this.emitter.emit(Kf,"unknown");const O=this.createError($t.EVENT_PLANE_WS_UNEXPECTED_CLOSE,A);this.trackJoinEnded(),this.emitter.emit(yl,O)}onOpen(){this.logger.debug({msg:`${this.id} socket opened`}),this.clearConnectionAttemptTimeouts(),this.connectTimeoutId=window.setTimeout(this.triggerSocketOpen,12e3)}clearConnectionAttemptTimeouts(){window.clearTimeout(this.nextConnectionAttemptId),window.clearTimeout(this.connectTimeoutId),this.nextConnectionAttemptId=0,this.connectTimeoutId=0}clearConnectionAttempts(){this.connectionAttempts=0}connectTimedOut(){this.connecting=!1,this.logger.debug({msg:`${this.id} Connect timed out!`});const E=this.createError($t.JOIN_TIMED_OUT);this.isSocketConnecting()&&this.trackJoinFailed(E,this.getRetryCount()),this.emitter.emit(yl,E),this.close()}clearPingPongTracking(){window.clearInterval(this.pingIntervalId),window.clearTimeout(this.pongTimeoutId),this.pingIntervalId=0,this.pongTimeoutId=0}handleJoinError(E){const A=(function(j){var H,X;let re;switch(j.code){case dc.TOKEN_EXPIRED:re=$t.EXPIRED_TOKEN;break;case dc.TOKEN_INVALID:case dc.TOKEN_INVALID_SIGNATURE:case dc.TOKEN_MISSING:re=$t.MALFORMED_TOKEN;break;case dc.STAGE_DELETED:re=$t.STAGE_DELETED;break;case dc.PARTICIPANT_DISCONNECTED:re=$t.PARTICIPANT_DISCONNECTED;break;case dc.INTERNAL:re=$t.JOIN_SERVER_INTERNAL_ERROR;break;case dc.BAD_REQUEST:re=$t.JOIN_SERVER_BAD_REQUEST;break;default:re=Object.assign(Object.assign({},$t.JOIN_FAILURE),{message:j.message||$t.JOIN_FAILURE.message})}return Object.assign(Object.assign({},re),{fatal:(H=j.fatal)!==null&&H!==void 0?H:re.fatal,nominal:(X=j.nominal)!==null&&X!==void 0?X:re.nominal})})(E),O=this.createError(A,`JOIN_ERROR: ${E.code}`);this.logger.debug({msg:`${this.id} received JOIN_ERROR: ${JSON.stringify(E)}`}),this.handleSocketError(O)}handleSocketError(E){const A=this.checkNonFatalRetriesLimit(E);let O=E;A.ok||(O=A.error,O.details=`Timeout triggered by ${E.code}`),this.trackSocketError(O),this.markSocketAsClosed(),this.clearPingPongTracking(),this.clearConnectionAttemptTimeouts(),this.cleanupWebSocket(),O.fatal?(this.clearConnectionAttempts(),this.emitter.emit(yl,O)):this.queueExponentialBackoffRetry()}queueExponentialBackoffRetry(){let E=Math.pow(2,this.connectionAttempts-1);E>32&&(E=32),this.logger.debug({msg:`${this.id} reconnecting in ${E} seconds`}),window.clearTimeout(this.nextConnectionAttemptId),this.nextConnectionAttemptId=window.setTimeout(this.attemptConnect,1e3*E)}isSocketConnecting(){return this.socket&&this.socket.readyState===this.socket.CONNECTING}isSocketOpen(){return this.socket&&this.socket.readyState===this.socket.OPEN}isStateMessageReceived(){return this.latestSequenceNumber!==0}trackJoinStarted(E){this.analyticsTracker.trackEventNoSharedProps(new ug({token:this.token,eventEndpoint:this.token.eventsURL,numRetries:E,protocol:this.protocol,traceId:this.traceId}))}trackJoinAttempt(E){const{token:A,traceId:O}=this;this.analyticsTracker.trackEvent(new am({token:A,eventEndpoint:A?.eventsURL||"",whipEndpoint:A?.whipURL||"",traceId:O}))}trackJoinFailed(E,A){const{token:O,traceId:j,code:H,message:X,fatal:re,nominal:se}=E;this.analyticsTracker.trackEvent(new lg({token:O,eventEndpoint:O.eventsURL,whipEndpoint:O.whipURL,traceId:j,code:H,message:X,fatal:re,nominal:se,retryCnt:A}))}}var xs=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))},Ws,co,yc,Xi;(function(C){C.SDP_EXCHANGE="xdp",C.JITTER_BUFFER_MIN_DELAY_MS="jit_buf_min_delay_ms"})(Ws||(Ws={})),(function(C){C.USER_INITIATED="user-initiated",C.CLIENT_RECONNECT="reconnect",C.TOKEN_REUSED="token-reused",C.UNKNOWN="unknown",C.PARTICIPANT_DISCONNECTED="participant-disconnected",C.STAGE_DELETED="stage-deleted",C.TOKEN_EXPIRED="token-expired"})(co||(co={})),(function(C){C[C.NOT_CONNECTED=0]="NOT_CONNECTED",C[C.CONNECTION_LOST=1]="CONNECTION_LOST",C[C.TIMEDOUT=2]="TIMEDOUT",C[C.ABORTED=3]="ABORTED",C[C.INVALID_MESSAGE=4]="INVALID_MESSAGE",C[C.UNEXPECTED_ERROR=5]="UNEXPECTED_ERROR"})(yc||(yc={})),(function(C){C.DISCONNECTED="disconnected",C.CONNECTING="connecting",C.CONNECTED="connected",C.ERRORED="errored"})(Xi||(Xi={}));class hg extends ea{constructor(E,A,O){super(),this.token=E,this.nonScopedLogger=A,this.analyticsTracker=O,this.participants=new Map,this.disconnected=[],this.state={value:Xi.DISCONNECTED,context:{connectStartTime:0,hasConnected:!1}},this.features={sdpExchange:!1},this.stats=this.resetStats(),this.stageMinutesLogged=0,this.isStagePublishing=!1,this.onConnecting=(j,H)=>{this.logger.debug({msg:"onConnecting",context:j,event:H}),j.connectStartTime=performance.now();const X=H.type==="RECONNECT";X&&this.stageSocket.close();const{eventsURL:re}=this.token;this.emit(Wf,Xi.CONNECTING),this.state.value=Xi.CONNECTING;const se=!X;this.stageSocket.connect(re,this.traceId,se)},this.onConnected=(j,H)=>{this.logger.debug({msg:"onConnected",context:j,event:H}),j.hasConnected=!0,this.emit(nf),this.emit(Wf,Xi.CONNECTED),this.state.value=Xi.CONNECTED},this.onDisconnected=(j,H)=>{this.logger.debug({msg:"onDisconnected",context:j}),this.state.value=Xi.DISCONNECTED,this.stopStageMinuteLoggedInterval(!0),this.stageSocket.close(),j.hasConnected=!1,this.participants=new Map,this.disconnected=[],this.stageSocket.removeAllListeners(),this.resetStats(),this.emit(Wf,Xi.DISCONNECTED,H)},this.onErrored=(j,H)=>{var X;this.logger.error({msg:"Connection failure occurred",err:H.payload.error}),this.emit(Wf,Xi.ERRORED),this.emit(Xp,H.payload.error),this.state.value=Xi.ERRORED;const re=H.payload.error;if(re instanceof hr&&re.fatal&&(!((X=re.details)===null||X===void 0)&&X.includes("JOIN_ERROR"))&&j.hasConnected){const se=this.mapJoinErrorCodeToDisconnectReason(re);this.processStateUpdate({type:"DISCONNECT",reason:se})}else j.hasConnected?this.processStateUpdate({type:"RECONNECT"}):this.stageSocket.close()},this.processStateUpdate=j=>{const H=this.state.value,X=this.state.context;switch(H){case Xi.DISCONNECTED:j.type==="CONNECT"&&this.onConnecting(X,j);break;case Xi.CONNECTING:j.type==="RECONNECT"?this.onConnecting(X,j):j.type==="DISCONNECT"?this.onDisconnected(X,j.reason):j.type==="CONNECT_SUCCESS"?this.onConnected(X,j):j.type==="ERROR"&&this.onErrored(X,j);break;case Xi.CONNECTED:j.type==="RECONNECT"?this.onConnecting(X,j):j.type==="DISCONNECT"?this.onDisconnected(X,j.reason):j.type==="ERROR"&&this.onErrored(X,j);break;case Xi.ERRORED:j.type==="RECONNECT"?this.onConnecting(X,j):j.type==="DISCONNECT"&&this.onDisconnected(X,j.reason)}},this.measureConnect=(j,H)=>{const X=this.stats.edpConnectCount,re=X+1,se=performance.now(),ee=se-H;return Object.assign(this.stats,{edpConnectCount:re,edpConnectDuration:ee}),X===0&&Object.assign(this.stats,{edpInitialStartConnectTime:H,edpInitialFinishConnectTime:se,edpInitialConnectDuration:ee,edpInitialConnectRetries:j}),this.stats},this.measureStateUpdate=j=>{const{edpInitialFinishConnectTime:H}=this.stats,X=this.stats.edpStateUpdateCount,re=X+1;return Object.assign(this.stats,{edpStateUpdateCount:re}),X===0&&Object.assign(this.stats,{edpInitialStateDuration:performance.now()-H,edpInitialStatePublishingCount:j}),this.stats},this.trackMessageParseError=j=>{this.logger.error({msg:"Message Parse Error occurred",err:j.err});const H=new hr({token:j.token,traceId:j.traceId,code:$t.WEBSOCKET_MESSAGE_PARSE_FAILURE.code,tag:j.tag,location:j.location,message:j.message,details:j.err.message});this.analyticsTracker.trackEvent(new fs(H))},this.trackStageSocketMessageParseError=(j,H,X)=>{this.trackMessageParseError({token:j,traceId:H,tag:aa,location:"StageConnection.onMessage",message:$t.WEBSOCKET_MESSAGE_PARSE_FAILURE.message,err:X})},this.trackStageStateMessageParseError=(j,H,X,re)=>{this.trackMessageParseError({token:j,traceId:H,tag:aa,location:"StageConnection.onStageStateMessage",message:re,err:X})},this.onDisconnectMessage=j=>{this.analyticsTracker.trackEventNoSharedProps(new Xf(this.token,this.traceId,`DISCONNECT message received: ${j.code}:${j.reason}`,yn.JOIN));let H=co.UNKNOWN;if(j.code==="PARTICIPANT_DISCONNECTED")H=co.PARTICIPANT_DISCONNECTED;else if(j.code==="STAGE_DELETED")H=co.STAGE_DELETED;else if(j.code==="TOKEN_REUSED"&&(H=co.TOKEN_REUSED,cc("disableTokenReuseMessage")))return void console.warn("Token reuse is detected, but skipping as feature is disabled");console.warn(`Disconnecting client due to: ${j.reason}`),this.processStateUpdate({type:"DISCONNECT",reason:H})},this.onReassignmentMessage=j=>{this.emit(Ry,j)},this.onIncompatibleCodecsMessage=j=>{this.emit(mc,j)},this.onSsuMessage=j=>{var H;const X=window.atob((H=j.A)!==null&&H!==void 0?H:"").trim();X&&X.startsWith("http")?Bo.currentEndpoint=X:this.logger.warn({msg:"SSU Url invalid"})},this.onStageStateMessage=(j,H,X)=>{var re,se;this.logger.debug({msg:"State Stage Message occurred",state:X});const ee=X.payload,he=(re=ee.participants)!==null&&re!==void 0?re:[],Ee=(se=ee.disconnected)!==null&&se!==void 0?se:[],Ce=[],Ye=[];this.measureStateUpdate(he.length),this.enableFeaturesBasedOnServerFeatures(ee.serverFeatures||[]);const gt=(ft,lt)=>{this.analyticsTracker.trackEventNoSharedProps(new Xy({token:j,otherParticipantId:ft.id,otherParticipantUserId:ft.userId,isAudioMuted:ft.audioMuted,isVideoStopped:ft.videoStopped,isPublishing:ft.isPublishing,isDisconnected:lt,traceId:H}))};this.participants.forEach((ft=>{const lt=he.find((et=>et.id===ft.id));if(lt){let et=!0,ot=!1;["isPublishing","id","audioMuted","joinedAt","userId","videoStopped"].forEach((Mt=>{et=et&&lt[Mt.toString()]===ft[Mt.toString()],et||(ft[Mt.toString()]=lt[Mt.toString()],ot=!0)})),Object.keys(ft.attributes).forEach((Mt=>{et=et&&lt.attributes[Mt]===ft.attributes[Mt],et||(ft.attributes=lt.attributes,ot=!0)})),ot&&(gt(ft,!1),this.emit(yr,lt))}else Ye.push(ft)})),he.forEach((ft=>{this.participants.get(ft.id)||Ce.push(ft)})),Ye.forEach((ft=>{this.participants.delete(ft.id),gt(ft,!0),this.emit(Hl,ft)})),Ce.forEach((ft=>{this.participants.set(ft.id,ft),gt(ft,!1),this.emit(V_,ft)})),Ee.forEach((ft=>{this.disconnected.find((lt=>lt.id===ft.id))||(this.disconnected.push(ft),ft.status==="KICKED"&&this.emit(G_,ft))})),this.disconnected=Ee},this.nonScopedLogger=A,this.logger=new Gs(A,le.CONNECTION),this.stageSocket=new Jy(E,this.nonScopedLogger,O),this.token=E,this.traceId=oa()}resetStats(){return this.stats={isConnected:!1,edpInitialStartConnectTime:0,edpInitialFinishConnectTime:0,edpConnectCount:0,edpInitialConnectDuration:0,edpConnectDuration:0,edpInitialStateDuration:0,edpInitialStatePublishingCount:0,edpStateUpdateCount:0,edpInitialConnectRetries:0},this.stats}connect(E){return xs(this,void 0,void 0,(function*(){return this.logger.debug({msg:"connect invoked",token:this.token,traceId:E}),this.traceId=E,this.state.value!==Xi.DISCONNECTED&&(this.logger.debug({msg:"Disconnecting previous connection"}),this.processStateUpdate({type:"DISCONNECT",reason:co.CLIENT_RECONNECT})),new Promise(((A,O)=>{this.stageSocket.on(Zp,(j=>{var H,X;const{retryCnt:re,initialStageState:se}=j;se&&this.enableFeaturesBasedOnServerFeatures((X=(H=se.payload)===null||H===void 0?void 0:H.serverFeatures)!==null&&X!==void 0?X:[]),this.traceId=j.traceId||oa(),this.measureConnect(re,this.state.context.connectStartTime),this.processStateUpdate({type:"CONNECT_SUCCESS"}),this.startStageMinuteLoggedInterval(this.token,this.traceId),A(this.traceId)})),this.stageSocket.on(yl,(j=>{O(j),this.processStateUpdate({type:"ERROR",payload:{error:j}})})),this.stageSocket.on(q0,(()=>{this.logger.debug({msg:"Refresh event occurred"}),this.emit(Ay),this.processStateUpdate({type:"RECONNECT"})})),this.stageSocket.on(Vc,(j=>this.onStageStateMessage(this.token,this.traceId,j))),this.stageSocket.on(My,(j=>this.trackStageSocketMessageParseError(this.token,this.traceId,j))),this.stageSocket.on(Vl,this.onDisconnectMessage),this.stageSocket.on(Gc,this.onReassignmentMessage),this.stageSocket.on(Y0,this.onIncompatibleCodecsMessage),this.stageSocket.on(aS,this.onSsuMessage),this.stageSocket.on(Kf,(j=>{this.stopStageMinuteLoggedInterval()})),this.processStateUpdate({type:"CONNECT",payload:{token:this.token,traceId:E}})}))}))}disconnect(){return this.logger.debug({msg:"disconnect invoked"}),this.processStateUpdate({type:"DISCONNECT",reason:co.USER_INITIATED}),this.traceId}getParticipant(E){return this.participants.get(E)}listConnectedParticipants(){const E=[];return this.participants.forEach((A=>{A.subscribed&&E.push(A)})),E}listAvailableParticipants(){return Array.from(this.participants.values())}emitStageState(E,A){this.stageSocket.send({audioMuted:E,type:"SET_STATE",version:"0",videoStopped:A})}setStagePublishing(E){this.isStagePublishing=E,this.emit(Vd,this.isStagePublishing)}getIsStagePublishing(){return this.isStagePublishing}startStageMinuteLoggedInterval(E,A){this.uploadStageMinutesBroadcastInterval||(this.analyticsTracker.trackEvent(new sm(E,A,this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++,this.uploadStageMinutesBroadcastInterval=setInterval((()=>{this.analyticsTracker.trackEvent(new sm(E,A??oa(),this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++}),6e4))}stopStageMinuteLoggedInterval(E=!1){this.uploadStageMinutesBroadcastInterval&&(clearInterval(this.uploadStageMinutesBroadcastInterval),this.uploadStageMinutesBroadcastInterval=void 0),E&&(this.stageMinutesLogged=0)}enableFeaturesBasedOnServerFeatures(E){const A=(X,re)=>{this.trackStageStateMessageParseError(this.token,this.traceId,re,`Could not parse "${X}" from the Eevee server features list`)},O=E.includes(Ws.SDP_EXCHANGE);this.features.sdpExchange!==O&&(this.logger.debug({msg:`XDP SDP exchange feature toggled: ${O}`}),this.features.sdpExchange=O);const j=E.find((X=>X.indexOf(Ws.JITTER_BUFFER_MIN_DELAY_MS)!==-1)),H=X=>{this.logger.debug({msg:`jitterBufferMinDelay feature updated to: ${X}`}),this.features.jitterBufferMinDelayInMs=X};if(j!==void 0)try{const X=j.split("=")[1],re=parseInt(X,10);if(isNaN(re))throw new Error("Unable to parse - result is NaN");if(re<0)throw new Error("Unable to apply - result is negative");this.features.jitterBufferMinDelayInMs!==void 0&&this.features.jitterBufferMinDelayInMs===re||H(re)}catch(X){A(j,X),H(void 0)}else H(void 0)}mapJoinErrorCodeToDisconnectReason(E){switch(E.code){case $t.PARTICIPANT_DISCONNECTED.code:return co.PARTICIPANT_DISCONNECTED;case $t.STAGE_DELETED.code:return co.STAGE_DELETED;case $t.EXPIRED_TOKEN.code:return co.TOKEN_EXPIRED;default:return co.UNKNOWN}}isConnected(){return this.state.value===Xi.CONNECTED}supportsSdpExchange(){return this.features.sdpExchange}jitterBufferMinDelayInMs(){return this.features.jitterBufferMinDelayInMs}getConnectionStats(){return Object.assign({},this.stats,{isConnected:this.isConnected()})}exchangeSdp(E,A,O,j,H,X,re,se,ee){return xs(this,void 0,void 0,(function*(){return this.isConnected()?new Promise(((he,Ee)=>{const Ce=window.setTimeout((()=>{Ye(),Ee(yc.TIMEDOUT)}),12e3),Ye=()=>{window.clearTimeout(Ce),this.stageSocket.off(jo,gt),this.stageSocket.off(yl,ft)},gt=lt=>{lt.requestId===j&&(Ye(),he(lt))},ft=()=>{Ye(),Ee(yc.CONNECTION_LOST)};H?.addEventListener("abort",(()=>{Ye(),Ee(yc.ABORTED)})),this.stageSocket.on(jo,gt),this.stageSocket.on(yl,ft),this.stageSocket.sendSdpOffer(E,A,O,j,X,re,se,ee)})):Promise.reject(yc.NOT_CONNECTED)}))}}class fg{constructor(E){this.token=E}}const dg=new RegExp("^(?:[a-z+]+:)?//","i");function Qf(C){return dg.test(C)}function ql({sdpExchangeTransport:C,serverHttpResponse:E,serverErrorCode:A}){return`sdpExchangeTransport: ${C}, serverHttpResponse: ${E}, serverErrorCode: ${A}`}var pg=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};const ed={[yc.ABORTED]:$t.OPERATION_ABORTED,[yc.NOT_CONNECTED]:$t.EVENT_PLANE_WS_UNEXPECTED_CLOSE,[yc.CONNECTION_LOST]:$t.XDP_CONNECTION_LOST,[yc.TIMEDOUT]:$t.XDP_TIMEOUT,[yc.INVALID_MESSAGE]:$t.XDP_INVALID_ANSWER_MSG,[yc.UNEXPECTED_ERROR]:$t.XDP_UNEXPECTED_ERROR};class Qy extends fg{constructor(E,A,O,j){super(E),this.token=E,this.stageConnection=A,this.contextData=O,this.analyticsTracker=j}exchange(E){return pg(this,void 0,void 0,(function*(){const A=Hd(),{action:O}=this.contextData,{sdpOffer:j,url:H,traceId:X,forceNode:re,assignmentToken:se,multiCodec:ee,abortController:he,initialLayerPreference:Ee}=E;let Ce;this.trackAttempt(H,A,X);try{Ce=yield this.stageConnection.exchangeSdp(j,H,X.value,A.value,he?.signal,re,se,ee,Ee)}catch(gn){if(typeof gn=="number")throw this.createClientSideErrorFromReasonCode(gn,X,A,O)}if(!Ce)return;const{httpStatusCode:Ye,errorCode:gt,location:ft,content:lt,sessionDeleteLink:et,subscriberControlLink:ot,videoLayersLink:Mt}=Ce;if(Ye>=200&&Ye<300)return{sdpAnswer:lt,url:H,location:ft,sessionDeleteLink:et,mediaControls:ot,layerControls:Mt};throw this.createServerSideError(X,A,Ye,gt,O)}))}trackAttempt(E,A,O){const{remoteParticipantId:j,action:H}=this.contextData;this.analyticsTracker.trackEventNoSharedProps(new Iy(H,this.token,E,"POST",A.value,j,O,"xdp"))}createServerSideError(E,A,O,j,H){const X=this.baseErrorProps(E,A);let re=Kp(O,j);return re||(re=$t.UNKNOWN_SERVER_ERROR),new hr(Object.assign(Object.assign(Object.assign({action:H},X),re),{details:ql({sdpExchangeTransport:"xdp",serverHttpResponse:O,serverErrorCode:j})}))}baseErrorProps(E,A){const{remoteParticipantId:O,action:j}=this.contextData;return{token:this.token,traceId:E,tag:ms(j,O),location:"EdpSdpExchanger.exchange",requestUUID:A,remoteParticipantId:O}}createClientSideErrorFromReasonCode(E,A,O,j){const H=this.baseErrorProps(A,O),X=ed[E];return new hr(X?Object.assign(Object.assign({action:j},H),X):Object.assign(Object.assign({action:j},H),$t.XDP_INVALID_ANSWER_MSG))}getTransport(){return"sdp"}}var lm=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};class iv extends fg{constructor(E,A,O){super(E),this.contextData=A,this.analyticsTracker=O}exchange(E){var A,O,j;return lm(this,void 0,void 0,(function*(){const H=Hd(),{token:X}=this,{action:re,remoteParticipantId:se}=this.contextData,{sdpOffer:ee,url:he,traceId:Ee,forceNode:Ce,assignmentToken:Ye,multiCodec:gt,abortController:ft,initialLayerPreference:lt}=E;try{const ot="POST",Mt="http";this.analyticsTracker.trackEventNoSharedProps(new Iy(re,X,he,ot,H.value,se,Ee,Mt));const gn={data:ee,headers:{Authorization:`Bearer ${X.rawToken}`,"Content-Type":"application/sdp","X-Stages-Platform":"web","X-Stages-Request-ID":H.value,"X-Stages-SDK":"1.31.1","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":Ee.value,"X-Stages-WHIP-Version":bl,[sS]:(et=JSON.stringify({[oS]:["sau"]}),btoa(et).replace(/[^A-Za-z0-9+/]/g,""))},method:ot,responseType:"text",url:he,signal:ft?.signal,params:{}};Ce&&(gn.params.force_node=Ce),Ye&&(gn.params.assignment_token=Ye),gt&&(gn.params.multi_codec=!0);const Bn=wa()===void 0,Wn=wa()||Bn;lt&&gn.headers&&Wn&&(gn.headers["X-Stages-Initial-Layer-Pref"]=cS(lt));const{data:ar,headers:br,request:kr}=yield C0(gn),mr=this.parseWhipResource(he,br.location,br.link);return{url:kr.responseURL,sdpAnswer:ar,location:mr?.location,sessionDeleteLink:mr?.sessionDeleteLink,mediaControls:mr?.mediaControls,layerControls:mr?.layerControls}}catch(ot){if(Lf().isCancel(ot))throw new hr(Object.assign(Object.assign({},sh($t.OPERATION_ABORTED,ot)),{action:re,token:X,traceId:Ee,tag:ms(re,se),location:"StagePeerClient.start",requestUUID:H,remoteParticipantId:se}));const Mt=Number((A=ot?.response)===null||A===void 0?void 0:A.status)||-1,gn=((j=(O=ot?.response)===null||O===void 0?void 0:O.data)===null||j===void 0?void 0:j.code)||-1,Bn=(function(Wn,ar){var br;return Wn instanceof lc.AxiosError&&Wn.response&&typeof Wn.response.status=="number"?Wn instanceof lc.AxiosError&&Wn.code==="ERR_NETWORK"?$t.NETWORK_FAILURE:Kp(Number(Wn.response.status),(br=Wn.response.data)===null||br===void 0?void 0:br.code)||ar:ar})(ot,$t.WHIP_POST_FAILURE);throw new hr(Object.assign(Object.assign({},sh(Bn,ot)),{action:re,token:X,traceId:Ee,tag:ms(re,se),details:ql({sdpExchangeTransport:"http",serverHttpResponse:Mt,serverErrorCode:gn}),location:"StagePeerClient.start",requestUUID:H,remoteParticipantId:se}))}var et}))}parseWhipResource(E,A,O){const j=new URL(E);let H;return H=(function(X,re,se){if(!se)return X;if(X||(X={}),Qf(se))return X.location=se,X;const ee=re.port?`:${re.port}`:"";return X.location=`${re.protocol}//${re.hostname}${ee}${se}`,X})(H,j,A),H=(function(X,re,se){if(!se)return X;X||(X={});const ee=X;return se.split(",").forEach((he=>{const Ee=/<(.+)>;\s?rel="([a-z:-]+)"/.exec(he);if(Ee?.length!==3)return;let Ce;if(Qf(Ee[1]))Ce=Ee[1];else{const Ye=re.port?`:${re.port}`:"";Ce=`${re.protocol}//${re.hostname}${Ye}${Ee[1]}`}switch(Ee[2]){case"urn:ietf:params:whip:ivs-stages:session-delete":ee.sessionDeleteLink=Ce;break;case"urn:ietf:params:whep:core:playback-controls":ee.mediaControls=Ce;break;case"urn:ietf:params:whep:ext:core:layer":ee.layerControls=Ce;break;default:return}})),ee})(H,j,O),H}getTransport(){return"http"}}function Yl(C){const{connection:E,token:A,action:O,identifier:j,tracker:H}=C,X=E&&E.supportsSdpExchange()&&E.isConnected(),re=O===yn.SUBSCRIBE&&X&&!T_()&&!cc("disableXdpSubscribe"),se=O===yn.PUBLISH&&X&&!T_()&&!cc("disableXdpPublish");return re||se?new Qy(A,E,{action:O,remoteParticipantId:j},H):new iv(A,{action:O,remoteParticipantId:j},H)}function Kl({stageErrorValue:C,action:E,token:A,traceId:O,tag:j,identifier:H,details:X}){return new hr(Object.assign(Object.assign({},C),{token:A,traceId:O,location:"peer-client",tag:j,action:E,remoteParticipantId:H,details:X}))}var vi;function af(C){var E;return!((E=C?.sender)===null||E===void 0)&&E.createEncodedStreams?vi.INSERTABLE_STREAMS:window.RTCRtpSender&&"transform"in RTCRtpSender.prototype&&window.RTCRtpScriptTransform?vi.ENCODED_TRANSFORMS:vi.NONE}function Fr(C){var E;return!((E=C?.receiver)===null||E===void 0)&&E.createEncodedStreams?vi.INSERTABLE_STREAMS:window.RTCRtpReceiver&&"transform"in RTCRtpReceiver.prototype&&window.RTCRtpScriptTransform?vi.ENCODED_TRANSFORMS:vi.NONE}function Bi(){return iS()(`/*! For license information please see transform.worker.worker.js.LICENSE.txt */
(()=>{"use strict";const e=new Uint8Array([158,80,78,165,238,90,79,2,148,159,176,51,163,118,141,162]);var t;!function(e){e.VIDEO_SEND="video/send",e.VIDEO_RECEIVE="video/receive",e.INSERT_SEI="insertSei"}(t||(t={}));function n(t,n){const{transformerId:s,type:r,payloads:a}=n;let o=[];if("sei"===n.type){const{value:n,messages:s}=function(t,n){function s(e,t,n){return n+t.length<=e.byteLength&&t.every(((t,s)=>e.getUint8(n+s)===t))}function r(e,t){const n=function(e,t){return new Uint8Array([0,0,1,6,5,...t,...e])}(e,function(e){const t=[];for(;e>=255;)t.push(255),e-=255;return t.push(e),new Uint8Array(t)}(t.length+e.length)),s=function(e){const t=[...e];let n=3;for(;n<t.length-2;)0!==t[n]||0!==t[n+1]||0!==t[n+2]&&1!==t[n+2]&&2!==t[n+2]&&3!==t[n+2]?n+=1:(t.splice(n+2,0,3),n+=3);return t}(new Uint8Array([...n,...t,128]));return new Uint8Array(s)}function a(e,n){const r=function(e){const t=new DataView(e);for(let e=0;e<t.byteLength-4;e++)if(s(t,[0,0,1],e)){const n=31&t.getUint8(e+3);if(n>=1&&n<=5)return e}return-1}(t.data);if(r>=0){const e=new ArrayBuffer(t.data.byteLength+n.byteLength),s=new Uint8Array(e);return s.set(new Uint8Array(t.data.slice(0,r)),0),s.set(n,r),s.set(new Uint8Array(t.data.slice(r)),r+n.byteLength),e}return e}return function(){const s=[];for(let o=0;o<n.length;o+=1){const i=r(e,new Uint8Array(n[o]));t.data=a(t.data,i),s.push({uuid:e,payload:n[o]})}return{value:t,messages:s}}()}(t,a||[]);t=n,o=s}return{success:!0,frame:t,transformerId:s,type:r,seiResult:o}}const s=function(){let e=[];const t=new Map;return{add:({payload:t,repeatCount:n})=>(e.push({payload:t,repeatCount:n}),!0),poll(n){t.has(n)||t.set(n,[]),t.size>0&&(t.forEach((t=>{t.push(...e)})),e=[]);const s=t.get(n)||[],r=s.filter((e=>e.repeatCount>0)).map((e=>Object.assign(Object.assign({},e),{repeatCount:e.repeatCount-1})));return t.set(n,r),s}}}(),r=e=>(t,r)=>{try{const a=t.getMetadata().synchronizationSource,o=(s?s.poll(a):[]).map((e=>e.payload)),i=n(t,Object.assign(Object.assign({},e),{payloads:o}));r.enqueue(i.frame),self.postMessage(Object.assign({success:i.success,seiResult:i.seiResult},e))}catch(t){self.postMessage(Object.assign({success:!1},e))}},a=e=>(t,n)=>{try{const s=function(e,t){const{type:n,transformerId:s}=t;if("sei"===n){const t=function(e){function t(e,t,n){return n+t.length<e.byteLength&&t.every(((t,s)=>e.getUint8(n+s)===t))}function n(e){const t=[];let n=0;for(;n<e.length;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(t.push(e[n]),t.push(e[n+1]),n+=3):(t.push(e[n]),n+=1);return new Uint8Array(t)}function s(e){let t=2;const n=e.byteLength;for(;t<n;){let s=0;for(;t<n&&255===e[t];)s+=255,t++;s+=e[t],t++;const r=Math.min(t+s,n),a=new Uint8Array(e.slice(t,r));return{uuid:a.slice(0,16),payload:a.slice(16)}}}return{messages:function(e){const r=new DataView(e.data),a=[];let o=0;if(!t(r,[0,0,1],0)&&!t(r,[0,0,0,1],0))return[];for(;o<r.byteLength-5;)if(t(r,[0,0,1],o)){const i=o+3;o=i;const c=31&r.getUint8(o),u=31&r.getUint8(o+1);if(6===c&&5===u){for(;o<r.byteLength&&!t(r,[0,0,1],o);)o++;const c=o,u=s(n(new Uint8Array(e.data.slice(i,c))));u&&a.push(Object.assign({},u))}else o++}else o++;return a}(e),frame:e}}(e),{frame:r,messages:a}=t;return{success:!0,frame:r,type:n,transformerId:s,seiResult:a}}return{success:!0,frame:e,transformerId:s,type:n}}(t,e);n.enqueue(s.frame),self.postMessage(Object.assign({success:s.success,seiResult:s.seiResult},e))}catch(t){self.postMessage(Object.assign({success:!1},e))}};function o(e,t,n,s){const o=new TransformStream({transform:"video/send"===e?r(t):a(t)});n.pipeThrough(o).pipeTo(s)}const i=self;i.addEventListener("message",(function(e){var n,r,a;if(!(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.operation)||!(null===(r=null==e?void 0:e.data)||void 0===r?void 0:r.transformerId))return;const{operation:i,transformerId:c}=e.data;switch(i){case t.VIDEO_SEND:case t.VIDEO_RECEIVE:o(i,{method:i,transformerId:c,type:"sei"},e.data.readable,e.data.writable);break;case t.INSERT_SEI:s.add({payload:e.data.payload,repeatCount:null!==(a=e.data.repeatCount)&&void 0!==a?a:0})}})),i.addEventListener("rtctransform",(function(e){const t=e.transformer;if(!t)return;o(t.options.method,t.options,t.readable,t.writable)}))})();`,"Worker",void 0,void 0)}(function(C){C.NONE="none",C.ENCODED_TRANSFORMS="encodedTransforms",C.INSERTABLE_STREAMS="insertableStreams"})(vi||(vi={}));const gs=(()=>{const C={};return{getWorker:E=>(C[E]||(C[E]=new Bi),C[E]),destroy:E=>{var A;(A=C[E])===null||A===void 0||A.terminate(),C[E]=void 0}}})();var ha;(function(C){C.NOT_PUBLISHING_VIDEO="NOT_PUBLISHING_VIDEO",C.INBAND_MESSAGING_NOT_ENABLED="INBAND_MESSAGING_NOT_ENABLED",C.INVALID_REPEAT_COUNT="INVALID_REPEAT_COUNT",C.PAYLOAD_SIZE_INVALID="PAYLOAD_SIZE_INVALID",C.PAYLOAD_RATE_EXCEEDED="PAYLOAD_RATE_EXCEEDED",C.INVALID_TRACK_TYPE="INVALID_TRACK_TYPE"})(ha||(ha={}));class td{constructor(E){this.maxFramerate=E,this.queued=[]}validateMessagePayload(E,A){if(E.byteLength<=0)return pn.err(ha.PAYLOAD_SIZE_INVALID);if(A<0||A>30)return pn.err(ha.INVALID_REPEAT_COUNT);if(E.byteLength>1024)return pn.err(ha.PAYLOAD_SIZE_INVALID);this.queued=this.trimPastPayloads(this.queued,1e3);const{before:O,after:j}=this.getPayloadSums(this.queued);if(O+E.byteLength>10240||j+E.byteLength*Math.max(1,A)>10240)return pn.err(ha.PAYLOAD_RATE_EXCEEDED);if(this.queued.push({byteLength:E.byteLength,timestamp:Date.now()}),A>0){const H=1e3/this.maxFramerate;let X=Date.now()+H;for(let re=0;re<A;re+=1)this.queued.push({byteLength:E.byteLength,timestamp:X}),X+=H}return pn.ok(!0)}trimPastPayloads(E,A){const O=Date.now()-A;return E.filter((j=>j.timestamp>O))}getPayloadSums(E){const A=Date.now();return E.reduce(((O,j)=>{const{before:H,after:X}=O;return j.timestamp<=A?{before:H+j.byteLength,after:X}:{before:H,after:X+j.byteLength}}),{before:0,after:0})}}const nd="seiMessageReceived",mg="error";var Ni;(function(C){C.CREATED="created",C.INITIALIZED="initialized",C.DESTROYED="destroyed"})(Ni||(Ni={}));class cf extends ea{constructor(E){super(),this.sessionId=E,this.state=Ni.CREATED,this.transformerId=Hd().value,this.prevResultWasError=!1,this.consecutiveErrorResults=0,this.seiReadCnt=0,this.seiBytesRead=0,this.onMessage=A=>{this.onTransformResult(A.data)}}initializeInsertableStreams(E){var A,O;this.worker=gs.getWorker(this.sessionId);const j=E.receiver.createEncodedStreams(),{readable:H,writable:X}=j;(A=this.worker)===null||A===void 0||A.postMessage({operation:"video/receive",transformerId:this.transformerId,readable:H,writable:X},[H,X]),(O=this.worker)===null||O===void 0||O.addEventListener("message",this.onMessage)}initializeEncodedTransforms(E){var A;this.worker=gs.getWorker(this.sessionId);const O={method:"video/receive",type:"sei",transformerId:this.transformerId};E.receiver.transform=new RTCRtpScriptTransform(this.worker,O),(A=this.worker)===null||A===void 0||A.addEventListener("message",this.onMessage)}initialize(E,A){if(this.state!==Ni.CREATED)return!1;const O=Fr(E);if(O===vi.NONE)return!1;if(A&&O===vi.INSERTABLE_STREAMS)this.initializeInsertableStreams(E);else{if(A||O!==vi.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(E)}return this.transceiver=E,this.state=Ni.INITIALIZED,!0}onTransceiverAdd(E){return this.initialize(E,!0)}onTrackEvent(E){return E.track.kind==="video"&&this.initialize(E.transceiver,!1)}static isSupported(E){return Fr(E)!==vi.NONE}onTransformResult(E){return E.transformerId===this.transformerId&&(E.success?(this.prevResultWasError=!1,this.consecutiveErrorResults=0,!!E.seiResult&&(E.seiResult.forEach((A=>{const{payload:O,uuid:j}=A;this.updateReadStats(A),this.emit(nd,{uuid:j,payload:O})})),E.seiResult.length>0)):(this.prevResultWasError&&this.consecutiveErrorResults++,this.consecutiveErrorResults>=300&&this.onError(E,$t.TRANSFORM_TOO_MANY_ERRORS),this.prevResultWasError=!0,this.onError(E,$t.TRANSFORM_UNEXPECTED_ERROR),!1))}updateReadStats(E){this.seiReadCnt++,this.seiBytesRead+=E.payload.byteLength}getReceiverStats(){const{seiBytesRead:E,seiReadCnt:A}=this;return{seiReadCnt:A,seiBytesRead:E}}onError(E,A){const{type:O}=E;this.emit(mg,{type:O,stageErrorValue:A})}destroy(){var E,A;this.state!==Ni.DESTROYED&&(this.removeAllListeners(),(E=this.worker)===null||E===void 0||E.removeEventListener("message",this.onMessage),!((A=this.transceiver)===null||A===void 0)&&A.receiver&&(this.transceiver.receiver.transform=null),this.state=Ni.DESTROYED)}getState(){return this.state}}class SS{constructor(E){this.sessionId=E,this.state=Ni.CREATED,this.transformerId=Hd().value,this.seiWriteCnt=0,this.seiBytesWritten=0,this.onMessage=A=>{this.onTransformResult(A.data)}}initializeInsertableStreams(E,A){var O,j;this.worker=gs.getWorker(this.sessionId);const H=E.sender.createEncodedStreams(),{readable:X,writable:re}=H;(O=this.worker)===null||O===void 0||O.postMessage({operation:"video/send",transformerId:this.transformerId,readable:X,writable:re},[X,re]),(j=this.worker)===null||j===void 0||j.addEventListener("message",this.onMessage)}initializeEncodedTransforms(E,A){var O;this.worker=gs.getWorker(this.sessionId);const j={method:"video/send",type:"sei",transformerId:this.transformerId,encodingLayers:A};E.sender.transform=new RTCRtpScriptTransform(this.worker,j),(O=this.worker)===null||O===void 0||O.addEventListener("message",this.onMessage)}initialize(E){var A;if(this.state!==Ni.CREATED)return!1;const O=af(E);if(O===vi.NONE)return!1;const j=E.sender.getParameters(),H=((A=j?.encodings)===null||A===void 0?void 0:A.length)||1;if(O===vi.INSERTABLE_STREAMS)this.initializeInsertableStreams(E,H);else{if(O!==vi.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(E,H)}return this.transceiver=E,this.state=Ni.INITIALIZED,!0}static isSupported(E){return af(E)!==vi.NONE}sendSeiMessage(E,A){var O;return this.state===Ni.INITIALIZED&&this.transceiver?((O=this.worker)===null||O===void 0||O.postMessage({operation:"insertSei",transformerId:this.transformerId,payload:E,repeatCount:A}),pn.ok(!0)):pn.err(ha.NOT_PUBLISHING_VIDEO)}onTransceiverAdd(E){return this.initialize(E)}onTrackEvent(E){return!1}onTransformResult(E){return E.transformerId===this.transformerId&&(E.success&&this.updateSendStats(E),E.success)}updateSendStats(E){E.seiResult&&E.seiResult.forEach((A=>{this.seiWriteCnt++,this.seiBytesWritten+=A.payload.byteLength}))}getSenderStats(){const{seiBytesWritten:E,seiWriteCnt:A}=this;return{seiWriteCnt:A,seiBytesWritten:E}}destroy(){var E;this.state!==Ni.DESTROYED&&(!((E=this.transceiver)===null||E===void 0)&&E.receiver&&(this.transceiver.receiver.transform=null),this.state=Ni.DESTROYED)}getState(){return this.state}}class e1 extends $n{constructor(E,A,O,j,H,X,re,se,ee){super(xn.SELECTED_PAIR_CHANGE,A,O,!1),Object.assign(this.properties,{action:E,protocol:j,local_type:H,local_addr:X,remote_addr:re,local_candidate_priority:se,remote_participant_id:ee})}}var Fi=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};let xl=null;class lf extends ea{constructor(E,A,O,j,H,X,re,se,ee){var he;if(super(),this.analyticsTracker=X,this.subscribeConfig=ee,this.sfuResource={node:"",cluster:""},this.protocol="",this.incompatibleCodecs=new Set,this.connect=({audioOnly:Ee=!1,traceId:Ce,iceRestartOptions:Ye})=>Fi(this,void 0,void 0,(function*(){const{token:gt,tag:ft,identifier:lt,action:et}=this,ot=!!Ye,Mt=new AbortController;let gn,Bn,Wn;this.abortController=Mt,this.traceId=Ce,this.protocol="",this.perfTracker.resetMeasurements(Ce);const ar=()=>{gn&&this.off(Yu,gn),Bn&&this.off(Bl,Bn)},br=new Promise(((kr,mr)=>{const Or=(function({action:Er,token:jr,traceId:gr,tag:xr,identifier:ri}){const ji=Er===yn.SUBSCRIBE?$t.SUBSCRIBE_TIMED_OUT:$t.PUBLISH_TIMED_OUT;return new hr(Object.assign(Object.assign({},ji),{action:Er,token:jr,traceId:gr,tag:xr,location:"connect",remoteParticipantId:ri}))})({action:et,token:gt,traceId:Ce,tag:ft,identifier:lt}),ni=(function({action:Er,token:jr,traceId:gr,tag:xr}){const ri=$t.OPERATION_ABORTED;return new hr(Object.assign(Object.assign({},ri),{token:jr,traceId:gr,location:"peer-client.connect",tag:xr,action:Er}))})({action:et,token:gt,traceId:Ce,tag:ft}),ei=setTimeout((()=>{this.stop(),this.analyticsTracker.trackError(Or),mr(Or)}),1e4);gn=Er=>{clearTimeout(ei),ot||this.stop(),mr(Er)},Bn=Er=>{if(Er===Zn.CONNECTED)clearTimeout(ei),kr();else if(Er===Zn.FAILED){const jr=(function({action:gr,token:xr,traceId:ri,tag:ji}){return new hr(Object.assign(Object.assign({},$t.PEER_CONNECTION_NETWORK_FAILURE),{token:xr,traceId:ri,location:"peer-client.connect",tag:ji,action:gr}))})({action:et,token:gt,traceId:Ce,tag:ft});clearTimeout(ei),mr(jr)}},this.on(Yu,gn),this.on(Bl,Bn),Wn=()=>{clearTimeout(ei)},Mt.signal.aborted&&(clearTimeout(ei),mr(ni)),Mt.signal.addEventListener("abort",(()=>{clearTimeout(ei),mr(ni)}))}));try{const kr=yield Promise.all([Fi(this,void 0,void 0,(function*(){ot||(yield this.start(),this.mediaStream=yield this.initializePeerConnection(Ee));const Or=Ye?.assignmentToken,ni=Ye?.nodeOverride;return yield this.exchangeSdp({iceRestart:ot,nodeOverride:ni,assignmentToken:Or,abortController:Mt}),this.mediaStream})),br]);this.statsReporter.traceId=Ce;const mr=kr[0];if(this.abortController=void 0,!ot&&et===yn.PUBLISH)try{yield this.verifyOrUpdateTransceiverSync()}catch(Or){this.logger.error({err:Or,msg:"error syncing transceivers"})}return{mediaStream:mr}}catch(kr){throw Wn&&Wn(),kr}finally{ar()}})),this.disconnect=(Ee=!1)=>Fi(this,void 0,void 0,(function*(){var Ce;const{token:Ye,action:gt}=this;(Ce=this.abortController)===null||Ce===void 0||Ce.abort(),this.stop(),this.protocol="",Ee?this.cleanup(gt,Ye.participantID,Ye,Ee):yield this.cleanup(gt,Ye.participantID,Ye,Ee)})),this.resetTransformers=()=>{var Ee,Ce;(Ee=this.videoSenderTransformer)===null||Ee===void 0||Ee.destroy(),this.videoSenderTransformer=this.createVideoSenderTransformer(),(Ce=this.videoReceiverTransformer)===null||Ce===void 0||Ce.destroy(),this.videoReceiverTransformer=this.createVideoReceiverTransformer(),this.statsReporter.resetTransformers(this.videoReceiverTransformer,this.videoSenderTransformer)},this.onTrack=Ee=>{var Ce,Ye;const{token:gt,action:ft,traceId:lt,identifier:et}=this;this.trace(gt,lt,`onTrack: ${Ee.track.kind}`,ft,et),this.sendInBandMessagingEnabled&&((Ce=this.videoSenderTransformer)===null||Ce===void 0||Ce.onTrackEvent(Ee)),this.receiveInBandMessagingEnabled&&((Ye=this.videoReceiverTransformer)===null||Ye===void 0||Ye.onTrackEvent(Ee))},this.onIceGatheringStateChange=()=>{var Ee,Ce,Ye;const{token:gt,action:ft,traceId:lt,identifier:et}=this;if(((Ee=this.peerConnection)===null||Ee===void 0?void 0:Ee.iceGatheringState)==="gathering"?this.perfTracker.markIceGatheringStart():((Ce=this.peerConnection)===null||Ce===void 0?void 0:Ce.iceGatheringState)==="complete"&&this.perfTracker.markIceGatheringStop(),this.peerConnection){const ot=this.peerConnection.iceGatheringState,Mt=new Ny(ft,gt,lt,ot,et);this.analyticsTracker.trackEventNoSharedProps(Mt)}this.trace(gt,lt,`ICE gathering state change: ${(Ye=this.peerConnection)===null||Ye===void 0?void 0:Ye.iceGatheringState}`,ft,et)},this.onSelectedCandidatePairChange=()=>{var Ee,Ce,Ye,gt,ft,lt,et,ot,Mt,gn,Bn,Wn,ar,br;const{token:kr,action:mr,traceId:Or,identifier:ni}=this,ei=(Ce=(Ee=this.peerConnection)===null||Ee===void 0?void 0:Ee.getReceivers()[0].transport)===null||Ce===void 0?void 0:Ce.iceTransport,Er=ei?.getSelectedCandidatePair();if(Er){const{local:jr,remote:gr}=Er,xr=`Selected candidate pair change (local, remote): ${jr?.candidate}, ${gr?.candidate}`;this.logger.debug({msg:xr});const ri=new e1(mr,kr,Or,(gt=(Ye=Er.local)===null||Ye===void 0?void 0:Ye.protocol)!==null&&gt!==void 0?gt:"",(lt=(ft=Er.local)===null||ft===void 0?void 0:ft.type)!==null&&lt!==void 0?lt:"",(ot=(et=Er.local)===null||et===void 0?void 0:et.address)!==null&&ot!==void 0?ot:"",(gn=(Mt=Er.remote)===null||Mt===void 0?void 0:Mt.address)!==null&&gn!==void 0?gn:"",(Wn=(Bn=Er.local)===null||Bn===void 0?void 0:Bn.priority)!==null&&Wn!==void 0?Wn:0,ni);this.analyticsTracker.trackEvent(ri),this.protocol=(br=(ar=Er.local)===null||ar===void 0?void 0:ar.protocol)!==null&&br!==void 0?br:""}},this.onIceCandidate=Ee=>Fi(this,void 0,void 0,(function*(){var Ce,Ye;const{identifier:gt,action:ft,traceId:lt}=this,et=(Ce=Ee.target.localDescription)===null||Ce===void 0?void 0:Ce.sdp.includes("relay");this.analyticsTracker.trackEventNoSharedProps(new Xf(this.token,lt,`ice candidate: hasRelay = ${et}, candidate = ${(Ye=Ee.candidate)===null||Ye===void 0?void 0:Ye.candidate}`,ft,gt))})),this.onMute=()=>Fi(this,void 0,void 0,(function*(){const{token:Ee,action:Ce,traceId:Ye,identifier:gt}=this;this.trace(Ee,Ye,"Track has muted",Ce,gt)})),this.onUnMute=()=>Fi(this,void 0,void 0,(function*(){const{token:Ee,action:Ce,traceId:Ye,identifier:gt}=this;this.trace(Ee,Ye,"Track has unmuted",Ce,gt)})),this.fetchAndSetRemoteDescription=Ee=>Fi(this,void 0,void 0,(function*(){var Ce,Ye,gt,ft;const lt=(Ye=(Ce=this.peerConnection)===null||Ce===void 0?void 0:Ce.localDescription)===null||Ye===void 0?void 0:Ye.sdp;lt||this.logger.warn({msg:"Unexpected state: No SDP offer when attempting to fetch remote description"});const{token:et,traceId:ot,action:Mt,identifier:gn,tag:Bn}=this,{endpointURL:Wn,nodeOverride:ar,assignmentToken:br,multiCodec:kr,abortController:mr}=Ee;let Or;this.perfTracker.markPostStart(),this.perfTracker.markSdpExchangeStart();try{const gr=Yl({connection:this.stageConnection,action:Mt,token:et,identifier:this.identifier,tracker:this.analyticsTracker});this.perfTracker.setTransport(gr.getTransport());const xr=ar||is("node")||is("dataPlaneEndpoint");Or=yield gr.exchange({sdpOffer:lt,url:Wn,traceId:ot,forceNode:xr,assignmentToken:br,multiCodec:kr,abortController:mr,initialLayerPreference:(gt=this.simulcastSubscribeConfig)===null||gt===void 0?void 0:gt.initialLayerPreference})}catch(gr){let xr=gr;xr instanceof hr||(xr=new hr(Object.assign(Object.assign({},$t.UNEXPECTED_ERROR),{action:Mt,token:et,traceId:ot,tag:Bn,details:gr instanceof Error?gr.message:"",location:"sdp-exchange"}))),xr instanceof hr&&(this.analyticsTracker.trackError(xr),this.emit(Yu,xr))}if(this.perfTracker.markSdpExchangeStop(),!Or)return;const{location:ni,sessionDeleteLink:ei,mediaControls:Er}=Or;let jr=Or.sdpAnswer;try{jr=this.mungeSdpAnswer(jr),Or.sdpAnswer=jr}catch(gr){this.logger.error({err:gr,msg:"Error while attempting to munge SDP, keeping original answer"})}this.statsReporter.sdpAnswer=jr,this.emit(fy,Or),ni&&(this.whipResource={location:ni,sessionDeleteLink:ei,mediaControls:Er},this.sfuResource=(function(gr){const xr=gr.match(/https:\/\/([^/]+)\//);if(xr){const ri=xr[1].split(".");if(ri[0].includes("video-rtx"))return{node:`${ri[0]}.${ri[1]}`,cluster:ri[1]}}})(ni)||{node:"",cluster:""},this.statsReporter.updateSfuResource(this.sfuResource));try{this.perfTracker.markSetRemoteDescStart(),yield(ft=this.peerConnection)===null||ft===void 0?void 0:ft.setRemoteDescription({sdp:jr,type:"answer"}),this.perfTracker.markSetRemoteDescStop(),this.perfTracker.markPostStop()}catch(gr){const xr=new hr(Object.assign(Object.assign({},$t.SET_ANSWER_FAILURE),{action:Mt,token:et,traceId:ot,tag:ms(Mt,gn),location:"setRemoteDescription",remoteParticipantId:gn,details:gr instanceof Error?gr.message:""}));this.analyticsTracker.trackError(xr),this.emit(Yu,xr)}})),this.cleanup=(Ee,Ce,Ye,gt=!1)=>Fi(this,void 0,void 0,(function*(){var ft,lt,et;const ot=Hd();if(this.toggleStageConnectionListeners(!1),this.currentJitterBufferMinDelayInMs=void 0,this.stageConnection=void 0,this.closeFailedPeerConnections(),!(!((ft=this.whipResource)===null||ft===void 0)&&ft.location))return this.trace(Ye,this.traceId,"whipResource location not known, exiting cleanup",Ee,Ce),void this.analyticsTracker.trackError(new hr(Object.assign(Object.assign({},$t.WHIP_URL_MISSING),{action:Ee,token:Ye,traceId:this.traceId,tag:ms(Ee,Ce),location:Ee===yn.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:ot,remoteParticipantId:Ce})));let Mt=this.whipResource.location;if(this.trace(Ye,this.traceId,`use hostnamecachedurl: ${Mt}`,Ee,Ce),gt){if(!((et=this.whipResource)===null||et===void 0)&&et.sessionDeleteLink){Mt=this.whipResource.sessionDeleteLink,this.trace(Ye,this.traceId,`DELETE via session-delete beacon path: ${Mt}`,Ee,Ce);try{navigator.sendBeacon(Mt,JSON.stringify({authorization:Ye.rawToken}))}catch(gn){this.analyticsTracker.trackErrorAndThrow(new hr(Object.assign(Object.assign({},sh($t.WHIP_DELETE_FAILURE,gn)),{action:Ee,token:Ye,traceId:this.traceId,tag:ms(Ee,Ce),location:yn.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:ot,remoteParticipantId:Ce})))}}}else try{yield Lf().delete(Mt,{headers:{Authorization:`Bearer ${Ye.rawToken}`,"X-Stages-Platform":"web","X-Stages-Request-ID":ot.value,"X-Stages-SDK":"1.31.1","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":this.traceId.value,"X-Stages-WHIP-Version":bl}})}catch(gn){((lt=gn.response)===null||lt===void 0?void 0:lt.status)===404?this.trace(Ye,this.traceId,`DELETE returned 404, ignoring, action = ${Ee}, uuid = ${ot.value}`,Ee,Ce):this.analyticsTracker.trackErrorAndThrow(new hr(Object.assign(Object.assign({},sh($t.WHIP_DELETE_FAILURE,gn)),{action:Ee,token:Ye,traceId:this.traceId,tag:ms(Ee,Ce),location:yn.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:ot,remoteParticipantId:Ce})))}})),this.getConnectionState=()=>{if(!this.peerConnection)return Zn.NONE;const Ee=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;try{return C_(Ee)}catch{return this.logger.warn({msg:"Unhandled connection state:",rawState:Ee}),Zn.IDLE}},this.onIceCandidateError=Ee=>{const{token:Ce,traceId:Ye,tag:gt}=this;if(Ee.errorCode!==701){const ft=new hr(Object.assign(Object.assign({},$t.ICE_CANDIDATE_ERROR),{action:this.action,token:Ce,traceId:Ye,tag:gt,location:"onIceCandidateError",remoteParticipantId:this.identifier}));this.analyticsTracker.trackError(ft),this.emit(Yu,ft)}},this.onIceConnectionStateChange=()=>{var Ee,Ce;const{token:Ye,traceId:gt,action:ft,identifier:lt}=this;this.trace(Ye,gt,`ICE connection state change: ${(Ee=this.peerConnection)===null||Ee===void 0?void 0:Ee.iceConnectionState}`,ft,lt),((Ce=this.peerConnection)===null||Ce===void 0?void 0:Ce.iceConnectionState)==="checking"&&this.peerConnection.getTransceivers().forEach((({receiver:et,sender:ot})=>{[et,ot].forEach((Mt=>{var gn,Bn;(Bn=(gn=Mt?.transport)===null||gn===void 0?void 0:gn.iceTransport)===null||Bn===void 0||Bn.addEventListener("selectedcandidatepairchange",this.onSelectedCandidatePairChange)}))})),this.onConnectionStateChange()},this.createVideoSenderTransformer=()=>new SS(this.analyticsTracker.getSessionId()),this.createVideoReceiverTransformer=()=>{const Ee=new cf(this.analyticsTracker.getSessionId()),{token:Ce,tag:Ye,identifier:gt,action:ft,traceId:lt}=this;Ee.on(nd,(Mt=>{this.emit(Ku,Mt)}));const et=(function(Mt,gn){let Bn=0;return function(...Wn){const ar=Date.now();ar-Bn>=gn&&(Bn=ar,Mt(...Wn))}})((Mt=>{const gn=`Transform error occurred: ${Mt.type}`,Bn=Kl({traceId:lt,token:Ce,tag:Ye,identifier:gt,action:ft,details:gn,stageErrorValue:$t.TRANSFORM_UNEXPECTED_ERROR});this.logger.warn({err:Bn,msg:"Error encountered when transforming receiver",error:Mt})}),1e3),ot=Mt=>{const gn=`Too many errors occurred: ${Mt.type}`,Bn=Kl({traceId:lt,token:Ce,tag:Ye,identifier:gt,action:ft,details:gn,stageErrorValue:$t.TRANSFORM_TOO_MANY_ERRORS});this.logger.error({err:Bn,msg:"Too many errors encountered when transforming receiver. Shutting down transformer.",error:Mt}),Ee.destroy(),this.analyticsTracker.trackError(Bn),this.emit(fl,Bn)};return Ee.on(mg,(Mt=>{Mt.stageErrorValue.code!==$t.TRANSFORM_TOO_MANY_ERRORS.code?et(Mt):ot(Mt)})),Ee},this.onConnectionStateChange=()=>{if(this.peerConnection){const Ce=this.peerConnection.connectionState||this.peerConnection.iceConnectionState,{token:Ye,traceId:gt,identifier:ft,action:lt}=this,et=new Y_(lt,Ye,gt,Ce,ft);this.analyticsTracker.trackEventNoSharedProps(et),this.trace(Ye,gt,`connection state change: ${Ce}`,lt,ft)}const Ee=this.getConnectionState();switch(Ee){case Zn.CONNECTED:this.closeFailedPeerConnections(),this.perfTracker.markActionStop(),this.emit(Bl,Ee),this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream);break;case Zn.FAILED:this.storeFailedPeerConnection(this.peerConnection),this.destroyPeerConnection({closeConnection:!1}),this.emit(Bl,Ee),this.handleConnectionFailure();break;default:this.emit(Bl,Ee)}},this.onIncompatibleCodecs=Ee=>Fi(this,void 0,void 0,(function*(){if(Ee.forEach((gt=>{let ft=!1;this.incompatibleCodecs.forEach((lt=>{lt.config===gt.config&&lt.mime===gt.mime&&(ft=!0)})),ft||this.incompatibleCodecs.add(gt)})),this.peerConnection)try{yield(Ce=this.peerConnection,Ye=[...this.incompatibleCodecs],dT(void 0,void 0,void 0,(function*(){var gt;for(const ft of Ce.getSenders()){const lt=ft.getParameters();if(lt.codecs.length>1){const et=lt.codecs[0];let ot=!1;for(const Mt of Ye)Hy(et,Mt)&&(ot=!0);if(ot){const Mt=pT(Ye,lt.codecs);(gt=lt.encodings)===null||gt===void 0||gt.forEach((gn=>{gn.active&&(gn.codec=Mt)})),yield ft.setParameters(lt)}}}})))}catch(gt){const{token:ft,action:lt,traceId:et,identifier:ot}=this,Mt=new hr(Object.assign(Object.assign({},$t.CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR),{action:lt,token:ft,traceId:et,tag:ms(lt,ot),location:"onIncompatibleCodecs",remoteParticipantId:ot,details:gt instanceof Error?gt.message:""}));this.analyticsTracker.trackError(Mt),this.emit(Yu,Mt)}var Ce,Ye})),this.token=E,this.logger=new Gs(A,le.WEBRTC),this.action=O,this.tag=j,this.traceId=H,O===yn.SUBSCRIBE&&!re)throw new Error("Subscribe action provided without subscriber Id");this.jitterBufferConfig=ee?.jitterBuffer,this.simulcastSubscribeConfig=ee?.simulcast,this.subscriberId=re,this.stageConnection=se,this.failedPeerConnections=[],this.receiveInBandMessagingEnabled=!!(!((he=this.subscribeConfig)===null||he===void 0)&&he.inBandMessaging.enabled),this.perfTracker=new K_(this.action,this.traceId),this.statsReporter=new Co(O,E,H,this.identifier,this.analyticsTracker),this.handlePublishingChangedBinding=this.handlePublishingChanged.bind(this),this.toggleStageConnectionListeners(!0)}get videoMediaId(){var E,A;return(A=(E=this.videoTransceiver)===null||E===void 0?void 0:E.mid)!==null&&A!==void 0?A:null}toggleStageConnectionListeners(E){var A,O;E?(A=this.stageConnection)===null||A===void 0||A.on(Vd,this.handlePublishingChangedBinding):(O=this.stageConnection)===null||O===void 0||O.off(Vd,this.handlePublishingChangedBinding)}updateSubscribeConfig(E){var A,O;if(this.jitterBufferConfig=E.jitterBuffer,this.simulcastSubscribeConfig=E.simulcast,this.action===yn.SUBSCRIBE){const j=E.inBandMessaging.enabled;this.receiveInBandMessagingEnabled!==j&&this.logger.warn({msg:"Cannot mutate in-band messaging config value for receiver"})}this.applyJitterBufferMinDelayConditionally((O=(A=this.stageConnection)===null||A===void 0?void 0:A.getIsStagePublishing())!==null&&O!==void 0&&O)}verifyOrUpdateTransceiverSync(){var E,A;return Fi(this,void 0,void 0,(function*(){if(this.publishVideoStream){const O=this.getTransceiverForKind("video");O?this.publishVideoStream.track.id!==((E=O.sender.track)===null||E===void 0?void 0:E.id)&&(this.logger.debug({msg:"found out of sync video transceiver... updating"}),yield this.replaceOrUpdateStream(this.publishVideoStream)):this.logger.warn({msg:"missing transceiver for video"})}if(this.publishAudioStream){const O=this.getTransceiverForKind("audio");O?this.publishAudioStream.track.id!==((A=O.sender.track)===null||A===void 0?void 0:A.id)&&(this.logger.debug({msg:"found out of sync audio transceiver... updating"}),yield this.replaceOrUpdateStream(this.publishAudioStream)):this.logger.warn({msg:"missing transceiver for audio"})}}))}start(){return Fi(this,void 0,void 0,(function*(){const{token:E,action:A,traceId:O,identifier:j}=this;A!==yn.PUBLISH||E.claims.capabilities.allow_publish||this.analyticsTracker.trackErrorAndThrow(new hr(Object.assign(Object.assign({},sh($t.TOKEN_PERMISSIONS_DENIED,new Error("Cannot publish with subscribe only token"))),{action:A,token:E,traceId:O,tag:ms(A,j),location:"StagePeerClient.start",remoteParticipantId:j})));const H=(function({action:X,identifier:re,token:se,analyticsTracker:ee}){let he="";const Ee=ky(se,ee);switch(X){case yn.PUBLISH:he=Ee.getPublishEndpoint();break;case yn.SUBSCRIBE:re&&(he=Ee.getSubscribeEndpoint(re))}return he})({action:A,identifier:j,token:E.rawToken,analyticsTracker:this.analyticsTracker});try{this.perfTracker.markActionStart(),this.endpointURL=H,this.createPeerConnection(),this.trace(E,O,"peer connection created",A,j)}catch(X){const re=new hr(Object.assign(Object.assign({action:A},sh($t.CREATE_PEER_CONNECTION_FAILURE,X)),{token:E,traceId:O,tag:ms(A,j),location:"StagePeerClient.start",remoteParticipantId:j}));A===yn.PUBLISH&&this.emit(Bl,Zn.FAILED),this.emit(Yu,re),this.analyticsTracker.trackErrorAndThrow(re)}}))}mungeSdpOffer(E,A,O){if(O.simulcastEnabled&&(E=new Hr(E).withVideoLayersAllocationRtpHeaderExtension().sdp),A===yn.SUBSCRIBE)E=new Hr(E).withOpusAudioConfig(Eu(em),!0).sdp;else if(A===yn.PUBLISH&&O.audioConfig){const{maxBitrateBps:j,stereo:H}=O.audioConfig;E=new Hr(E).withOpusAudioConfig(j,H).sdp}return E}mungeSdpAnswer(E){uh.browser.isFirefox()&&this.publishAudioStream&&this.action===yn.PUBLISH&&(E=new Hr(E).withOpusAudioConfig(this.publishAudioStream.config.maxBitrateBps,void 0).sdp);const A=uh.browser.isChrome()||uh.browser.isEdge();this.action===yn.SUBSCRIBE&&A&&(E=new Hr(E).withoutAudioRtcpRSize().sdp);const O=(function(){const j=is("subscribeForceIceProtocol");if(j==="tcp"||j==="udp")return j})();return this.action===yn.SUBSCRIBE&&O&&(E=new Hr(E).withFilteredCandidates(O).sdp),E}createPeerConnection(){var E;this.logger.debug({msg:"setting up peer connection"}),this.peerConnection&&(this.logger.debug({msg:"peer connection is already established, cleaning up previous connection"}),this.destroyPeerConnection({closeConnection:!1})),this.peerConnection=new RTCPeerConnection({iceTransportPolicy:"all"}),this.statsReporter.start(this.peerConnection,(E=this.publishVideoStream)===null||E===void 0?void 0:E.config.simulcastEnabled),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.peerConnection.addEventListener("icecandidateerror",this.onIceCandidateError),this.peerConnection.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this.peerConnection.addEventListener("icecandidate",this.onIceCandidate),this.peerConnection.addEventListener("track",this.onTrack),this.peerConnection.addEventListener("mute",this.onMute),this.peerConnection.addEventListener("unmute",this.onUnMute)}destroyPeerConnection(E){var A,O,j,H,X,re,se,ee,he;this.statsReporter.stop(),(A=this.peerConnection)===null||A===void 0||A.removeEventListener("connectionstatechange",this.onConnectionStateChange),(O=this.peerConnection)===null||O===void 0||O.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),(j=this.peerConnection)===null||j===void 0||j.removeEventListener("icecandidateerror",this.onIceCandidateError),(H=this.peerConnection)===null||H===void 0||H.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),(X=this.peerConnection)===null||X===void 0||X.removeEventListener("icecandidate",this.onIceCandidate),(re=this.peerConnection)===null||re===void 0||re.removeEventListener("track",this.onTrack),(se=this.peerConnection)===null||se===void 0||se.removeEventListener("mute",this.onMute),(ee=this.peerConnection)===null||ee===void 0||ee.removeEventListener("unmute",this.onUnMute),(E.closeConnection||this.action===yn.PUBLISH)&&((he=this.peerConnection)===null||he===void 0||he.close()),this.peerConnection=void 0}closeFailedPeerConnections(){for(const E of this.failedPeerConnections)E?.close();this.failedPeerConnections=[]}storeFailedPeerConnection(E){E&&this.action!==yn.PUBLISH&&this.failedPeerConnections.push(E)}stop(){var E,A;(E=this.videoReceiverTransformer)===null||E===void 0||E.destroy(),(A=this.videoSenderTransformer)===null||A===void 0||A.destroy(),this.destroyPeerConnection({closeConnection:!0})}getTransceiverForKind(E){if(!this.peerConnection)return;const A=this.peerConnection.getTransceivers();return E==="audio"?A.find((O=>O.mid==="0")):E==="video"?A.find((O=>O.mid==="1")):void 0}removeTrack(E){return Fi(this,void 0,void 0,(function*(){if(E==="audio"||E==="video")if(this.peerConnection)try{const A=this.getTransceiverForKind(E);if(!A)return void this.logger.warn({msg:`tried removing track type ${E} but couldn't find transceiver`});yield A.sender.replaceTrack(null),E===Vs.AUDIO?this.publishAudioStream=void 0:this.publishVideoStream=void 0,yield this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream)}catch(A){this.logger.warn({msg:"error replacing track",err:A})}else E===Vs.AUDIO?this.publishAudioStream=void 0:this.publishVideoStream=void 0;else this.logger.warn({msg:"RemoveTrack called with invalid track type",trackType:E})}))}replaceOrUpdateStream(E){return Fi(this,void 0,void 0,(function*(){if(E.track){if(vc(E)?this.publishAudioStream=E:Xa(E)&&(this.publishVideoStream=E),this.peerConnection)try{const A=this.getTransceiverForKind(E.track.kind);if(!A)return void this.logger.warn({msg:`tried replacing track type ${E.track.kind} but couldn't find transceiver`,track:E.track});if(Xa(E)){const O=A.sender.getParameters(),j=E.config.encodingLayers;O.encodings=O.encodings.map((H=>{var X;const re=(X=H.rid)!==null&&X!==void 0?X:"",se=j.find((ee=>{var he;return((he=ee.rid)!==null&&he!==void 0?he:"")===re}));return se?Object.assign(Object.assign({},H),se):H})),yield A.sender.setParameters(O)}else if(vc(E)){const O=A.sender.getParameters(),j=X_(E)[0];O.encodings=O.encodings.map((H=>Object.assign(Object.assign({},H),j))),yield A.sender.setParameters(O)}yield A.sender.replaceTrack(E.track),yield this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream)}catch(A){this.logger.warn({msg:"error replacing track",err:A})}}else this.logger.warn({msg:"Unexpected call to replaceOrUpdateStream with no track"})}))}initializePeerConnection(E=!1){var A,O,j,H,X,re,se,ee;return Fi(this,void 0,void 0,(function*(){const{traceId:he,token:Ee,action:Ce,identifier:Ye}=this;Hc(this.peerConnection),this.resetTransformers();let gt=new MediaStream;if(Ce===yn.PUBLISH){this.publishAudioStream||(this.publishAudioStream={track:this.getSilentAudio(),config:{maxBitrateBps:Eu(J0),stereo:!1}});const ft=this.peerConnection.getTransceivers(),lt=[];ft.forEach((ar=>{var br;lt.concat((br=ar.sender.track)===null||br===void 0?void 0:br.id)})),gt=new MediaStream([this.publishAudioStream.track,(A=this.publishVideoStream)===null||A===void 0?void 0:A.track].filter((ar=>!!ar&&!lt.includes(ar.id))));const et=gt.getAudioTracks()[0]||"audio",ot=gt.getVideoTracks()[0]||"video",Mt={direction:"sendonly",streams:[gt],sendEncodings:X_(this.publishAudioStream)},gn={direction:"sendrecv",streams:[gt],sendEncodings:(O=this.publishVideoStream)===null||O===void 0?void 0:O.config.encodingLayers};this.peerConnection.addTransceiver(et,Mt),this.trace(Ee,he,`track added, type: ${et.kind||et}`,Ce,Ye);const Bn=this.peerConnection.addTransceiver(ot,gn);this.trace(Ee,he,`track added, type: ${ot.kind||ot}`,Ce,Ye);const Wn=!!(!((H=(j=this.publishVideoStream)===null||j===void 0?void 0:j.config)===null||H===void 0)&&H.inBandMessagingEnabled);this.sendInBandMessagingEnabled===void 0?this.sendInBandMessagingEnabled=Wn:this.sendInBandMessagingEnabled!==Wn&&this.logger.warn({msg:"Cannot mutate in-band messaging config value for sender"}),this.sendInBandMessagingEnabled&&!SS.isSupported(Bn)?this.handleTransformNotSupported():this.sendInBandMessagingEnabled&&((X=this.videoSenderTransformer)===null||X===void 0||X.onTransceiverAdd(Bn))}else Ce===yn.SUBSCRIBE&&(Ee.shouldSendSilentAudio()?this.peerConnection.addTransceiver(this.getSilentAudio(),{direction:"sendrecv"}):this.peerConnection.addTransceiver("audio",{direction:"recvonly"}),this.trace(Ee,he,"track added, type: audio",Ce,Ye),E||(this.videoTransceiver=this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.trace(Ee,he,"track added, type: video",Ce,Ye),this.receiveInBandMessagingEnabled&&!cf.isSupported(this.videoTransceiver)?this.handleTransformNotSupported():this.receiveInBandMessagingEnabled&&((re=this.videoReceiverTransformer)===null||re===void 0||re.onTransceiverAdd(this.videoTransceiver))),this.peerConnection.getTransceivers().forEach((ft=>{ft.receiver?(this.logger.info({msg:"dbg: Subscribe succeeded, adding media track to participant mediaStream"}),gt?.addTrack(ft.receiver.track)):this.logger.info({msg:"dbg: Subscribe succeeded, but Transceiver were negotiated without Receiver"})})),this.applyJitterBufferMinDelayConditionally((ee=(se=this.stageConnection)===null||se===void 0?void 0:se.getIsStagePublishing())!==null&&ee!==void 0&&ee));return gt}))}handlePublishingChanged(E){this.logger.debug({msg:`[handlePublishingChanged (${this.subscriberId})] isStagePublishing: ${E}, currentMinDelay: ${this.currentJitterBufferMinDelayInMs}`}),this.action===yn.SUBSCRIBE&&this.applyJitterBufferMinDelayConditionally(E)}applyJitterBufferMinDelayConditionally(E){const A=this.currentJitterBufferMinDelayInMs,O=this.calcJitterBufferMinDelay(E,this.jitterBufferConfig);if(E){if(A===void 0||A>O){const j=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is publishing and min delay is unset or > configured; attempting to update to ${O}`;this.logger.debug({msg:j}),this.trace(this.token,this.traceId,j,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(O)}}else if(A===void 0||O!==A){const j=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is subscribe-only and min delay is unset or != configured; attempting to update to ${O}`;this.logger.debug({msg:j}),this.trace(this.token,this.traceId,j,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(O)}}calcJitterBufferMinDelay(E,A){var O,j,H;let X=0;if(!(()=>{const re=RTCRtpReceiver.prototype;return!(!re||typeof re!="object")&&("jitterBufferTarget"in re||"playoutDelayHint"in re)})())return 0;if(E)X=Za((O=A?.minDelayWhenPublishing)!==null&&O!==void 0?O:Es.DEFAULT,E);else{X=Za((j=A?.minDelayWhenSubscribeOnly)!==null&&j!==void 0?j:Es.DEFAULT,E);const re=(H=this.stageConnection)===null||H===void 0?void 0:H.jitterBufferMinDelayInMs();A?.minDelayWhenSubscribeOnly===Es.DEFAULT&&re!==void 0&&(X=re,this.logger.debug({msg:`[calcJitterBufferMinDelay] overriding min delay with remote value: ${X}`}))}return X}applyAndTrackJitterBufferMinDelay(E){var A,O;this.currentJitterBufferMinDelayInMs=E,this.statsReporter.updateJitterBufferMinDelay(E),E!==void 0&&((O=(A=this.peerConnection)===null||A===void 0?void 0:A.getTransceivers())===null||O===void 0||O.forEach((j=>{j.receiver&&this.applyJitterBufferMinDelay(j.receiver,E)})))}applyJitterBufferMinDelay(E,A){let O="Unable to set jitter buffer min delay";if("jitterBufferTarget"in E)O=`setting jitterBufferTarget to: ${A} for track: ${E.track.kind}`,this.logger.debug({msg:O}),E.jitterBufferTarget=A;else if("playoutDelayHint"in E){const j=A/1e3;O=`setting playoutDelayHint to: ${A} for track: ${E.track.kind}`,this.logger.debug({msg:O}),E.playoutDelayHint=j}else this.logger.warn({msg:O});this.trace(this.token,this.traceId,O,this.action,this.identifier)}exchangeSdp(E){var A,O,j;return Fi(this,void 0,void 0,(function*(){const{traceId:H,token:X,action:re,identifier:se,tag:ee,endpointURL:he}=this,{iceRestart:Ee=!1,nodeOverride:Ce,assignmentToken:Ye,abortController:gt}=E;let ft;this.logger.debug({msg:`Exchanging SDP: ${H.value}, iceRestart=${Ee}, nodeOverride=${Ce}, assignmentToken=${Ye}`}),Hc(this.peerConnection),re===yn.PUBLISH&&A0()&&(this.logger.debug({msg:"Applying publisher codec preference for main profile."}),((et,ot)=>{var Mt,gn;const Bn=(Mt=RTCRtpReceiver.getCapabilities("video"))===null||Mt===void 0?void 0:Mt.codecs;if(!Bn)return;let Wn=Bn;Wn=fS(Bn,"42e0"),ot.preferMainProfile&&(Wn=fS(Bn,"4d00")),(gn=et.getTransceivers().find((ar=>ar.receiver.track.kind==="video")))===null||gn===void 0||gn.setCodecPreferences(Wn)})(this.peerConnection,{preferMainProfile:A0()}));try{this.trace(X,H,"Creating offer",re,se),ft=yield this.peerConnection.createOffer({iceRestart:Ee})}catch(et){const ot=new hr(Object.assign(Object.assign({},sh($t.CREATE_OFFER_FAILURE,et)),{action:re,token:X,traceId:H,tag:ee,location:"exchangeSdp",remoteParticipantId:se}));this.emit(Yu,ot),this.analyticsTracker.trackErrorAndThrow(ot)}ft.sdp&&(ft.sdp=this.mungeSdpOffer(ft.sdp,re,{simulcastEnabled:(O=(A=this.publishVideoStream)===null||A===void 0?void 0:A.config.simulcastEnabled)!==null&&O!==void 0&&O,audioConfig:(j=this.publishAudioStream)===null||j===void 0?void 0:j.config})),this.trace(X,H,"Setting local description",re,se),yield this.peerConnection.setLocalDescription(ft),this.trace(X,H,"local description set",re,se),he||this.logger.warn({msg:"Unexpected state: No endpointURL specified for fetching of remote description."});const lt=re===yn.PUBLISH&&A0()||re===yn.SUBSCRIBE&&cc("multiCodecAnswer");yield this.fetchAndSetRemoteDescription({endpointURL:he,nodeOverride:Ce,assignmentToken:Ye,multiCodec:lt,abortController:gt})}))}getReports(){var E;return Fi(this,void 0,void 0,(function*(){try{const A=(yield(E=this.peerConnection)===null||E===void 0?void 0:E.getStats())||[],O=[];return A.forEach((j=>{O.push(j)})),O}catch{return[]}}))}requestRTCStats(E){return Fi(this,void 0,void 0,(function*(){if(this.peerConnection)return this.statsReporter.getStats(E)}))}get identifier(){return this.subscriberId||this.token.participantID}handleTransformNotSupported(){const{token:E,tag:A,identifier:O,action:j,traceId:H}=this,X=Kl({traceId:H,token:E,tag:A,identifier:O,action:j,stageErrorValue:$t.TRANSFORM_NOT_SUPPORTED_BY_PLATFORM});this.logger.error({err:X,msg:"Transforms not supported by this platform"}),this.analyticsTracker.trackError(X),this.emit(fl,X)}handleConnectionFailure(){return Fi(this,void 0,void 0,(function*(){const{token:E,traceId:A,tag:O}=this;this.analyticsTracker.trackError(new hr(Object.assign(Object.assign({},$t.PEER_CONNECTION_NETWORK_FAILURE),{action:this.action,token:E,traceId:A,tag:O,location:"onIceCandidateError",remoteParticipantId:this.identifier})))}))}getSilentAudio(){xl||(xl=new AudioContext);const E=xl.createOscillator(),A=xl.createGain();E.connect(A);const O=xl.createMediaStreamDestination();return A.connect(O),A.gain.value=0,E.start(),O.stream.getAudioTracks()[0]}getActionMeasurements(){return this.perfTracker.getMeasurements()}getProtocol(){return this.protocol}initStreamsToPublish(E){this.publishVideoStream=E.find(Xa),this.publishAudioStream=E.find(vc)}getSfuResource(){return this.sfuResource}getExpectedJitterBufferMinDelayInMs(){var E,A;return this.calcJitterBufferMinDelay((A=(E=this.stageConnection)===null||E===void 0?void 0:E.getIsStagePublishing())!==null&&A!==void 0&&A,this.jitterBufferConfig)}trace(E,A,O,j,H){this.analyticsTracker.trackEventNoSharedProps(new Xf(E,A,O,j,H))}sendSeiMessage(E,A){const O=this.getTransceiverForKind("video");return this.videoSenderTransformer&&this.sendInBandMessagingEnabled?this.action===yn.PUBLISH&&O?this.videoSenderTransformer.sendSeiMessage(E,A):pn.err(ha.NOT_PUBLISHING_VIDEO):pn.err(ha.INBAND_MESSAGING_NOT_ENABLED)}}const rd=yn.SUBSCRIBE;class t1{constructor(E,A,O){this.analyticsTracker=E,this.token=A,this.remoteId=O,this.action=rd}trackAttempt({stageConnectionStats:E,isReassignment:A=!1,traceIdOverride:O,preAttemptSfuResource:j}){const{action:H,analyticsTracker:X,token:re,remoteId:se}=this,ee=O||oa();return X.trackEvent(new ir({token:this.token,subscribedId:this.remoteId,traceId:ee,isEdpConnected:E.isConnected,isReassignment:A,preAttemptSfuResource:j})),{getTraceId:()=>ee,trackSubscribeStarted({totalDurationWithRetries:he,retryTimes:Ee,sfuResource:Ce,peerClientPerfStats:Ye,protocol:gt}){const{optionsDuration:ft,postDuration:lt,timeToCandidate:et,timeToConnected:ot,sdpExchangeDuration:Mt,sdpExchangeTransport:gn,setRemoteDescDuration:Bn,peerConnectionDuration:Wn}=Ye,{edpInitialConnectDuration:ar,edpInitialConnectRetries:br,edpInitialStateDuration:kr,edpInitialStatePublishingCount:mr,edpStateUpdateCount:Or}=E;X.trackEvent(new Ky({token:re,traceId:ee,remoteParticipantId:se,optionsDuration:ft,postDuration:lt,timeToCandidate:et,totalDuration:ot,edpInitialConnectDuration:ar,edpInitialConnectRetries:br,edpInitialStateDuration:kr,edpInitialStatePublishingCount:mr,edpStateUpdateCount:Or,sdpExchangeDuration:Mt,sdpExchangeTransport:gn,setRemoteDescDuration:Bn,peerConnectionDuration:Wn,sfuResource:Ce,totalDurationWithRetries:he,subscribeRetryTimes:Ee,isReassignment:A,protocol:gt}))},trackSubscribeFirstFrame:({peerClientPerfStats:he,totalDurationWithRetries:Ee,sfuResource:Ce,retryTimes:Ye,currentJitterBufferMinDelayInMs:gt,mediaType:ft,firstFrameDuration:lt,protocol:et})=>{const{sdpExchangeDuration:ot,sdpExchangeTransport:Mt,setRemoteDescDuration:gn,peerConnectionDuration:Bn}=he,{edpInitialConnectDuration:Wn,edpInitialConnectRetries:ar,edpInitialStateDuration:br,edpInitialStatePublishingCount:kr,edpStateUpdateCount:mr}=E;this.analyticsTracker.trackEvent(new rv({token:this.token,traceId:ee,remoteParticipantId:se,edpInitialConnectDuration:Wn,edpInitialConnectRetries:ar,edpInitialStateDuration:br,edpInitialStatePublishingCount:kr,edpStateUpdateCount:mr,sdpExchangeDuration:ot,sdpExchangeTransport:Mt,setRemoteDescDuration:gn,peerConnectionDuration:Bn,videoWasPaused:!1,firstFrameDuration:lt,mediaType:ft,sfuResource:Ce,totalDurationWithRetries:Ee,subscribeRetryTimes:Ye,currentJitterBufferMinDelayInMs:gt,protocol:et}))},trackSubscribeFailed(he,Ee,Ce){const Ye=((lt,et,ot)=>{if(lt instanceof hr)return lt;let Mt="";return lt instanceof lc.AxiosError&&(Mt+=`AxiosError - ${lt.code}`),new hr(Object.assign(Object.assign(Object.assign({},$t.SUBSCRIBE_FAILURE),{action:rd,token:et,traceId:ot,tag:W0,location:"subscribe",details:`${Mt} ${lt?.message}`}),{fatal:!0}))})(he,re,ee);X.trackEvent(new El({token:re,traceId:ee,remoteParticipantId:se,code:Ye.code,message:Ye.message,fatal:Ye.fatal,nominal:Ye.nominal,isReassignment:A,protocol:Ee}));const{isConnected:gt}=E,ft=new hr(Object.assign(Object.assign({},$t.SUBSCRIBE_FAILURE),{action:H,token:re,traceId:ee,tag:ms(yn.SUBSCRIBE,se),location:"subscribe",remoteParticipantId:se,isEdpConnected:gt,details:Ce}));return he instanceof hr&&(ft.fatal=he.fatal,ft.nominal=he.nominal,ft.location=`subscribe > ${he.location}`),X.trackError(ft),Ye},trackUnsubscribe:()=>{X.trackEvent(new Oa({token:re,unsubscribedId:se,traceId:ee}))},trackEndSucceeded:(he,Ee)=>{X.trackEvent(new ph({token:re,traceId:ee,remoteParticipantId:se,isUnsubscribeSuccessful:!0,reason:he,protocol:Ee}))},trackEndFailed:(he,Ee)=>{const Ce=new hr(Object.assign(Object.assign({},$t.UNSUBSCRIBE_FAILURE),{token:re,traceId:ee,tag:ms(yn.SUBSCRIBE,se),location:"unsubscribe",remoteParticipantId:se}));return he!==$s.UNLOAD&&he!==$s.UNSUBSCRIBE||X.trackError(Ce),X.trackEvent(new ph({token:re,traceId:ee,remoteParticipantId:se,isUnsubscribeSuccessful:!0,reason:he,protocol:Ee})),Ce}}}}class n1 extends $n{constructor(E,A,O,j,H,X){super(xn.PLAYBACK_LAYER_REQUEST,E,A,!1),Object.assign(this.properties,{media_type:O,remote_participant_id:j,track_id:H,layer_id:X})}}class ES extends $n{constructor(E,A,O,j,H,X=1){super(xn.PLAYBACK_LAYER_STATE,E,A,!1),Object.assign(this.properties,{media_type:O,remote_participant_id:j,track_id:H,request_count:X})}}var qs,Ys,uf,Ts;(function(C){C.PAUSE="pause",C.PLAY="play"})(qs||(qs={})),(function(C){C.IDLE="idle",C.ACTIVE="active",C.ERRORED="errored",C.DESTROYED="destroyed"})(Ys||(Ys={})),(function(C){C.SUCCESS="success"})(uf||(uf={})),(function(C){C.FAILED="failed",C.DESTROYED="destroyed",C.THROTTLED="throttled"})(Ts||(Ts={}));var Ia=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};class ST{constructor(E){this.state=Ys.IDLE,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null,this.stopVideo=()=>Ia(this,void 0,void 0,(function*(){return this.state!==Ys.ACTIVE?(this.logCommandSkipped("stopVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(qs.PAUSE)})),this.startVideo=()=>Ia(this,void 0,void 0,(function*(){return this.state!==Ys.ACTIVE?(this.logCommandSkipped("startVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(qs.PLAY)})),this.setLayer=A=>Ia(this,void 0,void 0,(function*(){return this.state!==Ys.ACTIVE?(this.logCommandSkipped("setLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest(A)})),this.unsetLayer=()=>Ia(this,void 0,void 0,(function*(){return this.state!==Ys.ACTIVE?(this.logCommandSkipped("unsetLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest()})),this.getLayers=()=>Ia(this,void 0,void 0,(function*(){return this.state!==Ys.ACTIVE?(this.logCommandSkipped("getLayers"),this.mapSkippedResultFromState(this.state)):this.sendLayerStateRequest()})),this.sendPlaybackRequest=A=>Ia(this,void 0,void 0,(function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,pn.err)(Ts.FAILED);if(!this.playbackEndpoint)return this.logger.warn({msg:"Playback endpoint is unset and required for playback control requests"}),(0,pn.err)(Ts.FAILED);this.logger.info({msg:`Sending ${A} request to ${this.playbackEndpoint}`});const O=A===qs.PAUSE?{pause:[this.mid]}:{play:[this.mid]},j=this.createPostWhepRequest(O);return fetch(this.playbackEndpoint,j).then((H=>{if(H.status>=300){const X=new Error(`Error sending media controls request: ${H.status}:${H.statusText}`);return this.logger.error({err:X}),(0,pn.err)(Ts.FAILED)}return this.logger.debug({msg:`Request to ${A} was successful: ${H.status}`}),(0,pn.ok)(uf.SUCCESS)})).catch((H=>(this.logger.error({err:H,msg:"Error sending media controls request"}),(0,pn.err)(Ts.FAILED))))})),this.sendLayerRequest=A=>Ia(this,void 0,void 0,(function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,pn.err)(Ts.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,pn.err)(Ts.FAILED);const O=typeof A=="string",j=O?{mediaId:this.mid,encodingId:A}:{},H=O?`set : ${A}`:"unset layer";this.logger.info({msg:`sendLayerRequest for ${H} at ${this.layersEndpoint}`});const X=this.createPostWhepRequest(j);return this.trackLayerRequest(A??"auto"),fetch(this.layersEndpoint,X).then((re=>this.state===Ys.DESTROYED?(0,pn.err)(Ts.DESTROYED):re.status>=300?this.handleLayerRequestError(re.status,re.statusText):(this.logger.debug({msg:`Request to ${H} was successful: ${re.status}`}),(0,pn.ok)(uf.SUCCESS)))).catch((re=>this.handleLayerRequestError(0,re.message)))})),this.sendLayerStateRequest=()=>Ia(this,void 0,void 0,(function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,pn.err)(Ts.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,pn.err)(Ts.FAILED);this.logger.info({msg:`sendLayerStateRequest for ${this.mid} at ${this.layersEndpoint}`});const A=this.createGetWhepRequest();return this.trackLayerStateRequest(),fetch(this.layersEndpoint,A).then((O=>Ia(this,void 0,void 0,(function*(){var j;if(this.state===Ys.DESTROYED)return(0,pn.err)(Ts.DESTROYED);if(O.status>=300)return this.handleLayerStateRequestError(O.status,O.statusText);const H=yield O.json(),X=(j=H?.layers)!==null&&j!==void 0?j:[],re=JSON.stringify(X,null,2);return this.logger.debug({msg:`sendLayerStateRequest was successful: ${re}`}),(0,pn.ok)(X)})))).catch((O=>this.handleLayerStateRequestError(0,O.message)))})),this.logger=new Gs(E.logger,le.REMOTE_PLAYBACK),this.token=E.token,this.traceId=E.traceId,this.analyticsTracker=E.analyticsTracker,this.remoteParticipantId=E.remoteParticipantId}set mediaId(E){if(this.state!==Ys.DESTROYED){if(this.mid=E,this.mid===null)return this.logger.info({msg:"media id is unset, controller is transitioning to idle state"}),void(this.state=Ys.IDLE);(this.playbackEndpoint||this.layersEndpoint)&&(this.state=Ys.ACTIVE)}else this.logCommandSkipped("set mediaId")}set endpoints(E){var A,O;if(this.state!==Ys.DESTROYED){if(this.playbackEndpoint=(A=E.playback)!==null&&A!==void 0?A:null,this.layersEndpoint=(O=E.layers)!==null&&O!==void 0?O:null,!this.playbackEndpoint||!this.layersEndpoint){const j={playbackEndpoint:this.playbackEndpoint,layersEndpoint:this.layersEndpoint};return this.logger.info({msg:`no endpoints are set, transitioning to idle state: ${JSON.stringify(j,null)}`}),void(this.state=Ys.IDLE)}this.mid&&(this.state=Ys.ACTIVE)}else this.logCommandSkipped("set endpoints")}destroy(){this.state=Ys.DESTROYED,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null}logCommandSkipped(E="command"){this.logger.info({msg:`skipping ${E}, controller state invalid: ${this.state}`})}mapSkippedResultFromState(E){return E===Ys.DESTROYED?(0,pn.err)(Ts.DESTROYED):(0,pn.err)(Ts.FAILED)}createPostWhepRequest(E){return{method:"POST",headers:this.createRequestHeaders(),body:JSON.stringify(E)}}createGetWhepRequest(){return{method:"GET",headers:this.createRequestHeaders()}}createRequestHeaders(){var E,A;return{Authorization:`Bearer ${this.token.rawToken}`,"Content-Type":"application/json","X-Stages-Platform":"web","X-Stages-Request-ID":Hd().value,"X-Stages-SDK":"1.31.1","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":(A=(E=this.traceId)===null||E===void 0?void 0:E.value)!==null&&A!==void 0?A:"","X-Stages-WHIP-Version":bl}}trackLayerRequest(E){var A;this.analyticsTracker.trackEventNoSharedProps(new n1(this.token,this.traceId,vr.VIDEO,this.remoteParticipantId,(A=this.mid)!==null&&A!==void 0?A:"unknown",E))}trackLayerStateRequest(E=1){var A;this.analyticsTracker.trackEventNoSharedProps(new ES(this.token,this.traceId,vr.VIDEO,this.remoteParticipantId,(A=this.mid)!==null&&A!==void 0?A:"unknown",E))}handleLayerRequestError(E,A){const O=`sendLayerRequest failed for reason: ${E} ${A}`;let j,H;return E===429?(j=Ts.THROTTLED,H=$t.WHEP_SET_LAYER_REQUEST_THROTTLED):(j=Ts.FAILED,H=$t.WHEP_SET_LAYER_REQUEST_FAILED),this.trackRequestError(H,O),(0,pn.err)(j)}handleLayerStateRequestError(E,A){const O=`sendLayerStateRequest failed for reason: ${E} ${A}`;let j,H;return E===429?(j=Ts.THROTTLED,H=$t.WHEP_GET_LAYER_STATE_THROTTLED):(j=Ts.FAILED,H=$t.WHEP_GET_LAYER_STATE_FAILED),this.trackRequestError(H,O),(0,pn.err)(j)}trackRequestError(E,A){const O=new Error(A);this.logger.error({err:O}),E.message=A;const j=this.createError(E);this.analyticsTracker.trackError(j)}createError(E,A){return new hr(Object.assign({action:yn.SUBSCRIBE,traceId:this.traceId,token:this.token,location:"RemotePlaybackController",tag:W0,details:A},E))}}var gg,um,ci,Ho,Xl=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))},w=function(C,E,A,O){if(typeof E=="function"?C!==E||!O:!E.has(C))throw new TypeError("Cannot read private member from an object whose class did not declare it");return A==="m"?O:A==="a"?O.call(C):O?O.value:E.get(C)};(function(C){C.DISCONNECTED="disconnected",C.CONNECTING="connecting",C.CONNECTED="connected",C.ERRORED="errored"})(ci||(ci={})),(function(C){C.NONE="none",C.AUDIO_ONLY="audio_only",C.AUDIO_VIDEO="audio_video"})(Ho||(Ho={}));class D extends ea{constructor(E,A,O,j,H,X,re){super(),this.id=E,this.token=A,this.stageConnection=O,this.nonScopedLogger=j,this.analyticsTracker=H,this.desiredSubscribeType=X,gg.add(this),this.isSubscriptionActive=!1,this.subscriptionState={connectionState:ci.DISCONNECTED,subscribeInProgress:!1},this.previousSignalState={isTargetPublishing:!1},this.failedRetries=0,this.startConnectingTimestamp=-1,this.throttler=new fT(1e3),this.cleanupFirstFrameTracking=Yh,this.actualSubscribeType=Ho.NONE,this.action=yn.SUBSCRIBE,this.updateDesiredSubscribeType=ee=>{this.desiredSubscribeType=ee,this.attemptToActualizeSubscribeType()},this.updateSubscribeConfig=ee=>{this.peerClient.updateSubscribeConfig(ee)},this.getDesiredSubscribeType=()=>this.desiredSubscribeType,this.attemptToActualizeSubscribeType=()=>{const ee=this.actualSubscribeType,he=this.desiredSubscribeType;this.logger.debug({msg:`Attempt to actualize subscribe type to ${he}`}),this.subscriptionState.connectionState===ci.CONNECTED&&he!==Ho.NONE&&ee!==he&&this.applyVideoControlsBySubscribeType(he,ee)},this.onParticipantUpdated=ee=>{w(this,gg,"m",um).call(this,ee)&&(this.logger.debug({msg:"onParticipantUpdated",participant:ee}),this.processStateUpdate({isTargetPublishing:ee.isPublishing}))},this.onParticipantJoined=ee=>{w(this,gg,"m",um).call(this,ee)&&(this.logger.debug({msg:"onParticipantJoined",participant:ee}),this.processStateUpdate({isTargetPublishing:ee.isPublishing}))},this.onParticipantLeft=ee=>{w(this,gg,"m",um).call(this,ee)&&(this.logger.debug({msg:"onParticipantLeft",participant:ee}),this.processStateUpdate({isTargetPublishing:!1}))},this.onPeerClientConnectionStateChange=ee=>{const he=this.stageConnection.getParticipant(this.id);this.logger.debug({msg:`onPeerClientConnectionStateChange: ${ee}`,state:ee,targetParticipant:he}),this.processStateUpdate({peerClientState:ee})},this.onPeerClientTransformError=ee=>{this.emit(W_,ee)},this.onSdpNegotiated=ee=>{this.remotePlaybackController.endpoints={playback:ee.mediaControls,layers:ee.layerControls}},this.seiMessageHandler=ee=>{this.emit(Cy,ee)},this.requestRTCStats=ee=>Xl(this,void 0,void 0,(function*(){return this.peerClient.requestRTCStats(ee)})),this.trySubscribe=ee=>Xl(this,void 0,void 0,(function*(){var he,Ee;if(this.logger.debug({msg:`Subscribe attempt started: ${ee}`}),!this.isSubscriptionActive)return this.logger.warn({msg:"Subscribe attempt invalid: Subscription is inactive"}),!1;this.logger.debug({msg:"Subscribe attempt is valid."}),this.startConnectingTimestamp<0&&(this.startConnectingTimestamp=performance.now()),this.subscriptionState.connectionState!==ci.ERRORED&&(this.logger.debug({msg:"Updating state to CONNECTING"}),this.updateState({connectionState:ci.CONNECTING}));const Ce=this.stageConnection.getConnectionStats(),Ye=this.peerClient.getExpectedJitterBufferMinDelayInMs(),gt=this.peerClient.getSfuResource();this.attemptTracker=this.subscribeTracker.trackAttempt({stageConnectionStats:Ce,preAttemptSfuResource:gt});try{this.remotePlaybackController.traceId=this.attemptTracker.getTraceId();const{mediaStream:ft}=yield this.subscribe(this.attemptTracker.getTraceId()),lt=performance.now()-this.startConnectingTimestamp,et=this.peerClient.getSfuResource();this.remotePlaybackController.mediaId=this.peerClient.videoMediaId;const ot=this.failedRetries;this.attemptToActualizeSubscribeType();const Mt=this.peerClient.getActionMeasurements(),gn=this.peerClient.getProtocol();if(this.attemptTracker.trackSubscribeStarted({sfuResource:et,totalDurationWithRetries:lt,retryTimes:ot,peerClientPerfStats:Mt,protocol:gn}),ft){this.cleanupFirstFrameTracking();const Bn=this.actualSubscribeType,Wn=this.attemptTracker,ar=(br,kr)=>{Wn.trackSubscribeFirstFrame({peerClientPerfStats:Mt,sfuResource:et,totalDurationWithRetries:lt,retryTimes:ot,currentJitterBufferMinDelayInMs:Ye,mediaType:kr,firstFrameDuration:br,protocol:gn})};this.cleanupFirstFrameTracking=this.measureFirstFrameDuration({mediaStream:ft,subscribeType:Bn,callback:ar})}return this.throttler.clear(),this.failedRetries=0,this.startConnectingTimestamp=-1,ft&&this.emit(oh,ft,this.remotePlaybackController),this.logger.debug({msg:"Subscribe attempt succeeded"}),!0}catch(ft){const lt=(Ee=(he=this.peerClient)===null||he===void 0?void 0:he.getProtocol())!==null&&Ee!==void 0?Ee:"",et=this.attemptTracker.trackSubscribeFailed(ft,lt);this.logger.error({log:"Subscribe attempt failed",err:ft}),this.onTrySubscribeFailure(et,ee)}return!1}));const se=oa();this.peerClient=new lf(A,this.nonScopedLogger,this.action,ms(this.action,E),se,H,E,O,re),this.logger=new Gs(j,le.SUBSCRIPTION),this.subscribeTracker=new t1(this.analyticsTracker,A,E),this.remotePlaybackController=new ST({token:A,analyticsTracker:H,traceId:se,logger:this.nonScopedLogger,remoteParticipantId:this.id})}applyVideoControlsBySubscribeType(E,A){try{E===Ho.AUDIO_ONLY?this.remotePlaybackController.stopVideo().catch((O=>{this.logger.error({err:O,msg:"Remote playback request to stop video failed"})})):E===Ho.AUDIO_VIDEO&&this.remotePlaybackController.startVideo().catch((O=>{this.logger.error({err:O,msg:"Remote playback request to start video failed"})})),this.actualSubscribeType=E,this.logger.debug({msg:`Desired subscribe type actualized from ${A} to ${E}.`})}catch(O){this.logger.error({err:O,msg:`Error updating subscribe type from ${A} to ${E}.`})}}processStateUpdate(E){const A=this.previousSignalState,O=Object.assign({},A,E);if(!this.isSubscriptionActive)return void this.logger.warn({msg:"Unexpected processStateUpdate when subscription is inactive"});O.isTargetPublishing?E.peerClientState===Zn.CONNECTED?this.updateState({connectionState:ci.CONNECTED,subscribeInProgress:!0}):E.peerClientState===Zn.FAILED&&this.subscriptionState.subscribeInProgress&&(this.attemptTracker&&this.attemptTracker.trackEndFailed($s.CONNECTION_FAIL,this.peerClient.getProtocol()),this.updateState({subscribeInProgress:!1}),this.emit(qf)):(A.isTargetPublishing&&this.subscriptionState.subscribeInProgress&&(this.logger.debug({msg:"Scheduling an unsubscribe on the event loop"}),this.unsubscribe()),this.throttler.clear(),this.updateState({connectionState:ci.DISCONNECTED}));const j=!A.isTargetPublishing&&E.isTargetPublishing,H=this.subscriptionState.connectionState===ci.CONNECTED&&E.peerClientState===Zn.FAILED;(j||H)&&this.throttledTrySubscribe("onSignalState change: isTargetPublishing is now true"),Object.assign(this.previousSignalState,E)}onTrySubscribeFailure(E,A){this.logger.debug({msg:"Changing/keeping state FAILED"});const O=E.fatal,j=E.code===$t.OPERATION_ABORTED.code,H=this.failedRetries<=4;if(!j&&!O&&H){const X=1e3*Math.pow(2,this.failedRetries);this.logger.debug({msg:`Retrying in ${X}ms`}),this.failedRetries++,this.nextAttemptTimerId=window.setTimeout((()=>Xl(this,void 0,void 0,(function*(){this.throttledTrySubscribe(A)}))),X)}else this.updateState({connectionState:ci.ERRORED}),this.emit($_,E),this.onTerminalFailure()}onTerminalFailure(){this.previousSignalState.isTargetPublishing=!1,this.startConnectingTimestamp=-1,this.failedRetries=0}start(){this.isSubscriptionActive=!0,this.peerClient.on(Bl,this.onPeerClientConnectionStateChange),this.peerClient.on(fy,this.onSdpNegotiated),this.peerClient.on(Ku,this.seiMessageHandler),this.peerClient.on(fl,this.onPeerClientTransformError),this.stageConnection.on(yr,this.onParticipantUpdated),this.stageConnection.on(V_,this.onParticipantJoined),this.stageConnection.on(Hl,this.onParticipantLeft),this.stageConnection.on(G_,this.onParticipantLeft);let E=!0;if(this.stageConnection.isConnected()){const A=this.stageConnection.getParticipant(this.id);E=!!A?.isPublishing}this.processStateUpdate({isTargetPublishing:E})}throttledTrySubscribe(E){return this.throttler.invoke(this.trySubscribe,E)}updateState(E){E.subscribeInProgress!==void 0&&(this.subscriptionState.subscribeInProgress=E.subscribeInProgress),E.connectionState&&this.subscriptionState.connectionState!==E.connectionState&&(this.subscriptionState.connectionState=E.connectionState,this.emit(vl,this.subscriptionState.connectionState))}stop(E=!1){this.peerClient.off(Bl,this.onPeerClientConnectionStateChange),this.peerClient.off(fl,this.onPeerClientTransformError),this.peerClient.off(fy,this.onSdpNegotiated),this.peerClient.off(Ku,this.seiMessageHandler),this.unsubscribe(E),this.throttler.clear(),this.stageConnection.off(yr,this.onParticipantUpdated),this.stageConnection.off(V_,this.onParticipantJoined),this.stageConnection.off(Hl,this.onParticipantLeft),this.stageConnection.off(G_,this.onParticipantLeft),this.isSubscriptionActive=!1,this.updateState({connectionState:ci.DISCONNECTED})}isActive(){return this.isSubscriptionActive}subscribe(E,A){return Xl(this,void 0,void 0,(function*(){const{token:O,id:j}=this;O.assertTokenIsUnexpired(E,ms(yn.SUBSCRIBE,j),"subscribe",j);const{mediaStream:H}=yield this.peerClient.connect({audioOnly:A,traceId:E});return{peerClient:this.peerClient,mediaStream:H}}))}unsubscribe(E=!1){return Xl(this,void 0,void 0,(function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.remotePlaybackController.destroy(),!this.isSubscriptionActive||!this.attemptTracker||this.subscriptionState.connectionState===ci.DISCONNECTED)return;this.cleanupFirstFrameTracking(),this.attemptTracker.trackUnsubscribe();const A=E?$s.UNLOAD:$s.UNSUBSCRIBE,O=this.peerClient.getProtocol();try{E?this.peerClient.disconnect(E):yield this.peerClient.disconnect(E),this.updateState({subscribeInProgress:!1}),this.attemptTracker.trackEndSucceeded(A,O)}catch{this.attemptTracker.trackEndFailed(A,O)}}))}triggerIceRestart(E){var A;return Xl(this,void 0,void 0,(function*(){const O=this.stageConnection.getConnectionStats(),j=this.peerClient.getSfuResource(),H=this.subscribeTracker.trackAttempt({stageConnectionStats:O,isReassignment:!0,traceIdOverride:E.traceId,preAttemptSfuResource:j}),X=performance.now();try{this.emit(Gd),this.logger.debug({msg:`Triggering attempt. Current node: ${this.peerClient.getSfuResource().node}`}),yield this.peerClient.connect({iceRestartOptions:E,traceId:E.traceId}),this.logger.debug({msg:`Successful ICE restart attempt. Current node: ${this.peerClient.getSfuResource().node}`});const re=performance.now()-X,se=this.peerClient.getSfuResource(),ee=this.peerClient.getActionMeasurements();(A=this.attemptTracker)===null||A===void 0||A.trackEndSucceeded($s.REASSIGNMENT,this.peerClient.getProtocol()),this.applyVideoControlsBySubscribeType(this.actualSubscribeType,this.actualSubscribeType),H.trackSubscribeStarted({totalDurationWithRetries:re,sfuResource:se,retryTimes:0,peerClientPerfStats:ee,protocol:this.peerClient.getProtocol()}),this.emit(Yf)}catch(re){this.emit(q_),this.logger.error({msg:"ICE restart attempt failed",err:re});const se=this.peerClient.getSfuResource(),ee=H.trackSubscribeFailed(re,this.peerClient.getProtocol(),`iceRestart=true, startNode=${j.node}, endNode=${se?.node}`);throw ee.code===$t.SUBSCRIBE_TIMED_OUT.code&&this.onTrySubscribeFailure(ee,"ice restart timeout"),re}}))}measureFirstFrameDuration({mediaStream:E,subscribeType:A,callback:O}){const j=performance.now(),H=se=>{const ee=performance.now()-j;O(ee,se),se==="audio"?re():X()};let X=Yh,re=Yh;return A!==Ho.AUDIO_ONLY&&(X=(function(se,ee){return Xu(se,"video",ee)})(E,H)),re=(function(se,ee){return Xu(se,"audio",ee)})(E,H),()=>{X(),re()}}}var J,ge;gg=new WeakSet,um=function(C){return C.id===this.id},(function(C){C.JOIN_ERROR="JOIN_ERROR",C.PUBLISH_ERROR="PUBLISH_ERROR",C.SUBSCRIBE_ERROR="SUBSCRIBE_ERROR"})(J||(J={})),(function(C){C[C.TOKEN_MALFORMED=1]="TOKEN_MALFORMED",C[C.TOKEN_EXPIRED=2]="TOKEN_EXPIRED",C[C.TIMEOUT=3]="TIMEOUT",C[C.FAILED=4]="FAILED",C[C.CANCELED=5]="CANCELED",C[C.STAGE_AT_CAPACITY=6]="STAGE_AT_CAPACITY",C[C.CODEC_MISMATCH=7]="CODEC_MISMATCH",C[C.TOKEN_NOT_ALLOWED=8]="TOKEN_NOT_ALLOWED",C[C.STAGE_DELETED=9]="STAGE_DELETED",C[C.PARTICIPANT_DISCONNECTED=10]="PARTICIPANT_DISCONNECTED"})(ge||(ge={}));const ke={[ge.TOKEN_MALFORMED]:"Token is malformed",[ge.TOKEN_EXPIRED]:"Token expired and is no longer valid",[ge.TIMEOUT]:"Operation timed out",[ge.FAILED]:"Operation failed",[ge.CANCELED]:"Operation canceled",[ge.STAGE_AT_CAPACITY]:"Stage at capacity",[ge.CODEC_MISMATCH]:"Client codec is not supported",[ge.TOKEN_NOT_ALLOWED]:"Token not allowed to perform operation",[ge.STAGE_DELETED]:"Stage has been deleted, unable to join",[ge.PARTICIPANT_DISCONNECTED]:"Participant has been disconnected, unable to join"},Ge={[$t.EXPIRED_TOKEN.code]:ge.TOKEN_EXPIRED,[$t.MALFORMED_TOKEN.code]:ge.TOKEN_MALFORMED,[$t.JOIN_SERVER_BAD_REQUEST.code]:ge.FAILED,[$t.TOKEN_PERMISSIONS_DENIED.code]:ge.TOKEN_NOT_ALLOWED,[$t.OPERATION_ABORTED.code]:ge.CANCELED,[$t.JOIN_TIMED_OUT.code]:ge.TIMEOUT,[$t.STAGE_DELETED.code]:ge.STAGE_DELETED,[$t.PARTICIPANT_DISCONNECTED.code]:ge.PARTICIPANT_DISCONNECTED,[$t.EVENT_PLANE_WS_CREATE_FAILED.code]:ge.FAILED,[$t.PUBLISH_TIMED_OUT.code]:ge.TIMEOUT,[$t.PUBLISH_FAILURE.code]:ge.FAILED,[$t.SUBSCRIBE_TIMED_OUT.code]:ge.TIMEOUT,[$t.SUBSCRIBE_FAILURE.code]:ge.FAILED,[$t.STAGE_AT_CAPACITY.code]:ge.STAGE_AT_CAPACITY,[$t.NO_MATCHING_CODEC.code]:ge.CODEC_MISMATCH,[$t.NETWORK_FAILURE.code]:ge.FAILED,[$t.INTERNAL_SERVER_ERROR.code]:ge.FAILED,[$t.REMOTE_STREAM_NOT_FOUND.code]:ge.FAILED,[$t.INTERNAL_MHCP_ERROR.code]:ge.FAILED,[$t.UNREACHABLE_MHCP.code]:ge.FAILED,[$t.INVALID_SESSION_STATUS.code]:ge.FAILED,[$t.MHCP_ABORTED.code]:ge.FAILED,[$t.EVENT_PLANE_PONG_TIMEOUT.code]:ge.FAILED,[$t.EVENT_PLANE_WS_UNEXPECTED_CLOSE.code]:ge.FAILED},st={[$t.SEI_INSERT_NOT_PUBLISHING_VIDEO.code]:"SEI insert failed due to not publishing video",[$t.SEI_INSERT_INBAND_NOT_ENABLED.code]:"SEI insert failed due to in-band messaging not being enabled for the stage stream"};class dt extends Error{constructor(E,A,O){super(),this.code=E,this.category=A,this.message=O,this.name="StageError",this.errorDetails=[],this.message=`[${A}] ${O}`}addDetails(E){this.errorDetails.push(E)}get details(){return this.errorDetails.length?JSON.stringify(this.errorDetails):""}toString(){return`
${this.message}
details - ${this.details}
        `.trim()}}var xt,Gt,Wt;function un(C,E){let A;if(C instanceof hr){if(E===J.JOIN_ERROR&&(C.code===$t.EVENT_PLANE_PONG_TIMEOUT.code||C.code===$t.EVENT_PLANE_WS_UNEXPECTED_CLOSE.code))return;const O=Ge[C.code];O&&(A=(function(j,H,X){var re,se,ee;const he=ke[j],Ee=new dt(j,H,he);return Ee.addDetails({stageErrorMessage:he,stageErrorCode:j,stageErrorCategory:H,stageArn:(re=X.token)===null||re===void 0?void 0:re.stageARN,traceId:(se=X.traceId)===null||se===void 0?void 0:se.value,causeCode:X.code,causeDetails:X.details,causeMessage:X.message,causeLocation:X.location,participantId:(ee=X.token)===null||ee===void 0?void 0:ee.participantID,timeUTC:new Date().toISOString()}),Ee})(O,E,C))}return A}(function(C){C.ERROR="error"})(xt||(xt={}));class Vn extends ea{constructor(E){super(),this.logger=E,this.handleError=(A,O,j=!0)=>{const H=(function(re){let se;return re instanceof hr&&(se=st[re.code]),se})(A),X=un(A,O);if(H&&this.logger.warn({msg:H}),X)return j&&this.emit(xt.ERROR,X),X}}}(function(C){C.INTERNAL="internal",C.REMOTE="remote",C.API="api"})(Gt||(Gt={})),(function(C){C.ADDITIVE="additive",C.REPLACE="replace"})(Wt||(Wt={}));class qn{constructor(E){this.logger=new Gs(E.logger,le.CONNECTION),this.subscribeConfig={defaults:E.subscribeDefaults,participants:{}}}handleSubscribeConfigUpdate(E,A,O,j=Wt.REPLACE){A=(he=>{const Ee=Py(he);if(Ee.jitterBuffer!==void 0){const Ce=Ye=>{if(typeof Ye=="number"){if(Ye<0)return 0;if(Ye>4e3)return 4e3}return Ye};Ee.jitterBuffer.minDelayWhenPublishing!==void 0&&(Ee.jitterBuffer.minDelayWhenPublishing=Ce(Ee.jitterBuffer.minDelayWhenPublishing)),Ee.jitterBuffer.minDelayWhenSubscribeOnly!==void 0&&(Ee.jitterBuffer.minDelayWhenSubscribeOnly=Ce(Ee.jitterBuffer.minDelayWhenSubscribeOnly))}return Ee})(A),this.subscribeConfig.participants[E]===void 0&&(this.subscribeConfig.participants[E]={internalOverrides:{},apiOverrides:{},remoteOverrides:{},lastMerged:this.subscribeConfig.defaults});const H=this.subscribeConfig.participants[E];switch(O){case Gt.INTERNAL:H.internalOverrides=this.handleSubscribeConfigLevelMerging(H.internalOverrides,A,j);break;case Gt.REMOTE:H.remoteOverrides=this.handleSubscribeConfigLevelMerging(H.remoteOverrides,A,j);break;case Gt.API:H.apiOverrides=this.handleSubscribeConfigLevelMerging(H.apiOverrides,A,j);break;default:(function(he){throw new Error(`Unknown case kind: ${he}`)})(O)}const X=Ca(this.subscribeConfig.defaults,H.internalOverrides,H.remoteOverrides,H.apiOverrides);if(X===void 0)return this.logger.warn({msg:`Unable to merge subscribe configs for participant: ${E} | ${H}, ${A}`}),!1;const re=(se=H.lastMerged,ee=X,(typeof se=="object"&&typeof ee=="object"&&(0,Vi.isEqual)(se,ee))===!1);var se,ee;return H.lastMerged=X,this.subscribeConfig.participants[E]=H,re}handleExternalSubscribeConfigUpdate(E,A,O,j=Wt.REPLACE){const H=(X=>{const re={};return typeof X!="object"?pn.err(new Error("Invalid input")):(X.jitterBuffer!==void 0&&(re.jitterBuffer={},X.jitterBuffer.minDelay!==void 0&&(re.jitterBuffer.minDelayWhenSubscribeOnly=X.jitterBuffer.minDelay)),X.inBandMessaging!==void 0&&(re.inBandMessaging={enabled:X.inBandMessaging.enabled===!0}),X.simulcast!==void 0&&(re.simulcast={},X.simulcast.initialLayerPreference!==void 0&&(re.simulcast.initialLayerPreference=X.simulcast.initialLayerPreference)),pn.ok(re))})(A);return H.ok===!0&&this.handleSubscribeConfigUpdate(E,H.value,O,j)}handleSubscribeConfigLevelMerging(E,A,O){if(O===Wt.REPLACE)return A;{const j=Ca(E,A);return j===void 0?(this.logger.warn({msg:`Unable to merge '${E}' and '${A}' with type ${O}`}),E):j}}getSubscribeConfigSnapshot(E){return this.subscribeConfig.participants[E]===void 0?$d(this.subscribeConfig.defaults):$d(this.subscribeConfig.participants[E].lastMerged)}}class sr extends $n{constructor(E){super(xn.REASSIGNMENT_REQUEST,E.token,E.traceId,!1),Object.assign(this.properties,{target_local_participant_id:E.targetLocalParticipantId,target_remote_participant_id:E.targetRemoteParticipantId}),this.critical=!0}}var Vt,tn,nr,Jt,Cn,Tn=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};class Gn extends ea{constructor(E,A){super(),this.setGetStats=O=>{this._getInternalStats=O},this.getStats=()=>Tn(this,void 0,void 0,(function*(){return this.requestRTCStats()})),this.requestRTCStats=()=>Tn(this,void 0,void 0,(function*(){if(!this._getInternalStats)return;const O=yield this._getInternalStats(this.mediaStreamTrack);return O?O.rawReport:void 0})),this._getInternalStats=A,this.id=E.id,this.isMuted=!E.enabled,this.mediaStreamTrack=E,this.streamType=this.mediaStreamTrack.kind==="audio"?vr.AUDIO:vr.VIDEO}cleanup(){this.removeAllListeners(),this._getInternalStats=void 0}}(function(C){C.IDLE="IDLE",C.INITIALIZING="INITIALIZING",C.ACTIVE="ACTIVE",C.CONTROLS_PAUSED="CONTROLS_PAUSED",C.DESTROYED="DESTROYED"})(Vt||(Vt={})),(function(C){C.LAYERS_CHANGED="LAYERS_CHANGED",C.LAYER_SELECTED="LAYER_SELECTED",C.ADAPTION_CHANGED="ADAPTION_CHANGED"})(tn||(tn={})),(function(C){C.LAYERS_CHANGED="LAYERS_CHANGED",C.LAYER_SELECTED="LAYER_SELECTED",C.ADAPTION_CHANGED="ADAPTION_CHANGED"})(nr||(nr={})),(function(C){C.UNAVAILABLE="unavailable",C.SELECTED="selected"})(Jt||(Jt={})),(function(C){C.LOCAL_STREAM_MUTE_CHANGED="localStreamMutedChanged",C.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST="localStreamInsertSeiMsgRequest"})(Cn||(Cn={}));var bn,wn,Vr,Zi=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};class fa extends Gn{constructor(E,A){super(E),this.setMuted=O=>{O!==this.isMuted&&(this.mediaStreamTrack.enabled=!O,this.isMuted=O,this.emit(Cn.LOCAL_STREAM_MUTE_CHANGED,this))},this.insertSeiMessage=(O,j)=>Zi(this,void 0,void 0,(function*(){let H;if(this.streamType==="audio")H=ha.INVALID_TRACK_TYPE;else if(this.mediaConfig.inBandMessaging.enabled){const X=this.validator.validateMessagePayload(O,j?.repeatCount||0);H=pn.getErr(X)}else H=ha.INBAND_MESSAGING_NOT_ENABLED;H?console.warn(`Unable to insert SEI message due to ${H}`):this.emit(Cn.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this,O,j)})),this.requestQualityStats=()=>Zi(this,void 0,void 0,(function*(){if(!this._getInternalStats)return;const O=yield this._getInternalStats(this.mediaStreamTrack);return O?O.stats:void 0})),this.validatedExternalConfig=Ki(E,A),this.normalizedConfig=Wc(0,this.validatedExternalConfig),this.mediaConfig=(0,Vi.cloneDeep)(this.normalizedConfig),this.validator=new td(lh)}}class Ei{constructor(E,A){this.strategy=E,this.logger=A}setStrategy(E){this.strategy=E}hasStrategy(E){return this.strategy[E]!==void 0}stageStreamsToPublish(){let E=[];try{E=this.strategy.stageStreamsToPublish(),E=E.filter((j=>j instanceof fa))}catch(j){return this.logger.warn({msg:"error executing stageStreamsToPublish treating this as a no-op",err:j}),console.error("Error executing stageStreamsToPublish",j),pn.err(j)}let A=0,O=0;for(const j of E)j.mediaStreamTrack.kind==="audio"?A++:j.mediaStreamTrack.kind==="video"&&O++;if(A>1||O>1){const j=Error("stageStreamsToPublish strategy function returned more than 1 video or audio stream and as a result will not publish",{cause:"UserStrategy"});return pn.err(j)}return pn.ok(E)}shouldPublishParticipant(E){try{return pn.ok(this.strategy.shouldPublishParticipant(E))}catch(A){return this.logger.warn({msg:"error executing shouldPublishParticipant treating this as a no-op",err:A}),console.error("Error executing shouldPublishParticipant",A),pn.err(A)}}shouldSubscribeToParticipant(E){try{return pn.ok(this.strategy.shouldSubscribeToParticipant(E))}catch(A){return this.logger.warn({msg:"error executing shouldSubscribeToParticipant. Treating it as a no-op",err:A}),console.error("Error executing shouldSubscribeToParticipant",A),pn.err(A)}}subscribeConfiguration(E){var A,O;try{return pn.ok((O=(A=this.strategy).subscribeConfiguration)===null||O===void 0?void 0:O.call(A,E))}catch(j){return this.logger.warn({msg:"error executing subscribeConfiguration. Treating it as a no-op",err:j}),console.error("Error executing subscribeConfiguration",j),pn.err(j)}}preferredLayerForStream(E,A){var O,j;try{return pn.ok((j=(O=this.strategy).preferredLayerForStream)===null||j===void 0?void 0:j.call(O,E,A))}catch(H){return this.logger.warn({msg:"error executing preferredLayerForStream. Treating it as a no-op",err:H}),console.error("Error executing preferredLayerForStream",H),pn.err(H)}}}class ti extends ea{constructor(E,A){super(),this.audioMuted=!0,this.videoStopped=!0,this.publishState=wn.NOT_PUBLISHED,this.logger=A,this.info=E,this.audioMuted=E.audioMuted,this.videoStopped=E.videoStopped}}(function(C){C.PUBLISH="publish",C.SUBSCRIBE="subscribe"})(bn||(bn={})),(function(C){C.NOT_PUBLISHED="not_published",C.ATTEMPTING_PUBLISH="attempting_publish",C.PUBLISHED="published",C.ERRORED="errored"})(wn||(wn={})),(function(C){C.NOT_SUBSCRIBED="not_subscribed",C.ATTEMPTING_SUBSCRIBE="attempting_subscribe",C.SUBSCRIBED="subscribed",C.ERRORED="errored"})(Vr||(Vr={}));function da(C){return C.map((E=>E.remote))}function qc(C){return{label:C.encodingId,bitrateBps:1e3*C.bitrate,width:C.width,height:C.height,framesPerSecond:C.framesPerSecond,selected:C.selected}}function Jd(C,E){const A=C.width*C.height,O=E.width*E.height;return A>O||C.bitrateBps>E.bitrateBps||C.framesPerSecond>E.framesPerSecond?1:A===O&&C.bitrateBps===E.bitrateBps&&C.framesPerSecond===E.framesPerSecond?0:-1}var Ja=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};class mh extends ea{constructor(E){var A,O,j;super(),this.onAdaptionChanged=H=>{this.emit(nr.ADAPTION_CHANGED,H)},this.onLayersChanged=H=>{this.emit(nr.LAYERS_CHANGED,H)},this.onLayerSelected=(H,X)=>{this.emit(nr.LAYER_SELECTED,H,X)},this.setGetStats=()=>{},this.requestRTCStats=()=>Ja(this,void 0,void 0,(function*(){var H;return(H=this.internalStream)===null||H===void 0?void 0:H.requestRTCStats()})),this.requestQualityStats=()=>Ja(this,void 0,void 0,(function*(){if(this.internalStream)try{const H=yield this.internalStream.getInternalStats();return H?H.stats:void 0}catch{return}})),this.getStats=()=>Ja(this,void 0,void 0,(function*(){var H;return(H=this.internalStream)===null||H===void 0?void 0:H.requestRTCStats()})),this.setMuted=H=>{var X;(X=this.internalStream)===null||X===void 0||X.setMuted(H)},this.getLayers=()=>{var H,X;return(X=(H=this.internalStream)===null||H===void 0?void 0:H.layers)!==null&&X!==void 0?X:this.cachedLayers},this.getSelectedLayer=()=>{var H,X;return(X=(H=this.internalStream)===null||H===void 0?void 0:H.selectedLayer)!==null&&X!==void 0?X:this.cachedSelectedLayer},this.getLowestQualityLayer=()=>{var H,X;return(X=(H=this.internalStream)===null||H===void 0?void 0:H.lowestQualityLayer)!==null&&X!==void 0?X:this.cachedLowestLowestLayer},this.getHighestQualityLayer=()=>{var H,X;return(X=(H=this.internalStream)===null||H===void 0?void 0:H.highestQualityLayer)!==null&&X!==void 0?X:this.cachedHighestQualityLayer},this.internalStream=E,this.cachedId=this.internalStream.id,this.cachedParticipantInfo=(0,Vi.cloneDeep)(this.internalStream.participantInfo),this.cachedStreamType=this.internalStream.streamType,this.cachedMediaStreamTrack=(j=(O=(A=this.internalStream.mediaStreamTrack).clone)===null||O===void 0?void 0:O.call(A))!==null&&j!==void 0?j:{},this.cachedIsMuted=this.internalStream.isMuted,this.cachedIsAdapting=this.internalStream.isAdapting,this.cachedLayers=this.internalStream.layers,this.updateCachedStreamData(),this.internalStream.on(tn.ADAPTION_CHANGED,this.onAdaptionChanged),this.internalStream.on(tn.LAYERS_CHANGED,this.onLayersChanged),this.internalStream.on(tn.LAYER_SELECTED,this.onLayerSelected)}updateCachedStreamData(){var E,A,O,j,H;this.cachedLayers=(A=(E=this.internalStream)===null||E===void 0?void 0:E.layers)!==null&&A!==void 0?A:[],this.cachedHighestQualityLayer=(O=this.internalStream)===null||O===void 0?void 0:O.highestQualityLayer,this.cachedLowestLowestLayer=(j=this.internalStream)===null||j===void 0?void 0:j.lowestQualityLayer,this.cachedSelectedLayer=(H=this.internalStream)===null||H===void 0?void 0:H.selectedLayer}get id(){var E,A;return(A=(E=this.internalStream)===null||E===void 0?void 0:E.id)!==null&&A!==void 0?A:this.cachedId}get participantInfo(){var E,A;return(A=(E=this.internalStream)===null||E===void 0?void 0:E.participantInfo)!==null&&A!==void 0?A:this.cachedParticipantInfo}get streamType(){var E,A;return(A=(E=this.internalStream)===null||E===void 0?void 0:E.streamType)!==null&&A!==void 0?A:this.cachedStreamType}get mediaStreamTrack(){var E,A;return(A=(E=this.internalStream)===null||E===void 0?void 0:E.mediaStreamTrack)!==null&&A!==void 0?A:this.cachedMediaStreamTrack}get isMuted(){var E,A;return(A=(E=this.internalStream)===null||E===void 0?void 0:E.isMuted)!==null&&A!==void 0?A:this.cachedIsMuted}set isMuted(E){var A;(A=this.internalStream)===null||A===void 0||A.setMuted(E)}get isAdapting(){var E,A;return(A=(E=this.internalStream)===null||E===void 0?void 0:E.isAdapting)!==null&&A!==void 0?A:this.cachedIsAdapting}cleanup(){var E,A,O;this.updateCachedStreamData(),(E=this.internalStream)===null||E===void 0||E.off(tn.ADAPTION_CHANGED,this.onAdaptionChanged),(A=this.internalStream)===null||A===void 0||A.off(tn.LAYERS_CHANGED,this.onLayersChanged),(O=this.internalStream)===null||O===void 0||O.off(tn.LAYER_SELECTED,this.onLayerSelected),this.internalStream=void 0,this.removeAllListeners()}}var Yc,Tl,sv=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};class hm extends Gn{constructor({track:E,info:A,getStats:O,remotePlaybackController:j,analyticsTracker:H,token:X,subscribeConfig:re}){super(E,O),this.hasRemoteListenersForLayerEvents=()=>{const ee=this.remote;return ee.hasListenersFor(nr.ADAPTION_CHANGED)||ee.hasListenersFor(nr.LAYERS_CHANGED)||ee.hasListenersFor(nr.LAYER_SELECTED)},this.setMuted=ee=>{this.isMuted=ee,this.mediaStreamTrack.enabled=!ee},this.setLayer=ee=>{const he=(0,Vi.cloneDeep)(ee);if(this.queueLayerUpdateForValidState(he))return void this.logger.debug({msg:`setLayer:${he} queued, skipping for now`});const Ee=(function(Ye,gt){if(!Ye)return(0,pn.ok)(void 0);const ft=typeof Ye=="string"?Ye:Ye.label,lt=gt.filter((et=>et.label===ft))[0];return lt?(0,pn.ok)(lt):(0,pn.err)(`Provided layer with id ${ft} does not exist`)})(he,this._layers);if(!Ee.ok){const Ye=Ee.error;return void this.logger.error({err:Ye,msg:"Unable to select layer, skipping selection"})}const Ce=Ee.value;if(this.isNextUpdateAdaptionOnly(Ce))return this.logger.warn({msg:"setLayer:dynamic"}),void this.handleDynamicUpdate();this.isFirstLayerUpdate()||!this.isRepeatLayerSelection(Ce)||this.isAdapting?Ce&&(this.logger.warn({msg:`setLayer:${JSON.stringify(Ce)} `}),this.handleManualUpdate(Ce)):this.logger.debug({msg:"Setting the same layer, same adaption state, skipping selection"})},this.state=Vt.INITIALIZING,this.prevState=Vt.IDLE,this.analyticsTracker=H,this.token=X,this.id=E.id,this.info=A,this.mediaStreamTrack=E,this.remotePlaybackController=j,this.layerPollingIntervalId=null,this.weakRemoteMap=new WeakMap,this.weakRemoteKey={id:"remote"},this.commandMap=new Map,this.subscribeConfig=re,this._isAdapting=!0,this._layers=[],this._selectedLayer=null;const se=x_();this.logger=new Gs(new zc(se),le.REMOTE_STAGE_STREAM),this.streamType===vr.AUDIO?this.isMuted=A.audioMuted:this.isMuted=A.videoStopped,this.initializeLayerPolling(),this.pollInternalLayers(!0)}transitionStateTo(E){this.state!==E&&(this.prevState=this.state,this.state=E)}initializeLayerPolling(){Bd(this.mediaStreamTrack)?this.streamType!==vr.AUDIO?(this.logger.debug({msg:"Setting up RemoteStageStream, requesting initial layers"}),this.layerPollingIntervalId!==null&&clearInterval(this.layerPollingIntervalId),this.layerPollingIntervalId=setInterval((()=>{this.pollInternalLayers()}),this.subscribeConfig.simulcast.layerPollingIntervalMs)):this.logger.debug({msg:"Skipping initializing polling for audio streams"}):this.logger.debug({msg:"Skipping initializing polling, media track is not active"})}startLayerPolling(){this.layerPollingIntervalId===null?this.initializeLayerPolling():this.logger.debug({msg:"Skipping start polling request, already started"})}stopLayerPolling(){this.layerPollingIntervalId!==null?(clearInterval(this.layerPollingIntervalId),this.layerPollingIntervalId=null):this.logger.debug({msg:"Skipping stop polling request, already stopped"})}pollInternalLayers(E=!1){if(!Bd(this.mediaStreamTrack))return void this.pauseControls();if(this.streamType===vr.AUDIO)return this.logger.debug({msg:"Skipping layer poll request for audio stream"}),void this.transitionStateTo(Vt.ACTIVE);const A=!this.hasRemoteListenersForLayerEvents(),O=!this.subscribeConfig.simulcast.layerPollingEnabled;!E&&A&&O?this.logger.debug({msg:"Skipping layer request due to no listeners"}):this.remotePlaybackController.getLayers().then((j=>{if(this.isStateValidForLayerUpdates()){if(!j.ok)throw Error(j.error);this.updateInternalLayersFromRemote(j.value),this.transitionStateTo(Vt.ACTIVE),this.flushCommandQueue()}else this.logger.warn({msg:"Stream controls have been paused, skipping getLayers"})})).catch((j=>{this.logger.error({err:j,msg:"Error calling getLayers, returning current layers"})}))}updateInternalLayersFromRemote(E){const A=this._layers,O=E.map(qc).sort(Jd),j=!(0,Vi.isEqual)(O,A);this._layers=O;const H=this._selectedLayer,X=this._layers.filter((se=>se.selected))[0],re=!(0,Vi.isEqual)(X,H);H&&(H.selected=!1),this._selectedLayer=X,re&&(this.trackLayerUpdate(H),this.trackLayerUpdate(X)),this.isCommandQueueEmpty()&&(j&&this.emitLayersChanged(),re&&this.emitLayerSelected(X))}flushCommandQueue(){if(this.isCommandQueueEmpty())return;const E=Array.from(this.commandMap.keys());this.logger.debug({msg:`Flushing active commands from map ${E}`});for(const A of this.commandMap.keys()){const O=this.commandMap.get(A);O?.()}this.commandMap.clear()}queueLayerUpdateForValidState(E){if(!E)return this.commandMap.delete("setLayer"),!1;if(this.state===Vt.INITIALIZING){const A=this.setLayer.bind(this,E);return this.commandMap.set("setLayer",A),!0}return!1}handleDynamicUpdate(){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const E=this._isAdapting;this._isAdapting=!0,this.emitAdaptionChanged(),this.remotePlaybackController.unsetLayer().then((A=>{if(!this.isStateValidForLayerUpdates())return this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"}),void this.resetAdaptionStateOnError(E,`Stream in invalid state: ${this.state}`);A.ok?this.logger.debug({msg:"Layer successfully unset, restarting dynamic adaption"}):this.resetAdaptionStateOnError(E,A.error)})).catch((()=>{}))}resetAdaptionStateOnError(E,A){this._isAdapting=E,this.emitAdaptionChanged(),this.logger.error({err:A,msg:"Error unsetting layer, reverting adaption state"})}handleManualUpdate(E){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping manual updates"});const A=this._isAdapting,O=this._selectedLayer;O&&(O.selected=!1),this._isAdapting=!1,this._selectedLayer=E,E.selected=!0,A!==this._isAdapting&&this.emitAdaptionChanged(),this.updateLocalLayerStateBeforeRemote(E,O),this.trackLayerUpdate(O),this.trackLayerUpdate(E),this.emitLayersChanged(),this.emitLayerSelected(E),this.remotePlaybackController.setLayer(E.label).then((j=>{if(!this.isStateValidForLayerUpdates()){this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const H=`Stream in invalid state: ${this.state}`;return this.resetAdaptionStateOnError(A,H),void this.resetLayerOnError(O,E,H)}if(!j.ok){const H=j.error;return this.resetAdaptionStateOnError(A,H),void this.resetLayerOnError(O,E,H)}this.logger.debug({msg:`Layer successfully selected: ${E.label}`})})).catch((()=>{}))}applyExistingControlState(){var E;this._isAdapting?this.remotePlaybackController.unsetLayer().then((()=>{})).catch((()=>{})):!((E=this._selectedLayer)===null||E===void 0)&&E.label&&this.remotePlaybackController.setLayer(this._selectedLayer.label).then((()=>{})).catch((()=>{}))}resetLayerOnError(E,A,O){A&&(A.selected=!1),E&&(E.selected=!0),this._selectedLayer=E,this.logger.error({err:O,msg:"Error unsetting layer, leaving current selection in place"}),this.updateLocalLayerStateBeforeRemote(E,A),this.emitLayersChanged(),E!==null&&this.emitLayerSelected(E,Jt.UNAVAILABLE),this.trackLayerUpdate(A),this.trackLayerUpdate(E)}updateLocalLayerStateBeforeRemote(E,A){this._layers=this._layers.map((O=>O.label===E?.label?E:O.label===A?.label?A:O)).sort(Jd)}trackLayerUpdate(E){var A,O;this.analyticsTracker.trackEventNoSharedProps(new J_(this.token,oa(),(A=E?.label)!==null&&A!==void 0?A:"auto",!0,yn.SUBSCRIBE,(O=E?.selected)!==null&&O!==void 0&&O,this.info.id))}isNextUpdateAdaptionOnly(E){return E===void 0&&this.isFirstLayerUpdate()||E===void 0&&!this.isAdapting}isFirstLayerUpdate(){return this._selectedLayer===null}isRepeatLayerSelection(E){var A;return((A=this._selectedLayer)===null||A===void 0?void 0:A.label)===E?.label}isStateValidForLayerUpdates(){return this.state===Vt.ACTIVE||this.state===Vt.INITIALIZING}isCommandQueueEmpty(){return this.commandMap.size===0}emitLayerSelected(E,A=Jt.SELECTED){this.logger.debug({msg:`Emitting layers selected ${JSON.stringify(E,null,2)}`}),this.emit(tn.LAYER_SELECTED,(0,Vi.cloneDeep)(E),A)}emitLayersChanged(){this.emit(tn.LAYERS_CHANGED,(0,Vi.cloneDeep)(this._layers))}emitAdaptionChanged(){this.emit(tn.ADAPTION_CHANGED,this._isAdapting)}get remote(){const E=this.weakRemoteMap.get(this.weakRemoteKey);if(E)return E;const A=new mh(this);return this.weakRemoteMap.set(this.weakRemoteKey,A),A}get participantInfo(){return(0,Vi.cloneDeep)(this.info)}get isAdapting(){return this._isAdapting}get layers(){return(0,Vi.cloneDeep)(this._layers)}get selectedLayer(){var E;return(0,Vi.cloneDeep)((E=this._selectedLayer)!==null&&E!==void 0?E:void 0)}get highestQualityLayer(){return(0,Vi.cloneDeep)(this.layers[this.layers.length-1])}get lowestQualityLayer(){return(0,Vi.cloneDeep)(this.layers[0])}getInternalStats(){return sv(this,void 0,void 0,(function*(){if(this._getInternalStats)return this._getInternalStats(this.mediaStreamTrack)}))}pauseControls(){this.transitionStateTo(Vt.CONTROLS_PAUSED),this.stopLayerPolling()}resumeControls(){this.applyExistingControlState(),this.startLayerPolling(),this.transitionStateTo(Vt.ACTIVE)}updateSubscribeConfig(E){const A=this.subscribeConfig;this.subscribeConfig=E,A.simulcast.layerPollingIntervalMs!==E.simulcast.layerPollingIntervalMs&&this.isStateValidForLayerUpdates()&&this.initializeLayerPolling()}cleanup(){this.transitionStateTo(Vt.DESTROYED),super.cleanup(),this.weakRemoteMap.delete(this.weakRemoteKey),this.stopLayerPolling(),this._layers=[],this._selectedLayer=null,this._isAdapting=!0,this.commandMap.clear()}}(function(C){C.STATE_CHANGE="stateChange",C.MEDIA_STREAM_ADDED="mediaStreamAdded",C.MEDIA_STREAM_REMOVED="mediaStreamRemoved",C.MEDIA_STREAM_MUTE_CHANGED="mediaStreamMuteChanged",C.ERROR="error"})(Yc||(Yc={})),(function(C){C.SUBSCRIPTION_STATE_CHANGE="subscriptionStateChange",C.MEDIA_STREAM_SEI_MESSAGE_RECEIVED="mediaStreamSeiMessageReceived"})(Tl||(Tl={}));const lo=Object.assign(Object.assign({},Yc),Tl);var hf;(function(C){C.PUBLICATION_STATE_CHANGE="publicationStateChange"})(hf||(hf={}));const pa=Object.assign(Object.assign({},Yc),hf);var _g=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};class gh extends ti{constructor(E,A,O,j,H,X,re,se=!1){super(E,new Gs(j,le.REMOTE_PARTICIPANT)),this.subscribeState=Vr.NOT_SUBSCRIBED,this.reassigning=!1,this.streams=[],this.left=!1,this.onSubscriptionStateChange=ee=>{this.logger.debug({msg:"subscriptionStateChange",state:ee}),ee===ci.DISCONNECTED?this.updateSubscriptionState(Vr.NOT_SUBSCRIBED):ee===ci.CONNECTED?this.updateSubscriptionState(Vr.SUBSCRIBED):ee===ci.CONNECTING?this.updateSubscriptionState(Vr.ATTEMPTING_SUBSCRIBE):ee===ci.ERRORED?(this.emitStreamsRemovedByType(this.getDesiredSubscribeType()),this.cleanupStreams(),this.updateSubscriptionState(Vr.ERRORED)):this.logger.warn({msg:"FIXME onSubscriptionStateChange UNHANDLED STATE",state:ee})},this.onSubscriptionStreamRemoved=()=>{this.logger.debug({msg:"onSubscriptionStreamRemoved"}),this.emitStreamsRemovedByType(this.getDesiredSubscribeType()),this.cleanupStreams()},this.onSubscriptionStreamCreated=(ee,he)=>{this.logger.debug({msg:"onSubscriptionStreamCreated",stream:ee}),this.pruneInactiveStreams();let Ee=ee.getTracks().map((Ce=>{const Ye=new hm({track:Ce,info:this.info,getStats:this.subscription.requestRTCStats,remotePlaybackController:he,analyticsTracker:this.analyticsTracker,token:this.token,subscribeConfig:this.subscribeConfig});return this.streams.push(Ye),Ye}));this.subscription.getDesiredSubscribeType()===Ho.AUDIO_ONLY&&(Ee=Ee.filter((Ce=>Ce.streamType!==vr.VIDEO))),this.emit(lo.MEDIA_STREAM_ADDED,Ee)},this.onSubscriptionError=ee=>{this.emit(lo.ERROR,ee)},this.onSubscriptionSeiMessageReceived=ee=>{this.emit(lo.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,ee)},this.onSubscriptionTransformError=ee=>{this.emit(lo.ERROR,ee)},this.onSubscriptionReassignmentStart=()=>{for(const ee of this.streams)ee.pauseControls()},this.onSubscriptionReassignmentDone=()=>{for(const ee of this.streams)ee.resumeControls()},this.updateSubscribeStateIfNecessary=(ee,he)=>{if(!this.info.capabilities.has(bn.SUBSCRIBE))return;he!==void 0&&(this.subscribeConfig=he,this.subscription.updateSubscribeConfig(he),this.streams.forEach((Ye=>{Ye.updateSubscribeConfig(he)})));const Ee=ee!==Ho.NONE&&this.publishState===wn.PUBLISHED,Ce=this.subscribeState!==Vr.NOT_SUBSCRIBED&&this.subscribeState!==Vr.ERRORED;if(Ee&&!Ce)this.subscription.updateDesiredSubscribeType(ee),this.subscribe();else if(!Ee&&Ce)this.unsubscribe(),this.subscription.updateDesiredSubscribeType(ee);else if(this.subscribeState===Vr.SUBSCRIBED&&this.subscription.getDesiredSubscribeType()!==ee)try{ee===Ho.AUDIO_ONLY?this.emit(lo.MEDIA_STREAM_REMOVED,this.filterStreamsByType(this.streams,vr.VIDEO)):ee===Ho.AUDIO_VIDEO&&this.emit(lo.MEDIA_STREAM_ADDED,this.filterStreamsByType(this.streams,vr.VIDEO)),this.subscription.updateDesiredSubscribeType(ee)}catch(Ye){this.logger.error({err:Ye,msg:"error updating subscribe type"})}},this.updatePublishState=ee=>{const he=ee&&this.publishState===wn.PUBLISHED,Ee=!ee&&this.publishState===wn.NOT_PUBLISHED;return!he&&!Ee&&(this.info.isPublishing=ee,this.publishState=ee?wn.PUBLISHED:wn.NOT_PUBLISHED,!0)},this.updateStreamState=(ee,he)=>{this.audioMuted!==ee&&(this.audioMuted=ee,this.info.audioMuted=ee,this.updateStreamMuteState(vr.AUDIO,ee)),this.videoStopped!==he&&(this.videoStopped=he,this.info.videoStopped=he,this.updateStreamMuteState(vr.VIDEO,he))},this.updateStreamMuteState=(ee,he)=>{const Ee=this.filterStreamsByType(this.streams,ee),Ce=Ee[Ee.length-1];if(!Ce){const Ye=`state update received for ${this.info.id} for non-existent ${ee} stream`;return this.logger.warn({msg:Ye}),void this.traceRemoteParticipantMsg(Ye)}Ce.setMuted(he),this.emit(lo.MEDIA_STREAM_MUTE_CHANGED,Ce)},this.cleanup=()=>{this.removeAllListeners()},this.quickUnsubscribe=()=>this.subscribeState!==Vr.NOT_SUBSCRIBED&&this.subscription.stop(!0),this.getDesiredSubscribeType=()=>this.subscription.getDesiredSubscribeType(),this.isReassigning=()=>this.reassigning,this.analyticsTracker=re,this.token=A,this.subscribeConfig=X,this.createSubscription=()=>{const ee=new D(E.id,A,O,j,re,H,X);return ee.on(vl,this.onSubscriptionStateChange),ee.on(oh,this.onSubscriptionStreamCreated),ee.on(qf,this.onSubscriptionStreamRemoved),ee.on($_,this.onSubscriptionError),ee.on(Cy,this.onSubscriptionSeiMessageReceived),ee.on(W_,this.onSubscriptionTransformError),ee.on(Gd,this.onSubscriptionReassignmentStart),ee.on(Yf,this.onSubscriptionReassignmentDone),ee.on(q_,this.onSubscriptionReassignmentDone),ee},this.subscription=this.createSubscription(),se&&(this.publishState=wn.PUBLISHED)}updateSubscriptionState(E){E!==this.subscribeState&&(this.subscribeState=E,this.emit(lo.SUBSCRIPTION_STATE_CHANGE,this.subscribeState))}pruneInactiveStreams(){const E=[];this.streams=this.streams.filter((H=>!!Bd(H.mediaStreamTrack)||(E.push(H),!1)));const A=E.length;if(A===0)return;const O=this.filterStreamsByType(E,vr.AUDIO).length,j=A-O;this.traceRemoteParticipantMsg(`Pruning inactive streams (${O} audio, ${j} video)`),this.emitStreamsRemoved(E),E.forEach((H=>{H.remote.cleanup(),H.cleanup()}))}filterStreamsByType(E,A){return E.filter((O=>O.streamType===A))}participantLeave(){this.left=!0}subscribe(){this.left?this.logger.warn({msg:"tried to subscribe to a participant that left"}):(this.updateSubscriptionState(Vr.ATTEMPTING_SUBSCRIBE),this.logger.debug({msg:"subscribe"}),this.subscription.start())}unsubscribe(){if(this.subscribeState===Vr.NOT_SUBSCRIBED)return;this.logger.debug({msg:"unsubscribe"}),this.subscription.stop(),this.subscription.off(vl,this.onSubscriptionStateChange),this.subscription.off(oh,this.onSubscriptionStreamCreated),this.subscription.off(qf,this.onSubscriptionStreamRemoved),this.subscription.off($_,this.onSubscriptionError),this.subscription.off(W_,this.onSubscriptionTransformError);const E=this.getDesiredSubscribeType();this.subscription=this.createSubscription(),this.emitStreamsRemovedByType(E),this.updateSubscriptionState(Vr.NOT_SUBSCRIBED),this.cleanupStreams()}emitStreamsRemovedByType(E){switch(E){case Ho.AUDIO_VIDEO:this.emitStreamsRemoved(this.streams);break;case Ho.AUDIO_ONLY:this.emitStreamsRemoved(this.filterStreamsByType(this.streams,vr.AUDIO));case Ho.NONE:}}emitStreamsRemoved(E){this.emit(lo.MEDIA_STREAM_REMOVED,E)}cleanupStreams(){this.streams.length!==0&&(this.logger.debug({msg:"Cleaning up streams due to internal removal"}),this.streams.forEach((E=>{E.remote.cleanup(),E.cleanup()})),this.streams=[])}traceRemoteParticipantMsg(E){this.analyticsTracker.trackEventNoSharedProps(new Xf(this.token,oa(),E,yn.SUBSCRIBE,this.info.id))}triggerIceRestart(E){return _g(this,void 0,void 0,(function*(){this.reassigning=!0;try{yield this.subscription.triggerIceRestart(E)}finally{this.reassigning=!1}}))}}const ff=yn.PUBLISH;function xS(C,E,A){return new hr(Object.assign(Object.assign({},C),{token:E,traceId:A,location:"stage-publication.sendSeiMessage",tag:_l,action:yn.PUBLISH}))}class ET{constructor(E,A){this.analyticsTracker=E,this.token=A,this.action=ff,this.traceId=oa()}trackPublish(E){const{action:A,traceId:O,analyticsTracker:j,token:H}=this;return j.trackEvent(new of({token:H,traceId:O})),{getTraceId:()=>O,trackPublishStarted({totalDurationWithRetries:X,retryTimes:re,sfuResource:se,peerClientPerfStats:ee,protocol:he}){const{optionsDuration:Ee,postDuration:Ce,timeToCandidate:Ye,timeToConnected:gt,sdpExchangeDuration:ft,sdpExchangeTransport:lt,setRemoteDescDuration:et,peerConnectionDuration:ot}=ee,{edpInitialConnectDuration:Mt,edpInitialConnectRetries:gn,edpInitialStateDuration:Bn,edpStateUpdateCount:Wn}=E;j.trackEvent(new Lr({token:H,traceId:O,optionsDuration:Ee,postDuration:Ce,timeToCandidate:Ye,totalDuration:gt,edpInitialConnectDuration:Mt,edpInitialConnectRetries:gn,edpInitialStateDuration:Bn,edpStateUpdateCount:Wn,sdpExchangeDuration:ft,sdpExchangeTransport:lt,setRemoteDescDuration:et,peerConnectionDuration:ot,publishRetries:re,totalDurationWithRetries:X,sfuResource:se,protocol:he}))},trackPublishFailed(X,re){const se=((he,Ee,Ce)=>{if(he instanceof hr)return he;let Ye="";return he instanceof lc.AxiosError&&(Ye+=`AxiosError - ${he.code}`),new hr(Object.assign(Object.assign(Object.assign({},$t.PUBLISH_FAILURE),{action:ff,token:Ee,traceId:Ce,tag:_l,location:"publish",details:`${Ye} ${he.message}`}),{fatal:!0}))})(X,H,O);j.trackEvent(new Wl({token:H,traceId:O,code:se.code,message:se.message,fatal:se.fatal,nominal:se.nominal,protocol:re}));const ee=new hr(Object.assign(Object.assign({},$t.PUBLISH_FAILURE),{action:A,token:H,traceId:O,tag:_l,location:"publish"}));return X instanceof hr&&(ee.fatal=X.fatal,ee.nominal=X.nominal,ee.location=`publish > ${X.location}`),j.trackError(ee),se},trackUnpublish:()=>{j.trackEvent(new $l({token:H,traceId:O}))},trackEndSucceeded:(X,re)=>{j.trackEvent(new Xr({token:H,isUnpublishSuccessful:!0,traceId:O,reason:X,protocol:re}))},trackEndFailed:(X,re)=>{const se=new hr(Object.assign(Object.assign({},$t.UNPUBLISH_FAILURE),{token:H,traceId:O,tag:wy,location:"unpublish"}));return X!==$s.UNLOAD&&X!==$s.UNPUBLISH||this.analyticsTracker.trackError(se),j.trackEvent(new Xr({token:H,isUnpublishSuccessful:!1,traceId:O,reason:X,protocol:re})),se},createSeiNotPublishingVideoError:()=>xS($t.SEI_INSERT_NOT_PUBLISHING_VIDEO,H,O),createSeiInBandMessagingNotEnabledError:()=>xS($t.SEI_INSERT_INBAND_NOT_ENABLED,H,O)}}}var Vo,Kc,v=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};(function(C){C.DISCONNECTED="disconnected",C.CONNECTING="connecting",C.CONNECTED="connected",C.ERRORED="errored"})(Vo||(Vo={})),(function(C){C.STATE_CHANGE="stateChange",C.ERROR="error",C.TRANSFORM_ERROR="transformError"})(Kc||(Kc={}));class S extends ea{constructor(E,A,O,j){super(),this.token=E,this.stageConnection=A,this.nonScopedLogger=O,this.analyticsTracker=j,this.streamsToPublish=[],this.publicationState=Vo.DISCONNECTED,this.latestPubAttemptNum=0,this.startConnectingTimestamp=-1,this.action=yn.PUBLISH,this.start=H=>{this.publicationState===Vo.DISCONNECTED||this.publicationState===Vo.ERRORED?(this.streamsToPublish=H,this.latestPubAttemptNum=0,this.processStateUpdate()):this.logger.warn({msg:"publication cannot be started if not in disconnected or error state"})},this.requestRTCStats=H=>v(this,void 0,void 0,(function*(){return this.peerClient.requestRTCStats(H)})),this.stop=(H=!1)=>v(this,void 0,void 0,(function*(){this.peerClient.off(Bl,this.onPeerClientConnectionStateChange),this.peerClient.off(fl,this.onPeerClientTransformError),yield this.unpublish(H),this.updateState(Vo.DISCONNECTED)})),this.processStateUpdate=H=>{const{publicationState:X}=this;X===Vo.DISCONNECTED||X===Vo.ERRORED?this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(Vo.CONNECTING),this.tryPublish()):X===Vo.CONNECTING?H===Zn.CONNECTED&&this.updateState(Vo.CONNECTED):X===Vo.CONNECTED&&H===Zn.FAILED&&(this.attemptTracker&&this.attemptTracker.trackEndFailed($s.CONNECTION_FAIL,this.peerClient.getProtocol()),this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(Vo.CONNECTING),this.tryPublish()))},this.updateState=H=>{this.publicationState=H,this.emit(Kc.STATE_CHANGE,H)},this.tryPublish=()=>v(this,void 0,void 0,(function*(){if(this.latestPubAttemptNum++,this.latestPubAttemptNum<=4){const H=this.stageConnection.getConnectionStats();this.attemptTracker=this.publishTracker.trackPublish(H);try{this.logger.debug({msg:`attempting to publish, attemptNum: ${this.latestPubAttemptNum}`}),yield this.publish(this.streamsToPublish,this.attemptTracker.getTraceId()),this.logger.debug({msg:"publish succeeded!"});const X=this.peerClient.getSfuResource(),re=this.latestPubAttemptNum-1,se=performance.now()-this.startConnectingTimestamp,ee=this.peerClient.getActionMeasurements();this.attemptTracker.trackPublishStarted({sfuResource:X,totalDurationWithRetries:se,retryTimes:re,peerClientPerfStats:ee,protocol:this.peerClient.getProtocol()}),this.latestPubAttemptNum=0}catch(X){this.logger.error({msg:"publish failed!",err:X});const re=this.attemptTracker.trackPublishFailed(X,this.peerClient.getProtocol()),se=re.code===$t.OPERATION_ABORTED.code,ee=re.fatal,he=this.latestPubAttemptNum===4;if(se)return;if(ee||he)return this.logger.error({msg:`Stopping attempts: isFatal=${ee}, isLastAttempt=${he}`,err:X}),this.updateState(Vo.ERRORED),void this.emit(Kc.ERROR,re);const Ee=1e3*Math.pow(2,this.latestPubAttemptNum);this.logger.debug({msg:`attempt failed, retrying in ${Ee}ms`}),this.nextAttemptTimerId=window.setTimeout((()=>{this.tryPublish()}),Ee)}}})),this.publish=(H,X)=>v(this,void 0,void 0,(function*(){this.peerClient.initStreamsToPublish(H),yield this.peerClient.connect({audioOnly:!1,traceId:X})})),this.unpublish=(H=!1)=>v(this,void 0,void 0,(function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.publicationState===Vo.DISCONNECTED||this.publicationState===Vo.ERRORED||!this.attemptTracker)return;this.attemptTracker.trackUnpublish();const X=H?$s.UNLOAD:$s.UNPUBLISH,re=this.peerClient.getProtocol();try{H?this.peerClient.disconnect(H):yield this.peerClient.disconnect(H),this.attemptTracker.trackEndSucceeded(X,re)}catch{this.attemptTracker.trackEndFailed(X,re)}})),this.replaceOrUpdateStream=H=>v(this,void 0,void 0,(function*(){this.streamsToPublish.find((X=>X.track.kind===H.track.kind))?this.streamsToPublish=this.streamsToPublish.map((X=>X.track.kind===H.track.kind?H:X)):this.streamsToPublish.push(H),yield this.peerClient.replaceOrUpdateStream(H)})),this.onPeerClientConnectionStateChange=H=>{this.logger.debug({msg:`onPeerClientConnectionStateChange: ${H}`,state:H}),this.processStateUpdate(H)},this.onPeerClientTransformError=H=>{this.emit(Kc.TRANSFORM_ERROR,H)},this.onIncompatibleCodecs=H=>v(this,void 0,void 0,(function*(){yield this.peerClient.onIncompatibleCodecs(H)})),this.sendSeiMessage=(H,X)=>{if(this.publicationState!==Vo.CONNECTED)return this.attemptTracker&&this.emit(Kc.ERROR,this.attemptTracker.createSeiNotPublishingVideoError()),pn.err(ha.NOT_PUBLISHING_VIDEO);const re=this.peerClient.sendSeiMessage(H,X),se=pn.getErr(re);return se&&this.attemptTracker&&(se===ha.INBAND_MESSAGING_NOT_ENABLED?this.emit(Kc.ERROR,this.attemptTracker.createSeiInBandMessagingNotEnabledError()):se===ha.NOT_PUBLISHING_VIDEO&&this.emit(Kc.ERROR,this.attemptTracker.createSeiNotPublishingVideoError())),re},this.peerClient=new lf(E,this.nonScopedLogger,this.action,ms(this.action),oa(),this.analyticsTracker,void 0,A,void 0),this.logger=new Gs(O,le.PUBLICATION),this.peerClient.on(Bl,this.onPeerClientConnectionStateChange),this.peerClient.on(fl,this.onPeerClientTransformError),this.publishTracker=new ET(this.analyticsTracker,this.token)}removeTrack(E){return v(this,void 0,void 0,(function*(){this.streamsToPublish=this.streamsToPublish.filter((A=>A.track.kind!==E)),yield this.peerClient.removeTrack(E)}))}}var N,G=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};class oe extends ti{constructor(E,A,O,j,H){super(E,new Gs(O,le.LOCAL_PARTICIPANT)),this.onPublicationStateChange=X=>{switch(this.logger.debug({msg:"publicationStateChange",state:X}),X){case"connected":this.connection.setStagePublishing(!0),this.updatePublishState(wn.PUBLISHED);break;case"connecting":this.updatePublishState(wn.ATTEMPTING_PUBLISH);break;case"errored":this.updatePublishState(wn.ERRORED),this.connection.setStagePublishing(!1);break;default:return void this.logger.warn({msg:"FIXME onPublicationStateChange UNHANDLED STATE",state:X})}},this.onPublicationError=X=>{this.emit(pa.ERROR,X)},this.updatePublishState=X=>{this.info.isPublishing=X===wn.PUBLISHED,this.publishState=X,this.emit(pa.PUBLICATION_STATE_CHANGE,this.publishState)},this.handleMute=X=>{X.streamType===vr.AUDIO&&(this.audioMuted=X.isMuted,this.info.audioMuted=X.isMuted),X.streamType===vr.VIDEO&&(this.videoStopped=X.isMuted,this.info.videoStopped=X.isMuted),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.emit(pa.MEDIA_STREAM_MUTE_CHANGED,X)},this.handleInsertSeiMsgRequest=(X,re,se)=>{this.sendSeiMessage(re,se?.repeatCount)},this.publish=X=>{this.logger.debug({msg:"publish"}),X.forEach((se=>{se&&(this.setupStreamListeners(se),se.streamType===vr.AUDIO?(this.audioStream=se,this.audioMuted=!se.mediaStreamTrack.enabled,this.info.audioMuted=this.audioMuted):se.streamType===vr.VIDEO&&(this.videoStream=se,this.videoStopped=!se.mediaStreamTrack.enabled,this.info.videoStopped=this.videoStopped),se.setGetStats(this.publication.requestRTCStats))})),this.connection.emitStageState(this.audioMuted,this.videoStopped);const re=X.map((se=>sf(se)));this.publication.start(re)},this.cleanup=()=>this.removeAllListeners(),this.quickUnpublish=()=>this.publishState!==wn.NOT_PUBLISHED&&this.publishState!==wn.ERRORED&&void this.publication.stop(!0),this.onIncompatibleCodecs=X=>G(this,void 0,void 0,(function*(){yield this.publication.onIncompatibleCodecs(X)})),this.sendSeiMessage=(X,re=0)=>this.publication.sendSeiMessage(X,re),this.sendSeiMessageString=(X,re=0)=>{const se=new TextEncoder().encode(X);return this.publication.sendSeiMessage(se,re)},this.connection=j,this.createPublication=()=>{const X=new S(A,j,O,H);return X.on(Kc.STATE_CHANGE,this.onPublicationStateChange),X.on(Kc.ERROR,this.onPublicationError),X.on(Kc.TRANSFORM_ERROR,this.onPublicationError),X},this.publication=this.createPublication()}setupStreamListeners(E){E.on(Cn.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),E.streamType===vr.VIDEO&&E.on(Cn.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this.handleInsertSeiMsgRequest)}removeTrack(E){var A,O,j;E.streamType===vr.AUDIO?((A=this.audioStream)===null||A===void 0||A.off(Cn.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),this.audioStream=void 0,this.audioMuted=!0,this.info.audioMuted=!0):E.streamType===vr.VIDEO&&((O=this.videoStream)===null||O===void 0||O.off(Cn.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),(j=this.videoStream)===null||j===void 0||j.off(Cn.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this.handleMute),this.videoStream=void 0,this.videoStopped=!0,this.info.videoStopped=!0),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.publication.removeTrack(E.streamType)}replaceOrAddTrack(E){return G(this,void 0,void 0,(function*(){this.setupStreamListeners(E),E.setGetStats(this.publication.requestRTCStats),E.streamType===vr.AUDIO?(this.audioStream=E,this.audioMuted=!E.mediaStreamTrack.enabled):E.streamType===vr.VIDEO&&(this.videoStream=E,this.videoStopped=!E.mediaStreamTrack.enabled),this.connection.emitStageState(this.audioMuted,this.videoStopped);const A=sf(E);yield this.publication.replaceOrUpdateStream(A)}))}unpublish(){if(this.publishState===wn.NOT_PUBLISHED||this.publishState===wn.ERRORED)return;this.logger.debug({msg:"unpublish"}),this.connection.setStagePublishing(!1),this.publication.stop(),this.publication.off(Kc.STATE_CHANGE,this.onPublicationStateChange),this.publication.off(Kc.ERROR,this.onPublicationError),this.publication.off(Kc.TRANSFORM_ERROR,this.onPublicationError);const E=[this.audioStream,this.videoStream].filter((A=>!!A));E.forEach((A=>{A.cleanup()})),this.audioStream=void 0,this.videoStream=void 0,this.emit(pa.MEDIA_STREAM_REMOVED,E),this.updatePublishState(wn.NOT_PUBLISHED),this.publication=this.createPublication()}}(function(C){C.STAGE_CONNECTION_STATE_CHANGED="stageConnectionStateChanged",C.STAGE_PARTICIPANT_JOINED="stageParticipantJoined",C.STAGE_PARTICIPANT_LEFT="stageParticipantLeft",C.STAGE_PARTICIPANT_STREAMS_ADDED="stageParticipantStreamsAdded",C.STAGE_PARTICIPANT_STREAMS_REMOVED="stageParticipantStreamsRemoved",C.STAGE_STREAM_MUTE_CHANGED="stageStreamMuteChanged",C.STAGE_STREAM_SEI_MESSAGE_RECEIVED="stageStreamSeiMessageReceived",C.STAGE_STREAM_LAYERS_CHANGED="stageStreamLayersChanged",C.STAGE_STREAM_LAYER_SELECTED="stageStreamLayerSelected",C.STAGE_STREAM_ADAPTION_CHANGED="stageStreamAdaptionChanged",C.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED="stageParticipantSubscribeStateChanged",C.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED="stageParticipantPublishStateChanged",C.ERROR="error",C.STAGE_LEFT="stageLeft"})(N||(N={}));var me=function(C,E,A,O){return new(A||(A=Promise))((function(j,H){function X(ee){try{se(O.next(ee))}catch(he){H(he)}}function re(ee){try{se(O.throw(ee))}catch(he){H(he)}}function se(ee){var he;ee.done?j(ee.value):(he=ee.value,he instanceof A?he:new A((function(Ee){Ee(he)}))).then(X,re)}se((O=O.apply(C,[])).next())}))};const He=C=>!!C;class ht extends ea{constructor(E,A){super(),this.connectionState=Xi.DISCONNECTED,this.participants=new Map,this.connectionStateErrored=!1,this.onConnectionStateChanged=(H,X)=>{var re,se;if(this.connectionState=H,H===Xi.ERRORED&&(this.connectionStateErrored=!0),H===Xi.CONNECTED&&this.localParticipant&&this.localParticipant.publishState!==wn.NOT_PUBLISHED&&this.stageConnection.emitStageState((re=this.localParticipant)===null||re===void 0?void 0:re.audioMuted,(se=this.localParticipant)===null||se===void 0?void 0:se.videoStopped),H===Xi.CONNECTED&&this.connectionStateErrored&&(this.connectionStateErrored=!1,this.refreshStrategy()),H===Xi.DISCONNECTED){if(X&&X!==co.CLIENT_RECONNECT&&X!==co.USER_INITIATED){let ee=Tt.UNKNOWN;(function(he){return Object.values(Tt).includes(he)})(X)?ee=X:this.logger.warn({msg:`DISCONNECTED reason is not a StageLeftReason: ${X}`}),this.cleanup(ee)}}else this.emit(N.STAGE_CONNECTION_STATE_CHANGED,this.connectionState)},this.setupLocalParticipantOnce=()=>{var H;this.localParticipant?this.analyticsTracker.trackEventNoSharedProps(new Xf(this.token,(H=this.joinTraceId)!==null&&H!==void 0?H:new ps,"reusing local participant from repeat join",yn.JOIN,"")):this.createLocalParticipant()},this.createLocalParticipant=()=>{const H=(function(X){var re,se;const ee=new Set;return X.token.claims.capabilities.allow_publish&&ee.add(bn.PUBLISH),X.token.claims.capabilities.allow_subscribe&&ee.add(bn.SUBSCRIBE),{id:X.token.participantID,userId:(re=X.token.userID)!==null&&re!==void 0?re:"",attributes:(se=X.token.claims.attributes)!==null&&se!==void 0?se:{},capabilities:ee,isLocal:!0,userInfo:{},videoStopped:X.videoStopped,audioMuted:X.audioMuted,isPublishing:X.isPublishing}})({token:this.token,videoStopped:!0,audioMuted:!0,isPublishing:!1});this.localParticipant=new oe(H,this.token,this.logger.unwrap(),this.stageConnection,this.analyticsTracker),this.localParticipant.on(pa.PUBLICATION_STATE_CHANGE,(X=>{this.onPublishStateChanged(this.localParticipant.info,X)})),this.localParticipant.on(pa.MEDIA_STREAM_REMOVED,this.onLocalStreamsRemoved),this.localParticipant.on(pa.MEDIA_STREAM_MUTE_CHANGED,(X=>{this.localParticipant?this.onStreamMuteChange(this.localParticipant.info,X):this.logger.warn({msg:"tried to emit a stream mute change event for undefined local participant"})})),this.localParticipant.on(pa.ERROR,(X=>{this.errorManager.handleError(X,J.PUBLISH_ERROR)})),this.emit(N.STAGE_PARTICIPANT_JOINED,H)},this.onRemoteParticipantJoined=H=>{if(H.id===this.token.participantID)return;const X=(function(he){return{id:he.id,userId:he.userId,attributes:he.attributes,capabilities:new Set([bn.SUBSCRIBE]),isLocal:!1,userInfo:{},videoStopped:he.videoStopped,audioMuted:he.audioMuted,isPublishing:he.isPublishing}})(H);if(this.participants.has(X.id))return void this.logger.warn({msg:"Remote participant already tracked"});let re=Ho.NONE;X.capabilities.has(bn.SUBSCRIBE)&&(re=pn.getOk_or(this.strategyWrapper.shouldSubscribeToParticipant(X),re),this.updateManagerWithExternalSubscribeConfig(X,"joined"));const se=this.configManager.getSubscribeConfigSnapshot(X.id),ee=new gh(X,this.token,this.stageConnection,this.logger.unwrap(),re,se,this.analyticsTracker,H.isPublishing);this.participants.set(X.id,ee),this.setupRemoteParticipantListeners(ee),this.emit(N.STAGE_PARTICIPANT_JOINED,ee.info),ee.updateSubscribeStateIfNecessary(re)},this.setupRemoteParticipantListeners=H=>{H.on(lo.SUBSCRIPTION_STATE_CHANGE,(X=>{this.onParticipantSubscribeStateChanged(H.info.id,X)})),H.on(lo.MEDIA_STREAM_ADDED,(X=>{const re=this.participants.get(H.info.id);if(re){for(const se of X)this.setupRemoteParticipantStreamEvents(re.info,se);this.emit(N.STAGE_PARTICIPANT_STREAMS_ADDED,re.info,da(X)),this.updateStreamLayerForParticipantInfo(H.info,H.streams)}else this.logger.warn({msg:"Got stream add for participant no longer being tracked"})})),H.on(lo.MEDIA_STREAM_REMOVED,(X=>{const re=this.participants.get(H.info.id);re?this.emit(N.STAGE_PARTICIPANT_STREAMS_REMOVED,re.info,da(X)):this.logger.warn({msg:"Got stream remove for participant no longer being tracked"})})),H.on(lo.MEDIA_STREAM_MUTE_CHANGED,(X=>{this.onStreamMuteChange(H.info,X.remote)})),H.on(lo.ERROR,(X=>{this.errorManager.handleError(X,J.SUBSCRIBE_ERROR)})),H.on(lo.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,(X=>{this.onSeiMessageReceived(H.info,X)}))},this.onRemoteParticipantLeft=H=>{if(this.connectionState!==Xi.CONNECTED)return;const X=this.participants.get(H);X?(X.participantLeave(),X.unsubscribe(),X.cleanup(),this.participants.delete(H),this.emitParticipantLeave(X.info)):this.logger.warn({msg:"Remote participant no longer tracked"})},this.emitParticipantLeave=H=>{this.emit(N.STAGE_PARTICIPANT_LEFT,H)},this.onRemoteParticipantStateChanged=H=>{const X=this.participants.get(H.id);if(!X)return void this.logger.warn({msg:"Remote participant updated but not tracked"});X.updatePublishState(H.isPublishing)&&this.onPublishStateChanged(X.info,X.publishState),X.updateStreamState(H.audioMuted,H.videoStopped);const re=this.strategyWrapper.shouldSubscribeToParticipant(X.info);if(pn.isNotOk(re))return;this.updateManagerWithExternalSubscribeConfig(X.info,"updated");const se=this.configManager.getSubscribeConfigSnapshot(X.info.id),ee=pn.getOk_or(re,Ho.NONE);X.updateSubscribeStateIfNecessary(ee,se)},this.onPublishStateChanged=(H,X)=>{this.emit(N.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED,H,X)},this.onParticipantSubscribeStateChanged=(H,X)=>{const re=this.participants.get(H);re?this.emit(N.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED,re.info,X):this.logger.warn({msg:"Remote participant subscribe state changed but not tracked"})},this.onLocalStreamsAdded=H=>{this.localParticipant&&this.emit(N.STAGE_PARTICIPANT_STREAMS_ADDED,this.localParticipant.info,H)},this.onLocalStreamsRemoved=H=>{this.localParticipant&&this.emit(N.STAGE_PARTICIPANT_STREAMS_REMOVED,this.localParticipant.info,H)},this.onStreamMuteChange=(H,X)=>{this.emit(N.STAGE_STREAM_MUTE_CHANGED,H,X)},this.onSeiMessageReceived=(H,X)=>{this.emit(N.STAGE_STREAM_SEI_MESSAGE_RECEIVED,H,X)},this.leave=()=>{this.cleanup(Tt.USER_INITIATED)},this.onBeforeUnloadCleanup=()=>{var H;this.participants.forEach((X=>{X.quickUnsubscribe()})),(H=this.localParticipant)===null||H===void 0||H.quickUnpublish(),this.stageConnection.disconnect(),this.emit(N.STAGE_CONNECTION_STATE_CHANGED,Xi.DISCONNECTED),this.analyticsTracker.stop(!0)},this.cleanup=H=>{if(!this.localParticipant)return;this.analyticsTracker.trackEventNoSharedProps(new Yp({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId,reason:H})),this.localParticipant.unpublish(),this.localParticipant.cleanup();const X=this.localParticipant.info;this.localParticipant=void 0,this.emitParticipantLeave(X);const re=this.participants.entries();for(const[se,ee]of re)ee.unsubscribe(),this.participants.delete(se),ee.cleanup(),this.emitParticipantLeave(ee.info);gs.destroy(this.analyticsTracker.getSessionId()),this.stageConnection.disconnect(),this.emit(N.STAGE_CONNECTION_STATE_CHANGED,Xi.DISCONNECTED),this.emit(N.STAGE_LEFT,H),this.analyticsTracker.stop(!1),window.removeEventListener("beforeunload",this.onBeforeUnloadCleanup)},this.refreshStrategy=()=>{this.participants.forEach((H=>{if(H.info.capabilities.has(bn.SUBSCRIBE)){const X=this.strategyWrapper.shouldSubscribeToParticipant(H.info);if(pn.isNotOk(X))return;const re=pn.getOk_or(X,Ho.NONE);this.updateManagerWithExternalSubscribeConfig(H.info,"updated");const se=this.configManager.getSubscribeConfigSnapshot(H.info.id);H.updateSubscribeStateIfNecessary(re,se),this.updateStreamLayerForParticipantInfo(H.info,H.streams)}})),this.updateStreamsToPublishIfNecessary()},this.updateManagerWithExternalSubscribeConfig=(H,X)=>{var re;const se=pn.getOk(this.strategyWrapper.subscribeConfiguration(H)),ee=pn.getOk(this.getRemoteSubscribeConfiguration()),he=this.getInternalSubscribeOverrides(),Ee=H.id;let Ce=!1;se&&(Ce=this.configManager.handleExternalSubscribeConfigUpdate(Ee,se,Gt.API));let Ye=!1;ee&&(Ye=this.configManager.handleSubscribeConfigUpdate(Ee,ee,Gt.REMOTE));let gt=!1;if(he&&(gt=this.configManager.handleSubscribeConfigUpdate(Ee,he,Gt.INTERNAL)),Ce||gt||Ye){const ft=this.configManager.getSubscribeConfigSnapshot(Ee);this.analyticsTracker.trackEventNoSharedProps(new ao(this.token,(re=this.joinTraceId)!==null&&re!==void 0?re:oa(),X==="joined"?"initial":"ad-hoc",Ee,ft))}},this.getRemoteSubscribeConfiguration=()=>{const H=Bo.getRemoteSubscribeConfig({customerId:this.token.customerId,sessionId:this.analyticsTracker.getSessionId()});return H?pn.ok(H):pn.err("No payload found")},this.updateStreamsToPublishIfNecessary=()=>{var H;if(!this.localParticipant||!(!((H=this.localParticipant)===null||H===void 0)&&H.info.capabilities.has(bn.PUBLISH)))return;const X=this.localParticipant.publishState!==wn.NOT_PUBLISHED&&this.localParticipant.publishState!==wn.ERRORED,re=this.strategyWrapper.shouldPublishParticipant(this.localParticipant.info);if(pn.isNotOk(re))return;let se=pn.getOk_or(re,!1);if(!X&&!se)return;if(X&&!se)return void this.localParticipant.unpublish();const ee=this.strategyWrapper.stageStreamsToPublish();if(pn.isNotOk(ee)){const Ee=pn.getErr(ee);if(Ee instanceof Error&&Ee.cause==="UserStrategy")throw Ee;return}const he=pn.getOk_or(ee,[]);se=se&&he.length>0,!X&&se?(this.localParticipant.publish(he),this.onLocalStreamsAdded(he)):this.syncTracksToPublish(he)},this.syncTracksToPublish=H=>{var X;if(!this.localParticipant)return;const re=this.localParticipant.audioStream,se=this.localParticipant.videoStream,{updates:ee,streamsToAdd:he,streamsToRemove:Ee}=this.determineStreamUpdates(re,se,H);if(ee.length){for(const Ce of ee)Ce.newStream?(X=this.localParticipant)===null||X===void 0||X.replaceOrAddTrack(Ce.newStream):Ce.oldStream&&this.localParticipant.removeTrack(Ce.oldStream);Ee.length!==0&&this.onLocalStreamsRemoved(Ee),he.length!==0&&this.onLocalStreamsAdded(he)}},this.determineStreamUpdates=(H,X,re=[])=>{const se=[],ee=re.slice(0,2);if(ee.sort(((Ce,Ye)=>Ce.streamType===vr.AUDIO?-1:1)),ee.length===0)H&&se.push({oldStream:H}),X&&se.push({oldStream:X});else if(ee.length===1){const Ce=ee[0];Ce.streamType===vr.AUDIO?X&&se.push({oldStream:X}):Ce.streamType===vr.VIDEO&&H&&se.push({oldStream:H})}ee.forEach((Ce=>{var Ye,gt;Ce.streamType===vr.AUDIO?H?H.id===Ce.id&&(0,Vi.isEqual)(H.mediaConfig,Ce.mediaConfig)||(!!(!((Ye=H.mediaConfig)===null||Ye===void 0)&&Ye.stereo)!=!!(!((gt=Ce.mediaConfig)===null||gt===void 0)&&gt.stereo)&&this.logger.warn({msg:"Ignoring change to audio stream's stereo configuration. Re-publish to change stereo configuraiton."}),se.push({oldStream:H,newStream:Ce})):se.push({newStream:Ce}):Ce.streamType===vr.VIDEO&&(X?X.id===Ce.id&&(0,Vi.isEqual)(X.mediaConfig,Ce.mediaConfig)||se.push({oldStream:X,newStream:Ce}):se.push({newStream:Ce}))}));const he=se.map((Ce=>Ce.newStream)).filter(He),Ee=se.map((Ce=>Ce.oldStream)).filter(He);return{updates:se,streamsToAdd:he,streamsToRemove:Ee}},this.onReassignmentMessage=H=>me(this,void 0,void 0,(function*(){if(cc("disableReassignments"))return void this.logger.debug({msg:"REASSIGN message ignored: disableReassignments is configured"});if(!uh.browser.isChrome())return void this.logger.debug({msg:"REASSIGN message ignored: browser is not chrome"});const X=oa();this.trackReassignmentRequest(H,X);const re=this.participants.get(H.remoteParticipantId),se=this.token.participantID,ee=(function(he,{localParticipantId:Ee,remoteParticipant:Ce}){const{participantId:Ye}=he;if(Ee!==Ye)return pn.err(Object.assign(Object.assign({},$t.REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID),{details:`Invalid participantId received: ${Ye}`}));if(!Ce)return pn.err(Object.assign(Object.assign({},$t.REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID),{details:`Invalid remoteParticipantId received: ${Ce}`}));if(Ce.isReassigning())return pn.err($t.REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS);const gt=Ce.subscription.peerClient.getConnectionState();return[Zn.CONNECTED,Zn.DISCONNECTED].includes(gt)?pn.ok(Ce):pn.err(Object.assign(Object.assign({},$t.REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE),{details:`connectionState: ${gt}`}))})(H,{localParticipantId:se,remoteParticipant:re});if(!ee.ok)this.trackReassignmentRequestRejected(ee.error,X);else try{const{token:he,nodeOverride:Ee}=H;yield ee.value.triggerIceRestart({assignmentToken:he,traceId:X,nodeOverride:Ee})}catch(he){this.logger.error({msg:"Reassignment failed.",err:he})}})),this.onIncompatibleCodecsMessage=H=>me(this,void 0,void 0,(function*(){var X;yield(X=this.localParticipant)===null||X===void 0?void 0:X.onIncompatibleCodecs(H.codecs)})),this.analyticsTracker=new zf;const O=x_();this.logger=new Gs(new zc(O),le.STAGE),this.strategyWrapper=new Ei(A,this.logger),this.configManager=new qn({logger:this.logger.unwrap(),subscribeDefaults:{jitterBuffer:{minDelayWhenPublishing:Es.DEFAULT,minDelayWhenSubscribeOnly:Es.DEFAULT},inBandMessaging:{enabled:!1},simulcast:{initialLayerPreference:ra.LOWEST_QUALITY,layerPollingEnabled:!0,layerPollingIntervalMs:3e3}}}),this.errorManager=new Vn(this.logger.unwrap());try{this.token=ky(E,this.analyticsTracker)}catch(H){const X=new hr(Object.assign({action:yn.JOIN,token:E,traceId:oa(),tag:aa,location:"Stage.constructor"},$t.MALFORMED_TOKEN));throw H instanceof Error&&(X.details=H.message),this.errorManager.handleError(X,J.JOIN_ERROR)||H}const j={customerId:this.token.customerId,sessionId:this.analyticsTracker.getSessionId()};Bo.cacheRealTimeContext(j),Bo.resolveExperimentsForRealTimeContext(j),this.stageConnection=new hg(this.token,this.logger.unwrap(),this.analyticsTracker),this.setupListeners()}setupListeners(){this.stageConnection.on(Wf,((E,A)=>{this.onConnectionStateChanged(E,A)})),this.stageConnection.on(V_,(E=>{this.onRemoteParticipantJoined(E)})),this.stageConnection.on(Hl,(E=>{this.onRemoteParticipantLeft(E.id)})),this.stageConnection.on(yr,(E=>{var A;E.id!==((A=this.localParticipant)===null||A===void 0?void 0:A.info.id)&&this.onRemoteParticipantStateChanged(E)})),this.stageConnection.on(Ry,(E=>me(this,void 0,void 0,(function*(){yield this.onReassignmentMessage(E)})))),this.stageConnection.on(mc,(E=>me(this,void 0,void 0,(function*(){yield this.onIncompatibleCodecsMessage(E)})))),this.stageConnection.on(Xp,(E=>{E instanceof hr&&this.analyticsTracker.trackError(E),this.errorManager.handleError(E,J.JOIN_ERROR)})),this.errorManager.on(xt.ERROR,(E=>{this.emit(N.ERROR,E)}))}setupRemoteParticipantStreamEvents(E,A){const O=A.remote;A.on(tn.ADAPTION_CHANGED,(j=>{this.emit(N.STAGE_STREAM_ADAPTION_CHANGED,E,O,j)})),A.on(tn.LAYERS_CHANGED,(j=>{this.emit(N.STAGE_STREAM_LAYERS_CHANGED,E,O,j),this.updateStreamLayerForParticipantInfo(E,[A])})),A.on(tn.LAYER_SELECTED,((j,H)=>{this.emit(N.STAGE_STREAM_LAYER_SELECTED,E,O,j,H)})),A.layers.length>0&&(this.emit(N.STAGE_STREAM_LAYERS_CHANGED,E,O,O.getLayers()),this.emit(N.STAGE_STREAM_LAYER_SELECTED,E,O,O.getSelectedLayer(),Jt.SELECTED))}join(){return me(this,void 0,void 0,(function*(){Bo.markSdkUsage(),this.analyticsTracker.start(),this.joinTraceId=oa(),this.analyticsTracker.trackEvent(new Zy({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId}));try{this.token.assertTokenIsUnexpired(oa(),aa,"join")}catch(E){throw this.errorManager.handleError(E,J.JOIN_ERROR)||E}try{this.joinTraceId=yield this.stageConnection.connect(this.joinTraceId),this.connectionState===Xi.CONNECTED&&(this.setupLocalParticipantOnce(),this.updateStreamsToPublishIfNecessary()),window.addEventListener("beforeunload",this.onBeforeUnloadCleanup)}catch(E){throw this.logger.error({err:E,msg:"error joining stage"}),this.errorManager.handleError(E,J.JOIN_ERROR,!1)||E}}))}replaceStrategy(E){this.strategyWrapper.setStrategy(E),this.refreshStrategy()}getInternalSubscribeOverrides(){const E=this.strategyWrapper.hasStrategy("preferredLayerForStream"),A=this.hasListenersFor(N.STAGE_STREAM_LAYERS_CHANGED)||this.hasListenersFor(N.STAGE_STREAM_ADAPTION_CHANGED)||this.hasListenersFor(N.STAGE_STREAM_LAYER_SELECTED);return{simulcast:{layerPollingEnabled:E||A}}}updateStreamLayerForParticipantInfo(E,A){A.forEach((O=>{if(O.streamType==="audio")return;const j=this.strategyWrapper.preferredLayerForStream(E,O.remote),H=pn.getOk_or(j,void 0);O.setLayer(H)}))}trackReassignmentRequestRejected(E,A){const{token:O}=this,j=new hr(Object.assign(Object.assign({},E),{token:O,action:yn.JOIN,traceId:A,tag:W0,location:"publish"}));this.logger.error({err:j,msg:"Reassignment request rejected."}),this.analyticsTracker.trackError(j)}trackReassignmentRequest(E,A){const{token:O}=this;this.analyticsTracker.trackEvent(new sr({token:O,traceId:A,targetLocalParticipantId:E.participantId,targetRemoteParticipantId:E.remoteParticipantId}))}}var Tt;(function(C){C.UNKNOWN="unknown",C.USER_INITIATED="user-initiated",C.TOKEN_REUSED="token-reused",C.PARTICIPANT_DISCONNECTED="participant-disconnected",C.STAGE_DELETED="stage-deleted"})(Tt||(Tt={}));const qt=h})(),s})()))})(aD)),aD.exports}var Uqe=Lqe();const fE=Dl(Uqe);class Bqe{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const t of this._parts)e.push(t);return Fqe(e).buffer}}function Fqe(n){let e=0;for(const i of n)e+=i.byteLength;const t=new Uint8Array(e);let r=0;for(const i of n){const s=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);t.set(s,r),r+=i.byteLength}return t}function Ese(n){return new jqe(n).unpack()}function xse(n){const e=new zqe,t=e.pack(n);return t instanceof Promise?t.then(()=>e.getBuffer()):e.getBuffer()}class jqe{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let t;if((t=e^160)<=15)return this.unpack_raw(t);if((t=e^176)<=15)return this.unpack_string(t);if((t=e^144)<=15)return this.unpack_array(t);if((t=e^128)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t}unpack_uint32(){const e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t}unpack_uint64(){const e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){const t=this.read(e);let r=0,i="",s,o;for(;r<e;)s=t[r],s<160?(o=s,r++):(s^192)<32?(o=(s&31)<<6|t[r+1]&63,r+=2):(s^224)<16?(o=(s&15)<<12|(t[r+1]&63)<<6|t[r+2]&63,r+=3):(o=(s&7)<<18|(t[r+1]&63)<<12|(t[r+2]&63)<<6|t[r+3]&63,r+=4),i+=String.fromCodePoint(o);return this.index+=e,i}unpack_array(e){const t=new Array(e);for(let r=0;r<e;r++)t[r]=this.unpack();return t}unpack_map(e){const t={};for(let r=0;r<e;r++){const i=this.unpack();t[i]=this.unpack()}return t}unpack_float(){const e=this.unpack_uint32(),t=e>>31,r=(e>>23&255)-127,i=e&8388607|8388608;return(t===0?1:-1)*i*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),t=this.unpack_uint32(),r=e>>31,i=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(i-20)+t*2**(i-52);return(r===0?1:-1)*o}read(e){const t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")}}class zqe{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const t=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(t==Object||t.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${t.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const t=this._textEncoder.encode(e),r=t.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_array(e){const t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");const r=i=>{if(i<t){const s=this.pack(e[i]);return s instanceof Promise?s.then(()=>r(i+1)):r(i+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let t=0;e<0&&(t=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),i=e/2**r-1,s=Math.floor(i*2**52),o=2**32,a=t<<31|r+1023<<20|s/o&1048575,c=s%o;this._bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(c)}pack_object(e){const t=Object.keys(e),r=t.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const i=s=>{if(s<t.length){const o=t[s];if(e.hasOwnProperty(o)){this.pack(o);const a=this.pack(e[o]);if(a instanceof Promise)return a.then(()=>i(s+1))}return i(s+1)}};return i(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const t=e&4294967295;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_uint64(e){const t=e/4294967296,r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const t=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new Bqe,this._textEncoder=new TextEncoder}}let Tse=!0,wse=!0;function ww(n,e,t){const r=n.match(e);return r&&r.length>=t&&parseFloat(r[t],10)}function Zb(n,e,t){if(!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return i.apply(this,arguments);const c=l=>{const u=t(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),i.apply(this,[o,c])};const s=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function Hqe(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(Tse=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function Vqe(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(wse=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function Ase(){if(typeof window=="object"){if(Tse)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function EB(n,e){wse&&console.warn(n+" is deprecated, please use "+e+" instead.")}function Gqe(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.userAgentData&&t.userAgentData.brands){const r=t.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=parseInt(ww(t.userAgent,/Firefox\/(\d+)\./,1));else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(ww(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(ww(t.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype,e._safariVersion=ww(t.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function R$(n){return Object.prototype.toString.call(n)==="[object Object]"}function Rse(n){return R$(n)?Object.keys(n).reduce(function(e,t){const r=R$(n[t]),i=r?Rse(n[t]):n[t],s=r&&!Object.keys(i).length;return i===void 0||s?e:Object.assign(e,{[t]:i})},{}):n}function z4(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?z4(n,n.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(i=>{z4(n,n.get(i),t)})}))}function C$(n,e,t){const r=t?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return n.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{n.forEach(a=>{a.type===r&&a.trackId===o.id&&z4(n,a,i)})}),i}const M$=Ase;function Cse(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(f,d){return f?f+d.charAt(0).toUpperCase()+d.slice(1):d==="deviceId"?"sourceId":d};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[h("min",l)]=u.ideal,c.optional.push(f),f={},f[h("max",l)]=u.ideal,c.optional.push(f)):(f[h("",l)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",l)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(f,l)]=u[f])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},i=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,h,f){h in u&&!(f in u)&&(u[f]=u[h],delete u[h])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let h;if(l.exact==="environment"||l.ideal==="environment"?h=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(h=["front"]),h)return t.mediaDevices.enumerateDevices().then(f=>{f=f.filter(p=>p.kind==="videoinput");let d=f.find(p=>h.some(_=>p.label.toLowerCase().includes(_)));return!d&&f.length&&h.includes("back")&&(d=f[f.length-1]),d&&(a.video.deviceId=l.exact?{exact:d.deviceId}:{ideal:d.deviceId}),a.video=r(a.video),M$("chrome: "+JSON.stringify(a)),c(a)})}a.video=r(a.video)}return M$("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){i(a,u=>{t.webkitGetUserMedia(u,c,h=>{l&&l(s(h))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(c){return i(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function Mse(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function kse(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):s={track:i.track};const o=new Event("track");o.track=i.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(i=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.id):s={track:i};const o=new Event("track");o.track=i,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Zb(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Ose(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,c){let l=i.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],t.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ise(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(o=>o._pc=this),s});const r=n.RTCPeerConnection.prototype.addTrack;r&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>C$(o,s.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Zb(n,"track",r=>(r.receiver._pc=r.srcElement,r)),n.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>C$(s,i.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const r=arguments[0];let i,s,o;return this.getSenders().forEach(a=>{a.track===r&&(i?o=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===r&&(s?o=!0:s=a),a.track===r)),o||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Nse(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(h=>h.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const i=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function Pse(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Nse(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const u=t.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const r=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(d=>d.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new n.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}r.apply(this,[u])};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},n.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(_=>_===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(_=>_.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const p=this._streams[h.id];if(p)p.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const _=new n.MediaStream([u]);this._streams[h.id]=_,this._reverseStreams[_.id]=h,this.addStream(_)}return this.getSenders().find(_=>_.track===u)};function s(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const d=l._reverseStreams[f],p=l._streams[d.id];h=h.replace(new RegExp(p.id,"g"),d.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function o(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const d=l._reverseStreams[f],p=l._streams[d.id];h=h.replace(new RegExp(d.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(l){const u=n.RTCPeerConnection.prototype[l],h={[l](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[p=>{const _=s(this,p);f[0].apply(null,[_])},p=>{f[1]&&f[1].apply(null,p)},arguments[2]]):u.apply(this,arguments).then(p=>s(this,p))}};n.RTCPeerConnection.prototype[l]=h[l]});const a=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),n.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(d=>{this._streams[d].getTracks().find(_=>u.track===_)&&(f=this._streams[d])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function H4(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const r=n.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=i[t]})}function Dse(n,e){Zb(n,"negotiationneeded",t=>{const r=t.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return t})}const k$=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Dse,shimAddTrackRemoveTrack:Pse,shimAddTrackRemoveTrackWithNative:Nse,shimGetSendersWithDtmf:Ose,shimGetUserMedia:Cse,shimMediaStream:Mse,shimOnTrack:kse,shimPeerConnection:H4,shimSenderReceiverGetStats:Ise},Symbol.toStringTag,{value:"Module"}));function Lse(n,e){const t=n&&n.navigator,r=n&&n.MediaStreamTrack;if(t.getUserMedia=function(i,s,o){EB("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(i).then(s,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const i=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function $qe(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(r)})}function Use(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function V4(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=n.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};n.RTCPeerConnection.prototype[i]=o[i]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return r.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=t[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:t[u.type]||u.type}))})}return c}).then(o,a)}}function Bse(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=t.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Fse(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Zb(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function jse(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){EB("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&t.getTracks().includes(r.track)&&this.removeTrack(r)})})}function zse(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function Hse(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function Vse(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Gse(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function $se(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const O$=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Hse,shimCreateAnswer:$se,shimCreateOffer:Gse,shimGetDisplayMedia:$qe,shimGetParameters:Vse,shimGetUserMedia:Lse,shimOnTrack:Use,shimPeerConnection:V4,shimRTCDataChannel:zse,shimReceiverGetStats:Fse,shimRemoveStream:jse,shimSenderGetStats:Bse},Symbol.toStringTag,{value:"Module"}));function Wse(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},n.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const i=t.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function qse(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function Yse(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=t.apply(this,[h]);return u?(f.then(l,u),Promise.resolve()):f},e.createAnswer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[h]);return u?(f.then(l,u),Promise.resolve()):f};let a=function(c,l,u){const h=i.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h};e.setLocalDescription=a,a=function(c,l,u){const h=s.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.setRemoteDescription=a,a=function(c,l,u){const h=o.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.addIceCandidate=a}function Kse(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,r=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=i=>r(Xse(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,s){e.mediaDevices.getUserMedia(r).then(i,s)}).bind(e))}function Xse(n){return n&&n.video!==void 0?Object.assign({},n,{video:Rse(n.video)}):n}function Zse(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(EB("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(r.iceServers[o])}r.iceServers=s}return new e(r,i)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Jse(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Qse(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function eoe(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const I$=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:eoe,shimCallbacksAPI:Yse,shimConstraints:Xse,shimCreateOfferLegacy:Qse,shimGetUserMedia:Kse,shimLocalStreamsAPI:Wse,shimRTCIceServerUrls:Zse,shimRemoteStreamsAPI:qse,shimTrackEventTransceiver:Jse},Symbol.toStringTag,{value:"Module"}));var cD={exports:{}},N$;function Wqe(){return N$||(N$=1,(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(t){return t.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(t){const r=e.splitSections(t);return r&&r[0]},e.getMediaSections=function(t){const r=e.splitSections(t);return r.shift(),r},e.matchPrefix=function(t,r){return e.splitLines(t).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(t){let r;t.indexOf("a=candidate:")===0?r=t.substring(12).split(" "):r=t.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1]);break}return i},e.writeCandidate=function(t){const r=[];r.push(t.foundation);const i=t.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(t.protocol.toUpperCase()),r.push(t.priority),r.push(t.address||t.ip),r.push(t.port);const s=t.type;return r.push("typ"),r.push(s),s!=="host"&&t.relatedAddress&&t.relatedPort&&(r.push("raddr"),r.push(t.relatedAddress),r.push("rport"),r.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(r.push("ufrag"),r.push(t.usernameFragment||t.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let r=t.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(t){let r=t.payloadType;t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType);const i=t.channels||t.numChannels||1;return"a=rtpmap:"+r+" "+t.name+"/"+t.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(t){const r=t.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const r={};let i;const s=t.substring(t.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(t){let r="",i=t.payloadType;if(t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const s=[];Object.keys(t.parameters).forEach(o=>{t.parameters[o]!==void 0?s.push(o+"="+t.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(t){const r=t.substring(t.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(t){let r="",i=t.payloadType;return t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(t){const r=t.indexOf(" "),i={ssrc:parseInt(t.substring(7,r),10)},s=t.indexOf(":",r);return s>-1?(i.attribute=t.substring(r+1,s),i.value=t.substring(s+1)):i.attribute=t.substring(r+1),i},e.parseSsrcGroup=function(t){const r=t.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(t){const r=e.matchPrefix(t,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(t){const r=t.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(t,r){return{role:"auto",fingerprints:e.matchPrefix(t+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,r){let i="a=setup:"+r+`\r
`;return t.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(t){const r=t.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const r=t.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,r){return e.matchPrefix(t+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,r){const i=e.matchPrefix(t+r,"a=ice-ufrag:")[0],s=e.matchPrefix(t+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(t){let r="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(t){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(t)[0].split(" ");r.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(t,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),h=e.matchPrefix(t,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(t,r){let i="";i+="m="+t+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(t){const r=[],i=e.parseRtpParameters(t),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(t,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(t,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(p=>parseInt(p,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),i.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let d={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&l&&(d.rtx={ssrc:l}),r.push(d),s&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(d))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(t,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-2e3*8:h=void 0,r.forEach(f=>{f.maxBitrate=h})),r},e.parseRtcpParameters=function(t){const r={},i=e.matchPrefix(t,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(t,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=e.matchPrefix(t,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(t){let r="";return t.reducedSize&&(r+=`a=rtcp-rsize\r
`),t.mux&&(r+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(r+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),r},e.parseMsid=function(t){let r;const i=e.matchPrefix(t,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(t,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(t){const r=e.parseMLine(t),i=e.matchPrefix(t,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(t,r){let i=[];return t.protocol!=="DTLS/SCTP"?i=["m="+t.kind+" 9 "+t.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+t.kind+" 9 "+t.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,r,i){let s;const o=r!==void 0?r:2;return t?s=t:s=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,r){const i=e.splitLines(t);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const i=e.splitLines(t)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(t){const i=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const r=e.splitLines(t);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},n.exports=e})(cD)),cD.exports}var toe=Wqe();const XE=Dl(toe),qqe=voe({__proto__:null,default:XE},[toe]);function tM(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),s=XE.parseCandidate(r.candidate);for(const o in s)o in i||Object.defineProperty(i,o,{value:s[o]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},n.RTCIceCandidate.prototype=e.prototype,Zb(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function G4(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||Zb(n,"icecandidate",e=>{if(e.candidate){const t=XE.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function nM(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const c=XE.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=XE.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},i=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=XE.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const c=r(arguments[0]),l=i(c),u=s(arguments[0],c);let h;l===0&&u===0?h=Number.POSITIVE_INFINITY:l===0||u===0?h=Math.max(l,u):h=Math.min(l,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return h}}),this._sctp=f}return o.apply(this,arguments)}}function rM(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const i=t.apply(this,arguments);return e(i,this),i},Zb(n,"datachannel",r=>(e(r.channel,r.target),r))}function $4(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const r=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function W4(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&i instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return t.apply(this,arguments)}}function iM(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function sM(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return t.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?t.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>t.apply(this,[o]))})}const Yqe=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:W4,shimAddIceCandidateNullOrEmpty:iM,shimConnectionState:$4,shimMaxMessageSize:nM,shimParameterlessSetLocalDescription:sM,shimRTCIceCandidate:tM,shimRTCIceCandidateRelayProtocol:G4,shimSendThrowTypeError:rM},Symbol.toStringTag,{value:"Module"}));function Kqe({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const t=Ase,r=Gqe(n),i={browserDetails:r,commonShim:Yqe,extractVersion:ww,disableLog:Hqe,disableWarnings:Vqe,sdp:qqe};switch(r.browser){case"chrome":if(!k$||!H4||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),i;if(r.version===null)return t("Chrome shim can not determine version, not shimming."),i;t("adapter.js shimming chrome."),i.browserShim=k$,iM(n,r),sM(n),Cse(n,r),Mse(n),H4(n,r),kse(n),Pse(n,r),Ose(n),Ise(n),Dse(n,r),tM(n),G4(n),$4(n),nM(n,r),rM(n),W4(n,r);break;case"firefox":if(!O$||!V4||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),i;t("adapter.js shimming firefox."),i.browserShim=O$,iM(n,r),sM(n),Lse(n,r),V4(n,r),Use(n),jse(n),Bse(n),Fse(n),zse(n),Hse(n),Vse(n),Gse(n),$se(n),tM(n),$4(n),nM(n,r),rM(n);break;case"safari":if(!I$||!e.shimSafari)return t("Safari shim is not included in this adapter release."),i;t("adapter.js shimming safari."),i.browserShim=I$,iM(n,r),sM(n),Zse(n),Qse(n),Yse(n),Wse(n),qse(n),Jse(n),Kse(n),eoe(n),tM(n),G4(n),nM(n,r),rM(n),W4(n,r);break;default:t("Unsupported browser!");break}return i}const P$=Kqe({window:typeof window>"u"?void 0:window});function Jb(n,e,t,r){Object.defineProperty(n,e,{get:t,set:r,enumerable:!0,configurable:!0})}class noe{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const t=[],r=e.byteLength,i=Math.ceil(r/this.chunkedMTU);let s=0,o=0;for(;o<r;){const a=Math.min(r,o+this.chunkedMTU),c=e.slice(o,a),l={__peerData:this._dataCount,n:s,data:c,total:i};t.push(l),o=a,s++}return this._dataCount++,t}}}function Xqe(n){let e=0;for(const i of n)e+=i.byteLength;const t=new Uint8Array(e);let r=0;for(const i of n)t.set(i,r),r+=i.byteLength;return t}const lD=P$.default||P$,dw=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const n=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(n)?n==="chrome"?e>=this.minChromeVersion:n==="firefox"?e>=this.minFirefoxVersion:n==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return lD.browserDetails.browser}getVersion(){return lD.browserDetails.version||0}isUnifiedPlanSupported(){const n=this.getBrowser(),e=lD.browserDetails.version||0;if(n==="chrome"&&e<this.minChromeVersion)return!1;if(n==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t,r=!1;try{t=new RTCPeerConnection,t.addTransceiver("audio"),r=!0}catch{}finally{t&&t.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},Zqe=n=>!n||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(n),roe=()=>Math.random().toString(36).slice(2),D$={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class Jqe extends noe{noop(){}blobToArrayBuffer(e,t){const r=new FileReader;return r.onload=function(i){i.target&&t(i.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r)&255;return t.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=D$,this.browser=dw.getBrowser(),this.browserVersion=dw.getVersion(),this.pack=xse,this.unpack=Ese,this.supports=(function(){const t={browser:dw.isBrowserSupported(),webRTC:dw.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;let r;try{r=new RTCPeerConnection(D$),t.audioVideo=!0;let i;try{i=r.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!i.ordered;try{i.binaryType="blob",t.binaryBlob=!dw.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{r&&r.close()}return t})(),this.validateId=Zqe,this.randomToken=roe}}const xh=new Jqe,Qqe="PeerJS: ";class eYe{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){const r=[Qqe,...t];for(const i in r)r[i]instanceof Error&&(r[i]="("+r[i].name+") "+r[i].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var er=new eYe,xB={},tYe=Object.prototype.hasOwnProperty,Hu="~";function BA(){}Object.create&&(BA.prototype=Object.create(null),new BA().__proto__||(Hu=!1));function nYe(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function ioe(n,e,t,r,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var s=new nYe(t,r||n,i),o=Hu?Hu+e:e;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],s]:n._events[o].push(s):(n._events[o]=s,n._eventsCount++),n}function oM(n,e){--n._eventsCount===0?n._events=new BA:delete n._events[e]}function du(){this._events=new BA,this._eventsCount=0}du.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)tYe.call(t,r)&&e.push(Hu?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};du.prototype.listeners=function(e){var t=Hu?Hu+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o};du.prototype.listenerCount=function(e){var t=Hu?Hu+e:e,r=this._events[t];return r?r.fn?1:r.length:0};du.prototype.emit=function(e,t,r,i,s,o){var a=Hu?Hu+e:e;if(!this._events[a])return!1;var c=this._events[a],l=arguments.length,u,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,s),!0;case 6:return c.fn.call(c.context,t,r,i,s,o),!0}for(h=1,u=new Array(l-1);h<l;h++)u[h-1]=arguments[h];c.fn.apply(c.context,u)}else{var f=c.length,d;for(h=0;h<f;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),l){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,t);break;case 3:c[h].fn.call(c[h].context,t,r);break;case 4:c[h].fn.call(c[h].context,t,r,i);break;default:if(!u)for(d=1,u=new Array(l-1);d<l;d++)u[d-1]=arguments[d];c[h].fn.apply(c[h].context,u)}}return!0};du.prototype.on=function(e,t,r){return ioe(this,e,t,r,!1)};du.prototype.once=function(e,t,r){return ioe(this,e,t,r,!0)};du.prototype.removeListener=function(e,t,r,i){var s=Hu?Hu+e:e;if(!this._events[s])return this;if(!t)return oM(this,s),this;var o=this._events[s];if(o.fn)o.fn===t&&(!i||o.once)&&(!r||o.context===r)&&oM(this,s);else{for(var a=0,c=[],l=o.length;a<l;a++)(o[a].fn!==t||i&&!o[a].once||r&&o[a].context!==r)&&c.push(o[a]);c.length?this._events[s]=c.length===1?c[0]:c:oM(this,s)}return this};du.prototype.removeAllListeners=function(e){var t;return e?(t=Hu?Hu+e:e,this._events[t]&&oM(this,t)):(this._events=new BA,this._eventsCount=0),this};du.prototype.off=du.prototype.removeListener;du.prototype.addListener=du.prototype.on;du.prefixed=Hu;du.EventEmitter=du;xB=du;var Qb={};Jb(Qb,"ConnectionType",()=>Fv);Jb(Qb,"PeerErrorType",()=>rc);Jb(Qb,"BaseConnectionErrorType",()=>q4);Jb(Qb,"DataConnectionErrorType",()=>TB);Jb(Qb,"SerializationType",()=>E3);Jb(Qb,"SocketEventType",()=>Nv);Jb(Qb,"ServerMessageType",()=>iu);var Fv=(function(n){return n.Data="data",n.Media="media",n})({}),rc=(function(n){return n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc",n})({}),q4=(function(n){return n.NegotiationFailed="negotiation-failed",n.ConnectionClosed="connection-closed",n})({}),TB=(function(n){return n.NotOpenYet="not-open-yet",n.MessageToBig="message-too-big",n})({}),E3=(function(n){return n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json",n.None="raw",n})({}),Nv=(function(n){return n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close",n})({}),iu=(function(n){return n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE",n})({});const soe="1.5.5";class rYe extends xB.EventEmitter{constructor(e,t,r,i,s,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const a=e?"wss://":"ws://";this._baseUrl=a+t+":"+r+i+"peerjs?key="+s}start(e,t){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${t}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+soe),this._disconnected=!1,this._socket.onmessage=i=>{let s;try{s=JSON.parse(i.data),er.log("Server message received:",s)}catch{er.log("Invalid server message",i.data);return}this.emit(Nv.Message,s)},this._socket.onclose=i=>{this._disconnected||(er.log("Socket closed.",i),this._cleanup(),this._disconnected=!0,this.emit(Nv.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),er.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){er.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:iu.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const t of e)this.send(t)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Nv.Error,"Invalid message");return}if(!this._wsOpen())return;const t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class ooe{constructor(e){this.connection=e}startConnection(e){const t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===Fv.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){const r=this.connection,i={ordered:!!e.reliable},s=t.createDataChannel(r.label,i);r._initializeDataChannel(s),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){er.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const t=this.connection.peer,r=this.connection.connectionId,i=this.connection.type,s=this.connection.provider;er.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(er.log(`Received ICE candidates for ${t}:`,o.candidate),s.socket.send({type:iu.Candidate,payload:{candidate:o.candidate,type:i,connectionId:r},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":er.log("iceConnectionState is failed, closing connections to "+t),this.connection.emitError(q4.NegotiationFailed,"Negotiation of connection to "+t+" failed."),this.connection.close();break;case"closed":er.log("iceConnectionState is closed, closing connections to "+t),this.connection.emitError(q4.ConnectionClosed,"Connection to "+t+" closed."),this.connection.close();break;case"disconnected":er.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},er.log("Listening for data channel"),e.ondatachannel=o=>{er.log("Received data channel");const a=o.channel;s.getConnection(t,r)._initializeDataChannel(a)},er.log("Listening for remote stream"),e.ontrack=o=>{er.log("Received remote stream");const a=o.streams[0],c=s.getConnection(t,r);if(c.type===Fv.Media){const l=c;this._addStreamToMediaConnection(a,l)}}}cleanup(){er.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const t=e.signalingState!=="closed";let r=!1;const i=this.connection.dataChannel;i&&(r=!!i.readyState&&i.readyState!=="closed"),(t||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);er.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),er.log("Set localDescription:",r,`for:${this.connection.peer}`);let i={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Fv.Data){const s=this.connection;i={...i,label:s.label,reliable:s.reliable,serialization:s.serialization}}t.socket.send({type:iu.Offer,payload:i,dst:this.connection.peer})}catch(i){i!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(rc.WebRTC,i),er.log("Failed to setLocalDescription, ",i))}}catch(r){t.emitError(rc.WebRTC,r),er.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createAnswer();er.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),er.log("Set localDescription:",r,`for:${this.connection.peer}`),t.socket.send({type:iu.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(i){t.emitError(rc.WebRTC,i),er.log("Failed to setLocalDescription, ",i)}}catch(r){t.emitError(rc.WebRTC,r),er.log("Failed to create answer, ",r)}}async handleSDP(e,t){t=new RTCSessionDescription(t);const r=this.connection.peerConnection,i=this.connection.provider;er.log("Setting remote description",t);const s=this;try{await r.setRemoteDescription(t),er.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await s._makeAnswer()}catch(o){i.emitError(rc.WebRTC,o),er.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){er.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),er.log(`Added ICE candidate for:${this.connection.peer}`)}catch(t){this.connection.provider.emitError(rc.WebRTC,t),er.log("Failed to handleCandidate, ",t)}}_addTracksToConnection(e,t){if(er.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return er.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{t.addTrack(r,e)})}_addStreamToMediaConnection(e,t){er.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}}class aoe extends xB.EventEmitter{emitError(e,t){er.error("Error:",t),this.emit("error",new iYe(`${e}`,t))}}class iYe extends Error{constructor(e,t){typeof t=="string"?super(t):(super(),Object.assign(this,t)),this.type=e}}class coe extends aoe{get open(){return this._open}constructor(e,t,r){super(),this.peer=e,this.provider=t,this.options=r,this._open=!1,this.metadata=r.metadata}}class Uk extends coe{static#e=this.ID_PREFIX="mc_";get type(){return Fv.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,t,r){super(e,t,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||Uk.ID_PREFIX+xh.randomToken(),this._negotiator=new ooe(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{er.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{er.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){er.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const t=e.type,r=e.payload;switch(e.type){case iu.Answer:this._negotiator.handleSDP(t,r.sdp),this._open=!0;break;case iu.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:er.warn(`Unrecognized message type:${t} from peer:${this.peer}`);break}}answer(e,t={}){if(this._localStream){er.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const i of r)this.handleMessage(i);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class sYe{constructor(e){this._options=e}_buildRequest(e){const t=this._options.secure?"https":"http",{host:r,port:i,path:s,key:o}=this._options,a=new URL(`${t}://${r}:${i}${s}${o}/${e}`);return a.searchParams.set("ts",`${Date.now()}${Math.random()}`),a.searchParams.set("version",soe),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){er.error("Error retrieving ID",e);let t="";throw this._options.path==="/"&&this._options.host!==xh.CLOUD_HOST&&(t=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+t)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let t="";throw this._options.host===xh.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw er.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}class Bk extends coe{static#e=this.ID_PREFIX="dc_";static#t=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return Fv.Data}constructor(e,t,r){super(e,t,r),this.connectionId=this.options.connectionId||Bk.ID_PREFIX+roe(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new ooe(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{er.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=t=>{er.log(`DC#${this.connectionId} dc onmessage:`,t.data)},this.dataChannel.onclose=()=>{er.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,t=!1){if(!this.open){this.emitError(TB.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,t)}async handleMessage(e){const t=e.payload;switch(e.type){case iu.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case iu.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:er.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}}class wB extends Bk{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",t=>this._handleDataMessage(t))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>Bk.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(t){return er.error(`DC#:${this.connectionId} Error when sending:`,t),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class uD extends wB{close(e){super.close(e),this._chunkedData={}}constructor(e,t,r){super(e,t,r),this.chunker=new noe,this.serialization=E3.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const t=Ese(e),r=t.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(t);return}this.emit("data",t)}_handleChunk(e){const t=e.__peerData,r=this._chunkedData[t]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[t]=r,r.total===r.count){delete this._chunkedData[t];const i=Xqe(r.data);this._handleDataMessage({data:i})}}_send(e,t){const r=xse(e);if(r instanceof Promise)return this._send_blob(r);if(!t&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const t=await e;if(t.byteLength>this.chunker.chunkedMTU){this._sendChunks(t);return}this._bufferedSend(t)}_sendChunks(e){const t=this.chunker.chunk(e);er.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`);for(const r of t)this.send(r,!0)}}class oYe extends wB{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=E3.None}}class aYe extends wB{_handleDataMessage({data:e}){const t=this.parse(this.decoder.decode(e)),r=t.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",t)}_send(e,t){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=xh.chunkedMTU){this.emitError(TB.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=E3.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class AB extends aoe{static#e=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[t,r]of this._connections)e[t]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,t){super(),this._serializers={raw:oYe,json:aYe,binary:uD,"binary-utf8":uD,default:uD},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?t=e:e&&(r=e.toString()),t={debug:0,host:xh.CLOUD_HOST,port:xh.CLOUD_PORT,path:"/",key:AB.DEFAULT_KEY,token:xh.randomToken(),config:xh.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...t},this._options=t,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==xh.CLOUD_HOST?this._options.secure=xh.isSecure():this._options.host==xh.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&er.setLogFunction(this._options.logFunction),er.logLevel=this._options.debug||0,this._api=new sYe(t),this._socket=this._createServerConnection(),!xh.supports.audioVideo&&!xh.supports.data){this._delayedAbort(rc.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!xh.validateId(r)){this._delayedAbort(rc.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(i=>this._initialize(i)).catch(i=>this._abort(rc.ServerError,i))}_createServerConnection(){const e=new rYe(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Nv.Message,t=>{this._handleMessage(t)}),e.on(Nv.Error,t=>{this._abort(rc.SocketError,t)}),e.on(Nv.Disconnected,()=>{this.disconnected||(this.emitError(rc.Network,"Lost connection to server."),this.disconnect())}),e.on(Nv.Close,()=>{this.disconnected||this._abort(rc.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const t=e.type,r=e.payload,i=e.src;switch(t){case iu.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case iu.Error:this._abort(rc.ServerError,r.msg);break;case iu.IdTaken:this._abort(rc.UnavailableID,`ID "${this.id}" is taken`);break;case iu.InvalidKey:this._abort(rc.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case iu.Leave:er.log(`Received leave message from ${i}`),this._cleanupPeer(i),this._connections.delete(i);break;case iu.Expire:this.emitError(rc.PeerUnavailable,`Could not connect to peer ${i}`);break;case iu.Offer:{const s=r.connectionId;let o=this.getConnection(i,s);if(o&&(o.close(),er.warn(`Offer received for existing Connection ID:${s}`)),r.type===Fv.Media){const c=new Uk(i,this,{connectionId:s,_payload:r,metadata:r.metadata});o=c,this._addConnection(i,o),this.emit("call",c)}else if(r.type===Fv.Data){const c=new this._serializers[r.serialization](i,this,{connectionId:s,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(i,o),this.emit("connection",c)}else{er.warn(`Received malformed connection type:${r.type}`);return}const a=this._getMessages(s);for(const c of a)o.handleMessage(c);break}default:{if(!r){er.warn(`You received a malformed message from ${i} of type ${t}`);return}const s=r.connectionId,o=this.getConnection(i,s);o&&o.peerConnection?o.handleMessage(e):s?this._storeMessage(s,e):er.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){const t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:"default",...t},this.disconnected){er.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(rc.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,r),r}call(e,t,r={}){if(this.disconnected){er.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(rc.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!t){er.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const i=new Uk(e,this,{...r,_stream:t});return this._addConnection(e,i),i}_addConnection(e,t){er.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){const t=this._connections.get(e.peer);if(t){const r=t.indexOf(e);r!==-1&&t.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){const r=this._connections.get(e);if(!r)return null;for(const i of r)if(i.connectionId===t)return i;return null}_delayedAbort(e,t){setTimeout(()=>{this._abort(e,t)},0)}_abort(e,t){er.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(er.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const t=this._connections.get(e);if(t)for(const r of t)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;er.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)er.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)er.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=t=>{}){this._api.listAllPeers().then(t=>e(t)).catch(t=>this._abort(rc.ServerError,t))}}var cYe=AB;async function lYe(){return aee("netid")}async function loe(n){return cee("netid",n)}let UE="";function uYe(){return UE}let Ml;function hYe(){return Ml?.id===UE}function uoe(n){return ZEe(n)}function L$(n){const e=Qr();let t;function r(){t=R4(o=>{fe(Ml)&&yHe(o)&&vHe(o)===!1&&n.send(o)})}function i(){t=R4(o=>{fe(Ml)&&C4(o)&&bHe(o)===!1&&n.send(o)}),EEe(Ke,e)}function s(){n.open&&(Qi(Ke,e,`connection ${n.peer} open`),hYe()?r():i())}n.on("open",s),n.on("close",()=>{t?.disconnect(),fe(Ml)&&Qi(Ke,e,`disconnection from ${n.peer}`)}),n.on("data",o=>{const a=o;fe(Ml)&&t?.forward({...a,session:Ke.session()})}),n.on("error",o=>{ur(Ke,e,"netterminal",`dataconnection ${n.peer} - ${JSON.stringify(o)}`)}),s()}function hoe(n,e){UE=n,SEe(Ke,Qr(),UE);const t=Qr(),r=e??n;Ml=new cYe(r,{debug:2,host:"terminal.zed.cafe"}),window.addEventListener("unload",()=>{Ml?.disconnect(),Ml=void 0}),Qi(Ke,t,`netterminal for ${r}`),Ml.on("open",()=>{if(Qi(Ke,t,"connected to netterminal"),n!==r){Qi(Ke,t,`joining topic ${UE}`);const i=Ml?.connect(n,{reliable:!0});fe(i)&&L$(i)}else Qi(Ke,t,`hosting topic ${UE}`)}),Ml.on("connection",L$),Ml.on("disconnected",()=>{ur(Ke,t,"netterminal","lost connection to netterminal"),setTimeout(()=>{ur(Ke,t,"netterminal","retrying the connection to netterminal"),Ml?.reconnect()},5e3)}),Ml.on("error",i=>{switch(i.type){case"disconnected":case"peer-unavailable":return;case"invalid-id":case"unavailable-id":to(Ke,t,async()=>{await loe(()=>"")});return}ur(Ke,t,"netterminal",`${Ml?.id} - ${JSON.stringify(i)}`)})}async function U$(){const n=Qr();if(fe(Ml)){Qi(Ke,n,"netterminal already active");return}let e=await lYe();e=(e??"")||n,await loe(()=>e??"");const t=uoe(e);hoe(t)}function fYe(n){const e=Qr();if(fe(Ml)){Qi(Ke,e,"netterminal already active");return}const t=uoe(e);hoe(n,t)}let Tm,nu;async function dYe(n,e,t,r,i,s){let o;switch(Jn(i)){case"get":{o=await fetch(r);break}case"post:json":{const l=[];for(let u=0;u<s.length;u+=2)l.push([s[u],s[u+1]]);o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(vpe(l))});break}}if(!o?.ok)return;const a=`fetch:${t}`,[c]=(o.headers.get("content-type")??"").split(";");switch(c){case"text/plain":{const l=await o.text();Uh(Ke,n,e,"text",a,l);break}case"application/json":{const l=await o.json();Uh(Ke,n,e,"json",a,l);break}case"application/octet-stream":{const l=await o.arrayBuffer();Uh(Ke,n,e,"binary",a,new Uint8Array(l));break}}}function B$(){const n=`${location.origin}/join/#${uYe()}`;return fe(ya())&&ya().writeText(n).catch(e=>console.error(e)),n}function pYe(n){const e=/(?:https?|ftp):\/\/[\n\S]+/g;return n.replace(e,"")}function F$(n){let e=n.text;const t=[...n.emoteOffsets.values()];for(let r=0;r<t.length;++r){const i=t[r].reverse();for(let s=0;s<i.length;++s){const[o,a]=i[s].split("-").map(parseFloat);e=e.substring(0,o)+e.substring(a+1)}}return pYe(e)}const Ds=y0("bridge",[],n=>{if(!Ds.session(n))return;const e=Qr();switch(n.target){default:if(n.player!==e)return;break}switch(n.target){case"fetch":if(Xn(n.data)){const[t,r,i,s,o]=n.data;to(Ke,n.player,async()=>{await dYe(n.player,t,r,i,s,o)})}break;case"start":to(Ds,n.player,async()=>{await U$(),GSe(Ke,n.player,!!n.data)});break;case"tab":to(Ds,n.player,async()=>{await U$(),VSe(Ke,n.player)});break;case"tabopen":{const t=B$();window.open(t,"_blank","noopener,noreferrer");break}case"join":rn(n.data)&&fYe(n.data);break;case"showjoincode":{const t=B$();n.data?n4(Ds,n.player,t,"secret join url",!1):n4(Ds,n.player,t,t);break}case"chatstart":fe(Tm)?ur(Ds,n.player,"bridge","chat is already started"):rn(n.data)&&(Qi(Ds,n.player,`connecting to ${n.data}`),Tm=new Lk({channels:[n.data]}),Tm.connect(),Tm.onConnect(()=>{Qi(Ds,n.player,"connected")}),Tm.onDisconnect(()=>{Qi(Ds,n.player,"disconnected")}),Tm.onMessage((t,r,i,s)=>{const o=F$(s);Uh(Ds,n.player,void 0,"text",`chat:message:${n.data}`,`${r}:${o}`)}),Tm.onAction((t,r,i,s)=>{const o=F$(s);Uh(Ds,n.player,void 0,"text",`chat:action:${n.data}`,`${r}:${o}`)}));break;case"chatstop":fe(Tm)?(Tm.quit(),Tm=void 0,Qi(Ds,n.player,"chat stopped")):ur(Ds,n.player,"bridge","chat is already stoped");break;case"streamstart":to(Ds,n.player,async()=>{if(fe(nu))ur(Ds,n.player,"bridge","stream is already open");else{const r=window.innerHeight>window.innerWidth?fE.STANDARD_PORTRAIT:fE.STANDARD_LANDSCAPE;nu=fE.create({streamConfig:{...r,maxFramerate:60}}),nu.on(fE.BroadcastClientEvents.ACTIVE_STATE_CHANGE,function(o){console.info({activestate:o})}),nu.on(fE.BroadcastClientEvents.CONNECTION_STATE_CHANGE,function(o){Qi(Ds,n.player,o)}),nu.on(fE.BroadcastClientEvents.ERROR,function(o){ur(Ds,n.player,"bridge",o),nu=void 0});const i=document.querySelector("canvas");if(fe(i))await nu.addImageSource(i,"video",{index:1});else{ur(Ds,n.player,"video","unabled to find canvas element"),nu=void 0;return}const s=uje();if(fe(s))await nu.addAudioInputDevice(s.stream,"audio");else{ur(Ds,n.player,"video","unable create media audio node destination"),nu=void 0;return}Qi(Ds,n.player,"created client")}rn(n.data)&&fe(nu)&&(Wv(Ds,n.player,"broadcasting in"),Rh(Ds,n.player,"3","..."),await Mh(1e3),Rh(Ds,n.player,"2","..."),await Mh(1e3),Rh(Ds,n.player,"1","..."),await Mh(1e3),Wv(Ds,n.player,"GOING LIVE"),await nu.startBroadcast(n.data,"https://g.webrtc.live-video.net:4443"))});break;case"streamstop":fe(nu)?(nu.stopBroadcast(),nu.delete(),nu=void 0,Qi(Ds,n.player,"stream stopped")):ur(Ds,n.player,"bridge","stream already stopped");break}});function mYe(){const{viewport:n}=cl(),{width:e,height:t}=n.getCurrentViewport();Qe.useEffect(()=>(THe(RQ()),()=>{wHe()}),[]);const[r]=Qe.useState(()=>new bje);Qe.useEffect(()=>{if(!xpe)return;document.body.appendChild(r.dom),r.showPanel(0),r.dom.style.cssText="position:fixed;bottom:0;left:0;z-index:2;";const x=Kde(()=>r.begin()),T=Xde(()=>r.end());return()=>{document.body.removeChild(r.dom),x(),T()}},[r]);const i=Aje({benchmarksURL:"/benchmarks-min"}),[s,o]=Qe.useState(!1),[a,c]=Qe.useState(!1),[l,u]=Qe.useState(!1);Qe.useLayoutEffect(()=>{to(Ke,Qr(),async()=>{await HC("lowrez")==="on"&&o(!0),await HC("crt")==="on"&&!ADe&&c(!0),await HC("scanlines")==="on"&&u(!0)})},[]);const h=Math.min(e,t),f=s||h<600;An.DRAW_CHAR_SCALE=f?1:2;const d=e>t,p=A4==="touchOnly"||uHe==="touch",_=!f&&!p&&a===!0&&i&&(i.tier>2||i.gpu?.includes("apple gpu"))&&!i.isMobile;Qe.useEffect(()=>{Sd.setState(x=>({...x,islowrez:f,islandscape:d,showtouchcontrols:p}))},[f,d,p]);const{toast:g}=as(),[m,b]=Qe.useState(FQ),y=Qe.useRef(null);return xe.jsxs(xe.Fragment,{children:[xe.jsx(gje,{ref:y,makeDefault:!0,near:1,far:2e3,position:[0,0,1e3]}),xe.jsx(iy,{children:xe.jsxs(iVe,{children:[xe.jsx(mGe,{}),xe.jsx(i$e,{}),xe.jsx(LG,{toast:g}),xe.jsx(h$e,{}),m&&xe.jsxs(xe.Fragment,{children:[xe.jsx(e0,{blocking:!0,opacity:.5,color:"black",cursor:"pointer",width:Math.ceil(e/An.DRAW_CHAR_WIDTH()),height:Math.ceil(t/An.DRAW_CHAR_HEIGHT()),onClick:()=>b(!1)}),xe.jsx(LG,{toast:"Click to un-mute"})]})]})}),xe.jsx(c$e,{width:e,height:t,children:xe.jsx(xe.Fragment,{children:_&&xe.jsxs(xe.Fragment,{children:[l&&xe.jsx(a$e,{}),xe.jsx(iHe,{technique:SE.ESKIL,offset:.89,darkness:.911}),xe.jsx(_He,{viewheight:t})]})})})]})}FQ||window.addEventListener("keyup",()=>{DR()});window.addEventListener("click",()=>{DR()});window.addEventListener("dragover",n=>{n.preventDefault()});window.addEventListener("contextmenu",n=>{DR(),n.preventDefault()});window.addEventListener("paste",n=>{if(!n.clipboardData?.files.length)return;DR(),n.preventDefault(),[...n.clipboardData.files].forEach(t=>Uh(Ke,Qr(),void 0,"file",`file:${t.name}`,t))});window.addEventListener("drop",n=>{DR(),n.preventDefault(),n.dataTransfer?.items?[...n.dataTransfer.items].forEach(t=>{if(t.kind==="file"){const r=t.getAsFile();fe(r)&&Uh(Ke,Qr(),void 0,"file",r.name,r)}}):[...n.dataTransfer?.files??[]].forEach(t=>Uh(Ke,Qr(),void 0,"file",t.name,t))});document.addEventListener("DOMContentLoaded",()=>{let n,e=!1;document.body.style.cursor="none",document.body.addEventListener("mousemove",()=>{e||(document.body.style.cursor="",clearTimeout(n),n=setTimeout(()=>{document.body.style.cursor="none",e=!0,setTimeout(()=>{e=!1},200)},3e3))})});function gYe(){return Sd(e=>e.active)&&xe.jsx(mYe,{})}kW({Mesh:wf,OrthographicCamera:c5,Group:mw,PlaneGeometry:HA,MeshBasicMaterial:s5,BufferAttribute:Dh,BufferGeometry:h0,Points:lce,BoxGeometry:Bx,PerspectiveCamera:Ou,InstancedMesh:sce,InstancedBufferAttribute:ZD});const foe=n=>({...Zde(n),filter:e=>{const t=e.filter(o=>!!o.object.visible),r=t.findIndex(o=>o.object.userData.blocking),i=r===-1?t:t.slice(0,r+1);let s="default";return i.some(o=>o.object.userData.cursor?(s=o.object.userData.cursor,!0):!1),document.querySelectorAll("html, body").forEach(o=>{o.style.cursor=s}),i}}),Y4=Vde(document.getElementById("frame"));function _Ye(){const n=window.innerWidth,e=window.innerHeight,t=S9(n),r=S9(e),i=window.visualViewport?Math.min(e,window.visualViewport.height):e,s=Math.floor(i/An.DRAW_CHAR_HEIGHT());Sd.setState({saferows:s}),Y4.configure({size:{left:0,top:0,width:t,height:r},events:foe,dpr:1,flat:!0,linear:!0,shadows:!1,gl:{alpha:!0,stencil:!1,antialias:!1,preserveDrawingBuffer:!0}}).catch(console.error)}const pw=epe(_Ye,256);async function vYe(){await Y4.configure({events:foe,dpr:1,flat:!0,linear:!0,shadows:!1,gl:{alpha:!0,stencil:!1,antialias:!1,preserveDrawingBuffer:!0}}),window.addEventListener("resize",pw),pw(),window.visualViewport&&(window.visualViewport.addEventListener("resize",pw),window.visualViewport.addEventListener("scroll",pw)),pw(),Y4.render(xe.jsx(gYe,{}))}vYe().catch(console.error)});export default yYe();

var yC=Object.defineProperty;var TC=(We,rt,vn)=>rt in We?yC(We,rt,{enumerable:!0,configurable:!0,writable:!0,value:vn}):We[rt]=vn;var P=(We,rt,vn)=>(TC(We,typeof rt!="symbol"?rt+"":rt,vn),vn);(function(){"use strict";const We=new Set,rt={emit(e,t,n,r){rt.invoke(Eg(e,t,n,r))},invoke(e){We.forEach(t=>t.handle(e))},connect(e){We.add(e)},disconnect(e){We.delete(e)}},vn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let pg=e=>crypto.getRandomValues(new Uint8Array(e)),gg=(e,t,n)=>{let r=(2<<Math.log(e.length-1)/Math.LN2)-1,s=-~(1.6*r*t/e.length);return(i=t)=>{let o="";for(;;){let a=n(s),c=s;for(;c--;)if(o+=e[a[c]&r]||"",o.length===i)return o}}},il=(e,t=21)=>gg(e,t,pg),mg=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=vn[n[e]&63];return t};function Nn(){return mg()}function Eg(e,t,n,r){return{id:Nn(),target:e,sender:t,data:n,player:r}}function ol(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Ur(e,t,n){const r=Nn(),s=e.toLowerCase(),i=t.map(a=>a.toLowerCase()),o={id(){return r},name(){return e},tags(){return t},emit(a,c,l){rt.emit(a,r,c,l)},reply(a,c,l,u){o.emit(`${a.sender}:${c}`,l,u)},handle(a){const{target:c,path:l}=ol(a.target),u=c.toLowerCase();i.findIndex(h=>h==="all"||h===u)!==-1&&n(a),(r===c||u==="all"||s===u)&&n({...a,target:l})}};return rt.connect(o),o}function _g(e){const t=new Set;function n(r){t.has(r.id)||(t.add(r.id),rt.invoke(r))}return Ur("forward",["all"],r=>{t.has(r.id)||(t.add(r.id),e(r))}),n}var Ms=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mo(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function yg(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}),n}var al="abcdefghijklmnopqrstuvwxyz",cl="ABCDEFGHIJKLMNOPQRSTUVWXYZ",ll="0123456789",Tg="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",Sg="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const Ag=ll,wg=al,Rg=cl;var vg=Ag+wg+Rg,Eo={lowercase:al,uppercase:cl,numbers:ll,nolookalikes:Tg,nolookalikesSafe:Sg,alphanumeric:vg};/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Ng=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var i in s)s.hasOwnProperty(i)&&(r[i]=s[i])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),bg=Object.prototype.hasOwnProperty;function _o(e,t){return bg.call(e,t)}function yo(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var s in e)_o(e,s)&&r.push(s);return r}function kt(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function To(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function bn(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function ul(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function So(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(So(e[t]))return!0}else if(typeof e=="object"){for(var r=yo(e),s=r.length,i=0;i<s;i++)if(So(e[r[i]]))return!0}}return!1}function hl(e,t){var n=[e];for(var r in t){var s=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof s<"u"&&n.push(r+": "+s)}return n.join(`
`)}var fl=function(e){Ng(t,e);function t(n,r,s,i,o){var a=this.constructor,c=e.call(this,hl(n,{name:r,index:s,operation:i,tree:o}))||this;return c.name=r,c.index=s,c.operation=i,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=hl(n,{name:r,index:s,operation:i,tree:o}),c}return t}(Error),st=fl,Cg=kt,Qn={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=xs(n,this.path);r&&(r=kt(r));var s=Cn(n,{op:"remove",path:this.from}).removed;return Cn(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=xs(n,this.from);return Cn(n,{op:"add",path:this.path,value:kt(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Pr(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Ig={add:function(e,t,n){return To(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Qn.move,copy:Qn.copy,test:Qn.test,_get:Qn._get};function xs(e,t){if(t=="")return e;var n={op:"_get",path:t};return Cn(e,n),n.value}function Cn(e,t,n,r,s,i){if(n===void 0&&(n=!1),r===void 0&&(r=!0),s===void 0&&(s=!0),i===void 0&&(i=0),n&&(typeof n=="function"?n(t,0,e,t.path):Us(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=xs(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Pr(e,t.value),o.test===!1)throw new st("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new st("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,t,e);return o}}else{r||(e=kt(e));var a=t.path||"",c=a.split("/"),l=e,u=1,h=c.length,d=void 0,f=void 0,m=void 0;for(typeof n=="function"?m=n:m=Us;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=ul(f)),s&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=t.path),d!==void 0&&m(t,0,e,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!To(f))throw new st("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,t,e);To(f)&&(f=~~f)}if(u>=h){if(n&&t.op==="add"&&f>l.length)throw new st("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,t,e);var o=Ig[t.op].call(t,l,f,e);if(o.test===!1)throw new st("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return o}}else if(u>=h){var o=Qn[t.op].call(t,l,f,e);if(o.test===!1)throw new st("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return o}if(l=l[f],n&&u<h&&(!l||typeof l!="object"))throw new st("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,t,e)}}}function Ao(e,t,n,r,s){if(r===void 0&&(r=!0),s===void 0&&(s=!0),n&&!Array.isArray(t))throw new st("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=kt(e));for(var i=new Array(t.length),o=0,a=t.length;o<a;o++)i[o]=Cn(e,t[o],n,!0,s,o),e=i[o].newDocument;return i.newDocument=e,i}function Og(e,t,n){var r=Cn(e,t);if(r.test===!1)throw new st("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Us(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new st("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Qn[e.op]){if(typeof e.path!="string")throw new st("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new st('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new st("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new st("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&So(e.value))throw new st("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var s=e.path.split("/").length,i=r.split("/").length;if(s!==i+1&&s!==i)throw new st("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new st("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=dl([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new st("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new st("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function dl(e,t,n){try{if(!Array.isArray(e))throw new st("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Ao(kt(t),kt(e),n||!0);else{n=n||Us;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(s){if(s instanceof st)return s;throw s}}function Pr(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),s,i,o;if(n&&r){if(i=e.length,i!=t.length)return!1;for(s=i;s--!==0;)if(!Pr(e[s],t[s]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(i=a.length,i!==Object.keys(t).length)return!1;for(s=i;s--!==0;)if(!t.hasOwnProperty(a[s]))return!1;for(s=i;s--!==0;)if(o=a[s],!Pr(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var Lg=Object.freeze({__proto__:null,JsonPatchError:st,_areEquals:Pr,applyOperation:Cn,applyPatch:Ao,applyReducer:Og,deepClone:Cg,getValueByPointer:xs,validate:dl,validator:Us});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var wo=new WeakMap,kg=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Mg=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function xg(e){return wo.get(e)}function Ug(e,t){return e.observers.get(t)}function Pg(e,t){e.observers.delete(t.callback)}function Dg(e,t){t.unobserve()}function $g(e,t){var n=[],r,s=xg(e);if(!s)s=new kg(e),wo.set(e,s);else{var i=Ug(s,t);r=i&&i.observer}if(r)return r;if(r={},s.value=kt(e),t){r.callback=t,r.next=null;var o=function(){Ro(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){Ro(r),clearTimeout(r.next),Pg(s,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},s.observers.set(t,new Mg(t,r)),r}function Ro(e,t){t===void 0&&(t=!1);var n=wo.get(e.object);vo(n.value,e.object,e.patches,"",t),e.patches.length&&Ao(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function vo(e,t,n,r,s){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var i=yo(t),o=yo(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(_o(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var h=t[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?vo(u,h,n,r+"/"+bn(l),s):u!==h&&(s&&n.push({op:"test",path:r+"/"+bn(l),value:kt(u)}),n.push({op:"replace",path:r+"/"+bn(l),value:kt(h)}))}else Array.isArray(e)===Array.isArray(t)?(s&&n.push({op:"test",path:r+"/"+bn(l),value:kt(u)}),n.push({op:"remove",path:r+"/"+bn(l)}),a=!0):(s&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&i.length==o.length))for(var c=0;c<i.length;c++){var l=i[c];!_o(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+bn(l),value:kt(t[l])})}}}function No(e,t,n){n===void 0&&(n=!1);var r=[];return vo(e,t,r,"",n),r}var Fg=Object.freeze({__proto__:null,compare:No,generate:Ro,observe:$g,unobserve:Dg});Object.assign({},Lg,Fg,{JsonPatchError:fl,deepClone:kt,escapePathComponent:bn,unescapePathComponent:ul});function E(e){return e!=null}function Bg(e,t){return No(e,t).length===0}function Gg(e){return kt(e)}function bt(e){return typeof e=="number"}function it(e){return typeof e=="string"}function Ke(e){return Array.isArray(e)}var _t=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.CLEAR=32]="CLEAR",e[e.SHADOW=33]="SHADOW",e[e.BORROW=34]="BORROW",e))(_t||{});function Ps(e,t){return new Array(e).fill(t)}function jg(e,t,n,r,s=0){const i=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:Ps(i,0),color:Ps(i,0),bg:Ps(i,s)}}function Wg(e,t,n,r=1,s=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:s,bg:32}}function Kg(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function Hg(e,t,n,r,s=0){const i=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:Ps(i,s)}}function Vg(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:2}}var Qt=(e=>(e[e.START=0]="START",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP",e[e.BOTTOM=4]="BOTTOM",e[e.SCROLL=5]="SCROLL",e))(Qt||{});const zg={start:0,left:1,right:2,top:3,bottom:4,scroll:5},Yg={0:1,1:20,2:20,3:1,4:1,5:40},qg=1,Xg=16,Jg=256;var ft=(e=>(e[e.NONE=0]="NONE",e[e.MOVE_UP=1]="MOVE_UP",e[e.MOVE_DOWN=2]="MOVE_DOWN",e[e.MOVE_LEFT=3]="MOVE_LEFT",e[e.MOVE_RIGHT=4]="MOVE_RIGHT",e[e.OK_BUTTON=5]="OK_BUTTON",e[e.CANCEL_BUTTON=6]="CANCEL_BUTTON",e[e.MENU_BUTTON=7]="MENU_BUTTON",e))(ft||{});function Zn(e,t,n,r){const s=r??"anon";return rt.emit(`error:${t}`,e,n,s),nm(e,n,s)}function Qg(e,t,n){rt.emit("gadgetclient:reset",e,t,n)}function Zg(e,t,n){rt.emit("gadgetclient:patch",e,t,n)}function tm(e,t,n){rt.emit("register:read",e,[t],n)}function em(e,t,n,r){rt.emit("register:write",e,[t,n],r)}function $t(e,...t){return rt.emit("tape:info",e,t),!0}function bo(e,...t){return rt.emit("tape:debug",e,t),!0}function nm(e,...t){return rt.emit("tape:error",e,t),!1}var pl={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Ms,function(){return n.importState=function(s){var i=new n;return i.importState(s),i},n;function n(){return function(s){var i=0,o=0,a=0,c=1;s.length==0&&(s=[+new Date]);var l=r();i=l(" "),o=l(" "),a=l(" ");for(var u=0;u<s.length;u++)i-=l(s[u]),i<0&&(i+=1),o-=l(s[u]),o<0&&(o+=1),a-=l(s[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*i+c*23283064365386963e-26;return i=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=s,h.exportState=function(){return[i,o,a,c]},h.importState=function(d){i=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var s=4022871197,i=function(o){o=o.toString();for(var a=0;a<o.length;a++){s+=o.charCodeAt(a);var c=.02519603282416938*s;s=c>>>0,c-=s,c*=s,s=c>>>0,c-=s,s+=c*4294967296}return(s>>>0)*23283064365386963e-26};return i.version="Mash 0.9",i}})})(pl);var rm=pl.exports,sm=mo(rm);const im=sm("089fad0j9awfem09wavefc09uwaef");function In(e,t=0,n=1){return Math.max(t,Math.min(n,e))}function om(){return im()}function Ds(e,t){const n=Math.min(e,t),s=Math.max(e,t)-n+1;return n+Math.floor(om()*s)}function Co(e,t,n){typeof e!="number"&&(e=0,t=0,n=1),typeof t!="number"&&(t=e,e=0,n=1),typeof n!="number"&&(n=1);const r=[],s=Math.min(e,t),i=Math.max(e,t);for(let o=s;o<=i;o+=n)r.push(o);return r}function am(e){return e[Ds(0,e.length-1)]}function He(...e){return am(e.flat())}function cm(e){return[...new Set(e)].filter(E)}function lm(...e){const t=e.flat().filter(E);return t.reduce((n,r)=>n+r,0)/t.length}function gl(e,t){const n=e??Ct.WALK,r=t??Ct.WALK;switch(n){case Ct.WALK:return r!==Ct.WALK;case Ct.SWIM:return r!==Ct.SWIM;case Ct.SOLID:return!0;case Ct.BULLET:return r!==Ct.WALK&&r!==Ct.SWIM}}function Io(e,t){var r,s;return[...((s=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:s.values())??[]].map(i=>typeof i=="string"?e==null?void 0:e.objects[i]:e==null?void 0:e.terrain[i]).filter(E)}function um(e,t){const n=Po(t),r=Ml(t),s=xl(t);return e.filter(i=>!(E(n)&&mm(i)!==n||E(r)&&Em(i)!==r||E(s)&&_m(i)!==s)).filter(E)}function Oo(e,t){return E(e)?t.map(n=>{var r;if(typeof n=="string"){const s=e.objects[n];if(E(s))return s;const i=Io(e,n.toLowerCase());if(i.length)return i}else if(we(n)&&n.x>=0&&n.x<e.width&&n.y>=0&&n.y<e.height){const s=n.x+n.y*e.width,i=(r=e.lookup)==null?void 0:r[s];return E(i)?e.objects[i]:e.terrain[s]}}).flat().filter(E):[]}function hm(e,t){let n=0,r;for(let s=0;s<t.length;++s){const i=t[s];if(i){const o=e.x-(i.x??0),a=e.y-(i.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=i)}}return r}const fm=60,dm=25;new Array(fm*dm);function pm(e,t){return!E(e)||t.x<0||t.x>=e.width||t.y<0||t.y>=e.height?-1:t.x+t.y*e.width}function gm(e,t){const n=pm(e,t);if(n<0||!E(e==null?void 0:e.lookup))return;const r=Lo(e,e.lookup[n]??"");return E(r)?r:e.terrain[n]}function mm(e){var t;return((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"object").toLowerCase()}function Em(e){var t;return(e==null?void 0:e.color)??((t=e==null?void 0:e.kinddata)==null?void 0:t.color)??_t.BLACK}function _m(e){var t;return(e==null?void 0:e.bg)??((t=e==null?void 0:e.kinddata)==null?void 0:t.bg)??_t.BLACK}function $s(e,t){if(!E(e)||!te(t))return;const n=Cl(t);E(n)&&(e.color=n);const r=Il(t);E(r)&&(e.bg=r)}function ym(e,t){if(!E(e)||!E(t)||!E(t.x)||!E(t.y)||t.x<0||t.x>=e.width||t.y<0||t.y>=e.height)return;const n={...t},r=t.x+t.y*e.width;return e.terrain[r]=n,t}function ml(e,t){if(!E(e)||!E(t))return;const n={...t,id:t.id??Nn()};return e.objects[n.id]=n,n}function El(e,t,n){return ym(e,{...t,kind:n})}function _l(e,t,n){return ml(e,{...t,kind:n})}function Lo(e,t){if(e)return e.objects[t]}function tr(e,t,n){if(!E(e)||!E(t))return{x:0,y:0};const r={x:t.x??0,y:t.y??0},s={x:t.lx??r.x,y:t.ly??r.y},i={...r},o=ln(s,r),a=e.width-1,c=e.height-1;for(let l=0;l<n.length;++l){const u=Am(n[l]);switch(u){case K.IDLE:break;case K.NORTH:case K.SOUTH:case K.WEST:case K.EAST:Zt(r,u);break;case K.BY:{const[h,d]=n.slice(l+1);bt(h)&&bt(d)&&(r.x=In(r.x+h,0,a),r.y=In(r.y+d,0,c)),l+=2;break}case K.AT:{const[h,d]=n.slice(l+1);bt(h)&&bt(d)&&(r.x=In(h,0,a),r.y=In(d,0,c)),l+=2;break}case K.FLOW:Zt(r,o);break;case K.SEEK:{const h=Mo(e,t);we(h)&&Zt(r,ln(i,h));break}case K.RNDNS:Zt(r,He(K.NORTH,K.SOUTH));break;case K.RNDNE:Zt(r,He(K.NORTH,K.EAST));break;case K.RND:Zt(r,He(K.NORTH,K.SOUTH,K.WEST,K.EAST));break;case K.CW:{const h=tr(e,t,n.slice(l+1));Zt(r,ln(i,h));break}case K.CCW:{const h=tr(e,t,n.slice(l+1));Zt(r,ln(i,h));break}case K.OPP:{const h=tr(e,t,n.slice(l+1));Zt(r,ln(i,h));break}case K.RNDP:{const h=tr(e,t,n.slice(l+1));switch(ln(i,h)){case K.NORTH:case K.SOUTH:r.x+=He(-1,1);break;case K.WEST:case K.EAST:r.y+=He(-1,1);break}break}}}return r}function ko(e,t){return E(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function Mo(e,t){var s;if(!E(e)||!E(t))return;const n=((s=t.stats)==null?void 0:s.player)??"",r=e.objects[n];if(E(r))return r;if(we(t))return hm(t,Io(e,"player"))}function Tm(e,t,n){return{book:e.book,board:e.board,object:e.object,terrain:e.terrain,charset:e.charset,palette:e.palette,words:t,get:n}}var K=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e))(K||{}),Ct=(e=>(e[e.SOLID=0]="SOLID",e[e.WALK=1]="WALK",e[e.SWIM=2]="SWIM",e[e.BULLET=3]="BULLET",e))(Ct||{}),Fs=(e=>(e[e.TERRAIN=0]="TERRAIN",e[e.OBJECT=1]="OBJECT",e))(Fs||{});function we(e){return E(e)&&E(e.x)&&E(e.y)}function Zt(e,t){switch(t){case 1:--e.y;break;case 2:++e.y;break;case 3:--e.x;break;case 4:++e.x;break}return e}function ln(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return 3;if(n>0)return 4;if(r<0)return 1;if(r>0)return 2}const yl={terrain:"TERRAIN",object:"OBJECT"};function un(e){return Ke(e)&&Tl(e[0])}function Tl(e){return E(Fs[e])&&it(e)}function Sl(e){if(it(e))return yl[e.toLowerCase()]}function Al(e){if(un(e))return e;if(Tl(e))return[e];const t=Sl(e);if(E(t))return[t]}function Bs(e,t){const n=e.words[t],r=Al(n);if(un(r))return[r,t+1];const[s,i]=Mt(e,t),o=Al(s);return un(o)?[o,i]:[void 0,t]}const wl={solid:"SOLID",walk:"WALK",swim:"SWIM",bullet:"BULLET",walkable:"WALK",swimmable:"SWIM"};function On(e){return Ke(e)&&xo(e[0])}function xo(e){return E(Ct[e])&&it(e)}function Sm(e){if(it(e))return wl[e.toLowerCase()]}function Rl(e,t){const n=e.words[t];if(On(n))return[n,t+1];if(xo(n))return[[n],t+1];const[r,s]=Mt(e,t);return On(r)?[r,s]:xo(r)?[[r],s]:[void 0,t]}const Uo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",clear:"CLEAR",shadow:"SHADOW",borrow:"BORROW",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY"};function te(e){return Ke(e)&&Nl(e[0])}function vl(e){return te(e)&&e[0].startsWith("ON")}function Nl(e){return E(_t[e])&&it(e)}function bl(e){if(it(e))return Uo[e.toLowerCase()]}function Cl(e){return e.map(t=>_t[t]).find(t=>E(t)&&t<_t.ONBLACK)}function Il(e){return e.map(t=>_t[t]).find(t=>E(t)&&t>=_t.ONBLACK)}function Ol(e){if(te(e))return e;if(Nl(e))return[e];const t=bl(e);if(E(t))return[t]}function Ll(e,t){const n=e.words[t],r=Ol(n);if(te(r))return[r,t+1];const[s,i]=Mt(e,t),o=Ol(s);return te(o)?[o,i]:[void 0,t]}function Gs(e,t){const n=[];let r=t;const[s,i]=Ll(e,t);if(te(s)&&(n.push(...s),r=i),te(n)&&!vl(n)){const[o,a]=Ll(e,i);vl(o)&&(r=a)}return n.length?[n,r]:[void 0,t]}function er(e){return Ke(e)&&typeof e[0]=="string"}function kl(e,t){const n=e.words[t];if(er(n))return[n,t+1];const[r,s]=Gs(e,t),[i,o]=Mt(e,s,!1);return it(i)?[[i,r],o]:[void 0,t]}function Po(e){if(!er(e))return;const[t]=e;return t}function Ml(e){if(!er(e))return;const[,t]=e,n=E(t)?Cl(t):void 0;return E(n)?n:void 0}function xl(e){if(!er(e))return;const[,t]=e,n=E(t)?Il(t):void 0;return E(n)?n:void 0}const Ul={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function Ve(e){return Ke(e)&&Pl(e[0])}function Pl(e){return E(K[e])&&it(e)}function Am(e){const t=K[e];return E(t)?t:0}function Dl(e){if(it(e))return Ul[e.toLowerCase()]}function $l(e){if(Ve(e))return e;if(Pl(e))return[e];const t=Dl(e);if(E(t))return[t]}function Fl(e,t){const n=e.words[t],r=$l(n);if(Ve(r))return[r,t+1];const[s,i]=Mt(e,t),o=$l(s);return Ve(o)?[o,i]:[void 0,t]}function Do(e,t){const n=[];let[r,s]=Fl(e,t);for(;Ve(r);){if(n.push(...r),r[0]==="AT"||r[0]==="BY"){const[a,c,l]=C(e,s,[5,5]);n.push(a,c),s=l}const[i,o]=Fl(e,s);r=i,s=o}return n.length?[n,s]:[void 0,t]}function Mt(e,t,n=!0){const r=e.words[t];if(Sl(r)){const[s,i]=Bs(e,t);if(E(s))return[s,i]}if(Sm(r)){const[s,i]=Rl(e,t);if(E(s))return[s,i]}if(bl(r)){const[s,i]=Gs(e,t);if(E(s))return[s,i]}if(it(r)&&r.toLowerCase()==="rnd"){const[s,i]=Mt(e,t+1),[o,a]=Mt(e,i);return bt(s)&&bt(o)?[Ds(s,o),a]:bt(s)?[Ds(0,s),i]:[Ds(0,1),t+1]}if(Dl(r)){const[s,i]=Do(e,t);if(E(s))return[s,i]}if(!E(r))return[void 0,t];if(we(r)||bt(r)||Ke(r))return[r,t+1];if(it(r)){const s=r.toLowerCase();if(n){const i=e.get(r);if(E(i))return[i,t+1]}switch(s){case"aligned":case"alligned":break;case"contact":break;case"blocked":break;case"any":break;case"abs":{const[i,o]=C(e,t+1,[5]);return[Math.abs(i),o]}case"ceil":{const[i,o]=C(e,t+1,[5]);return[Math.ceil(i),o]}case"floor":{const[i,o]=C(e,t+1,[5]);return[Math.floor(i),o]}case"round":{const[i,o]=C(e,t+1,[5]);return[Math.round(i),o]}case"min":{const i=[];for(let o=t+1;o<e.words.length;){const[a,c]=Mt(e,o);if(Ke(a)&&!we(a)&&!Ve(a)&&!un(a)&&!On(a)&&!te(a))return[He(a),c];o=c,i.push(a)}return[Math.min(...i),e.words.length]}case"max":{const i=[];for(let o=t+1;o<e.words.length;){const[a,c]=Mt(e,o);if(Ke(a)&&!we(a)&&!Ve(a)&&!un(a)&&!On(a)&&!te(a))return[He(a),c];o=c,i.push(a)}return[Math.max(...i),e.words.length]}case"clamp":{const[i,o,a,c]=C(e,t+1,[5,5,5]);return[In(i,o,a),c]}case"pick":{const i=[];for(let o=t+1;o<e.words.length;){const[a,c]=Mt(e,o);if(Ke(a)&&!we(a)&&!Ve(a)&&!un(a)&&!On(a)&&!te(a))return[He(a),c];o=c,i.push(a)}return[He(i),e.words.length]}case"range":{const[i,o,a,c]=C(e,t+1,[5,13,13]);return[Co(i,o,a),c]}}}return[r,t+1]}var N=(e=>(e[e.CATEGORY=0]="CATEGORY",e[e.COLLISION=1]="COLLISION",e[e.COLOR=2]="COLOR",e[e.KIND=3]="KIND",e[e.DIR=4]="DIR",e[e.NUMBER=5]="NUMBER",e[e.STRING=6]="STRING",e[e.NUMBER_OR_STRING=7]="NUMBER_OR_STRING",e[e.MAYBE_CATEGORY=8]="MAYBE_CATEGORY",e[e.MAYBE_COLLISION=9]="MAYBE_COLLISION",e[e.MAYBE_COLOR=10]="MAYBE_COLOR",e[e.MAYBE_KIND=11]="MAYBE_KIND",e[e.MAYBE_DIR=12]="MAYBE_DIR",e[e.MAYBE_NUMBER=13]="MAYBE_NUMBER",e[e.MAYBE_STRING=14]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=15]="MAYBE_NUMBER_OR_STRING",e[e.ANY=16]="ANY",e))(N||{});function It(e,t){throw new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function C(e,t,n){const r=[];let s=t;for(let i=0;i<n.length;++i)switch(n[i]){case 0:{const[o,a]=Bs(e,s);un(o)||It("terrain or object",o),s=a,r.push(o);break}case 1:{const[o,a]=Rl(e,s);On(o)||It("solid, walk, swim, bullet, walkable or swimmable",o),s=a,r.push(o);break}case 2:{const[o,a]=Gs(e,s);te(o)||It("color",o),s=a,r.push(o);break}case 3:{const[o,a]=kl(e,s);er(o)?(s=a,r.push(o)):It("kind",o);break}case 4:{const[o,a]=Do(e,s);if(Ve(o)){const c=e.board?tr(e.board,e.object,o):{x:0,y:0};s=a,r.push(c)}else It("direction",o);break}case 5:{const[o,a]=Mt(e,s);bt(o)||It("number",o),s=a,r.push(o);break}case 6:{const o=e.words[s];it(o)||It("string",o),++s,r.push(o);break}case 7:{const[o,a]=Mt(e,s,!1);!bt(o)&&!it(o)&&It("number or string",o),s=a,r.push(o);break}case 8:{const[o,a]=Bs(e,s);o!==void 0&&!un(o)&&It("optional terrain or object",o),s=a,r.push(o);break}case 9:{const[o,a]=Bs(e,s);o!==void 0&&!On(o)&&It("optional solid, walk, swim, bullet, walkable or swimmable",o),s=a,r.push(o);break}case 10:{const[o,a]=Gs(e,s);o!==void 0&&!te(o)&&It("optional color",o),s=a,r.push(o);break}case 11:{const[o,a]=kl(e,s);o!==void 0&&!er(o)&&It("optional kind",o),s=a,r.push(o);break}case 12:{const[o,a]=Do(e,s);if(Ve(o)){const c=e.board?tr(e.board,e.object,o):{x:0,y:0};s=a,r.push(c)}else o===void 0?(s=a,r.push(void 0)):It("optional direction",o);break}case 13:{const[o,a]=Mt(e,s);o!==void 0&&!bt(o)&&It("optional number",o),s=a,r.push(o);break}case 14:{const o=e.words[s];o!==void 0&&!it(o)&&It("optional string",o),++s,r.push(o);break}case 15:{const[o,a]=Mt(e,s,!1);o!==void 0&&!bt(o)&&!it(o)&&It("optional number or string",o),s=a,r.push(o);break}case 16:{const[o,a]=Mt(e,s);s=a,r.push(o);break}}return[...r,s]}const $o=40,Fo=Math.round(1e3/$o),wm=3;var Bl=typeof global=="object"&&global&&global.Object===Object&&global,Rm=typeof self=="object"&&self&&self.Object===Object&&self,Re=Bl||Rm||Function("return this")(),ee=Re.Symbol,Gl=Object.prototype,vm=Gl.hasOwnProperty,Nm=Gl.toString,Dr=ee?ee.toStringTag:void 0;function bm(e){var t=vm.call(e,Dr),n=e[Dr];try{e[Dr]=void 0;var r=!0}catch{}var s=Nm.call(e);return r&&(t?e[Dr]=n:delete e[Dr]),s}var Cm=Object.prototype,Im=Cm.toString;function Om(e){return Im.call(e)}var Lm="[object Null]",km="[object Undefined]",jl=ee?ee.toStringTag:void 0;function hn(e){return e==null?e===void 0?km:Lm:jl&&jl in Object(e)?bm(e):Om(e)}function he(e){return e!=null&&typeof e=="object"}var Mm="[object Symbol]";function js(e){return typeof e=="symbol"||he(e)&&hn(e)==Mm}function Ws(e,t){for(var n=-1,r=e==null?0:e.length,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s}var j=Array.isArray,xm=1/0,Wl=ee?ee.prototype:void 0,Kl=Wl?Wl.toString:void 0;function Hl(e){if(typeof e=="string")return e;if(j(e))return Ws(e,Hl)+"";if(js(e))return Kl?Kl.call(e):"";var t=e+"";return t=="0"&&1/e==-xm?"-0":t}var Um=/\s/;function Pm(e){for(var t=e.length;t--&&Um.test(e.charAt(t)););return t}var Dm=/^\s+/;function $m(e){return e&&e.slice(0,Pm(e)+1).replace(Dm,"")}function ne(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Vl=NaN,Fm=/^[-+]0x[0-9a-f]+$/i,Bm=/^0b[01]+$/i,Gm=/^0o[0-7]+$/i,jm=parseInt;function Wm(e){if(typeof e=="number")return e;if(js(e))return Vl;if(ne(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ne(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=$m(e);var n=Bm.test(e);return n||Gm.test(e)?jm(e.slice(2),n?2:8):Fm.test(e)?Vl:+e}var zl=1/0,Km=17976931348623157e292;function Hm(e){if(!e)return e===0?e:0;if(e=Wm(e),e===zl||e===-zl){var t=e<0?-1:1;return t*Km}return e===e?e:0}function Ks(e){var t=Hm(e),n=t%1;return t===t?n?t-n:t:0}function nr(e){return e}var Vm="[object AsyncFunction]",zm="[object Function]",Ym="[object GeneratorFunction]",qm="[object Proxy]";function ze(e){if(!ne(e))return!1;var t=hn(e);return t==zm||t==Ym||t==Vm||t==qm}var Bo=Re["__core-js_shared__"],Yl=function(){var e=/[^.]+$/.exec(Bo&&Bo.keys&&Bo.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Xm(e){return!!Yl&&Yl in e}var Jm=Function.prototype,Qm=Jm.toString;function Ln(e){if(e!=null){try{return Qm.call(e)}catch{}try{return e+""}catch{}}return""}var Zm=/[\\^$.*+?()[\]{}|]/g,tE=/^\[object .+?Constructor\]$/,eE=Function.prototype,nE=Object.prototype,rE=eE.toString,sE=nE.hasOwnProperty,iE=RegExp("^"+rE.call(sE).replace(Zm,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function oE(e){if(!ne(e)||Xm(e))return!1;var t=ze(e)?iE:tE;return t.test(Ln(e))}function aE(e,t){return e==null?void 0:e[t]}function kn(e,t){var n=aE(e,t);return oE(n)?n:void 0}var Go=kn(Re,"WeakMap"),ql=Object.create,cE=function(){function e(){}return function(t){if(!ne(t))return{};if(ql)return ql(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function lE(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function dt(){}function uE(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var hE=800,fE=16,dE=Date.now;function pE(e){var t=0,n=0;return function(){var r=dE(),s=fE-(r-n);if(n=r,s>0){if(++t>=hE)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function gE(e){return function(){return e}}var Hs=function(){try{var e=kn(Object,"defineProperty");return e({},"",{}),e}catch{}}(),mE=Hs?function(e,t){return Hs(e,"toString",{configurable:!0,enumerable:!1,value:gE(t),writable:!0})}:nr,EE=pE(mE);function Xl(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function Jl(e,t,n,r){for(var s=e.length,i=n+-1;++i<s;)if(t(e[i],i,e))return i;return-1}function _E(e){return e!==e}function yE(e,t,n){for(var r=n-1,s=e.length;++r<s;)if(e[r]===t)return r;return-1}function jo(e,t,n){return t===t?yE(e,t,n):Jl(e,_E,n)}function Ql(e,t){var n=e==null?0:e.length;return!!n&&jo(e,t,0)>-1}var TE=9007199254740991,SE=/^(?:0|[1-9]\d*)$/;function Vs(e,t){var n=typeof e;return t=t??TE,!!t&&(n=="number"||n!="symbol"&&SE.test(e))&&e>-1&&e%1==0&&e<t}function Wo(e,t,n){t=="__proto__"&&Hs?Hs(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function $r(e,t){return e===t||e!==e&&t!==t}var AE=Object.prototype,wE=AE.hasOwnProperty;function zs(e,t,n){var r=e[t];(!(wE.call(e,t)&&$r(r,n))||n===void 0&&!(t in e))&&Wo(e,t,n)}function Ko(e,t,n,r){var s=!n;n||(n={});for(var i=-1,o=t.length;++i<o;){var a=t[i],c=void 0;c===void 0&&(c=e[a]),s?Wo(n,a,c):zs(n,a,c)}return n}var Zl=Math.max;function RE(e,t,n){return t=Zl(t===void 0?e.length-1:t,0),function(){for(var r=arguments,s=-1,i=Zl(r.length-t,0),o=Array(i);++s<i;)o[s]=r[t+s];s=-1;for(var a=Array(t+1);++s<t;)a[s]=r[s];return a[t]=n(o),lE(e,this,a)}}function Ho(e,t){return EE(RE(e,t,nr),e+"")}var vE=9007199254740991;function Vo(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=vE}function ve(e){return e!=null&&Vo(e.length)&&!ze(e)}function tu(e,t,n){if(!ne(n))return!1;var r=typeof t;return(r=="number"?ve(n)&&Vs(t,n.length):r=="string"&&t in n)?$r(n[t],e):!1}function NE(e){return Ho(function(t,n){var r=-1,s=n.length,i=s>1?n[s-1]:void 0,o=s>2?n[2]:void 0;for(i=e.length>3&&typeof i=="function"?(s--,i):void 0,o&&tu(n[0],n[1],o)&&(i=s<3?void 0:i,s=1),t=Object(t);++r<s;){var a=n[r];a&&e(t,a,r,i)}return t})}var bE=Object.prototype;function Fr(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||bE;return e===n}function CE(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var IE="[object Arguments]";function eu(e){return he(e)&&hn(e)==IE}var nu=Object.prototype,OE=nu.hasOwnProperty,LE=nu.propertyIsEnumerable,Ys=eu(function(){return arguments}())?eu:function(e){return he(e)&&OE.call(e,"callee")&&!LE.call(e,"callee")};function kE(){return!1}var ru=typeof exports=="object"&&exports&&!exports.nodeType&&exports,su=ru&&typeof module=="object"&&module&&!module.nodeType&&module,ME=su&&su.exports===ru,iu=ME?Re.Buffer:void 0,xE=iu?iu.isBuffer:void 0,Br=xE||kE,UE="[object Arguments]",PE="[object Array]",DE="[object Boolean]",$E="[object Date]",FE="[object Error]",BE="[object Function]",GE="[object Map]",jE="[object Number]",WE="[object Object]",KE="[object RegExp]",HE="[object Set]",VE="[object String]",zE="[object WeakMap]",YE="[object ArrayBuffer]",qE="[object DataView]",XE="[object Float32Array]",JE="[object Float64Array]",QE="[object Int8Array]",ZE="[object Int16Array]",t_="[object Int32Array]",e_="[object Uint8Array]",n_="[object Uint8ClampedArray]",r_="[object Uint16Array]",s_="[object Uint32Array]",X={};X[XE]=X[JE]=X[QE]=X[ZE]=X[t_]=X[e_]=X[n_]=X[r_]=X[s_]=!0,X[UE]=X[PE]=X[YE]=X[DE]=X[qE]=X[$E]=X[FE]=X[BE]=X[GE]=X[jE]=X[WE]=X[KE]=X[HE]=X[VE]=X[zE]=!1;function i_(e){return he(e)&&Vo(e.length)&&!!X[hn(e)]}function qs(e){return function(t){return e(t)}}var ou=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Gr=ou&&typeof module=="object"&&module&&!module.nodeType&&module,o_=Gr&&Gr.exports===ou,zo=o_&&Bl.process,fn=function(){try{var e=Gr&&Gr.require&&Gr.require("util").types;return e||zo&&zo.binding&&zo.binding("util")}catch{}}(),au=fn&&fn.isTypedArray,Yo=au?qs(au):i_,a_=Object.prototype,c_=a_.hasOwnProperty;function cu(e,t){var n=j(e),r=!n&&Ys(e),s=!n&&!r&&Br(e),i=!n&&!r&&!s&&Yo(e),o=n||r||s||i,a=o?CE(e.length,String):[],c=a.length;for(var l in e)(t||c_.call(e,l))&&!(o&&(l=="length"||s&&(l=="offset"||l=="parent")||i&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Vs(l,c)))&&a.push(l);return a}function lu(e,t){return function(n){return e(t(n))}}var l_=lu(Object.keys,Object),u_=Object.prototype,h_=u_.hasOwnProperty;function uu(e){if(!Fr(e))return l_(e);var t=[];for(var n in Object(e))h_.call(e,n)&&n!="constructor"&&t.push(n);return t}function re(e){return ve(e)?cu(e):uu(e)}var f_=Object.prototype,d_=f_.hasOwnProperty,Ht=NE(function(e,t){if(Fr(t)||ve(t)){Ko(t,re(t),e);return}for(var n in t)d_.call(t,n)&&zs(e,n,t[n])});function p_(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var g_=Object.prototype,m_=g_.hasOwnProperty;function E_(e){if(!ne(e))return p_(e);var t=Fr(e),n=[];for(var r in e)r=="constructor"&&(t||!m_.call(e,r))||n.push(r);return n}function hu(e){return ve(e)?cu(e,!0):E_(e)}var __=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,y_=/^\w*$/;function qo(e,t){if(j(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||js(e)?!0:y_.test(e)||!__.test(e)||t!=null&&e in Object(t)}var jr=kn(Object,"create");function T_(){this.__data__=jr?jr(null):{},this.size=0}function S_(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var A_="__lodash_hash_undefined__",w_=Object.prototype,R_=w_.hasOwnProperty;function v_(e){var t=this.__data__;if(jr){var n=t[e];return n===A_?void 0:n}return R_.call(t,e)?t[e]:void 0}var N_=Object.prototype,b_=N_.hasOwnProperty;function C_(e){var t=this.__data__;return jr?t[e]!==void 0:b_.call(t,e)}var I_="__lodash_hash_undefined__";function O_(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=jr&&t===void 0?I_:t,this}function Mn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Mn.prototype.clear=T_,Mn.prototype.delete=S_,Mn.prototype.get=v_,Mn.prototype.has=C_,Mn.prototype.set=O_;function L_(){this.__data__=[],this.size=0}function Xs(e,t){for(var n=e.length;n--;)if($r(e[n][0],t))return n;return-1}var k_=Array.prototype,M_=k_.splice;function x_(e){var t=this.__data__,n=Xs(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():M_.call(t,n,1),--this.size,!0}function U_(e){var t=this.__data__,n=Xs(t,e);return n<0?void 0:t[n][1]}function P_(e){return Xs(this.__data__,e)>-1}function D_(e,t){var n=this.__data__,r=Xs(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function Ye(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ye.prototype.clear=L_,Ye.prototype.delete=x_,Ye.prototype.get=U_,Ye.prototype.has=P_,Ye.prototype.set=D_;var Wr=kn(Re,"Map");function $_(){this.size=0,this.__data__={hash:new Mn,map:new(Wr||Ye),string:new Mn}}function F_(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Js(e,t){var n=e.__data__;return F_(t)?n[typeof t=="string"?"string":"hash"]:n.map}function B_(e){var t=Js(this,e).delete(e);return this.size-=t?1:0,t}function G_(e){return Js(this,e).get(e)}function j_(e){return Js(this,e).has(e)}function W_(e,t){var n=Js(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function qe(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}qe.prototype.clear=$_,qe.prototype.delete=B_,qe.prototype.get=G_,qe.prototype.has=j_,qe.prototype.set=W_;var K_="Expected a function";function Xo(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(K_);var n=function(){var r=arguments,s=t?t.apply(this,r):r[0],i=n.cache;if(i.has(s))return i.get(s);var o=e.apply(this,r);return n.cache=i.set(s,o)||i,o};return n.cache=new(Xo.Cache||qe),n}Xo.Cache=qe;var H_=500;function V_(e){var t=Xo(e,function(r){return n.size===H_&&n.clear(),r}),n=t.cache;return t}var z_=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Y_=/\\(\\)?/g,q_=V_(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(z_,function(n,r,s,i){t.push(s?i.replace(Y_,"$1"):r||n)}),t});function X_(e){return e==null?"":Hl(e)}function Qs(e,t){return j(e)?e:qo(e,t)?[e]:q_(X_(e))}var J_=1/0;function Kr(e){if(typeof e=="string"||js(e))return e;var t=e+"";return t=="0"&&1/e==-J_?"-0":t}function Jo(e,t){t=Qs(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[Kr(t[n++])];return n&&n==r?e:void 0}function Q_(e,t,n){var r=e==null?void 0:Jo(e,t);return r===void 0?n:r}function Qo(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e}var fu=ee?ee.isConcatSpreadable:void 0;function Z_(e){return j(e)||Ys(e)||!!(fu&&e&&e[fu])}function Zo(e,t,n,r,s){var i=-1,o=e.length;for(n||(n=Z_),s||(s=[]);++i<o;){var a=e[i];n(a)?Qo(s,a):r||(s[s.length]=a)}return s}function fe(e){var t=e==null?0:e.length;return t?Zo(e):[]}var du=lu(Object.getPrototypeOf,Object);function pu(e,t,n){var r=-1,s=e.length;t<0&&(t=-t>s?0:s+t),n=n>s?s:n,n<0&&(n+=s),s=t>n?0:n-t>>>0,t>>>=0;for(var i=Array(s);++r<s;)i[r]=e[r+t];return i}function ty(e,t,n,r){var s=-1,i=e==null?0:e.length;for(r&&i&&(n=e[++s]);++s<i;)n=t(n,e[s],s,e);return n}function ey(){this.__data__=new Ye,this.size=0}function ny(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function ry(e){return this.__data__.get(e)}function sy(e){return this.__data__.has(e)}var iy=200;function oy(e,t){var n=this.__data__;if(n instanceof Ye){var r=n.__data__;if(!Wr||r.length<iy-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new qe(r)}return n.set(e,t),this.size=n.size,this}function Ne(e){var t=this.__data__=new Ye(e);this.size=t.size}Ne.prototype.clear=ey,Ne.prototype.delete=ny,Ne.prototype.get=ry,Ne.prototype.has=sy,Ne.prototype.set=oy;function ay(e,t){return e&&Ko(t,re(t),e)}var gu=typeof exports=="object"&&exports&&!exports.nodeType&&exports,mu=gu&&typeof module=="object"&&module&&!module.nodeType&&module,cy=mu&&mu.exports===gu,Eu=cy?Re.Buffer:void 0,_u=Eu?Eu.allocUnsafe:void 0;function ly(e,t){var n=e.length,r=_u?_u(n):new e.constructor(n);return e.copy(r),r}function ta(e,t){for(var n=-1,r=e==null?0:e.length,s=0,i=[];++n<r;){var o=e[n];t(o,n,e)&&(i[s++]=o)}return i}function yu(){return[]}var uy=Object.prototype,hy=uy.propertyIsEnumerable,Tu=Object.getOwnPropertySymbols,ea=Tu?function(e){return e==null?[]:(e=Object(e),ta(Tu(e),function(t){return hy.call(e,t)}))}:yu;function fy(e,t){return Ko(e,ea(e),t)}var dy=Object.getOwnPropertySymbols,py=dy?function(e){for(var t=[];e;)Qo(t,ea(e)),e=du(e);return t}:yu;function Su(e,t,n){var r=t(e);return j(e)?r:Qo(r,n(e))}function na(e){return Su(e,re,ea)}function gy(e){return Su(e,hu,py)}var ra=kn(Re,"DataView"),sa=kn(Re,"Promise"),rr=kn(Re,"Set"),Au="[object Map]",my="[object Object]",wu="[object Promise]",Ru="[object Set]",vu="[object WeakMap]",Nu="[object DataView]",Ey=Ln(ra),_y=Ln(Wr),yy=Ln(sa),Ty=Ln(rr),Sy=Ln(Go),se=hn;(ra&&se(new ra(new ArrayBuffer(1)))!=Nu||Wr&&se(new Wr)!=Au||sa&&se(sa.resolve())!=wu||rr&&se(new rr)!=Ru||Go&&se(new Go)!=vu)&&(se=function(e){var t=hn(e),n=t==my?e.constructor:void 0,r=n?Ln(n):"";if(r)switch(r){case Ey:return Nu;case _y:return Au;case yy:return wu;case Ty:return Ru;case Sy:return vu}return t});var Ay=Object.prototype,wy=Ay.hasOwnProperty;function Ry(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&wy.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Zs=Re.Uint8Array;function vy(e){var t=new e.constructor(e.byteLength);return new Zs(t).set(new Zs(e)),t}function Ny(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var by=/\w*$/;function Cy(e){var t=new e.constructor(e.source,by.exec(e));return t.lastIndex=e.lastIndex,t}var bu=ee?ee.prototype:void 0,Cu=bu?bu.valueOf:void 0;function Iy(e){return Cu?Object(Cu.call(e)):{}}function Oy(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var Ly="[object Boolean]",ky="[object Date]",My="[object Map]",xy="[object Number]",Uy="[object RegExp]",Py="[object Set]",Dy="[object String]",$y="[object Symbol]",Fy="[object ArrayBuffer]",By="[object DataView]",Gy="[object Float32Array]",jy="[object Float64Array]",Wy="[object Int8Array]",Ky="[object Int16Array]",Hy="[object Int32Array]",Vy="[object Uint8Array]",zy="[object Uint8ClampedArray]",Yy="[object Uint16Array]",qy="[object Uint32Array]";function Xy(e,t,n){var r=e.constructor;switch(t){case Fy:return vy(e);case Ly:case ky:return new r(+e);case By:return Ny(e);case Gy:case jy:case Wy:case Ky:case Hy:case Vy:case zy:case Yy:case qy:return Oy(e);case My:return new r;case xy:case Dy:return new r(e);case Uy:return Cy(e);case Py:return new r;case $y:return Iy(e)}}function Jy(e){return typeof e.constructor=="function"&&!Fr(e)?cE(du(e)):{}}var Qy="[object Map]";function Zy(e){return he(e)&&se(e)==Qy}var Iu=fn&&fn.isMap,tT=Iu?qs(Iu):Zy,eT="[object Set]";function nT(e){return he(e)&&se(e)==eT}var Ou=fn&&fn.isSet,rT=Ou?qs(Ou):nT,Lu="[object Arguments]",sT="[object Array]",iT="[object Boolean]",oT="[object Date]",aT="[object Error]",ku="[object Function]",cT="[object GeneratorFunction]",lT="[object Map]",uT="[object Number]",Mu="[object Object]",hT="[object RegExp]",fT="[object Set]",dT="[object String]",pT="[object Symbol]",gT="[object WeakMap]",mT="[object ArrayBuffer]",ET="[object DataView]",_T="[object Float32Array]",yT="[object Float64Array]",TT="[object Int8Array]",ST="[object Int16Array]",AT="[object Int32Array]",wT="[object Uint8Array]",RT="[object Uint8ClampedArray]",vT="[object Uint16Array]",NT="[object Uint32Array]",V={};V[Lu]=V[sT]=V[mT]=V[ET]=V[iT]=V[oT]=V[_T]=V[yT]=V[TT]=V[ST]=V[AT]=V[lT]=V[uT]=V[Mu]=V[hT]=V[fT]=V[dT]=V[pT]=V[wT]=V[RT]=V[vT]=V[NT]=!0,V[aT]=V[ku]=V[gT]=!1;function ti(e,t,n,r,s,i){var o;if(o!==void 0)return o;if(!ne(e))return e;var a=j(e);if(a)return o=Ry(e),uE(e,o);var c=se(e),l=c==ku||c==cT;if(Br(e))return ly(e);if(c==Mu||c==Lu||l&&!s)return o=l?{}:Jy(e),fy(e,ay(o,e));if(!V[c])return s?e:{};o=Xy(e,c),i||(i=new Ne);var u=i.get(e);if(u)return u;i.set(e,o),rT(e)?e.forEach(function(f){o.add(ti(f,t,n,f,e,i))}):tT(e)&&e.forEach(function(f,m){o.set(m,ti(f,t,n,m,e,i))});var h=na,d=a?void 0:h(e);return Xl(d||e,function(f,m){d&&(m=f,f=e[m]),zs(o,m,ti(f,t,n,m,e,i))}),o}var bT=4;function wt(e){return ti(e,bT)}function Hr(e){for(var t=-1,n=e==null?0:e.length,r=0,s=[];++t<n;){var i=e[t];i&&(s[r++]=i)}return s}var CT="__lodash_hash_undefined__";function IT(e){return this.__data__.set(e,CT),this}function OT(e){return this.__data__.has(e)}function sr(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new qe;++t<n;)this.add(e[t])}sr.prototype.add=sr.prototype.push=IT,sr.prototype.has=OT;function xu(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function ia(e,t){return e.has(t)}var LT=1,kT=2;function Uu(e,t,n,r,s,i){var o=n&LT,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=i.get(e),u=i.get(t);if(l&&u)return l==t&&u==e;var h=-1,d=!0,f=n&kT?new sr:void 0;for(i.set(e,t),i.set(t,e);++h<a;){var m=e[h],_=t[h];if(r)var w=o?r(_,m,h,t,e,i):r(m,_,h,e,t,i);if(w!==void 0){if(w)continue;d=!1;break}if(f){if(!xu(t,function(R,A){if(!ia(f,A)&&(m===R||s(m,R,n,r,i)))return f.push(A)})){d=!1;break}}else if(!(m===_||s(m,_,n,r,i))){d=!1;break}}return i.delete(e),i.delete(t),d}function MT(e){var t=-1,n=Array(e.size);return e.forEach(function(r,s){n[++t]=[s,r]}),n}function oa(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var xT=1,UT=2,PT="[object Boolean]",DT="[object Date]",$T="[object Error]",FT="[object Map]",BT="[object Number]",GT="[object RegExp]",jT="[object Set]",WT="[object String]",KT="[object Symbol]",HT="[object ArrayBuffer]",VT="[object DataView]",Pu=ee?ee.prototype:void 0,aa=Pu?Pu.valueOf:void 0;function zT(e,t,n,r,s,i,o){switch(n){case VT:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case HT:return!(e.byteLength!=t.byteLength||!i(new Zs(e),new Zs(t)));case PT:case DT:case BT:return $r(+e,+t);case $T:return e.name==t.name&&e.message==t.message;case GT:case WT:return e==t+"";case FT:var a=MT;case jT:var c=r&xT;if(a||(a=oa),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=UT,o.set(e,t);var u=Uu(a(e),a(t),r,s,i,o);return o.delete(e),u;case KT:if(aa)return aa.call(e)==aa.call(t)}return!1}var YT=1,qT=Object.prototype,XT=qT.hasOwnProperty;function JT(e,t,n,r,s,i){var o=n&YT,a=na(e),c=a.length,l=na(t),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in t:XT.call(t,d)))return!1}var f=i.get(e),m=i.get(t);if(f&&m)return f==t&&m==e;var _=!0;i.set(e,t),i.set(t,e);for(var w=o;++h<c;){d=a[h];var R=e[d],A=t[d];if(r)var T=o?r(A,R,d,t,e,i):r(R,A,d,e,t,i);if(!(T===void 0?R===A||s(R,A,n,r,i):T)){_=!1;break}w||(w=d=="constructor")}if(_&&!w){var b=e.constructor,y=t.constructor;b!=y&&"constructor"in e&&"constructor"in t&&!(typeof b=="function"&&b instanceof b&&typeof y=="function"&&y instanceof y)&&(_=!1)}return i.delete(e),i.delete(t),_}var QT=1,Du="[object Arguments]",$u="[object Array]",ei="[object Object]",ZT=Object.prototype,Fu=ZT.hasOwnProperty;function tS(e,t,n,r,s,i){var o=j(e),a=j(t),c=o?$u:se(e),l=a?$u:se(t);c=c==Du?ei:c,l=l==Du?ei:l;var u=c==ei,h=l==ei,d=c==l;if(d&&Br(e)){if(!Br(t))return!1;o=!0,u=!1}if(d&&!u)return i||(i=new Ne),o||Yo(e)?Uu(e,t,n,r,s,i):zT(e,t,c,n,r,s,i);if(!(n&QT)){var f=u&&Fu.call(e,"__wrapped__"),m=h&&Fu.call(t,"__wrapped__");if(f||m){var _=f?e.value():e,w=m?t.value():t;return i||(i=new Ne),s(_,w,n,r,i)}}return d?(i||(i=new Ne),JT(e,t,n,r,s,i)):!1}function ca(e,t,n,r,s){return e===t?!0:e==null||t==null||!he(e)&&!he(t)?e!==e&&t!==t:tS(e,t,n,r,ca,s)}var eS=1,nS=2;function rS(e,t,n,r){var s=n.length,i=s;if(e==null)return!i;for(e=Object(e);s--;){var o=n[s];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++s<i;){o=n[s];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new Ne,h;if(!(h===void 0?ca(l,c,eS|nS,r,u):h))return!1}}return!0}function Bu(e){return e===e&&!ne(e)}function sS(e){for(var t=re(e),n=t.length;n--;){var r=t[n],s=e[r];t[n]=[r,s,Bu(s)]}return t}function Gu(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function iS(e){var t=sS(e);return t.length==1&&t[0][2]?Gu(t[0][0],t[0][1]):function(n){return n===e||rS(n,e,t)}}function oS(e,t){return e!=null&&t in Object(e)}function ju(e,t,n){t=Qs(t,e);for(var r=-1,s=t.length,i=!1;++r<s;){var o=Kr(t[r]);if(!(i=e!=null&&n(e,o)))break;e=e[o]}return i||++r!=s?i:(s=e==null?0:e.length,!!s&&Vo(s)&&Vs(o,s)&&(j(e)||Ys(e)))}function aS(e,t){return e!=null&&ju(e,t,oS)}var cS=1,lS=2;function uS(e,t){return qo(e)&&Bu(t)?Gu(Kr(e),t):function(n){var r=Q_(n,e);return r===void 0&&r===t?aS(n,e):ca(t,r,cS|lS)}}function hS(e){return function(t){return t==null?void 0:t[e]}}function fS(e){return function(t){return Jo(t,e)}}function dS(e){return qo(e)?hS(Kr(e)):fS(e)}function be(e){return typeof e=="function"?e:e==null?nr:typeof e=="object"?j(e)?uS(e[0],e[1]):iS(e):dS(e)}function pS(e,t,n,r){for(var s=-1,i=e==null?0:e.length;++s<i;){var o=e[s];t(r,o,n(o),e)}return r}function gS(e){return function(t,n,r){for(var s=-1,i=Object(t),o=r(t),a=o.length;a--;){var c=o[++s];if(n(i[c],c,i)===!1)break}return t}}var mS=gS();function ES(e,t){return e&&mS(e,t,re)}function _S(e,t){return function(n,r){if(n==null)return n;if(!ve(n))return e(n,r);for(var s=n.length,i=-1,o=Object(n);++i<s&&r(o[i],i,o)!==!1;);return n}}var xn=_S(ES);function yS(e,t,n,r){return xn(e,function(s,i,o){t(r,s,n(s),o)}),r}function TS(e,t){return function(n,r){var s=j(n)?pS:yS,i=t?t():{};return s(n,e,be(r),i)}}var Wu=Object.prototype,SS=Wu.hasOwnProperty,la=Ho(function(e,t){e=Object(e);var n=-1,r=t.length,s=r>2?t[2]:void 0;for(s&&tu(t[0],t[1],s)&&(r=1);++n<r;)for(var i=t[n],o=hu(i),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||$r(u,Wu[l])&&!SS.call(e,l))&&(e[l]=i[l])}return e});function Ku(e){return he(e)&&ve(e)}var AS=200;function wS(e,t,n,r){var s=-1,i=Ql,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=AS&&(i=ia,o=!1,t=new sr(t));t:for(;++s<a;){var u=e[s],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(t[d]===h)continue t;c.push(u)}else i(t,h,r)||c.push(u)}return c}var ni=Ho(function(e,t){return Ku(e)?wS(e,Zo(t,1,Ku,!0)):[]});function ir(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function Rt(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Ks(t),pu(e,t<0?0:t,r)):[]}function Vr(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Ks(t),t=r-t,pu(e,0,t<0?0:t)):[]}function RS(e){return typeof e=="function"?e:nr}function M(e,t){var n=j(e)?Xl:xn;return n(e,RS(t))}function vS(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function NS(e,t){var n=!0;return xn(e,function(r,s,i){return n=!!t(r,s,i),n}),n}function de(e,t,n){var r=j(e)?vS:NS;return r(e,be(t))}function Hu(e,t){var n=[];return xn(e,function(r,s,i){t(r,s,i)&&n.push(r)}),n}function ie(e,t){var n=j(e)?ta:Hu;return n(e,be(t))}function bS(e){return function(t,n,r){var s=Object(t);if(!ve(t)){var i=be(n);t=re(t),n=function(a){return i(s[a],a,s)}}var o=e(t,n,r);return o>-1?s[i?t[o]:o]:void 0}}var CS=Math.max;function IS(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var s=n==null?0:Ks(n);return s<0&&(s=CS(r+s,0)),Jl(e,be(t),s)}var or=bS(IS);function pe(e){return e&&e.length?e[0]:void 0}function OS(e,t){var n=-1,r=ve(e)?Array(e.length):[];return xn(e,function(s,i,o){r[++n]=t(s,i,o)}),r}function I(e,t){var n=j(e)?Ws:OS;return n(e,be(t))}function oe(e,t){return Zo(I(e,t))}var LS=Object.prototype,kS=LS.hasOwnProperty,MS=TS(function(e,t,n){kS.call(e,n)?e[n].push(t):Wo(e,n,[t])}),xS=Object.prototype,US=xS.hasOwnProperty;function PS(e,t){return e!=null&&US.call(e,t)}function k(e,t){return e!=null&&ju(e,t,PS)}var DS="[object String]";function Ft(e){return typeof e=="string"||!j(e)&&he(e)&&hn(e)==DS}function $S(e,t){return Ws(t,function(n){return e[n]})}function pt(e){return e==null?[]:$S(e,re(e))}var FS=Math.max;function xt(e,t,n,r){e=ve(e)?e:pt(e),n=n&&!r?Ks(n):0;var s=e.length;return n<0&&(n=FS(s+n,0)),Ft(e)?n<=s&&e.indexOf(t,n)>-1:!!s&&jo(e,t,n)>-1}function Vu(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var s=0;return jo(e,t,s)}var BS="[object Map]",GS="[object Set]",jS=Object.prototype,WS=jS.hasOwnProperty;function z(e){if(e==null)return!0;if(ve(e)&&(j(e)||typeof e=="string"||typeof e.splice=="function"||Br(e)||Yo(e)||Ys(e)))return!e.length;var t=se(e);if(t==BS||t==GS)return!e.size;if(Fr(e))return!uu(e).length;for(var n in e)if(WS.call(e,n))return!1;return!0}var KS="[object RegExp]";function HS(e){return he(e)&&hn(e)==KS}var zu=fn&&fn.isRegExp,Xe=zu?qs(zu):HS;function Je(e){return e===void 0}var VS="Expected a function";function zS(e){if(typeof e!="function")throw new TypeError(VS);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function YS(e,t,n,r){if(!ne(e))return e;t=Qs(t,e);for(var s=-1,i=t.length,o=i-1,a=e;a!=null&&++s<i;){var c=Kr(t[s]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(s!=o){var u=a[c];l=void 0,l===void 0&&(l=ne(u)?u:Vs(t[s+1])?[]:{})}zs(a,c,l),a=a[c]}return e}function qS(e,t,n){for(var r=-1,s=t.length,i={};++r<s;){var o=t[r],a=Jo(e,o);n(a,o)&&YS(i,Qs(o,e),a)}return i}function ge(e,t){if(e==null)return{};var n=Ws(gy(e),function(r){return[r]});return t=be(t),qS(e,n,function(r,s){return t(r,s[0])})}function XS(e,t,n,r,s){return s(e,function(i,o,a){n=r?(r=!1,i):t(n,i,o,a)}),n}function Vt(e,t,n){var r=j(e)?ty:XS,s=arguments.length<3;return r(e,be(t),n,s,xn)}function ri(e,t){var n=j(e)?ta:Hu;return n(e,zS(be(t)))}function JS(e,t){var n;return xn(e,function(r,s,i){return n=t(r,s,i),!n}),!!n}function Yu(e,t,n){var r=j(e)?xu:JS;return r(e,be(t))}var QS=1/0,ZS=rr&&1/oa(new rr([,-0]))[1]==QS?function(e){return new rr(e)}:dt,tA=200;function eA(e,t,n){var r=-1,s=Ql,i=e.length,o=!0,a=[],c=a;if(i>=tA){var l=ZS(e);if(l)return oa(l);o=!1,s=ia,c=new sr}else c=a;t:for(;++r<i;){var u=e[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue t;a.push(u)}else s(c,h,n)||(c!==a&&c.push(h),a.push(u))}return a}function ua(e){return e&&e.length?eA(e):[]}function ha(e){console&&console.error&&console.error(`Error: ${e}`)}function qu(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function Xu(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function Ju(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function nA(e){return rA(e)?e.LABEL:e.name}function rA(e){return Ft(e.LABEL)&&e.LABEL!==""}class Ce{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),M(this.definition,n=>{n.accept(t)})}}class zt extends Ce{constructor(t){super([]),this.idx=1,Ht(this,ge(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class ar extends Ce{constructor(t){super(t.definition),this.orgText="",Ht(this,ge(t,n=>n!==void 0))}}class Bt extends Ce{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Ht(this,ge(t,n=>n!==void 0))}}class Gt extends Ce{constructor(t){super(t.definition),this.idx=1,Ht(this,ge(t,n=>n!==void 0))}}class Ie extends Ce{constructor(t){super(t.definition),this.idx=1,Ht(this,ge(t,n=>n!==void 0))}}class Oe extends Ce{constructor(t){super(t.definition),this.idx=1,Ht(this,ge(t,n=>n!==void 0))}}class gt extends Ce{constructor(t){super(t.definition),this.idx=1,Ht(this,ge(t,n=>n!==void 0))}}class me extends Ce{constructor(t){super(t.definition),this.idx=1,Ht(this,ge(t,n=>n!==void 0))}}class Ee extends Ce{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Ht(this,ge(t,n=>n!==void 0))}}class Q{constructor(t){this.idx=1,Ht(this,ge(t,n=>n!==void 0))}accept(t){t.visit(this)}}function sA(e){return I(e,si)}function si(e){function t(n){return I(n,si)}if(e instanceof zt){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return Ft(e.label)&&(n.label=e.label),n}else{if(e instanceof Bt)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Gt)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof Ie)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof Oe)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:si(new Q({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof me)return{type:"RepetitionWithSeparator",idx:e.idx,separator:si(new Q({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof gt)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof Ee)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Q){const n={type:"Terminal",name:e.terminalType.name,label:nA(e.terminalType),idx:e.idx};Ft(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=Xe(r)?r.source:r),n}else{if(e instanceof ar)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class cr{visit(t){const n=t;switch(n.constructor){case zt:return this.visitNonTerminal(n);case Bt:return this.visitAlternative(n);case Gt:return this.visitOption(n);case Ie:return this.visitRepetitionMandatory(n);case Oe:return this.visitRepetitionMandatoryWithSeparator(n);case me:return this.visitRepetitionWithSeparator(n);case gt:return this.visitRepetition(n);case Ee:return this.visitAlternation(n);case Q:return this.visitTerminal(n);case ar:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function iA(e){return e instanceof Bt||e instanceof Gt||e instanceof gt||e instanceof Ie||e instanceof Oe||e instanceof me||e instanceof Q||e instanceof ar}function ii(e,t=[]){return e instanceof Gt||e instanceof gt||e instanceof me?!0:e instanceof Ee?Yu(e.definition,r=>ii(r,t)):e instanceof zt&&xt(t,e)?!1:e instanceof Ce?(e instanceof zt&&t.push(e),de(e.definition,r=>ii(r,t))):!1}function oA(e){return e instanceof Ee}function Le(e){if(e instanceof zt)return"SUBRULE";if(e instanceof Gt)return"OPTION";if(e instanceof Ee)return"OR";if(e instanceof Ie)return"AT_LEAST_ONE";if(e instanceof Oe)return"AT_LEAST_ONE_SEP";if(e instanceof me)return"MANY_SEP";if(e instanceof gt)return"MANY";if(e instanceof Q)return"CONSUME";throw Error("non exhaustive match")}class oi{walk(t,n=[]){M(t.definition,(r,s)=>{const i=Rt(t.definition,s+1);if(r instanceof zt)this.walkProdRef(r,i,n);else if(r instanceof Q)this.walkTerminal(r,i,n);else if(r instanceof Bt)this.walkFlat(r,i,n);else if(r instanceof Gt)this.walkOption(r,i,n);else if(r instanceof Ie)this.walkAtLeastOne(r,i,n);else if(r instanceof Oe)this.walkAtLeastOneSep(r,i,n);else if(r instanceof me)this.walkManySep(r,i,n);else if(r instanceof gt)this.walkMany(r,i,n);else if(r instanceof Ee)this.walkOr(r,i,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const s=n.concat(r);this.walk(t,s)}walkOption(t,n,r){const s=n.concat(r);this.walk(t,s)}walkAtLeastOne(t,n,r){const s=[new Gt({definition:t.definition})].concat(n,r);this.walk(t,s)}walkAtLeastOneSep(t,n,r){const s=Qu(t,n,r);this.walk(t,s)}walkMany(t,n,r){const s=[new Gt({definition:t.definition})].concat(n,r);this.walk(t,s)}walkManySep(t,n,r){const s=Qu(t,n,r);this.walk(t,s)}walkOr(t,n,r){const s=n.concat(r);M(t.definition,i=>{const o=new Bt({definition:[i]});this.walk(o,s)})}}function Qu(e,t,n){return[new Gt({definition:[new Q({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function zr(e){if(e instanceof zt)return zr(e.referencedRule);if(e instanceof Q)return lA(e);if(iA(e))return aA(e);if(oA(e))return cA(e);throw Error("non exhaustive match")}function aA(e){let t=[];const n=e.definition;let r=0,s=n.length>r,i,o=!0;for(;s&&o;)i=n[r],o=ii(i),t=t.concat(zr(i)),r=r+1,s=n.length>r;return ua(t)}function cA(e){const t=I(e.definition,n=>zr(n));return ua(fe(t))}function lA(e){return[e.terminalType]}const Zu="_~IN~_";class uA extends oi{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const s=fA(t.referencedRule,t.idx)+this.topProd.name,i=n.concat(r),o=new Bt({definition:i}),a=zr(o);this.follows[s]=a}}function hA(e){const t={};return M(e,n=>{const r=new uA(n).startWalking();Ht(t,r)}),t}function fA(e,t){return e.name+t+Zu}function x(e){return e.charCodeAt(0)}function fa(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function Yr(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function lr(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function dA(){throw Error("Internal Error - Should never get here!")}function th(e){return e.type==="Character"}const ai=[];for(let e=x("0");e<=x("9");e++)ai.push(e);const ci=[x("_")].concat(ai);for(let e=x("a");e<=x("z");e++)ci.push(e);for(let e=x("A");e<=x("Z");e++)ci.push(e);const eh=[x(" "),x("\f"),x(`
`),x("\r"),x("	"),x("\v"),x("	"),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x("\u2028"),x("\u2029"),x(" "),x(" "),x("　"),x("\uFEFF")],pA=/[0-9a-fA-F]/,li=/[0-9]/,gA=/[1-9]/;class mA{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Yr(r,"global");break;case"i":Yr(r,"ignoreCase");break;case"m":Yr(r,"multiLine");break;case"u":Yr(r,"unicode");break;case"y":Yr(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}lr(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return dA()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const s=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:s,atMost:s};break;case",":let i;this.isDigit()?(i=this.integerIncludingZero(),n={atLeast:s,atMost:i}):n={atLeast:s,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;lr(n);break}if(!(t===!0&&n===void 0)&&lr(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),lr(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[x(`
`),x("\r"),x("\u2028"),x("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=ai;break;case"D":t=ai,n=!0;break;case"s":t=eh;break;case"S":t=eh,n=!0;break;case"w":t=ci;break;case"W":t=ci,n=!0;break}if(lr(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=x("\f");break;case"n":t=x(`
`);break;case"r":t=x("\r");break;case"t":t=x("	");break;case"v":t=x("\v");break}if(lr(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:x("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:x(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:x(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,th(r)&&this.isRangeDash()){this.consumeChar("-");const s=this.classAtom();if(s.type,th(s)){if(s.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:s.value})}else fa(r.value,t),t.push(x("-")),fa(s.value,t)}else fa(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:x("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(gA.test(t)===!1)throw Error("Expecting a positive integer");for(;li.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(li.test(t)===!1)throw Error("Expecting an integer");for(;li.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:x(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return li.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let s=0;s<t;s++){const i=this.popChar();if(pA.test(i)===!1)throw Error("Expecting a HexDecimal digits");n+=i}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class da{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(s=>{this.visit(s)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let ui={};const EA=new mA;function hi(e){const t=e.toString();if(ui.hasOwnProperty(t))return ui[t];{const n=EA.pattern(t);return ui[t]=n,n}}function _A(){ui={}}const nh="Complement Sets are not supported for first char optimization",fi=`Unable to use "first char" lexer optimizations:
`;function yA(e,t=!1){try{const n=hi(e);return pa(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===nh)t&&qu(`${fi}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),ha(`${fi}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function pa(e,t,n){switch(e.type){case"Disjunction":for(let s=0;s<e.value.length;s++)pa(e.value[s],t,n);break;case"Alternative":const r=e.value;for(let s=0;s<r.length;s++){const i=r[s];switch(i.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=i;switch(o.type){case"Character":di(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(nh);M(o.value,c=>{if(typeof c=="number")di(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)di(u,t,n);else{for(let u=l.from;u<=l.to&&u<Xr;u++)di(u,t,n);if(l.to>=Xr){const u=l.from>=Xr?l.from:Xr,h=l.to,d=dn(u),f=dn(h);for(let m=d;m<=f;m++)t[m]=m}}}});break;case"Group":pa(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&ga(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return pt(t)}function di(e,t,n){const r=dn(e);t[r]=r,n===!0&&TA(e,t)}function TA(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const s=dn(r.charCodeAt(0));t[s]=s}else{const s=n.toLowerCase();if(s!==n){const i=dn(s.charCodeAt(0));t[i]=i}}}function rh(e,t){return or(e.value,n=>{if(typeof n=="number")return xt(t,n);{const r=n;return or(t,s=>r.from<=s&&s<=r.to)!==void 0}})}function ga(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?j(e.value)?de(e.value,ga):ga(e.value):!1}class SA extends da{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){xt(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?rh(t,this.targetCharCodes)===void 0&&(this.found=!0):rh(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function ma(e,t){if(t instanceof RegExp){const n=hi(t),r=new SA(e);return r.visit(n),r.found}else return or(t,n=>xt(e,n.charCodeAt(0)))!==void 0}const Un="PATTERN",qr="defaultMode",pi="modes";let sh=typeof new RegExp("(?:)").sticky=="boolean";function AA(e,t){t=la(t,{useSticky:sh,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(A,T)=>T()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{HA()});let r;n("Reject Lexer.NA",()=>{r=ri(e,A=>A[Un]===yt.NA)});let s=!1,i;n("Transform Patterns",()=>{s=!1,i=I(r,A=>{const T=A[Un];if(Xe(T)){const b=T.source;return b.length===1&&b!=="^"&&b!=="$"&&b!=="."&&!T.ignoreCase?b:b.length===2&&b[0]==="\\"&&!xt(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],b[1])?b[1]:t.useSticky?oh(T):ih(T)}else{if(ze(T))return s=!0,{exec:T};if(typeof T=="object")return s=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const b=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),y=new RegExp(b);return t.useSticky?oh(y):ih(y)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=I(r,A=>A.tokenTypeIdx),a=I(r,A=>{const T=A.GROUP;if(T!==yt.SKIPPED){if(Ft(T))return T;if(Je(T))return!1;throw Error("non exhaustive match")}}),c=I(r,A=>{const T=A.LONGER_ALT;if(T)return j(T)?I(T,y=>Vu(r,y)):[Vu(r,T)]}),l=I(r,A=>A.PUSH_MODE),u=I(r,A=>k(A,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const A=lh(t.lineTerminatorCharacters);h=I(r,T=>!1),t.positionTracking!=="onlyOffset"&&(h=I(r,T=>k(T,"LINE_BREAKS")?!!T.LINE_BREAKS:ch(T,A)===!1&&ma(A,T.PATTERN)))});let d,f,m,_;n("Misc Mapping #2",()=>{d=I(r,ah),f=I(i,jA),m=Vt(r,(A,T)=>{const b=T.GROUP;return Ft(b)&&b!==yt.SKIPPED&&(A[b]=[]),A},{}),_=I(i,(A,T)=>({pattern:i[T],longerAlt:c[T],canLineTerminator:h[T],isCustom:d[T],short:f[T],group:a[T],push:l[T],pop:u[T],tokenTypeIdx:o[T],tokenType:r[T]}))});let w=!0,R=[];return t.safeMode||n("First Char Optimization",()=>{R=Vt(r,(A,T,b)=>{if(typeof T.PATTERN=="string"){const y=T.PATTERN.charCodeAt(0),g=dn(y);Ea(A,g,_[b])}else if(j(T.START_CHARS_HINT)){let y;M(T.START_CHARS_HINT,g=>{const p=typeof g=="string"?g.charCodeAt(0):g,S=dn(p);y!==S&&(y=S,Ea(A,S,_[b]))})}else if(Xe(T.PATTERN))if(T.PATTERN.unicode)w=!1,t.ensureOptimizations&&ha(`${fi}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const y=yA(T.PATTERN,t.ensureOptimizations);z(y)&&(w=!1),M(y,g=>{Ea(A,g,_[b])})}else t.ensureOptimizations&&ha(`${fi}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),w=!1;return A},[])}),{emptyGroups:m,patternIdxToConfig:_,charCodeToPatternIdxToConfig:R,hasCustom:s,canBeOptimized:w}}function wA(e,t){let n=[];const r=vA(e);n=n.concat(r.errors);const s=NA(r.valid),i=s.valid;return n=n.concat(s.errors),n=n.concat(RA(i)),n=n.concat(xA(i)),n=n.concat(UA(i,t)),n=n.concat(PA(i)),n}function RA(e){let t=[];const n=ie(e,r=>Xe(r[Un]));return t=t.concat(CA(n)),t=t.concat(LA(n)),t=t.concat(kA(n)),t=t.concat(MA(n)),t=t.concat(IA(n)),t}function vA(e){const t=ie(e,s=>!k(s,Un)),n=I(t,s=>({message:"Token Type: ->"+s.name+"<- missing static 'PATTERN' property",type:ot.MISSING_PATTERN,tokenTypes:[s]})),r=ni(e,t);return{errors:n,valid:r}}function NA(e){const t=ie(e,s=>{const i=s[Un];return!Xe(i)&&!ze(i)&&!k(i,"exec")&&!Ft(i)}),n=I(t,s=>({message:"Token Type: ->"+s.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:ot.INVALID_PATTERN,tokenTypes:[s]})),r=ni(e,t);return{errors:n,valid:r}}const bA=/[^\\][$]/;function CA(e){class t extends da{constructor(){super(...arguments),this.found=!1}visitEndAnchor(i){this.found=!0}}const n=ie(e,s=>{const i=s.PATTERN;try{const o=hi(i),a=new t;return a.visit(o),a.found}catch{return bA.test(i.source)}});return I(n,s=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+s.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ot.EOI_ANCHOR_FOUND,tokenTypes:[s]}))}function IA(e){const t=ie(e,r=>r.PATTERN.test(""));return I(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:ot.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const OA=/[^\\[][\^]|^\^/;function LA(e){class t extends da{constructor(){super(...arguments),this.found=!1}visitStartAnchor(i){this.found=!0}}const n=ie(e,s=>{const i=s.PATTERN;try{const o=hi(i),a=new t;return a.visit(o),a.found}catch{return OA.test(i.source)}});return I(n,s=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+s.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ot.SOI_ANCHOR_FOUND,tokenTypes:[s]}))}function kA(e){const t=ie(e,r=>{const s=r[Un];return s instanceof RegExp&&(s.multiline||s.global)});return I(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:ot.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function MA(e){const t=[];let n=I(e,i=>Vt(e,(o,a)=>(i.PATTERN.source===a.PATTERN.source&&!xt(t,a)&&a.PATTERN!==yt.NA&&(t.push(a),o.push(a)),o),[]));n=Hr(n);const r=ie(n,i=>i.length>1);return I(r,i=>{const o=I(i,c=>c.name);return{message:`The same RegExp pattern ->${pe(i).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:ot.DUPLICATE_PATTERNS_FOUND,tokenTypes:i}})}function xA(e){const t=ie(e,r=>{if(!k(r,"GROUP"))return!1;const s=r.GROUP;return s!==yt.SKIPPED&&s!==yt.NA&&!Ft(s)});return I(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:ot.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function UA(e,t){const n=ie(e,s=>s.PUSH_MODE!==void 0&&!xt(t,s.PUSH_MODE));return I(n,s=>({message:`Token Type: ->${s.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${s.PUSH_MODE}<-which does not exist`,type:ot.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[s]}))}function PA(e){const t=[],n=Vt(e,(r,s,i)=>{const o=s.PATTERN;return o===yt.NA||(Ft(o)?r.push({str:o,idx:i,tokenType:s}):Xe(o)&&$A(o)&&r.push({str:o.source,idx:i,tokenType:s})),r},[]);return M(e,(r,s)=>{M(n,({str:i,idx:o,tokenType:a})=>{if(s<o&&DA(i,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:ot.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function DA(e,t){if(Xe(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(ze(t))return t(e,0,[],{});if(k(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function $A(e){return or([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function ih(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function oh(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function FA(e,t,n){const r=[];return k(e,qr)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+qr+`> property in its definition
`,type:ot.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),k(e,pi)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+pi+`> property in its definition
`,type:ot.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),k(e,pi)&&k(e,qr)&&!k(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${qr}: <${e.defaultMode}>which does not exist
`,type:ot.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),k(e,pi)&&M(e.modes,(s,i)=>{M(s,(o,a)=>{if(Je(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${i}> at index: <${a}>
`,type:ot.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(k(o,"LONGER_ALT")){const c=j(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];M(c,l=>{!Je(l)&&!xt(s,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${i}>
`,type:ot.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function BA(e,t,n){const r=[];let s=!1;const i=Hr(fe(pt(e.modes))),o=ri(i,c=>c[Un]===yt.NA),a=lh(n);return t&&M(o,c=>{const l=ch(c,a);if(l!==!1){const h={message:KA(c,l),type:l.issue,tokenType:c};r.push(h)}else k(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(s=!0):ma(a,c.PATTERN)&&(s=!0)}),t&&!s&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:ot.NO_LINE_BREAKS_FLAGS}),r}function GA(e){const t={},n=re(e);return M(n,r=>{const s=e[r];if(j(s))t[r]=[];else throw Error("non exhaustive match")}),t}function ah(e){const t=e.PATTERN;if(Xe(t))return!1;if(ze(t))return!0;if(k(t,"exec"))return!0;if(Ft(t))return!1;throw Error("non exhaustive match")}function jA(e){return Ft(e)&&e.length===1?e.charCodeAt(0):!1}const WA={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function ch(e,t){if(k(e,"LINE_BREAKS"))return!1;if(Xe(e.PATTERN)){try{ma(t,e.PATTERN)}catch(n){return{issue:ot.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Ft(e.PATTERN))return!1;if(ah(e))return{issue:ot.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function KA(e,t){if(t.issue===ot.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===ot.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function lh(e){return I(e,n=>Ft(n)?n.charCodeAt(0):n)}function Ea(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const Xr=256;let gi=[];function dn(e){return e<Xr?e:gi[e]}function HA(){if(z(gi)){gi=new Array(65536);for(let e=0;e<65536;e++)gi[e]=e>255?255+~~(e/255):e}}function Jr(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function mi(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let uh=1;const hh={};function Qr(e){const t=VA(e);zA(t),qA(t),YA(t),M(t,n=>{n.isParent=n.categoryMatches.length>0})}function VA(e){let t=wt(e),n=e,r=!0;for(;r;){n=Hr(fe(I(n,i=>i.CATEGORIES)));const s=ni(n,t);t=t.concat(s),z(s)?r=!1:n=s}return t}function zA(e){M(e,t=>{dh(t)||(hh[uh]=t,t.tokenTypeIdx=uh++),ph(t)&&!j(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),ph(t)||(t.CATEGORIES=[]),XA(t)||(t.categoryMatches=[]),JA(t)||(t.categoryMatchesMap={})})}function YA(e){M(e,t=>{t.categoryMatches=[],M(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(hh[r].tokenTypeIdx)})})}function qA(e){M(e,t=>{fh([],t)})}function fh(e,t){M(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),M(t.CATEGORIES,n=>{const r=e.concat(t);xt(r,n)||fh(r,n)})}function dh(e){return k(e,"tokenTypeIdx")}function ph(e){return k(e,"CATEGORIES")}function XA(e){return k(e,"categoryMatches")}function JA(e){return k(e,"categoryMatchesMap")}function QA(e){return k(e,"tokenTypeIdx")}const ZA={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,s){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var ot;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(ot||(ot={}));const Zr={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:ZA,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Zr);class yt{constructor(t,n=Zr){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(s,i)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${s}>`);const{time:a,value:c}=Xu(i),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${s}> time: ${a}ms`),this.traceInitIndent--,c}else return i()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Ht({},Zr,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let s,i=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Zr.lineTerminatorsPattern)this.config.lineTerminatorsPattern=WA;else if(this.config.lineTerminatorCharacters===Zr.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),j(t)?s={modes:{defaultMode:wt(t)},defaultMode:qr}:(i=!1,s=wt(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(FA(s,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(BA(s,this.trackStartLines,this.config.lineTerminatorCharacters))})),s.modes=s.modes?s.modes:{},M(s.modes,(a,c)=>{s.modes[c]=ri(a,l=>Je(l))});const o=re(s.modes);if(M(s.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(wA(a,o))}),z(this.lexerDefinitionErrors)){Qr(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=AA(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Ht({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=s.defaultMode,!z(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=I(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}M(this.lexerDefinitionWarning,a=>{qu(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(sh?(this.chopInput=nr,this.match=this.matchWithTest):(this.updateLastIndex=dt,this.match=this.matchWithExec),i&&(this.handleModes=dt),this.trackStartLines===!1&&(this.computeNewColumn=nr),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=dt),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Vt(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!z(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{_A()}),this.TRACE_INIT("toFastProperties",()=>{Ju(this)})})}tokenize(t,n=this.defaultMode){if(!z(this.lexerDefinitionErrors)){const s=I(this.lexerDefinitionErrors,i=>i.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+s)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,s,i,o,a,c,l,u,h,d,f,m,_,w,R;const A=t,T=A.length;let b=0,y=0;const g=this.hasCustom?0:Math.floor(t.length/10),p=new Array(g),S=[];let v=this.trackStartLines?1:void 0,W=this.trackStartLines?1:void 0;const ut=GA(this.emptyGroups),Mr=this.trackStartLines,At=this.config.lineTerminatorsPattern;let je=0,le=[],Ls=[];const go=[],og=[];Object.freeze(og);let ks;function ag(){return le}function cg(Lt){const ue=dn(Lt),xr=Ls[ue];return xr===void 0?og:xr}const _C=Lt=>{if(go.length===1&&Lt.tokenType.PUSH_MODE===void 0){const ue=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Lt);S.push({offset:Lt.startOffset,line:Lt.startLine,column:Lt.startColumn,length:Lt.image.length,message:ue})}else{go.pop();const ue=ir(go);le=this.patternIdxToConfig[ue],Ls=this.charCodeToPatternIdxToConfig[ue],je=le.length;const xr=this.canModeBeOptimized[ue]&&this.config.safeMode===!1;Ls&&xr?ks=cg:ks=ag}};function lg(Lt){go.push(Lt),Ls=this.charCodeToPatternIdxToConfig[Lt],le=this.patternIdxToConfig[Lt],je=le.length,je=le.length;const ue=this.canModeBeOptimized[Lt]&&this.config.safeMode===!1;Ls&&ue?ks=cg:ks=ag}lg.call(this,n);let Ae;const ug=this.config.recoveryEnabled;for(;b<T;){c=null;const Lt=A.charCodeAt(b),ue=ks(Lt),xr=ue.length;for(r=0;r<xr;r++){Ae=ue[r];const Jt=Ae.pattern;l=null;const an=Ae.short;if(an!==!1?Lt===an&&(c=Jt):Ae.isCustom===!0?(R=Jt.exec(A,b,p,ut),R!==null?(c=R[0],R.payload!==void 0&&(l=R.payload)):c=null):(this.updateLastIndex(Jt,b),c=this.match(Jt,t,b)),c!==null){if(a=Ae.longerAlt,a!==void 0){const Rn=a.length;for(i=0;i<Rn;i++){const cn=le[a[i]],Jn=cn.pattern;if(u=null,cn.isCustom===!0?(R=Jn.exec(A,b,p,ut),R!==null?(o=R[0],R.payload!==void 0&&(u=R.payload)):o=null):(this.updateLastIndex(Jn,b),o=this.match(Jn,t,b)),o&&o.length>c.length){c=o,l=u,Ae=cn;break}}}break}}if(c!==null){if(h=c.length,d=Ae.group,d!==void 0&&(f=Ae.tokenTypeIdx,m=this.createTokenInstance(c,b,f,Ae.tokenType,v,W,h),this.handlePayload(m,l),d===!1?y=this.addToken(p,y,m):ut[d].push(m)),t=this.chopInput(t,h),b=b+h,W=this.computeNewColumn(W,h),Mr===!0&&Ae.canLineTerminator===!0){let Jt=0,an,Rn;At.lastIndex=0;do an=At.test(c),an===!0&&(Rn=At.lastIndex-1,Jt++);while(an===!0);Jt!==0&&(v=v+Jt,W=h-Rn,this.updateTokenEndLineColumnLocation(m,d,Rn,Jt,v,W,h))}this.handleModes(Ae,_C,lg,m)}else{const Jt=b,an=v,Rn=W;let cn=ug===!1;for(;cn===!1&&b<T;)for(t=this.chopInput(t,1),b++,s=0;s<je;s++){const Jn=le[s],rl=Jn.pattern,hg=Jn.short;if(hg!==!1?A.charCodeAt(b)===hg&&(cn=!0):Jn.isCustom===!0?cn=rl.exec(A,b,p,ut)!==null:(this.updateLastIndex(rl,b),cn=rl.exec(t)!==null),cn===!0)break}if(_=b-Jt,W=this.computeNewColumn(W,_),w=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(A,Jt,_,an,Rn),S.push({offset:Jt,line:an,column:Rn,length:_,message:w}),ug===!1)break}}return this.hasCustom||(p.length=y),{tokens:p,groups:ut,errors:S}}handleModes(t,n,r,s){if(t.pop===!0){const i=t.push;n(s),i!==void 0&&r.call(this,i)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,s,i,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,s===1&&c===!0||(t.endLine=i+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,s){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:s}}createStartOnlyToken(t,n,r,s,i,o){return{image:t,startOffset:n,startLine:i,startColumn:o,tokenTypeIdx:r,tokenType:s}}createFullToken(t,n,r,s,i,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:i,endLine:i,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:s}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}}yt.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",yt.NA=/NOT_APPLICABLE/;function ts(e){return gh(e)?e.LABEL:e.name}function gh(e){return Ft(e.LABEL)&&e.LABEL!==""}const tw="parent",mh="categories",Eh="label",_h="group",yh="push_mode",Th="pop_mode",Sh="longer_alt",Ah="line_breaks",wh="start_chars_hint";function U(e){return ew(e)}function ew(e){const t=e.pattern,n={};if(n.name=e.name,Je(t)||(n.PATTERN=t),k(e,tw))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return k(e,mh)&&(n.CATEGORIES=e[mh]),Qr([n]),k(e,Eh)&&(n.LABEL=e[Eh]),k(e,_h)&&(n.GROUP=e[_h]),k(e,Th)&&(n.POP_MODE=e[Th]),k(e,yh)&&(n.PUSH_MODE=e[yh]),k(e,Sh)&&(n.LONGER_ALT=e[Sh]),k(e,Ah)&&(n.LINE_BREAKS=e[Ah]),k(e,wh)&&(n.START_CHARS_HINT=e[wh]),n}const Pn=U({name:"EOF",pattern:yt.NA});Qr([Pn]);function Ei(e,t,n,r,s,i,o,a){return{image:t,startOffset:n,endOffset:r,startLine:s,endLine:i,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function nw(e,t){return Jr(e,t)}const Rh={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${gh(e)?`--> ${ts(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:s}){const i="Expecting: ",a=`
but found: '`+pe(t).image+"'";if(r)return i+r+a;{const c=Vt(e,(d,f)=>d.concat(f),[]),l=I(c,d=>`[${I(d,f=>ts(f)).join(", ")}]`),h=`one of these possible Token sequences:
${I(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return i+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const s="Expecting: ",o=`
but found: '`+pe(t).image+"'";if(n)return s+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${I(e,l=>`[${I(l,u=>ts(u)).join(",")}]`).join(" ,")}>`;return s+c+o}}};Object.freeze(Rh);const rw={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},Dn={buildDuplicateFoundError(e,t){function n(u){return u instanceof Q?u.terminalType.name:u instanceof zt?u.nonTerminalName:""}const r=e.name,s=pe(t),i=s.idx,o=Le(s),a=n(s),c=i>0;let l=`->${o}${c?i:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=I(e.prefixPath,s=>ts(s)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=I(e.prefixPath,s=>ts(s)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Le(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=I(e.leftRecursionPath,i=>i.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof ar?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function sw(e,t){const n=new iw(e,t);return n.resolveRefs(),n.errors}class iw extends cr{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){M(pt(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:Ut.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class ow extends oi{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=wt(this.path.ruleStack).reverse(),this.occurrenceStack=wt(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const s=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,s)}}updateExpectedNext(){z(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class aw extends ow{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const s=n.concat(r),i=new Bt({definition:s});this.possibleTokTypes=zr(i),this.found=!0}}}class _i extends oi{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class cw extends _i{walkMany(t,n,r){if(t.idx===this.occurrence){const s=pe(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof Q&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkMany(t,n,r)}}class vh extends _i{walkManySep(t,n,r){if(t.idx===this.occurrence){const s=pe(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof Q&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkManySep(t,n,r)}}class lw extends _i{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const s=pe(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof Q&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkAtLeastOne(t,n,r)}}class Nh extends _i{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const s=pe(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof Q&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkAtLeastOneSep(t,n,r)}}function _a(e,t,n=[]){n=wt(n);let r=[],s=0;function i(a){return a.concat(Rt(e,s+1))}function o(a){const c=_a(i(a),t,n);return r.concat(c)}for(;n.length<t&&s<e.length;){const a=e[s];if(a instanceof Bt)return o(a.definition);if(a instanceof zt)return o(a.definition);if(a instanceof Gt)r=o(a.definition);else if(a instanceof Ie){const c=a.definition.concat([new gt({definition:a.definition})]);return o(c)}else if(a instanceof Oe){const c=[new Bt({definition:a.definition}),new gt({definition:[new Q({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof me){const c=a.definition.concat([new gt({definition:[new Q({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof gt){const c=a.definition.concat([new gt({definition:a.definition})]);r=o(c)}else{if(a instanceof Ee)return M(a.definition,c=>{z(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Q)n.push(a.terminalType);else throw Error("non exhaustive match")}s++}return r.push({partialPath:n,suffixDef:Rt(e,s)}),r}function bh(e,t,n,r){const s="EXIT_NONE_TERMINAL",i=[s],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!z(h);){const d=h.pop();if(d===o){a&&ir(h).idx<=l&&h.pop();continue}const f=d.def,m=d.idx,_=d.ruleStack,w=d.occurrenceStack;if(z(f))continue;const R=f[0];if(R===s){const A={idx:m,def:Rt(f),ruleStack:Vr(_),occurrenceStack:Vr(w)};h.push(A)}else if(R instanceof Q)if(m<c-1){const A=m+1,T=t[A];if(n(T,R.terminalType)){const b={idx:A,def:Rt(f),ruleStack:_,occurrenceStack:w};h.push(b)}}else if(m===c-1)u.push({nextTokenType:R.terminalType,nextTokenOccurrence:R.idx,ruleStack:_,occurrenceStack:w}),a=!0;else throw Error("non exhaustive match");else if(R instanceof zt){const A=wt(_);A.push(R.nonTerminalName);const T=wt(w);T.push(R.idx);const b={idx:m,def:R.definition.concat(i,Rt(f)),ruleStack:A,occurrenceStack:T};h.push(b)}else if(R instanceof Gt){const A={idx:m,def:Rt(f),ruleStack:_,occurrenceStack:w};h.push(A),h.push(o);const T={idx:m,def:R.definition.concat(Rt(f)),ruleStack:_,occurrenceStack:w};h.push(T)}else if(R instanceof Ie){const A=new gt({definition:R.definition,idx:R.idx}),T=R.definition.concat([A],Rt(f)),b={idx:m,def:T,ruleStack:_,occurrenceStack:w};h.push(b)}else if(R instanceof Oe){const A=new Q({terminalType:R.separator}),T=new gt({definition:[A].concat(R.definition),idx:R.idx}),b=R.definition.concat([T],Rt(f)),y={idx:m,def:b,ruleStack:_,occurrenceStack:w};h.push(y)}else if(R instanceof me){const A={idx:m,def:Rt(f),ruleStack:_,occurrenceStack:w};h.push(A),h.push(o);const T=new Q({terminalType:R.separator}),b=new gt({definition:[T].concat(R.definition),idx:R.idx}),y=R.definition.concat([b],Rt(f)),g={idx:m,def:y,ruleStack:_,occurrenceStack:w};h.push(g)}else if(R instanceof gt){const A={idx:m,def:Rt(f),ruleStack:_,occurrenceStack:w};h.push(A),h.push(o);const T=new gt({definition:R.definition,idx:R.idx}),b=R.definition.concat([T],Rt(f)),y={idx:m,def:b,ruleStack:_,occurrenceStack:w};h.push(y)}else if(R instanceof Ee)for(let A=R.definition.length-1;A>=0;A--){const T=R.definition[A],b={idx:m,def:T.definition.concat(Rt(f)),ruleStack:_,occurrenceStack:w};h.push(b),h.push(o)}else if(R instanceof Bt)h.push({idx:m,def:R.definition.concat(Rt(f)),ruleStack:_,occurrenceStack:w});else if(R instanceof ar)h.push(uw(R,m,_,w));else throw Error("non exhaustive match")}return u}function uw(e,t,n,r){const s=wt(n);s.push(e.name);const i=wt(r);return i.push(1),{idx:t,def:e.definition,ruleStack:s,occurrenceStack:i}}var at;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(at||(at={}));function Ch(e){if(e instanceof Gt||e==="Option")return at.OPTION;if(e instanceof gt||e==="Repetition")return at.REPETITION;if(e instanceof Ie||e==="RepetitionMandatory")return at.REPETITION_MANDATORY;if(e instanceof Oe||e==="RepetitionMandatoryWithSeparator")return at.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof me||e==="RepetitionWithSeparator")return at.REPETITION_WITH_SEPARATOR;if(e instanceof Ee||e==="Alternation")return at.ALTERNATION;throw Error("non exhaustive match")}function hw(e,t,n,r,s,i){const o=Ta(e,t,n),a=kh(o)?mi:Jr;return i(o,r,a,s)}function fw(e,t,n,r,s,i){const o=Sa(e,t,s,n),a=kh(o)?mi:Jr;return i(o[0],a,r)}function dw(e,t,n,r){const s=e.length,i=de(e,o=>de(o,a=>a.length===1));if(t)return function(o){const a=I(o,c=>c.GATE);for(let c=0;c<s;c++){const l=e[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let d=0;d<u;d++){const f=l[d],m=f.length;for(let _=0;_<m;_++){const w=this.LA(_+1);if(n(w,f[_])===!1)continue t}return c}}};if(i&&!r){const o=I(e,c=>fe(c)),a=Vt(o,(c,l,u)=>(M(l,h=>{k(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),M(h.categoryMatches,d=>{k(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<s;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,u[d])===!1)continue t}return o}}}}function pw(e,t,n){const r=de(e,i=>i.length===1),s=e.length;if(r&&!n){const i=fe(e);if(i.length===1&&z(i[0].categoryMatches)){const a=i[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Vt(i,(a,c,l)=>(a[c.tokenTypeIdx]=!0,M(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let i=0;i<s;i++){const o=e[i],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class gw extends oi{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,s){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(s),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,at.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,at.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,at.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,at.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,at.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class Ih extends cr{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,at.OPTION)}visitRepetition(t){this.checkIsTarget(t,at.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,at.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,at.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,at.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,at.ALTERNATION)}}function Oh(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function ya(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],s=[];for(let i=0;i<t.length;i++){const o=t[i];s.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];s.push(o+c)}}t=s}return t}function mw(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const s=e[r];for(let i=0;i<t.length;i++){const o=t[i];if(s[o]===!0)return!1}}return!0}function Lh(e,t){const n=I(e,o=>_a([o],1)),r=Oh(n.length),s=I(n,o=>{const a={};return M(o,c=>{const l=ya(c.partialPath);M(l,u=>{a[u]=!0})}),a});let i=n;for(let o=1;o<=t;o++){const a=i;i=Oh(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=ya(h);if(mw(s,f,c)||z(d)||h.length===t){const _=r[c];if(Aa(_,h)===!1){_.push(h);for(let w=0;w<f.length;w++){const R=f[w];s[c][R]=!0}}}else{const _=_a(d,o+1,h);i[c]=i[c].concat(_),M(_,w=>{const R=ya(w.partialPath);M(R,A=>{s[c][A]=!0})})}}}}return r}function Ta(e,t,n,r){const s=new Ih(e,at.ALTERNATION,r);return t.accept(s),Lh(s.result,n)}function Sa(e,t,n,r){const s=new Ih(e,n);t.accept(s);const i=s.result,a=new gw(t,e,n).startWalking(),c=new Bt({definition:i}),l=new Bt({definition:a});return Lh([c,l],r)}function Aa(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let s=0;s<r.length;s++){const i=t[s],o=r[s];if((i===o||o.categoryMatchesMap[i.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function Ew(e,t){return e.length<t.length&&de(e,(n,r)=>{const s=t[r];return n===s||s.categoryMatchesMap[n.tokenTypeIdx]})}function kh(e){return de(e,t=>de(t,n=>de(n,r=>z(r.categoryMatches))))}function _w(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return I(t,n=>Object.assign({type:Ut.CUSTOM_LOOKAHEAD_VALIDATION},n))}function yw(e,t,n,r){const s=oe(e,c=>Tw(c,n)),i=kw(e,t,n),o=oe(e,c=>Cw(c,n)),a=oe(e,c=>ww(c,e,r,n));return s.concat(i,o,a)}function Tw(e,t){const n=new Aw;e.accept(n);const r=n.allProductions,s=MS(r,Sw),i=ge(s,a=>a.length>1);return I(pt(i),a=>{const c=pe(a),l=t.buildDuplicateFoundError(e,a),u=Le(c),h={message:l,type:Ut.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=Mh(c);return d&&(h.parameter=d),h})}function Sw(e){return`${Le(e)}_#_${e.idx}_#_${Mh(e)}`}function Mh(e){return e instanceof Q?e.terminalType.name:e instanceof zt?e.nonTerminalName:""}class Aw extends cr{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function ww(e,t,n,r){const s=[];if(Vt(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});s.push({message:o,type:Ut.DUPLICATE_RULE_NAME,ruleName:e.name})}return s}function Rw(e,t,n){const r=[];let s;return xt(t,e)||(s=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:s,type:Ut.INVALID_RULE_OVERRIDE,ruleName:e})),r}function xh(e,t,n,r=[]){const s=[],i=yi(t.definition);if(z(i))return[];{const o=e.name;xt(i,e)&&s.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:Ut.LEFT_RECURSION,ruleName:o});const c=ni(i,r.concat([e])),l=oe(c,u=>{const h=wt(r);return h.push(u),xh(e,u,n,h)});return s.concat(l)}}function yi(e){let t=[];if(z(e))return t;const n=pe(e);if(n instanceof zt)t.push(n.referencedRule);else if(n instanceof Bt||n instanceof Gt||n instanceof Ie||n instanceof Oe||n instanceof me||n instanceof gt)t=t.concat(yi(n.definition));else if(n instanceof Ee)t=fe(I(n.definition,i=>yi(i.definition)));else if(!(n instanceof Q))throw Error("non exhaustive match");const r=ii(n),s=e.length>1;if(r&&s){const i=Rt(e);return t.concat(yi(i))}else return t}class wa extends cr{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function vw(e,t){const n=new wa;e.accept(n);const r=n.alternations;return oe(r,i=>{const o=Vr(i.definition);return oe(o,(a,c)=>{const l=bh([a],[],Jr,1);return z(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:i,emptyChoiceIdx:c}),type:Ut.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:i.idx,alternative:c+1}]:[]})})}function Nw(e,t,n){const r=new wa;e.accept(r);let s=r.alternations;return s=ri(s,o=>o.ignoreAmbiguities===!0),oe(s,o=>{const a=o.idx,c=o.maxLookahead||t,l=Ta(a,e,c,o),u=Ow(l,o,e,n),h=Lw(l,o,e,n);return u.concat(h)})}class bw extends cr{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function Cw(e,t){const n=new wa;e.accept(n);const r=n.alternations;return oe(r,i=>i.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:i}),type:Ut.TOO_MANY_ALTS,ruleName:e.name,occurrence:i.idx}]:[])}function Iw(e,t,n){const r=[];return M(e,s=>{const i=new bw;s.accept(i);const o=i.allProductions;M(o,a=>{const c=Ch(a),l=a.maxLookahead||t,u=a.idx,d=Sa(u,s,c,l)[0];if(z(fe(d))){const f=n.buildEmptyRepetitionError({topLevelRule:s,repetition:a});r.push({message:f,type:Ut.NO_NON_EMPTY_LOOKAHEAD,ruleName:s.name})}})}),r}function Ow(e,t,n,r){const s=[],i=Vt(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||M(c,u=>{const h=[l];M(e,(d,f)=>{l!==f&&Aa(d,u)&&t.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!Aa(s,u)&&(s.push(u),a.push({alts:h,path:u}))}),a),[]);return I(i,a=>{const c=I(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:Ut.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function Lw(e,t,n,r){const s=Vt(e,(o,a,c)=>{const l=I(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return Hr(oe(s,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=ie(s,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&Ew(d.path,l));return I(u,d=>{const f=[d.idx+1,c+1],m=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:f,prefixPath:d.path}),type:Ut.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:m,alternatives:f}})}))}function kw(e,t,n){const r=[],s=I(t,i=>i.name);return M(e,i=>{const o=i.name;if(xt(s,o)){const a=n.buildNamespaceConflictError(i);r.push({message:a,type:Ut.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function Mw(e){const t=la(e,{errMsgProvider:rw}),n={};return M(e.rules,r=>{n[r.name]=r}),sw(n,t.errMsgProvider)}function xw(e){return e=la(e,{errMsgProvider:Dn}),yw(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const Uh="MismatchedTokenException",Ph="NoViableAltException",Dh="EarlyExitException",$h="NotAllInputParsedException",Fh=[Uh,Ph,Dh,$h];Object.freeze(Fh);function Ti(e){return xt(Fh,e.name)}class Si extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Bh extends Si{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Uh}}class Uw extends Si{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Ph}}class Pw extends Si{constructor(t,n){super(t,n),this.name=$h}}class Dw extends Si{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Dh}}const Ra={},Gh="InRuleRecoveryException";class $w extends Error{constructor(t){super(t),this.name=Gh}}class Fw{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=k(t,"recoveryEnabled")?t.recoveryEnabled:Qe.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=Bw)}getTokenToInsert(t){const n=Ei(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,s){const i=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:s,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),m=new Bh(f,l,this.LA(0));m.resyncedTokens=Vr(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(u,s)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(u,i)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new $w("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||z(n))return!1;const r=this.LA(1);return or(n,i=>this.tokenMatcher(r,i))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return xt(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const s=or(t,i=>nw(n,i));if(s!==void 0)return s;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Ra;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return I(t,(r,s)=>s===0?Ra:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[s],inRule:this.shortRuleNameToFullName(t[s-1])})}flattenFollowSet(){const t=I(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return fe(t)}getFollowSetFromFollowKey(t){if(t===Ra)return[Pn];const n=t.ruleName+t.idxInCallingRule+Zu+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,Pn)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Vr(n)}attemptInRepetitionRecovery(t,n,r,s,i,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),s=wt(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:s,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return I(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function Bw(e,t,n,r,s,i,o){const a=this.getKeyForAutomaticLookahead(r,s);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new i(f,s).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=Pn,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const Gw=4,pn=8,jh=1<<pn,Wh=2<<pn,va=3<<pn,Na=4<<pn,ba=5<<pn,Ai=6<<pn;function Ca(e,t,n){return n|t|e}class jw{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:Qe.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(z(n)){const r=this.validateEmptyOrAlternatives(t.rules),s=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),i=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...s,...i]}return n}validateNoLeftRecursion(t){return oe(t,n=>xh(n,n,Dn))}validateEmptyOrAlternatives(t){return oe(t,n=>vw(n,Dn))}validateAmbiguousAlternationAlternatives(t,n){return oe(t,r=>Nw(r,n,Dn))}validateSomeNonEmptyLookaheadPath(t,n){return Iw(t,n,Dn)}buildLookaheadForAlternation(t){return hw(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,dw)}buildLookaheadForOptional(t){return fw(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Ch(t.prodType),pw)}}class Ww{initLooksAhead(t){this.dynamicTokensEnabled=k(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Qe.dynamicTokensEnabled,this.maxLookahead=k(t,"maxLookahead")?t.maxLookahead:Qe.maxLookahead,this.lookaheadStrategy=k(t,"lookaheadStrategy")?t.lookaheadStrategy:new jw({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){M(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:s,option:i,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=Hw(n);M(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Le(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=Ca(this.fullRuleNameToShort[n.name],jh,l.idx);this.setLaFuncCache(d,h)})}),M(s,l=>{this.computeLookaheadFunc(n,l.idx,va,"Repetition",l.maxLookahead,Le(l))}),M(i,l=>{this.computeLookaheadFunc(n,l.idx,Wh,"Option",l.maxLookahead,Le(l))}),M(o,l=>{this.computeLookaheadFunc(n,l.idx,Na,"RepetitionMandatory",l.maxLookahead,Le(l))}),M(a,l=>{this.computeLookaheadFunc(n,l.idx,Ai,"RepetitionMandatoryWithSeparator",l.maxLookahead,Le(l))}),M(c,l=>{this.computeLookaheadFunc(n,l.idx,ba,"RepetitionWithSeparator",l.maxLookahead,Le(l))})})})}computeLookaheadFunc(t,n,r,s,i,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:i||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:s}),c=Ca(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return Ca(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class Kw extends cr{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const wi=new Kw;function Hw(e){wi.reset(),e.accept(wi);const t=wi.dslMethods;return wi.reset(),t}function Kh(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function Hh(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function Vw(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function zw(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const Yw="name";function Vh(e,t){Object.defineProperty(e,Yw,{enumerable:!1,configurable:!0,writable:!1,value:t})}function qw(e,t){const n=re(e),r=n.length;for(let s=0;s<r;s++){const i=n[s],o=e[i],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function Xw(e,t){const n=function(){};Vh(n,e+"BaseSemantics");const r={visit:function(s,i){if(j(s)&&(s=s[0]),!Je(s))return this[s.name](s.children,i)},validateVisitor:function(){const s=Qw(this,t);if(!z(s)){const i=I(s,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${i.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function Jw(e,t,n){const r=function(){};Vh(r,e+"BaseSemanticsWithDefaults");const s=Object.create(n.prototype);return M(t,i=>{s[i]=qw}),r.prototype=s,r.prototype.constructor=r,r}var Ia;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(Ia||(Ia={}));function Qw(e,t){return Zw(e,t)}function Zw(e,t){const n=ie(t,s=>ze(e[s])===!1),r=I(n,s=>({msg:`Missing visitor method: <${s}> on ${e.constructor.name} CST Visitor.`,type:Ia.MISSING_METHOD,methodName:s}));return Hr(r)}class tR{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=k(t,"nodeLocationTracking")?t.nodeLocationTracking:Qe.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=dt,this.cstFinallyStateUpdate=dt,this.cstPostTerminal=dt,this.cstPostNonTerminal=dt,this.cstPostRule=dt;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Hh,this.setNodeLocationFromNode=Hh,this.cstPostRule=dt,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=dt,this.setNodeLocationFromNode=dt,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Kh,this.setNodeLocationFromNode=Kh,this.cstPostRule=dt,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=dt,this.setNodeLocationFromNode=dt,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=dt,this.setNodeLocationFromNode=dt,this.cstPostRule=dt,this.setInitialNodeLocation=dt;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];Vw(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];zw(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(Je(this.baseCstVisitorConstructor)){const t=Xw(this.className,re(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Je(this.baseCstVisitorWithDefaultsConstructor)){const t=Jw(this.className,re(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class eR{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Ni}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?Ni:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class nR{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=bi){if(xt(this.definedRulesNames,t)){const o={message:Dn.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:Ut.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const s=this.defineRule(t,n,r);return this[t]=s,s}OVERRIDE_RULE(t,n,r=bi){const s=Rw(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(s);const i=this.defineRule(t,n,r);return this[t]=i,i}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(s){if(Ti(s))return!1;throw s}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return sA(pt(this.gastProductionsCache))}}class rR{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=mi,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},k(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(j(t)){if(z(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(j(t))this.tokensMap=Vt(t,(i,o)=>(i[o.name]=o,i),{});else if(k(t,"modes")&&de(fe(pt(t.modes)),QA)){const i=fe(pt(t.modes)),o=ua(i);this.tokensMap=Vt(o,(a,c)=>(a[c.name]=c,a),{})}else if(ne(t))this.tokensMap=wt(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Pn;const r=k(t,"modes")?fe(pt(t.modes)):pt(t),s=de(r,i=>z(i.categoryMatches));this.tokenMatcher=s?mi:Jr,Qr(pt(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const s=k(r,"resyncEnabled")?r.resyncEnabled:bi.resyncEnabled,i=k(r,"recoveryValueFunc")?r.recoveryValueFunc:bi.recoveryValueFunc,o=this.ruleShortNameIdx<<Gw+pn;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,s,i)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,s,i)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const s=this.RULE_STACK.length===1,i=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Ti(t)){const o=t;if(i){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(s)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(Wh,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof t!="function"){i=t.DEF;const o=t.GATE;if(o!==void 0){const a=s;s=()=>o.call(this)&&a.call(this)}}else i=t;if(s.call(this)===!0)return i.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(Na,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof n!="function"){i=n.DEF;const o=n.GATE;if(o!==void 0){const a=s;s=()=>o.call(this)&&a.call(this)}}else i=n;if(s.call(this)===!0){let o=this.doSingleRepetition(i);for(;s.call(this)===!0&&o===!0;)o=this.doSingleRepetition(i)}else throw this.raiseEarlyExitException(t,at.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],s,Na,t,lw)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(Ai,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const s=n.DEF,i=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){s.call(this);const a=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,i,a,s,Nh],a,Ai,t,Nh)}else throw this.raiseEarlyExitException(t,at.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(va,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof n!="function"){i=n.DEF;const a=n.GATE;if(a!==void 0){const c=s;s=()=>a.call(this)&&c.call(this)}}else i=n;let o=!0;for(;s.call(this)===!0&&o===!0;)o=this.doSingleRepetition(i);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],s,va,t,cw,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(ba,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const s=n.DEF,i=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){s.call(this);const a=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,i,a,s,vh],a,ba,t,vh)}}repetitionSepSecondInternal(t,n,r,s,i){for(;r();)this.CONSUME(n),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,s,i],r,Ai,t,i)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(jh,n),s=j(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,s);if(o!==void 0)return s[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new Pw(n,t))}}subruleInternal(t,n,r){let s;try{const i=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,s=t.apply(this,i),this.cstPostNonTerminal(s,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),s}catch(i){throw this.subruleInternalError(i,r,t.ruleName)}}subruleInternalError(t,n,r){throw Ti(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let s;try{const i=this.LA(1);this.tokenMatcher(i,t)===!0?(this.consumeToken(),s=i):this.consumeInternalError(t,i,r)}catch(i){s=this.consumeInternalRecovery(t,n,i)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,s),s}consumeInternalError(t,n,r){let s;const i=this.LA(0);throw r!==void 0&&r.ERR_MSG?s=r.ERR_MSG:s=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Bh(s,n,i))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const s=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,s)}catch(i){throw i.name===Gh?r:i}}else throw r}saveRecogState(){const t=this.errors,n=wt(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Pn)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class sR{initErrorHandler(t){this._errors=[],this.errorMessageProvider=k(t,"errorMessageProvider")?t.errorMessageProvider:Qe.errorMessageProvider}SAVE_ERROR(t){if(Ti(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:wt(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return wt(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const s=this.getCurrRuleFullName(),i=this.getGAstProductions()[s],a=Sa(t,i,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:s});throw this.SAVE_ERROR(new Dw(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),s=this.getGAstProductions()[r],i=Ta(t,s,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:i,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new Uw(c,this.LA(1),a))}}class iR{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(Je(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return bh([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=pe(t.ruleStack),s=this.getGAstProductions()[n];return new aw(s,t).startWalking()}}const Ri={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Ri);const zh=!0,Yh=Math.pow(2,pn)-1,qh=U({name:"RECORDING_PHASE_TOKEN",pattern:yt.NA});Qr([qh]);const Xh=Ei(qh,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Xh);const oR={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class aR{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,s){return this.consumeInternalRecord(r,t,s)},this[`SUBRULE${n}`]=function(r,s){return this.subruleInternalRecord(r,t,s)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return Ni}topLevelRuleRecord(t,n){try{const r=new ar({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return es.call(this,Gt,t,n)}atLeastOneInternalRecord(t,n){es.call(this,Ie,n,t)}atLeastOneSepFirstInternalRecord(t,n){es.call(this,Oe,n,t,zh)}manyInternalRecord(t,n){es.call(this,gt,n,t)}manySepFirstInternalRecord(t,n){es.call(this,me,n,t,zh)}orInternalRecord(t,n){return cR.call(this,t,n)}subruleInternalRecord(t,n,r){if(vi(n),!t||k(t,"ruleName")===!1){const a=new Error(`<SUBRULE${Jh(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const s=ir(this.recordingProdStack),i=t.ruleName,o=new zt({idx:n,nonTerminalName:i,label:r==null?void 0:r.LABEL,referencedRule:void 0});return s.definition.push(o),this.outputCst?oR:Ri}consumeInternalRecord(t,n,r){if(vi(n),!dh(t)){const o=new Error(`<CONSUME${Jh(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const s=ir(this.recordingProdStack),i=new Q({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return s.definition.push(i),Xh}}function es(e,t,n,r=!1){vi(n);const s=ir(this.recordingProdStack),i=ze(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),k(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),i.call(this),s.definition.push(o),this.recordingProdStack.pop(),Ri}function cR(e,t){vi(t);const n=ir(this.recordingProdStack),r=j(e)===!1,s=r===!1?e:e.DEF,i=new Ee({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});k(e,"MAX_LOOKAHEAD")&&(i.maxLookahead=e.MAX_LOOKAHEAD);const o=Yu(s,a=>ze(a.GATE));return i.hasPredicates=o,n.definition.push(i),M(s,a=>{const c=new Bt({definition:[]});i.definition.push(c),k(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:k(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Ri}function Jh(e){return e===0?"":`${e}`}function vi(e){if(e<0||e>Yh){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${Yh+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class lR{initPerformanceTracer(t){if(k(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Qe.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:s,value:i}=Xu(n),o=s>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${s}ms`),this.traceInitIndent--,i}else return n()}}function uR(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(s=>{if(s==="constructor")return;const i=Object.getOwnPropertyDescriptor(r,s);i&&(i.get||i.set)?Object.defineProperty(e.prototype,s,i):e.prototype[s]=n.prototype[s]})})}const Ni=Ei(Pn,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Ni);const Qe=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Rh,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),bi=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Ut;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Ut||(Ut={}));class ns{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Ju(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),M(this.definedRulesNames,s=>{const o=this[s].originalGrammarAction;let a;this.TRACE_INIT(`${s} Rule`,()=>{a=this.topLevelRuleRecord(s,o)}),this.gastProductionsCache[s]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=Mw({rules:pt(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(z(r)&&this.skipValidations===!1){const s=xw({rules:pt(this.gastProductionsCache),tokenTypes:pt(this.tokensMap),errMsgProvider:Dn,grammarName:n}),i=_w({lookaheadStrategy:this.lookaheadStrategy,rules:pt(this.gastProductionsCache),tokenTypes:pt(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(s,i)}}),z(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const s=hA(pt(this.gastProductionsCache));this.resyncFollows=s}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var s,i;(i=(s=this.lookaheadStrategy).initialize)===null||i===void 0||i.call(s,{rules:pt(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(pt(this.gastProductionsCache))})),!ns.DEFER_DEFINITION_ERRORS_HANDLING&&!z(this.definitionErrors))throw t=I(this.definitionErrors,s=>s.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),k(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=k(n,"skipValidations")?n.skipValidations:Qe.skipValidations}}ns.DEFER_DEFINITION_ERRORS_HANDLING=!1,uR(ns,[Fw,Ww,tR,eR,rR,nR,sR,iR,aR,lR]);class hR extends ns{constructor(t,n=Qe){const r=wt(n);r.outputCst=!0,super(t,r)}}const ke=!!JSON.parse("false");JSON.parse("false");const fR=!!JSON.parse("false"),Oa=Co(32,126).map(e=>String.fromCharCode(e)),rs=U({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),dR=U({name:"Whitespace",pattern:/ +/,group:yt.SKIPPED}),pR=U({name:"Whitespace",pattern:/\s+/,line_breaks:!0,group:yt.SKIPPED}),La=U({name:"Stat",pattern:/@.*/,start_chars_hint:["@"]}),_e=U({name:"Command",pattern:/#/,start_chars_hint:["#"]});let Qh=!1;function gR(e,t,n){if(!Qh)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==rs)return null;let s=t;for(;e[s]===" ";)s++;if("@#/?':!".includes(e[s]))return null;let i=t+1;for(;i<e.length&&e[i]!==`
`;)i++;return[e.substring(t,i)]}const Zh=U({name:"Text",pattern:gR,line_breaks:!1,start_chars_hint:Oa.filter(e=>"@#/?':!".includes(e)===!1)}),tf=U({name:"Comment",pattern:/'.*/,start_chars_hint:["'"]}),ef=U({name:"Label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),nf=U({name:"HyperLink",pattern:/!/,start_chars_hint:["!"]}),rf=U({name:"HyperLinkText",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),jt=U({name:"StringLiteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:Oa}),sf=U({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),of=U({name:"NumberLiteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/});function Wt(e){return U({name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:jt})}const af=U({name:"IsEq",pattern:/=|is|eq|equal/,longer_alt:jt}),cf=U({name:"IsNotEq",pattern:/!=|not ?eq|not ?equal/,longer_alt:jt}),lf=U({name:"IsLessThan",pattern:/<|below/,longer_alt:jt}),uf=U({name:"IsGreaterThan",pattern:/>|above/,longer_alt:jt}),hf=U({name:"IsLessThanOrEqual",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:jt}),ff=U({name:"IsGreaterThanOrEqual",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:jt}),ka=U({name:"Or",pattern:/or/i,longer_alt:jt}),Ma=U({name:"Not",pattern:/not/i,longer_alt:jt}),xa=U({name:"And",pattern:/and/i,longer_alt:jt}),Ua=U({name:"Plus",pattern:/\+/}),Pa=U({name:"Minus",pattern:/-/}),df=U({name:"Power",pattern:/\*\*/}),pf=U({name:"Multiply",pattern:/\*/}),Da=U({name:"Divide",pattern:/\//}),gf=U({name:"ModDivide",pattern:/%/}),mf=U({name:"FloorDivide",pattern:/%%/}),Ef=U({name:"Query",pattern:/\?/}),_f=U({name:"LParen",pattern:/\(/,push_mode:"ignore_newlines"}),yf=U({name:"RParen",pattern:/\)/,pop_mode:!0}),Tf=U({name:"play",pattern:/play .*/,start_chars_hint:Oa,longer_alt:jt}),$a=Wt("if"),$n=Wt("do"),Fn=Wt("then"),Fa=Wt("else"),Sf=Wt("endif"),Af=Wt("while"),wf=Wt("endwhile"),Rf=Wt("repeat"),vf=Wt("endrepeat"),Ba=Wt("read"),Nf=Wt("into"),bf=Wt("endread"),Cf=Wt("break"),If=Wt("continue");function Of(e){return[...e,of,af,cf,hf,lf,ff,uf,ka,Ma,xa,Ua,Pa,df,pf,Da,mf,gf,Ef,_f,yf,sf,jt]}const Lf=Of([Zh,La,Tf,_e,tf,ef,nf,rf,rs,dR,$a,$n,Fn,Fa,Sf,Af,wf,Rf,vf,Ba,Nf,bf,Cf,If]),mR=new yt({defaultMode:"use_newlines",modes:{use_newlines:Lf,ignore_newlines:Of([pR])}},{skipValidations:!ke,ensureOptimizations:ke});function Ga(e){Qh=!0;const t=mR.tokenize(e||` 
`),[n]=(Array.isArray(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(Ei(rs,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}var Z=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(Z||{});function ER(e){return e.map(t=>t.image)}function _R(e,t){const[n,r,...s]=t;if(E(e.stats)&&E(n))switch(n.image.toLowerCase()){case"rn":case"range":case"sl":case"select":case"nm":case"number":case"tx":case"text":case"ln":case"link":if(E(r)){const i=r.image.toLowerCase();e.stats[i]=ER(s??[])}break}}function kf(e){const t={...ja(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function ja(e){var r;if(!E(e))return{};if(E((r=e.stats)==null?void 0:r.type))return e.stats;e.stats={};const t=Ga(e.code);let n=!0;for(let s=0;s<t.tokens.length;++s){const i=t.tokens[s];if(i.tokenType===La){const[o,...a]=i.image.slice(1).split(" "),c=o.toLowerCase(),l=a.join(" "),u=l.toLowerCase();switch(c){case"stat":{const h=Ga(`!${l}`);h.tokens.length&&_R(e,h.tokens);break}case"flags":e.stats.flags=u;break;case"cli":e.stats.type=1,e.stats.name=u;break;case"func":e.stats.type=Z.FUNC,e.stats.name=u;break;case"board":e.stats.type=2,e.stats.name=u;break;case"object":e.stats.type=3,e.stats.name=u;break;case"terrain":e.stats.type=4,e.stats.name=u;break;case"charset":e.stats.type=5,e.stats.name=u;break;case"palette":e.stats.type=6,e.stats.name=u;break;default:n?e.stats.name=[c,...a].join(" "):e.stats[c]=1;break}n=!1}}return E(e.stats.type)||(e.stats.type=3),e.stats}function yR(e){return ja(e).type??0}function TR(e){return(ja(e).name??"").toLowerCase()}function SR(e,t){return{id:Nn(),name:e,pages:t,flags:{},players:{}}}function Wa(e,t,n){if(!E(e))return;const r=n.toLowerCase();return e.pages.find(i=>yR(i)===t&&(i.id===n||r===TR(i)))}function Ka(e,t,n){const r=Wa(e,t,n);if(r)switch(t){case Z.ERROR:return r.error;case Z.FUNC:return r.code;case Z.BOARD:return r.board;case Z.OBJECT:return r.object;case Z.TERRAIN:return r.terrain;case Z.CHARSET:return r.charset;case Z.PALETTE:return r.palette}}function Me(e,t){if(E(t)&&E(t.kind))return E(t.kinddata)||(t.kinddata=E(t.id)?Ci(e,t.kind):Mf(e,t.kind)),t.kinddata}function Ci(e,t){const n=t??"",r=Wa(e,Z.OBJECT,n),s=Ka(e,Z.OBJECT,n);if(E(r)){const i=kf(r);return{...s,...i,name:n,code:r.code}}else return}function Mf(e,t){const n=t??"",r=Wa(e,Z.TERRAIN,n),s=Ka(e,Z.TERRAIN,n);if(E(r)){const i=kf(r);return{...s,...i,name:n,code:r.code}}else return}function ur(e,t){return Ka(e,Z.BOARD,t)}function xf(e,t){if(e)return e.flags[t]=e.flags[t]??{},e.flags[t]}function AR(e,t,n){const r=xf(e,t);return r==null?void 0:r[n]}function wR(e,t,n,r){const s=xf(e,t);return s&&(s[n]=r),r}function Uf(e,t){return ur(e,(e==null?void 0:e.players[t])??"")}function RR(e,t,n){E(e)&&E(ur(e,n))&&(e.players[t]=n)}function vR(e){return cm(Object.values((e==null?void 0:e.players)??[])).map(t=>ur(e,t)).filter(E)}function NR(e,t,n,r){const s=Lo(t,(n==null?void 0:n.id)??"");if(!E(e)||!E(t)||!E(s)||!E(s.x)||!E(s.y)||!E(t.lookup)||r.x<0||r.x>=t.width||r.y<0||r.y>=t.height)return{kind:"edge",collision:Ct.SOLID,x:r.x,y:r.y};if(s.x-r.x===0&&s.y-r.y===0)return;const i=r.x+r.y*t.width,o=Me(e,s),a=s.collision??(o==null?void 0:o.collision),c=Lo(t,t.lookup[i]??"");if(E(c))return{...c};const l=t.terrain[i];if(E(l)){const u=Me(e,l),h=l.collision??(u==null?void 0:u.collision);if(gl(a,h))return{...l,x:r.x,y:r.y}}s.x=r.x,s.y=r.y,E(s.removed)||(t.lookup[i]=void 0,t.lookup[s.x+s.y*t.width]=s.id??"")}function hr(e,t){const n=Me(e,t);return E(t==null?void 0:t.id)&&E(t.x)&&E(t.y)?(t.name??(n==null?void 0:n.name)??"object").toLowerCase():((t==null?void 0:t.name)??(n==null?void 0:n.name)??"terrain").toLowerCase()}function Ha(e,t,n,r){if(!E(e)||!E(t)||!E(t.named)||!E(n))return;const s=hr(e,n);t.named[s]||(t.named[s]=new Set),t.named[s].add((n==null?void 0:n.id)??r??"")}function bR(e,t,n){if(!(!E(e)||!E(t)||!E(t.lookup)||!E(n==null?void 0:n.id))&&!E(n.removed)){const r=n.x??0,s=n.y??0;t.lookup[r+s*t.width]=n.id}}function ss(e,t){if(!E(e)||!E(t)||E(t.lookup)&&E(t.named))return;const n=new Array(t.width*t.height).fill(void 0),r={},s=Object.values(t.objects);for(let a=0;a<s.length;++a){const c=s[a];if(E(c.x)&&E(c.y)&&E(c.id)&&!E(c.removed)){c.category=Fs.OBJECT,n[c.x+c.y*t.width]=c.id;const l=hr(e,c);r[l]||(r[l]=new Set),r[l].add(c.id)}}let i=0,o=0;for(let a=0;a<t.terrain.length;++a){const c=t.terrain[a];if(E(c)){c.x=i,c.y=o,c.category=Fs.TERRAIN;const l=hr(e,c);r[l]||(r[l]=new Set),r[l].add(a)}++i,i>=t.width&&(i=0,++o)}t.lookup=n,t.named=r}function Va(e,t,n){return hr(e,t)!=="player"&&E(t)?(t.removed=n,!0):!1}function Ii(e,t,n){var r;if(E(e)&&E(t)&&E(n==null?void 0:n.id)){if(E(t.lookup)&&E(n.x)&&E(n.y)){const i=n.x+n.y*t.width;t.lookup[i]===n.id&&delete t.lookup[i]}const s=hr(e,n);E((r=t.named)==null?void 0:r[s])&&E(n.id)&&t.named[s].delete(n.id)}}function CR(e,t,n){if(!E(e)||!E(t))return;const r=Object.values(t.objects);for(let s=0;s<r.length;++s){const i=r[s];E(i.id)&&E(i.removed)&&n-i.removed>Fo*5&&ko(t,i.id)}}function IR(e,t,n){const r=[];if(!E(e)||!E(t))return r;t.lookup=void 0,ss(e,t);const s=Object.values(t.objects);for(let i=0;i<s.length;++i){const o=s[i];if(!E(o.id))continue;o.lx=o.x,o.ly=o.y;const a=Me(e,o),c=o.code??(a==null?void 0:a.code)??"";c&&r.push({id:o.id,type:Z.OBJECT,code:c,object:o,terrain:void 0})}return CR(e,t,n),r}var is=(e=>(e[e.VIEW=0]="VIEW",e[e.EDIT=1]="EDIT",e))(is||{});function Pf(e){return{id:Nn(),type:e}}function Df(e,t){const n=Pf(0);return n.book=e,n.board=t,n}function OR(e,t){const n=Pf(1);return n.book=e,n.board=t,n}const Yt={defaultplayer:"",books:new Map,chips:new Map,frames:new Map};function LR(e){Yt.defaultplayer=e}function $f(e){const t=[Df(void 0,void 0)];return Yt.frames.set(e,t),t}function kR(e,t,n){const r=Oi(e);E(r)&&r.push(Df(t,n))}function MR(e,t,n){const r=Oi(e);E(r)&&r.push(OR(t,n))}function Oi(e){return Yt.frames.get(e)??$f(e)}function xR(){return[...Yt.books.values()]}function os(e){const t=e.toLowerCase();return Yt.books.get(e)??[...Yt.books.values()].find(n=>n.name.toLowerCase()===t)}function UR(e){return Yt.books.clear(),Yt.books.set(e.id,e),e.id}function PR(e){return Yt.books.set(e.id,e),e.id}function tt(e){let t=Yt.chips.get(e);return E(t)||(t={book:void 0,board:void 0,object:void 0,terrain:void 0,charset:void 0,palette:void 0,player:Yt.defaultplayer,inputqueue:new Set,inputmods:{[ft.NONE]:0,[ft.MOVE_UP]:0,[ft.MOVE_DOWN]:0,[ft.MOVE_LEFT]:0,[ft.MOVE_RIGHT]:0,[ft.OK_BUTTON]:0,[ft.CANCEL_BUTTON]:0,[ft.MENU_BUTTON]:0},inputcurrent:void 0},Yt.chips.set(e,t)),t}function L(e,t){const n=tt(e.id());return Tm(n,t,e.get)}const Li="main",za="player",Ya="title";function DR(e){if(!it(e)||!e)return Zn("memory","login",`failed for playerid ==>${e}<==`,e);const t=os(Li);if(!E(t))return Zn("memory","login",`login failed to find book ${Li}`,e);const n=ur(t,Ya);if(!E(n))return Zn("memory","login",`login failed to find board ${Ya}`,e);const r=Ci(t,za);if(!E(r))return Zn("memory","login",`login failed to find object type ${za}`,e);const s=ml(n,{id:e,x:0,y:0,kind:za,stats:{player:e}});return E(s==null?void 0:s.id)&&RR(t,e,Ya),!0}function $R(e){Yt.books.forEach(t=>ko(Uf(t,e),e))}function FR(e,t){const n=os(Li);vR(n).forEach(r=>{const s=IR(n,r,t);for(let i=0;i<s.length;++i){const o=s[i],a=tt(o.id);a.book=n,a.board=r,a.object=o.object,a.inputcurrent=void 0,e.tick(o.id,o.type,t,o.code)}})}function BR(e,t,n,r){const s=`${n}_cli`,i=tt(s);i.book=void 0,i.board=void 0,i.inputcurrent=void 0,bo("memory","running",t,s,r),e.once(s,Z.CLI,t,r)}function GR(e,t,n,r,s,i){const o=[];let a=t;const c=a===0,l=r.width??0,u=r.height??0,h=c?_t.BLACK:_t.CLEAR,d=jg(e,a++,l,u,h);o.push(d);const f=Hg(e,a++,l,u);o.push(f);const m=a++,_=Kg(e,m);o.push(_);const w=Vg(e,a++);s&&o.push(w),r.terrain.forEach((y,g)=>{if(y){const p=Me(n,y);d.char[g]=y.char??(p==null?void 0:p.char)??0,d.color[g]=y.color??(p==null?void 0:p.color)??h,d.bg[g]=y.bg??(p==null?void 0:p.bg)??h,d.color[g]!==_t.CLEAR&&(i[g]=d.color[g])}});const R=r.objects??{};Object.values(R).forEach(y=>{if(E(y.removed)||E(y.headless))return;const g=y.id??"",p=Me(n,y),S=Wg(e,m,g),v=y.lx??y.x??0,W=y.ly??y.y??0,ut=v+W*r.width;S.x=y.x??0,S.y=y.y??0,S.char=y.char??(p==null?void 0:p.char)??1,S.color=y.color??(p==null?void 0:p.color)??_t.WHITE,S.bg=y.bg??(p==null?void 0:p.bg)??_t.BORROW,_.sprites.push(S),S.bg===_t.SHADOW&&(S.bg=_t.CLEAR,f.alphas[v+W*l]=.5),S.bg===_t.BORROW&&(S.bg=i[ut]??_t.BLACK),S.color!==_t.CLEAR&&(i[ut]=S.color),g===e&&(w.focusx=S.x,w.focusy=S.y,w.focusid=g)});function A(y,g){if(!(y<0||y>=r.width||g<0||g>=r.height))return f.alphas[y+g*r.width]}const T=[[1,1,1,1,1],[1,3,5,3,1],[1,5,12,5,1],[1,3,5,3,1],[1,1,1,1,1]].flat(),b=new Array(f.alphas.length);for(let y=0;y<f.alphas.length;++y){const g=y%r.width,p=Math.floor(y/r.width),S=[[A(g-2,p-2),A(g-1,p-2),A(g,p-2),A(g+1,p-2),A(g+2,p-2)],[A(g-2,p-1),A(g-1,p-1),A(g,p-1),A(g+1,p-1),A(g+2,p-1)],[A(g-2,p),A(g-1,p),A(g,p),A(g+1,p),A(g+2,p)],[A(g-2,p+1),A(g-1,p+1),A(g,p+1),A(g+1,p+1),A(g+2,p+1)],[A(g-2,p+2),A(g-1,p+2),A(g,p+2),A(g+1,p+2),A(g+2,p+2)]].flat().map((v,W)=>E(v)?v*T[W]:void 0).filter(E);b[y]=In(lm(S),0,1)}return f.alphas=b,o}function Ff(e){switch(e.type){case is.EDIT:return 1;case is.VIEW:return 2}return 0}function jR(e){const t=os(Li),n=Uf(t,e),r=[];if(!E(t)||!E(n))return r;let s=0;const i=[...Oi(n.id??"")],o=new Array(n.width*n.height).fill(0);return i.sort((a,c)=>Ff(a)-Ff(c)),i.forEach(a=>{const c=os(a.book??"")??t,l=ur(c,a.board??"")??n;if(E(c)&&E(l)){const u=GR(e,s,c,l,a.type===is.VIEW,o);s+=u.length,r.push(...u)}}),r}var Bf={exports:{}},qa={exports:{}},Gf;function WR(){return Gf||(Gf=1,function(e,t){(function(n,r){e.exports=r()})(Ms,function(){function n(_){return!isNaN(parseFloat(_))&&isFinite(_)}function r(_){return _.charAt(0).toUpperCase()+_.substring(1)}function s(_){return function(){return this[_]}}var i=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=i.concat(o,a,c,l);function h(_){if(_)for(var w=0;w<u.length;w++)_[u[w]]!==void 0&&this["set"+r(u[w])](_[u[w]])}h.prototype={getArgs:function(){return this.args},setArgs:function(_){if(Object.prototype.toString.call(_)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=_},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(_){if(_ instanceof h)this.evalOrigin=_;else if(_ instanceof Object)this.evalOrigin=new h(_);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var _=this.getFileName()||"",w=this.getLineNumber()||"",R=this.getColumnNumber()||"",A=this.getFunctionName()||"";return this.getIsEval()?_?"[eval] ("+_+":"+w+":"+R+")":"[eval]:"+w+":"+R:A?A+" ("+_+":"+w+":"+R+")":_+":"+w+":"+R}},h.fromString=function(w){var R=w.indexOf("("),A=w.lastIndexOf(")"),T=w.substring(0,R),b=w.substring(R+1,A).split(","),y=w.substring(A+1);if(y.indexOf("@")===0)var g=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(y,""),p=g[1],S=g[2],v=g[3];return new h({functionName:T,args:b||void 0,fileName:p,lineNumber:S||void 0,columnNumber:v||void 0})};for(var d=0;d<i.length;d++)h.prototype["get"+r(i[d])]=s(i[d]),h.prototype["set"+r(i[d])]=function(_){return function(w){this[_]=!!w}}(i[d]);for(var f=0;f<o.length;f++)h.prototype["get"+r(o[f])]=s(o[f]),h.prototype["set"+r(o[f])]=function(_){return function(w){if(!n(w))throw new TypeError(_+" must be a Number");this[_]=Number(w)}}(o[f]);for(var m=0;m<a.length;m++)h.prototype["get"+r(a[m])]=s(a[m]),h.prototype["set"+r(a[m])]=function(_){return function(w){this[_]=String(w)}}(a[m]);return h})}(qa)),qa.exports}(function(e,t){(function(n,r){e.exports=r(WR())})(Ms,function(r){var s=/(^|@)\S+:\d+/,i=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(i))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),m=d&&h||void 0,_=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:m,fileName:_,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,m=this.extractLocation(u.replace(h,""));return new r({functionName:f,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var m=l.exec(u[d]);m&&h.push(new r({fileName:m[2],lineNumber:m[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var m=l.exec(u[d]);m&&h.push(new r({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",m=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,_;f.match(/\(([^)]*)\)/)&&(_=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var w=_===void 0||_==="[arguments not available]"?void 0:_.split(",");return new r({functionName:m,args:w,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Bf);var KR=Bf.exports,HR=mo(KR),jf={},Wf={},Kf={};const Hf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Kf.encode=function(e){if(0<=e&&e<Hf.length)return Hf[e];throw new TypeError("Must be between 0 and 63: "+e)};const VR=Kf,Vf=5,zf=1<<Vf,zR=zf-1,YR=zf;function qR(e){return e<0?(-e<<1)+1:(e<<1)+0}Wf.encode=function(t){let n="",r,s=qR(t);do r=s&zR,s>>>=Vf,s>0&&(r|=YR),n+=VR.encode(r);while(s>0);return n};var as={};(function(e){function t(g,p,S){if(p in g)return g[p];if(arguments.length===3)return S;throw new Error('"'+p+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function s(g){const p=g.match(n);return p?{scheme:p[1],auth:p[2],host:p[3],port:p[4],path:p[5]}:null}e.urlParse=s;function i(g){let p="";return g.scheme&&(p+=g.scheme+":"),p+="//",g.auth&&(p+=g.auth+"@"),g.host&&(p+=g.host),g.port&&(p+=":"+g.port),g.path&&(p+=g.path),p}e.urlGenerate=i;const o=32;function a(g){const p=[];return function(S){for(let W=0;W<p.length;W++)if(p[W].input===S){const ut=p[0];return p[0]=p[W],p[W]=ut,p[0].result}const v=g(S);return p.unshift({input:S,result:v}),p.length>o&&p.pop(),v}}const c=a(function(p){let S=p;const v=s(p);if(v){if(!v.path)return p;S=v.path}const W=e.isAbsolute(S),ut=[];let Mr=0,At=0;for(;;)if(Mr=At,At=S.indexOf("/",Mr),At===-1){ut.push(S.slice(Mr));break}else for(ut.push(S.slice(Mr,At));At<S.length&&S[At]==="/";)At++;let je=0;for(At=ut.length-1;At>=0;At--){const le=ut[At];le==="."?ut.splice(At,1):le===".."?je++:je>0&&(le===""?(ut.splice(At+1,je),je=0):(ut.splice(At,2),je--))}return S=ut.join("/"),S===""&&(S=W?"/":"."),v?(v.path=S,i(v)):S});e.normalize=c;function l(g,p){g===""&&(g="."),p===""&&(p=".");const S=s(p),v=s(g);if(v&&(g=v.path||"/"),S&&!S.scheme)return v&&(S.scheme=v.scheme),i(S);if(S||p.match(r))return p;if(v&&!v.host&&!v.path)return v.host=p,i(v);const W=p.charAt(0)==="/"?p:c(g.replace(/\/+$/,"")+"/"+p);return v?(v.path=W,i(v)):W}e.join=l,e.isAbsolute=function(g){return g.charAt(0)==="/"||n.test(g)};function u(g,p){g===""&&(g="."),g=g.replace(/\/$/,"");let S=0;for(;p.indexOf(g+"/")!==0;){const v=g.lastIndexOf("/");if(v<0||(g=g.slice(0,v),g.match(/^([^\/]+:\/)?\/*$/)))return p;++S}return Array(S+1).join("../")+p.substr(g.length+1)}e.relative=u;const h=function(){return!("__proto__"in Object.create(null))}();function d(g){return g}function f(g){return _(g)?"$"+g:g}e.toSetString=h?d:f;function m(g){return _(g)?g.slice(1):g}e.fromSetString=h?d:m;function _(g){if(!g)return!1;const p=g.length;if(p<9||g.charCodeAt(p-1)!==95||g.charCodeAt(p-2)!==95||g.charCodeAt(p-3)!==111||g.charCodeAt(p-4)!==116||g.charCodeAt(p-5)!==111||g.charCodeAt(p-6)!==114||g.charCodeAt(p-7)!==112||g.charCodeAt(p-8)!==95||g.charCodeAt(p-9)!==95)return!1;for(let S=p-10;S>=0;S--)if(g.charCodeAt(S)!==36)return!1;return!0}function w(g,p,S){let v=A(g.source,p.source);return v!==0||(v=g.originalLine-p.originalLine,v!==0)||(v=g.originalColumn-p.originalColumn,v!==0||S)||(v=g.generatedColumn-p.generatedColumn,v!==0)||(v=g.generatedLine-p.generatedLine,v!==0)?v:A(g.name,p.name)}e.compareByOriginalPositions=w;function R(g,p,S){let v=g.generatedLine-p.generatedLine;return v!==0||(v=g.generatedColumn-p.generatedColumn,v!==0||S)||(v=A(g.source,p.source),v!==0)||(v=g.originalLine-p.originalLine,v!==0)||(v=g.originalColumn-p.originalColumn,v!==0)?v:A(g.name,p.name)}e.compareByGeneratedPositionsDeflated=R;function A(g,p){return g===p?0:g===null?1:p===null?-1:g>p?1:-1}function T(g,p){let S=g.generatedLine-p.generatedLine;return S!==0||(S=g.generatedColumn-p.generatedColumn,S!==0)||(S=A(g.source,p.source),S!==0)||(S=g.originalLine-p.originalLine,S!==0)||(S=g.originalColumn-p.originalColumn,S!==0)?S:A(g.name,p.name)}e.compareByGeneratedPositionsInflated=T;function b(g){return JSON.parse(g.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=b;function y(g,p,S){if(p=p||"",g&&(g[g.length-1]!=="/"&&p[0]!=="/"&&(g+="/"),p=g+p),S){const v=s(S);if(!v)throw new Error("sourceMapURL could not be parsed");if(v.path){const W=v.path.lastIndexOf("/");W>=0&&(v.path=v.path.substring(0,W+1))}p=l(i(v),p)}return c(p)}e.computeSourceURL=y})(as);var Xa={};let XR=class fg{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new fg;for(let s=0,i=t.length;s<i;s++)r.add(t[s],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),s=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,s)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};Xa.ArraySet=XR;var Yf={};const qf=as;function JR(e,t){const n=e.generatedLine,r=t.generatedLine,s=e.generatedColumn,i=t.generatedColumn;return r>n||r==n&&i>=s||qf.compareByGeneratedPositionsInflated(e,t)<=0}let QR=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){JR(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(qf.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};Yf.MappingList=QR;const cs=Wf,ht=as,ki=Xa.ArraySet,ZR=Yf.MappingList;let Xf=class dg{constructor(t){t||(t={}),this._file=ht.getArg(t,"file",null),this._sourceRoot=ht.getArg(t,"sourceRoot",null),this._skipValidation=ht.getArg(t,"skipValidation",!1),this._sources=new ki,this._names=new ki,this._mappings=new ZR,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new dg({file:t.file,sourceRoot:n});return t.eachMapping(function(s){const i={generated:{line:s.generatedLine,column:s.generatedColumn}};s.source!=null&&(i.source=s.source,n!=null&&(i.source=ht.relative(n,i.source)),i.original={line:s.originalLine,column:s.originalColumn},s.name!=null&&(i.name=s.name)),r.addMapping(i)}),t.sources.forEach(function(s){let i=s;n!==null&&(i=ht.relative(n,s)),r._sources.has(i)||r._sources.add(i);const o=t.sourceContentFor(s);o!=null&&r.setSourceContent(s,o)}),r}addMapping(t){const n=ht.getArg(t,"generated"),r=ht.getArg(t,"original",null);let s=ht.getArg(t,"source",null),i=ht.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,s,i),s!=null&&(s=String(s),this._sources.has(s)||this._sources.add(s)),i!=null&&(i=String(i),this._names.has(i)||this._names.add(i)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:s,name:i})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=ht.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[ht.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[ht.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let s=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);s=t.file}const i=this._sourceRoot;i!=null&&(s=ht.relative(i,s));const o=this._mappings.toArray().length>0?new ki:this._sources,a=new ki;this._mappings.unsortedForEach(function(c){if(c.source===s&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=ht.join(r,c.source)),i!=null&&(c.source=ht.relative(i,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=ht.join(r,c)),i!=null&&(c=ht.relative(i,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,s){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!s)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:s}))}}_serializeMappings(){let t=0,n=1,r=0,s=0,i=0,o=0,a="",c,l,u,h;const d=this._mappings.toArray();for(let f=0,m=d.length;f<m;f++){if(l=d[f],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(f>0){if(!ht.compareByGeneratedPositionsInflated(l,d[f-1]))continue;c+=","}c+=cs.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=cs.encode(h-o),o=h,c+=cs.encode(l.originalLine-1-s),s=l.originalLine-1,c+=cs.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=cs.encode(u-i),i=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=ht.relative(n,r));const s=ht.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,s)?this._sourcesContents[s]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};Xf.prototype._version=3,jf.SourceMapGenerator=Xf;var Jf={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,s,i,o,a){const c=Math.floor((r-n)/2)+n,l=o(s,i[c],!0);return l===0?c:l>0?r-c>1?t(c,r,s,i,o,a):a==e.LEAST_UPPER_BOUND?r<i.length?r:-1:c:c-n>1?t(n,c,s,i,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,s,i,o){if(s.length===0)return-1;let a=t(-1,s.length,r,s,i,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&i(s[a],s[a-1],!0)===0;)--a;return a}})(Jf);var ls={exports:{}},tv={},ev=Object.freeze({__proto__:null,default:tv}),Qf=yg(ev);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;ls.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},ls.exports.initialize=t=>e=t}else{const e=Qf,t=Qf;ls.exports=function(){return new Promise((r,s)=>{const i=t.join(__dirname,"mappings.wasm");e.readFile(i,null,(o,a)=>{if(o){s(o);return}r(a.buffer)})})},ls.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var Zf=ls.exports;const nv=Zf;function rv(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let us=null;var sv=function(){if(us)return us;const t=[];return us=nv().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,s,i,o,a,c,l,u,h,d){const f=new rv;f.generatedLine=r+1,f.generatedColumn=s,i&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,h&&(f.name=d)),t[t.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,s)=>{t.push(r);try{s()}finally{t.pop()}}})).then(null,n=>{throw us=null,n}),us};const O=as,Ja=Jf,Mi=Xa.ArraySet,iv=Zf,ov=sv,Qa=Symbol("smcInternal");class ct{constructor(t,n){return t==Qa?Promise.resolve(this):cv(t,n)}static initialize(t){iv.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return lv(t,n)}static async with(t,n,r){const s=await new ct(t,n);try{return await r(s)}finally{s.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}ct.prototype._version=3,ct.GENERATED_ORDER=1,ct.ORIGINAL_ORDER=2,ct.GREATEST_LOWER_BOUND=1,ct.LEAST_UPPER_BOUND=2;class hs extends ct{constructor(t,n){return super(Qa).then(r=>{let s=t;typeof t=="string"&&(s=O.parseSourceMapInput(t));const i=O.getArg(s,"version");let o=O.getArg(s,"sources");const a=O.getArg(s,"names",[]);let c=O.getArg(s,"sourceRoot",null);const l=O.getArg(s,"sourcesContent",null),u=O.getArg(s,"mappings"),h=O.getArg(s,"file",null);if(i!=r._version)throw new Error("Unsupported version: "+i);return c&&(c=O.normalize(c)),o=o.map(String).map(O.normalize).map(function(d){return c&&O.isAbsolute(c)&&O.isAbsolute(d)?O.relative(c,d):d}),r._names=Mi.fromArray(a.map(String),!0),r._sources=Mi.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return O.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,ov().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=O.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new hs(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,s=this._wasm.exports.allocate_mappings(r),i=new Uint8Array(this._wasm.exports.memory.buffer,s,r);for(let a=0;a<r;a++)i[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(s);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const s=n||null,i=r||ct.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=O.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(s,a)},()=>{switch(i){case ct.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case ct.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=O.getArg(t,"source");const r=O.getArg(t,"line"),s=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(s<0)throw new Error("Column numbers must be >= 0");const i=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),i.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,s)}),i}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:O.getArg(t,"line"),generatedColumn:O.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=O.getArg(t,"bias",ct.GREATEST_LOWER_BOUND);r==null&&(r=ct.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(i=>s=i,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),s&&s.generatedLine===n.generatedLine){let i=O.getArg(s,"source",null);i!==null&&(i=this._sources.at(i),i=O.computeSourceURL(this.sourceRoot,i,this._sourceMapURL));let o=O.getArg(s,"name",null);return o!==null&&(o=this._names.at(o)),{source:i,line:O.getArg(s,"originalLine",null),column:O.getArg(s,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let s=t;this.sourceRoot!=null&&(s=O.relative(this.sourceRoot,s));let i;if(this.sourceRoot!=null&&(i=O.urlParse(this.sourceRoot))){const o=s.replace(/^file:\/\//,"");if(i.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!i.path||i.path=="/")&&this._sources.has("/"+s))return this.sourcesContent[this._sources.indexOf("/"+s)]}if(n)return null;throw new Error('"'+s+'" is not in the SourceMap.')}generatedPositionFor(t){let n=O.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:O.getArg(t,"line"),originalColumn:O.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let s=O.getArg(t,"bias",ct.GREATEST_LOWER_BOUND);s==null&&(s=ct.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(o=>i=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,s)}),i&&i.source===r.source){let o=i.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:O.getArg(i,"generatedLine",null),column:O.getArg(i,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}hs.prototype.consumer=ct;class av extends ct{constructor(t,n){return super(Qa).then(r=>{let s=t;typeof t=="string"&&(s=O.parseSourceMapInput(t));const i=O.getArg(s,"version"),o=O.getArg(s,"sections");if(i!=r._version)throw new Error("Unsupported version: "+i);r._sources=new Mi,r._names=new Mi,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=O.getArg(c,"offset"),u=O.getArg(l,"line"),h=O.getArg(l,"column");if(u<a.line||u===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new ct(O.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(O.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(O.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:O.getArg(t,"line"),generatedColumn:O.getArg(t,"column")},r=Ja.search(n,this._sections,function(i,o){const a=i.generatedLine-o.generatedOffset.generatedLine;return a||i.generatedColumn-o.generatedOffset.generatedColumn}),s=this._sections[r];return s?s.consumer.originalPositionFor({line:n.generatedLine-(s.generatedOffset.generatedLine-1),column:n.generatedColumn-(s.generatedOffset.generatedLine===n.generatedLine?s.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const i=this._sections[r].consumer.sourceContentFor(t,!0);if(i)return i}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(O.getArg(t,"source"))===-1)continue;const s=r.consumer.generatedPositionFor(t);if(s)return{line:s.line+(r.generatedOffset.generatedLine-1),column:s.column+(r.generatedOffset.generatedLine===s.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],s=this.__originalMappingsUnsorted=[];for(let i=0;i<this._sections.length;i++){const o=this._sections[i],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=O.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let h=null;l.name&&(this._names.add(l.name),h=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&s.push(d)}}}eachMapping(t,n,r){const s=n||null,i=r||ct.GENERATED_ORDER;let o;switch(i){case ct.GENERATED_ORDER:o=this._generatedMappings;break;case ct.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=O.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,s)}_findMapping(t,n,r,s,i,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[s]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[s]);return Ja.search(t,n,i,o)}allGeneratedPositionsFor(t){const n=O.getArg(t,"line"),r={source:O.getArg(t,"source"),originalLine:n,originalColumn:O.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const s=[];let i=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",O.compareByOriginalPositions,Ja.LEAST_UPPER_BOUND);if(i>=0){let o=this._originalMappings[i];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),s.push({line:O.getArg(o,"generatedLine",null),column:O.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++i]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),s.push({line:O.getArg(o,"generatedLine",null),column:O.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++i]}}}return s}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function cv(e,t){let n=e;typeof e=="string"&&(n=O.parseSourceMapInput(e));const r=n.sections!=null?new av(n,t):new hs(n,t);return Promise.resolve(r)}function lv(e,t){return hs.fromSourceMap(e,t)}var td={};const uv=jf.SourceMapGenerator,xi=as,hv=/(\r?\n)/,fv=10,fr="$$$isSourceNode$$$";let dv=class sl{constructor(t,n,r,s,i){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=i??null,this[fr]=!0,s!=null&&this.add(s)}static fromStringWithSourceMap(t,n,r){const s=new sl,i=t.split(hv);let o=0;const a=function(){const f=_(),m=_()||"";return f+m;function _(){return o<i.length?i[o++]:void 0}};let c=1,l=0,u=null,h;return n.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)d(u,a()),c++,l=0;else{h=i[o]||"";const m=h.substr(0,f.generatedColumn-l);i[o]=h.substr(f.generatedColumn-l),l=f.generatedColumn,d(u,m),u=f;return}for(;c<f.generatedLine;)s.add(a()),c++;l<f.generatedColumn&&(h=i[o]||"",s.add(h.substr(0,f.generatedColumn)),i[o]=h.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),o<i.length&&(u&&d(u,a()),s.add(i.splice(o).join(""))),n.sources.forEach(function(f){const m=n.sourceContentFor(f);m!=null&&(r!=null&&(f=xi.join(r,f)),s.setSourceContent(f,m))}),s;function d(f,m){if(f===null||f.source===void 0)s.add(m);else{const _=r?xi.join(r,f.source):f.source;s.add(new sl(f.originalLine,f.originalColumn,_,m,f.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[fr]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[fr]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,s=this.children.length;r<s;r++)n=this.children[r],n[fr]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const s=this.children.length;if(s>0){for(n=[],r=0;r<s-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[fr]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[xi.toSetString(t)]=n}walkSourceContents(t){for(let r=0,s=this.children.length;r<s;r++)this.children[r][fr]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,s=n.length;r<s;r++)t(xi.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new uv(t);let s=!1,i=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((i!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),i=u.source,o=u.line,a=u.column,c=u.name,s=!0):s&&(r.addMapping({generated:{line:n.line,column:n.column}}),i=null,s=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===fv?(n.line++,n.column=0,h+1===d?(i=null,s=!1):s&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};td.SourceNode=dv;var pv=td.SourceNode,ed={exports:{}},B={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fs=Symbol.for("react.element"),gv=Symbol.for("react.portal"),mv=Symbol.for("react.fragment"),Ev=Symbol.for("react.strict_mode"),_v=Symbol.for("react.profiler"),yv=Symbol.for("react.provider"),Tv=Symbol.for("react.context"),Sv=Symbol.for("react.forward_ref"),Av=Symbol.for("react.suspense"),wv=Symbol.for("react.memo"),Rv=Symbol.for("react.lazy"),nd=Symbol.iterator;function vv(e){return e===null||typeof e!="object"?null:(e=nd&&e[nd]||e["@@iterator"],typeof e=="function"?e:null)}var rd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},sd=Object.assign,id={};function dr(e,t,n){this.props=e,this.context=t,this.refs=id,this.updater=n||rd}dr.prototype.isReactComponent={},dr.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},dr.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function od(){}od.prototype=dr.prototype;function Za(e,t,n){this.props=e,this.context=t,this.refs=id,this.updater=n||rd}var tc=Za.prototype=new od;tc.constructor=Za,sd(tc,dr.prototype),tc.isPureReactComponent=!0;var ad=Array.isArray,cd=Object.prototype.hasOwnProperty,ec={current:null},ld={key:!0,ref:!0,__self:!0,__source:!0};function ud(e,t,n){var r,s={},i=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(i=""+t.key),t)cd.call(t,r)&&!ld.hasOwnProperty(r)&&(s[r]=t[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];s.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:fs,type:e,key:i,ref:o,props:s,_owner:ec.current}}function Nv(e,t){return{$$typeof:fs,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function nc(e){return typeof e=="object"&&e!==null&&e.$$typeof===fs}function bv(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var hd=/\/+/g;function rc(e,t){return typeof e=="object"&&e!==null&&e.key!=null?bv(""+e.key):t.toString(36)}function Ui(e,t,n,r,s){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case fs:case gv:o=!0}}if(o)return o=e,s=s(o),e=r===""?"."+rc(o,0):r,ad(s)?(n="",e!=null&&(n=e.replace(hd,"$&/")+"/"),Ui(s,t,n,"",function(l){return l})):s!=null&&(nc(s)&&(s=Nv(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(hd,"$&/")+"/")+e)),t.push(s)),1;if(o=0,r=r===""?".":r+":",ad(e))for(var a=0;a<e.length;a++){i=e[a];var c=r+rc(i,a);o+=Ui(i,t,n,c,s)}else if(c=vv(e),typeof c=="function")for(e=c.call(e),a=0;!(i=e.next()).done;)i=i.value,c=r+rc(i,a++),o+=Ui(i,t,n,c,s);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Pi(e,t,n){if(e==null)return e;var r=[],s=0;return Ui(e,r,"","",function(i){return t.call(n,i,s++)}),r}function Cv(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Pt={current:null},Di={transition:null},Iv={ReactCurrentDispatcher:Pt,ReactCurrentBatchConfig:Di,ReactCurrentOwner:ec};function fd(){throw Error("act(...) is not supported in production builds of React.")}B.Children={map:Pi,forEach:function(e,t,n){Pi(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Pi(e,function(){t++}),t},toArray:function(e){return Pi(e,function(t){return t})||[]},only:function(e){if(!nc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},B.Component=dr,B.Fragment=mv,B.Profiler=_v,B.PureComponent=Za,B.StrictMode=Ev,B.Suspense=Av,B.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Iv,B.act=fd,B.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=sd({},e.props),s=e.key,i=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,o=ec.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)cd.call(t,c)&&!ld.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:fs,type:e.type,key:s,ref:i,props:r,_owner:o}},B.createContext=function(e){return e={$$typeof:Tv,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:yv,_context:e},e.Consumer=e},B.createElement=ud,B.createFactory=function(e){var t=ud.bind(null,e);return t.type=e,t},B.createRef=function(){return{current:null}},B.forwardRef=function(e){return{$$typeof:Sv,render:e}},B.isValidElement=nc,B.lazy=function(e){return{$$typeof:Rv,_payload:{_status:-1,_result:e},_init:Cv}},B.memo=function(e,t){return{$$typeof:wv,type:e,compare:t===void 0?null:t}},B.startTransition=function(e){var t=Di.transition;Di.transition={};try{e()}finally{Di.transition=t}},B.unstable_act=fd,B.useCallback=function(e,t){return Pt.current.useCallback(e,t)},B.useContext=function(e){return Pt.current.useContext(e)},B.useDebugValue=function(){},B.useDeferredValue=function(e){return Pt.current.useDeferredValue(e)},B.useEffect=function(e,t){return Pt.current.useEffect(e,t)},B.useId=function(){return Pt.current.useId()},B.useImperativeHandle=function(e,t,n){return Pt.current.useImperativeHandle(e,t,n)},B.useInsertionEffect=function(e,t){return Pt.current.useInsertionEffect(e,t)},B.useLayoutEffect=function(e,t){return Pt.current.useLayoutEffect(e,t)},B.useMemo=function(e,t){return Pt.current.useMemo(e,t)},B.useReducer=function(e,t,n){return Pt.current.useReducer(e,t,n)},B.useRef=function(e){return Pt.current.useRef(e)},B.useState=function(e){return Pt.current.useState(e)},B.useSyncExternalStore=function(e,t,n){return Pt.current.useSyncExternalStore(e,t,n)},B.useTransition=function(){return Pt.current.useTransition()},B.version="18.3.1",ed.exports=B;var Ov=ed.exports;const Lv=Co(32,126).map(e=>String.fromCharCode(e)),kv=U({name:"Whitespace",pattern:/ +/}),Mv=U({name:"WhitespaceSkipped",pattern:/ +/,group:yt.SKIPPED}),dd=U({name:"StringLiteral",pattern:/[^ $]+/,start_chars_hint:Lv}),pd=U({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),gd=U({name:"EscapedDollar",pattern:"$$"}),sc=U({name:"MaybeFlag",pattern:/\$[^ $]+/}),md=U({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/});function xv(e,t=""){return U({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const Ed=Object.keys(Uo).map(e=>xv(`\\$(${e})`,e)),Uv=[kv,...Ed,pd,dd,md,gd,sc],Pv=new yt(Uv,{skipValidations:!ke,ensureOptimizations:ke}),Dv=new yt([Mv,...Ed,pd,dd,md,gd,sc],{skipValidations:!ke,ensureOptimizations:ke});function $v(e,t=!1){return t?Dv.tokenize(e):Pv.tokenize(e)}function Fv(e,t,n,r){return{measureonly:!1,x:0,y:0,isEven:!0,resetColor:n,resetBg:r,activeColor:n,activeBg:r,width:e,height:t,leftEdge:void 0,rightEdge:void 0,bottomEdge:void 0,char:[],color:[],bg:[]}}Ov.createContext(Fv(1,1,15,1));let Bv=0,_d=0;const yd=ke,Gv=["Command","lines"];class jv extends hR{constructor(){super(Lf,{traceInitPerf:ke,skipValidations:!ke,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});P(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));P(this,"line",this.RULED("line",()=>{this.OPTION(()=>this.SUBRULE(this.stmt)),this.AT_LEAST_ONE(()=>this.CONSUME(rs))}));P(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stat)},{ALT:()=>this.SUBRULE(this.text)},{ALT:()=>this.SUBRULE(this.label)},{ALT:()=>this.SUBRULE(this.comment)},{ALT:()=>this.SUBRULE(this.commands)}])}));P(this,"stat",this.RULED("stat",()=>{this.CONSUME(La)}));P(this,"text",this.RULED("text",()=>{this.CONSUME(Zh)}));P(this,"label",this.RULED("label",()=>{this.CONSUME(ef)}));P(this,"comment",this.RULED("comment",()=>{this.CONSUME(tf)}));P(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>{this.CONSUME(_e),this.AT_LEAST_ONE1(()=>this.SUBRULE1(this.command))}},{ALT:()=>{this.AT_LEAST_ONE2(()=>this.SUBRULE2(this.command))}}])}));P(this,"command",this.RULED("command",()=>{this.OR([{ALT:()=>this.SUBRULE(this.flat_cmd)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));P(this,"flat_cmd",this.RULED("flat_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.hyperlink)},{ALT:()=>this.SUBRULE(this.Short_go)},{ALT:()=>this.SUBRULE(this.Short_try)},{ALT:()=>this.SUBRULE(this.Command_play)}])}));P(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.Command_if)},{ALT:()=>this.SUBRULE(this.Command_read)},{ALT:()=>this.SUBRULE(this.Command_while)},{ALT:()=>this.SUBRULE(this.Command_repeat)},{ALT:()=>this.SUBRULE(this.Command_break)},{ALT:()=>this.SUBRULE(this.Command_continue)}])}));P(this,"hyperlink",this.RULED("hyperlink",()=>{this.CONSUME(nf),this.SUBRULE(this.words),this.CONSUME(rf)}));P(this,"Short_go",this.RULED("Short_go",()=>{this.CONSUME(Da),this.SUBRULE(this.words)}));P(this,"Short_try",this.RULED("Short_try",()=>{this.CONSUME(Ef),this.SUBRULE(this.words)}));P(this,"Command_play",this.RULED("Command_play",()=>{this.CONSUME(Tf)}));P(this,"do_line",this.RULED("do_line",()=>{this.OPTION(()=>this.SUBRULE(this.do_stmt)),this.AT_LEAST_ONE(()=>this.CONSUME(rs))}));P(this,"do_stmt",this.RULED("do_stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.text)},{ALT:()=>this.SUBRULE(this.comment)},{ALT:()=>this.SUBRULE(this.commands)}])}));P(this,"Command_if",this.RULED("Command_if",()=>{this.CONSUME($a),this.SUBRULE(this.words),this.OPTION(()=>this.CONSUME(Fn)),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME($n),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.OR2([{GATE:this.BACKTRACK(this.Command_else_if),ALT:()=>this.SUBRULE(this.Command_else_if)},{GATE:this.BACKTRACK(this.Command_else),ALT:()=>this.SUBRULE(this.Command_else)},{GATE:this.BACKTRACK(this.Command_endif),ALT:()=>this.SUBRULE(this.Command_endif)}])}}])})}));P(this,"Command_else_if",this.RULED("Command_else_if",()=>{this.CONSUME(_e),this.CONSUME(Fa),this.CONSUME($a),this.SUBRULE(this.words),this.OPTION(()=>this.CONSUME(Fn)),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME($n),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.OR2([{GATE:this.BACKTRACK(this.Command_else_if),ALT:()=>this.SUBRULE(this.Command_else_if)},{GATE:this.BACKTRACK(this.Command_else),ALT:()=>this.SUBRULE(this.Command_else)},{GATE:this.BACKTRACK(this.Command_endif),ALT:()=>this.SUBRULE(this.Command_endif)}])}}])})}));P(this,"Command_else",this.RULED("Command_else",()=>{this.CONSUME(_e),this.CONSUME(Fa),this.OPTION(()=>this.CONSUME(Fn)),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME($n),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.SUBRULE(this.Command_endif)}}])})}));P(this,"Command_endif",this.RULED("Command_endif",()=>{this.CONSUME(_e),this.CONSUME(Sf)}));P(this,"Command_while",this.RULED("Command_while",()=>{this.CONSUME(_e),this.CONSUME(Af),this.SUBRULE(this.words),this.OPTION(()=>this.CONSUME(Fn)),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME($n),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(_e),this.CONSUME4(wf)}}])})}));P(this,"Command_repeat",this.RULED("Command_repeat",()=>{this.CONSUME(_e),this.CONSUME(Rf),this.SUBRULE(this.words),this.OPTION(()=>this.CONSUME(Fn)),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME($n),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(_e),this.CONSUME4(vf)}}])})}));P(this,"Command_read_flags",this.RULED("Command_read_flags",()=>{this.AT_LEAST_ONE(()=>this.CONSUME(jt))}));P(this,"Command_read",this.RULED("Command_read",()=>{this.CONSUME(_e),this.CONSUME(Ba),this.SUBRULE(this.words),this.CONSUME(Nf),this.SUBRULE(this.Command_read_flags),this.OPTION(()=>this.CONSUME(Fn)),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME($n),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(_e),this.CONSUME4(bf)}}])})}));P(this,"Command_break",this.RULED("Command_break",()=>{this.CONSUME(Cf)}));P(this,"Command_continue",this.RULED("Command_continue",()=>{this.CONSUME(If)}));P(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(ka),this.SUBRULE2(this.and_test)})}));P(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(xa),this.SUBRULE2(this.not_test)})}));P(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Ma),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));P(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));P(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(af)},{ALT:()=>this.CONSUME(cf)},{ALT:()=>this.CONSUME(lf)},{ALT:()=>this.CONSUME(uf)},{ALT:()=>this.CONSUME(hf)},{ALT:()=>this.CONSUME(ff)}])}));P(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(ka),this.SUBRULE2(this.and_test_value)})}));P(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(xa),this.SUBRULE2(this.not_test_value)})}));P(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Ma),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));P(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));P(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Ua)},{ALT:()=>this.CONSUME(Pa)}]),this.SUBRULE(this.term)}));P(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));P(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(pf)},{ALT:()=>this.CONSUME(Da)},{ALT:()=>this.CONSUME(gf)},{ALT:()=>this.CONSUME(mf)}]),this.SUBRULE(this.factor)}));P(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Ua)},{ALT:()=>this.CONSUME(Pa)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));P(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(df),this.SUBRULE(this.factor)})}));P(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));P(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(sf)},{ALT:()=>this.CONSUME(jt)},{ALT:()=>this.CONSUME(of)},{ALT:()=>this.CONSUME(Ba)},{ALT:()=>{this.CONSUME(_f),this.SUBRULE(this.expr),this.CONSUME(yf)}}])}));this.performSelfAnalysis()}PEEK(n,r,...s){console.info(n,s.map(i=>[i.image,i.tokenType]),r)}RULED(n,r,s){const i=Gv.some(o=>n.includes(o));return this.RULE(n,()=>{const o=Bv++,a=_d++,c=a.toString().padStart(3),l=" ".repeat(a),u=i?"font-weight: bold;":"";if(yd&&!this.RECORDING_PHASE){const d=[this.LA(0),this.LA(1),this.LA(2)].map(f=>[`[${f.tokenType.name}]`,f.image.replaceAll(`
`,"\\n")]).flat();console.info(`${c}%c${l}> ${n} ${o} ${d.join(" ")}`,u)}r(),yd&&!this.RECORDING_PHASE&&console.info(`${c}%c${l}< ${n} ${o}`,u),_d--},s)}}const ds=new jv,Wv=ds.getBaseCstVisitorConstructor();var Y=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.TEXT=1]="TEXT",e[e.LABEL=2]="LABEL",e[e.HYPERLINK=3]="HYPERLINK",e[e.STAT=4]="STAT",e[e.MOVE=5]="MOVE",e[e.COMMAND=6]="COMMAND",e[e.LITERAL=7]="LITERAL",e[e.IF=8]="IF",e[e.ELSE_IF=9]="ELSE_IF",e[e.ELSE=10]="ELSE",e[e.WHILE=11]="WHILE",e[e.BREAK=12]="BREAK",e[e.CONTINUE=13]="CONTINUE",e[e.REPEAT=14]="REPEAT",e[e.READ=15]="READ",e[e.OR=16]="OR",e[e.AND=17]="AND",e[e.NOT=18]="NOT",e[e.COMPARE=19]="COMPARE",e[e.OPERATOR=20]="OPERATOR",e[e.OPERATOR_ITEM=21]="OPERATOR_ITEM",e[e.EXPR=22]="EXPR",e))(Y||{}),Bn=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(Bn||{}),xe=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(xe||{}),$i=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))($i||{});function wC(e){return e}function et(e,t){return((t==null?void 0:t.map(n=>e.visit(n)).filter(n=>n))??[]).flat()}function Ze(e){return e.image}function Td(e,t){return F(e,{type:7,literal:1,value:t})}function Kv(e){return!!(e!=null&&e.tokenType)}function Hv(e){const t=Object.values(e).flat().filter(n=>!!n).map(n=>n&&Kv(n)?{startLine:n.startLine,startColumn:n.startColumn,startOffset:n.startOffset,endLine:n.endLine,endColumn:n.endColumn,endOffset:n.endOffset}:n!=null&&n.location?{...n.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(n=>n.startLine!==0&&n.endLine!==0);return{startLine:Math.min(...t.map(n=>n.startLine??1)),startColumn:Math.min(...t.map(n=>n.startColumn??1)),startOffset:Math.min(...t.map(n=>n.startOffset??1)),endLine:Math.max(...t.map(n=>n.endLine??1)),endColumn:Math.max(...t.map(n=>n.endColumn??1)),endOffset:Math.max(...t.map(n=>n.endOffset??1))}}function F(e,t){return{...t,...Hv(e)}}class Vv extends Wv{constructor(){super(),ke&&this.validateVisitor()}program(t){return F(t,{type:0,lines:et(this,t.line)})}line(t){if(t.stmt)return this.visit(t.stmt)}stmt(t){if(t.stat)return this.visit(t.stat);if(t.text)return this.visit(t.text);if(t.label)return this.visit(t.label);if(t.comment)return this.visit(t.comment);if(t.commands)return this.visit(t.commands)}stat(){}text(t){if(t.Text)return F(t,{type:1,value:Ze(t.Text[0])})}label(t){var n;return F(t,{type:2,active:!0,name:Ze(((n=t.Label)==null?void 0:n[0])??":").slice(1).trim()})}comment(t){return F(t,{type:2,active:!1,name:Ze(t.Comment[0]).slice(1).trim()})}commands(t){return et(this,t.command)}command(t){if(t.flat_cmd)return this.visit(t.flat_cmd);if(t.structured_cmd)return this.visit(t.structured_cmd)}flat_cmd(t){if(t.words)return F(t,{type:6,words:et(this,t.words).flat()});if(t.hyperlink)return this.visit(t.hyperlink);if(t.Short_go)return this.visit(t.Short_go);if(t.Short_try)return this.visit(t.Short_try);if(t.Command_play)return this.visit(t.Command_play)}structured_cmd(t){if(t.Command_if)return this.visit(t.Command_if);if(t.Command_read)return this.visit(t.Command_read);if(t.Command_while)return this.visit(t.Command_while);if(t.Command_repeat)return this.visit(t.Command_repeat);if(t.Command_break)return this.visit(t.Command_break);if(t.Command_continue)return this.visit(t.Command_continue)}hyperlink(t){var n;return F(t,{type:3,link:et(this,t.words).flat(),text:Ze(((n=t.HyperLinkText)==null?void 0:n[0])??";").slice(1)})}Short_go(t){if(t.Divide)return F(t,{type:5,wait:!0,words:et(this,t.words).flat()})}Short_try(t){if(t.Query)return F(t,{type:5,wait:!1,words:et(this,t.words).flat()})}Command_play(t){if(t.play)return F(t,{type:6,words:[Td(t,"play"),Td(t,Ze(t.play[0]).replace("play","").trim())]})}do_line(t){return this.visit(t.do_stmt)}do_stmt(t){if(t.text)return this.visit(t.text);if(t.comment)return this.visit(t.comment);if(t.commands)return this.visit(t.commands)}Command_if(t){const n=et(this,t.words).flat(),r=[this.visit(t.command),...et(this,t.do_line)].flat(),s=[this.visit(t.Command_else_if),this.visit(t.Command_else)].flat();return F(t,{type:8,method:"if",words:n.filter(E),lines:r.filter(E),branches:s.filter(E)})}Command_else_if(t){const n=et(this,t.words).flat(),r=[this.visit(t.command),...et(this,t.do_line)].flat(),s=et(this,t.Command_else_if).flat();return[F(t,{type:9,method:"if",words:n.filter(E),lines:r.filter(E)}),...s.filter(E),this.visit(t.Command_else)]}Command_else(t){const n=et(this,t.words).flat(),r=[this.visit(t.command),...et(this,t.do_line)].flat();return F(t,{type:10,method:"if",words:n.filter(E),lines:r.filter(E)})}Command_endif(){}Command_while(t){const n=et(this,t.words).flat(),r=[this.visit(t.command),...et(this,t.do_line)].flat();return F(t,{type:11,words:n.filter(E),lines:r.filter(E)})}Command_repeat(t){const n=et(this,t.words).flat(),r=[this.visit(t.command),...et(this,t.do_line)].flat();return F(t,{type:14,words:n.filter(E),lines:r.filter(E)})}Command_read(t){const n=et(this,t.words).flat(),r=[this.visit(t.command),...et(this,t.do_line)].flat();return F(t,{type:15,words:n.filter(E),lines:r.filter(E)})}Command_break(t){return F(t,{type:12})}Command_continue(t){return F(t,{type:13})}expr(t){return t.and_test.length===1?this.visit(t.and_test):F(t,{type:16,items:this.visit(t.and_test)})}and_test(t){return t.not_test.length===1?this.visit(t.not_test):F(t,{type:17,items:this.visit(t.not_test)})}not_test(t){if(t.comparison)return this.visit(t.comparison);if(t.not_test)return F(t,{type:18,items:this.visit(t.not_test)})}comparison(t){return t.arith_expr.length===1?this.visit(t.arith_expr):F(t,{type:19,lhs:this.visit(t.arith_expr[0]),compare:this.visit(t.comp_op),rhs:this.visit(t.arith_expr[1])})}comp_op(t){if(t.is||t.IsEq)return 0;if(t.IsNotEq)return 1;if(t.IsLessThan)return 2;if(t.IsGreaterThan)return 3;if(t.IsLessThanOrEqual)return 4;if(t.IsGreaterThanOrEqual)return 5}expr_value(t){return t.and_test_value.length===1?this.visit(t.and_test_value):F(t,{type:16,items:this.visit(t.and_test_value)})}and_test_value(t){return t.not_test_value.length===1?this.visit(t.not_test_value):F(t,{type:17,items:this.visit(t.not_test_value)})}not_test_value(t){if(t.arith_expr)return this.visit(t.arith_expr);if(t.not_test)return F(t,{type:18,items:this.visit(t.not_test)})}arith_expr(t){const n=this.visit(t.term);return t.arith_expr_item?F(t,{type:20,lhs:n,items:et(this,t.arith_expr_item)}):n}arith_expr_item(t){return F(t,{type:21,operator:t.Plus?1:2,rhs:this.visit(t.term)})}term(t){return t.term_item?F(t,{type:20,lhs:this.visit(t.factor),items:et(this,t.term_item)}):this.visit(t.factor)}term_item(t){let n=0;return t.Multiply&&(n=4),t.Divide&&(n=5),t.ModDivide&&(n=6),t.FloorDivide&&(n=7),F(t,{type:21,operator:n,rhs:this.visit(t.factor)})}factor(t){if(t.power)return this.visit(t.power);let n=0;return t.Plus&&(n=8),t.Minus&&(n=9),F(t,{type:20,lhs:void 0,items:[F(t,{type:21,operator:n,rhs:this.visit(t.factor)})]})}power(t){const n=this.visit(t.token);return t.factor?F(t,{type:20,lhs:n,items:[F(t,{type:21,operator:3,rhs:this.visit(t.factor)})]}):n}words(t){return et(this,t.expr)}token(t){if(t.StringLiteralDouble){const n=Ze(t.StringLiteralDouble[0]);return F(t,{type:7,literal:2,value:n.substring(1,n.length-1)})}if(t.StringLiteral)return F(t,{type:7,literal:1,value:Ze(t.StringLiteral[0])});if(t.NumberLiteral)return F(t,{type:7,literal:0,value:parseFloat(Ze(t.NumberLiteral[0]))});if(t.read)return F(t,{type:7,literal:1,value:Ze(t.read[0])});if(t.LParen)return F(t,{type:22,words:et(this,t.expr).flat()})}}const zv=new Vv,Kt={internal:0,labels:{},labelIndex:0},ps="if (api.hm()) { continue zss; }",ic=`if (api.sy()) { yield 1; ${ps} };`,Fi=`yield 1; ${ps}`,Bi="zss.js";function lt(e,t){return new pv(e.startLine??1,e.startColumn??1,Bi,t)}function oc(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Yv(e){return`'${oc(e)}'`}function Gi(e){if(e.startsWith('"'))return Gi(e.substring(1,e.length-1));const t=$v(e);return t.errors.length?e:`'${t.tokens.map(r=>r.tokenType===sc?`', api.group('${oc(r.image.substring(1))}'), '`:oc(r.image)).join("")}'`}function Ue(e){return e.filter(t=>t!==void 0).map(H)}function Sd(e){return lt(e,"")}function qv(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function nt(e,t,n){return lt(e,[`api.${t}(`,...qv(n,", "),")"])}function Xv(e){if(e.type===Y.COMPARE)switch(e.compare){case Bn.IS_EQ:return nt(e,"isEq",[H(e.lhs),H(e.rhs)]);case Bn.IS_NOT_EQ:return nt(e,"isNotEq",[H(e.lhs),H(e.rhs)]);case Bn.IS_LESS_THAN:return nt(e,"isLessThan",[H(e.lhs),H(e.rhs)]);case Bn.IS_GREATER_THAN:return nt(e,"isGreaterThan",[H(e.lhs),H(e.rhs)]);case Bn.IS_LESS_THAN_OR_EQ:return nt(e,"isLessThanOrEq",[H(e.lhs),H(e.rhs)]);case Bn.IS_GREATER_THAN_OR_EQ:return nt(e,"isGreaterThanOrEq",[H(e.lhs),H(e.rhs)])}return lt(e,"")}function Gn(e,t,n,r){return t.prepend(`api.${n}(`),t.add([", ",H(r),")"])}function Ad(e,t,n,r){return t.prepend(`api.${n}(`),t.add([H(r),")"])}function Jv(e,t){if(e.type===Y.OPERATOR_ITEM)switch(e.operator){case xe.PLUS:return Gn(e,t,"opPlus",e.rhs);case xe.MINUS:return Gn(e,t,"opMinus",e.rhs);case xe.POWER:return Gn(e,t,"opPower",e.rhs);case xe.MULTIPLY:return Gn(e,t,"opMultiply",e.rhs);case xe.DIVIDE:return Gn(e,t,"opDivide",e.rhs);case xe.MOD_DIVIDE:return Gn(e,t,"opModDivide",e.rhs);case xe.FLOOR_DIVIDE:return Gn(e,t,"opFloorDivide",e.rhs);case xe.UNI_PLUS:return Ad(e,t,"opUniPlus",e.rhs);case xe.UNI_MINUS:return Ad(e,t,"opUniMinus",e.rhs)}return lt(e,"")}function Qv(e){if(e.type===Y.OPERATOR){const t=e.lhs?H(e.lhs):lt(e,"");return e.items.forEach(n=>Jv(n,t)),t}return lt(e,"")}function H(e){switch(e.type){case Y.PROGRAM:return lt(e,[`try { // first-line
`,`zss: while (true) {
`,`switch (api.getcase()) {
`,`default:
`,`case 1: 
`,...e.lines.map(t=>[H(t),`
`]).flat(),`}
`,`api.endofprogram();
`,`while(true) { ${Fi} }
`,`}
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Bi}`]);case Y.LITERAL:switch(e.literal){case $i.NUMBER:return lt(e,`${e.value}`);case $i.STRING:return lt(e,Yv(e.value));case $i.TEMPLATE:return lt(e,Gi(e.value))}return Sd(e);case Y.TEXT:return nt(e,"text",[Gi(e.value)]);case Y.STAT:return nt(e,"stat",Ue(e.words));case Y.LABEL:{const t=Kt.labelIndex++;return Kt.labels[e.name]||(Kt.labels[e.name]=[]),Kt.labels[e.name].push(e.active?t:-t),lt(e,`case ${t}: // ${e.name}`)}case Y.HYPERLINK:return nt(e,"hyperlink",[Gi(e.text),...Ue(e.link)]);case Y.MOVE:return lt(e,["while (",nt(e,"move",[e.wait?"true":"false",...Ue(e.words)]),`) { ${Fi} };
         ${ic} ${ps}`]);case Y.COMMAND:return lt(e,["while (",nt(e,"command",Ue(e.words)),`) { ${Fi} };
         ${ic} ${ps}`]);case Y.IF:{const t=lt(e,["if (",nt(e,`${e.method}`,Ue(e.words)),`) {
`]);return e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),e.branches&&e.branches.forEach(n=>t.add(H(n))),t.add("}"),t}case Y.ELSE_IF:{const t=lt(e,["} else if (",nt(e,e.method,Ue(e.words)),`) {
`]);return e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),t}case Y.ELSE:{const t=lt(e,`} else {
`);return e.words.length&&t.add(["while (",nt(e,"command",Ue(e.words)),`) { ${Fi} };`]),e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),t}case Y.WHILE:{const t=lt(e,["while (",nt(e,"if",Ue(e.words)),`) {
`]);return e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),t.add("}"),t}case Y.REPEAT:{const t=lt(e,[nt(e,"repeatstart",[`${Kt.internal}`,...Ue(e.words)]),`;
while (`,nt(e,"repeat",[`${Kt.internal}`]),`) {
         ${ic} ${ps}
`]);return Kt.internal+=1,e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),t.add("}"),t}case Y.READ:{const[t,...n]=e.words,r=lt(e,[nt(e,"readStart",[`${Kt.internal}`,H(t)]),`;
while (`,nt(e,"read",[`${Kt.internal}`,...Ue(n)]),`) {
`]);return Kt.internal+=1,e.lines&&e.lines.forEach(s=>r.add([H(s),`
`])),r.add("}"),r}case Y.BREAK:return lt(e,`break;
`);case Y.CONTINUE:return lt(e,`continue;
`);case Y.OR:return nt(e,"or",e.items.map(H));case Y.AND:return nt(e,"and",e.items.map(H));case Y.NOT:return nt(e,"not",e.items.map(H));case Y.COMPARE:return Xv(e);case Y.OPERATOR:return Qv(e);case Y.EXPR:return nt(e,"expr",e.words.map(H));default:return console.error("<unsupported node>",e),Sd(e)}}function Zv(e){return Kt.internal=0,Kt.labels={restart:[1]},Kt.labelIndex=2,{...H(e).toStringWithSourceMap({file:`${Bi}.map`}),...Kt}}const tN=64;function eN(e){return Array.isArray(e)?e.length>0?1:0:e??0}function qt(e){return`${e??""}`}function nN(e,t){var b;const n=Gg(t.labels??{});let r,s="",i,o=0;const a={},c={},l={};let u=!1,h=wm,d=0,f=0,m=!1;const _=[];let w={};function R(y){if(w[y]===void 0)for(let g=0;g<_.length;++g){const p=_[g].getcommand(y);p&&(w[y]=p)}return w[y]}function A(y,g){const p=R(y);if(!p)throw new Error(`unknown firmware command ${y}`);return p(T,g)}const T={id(){return e},senderid(y=T.id()){return`vm${y??T.id()}`},install(y){E(y)&&(w={},_.push(y))},set(y,g){const p=y.toLowerCase();for(let S=0;S<_.length;++S){const[v]=_[S].set(T,p,g);if(v)return g}return g},get(y){const g=y.toLowerCase();for(let p=0;p<_.length;++p){const[S,v]=_[p].get(T,g);if(S)return v}},cycle(y){h=y},timestamp(){return f},tick(y){f=y;for(let p=0;p<_.length;++p)_[p].shouldtick(T);if(!T.shouldtick())return!1;const g=d%h===0;if(++d,!g)return!1;o=0,u=!1;for(let p=0;p<_.length;++p)_[p].tick(T);try{const p=r==null?void 0:r.next();p!=null&&p.done&&(console.error("we crashed?",t.source),m=!0)}catch(p){console.error("we crashed?",p),m=!0}for(let p=0;p<_.length;++p)_[p].tock(T);return!0},shouldtick(){return m===!1||T.hm()!==0},shouldhalt(){return o++>tN},hm(){var g;const y=(i==null?void 0:i.target)??"";return((g=n[y])==null?void 0:g.find(p=>p>0))??0},yield(){u=!0},sy(){return u||T.shouldhalt()},emit(y,g){rt.emit(y,T.senderid(),g)},send(y,g,p){rt.emit(`${T.senderid(y)}:${g}`,e,p)},lock(y){s=y},unlock(){s=""},message(y){switch(y.target){case"urlstate":{const[g,p]=y.data;T.set(g,p);break}default:if(s&&y.sender!==s)return;i=y;break}},zap(y){const g=n[y];if(g){const p=g.findIndex(S=>S>0);p>=0&&(g[p]*=-1)}},restore(y){const g=n[y];if(g)for(let p=0;p<g.length;p++)g[p]=Math.abs(g[p])},getcase(){if(i){const y=T.hm();return T.set("sender",i.sender),T.set("data",i.data),i.player&&T.set("player",i.player),i=void 0,u=!1,m=!1,y}return 0},endofprogram(){T.yield(),m=!0},stacktrace(y){const g=HR.parse(y),[p]=g.filter(S=>S.fileName===Bi);return{line:(p==null?void 0:p.lineNumber)??0,column:(p==null?void 0:p.columnNumber)??0}},text(y){return A("text",[y])},stat(...y){return A("stat",y)},hyperlink(...y){return A("hyperlink",y)},move(y,...g){const p=T.command("go",...g);return T.yield(),p&&y?1:0},command(...y){if(y.length===0)return 0;const[g,...p]=y,S=R(qt(g));return S?S(T,p):A("send",[g,...p])},if(...y){const[g,p]=C(L(T,y),0,[N.ANY]),S=eN(g);return S&&p<y.length&&T.command(...y.slice(p)),S},repeatstart(y,...g){const[p,S]=C(L(T,g),0,[N.NUMBER]);a[y]=p,c[y]=S<g.length?g.slice(S):void 0},repeat(y){const g=a[y]??0;a[y]=g-1;const p=g>0,S=c[y];return p&&S&&T.command(...S),p},readstart(y,g){if(!it(g))return;const p=T.get(g)??[];l[y]=Array.isArray(p)?p:[p]},read(y,...g){const p=l[y];if(Array.isArray(p)===!1)return!1;const S=p.shift();if(S===void 0)return!1;const v=g.map(qt);switch(typeof S){case"number":case"string":v.forEach(W=>{T.set(W,S)});break;case"object":v.forEach(W=>{const ut=S[W];T.set(W,ut)});break}return!0},or(...y){let g=0;for(let p=0;p<y.length;){const[S,v]=C(L(T,y),0,[N.ANY]);if(g=S,g)break;p=v}return g},and(...y){let g=0;for(let p=0;p<y.length;){const[S,v]=C(L(T,y),0,[N.ANY]);if(g=S,!g)break;p=v}return g},not(...y){const[g]=C(L(T,y),0,[N.ANY]);return g?0:1},expr(...y){const[g]=C(L(T,y),0,[N.ANY]);return g},isEq(y,g){const[p]=C(L(T,[y]),0,[N.ANY]),[S]=C(L(T,[g]),0,[N.ANY]);return Bg(p,S)?1:0},isNotEq(y,g){const[p]=C(L(T,[y]),0,[N.ANY]),[S]=C(L(T,[g]),0,[N.ANY]);return p!==S?1:0},isLessThan(y,g){const[p]=C(L(T,[y]),0,[N.NUMBER]),[S]=C(L(T,[g]),0,[N.NUMBER]);return p<S?1:0},isGreaterThan(y,g){const[p]=C(L(T,[y]),0,[N.NUMBER]),[S]=C(L(T,[g]),0,[N.NUMBER]);return p>S?1:0},isLessThanOrEq(y,g){const[p]=C(L(T,[y]),0,[N.NUMBER]),[S]=C(L(T,[g]),0,[N.NUMBER]);return p<=S?1:0},isGreaterThanOrEq(y,g){const[p]=C(L(T,[y]),0,[N.NUMBER]),[S]=C(L(T,[g]),0,[N.NUMBER]);return p>=S?1:0},opPlus(y,g){const[p]=C(L(T,[y]),0,[N.ANY]),[S]=C(L(T,[g]),0,[N.ANY]);return p+S},opMinus(y,g){const[p]=C(L(T,[y]),0,[N.ANY]),[S]=C(L(T,[g]),0,[N.ANY]);return p-S},opPower(y,g){const[p]=C(L(T,[y]),0,[N.NUMBER]),[S]=C(L(T,[g]),0,[N.NUMBER]);return Math.pow(p,S)},opMultiply(y,g){const[p]=C(L(T,[y]),0,[N.NUMBER]),[S]=C(L(T,[g]),0,[N.NUMBER]);return p*S},opDivide(y,g){const[p]=C(L(T,[y]),0,[N.NUMBER]),[S]=C(L(T,[g]),0,[N.NUMBER]);return p/S},opModDivide(y,g){const[p]=C(L(T,[y]),0,[N.NUMBER]),[S]=C(L(T,[g]),0,[N.NUMBER]);return p%S},opFloorDivide(y,g){const[p]=C(L(T,[y]),0,[N.NUMBER]),[S]=C(L(T,[g]),0,[N.NUMBER]);return Math.floor(p/S)},opUniPlus(y){const[g]=C(L(T,[y]),0,[N.NUMBER]);return+g},opUniMinus(y){const[g]=C(L(T,[y]),0,[N.NUMBER]);return-g}};return r=(b=t.code)==null?void 0:b.call(t,T),T}function gs(e){const t={},n={...e,getcommand(r){return t[r]},command(r,s){return t[r]=s,n}};return n}const rN=gs({get(){return[!1,void 0]},set(){return[!1,void 0]},shouldtick(){},tick(){},tock(){}}).command("book",(e,t)=>{const[n,r]=C(L(e,t),0,[N.STRING,N.STRING]),s=n.toLowerCase();switch(r.toLowerCase()){case"create":PR(SR(s,[]));break}return 0}).command("register",(e,t)=>{var o,a;const r=((a=(o=tt(e.id()).object)==null?void 0:o.stats)==null?void 0:a.player)??"",[s,i]=C(L(e,t),0,[N.STRING,N.STRING]);switch(s.toLowerCase()){case"read":tm(e.senderid(),i,r);break;case"write":em(e.senderid(),i,e.get(i),r);break;default:Zn(e.senderid(),"register",`unknown #regsiter [action] ${s}`,r);break}return 0}).command("clear",(e,t)=>{const n=qt(t[0]);return e.set(n,void 0),0}).command("set",(e,t)=>{const[n,r]=C(L(e,t),0,[N.STRING,N.ANY]);return e.set(n,r),0}).command("take",(e,t)=>{const[n,r,s]=C(L(e,t),0,[N.STRING,N.MAYBE_NUMBER]),i=e.get(n),o=r??1;if(!bt(i))return 1;const a=i-o;return a<0?(s<t.length&&e.command(...t.slice(s)),1):(e.set(n,a),0)}).command("give",(e,t)=>{const[n,r,s]=C(L(e,t),0,[N.STRING,N.MAYBE_NUMBER]),i=e.get(n),o=bt(i)?i:0,a=r??1;if(!bt(a))return 0;const c=i===void 0?1:0;return c&&s<t.length&&e.command(...t.slice(s)),e.set(n,o+a),c}).command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(qt(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(qt(t[0])),0)),sN=gs({get(){return[!1,void 0]},set(){return[!1,void 0]},shouldtick(){},tick(){},tock(){}}).command("play",(e,t)=>{const n=L(e,t),[r]=C(n,0,[N.STRING]),s=e.get(r);return it(s)?e.emit("pcspeaker:play",[-1,s]):e.emit("pcspeaker:play",[-1,r]),0}),iN=navigator.userAgent.indexOf("Mac")!==-1?"cmd":"ctrl",tn="$dkpurple",oN="$196",wd="$204",aN="$199",pr="$186",Rd="$205";function ye(e,t){return`$${e}${t}$blue`}function vd(e,t){return`$${e}${t}$ondkblue`}function gr(e){const t=oN.repeat(e.length+2),n=Rd.repeat(e.length+3);$t("cli",`${tn}${pr} `),$t("cli",`${tn}${aN}${t}`),$t("cli",`${tn}${pr} $white${e}`),$t("cli",`${tn}${wd}${n}`)}function mr(e){const t=Rd.repeat(e.length+2);$t("cli",`${tn}${pr} `),$t("cli",`${tn}${pr} $gray${e}`),$t("cli",`${tn}${wd}${t}`)}function J(e,t){$t("cli",`${tn}${pr} $white${e} $blue${t}`)}function vt(e){$t("cli",`${tn}${pr} $blue${e}`)}const cN=gs({get(e,t){return[!1,void 0]},set(e,t,n){return[!1,void 0]},shouldtick(){},tick(){},tock(){}}).command("text",(e,t)=>{const n=t.map(qt).join("");return $t("cli","player>",n),0}).command("hyperlink",(e,t)=>{const[n,r,...s]=t,i=qt(n),o=qt(r),a=s.map(qt).join("");return $t("cli","player>",i,o,a),0}).command("help",()=>(gr("H E L P"),J("#1","zss controls and inputs"),J("#2","text formatting"),J("#3","edit commands"),J("#4","player settings"),mr("keyboard input"),J("?","open console"),J("esc","close console"),J("tab","move console"),J("up / down arrow keys","navigate console items"),J("left / right arrow keys","change console items"),J("enter","interact with console items"),J("alt + arrow keys","skip words and console lines"),J(`${iN} + up / down arrow keys`,"input history"),0)).command("1",()=>(gr("zss controls and inputs"),mr("keyboard input"),J("arrow keys","move"),J("shift + arrow keys","shoot"),J("enter","ok / accept"),J("escape","cancel / close"),J("tab","menu / action"),mr("mouse input"),vt("todo ???"),mr("controller input"),J("left stick","move"),J("right stick","aim"),J("a","ok / accept"),J("b","cancel / close"),J("y","menu / action"),J("x","shoot"),J("triggers","shoot"),0)).command("2",()=>(gr("text formatting"),mr("typography"),vt("plain text"),vt("$centering text"),vt('"\\"@quoted strings for special chars\\""'),vt("$$0-255 for ascii chars $159$176$240"),vt(`use color names like ${ye("red","$$red")} to change foreground color`),vt(`use color names like ${vd("ongreen","$$ongreen")} to change background color`),vt(`use clear ${vd("clear","to change background to")} transparent`),mr("hypertext"),vt(`${ye("white",'"!hotkey"')} message shortcut;${ye("gray","Label")}`),vt(`${ye("white",'"!range"')} flag [labelmin] [labelmax];${ye("gray","Input Label")}`),vt(`${ye("white",'"!select"')} flag ...list of values;${ye("gray","Input Label")}`),vt(`${ye("white",'"!number"')} flag [minvalue] [maxvalue];${ye("gray","Input Label")}`),vt(`${ye("white",'"!text"')} flag;${ye("gray","Input Label")}`),0)).command("3",()=>(gr("edit commands"),J("#books","list books in memory"),0)).command("books",()=>{gr("books");const e=xR();return e.length?e.forEach(t=>{vt(`!bookopen ${t.id};${t.name}`)}):vt("no books found"),vt("!bookcreate;create a new book"),0}).command("4",()=>(gr("player settings"),vt("todo"),0)).command("send",(e,t)=>(bo("cli",JSON.stringify(t)),0));var Nd={exports:{}};/*! Case - v1.6.2 - 2020-03-24
* Copyright (c) 2020 Nathan Bubna; Licensed MIT, GPL */(function(e){(function(){var t=function(f,m){return m=m||"",f.replace(/(^|-)/g,"$1\\u"+m).replace(/,/g,"\\u"+m)},n=t("20-26,28-2F,3A-40,5B-60,7B-7E,A0-BF,D7,F7","00"),r="a-z"+t("DF-F6,F8-FF","00"),s="A-Z"+t("C0-D6,D8-DE","00"),i="A|An|And|As|At|But|By|En|For|If|In|Of|On|Or|The|To|Vs?\\.?|Via",o=function(f,m,_,w){return f=f||n,m=m||r,_=_||s,w=w||i,{capitalize:new RegExp("(^|["+f+"])(["+m+"])","g"),pascal:new RegExp("(^|["+f+"])+(["+m+_+"])","g"),fill:new RegExp("["+f+"]+(.|$)","g"),sentence:new RegExp('(^\\s*|[\\?\\!\\.]+"?\\s+"?|,\\s+")(['+m+"])","g"),improper:new RegExp("\\b("+w+")\\b","g"),relax:new RegExp("([^"+_+"])(["+_+"]*)(["+_+"])(?=[^"+_+"]|$)","g"),upper:new RegExp("^[^"+m+"]+$"),hole:/[^\s]\s[^\s]/,apostrophe:/'/g,room:new RegExp("["+f+"]")}},a=o(),c={re:a,unicodes:t,regexps:o,types:[],up:String.prototype.toUpperCase,low:String.prototype.toLowerCase,cap:function(f){return c.up.call(f.charAt(0))+f.slice(1)},decap:function(f){return c.low.call(f.charAt(0))+f.slice(1)},deapostrophe:function(f){return f.replace(a.apostrophe,"")},fill:function(f,m,_){return m!=null&&(f=f.replace(a.fill,function(w,R){return R?m+R:""})),_&&(f=c.deapostrophe(f)),f},prep:function(f,m,_,w){if(f=f==null?"":f+"",!w&&a.upper.test(f)&&(f=c.low.call(f)),!m&&!a.hole.test(f)){var R=c.fill(f," ");a.hole.test(R)&&(f=R)}return!_&&!a.room.test(f)&&(f=f.replace(a.relax,c.relax)),f},relax:function(f,m,_,w){return m+" "+(_?_+" ":"")+w}},l={_:c,of:function(f){for(var m=0,_=c.types.length;m<_;m++)if(l[c.types[m]].apply(l,arguments)===f)return c.types[m]},flip:function(f){return f.replace(/\w/g,function(m){return(m==c.up.call(m)?c.low:c.up).call(m)})},random:function(f){return f.replace(/\w/g,function(m){return(Math.round(Math.random())?c.up:c.low).call(m)})},type:function(f,m){l[f]=m,c.types.push(f)}},u={lower:function(f,m,_){return c.fill(c.low.call(c.prep(f,m)),m,_)},snake:function(f){return l.lower(f,"_",!0)},constant:function(f){return l.upper(f,"_",!0)},camel:function(f){return c.decap(l.pascal(f))},kebab:function(f){return l.lower(f,"-",!0)},upper:function(f,m,_){return c.fill(c.up.call(c.prep(f,m,!1,!0)),m,_)},capital:function(f,m,_){return c.fill(c.prep(f).replace(a.capitalize,function(w,R,A){return R+c.up.call(A)}),m,_)},header:function(f){return l.capital(f,"-",!0)},pascal:function(f){return c.fill(c.prep(f,!1,!0).replace(a.pascal,function(m,_,w){return c.up.call(w)}),"",!0)},title:function(f){return l.capital(f).replace(a.improper,function(m,_,w,R){return w>0&&w<R.lastIndexOf(" ")?c.low.call(m):m})},sentence:function(f,m,_){return f=l.lower(f).replace(a.sentence,function(w,R,A){return R+c.up.call(A)}),m&&m.forEach(function(w){f=f.replace(new RegExp("\\b"+l.lower(w)+"\\b","g"),c.cap)}),_&&_.forEach(function(w){f=f.replace(new RegExp("(\\b"+l.lower(w)+"\\. +)(\\w)"),function(R,A,T){return A+c.low.call(T)})}),f}};u.squish=u.pascal,l.default=l;for(var h in u)l.type(h,u[h]);var d=typeof d=="function"?d:function(){};d(e.exports?e.exports=l:this.Case=l)}).call(Ms)})(Nd);var lN=Nd.exports,uN=mo(lN);const bd=1,Cd=2,ac=4,cc=8,ms=32,en=64,Xt=128,ji=31,lc=63,jn=127,hN=2147483647,gn=Math.floor,Wi=Math.abs,Id=(e,t)=>e<t?e:t,Wn=(e,t)=>e>t?e:t,Od=e=>e!==0?e<0:1/e<0,Ld=Number.MAX_SAFE_INTEGER,fN=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&gn(e)===e),Er=()=>new Set,uc=e=>e[e.length-1],dN=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},mn=Array.from,pN=Array.isArray,gN=e=>e.toLowerCase(),mN=/^\s*/g,EN=e=>e.replace(mN,""),_N=/([A-Z])/g,kd=(e,t)=>EN(e.replace(_N,n=>`${t}${gN(n)}`)),yN=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},Es=typeof TextEncoder<"u"?new TextEncoder:null,TN=Es?e=>Es.encode(e):yN;let _s=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});_s&&_s.decode(new Uint8Array).length===1&&(_s=null);const En=e=>new Error(e),Pe=()=>{throw En("Method unimplemented")},De=()=>{throw En("Unexpected case")};class ys{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const _n=()=>new ys,SN=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Te=e=>{const t=new Uint8Array(SN(e));let n=0;for(let r=0;r<e.bufs.length;r++){const s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},AN=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Wn(n,t)*2),e.cpos=0)},Tt=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},hc=Tt,D=(e,t)=>{for(;t>jn;)Tt(e,Xt|jn&t),t=gn(t/128);Tt(e,jn&t)},fc=(e,t)=>{const n=Od(t);for(n&&(t=-t),Tt(e,(t>lc?Xt:0)|(n?en:0)|lc&t),t=gn(t/64);t>0;)Tt(e,(t>jn?Xt:0)|jn&t),t=gn(t/128)},dc=new Uint8Array(3e4),wN=dc.length/3,RN=(e,t)=>{if(t.length<wN){const n=Es.encodeInto(t,dc).written||0;D(e,n);for(let r=0;r<n;r++)Tt(e,dc[r])}else Ot(e,TN(t))},vN=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;D(e,r);for(let s=0;s<r;s++)Tt(e,n.codePointAt(s))},_r=Es&&Es.encodeInto?RN:vN,Ki=(e,t)=>{const n=e.cbuf.length,r=e.cpos,s=Id(n-r,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Wn(n*2,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},Ot=(e,t)=>{D(e,t.byteLength),Ki(e,t)},pc=(e,t)=>{AN(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},NN=(e,t)=>pc(e,4).setFloat32(0,t,!1),bN=(e,t)=>pc(e,8).setFloat64(0,t,!1),CN=(e,t)=>pc(e,8).setBigInt64(0,t,!1),Md=new DataView(new ArrayBuffer(4)),IN=e=>(Md.setFloat32(0,e),Md.getFloat32(0)===e),Ts=(e,t)=>{switch(typeof t){case"string":Tt(e,119),_r(e,t);break;case"number":fN(t)&&Wi(t)<=hN?(Tt(e,125),fc(e,t)):IN(t)?(Tt(e,124),NN(e,t)):(Tt(e,123),bN(e,t));break;case"bigint":Tt(e,122),CN(e,t);break;case"object":if(t===null)Tt(e,126);else if(pN(t)){Tt(e,117),D(e,t.length);for(let n=0;n<t.length;n++)Ts(e,t[n])}else if(t instanceof Uint8Array)Tt(e,116),Ot(e,t);else{Tt(e,118);const n=Object.keys(t);D(e,n.length);for(let r=0;r<n.length;r++){const s=n[r];_r(e,s),Ts(e,t[s])}}break;case"boolean":Tt(e,t?120:121);break;default:Tt(e,127)}};class xd extends ys{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&D(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Ud=e=>{e.count>0&&(fc(e.encoder,e.count===1?e.s:-e.s),e.count>1&&D(e.encoder,e.count-2))};class Hi{constructor(){this.encoder=new ys,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Ud(this),this.count=1,this.s=t)}toUint8Array(){return Ud(this),Te(this.encoder)}}const Pd=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);fc(e.encoder,t),e.count>1&&D(e.encoder,e.count-2)}};class gc{constructor(){this.encoder=new ys,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Pd(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Pd(this),Te(this.encoder)}}class ON{constructor(){this.sarr=[],this.s="",this.lensE=new Hi}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new ys;return this.sarr.push(this.s),this.s="",_r(t,this.sarr.join("")),Ki(t,this.lensE.toUint8Array()),Te(t)}}const Dd=En("Unexpected end of array"),$d=En("Integer out of Range");class Vi{constructor(t){this.arr=t,this.pos=0}}const Kn=e=>new Vi(e),LN=e=>e.pos!==e.arr.length,kN=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Dt=e=>kN(e,$(e)),yr=e=>e.arr[e.pos++],$=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const s=e.arr[e.pos++];if(t=t+(s&jn)*n,n*=128,s<Xt)return t;if(t>Ld)throw $d}throw Dd},mc=e=>{let t=e.arr[e.pos++],n=t&lc,r=64;const s=(t&en)>0?-1:1;if(!(t&Xt))return s*n;const i=e.arr.length;for(;e.pos<i;){if(t=e.arr[e.pos++],n=n+(t&jn)*r,r*=128,t<Xt)return s*n;if(n>Ld)throw $d}throw Dd},Tr=_s?e=>_s.decode(Dt(e)):e=>{let t=$(e);if(t===0)return"";{let n=String.fromCodePoint(yr(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(yr(e));else for(;t>0;){const r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},Ec=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},MN=[e=>{},e=>null,mc,e=>Ec(e,4).getFloat32(0,!1),e=>Ec(e,8).getFloat64(0,!1),e=>Ec(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Tr,e=>{const t=$(e),n={};for(let r=0;r<t;r++){const s=Tr(e);n[s]=Ss(e)}return n},e=>{const t=$(e),n=[];for(let r=0;r<t;r++)n.push(Ss(e));return n},Dt],Ss=e=>MN[127-yr(e)](e);class Fd extends Vi{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),LN(this)?this.count=$(this)+1:this.count=-1),this.count--,this.s}}class zi extends Vi{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=mc(this);const t=Od(this.s);this.count=1,t&&(this.s=-this.s,this.count=$(this)+2)}return this.count--,this.s}}class _c extends Vi{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=mc(this),n=t&1;this.diff=gn(t/2),this.count=1,n&&(this.count=$(this)+2)}return this.s+=this.diff,this.count--,this.s}}class xN{constructor(t){this.decoder=new zi(t),this.str=Tr(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const Se=()=>new Map,yc=e=>{const t=Se();return e.forEach((n,r)=>{t.set(r,n)}),t},yn=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},UN=(e,t)=>{const n=[];for(const[r,s]of e)n.push(t(s,r));return n},PN=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1};class DN{constructor(){this._observers=Se()}on(t,n){return yn(this._observers,t,Er).add(n),n}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return mn((this._observers.get(t)||Se()).values()).forEach(r=>r(...n))}destroy(){this._observers=Se()}}const $N=crypto.getRandomValues.bind(crypto),Bd=()=>$N(new Uint32Array(1))[0],FN="10000000-1000-4000-8000"+-1e11,BN=()=>FN.replace(/[018]/g,e=>(e^Bd()&15>>e/4).toString(16)),Gd=e=>new Promise(e);Promise.all.bind(Promise);const jd=e=>e===void 0?null:e;class GN{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let Wd=new GN,jN=!0;try{typeof localStorage<"u"&&localStorage&&(Wd=localStorage,jN=!1)}catch{}const WN=Wd,KN=Object.assign,HN=Object.keys,VN=(e,t)=>{for(const n in e)t(e[n],n)},Kd=e=>HN(e).length,zN=e=>{for(const t in e)return!1;return!0},YN=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},qN=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),XN=(e,t)=>e===t||Kd(e)===Kd(t)&&YN(e,(n,r)=>(n!==void 0||qN(t,r))&&t[r]===n),Tc=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Tc(e,t,n+1)}},JN=e=>e,QN=(e,t)=>t.includes(e);var Hd={};const As=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let $e;const ZN=()=>{if($e===void 0)if(As){$e=Se();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&$e.set(t,""),t=r):t!==null&&($e.set(t,r),t=null)}t!==null&&$e.set(t,"")}else typeof location=="object"?($e=Se(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");$e.set(`--${kd(t,"-")}`,n),$e.set(`-${kd(t,"-")}`,n)}})):$e=Se();return $e},Sc=e=>ZN().has(e),Ac=e=>jd(As?Hd[e.toUpperCase().replaceAll("-","_")]:WN.getItem(e));(e=>Sc("--"+e)||Ac(e)!==null)("production");const Vd=As&&QN(Hd.FORCE_COLOR,["true","1","2"]),t0=!Sc("--no-colors")&&(!As||process.stdout.isTTY||Vd)&&(!As||Sc("--color")||Vd||Ac("COLORTERM")!==null||(Ac("TERM")||"").includes("color")),e0=e=>new Uint8Array(e),n0=e=>{const t=e0(e.byteLength);return t.set(e),t};class r0{constructor(t,n){this.left=t,this.right=n}}const nn=(e,t)=>new r0(e,t);typeof DOMParser<"u"&&new DOMParser;const s0=e=>UN(e,(t,n)=>`${n}:${t};`).join(""),rn=Symbol,zd=rn(),Yd=rn(),i0=rn(),o0=rn(),a0=rn(),qd=rn(),c0=rn(),Xd=rn(),l0=rn(),u0=e=>{var r;e.length===1&&((r=e[0])==null?void 0:r.constructor)===Function&&(e=e[0]());const t=[];let n=0;for(;n<e.length;n++){const s=e[n];s===void 0||s.constructor===String||s.constructor===Number||s.constructor===Object&&t.push(JSON.stringify(s))}return t},h0={[zd]:nn("font-weight","bold"),[Yd]:nn("font-weight","normal"),[i0]:nn("color","blue"),[a0]:nn("color","green"),[o0]:nn("color","grey"),[qd]:nn("color","red"),[c0]:nn("color","purple"),[Xd]:nn("color","orange"),[l0]:nn("color","black")},f0=t0?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=Se();let s=[],i=0;for(;i<e.length;i++){const a=e[i],c=h0[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=s0(r);i>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(i>0&&(s=n,s.unshift(t.join("")));i<e.length;i++){const a=e[i];a instanceof Symbol||s.push(a)}return s}:u0,d0=(...e)=>{console.log(...f0(e)),p0.forEach(t=>t.print(e))},p0=Er(),Jd=e=>({[Symbol.iterator](){return this},next:e}),g0=(e,t)=>Jd(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),wc=(e,t)=>Jd(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Rc{constructor(t,n){this.clock=t,this.len=n}}class ws{constructor(){this.clients=new Map}}const Qd=(e,t,n)=>t.clients.forEach((r,s)=>{const i=e.doc.store.clients.get(s);for(let o=0;o<r.length;o++){const a=r[o];mp(e,i,a.clock,a.len,n)}}),m0=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const s=gn((n+r)/2),i=e[s],o=i.clock;if(o<=t){if(t<o+i.len)return s;n=s+1}else r=s-1}return null},Zd=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&m0(n,t.clock)!==null},vc=e=>{e.clients.forEach(t=>{t.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<t.length;n++){const s=t[r-1],i=t[n];s.clock+s.len>=i.clock?s.len=Wn(s.len,i.clock+i.len-s.clock):(r<n&&(t[r]=i),r++)}t.length=r})},E0=e=>{const t=new ws;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){const i=r.slice();for(let o=n+1;o<e.length;o++)dN(i,e[o].clients.get(s)||[]);t.clients.set(s,i)}});return vc(t),t},Yi=(e,t,n,r)=>{yn(e.clients,t,()=>[]).push(new Rc(n,r))},_0=()=>new ws,y0=e=>{const t=_0();return e.clients.forEach((n,r)=>{const s=[];for(let i=0;i<n.length;i++){const o=n[i];if(o.deleted){const a=o.id.clock;let c=o.length;if(i+1<n.length)for(let l=n[i+1];i+1<n.length&&l.deleted;l=n[++i+1])c+=l.length;s.push(new Rc(a,c))}}s.length>0&&t.clients.set(r,s)}),t},Sr=(e,t)=>{D(e.restEncoder,t.clients.size),mn(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),D(e.restEncoder,n);const s=r.length;D(e.restEncoder,s);for(let i=0;i<s;i++){const o=r[i];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Nc=e=>{const t=new ws,n=$(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const s=$(e.restDecoder),i=$(e.restDecoder);if(i>0){const o=yn(t.clients,s,()=>[]);for(let a=0;a<i;a++)o.push(new Rc(e.readDsClock(),e.readDsLen()))}}return t},tp=(e,t,n)=>{const r=new ws,s=$(e.restDecoder);for(let i=0;i<s;i++){e.resetDsCurVal();const o=$(e.restDecoder),a=$(e.restDecoder),c=n.clients.get(o)||[],l=St(n,o);for(let u=0;u<a;u++){const h=e.readDsClock(),d=h+e.readDsLen();if(h<l){l<d&&Yi(r,o,l,d-l);let f=Fe(c,h),m=c[f];for(!m.deleted&&m.id.clock<h&&(c.splice(f+1,0,lo(t,m,h-m.id.clock)),f++);f<c.length&&(m=c[f++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(f,0,lo(t,m,d-m.id.clock)),m.delete(t))}else Yi(r,o,h,d-h)}}if(r.clients.size>0){const i=new Hn;return D(i.restEncoder,0),Sr(i,r),i.toUint8Array()}return null},ep=Bd;class Ar extends DN{constructor({guid:t=BN(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=ep(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new dp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Gd(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Gd(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&q(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(mn(this.subdocs).map(t=>t.guid))}transact(t,n=null){return q(this,t,n)}get(t,n=Nt){const r=yn(this.share,t,()=>{const i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==Nt&&s!==n)if(s===Nt){const i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(t,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Nr)}getText(t=""){return this.get(t,Vn)}getMap(t=""){return this.get(t,br)}getXmlElement(t=""){return this.get(t,Ir)}getXmlFragment(t=""){return this.get(t,zn)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){mn(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Ar({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,q(t.parent.doc,r=>{const s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class np{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return $(this.restDecoder)}readDsLen(){return $(this.restDecoder)}}class rp extends np{readLeftID(){return G($(this.restDecoder),$(this.restDecoder))}readRightID(){return G($(this.restDecoder),$(this.restDecoder))}readClient(){return $(this.restDecoder)}readInfo(){return yr(this.restDecoder)}readString(){return Tr(this.restDecoder)}readParentInfo(){return $(this.restDecoder)===1}readTypeRef(){return $(this.restDecoder)}readLen(){return $(this.restDecoder)}readAny(){return Ss(this.restDecoder)}readBuf(){return n0(Dt(this.restDecoder))}readJSON(){return JSON.parse(Tr(this.restDecoder))}readKey(){return Tr(this.restDecoder)}}class T0{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=$(this.restDecoder),this.dsCurrVal}readDsLen(){const t=$(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class wr extends T0{constructor(t){super(t),this.keys=[],$(t),this.keyClockDecoder=new _c(Dt(t)),this.clientDecoder=new zi(Dt(t)),this.leftClockDecoder=new _c(Dt(t)),this.rightClockDecoder=new _c(Dt(t)),this.infoDecoder=new Fd(Dt(t),yr),this.stringDecoder=new xN(Dt(t)),this.parentInfoDecoder=new Fd(Dt(t),yr),this.typeRefDecoder=new zi(Dt(t)),this.lenDecoder=new zi(Dt(t))}readLeftID(){return new Rr(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Rr(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Ss(this.restDecoder)}readBuf(){return Dt(this.restDecoder)}readJSON(){return Ss(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class sp{constructor(){this.restEncoder=_n()}toUint8Array(){return Te(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){D(this.restEncoder,t)}writeDsLen(t){D(this.restEncoder,t)}}class Rs extends sp{writeLeftID(t){D(this.restEncoder,t.client),D(this.restEncoder,t.clock)}writeRightID(t){D(this.restEncoder,t.client),D(this.restEncoder,t.clock)}writeClient(t){D(this.restEncoder,t)}writeInfo(t){hc(this.restEncoder,t)}writeString(t){_r(this.restEncoder,t)}writeParentInfo(t){D(this.restEncoder,t?1:0)}writeTypeRef(t){D(this.restEncoder,t)}writeLen(t){D(this.restEncoder,t)}writeAny(t){Ts(this.restEncoder,t)}writeBuf(t){Ot(this.restEncoder,t)}writeJSON(t){_r(this.restEncoder,JSON.stringify(t))}writeKey(t){_r(this.restEncoder,t)}}class ip{constructor(){this.restEncoder=_n(),this.dsCurrVal=0}toUint8Array(){return Te(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,D(this.restEncoder,n)}writeDsLen(t){t===0&&De(),D(this.restEncoder,t-1),this.dsCurrVal+=t}}class Hn extends ip{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new gc,this.clientEncoder=new Hi,this.leftClockEncoder=new gc,this.rightClockEncoder=new gc,this.infoEncoder=new xd(hc),this.stringEncoder=new ON,this.parentInfoEncoder=new xd(hc),this.typeRefEncoder=new Hi,this.lenEncoder=new Hi}toUint8Array(){const t=_n();return D(t,0),Ot(t,this.keyClockEncoder.toUint8Array()),Ot(t,this.clientEncoder.toUint8Array()),Ot(t,this.leftClockEncoder.toUint8Array()),Ot(t,this.rightClockEncoder.toUint8Array()),Ot(t,Te(this.infoEncoder)),Ot(t,this.stringEncoder.toUint8Array()),Ot(t,Te(this.parentInfoEncoder)),Ot(t,this.typeRefEncoder.toUint8Array()),Ot(t,this.lenEncoder.toUint8Array()),Ki(t,Te(this.restEncoder)),Te(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Ts(this.restEncoder,t)}writeBuf(t){Ot(this.restEncoder,t)}writeJSON(t){Ts(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const S0=(e,t,n,r)=>{r=Wn(r,t[0].id.clock);const s=Fe(t,r);D(e.restEncoder,t.length-s),e.writeClient(n),D(e.restEncoder,r);const i=t[s];i.write(e,r-i.id.clock);for(let o=s+1;o<t.length;o++)t[o].write(e,0)},bc=(e,t,n)=>{const r=new Map;n.forEach((s,i)=>{St(t,i)>s&&r.set(i,s)}),Xi(t).forEach((s,i)=>{n.has(i)||r.set(i,0)}),D(e.restEncoder,r.size),mn(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{S0(e,t.clients.get(s),s,i)})},A0=(e,t)=>{const n=Se(),r=$(e.restDecoder);for(let s=0;s<r;s++){const i=$(e.restDecoder),o=new Array(i),a=e.readClient();let c=$(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<i;l++){const u=e.readInfo();switch(ji&u){case 0:{const h=e.readLen();o[l]=new ae(G(a,c),h),c+=h;break}case 10:{const h=$(e.restDecoder);o[l]=new ce(G(a,c),h),c+=h;break}default:{const h=(u&(en|Xt))===0,d=new Et(G(a,c),null,(u&Xt)===Xt?e.readLeftID():null,null,(u&en)===en?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(u&ms)===ms?e.readString():null,Gp(e,u));o[l]=d,c+=d.length}}}}return n},w0=(e,t,n)=>{const r=[];let s=mn(n.keys()).sort((f,m)=>f-m);if(s.length===0)return null;const i=()=>{if(s.length===0)return null;let f=n.get(s[s.length-1]);for(;f.refs.length===f.i;)if(s.pop(),s.length>0)f=n.get(s[s.length-1]);else return null;return f};let o=i();if(o===null)return null;const a=new dp,c=new Map,l=(f,m)=>{const _=c.get(f);(_==null||_>m)&&c.set(f,m)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of r){const m=f.id.client,_=n.get(m);_?(_.i--,a.clients.set(m,_.refs.slice(_.i)),n.delete(m),_.i=0,_.refs=[]):a.clients.set(m,[f]),s=s.filter(w=>w!==m)}r.length=0};for(;;){if(u.constructor!==ce){const m=yn(h,u.id.client,()=>St(t,u.id.client))-u.id.clock;if(m<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const _=u.getMissing(e,t);if(_!==null){r.push(u);const w=n.get(_)||{refs:[],i:0};if(w.refs.length===w.i)l(_,St(t,_)),d();else{u=w.refs[w.i++];continue}}else(m===0||m<u.length)&&(u.integrate(e,m),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=i(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new Hn;return bc(f,a,new Map),D(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},R0=(e,t)=>bc(e,t.doc.store,t.beforeState),v0=(e,t,n,r=new wr(e))=>q(t,s=>{s.local=!1;let i=!1;const o=s.doc,a=o.store,c=A0(r,o),l=w0(s,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<St(a,d)){i=!0;break}if(l){for(const[d,f]of l.missing){const m=u.missing.get(d);(m==null||m>f)&&u.missing.set(d,f)}u.update=Qi([u.update,l.update])}}else a.pendingStructs=l;const h=tp(r,s,a);if(a.pendingDs){const d=new wr(Kn(a.pendingDs));$(d.restDecoder);const f=tp(d,s,a);h&&f?a.pendingDs=Qi([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(i){const d=a.pendingStructs.update;a.pendingStructs=null,op(s.doc,d)}},n,!1),op=(e,t,n,r=wr)=>{const s=Kn(t);v0(s,e,n,new r(s))},N0=(e,t,n)=>op(e,t,n,rp),b0=(e,t,n=new Map)=>{bc(e,t.store,n),Sr(e,y0(t.store))},C0=(e,t=new Uint8Array([0]),n=new Hn)=>{const r=ap(t);b0(n,e,r);const s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(W0(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===Rs)return G0(s.map((i,o)=>o===0?i:H0(i)));if(n.constructor===Hn)return Qi(s)}return s[0]},I0=(e,t)=>C0(e,t,new Rs),O0=e=>{const t=new Map,n=$(e.restDecoder);for(let r=0;r<n;r++){const s=$(e.restDecoder),i=$(e.restDecoder);t.set(s,i)}return t},ap=e=>O0(new np(Kn(e))),cp=(e,t)=>(D(e.restEncoder,t.size),mn(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{D(e.restEncoder,n),D(e.restEncoder,r)}),e),L0=(e,t)=>cp(e,Xi(t.store)),k0=(e,t=new ip)=>(e instanceof Map?cp(t,e):L0(t,e),t.toUint8Array()),M0=e=>k0(e,new sp);class x0{constructor(){this.l=[]}}const lp=()=>new x0,up=(e,t)=>e.l.push(t),hp=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},fp=(e,t,n)=>Tc(e.l,[t,n]);class Rr{constructor(t,n){this.client=t,this.clock=n}}const qi=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,G=(e,t)=>new Rr(e,t),U0=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw De()},vr=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Zd(t.ds,e.id),Cc=(e,t)=>{const n=yn(e.meta,Cc,Er),r=e.doc.store;n.has(t)||(t.sv.forEach((s,i)=>{s<St(r,i)&&Tn(e,G(i,s))}),Qd(e,t.ds,s=>{}),n.add(t))};class dp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Xi=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},St=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},pp=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw De()}n.push(t)},Fe=(e,t)=>{let n=0,r=e.length-1,s=e[r],i=s.id.clock;if(i===t)return r;let o=gn(t/(i+s.length-1)*r);for(;n<=r;){if(s=e[o],i=s.id.clock,i<=t){if(t<i+s.length)return o;n=o+1}else r=o-1;o=gn((n+r)/2)}throw De()},Ic=(e,t)=>{const n=e.clients.get(t.client);return n[Fe(n,t.clock)]},Oc=(e,t,n)=>{const r=Fe(t,n),s=t[r];return s.id.clock<n&&s instanceof Et?(t.splice(r+1,0,lo(e,s,n-s.id.clock)),r+1):r},Tn=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Oc(e,n,t.clock)]},gp=(e,t,n)=>{const r=t.clients.get(n.client),s=Fe(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==ae&&r.splice(s+1,0,lo(e,i,n.clock-i.id.clock+1)),i},P0=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Fe(r,t.id.clock)]=n},mp=(e,t,n,r,s)=>{if(r===0)return;const i=n+r;let o=Oc(e,t,n),a;do a=t[o++],i<a.id.clock+a.length&&Oc(e,t,i),s(a);while(o<t.length&&t[o].id.clock<i)};class D0{constructor(t,n,r){this.doc=t,this.deleteSet=new ws,this.beforeState=Xi(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Ep=(e,t)=>t.deleteSet.clients.size===0&&!PN(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(vc(t.deleteSet),R0(e,t),Sr(e,t.deleteSet),!0),_p=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&yn(e.changed,t,Er).add(n)},Ji=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0;n=r,r=e[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Et&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const i=t-s;return i&&e.splice(t+1-i,i),i},$0=(e,t,n)=>{for(const[r,s]of e.clients.entries()){const i=t.clients.get(r);for(let o=s.length-1;o>=0;o--){const a=s[o],c=a.clock+a.len;for(let l=Fe(i,a.clock),u=i[l];l<i.length&&u.id.clock<c;u=i[++l]){const h=i[l];if(a.clock+a.len<=h.id.clock)break;h instanceof Et&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},F0=(e,t)=>{e.clients.forEach((n,r)=>{const s=t.clients.get(r);for(let i=n.length-1;i>=0;i--){const o=n[i],a=Id(s.length-1,1+Fe(s,o.clock+o.len-1));for(let c=a,l=s[c];c>0&&l.id.clock>=o.clock;l=s[c])c-=1+Ji(s,c)}})},yp=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{vc(i),n.afterState=Xi(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),fp(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Tc(a,[]),n._needFormattingCleanup&&ib(n)}finally{r.gc&&$0(i,s,r.gcFilter),F0(i,s),n.afterState.forEach((u,h)=>{const d=n.beforeState.get(h)||0;if(d!==u){const f=s.clients.get(h),m=Wn(Fe(f,d),1);for(let _=f.length-1;_>=m;)_-=1+Ji(f,_)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=s.clients.get(h),m=Fe(f,d);m+1<f.length&&Ji(f,m+1)>1||m>0&&Ji(f,m)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(d0(Xd,zd,"[yjs] ",Yd,qd,"Changed the client-id because another client seems to be using it."),r.clientID=ep()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Rs;Ep(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Hn;Ep(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):yp(e,t+1)}}},q=(e,t,n=null,r=!0)=>{const s=e._transactionCleanups;let i=!1,o=null;e._transaction===null&&(i=!0,e._transaction=new D0(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(i){const a=e._transaction===s[0];e._transaction=null,a&&yp(s,0)}}return o};function*B0(e){const t=$(e.restDecoder);for(let n=0;n<t;n++){const r=$(e.restDecoder),s=e.readClient();let i=$(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=$(e.restDecoder);yield new ce(G(s,i),c),i+=c}else if(ji&a){const c=(a&(en|Xt))===0,l=new Et(G(s,i),null,(a&Xt)===Xt?e.readLeftID():null,null,(a&en)===en?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&ms)===ms?e.readString():null,Gp(e,a));yield l,i+=l.length}else{const c=e.readLen();yield new ae(G(s,i),c),i+=c}}}}class Lc{constructor(t,n){this.gen=B0(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ce);return this.curr}}class kc{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const G0=e=>Qi(e,rp,Rs),j0=(e,t)=>{if(e.constructor===ae){const{client:n,clock:r}=e.id;return new ae(G(n,r+t),e.length-t)}else if(e.constructor===ce){const{client:n,clock:r}=e.id;return new ce(G(n,r+t),e.length-t)}else{const n=e,{client:r,clock:s}=n.id;return new Et(G(r,s+t),null,G(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Qi=(e,t=wr,n=Hn)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Kn(u)));let s=r.map(u=>new Lc(u,!0)),i=null;const o=new n,a=new kc(o);for(;s=s.filter(d=>d.curr!==null),s.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const m=d.curr.id.clock-f.curr.id.clock;return m===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===ce?1:-1:m}else return f.curr.id.client-d.curr.id.client}),s.length!==0;){const u=s[0],h=u.curr.id.client;if(i!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=i.struct.id.clock+i.struct.length&&d.id.client>=i.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>i.struct.id.clock+i.struct.length)continue;if(h!==i.struct.id.client)Sn(a,i.struct,i.offset),i={struct:d,offset:0},u.next();else if(i.struct.id.clock+i.struct.length<d.id.clock)if(i.struct.constructor===ce)i.struct.length=d.id.clock+d.length-i.struct.id.clock;else{Sn(a,i.struct,i.offset);const m=d.id.clock-i.struct.id.clock-i.struct.length;i={struct:new ce(G(h,i.struct.id.clock+i.struct.length),m),offset:0}}else{const m=i.struct.id.clock+i.struct.length-d.id.clock;m>0&&(i.struct.constructor===ce?i.struct.length-=m:d=j0(d,m)),i.struct.mergeWith(d)||(Sn(a,i.struct,i.offset),i={struct:d,offset:0},u.next())}}else i={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===i.struct.id.clock+i.struct.length&&d.constructor!==ce;d=u.next())Sn(a,i.struct,i.offset),i={struct:d,offset:0}}i!==null&&(Sn(a,i.struct,i.offset),i=null),Mc(a);const c=r.map(u=>Nc(u)),l=E0(c);return Sr(o,l),o.toUint8Array()},W0=(e,t,n=wr,r=Hn)=>{const s=ap(t),i=new r,o=new kc(i),a=new n(Kn(e)),c=new Lc(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=s.get(h)||0;if(c.curr.constructor===ce){c.next();continue}if(u.id.clock+u.length>d)for(Sn(o,u,Wn(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Sn(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}Mc(o);const l=Nc(a);return Sr(i,l),i.toUint8Array()},Tp=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Te(e.encoder.restEncoder)}),e.encoder.restEncoder=_n(),e.written=0)},Sn=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Tp(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),D(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Mc=e=>{Tp(e);const t=e.encoder.restEncoder;D(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];D(t,r.written),Ki(t,r.restEncoder)}},K0=(e,t,n,r)=>{const s=new n(Kn(e)),i=new Lc(s,!1),o=new r,a=new kc(o);for(let l=i.curr;l!==null;l=i.next())Sn(a,t(l),0);Mc(a);const c=Nc(s);return Sr(o,c),o.toUint8Array()},H0=e=>K0(e,JN,wr,Rs),Sp="You must not compute changes after the event-handler fired.";class Zi{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=V0(this.currentTarget,this.target))}deletes(t){return Zd(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw En(Sp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const i=n._map.get(s);let o,a;if(this.adds(i)){let c=i.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(i))if(c!==null&&this.deletes(c))o="delete",a=uc(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=uc(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=uc(i.content.getContent());else return;t.set(s,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw En(Sp);const n=this.target,r=Er(),s=Er(),i=[];if(t={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&i.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,s.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const V0=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)s.deleted||r++,s=s.right;n.unshift(r)}t=t._item.parent}return n},Ap=80;let xc=0;class z0{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=xc++}}const Y0=e=>{e.timestamp=xc++},wp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=xc++},q0=(e,t,n)=>{if(e.length>=Ap){const r=e.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return wp(r,t,n),r}else{const r=new z0(t,n);return e.push(r),r}},to=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((i,o)=>Wi(t-i.index)<Wi(t-o.index)?i:o);let r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,Y0(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&Wi(n.index-s)<r.parent.length/Ap?(wp(n,r,s),n):q0(e._searchMarker,r,s)},vs=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const s=e[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){e.splice(r,1);continue}s.p=i,i.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=Wn(t,s.index+n))}},eo=(e,t,n)=>{const r=e,s=t.changedParentTypes;for(;yn(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;fp(r._eH,n,t)};class Nt{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=lp(),this._dEH=lp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Pe()}clone(){throw Pe()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){up(this._eH,t)}observeDeep(t){up(this._dEH,t)}unobserve(t){hp(this._eH,t)}unobserveDeep(t){hp(this._dEH,t)}toJSON(){}}const Rp=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const s=[];let i=e._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)s.push(o[a]),r--;t=0}}i=i.right}return s},vp=e=>{const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)t.push(r[s])}n=n.right}return t},Ns=(e,t)=>{let n=0,r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)t(s[i],n++,e)}r=r.right}},Np=(e,t)=>{const n=[];return Ns(e,(r,s)=>{n.push(t(r,s,e))}),n},X0=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},bp=(e,t)=>{const n=to(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},no=(e,t,n,r)=>{let s=n;const i=e.doc,o=i.clientID,a=i.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(s=new Et(G(o,St(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new qn(l)),s.integrate(e,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:s=new Et(G(o,St(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new bs(new Uint8Array(h))),s.integrate(e,0);break;case Ar:s=new Et(G(o,St(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new Is(h)),s.integrate(e,0);break;default:if(h instanceof Nt)s=new Et(G(o,St(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new sn(h)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Cp=()=>En("Length exceeded!"),Ip=(e,t,n,r)=>{if(n>t._length)throw Cp();if(n===0)return t._searchMarker&&vs(t._searchMarker,n,r.length),no(e,t,null,r);const s=n,i=to(t,n);let o=t._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Tn(e,G(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&vs(t._searchMarker,s,r.length),no(e,t,o,r)},J0=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return no(e,t,s,n)},Op=(e,t,n,r)=>{if(r===0)return;const s=n,i=r,o=to(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Tn(e,G(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Tn(e,G(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw Cp();t._searchMarker&&vs(t._searchMarker,s,-i+r)},ro=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Uc=(e,t,n,r)=>{const s=t._map.get(n)||null,i=e.doc,o=i.clientID;let a;if(r==null)a=new qn([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new qn([r]);break;case Uint8Array:a=new bs(r);break;case Ar:a=new Is(r);break;default:if(r instanceof Nt)a=new sn(r);else throw new Error("Unexpected content type")}new Et(G(o,St(i.store,o)),s,s&&s.lastId,null,null,t,n,a).integrate(e,0)},Pc=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Lp=e=>{const t={};return e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},kp=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted},Q0=(e,t)=>{const n={};return e._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!t.sv.has(i.id.client)||i.id.clock>=(t.sv.get(i.id.client)||0));)i=i.left;i!==null&&vr(i,t)&&(n[s]=i.content.getContent()[i.length-1])}),n},so=e=>g0(e.entries(),t=>!t[1].deleted);class Z0 extends Zi{constructor(t,n){super(t,n),this._transaction=n}}class Nr extends Nt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Nr;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Nr}clone(){const t=new Nr;return t.insert(0,this.toArray().map(n=>n instanceof Nt?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,n){super._callObserver(t,n),eo(this,t,new Z0(this,t))}insert(t,n){this.doc!==null?q(this.doc,r=>{Ip(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?q(this.doc,n=>{J0(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?q(this.doc,r=>{Op(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return bp(this,t)}toArray(){return vp(this)}slice(t=0,n=this.length){return Rp(this,t,n)}toJSON(){return this.map(t=>t instanceof Nt?t.toJSON():t)}map(t){return Np(this,t)}forEach(t){Ns(this,t)}[Symbol.iterator](){return X0(this)}_write(t){t.writeTypeRef(wb)}}const tb=e=>new Nr;class eb extends Zi{constructor(t,n,r){super(t,n),this.keysChanged=r}}class br extends Nt{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new br}clone(){const t=new br;return this.forEach((n,r)=>{t.set(r,n instanceof Nt?n.clone():n)}),t}_callObserver(t,n){eo(this,t,new eb(this,t,n))}toJSON(){const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];t[r]=s instanceof Nt?s.toJSON():s}}),t}get size(){return[...so(this._map)].length}keys(){return wc(so(this._map),t=>t[0])}values(){return wc(so(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return wc(so(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?q(this.doc,n=>{ro(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?q(this.doc,r=>{Uc(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Pc(this,t)}has(t){return kp(this,t)}clear(){this.doc!==null?q(this.doc,t=>{this.forEach(function(n,r,s){ro(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Rb)}}const nb=e=>new br,An=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&XN(e,t);class Dc{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&De(),this.right.content.constructor){case mt:this.right.deleted||Cr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Mp=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case mt:t.right.deleted||Cr(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Tn(e,G(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},io=(e,t,n,r)=>{const s=new Map,i=r?to(t,n):null;if(i){const o=new Dc(i.p.left,i.p,i.index,s);return Mp(e,o,n-i.index)}else{const o=new Dc(null,t._start,0,s);return Mp(e,o,n)}},xp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===mt&&An(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=e.doc,i=s.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Et(G(i,St(s.store,i)),c,c&&c.lastId,l,l&&l.id,t,null,new mt(a,o));u.integrate(e,0),n.right=u,n.forward()})},Cr=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Up=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===mt&&An(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Pp=(e,t,n,r)=>{const s=e.doc,i=s.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!An(l,c)){o.set(a,l);const{left:u,right:h}=n;n.right=new Et(G(i,St(s.store,i)),u,u&&u.lastId,h,h&&h.id,t,null,new mt(a,c)),n.right.integrate(e,0),n.forward()}}return o},$c=(e,t,n,r,s)=>{n.currentAttributes.forEach((d,f)=>{s[f]===void 0&&(s[f]=null)});const i=e.doc,o=i.clientID;Up(n,s);const a=Pp(e,t,n,s),c=r.constructor===String?new Be(r):r instanceof Nt?new sn(r):new Yn(r);let{left:l,right:u,index:h}=n;t._searchMarker&&vs(t._searchMarker,n.index,c.getLength()),u=new Et(G(o,St(i.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=h,n.forward(),xp(e,t,n,a)},Dp=(e,t,n,r,s)=>{const i=e.doc,o=i.clientID;Up(n,s);const a=Pp(e,t,n,s);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===mt));){if(!n.right.deleted)switch(n.right.content.constructor){case mt:{const{key:c,value:l}=n.right.content,u=s[c];if(u!==void 0){if(An(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Tn(e,G(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Et(G(o,St(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Be(c)),n.right.integrate(e,0),n.forward()}xp(e,t,n,a)},$p=(e,t,n,r,s)=>{let i=t;const o=Se();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===mt){const l=i.content;o.set(l.key,l)}i=i.right}let a=0,c=!1;for(;t!==i;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case mt:{const{key:u,value:h}=l,d=r.get(u)??null;(o.get(u)!==l||d===h)&&(t.delete(e),a++,!c&&(s.get(u)??null)===h&&d!==h&&(d===null?s.delete(u):s.set(u,d))),!c&&!t.deleted&&Cr(s,l);break}}}t=t.right}return a},rb=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===mt){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},sb=e=>{let t=0;return q(e.doc,n=>{let r=e._start,s=e._start,i=Se();const o=yc(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case mt:Cr(o,s.content);break;default:t+=$p(n,r,s,i,o),i=yc(o),r=s;break}s=s.right}}),t},ib=e=>{const t=new Set,n=e.doc;for(const[r,s]of e.afterState.entries()){const i=e.beforeState.get(r)||0;s!==i&&mp(e,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===mt&&o.constructor!==ae&&t.add(o.parent)})}q(n,r=>{Qd(e,e.deleteSet,s=>{if(s instanceof ae||!s.parent._hasFormatting||t.has(s.parent))return;const i=s.parent;s.content.constructor===mt?t.add(i):rb(r,s)});for(const s of t)sb(s)})},Fp=(e,t,n)=>{const r=n,s=yc(t.currentAttributes),i=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case sn:case Yn:case Be:n<t.right.length&&Tn(e,G(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}i&&$p(e,i,t.right,s,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&vs(o._searchMarker,t.index,-r+n),t};class ob extends Zi{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];q(t,r=>{const s=new Map,i=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},s.size>0&&(f.attributes={},s.forEach((m,_)=>{m!==null&&(f.attributes[_]=m)}))),l="";break;case"retain":u>0&&(f={retain:u},zN(c)||(f.attributes=KN({},c))),u=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case sn:case Yn:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Be:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case mt:{const{key:f,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const _=s.get(f)??null;An(_,m)?m!==null&&o.delete(r):(a==="retain"&&d(),An(m,i.get(f)??null)?delete c[f]:c[f]=m)}}else if(this.deletes(o)){i.set(f,m);const _=s.get(f)??null;An(_,m)||(a==="retain"&&d(),c[f]=_)}else if(!o.deleted){i.set(f,m);const _=c[f];_!==void 0&&(An(_,m)?_!==null&&o.delete(r):(a==="retain"&&d(),m===null?delete c[f]:c[f]=m))}o.deleted||(a==="insert"&&d(),Cr(s,o.content));break}}o=o.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Vn extends Nt{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Vn}clone(){const t=new Vn;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new ob(this,t,n);eo(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Be&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?q(this.doc,r=>{const s=new Dc(null,this._start,0,new Map);for(let i=0;i<t.length;i++){const o=t[i];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&i===t.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&$c(r,this,s,a,o.attributes||{})}else o.retain!==void 0?Dp(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&Fp(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){const s=[],i=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;i.forEach((m,_)=>{d=!0,h[_]=m});const f={insert:a};d&&(f.attributes=h),s.push(f),a=""}}const u=()=>{for(;c!==null;){if(vr(c,t)||n!==void 0&&vr(c,n))switch(c.content.constructor){case Be:{const h=i.get("ychange");t!==void 0&&!vr(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),i.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!vr(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),i.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),i.delete("ychange")),a+=c.content.str;break}case sn:case Yn:{l();const h={insert:c.content.getContent()[0]};if(i.size>0){const d={};h.attributes=d,i.forEach((f,m)=>{d[m]=f})}s.push(h);break}case mt:vr(c,t)&&(l(),Cr(i,c.content));break}c=c.right}l()};return t||n?q(o,h=>{t&&Cc(h,t),n&&Cc(h,n),u()},"cleanup"):u(),s}insert(t,n,r){if(n.length<=0)return;const s=this.doc;s!==null?q(s,i=>{const o=io(i,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),$c(i,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const s=this.doc;s!==null?q(s,i=>{const o=io(i,this,t,!r);$c(i,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?q(r,s=>{Fp(s,io(s,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const s=this.doc;s!==null?q(s,i=>{const o=io(i,this,t,!1);o.right!==null&&Dp(i,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?q(this.doc,n=>{ro(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?q(this.doc,r=>{Uc(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Pc(this,t)}getAttributes(){return Lp(this)}_write(t){t.writeTypeRef(vb)}}const ab=e=>new Vn;class Fc{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Ir||n.constructor===zn)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class zn extends Nt{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new zn}clone(){const t=new zn;return t.insert(0,this.toArray().map(n=>n instanceof Nt?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Fc(this,t)}querySelector(t){t=t.toUpperCase();const r=new Fc(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),mn(new Fc(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){eo(this,t,new ub(this,n,t))}toString(){return Np(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),Ns(this,i=>{s.insertBefore(i.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?q(this.doc,r=>{Ip(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)q(this.doc,r=>{const s=t&&t instanceof Nt?t._item:t;no(r,this,s,n)});else{const r=this._prelimContent,s=t===null?0:r.findIndex(i=>i===t)+1;if(s===0&&t!==null)throw En("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?q(this.doc,r=>{Op(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return vp(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return bp(this,t)}slice(t=0,n=this.length){return Rp(this,t,n)}forEach(t){Ns(this,t)}_write(t){t.writeTypeRef(bb)}}const cb=e=>new zn;class Ir extends zn{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new Ir(this.nodeName)}clone(){const t=new Ir(this.nodeName),n=this.getAttributes();return VN(n,(r,s)=>{typeof r=="string"&&t.setAttribute(s,r)}),t.insert(0,this.toArray().map(r=>r instanceof Nt?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const s=r.length;for(let a=0;a<s;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(t){this.doc!==null?q(this.doc,n=>{ro(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?q(this.doc,r=>{Uc(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Pc(this,t)}hasAttribute(t){return kp(this,t)}getAttributes(t){return t?Q0(this,t):Lp(this)}toDOM(t=document,n={},r){const s=t.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&s.setAttribute(o,a)}return Ns(this,o=>{s.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(Nb),t.writeKey(this.nodeName)}}const lb=e=>new Ir(e.readKey());class ub extends Zi{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class oo extends br{constructor(t){super(),this.hookName=t}_copy(){return new oo(this.hookName)}clone(){const t=new oo(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const s=n[this.hookName];let i;return s!==void 0?i=s.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(Cb),t.writeKey(this.hookName)}}const hb=e=>new oo(e.readKey());class ao extends Vn{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new ao}clone(){const t=new ao;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{const n=[];for(const s in t.attributes){const i=[];for(const o in t.attributes[s])i.push({key:o,value:t.attributes[s][o]});i.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:s,attrs:i})}n.sort((s,i)=>s.nodeName<i.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){const i=n[s];r+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){const a=i.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Ib)}}const fb=e=>new ao;class Bc{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Pe()}mergeWith(t){return!1}write(t,n,r){throw Pe()}integrate(t,n){throw Pe()}}const db=0;class ae extends Bc{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),pp(t.doc.store,this)}write(t,n){t.writeInfo(db),t.writeLen(this.length-n)}getMissing(t,n){return null}}class bs{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new bs(this.content)}splice(t){throw Pe()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const pb=e=>new bs(e.readBuf());class Cs{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Cs(this.len)}splice(t){const n=new Cs(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Yi(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const gb=e=>new Cs(e.readLen()),Bp=(e,t)=>new Ar({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Is{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Is(Bp(this.doc.guid,this.opts))}splice(t){throw Pe()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const mb=e=>new Is(Bp(e.readString(),e.readAny()));class Yn{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Yn(this.embed)}splice(t){throw Pe()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const Eb=e=>new Yn(e.readJSON());class mt{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new mt(this.key,this.value)}splice(t){throw Pe()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const _b=e=>new mt(e.readKey(),e.readJSON());class co{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new co(this.arr)}splice(t){const n=new co(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];t.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const yb=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new co(n)};class qn{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new qn(this.arr)}splice(t){const n=new qn(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];t.writeAny(i)}}getRef(){return 8}}const Tb=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new qn(n)};class Be{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Be(this.str)}splice(t){const n=new Be(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Sb=e=>new Be(e.readString()),Ab=[tb,nb,ab,lb,cb,hb,fb],wb=0,Rb=1,vb=2,Nb=3,bb=4,Cb=5,Ib=6;class sn{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new sn(this.type._copy())}splice(t){throw Pe()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const Ob=e=>new sn(Ab[e.readTypeRef()](e)),lo=(e,t,n)=>{const{client:r,clock:s}=t.id,i=new Et(G(r,s+n),t,G(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),t.redone!==null&&(i.redone=G(t.redone.client,t.redone.clock+n)),t.right=i,i.right!==null&&(i.right.left=i),e._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),t.length=n,i};class Et extends Bc{constructor(t,n,r,s,i,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Cd:0}set marker(t){(this.info&cc)>0!==t&&(this.info^=cc)}get marker(){return(this.info&cc)>0}get keep(){return(this.info&bd)>0}set keep(t){this.keep!==t&&(this.info^=bd)}get countable(){return(this.info&Cd)>0}get deleted(){return(this.info&ac)>0}set deleted(t){this.deleted!==t&&(this.info^=ac)}markDeleted(){this.info|=ac}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=St(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=St(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Rr&&this.id.client!==this.parent.client&&this.parent.clock>=St(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=gp(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Tn(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===ae||this.right&&this.right.constructor===ae)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Et&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Et&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Rr){const r=Ic(n,this.parent);r.constructor===ae?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=gp(t,t.doc.store,G(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),qi(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(qi(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(Ic(t.doc.store,s.origin)))i.has(Ic(t.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),pp(t.doc.store,this),this.content.integrate(t,this),_p(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new ae(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:G(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&qi(t.origin,this.lastId)&&this.right===t&&qi(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Yi(t.deleteSet,this.id.client,this.id.clock,this.length),_p(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw De();this.content.gc(t),n?P0(t,this,new ae(this.id,this.length)):this.content=new Cs(this.length)}write(t,n){const r=n>0?G(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&ji|(r===null?0:Xt)|(s===null?0:en)|(i===null?0:ms);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=U0(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Rr?(t.writeParentInfo(!1),t.writeLeftID(a)):De();i!==null&&t.writeString(i)}this.content.write(t,n)}}const Gp=(e,t)=>Lb[t&ji](e),Lb=[()=>{De()},gb,yb,pb,Sb,Eb,_b,Ob,Tb,mb,()=>{De()}],kb=10;class ce extends Bc{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){De()}write(t,n){t.writeInfo(kb),D(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const jp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Wp="__ $YJS$ __";jp[Wp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),jp[Wp]=!0;const Gc=0,Kp=1,Hp=2,Mb=(e,t)=>{D(e,Gc);const n=M0(t);Ot(e,n)},Vp=(e,t,n)=>{D(e,Kp),Ot(e,I0(t,n))},xb=(e,t,n)=>Vp(t,n,Dt(e)),zp=(e,t,n)=>{try{N0(t,Dt(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Ub=(e,t)=>{D(e,Hp),Ot(e,t)},Pb=zp,Db=(e,t,n,r)=>{const s=$(e);switch(s){case Gc:xb(e,t,n);break;case Kp:zp(e,n,r);break;case Hp:Pb(e,n,r);break;default:throw new Error("Unknown message type")}return s},Or={},jc={},Wc={},Os={},Ge=Ur("shared",["second"],e=>{switch(e.target){case"second":Object.keys(Wc).forEach(t=>{const n=Os[t];n===void 0?Ge.emit("shared:join",t):n<10?Os[t]=n+1:delete Os[t]}),Object.keys(jc).forEach(t=>{Ge.emit("shared:active",t)});break;case"join":{const t=e.data,n=Or[t];if(n&&jc[t]){Ge.reply(e,"joinack",t);const r=_n();Mb(r,n),Ge.reply(e,"sync",ho(t,r));const s=_n();Vp(s,n),Ge.reply(e,"sync",ho(t,s))}break}case"joinack":{const t=e.data;Or[t]&&Wc[t]&&(Os[t]=0);break}case"active":{const t=e.data;Or[t]&&Wc[t]&&(Os[t]=0);break}case"sync":{const[t,n,r]=e.data,s=Or[n];if(s&&t!==Ge.id()){const i=Kn(r),o=_n();if(Db(i,o,s,Ge)===Gc){const c=ho(n,o);Ge.emit("shared:sync",c)}}break}}});function $b(e){let t=Or[e];if(t)return t;Or[e]=t=new Ar({guid:e});function n(r){const s=_n();Ub(s,r),Ge.emit("shared:sync",ho(e,s))}return t.on("update",n),t.on("destroy",()=>{t==null||t.off("update",n)}),t}function uo(e){return $b(e).getMap()}function ho(e,t){const n=Te(t);return[Ge.id()??"",e,n]}function Yp(e,t){const n=e.get(t);return n!=null&&n.toJSON?n.toJSON():n}function qp(e,t,n){typeof n=="string"?e.set(t,new Vn(n)):e.set(t,n)}function Fb(e,t,n){jc[e]=!0;const r=uo(e);r.get(t)===void 0&&n!==void 0&&qp(r,t,n)}function Bb(e,t,n){const r=uo(e),s=Yp(r,t);(s===void 0||n!==s)&&qp(r,t,n)}function Gb(e,t,n){const r=uo(e);function s(){n(Yp(r,t))}function i(o){o.keysChanged.has(t)&&s()}return s(),r.observe(i),()=>{r.unobserve(i)}}function jb(e,t,n){const r=uo(e);let s=r.get(t);function i(){n(s)}function o(c){c.keysChanged.has(t)&&s===void 0&&a(),s&&r.unobserve(o)}function a(){s=r.get(t),s?(s.observeDeep(i),i()):r.observe(o)}return a(),()=>{s?s.unobserveDeep(i):r.unobserve(o)}}const wn={};function Xp(e,t){return e.player=t,e.layers=[],e.layout=[],e.layoutreset=!0,e.layoutfocus="scroll",e}function Jp(e){e.text=[],Object.values(wn[e.id]??{}).forEach(t=>t==null?void 0:t()),wn[e.id]={}}function Qp(e){const t=e.layout.find(n=>n.name===e.layoutfocus);if(!t){const n={id:Nn(),name:e.layoutfocus,edge:Qt.RIGHT,size:20,text:[]};return e.layout.push(n),e.layoutreset=!1,n}return t}const Kc={},Wb=new Set(["hk","hotkey","rn","range","sl","select","nm","number","tx","text"]),Kb=new Set(["rn","range","sl","select","nm","number","tx","text"]),Hb=new Set(["tx","text"]),Vb={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:""};function Xn(e){let t=Kc[e];return E(t)?t:Kc[e]=t=Xp({},e)}function zb(){return Object.keys(Kc)}function Yb(e){const t=Xn(e);t.layout=t.layout.filter(n=>n.edge!==Qt.SCROLL)}function qb(e,t,n){Object.values(wn).forEach(r=>{r[t]!==void 0&&Bb(e.id(),t,n)})}function Xb(e){const t=Xn(e.id());t.layout=t.layout.filter(n=>n.edge!==Qt.SCROLL||n.text.length>0)}function Hc(e,t,n,r,s){const i=Xn(e.id()),o=r,a=s??uN.capital(t),c=i.layout.find(l=>l.name===a);if(c)i.layoutreset=!0,i.layoutfocus=a,bt(o)&&(c.size=o);else switch(n){case Qt.START:Xp(i,e.id());break;case Qt.LEFT:case Qt.RIGHT:case Qt.TOP:case Qt.BOTTOM:case Qt.SCROLL:{const l={id:Nn(),name:a,edge:n,size:o??Yg[n],text:[]};i.layout.push(l),i.layoutfocus=a;break}}}function Jb(e,t){const n=Xn(e.id()),r=Qp(n);n.layoutreset&&(n.layoutreset=!1,Jp(r)),r.text.push(t)}function Qb(e,t,n,r){const s=Xn(e.id()),i=Qp(s);s.layoutreset&&(s.layoutreset=!1,Jp(i));const o=n.toLowerCase(),a=[e.id(),t,...Wb.has(o)?[o]:["hypertext",n],...r],c=a[2];if(Kb.has(c)){const l=`${a[3]??""}`;wn[i.id]=wn[i.id]??{};const u=e.get(l);wn[i.id][l]===void 0&&(Fb(e.id(),l,u??Vb[c]),Hb.has(c)?wn[i.id][l]=jb(e.id(),l,h=>{if(h!==void 0){const d=h.toJSON();d!==e.get(l)&&e.set(l,d)}}):wn[i.id][l]=Gb(e.id(),l,h=>{h!==void 0&&h!==e.get(l)&&e.set(l,h)}))}i.text.push(a)}const Zb=gs({get(){return[!1,void 0]},set(e,t,n){return qb(e,t,n),[!1,void 0]},shouldtick(){},tick(e){var r;const t=tt(e.id());let n="scroll";E((r=t.object)==null?void 0:r.name)&&(n=t.object.name),Hc(e,"scroll",Qt.SCROLL,void 0,n)},tock(e){Xb(e)}}).command("gadget",(e,t)=>{const n=L(e,t),[r]=C(n,0,[N.STRING]),s=zg[r.toLowerCase()];if(s===Qt.SCROLL){const[,i,o]=C(n,0,[N.STRING,N.MAYBE_STRING,N.MAYBE_NUMBER]);Hc(e,r,s,o,i)}else{const[,i,o]=C(n,0,[N.STRING,N.MAYBE_NUMBER,N.MAYBE_STRING]);Hc(e,r,s,i,o)}return 0}).command("frame",(e,t)=>{var c;const n=tt(e.id()),[r,s,i]=C(L(e,t),0,[N.STRING,N.MAYBE_STRING,N.MAYBE_STRING]),o=((c=n.board)==null?void 0:c.id)??"",a=r.toLowerCase();if(a==="reset")$f(o);else if(E(s)&&E(i))switch(s.toLowerCase()){case"edit":MR(o,a,i);break;case"view":kR(o,a,i);break}return 0}).command("text",(e,t)=>{const n=t.map(qt).join("");return Jb(e,n),0}).command("hyperlink",(e,t)=>{const[n,r,...s]=t,i=qt(n),o=qt(r);return Qb(e,i,o,s),0});function Vc(e,t){if(!(!E(e)||!E(t))){E(e.stats)||(e.stats={});for(const[n,r]of Object.entries(t)){const s=n.toLowerCase();e.stats[s]=r}}}function tC(e,t,n,r){if(E(e)&&E(t)&&E(n)){const[s,i]=n,o=Ci(e,s);if(E(o)&&E(o.name)){const a=_l(t,r,s);return E(a)&&(a.headless=!0,$s(a,i),Ha(e,t,a)),a}}}function fo(e,t,n,r){if(E(e)&&E(t)&&E(n)){const[s,i]=n,o=Mf(e,s);if(E(o)){const c=El(t,r,s);$s(c,i);const l=r.x+r.y*t.width;return Ha(e,t,c,l),c}const a=Ci(e,s);if(E(a)&&E(a.name)){const c=_l(t,r,s);return $s(c,i),bR(e,t,c),Ha(e,t,c),c}}}const Zp=new Set(["cycle","player","sender","inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu","data"]),eC=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]);function nC(e){const t=yl[e];if(E(t))return t;const n=wl[e];if(E(n))return n;const r=Uo[e];if(E(r))return r;const s=Ul[e];if(E(s))return s}const rC=["NORTH","SOUTH","WEST","EAST"];function sC(e){const t=tt(e.id??"");if(t.inputcurrent!==void 0)return;const[n=ft.NONE]=t.inputqueue;e.stats===void 0&&(e.stats={}),e.stats.inputmove=[],e.stats.inputok=0,e.stats.inputcancel=0,e.stats.inputmenu=0;const r=t.inputmods[n];switch(e.stats.inputalt=r&qg?1:0,e.stats.inputctrl=r&Xg?1:0,e.stats.inputshift=r&Jg?1:0,n){case ft.MOVE_UP:case ft.MOVE_DOWN:case ft.MOVE_LEFT:case ft.MOVE_RIGHT:e.stats.inputmove=[rC[n-ft.MOVE_UP]];break;case ft.OK_BUTTON:e.stats.inputok=1;break;case ft.CANCEL_BUTTON:e.stats.inputcancel=1;break;case ft.MENU_BUTTON:e.stats.inputmenu=1;break}t.inputcurrent=n,t.inputqueue.delete(n)}function Lr(e,t,n,r){const s=it(t)?t:t.id,i=it(t)?void 0:{x:t.x??0,y:t.y??0},o=it(n)?n:n.id,a=s??i;E(o)&&E(a)&&e.send(o,r,a)}function tg(e,t,n,r){E(n==null?void 0:n.id)?(n.headless=!0,Ii(e,t,n)):El(t,r,"empty")}function eg(e,t,n,r,s){const i=NR(t,n,r,s);if(E(i)){Lr(e,i,e.id(),"thud"),r.kind==="player"?Lr(e,e.id(),i,"touch"):r.collision===Ct.BULLET?Lr(e,e.id(),i,"shot"):Lr(e,e.id(),i,"bump");const o=Me(t,i);return(i.destructible??(o==null?void 0:o.destructible))&&tg(t,n,i,s),!1}return!0}function zc(e,t){if(it(e)){const n=e.toLowerCase();switch(n){case"edit":return[n,t+1]}}return[void 0,t]}function Yc(e,t,n){let r;const s=Oi((t==null?void 0:t.id)??"");switch(n){case"edit":{r=s.find(a=>a.type===is.EDIT);break}}const i=r?os((r==null?void 0:r.book)??""):e,o=r?ur(i,(r==null?void 0:r.board)??""):t;return{maybebook:i,maybeboard:o}}const iC=gs({get(e,t){var o;const n=nC(t);if(E(n))return[!0,n];const r=tt(e.id());if(r.object){eC.has(t)&&sC(r.object);const a=(o=r.object.stats)==null?void 0:o[t];if(E(a)||Zp.has(t))return[!0,a]}const s=r.board?Mo(r.board,r.object):void 0,i=AR(r.book,(s==null?void 0:s.id)??"",t);return[E(i),i]},set(e,t,n){var i,o;const r=tt(e.id());if(E(r.object)&&(E((o=(i=r.object)==null?void 0:i.stats)==null?void 0:o[t])||Zp.has(t)))return r.object.stats||(r.object.stats={}),r.object.stats[t]=n,[!0,n];const s=r.board?Mo(r.board,r.object):void 0;return wR(r.book,(s==null?void 0:s.id)??"",t,n),[!0,n]},shouldtick(e){var n,r,s,i,o,a;const t=tt(e.id());!E((n=t.object)==null?void 0:n.x)||!E((r=t.object)==null?void 0:r.y)||!E((i=(s=t.object)==null?void 0:s.stats)==null?void 0:i.stepx)||!E((a=(o=t.object)==null?void 0:o.stats)==null?void 0:a.stepy)||eg(e,t.book,t.board,t.object,{x:t.object.x+t.object.stats.stepx,y:t.object.y+t.object.stats.stepy})||Vc(t.object,{stepx:0,stepy:0})},tick(){},tock(e){var n;(n=tt(e.id()).object)!=null&&n.headless&&e.command("die")}}).command("become",(e,t)=>{var i,o;const n=tt(e.id()),r={x:((i=n.object)==null?void 0:i.x)??0,y:((o=n.object)==null?void 0:o.y)??0},[s]=C(L(e,t),0,[N.KIND]);return ss(n.book,n.board),Ii(n.book,n.board,n.object),Va(n.book,n.object,e.timestamp())&&fo(n.book,n.board,s,r),e.endofprogram(),0}).command("bind",()=>0).command("change",(e,t)=>{const n=tt(e.id()),[r,s]=zc(t[0],0),[i,o]=C(L(e,t),s,[N.KIND,N.KIND]),{maybebook:a,maybeboard:c}=Yc(n.book,n.board,r);ss(a,c);const l=Po(i)??"",u=Io(c,l),h=um(u,i),d=Po(o),f=Ml(o),m=xl(o);return h.forEach(_=>{if(hr(a,_)===d)E(f)&&(_.color=f),E(m)&&(_.bg=m);else{if(E(_.id))switch(Ii(a,c,_),r){case"edit":if(!ko(c,_.id))return;break;default:if(!Va(a,_,e.timestamp()))return;break}we(_)&&fo(a,c,o,_)}}),0}).command("char",(e,t)=>{const n=tt(e.id()),[r]=C(L(e,t),0,[N.NUMBER]);return E(n.object)&&(n.object.char=r),0}).command("color",(e,t)=>{const n=tt(e.id()),[r]=C(L(e,t),0,[N.COLOR]);return E(n.object)&&E(r)&&$s(n.object,r),0}).command("cycle",(e,t)=>{const[n]=C(L(e,t),0,[N.NUMBER]);return e.cycle(In(Math.round(n),1,255)),0}).command("die",e=>{var n;const t=tt(e.id());return(n=t.object)!=null&&n.headless&&Ii(t.book,t.board,t.object),Va(t.book,t.object,e.timestamp()),e.endofprogram(),0}).command("endgame",e=>(e.set("health",0),0)).command("go",(e,t)=>{const n=tt(e.id());if(!E(n.object))return 1;const[r]=C(L(e,t),0,[N.DIR]);return eg(e,n.book,n.board,n.object,r),n.object.x!==r.x&&n.object.y!==r.y?1:0}).command("put",(e,t)=>{const n=tt(e.id()),[r,s]=zc(t[0],0),[i,o]=C(L(e,t),s,[N.DIR,N.KIND]),{maybebook:a,maybeboard:c}=Yc(n.book,n.board,r);return ss(a,c),fo(a,c,o,i),0}).command("send",(e,t)=>{var h,d;const n=tt(e.id()),[r,s]=C(L(e,t),0,[N.STRING,N.ANY]),[i,o]=r.split(":"),a=E(o)?i:"self",c=o??i;function l(f){f.forEach(m=>{E(m.id)&&e.send(m.id,c,s)})}const u=a.toLowerCase();switch(u){case"all":for(const f of Object.keys(((h=n.board)==null?void 0:h.objects)??{}))e.send(f,c,s);break;case"self":e.send(e.id(),c,s);break;case"others":for(const f of Object.keys(((d=n.board)==null?void 0:d.objects)??{}))f!==e.id()&&e.send(f,c,s);break;case"player":break;default:{l(Oo(n.board,[a]));const f=e.get(u);Array.isArray(f)?l(Oo(n.board,f)):l(Oo(n.board,[f]));break}}return 0}).command("shoot",(e,t)=>{const n=tt(e.id());if(!we(n.object))return 0;const[r,s]=zc(t[0],0),[i,o]=C(L(e,t),s,[N.DIR,N.MAYBE_KIND]),{maybebook:a,maybeboard:c}=Yc(n.book,n.board,r),l=ln(n.object,i),u=Zt({x:0,y:0},l),h=Zt({x:n.object.x,y:n.object.y},l);ss(a,c);let d=gm(c,h);if(E(d)&&!E(d.id)){const f=Me(a,n.object),m=Me(a,d);gl(d.collision??(f==null?void 0:f.collision),d.collision??(m==null?void 0:m.collision))||(d=void 0)}if(E(d)){E(d.id)&&Lr(e,e.id(),d,"shot");const f=Me(a,d);(d.destructible??(f==null?void 0:f.destructible))&&tg(a,c,d,h);const m=tC(a,c,o??["bullet"],h);E(m)&&(m.collision=Ct.BULLET,Lr(e,d,e.id(),"thud"))}else{const f=fo(a,c,o??["bullet"],h);E(f)&&(f.collision=Ct.BULLET,Vc(f,{stepx:u.x,stepy:u.y}))}return e.yield(),0}).command("throwstar",(e,t)=>e.command("shoot",...t,"star")?1:0).command("try",(e,t)=>{const[,n]=C(L(e,t),0,[N.DIR]);return e.command("go",...t)&&n<t.length&&e.command(...t.slice(n)),e.yield(),0}).command("walk",(e,t)=>{const n=tt(e.id());if(!we(n.object))return 0;const[r]=C(L(e,t),0,[N.DIR]),s=ln(n.object,r),i=Zt({x:0,y:0},s);return Vc(n.object,{stepx:i.x,stepy:i.y}),0}).command("stat",(e,t)=>{const n=tt(e.id());return n.object&&(n.object.name=t.map(qt).join(" ")),0}),oC={all:rN,cli:cN,audio:sN,gadget:Zb,object:iC},aC={[Z.ERROR]:[],[Z.CLI]:["all","audio","cli"],[Z.BOARD]:["all","audio","gadget"],[Z.OBJECT]:["all","audio","object","gadget"],[Z.TERRAIN]:["all"],[Z.CHARSET]:["all"],[Z.PALETTE]:["all"]};function cC(e,t){(aC[t]??[]).forEach(r=>e.install(oC[r]))}function qc(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];Array.isArray(r)?r.forEach(s=>{t.push(qc(s))}):t.push(qc(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function lC(e){const t=Ga(`${e}
`);if(t.errors.length>0)return{errors:t.errors,tokens:[]};ds.input=t.tokens;const n=ds.program();if(ds.errors.length>0)return{tokens:t.tokens,errors:ds.errors};const r=zv.visit(n);return r?(qc(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:["no ast output"]}}const Xc=Object.getPrototypeOf(function*(){}).constructor;function uC(e){const t=lC(e);if(t.errors&&t.errors.length>0)return t;if(!t.ast)return{...t,errors:["no ast output"]};const n=Zv(t.ast);if(n.code){fR&&console.info(n.code);try{return{...t,...n,source:n.code,code:new Xc("api",n.code)}}catch(r){return{errors:[{message:r.message}],source:"there was an error",code:new Xc("api"," ")}}}return{...t,...n,source:"there was an error",code:new Xc("api"," ")}}function hC(){const e={},t={};function n(s){const i=e[s];if(i)return i;const o=uC(s);return e[s]=o,o}const r={ids(){return Object.keys(t)},has(s){return E(t[s])},halt(s){const i=t[s];return i&&delete t[s],!!i},tick(s,i,o,a){var l;let c=t[s];if(!E(t[s])){const u=n(a);if((l=u.errors)!=null&&l.length)return Zn("os","build",JSON.stringify(u.errors),""),!1;c=t[s]=nN(s,u),cC(c,i)}return!!(c!=null&&c.tick(o))},once(s,i,o,a){return r.tick(s,i,o,a)&&r.halt(s)},message(s){const{target:i,path:o}=ol(s.target),a=t[i];E(a)&&a.message({...s,target:o})}};return r}const fC=il(Eo.numbers,4),dC=il(`${Eo.numbers}${Eo.lowercase}`,16),Jc=`pid_${fC()}_${dC()}`;LR(Jc);const Qc=hC();let Zc=0;const pC=32,kr={},on=Ur("vm",["tick","second"],e=>{switch(e.target){case"mem":e.player===Jc&&(UR(e.data),$t(on.name(),"ackmem",e.player),on.emit("ackmem",void 0,e.player));break;case"login":e.player&&DR(e.player)&&(kr[e.player]=0,$t(on.name(),"acklogin",e.player),on.emit("acklogin",void 0,e.player));break;case"doot":e.player&&(kr[e.player]=0,bo(on.name(),e.player,"active"),on.emit("doot",void 0,e.player));break;case"input":if(e.player){const t=tt(e.player),[n=ft.NONE,r=0]=e.data??{};t.inputqueue.add(n),t.inputmods[n]=r}break;case"tick":Zc=e.data??0,FR(Qc,Zc);break;case"second":Object.keys(kr).forEach(t=>{++kr[t],kr[t]>=pC&&(delete kr[t],$R(t),$t(on.name(),"logout",t),on.emit("logout",void 0,t))});break;case"cli":BR(Qc,Zc,e.player??"",e.data??"");break;default:Qc.message(e);break}});function gC(){on.emit("ready",void 0,Jc)}const tl=Ur("clock",[],()=>{});let el=0,ng=performance.now(),nl=0,po=0;function mC(){tl.emit("tick",po),tl.emit("tock",po),++nl,++po,nl>=Fo&&(nl%=Fo,tl.emit("second",po))}function rg(){const e=performance.now(),t=e-ng;el+=t,el>=$o&&(el%=$o,mC()),ng=e,setTimeout(rg)}rg();const sg={},ig=Ur("gadgetserver",["tock"],e=>{switch(e.target){case"tock":zb().forEach(t=>{const n=Xn(t);n.layers=jR(t);const r=No(sg[t]??{},n);r.length&&(sg[t]=kt(n),Zg(ig.name(),r,t))});break;case"desync":if(e.player){const t=Xn(e.player);Qg(ig.name(),t,e.player)}break;case"clearscroll":e.player&&Yb(e.player);break}}),EC=_g(e=>postMessage(e));onmessage=function(t){EC(t.data)},queueMicrotask(gC)})();

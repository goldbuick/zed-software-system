var uL=Object.defineProperty;var hL=(lr,en,Be)=>en in lr?uL(lr,en,{enumerable:!0,configurable:!0,writable:!0,value:Be}):lr[en]=Be;var bt=(lr,en,Be)=>hL(lr,typeof en!="symbol"?en+"":en,Be);(function(){"use strict";const lr=new Set,en={emit(e,t,n,r,i){en.invoke(G_(e,t,n,r,i))},invoke(e){switch(e.target){}lr.forEach(t=>t.handle(e))},connect(e){lr.add(e)},disconnect(e){lr.delete(e)}};var Be=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ni(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function h_(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var lf={};(function(e){var t=Be&&Be.__spreadArray||function(u,l,h){if(h||arguments.length===2)for(var d=0,f=l.length,p;d<f;d++)(p||!(d in l))&&(p||(p=Array.prototype.slice.call(l,0,d)),p[d]=l[d]);return u.concat(p||Array.prototype.slice.call(l))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(u){return u[Math.floor(Math.random()*u.length)]}function r(u){return u.reduce(function(l,h){return l.length>h.length?l:h})}function i(u){return u.reduce(function(l,h){return l.length<h.length?l:h})}function s(u){u===void 0&&(u={}),typeof u=="string"&&(u={separator:u}),typeof u=="boolean"&&(u={capitalize:u});var l=u.separator,h=l===void 0?"":l,d=u.capitalize,f=d===void 0?!0:d,p=u.adjectiveCount,m=p===void 0?1:p,b=u.addAdverb,_=b===void 0?!1:b,w=t(t(t([],t([],Array(m),!0).map(function(E){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),_?[n(e.adverbs)]:[],!0);return f&&(w=w.map(function(E){return E.charAt(0).toUpperCase()+E.substr(1)})),w.join(h)}e.humanId=s;function o(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,d=u.addAdverb,f=d===void 0?!1:d;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(f?e.adverbs.length:1)}e.poolSize=o;function a(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,d=u.addAdverb,f=d===void 0?!1:d,p=u.separator,m=p===void 0?"":p;return r(e.adjectives).length*h+h*m.length+r(e.nouns).length+m.length+r(e.verbs).length+(f?r(e.adverbs).length+m.length:0)}e.maxLength=a;function c(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,d=u.addAdverb,f=d===void 0?!1:d,p=u.separator,m=p===void 0?"":p;return i(e.adjectives).length*h+h*m.length+i(e.nouns).length+m.length+i(e.verbs).length+(f?i(e.adverbs).length+m.length:0)}e.minLength=c,e.default=s})(lf);var f_=Ni(lf);const d_="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let p_=e=>crypto.getRandomValues(new Uint8Array(e)),m_=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},uf=(e,t=21)=>m_(e,t,p_),g_=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=d_[n[e]&63];return t};var hf="abcdefghijklmnopqrstuvwxyz",ff="ABCDEFGHIJKLMNOPQRSTUVWXYZ",df="0123456789",y_="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",__="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const b_=df,w_=hf,v_=ff;var E_=b_+w_+v_,zc={lowercase:hf,uppercase:ff,numbers:df,nolookalikes:y_,nolookalikesSafe:__,alphanumeric:E_};function ie(){return`sid_${g_(12).replaceAll("-",".")}`}uf(zc.numbers,4),uf(`${zc.numbers}${zc.lowercase}`,16);function pf(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function k_(){return f_({capitalize:!1,adjectiveCount:1})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var S_=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),A_=Object.prototype.hasOwnProperty;function Wc(e,t){return A_.call(e,t)}function Hc(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)Wc(e,i)&&r.push(i);return r}function Ve(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Gc(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function ei(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function mf(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Vc(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Vc(e[t]))return!0}else if(typeof e=="object"){for(var r=Hc(e),i=r.length,s=0;s<i;s++)if(Vc(e[r[s]]))return!0}}return!1}function gf(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var yf=function(e){S_(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,gf(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=gf(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),se=yf,x_=Ve,Li={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Ro(n,this.path);r&&(r=Ve(r));var i=ni(n,{op:"remove",path:this.from}).removed;return ni(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Ro(n,this.from);return ni(n,{op:"add",path:this.path,value:Ve(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:ds(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},T_={add:function(e,t,n){return Gc(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Li.move,copy:Li.copy,test:Li.test,_get:Li._get};function Ro(e,t){if(t=="")return e;var n={op:"_get",path:t};return ni(e,n),n.value}function ni(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Io(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Ro(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=ds(e,t.value),o.test===!1)throw new se("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new se("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=Ve(e));var a=t.path||"",c=a.split("/"),u=e,l=1,h=c.length,d=void 0,f=void 0,p=void 0;for(typeof n=="function"?p=n:p=Io;;){if(f=c[l],f&&f.indexOf("~")!=-1&&(f=mf(f)),i&&(f=="__proto__"||f=="prototype"&&l>0&&c[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(u[f]===void 0?d=c.slice(0,l).join("/"):l==h-1&&(d=t.path),d!==void 0&&p(t,0,e,d)),l++,Array.isArray(u)){if(f==="-")f=u.length;else{if(n&&!Gc(f))throw new se("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Gc(f)&&(f=~~f)}if(l>=h){if(n&&t.op==="add"&&f>u.length)throw new se("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=T_[t.op].call(t,u,f,e);if(o.test===!1)throw new se("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(l>=h){var o=Li[t.op].call(t,u,f,e);if(o.test===!1)throw new se("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(u=u[f],n&&l<h&&(!u||typeof u!="object"))throw new se("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Kc(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new se("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Ve(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=ni(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function R_(e,t,n){var r=ni(e,t);if(r.test===!1)throw new se("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Io(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new se("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Li[e.op]){if(typeof e.path!="string")throw new se("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new se('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new se("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new se("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Vc(e.value))throw new se("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new se("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new se("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=_f([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new se("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new se("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function _f(e,t,n){try{if(!Array.isArray(e))throw new se("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Kc(Ve(t),Ve(e),n||!0);else{n=n||Io;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof se)return i;throw i}}function ds(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!ds(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!ds(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var I_=Object.freeze({__proto__:null,JsonPatchError:se,_areEquals:ds,applyOperation:ni,applyPatch:Kc,applyReducer:R_,deepClone:x_,getValueByPointer:Ro,validate:_f,validator:Io});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var qc=new WeakMap,O_=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),C_=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function N_(e){return qc.get(e)}function L_(e,t){return e.observers.get(t)}function M_(e,t){e.observers.delete(t.callback)}function U_(e,t){t.unobserve()}function P_(e,t){var n=[],r,i=N_(e);if(!i)i=new O_(e),qc.set(e,i);else{var s=L_(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=Ve(e),t){r.callback=t,r.next=null;var o=function(){Xc(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){Xc(r),clearTimeout(r.next),M_(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new C_(t,r)),r}function Xc(e,t){t===void 0&&(t=!1);var n=qc.get(e.object);Zc(n.value,e.object,e.patches,"",t),e.patches.length&&Kc(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Zc(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=Hc(t),o=Hc(e),a=!1,c=o.length-1;c>=0;c--){var u=o[c],l=e[u];if(Wc(t,u)&&!(t[u]===void 0&&l!==void 0&&Array.isArray(t)===!1)){var h=t[u];typeof l=="object"&&l!=null&&typeof h=="object"&&h!=null&&Array.isArray(l)===Array.isArray(h)?Zc(l,h,n,r+"/"+ei(u),i):l!==h&&(i&&n.push({op:"test",path:r+"/"+ei(u),value:Ve(l)}),n.push({op:"replace",path:r+"/"+ei(u),value:Ve(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+ei(u),value:Ve(l)}),n.push({op:"remove",path:r+"/"+ei(u)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var u=s[c];!Wc(e,u)&&t[u]!==void 0&&n.push({op:"add",path:r+"/"+ei(u),value:Ve(t[u])})}}}function bf(e,t,n){n===void 0&&(n=!1);var r=[];return Zc(e,t,r,"",n),r}var D_=Object.freeze({__proto__:null,compare:bf,generate:Xc,observe:P_,unobserve:U_});Object.assign({},I_,D_,{JsonPatchError:yf,deepClone:Ve,escapePathComponent:ei,unescapePathComponent:mf});var B_=typeof Element<"u",F_=typeof Map=="function",$_=typeof Set=="function",j_=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Oo(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Oo(e[r],t[r]))return!1;return!0}var s;if(F_&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Oo(r.value[1],t.get(r.value[0])))return!1;return!0}if($_&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(j_&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(B_&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Oo(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var z_=function(t,n){try{return Oo(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},W_=Ni(z_);function v(e){return e!=null}const H_=Object.keys;function ur(e){return Ve(e)}function St(e){return typeof e=="number"&&isNaN(e)===!1}function vt(e){return typeof e=="string"}function Ht(e){return Array.isArray(e)}function wf(e){return e}var Tt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(Tt||{}),Kt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(Kt||{}),Co=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Co||{}),ct=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e))(ct||{}),ft=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.LINK=11]="LINK",e[e.HOTKEY=12]="HOTKEY",e[e.SCROLL=13]="SCROLL",e[e.COPYIT=14]="COPYIT",e))(ft||{});function Ct(e){return e.toLowerCase().trim()}function G_(e,t,n,r,i){return{session:e,id:ie(),target:t,sender:n,data:r,player:i}}function vf(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Mi(e,t=[],n=wf,r=""){const i=ie(),s=Ct(e),o=t.map(Ct);let a=r;const c={id(){return i},name(){return e},session(u){return v(u)?u.session===a?u.session:"":a},topics(){return t},emit(u,l,h){en.emit(a,u,i,l,h)},reply(u,l,h,d){c.emit(`${u.sender}:${l}`,h,d)},handle(u){const{target:l,path:h}=vf(u.target),d=Ct(l);!a&&d==="ready"&&(a=u.session),o.findIndex(f=>f==="all"||f===d)!==-1&&n(u),(i===l||d==="all"||s===d)&&n({...u,target:h})}};return en.connect(c),c}function V_(e){return v(e)&&typeof e=="object"&&vt(e.id)&&vt(e.target)&&vt(e.sender)}function K_(e){const t=new Set;function n(s){V_(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),en.invoke(s))}const r=Mi("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){en.disconnect(r)}return{forward:n,disconnect:i}}const Jc=66.666,No=Math.round(1e3/Jc),q_=3;function X_(){return location.href.includes("/join/")}function Z_(){return location.href.includes("/locked/")}const Yc=Mi("clock",[],()=>{});let Qc=0,Lo=0,tl=0,Ef=performance.now();function kf(){const e=performance.now(),t=e-Ef,n=Z_()?"locked":"";tl+=t,tl>=Jc&&(tl%=Jc,Yc.emit("tick",Lo,n),Yc.emit("tock",Lo,n),++Qc,++Lo,Qc>=No&&(Qc%=No,Yc.emit("second",Lo,n))),Ef=e,setTimeout(kf,1)}kf();var Sf={exports:{}};/*! Case - v1.6.2 - 2020-03-24
* Copyright (c) 2020 Nathan Bubna; Licensed MIT, GPL */(function(e){(function(){var t=function(f,p){return p=p||"",f.replace(/(^|-)/g,"$1\\u"+p).replace(/,/g,"\\u"+p)},n=t("20-26,28-2F,3A-40,5B-60,7B-7E,A0-BF,D7,F7","00"),r="a-z"+t("DF-F6,F8-FF","00"),i="A-Z"+t("C0-D6,D8-DE","00"),s="A|An|And|As|At|But|By|En|For|If|In|Of|On|Or|The|To|Vs?\\.?|Via",o=function(f,p,m,b){return f=f||n,p=p||r,m=m||i,b=b||s,{capitalize:new RegExp("(^|["+f+"])(["+p+"])","g"),pascal:new RegExp("(^|["+f+"])+(["+p+m+"])","g"),fill:new RegExp("["+f+"]+(.|$)","g"),sentence:new RegExp('(^\\s*|[\\?\\!\\.]+"?\\s+"?|,\\s+")(['+p+"])","g"),improper:new RegExp("\\b("+b+")\\b","g"),relax:new RegExp("([^"+m+"])(["+m+"]*)(["+m+"])(?=[^"+m+"]|$)","g"),upper:new RegExp("^[^"+p+"]+$"),hole:/[^\s]\s[^\s]/,apostrophe:/'/g,room:new RegExp("["+f+"]")}},a=o(),c={re:a,unicodes:t,regexps:o,types:[],up:String.prototype.toUpperCase,low:String.prototype.toLowerCase,cap:function(f){return c.up.call(f.charAt(0))+f.slice(1)},decap:function(f){return c.low.call(f.charAt(0))+f.slice(1)},deapostrophe:function(f){return f.replace(a.apostrophe,"")},fill:function(f,p,m){return p!=null&&(f=f.replace(a.fill,function(b,_){return _?p+_:""})),m&&(f=c.deapostrophe(f)),f},prep:function(f,p,m,b){if(f=f==null?"":f+"",!b&&a.upper.test(f)&&(f=c.low.call(f)),!p&&!a.hole.test(f)){var _=c.fill(f," ");a.hole.test(_)&&(f=_)}return!m&&!a.room.test(f)&&(f=f.replace(a.relax,c.relax)),f},relax:function(f,p,m,b){return p+" "+(m?m+" ":"")+b}},u={_:c,of:function(f){for(var p=0,m=c.types.length;p<m;p++)if(u[c.types[p]].apply(u,arguments)===f)return c.types[p]},flip:function(f){return f.replace(/\w/g,function(p){return(p==c.up.call(p)?c.low:c.up).call(p)})},random:function(f){return f.replace(/\w/g,function(p){return(Math.round(Math.random())?c.up:c.low).call(p)})},type:function(f,p){u[f]=p,c.types.push(f)}},l={lower:function(f,p,m){return c.fill(c.low.call(c.prep(f,p)),p,m)},snake:function(f){return u.lower(f,"_",!0)},constant:function(f){return u.upper(f,"_",!0)},camel:function(f){return c.decap(u.pascal(f))},kebab:function(f){return u.lower(f,"-",!0)},upper:function(f,p,m){return c.fill(c.up.call(c.prep(f,p,!1,!0)),p,m)},capital:function(f,p,m){return c.fill(c.prep(f).replace(a.capitalize,function(b,_,w){return _+c.up.call(w)}),p,m)},header:function(f){return u.capital(f,"-",!0)},pascal:function(f){return c.fill(c.prep(f,!1,!0).replace(a.pascal,function(p,m,b){return c.up.call(b)}),"",!0)},title:function(f){return u.capital(f).replace(a.improper,function(p,m,b,_){return b>0&&b<_.lastIndexOf(" ")?c.low.call(p):p})},sentence:function(f,p,m){return f=u.lower(f).replace(a.sentence,function(b,_,w){return _+c.up.call(w)}),p&&p.forEach(function(b){f=f.replace(new RegExp("\\b"+u.lower(b)+"\\b","g"),c.cap)}),m&&m.forEach(function(b){f=f.replace(new RegExp("(\\b"+u.lower(b)+"\\. +)(\\w)"),function(_,w,E){return w+c.low.call(E)})}),f}};l.squish=l.pascal,u.default=u;for(var h in l)u.type(h,l[h]);var d=typeof d=="function"?d:function(){};d(e.exports?e.exports=u:this.Case=u)}).call(Be)})(Sf);var J_=Sf.exports,Y_=Ni(J_);function ps(){return ps=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ps.apply(this,arguments)}function Q_(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,el(e,t)}function el(e,t){return el=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},el(e,t)}function tb(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Af=function(){function e(n){this.trigger=n,this.observing=new Map}var t=e.prototype;return t.registerConnection=function(r){var i=this.observing.get(r.observable);i||(i={byKey:new Set,iterate:!1},this.observing.set(r.observable,i)),r.type==="iterate"?i.iterate=!0:i.byKey.add(r.key)},t.removeObservers=function(){var r=this;this.observing.forEach(function(i,s){i.iterate&&s[_e].connections.iterate.delete(r),i.byKey.forEach(function(o){s[_e].connections.byKey.get(o).delete(r)})}),this.observing.clear()},e}(),ri=[],Mo=function(e){Q_(t,e);function t(r,i,s){var o;if(o=e.call(this,function(){return o._trigger()})||this,o.func=r,o.options=i,o.effect=s,o.isInitial=!0,o.reaction=function(){ri.push(tb(o));try{o.func()}finally{ri.pop()}o.effect&&(!o.isInitial||o.options.fireImmediately)&&o.effect(),o.isInitial=!1},!s&&!o.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return o.reaction(),o}var n=t.prototype;return n._trigger=function(){if(ri.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},t}(Af);function xf(){return!!ri.length}function Tf(){return ri.length?ri[ri.length-1]:void 0}function eb(e,t,n){var r=ps({name:"unnamed",fireImmediately:!0},n),i=new Mo(e,r,t);return i}var Uo=0;function Rf(){return Uo>0}function nl(e){Uo++;try{return e()}finally{Uo--,Uo===0&&rb()}}var rl=!1;function If(){return rl}function Of(e){rl=!0;try{e()}finally{rl=!1}}function nb(e){return function(){return Of(e)}}var il=[];function rb(){var e=[].concat(il);il=[],Cf(e)}function Cf(e){var t=new Set;e.forEach(function(n){var r;(n.type==="add"||n.type==="delete")&&n.observable[_e].connections.iterate.forEach(function(i){t.add(i)}),(r=n.observable[_e].connections.byKey.get(n.key))==null||r.forEach(function(i){t.add(i)})}),t.forEach(function(n){n.trigger()})}function Po(e){if(Rf()){il.push(e);return}Cf([e])}function Nf(e,t){if(e.type==="iterate")e.observable[_e].connections.iterate.add(t);else{var n=e.observable[_e].connections.byKey.get(e.key);n||(n=new Set,e.observable[_e].connections.byKey.set(e.key,n)),n.add(t)}}function Do(e,t){if(!If()){var n=Tf();n&&(Nf(e,n),n.registerConnection(e)),t&&(Nf(e,t),t.registerConnection(e))}}var sl=Symbol("$skipreactive"),_e=Symbol("$reactive"),hn=Symbol("$reactiveproxy");function ms(e,t){return!!(e&&e[hn]&&e[hn].implicitObserver===t)}function ol(e){return e[sl]=!0,e}function Lf(e){return!!(e&&!ms(e)&&e[_e])}function al(e,t,n){if(n===void 0&&(n=!1),e[sl]||ms(e,t))return e;var r=ib(e,n);if(!t)return r;var i=r[_e].proxiesWithImplicitObserver.get(t);if(!i){var s={implicitObserver:t};Object.setPrototypeOf(s,Mf),i=new Proxy(r[_e].raw,s),r[_e].proxiesWithImplicitObserver.set(t,i)}return i}var gs=al;function ib(e,t){if(t===void 0&&(t=!1),ms(e))return e;if(Lf(e))return e[_e].proxy;if(e[_e]||e[hn])throw new Error("unexpected");var n={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:e,proxiesWithImplicitObserver:new Map,shallow:t};Object.defineProperty(e,_e,{enumerable:!1,writable:!0,configurable:!0,value:n});var r=new Proxy(e,Mf);return n.proxy=r,r}var Mf={has:function(t,n){var r=Reflect.has(t,n);return typeof n=="symbol"||Do({observable:t,key:n,type:"has"},this.implicitObserver),r},get:function(t,n,r){if(n===hn)return{implicitObserver:this.implicitObserver};var i=Reflect.get(t,n,r);if(typeof n=="symbol")return n.toString()==="Symbol($reactiveproxy)"&&console.error("warning, Symbol($reactiveproxy) passed, but does not match $reactiveproxy. Multiple Reactive libraries loaded?"),i;if(n==="length"&&Array.isArray(t)?Do({observable:t,type:"iterate"},this.implicitObserver):Do({observable:t,key:n,type:"get"},this.implicitObserver),Lf(i))return al(i,this.implicitObserver);if(t[_e].shallow)return i;if(typeof i=="object"&&i!==null&&!ms(i,this.implicitObserver)&&!Object.isFrozen(i)){var s=Reflect.getOwnPropertyDescriptor(t,n);if((!s||!(s.writable===!1&&s.configurable===!1))&&(xf()||this.implicitObserver))return al(i,this.implicitObserver)}return i},ownKeys:function(t){return Do({observable:t,type:"iterate"},this.implicitObserver),Reflect.ownKeys(t)},set:function(t,n,r,i){return nl(function(){if(typeof n=="symbol")return Reflect.set(t,n,r,i);var s=Object.hasOwnProperty.call(t,n),o=Reflect.get(t,n,i),a=Reflect.set(t,n,r,i);if(!s)Po({observable:t,key:n,value:r,type:"add"});else if(r!==o)if(n==="length"&&Array.isArray(t)){if(!(o<r))for(var c=r+1;c<=o;c++)Po({observable:t,key:""+(c-1),oldValue:void 0,type:"delete"})}else Po({observable:t,key:n,value:r,oldValue:o,type:"update"});return a})},deleteProperty:function(t,n){return nl(function(){if(typeof n=="symbol")return Reflect.deleteProperty(t,n);var r=Object.hasOwnProperty.call(t,n),i=Reflect.get(t,n),s=Reflect.deleteProperty(t,n);return r&&Po({observable:t,key:n,oldValue:i,type:"delete"}),s})},preventExtensions:function(t){throw new Error("Dynamic observable objects cannot be frozen")}};function sb(e,t){var n=ps({name:"unnamed",fireImmediately:!0},t),r=new Mo(e,n);return r}function ob(e,t,n){var r=ps({name:"unnamed",fireImmediately:!0},n),i=new Mo(function(){e(t)},r);return t=gs(t,i),r.fireImmediately&&i.trigger(),i}var Uf=function(){function e(){this._observable=gs({_key:1})}var t=e.prototype;return t.reportObserved=function(r){return gs(this._observable,r)._key},t.reportChanged=function(){this._observable._key++},e}();function ab(e,t,n){return new Uf}var cb=Object.freeze({__proto__:null,$reactive:_e,$reactiveproxy:hn,$skipreactive:sl,Atom:Uf,Observer:Af,Reaction:Mo,autorun:sb,autorunAsync:ob,createAtom:ab,hasRunningReaction:xf,isActionRunning:Rf,isReactive:ms,isTrackingDisabled:If,markRaw:ol,reaction:eb,reactive:gs,runInAction:nl,runningReaction:Tf,untracked:Of,untrackedCB:nb});const Rn=()=>new Map,cl=e=>{const t=Rn();return e.forEach((n,r)=>{t.set(r,n)}),t},Lr=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},lb=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},ub=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},Ui=()=>new Set,ll=e=>e[e.length-1],hb=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Mr=Array.from,fb=Array.isArray;class db{constructor(){this._observers=Rn()}on(t,n){return Lr(this._observers,t,Ui).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Mr((this._observers.get(t)||Rn()).values()).forEach(r=>r(...n))}destroy(){this._observers=Rn()}}const Ur=Math.floor,Bo=Math.abs,Pf=(e,t)=>e<t?e:t,ii=(e,t)=>e>t?e:t,Df=e=>e!==0?e<0:1/e<0,Bf=1,Ff=2,ul=4,hl=8,ys=32,hr=64,nn=128,Fo=31,fl=63,si=127,pb=2147483647,$f=Number.MAX_SAFE_INTEGER,mb=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Ur(e)===e),gb=e=>e.toLowerCase(),yb=/^\s*/g,_b=e=>e.replace(yb,""),bb=/([A-Z])/g,jf=(e,t)=>_b(e.replace(bb,n=>`${t}${gb(n)}`)),wb=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},_s=typeof TextEncoder<"u"?new TextEncoder:null,vb=_s?e=>_s.encode(e):wb;let bs=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});bs&&bs.decode(new Uint8Array).length===1&&(bs=null);class ws{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Pr=()=>new ws,Eb=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},In=e=>{const t=new Uint8Array(Eb(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},kb=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(ii(n,t)*2),e.cpos=0)},Ae=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},dl=Ae,At=(e,t)=>{for(;t>si;)Ae(e,nn|si&t),t=Ur(t/128);Ae(e,si&t)},pl=(e,t)=>{const n=Df(t);for(n&&(t=-t),Ae(e,(t>fl?nn:0)|(n?hr:0)|fl&t),t=Ur(t/64);t>0;)Ae(e,(t>si?nn:0)|si&t),t=Ur(t/128)},ml=new Uint8Array(3e4),Sb=ml.length/3,Ab=(e,t)=>{if(t.length<Sb){const n=_s.encodeInto(t,ml).written||0;At(e,n);for(let r=0;r<n;r++)Ae(e,ml[r])}else Me(e,vb(t))},xb=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;At(e,r);for(let i=0;i<r;i++)Ae(e,n.codePointAt(i))},Pi=_s&&_s.encodeInto?Ab:xb,$o=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=Pf(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(ii(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},Me=(e,t)=>{At(e,t.byteLength),$o(e,t)},gl=(e,t)=>{kb(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},Tb=(e,t)=>gl(e,4).setFloat32(0,t,!1),Rb=(e,t)=>gl(e,8).setFloat64(0,t,!1),Ib=(e,t)=>gl(e,8).setBigInt64(0,t,!1),zf=new DataView(new ArrayBuffer(4)),Ob=e=>(zf.setFloat32(0,e),zf.getFloat32(0)===e),vs=(e,t)=>{switch(typeof t){case"string":Ae(e,119),Pi(e,t);break;case"number":mb(t)&&Bo(t)<=pb?(Ae(e,125),pl(e,t)):Ob(t)?(Ae(e,124),Tb(e,t)):(Ae(e,123),Rb(e,t));break;case"bigint":Ae(e,122),Ib(e,t);break;case"object":if(t===null)Ae(e,126);else if(fb(t)){Ae(e,117),At(e,t.length);for(let n=0;n<t.length;n++)vs(e,t[n])}else if(t instanceof Uint8Array)Ae(e,116),Me(e,t);else{Ae(e,118);const n=Object.keys(t);At(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Pi(e,i),vs(e,t[i])}}break;case"boolean":Ae(e,t?120:121);break;default:Ae(e,127)}};class Wf extends ws{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&At(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Hf=e=>{e.count>0&&(pl(e.encoder,e.count===1?e.s:-e.s),e.count>1&&At(e.encoder,e.count-2))};class jo{constructor(){this.encoder=new ws,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Hf(this),this.count=1,this.s=t)}toUint8Array(){return Hf(this),In(this.encoder)}}const Gf=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);pl(e.encoder,t),e.count>1&&At(e.encoder,e.count-2)}};class yl{constructor(){this.encoder=new ws,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Gf(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Gf(this),In(this.encoder)}}class Cb{constructor(){this.sarr=[],this.s="",this.lensE=new jo}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new ws;return this.sarr.push(this.s),this.s="",Pi(t,this.sarr.join("")),$o(t,this.lensE.toUint8Array()),In(t)}}const Dr=e=>new Error(e),jn=()=>{throw Dr("Method unimplemented")},zn=()=>{throw Dr("Unexpected case")},Vf=Dr("Unexpected end of array"),Kf=Dr("Integer out of Range");class zo{constructor(t){this.arr=t,this.pos=0}}const oi=e=>new zo(e),Nb=e=>e.pos!==e.arr.length,Lb=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Fe=e=>Lb(e,xt(e)),Di=e=>e.arr[e.pos++],xt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&si)*n,n*=128,i<nn)return t;if(t>$f)throw Kf}throw Vf},_l=e=>{let t=e.arr[e.pos++],n=t&fl,r=64;const i=(t&hr)>0?-1:1;if(!(t&nn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&si)*r,r*=128,t<nn)return i*n;if(n>$f)throw Kf}throw Vf},Bi=bs?e=>bs.decode(Fe(e)):e=>{let t=xt(e);if(t===0)return"";{let n=String.fromCodePoint(Di(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Di(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},bl=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Mb=[e=>{},e=>null,_l,e=>bl(e,4).getFloat32(0,!1),e=>bl(e,8).getFloat64(0,!1),e=>bl(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Bi,e=>{const t=xt(e),n={};for(let r=0;r<t;r++){const i=Bi(e);n[i]=Es(e)}return n},e=>{const t=xt(e),n=[];for(let r=0;r<t;r++)n.push(Es(e));return n},Fe],Es=e=>Mb[127-Di(e)](e);class qf extends zo{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Nb(this)?this.count=xt(this)+1:this.count=-1),this.count--,this.s}}class Wo extends zo{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=_l(this);const t=Df(this.s);this.count=1,t&&(this.s=-this.s,this.count=xt(this)+2)}return this.count--,this.s}}class wl extends zo{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=_l(this),n=t&1;this.diff=Ur(t/2),this.count=1,n&&(this.count=xt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Ub{constructor(t){this.decoder=new Wo(t),this.str=Bi(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const Pb=crypto.getRandomValues.bind(crypto),Xf=()=>Pb(new Uint32Array(1))[0],Db="10000000-1000-4000-8000"+-1e11,Bb=()=>Db.replace(/[018]/g,e=>(e^Xf()&15>>e/4).toString(16)),Zf=e=>new Promise(e);Promise.all.bind(Promise);const Jf=e=>e===void 0?null:e;class Fb{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let Yf=new Fb,$b=!0;try{typeof localStorage<"u"&&localStorage&&(Yf=localStorage,$b=!1)}catch{}const jb=Yf,zb=Object.assign,Wb=Object.keys,Hb=(e,t)=>{for(const n in e)t(e[n],n)},Qf=e=>Wb(e).length,Gb=e=>{for(const t in e)return!1;return!0},Vb=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Kb=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),qb=(e,t)=>e===t||Qf(e)===Qf(t)&&Vb(e,(n,r)=>(n!==void 0||Kb(t,r))&&t[r]===n),Xb=Object.freeze,td=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&td(e[t])}return Xb(e)},vl=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&vl(e,t,n+1)}},Zb=e=>e,Jb=(e,t)=>t.includes(e);var ed={};const ks=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Wn;const Yb=()=>{if(Wn===void 0)if(ks){Wn=Rn();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Wn.set(t,""),t=r):t!==null&&(Wn.set(t,r),t=null)}t!==null&&Wn.set(t,"")}else typeof location=="object"?(Wn=Rn(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Wn.set(`--${jf(t,"-")}`,n),Wn.set(`-${jf(t,"-")}`,n)}})):Wn=Rn();return Wn},El=e=>Yb().has(e),Ho=e=>Jf(ks?ed[e.toUpperCase().replaceAll("-","_")]:jb.getItem(e)),nd=e=>El("--"+e)||Ho(e)!==null;nd("production");const Qb=ks&&Jb(ed.FORCE_COLOR,["true","1","2"])||!El("--no-colors")&&!nd("no-color")&&(!ks||process.stdout.isTTY)&&(!ks||El("--color")||Ho("COLORTERM")!==null||(Ho("TERM")||"").includes("color")),tw=e=>new Uint8Array(e),ew=e=>{const t=tw(e.byteLength);return t.set(e),t};class nw{constructor(t,n){this.left=t,this.right=n}}const fr=(e,t)=>new nw(e,t);typeof DOMParser<"u"&&new DOMParser;const rw=e=>lb(e,(t,n)=>`${n}:${t};`).join(""),dr=Symbol,rd=dr(),id=dr(),iw=dr(),sw=dr(),ow=dr(),sd=dr(),aw=dr(),kl=dr(),cw=dr(),lw=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},uw={[rd]:fr("font-weight","bold"),[id]:fr("font-weight","normal"),[iw]:fr("color","blue"),[ow]:fr("color","green"),[sw]:fr("color","grey"),[sd]:fr("color","red"),[aw]:fr("color","purple"),[kl]:fr("color","orange"),[cw]:fr("color","black")},od=Qb?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=Rn();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=uw[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=rw(r);s>0||u.length>0?(t.push("%c"+a),n.push(u)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:lw,hw=(...e)=>{console.log(...od(e)),ad.forEach(t=>t.print(e))},fw=(...e)=>{console.warn(...od(e)),e.unshift(kl),ad.forEach(t=>t.print(e))},ad=Ui(),cd=e=>({[Symbol.iterator](){return this},next:e}),dw=(e,t)=>cd(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Sl=(e,t)=>cd(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Al{constructor(t,n){this.clock=t,this.len=n}}class Ss{constructor(){this.clients=new Map}}const ld=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];Td(e,s,a.clock,a.len,n)}}),pw=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Ur((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},ud=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&pw(n,t.clock)!==null},xl=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=ii(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},mw=e=>{const t=new Ss;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)hb(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return xl(t),t},Go=(e,t,n,r)=>{Lr(e.clients,t,()=>[]).push(new Al(n,r))},gw=()=>new Ss,yw=e=>{const t=gw();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let u=n[s+1];s+1<n.length&&u.deleted;u=n[++s+1])c+=u.length;i.push(new Al(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Fi=(e,t)=>{At(e.restEncoder,t.clients.size),Mr(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),At(e.restEncoder,n);const i=r.length;At(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Tl=e=>{const t=new Ss,n=xt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=xt(e.restDecoder),s=xt(e.restDecoder);if(s>0){const o=Lr(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Al(e.readDsClock(),e.readDsLen()))}}return t},hd=(e,t,n)=>{const r=new Ss,i=xt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=xt(e.restDecoder),a=xt(e.restDecoder),c=n.clients.get(o)||[],u=xe(n,o);for(let l=0;l<a;l++){const h=e.readDsClock(),d=h+e.readDsLen();if(h<u){u<d&&Go(r,o,u,d-u);let f=On(c,h),p=c[f];for(!p.deleted&&p.id.clock<h&&(c.splice(f+1,0,ia(t,p,h-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(f,0,ia(t,p,d-p.id.clock)),p.delete(t))}else Go(r,o,h,d-h)}}if(r.clients.size>0){const s=new ai;return At(s.restEncoder,0),Fi(s,r),s.toUint8Array()}return null},fd=Xf;class pr extends db{constructor({guid:t=Bb(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=fd(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Sd,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Zf(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const c=()=>Zf(u=>{const l=h=>{(h===void 0||h===!0)&&(this.off("sync",l),u())};this.on("sync",l)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&qt(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Mr(this.subdocs).map(t=>t.guid))}transact(t,n=null){return qt(this,t,n)}get(t,n=oe){const r=Lr(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==oe&&i!==n)if(i===oe){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Hn)}getText(t=""){return this.get(t,Cn)}getMap(t=""){return this.get(t,Gn)}getXmlElement(t=""){return this.get(t,mr)}getXmlFragment(t=""){return this.get(t,Vn)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Mr(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new pr({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,qt(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class dd{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return xt(this.restDecoder)}readDsLen(){return xt(this.restDecoder)}}class pd extends dd{readLeftID(){return Nt(xt(this.restDecoder),xt(this.restDecoder))}readRightID(){return Nt(xt(this.restDecoder),xt(this.restDecoder))}readClient(){return xt(this.restDecoder)}readInfo(){return Di(this.restDecoder)}readString(){return Bi(this.restDecoder)}readParentInfo(){return xt(this.restDecoder)===1}readTypeRef(){return xt(this.restDecoder)}readLen(){return xt(this.restDecoder)}readAny(){return Es(this.restDecoder)}readBuf(){return ew(Fe(this.restDecoder))}readJSON(){return JSON.parse(Bi(this.restDecoder))}readKey(){return Bi(this.restDecoder)}}class _w{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=xt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=xt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class $i extends _w{constructor(t){super(t),this.keys=[],xt(t),this.keyClockDecoder=new wl(Fe(t)),this.clientDecoder=new Wo(Fe(t)),this.leftClockDecoder=new wl(Fe(t)),this.rightClockDecoder=new wl(Fe(t)),this.infoDecoder=new qf(Fe(t),Di),this.stringDecoder=new Ub(Fe(t)),this.parentInfoDecoder=new qf(Fe(t),Di),this.typeRefDecoder=new Wo(Fe(t)),this.lenDecoder=new Wo(Fe(t))}readLeftID(){return new ji(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ji(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Es(this.restDecoder)}readBuf(){return Fe(this.restDecoder)}readJSON(){return Es(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class md{constructor(){this.restEncoder=Pr()}toUint8Array(){return In(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){At(this.restEncoder,t)}writeDsLen(t){At(this.restEncoder,t)}}class As extends md{writeLeftID(t){At(this.restEncoder,t.client),At(this.restEncoder,t.clock)}writeRightID(t){At(this.restEncoder,t.client),At(this.restEncoder,t.clock)}writeClient(t){At(this.restEncoder,t)}writeInfo(t){dl(this.restEncoder,t)}writeString(t){Pi(this.restEncoder,t)}writeParentInfo(t){At(this.restEncoder,t?1:0)}writeTypeRef(t){At(this.restEncoder,t)}writeLen(t){At(this.restEncoder,t)}writeAny(t){vs(this.restEncoder,t)}writeBuf(t){Me(this.restEncoder,t)}writeJSON(t){Pi(this.restEncoder,JSON.stringify(t))}writeKey(t){Pi(this.restEncoder,t)}}class gd{constructor(){this.restEncoder=Pr(),this.dsCurrVal=0}toUint8Array(){return In(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,At(this.restEncoder,n)}writeDsLen(t){t===0&&zn(),At(this.restEncoder,t-1),this.dsCurrVal+=t}}class ai extends gd{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new yl,this.clientEncoder=new jo,this.leftClockEncoder=new yl,this.rightClockEncoder=new yl,this.infoEncoder=new Wf(dl),this.stringEncoder=new Cb,this.parentInfoEncoder=new Wf(dl),this.typeRefEncoder=new jo,this.lenEncoder=new jo}toUint8Array(){const t=Pr();return At(t,0),Me(t,this.keyClockEncoder.toUint8Array()),Me(t,this.clientEncoder.toUint8Array()),Me(t,this.leftClockEncoder.toUint8Array()),Me(t,this.rightClockEncoder.toUint8Array()),Me(t,In(this.infoEncoder)),Me(t,this.stringEncoder.toUint8Array()),Me(t,In(this.parentInfoEncoder)),Me(t,this.typeRefEncoder.toUint8Array()),Me(t,this.lenEncoder.toUint8Array()),$o(t,In(this.restEncoder)),In(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){vs(this.restEncoder,t)}writeBuf(t){Me(this.restEncoder,t)}writeJSON(t){vs(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const bw=(e,t,n,r)=>{r=ii(r,t[0].id.clock);const i=On(t,r);At(e.restEncoder,t.length-i),e.writeClient(n),At(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},Rl=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{xe(t,s)>i&&r.set(s,i)}),Ko(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),At(e.restEncoder,r.size),Mr(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{bw(e,t.clients.get(i),i,s)})},ww=(e,t)=>{const n=Rn(),r=xt(e.restDecoder);for(let i=0;i<r;i++){const s=xt(e.restDecoder),o=new Array(s),a=e.readClient();let c=xt(e.restDecoder);n.set(a,{i:0,refs:o});for(let u=0;u<s;u++){const l=e.readInfo();switch(Fo&l){case 0:{const h=e.readLen();o[u]=new rn(Nt(a,c),h),c+=h;break}case 10:{const h=xt(e.restDecoder);o[u]=new fn(Nt(a,c),h),c+=h;break}default:{const h=(l&(hr|nn))===0,d=new we(Nt(a,c),null,(l&nn)===nn?e.readLeftID():null,null,(l&hr)===hr?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(l&ys)===ys?e.readString():null,Yd(e,l));o[u]=d,c+=d.length}}}}return n},vw=(e,t,n)=>{const r=[];let i=Mr(n.keys()).sort((f,p)=>f-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=n.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=n.get(i[i.length-1]);else return null;return f};let o=s();if(o===null)return null;const a=new Sd,c=new Map,u=(f,p)=>{const m=c.get(f);(m==null||m>p)&&c.set(f,p)};let l=o.refs[o.i++];const h=new Map,d=()=>{for(const f of r){const p=f.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[f]),i=i.filter(b=>b!==p)}r.length=0};for(;;){if(l.constructor!==fn){const p=Lr(h,l.id.client,()=>xe(t,l.id.client))-l.id.clock;if(p<0)r.push(l),u(l.id.client,l.id.clock-1),d();else{const m=l.getMissing(e,t);if(m!==null){r.push(l);const b=n.get(m)||{refs:[],i:0};if(b.refs.length===b.i)u(m,xe(t,m)),d();else{l=b.refs[b.i++];continue}}else(p===0||p<l.length)&&(l.integrate(e,p),h.set(l.id.client,l.id.clock+l.length))}}if(r.length>0)l=r.pop();else if(o!==null&&o.i<o.refs.length)l=o.refs[o.i++];else{if(o=s(),o===null)break;l=o.refs[o.i++]}}if(a.clients.size>0){const f=new ai;return Rl(f,a,new Map),At(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},Ew=(e,t)=>Rl(e,t.doc.store,t.beforeState),kw=(e,t,n,r=new $i(e))=>qt(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=ww(r,o),u=vw(i,a,c),l=a.pendingStructs;if(l){for(const[d,f]of l.missing)if(f<xe(a,d)){s=!0;break}if(u){for(const[d,f]of u.missing){const p=l.missing.get(d);(p==null||p>f)&&l.missing.set(d,f)}l.update=Xo([l.update,u.update])}}else a.pendingStructs=u;const h=hd(r,i,a);if(a.pendingDs){const d=new $i(oi(a.pendingDs));xt(d.restDecoder);const f=hd(d,i,a);h&&f?a.pendingDs=Xo([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,yd(i.doc,d)}},n,!1),yd=(e,t,n,r=$i)=>{const i=oi(t);kw(i,e,n,new r(i))},Sw=(e,t,n)=>yd(e,t,n,pd),Aw=(e,t,n=new Map)=>{Rl(e,t.store,n),Fi(e,yw(t.store))},xw=(e,t=new Uint8Array([0]),n=new ai)=>{const r=_d(t);Aw(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(jw(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===As)return Fw(i.map((s,o)=>o===0?s:Ww(s)));if(n.constructor===ai)return Xo(i)}return i[0]},Tw=(e,t)=>xw(e,t,new As),Rw=e=>{const t=new Map,n=xt(e.restDecoder);for(let r=0;r<n;r++){const i=xt(e.restDecoder),s=xt(e.restDecoder);t.set(i,s)}return t},_d=e=>Rw(new dd(oi(e))),bd=(e,t)=>(At(e.restEncoder,t.size),Mr(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{At(e.restEncoder,n),At(e.restEncoder,r)}),e),Iw=(e,t)=>bd(e,Ko(t.store)),Ow=(e,t=new gd)=>(e instanceof Map?bd(t,e):Iw(t,e),t.toUint8Array()),Cw=e=>Ow(e,new md);class Nw{constructor(){this.l=[]}}const wd=()=>new Nw,vd=(e,t)=>e.l.push(t),Ed=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},kd=(e,t,n)=>vl(e.l,[t,n]);class ji{constructor(t,n){this.client=t,this.clock=n}}const Vo=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,Nt=(e,t)=>new ji(e,t),Lw=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw zn()},zi=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!ud(t.ds,e.id),Il=(e,t)=>{const n=Lr(e.meta,Il,Ui),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<xe(r,s)&&Br(e,Nt(s,i))}),ld(e,t.ds,i=>{}),n.add(t))};class Sd{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ko=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},xe=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Ad=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw zn()}n.push(t)},On=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=Ur(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=Ur((n+r)/2)}throw zn()},Ol=(e,t)=>{const n=e.clients.get(t.client);return n[On(n,t.clock)]},Cl=(e,t,n)=>{const r=On(t,n),i=t[r];return i.id.clock<n&&i instanceof we?(t.splice(r+1,0,ia(e,i,n-i.id.clock)),r+1):r},Br=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Cl(e,n,t.clock)]},xd=(e,t,n)=>{const r=t.clients.get(n.client),i=On(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==rn&&r.splice(i+1,0,ia(e,s,n.clock-s.id.clock+1)),s},Mw=(e,t,n)=>{const r=e.clients.get(t.id.client);r[On(r,t.id.clock)]=n},Td=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=Cl(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&Cl(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class Uw{constructor(t,n,r){this.doc=t,this.deleteSet=new Ss,this.beforeState=Ko(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Rd=(e,t)=>t.deleteSet.clients.size===0&&!ub(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(xl(t.deleteSet),Ew(e,t),Fi(e,t.deleteSet),!0),Id=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Lr(e.changed,t,Ui).add(n)},qo=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof we&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},Pw=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let u=On(s,a.clock),l=s[u];u<s.length&&l.id.clock<c;l=s[++u]){const h=s[u];if(a.clock+a.len<=h.id.clock)break;h instanceof we&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},Dw=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Pf(i.length-1,1+On(i,o.clock+o.len-1));for(let c=a,u=i[c];c>0&&u.id.clock>=o.clock;u=i[c])c-=1+qo(i,c)}})},Od=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{xl(s),n.afterState=Ko(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u,l._path=null}),c.sort((l,h)=>l.path.length-h.path.length),kd(u._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),vl(a,[]),n._needFormattingCleanup&&rv(n)}finally{r.gc&&Pw(s,i,r.gcFilter),Dw(s,i),n.afterState.forEach((l,h)=>{const d=n.beforeState.get(h)||0;if(d!==l){const f=i.clients.get(h),p=ii(On(f,d),1);for(let m=f.length-1;m>=p;)m-=1+qo(f,m)}});for(let l=o.length-1;l>=0;l--){const{client:h,clock:d}=o[l].id,f=i.clients.get(h),p=On(f,d);p+1<f.length&&qo(f,p+1)>1||p>0&&qo(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(hw(kl,rd,"[yjs] ",id,sd,"Changed the client-id because another client seems to be using it."),r.clientID=fd()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const l=new As;Rd(l,n)&&r.emit("update",[l.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const l=new ai;Rd(l,n)&&r.emit("updateV2",[l.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:u}=n;(a.size>0||u.size>0||c.size>0)&&(a.forEach(l=>{l.clientID=r.clientID,l.collectionid==null&&(l.collectionid=r.collectionid),r.subdocs.add(l)}),u.forEach(l=>r.subdocs.delete(l)),r.emit("subdocs",[{loaded:c,added:a,removed:u},r,n]),u.forEach(l=>l.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Od(e,t+1)}}},qt=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new Uw(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&Od(i,0)}}return o};function*Bw(e){const t=xt(e.restDecoder);for(let n=0;n<t;n++){const r=xt(e.restDecoder),i=e.readClient();let s=xt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=xt(e.restDecoder);yield new fn(Nt(i,s),c),s+=c}else if(Fo&a){const c=(a&(hr|nn))===0,u=new we(Nt(i,s),null,(a&nn)===nn?e.readLeftID():null,null,(a&hr)===hr?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&ys)===ys?e.readString():null,Yd(e,a));yield u,s+=u.length}else{const c=e.readLen();yield new rn(Nt(i,s),c),s+=c}}}}class Nl{constructor(t,n){this.gen=Bw(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===fn);return this.curr}}class Ll{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Fw=e=>Xo(e,pd,As),$w=(e,t)=>{if(e.constructor===rn){const{client:n,clock:r}=e.id;return new rn(Nt(n,r+t),e.length-t)}else if(e.constructor===fn){const{client:n,clock:r}=e.id;return new fn(Nt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new we(Nt(r,i+t),null,Nt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Xo=(e,t=$i,n=ai)=>{if(e.length===1)return e[0];const r=e.map(l=>new t(oi(l)));let i=r.map(l=>new Nl(l,!0)),s=null;const o=new n,a=new Ll(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const p=d.curr.id.clock-f.curr.id.clock;return p===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===fn?1:-1:p}else return f.curr.id.client-d.curr.id.client}),i.length!==0;){const l=i[0],h=l.curr.id.client;if(s!==null){let d=l.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=l.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Fr(a,s.struct,s.offset),s={struct:d,offset:0},l.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===fn)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Fr(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new fn(Nt(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===fn?s.struct.length-=p:d=$w(d,p)),s.struct.mergeWith(d)||(Fr(a,s.struct,s.offset),s={struct:d,offset:0},l.next())}}else s={struct:l.curr,offset:0},l.next();for(let d=l.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==fn;d=l.next())Fr(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Fr(a,s.struct,s.offset),s=null),Ml(a);const c=r.map(l=>Tl(l)),u=mw(c);return Fi(o,u),o.toUint8Array()},jw=(e,t,n=$i,r=ai)=>{const i=_d(t),s=new r,o=new Ll(s),a=new n(oi(e)),c=new Nl(a,!1);for(;c.curr;){const l=c.curr,h=l.id.client,d=i.get(h)||0;if(c.curr.constructor===fn){c.next();continue}if(l.id.clock+l.length>d)for(Fr(o,l,ii(d-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Fr(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}Ml(o);const u=Tl(a);return Fi(s,u),s.toUint8Array()},Cd=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:In(e.encoder.restEncoder)}),e.encoder.restEncoder=Pr(),e.written=0)},Fr=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Cd(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),At(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Ml=e=>{Cd(e);const t=e.encoder.restEncoder;At(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];At(t,r.written),$o(t,r.restEncoder)}},zw=(e,t,n,r)=>{const i=new n(oi(e)),s=new Nl(i,!1),o=new r,a=new Ll(o);for(let u=s.curr;u!==null;u=s.next())Fr(a,t(u),0);Ml(a);const c=Tl(i);return Fi(o,c),o.toUint8Array()},Ww=e=>zw(e,Zb,$i,As),Nd="You must not compute changes after the event-handler fired.";class Zo{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Hw(this.currentTarget,this.target))}deletes(t){return ud(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Dr(Nd);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=ll(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=ll(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=ll(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Dr(Nd);const n=this.target,r=Ui(),i=Ui(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=u.length,i.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const Hw=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},Ue=()=>{fw("Invalid access: Add Yjs type to a document before reading data.")},Ld=80;let Ul=0;class Gw{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Ul++}}const Vw=e=>{e.timestamp=Ul++},Md=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Ul++},Kw=(e,t,n)=>{if(e.length>=Ld){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Md(r,t,n),r}else{const r=new Gw(t,n);return e.push(r),r}},Jo=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Bo(t-s.index)<Bo(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,Vw(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Bo(n.index-i)<r.parent.length/Ld?(Md(n,r,i),n):Kw(e._searchMarker,r,i)},xs=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=ii(t,i.index+n))}},Yo=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;Lr(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;kd(r._eH,n,t)};class oe{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=wd(),this._dEH=wd(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw jn()}clone(){throw jn()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){vd(this._eH,t)}observeDeep(t){vd(this._dEH,t)}unobserve(t){Ed(this._eH,t)}unobserveDeep(t){Ed(this._dEH,t)}toJSON(){}}const Ud=(e,t,n)=>{e.doc??Ue(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},Pd=e=>{e.doc??Ue();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Ts=(e,t)=>{let n=0,r=e._start;for(e.doc??Ue();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},Dd=(e,t)=>{const n=[];return Ts(e,(r,i)=>{n.push(t(r,i,e))}),n},qw=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},Bd=(e,t)=>{e.doc??Ue();const n=Jo(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Qo=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let u=[];const l=()=>{u.length>0&&(i=new we(Nt(o,xe(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ui(u)),i.integrate(e,0),u=[])};r.forEach(h=>{if(h===null)u.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(h);break;default:switch(l(),h.constructor){case Uint8Array:case ArrayBuffer:i=new we(Nt(o,xe(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Rs(new Uint8Array(h))),i.integrate(e,0);break;case pr:i=new we(Nt(o,xe(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Os(h)),i.integrate(e,0);break;default:if(h instanceof oe)i=new we(Nt(o,xe(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new gr(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},Fd=()=>Dr("Length exceeded!"),$d=(e,t,n,r)=>{if(n>t._length)throw Fd();if(n===0)return t._searchMarker&&xs(t._searchMarker,n,r.length),Qo(e,t,null,r);const i=n,s=Jo(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Br(e,Nt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&xs(t._searchMarker,i,r.length),Qo(e,t,o,r)},Xw=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Qo(e,t,i,n)},jd=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=Jo(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Br(e,Nt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Br(e,Nt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw Fd();t._searchMarker&&xs(t._searchMarker,i,-s+r)},ta=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Pl=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new ui([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ui([r]);break;case Uint8Array:a=new Rs(r);break;case pr:a=new Os(r);break;default:if(r instanceof oe)a=new gr(r);else throw new Error("Unexpected content type")}new we(Nt(o,xe(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},Dl=(e,t)=>{e.doc??Ue();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},zd=e=>{const t={};return e.doc??Ue(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Wd=(e,t)=>{e.doc??Ue();const n=e._map.get(t);return n!==void 0&&!n.deleted},Zw=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&zi(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},ea=e=>(e.doc??Ue(),dw(e._map.entries(),t=>!t[1].deleted));class Jw extends Zo{}class Hn extends oe{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Hn;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Hn}clone(){const t=new Hn;return t.insert(0,this.toArray().map(n=>n instanceof oe?n.clone():n)),t}get length(){return this.doc??Ue(),this._length}_callObserver(t,n){super._callObserver(t,n),Yo(this,t,new Jw(this,t))}insert(t,n){this.doc!==null?qt(this.doc,r=>{$d(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?qt(this.doc,n=>{Xw(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?qt(this.doc,r=>{jd(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Bd(this,t)}toArray(){return Pd(this)}slice(t=0,n=this.length){return Ud(this,t,n)}toJSON(){return this.map(t=>t instanceof oe?t.toJSON():t)}map(t){return Dd(this,t)}forEach(t){Ts(this,t)}[Symbol.iterator](){return qw(this)}_write(t){t.writeTypeRef(Ev)}}const Yw=e=>new Hn;class Qw extends Zo{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Gn extends oe{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Gn}clone(){const t=new Gn;return this.forEach((n,r)=>{t.set(r,n instanceof oe?n.clone():n)}),t}_callObserver(t,n){Yo(this,t,new Qw(this,t,n))}toJSON(){this.doc??Ue();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof oe?i.toJSON():i}}),t}get size(){return[...ea(this)].length}keys(){return Sl(ea(this),t=>t[0])}values(){return Sl(ea(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Sl(ea(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??Ue(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?qt(this.doc,n=>{ta(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?qt(this.doc,r=>{Pl(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Dl(this,t)}has(t){return Wd(this,t)}clear(){this.doc!==null?qt(this.doc,t=>{this.forEach(function(n,r,i){ta(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(kv)}}const tv=e=>new Gn,$r=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&qb(e,t);class Bl{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&zn(),this.right.content.constructor){case be:this.right.deleted||Wi(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Hd=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case be:t.right.deleted||Wi(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Br(e,Nt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},na=(e,t,n,r)=>{const i=new Map,s=r?Jo(t,n):null;if(s){const o=new Bl(s.p.left,s.p,s.index,i);return Hd(e,o,n-s.index)}else{const o=new Bl(null,t._start,0,i);return Hd(e,o,n)}},Gd=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===be&&$r(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,u=n.right,l=new we(Nt(s,xe(i.store,s)),c,c&&c.lastId,u,u&&u.id,t,null,new be(a,o));l.integrate(e,0),n.right=l,n.forward()})},Wi=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Vd=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===be&&$r(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Kd=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],u=n.currentAttributes.get(a)??null;if(!$r(u,c)){o.set(a,u);const{left:l,right:h}=n;n.right=new we(Nt(s,xe(i.store,s)),l,l&&l.lastId,h,h&&h.id,t,null,new be(a,c)),n.right.integrate(e,0),n.forward()}}return o},Fl=(e,t,n,r,i)=>{n.currentAttributes.forEach((d,f)=>{i[f]===void 0&&(i[f]=null)});const s=e.doc,o=s.clientID;Vd(n,i);const a=Kd(e,t,n,i),c=r.constructor===String?new Kn(r):r instanceof oe?new gr(r):new li(r);let{left:u,right:l,index:h}=n;t._searchMarker&&xs(t._searchMarker,n.index,c.getLength()),l=new we(Nt(o,xe(s.store,o)),u,u&&u.lastId,l,l&&l.id,t,null,c),l.integrate(e,0),n.right=l,n.index=h,n.forward(),Gd(e,t,n,a)},qd=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;Vd(n,i);const a=Kd(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===be));){if(!n.right.deleted)switch(n.right.content.constructor){case be:{const{key:c,value:u}=n.right.content,l=i[c];if(l!==void 0){if($r(l,u))a.delete(c);else{if(r===0)break t;a.set(c,u)}n.right.delete(e)}else n.currentAttributes.set(c,u);break}default:r<n.right.length&&Br(e,Nt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new we(Nt(o,xe(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Kn(c)),n.right.integrate(e,0),n.forward()}Gd(e,t,n,a)},Xd=(e,t,n,r,i)=>{let s=t;const o=Rn();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===be){const u=s.content;o.set(u.key,u)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const u=t.content;switch(u.constructor){case be:{const{key:l,value:h}=u,d=r.get(l)??null;(o.get(l)!==u||d===h)&&(t.delete(e),a++,!c&&(i.get(l)??null)===h&&d!==h&&(d===null?i.delete(l):i.set(l,d))),!c&&!t.deleted&&Wi(i,u);break}}}t=t.right}return a},ev=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===be){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},nv=e=>{let t=0;return qt(e.doc,n=>{let r=e._start,i=e._start,s=Rn();const o=cl(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case be:Wi(o,i.content);break;default:t+=Xd(n,r,i,s,o),s=cl(o),r=i;break}i=i.right}}),t},rv=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&Td(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===be&&o.constructor!==rn&&t.add(o.parent)})}qt(n,r=>{ld(e,e.deleteSet,i=>{if(i instanceof rn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===be?t.add(s):ev(r,i)});for(const i of t)nv(i)})},Zd=(e,t,n)=>{const r=n,i=cl(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case gr:case li:case Kn:n<t.right.length&&Br(e,Nt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&Xd(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&xs(o._searchMarker,t.index,-r+n),t};class iv extends Zo{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];qt(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let u="",l=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof u=="object"||u.length>0)&&(f={insert:u},i.size>0&&(f.attributes={},i.forEach((p,m)=>{p!==null&&(f.attributes[m]=p)}))),u="";break;case"retain":l>0&&(f={retain:l},Gb(c)||(f.attributes=zb({},c))),l=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case gr:case li:this.adds(o)?this.deletes(o)||(d(),a="insert",u=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),l+=1);break;case Kn:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),l+=o.length);break;case be:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(f)??null;$r(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),$r(p,s.get(f)??null)?delete c[f]:c[f]=p)}}else if(this.deletes(o)){s.set(f,p);const m=i.get(f)??null;$r(m,p)||(a==="retain"&&d(),c[f]=m)}else if(!o.deleted){s.set(f,p);const m=c[f];m!==void 0&&($r(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[f]:c[f]=p))}o.deleted||(a==="insert"&&d(),Wi(i,o.content));break}}o=o.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Cn extends oe{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Ue(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Cn}clone(){const t=new Cn;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new iv(this,t,n);Yo(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??Ue();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Kn&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?qt(this.doc,r=>{const i=new Bl(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Fl(r,this,i,a,o.attributes||{})}else o.retain!==void 0?qd(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Zd(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??Ue();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function u(){if(a.length>0){const h={};let d=!1;s.forEach((p,m)=>{d=!0,h[m]=p});const f={insert:a};d&&(f.attributes=h),i.push(f),a=""}}const l=()=>{for(;c!==null;){if(zi(c,t)||n!==void 0&&zi(c,n))switch(c.content.constructor){case Kn:{const h=s.get("ychange");t!==void 0&&!zi(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(u(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!zi(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(u(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(u(),s.delete("ychange")),a+=c.content.str;break}case gr:case li:{u();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((f,p)=>{d[p]=f})}i.push(h);break}case be:zi(c,t)&&(u(),Wi(s,c.content));break}c=c.right}u()};return t||n?qt(o,h=>{t&&Il(h,t),n&&Il(h,n),l()},"cleanup"):l(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?qt(i,s=>{const o=na(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Fl(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?qt(i,s=>{const o=na(s,this,t,!r);Fl(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?qt(r,i=>{Zd(i,na(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?qt(i,s=>{const o=na(s,this,t,!1);o.right!==null&&qd(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?qt(this.doc,n=>{ta(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?qt(this.doc,r=>{Pl(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Dl(this,t)}getAttributes(){return zd(this)}_write(t){t.writeTypeRef(Sv)}}const sv=e=>new Cn;class $l{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??Ue()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===mr||n.constructor===Vn)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Vn extends oe{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Vn}clone(){const t=new Vn;return t.insert(0,this.toArray().map(n=>n instanceof oe?n.clone():n)),t}get length(){return this.doc??Ue(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new $l(this,t)}querySelector(t){t=t.toUpperCase();const r=new $l(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Mr(new $l(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Yo(this,t,new cv(this,n,t))}toString(){return Dd(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Ts(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?qt(this.doc,r=>{$d(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)qt(this.doc,r=>{const i=t&&t instanceof oe?t._item:t;Qo(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Dr("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?qt(this.doc,r=>{jd(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Pd(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Bd(this,t)}slice(t=0,n=this.length){return Ud(this,t,n)}forEach(t){Ts(this,t)}_write(t){t.writeTypeRef(xv)}}const ov=e=>new Vn;class mr extends Vn{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new mr(this.nodeName)}clone(){const t=new mr(this.nodeName),n=this.getAttributes();return Hb(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof oe?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?qt(this.doc,n=>{ta(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?qt(this.doc,r=>{Pl(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Dl(this,t)}hasAttribute(t){return Wd(this,t)}getAttributes(t){return t?Zw(this,t):zd(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Ts(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(Av),t.writeKey(this.nodeName)}}const av=e=>new mr(e.readKey());class cv extends Zo{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Hi extends Gn{constructor(t){super(),this.hookName=t}_copy(){return new Hi(this.hookName)}clone(){const t=new Hi(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(Tv),t.writeKey(this.hookName)}}const lv=e=>new Hi(e.readKey());class ci extends Cn{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new ci}clone(){const t=new ci;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Rv)}}const uv=e=>new ci;class jl{constructor(t,n){this.id=t,this.length=n}get deleted(){throw jn()}mergeWith(t){return!1}write(t,n,r){throw jn()}integrate(t,n){throw jn()}}const hv=0;class rn extends jl{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Ad(t.doc.store,this)}write(t,n){t.writeInfo(hv),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Rs{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Rs(this.content)}splice(t){throw jn()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const fv=e=>new Rs(e.readBuf());class Is{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Is(this.len)}splice(t){const n=new Is(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Go(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const dv=e=>new Is(e.readLen()),Jd=(e,t)=>new pr({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Os{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Os(Jd(this.doc.guid,this.opts))}splice(t){throw jn()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const pv=e=>new Os(Jd(e.readString(),e.readAny()));class li{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new li(this.embed)}splice(t){throw jn()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const mv=e=>new li(e.readJSON());class be{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new be(this.key,this.value)}splice(t){throw jn()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const gv=e=>new be(e.readKey(),e.readJSON());class ra{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ra(this.arr)}splice(t){const n=new ra(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const yv=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new ra(n)},_v=Ho("node_env")==="development";class ui{constructor(t){this.arr=t,_v&&td(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ui(this.arr)}splice(t){const n=new ui(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const bv=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new ui(n)};class Kn{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Kn(this.str)}splice(t){const n=new Kn(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const wv=e=>new Kn(e.readString()),vv=[Yw,tv,sv,av,ov,lv,uv],Ev=0,kv=1,Sv=2,Av=3,xv=4,Tv=5,Rv=6;class gr{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new gr(this.type._copy())}splice(t){throw jn()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const Iv=e=>new gr(vv[e.readTypeRef()](e)),ia=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new we(Nt(r,i+n),t,Nt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=Nt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class we extends jl{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Ff:0}set marker(t){(this.info&hl)>0!==t&&(this.info^=hl)}get marker(){return(this.info&hl)>0}get keep(){return(this.info&Bf)>0}set keep(t){this.keep!==t&&(this.info^=Bf)}get countable(){return(this.info&Ff)>0}get deleted(){return(this.info&ul)>0}set deleted(t){this.deleted!==t&&(this.info^=ul)}markDeleted(){this.info|=ul}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=xe(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=xe(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ji&&this.id.client!==this.parent.client&&this.parent.clock>=xe(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=xd(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Br(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===rn||this.right&&this.right.constructor===rn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===we&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===we&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===ji){const r=Ol(n,this.parent);r.constructor===rn?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=xd(t,t.doc.store,Nt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Vo(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Vo(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Ol(t.doc.store,i.origin)))s.has(Ol(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ad(t.doc.store,this),this.content.integrate(t,this),Id(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new rn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:Nt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Vo(t.origin,this.lastId)&&this.right===t&&Vo(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Go(t.deleteSet,this.id.client,this.id.clock,this.length),Id(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw zn();this.content.gc(t),n?Mw(t,this,new rn(this.id,this.length)):this.content=new Is(this.length)}write(t,n){const r=n>0?Nt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Fo|(r===null?0:nn)|(i===null?0:hr)|(s===null?0:ys);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const u=Lw(a);t.writeParentInfo(!0),t.writeString(u)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===ji?(t.writeParentInfo(!1),t.writeLeftID(a)):zn();s!==null&&t.writeString(s)}this.content.write(t,n)}}const Yd=(e,t)=>Ov[t&Fo](e),Ov=[()=>{zn()},dv,yv,fv,wv,mv,gv,Iv,bv,pv,()=>{zn()}],Cv=10;class fn extends jl{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){zn()}write(t,n){t.writeInfo(Cv),At(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const Qd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},tp="__ $YJS$ __";Qd[tp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Qd[tp]=!0;let zl,Wl,Nv=e=>e();function Lv(e,t){if(Wl)return Wl(e,t);Nv(e)}function hi(e,t,n){if(zl)return zl.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function Mv(e){zl=function(t,n,r){const i=e.createAtom(t);return n&&n(),i},Wl=(t,n)=>e.reaction(t,n,{fireImmediately:!1})}const ep=new WeakSet;function Uv(e){if(ep.has(e))return e;ep.add(e);let t;const n=new Map;function r(){if(!t){const h=d=>{(d.changes.added.size||d.changes.deleted.size||d.changes.keys.size||d.changes.delta.length)&&t.reportChanged()};t=hi("map",()=>{e.observe(h)},()=>{e.unobserve(h)})}t.reportObserved(e._implicitObserver)}function i(h){let d=n.get(h);if(!d){const f=p=>{d.reportChanged()};d=hi(h+"",()=>{e.observe(f)},()=>{e.unobserve(f)}),n.set(h,d)}d.reportObserved(e._implicitObserver)}const s=e.get;e.get=function(h){if(typeof h!="number")throw new Error("unexpected");return i(h),Reflect.apply(s,this,arguments)};function o(h){const d=e[h];e[h]=function(){return r(),Reflect.apply(d,this,arguments)}}function a(h){let d=e,f=Object.getOwnPropertyDescriptor(d,h);if(f||(d=Object.getPrototypeOf(d),f=Object.getOwnPropertyDescriptor(d,h)),f||(d=Object.getPrototypeOf(d),f=Object.getOwnPropertyDescriptor(d,h)),!f)throw new Error("property not found");const p=f.get;f.get=function(){return this._disableTracking||r(),Reflect.apply(p,this,arguments)},Object.defineProperty(e,h,f)}function c(h,d){let f=e,p=Object.getOwnPropertyDescriptor(f,h);if(p||(f=Object.getPrototypeOf(f),p=Object.getOwnPropertyDescriptor(f,h)),p||(f=Object.getPrototypeOf(f),p=Object.getOwnPropertyDescriptor(f,h)),!p)throw new Error("property not found");Object.defineProperty(e,d,p)}o("forEach"),o("toJSON"),o("toArray"),o("slice"),o("map"),c("length","lengthUntracked"),a("length");const u=e.push;e.push=function(h){this._disableTracking=!0;const d=u.call(this,h);return this._disableTracking=!1,d};const l=e.slice;return e.slice=function(h,d){this._disableTracking=!0;const f=l.call(this,h,d);return this._disableTracking=!1,f},e}const np=new WeakSet;function Pv(e){if(np.has(e))return e;np.add(e);let t;function n(){if(!t){let s=Array.from(e.share.keys());const o=a=>{const c=Array.from(e.share.keys());JSON.stringify(s)!==JSON.stringify(c)&&(s=c,t.reportChanged())};t=hi("map",()=>{e.on("beforeObserverCalls",o)},()=>{e.off("beforeObserverCalls",o)})}t.reportObserved(e._implicitObserver)}const r=e.get;e.get=function(s){if(typeof s!="string")throw new Error("unexpected");const o=Reflect.apply(r,this,arguments);return sa(o),o};function i(s){const o=e[s];let a;e[s]=function(){let c,u=arguments;return n(),a&&a.removeObservers(),a=Lv(()=>(c=Reflect.apply(o,e,u),c),()=>t.reportChanged()),c}}return i("toJSON"),Object.defineProperty(e,"keys",{get:()=>(n(),Object.keys(e.share))}),e}const rp=new WeakSet;function Dv(e){if(rp.has(e))return e;rp.add(e);let t;const n=new Map;function r(){if(!t){const a=c=>{(c.changes.added.size||c.changes.deleted.size||c.changes.keys.size||c.changes.delta.length)&&t.reportChanged()};t=hi("map",()=>{e.observe(a)},()=>{e.unobserve(a)})}t.reportObserved(e._implicitObserver)}function i(a){let c=n.get(a);if(!c){const u=l=>{l.keysChanged.has(a)&&(l.changes.added.size||l.changes.deleted.size||l.changes.keys.size||l.changes.delta.length)&&c.reportChanged()};c=hi(a,()=>{e.observe(u)},()=>{e.unobserve(u)}),n.set(a,c)}c.reportObserved(e._implicitObserver)}const s=e.get;e.get=function(a){if(typeof a!="string")throw new Error("unexpected");return i(a),Reflect.apply(s,this,arguments)};function o(a){const c=e[a];e[a]=function(){return r(),Reflect.apply(c,this,arguments)}}return o("values"),o("entries"),o("keys"),o("forEach"),o("toJSON"),e}const ip=new WeakSet;function sp(e){if(ip.has(e))return e;ip.add(e);let t;const n=i=>{t.reportChanged()};t=hi("text",()=>{e.observe(n)},()=>{e.unobserve(n)});function r(i){const s=e[i];e[i]=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(s,this,arguments)}}return r("toString"),r("toJSON"),e}const op=new WeakSet;function ap(e){if(op.has(e))return e;op.add(e);let t;const n=s=>{(s.changes.added.size||s.changes.deleted.size||s.changes.keys.size||s.changes.delta.length)&&t.reportChanged()};t=hi("xml",()=>{e.observe(n)},()=>{e.unobserve(n)});function r(s){const o=e[s];e[s]=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(o,this,arguments)}}function i(s){let o=e,a=Object.getOwnPropertyDescriptor(o,s);if(a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),!a)throw new Error("property not found");const c=a.get;a.get=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(c,this,arguments)},Object.defineProperty(e,s,a)}return r("toString"),r("toDOM"),r("toArray"),r("getAttribute"),i("firstChild"),e}function sa(e){return e instanceof ci||e instanceof Cn?sp(e):e instanceof Hn?Uv(e):e instanceof Gn?Dv(e):e instanceof pr||Object.prototype.hasOwnProperty.call(e,"autoLoad")?Pv(e):e instanceof Vn||e instanceof mr?ap(e):e}function cp(e){e.share.forEach(t=>{t.constructor!==oe&&sa(t)})}function lp(e,t){for(let r=e.length-1;r>=t;r--){let i=e[r];if(!i.deleted){var n;if(i instanceof rn)continue;(n=i.content)==null||n.getContent().forEach(s=>{s instanceof oe&&sa(s)})}}}const up=new WeakSet;function Bv(e){up.has(e)||(up.add(e),sa(e),e.store.clients.forEach(t=>{t&&lp(t,0)}),cp(e),e.on("beforeObserverCalls",t=>{cp(e),t.afterState.forEach((n,r)=>{const i=t.beforeState.get(r)||0;if(i!==n){const s=t.doc.store.clients.get(r);if(!s)return;const o=On(s,i);lp(s,o)}})}))}class Cs{constructor(t){this.value=void 0,this.value=t}}function Fv(e){return ArrayBuffer.isView(e)?new Cs(e):new Cs(Object.freeze(e))}function $v(e){const t=function(){var a;let c=(a=this[hn])==null?void 0:a.implicitObserver;return e._implicitObserver=c,e.slice.bind(e).apply(e,arguments).map(l=>{const h=oa(l,c);return c&&typeof h=="object"?gs(h,c):h})},n=function(a){return a.map(c=>{const u=Hl(c);let l=fi(u)||u;if(l instanceof Cs&&(l=l.value),l instanceof oe&&l.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return l})},r=function(){return[].findIndex.apply(t.apply(this),arguments)},i={slice:t,unshift:(...o)=>(e.unshift(n(o)),e.lengthUntracked),push:(...o)=>(e.push(n(o)),e.lengthUntracked),insert:e.insert.bind(e),toJSON:e.toJSON.bind(e),forEach:function(){return[].forEach.apply(t.apply(this),arguments)},every:function(){return[].every.apply(t.apply(this),arguments)},filter:function(){return[].filter.apply(t.apply(this),arguments)},find:function(){return[].find.apply(t.apply(this),arguments)},findIndex:r,some:function(){return[].some.apply(t.apply(this),arguments)},includes:function(){return[].includes.apply(t.apply(this),arguments)},map:function(){return[].map.apply(t.apply(this),arguments)},indexOf:function(){const o=arguments[0];return r.call(this,a=>Gv(a,o))},splice:function(){let o=arguments[0]<0?e.length-Math.abs(arguments[0]):arguments[0],a=arguments[1],c=Array.from(Array.from(arguments).slice(2)),u=t.apply(this,[o,Number.isInteger(a)?o+a:void 0]);return e.doc?e.doc.transact(()=>{e.delete(o,a),e.insert(o,n(c))}):(e.delete(o,a),e.insert(o,n(c))),u}},s=[];for(let o in i)s[o]=i[o];return s}function Ns(e){if(typeof e=="string"&&e.trim().length){const t=Number(e);if(Number.isInteger(t))return t}return e}function hp(e,t=new Hn){if(t[_e])throw new Error("unexpected");const n=$v(t),r=new Proxy(n,{set:(i,s,o)=>{throw typeof Ns(s)!="number"?new Error:new Error("array assignment is not implemented / supported")},get:(i,s,o)=>{const a=Ns(s);if(a===aa)return t;if(typeof a=="number"){let l;if(o&&o[hn]){var c;l=(c=o[hn])==null?void 0:c.implicitObserver,t._implicitObserver=l}let h=t.get(a);return h=oa(h,l),h}if(a===Symbol.toStringTag)return"Array";if(a===Symbol.iterator){const l=t.slice();return Reflect.get(l,a)}return a==="length"?t.length:Reflect.get(i,a,o)},deleteProperty:(i,s)=>{const o=Ns(s);if(typeof o!="number")throw new Error;return o<t.lengthUntracked&&o>=0?(t.delete(o),!0):!1},has:(i,s)=>{const o=Ns(s);return typeof o!="number"?Reflect.has(i,o):o<t.lengthUntracked&&o>=0},getOwnPropertyDescriptor(i,s){const o=Ns(s);if(o==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof o=="number"&&o>=0&&o<t.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:i=>{const s=[];for(let o=0;o<t.length;o++)s.push(o+"");return s.push("length"),s}});return n.push.apply(r,e),r}function fp(e,t=new Gn){if(t[_e])throw new Error("unexpected");const n=new Proxy({},{set:(r,i,s)=>{if(typeof i!="string")throw new Error;const o=Hl(s);let a=fi(o)||o;if(a instanceof Cs&&(a=a.value),a instanceof oe&&a.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return t.set(i,a),!0},get:(r,i,s)=>{if(i===aa)return t;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[hn]){var a;o=(a=s[hn])==null?void 0:a.implicitObserver,t._implicitObserver=o}let c=t.get(i);return c=oa(c,o),c},deleteProperty:(r,i)=>{if(typeof i!="string")throw new Error;return t.has(i)?(t.delete(i),!0):!1},has:(r,i)=>!!(typeof i=="string"&&t.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&t.has(i))return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(t.keys())});Ls.set(t,n);for(let r in e)n[r]=e[r];return n}function jv(e){return e instanceof oe}const Ls=new WeakMap;function oa(e,t){if(jv(e)){if(e._implicitObserver=t,e instanceof Hn||e instanceof Gn){if(!Ls.has(e)){const n=Hl(e);Ls.set(e,n)}e=Ls.get(e)}else if(e instanceof mr||e instanceof Vn||e instanceof ci||e instanceof Hi||e instanceof Cn)ol(e),e.__v_skip=!0;else throw new Error("unknown YType");return e}else{if(e===null)return null;if(typeof e=="object")return Fv(e)}return e}function Hl(e){if(e==null)return e;if(e=fi(e)||e,e instanceof Hn)return hp([],e);if(e instanceof Gn)return fp({},e);if(typeof e=="string")return e;if(Array.isArray(e))return hp(e);if(e instanceof mr||e instanceof Vn||e instanceof ci||e instanceof Hi)return e;if(e instanceof Cn)return e;if(typeof e=="object")return e instanceof Cs?e:fp(e);if(typeof e=="number"||typeof e=="boolean")return e;throw new Error("invalid")}function zv(e){for(let[t,n]of Object.entries(e))if(Array.isArray(n)){if(n.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(n&&typeof n=="object"){if(Object.keys(n).length!==0||Object.getPrototypeOf(n)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(n!=="xml"&&n!=="text")throw new Error("unknown Root initializer")}function dp(e,t,n){let r=t[n];if(!r){n!=="__v_raw"&&n!=="__v_isRef"&&n!=="__v_isReadonly"&&console.warn("property not found on root doc",n);return}return r==="xml"?e.getXmlFragment(n):r==="text"?e.getText(n):Array.isArray(r)?e.getArray(n):e.getMap(n)}function Wv(e,t){if(e[_e])throw new Error("unexpected");zv(t);const n=new Proxy({},{set:(r,i,s)=>{throw typeof i!="string"?new Error:new Error("cannot set new elements on root doc")},get:(r,i,s)=>{if(i===aa)return e;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[hn]){var a;o=(a=s[hn])==null?void 0:a.implicitObserver,e._implicitObserver=o}if(i==="toJSON"){for(let l of Object.keys(t))dp(e,t,l);return Reflect.get(e,i)}let c=dp(e,t,i);return c=oa(c,o),c},deleteProperty:(r,i)=>{throw new Error("deleteProperty not available for doc")},has:(r,i)=>!!(typeof i=="string"&&e.share.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&e.share.has(i)||i==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(e.share.keys())});return Ls.set(e,n),n}Mv(cb);const aa=Symbol("INTERNAL_SYMBOL");function pp(e,t){const n=fi(e)||e;if(!n)throw new Error("not a valid synced object");return n instanceof pr?(n.on("update",t),()=>{n.off("update",t)}):(n.observeDeep(t),()=>{n.unobserveDeep(t)})}function Hv(e){const t=fi(e);if(!(t instanceof pr))throw new Error("store is not a valid syncedStore that maps to a Y.Doc");return t}function fi(e){if(typeof e!="object"||e===null)return;const t=e[aa];return t&&(ol(t),t.__v_skip=!0),t}function Gv(e,t){if(e===t)return!0;if(typeof e=="object"&&typeof t=="object"){const n=fi(e),r=fi(t);return!n||!r?!1:n===r}return!1}function Vv(e,t=new pr){return Bv(t),Wv(t,e)}var Rt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ms=Symbol.for("react.element"),Kv=Symbol.for("react.portal"),qv=Symbol.for("react.fragment"),Xv=Symbol.for("react.strict_mode"),Zv=Symbol.for("react.profiler"),Jv=Symbol.for("react.provider"),Yv=Symbol.for("react.context"),Qv=Symbol.for("react.forward_ref"),tE=Symbol.for("react.suspense"),eE=Symbol.for("react.memo"),nE=Symbol.for("react.lazy"),mp=Symbol.iterator;function rE(e){return e===null||typeof e!="object"?null:(e=mp&&e[mp]||e["@@iterator"],typeof e=="function"?e:null)}var gp={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},yp=Object.assign,_p={};function Gi(e,t,n){this.props=e,this.context=t,this.refs=_p,this.updater=n||gp}Gi.prototype.isReactComponent={},Gi.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Gi.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function bp(){}bp.prototype=Gi.prototype;function Gl(e,t,n){this.props=e,this.context=t,this.refs=_p,this.updater=n||gp}var Vl=Gl.prototype=new bp;Vl.constructor=Gl,yp(Vl,Gi.prototype),Vl.isPureReactComponent=!0;var wp=Array.isArray,vp=Object.prototype.hasOwnProperty,Kl={current:null},Ep={key:!0,ref:!0,__self:!0,__source:!0};function kp(e,t,n){var r,i={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)vp.call(t,r)&&!Ep.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ms,type:e,key:s,ref:o,props:i,_owner:Kl.current}}function iE(e,t){return{$$typeof:Ms,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function ql(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ms}function sE(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Sp=/\/+/g;function Xl(e,t){return typeof e=="object"&&e!==null&&e.key!=null?sE(""+e.key):t.toString(36)}function ca(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Ms:case Kv:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+Xl(o,0):r,wp(i)?(n="",e!=null&&(n=e.replace(Sp,"$&/")+"/"),ca(i,t,n,"",function(u){return u})):i!=null&&(ql(i)&&(i=iE(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Sp,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",wp(e))for(var a=0;a<e.length;a++){s=e[a];var c=r+Xl(s,a);o+=ca(s,t,n,c,i)}else if(c=rE(e),typeof c=="function")for(e=c.call(e),a=0;!(s=e.next()).done;)s=s.value,c=r+Xl(s,a++),o+=ca(s,t,n,c,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function la(e,t,n){if(e==null)return e;var r=[],i=0;return ca(e,r,"","",function(s){return t.call(n,s,i++)}),r}function oE(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var $e={current:null},ua={transition:null},aE={ReactCurrentDispatcher:$e,ReactCurrentBatchConfig:ua,ReactCurrentOwner:Kl};function Ap(){throw Error("act(...) is not supported in production builds of React.")}Rt.Children={map:la,forEach:function(e,t,n){la(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return la(e,function(){t++}),t},toArray:function(e){return la(e,function(t){return t})||[]},only:function(e){if(!ql(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Rt.Component=Gi,Rt.Fragment=qv,Rt.Profiler=Zv,Rt.PureComponent=Gl,Rt.StrictMode=Xv,Rt.Suspense=tE,Rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=aE,Rt.act=Ap,Rt.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=yp({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=Kl.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)vp.call(t,c)&&!Ep.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Ms,type:e.type,key:i,ref:s,props:r,_owner:o}},Rt.createContext=function(e){return e={$$typeof:Yv,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Jv,_context:e},e.Consumer=e},Rt.createElement=kp,Rt.createFactory=function(e){var t=kp.bind(null,e);return t.type=e,t},Rt.createRef=function(){return{current:null}},Rt.forwardRef=function(e){return{$$typeof:Qv,render:e}},Rt.isValidElement=ql,Rt.lazy=function(e){return{$$typeof:nE,_payload:{_status:-1,_result:e},_init:oE}},Rt.memo=function(e,t){return{$$typeof:eE,type:e,compare:t===void 0?null:t}},Rt.startTransition=function(e){var t=ua.transition;ua.transition={};try{e()}finally{ua.transition=t}},Rt.unstable_act=Ap,Rt.useCallback=function(e,t){return $e.current.useCallback(e,t)},Rt.useContext=function(e){return $e.current.useContext(e)},Rt.useDebugValue=function(){},Rt.useDeferredValue=function(e){return $e.current.useDeferredValue(e)},Rt.useEffect=function(e,t){return $e.current.useEffect(e,t)},Rt.useId=function(){return $e.current.useId()},Rt.useImperativeHandle=function(e,t,n){return $e.current.useImperativeHandle(e,t,n)},Rt.useInsertionEffect=function(e,t){return $e.current.useInsertionEffect(e,t)},Rt.useLayoutEffect=function(e,t){return $e.current.useLayoutEffect(e,t)},Rt.useMemo=function(e,t){return $e.current.useMemo(e,t)},Rt.useReducer=function(e,t,n){return $e.current.useReducer(e,t,n)},Rt.useRef=function(e){return $e.current.useRef(e)},Rt.useState=function(e){return $e.current.useState(e)},Rt.useSyncExternalStore=function(e,t,n){return $e.current.useSyncExternalStore(e,t,n)},Rt.useTransition=function(){return $e.current.useTransition()},Rt.version="18.3.1";const Zl=0,xp=1,Tp=2,cE=(e,t)=>{At(e,Zl);const n=Cw(t);Me(e,n)},Rp=(e,t,n)=>{At(e,xp),Me(e,Tw(t,n))},lE=(e,t,n)=>Rp(t,n,Fe(e)),Ip=(e,t,n)=>{try{Sw(t,Fe(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},uE=(e,t)=>{At(e,Tp),Me(e,t)},hE=Ip,fE=(e,t,n,r)=>{const i=xt(e);switch(i){case Zl:lE(e,t,n);break;case xp:Ip(e,n,r);break;case Tp:hE(e,n,r);break;default:throw new Error("Unknown message type")}return i};function Vt(e,t,n,r){const i=r??"";return e.emit(`error:${t}`,n,i),NE(e,n,i)}function dE(e,t,n){e.emit("broadcast:startstream",t,n)}function pE(e,t){e.emit("broadcast:stopstream",void 0,t)}function mE(e,t,n){e.emit("chat:connect",t,n)}function gE(e,t){e.emit("chat:disconnect",void 0,t)}function yE(e,t,n){e.emit("gadgetclient:reset",t,n)}function _E(e,t,n){e.emit("gadgetclient:patch",t,n)}function bE(e,t){e.emit("gadgetserver:clearplayer",void 0,t)}function wE(e,t){e.emit("peer:joincode",void 0,t)}function vE(e){e.emit("ready")}function EE(e,t,n,r){e.emit("register:savemem",[t,n],r)}function kE(e,t){e.emit("register:dev",void 0,t)}function SE(e,t){e.emit("register:share",void 0,t)}function AE(e,t){e.emit("register:nuke",void 0,t)}function xE(e,t,n){e.emit("synth:tts",[t,n])}function TE(e,t,n){e.emit("synth:play",[t,n])}function RE(e,t){e.emit("synth:mainvolume",t)}function IE(e,t){e.emit("synth:drumvolume",t)}function OE(e,t){e.emit("synth:ttsvolume",t)}function Jl(e,t,n,r){e.emit("synth:voice",[t,n,r])}function CE(e,t,n,r,i){e.emit("synth:voicefx",[t,n,r,i])}function sn(e,...t){return e.emit("tape:info",t),!0}function Op(e,...t){return e.emit("tape:debug",t),!0}function NE(e,...t){return e.emit("tape:error",t),!1}function LE(e,t,n,r,i,s){e.emit("tape:editor:open",[t,n,r,i],s)}function ME(e,t){e.emit("vm:endgame",void 0,t)}function Cp(e,t){return`${e}${t}`}function Np(e,t,n){e.emit("vm:flush",t,n)}function Lp(e,t,n,r,i){function s(){return{filename:n,cursor:0,lines:r.split(`
`)}}function o(){return{filename:n,cursor:0,bytes:r,dataview:new DataView(r.buffer)}}let a;switch(t){case"file":a=r;break;case"chat":a=s();break;case"text":a=s();break;case"binary":a=o();break}e.emit("vm:loader",[t,a],i)}const yr=Vv({shared:[]});function ha(e,t,n){return e.find(r=>r.key===t&&r.type===n)}function Mp(e,t,n){const r=ha(yr.shared,e,t);v(r)||yr.shared.push({key:e,type:t,value:n})}function UE(e,t){Mp(e,0,t)}function Up(e,t){const n=new Cn(t);Mp(e,1,n)}function PE(e,t){const n=ha(yr.shared,e,0);if(v(n)){n.value=t;return}yr.shared.push({key:e,type:0,value:t})}function DE(e,t){const n=new Cn(t),r=ha(yr.shared,e,1);if(v(r)){r.value=n;return}yr.shared.push({key:e,type:1,value:n})}function Pp(e,t,n){let r;function i(){const o=ha(yr.shared,e,t);v(o)&&(s(),r=pp(o,()=>n(o.value)))}const s=pp(yr.shared,i);return i(),()=>r==null?void 0:r()}function BE(e,t){return Pp(e,0,t)}function Dp(e,t){return Pp(e,1,n=>t(n.toJSON()))}function fa(e){return In(e)}let Bp=!1;const jr=Hv(yr),dn=Mi("modem",["second"],e=>{if(dn.session(e))switch(e.target){case"second":!Bp&&e.data%2===0&&dn.emit("modem:join");break;case"join":if(e.sender!==dn.id()){dn.reply(e,"joinack");const t=Pr();cE(t,jr),dn.reply(e,"sync",fa(t));const n=Pr();Rp(n,jr),dn.reply(e,"sync",fa(n))}break;case"joinack":e.sender!==dn.id()&&(Bp=!0);break;case"sync":{if(e.sender!==dn.id()&&v(e.data))try{const t=oi(e.data),n=Pr();fE(t,n,jr,dn)===Zl&&dn.emit("modem:sync",fa(n))}catch(t){Vt(dn,"sync",t.message)}break}}});function Fp(e){const t=Pr();uE(t,e),dn.emit("modem:sync",fa(t))}jr.on("update",Fp),jr.on("destroy",()=>{jr==null||jr.off("update",Fp)});const Yl=14,da=3,pa=8,ma=14,ga=16,FE=16,$E=16;function ya(e,t){return new Array(e).fill(t)}function $p(e,t,n,r,i=0){const s=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:ya(s,0),color:ya(s,0),bg:ya(s,i)}}function jE(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:Tt.ONCLEAR}}function zE(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function WE(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:ya(s,i)}}function jp(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function HE(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:2}}var pn=(e=>(e[e.START=0]="START",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP",e[e.BOTTOM=4]="BOTTOM",e[e.SCROLL=5]="SCROLL",e))(pn||{});const GE={start:0,left:1,right:2,top:3,bottom:4,scroll:5},VE={0:1,1:20,2:20,3:1,4:1,5:40};function zp(e,t){return`${e}:${t}`}const KE=1,qE=16,XE=256;var je=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(je||{});const zr={};function Ql(){return{layers:[],panels:[],reset:!0,focus:"scroll"}}function Wp(e){e.text=[],Object.values(zr[e.id]??{}).forEach(t=>t==null?void 0:t()),zr[e.id]={}}function Hp(e){const t=e.panels.find(n=>n.name===e.focus);if(!t){const n={id:ie(),name:e.focus,edge:pn.RIGHT,size:20,text:[]};return e.panels.push(n),e.reset=!1,n}return t}const ZE=new Set(["hk","hotkey","rn","range","sl","select","nm","number","tx","text"]),JE=new Set(["rn","range","sl","select","nm","number","tx","text"]),YE=new Set(["tx","text"]),QE={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:""},tu={};let Gp=e=>{let t=tu[e];return v(t)||(tu[e]=t=Ql()),t};function tk(e){Gp=e}function di(e){return Gp(e)}function ek(e){const t=di(e);t.panels=t.panels.filter(n=>n.edge!==pn.SCROLL)}function nk(e,t,n){Object.values(zr).forEach(r=>{if(r[t]!==void 0){const i=zp(e.id(),t);St(n)&&PE(i,n),vt(n)&&DE(i,n)}})}function rk(e){let t="";const n=di(e);return n.panels=n.panels.filter(r=>{if(r.edge===pn.SCROLL){const[i]=r.text;return vt(i)&&r.text.length===1&&(t=i),r.text.length>1}return!0}),t}function eu(e,t,n,r,i){const s=di(e),o=r,a=i??Y_.capital(t),c=s.panels.find(u=>u.name===a);if(c)s.reset=!0,s.focus=a,St(o)&&(c.size=o);else switch(n){case pn.START:{tu[e]=Ql();break}case pn.LEFT:case pn.RIGHT:case pn.TOP:case pn.BOTTOM:case pn.SCROLL:{const u={id:ie(),name:a,edge:n,size:o??VE[n],text:[]};s.panels.push(u),s.focus=a;break}}}function ik(e,t){const n=di(e),r=Hp(n);n.reset&&(n.reset=!1,Wp(r)),r.text.push(t)}function sk(e,t,n,r,i){const s=di(e),o=Hp(s);s.reset&&(s.reset=!1,Wp(o));const a=Ct(r),c=[t.id(),n,...ZE.has(a)?[a]:["hyperlink",r],...i],u=c[2];if(JE.has(u)){const l=`${c[3]??""}`;zr[o.id]=zr[o.id]??{};const h=t.get(l)??QE[u];if(zr[o.id][l]===void 0){const d=zp(t.id(),l);St(h)&&UE(d,h),vt(h)&&Up(d,h),YE.has(u)?zr[o.id][l]=Dp(d,f=>{v(f)&&f!==t.get(l)&&t.set(l,f)}):zr[o.id][l]=BE(d,f=>{v(f)&&f!==t.get(l)&&t.set(l,f)})}}o.text.push(c)}var Vp={exports:{}},nu={exports:{}},Kp;function ok(){return Kp||(Kp=1,function(e,t){(function(n,r){e.exports=r()})(Be,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],u=["evalOrigin"],l=s.concat(o,a,c,u);function h(m){if(m)for(var b=0;b<l.length;b++)m[l[b]]!==void 0&&this["set"+r(l[b])](m[l[b]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",b=this.getLineNumber()||"",_=this.getColumnNumber()||"",w=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+b+":"+_+")":"[eval]:"+b+":"+_:w?w+" ("+m+":"+b+":"+_+")":m+":"+b+":"+_}},h.fromString=function(b){var _=b.indexOf("("),w=b.lastIndexOf(")"),E=b.substring(0,_),A=b.substring(_+1,w).split(","),L=b.substring(w+1);if(L.indexOf("@")===0)var I=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(L,""),R=I[1],D=I[2],C=I[3];return new h({functionName:E,args:A||void 0,fileName:R,lineNumber:D||void 0,columnNumber:C||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+r(s[d])]=i(s[d]),h.prototype["set"+r(s[d])]=function(m){return function(b){this[m]=!!b}}(s[d]);for(var f=0;f<o.length;f++)h.prototype["get"+r(o[f])]=i(o[f]),h.prototype["set"+r(o[f])]=function(m){return function(b){if(!n(b))throw new TypeError(m+" must be a Number");this[m]=Number(b)}}(o[f]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(m){return function(b){this[m]=String(b)}}(a[p]);return h})}(nu)),nu.exports}(function(e,t){(function(n,r){e.exports=r(ok())})(Be,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var u=/(.+?)(?::(\d+))?(?::(\d+))?$/,l=u.exec(c.replace(/[()]/g,""));return[l[1],l[2]||void 0,l[3]||void 0]},parseV8OrIE:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(s)},this);return u.map(function(l){l.indexOf("(eval ")>-1&&(l=l.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=l.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),p=d&&h||void 0,m=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:p,fileName:m,lineNumber:f[1],columnNumber:f[2],source:l})},this)},parseFFOrSafari:function(c){var u=c.stack.split(`
`).filter(function(l){return!l.match(o)},this);return u.map(function(l){if(l.indexOf(" > eval")>-1&&(l=l.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),l.indexOf("@")===-1&&l.indexOf(":")===-1)return new r({functionName:l});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=l.match(h),f=d&&d[1]?d[1]:void 0,p=this.extractLocation(l.replace(h,""));return new r({functionName:f,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:l})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)/i,l=c.message.split(`
`),h=[],d=2,f=l.length;d<f;d+=2){var p=u.exec(l[d]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:l[d]}))}return h},parseOpera10:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,l=c.stacktrace.split(`
`),h=[],d=0,f=l.length;d<f;d+=2){var p=u.exec(l[d]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:l[d]}))}return h},parseOpera11:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(i)&&!l.match(/^Error created at/)},this);return u.map(function(l){var h=l.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",p=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;f.match(/\(([^)]*)\)/)&&(m=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:b,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:l})},this)}}})})(Vp);var ak=Vp.exports,ck=Ni(ak);const qn=!!JSON.parse("false"),lk=!!JSON.parse("false");JSON.parse("false");const uk=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const _r={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return pa*_r.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return ma*_r.DRAW_CHAR_SCALE}},z=Mi("SOFTWARE");function Nn(e){const t={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}var qp={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Be,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var u=r();s=u(" "),o=u(" "),a=u(" ");for(var l=0;l<i.length;l++)s-=u(i[l]),s<0&&(s+=1),o-=u(i[l]),o<0&&(o+=1),a-=u(i[l]),a<0&&(a+=1);u=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(qp);var hk=qp.exports,Xp=Ni(hk);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Zp="170",fk="",_a="srgb",Jp="srgb-linear",Yp="linear",ru="srgb";function dk(e,t,n){return Math.max(t,Math.min(n,e))}class Us{constructor(t=0,n=0){Us.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(dk(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ps{constructor(t,n,r,i,s,o,a,c,u){Ps.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,u)}set(t,n,r,i,s,o,a,c,u){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=n,l[4]=s,l[5]=c,l[6]=r,l[7]=o,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],u=r[1],l=r[4],h=r[7],d=r[2],f=r[5],p=r[8],m=i[0],b=i[3],_=i[6],w=i[1],E=i[4],A=i[7],L=i[2],I=i[5],R=i[8];return s[0]=o*m+a*w+c*L,s[3]=o*b+a*E+c*I,s[6]=o*_+a*A+c*R,s[1]=u*m+l*w+h*L,s[4]=u*b+l*E+h*I,s[7]=u*_+l*A+h*R,s[2]=d*m+f*w+p*L,s[5]=d*b+f*E+p*I,s[8]=d*_+f*A+p*R,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8];return n*o*l-n*a*u-r*s*l+r*a*c+i*s*u-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=l*o-a*u,d=a*c-l*s,f=u*s-o*c,p=n*h+r*d+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=h*m,t[1]=(i*u-l*r)*m,t[2]=(a*r-i*o)*m,t[3]=d*m,t[4]=(l*n-i*c)*m,t[5]=(i*s-a*n)*m,t[6]=f*m,t[7]=(r*c-u*n)*m,t[8]=(o*n-r*s)*m,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),u=Math.sin(s);return this.set(r*c,r*u,-r*(c*o+u*a)+o+t,-i*u,i*c,-i*(-u*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(iu.makeScale(t,n)),this}rotate(t){return this.premultiply(iu.makeRotation(-t)),this}translate(t,n){return this.premultiply(iu.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const iu=new Ps,pk={enabled:!0,workingColorSpace:Jp,spaces:{},convert:function(e,t,n){return this.enabled===!1||t===n||!t||!n||(this.spaces[t].transfer===ru&&(e.r=su(e.r),e.g=su(e.g),e.b=su(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===ru&&(e.r=ou(e.r),e.g=ou(e.g),e.b=ou(e.b))),e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===fk?Yp:this.spaces[e].transfer},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}};function su(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function ou(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const Qp=[.64,.33,.3,.6,.15,.06],t0=[.2126,.7152,.0722],e0=[.3127,.329],n0=new Ps().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),r0=new Ps().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);pk.define({[Jp]:{primaries:Qp,whitePoint:e0,transfer:Yp,toXYZ:n0,fromXYZ:r0,luminanceCoefficients:t0,workingColorSpaceConfig:{unpackColorSpace:_a},outputColorSpaceConfig:{drawingBufferColorSpace:_a}},[_a]:{primaries:Qp,whitePoint:e0,transfer:ru,toXYZ:n0,fromXYZ:r0,luminanceCoefficients:t0,outputColorSpaceConfig:{drawingBufferColorSpace:_a}}}),typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Zp}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Zp),new Us,new Us;function on(e,t,n){return Math.max(t,Math.min(n,e))}const mk=Xp("089fad0j9awfem09wavefc09uwaef");function gk(){return mk()}function yk(e){return Xp(e)()}function Ds(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(gk()*i)}function _k(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(yk(e)*s)}function au(e,t,n){typeof e!="number"&&(e=0,t=0,n=1),typeof t!="number"&&(t=e,e=0,n=1),typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function bk(e){return e[Ds(0,e.length-1)]}function wk(e,t){return t[_k(e,0,t.length-1)]}function Vi(...e){return bk(e.flat())}function i0(e,...t){return wk(e,t.flat())}function vk(e){return[...new Set(e)].filter(v)}function Bs(e){return v(e)&&v(e.x)&&v(e.y)}function Te(e,t){switch(t){case ct.NORTH:--e.y;break;case ct.SOUTH:++e.y;break;case ct.WEST:--e.x;break;case ct.EAST:++e.x;break}return e}function Ki(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return ct.WEST;if(n>0)return ct.EAST;if(r<0)return ct.NORTH;if(r>0)return ct.SOUTH}const s0={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function Xn(e){return Ht(e)&&o0(e[0])}function o0(e){return v(ct[e])&&vt(e)}function Ek(e){const t=ct[e];return v(t)?t:ct.IDLE}function a0(e){if(vt(e))return s0[Ct(e)]}function c0(e){if(Xn(e))return e;if(o0(e))return[e];const t=a0(e);if(v(t))return[t]}function l0(e){const t=T.words[e],n=c0(t);if(Xn(n))return[n,e+1];const[r,i]=Oe(e),s=c0(r);return Xn(s)?[s,i]:[void 0,e]}function cu(e){const t=[];let[n,r]=l0(e);for(;Xn(n);){if(t.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=J(T.words,r,[K.NUMBER,K.NUMBER]);t.push(o,a),r=c}const[i,s]=l0(r);n=i,r=s}return t.length?[t,r]:[void 0,e]}function qi(e){return Ht(e)&&typeof e[0]=="string"}function u0(e){const t=T.words[e];if(qi(t))return[t,e+1];const[n,r]=Ac(e),[i,s]=Oe(r,!1);return vt(i)?[[i,n],s]:[void 0,e]}function ba(e){if(!qi(e))return;const[t]=e;return t}function h0(e){if(!qi(e))return;const[,t]=e,n=v(t)?c1(t):void 0;return v(n)?n:void 0}function f0(e){if(!qi(e))return;const[,t]=e,n=v(t)?WC(t):void 0;return v(n)?n:void 0}const ee=60,mn=25;var Et=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(Et||{});function lu(e,t){const n=e??Kt.ISWALK,r=t??Kt.ISWALK;switch(n){case Kt.ISWALK:return r!==Kt.ISWALK;case Kt.ISSWIM:return r!==Kt.ISSWIM;case Kt.ISSOLID:return!0;case Kt.ISBULLET:return r!==Kt.ISWALK&&r!==Kt.ISSWIM}}function wa(e,t,n){const r=e==null?void 0:e.objects[n];if(v(r))return r;if(v(t)){const i=Fs(e,"player"),s={x:t.x??0,y:t.y??0};p0(s,i)}}function Fs(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(v)}function d0(e,t){const n=ba(t),r=h0(t),i=f0(t);return e.filter(s=>!(v(n)&&Dh(s)!==n||v(r)&&ZC(s)!==r||v(i)&&JC(s)!==i)).filter(v)}function uu(e,t){return v(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(v(i))return i;const s=Fs(e,Ct(n));if(s.length)return s}else if(Bs(n)&&n.x>=0&&n.x<ee&&n.y>=0&&n.y<mn){const i=n.x+n.y*ee,s=(r=e.lookup)==null?void 0:r[i];return v(s)?e.objects[s]:e.terrain[i]}}).flat().filter(v):[]}function p0(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function m0(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function g0(e){const t=Math.floor(e.length/da);if(t*da!==e.length){Vt(z,"size","wrong number of bytes for a palette");return}const n=m0(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function kk(e,t){return e&1<<t?255:0}function y0(e){const t=Math.floor(e.length/Yl);if(t*Yl!==e.length){Vt(z,"size","wrong number of bytes for a charset");return}const n=Math.ceil(t/ga),r=pa*ga,i=m0(r,ma*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const u=o*ma+a,l=e[c];for(let h=0;h<pa;++h){const d=s*pa+h;i.bits[d+u*r]=kk(l,7-h)}++a,a===ma&&(a=0,++s,s===ga&&(s=0,++o))}return i}const Sk=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,129,165,129,129,189,153,129,126,0,0,0,0,0,126,255,219,255,255,195,231,255,126,0,0,0,0,0,0,108,254,254,254,254,124,56,16,0,0,0,0,0,0,16,56,124,254,124,56,16,0,0,0,0,0,0,24,60,60,231,231,231,24,24,60,0,0,0,0,0,24,60,126,255,255,126,24,24,60,0,0,0,0,0,0,0,0,24,60,60,24,0,0,0,0,0,255,255,255,255,255,231,195,195,231,255,255,255,255,255,0,0,0,0,60,102,66,66,102,60,0,0,0,0,255,255,255,255,195,153,189,189,153,195,255,255,255,255,0,0,30,14,26,50,120,204,204,204,120,0,0,0,0,0,60,102,102,102,60,24,126,24,24,0,0,0,0,0,63,51,63,48,48,48,112,240,224,0,0,0,0,0,127,99,127,99,99,99,103,231,230,192,0,0,0,0,24,24,219,60,231,60,219,24,24,0,0,0,0,0,128,192,224,248,254,248,224,192,128,0,0,0,0,0,2,6,14,62,254,62,14,6,2,0,0,0,0,0,24,60,126,24,24,24,126,60,24,0,0,0,0,0,102,102,102,102,102,102,0,102,102,0,0,0,0,0,127,219,219,219,123,27,27,27,27,0,0,0,0,124,198,96,56,108,198,198,108,56,12,198,124,0,0,0,0,0,0,0,0,0,254,254,254,0,0,0,0,0,24,60,126,24,24,24,126,60,24,126,0,0,0,0,24,60,126,24,24,24,24,24,24,0,0,0,0,0,24,24,24,24,24,24,126,60,24,0,0,0,0,0,0,0,24,12,254,12,24,0,0,0,0,0,0,0,0,0,48,96,254,96,48,0,0,0,0,0,0,0,0,0,0,192,192,192,254,0,0,0,0,0,0,0,0,0,40,108,254,108,40,0,0,0,0,0,0,0,0,16,56,56,124,124,254,254,0,0,0,0,0,0,0,254,254,124,124,56,56,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,60,60,60,24,24,0,24,24,0,0,0,0,102,102,102,36,0,0,0,0,0,0,0,0,0,0,0,108,108,254,108,108,108,254,108,108,0,0,0,24,24,124,198,194,192,124,6,134,198,124,24,24,0,0,0,0,0,194,198,12,24,48,102,198,0,0,0,0,0,56,108,108,56,118,220,204,204,118,0,0,0,0,48,48,48,96,0,0,0,0,0,0,0,0,0,0,0,12,24,48,48,48,48,48,24,12,0,0,0,0,0,48,24,12,12,12,12,12,24,48,0,0,0,0,0,0,0,102,60,255,60,102,0,0,0,0,0,0,0,0,0,24,24,126,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,48,0,0,0,0,0,0,0,0,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,2,6,12,24,48,96,192,128,0,0,0,0,0,0,124,198,206,222,246,230,198,198,124,0,0,0,0,0,24,56,120,24,24,24,24,24,126,0,0,0,0,0,124,198,6,12,24,48,96,198,254,0,0,0,0,0,124,198,6,6,60,6,6,198,124,0,0,0,0,0,12,28,60,108,204,254,12,12,30,0,0,0,0,0,254,192,192,192,252,6,6,198,124,0,0,0,0,0,56,96,192,192,252,198,198,198,124,0,0,0,0,0,254,198,6,12,24,48,48,48,48,0,0,0,0,0,124,198,198,198,124,198,198,198,124,0,0,0,0,0,124,198,198,198,126,6,6,12,120,0,0,0,0,0,0,24,24,0,0,0,24,24,0,0,0,0,0,0,0,24,24,0,0,0,24,24,48,0,0,0,0,0,6,12,24,48,96,48,24,12,6,0,0,0,0,0,0,0,0,126,0,0,126,0,0,0,0,0,0,0,96,48,24,12,6,12,24,48,96,0,0,0,0,0,124,198,198,12,24,24,0,24,24,0,0,0,0,0,124,198,198,222,222,222,220,192,124,0,0,0,0,0,16,56,108,198,198,254,198,198,198,0,0,0,0,0,252,102,102,102,124,102,102,102,252,0,0,0,0,0,60,102,194,192,192,192,194,102,60,0,0,0,0,0,248,108,102,102,102,102,102,108,248,0,0,0,0,0,254,102,98,104,120,104,98,102,254,0,0,0,0,0,254,102,98,104,120,104,96,96,240,0,0,0,0,0,60,102,194,192,192,222,198,102,58,0,0,0,0,0,198,198,198,198,254,198,198,198,198,0,0,0,0,0,60,24,24,24,24,24,24,24,60,0,0,0,0,0,30,12,12,12,12,12,204,204,120,0,0,0,0,0,230,102,108,108,120,108,108,102,230,0,0,0,0,0,240,96,96,96,96,96,98,102,254,0,0,0,0,0,198,238,254,254,214,198,198,198,198,0,0,0,0,0,198,230,246,254,222,206,198,198,198,0,0,0,0,0,56,108,198,198,198,198,198,108,56,0,0,0,0,0,252,102,102,102,124,96,96,96,240,0,0,0,0,0,124,198,198,198,198,214,222,124,12,14,0,0,0,0,252,102,102,102,124,108,102,102,230,0,0,0,0,0,124,198,198,96,56,12,198,198,124,0,0,0,0,0,126,126,90,24,24,24,24,24,60,0,0,0,0,0,198,198,198,198,198,198,198,198,124,0,0,0,0,0,198,198,198,198,198,198,108,56,16,0,0,0,0,0,198,198,198,198,214,214,254,124,108,0,0,0,0,0,198,198,108,56,56,56,108,198,198,0,0,0,0,0,102,102,102,102,60,24,24,24,60,0,0,0,0,0,254,198,140,24,48,96,194,198,254,0,0,0,0,0,60,48,48,48,48,48,48,48,60,0,0,0,0,0,128,192,224,112,56,28,14,6,2,0,0,0,0,0,60,12,12,12,12,12,12,12,60,0,0,0,16,56,108,198,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,48,48,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,12,124,204,204,118,0,0,0,0,0,224,96,96,120,108,102,102,102,124,0,0,0,0,0,0,0,0,124,198,192,192,198,124,0,0,0,0,0,28,12,12,60,108,204,204,204,118,0,0,0,0,0,0,0,0,124,198,254,192,198,124,0,0,0,0,0,56,108,100,96,240,96,96,96,240,0,0,0,0,0,0,0,0,118,204,204,204,124,12,204,120,0,0,0,224,96,96,108,118,102,102,102,230,0,0,0,0,0,24,24,0,56,24,24,24,24,60,0,0,0,0,0,6,6,0,14,6,6,6,6,102,102,60,0,0,0,224,96,96,102,108,120,108,102,230,0,0,0,0,0,56,24,24,24,24,24,24,24,60,0,0,0,0,0,0,0,0,236,254,214,214,214,198,0,0,0,0,0,0,0,0,220,102,102,102,102,102,0,0,0,0,0,0,0,0,124,198,198,198,198,124,0,0,0,0,0,0,0,0,220,102,102,102,124,96,96,240,0,0,0,0,0,0,118,204,204,204,124,12,12,30,0,0,0,0,0,0,220,118,102,96,96,240,0,0,0,0,0,0,0,0,124,198,112,28,198,124,0,0,0,0,0,16,48,48,252,48,48,48,54,28,0,0,0,0,0,0,0,0,204,204,204,204,204,118,0,0,0,0,0,0,0,0,102,102,102,102,60,24,0,0,0,0,0,0,0,0,198,198,214,214,254,108,0,0,0,0,0,0,0,0,198,108,56,56,108,198,0,0,0,0,0,0,0,0,198,198,198,198,126,6,12,248,0,0,0,0,0,0,254,204,24,48,102,254,0,0,0,0,0,14,24,24,24,112,24,24,24,14,0,0,0,0,0,24,24,24,24,0,24,24,24,24,0,0,0,0,0,112,24,24,24,14,24,24,24,112,0,0,0,0,0,118,220,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,56,108,198,198,254,0,0,0,0,0,0,60,102,194,192,192,194,102,60,12,6,124,0,0,0,204,204,0,204,204,204,204,204,118,0,0,0,0,12,24,48,0,124,198,254,192,198,124,0,0,0,0,16,56,108,0,120,12,124,204,204,118,0,0,0,0,0,204,204,0,120,12,124,204,204,118,0,0,0,0,96,48,24,0,120,12,124,204,204,118,0,0,0,0,56,108,56,0,120,12,124,204,204,118,0,0,0,0,0,0,0,60,102,96,102,60,12,6,60,0,0,0,16,56,108,0,124,198,254,192,198,124,0,0,0,0,0,204,204,0,124,198,254,192,198,124,0,0,0,0,96,48,24,0,124,198,254,192,198,124,0,0,0,0,0,102,102,0,56,24,24,24,24,60,0,0,0,0,24,60,102,0,56,24,24,24,24,60,0,0,0,0,96,48,24,0,56,24,24,24,24,60,0,0,0,0,198,198,16,56,108,198,198,254,198,198,0,0,0,56,108,56,0,56,108,198,198,254,198,198,0,0,0,24,48,96,0,254,102,96,124,96,102,254,0,0,0,0,0,0,0,204,118,54,126,216,216,110,0,0,0,0,0,62,108,204,204,254,204,204,204,206,0,0,0,0,16,56,108,0,124,198,198,198,198,124,0,0,0,0,0,198,198,0,124,198,198,198,198,124,0,0,0,0,96,48,24,0,124,198,198,198,198,124,0,0,0,0,48,120,204,0,204,204,204,204,204,118,0,0,0,0,96,48,24,0,204,204,204,204,204,118,0,0,0,0,0,198,198,0,198,198,198,198,126,6,12,120,0,0,198,198,56,108,198,198,198,198,108,56,0,0,0,0,198,198,0,198,198,198,198,198,198,124,0,0,0,0,24,24,60,102,96,96,102,60,24,24,0,0,0,0,56,108,100,96,240,96,96,96,230,252,0,0,0,0,0,102,102,60,24,126,24,126,24,24,0,0,0,0,248,204,204,248,196,204,222,204,204,198,0,0,0,0,14,27,24,24,24,126,24,24,24,24,216,112,0,0,24,48,96,0,120,12,124,204,204,118,0,0,0,0,12,24,48,0,56,24,24,24,24,60,0,0,0,0,24,48,96,0,124,198,198,198,198,124,0,0,0,0,24,48,96,0,204,204,204,204,204,118,0,0,0,0,0,118,220,0,220,102,102,102,102,102,0,0,0,118,220,0,198,230,246,254,222,206,198,198,0,0,0,0,60,108,108,62,0,126,0,0,0,0,0,0,0,0,56,108,108,56,0,124,0,0,0,0,0,0,0,0,0,48,48,0,48,48,96,198,198,124,0,0,0,0,0,0,0,0,0,254,192,192,192,0,0,0,0,0,0,0,0,0,0,254,6,6,6,0,0,0,0,0,192,192,198,204,216,48,96,220,134,12,24,62,0,0,192,192,198,204,216,48,102,206,158,62,6,6,0,0,0,24,24,0,24,24,60,60,60,24,0,0,0,0,0,0,0,54,108,216,108,54,0,0,0,0,0,0,0,0,0,216,108,54,108,216,0,0,0,0,0,17,68,17,68,17,68,17,68,17,68,17,68,17,68,85,170,85,170,85,170,85,170,85,170,85,170,85,170,221,119,221,119,221,119,221,119,221,119,221,119,221,119,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,248,24,24,24,24,24,24,24,24,24,24,24,248,24,248,24,24,24,24,24,24,54,54,54,54,54,54,54,246,54,54,54,54,54,54,0,0,0,0,0,0,0,254,54,54,54,54,54,54,0,0,0,0,0,248,24,248,24,24,24,24,24,24,54,54,54,54,54,246,6,246,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,0,0,0,0,0,254,6,246,54,54,54,54,54,54,54,54,54,54,54,246,6,254,0,0,0,0,0,0,54,54,54,54,54,54,54,254,0,0,0,0,0,0,24,24,24,24,24,248,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,248,24,24,24,24,24,24,24,24,24,24,24,24,24,31,0,0,0,0,0,0,24,24,24,24,24,24,24,255,0,0,0,0,0,0,0,0,0,0,0,0,0,255,24,24,24,24,24,24,24,24,24,24,24,24,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,255,0,0,0,0,0,0,24,24,24,24,24,24,24,255,24,24,24,24,24,24,24,24,24,24,24,31,24,31,24,24,24,24,24,24,54,54,54,54,54,54,54,55,54,54,54,54,54,54,54,54,54,54,54,55,48,63,0,0,0,0,0,0,0,0,0,0,0,63,48,55,54,54,54,54,54,54,54,54,54,54,54,247,0,255,0,0,0,0,0,0,0,0,0,0,0,255,0,247,54,54,54,54,54,54,54,54,54,54,54,55,48,55,54,54,54,54,54,54,0,0,0,0,0,255,0,255,0,0,0,0,0,0,54,54,54,54,54,247,0,247,54,54,54,54,54,54,24,24,24,24,24,255,0,255,0,0,0,0,0,0,54,54,54,54,54,54,54,255,0,0,0,0,0,0,0,0,0,0,0,255,0,255,24,24,24,24,24,24,0,0,0,0,0,0,0,255,54,54,54,54,54,54,54,54,54,54,54,54,54,63,0,0,0,0,0,0,24,24,24,24,24,31,24,31,0,0,0,0,0,0,0,0,0,0,0,31,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,63,54,54,54,54,54,54,54,54,54,54,54,54,54,255,54,54,54,54,54,54,24,24,24,24,24,255,24,255,24,24,24,24,24,24,24,24,24,24,24,24,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,31,24,24,24,24,24,24,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255,240,240,240,240,240,240,240,240,240,240,240,240,240,240,15,15,15,15,15,15,15,15,15,15,15,15,15,15,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,118,220,216,216,220,118,0,0,0,0,0,0,0,124,198,252,198,198,252,192,192,64,0,0,0,254,198,198,192,192,192,192,192,192,0,0,0,0,0,0,0,254,108,108,108,108,108,108,0,0,0,0,0,254,198,96,48,24,48,96,198,254,0,0,0,0,0,0,0,0,126,216,216,216,216,112,0,0,0,0,0,0,0,102,102,102,102,124,96,96,192,0,0,0,0,0,0,118,220,24,24,24,24,24,0,0,0,0,0,126,24,60,102,102,102,60,24,126,0,0,0,0,0,56,108,198,198,254,198,198,108,56,0,0,0,0,0,56,108,198,198,198,108,108,108,238,0,0,0,0,0,30,48,24,12,62,102,102,102,60,0,0,0,0,0,0,0,0,126,219,219,126,0,0,0,0,0,0,0,3,6,126,219,219,243,126,96,192,0,0,0,0,0,28,48,96,96,124,96,96,48,28,0,0,0,0,0,0,124,198,198,198,198,198,198,198,0,0,0,0,0,0,254,0,0,254,0,0,254,0,0,0,0,0,0,0,24,24,126,24,24,0,0,255,0,0,0,0,0,48,24,12,6,12,24,48,0,126,0,0,0,0,0,12,24,48,96,48,24,12,0,126,0,0,0,0,0,14,27,27,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,216,216,112,0,0,0,0,0,0,24,24,0,126,0,24,24,0,0,0,0,0,0,0,0,118,220,0,118,220,0,0,0,0,0,0,56,108,108,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,15,12,12,12,12,12,236,108,60,28,0,0,0,0,216,108,108,108,108,108,0,0,0,0,0,0,0,0,112,216,48,96,200,248,0,0,0,0,0,0,0,0,0,0,0,124,124,124,124,124,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Ak=new Uint8Array([0,0,0,0,0,42,0,42,0,0,42,42,42,0,0,42,0,42,42,21,0,42,42,42,21,21,21,21,21,63,21,63,21,21,63,63,63,21,21,63,21,63,63,63,21,63,63,63]);var _0=typeof global=="object"&&global&&global.Object===Object&&global,xk=typeof self=="object"&&self&&self.Object===Object&&self,Zn=_0||xk||Function("return this")(),gn=Zn.Symbol,b0=Object.prototype,Tk=b0.hasOwnProperty,Rk=b0.toString,$s=gn?gn.toStringTag:void 0;function Ik(e){var t=Tk.call(e,$s),n=e[$s];try{e[$s]=void 0;var r=!0}catch{}var i=Rk.call(e);return r&&(t?e[$s]=n:delete e[$s]),i}var Ok=Object.prototype,Ck=Ok.toString;function Nk(e){return Ck.call(e)}var Lk="[object Null]",Mk="[object Undefined]",w0=gn?gn.toStringTag:void 0;function Wr(e){return e==null?e===void 0?Mk:Lk:w0&&w0 in Object(e)?Ik(e):Nk(e)}function Ln(e){return e!=null&&typeof e=="object"}var Uk="[object Symbol]";function va(e){return typeof e=="symbol"||Ln(e)&&Wr(e)==Uk}function Ea(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var Ut=Array.isArray,Pk=1/0,v0=gn?gn.prototype:void 0,E0=v0?v0.toString:void 0;function k0(e){if(typeof e=="string")return e;if(Ut(e))return Ea(e,k0)+"";if(va(e))return E0?E0.call(e):"";var t=e+"";return t=="0"&&1/e==-Pk?"-0":t}var Dk=/\s/;function Bk(e){for(var t=e.length;t--&&Dk.test(e.charAt(t)););return t}var Fk=/^\s+/;function $k(e){return e&&e.slice(0,Bk(e)+1).replace(Fk,"")}function yn(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var S0=NaN,jk=/^[-+]0x[0-9a-f]+$/i,zk=/^0b[01]+$/i,Wk=/^0o[0-7]+$/i,Hk=parseInt;function Gk(e){if(typeof e=="number")return e;if(va(e))return S0;if(yn(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=yn(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=$k(e);var n=zk.test(e);return n||Wk.test(e)?Hk(e.slice(2),n?2:8):jk.test(e)?S0:+e}var A0=1/0,Vk=17976931348623157e292;function Kk(e){if(!e)return e===0?e:0;if(e=Gk(e),e===A0||e===-A0){var t=e<0?-1:1;return t*Vk}return e===e?e:0}function ka(e){var t=Kk(e),n=t%1;return t===t?n?t-n:t:0}function Xi(e){return e}var qk="[object AsyncFunction]",Xk="[object Function]",Zk="[object GeneratorFunction]",Jk="[object Proxy]";function br(e){if(!yn(e))return!1;var t=Wr(e);return t==Xk||t==Zk||t==qk||t==Jk}var hu=Zn["__core-js_shared__"],x0=function(){var e=/[^.]+$/.exec(hu&&hu.keys&&hu.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Yk(e){return!!x0&&x0 in e}var Qk=Function.prototype,t2=Qk.toString;function pi(e){if(e!=null){try{return t2.call(e)}catch{}try{return e+""}catch{}}return""}var e2=/[\\^$.*+?()[\]{}|]/g,n2=/^\[object .+?Constructor\]$/,r2=Function.prototype,i2=Object.prototype,s2=r2.toString,o2=i2.hasOwnProperty,a2=RegExp("^"+s2.call(o2).replace(e2,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function c2(e){if(!yn(e)||Yk(e))return!1;var t=br(e)?a2:n2;return t.test(pi(e))}function l2(e,t){return e==null?void 0:e[t]}function mi(e,t){var n=l2(e,t);return c2(n)?n:void 0}var fu=mi(Zn,"WeakMap"),T0=Object.create,u2=function(){function e(){}return function(t){if(!yn(t))return{};if(T0)return T0(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function h2(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function ve(){}function f2(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var d2=800,p2=16,m2=Date.now;function g2(e){var t=0,n=0;return function(){var r=m2(),i=p2-(r-n);if(n=r,i>0){if(++t>=d2)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function y2(e){return function(){return e}}var Sa=function(){try{var e=mi(Object,"defineProperty");return e({},"",{}),e}catch{}}(),_2=Sa?function(e,t){return Sa(e,"toString",{configurable:!0,enumerable:!1,value:y2(t),writable:!0})}:Xi,b2=g2(_2);function R0(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function I0(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function w2(e){return e!==e}function v2(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function du(e,t,n){return t===t?v2(e,t,n):I0(e,w2,n)}function O0(e,t){var n=e==null?0:e.length;return!!n&&du(e,t,0)>-1}var E2=9007199254740991,k2=/^(?:0|[1-9]\d*)$/;function Aa(e,t){var n=typeof e;return t=t??E2,!!t&&(n=="number"||n!="symbol"&&k2.test(e))&&e>-1&&e%1==0&&e<t}function pu(e,t,n){t=="__proto__"&&Sa?Sa(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function js(e,t){return e===t||e!==e&&t!==t}var S2=Object.prototype,A2=S2.hasOwnProperty;function xa(e,t,n){var r=e[t];(!(A2.call(e,t)&&js(r,n))||n===void 0&&!(t in e))&&pu(e,t,n)}function mu(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?pu(n,a,c):xa(n,a,c)}return n}var C0=Math.max;function x2(e,t,n){return t=C0(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=C0(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),h2(e,this,a)}}function gu(e,t){return b2(x2(e,t,Xi),e+"")}var T2=9007199254740991;function yu(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=T2}function Jn(e){return e!=null&&yu(e.length)&&!br(e)}function N0(e,t,n){if(!yn(n))return!1;var r=typeof t;return(r=="number"?Jn(n)&&Aa(t,n.length):r=="string"&&t in n)?js(n[t],e):!1}function R2(e){return gu(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&N0(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var I2=Object.prototype;function zs(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||I2;return e===n}function O2(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var C2="[object Arguments]";function L0(e){return Ln(e)&&Wr(e)==C2}var M0=Object.prototype,N2=M0.hasOwnProperty,L2=M0.propertyIsEnumerable,Ta=L0(function(){return arguments}())?L0:function(e){return Ln(e)&&N2.call(e,"callee")&&!L2.call(e,"callee")};function M2(){return!1}var U0=typeof exports=="object"&&exports&&!exports.nodeType&&exports,P0=U0&&typeof module=="object"&&module&&!module.nodeType&&module,U2=P0&&P0.exports===U0,D0=U2?Zn.Buffer:void 0,P2=D0?D0.isBuffer:void 0,Ws=P2||M2,D2="[object Arguments]",B2="[object Array]",F2="[object Boolean]",$2="[object Date]",j2="[object Error]",z2="[object Function]",W2="[object Map]",H2="[object Number]",G2="[object Object]",V2="[object RegExp]",K2="[object Set]",q2="[object String]",X2="[object WeakMap]",Z2="[object ArrayBuffer]",J2="[object DataView]",Y2="[object Float32Array]",Q2="[object Float64Array]",tS="[object Int8Array]",eS="[object Int16Array]",nS="[object Int32Array]",rS="[object Uint8Array]",iS="[object Uint8ClampedArray]",sS="[object Uint16Array]",oS="[object Uint32Array]",te={};te[Y2]=te[Q2]=te[tS]=te[eS]=te[nS]=te[rS]=te[iS]=te[sS]=te[oS]=!0,te[D2]=te[B2]=te[Z2]=te[F2]=te[J2]=te[$2]=te[j2]=te[z2]=te[W2]=te[H2]=te[G2]=te[V2]=te[K2]=te[q2]=te[X2]=!1;function aS(e){return Ln(e)&&yu(e.length)&&!!te[Wr(e)]}function Ra(e){return function(t){return e(t)}}var B0=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Hs=B0&&typeof module=="object"&&module&&!module.nodeType&&module,cS=Hs&&Hs.exports===B0,_u=cS&&_0.process,Hr=function(){try{var e=Hs&&Hs.require&&Hs.require("util").types;return e||_u&&_u.binding&&_u.binding("util")}catch{}}(),F0=Hr&&Hr.isTypedArray,bu=F0?Ra(F0):aS,lS=Object.prototype,uS=lS.hasOwnProperty;function $0(e,t){var n=Ut(e),r=!n&&Ta(e),i=!n&&!r&&Ws(e),s=!n&&!r&&!i&&bu(e),o=n||r||i||s,a=o?O2(e.length,String):[],c=a.length;for(var u in e)(t||uS.call(e,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Aa(u,c)))&&a.push(u);return a}function j0(e,t){return function(n){return e(t(n))}}var hS=j0(Object.keys,Object),fS=Object.prototype,dS=fS.hasOwnProperty;function z0(e){if(!zs(e))return hS(e);var t=[];for(var n in Object(e))dS.call(e,n)&&n!="constructor"&&t.push(n);return t}function _n(e){return Jn(e)?$0(e):z0(e)}var pS=Object.prototype,mS=pS.hasOwnProperty,Ke=R2(function(e,t){if(zs(t)||Jn(t)){mu(t,_n(t),e);return}for(var n in t)mS.call(t,n)&&xa(e,n,t[n])});function gS(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var yS=Object.prototype,_S=yS.hasOwnProperty;function bS(e){if(!yn(e))return gS(e);var t=zs(e),n=[];for(var r in e)r=="constructor"&&(t||!_S.call(e,r))||n.push(r);return n}function W0(e){return Jn(e)?$0(e,!0):bS(e)}var wS=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,vS=/^\w*$/;function wu(e,t){if(Ut(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||va(e)?!0:vS.test(e)||!wS.test(e)||t!=null&&e in Object(t)}var Gs=mi(Object,"create");function ES(){this.__data__=Gs?Gs(null):{},this.size=0}function kS(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var SS="__lodash_hash_undefined__",AS=Object.prototype,xS=AS.hasOwnProperty;function TS(e){var t=this.__data__;if(Gs){var n=t[e];return n===SS?void 0:n}return xS.call(t,e)?t[e]:void 0}var RS=Object.prototype,IS=RS.hasOwnProperty;function OS(e){var t=this.__data__;return Gs?t[e]!==void 0:IS.call(t,e)}var CS="__lodash_hash_undefined__";function NS(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Gs&&t===void 0?CS:t,this}function gi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}gi.prototype.clear=ES,gi.prototype.delete=kS,gi.prototype.get=TS,gi.prototype.has=OS,gi.prototype.set=NS;function LS(){this.__data__=[],this.size=0}function Ia(e,t){for(var n=e.length;n--;)if(js(e[n][0],t))return n;return-1}var MS=Array.prototype,US=MS.splice;function PS(e){var t=this.__data__,n=Ia(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():US.call(t,n,1),--this.size,!0}function DS(e){var t=this.__data__,n=Ia(t,e);return n<0?void 0:t[n][1]}function BS(e){return Ia(this.__data__,e)>-1}function FS(e,t){var n=this.__data__,r=Ia(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function wr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}wr.prototype.clear=LS,wr.prototype.delete=PS,wr.prototype.get=DS,wr.prototype.has=BS,wr.prototype.set=FS;var Vs=mi(Zn,"Map");function $S(){this.size=0,this.__data__={hash:new gi,map:new(Vs||wr),string:new gi}}function jS(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Oa(e,t){var n=e.__data__;return jS(t)?n[typeof t=="string"?"string":"hash"]:n.map}function zS(e){var t=Oa(this,e).delete(e);return this.size-=t?1:0,t}function WS(e){return Oa(this,e).get(e)}function HS(e){return Oa(this,e).has(e)}function GS(e,t){var n=Oa(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function vr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}vr.prototype.clear=$S,vr.prototype.delete=zS,vr.prototype.get=WS,vr.prototype.has=HS,vr.prototype.set=GS;var VS="Expected a function";function vu(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(VS);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(vu.Cache||vr),n}vu.Cache=vr;var KS=500;function qS(e){var t=vu(e,function(r){return n.size===KS&&n.clear(),r}),n=t.cache;return t}var XS=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ZS=/\\(\\)?/g,JS=qS(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(XS,function(n,r,i,s){t.push(i?s.replace(ZS,"$1"):r||n)}),t});function H0(e){return e==null?"":k0(e)}function Ca(e,t){return Ut(e)?e:wu(e,t)?[e]:JS(H0(e))}var YS=1/0;function Ks(e){if(typeof e=="string"||va(e))return e;var t=e+"";return t=="0"&&1/e==-YS?"-0":t}function Eu(e,t){t=Ca(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[Ks(t[n++])];return n&&n==r?e:void 0}function QS(e,t,n){var r=e==null?void 0:Eu(e,t);return r===void 0?n:r}function ku(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var G0=gn?gn.isConcatSpreadable:void 0;function tA(e){return Ut(e)||Ta(e)||!!(G0&&e&&e[G0])}function Su(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=tA),i||(i=[]);++s<o;){var a=e[s];n(a)?ku(i,a):r||(i[i.length]=a)}return i}function an(e){var t=e==null?0:e.length;return t?Su(e):[]}var V0=j0(Object.getPrototypeOf,Object);function Au(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function eA(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:Au(e,t,n)}var nA="\\ud800-\\udfff",rA="\\u0300-\\u036f",iA="\\ufe20-\\ufe2f",sA="\\u20d0-\\u20ff",oA=rA+iA+sA,aA="\\ufe0e\\ufe0f",cA="\\u200d",lA=RegExp("["+cA+nA+oA+aA+"]");function K0(e){return lA.test(e)}function uA(e){return e.split("")}var q0="\\ud800-\\udfff",hA="\\u0300-\\u036f",fA="\\ufe20-\\ufe2f",dA="\\u20d0-\\u20ff",pA=hA+fA+dA,mA="\\ufe0e\\ufe0f",gA="["+q0+"]",xu="["+pA+"]",Tu="\\ud83c[\\udffb-\\udfff]",yA="(?:"+xu+"|"+Tu+")",X0="[^"+q0+"]",Z0="(?:\\ud83c[\\udde6-\\uddff]){2}",J0="[\\ud800-\\udbff][\\udc00-\\udfff]",_A="\\u200d",Y0=yA+"?",Q0="["+mA+"]?",bA="(?:"+_A+"(?:"+[X0,Z0,J0].join("|")+")"+Q0+Y0+")*",wA=Q0+Y0+bA,vA="(?:"+[X0+xu+"?",xu,Z0,J0,gA].join("|")+")",EA=RegExp(Tu+"(?="+Tu+")|"+vA+wA,"g");function kA(e){return e.match(EA)||[]}function SA(e){return K0(e)?kA(e):uA(e)}function AA(e){return function(t){t=H0(t);var n=K0(t)?SA(t):void 0,r=n?n[0]:t.charAt(0),i=n?eA(n,1).join(""):t.slice(1);return r[e]()+i}}var tm=AA("toUpperCase");function xA(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function TA(){this.__data__=new wr,this.size=0}function RA(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function IA(e){return this.__data__.get(e)}function OA(e){return this.__data__.has(e)}var CA=200;function NA(e,t){var n=this.__data__;if(n instanceof wr){var r=n.__data__;if(!Vs||r.length<CA-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new vr(r)}return n.set(e,t),this.size=n.size,this}function Yn(e){var t=this.__data__=new wr(e);this.size=t.size}Yn.prototype.clear=TA,Yn.prototype.delete=RA,Yn.prototype.get=IA,Yn.prototype.has=OA,Yn.prototype.set=NA;function LA(e,t){return e&&mu(t,_n(t),e)}var em=typeof exports=="object"&&exports&&!exports.nodeType&&exports,nm=em&&typeof module=="object"&&module&&!module.nodeType&&module,MA=nm&&nm.exports===em,rm=MA?Zn.Buffer:void 0,im=rm?rm.allocUnsafe:void 0;function UA(e,t){var n=e.length,r=im?im(n):new e.constructor(n);return e.copy(r),r}function Ru(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function sm(){return[]}var PA=Object.prototype,DA=PA.propertyIsEnumerable,om=Object.getOwnPropertySymbols,Iu=om?function(e){return e==null?[]:(e=Object(e),Ru(om(e),function(t){return DA.call(e,t)}))}:sm;function BA(e,t){return mu(e,Iu(e),t)}var FA=Object.getOwnPropertySymbols,$A=FA?function(e){for(var t=[];e;)ku(t,Iu(e)),e=V0(e);return t}:sm;function am(e,t,n){var r=t(e);return Ut(e)?r:ku(r,n(e))}function Ou(e){return am(e,_n,Iu)}function jA(e){return am(e,W0,$A)}var Cu=mi(Zn,"DataView"),Nu=mi(Zn,"Promise"),Zi=mi(Zn,"Set"),cm="[object Map]",zA="[object Object]",lm="[object Promise]",um="[object Set]",hm="[object WeakMap]",fm="[object DataView]",WA=pi(Cu),HA=pi(Vs),GA=pi(Nu),VA=pi(Zi),KA=pi(fu),bn=Wr;(Cu&&bn(new Cu(new ArrayBuffer(1)))!=fm||Vs&&bn(new Vs)!=cm||Nu&&bn(Nu.resolve())!=lm||Zi&&bn(new Zi)!=um||fu&&bn(new fu)!=hm)&&(bn=function(e){var t=Wr(e),n=t==zA?e.constructor:void 0,r=n?pi(n):"";if(r)switch(r){case WA:return fm;case HA:return cm;case GA:return lm;case VA:return um;case KA:return hm}return t});var qA=Object.prototype,XA=qA.hasOwnProperty;function ZA(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&XA.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Na=Zn.Uint8Array;function JA(e){var t=new e.constructor(e.byteLength);return new Na(t).set(new Na(e)),t}function YA(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var QA=/\w*$/;function tx(e){var t=new e.constructor(e.source,QA.exec(e));return t.lastIndex=e.lastIndex,t}var dm=gn?gn.prototype:void 0,pm=dm?dm.valueOf:void 0;function ex(e){return pm?Object(pm.call(e)):{}}function nx(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var rx="[object Boolean]",ix="[object Date]",sx="[object Map]",ox="[object Number]",ax="[object RegExp]",cx="[object Set]",lx="[object String]",ux="[object Symbol]",hx="[object ArrayBuffer]",fx="[object DataView]",dx="[object Float32Array]",px="[object Float64Array]",mx="[object Int8Array]",gx="[object Int16Array]",yx="[object Int32Array]",_x="[object Uint8Array]",bx="[object Uint8ClampedArray]",wx="[object Uint16Array]",vx="[object Uint32Array]";function Ex(e,t,n){var r=e.constructor;switch(t){case hx:return JA(e);case rx:case ix:return new r(+e);case fx:return YA(e);case dx:case px:case mx:case gx:case yx:case _x:case bx:case wx:case vx:return nx(e);case sx:return new r;case ox:case lx:return new r(e);case ax:return tx(e);case cx:return new r;case ux:return ex(e)}}function kx(e){return typeof e.constructor=="function"&&!zs(e)?u2(V0(e)):{}}var Sx="[object Map]";function Ax(e){return Ln(e)&&bn(e)==Sx}var mm=Hr&&Hr.isMap,xx=mm?Ra(mm):Ax,Tx="[object Set]";function Rx(e){return Ln(e)&&bn(e)==Tx}var gm=Hr&&Hr.isSet,Ix=gm?Ra(gm):Rx,ym="[object Arguments]",Ox="[object Array]",Cx="[object Boolean]",Nx="[object Date]",Lx="[object Error]",_m="[object Function]",Mx="[object GeneratorFunction]",Ux="[object Map]",Px="[object Number]",bm="[object Object]",Dx="[object RegExp]",Bx="[object Set]",Fx="[object String]",$x="[object Symbol]",jx="[object WeakMap]",zx="[object ArrayBuffer]",Wx="[object DataView]",Hx="[object Float32Array]",Gx="[object Float64Array]",Vx="[object Int8Array]",Kx="[object Int16Array]",qx="[object Int32Array]",Xx="[object Uint8Array]",Zx="[object Uint8ClampedArray]",Jx="[object Uint16Array]",Yx="[object Uint32Array]",Xt={};Xt[ym]=Xt[Ox]=Xt[zx]=Xt[Wx]=Xt[Cx]=Xt[Nx]=Xt[Hx]=Xt[Gx]=Xt[Vx]=Xt[Kx]=Xt[qx]=Xt[Ux]=Xt[Px]=Xt[bm]=Xt[Dx]=Xt[Bx]=Xt[Fx]=Xt[$x]=Xt[Xx]=Xt[Zx]=Xt[Jx]=Xt[Yx]=!0,Xt[Lx]=Xt[_m]=Xt[jx]=!1;function La(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!yn(e))return e;var a=Ut(e);if(a)return o=ZA(e),f2(e,o);var c=bn(e),u=c==_m||c==Mx;if(Ws(e))return UA(e);if(c==bm||c==ym||u&&!i)return o=u?{}:kx(e),BA(e,LA(o,e));if(!Xt[c])return i?e:{};o=Ex(e,c),s||(s=new Yn);var l=s.get(e);if(l)return l;s.set(e,o),Ix(e)?e.forEach(function(f){o.add(La(f,t,n,f,e,s))}):xx(e)&&e.forEach(function(f,p){o.set(p,La(f,t,n,p,e,s))});var h=Ou,d=a?void 0:h(e);return R0(d||e,function(f,p){d&&(p=f,f=e[p]),xa(o,p,La(f,t,n,p,e,s))}),o}var Qx=4;function Ne(e){return La(e,Qx)}function qs(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var tT="__lodash_hash_undefined__";function eT(e){return this.__data__.set(e,tT),this}function nT(e){return this.__data__.has(e)}function Ji(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new vr;++t<n;)this.add(e[t])}Ji.prototype.add=Ji.prototype.push=eT,Ji.prototype.has=nT;function wm(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Lu(e,t){return e.has(t)}var rT=1,iT=2;function vm(e,t,n,r,i,s){var o=n&rT,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),l=s.get(t);if(u&&l)return u==t&&l==e;var h=-1,d=!0,f=n&iT?new Ji:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var p=e[h],m=t[h];if(r)var b=o?r(m,p,h,t,e,s):r(p,m,h,e,t,s);if(b!==void 0){if(b)continue;d=!1;break}if(f){if(!wm(t,function(_,w){if(!Lu(f,w)&&(p===_||i(p,_,n,r,s)))return f.push(w)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function sT(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Mu(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var oT=1,aT=2,cT="[object Boolean]",lT="[object Date]",uT="[object Error]",hT="[object Map]",fT="[object Number]",dT="[object RegExp]",pT="[object Set]",mT="[object String]",gT="[object Symbol]",yT="[object ArrayBuffer]",_T="[object DataView]",Em=gn?gn.prototype:void 0,Uu=Em?Em.valueOf:void 0;function bT(e,t,n,r,i,s,o){switch(n){case _T:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case yT:return!(e.byteLength!=t.byteLength||!s(new Na(e),new Na(t)));case cT:case lT:case fT:return js(+e,+t);case uT:return e.name==t.name&&e.message==t.message;case dT:case mT:return e==t+"";case hT:var a=sT;case pT:var c=r&oT;if(a||(a=Mu),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;r|=aT,o.set(e,t);var l=vm(a(e),a(t),r,i,s,o);return o.delete(e),l;case gT:if(Uu)return Uu.call(e)==Uu.call(t)}return!1}var wT=1,vT=Object.prototype,ET=vT.hasOwnProperty;function kT(e,t,n,r,i,s){var o=n&wT,a=Ou(e),c=a.length,u=Ou(t),l=u.length;if(c!=l&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in t:ET.call(t,d)))return!1}var f=s.get(e),p=s.get(t);if(f&&p)return f==t&&p==e;var m=!0;s.set(e,t),s.set(t,e);for(var b=o;++h<c;){d=a[h];var _=e[d],w=t[d];if(r)var E=o?r(w,_,d,t,e,s):r(_,w,d,e,t,s);if(!(E===void 0?_===w||i(_,w,n,r,s):E)){m=!1;break}b||(b=d=="constructor")}if(m&&!b){var A=e.constructor,L=t.constructor;A!=L&&"constructor"in e&&"constructor"in t&&!(typeof A=="function"&&A instanceof A&&typeof L=="function"&&L instanceof L)&&(m=!1)}return s.delete(e),s.delete(t),m}var ST=1,km="[object Arguments]",Sm="[object Array]",Ma="[object Object]",AT=Object.prototype,Am=AT.hasOwnProperty;function xT(e,t,n,r,i,s){var o=Ut(e),a=Ut(t),c=o?Sm:bn(e),u=a?Sm:bn(t);c=c==km?Ma:c,u=u==km?Ma:u;var l=c==Ma,h=u==Ma,d=c==u;if(d&&Ws(e)){if(!Ws(t))return!1;o=!0,l=!1}if(d&&!l)return s||(s=new Yn),o||bu(e)?vm(e,t,n,r,i,s):bT(e,t,c,n,r,i,s);if(!(n&ST)){var f=l&&Am.call(e,"__wrapped__"),p=h&&Am.call(t,"__wrapped__");if(f||p){var m=f?e.value():e,b=p?t.value():t;return s||(s=new Yn),i(m,b,n,r,s)}}return d?(s||(s=new Yn),kT(e,t,n,r,i,s)):!1}function Pu(e,t,n,r,i){return e===t?!0:e==null||t==null||!Ln(e)&&!Ln(t)?e!==e&&t!==t:xT(e,t,n,r,Pu,i)}var TT=1,RT=2;function IT(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],u=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var l=new Yn,h;if(!(h===void 0?Pu(u,c,TT|RT,r,l):h))return!1}}return!0}function xm(e){return e===e&&!yn(e)}function OT(e){for(var t=_n(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,xm(i)]}return t}function Tm(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function CT(e){var t=OT(e);return t.length==1&&t[0][2]?Tm(t[0][0],t[0][1]):function(n){return n===e||IT(n,e,t)}}function NT(e,t){return e!=null&&t in Object(e)}function Rm(e,t,n){t=Ca(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=Ks(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&yu(i)&&Aa(o,i)&&(Ut(e)||Ta(e)))}function LT(e,t){return e!=null&&Rm(e,t,NT)}var MT=1,UT=2;function PT(e,t){return wu(e)&&xm(t)?Tm(Ks(e),t):function(n){var r=QS(n,e);return r===void 0&&r===t?LT(n,e):Pu(t,r,MT|UT)}}function DT(e){return function(t){return t==null?void 0:t[e]}}function BT(e){return function(t){return Eu(t,e)}}function FT(e){return wu(e)?DT(Ks(e)):BT(e)}function Qn(e){return typeof e=="function"?e:e==null?Xi:typeof e=="object"?Ut(e)?PT(e[0],e[1]):CT(e):FT(e)}function $T(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function jT(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var zT=jT();function WT(e,t){return e&&zT(e,t,_n)}function HT(e,t){return function(n,r){if(n==null)return n;if(!Jn(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var yi=HT(WT);function GT(e,t,n,r){return yi(e,function(i,s,o){t(r,i,n(i),o)}),r}function VT(e,t){return function(n,r){var i=Ut(n)?$T:GT,s=t?t():{};return i(n,e,Qn(r),s)}}var Im=Object.prototype,KT=Im.hasOwnProperty,Du=gu(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&N0(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=W0(s),a=-1,c=o.length;++a<c;){var u=o[a],l=e[u];(l===void 0||js(l,Im[u])&&!KT.call(e,u))&&(e[u]=s[u])}return e});function Om(e){return Ln(e)&&Jn(e)}var qT=200;function XT(e,t,n,r){var i=-1,s=O0,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;t.length>=qT&&(s=Lu,o=!1,t=new Ji(t));t:for(;++i<a;){var l=e[i],h=l;if(l=l!==0?l:0,o&&h===h){for(var d=u;d--;)if(t[d]===h)continue t;c.push(l)}else s(t,h,r)||c.push(l)}return c}var Ua=gu(function(e,t){return Om(e)?XT(e,Su(t,1,Om,!0)):[]});function Yi(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function Le(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:ka(t),Au(e,t<0?0:t,r)):[]}function Xs(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:ka(t),t=r-t,Au(e,0,t<0?0:t)):[]}function ZT(e){return typeof e=="function"?e:Xi}function gt(e,t){var n=Ut(e)?R0:yi;return n(e,ZT(t))}function JT(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function YT(e,t){var n=!0;return yi(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function Mn(e,t,n){var r=Ut(e)?JT:YT;return r(e,Qn(t))}function Cm(e,t){var n=[];return yi(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function wn(e,t){var n=Ut(e)?Ru:Cm;return n(e,Qn(t))}function QT(e){return function(t,n,r){var i=Object(t);if(!Jn(t)){var s=Qn(n);t=_n(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var tR=Math.max;function eR(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:ka(n);return i<0&&(i=tR(r+i,0)),I0(e,Qn(t),i)}var Qi=QT(eR);function Un(e){return e&&e.length?e[0]:void 0}function nR(e,t){var n=-1,r=Jn(e)?Array(e.length):[];return yi(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function lt(e,t){var n=Ut(e)?Ea:nR;return n(e,Qn(t))}function vn(e,t){return Su(lt(e,t))}var rR=Object.prototype,iR=rR.hasOwnProperty,Nm=VT(function(e,t,n){iR.call(e,n)?e[n].push(t):pu(e,n,[t])}),sR=Object.prototype,oR=sR.hasOwnProperty;function aR(e,t){return e!=null&&oR.call(e,t)}function mt(e,t){return e!=null&&Rm(e,t,aR)}var cR="[object String]";function qe(e){return typeof e=="string"||!Ut(e)&&Ln(e)&&Wr(e)==cR}function lR(e,t){return Ea(t,function(n){return e[n]})}function fe(e){return e==null?[]:lR(e,_n(e))}var uR=Math.max;function ze(e,t,n,r){e=Jn(e)?e:fe(e),n=n&&!r?ka(n):0;var i=e.length;return n<0&&(n=uR(i+n,0)),qe(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&du(e,t,n)>-1}function Lm(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return du(e,t,i)}var hR="[object Map]",fR="[object Set]",dR=Object.prototype,pR=dR.hasOwnProperty;function Zt(e){if(e==null)return!0;if(Jn(e)&&(Ut(e)||typeof e=="string"||typeof e.splice=="function"||Ws(e)||bu(e)||Ta(e)))return!e.length;var t=bn(e);if(t==hR||t==fR)return!e.size;if(zs(e))return!z0(e).length;for(var n in e)if(pR.call(e,n))return!1;return!0}var mR="[object RegExp]";function gR(e){return Ln(e)&&Wr(e)==mR}var Mm=Hr&&Hr.isRegExp,Er=Mm?Ra(Mm):gR;function kr(e){return e===void 0}var yR="Expected a function";function _R(e){if(typeof e!="function")throw new TypeError(yR);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function bR(e,t,n,r){if(!yn(e))return e;t=Ca(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=Ks(t[i]),u=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var l=a[c];u=void 0,u===void 0&&(u=yn(l)?l:Aa(t[i+1])?[]:{})}xa(a,c,u),a=a[c]}return e}function wR(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Eu(e,o);n(a,o)&&bR(s,Ca(o,e),a)}return s}function Pn(e,t){if(e==null)return{};var n=Ea(jA(e),function(r){return[r]});return t=Qn(t),wR(e,n,function(r,i){return t(r,i[0])})}function vR(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function Xe(e,t,n){var r=Ut(e)?xA:vR,i=arguments.length<3;return r(e,Qn(t),n,i,yi)}function Pa(e,t){var n=Ut(e)?Ru:Cm;return n(e,_R(Qn(t)))}function ER(e,t){var n;return yi(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function Bu(e,t,n){var r=Ut(e)?wm:ER;return r(e,Qn(t))}var kR=1/0,SR=Zi&&1/Mu(new Zi([,-0]))[1]==kR?function(e){return new Zi(e)}:ve,AR=200;function xR(e,t,n){var r=-1,i=O0,s=e.length,o=!0,a=[],c=a;if(s>=AR){var u=SR(e);if(u)return Mu(u);o=!1,i=Lu,c=new Ji}else c=a;t:for(;++r<s;){var l=e[r],h=l;if(l=l!==0?l:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue t;a.push(l)}else i(c,h,n)||(c!==a&&c.push(h),a.push(l))}return a}function Da(e){return e&&e.length?xR(e):[]}function Fu(e){console&&console.error&&console.error(`Error: ${e}`)}function Um(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function Pm(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function Dm(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function TR(e){return RR(e)?e.LABEL:e.name}function RR(e){return qe(e.LABEL)&&e.LABEL!==""}class tr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),gt(this.definition,n=>{n.accept(t)})}}class Ze extends tr{constructor(t){super([]),this.idx=1,Ke(this,Pn(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class ts extends tr{constructor(t){super(t.definition),this.orgText="",Ke(this,Pn(t,n=>n!==void 0))}}class Je extends tr{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Ke(this,Pn(t,n=>n!==void 0))}}class Ye extends tr{constructor(t){super(t.definition),this.idx=1,Ke(this,Pn(t,n=>n!==void 0))}}class er extends tr{constructor(t){super(t.definition),this.idx=1,Ke(this,Pn(t,n=>n!==void 0))}}class nr extends tr{constructor(t){super(t.definition),this.idx=1,Ke(this,Pn(t,n=>n!==void 0))}}class Ee extends tr{constructor(t){super(t.definition),this.idx=1,Ke(this,Pn(t,n=>n!==void 0))}}class Dn extends tr{constructor(t){super(t.definition),this.idx=1,Ke(this,Pn(t,n=>n!==void 0))}}class Bn extends tr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Ke(this,Pn(t,n=>n!==void 0))}}class ne{constructor(t){this.idx=1,Ke(this,Pn(t,n=>n!==void 0))}accept(t){t.visit(this)}}function IR(e){return lt(e,Ba)}function Ba(e){function t(n){return lt(n,Ba)}if(e instanceof Ze){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return qe(e.label)&&(n.label=e.label),n}else{if(e instanceof Je)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Ye)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof er)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof nr)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Ba(new ne({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Dn)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Ba(new ne({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Ee)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof Bn)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof ne){const n={type:"Terminal",name:e.terminalType.name,label:TR(e.terminalType),idx:e.idx};qe(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=Er(r)?r.source:r),n}else{if(e instanceof ts)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class _i{visit(t){const n=t;switch(n.constructor){case Ze:return this.visitNonTerminal(n);case Je:return this.visitAlternative(n);case Ye:return this.visitOption(n);case er:return this.visitRepetitionMandatory(n);case nr:return this.visitRepetitionMandatoryWithSeparator(n);case Dn:return this.visitRepetitionWithSeparator(n);case Ee:return this.visitRepetition(n);case Bn:return this.visitAlternation(n);case ne:return this.visitTerminal(n);case ts:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function OR(e){return e instanceof Je||e instanceof Ye||e instanceof Ee||e instanceof er||e instanceof nr||e instanceof Dn||e instanceof ne||e instanceof ts}function Fa(e,t=[]){return e instanceof Ye||e instanceof Ee||e instanceof Dn?!0:e instanceof Bn?Bu(e.definition,r=>Fa(r,t)):e instanceof Ze&&ze(t,e)?!1:e instanceof tr?(e instanceof Ze&&t.push(e),Mn(e.definition,r=>Fa(r,t))):!1}function CR(e){return e instanceof Bn}function rr(e){if(e instanceof Ze)return"SUBRULE";if(e instanceof Ye)return"OPTION";if(e instanceof Bn)return"OR";if(e instanceof er)return"AT_LEAST_ONE";if(e instanceof nr)return"AT_LEAST_ONE_SEP";if(e instanceof Dn)return"MANY_SEP";if(e instanceof Ee)return"MANY";if(e instanceof ne)return"CONSUME";throw Error("non exhaustive match")}class $a{walk(t,n=[]){gt(t.definition,(r,i)=>{const s=Le(t.definition,i+1);if(r instanceof Ze)this.walkProdRef(r,s,n);else if(r instanceof ne)this.walkTerminal(r,s,n);else if(r instanceof Je)this.walkFlat(r,s,n);else if(r instanceof Ye)this.walkOption(r,s,n);else if(r instanceof er)this.walkAtLeastOne(r,s,n);else if(r instanceof nr)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Dn)this.walkManySep(r,s,n);else if(r instanceof Ee)this.walkMany(r,s,n);else if(r instanceof Bn)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new Ye({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=Bm(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new Ye({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=Bm(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);gt(t.definition,s=>{const o=new Je({definition:[s]});this.walk(o,i)})}}function Bm(e,t,n){return[new Ye({definition:[new ne({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function Zs(e){if(e instanceof Ze)return Zs(e.referencedRule);if(e instanceof ne)return MR(e);if(OR(e))return NR(e);if(CR(e))return LR(e);throw Error("non exhaustive match")}function NR(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=Fa(s),t=t.concat(Zs(s)),r=r+1,i=n.length>r;return Da(t)}function LR(e){const t=lt(e.definition,n=>Zs(n));return Da(an(t))}function MR(e){return[e.terminalType]}const Fm="_~IN~_";class UR extends $a{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=DR(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new Je({definition:s}),a=Zs(o);this.follows[i]=a}}function PR(e){const t={};return gt(e,n=>{const r=new UR(n).startWalking();Ke(t,r)}),t}function DR(e,t){return e.name+t+Fm}function yt(e){return e.charCodeAt(0)}function $u(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function Js(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function es(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function BR(){throw Error("Internal Error - Should never get here!")}function $m(e){return e.type==="Character"}const ja=[];for(let e=yt("0");e<=yt("9");e++)ja.push(e);const za=[yt("_")].concat(ja);for(let e=yt("a");e<=yt("z");e++)za.push(e);for(let e=yt("A");e<=yt("Z");e++)za.push(e);const jm=[yt(" "),yt("\f"),yt(`
`),yt("\r"),yt("	"),yt("\v"),yt("	"),yt(""),yt(""),yt(""),yt(""),yt(""),yt(""),yt(""),yt(""),yt(""),yt(""),yt(""),yt(""),yt(""),yt("\u2028"),yt("\u2029"),yt(""),yt(""),yt(""),yt("\uFEFF")],FR=/[0-9a-fA-F]/,Wa=/[0-9]/,$R=/[1-9]/;class jR{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Js(r,"global");break;case"i":Js(r,"ignoreCase");break;case"m":Js(r,"multiLine");break;case"u":Js(r,"unicode");break;case"y":Js(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}es(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return BR()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;es(n);break}if(!(t===!0&&n===void 0)&&es(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),es(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[yt(`
`),yt("\r"),yt("\u2028"),yt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=ja;break;case"D":t=ja,n=!0;break;case"s":t=jm;break;case"S":t=jm,n=!0;break;case"w":t=za;break;case"W":t=za,n=!0;break}if(es(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=yt("\f");break;case"n":t=yt(`
`);break;case"r":t=yt("\r");break;case"t":t=yt("	");break;case"v":t=yt("\v");break}if(es(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:yt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:yt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:yt(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,$m(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,$m(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else $u(r.value,t),t.push(yt("-")),$u(i.value,t)}else $u(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:yt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if($R.test(t)===!1)throw Error("Expecting a positive integer");for(;Wa.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(Wa.test(t)===!1)throw Error("Expecting an integer");for(;Wa.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:yt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Wa.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(FR.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class ju{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let Ha={};const zR=new jR;function Ga(e){const t=e.toString();if(Ha.hasOwnProperty(t))return Ha[t];{const n=zR.pattern(t);return Ha[t]=n,n}}function WR(){Ha={}}const zm="Complement Sets are not supported for first char optimization",Va=`Unable to use "first char" lexer optimizations:
`;function HR(e,t=!1){try{const n=Ga(e);return zu(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===zm)t&&Um(`${Va}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Fu(`${Va}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function zu(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)zu(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Ka(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(zm);gt(o.value,c=>{if(typeof c=="number")Ka(c,t,n);else{const u=c;if(n===!0)for(let l=u.from;l<=u.to;l++)Ka(l,t,n);else{for(let l=u.from;l<=u.to&&l<Qs;l++)Ka(l,t,n);if(u.to>=Qs){const l=u.from>=Qs?u.from:Qs,h=u.to,d=Gr(l),f=Gr(h);for(let p=d;p<=f;p++)t[p]=p}}}});break;case"Group":zu(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Wu(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return fe(t)}function Ka(e,t,n){const r=Gr(e);t[r]=r,n===!0&&GR(e,t)}function GR(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Gr(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Gr(i.charCodeAt(0));t[s]=s}}}function Wm(e,t){return Qi(e.value,n=>{if(typeof n=="number")return ze(t,n);{const r=n;return Qi(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function Wu(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?Ut(e.value)?Mn(e.value,Wu):Wu(e.value):!1}class VR extends ju{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){ze(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?Wm(t,this.targetCharCodes)===void 0&&(this.found=!0):Wm(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Hu(e,t){if(t instanceof RegExp){const n=Ga(t),r=new VR(e);return r.visit(n),r.found}else return Qi(t,n=>ze(e,n.charCodeAt(0)))!==void 0}const bi="PATTERN",Ys="defaultMode",qa="modes";let Hm=typeof new RegExp("(?:)").sticky=="boolean";function KR(e,t){t=Du(t,{useSticky:Hm,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(w,E)=>E()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{gI()});let r;n("Reject Lexer.NA",()=>{r=Pa(e,w=>w[bi]===ke.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=lt(r,w=>{const E=w[bi];if(Er(E)){const A=E.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!E.ignoreCase?A:A.length===2&&A[0]==="\\"&&!ze(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:t.useSticky?Vm(E):Gm(E)}else{if(br(E))return i=!0,{exec:E};if(typeof E=="object")return i=!0,E;if(typeof E=="string"){if(E.length===1)return E;{const A=E.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),L=new RegExp(A);return t.useSticky?Vm(L):Gm(L)}}else throw Error("non exhaustive match")}})});let o,a,c,u,l;n("misc mapping",()=>{o=lt(r,w=>w.tokenTypeIdx),a=lt(r,w=>{const E=w.GROUP;if(E!==ke.SKIPPED){if(qe(E))return E;if(kr(E))return!1;throw Error("non exhaustive match")}}),c=lt(r,w=>{const E=w.LONGER_ALT;if(E)return Ut(E)?lt(E,L=>Lm(r,L)):[Lm(r,E)]}),u=lt(r,w=>w.PUSH_MODE),l=lt(r,w=>mt(w,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const w=Xm(t.lineTerminatorCharacters);h=lt(r,E=>!1),t.positionTracking!=="onlyOffset"&&(h=lt(r,E=>mt(E,"LINE_BREAKS")?!!E.LINE_BREAKS:qm(E,w)===!1&&Hu(w,E.PATTERN)))});let d,f,p,m;n("Misc Mapping #2",()=>{d=lt(r,Km),f=lt(s,dI),p=Xe(r,(w,E)=>{const A=E.GROUP;return qe(A)&&A!==ke.SKIPPED&&(w[A]=[]),w},{}),m=lt(s,(w,E)=>({pattern:s[E],longerAlt:c[E],canLineTerminator:h[E],isCustom:d[E],short:f[E],group:a[E],push:u[E],pop:l[E],tokenTypeIdx:o[E],tokenType:r[E]}))});let b=!0,_=[];return t.safeMode||n("First Char Optimization",()=>{_=Xe(r,(w,E,A)=>{if(typeof E.PATTERN=="string"){const L=E.PATTERN.charCodeAt(0),I=Gr(L);Gu(w,I,m[A])}else if(Ut(E.START_CHARS_HINT)){let L;gt(E.START_CHARS_HINT,I=>{const R=typeof I=="string"?I.charCodeAt(0):I,D=Gr(R);L!==D&&(L=D,Gu(w,D,m[A]))})}else if(Er(E.PATTERN))if(E.PATTERN.unicode)b=!1,t.ensureOptimizations&&Fu(`${Va}	Unable to analyze < ${E.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const L=HR(E.PATTERN,t.ensureOptimizations);Zt(L)&&(b=!1),gt(L,I=>{Gu(w,I,m[A])})}else t.ensureOptimizations&&Fu(`${Va}	TokenType: <${E.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),b=!1;return w},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:_,hasCustom:i,canBeOptimized:b}}function qR(e,t){let n=[];const r=ZR(e);n=n.concat(r.errors);const i=JR(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(XR(s)),n=n.concat(sI(s)),n=n.concat(oI(s,t)),n=n.concat(aI(s)),n}function XR(e){let t=[];const n=wn(e,r=>Er(r[bi]));return t=t.concat(QR(n)),t=t.concat(nI(n)),t=t.concat(rI(n)),t=t.concat(iI(n)),t=t.concat(tI(n)),t}function ZR(e){const t=wn(e,i=>!mt(i,bi)),n=lt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:ae.MISSING_PATTERN,tokenTypes:[i]})),r=Ua(e,t);return{errors:n,valid:r}}function JR(e){const t=wn(e,i=>{const s=i[bi];return!Er(s)&&!br(s)&&!mt(s,"exec")&&!qe(s)}),n=lt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:ae.INVALID_PATTERN,tokenTypes:[i]})),r=Ua(e,t);return{errors:n,valid:r}}const YR=/[^\\][$]/;function QR(e){class t extends ju{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=wn(e,i=>{const s=i.PATTERN;try{const o=Ga(s),a=new t;return a.visit(o),a.found}catch{return YR.test(s.source)}});return lt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ae.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function tI(e){const t=wn(e,r=>r.PATTERN.test(""));return lt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:ae.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const eI=/[^\\[][\^]|^\^/;function nI(e){class t extends ju{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=wn(e,i=>{const s=i.PATTERN;try{const o=Ga(s),a=new t;return a.visit(o),a.found}catch{return eI.test(s.source)}});return lt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ae.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function rI(e){const t=wn(e,r=>{const i=r[bi];return i instanceof RegExp&&(i.multiline||i.global)});return lt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:ae.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function iI(e){const t=[];let n=lt(e,s=>Xe(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!ze(t,a)&&a.PATTERN!==ke.NA&&(t.push(a),o.push(a)),o),[]));n=qs(n);const r=wn(n,s=>s.length>1);return lt(r,s=>{const o=lt(s,c=>c.name);return{message:`The same RegExp pattern ->${Un(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:ae.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function sI(e){const t=wn(e,r=>{if(!mt(r,"GROUP"))return!1;const i=r.GROUP;return i!==ke.SKIPPED&&i!==ke.NA&&!qe(i)});return lt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:ae.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function oI(e,t){const n=wn(e,i=>i.PUSH_MODE!==void 0&&!ze(t,i.PUSH_MODE));return lt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:ae.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function aI(e){const t=[],n=Xe(e,(r,i,s)=>{const o=i.PATTERN;return o===ke.NA||(qe(o)?r.push({str:o,idx:s,tokenType:i}):Er(o)&&lI(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return gt(e,(r,i)=>{gt(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&cI(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:ae.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function cI(e,t){if(Er(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(br(t))return t(e,0,[],{});if(mt(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function lI(e){return Qi([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function Gm(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function Vm(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function uI(e,t,n){const r=[];return mt(e,Ys)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Ys+`> property in its definition
`,type:ae.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),mt(e,qa)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+qa+`> property in its definition
`,type:ae.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),mt(e,qa)&&mt(e,Ys)&&!mt(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${Ys}: <${e.defaultMode}>which does not exist
`,type:ae.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),mt(e,qa)&&gt(e.modes,(i,s)=>{gt(i,(o,a)=>{if(kr(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:ae.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(mt(o,"LONGER_ALT")){const c=Ut(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];gt(c,u=>{!kr(u)&&!ze(i,u)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${u.name}> on token <${o.name}> outside of mode <${s}>
`,type:ae.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function hI(e,t,n){const r=[];let i=!1;const s=qs(an(fe(e.modes))),o=Pa(s,c=>c[bi]===ke.NA),a=Xm(n);return t&&gt(o,c=>{const u=qm(c,a);if(u!==!1){const h={message:mI(c,u),type:u.issue,tokenType:c};r.push(h)}else mt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):Hu(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:ae.NO_LINE_BREAKS_FLAGS}),r}function fI(e){const t={},n=_n(e);return gt(n,r=>{const i=e[r];if(Ut(i))t[r]=[];else throw Error("non exhaustive match")}),t}function Km(e){const t=e.PATTERN;if(Er(t))return!1;if(br(t))return!0;if(mt(t,"exec"))return!0;if(qe(t))return!1;throw Error("non exhaustive match")}function dI(e){return qe(e)&&e.length===1?e.charCodeAt(0):!1}const pI={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function qm(e,t){if(mt(e,"LINE_BREAKS"))return!1;if(Er(e.PATTERN)){try{Hu(t,e.PATTERN)}catch(n){return{issue:ae.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(qe(e.PATTERN))return!1;if(Km(e))return{issue:ae.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function mI(e,t){if(t.issue===ae.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===ae.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Xm(e){return lt(e,n=>qe(n)?n.charCodeAt(0):n)}function Gu(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const Qs=256;let Xa=[];function Gr(e){return e<Qs?e:Xa[e]}function gI(){if(Zt(Xa)){Xa=new Array(65536);for(let e=0;e<65536;e++)Xa[e]=e>255?255+~~(e/255):e}}function to(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function Za(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let Zm=1;const Jm={};function eo(e){const t=yI(e);_I(t),wI(t),bI(t),gt(t,n=>{n.isParent=n.categoryMatches.length>0})}function yI(e){let t=Ne(e),n=e,r=!0;for(;r;){n=qs(an(lt(n,s=>s.CATEGORIES)));const i=Ua(n,t);t=t.concat(i),Zt(i)?r=!1:n=i}return t}function _I(e){gt(e,t=>{Qm(t)||(Jm[Zm]=t,t.tokenTypeIdx=Zm++),tg(t)&&!Ut(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),tg(t)||(t.CATEGORIES=[]),vI(t)||(t.categoryMatches=[]),EI(t)||(t.categoryMatchesMap={})})}function bI(e){gt(e,t=>{t.categoryMatches=[],gt(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(Jm[r].tokenTypeIdx)})})}function wI(e){gt(e,t=>{Ym([],t)})}function Ym(e,t){gt(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),gt(t.CATEGORIES,n=>{const r=e.concat(t);ze(r,n)||Ym(r,n)})}function Qm(e){return mt(e,"tokenTypeIdx")}function tg(e){return mt(e,"CATEGORIES")}function vI(e){return mt(e,"categoryMatches")}function EI(e){return mt(e,"categoryMatchesMap")}function kI(e){return mt(e,"tokenTypeIdx")}const SI={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var ae;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(ae||(ae={}));const no={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:SI,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(no);class ke{constructor(t,n=no){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Pm(s),u=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&u(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Ke({},no,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===no.lineTerminatorsPattern)this.config.lineTerminatorsPattern=pI;else if(this.config.lineTerminatorCharacters===no.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Ut(t)?i={modes:{defaultMode:Ne(t)},defaultMode:Ys}:(s=!1,i=Ne(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(uI(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(hI(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},gt(i.modes,(a,c)=>{i.modes[c]=Pa(a,u=>kr(u))});const o=_n(i.modes);if(gt(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(qR(a,o))}),Zt(this.lexerDefinitionErrors)){eo(a);let u;this.TRACE_INIT("analyzeTokenTypes",()=>{u=KR(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=u.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=u.charCodeToPatternIdxToConfig,this.emptyGroups=Ke({},this.emptyGroups,u.emptyGroups),this.hasCustom=u.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=u.canBeOptimized}})}),this.defaultMode=i.defaultMode,!Zt(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=lt(this.lexerDefinitionErrors,u=>u.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}gt(this.lexerDefinitionWarning,a=>{Um(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Hm?(this.chopInput=Xi,this.match=this.matchWithTest):(this.updateLastIndex=ve,this.match=this.matchWithExec),s&&(this.handleModes=ve),this.trackStartLines===!1&&(this.computeNewColumn=Xi),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=ve),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Xe(this.canModeBeOptimized,(c,u,l)=>(u===!1&&c.push(l),c),[]);if(n.ensureOptimizations&&!Zt(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{WR()}),this.TRACE_INIT("toFastProperties",()=>{Dm(this)})})}tokenize(t,n=this.defaultMode){if(!Zt(this.lexerDefinitionErrors)){const i=lt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,u,l,h,d,f,p,m,b,_;const w=t,E=w.length;let A=0,L=0;const I=this.hasCustom?0:Math.floor(t.length/10),R=new Array(I),D=[];let C=this.trackStartLines?1:void 0,q=this.trackStartLines?1:void 0;const ot=fI(this.emptyGroups),O=this.trackStartLines,k=this.config.lineTerminatorsPattern;let g=0,N=[],j=[];const M=[],tt=[];Object.freeze(tt);let G;function Q(){return N}function U(kt){const Dt=Gr(kt),wt=j[Dt];return wt===void 0?tt:wt}const B=kt=>{if(M.length===1&&kt.tokenType.PUSH_MODE===void 0){const Dt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(kt);D.push({offset:kt.startOffset,line:kt.startLine,column:kt.startColumn,length:kt.image.length,message:Dt})}else{M.pop();const Dt=Yi(M);N=this.patternIdxToConfig[Dt],j=this.charCodeToPatternIdxToConfig[Dt],g=N.length;const wt=this.canModeBeOptimized[Dt]&&this.config.safeMode===!1;j&&wt?G=U:G=Q}};function ut(kt){M.push(kt),j=this.charCodeToPatternIdxToConfig[kt],N=this.patternIdxToConfig[kt],g=N.length,g=N.length;const Dt=this.canModeBeOptimized[kt]&&this.config.safeMode===!1;j&&Dt?G=U:G=Q}ut.call(this,n);let et;const nt=this.config.recoveryEnabled;for(;A<E;){c=null;const kt=w.charCodeAt(A),Dt=G(kt),wt=Dt.length;for(r=0;r<wt;r++){et=Dt[r];const _t=et.pattern;u=null;const Wt=et.short;if(Wt!==!1?kt===Wt&&(c=_t):et.isCustom===!0?(_=_t.exec(w,A,R,ot),_!==null?(c=_[0],_.payload!==void 0&&(u=_.payload)):c=null):(this.updateLastIndex(_t,A),c=this.match(_t,t,A)),c!==null){if(a=et.longerAlt,a!==void 0){const $t=a.length;for(s=0;s<$t;s++){const ye=N[a[s]],Se=ye.pattern;if(l=null,ye.isCustom===!0?(_=Se.exec(w,A,R,ot),_!==null?(o=_[0],_.payload!==void 0&&(l=_.payload)):o=null):(this.updateLastIndex(Se,A),o=this.match(Se,t,A)),o&&o.length>c.length){c=o,u=l,et=ye;break}}}break}}if(c!==null){if(h=c.length,d=et.group,d!==void 0&&(f=et.tokenTypeIdx,p=this.createTokenInstance(c,A,f,et.tokenType,C,q,h),this.handlePayload(p,u),d===!1?L=this.addToken(R,L,p):ot[d].push(p)),t=this.chopInput(t,h),A=A+h,q=this.computeNewColumn(q,h),O===!0&&et.canLineTerminator===!0){let _t=0,Wt,$t;k.lastIndex=0;do Wt=k.test(c),Wt===!0&&($t=k.lastIndex-1,_t++);while(Wt===!0);_t!==0&&(C=C+_t,q=h-$t,this.updateTokenEndLineColumnLocation(p,d,$t,_t,C,q,h))}this.handleModes(et,B,ut,p)}else{const _t=A,Wt=C,$t=q;let ye=nt===!1;for(;ye===!1&&A<E;)for(t=this.chopInput(t,1),A++,i=0;i<g;i++){const Se=N[i],y=Se.pattern,X=Se.short;if(X!==!1?w.charCodeAt(A)===X&&(ye=!0):Se.isCustom===!0?ye=y.exec(w,A,R,ot)!==null:(this.updateLastIndex(y,A),ye=y.exec(t)!==null),ye===!0)break}if(m=A-_t,q=this.computeNewColumn(q,m),b=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(w,_t,m,Wt,$t),D.push({offset:_t,line:Wt,column:$t,length:m,message:b}),nt===!1)break}}return this.hasCustom||(R.length=L),{tokens:R,groups:ot,errors:D}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,u;n!==void 0&&(c=r===a-1,u=c?-1:0,i===1&&c===!0||(t.endLine=s+u,t.endColumn=o-1+-u))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}}ke.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",ke.NA=/NOT_APPLICABLE/;function ro(e){return eg(e)?e.LABEL:e.name}function eg(e){return qe(e.LABEL)&&e.LABEL!==""}const AI="parent",ng="categories",rg="label",ig="group",sg="push_mode",og="pop_mode",ag="longer_alt",cg="line_breaks",lg="start_chars_hint";function cn(e){return xI(e)}function xI(e){const t=e.pattern,n={};if(n.name=e.name,kr(t)||(n.PATTERN=t),mt(e,AI))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return mt(e,ng)&&(n.CATEGORIES=e[ng]),eo([n]),mt(e,rg)&&(n.LABEL=e[rg]),mt(e,ig)&&(n.GROUP=e[ig]),mt(e,og)&&(n.POP_MODE=e[og]),mt(e,sg)&&(n.PUSH_MODE=e[sg]),mt(e,ag)&&(n.LONGER_ALT=e[ag]),mt(e,cg)&&(n.LINE_BREAKS=e[cg]),mt(e,lg)&&(n.START_CHARS_HINT=e[lg]),n}const wi=cn({name:"EOF",pattern:ke.NA});eo([wi]);function Ja(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function TI(e,t){return to(e,t)}const ug={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${eg(e)?`--> ${ro(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Un(t).image+"'";if(r)return s+r+a;{const c=Xe(e,(d,f)=>d.concat(f),[]),u=lt(c,d=>`[${lt(d,f=>ro(f)).join(", ")}]`),h=`one of these possible Token sequences:
${lt(u,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Un(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${lt(e,u=>`[${lt(u,l=>ro(l)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(ug);const RI={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},vi={buildDuplicateFoundError(e,t){function n(l){return l instanceof ne?l.terminalType.name:l instanceof Ze?l.nonTerminalName:""}const r=e.name,i=Un(t),s=i.idx,o=rr(i),a=n(i),c=s>0;let u=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return u=u.replace(/[ \t]+/g," "),u=u.replace(/\s\s+/g,`
`),u},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=lt(e.prefixPath,i=>ro(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=lt(e.prefixPath,i=>ro(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=rr(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=lt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof ts?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function II(e,t){const n=new OI(e,t);return n.resolveRefs(),n.errors}class OI extends _i{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){gt(fe(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:We.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class CI extends $a{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Ne(this.path.ruleStack).reverse(),this.occurrenceStack=Ne(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){Zt(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class NI extends CI{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Je({definition:i});this.possibleTokTypes=Zs(s),this.found=!0}}}class Ya extends $a{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class LI extends Ya{walkMany(t,n,r){if(t.idx===this.occurrence){const i=Un(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class hg extends Ya{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=Un(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class MI extends Ya{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=Un(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class fg extends Ya{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=Un(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function Vu(e,t,n=[]){n=Ne(n);let r=[],i=0;function s(a){return a.concat(Le(e,i+1))}function o(a){const c=Vu(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof Je)return o(a.definition);if(a instanceof Ze)return o(a.definition);if(a instanceof Ye)r=o(a.definition);else if(a instanceof er){const c=a.definition.concat([new Ee({definition:a.definition})]);return o(c)}else if(a instanceof nr){const c=[new Je({definition:a.definition}),new Ee({definition:[new ne({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Dn){const c=a.definition.concat([new Ee({definition:[new ne({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Ee){const c=a.definition.concat([new Ee({definition:a.definition})]);r=o(c)}else{if(a instanceof Bn)return gt(a.definition,c=>{Zt(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof ne)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:Le(e,i)}),r}function dg(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,u=c-r-1,l=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!Zt(h);){const d=h.pop();if(d===o){a&&Yi(h).idx<=u&&h.pop();continue}const f=d.def,p=d.idx,m=d.ruleStack,b=d.occurrenceStack;if(Zt(f))continue;const _=f[0];if(_===i){const w={idx:p,def:Le(f),ruleStack:Xs(m),occurrenceStack:Xs(b)};h.push(w)}else if(_ instanceof ne)if(p<c-1){const w=p+1,E=t[w];if(n(E,_.terminalType)){const A={idx:w,def:Le(f),ruleStack:m,occurrenceStack:b};h.push(A)}}else if(p===c-1)l.push({nextTokenType:_.terminalType,nextTokenOccurrence:_.idx,ruleStack:m,occurrenceStack:b}),a=!0;else throw Error("non exhaustive match");else if(_ instanceof Ze){const w=Ne(m);w.push(_.nonTerminalName);const E=Ne(b);E.push(_.idx);const A={idx:p,def:_.definition.concat(s,Le(f)),ruleStack:w,occurrenceStack:E};h.push(A)}else if(_ instanceof Ye){const w={idx:p,def:Le(f),ruleStack:m,occurrenceStack:b};h.push(w),h.push(o);const E={idx:p,def:_.definition.concat(Le(f)),ruleStack:m,occurrenceStack:b};h.push(E)}else if(_ instanceof er){const w=new Ee({definition:_.definition,idx:_.idx}),E=_.definition.concat([w],Le(f)),A={idx:p,def:E,ruleStack:m,occurrenceStack:b};h.push(A)}else if(_ instanceof nr){const w=new ne({terminalType:_.separator}),E=new Ee({definition:[w].concat(_.definition),idx:_.idx}),A=_.definition.concat([E],Le(f)),L={idx:p,def:A,ruleStack:m,occurrenceStack:b};h.push(L)}else if(_ instanceof Dn){const w={idx:p,def:Le(f),ruleStack:m,occurrenceStack:b};h.push(w),h.push(o);const E=new ne({terminalType:_.separator}),A=new Ee({definition:[E].concat(_.definition),idx:_.idx}),L=_.definition.concat([A],Le(f)),I={idx:p,def:L,ruleStack:m,occurrenceStack:b};h.push(I)}else if(_ instanceof Ee){const w={idx:p,def:Le(f),ruleStack:m,occurrenceStack:b};h.push(w),h.push(o);const E=new Ee({definition:_.definition,idx:_.idx}),A=_.definition.concat([E],Le(f)),L={idx:p,def:A,ruleStack:m,occurrenceStack:b};h.push(L)}else if(_ instanceof Bn)for(let w=_.definition.length-1;w>=0;w--){const E=_.definition[w],A={idx:p,def:E.definition.concat(Le(f)),ruleStack:m,occurrenceStack:b};h.push(A),h.push(o)}else if(_ instanceof Je)h.push({idx:p,def:_.definition.concat(Le(f)),ruleStack:m,occurrenceStack:b});else if(_ instanceof ts)h.push(UI(_,p,m,b));else throw Error("non exhaustive match")}return l}function UI(e,t,n,r){const i=Ne(n);i.push(e.name);const s=Ne(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var ce;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(ce||(ce={}));function pg(e){if(e instanceof Ye||e==="Option")return ce.OPTION;if(e instanceof Ee||e==="Repetition")return ce.REPETITION;if(e instanceof er||e==="RepetitionMandatory")return ce.REPETITION_MANDATORY;if(e instanceof nr||e==="RepetitionMandatoryWithSeparator")return ce.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Dn||e==="RepetitionWithSeparator")return ce.REPETITION_WITH_SEPARATOR;if(e instanceof Bn||e==="Alternation")return ce.ALTERNATION;throw Error("non exhaustive match")}function PI(e,t,n,r,i,s){const o=qu(e,t,n),a=_g(o)?Za:to;return s(o,r,a,i)}function DI(e,t,n,r,i,s){const o=Xu(e,t,i,n),a=_g(o)?Za:to;return s(o[0],a,r)}function BI(e,t,n,r){const i=e.length,s=Mn(e,o=>Mn(o,a=>a.length===1));if(t)return function(o){const a=lt(o,c=>c.GATE);for(let c=0;c<i;c++){const u=e[c],l=u.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let d=0;d<l;d++){const f=u[d],p=f.length;for(let m=0;m<p;m++){const b=this.LA(m+1);if(n(b,f[m])===!1)continue t}return c}}};if(s&&!r){const o=lt(e,c=>an(c)),a=Xe(o,(c,u,l)=>(gt(u,h=>{mt(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=l),gt(h.categoryMatches,d=>{mt(c,d)||(c[d]=l)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let u=0;u<c;u++){const l=a[u],h=l.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,l[d])===!1)continue t}return o}}}}function FI(e,t,n){const r=Mn(e,s=>s.length===1),i=e.length;if(r&&!n){const s=an(e);if(s.length===1&&Zt(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Xe(s,(a,c,u)=>(a[c.tokenTypeIdx]=!0,gt(c.categoryMatches,l=>{a[l]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const u=this.LA(c+1);if(t(u,o[c])===!1)continue t}return!0}return!1}}class $I extends $a{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,ce.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,ce.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,ce.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,ce.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,ce.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class mg extends _i{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,ce.OPTION)}visitRepetition(t){this.checkIsTarget(t,ce.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,ce.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,ce.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,ce.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,ce.ALTERNATION)}}function gg(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function Ku(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function jI(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function yg(e,t){const n=lt(e,o=>Vu([o],1)),r=gg(n.length),i=lt(n,o=>{const a={};return gt(o,c=>{const u=Ku(c.partialPath);gt(u,l=>{a[l]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=gg(a.length);for(let c=0;c<a.length;c++){const u=a[c];for(let l=0;l<u.length;l++){const h=u[l].partialPath,d=u[l].suffixDef,f=Ku(h);if(jI(i,f,c)||Zt(d)||h.length===t){const m=r[c];if(Zu(m,h)===!1){m.push(h);for(let b=0;b<f.length;b++){const _=f[b];i[c][_]=!0}}}else{const m=Vu(d,o+1,h);s[c]=s[c].concat(m),gt(m,b=>{const _=Ku(b.partialPath);gt(_,w=>{i[c][w]=!0})})}}}}return r}function qu(e,t,n,r){const i=new mg(e,ce.ALTERNATION,r);return t.accept(i),yg(i.result,n)}function Xu(e,t,n,r){const i=new mg(e,n);t.accept(i);const s=i.result,a=new $I(t,e,n).startWalking(),c=new Je({definition:s}),u=new Je({definition:a});return yg([c,u],r)}function Zu(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function zI(e,t){return e.length<t.length&&Mn(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function _g(e){return Mn(e,t=>Mn(t,n=>Mn(n,r=>Zt(r.categoryMatches))))}function WI(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return lt(t,n=>Object.assign({type:We.CUSTOM_LOOKAHEAD_VALIDATION},n))}function HI(e,t,n,r){const i=vn(e,c=>GI(c,n)),s=rO(e,t,n),o=vn(e,c=>QI(c,n)),a=vn(e,c=>qI(c,e,r,n));return i.concat(s,o,a)}function GI(e,t){const n=new KI;e.accept(n);const r=n.allProductions,i=Nm(r,VI),s=Pn(i,a=>a.length>1);return lt(fe(s),a=>{const c=Un(a),u=t.buildDuplicateFoundError(e,a),l=rr(c),h={message:u,type:We.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:l,occurrence:c.idx},d=bg(c);return d&&(h.parameter=d),h})}function VI(e){return`${rr(e)}_#_${e.idx}_#_${bg(e)}`}function bg(e){return e instanceof ne?e.terminalType.name:e instanceof Ze?e.nonTerminalName:""}class KI extends _i{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function qI(e,t,n,r){const i=[];if(Xe(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:We.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function XI(e,t,n){const r=[];let i;return ze(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:We.INVALID_RULE_OVERRIDE,ruleName:e})),r}function wg(e,t,n,r=[]){const i=[],s=Qa(t.definition);if(Zt(s))return[];{const o=e.name;ze(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:We.LEFT_RECURSION,ruleName:o});const c=Ua(s,r.concat([e])),u=vn(c,l=>{const h=Ne(r);return h.push(l),wg(e,l,n,h)});return i.concat(u)}}function Qa(e){let t=[];if(Zt(e))return t;const n=Un(e);if(n instanceof Ze)t.push(n.referencedRule);else if(n instanceof Je||n instanceof Ye||n instanceof er||n instanceof nr||n instanceof Dn||n instanceof Ee)t=t.concat(Qa(n.definition));else if(n instanceof Bn)t=an(lt(n.definition,s=>Qa(s.definition)));else if(!(n instanceof ne))throw Error("non exhaustive match");const r=Fa(n),i=e.length>1;if(r&&i){const s=Le(e);return t.concat(Qa(s))}else return t}class Ju extends _i{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function ZI(e,t){const n=new Ju;e.accept(n);const r=n.alternations;return vn(r,s=>{const o=Xs(s.definition);return vn(o,(a,c)=>{const u=dg([a],[],to,1);return Zt(u)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:We.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function JI(e,t,n){const r=new Ju;e.accept(r);let i=r.alternations;return i=Pa(i,o=>o.ignoreAmbiguities===!0),vn(i,o=>{const a=o.idx,c=o.maxLookahead||t,u=qu(a,e,c,o),l=eO(u,o,e,n),h=nO(u,o,e,n);return l.concat(h)})}class YI extends _i{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function QI(e,t){const n=new Ju;e.accept(n);const r=n.alternations;return vn(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:We.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function tO(e,t,n){const r=[];return gt(e,i=>{const s=new YI;i.accept(s);const o=s.allProductions;gt(o,a=>{const c=pg(a),u=a.maxLookahead||t,l=a.idx,d=Xu(l,i,c,u)[0];if(Zt(an(d))){const f=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:f,type:We.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function eO(e,t,n,r){const i=[],s=Xe(e,(a,c,u)=>(t.definition[u].ignoreAmbiguities===!0||gt(c,l=>{const h=[u];gt(e,(d,f)=>{u!==f&&Zu(d,l)&&t.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!Zu(i,l)&&(i.push(l),a.push({alts:h,path:l}))}),a),[]);return lt(s,a=>{const c=lt(a.alts,l=>l+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:We.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function nO(e,t,n,r){const i=Xe(e,(o,a,c)=>{const u=lt(a,l=>({idx:c,path:l}));return o.concat(u)},[]);return qs(vn(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,u=o.path,l=wn(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&zI(d.path,u));return lt(l,d=>{const f=[d.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:f,prefixPath:d.path}),type:We.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:f}})}))}function rO(e,t,n){const r=[],i=lt(t,s=>s.name);return gt(e,s=>{const o=s.name;if(ze(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:We.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function iO(e){const t=Du(e,{errMsgProvider:RI}),n={};return gt(e.rules,r=>{n[r.name]=r}),II(n,t.errMsgProvider)}function sO(e){return e=Du(e,{errMsgProvider:vi}),HI(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const vg="MismatchedTokenException",Eg="NoViableAltException",kg="EarlyExitException",Sg="NotAllInputParsedException",Ag=[vg,Eg,kg,Sg];Object.freeze(Ag);function tc(e){return ze(Ag,e.name)}class ec extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class xg extends ec{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=vg}}class oO extends ec{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Eg}}class aO extends ec{constructor(t,n){super(t,n),this.name=Sg}}class cO extends ec{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=kg}}const Yu={},Tg="InRuleRecoveryException";class lO extends Error{constructor(t){super(t),this.name=Tg}}class uO{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=mt(t,"recoveryEnabled")?t.recoveryEnabled:Sr.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=hO)}getTokenToInsert(t){const n=Ja(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const u=this.LA(1);let l=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:u,previous:d,ruleName:this.getCurrRuleFullName()}),p=new xg(f,u,this.LA(0));p.resyncedTokens=Xs(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(l,i)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(l,s)?c=!0:(l=this.SKIP_TOKEN(),this.addToResyncTokens(l,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new lO("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||Zt(n))return!1;const r=this.LA(1);return Qi(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return ze(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Qi(t,s=>TI(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Yu;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return lt(t,(r,i)=>i===0?Yu:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=lt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return an(t)}getFollowSetFromFollowKey(t){if(t===Yu)return[wi];const n=t.ruleName+t.idxInCallingRule+Fm+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,wi)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Xs(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=Ne(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return lt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function hO(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new s(f,i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,l=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&u===void 0&&(u=wi,l=1),!(u===void 0||l===void 0)&&this.shouldInRepetitionRecoveryBeTried(u,l,o)&&this.tryInRepetitionRecovery(e,t,n,u)}const fO=4,Vr=8,Rg=1<<Vr,Ig=2<<Vr,Qu=3<<Vr,th=4<<Vr,eh=5<<Vr,nc=6<<Vr;function nh(e,t,n){return n|t|e}class dO{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:Sr.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(Zt(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return vn(t,n=>wg(n,n,vi))}validateEmptyOrAlternatives(t){return vn(t,n=>ZI(n,vi))}validateAmbiguousAlternationAlternatives(t,n){return vn(t,r=>JI(r,n,vi))}validateSomeNonEmptyLookaheadPath(t,n){return tO(t,n,vi)}buildLookaheadForAlternation(t){return PI(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,BI)}buildLookaheadForOptional(t){return DI(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,pg(t.prodType),FI)}}class pO{initLooksAhead(t){this.dynamicTokensEnabled=mt(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Sr.dynamicTokensEnabled,this.maxLookahead=mt(t,"maxLookahead")?t.maxLookahead:Sr.maxLookahead,this.lookaheadStrategy=mt(t,"lookaheadStrategy")?t.lookaheadStrategy:new dO({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){gt(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=gO(n);gt(r,u=>{const l=u.idx===0?"":u.idx;this.TRACE_INIT(`${rr(u)}${l}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:u.idx,rule:n,maxLookahead:u.maxLookahead||this.maxLookahead,hasPredicates:u.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=nh(this.fullRuleNameToShort[n.name],Rg,u.idx);this.setLaFuncCache(d,h)})}),gt(i,u=>{this.computeLookaheadFunc(n,u.idx,Qu,"Repetition",u.maxLookahead,rr(u))}),gt(s,u=>{this.computeLookaheadFunc(n,u.idx,Ig,"Option",u.maxLookahead,rr(u))}),gt(o,u=>{this.computeLookaheadFunc(n,u.idx,th,"RepetitionMandatory",u.maxLookahead,rr(u))}),gt(a,u=>{this.computeLookaheadFunc(n,u.idx,nc,"RepetitionMandatoryWithSeparator",u.maxLookahead,rr(u))}),gt(c,u=>{this.computeLookaheadFunc(n,u.idx,eh,"RepetitionWithSeparator",u.maxLookahead,rr(u))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=nh(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return nh(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class mO extends _i{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const rc=new mO;function gO(e){rc.reset(),e.accept(rc);const t=rc.dslMethods;return rc.reset(),t}function Og(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function Cg(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function yO(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function _O(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const bO="name";function Ng(e,t){Object.defineProperty(e,bO,{enumerable:!1,configurable:!0,writable:!1,value:t})}function wO(e,t){const n=_n(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const u=o[c];u.tokenTypeIdx===void 0&&this[u.name](u.children,t)}}}function vO(e,t){const n=function(){};Ng(n,e+"BaseSemantics");const r={visit:function(i,s){if(Ut(i)&&(i=i[0]),!kr(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=kO(this,t);if(!Zt(i)){const s=lt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function EO(e,t,n){const r=function(){};Ng(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return gt(t,s=>{i[s]=wO}),r.prototype=i,r.prototype.constructor=r,r}var rh;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(rh||(rh={}));function kO(e,t){return SO(e,t)}function SO(e,t){const n=wn(t,i=>br(e[i])===!1),r=lt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:rh.MISSING_METHOD,methodName:i}));return qs(r)}class AO{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=mt(t,"nodeLocationTracking")?t.nodeLocationTracking:Sr.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=ve,this.cstFinallyStateUpdate=ve,this.cstPostTerminal=ve,this.cstPostNonTerminal=ve,this.cstPostRule=ve;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Cg,this.setNodeLocationFromNode=Cg,this.cstPostRule=ve,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=ve,this.setNodeLocationFromNode=ve,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Og,this.setNodeLocationFromNode=Og,this.cstPostRule=ve,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=ve,this.setNodeLocationFromNode=ve,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=ve,this.setNodeLocationFromNode=ve,this.cstPostRule=ve,this.setInitialNodeLocation=ve;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];yO(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];_O(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(kr(this.baseCstVisitorConstructor)){const t=vO(this.className,_n(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(kr(this.baseCstVisitorWithDefaultsConstructor)){const t=EO(this.className,_n(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class xO{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):oc}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?oc:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class TO{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=ac){if(ze(this.definedRulesNames,t)){const o={message:vi.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:We.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=ac){const i=XI(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(tc(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return IR(fe(this.gastProductionsCache))}}class RO{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Za,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},mt(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Ut(t)){if(Zt(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Ut(t))this.tokensMap=Xe(t,(s,o)=>(s[o.name]=o,s),{});else if(mt(t,"modes")&&Mn(an(fe(t.modes)),kI)){const s=an(fe(t.modes)),o=Da(s);this.tokensMap=Xe(o,(a,c)=>(a[c.name]=c,a),{})}else if(yn(t))this.tokensMap=Ne(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=wi;const r=mt(t,"modes")?an(fe(t.modes)):fe(t),i=Mn(r,s=>Zt(s.categoryMatches));this.tokenMatcher=i?Za:to,eo(fe(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=mt(r,"resyncEnabled")?r.resyncEnabled:ac.resyncEnabled,s=mt(r,"recoveryValueFunc")?r.recoveryValueFunc:ac.recoveryValueFunc,o=this.ruleShortNameIdx<<fO+Vr;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...l){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...l){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(tc(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(Ig,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(th,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,ce.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,th,t,MI)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(nc,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,fg],a,nc,t,fg)}else throw this.raiseEarlyExitException(t,ce.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(Qu,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,Qu,t,LI,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(eh,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,hg],a,eh,t,hg)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,nc,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(Rg,n),i=Ut(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new aO(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw tc(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new xg(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===Tg?r:s}}else throw r}saveRecogState(){const t=this.errors,n=Ne(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),wi)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class IO{initErrorHandler(t){this._errors=[],this.errorMessageProvider=mt(t,"errorMessageProvider")?t.errorMessageProvider:Sr.errorMessageProvider}SAVE_ERROR(t){if(tc(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Ne(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Ne(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Xu(t,s,n,this.maxLookahead)[0],c=[];for(let l=1;l<=this.maxLookahead;l++)c.push(this.LA(l));const u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new cO(u,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=qu(t,i,this.maxLookahead),o=[];for(let u=1;u<=this.maxLookahead;u++)o.push(this.LA(u));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new oO(c,this.LA(1),a))}}class OO{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(kr(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return dg([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=Un(t.ruleStack),i=this.getGAstProductions()[n];return new NI(i,t).startWalking()}}const ic={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(ic);const Lg=!0,Mg=Math.pow(2,Vr)-1,Ug=cn({name:"RECORDING_PHASE_TOKEN",pattern:ke.NA});eo([Ug]);const Pg=Ja(Ug,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Pg);const CO={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class NO{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return oc}topLevelRuleRecord(t,n){try{const r=new ts({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return io.call(this,Ye,t,n)}atLeastOneInternalRecord(t,n){io.call(this,er,n,t)}atLeastOneSepFirstInternalRecord(t,n){io.call(this,nr,n,t,Lg)}manyInternalRecord(t,n){io.call(this,Ee,n,t)}manySepFirstInternalRecord(t,n){io.call(this,Dn,n,t,Lg)}orInternalRecord(t,n){return LO.call(this,t,n)}subruleInternalRecord(t,n,r){if(sc(n),!t||mt(t,"ruleName")===!1){const a=new Error(`<SUBRULE${Dg(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Yi(this.recordingProdStack),s=t.ruleName,o=new Ze({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?CO:ic}consumeInternalRecord(t,n,r){if(sc(n),!Qm(t)){const o=new Error(`<CONSUME${Dg(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Yi(this.recordingProdStack),s=new ne({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),Pg}}function io(e,t,n,r=!1){sc(n);const i=Yi(this.recordingProdStack),s=br(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),mt(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),ic}function LO(e,t){sc(t);const n=Yi(this.recordingProdStack),r=Ut(e)===!1,i=r===!1?e:e.DEF,s=new Bn({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});mt(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=Bu(i,a=>br(a.GATE));return s.hasPredicates=o,n.definition.push(s),gt(i,a=>{const c=new Je({definition:[]});s.definition.push(c),mt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:mt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),ic}function Dg(e){return e===0?"":`${e}`}function sc(e){if(e<0||e>Mg){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${Mg+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class MO{initPerformanceTracer(t){if(mt(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Sr.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=Pm(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function UO(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const oc=Ja(wi,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(oc);const Sr=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:ug,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),ac=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var We;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(We||(We={}));class so{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Dm(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),gt(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=iO({rules:fe(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(Zt(r)&&this.skipValidations===!1){const i=sO({rules:fe(this.gastProductionsCache),tokenTypes:fe(this.tokensMap),errMsgProvider:vi,grammarName:n}),s=WI({lookaheadStrategy:this.lookaheadStrategy,rules:fe(this.gastProductionsCache),tokenTypes:fe(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),Zt(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=PR(fe(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:fe(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(fe(this.gastProductionsCache))})),!so.DEFER_DEFINITION_ERRORS_HANDLING&&!Zt(this.definitionErrors))throw t=lt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),mt(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=mt(n,"skipValidations")?n.skipValidations:Sr.skipValidations}}so.DEFER_DEFINITION_ERRORS_HANDLING=!1,UO(so,[uO,pO,AO,xO,RO,TO,IO,OO,NO,MO]);class PO extends so{constructor(t,n=Sr){const r=Ne(n);r.outputCst=!0,super(t,r)}}function DO(e){const t=new BO,n=fe(e);return lt(n,r=>t.visitRule(r))}class BO extends _i{visitRule(t){const n=this.visitEach(t.definition),r=Nm(n,s=>s.propertyName),i=lt(r,(s,o)=>{const a=!Bu(s,u=>!u.canBeNull);let c=s[0].type;return s.length>1&&(c=lt(s,u=>u.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:cc(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:cc(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:cc(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:cc(t)}]}visitEachAndOverrideWith(t,n){return lt(this.visitEach(t),r=>Ke({},r,n))}visitEach(t){return an(lt(t,n=>this.visit(n)))}}function cc(e){return e instanceof Ze?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function FO(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(an(lt(e,r=>$O(r)))),t.includeVisitorInterface&&(n=n.concat(HO(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function $O(e){const t=jO(e),n=zO(e);return[t,n]}function jO(e){const t=Fg(e.name),n=ih(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function zO(e){return`export type ${ih(e.name)} = {
  ${lt(e.properties,n=>WO(n)).join(`
  `)}
};`}function WO(e){const t=VO(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function HO(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${lt(t,n=>GO(n)).join(`
  `)}
}`}function GO(e){const t=ih(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function VO(e){if(Ut(e)){const t=Da(lt(e,r=>Bg(r)));return"("+Xe(t,(r,i)=>r+" | "+i)+")"}else return Bg(e)}function Bg(e){return e.kind==="token"?"IToken":Fg(e.name)}function Fg(e){return tm(e)+"CstNode"}function ih(e){return tm(e)+"CstChildren"}const KO={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function qO(e,t){const n=Object.assign(Object.assign({},KO),t),r=DO(e);return FO(r,n)}const sh=au(32,126).map(e=>String.fromCharCode(e));function It(e){return cn({...e,name:`token_${e.name}`})}function Fn(e,t=!1){return It(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:He,group:ke.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:He})}const oo=It({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),XO=It({name:"whitespace",pattern:/ +/,group:ke.SKIPPED}),ZO=It({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:ke.SKIPPED}),oh=It({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),ns=It({name:"command",pattern:/#/,start_chars_hint:["#"]});let $g=!1;function JO(e,t,n){if(!$g)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==oo)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const jg=It({name:"text",pattern:JO,line_breaks:!1,start_chars_hint:sh.filter(e=>"@#/?':!".includes(e)===!1)}),zg=It({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Wg=It({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Hg=It({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Gg=It({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),He=It({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:sh}),Vg=It({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Kg=It({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),qg=It({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:He}),Xg=It({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:He}),Zg=It({name:"islessthan",pattern:/<|below/,longer_alt:He}),Jg=It({name:"isgreaterthan",pattern:/>|above/,longer_alt:He}),Yg=It({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:He}),Qg=It({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:He}),ah=It({name:"or",pattern:/or/i,longer_alt:He}),ch=It({name:"not",pattern:/not/i,longer_alt:He}),lh=It({name:"and",pattern:/and/i,longer_alt:He}),uh=It({name:"plus",pattern:/\+/}),hh=It({name:"minus",pattern:/-/}),ty=It({name:"power",pattern:/\*\*/}),ey=It({name:"multiply",pattern:/\*/}),fh=It({name:"divide",pattern:/\//}),ny=It({name:"moddivide",pattern:/%/}),ry=It({name:"floordivide",pattern:/%%/}),iy=It({name:"query",pattern:/\?/}),sy=It({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),oy=It({name:"rparen",pattern:/\)/,pop_mode:!0}),ay=It({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:sh,longer_alt:He}),dh=Fn("if"),lc=Fn("do"),YO=Fn("to",!0),ph=Fn("done"),QO=Fn("then",!0),mh=Fn("else"),cy=Fn("while"),ly=Fn("repeat"),uy=Fn("waitfor"),hy=It({name:"foreach",pattern:/foreach|for/,longer_alt:He}),fy=Fn("break"),dy=Fn("continue");function py(e){return[...e,Kg,qg,Xg,Yg,Zg,Qg,Jg,ah,ch,lh,uh,hh,ty,ey,fh,ry,ny,iy,sy,oy,Vg,He]}const my=py([jg,oh,ay,ns,zg,Wg,Hg,Gg,oo,XO,fy,dy,ph,lc,mh,hy,dh,ly,QO,YO,uy,cy]),tC=new ke({defaultMode:"use_newlines",modes:{use_newlines:my,ignore_newlines:py([ZO])}},{skipValidations:!qn,ensureOptimizations:qn});function gy(e){$g=!0;const t=tC.tokenize(e||` 
`),[n]=(Ht(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(Ja(oo,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function yy(e,t=!0){const[n,...r]=e;switch(Ct(n)){default:return t?{type:ft.OBJECT,values:e}:{type:ft.CONST,values:e};case"loader":return{type:ft.LOADER,values:r};case"board":return{type:ft.BOARD,values:r};case"object":return{type:ft.OBJECT,values:r};case"terrain":return{type:ft.TERRAIN,values:r};case"charset":return{type:ft.CHARSET,values:r};case"palette":return{type:ft.PALETTE,values:r};case"rn":case"range":return{type:ft.RANGE,values:r};case"sl":case"select":return{type:ft.SELECT,values:r};case"nm":case"number":return{type:ft.NUMBER,values:r};case"tx":case"text":return{type:ft.TEXT,values:r};case"ln":case"link":return{type:ft.LINK,values:r};case"hk":case"hotkey":return{type:ft.HOTKEY,values:r};case"scroll":return{type:ft.SCROLL,values:r};case"copyit":return{type:ft.COPYIT,values:r}}}function En(e){switch(e){case ft.LOADER:return"loader";case ft.BOARD:return"board";case ft.OBJECT:return"object";case ft.TERRAIN:return"terrain";case ft.CHARSET:return"charset";case ft.PALETTE:return"palette";case ft.CONST:return"const";case ft.RANGE:return"range";case ft.SELECT:return"select";case ft.NUMBER:return"number";case ft.TEXT:return"text";case ft.LINK:return"link";case ft.HOTKEY:return"hotkey";case ft.SCROLL:return"scroll";case ft.COPYIT:return"copyit"}}var gh;try{gh=new TextDecoder}catch{}var st,kn,P=0,Jt={},Lt,Kr,Sn=0,ir=0,Re,Ar,Qe=[],Ot,_y={useRecords:!1,mapsAsObjects:!0};class by{}const wy=new by;wy.name="MessagePack 0xC1";var qr=!1,vy=2,Ey;try{new Function("")}catch{vy=1/0}class ao{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(st)return Uy(()=>(vh(),this?this.unpack(t,n):ao.prototype.unpack.call(_y,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof Buffer<"u"?Buffer.from(t):new Uint8Array(t)),typeof n=="object"?(kn=n.end||t.length,P=n.start||0):(P=0,kn=n>-1?n:t.length),ir=0,Kr=null,Re=null,st=t;try{Ot=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw st=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof ao){if(Jt=this,this.structures)return Lt=this.structures,uc(n);(!Lt||Lt.length>0)&&(Lt=[])}else Jt=_y,(!Lt||Lt.length>0)&&(Lt=[]);return uc(n)}unpackMultiple(t,n){let r,i=0;try{qr=!0;let s=t.length,o=this?this.unpack(t,s):hc.unpack(t,s);if(n){if(n(o,i,P)===!1)return;for(;P<s;)if(i=P,n(uc(),i,P)===!1)return}else{for(r=[o];P<s;)i=P,r.push(uc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{qr=!1,vh()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function uc(e){try{if(!Jt.trusted&&!qr){let n=Lt.sharedLength||0;n<Lt.length&&(Lt.length=n)}let t;if(Jt.randomAccessStructure&&st[P]<64&&st[P]>=32&&Ey?(t=Ey(st,P,kn,Jt),st=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),P=kn):t=le(),Re&&(P=Re.postBundlePosition,Re=null),qr&&(Lt.restoreStructures=null),P==kn)Lt&&Lt.restoreStructures&&ky(),Lt=null,st=null,Ar&&(Ar=null);else{if(P>kn)throw new Error("Unexpected end of MessagePack data");if(!qr){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Lt&&Lt.restoreStructures&&ky(),vh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||P>kn)&&(t.incomplete=!0),t}}function ky(){for(let e in Lt.restoreStructures)Lt[e]=Lt.restoreStructures[e];Lt.restoreStructures=null}function le(){let e=st[P++];if(e<160)if(e<128){if(e<64)return e;{let t=Lt[e&63]||Jt.getStructures&&Ay()[e&63];return t?(t.read||(t.read=yh(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,Jt.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Cy();r==="__proto__"&&(r="__proto_"),t[r]=le()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(le(),le());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=le();return Jt.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(ir>=P)return Kr.slice(P-Sn,(P+=t)-Sn);if(ir==0&&kn<140){let n=t<16?bh(t):Ry(t);if(n!=null)return n}return _h(t)}else{let t;switch(e){case 192:return null;case 193:return Re?(t=le(),t>0?Re[1].slice(Re.position1,Re.position1+=t):Re[0].slice(Re.position0,Re.position0-=t)):wy;case 194:return!1;case 195:return!0;case 196:if(t=st[P++],t===void 0)throw new Error("Unexpected end of buffer");return wh(t);case 197:return t=Ot.getUint16(P),P+=2,wh(t);case 198:return t=Ot.getUint32(P),P+=4,wh(t);case 199:return Ei(st[P++]);case 200:return t=Ot.getUint16(P),P+=2,Ei(t);case 201:return t=Ot.getUint32(P),P+=4,Ei(t);case 202:if(t=Ot.getFloat32(P),Jt.useFloat32>2){let n=Eh[(st[P]&127)<<1|st[P+1]>>7];return P+=4,(n*t+(t>0?.5:-.5)>>0)/n}return P+=4,t;case 203:return t=Ot.getFloat64(P),P+=8,t;case 204:return st[P++];case 205:return t=Ot.getUint16(P),P+=2,t;case 206:return t=Ot.getUint32(P),P+=4,t;case 207:return Jt.int64AsType==="number"?(t=Ot.getUint32(P)*4294967296,t+=Ot.getUint32(P+4)):Jt.int64AsType==="string"?t=Ot.getBigUint64(P).toString():Jt.int64AsType==="auto"?(t=Ot.getBigUint64(P),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Ot.getBigUint64(P),P+=8,t;case 208:return Ot.getInt8(P++);case 209:return t=Ot.getInt16(P),P+=2,t;case 210:return t=Ot.getInt32(P),P+=4,t;case 211:return Jt.int64AsType==="number"?(t=Ot.getInt32(P)*4294967296,t+=Ot.getUint32(P+4)):Jt.int64AsType==="string"?t=Ot.getBigInt64(P).toString():Jt.int64AsType==="auto"?(t=Ot.getBigInt64(P),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Ot.getBigInt64(P),P+=8,t;case 212:if(t=st[P++],t==114)return Ly(st[P++]&63);{let n=Qe[t];if(n)return n.read?(P++,n.read(le())):n.noBuffer?(P++,n()):n(st.subarray(P,++P));throw new Error("Unknown extension "+t)}case 213:return t=st[P],t==114?(P++,Ly(st[P++]&63,st[P++])):Ei(2);case 214:return Ei(4);case 215:return Ei(8);case 216:return Ei(16);case 217:return t=st[P++],ir>=P?Kr.slice(P-Sn,(P+=t)-Sn):nC(t);case 218:return t=Ot.getUint16(P),P+=2,ir>=P?Kr.slice(P-Sn,(P+=t)-Sn):rC(t);case 219:return t=Ot.getUint32(P),P+=4,ir>=P?Kr.slice(P-Sn,(P+=t)-Sn):iC(t);case 220:return t=Ot.getUint16(P),P+=2,xy(t);case 221:return t=Ot.getUint32(P),P+=4,xy(t);case 222:return t=Ot.getUint16(P),P+=2,Ty(t);case 223:return t=Ot.getUint32(P),P+=4,Ty(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const eC=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function yh(e,t){function n(){if(n.count++>vy){let i=e.read=new Function("r","return function(){return "+(Jt.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":eC.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(le);return e.highByte===0&&(e.read=Sy(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=le()}return Jt.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?Sy(t,n):n}const Sy=(e,t)=>function(){let n=st[P++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Lt[r]||Ay()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=yh(i,e)),i.read()};function Ay(){let e=Uy(()=>(st=null,Jt.getStructures()));return Lt=Jt._mergeStructures(e,Lt)}var _h=co,nC=co,rC=co,iC=co;function co(e){let t;if(e<16&&(t=bh(e)))return t;if(e>64&&gh)return gh.decode(st.subarray(P,P+=e));const n=P+e,r=[];for(t="";P<n;){const i=st[P++];if(!(i&128))r.push(i);else if((i&224)===192){const s=st[P++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=st[P++]&63,o=st[P++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=st[P++]&63,o=st[P++]&63,a=st[P++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=Ie.apply(String,r),r.length=0)}return r.length>0&&(t+=Ie.apply(String,r)),t}function xy(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=le();return Jt.freezeData?Object.freeze(t):t}function Ty(e){if(Jt.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Cy();r==="__proto__"&&(r="__proto_"),t[r]=le()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(le(),le());return t}}var Ie=String.fromCharCode;function Ry(e){let t=P,n=new Array(e);for(let r=0;r<e;r++){const i=st[P++];if((i&128)>0){P=t;return}n[r]=i}return Ie.apply(String,n)}function bh(e){if(e<4)if(e<2){if(e===0)return"";{let t=st[P++];if((t&128)>1){P-=1;return}return Ie(t)}}else{let t=st[P++],n=st[P++];if((t&128)>0||(n&128)>0){P-=2;return}if(e<3)return Ie(t,n);let r=st[P++];if((r&128)>0){P-=3;return}return Ie(t,n,r)}else{let t=st[P++],n=st[P++],r=st[P++],i=st[P++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){P-=4;return}if(e<6){if(e===4)return Ie(t,n,r,i);{let s=st[P++];if((s&128)>0){P-=5;return}return Ie(t,n,r,i,s)}}else if(e<8){let s=st[P++],o=st[P++];if((s&128)>0||(o&128)>0){P-=6;return}if(e<7)return Ie(t,n,r,i,s,o);let a=st[P++];if((a&128)>0){P-=7;return}return Ie(t,n,r,i,s,o,a)}else{let s=st[P++],o=st[P++],a=st[P++],c=st[P++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){P-=8;return}if(e<10){if(e===8)return Ie(t,n,r,i,s,o,a,c);{let u=st[P++];if((u&128)>0){P-=9;return}return Ie(t,n,r,i,s,o,a,c,u)}}else if(e<12){let u=st[P++],l=st[P++];if((u&128)>0||(l&128)>0){P-=10;return}if(e<11)return Ie(t,n,r,i,s,o,a,c,u,l);let h=st[P++];if((h&128)>0){P-=11;return}return Ie(t,n,r,i,s,o,a,c,u,l,h)}else{let u=st[P++],l=st[P++],h=st[P++],d=st[P++];if((u&128)>0||(l&128)>0||(h&128)>0||(d&128)>0){P-=12;return}if(e<14){if(e===12)return Ie(t,n,r,i,s,o,a,c,u,l,h,d);{let f=st[P++];if((f&128)>0){P-=13;return}return Ie(t,n,r,i,s,o,a,c,u,l,h,d,f)}}else{let f=st[P++],p=st[P++];if((f&128)>0||(p&128)>0){P-=14;return}if(e<15)return Ie(t,n,r,i,s,o,a,c,u,l,h,d,f,p);let m=st[P++];if((m&128)>0){P-=15;return}return Ie(t,n,r,i,s,o,a,c,u,l,h,d,f,p,m)}}}}}function Iy(){let e=st[P++],t;if(e<192)t=e-160;else switch(e){case 217:t=st[P++];break;case 218:t=Ot.getUint16(P),P+=2;break;case 219:t=Ot.getUint32(P),P+=4;break;default:throw new Error("Expected string")}return co(t)}function wh(e){return Jt.copyBuffers?Uint8Array.prototype.slice.call(st,P,P+=e):st.subarray(P,P+=e)}function Ei(e){let t=st[P++];if(Qe[t]){let n;return Qe[t](st.subarray(P,n=P+=e),r=>{P=r;try{return le()}finally{P=n}})}else throw new Error("Unknown extension type "+t)}var Oy=new Array(4096);function Cy(){let e=st[P++];if(e>=160&&e<192){if(e=e-160,ir>=P)return Kr.slice(P-Sn,(P+=e)-Sn);if(!(ir==0&&kn<180))return _h(e)}else return P--,Ny(le());let t=(e<<5^(e>1?Ot.getUint16(P):e>0?st[P]:0))&4095,n=Oy[t],r=P,i=P+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Ot.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=st[r++],s!=n[o++]){r=1879048192;break}if(r===i)return P=r,n.string;i-=3,r=P}for(n=[],Oy[t]=n,n.bytes=e;r<i;)s=Ot.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=st[r++],n.push(s);let a=e<16?bh(e):Ry(e);return a!=null?n.string=a:n.string=_h(e)}function Ny(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const Ly=(e,t)=>{let n=le().map(Ny),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Lt[e];return i&&(i.isShared||qr)&&((Lt.restoreStructures||(Lt.restoreStructures=[]))[e]=i),Lt[e]=n,n.read=yh(n,r),n.read()};Qe[0]=()=>{},Qe[0].noBuffer=!0,Qe[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let sC={Error,TypeError,ReferenceError};Qe[101]=()=>{let e=le();return(sC[e[0]]||Error)(e[1],{cause:e[2]})},Qe[105]=e=>{if(Jt.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Ot.getUint32(P-4);Ar||(Ar=new Map);let n=st[P],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Ar.set(t,i);let s=le();return i.used?Object.assign(r,s):(i.target=s,s)},Qe[112]=e=>{if(Jt.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Ot.getUint32(P-4),n=Ar.get(t);return n.used=!0,n.target},Qe[115]=()=>new Set(le());const My=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let oC=typeof globalThis=="object"?globalThis:window;Qe[116]=e=>{let t=e[0],n=My[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new oC[n](Uint8Array.prototype.slice.call(e,1).buffer)},Qe[120]=()=>{let e=le();return new RegExp(e[0],e[1])};const aC=[];Qe[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=P;return P+=t-e.length,Re=aC,Re=[Iy(),Iy()],Re.position0=0,Re.position1=0,Re.postBundlePosition=P,P=n,le()},Qe[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Uy(e){let t=kn,n=P,r=Sn,i=ir,s=Kr,o=Ar,a=Re,c=new Uint8Array(st.slice(0,kn)),u=Lt,l=Lt.slice(0,Lt.length),h=Jt,d=qr,f=e();return kn=t,P=n,Sn=r,ir=i,Kr=s,Ar=o,Re=a,st=c,qr=d,Lt=u,Lt.splice(0,Lt.length,...l),Jt=h,Ot=new DataView(st.buffer,st.byteOffset,st.byteLength),f}function vh(){st=null,Ar=null,Lt=null}const Eh=new Array(147);for(let e=0;e<256;e++)Eh[e]=+("1e"+Math.floor(45.15-e*.30103));var hc=new ao({useRecords:!1});const cC=hc.unpack;hc.unpackMultiple,hc.unpack;let lC=new Float32Array(1);new Uint8Array(lC.buffer,0,4);let fc;try{fc=new TextEncoder}catch{}let kh,Py;const dc=typeof Buffer<"u",pc=dc?function(e){return Buffer.allocUnsafeSlow(e)}:Uint8Array,Dy=dc?Buffer:Uint8Array,By=dc?4294967296:2144337920;let W,lo,Yt,F=0,Ge,re=null,uC;const hC=21760,fC=/[\u0080-\uFFFF]/,rs=Symbol("record-id");class dC extends ao{constructor(t){super(t),this.offset=0;let n,r,i,s,o=Dy.prototype.utf8Write?function(k,g){return W.utf8Write(k,g,W.byteLength-g)}:fc&&fc.encodeInto?function(k,g){return fc.encodeInto(k,W.subarray(g)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,u=t.structures||t.saveStructures,l=t.maxSharedStructures;if(l==null&&(l=u?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=u?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=l>32||h+l>64,f=l+64,p=l+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],b=0,_=0;this.pack=this.encode=function(k,g){if(W||(W=new pc(8192),Yt=W.dataView||(W.dataView=new DataView(W.buffer,0,8192)),F=0),Ge=W.length-10,Ge-F<2048?(W=new pc(W.length),Yt=W.dataView||(W.dataView=new DataView(W.buffer,0,W.length)),Ge=W.length-10,F=0):F=F+7&2147483640,n=F,g&wC&&(F+=g&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof k!="string"?(re=[],re.size=1/0):re=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let j=i.sharedLength||0;if(j>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let M=0;M<j;M++){let tt=i[M];if(!tt)continue;let G,Q=i.transitions;for(let U=0,B=tt.length;U<B;U++){let ut=tt[U];G=Q[ut],G||(G=Q[ut]=Object.create(null)),Q=G}Q[rs]=M+64}this.lastNamedStructuresLength=j}c||(i.nextId=j+64)}r&&(r=!1);let N;try{a.randomAccessStructure&&k&&k.constructor&&k.constructor===Object?O(k):A(k);let j=re;if(re&&jy(n,A,0),s&&s.idsToInsert){let M=s.idsToInsert.sort((U,B)=>U.offset>B.offset?1:-1),tt=M.length,G=-1;for(;j&&tt>0;){let U=M[--tt].offset+n;U<j.stringsPosition+n&&G===-1&&(G=0),U>j.position+n?G>=0&&(G+=6):(G>=0&&(Yt.setUint32(j.position+n,Yt.getUint32(j.position+n)+G),G=-1),j=j.previous,tt++)}G>=0&&j&&Yt.setUint32(j.position+n,Yt.getUint32(j.position+n)+G),F+=M.length*6,F>Ge&&C(F),a.offset=F;let Q=mC(W.subarray(n,F),M);return s=null,Q}return a.offset=F,g&_C?(W.start=n,W.end=F,W):W.subarray(n,F)}catch(j){throw N=j,j}finally{if(i&&(w(),r&&a.saveStructures)){let j=i.sharedLength||0,M=W.subarray(n,F),tt=gC(i,a);if(!N)return a.saveStructures(tt,tt.isCompatible)===!1?a.pack(k,g):(a.lastNamedStructuresLength=j,W.length>1073741824&&(W=null),M)}W.length>1073741824&&(W=null),g&bC&&(F=n)}};const w=()=>{_<10&&_++;let k=i.sharedLength||0;if(i.length>k&&!c&&(i.length=k),b>1e4)i.transitions=null,_=0,b=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let g=0,N=m.length;g<N;g++)m[g][rs]=0;m=[]}},E=k=>{var g=k.length;g<16?W[F++]=144|g:g<65536?(W[F++]=220,W[F++]=g>>8,W[F++]=g&255):(W[F++]=221,Yt.setUint32(F,g),F+=4);for(let N=0;N<g;N++)A(k[N])},A=k=>{F>Ge&&(W=C(F));var g=typeof k,N;if(g==="string"){let j=k.length;if(re&&j>=4&&j<4096){if((re.size+=j)>hC){let Q,U=(re[0]?re[0].length*3+re[1].length:0)+10;F+U>Ge&&(W=C(F+U));let B;re.position?(B=re,W[F]=200,F+=3,W[F++]=98,Q=F-n,F+=4,jy(n,A,0),Yt.setUint16(Q+n-3,F-n-Q)):(W[F++]=214,W[F++]=98,Q=F-n,F+=4),re=["",""],re.previous=B,re.size=0,re.position=Q}let G=fC.test(k);re[G?0:1]+=k,W[F++]=193,A(G?-j:j);return}let M;j<32?M=1:j<256?M=2:j<65536?M=3:M=5;let tt=j*3;if(F+tt>Ge&&(W=C(F+tt)),j<64||!o){let G,Q,U,B=F+M;for(G=0;G<j;G++)Q=k.charCodeAt(G),Q<128?W[B++]=Q:Q<2048?(W[B++]=Q>>6|192,W[B++]=Q&63|128):(Q&64512)===55296&&((U=k.charCodeAt(G+1))&64512)===56320?(Q=65536+((Q&1023)<<10)+(U&1023),G++,W[B++]=Q>>18|240,W[B++]=Q>>12&63|128,W[B++]=Q>>6&63|128,W[B++]=Q&63|128):(W[B++]=Q>>12|224,W[B++]=Q>>6&63|128,W[B++]=Q&63|128);N=B-F-M}else N=o(k,F+M);N<32?W[F++]=160|N:N<256?(M<2&&W.copyWithin(F+2,F+1,F+1+N),W[F++]=217,W[F++]=N):N<65536?(M<3&&W.copyWithin(F+3,F+2,F+2+N),W[F++]=218,W[F++]=N>>8,W[F++]=N&255):(M<5&&W.copyWithin(F+5,F+3,F+3+N),W[F++]=219,Yt.setUint32(F,N),F+=4),F+=N}else if(g==="number")if(k>>>0===k)k<32||k<128&&this.useRecords===!1||k<64&&!this.randomAccessStructure?W[F++]=k:k<256?(W[F++]=204,W[F++]=k):k<65536?(W[F++]=205,W[F++]=k>>8,W[F++]=k&255):(W[F++]=206,Yt.setUint32(F,k),F+=4);else if(k>>0===k)k>=-32?W[F++]=256+k:k>=-128?(W[F++]=208,W[F++]=k+256):k>=-32768?(W[F++]=209,Yt.setInt16(F,k),F+=2):(W[F++]=210,Yt.setInt32(F,k),F+=4);else{let j;if((j=this.useFloat32)>0&&k<4294967296&&k>=-2147483648){W[F++]=202,Yt.setFloat32(F,k);let M;if(j<4||(M=k*Eh[(W[F]&127)<<1|W[F+1]>>7])>>0===M){F+=4;return}else F--}W[F++]=203,Yt.setFloat64(F,k),F+=8}else if(g==="object"||g==="function")if(!k)W[F++]=192;else{if(s){let M=s.get(k);if(M){if(!M.id){let tt=s.idsToInsert||(s.idsToInsert=[]);M.id=tt.push(M)}W[F++]=214,W[F++]=112,Yt.setUint32(F,M.id),F+=4;return}else s.set(k,{offset:F-n})}let j=k.constructor;if(j===Object)D(k);else if(j===Array)E(k);else if(j===Map)if(this.mapAsEmptyObject)W[F++]=128;else{N=k.size,N<16?W[F++]=128|N:N<65536?(W[F++]=222,W[F++]=N>>8,W[F++]=N&255):(W[F++]=223,Yt.setUint32(F,N),F+=4);for(let[M,tt]of k)A(M),A(tt)}else{for(let M=0,tt=kh.length;M<tt;M++){let G=Py[M];if(k instanceof G){let Q=kh[M];if(Q.write){Q.type&&(W[F++]=212,W[F++]=Q.type,W[F++]=0);let nt=Q.write.call(this,k);nt===k?Array.isArray(k)?E(k):D(k):A(nt);return}let U=W,B=Yt,ut=F;W=null;let et;try{et=Q.pack.call(this,k,nt=>(W=U,U=null,F+=nt,F>Ge&&C(F),{target:W,targetView:Yt,position:F-nt}),A)}finally{U&&(W=U,Yt=B,F=ut,Ge=W.length-10)}et&&(et.length+F>Ge&&C(et.length+F),F=pC(et,W,F,Q.type));return}}if(Array.isArray(k))E(k);else{if(k.toJSON){const M=k.toJSON();if(M!==k)return A(M)}if(g==="function")return A(this.writeFunction&&this.writeFunction(k));D(k)}}}else if(g==="boolean")W[F++]=k?195:194;else if(g==="bigint"){if(k<BigInt(1)<<BigInt(63)&&k>=-(BigInt(1)<<BigInt(63)))W[F++]=211,Yt.setBigInt64(F,k);else if(k<BigInt(1)<<BigInt(64)&&k>0)W[F++]=207,Yt.setBigUint64(F,k);else if(this.largeBigIntToFloat)W[F++]=203,Yt.setFloat64(F,Number(k));else{if(this.largeBigIntToString)return A(k.toString());if(this.useBigIntExtension&&k<BigInt(2)**BigInt(1023)&&k>-(BigInt(2)**BigInt(1023))){W[F++]=199,F++,W[F++]=66;let j=[],M;do{let tt=k&BigInt(255);M=(tt&BigInt(128))===(k<BigInt(0)?BigInt(128):BigInt(0)),j.push(tt),k>>=BigInt(8)}while(!((k===BigInt(0)||k===BigInt(-1))&&M));W[F-2]=j.length;for(let tt=j.length;tt>0;)W[F++]=Number(j[--tt]);return}else throw new RangeError(k+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}F+=8}else if(g==="undefined")this.encodeUndefinedAsNil?W[F++]=192:(W[F++]=212,W[F++]=0,W[F++]=0);else throw new Error("Unknown type: "+g)},L=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?k=>{let g;if(this.skipValues){g=[];for(let M in k)(typeof k.hasOwnProperty!="function"||k.hasOwnProperty(M))&&!this.skipValues.includes(k[M])&&g.push(M)}else g=Object.keys(k);let N=g.length;N<16?W[F++]=128|N:N<65536?(W[F++]=222,W[F++]=N>>8,W[F++]=N&255):(W[F++]=223,Yt.setUint32(F,N),F+=4);let j;if(this.coercibleKeyAsNumber)for(let M=0;M<N;M++){j=g[M];let tt=Number(j);A(isNaN(tt)?j:tt),A(k[j])}else for(let M=0;M<N;M++)A(j=g[M]),A(k[j])}:k=>{W[F++]=222;let g=F-n;F+=2;let N=0;for(let j in k)(typeof k.hasOwnProperty!="function"||k.hasOwnProperty(j))&&(A(j),A(k[j]),N++);if(N>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');W[g+++n]=N>>8,W[g+n]=N&255},I=this.useRecords===!1?L:t.progressiveRecords&&!d?k=>{let g,N=i.transitions||(i.transitions=Object.create(null)),j=F++-n,M;for(let tt in k)if(typeof k.hasOwnProperty!="function"||k.hasOwnProperty(tt)){if(g=N[tt],g)N=g;else{let G=Object.keys(k),Q=N;N=i.transitions;let U=0;for(let B=0,ut=G.length;B<ut;B++){let et=G[B];g=N[et],g||(g=N[et]=Object.create(null),U++),N=g}j+n+1==F?(F--,q(N,G,U)):ot(N,G,j,U),M=!0,N=Q[tt]}A(k[tt])}if(!M){let tt=N[rs];tt?W[j+n]=tt:ot(N,Object.keys(k),j,0)}}:k=>{let g,N=i.transitions||(i.transitions=Object.create(null)),j=0;for(let tt in k)(typeof k.hasOwnProperty!="function"||k.hasOwnProperty(tt))&&(g=N[tt],g||(g=N[tt]=Object.create(null),j++),N=g);let M=N[rs];M?M>=96&&d?(W[F++]=((M-=96)&31)+96,W[F++]=M>>5):W[F++]=M:q(N,N.__keys__||Object.keys(k),j);for(let tt in k)(typeof k.hasOwnProperty!="function"||k.hasOwnProperty(tt))&&A(k[tt])},R=typeof this.useRecords=="function"&&this.useRecords,D=R?k=>{R(k)?I(k):L(k)}:I,C=k=>{let g;if(k>16777216){if(k-n>By)throw new Error("Packed buffer would be larger than maximum buffer size");g=Math.min(By,Math.round(Math.max((k-n)*(k>67108864?1.25:2),4194304)/4096)*4096)}else g=(Math.max(k-n<<2,W.length-1)>>12)+1<<12;let N=new pc(g);return Yt=N.dataView||(N.dataView=new DataView(N.buffer,0,g)),k=Math.min(k,W.length),W.copy?W.copy(N,0,n,k):N.set(W.slice(n,k)),F-=n,n=0,Ge=N.length-10,W=N},q=(k,g,N)=>{let j=i.nextId;j||(j=64),j<f&&this.shouldShareStructure&&!this.shouldShareStructure(g)?(j=i.nextOwnId,j<p||(j=f),i.nextOwnId=j+1):(j>=p&&(j=f),i.nextId=j+1);let M=g.highByte=j>=96&&d?j-96>>5:-1;k[rs]=j,k.__keys__=g,i[j-64]=g,j<f?(g.isShared=!0,i.sharedLength=j-63,r=!0,M>=0?(W[F++]=(j&31)+96,W[F++]=M):W[F++]=j):(M>=0?(W[F++]=213,W[F++]=114,W[F++]=(j&31)+96,W[F++]=M):(W[F++]=212,W[F++]=114,W[F++]=j),N&&(b+=_*N),m.length>=h&&(m.shift()[rs]=0),m.push(k),A(g))},ot=(k,g,N,j)=>{let M=W,tt=F,G=Ge,Q=n;W=lo,F=0,n=0,W||(lo=W=new pc(8192)),Ge=W.length-10,q(k,g,j),lo=W;let U=F;if(W=M,F=tt,Ge=G,n=Q,U>1){let B=F+U-1;B>Ge&&C(B);let ut=N+n;W.copyWithin(ut+U,ut+1,F),W.set(lo.slice(0,U),ut),F=B}else W[N+n]=lo[0]},O=k=>{let g=uC(k,W,n,F,i,C,(N,j,M)=>{if(M)return r=!0;F=j;let tt=W;return A(N),w(),tt!==W?{position:F,targetView:Yt,target:W}:F},this);if(g===0)return D(k);F=g}}useBuffer(t){W=t,W.dataView||(W.dataView=new DataView(W.buffer,W.byteOffset,W.byteLength)),F=0}set position(t){F=t}get position(){return F}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Py=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,by],kh=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?Fy(e,16,t):$y(dc?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==Dy&&this.moreTypes?Fy(e,My.indexOf(n.name),t):$y(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function Fy(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function $y(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function pC(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function mC(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function jy(e,t,n){if(re.length>0){Yt.setUint32(re.position+e,F+n-re.position-e),re.stringsPosition=F-e;let r=re;re=null,t(r[0]),t(r[1])}}function gC(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let zy=new dC({useRecords:!1});const yC=zy.pack;zy.pack;const _C=512,bC=1024,wC=2048;function ki(){return null}function uo(e,t,n={}){if(!v(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];v(c)&&(a=c(a));const u=t[o];v(u)&&(o=u),a!==null&&r.push(o,a)}return r}function ho(e,t,n={}){if(v(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];v(a)&&(s=a);const c=n[s];v(c)&&(o=c(o)),r[s]=o}return r}catch(r){Vt(z,"binary",r.message)}}function vC(e){try{const t=ur(e);return yC(t)}catch(t){Vt(z,"binary",t.message)}}function EC(e){try{return cC(e)}catch(t){Vt(z,"binary",t.message)}}function Wy(){return{id:ie()}}var Sh=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.destructible=16]="destructible",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.headless=27]="headless",e[e.removed=28]="removed",e))(Sh||{});function mc(e){return uo(e,Sh,{category:ki,kinddata:ki})}function gc(e){return ho(e,Sh)}var Ah=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(Ah||{});function Hy(e){return uo(e,Ah,{bits:t=>Array.from(t)})}function Gy(e){return ho(e,Ah,{bits:t=>new Uint8Array(t)})}function kC(e,t){return{id:ie(),code:e,...t}}var xh=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(xh||{});function SC(e){return uo(e,xh,{board:KC,object:mc,terrain:mc,charset:Hy,palette:Hy,stats:ki})}function AC(e){return ho(e,xh,{board:qC,object:gc,terrain:gc,charset:Gy,palette:Gy})}function Vy(e){const t={...is(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function xC(e){return v(e)?(e.stats=void 0,is(e)):{}}function is(e){var r;if(!v(e))return{};if(v((r=e.stats)==null?void 0:r.type))return e.stats;e.stats={};const t=gy(e.code);let n=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===oh){const a=s.image.slice(1).split(" "),c=yy(a,n),u=Ct(c.values.join(" "));switch(n=!1,c.type){case ft.LOADER:e.stats.type=Et.LOADER,e.stats.name=u;break;case ft.BOARD:e.stats.type=Et.BOARD,e.stats.name=u;break;case ft.OBJECT:e.stats.type=Et.OBJECT,e.stats.name=u;break;case ft.TERRAIN:e.stats.type=Et.TERRAIN,e.stats.name=u;break;case ft.CHARSET:e.stats.type=Et.CHARSET,e.stats.name=u;break;case ft.PALETTE:e.stats.type=Et.PALETTE,e.stats.name=u;break;case ft.CONST:{const[l,h]=c.values;if(vt(l)){const d=Ct(l);if(vt(h)){const f=parseFloat(h);e.stats[d]=St(f)?f:h}else St(h)?e.stats[d]=h:e.stats[d]=1}break}case ft.RANGE:case ft.SELECT:case ft.NUMBER:case ft.TEXT:case ft.LINK:case ft.HOTKEY:case ft.SCROLL:{const[l,...h]=c.values;if(vt(l)){const d=Ct(l);e.stats[d]=h}break}}}}return v(e.stats.type)||(e.stats.type=Et.OBJECT),e.stats}function Ky(e){switch(e){default:case Et.ERROR:return"error";case Et.LOADER:return En(ft.LOADER);case Et.BOARD:return En(ft.BOARD);case Et.OBJECT:return En(ft.OBJECT);case Et.TERRAIN:return En(ft.TERRAIN);case Et.CHARSET:return En(ft.CHARSET);case Et.PALETTE:return En(ft.PALETTE)}}function yc(e){return is(e).type??Et.ERROR}function _c(e){return Ky(yc(e))}function xr(e){return is(e).name??""}function qy(e,t){const n=Vy(e),r=Object.keys(n);for(let i=0;i<r.length;++i){const s=r[i];switch(s){case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":t[s]=n[s];break;case"ispushable":t.pushable=1;break;case"iswalk":case"iswalkable":t.collision=Kt.ISWALK;break;case"isswim":case"isswimable":t.collision=Kt.ISSWIM;break;case"issolid":t.collision=Kt.ISSOLID;break;case"isbullet":t.collision=Kt.ISBULLET;break;case"isdestructible":t.destructible=1;break}}}function Si(e){if(v(e))switch(yc(e)){default:return;case Et.ERROR:return e.code??"";case Et.LOADER:return e.code??"";case Et.BOARD:{v(e.board)||(e.board=VC()),e.board.id=e.id;const t=Vy(e);return e.board.isdark=v(t.isdark)&&t.isdark?1:0,e.board.over=t.over??e.board.over,e.board.under=t.under??e.board.under,e.board.exitnorth=t.exitnorth??e.board.exitnorth,e.board.exitsouth=t.exitsouth??e.board.exitsouth,e.board.exitwest=t.exitwest??e.board.exitwest,e.board.exiteast=t.exiteast??e.board.exiteast,e.board.timelimit=t.timelimit??e.board.timelimit,e.board.restartonzap=t.restartonzap??e.board.restartonzap,e.board.maxplayershots=t.maxplayershots??e.board.maxplayershots,e.board}case Et.OBJECT:return v(e.object)||(e.object=Wy()),e.object.name=xr(e),qy(e,e.object),e.object;case Et.TERRAIN:return v(e.terrain)||(e.terrain=Wy()),e.terrain.name=xr(e),qy(e,e.terrain),e.terrain;case Et.PALETTE:return v(e.palette)||(e.palette=g0(Ak)),e.palette;case Et.CHARSET:return v(e.charset)||(e.charset=y0(Sk)),e.charset}}function Xy(e){return{id:ie(),name:k_(),timestamp:0,activelist:[],pages:e,flags:{}}}var Th=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e))(Th||{});function TC(e){return uo(e,Th,{pages:t=>t.map(SC)})}function RC(e){return ho(e,Th,{pages:t=>t.map(AC)})}function ss(e,t){if(!v(e))return;const n=Ct(t);return e.pages.find(i=>i.id===t||n===xr(i))}function Ai(e,t,n){if(!v(e))return;const r=Ct(n);return e.pages.find(s=>yc(s)===t&&(s.id===n||r===xr(s)))}function Rh(e,t,n){let r=Ai(e,t,n);if(!v(r)){const i=Ky(t);r=kC(i==="object"?`@${n}
`:`@${i} ${n}
`,{}),IC(e,r)}return r}function Zy(e,t){return v(e)?e.pages.filter(n=>yc(n)===t):[]}function IC(e,t){if(!v(e)||!v(t))return!1;const n=ss(e,t.id);return v(n)?!1:(e.pages.push(t),!0)}function OC(e,t){const n=ss(e,t);if(v(e)&&v(n)){const r=Ct(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==xr(i)),n}}function An(e,t){if(v(t)&&v(t.kind))return v(t.kinddata)||(t.kinddata=v(t.id)?bc(e,t.kind):Jy(e,t.kind)),t.kinddata}function CC(e,t,n){const r=An(e,t);return(t==null?void 0:t[n])??(r==null?void 0:r[n])}function Ih(e,t,n,r,i){const s=An(e,t);return{char:(t==null?void 0:t.char)??(s==null?void 0:s.char)??n,color:(t==null?void 0:t.color)??(s==null?void 0:s.color)??r,bg:(t==null?void 0:t.bg)??(s==null?void 0:s.bg)??i,light:(t==null?void 0:t.light)??(s==null?void 0:s.light)??0}}function bc(e,t){const n=t??"",r=Ai(e,Et.OBJECT,n);if(v(r)){const i=Si(r);return{...ur(i),name:n,code:r.code}}}function Jy(e,t){const n=t??"",r=Ai(e,Et.TERRAIN,n);if(v(r)){const i=Si(r);return{...ur(i),name:n,code:r.code}}}function fo(e,t){const n=ss(e,t);return Si(n)}function Xr(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function Oh(e,t){e&&delete e.flags[t]}function Yy(e,t,n){const r=Xr(e,t);return r==null?void 0:r[n]}function NC(e,t,n,r){const i=Xr(e,t);return i&&(i[n]=r),r}function wc(e,t){const n=Yy(e,t,"board");return fo(e,vt(n)?n:"")}function Ch(e,t,n){if(!v(e))return;NC(e,t,"board",n);const r=fo(e,n);v(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function LC(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=Yy(e,r,"board");return vt(i)?i:""});return vk(n)}function Qy(e){return LC(e).map(n=>fo(e,n)).filter(v)}function MC(e,t,n,r){const i=xi(t,(n==null?void 0:n.id)??"");if(!v(e)||!v(t)||!v(i)||!v(i.x)||!v(i.y)||!v(t.lookup)||r.x<0||r.x>=ee||r.y<0||r.y>=mn||i.x-r.x===0&&i.y-r.y===0)return!0;const s=r.x+r.y*ee,o=An(e,i),a=i.collision??(o==null?void 0:o.collision),c=xi(t,t.lookup[s]??"");if(v(c))return!0;const u=t.terrain[s];if(v(u)){const l=An(e,u),h=u.collision??(l==null?void 0:l.collision);if(lu(a,h))return!0}return!1}function UC(e,t,n,r){const i=xi(t,(n==null?void 0:n.id)??"");if(!v(e)||!v(t)||!v(i)||!v(i.x)||!v(i.y)||!v(t.lookup)||r.x<0||r.x>=ee||r.y<0||r.y>=mn)return{kind:"edge",collision:Kt.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=i.x+i.y*ee,o=r.x+r.y*ee,a=An(e,i),c=i.collision??(a==null?void 0:a.collision),u=xi(t,t.lookup[o]??"");if(v(u))return{...u};const l=t.terrain[o];if(v(l)){const h=An(e,l),d=l.collision??(h==null?void 0:h.collision);if(lu(c,d))return{...l,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,v(i.removed)||(t.lookup[s]=void 0,t.lookup[o]=i.id??"")}function os(e,t){const n=An(e,t);return v(t==null?void 0:t.id)&&v(t.x)&&v(t.y)?Ct(t.name??(n==null?void 0:n.name)??"object"):Ct((t==null?void 0:t.name)??(n==null?void 0:n.name)??"terrain")}function Nh(e,t,n,r){if(!v(e)||!v(t)||!v(t.named)||!v(n))return;const i=os(e,n);t.named[i]||(t.named[i]=new Set),t.named[i].add((n==null?void 0:n.id)??r??"")}function PC(e,t,n){if(!(!v(e)||!v(t)||!v(t.lookup)||!v(n==null?void 0:n.id))&&!v(n.removed)){const r=n.x??0,i=n.y??0;t.lookup[r+i*ee]=n.id}}function vc(e,t){if(!v(e)||!v(t)||v(t.lookup)&&v(t.named))return;const n=new Array(ee*mn).fill(void 0),r={},i=Object.values(t.objects);for(let a=0;a<i.length;++a){const c=i[a];if(v(c.x)&&v(c.y)&&v(c.id)&&!v(c.removed)){c.category=Co.ISOBJECT,n[c.x+c.y*ee]=c.id;const u=os(e,c);r[u]||(r[u]=new Set),r[u].add(c.id)}}let s=0,o=0;for(let a=0;a<t.terrain.length;++a){const c=t.terrain[a];if(v(c)){c.x=s,c.y=o,c.category=Co.ISTERRAIN;const u=os(e,c);r[u]||(r[u]=new Set),r[u].add(a)}++s,s>=ee&&(s=0,++o)}t.lookup=n,t.named=r}function po(e,t,n,r){if(!v(n)||Ct(os(e,n))==="player")return!1;const i=n.id??"",s=n.x??0,o=n.y??0;return i?(n.removed=r,Ec(e,t,n)):Bh(t,{x:s,y:o},"empty"),!0}function Ec(e,t,n){var r;if(v(e)&&v(t)&&v(n==null?void 0:n.id)){if(v(t.lookup)&&v(n.x)&&v(n.y)){const s=n.x+n.y*ee;t.lookup[s]===n.id&&t.lookup.splice(s,1)}const i=os(e,n);v((r=t.named)==null?void 0:r[i])&&v(n.id)&&t.named[i].delete(n.id)}}function DC(e,t,n){const r=[];if(!v(e)||!v(t))return r;const i=Object.values(t.objects);for(let s=0;s<i.length;++s){const o=i[s];v(o.id)&&v(o.removed)&&n-o.removed>No*5&&(r.push(o.id),h1(t,o.id))}return r}function BC(e,t,n){const r=[];if(!v(e)||!v(t))return r;t.lookup=void 0,vc(e,t);const i=Object.values(t.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!v(a.id))continue;a.lx=a.x,a.ly=a.y;const c=An(e,a),u=a.code??(c==null?void 0:c.code)??"";u&&r.push({id:a.id,type:Et.OBJECT,code:u,object:a,terrain:void 0})}const s=DC(e,t,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:Et.ERROR,code:"",object:void 0,terrain:void 0});return r}function FC(e,t,n,r){if(v(e)&&v(t)&&v(n)){const[i,s]=n,o=bc(e,i);if(v(o)&&v(o.name)){const a=Fh(t,r,i);return xc(a,s),Nh(e,t,a),a}}}function Lh(e,t,n,r){if(v(e)&&v(t)&&v(n)){const[i,s]=n,o=Jy(e,i);if(v(o)){const c=Bh(t,r,i);xc(c,s);const u=r.x+r.y*ee;return Nh(e,t,c,u),c}const a=bc(e,i);if(v(a)&&v(a.name)){const c=Fh(t,r,i);return xc(c,s),PC(e,t,c),Nh(e,t,c),c}}}const t1={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Tr(e){return Ht(e)&&e1(e[0])}function e1(e){return v(Co[e])&&vt(e)}function n1(e){if(vt(e))return t1[Ct(e)]}function r1(e){if(Tr(e))return e;if(e1(e))return[e];const t=n1(e);if(v(t))return[t]}function kc(e){const t=T.words[e],n=r1(t);if(Tr(n))return[n,e+1];const[r,i]=Oe(e),s=r1(r);return Tr(s)?[s,i]:[void 0,e]}const i1={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalkable:"ISWALKABLE",isswimmable:"ISSWIMABLE"};Kt.ISSOLID,Kt.ISWALK,Kt.ISSWIM,Kt.ISBULLET,Kt.ISWALK,Kt.ISSWIM;function Zr(e){return Ht(e)&&Mh(e[0])}function Mh(e){return v(Kt[e])&&vt(e)}function $C(e){if(vt(e))return i1[Ct(e)]}function s1(e){const t=T.words[e];if(Zr(t))return[t,e+1];if(Mh(t))return[[t],e+1];const[n,r]=Oe(e);return Zr(n)?[n,r]:Mh(n)?[[n],r]:[void 0,e]}function Oe(e,t=!0){var i,s,o,a,c;const n=T.words[e],r=e+1;if(n1(n)){const[u,l]=kc(e);if(v(u))return[u,l]}if($C(n)){const[u,l]=s1(e);if(v(u))return[u,l]}if(Uh(n)){const[u,l]=Ac(e);if(v(u))return[u,l]}if(vt(n)&&Ct(n)==="rnd"){const[u,l]=Oe(r),[h,d]=Oe(l);return St(u)&&St(h)?[Ds(u,h),d]:St(u)?[Ds(0,u),l]:[Ds(0,1),r]}if(a0(n)){const[u,l]=cu(e);if(v(u))return[u,l]}if(!v(n))return[void 0,e];if(St(n)||Ht(n))return[n,r];if(vt(n)){const u=Ct(n);if(t){const l=(i=T.get)==null?void 0:i.call(T,n);if(v(l))return[l,r]}switch(u){case"aligned":case"alligned":{const l=wa(T.board,T.element,T.fromplayer);return!v(T.element)||!v(l)?[0,r]:[T.element.x===l.x||T.element.y===l.y?1:0,r]}case"contact":{const l=wa(T.board,T.element,T.fromplayer);if(!v(T.element)||!v(l))return[0,r];const h=(l.x??0)-(((s=T.element)==null?void 0:s.x)??0),d=(l.y??0)-(((o=T.element)==null?void 0:o.y)??0);return[h===0&&Math.abs(d)<2||d===0&&Math.abs(h)<2?1:0,r]}case"blocked":{const[l,h]=J(T.words,r,[K.DIR]);return[MC(T.book,T.board,T.element,l)?1:0,h]}case"any":{const[l,h]=J(T.words,r,[K.KIND]),d=ba(l)??"",f=Fs(T.board,d);return[d0(f,l).length?1:0,h]}case"rnd":return[Ds(0,1),r];case"abs":{const[l,h]=J(T.words,r,[K.NUMBER]);return[Math.abs(l),h]}case"ceil":{const[l,h]=J(T.words,r,[K.NUMBER]);return[Math.ceil(l),h]}case"floor":{const[l,h]=J(T.words,r,[K.NUMBER]);return[Math.floor(l),h]}case"round":{const[l,h]=J(T.words,r,[K.NUMBER]);return[Math.round(l),h]}case"clamp":{const[l,h,d,f]=J(T.words,r,[K.NUMBER,K.NUMBER,K.NUMBER]);return[on(l,h,d),f]}case"min":{const l=[];for(let h=r;h<T.words.length;){const[d,f]=Oe(h);Ht(d)&&!Xn(d)&&!Tr(d)&&!Zr(d)&&!ln(d)&&l.push(...d),h=f,l.push(d)}return[Math.min(...l),T.words.length]}case"max":{const l=[];for(let h=r;h<T.words.length;){const[d,f]=Oe(h);Ht(d)&&!Xn(d)&&!Tr(d)&&!Zr(d)&&!ln(d)&&l.push(...d),h=f,l.push(d)}return[Math.max(...l),T.words.length]}case"pick":{const l=[];for(let h=r;h<T.words.length;){const[d,f]=Oe(h);Ht(d)&&!Xn(d)&&!Tr(d)&&!Zr(d)&&!ln(d)&&l.push(...d),h=f,l.push(d)}return[Vi(l),T.words.length]}case"pickwith":{const l=[],[h,d]=J(T.words,r,[K.STRING]);for(let f=d;f<T.words.length;){const[p,m]=Oe(f);Ht(p)&&!Xn(p)&&!Tr(p)&&!Zr(p)&&!ln(p)&&l.push(...p),f=m,l.push(p)}return[i0(h,l),T.words.length]}case"range":{const[l,h,d,f]=J(T.words,r,[K.NUMBER,K.MAYBE_NUMBER,K.MAYBE_NUMBER]);return[au(l,h,d),f]}case"run":{const[l,h]=J(T.words,r,[K.NAME]);return Bc(l),[(a=T.get)==null?void 0:a.call(T,"arg"),h]}case"runwith":{const[l,h,d]=J(T.words,r,[K.ANY,K.NAME]);return v(T.element)&&(T.element.arg=l),Bc(h),[(c=T.get)==null?void 0:c.call(T,"arg"),d]}}}return[n,r]}function jC(e){return v(e)&&e<Tt.ONBLACK?e:void 0}function zC(e){return v(e)&&e>Tt.WHITE&&e<Tt.ONCLEAR?e-Tt.ONBLACK:void 0}const Sc={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function ln(e){return Ht(e)&&a1(e[0])}function o1(e){return ln(e)&&e[0].startsWith("ON")}function a1(e){return v(Tt[e])&&vt(e)}function Uh(e){if(vt(e))return Sc[Ct(e)]}function c1(e){return e.map(t=>Tt[t]).find(t=>v(t)&&t<Tt.ONBLACK)}function WC(e){return e.map(t=>Tt[t]).find(t=>v(t)&&t>=Tt.ONBLACK)}function l1(e){if(ln(e))return e;if(a1(e))return[e];const t=Uh(e);if(v(t))return[t]}function u1(e){const t=T.words[e],n=l1(t);if(ln(n))return[n,e+1];const[r,i]=Oe(e),s=l1(r);return ln(s)?[s,i]:[void 0,e]}function Ac(e){const t=[];let n=e;const[r,i]=u1(e);if(ln(r)&&(t.push(...r),n=i),ln(t)&&!o1(t)){const[s,o]=u1(i);o1(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function HC(e){const t={};return e.every(n=>{const r=Tt[n];v(r)&&(r<Tt.ONBLACK?t.color=r:t.bg=r-Tt.ONBLACK)}),t}function GC(){return new Array(ee*mn).map(()=>{})}function VC(e=wf){const t={terrain:GC(),objects:{},id:""};return e(t)}var Ph=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e))(Ph||{});function KC(e){return uo(e,Ph,{terrain:t=>t.map(mc),objects:t=>Object.values(t).map(mc),id:ki,named:ki,lookup:ki,codepage:ki})}function qC(e){return ho(e,Ph,{terrain:t=>t.map(gc),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=gc(t[r]);v(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function XC(e,t){return!v(e)||t.x<0||t.x>=ee||t.y<0||t.y>=mn?-1:t.x+t.y*ee}function Dh(e){var t;return Ct((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"object")}function ZC(e){var t;return(e==null?void 0:e.color)??((t=e==null?void 0:e.kinddata)==null?void 0:t.color)??Tt.BLACK}function JC(e){var t;return(e==null?void 0:e.bg)??((t=e==null?void 0:e.kinddata)==null?void 0:t.bg)??Tt.BLACK}function xc(e,t){if(!v(e)||!ln(t))return;const{color:n,bg:r}=HC(t);v(n)&&(e.color=n),v(r)&&(e.bg=r)}function YC(e,t){if(!v(e)||!v(t)||!v(t.x)||!v(t.y)||t.x<0||t.x>=ee||t.y<0||t.y>=mn)return;const n=ur(t),r=t.x+t.y*ee;return e.terrain[r]=n,e.terrain[r]}function QC(e,t){if(!v(e)||!v(t))return;const n=ur(t);return n.id=n.id??ie(),e.objects[n.id]=n,e.objects[n.id]}function Bh(e,t,n){return YC(e,{...t,kind:n})}function Fh(e,t,n,r){const i=QC(e,{...t,kind:n});return v(r)&&v(i)&&(i.id=r),i}function xi(e,t){if(e)return e.objects[t]}function $h(e,t,n,r,i){if(!v(e)||!v(t))return{x:0,y:0};const s={x:t.x??0,y:t.y??0},o={x:t.lx??s.x,y:t.ly??s.y},a=Ki(o,s),c=ee-1,u=mn-1;for(let l=0;l<r.length;++l){const h=Ek(r[l]);switch(h){case ct.IDLE:break;case ct.NORTH:case ct.SOUTH:case ct.WEST:case ct.EAST:Te(s,h);break;case ct.BY:{const[d,f]=r.slice(l+1);St(d)&&St(f)&&(s.x=on(s.x+d,0,c),s.y=on(s.y+f,0,u)),l+=2;break}case ct.AT:{const[d,f]=r.slice(l+1);St(d)&&St(f)&&(s.x=on(d,0,c),s.y=on(f,0,u)),l+=2;break}case ct.FLOW:Te(s,a);break;case ct.SEEK:{const d=tN(e,t,n);Bs(d)&&Te(s,Ki(i,d));break}case ct.RNDNS:Te(s,Vi(ct.NORTH,ct.SOUTH));break;case ct.RNDNE:Te(s,Vi(ct.NORTH,ct.EAST));break;case ct.RND:Te(s,Vi(ct.NORTH,ct.SOUTH,ct.WEST,ct.EAST));break;case ct.CW:case ct.CCW:case ct.OPP:case ct.RNDP:{const d=$h(e,t,n,r.slice(l+1),i);switch(s.x=i.x,s.y=i.y,h){case ct.CW:switch(Ki(i,d)){case ct.NORTH:Te(s,ct.EAST);break;case ct.SOUTH:Te(s,ct.WEST);break;case ct.EAST:Te(s,ct.SOUTH);break;case ct.WEST:Te(s,ct.NORTH);break}break;case ct.CCW:switch(Ki(i,d)){case ct.NORTH:Te(s,ct.WEST);break;case ct.SOUTH:Te(s,ct.EAST);break;case ct.EAST:Te(s,ct.NORTH);break;case ct.WEST:Te(s,ct.SOUTH);break}break;case ct.OPP:switch(Ki(i,d)){case ct.NORTH:Te(s,ct.SOUTH);break;case ct.SOUTH:Te(s,ct.NORTH);break;case ct.EAST:Te(s,ct.WEST);break;case ct.WEST:Te(s,ct.EAST);break}break;case ct.RNDP:switch(Ki(i,d)){case ct.NORTH:case ct.SOUTH:s.x+=Vi(-1,1);break;case ct.WEST:case ct.EAST:s.y+=Vi(-1,1);break}break}break}}}return s}function h1(e,t){return v(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function tN(e,t,n){if(!v(e)||!v(t))return;const r=e.objects[n];if(v(r))return r;if(Bs(t))return p0(t,Fs(e,"player"))}const T={timestamp:0,fromplayer:"",book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,words:[],get:void 0};var K=(e=>(e[e.CATEGORY=0]="CATEGORY",e[e.COLLISION=1]="COLLISION",e[e.COLOR=2]="COLOR",e[e.KIND=3]="KIND",e[e.DIR=4]="DIR",e[e.NAME=5]="NAME",e[e.NUMBER=6]="NUMBER",e[e.STRING=7]="STRING",e[e.NUMBER_OR_STRING=8]="NUMBER_OR_STRING",e[e.MAYBE_CATEGORY=9]="MAYBE_CATEGORY",e[e.MAYBE_COLLISION=10]="MAYBE_COLLISION",e[e.MAYBE_COLOR=11]="MAYBE_COLOR",e[e.MAYBE_KIND=12]="MAYBE_KIND",e[e.MAYBE_DIR=13]="MAYBE_DIR",e[e.MAYBE_NAME=14]="MAYBE_NAME",e[e.MAYBE_NUMBER=15]="MAYBE_NUMBER",e[e.MAYBE_STRING=16]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=17]="MAYBE_NUMBER_OR_STRING",e[e.ANY=18]="ANY",e))(K||{});function de(e,t){throw new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function J(e,t,n){var o,a,c,u;const r=T.words;T.words=e;const i=[];let s=t;for(let l=0;l<n.length;++l)switch(n[l]){case 0:{const[h,d]=kc(s);Tr(h)||de("terrain or object",h),s=d,i.push(h);break}case 1:{const[h,d]=s1(s);Zr(h)||de("solid, walk, swim, bullet, walkable or swimmable",h),s=d,i.push(h);break}case 2:{const[h,d]=Ac(s);ln(h)||de("color",h),s=d,i.push(h);break}case 3:{const[h,d]=u0(s);qi(h)?(s=d,i.push(h)):de("kind",h);break}case 4:{const[h,d]=cu(s);if(Xn(h)){const f=((o=T.element)==null?void 0:o.x)??0,p=((a=T.element)==null?void 0:a.y)??0,m={x:f,y:p},b=v(T.board)&&v(T.element)?$h(T.board,T.element,T.fromplayer,h,m):m;s=d,i.push(b)}else de("direction",h);break}case 5:{const h=T.words[s];vt(h)||de("string",h),++s,i.push(h);break}case 6:{const[h,d]=Oe(s);if(vt(h)){const f=parseFloat(h);St(f)?i.push(f):de("number",h)}else St(h)?i.push(h):de("number",h);s=d;break}case 7:{const[h,d]=Oe(s);vt(h)||de("string",h),s=d,i.push(h);break}case 8:{const[h,d]=Oe(s,!1);let f=h;if(vt(f)){const p=parseFloat(f);St(p)&&(f=p)}else St(f)||de("number or string",f);s=d,i.push(f);break}case 9:{const[h,d]=kc(s);h!==void 0&&!Tr(h)&&de("optional terrain or object",h),s=d,i.push(h);break}case 10:{const[h,d]=kc(s);h!==void 0&&!Zr(h)&&de("optional solid, walk, swim, bullet, walkable or swimmable",h),s=d,i.push(h);break}case 11:{const[h,d]=Ac(s);h!==void 0&&!ln(h)&&de("optional color",h),s=d,i.push(h);break}case 12:{const[h,d]=u0(s);h!==void 0&&!qi(h)&&de("optional kind",h),s=d,i.push(h);break}case 13:{const[h,d]=cu(s);if(Xn(h)){const f=((c=T.element)==null?void 0:c.x)??0,p=((u=T.element)==null?void 0:u.y)??0,m={x:f,y:p},b=T.board?$h(T.board,T.element,T.fromplayer,h,m):m;s=d,i.push(b)}else h===void 0?(s=d,i.push(void 0)):de("optional direction",h);break}case 14:{const h=T.words[s];h!==void 0&&!vt(h)&&de("optional string",h),++s,i.push(h);break}case 15:{const[h,d]=Oe(s);if(vt(h)){const f=parseFloat(h);St(f)?i.push(f):de("optional number",h)}else St(h)||h===void 0?i.push(h):de("optional number",h);s=d;break}case 16:{const[h,d]=Oe(s);h!==void 0&&!vt(h)&&de("optional string",h),s=d,i.push(h);break}case 17:{const[h,d]=Oe(s,!1);let f=h;if(vt(f)){const p=parseFloat(f);St(p)&&(f=p)}else f!==void 0&&!St(f)&&de("number or string",f);s=d,i.push(f);break}case 18:{const[h,d]=Oe(s);s=d,i.push(h);break}}return T.words=r,[...i,s]}const eN=["echo","reverb","chorus","phaser","distortion","vibrato"];function f1(e,t){const[n]=J(t,0,[K.STRING]);TE(z,e,n)}function sr(e,t){const[n]=J(t,0,[K.NUMBER_OR_STRING]);if(St(n))Jl(z,e,"volume",n);else if(eN.includes(Ct(n))){const[r,i]=J(t,1,[K.NUMBER_OR_STRING,K.MAYBE_NUMBER_OR_STRING]);CE(z,e,n,r,i)}else{const[r]=J(t,1,[K.MAYBE_NUMBER_OR_STRING]);if(St(r)){const i=t.length-1,s=new Array(i).fill(K.NUMBER),o=J(t,1,s).slice(0,i),a=o.length===1?o[0]:o;Jl(z,e,n,a)}else{const[i]=J(t,1,[K.MAYBE_NUMBER_OR_STRING]);Jl(z,e,n,i)}}}const nN=Nn().command("mainvolume",(e,t)=>{const[n]=J(t,0,[K.NUMBER]);return RE(z,n),0}).command("drumvolume",(e,t)=>{const[n]=J(t,0,[K.NUMBER]);return IE(z,n),0}).command("ttsvolume",(e,t)=>{const[n]=J(t,0,[K.NUMBER]);return OE(z,n),0}).command("play",(e,t)=>(f1(1,t),0)).command("synth",(e,t)=>{for(let n=1;n<=8;++n)sr(n,t);return 0}).command("synth1",(e,t)=>(sr(1,t),0)).command("synth2",(e,t)=>(sr(2,t),0)).command("synth3",(e,t)=>(sr(3,t),0)).command("synth4",(e,t)=>(sr(4,t),0)).command("synth5",(e,t)=>(sr(5,t),0)).command("synth6",(e,t)=>(sr(6,t),0)).command("synth7",(e,t)=>(sr(7,t),0)).command("synth8",(e,t)=>(sr(8,t),0)).command("bgplay",(e,t)=>(f1(0,t),0)).command("bgsynth",(e,t)=>(sr(0,t),0)).command("tts",(e,t)=>{const[n,r]=J(t,0,[K.STRING,K.MAYBE_STRING]);return xE(z,r??"",n),0});function Tc(e,t,n,r){const i=vt(t)?t:t.id,s=vt(t)?void 0:{x:t.x??0,y:t.y??0},o=vt(n)?n:n.id,a=i??s;v(o)&&v(a)&&e.send(o,r,a)}function d1(e,t,n,r,i){const s=UC(t,n,r,i);if(v(s)){Tc(e,s,e.id(),"thud"),r.kind===Ft.PLAYER?Tc(e,e.id(),s,"touch"):r.collision===Kt.ISBULLET?Tc(e,e.id(),s,"shot"):Tc(e,e.id(),s,"bump");const o=An(t,s);return s.destructible??(o==null?void 0:o.destructible)?(v(s==null?void 0:s.id)?po(T.book,T.board,s,T.timestamp):Bh(n,i,"empty"),!0):!1}return!0}function p1(e,t,n){if(!Bs(T.element))return 0;const[r,i]=J(t,0,[K.DIR,K.MAYBE_KIND]),s=i??["bullet"],o=FC(T.book,T.board,s,{x:T.element.x,y:T.element.y});if(v(o)){o.arg=n,o.collision=Kt.ISBULLET,o.destructible=1,o.stepx=r.x-T.element.x,o.stepy=r.y-T.element.y;const a=An(T.book,o),c=o.code??(a==null?void 0:a.code)??"";Q1(T.book,T.board,o,c,1),(o.x!==T.element.x||o.y!==T.element.y)&&e.bucket(o.id)}return e.yield(),0}const rN=Nn().command("change",(e,t)=>{if(!v(T.book)||!v(T.board))return 0;const[n,r]=J(t,0,[K.KIND,K.KIND]);vc(T.book,T.board);const i=ba(n)??"",s=Fs(T.board,i),o=d0(s,n),a=ba(r),c=h0(r),u=f0(r);return o.forEach(l=>{if(os(T.book,l)===a)v(c)&&(l.color=c),v(u)&&(l.bg=u);else{if(v(l.id)&&(Ec(T.book,T.board,l),!po(T.book,T.board,l,T.timestamp)))return;Bs(l)&&Lh(T.book,T.board,r,l)}}),0}).command("put",(e,t)=>{if(!v(T.book)||!v(T.board))return 0;const[n,r]=J(t,0,[K.DIR,K.KIND]);return vc(T.book,T.board),Lh(T.book,T.board,r,n),0}).command("shootwith",(e,t)=>{const[n,r]=J(t,0,[K.ANY]);return p1(e,t.slice(r),n)}).command("shoot",p1).command("throwstar",()=>0),iN=navigator.userAgent.includes("Mac")?"cmd":"ctrl",Jr="$dkpurple",sN="$196",oN="$205";function un(e,t){return`$${e}${t}$blue`}function m1(e,t){return`$${e}${t}$ondkblue`}function Gt(e,t){sn(e,t)}function aN(e,t){const n=sN.repeat(t);Gt(e,`${Jr}${n}`)}function jh(e,t){const n=oN.repeat(t);Gt(e,`${Jr}${n}`)}function mo(e,t){Gt(e,`${Jr} ${" ".repeat(t.length)} `),aN(e,t.length+2),Gt(e,`${Jr} $white${t} `),jh(e,t.length+2)}function Rr(e,t){Gt(e,`${Jr} ${" ".repeat(t.length)} `),Gt(e,`${Jr} $gray${t} `),jh(e,t.length+2)}function Bt(e,t,n){Gt(e,`${Jr} $white${t} $blue${n}`)}function zt(e,t){Gt(e,`${Jr}$blue${t}`)}function as(e=""){Np(z,e,rf())}const cN=Nn().command("send",(e,t)=>{const[n,r]=J(t,0,[K.NAME,K.ANY]);switch(n){case"helpmenu":mo(z,"H E L P"),Bt(z,"#help controls","zss controls and inputs"),Gt(z,"!helpcontrols;read help controls"),Gt(z,""),Bt(z,"#help text","text formatting"),Gt(z,"!helptext;read help text"),Gt(z,""),Bt(z,"#help developer","developer commands"),Gt(z,"!helpdeveloper;read help developer"),Gt(z,""),Bt(z,"#help player","player settings"),Gt(z,"!helpplayer;read help player"),Rr(z,"keyboard input"),Bt(z,"?","open console"),Bt(z,"esc","close console"),Bt(z,"tab","move console"),Bt(z,"up / down arrow keys","navigate console items"),Bt(z,"left / right arrow keys","change console items"),Bt(z,"enter","interact with console items"),Bt(z,"alt + arrow keys","skip words and console lines"),Bt(z,`${iN} + up / down arrow keys`,"input history");break;case"helpcontrols":mo(z,"zss controls and inputs"),Rr(z,"keyboard input"),Bt(z,"arrow keys","move"),Bt(z,"shift + arrow keys","shoot"),Bt(z,"enter","ok / accept"),Bt(z,"escape","cancel / close"),Bt(z,"tab","menu / action"),Rr(z,"mouse input"),zt(z,"todo ???"),Rr(z,"controller input"),Bt(z,"left stick","move"),Bt(z,"right stick","aim"),Bt(z,"a","ok / accept"),Bt(z,"b","cancel / close"),Bt(z,"y","menu / action"),Bt(z,"x","shoot"),Bt(z,"triggers","shoot");break;case"helptext":mo(z,"text formatting"),Rr(z,"typography"),zt(z,"plain text"),zt(z,"$centering text"),zt(z,'"\\"@quoted strings for special chars\\""'),zt(z,"$$0-255 for ascii chars $159$176$240"),zt(z,`use color names like ${un("red","$$red")} to change foreground color`),zt(z,`use color names like ${m1("ongreen","$$ongreen")} to change background color`),zt(z,`use clear ${m1("onclear","to change background to")} transparent`),Rr(z,"hyperlinks"),zt(z,`${un("white",'"!hotkey"')} message shortcut;${un("gray","Label")}`),zt(z,`${un("white",'"!range"')} flag [labelmin] [labelmax];${un("gray","Input Label")}`),zt(z,`${un("white",'"!select"')} flag ...list of values;${un("gray","Input Label")}`),zt(z,`${un("white",'"!number"')} flag [minvalue] [maxvalue];${un("gray","Input Label")}`),zt(z,`${un("white",'"!text"')} flag;${un("gray","Input Label")}`),zt(z,`${un("white",'"!copyit"')} flag;${un("gray","Input Label")}`);break;case"helpdeveloper":mo(z,"developer commands"),Bt(z,"#books","list books in memory"),Bt(z,"#pages","list pages in opened book"),Bt(z,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),Bt(z,"#trash","list books and pages from open book you can delete"),Bt(z,"#save","flush state to register");break;case"helpplayer":mo(z,"player settings"),zt(z,"todo");break;default:sn(z,`${n} ${r??""}`);break}return 0}).command("stat",(e,t)=>{let n;const[r,...i]=t.map(Ce),s=i.join(" ");switch(Ct(r)){case En(ft.LOADER):n=ti(Ft.CONTENT,s,Et.LOADER);break;default:n=ti(Ft.CONTENT,[r,...i].join(" "),Et.OBJECT);break;case En(ft.BOARD):n=ti(Ft.CONTENT,s,Et.BOARD);break;case En(ft.OBJECT):n=ti(Ft.CONTENT,s,Et.OBJECT);break;case En(ft.TERRAIN):n=ti(Ft.CONTENT,s,Et.TERRAIN);break;case En(ft.CHARSET):n=ti(Ft.CONTENT,s,Et.CHARSET);break;case En(ft.PALETTE):n=ti(Ft.CONTENT,s,Et.PALETTE);break}return v(n)&&e.command("pageopen",n.id),0}).command("text",(e,t)=>{const n=t.map(Ce).join(" ");return sn(z,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Ce(n),s=r.map(Ce).join(" ");return sn(z,`!${s};${i}`),0}).command("dev",()=>(as(),kE(z,T.fromplayer),0)).command("share",()=>(as(),SE(z,T.fromplayer),0)).command("bookcreate",(e,t)=>{const[n]=J(t,0,[K.MAYBE_NAME]),r=X1(n);return v(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=J(t,0,[K.NAME]),r=Qr(n);return v(r)?(zt(z,`opened [book] ${r.name}`),Dc(Ft.MAIN,r.id),e.command("pages")):Vt(z,"bookopen",`book ${n} not found`,T.fromplayer),0}).command("booktrash",(e,t)=>{const[n]=J(t,0,[K.NAME]),r=Pe(Ft.MAIN),i=Qr(n);return v(i)&&(r===i&&Dc(Ft.MAIN,""),B4(n),zt(z,`trashed [book] ${i.name}`),as(),e.command("pages")),0}).command("pageopen",(e,t)=>{const[n]=J(t,0,[K.NAME]),r=$n(Ft.MAIN);if(!v(r))return 0;const i=ss(r,n);if(v(i)){const s=xr(i),o=_c(i);zt(z,`opened [${o}] ${s}`),Up(Cp(r.id,i.id),i.code);const a=_c(i);LE(z,r.id,i.id,a,`${s} - ${r.name}`,T.fromplayer)}else Vt(z,"pageopen",`page ${n} not found`,T.fromplayer);return 0}).command("pagetrash",(e,t)=>{const[n]=J(t,0,[K.NAME]),r=$n(Ft.MAIN),i=OC(r,n);if(v(n)){const s=xr(i),o=_c(i);zt(z,`trashed [${o}] ${s}`),as(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(Ce).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{Rr(z,"books");const e=Pe(Ft.MAIN);Bt(z,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=Pe(Ft.CONTENT);Bt(z,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),jh(z,7);const n=Pc();return n.length?n.forEach(r=>{Gt(z,`!bookopen ${r.id};${r.name}`)}):zt(z,"no books found"),Gt(z,"!bookcreate;create a new book"),0}).command("pages",()=>{Rr(z,"pages");const e=$n(Ft.MAIN);return v(e)&&(Bt(z,"main",`${e.name} $GREEN${e.id}`),e.pages.length?e.pages.forEach(t=>{const n=xr(t),r=_c(t);Gt(z,`!pageopen ${t.id};[${r}] ${n}`)}):(Gt(z,""),zt(z,"no pages found"),zt(z,"use @ to create a page"),zt(z,"@board name of board"),zt(z,"@object name of object"),zt(z,"@terrain name of terrain"),zt(z,"You can omit the type and it will default to object"),zt(z,"@object name of object"),zt(z,"@name of object"))),0}).command("trash",()=>{Rr(z,"$REDTRASH"),zt(z,"books");const e=Pc();e.length&&(e.forEach(n=>{Gt(z,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Gt(z,""));const t=Pe(Ft.MAIN);return v(t)&&(zt(z,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=xr(n);Gt(z,`!pagetrash ${n.id};$REDTRASH ${r}`)}),Gt(z,"")),0}).command("save",()=>(as(),0)).command("savewith",(e,t)=>{const[n]=J(t,0,[K.NAME]);return as(n),0}).command("nuke",()=>(AE(z,T.fromplayer),0)).command("joincode",()=>(wE(z,T.fromplayer),0)).command("chat",(e,t)=>{const[n]=J(t,0,[K.NAME]);switch(Ct(n)){default:mE(z,n,T.fromplayer);break;case"close":gE(z,T.fromplayer);break}return 0}).command("broadcast",(e,t)=>{const[n]=J(t,0,[K.NAME]);switch(Ct(n)){default:dE(z,n,T.fromplayer);break;case"stop":pE(z,T.fromplayer);break}return 0});function lN(e){const t=t1[e];if(v(t))return t;const n=i1[e];if(v(n))return n;const r=Sc[e];if(v(r))return r;const i=s0[e];if(v(i))return i}const uN=Nn({get(e,t){const n=lN(t);return v(n)?[!0,n]:[!1,void 0]}}),hN=Nn().command("palette",(e,t)=>{const[n,r]=J(t,0,[K.NAME]),i=Z1(),s=Uh(Ct(n));if(v(s)){const o=c1([s]);if(!v(o))return 0;const[a,c,u]=J(t,r,[K.NUMBER,K.NUMBER,K.NUMBER]),l=ti(Ft.MAIN,vt(i.palette)?i.palette:Ft.MAIN,Et.PALETTE),h=Si(l);if(v(h)&&o>=0&&o<=16){const d=o*da;h.bits[d+0]=on(a,0,63),h.bits[d+1]=on(c,0,63),h.bits[d+2]=on(u,0,63)}v(l)&&(i.palette=l.id)}else{const o=Ai(T.book,Et.PALETTE,n);v(o)?(i.palette=o.id,Gt(z,`loaded palette ${n}`)):Vt(z,"not-found",`unabled to find palette ${n}`)}return 0}).command("charset",(e,t)=>{const[n]=J(t,0,[K.NAME]),r=Z1(),i=Ai(T.book,Et.CHARSET,n);return v(i)?(r.charset=i.id,Gt(z,`loaded charset ${n}`)):Vt(z,"not-found",`unabled to find charset ${n}`),0}),fN=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),g1=new Set(["player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),dN=["NORTH","SOUTH","WEST","EAST"];function pN(e){const t=us(e);if(St(t.inputcurrent)||(t.inputcurrent=0),Ht(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=je.NONE,i=0]=n??[je.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&KE?1:0,t.inputctrl=i&qE?1:0,t.inputshift=i&XE?1:0,r){case je.MOVE_UP:case je.MOVE_DOWN:case je.MOVE_LEFT:case je.MOVE_RIGHT:t.inputmove=[dN[r-je.MOVE_UP]];break;case je.OK_BUTTON:t.inputok=1;break;case je.CANCEL_BUTTON:t.inputcancel=1;break;case je.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==je.NONE&&o!==r}),t}const mN=Nn({get(e,t){var o;if(T.elementisplayer&&fN.has(t)){const a=pN(T.elementid)[t];return[v(a),a]}const n=(o=T.element)==null?void 0:o[t];if(v(n)||g1.has(t))return[!0,n];const i=wa(T.board,T.element,T.fromplayer);if(!v(i))return[!1,void 0];const s=us(i.id??"")[t];return[v(s),s]},set(e,t,n){var o;const r=(o=T.element)==null?void 0:o[t];if(v(r)||g1.has(t))return v(T.element)&&(T.element[t]=n),[!0,n];const i=wa(T.board,T.element,T.fromplayer);if(!v(i))return[!1,n];const s=us(i.id??"");return v(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(e){var t;v((t=T.element)==null?void 0:t.x)&&v(T.element.y)&&v(T.element.stepx)&&v(T.element.stepy)&&d1(e,T.book,T.board,T.element,{x:T.element.x+T.element.stepx,y:T.element.y+T.element.stepy})===!1&&(T.element.stepx=0,T.element.stepy=0,CC(T.book,T.element,"destructible")&&po(T.book,T.board,T.element,T.timestamp))}}).command("become",(e,t)=>{var i,s;const n={x:((i=T.element)==null?void 0:i.x)??0,y:((s=T.element)==null?void 0:s.y)??0},[r]=J(t,0,[K.KIND]);return vc(T.book,T.board),Ec(T.book,T.board,T.element),po(T.book,T.board,T.element,T.timestamp)&&Lh(T.book,T.board,r,n),e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=J(t,0,[K.NUMBER]);return v(T.element)&&(T.element.char=n),0}).command("color",(e,t)=>{const[n]=J(t,0,[K.COLOR]);return v(T.element)&&v(n)&&xc(T.element,n),0}).command("go",(e,t)=>{if(v(T.element)){const[n]=J(t,0,[K.DIR]);if(d1(e,T.book,T.board,T.element,n),e.yield(),T.element.x===n.x&&T.element.y===n.y)return 0}return 1}).command("try",(e,t)=>{const[,n]=J(t,0,[K.DIR]);return e.command("go",...t)&&n<t.length&&e.command(...t.slice(n)),0}).command("walk",(e,t)=>{if(!v(T.element))return 0;const[n]=J(t,0,[K.DIR]),r=T.element.x??0,i=T.element.y??0;return T.element.stepx=n.x-r,T.element.stepy=n.y-i,0}),gN=Nn().command("clear",(e,t)=>(t.forEach(n=>e.set(Ce(n),0)),0)).command("set",(e,t)=>{const[n,r]=J(t,0,[K.NAME,K.ANY]);return e.set(n,r),0}).command("take",(e,t)=>{const[n,r,i]=J(t,0,[K.NAME,K.MAYBE_NUMBER]),s=e.get(n),o=r??1;if(!St(s))return 1;const a=s-o;return a<0?(i<t.length&&e.command(...t.slice(i)),1):(e.set(n,a),0)}).command("give",(e,t)=>{const[n,r,i]=J(t,0,[K.NAME,K.MAYBE_NUMBER]),s=e.get(n),o=St(s)?s:0,a=r??1;if(!St(a))return 0;const c=s===void 0?1:0;return c&&i<t.length&&e.command(...t.slice(i)),e.set(n,o+a),c}),yN=Nn({get(){return[!1,void 0]},set(e,t,n){return nk(e,t,n),[!1,void 0]},tick(){var t;const e=((t=T.element)==null?void 0:t.name)??"scroll";eu(T.elementid,"scroll",pn.SCROLL,void 0,e)},everytick(){const e=rk(T.elementid);if(e&&v(T.element)){T.element.tickertext=e,T.element.tickertime=T.timestamp;const t=Ih(T.book,T.element,1,Tt.WHITE,Tt.ONCLEAR);sn(z,`$${Tt[t.color]}$${t.char}`,e)}}}).command("send",(e,t)=>{var l,h;const[n,r]=J(t,0,[K.NAME,K.ANY]),[i,s]=n.split(":"),o=v(s)?i:"self",a=s??i;function c(d){d.forEach(f=>{v(f.id)&&e.send(f.id,a,r)})}const u=Ct(o);switch(u){case"all":for(const d of Object.keys(((l=T.board)==null?void 0:l.objects)??{}))e.send(d,a,r);break;case"self":e.message({session:z.session(),id:ie(),sender:e.id(),target:a,data:r});break;case"others":for(const d of Object.keys(((h=T.board)==null?void 0:h.objects)??{}))d!==e.id()&&e.send(d,a,r);break;default:{c(uu(T.board,[o]));const d=e.get(u);Ht(d)?c(uu(T.board,d)):c(uu(T.board,[d]));break}}return 0}).command("stat",(e,t)=>{const n=yy(t.map(Ce));switch(n.type){case ft.OBJECT:v(T.element)&&(T.element.name=n.values.join(" "));break}return 0}).command("text",(e,t)=>{const n=t.map(Ce).join("");return ik(T.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,r,...i]=t,s=Ce(n),o=Ce(r);return sk(T.elementid,e,s,o,i),0}).command("gadget",(e,t)=>{const[n]=J(t,0,[K.NAME]),r=GE[Ct(n)];if(r===pn.SCROLL){const[i,s]=J(t,1,[K.MAYBE_NAME,K.MAYBE_NUMBER]);eu(T.elementid,n,r,s,i)}else if(v(r)){const[i,s]=J(t,1,[K.MAYBE_NUMBER,K.MAYBE_NAME]);eu(T.elementid,n,r,i,s)}return 0}),_N=Nn().command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=J(t,0,[K.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Ce(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Ce(t[0])),0)).command("cycle",(e,t)=>{if(v(T.element)){const[n]=J(t,0,[K.NUMBER]);T.element.cycle=on(Math.round(n),1,255)}return 0}).command("die",e=>(po(T.book,T.board,T.element,T.timestamp),e.endofprogram(),0)).command("endgame",()=>(T.elementisplayer&&ME(z,T.elementid),0)).command("run",(e,t)=>{const[n]=J(t,0,[K.NAME]);return Bc(n),0}).command("runwith",(e,t)=>{const[n,r]=J(t,0,[K.ANY,K.NAME]);return e.set("arg",n),Bc(r),0}),y1={},_1={};function bN(e){return y1[e]}function Rc(e){return _1[e]}function wN(e,t){const n=Pe(Ft.MAIN);if(!v(n))return;const r=Zy(n,Et.LOADER).filter(i=>!!is(i)[e]);for(let i=0;i<r.length;++i){const s=ie();y1[s]=e,_1[s]=t,z4(s,r[i].code)}}function b1(e,t){if(!v(e))return;const n=Ct(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const vN=(e,t)=>{const n=Rc(e.id());if(!v(n))return 0;const[r,i]=J(t,0,[K.NAME]),s=Ct(r);switch(s){case"seek":{const[o]=J(t,i,[K.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=J(t,i,[K.NAME]);e.set(o,b1(n,s));break}case"text":{const[o,a]=J(t,i,[K.NAME,K.NAME]),c=b1(n,o);if(St(c)&&vt(a)){const u=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(u);e.set(a,h),n.cursor+=c}break}case"palette":{const[o]=J(t,i,[K.NAME]),a=Rh(T.book,Et.PALETTE,o),c=Si(a);if(v(c)){const u=$E*da,l=g0(new Uint8Array(n.bytes.buffer,n.cursor,u));v(l)&&(c.bits=l.bits),n.cursor+=u}break}case"charset":{const[o]=J(t,i,[K.NAME]),a=Rh(T.book,Et.CHARSET,o),c=Si(a);if(v(c)){const u=ga*FE*Yl,l=y0(new Uint8Array(n.bytes.buffer,n.cursor,u));v(l)&&(c.bits=l.bits),n.cursor+=u}break}}return 0},EN=(e,t)=>{const n=Rc(e.id());if(!v(n))return 0;const[r,i]=J(t,0,[K.NAME]);switch(Ct(r)){case"seek":{const[o]=J(t,i,[K.NUMBER]);n.cursor=on(o,0,n.lines.length-1);break}case"line":n.cursor=on(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o);if(v(c)){let u=1;for(let l=i;l<t.length;){const[h,d]=J(t,l,[K.NAME]);v(c[u])&&e.set(h,c[u]),++u,l=d}}break}}return 0},kN=Nn({get(e,t){switch(bN(e.id())){case"chat":{const r=Rc(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"binary":{const r=Rc(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(e,t)=>{const[n,r]=J(t,0,[K.NAME,K.ANY]);return e.message({session:q1(),id:ie(),sender:e.id(),target:n,data:r}),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Ce).join(" ");return sn(z,"$2",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Ce(n),s=r.map(Ce).join(" ");return sn(z,"$2",`!${s};${i}`),0}).command("load",(e,t)=>{const n=t.map(Ce).join(" "),r=e.get(n)??n;return $n(Ft.CONTENT,r),0}).command("reload",(e,t)=>{const n=t.map(Ce).join(" "),r=e.get(n)??n,i=$n(Ft.CONTENT,r);return i.pages=[],0}).command("bin",vN).command("txt",EN),SN=Nn();var go=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.CODE_PAGE=3]="CODE_PAGE",e))(go||{});const AN={audio:nN,board:rN,cli:cN,const:uN,display:hN,element:mN,flags:gN,gadget:yN,lifecycle:_N,loader:kN,network:SN},zh=["const","flags","audio","board","display","network","lifecycle","element"],xN={0:[],1:["cli",...zh],2:["loader",...zh],3:["gadget",...zh]},TN={0:new Map,1:new Map,2:new Map,3:new Map};function yo(e){return(xN[e]??[]).map(n=>AN[n]).filter(v)}function RN(e,t){const n=TN[e];if(!n.has(t)){let r;const i=yo(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!v(r));++s);n.set(t,r)}return n.get(t)}function IN(e,t,n){const r=yo(e);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(t,n);if(s)return[s,o]}return[!1,void 0]}function ON(e,t,n,r){const i=yo(e);for(let s=0;s<i.length;++s){const[o]=i[s].set(t,n,r);if(o)return[o,r]}return[!1,void 0]}function CN(e,t){const n=yo(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function w1(e,t){const n=yo(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var v1={},E1={},k1={};const S1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");k1.encode=function(e){if(0<=e&&e<S1.length)return S1[e];throw new TypeError("Must be between 0 and 63: "+e)};const NN=k1,A1=5,x1=1<<A1,LN=x1-1,MN=x1;function UN(e){return e<0?(-e<<1)+1:(e<<1)+0}E1.encode=function(t){let n="",r,i=UN(t);do r=i&LN,i>>>=A1,i>0&&(r|=MN),n+=NN.encode(r);while(i>0);return n};var _o={};(function(e){function t(I,R,D){if(R in I)return I[R];if(arguments.length===3)return D;throw new Error('"'+R+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(I){const R=I.match(n);return R?{scheme:R[1],auth:R[2],host:R[3],port:R[4],path:R[5]}:null}e.urlParse=i;function s(I){let R="";return I.scheme&&(R+=I.scheme+":"),R+="//",I.auth&&(R+=I.auth+"@"),I.host&&(R+=I.host),I.port&&(R+=":"+I.port),I.path&&(R+=I.path),R}e.urlGenerate=s;const o=32;function a(I){const R=[];return function(D){for(let q=0;q<R.length;q++)if(R[q].input===D){const ot=R[0];return R[0]=R[q],R[q]=ot,R[0].result}const C=I(D);return R.unshift({input:D,result:C}),R.length>o&&R.pop(),C}}const c=a(function(R){let D=R;const C=i(R);if(C){if(!C.path)return R;D=C.path}const q=e.isAbsolute(D),ot=[];let O=0,k=0;for(;;)if(O=k,k=D.indexOf("/",O),k===-1){ot.push(D.slice(O));break}else for(ot.push(D.slice(O,k));k<D.length&&D[k]==="/";)k++;let g=0;for(k=ot.length-1;k>=0;k--){const N=ot[k];N==="."?ot.splice(k,1):N===".."?g++:g>0&&(N===""?(ot.splice(k+1,g),g=0):(ot.splice(k,2),g--))}return D=ot.join("/"),D===""&&(D=q?"/":"."),C?(C.path=D,s(C)):D});e.normalize=c;function u(I,R){I===""&&(I="."),R===""&&(R=".");const D=i(R),C=i(I);if(C&&(I=C.path||"/"),D&&!D.scheme)return C&&(D.scheme=C.scheme),s(D);if(D||R.match(r))return R;if(C&&!C.host&&!C.path)return C.host=R,s(C);const q=R.charAt(0)==="/"?R:c(I.replace(/\/+$/,"")+"/"+R);return C?(C.path=q,s(C)):q}e.join=u,e.isAbsolute=function(I){return I.charAt(0)==="/"||n.test(I)};function l(I,R){I===""&&(I="."),I=I.replace(/\/$/,"");let D=0;for(;R.indexOf(I+"/")!==0;){const C=I.lastIndexOf("/");if(C<0||(I=I.slice(0,C),I.match(/^([^\/]+:\/)?\/*$/)))return R;++D}return Array(D+1).join("../")+R.substr(I.length+1)}e.relative=l;const h=function(){return!("__proto__"in Object.create(null))}();function d(I){return I}function f(I){return m(I)?"$"+I:I}e.toSetString=h?d:f;function p(I){return m(I)?I.slice(1):I}e.fromSetString=h?d:p;function m(I){if(!I)return!1;const R=I.length;if(R<9||I.charCodeAt(R-1)!==95||I.charCodeAt(R-2)!==95||I.charCodeAt(R-3)!==111||I.charCodeAt(R-4)!==116||I.charCodeAt(R-5)!==111||I.charCodeAt(R-6)!==114||I.charCodeAt(R-7)!==112||I.charCodeAt(R-8)!==95||I.charCodeAt(R-9)!==95)return!1;for(let D=R-10;D>=0;D--)if(I.charCodeAt(D)!==36)return!1;return!0}function b(I,R,D){let C=w(I.source,R.source);return C!==0||(C=I.originalLine-R.originalLine,C!==0)||(C=I.originalColumn-R.originalColumn,C!==0||D)||(C=I.generatedColumn-R.generatedColumn,C!==0)||(C=I.generatedLine-R.generatedLine,C!==0)?C:w(I.name,R.name)}e.compareByOriginalPositions=b;function _(I,R,D){let C=I.generatedLine-R.generatedLine;return C!==0||(C=I.generatedColumn-R.generatedColumn,C!==0||D)||(C=w(I.source,R.source),C!==0)||(C=I.originalLine-R.originalLine,C!==0)||(C=I.originalColumn-R.originalColumn,C!==0)?C:w(I.name,R.name)}e.compareByGeneratedPositionsDeflated=_;function w(I,R){return I===R?0:I===null?1:R===null?-1:I>R?1:-1}function E(I,R){let D=I.generatedLine-R.generatedLine;return D!==0||(D=I.generatedColumn-R.generatedColumn,D!==0)||(D=w(I.source,R.source),D!==0)||(D=I.originalLine-R.originalLine,D!==0)||(D=I.originalColumn-R.originalColumn,D!==0)?D:w(I.name,R.name)}e.compareByGeneratedPositionsInflated=E;function A(I){return JSON.parse(I.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=A;function L(I,R,D){if(R=R||"",I&&(I[I.length-1]!=="/"&&R[0]!=="/"&&(I+="/"),R=I+R),D){const C=i(D);if(!C)throw new Error("sourceMapURL could not be parsed");if(C.path){const q=C.path.lastIndexOf("/");q>=0&&(C.path=C.path.substring(0,q+1))}R=u(s(C),R)}return c(R)}e.computeSourceURL=L})(_o);var Wh={};let PN=class l_{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new l_;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};Wh.ArraySet=PN;var T1={};const R1=_o;function DN(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||R1.compareByGeneratedPositionsInflated(e,t)<=0}let BN=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){DN(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(R1.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};T1.MappingList=BN;const bo=E1,pe=_o,Ic=Wh.ArraySet,FN=T1.MappingList;let I1=class u_{constructor(t){t||(t={}),this._file=pe.getArg(t,"file",null),this._sourceRoot=pe.getArg(t,"sourceRoot",null),this._skipValidation=pe.getArg(t,"skipValidation",!1),this._sources=new Ic,this._names=new Ic,this._mappings=new FN,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new u_({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=pe.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=pe.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=pe.getArg(t,"generated"),r=pe.getArg(t,"original",null);let i=pe.getArg(t,"source",null),s=pe.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=pe.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[pe.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[pe.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=pe.relative(s,i));const o=this._mappings.toArray().length>0?new Ic:this._sources,a=new Ic;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=pe.join(r,c.source)),s!=null&&(c.source=pe.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const u=c.source;u!=null&&!o.has(u)&&o.add(u);const l=c.name;l!=null&&!a.has(l)&&a.add(l)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const u=t.sourceContentFor(c);u!=null&&(r!=null&&(c=pe.join(r,c)),s!=null&&(c=pe.relative(s,c)),this.setSourceContent(c,u))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,u,l,h;const d=this._mappings.toArray();for(let f=0,p=d.length;f<p;f++){if(u=d[f],c="",u.generatedLine!==n)for(t=0;u.generatedLine!==n;)c+=";",n++;else if(f>0){if(!pe.compareByGeneratedPositionsInflated(u,d[f-1]))continue;c+=","}c+=bo.encode(u.generatedColumn-t),t=u.generatedColumn,u.source!=null&&(h=this._sources.indexOf(u.source),c+=bo.encode(h-o),o=h,c+=bo.encode(u.originalLine-1-i),i=u.originalLine-1,c+=bo.encode(u.originalColumn-r),r=u.originalColumn,u.name!=null&&(l=this._names.indexOf(u.name),c+=bo.encode(l-s),s=l)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=pe.relative(n,r));const i=pe.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};I1.prototype._version=3,v1.SourceMapGenerator=I1;var O1={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,u=o(i,s[c],!0);return u===0?c:u>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(O1);var wo={exports:{}},$N={},jN=Object.freeze({__proto__:null,default:$N}),C1=h_(jN);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;wo.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},wo.exports.initialize=t=>e=t}else{const e=C1,t=C1;wo.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},wo.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var N1=wo.exports;const zN=N1;function WN(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let vo=null;var HN=function(){if(vo)return vo;const t=[];return vo=zN().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,u,l,h,d){const f=new WN;f.generatedLine=r+1,f.generatedColumn=i,s&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=u+1,f.originalColumn=l,h&&(f.name=d)),t[t.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw vo=null,n}),vo};const dt=_o,Hh=O1,Oc=Wh.ArraySet,GN=N1,VN=HN,Gh=Symbol("smcInternal");class ue{constructor(t,n){return t==Gh?Promise.resolve(this):qN(t,n)}static initialize(t){GN.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return XN(t,n)}static async with(t,n,r){const i=await new ue(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}ue.prototype._version=3,ue.GENERATED_ORDER=1,ue.ORIGINAL_ORDER=2,ue.GREATEST_LOWER_BOUND=1,ue.LEAST_UPPER_BOUND=2;class Eo extends ue{constructor(t,n){return super(Gh).then(r=>{let i=t;typeof t=="string"&&(i=dt.parseSourceMapInput(t));const s=dt.getArg(i,"version");let o=dt.getArg(i,"sources");const a=dt.getArg(i,"names",[]);let c=dt.getArg(i,"sourceRoot",null);const u=dt.getArg(i,"sourcesContent",null),l=dt.getArg(i,"mappings"),h=dt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=dt.normalize(c)),o=o.map(String).map(dt.normalize).map(function(d){return c&&dt.isAbsolute(c)&&dt.isAbsolute(d)?dt.relative(c,d):d}),r._names=Oc.fromArray(a.map(String),!0),r._sources=Oc.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return dt.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=u,r._mappings=l,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,VN().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=dt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new Eo(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||ue.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=dt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case ue.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case ue.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=dt.getArg(t,"source");const r=dt.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:dt.getArg(t,"line"),generatedColumn:dt.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=dt.getArg(t,"bias",ue.GREATEST_LOWER_BOUND);r==null&&(r=ue.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=dt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=dt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=dt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:dt.getArg(i,"originalLine",null),column:dt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=dt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=dt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=dt.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:dt.getArg(t,"line"),originalColumn:dt.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=dt.getArg(t,"bias",ue.GREATEST_LOWER_BOUND);i==null&&(i=ue.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:dt.getArg(s,"generatedLine",null),column:dt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Eo.prototype.consumer=ue;class KN extends ue{constructor(t,n){return super(Gh).then(r=>{let i=t;typeof t=="string"&&(i=dt.parseSourceMapInput(t));const s=dt.getArg(i,"version"),o=dt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new Oc,r._names=new Oc,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const u=dt.getArg(c,"offset"),l=dt.getArg(u,"line"),h=dt.getArg(u,"column");if(l<a.line||l===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=u,new ue(dt.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:l+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(dt.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(dt.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:dt.getArg(t,"line"),generatedColumn:dt.getArg(t,"column")},r=Hh.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(dt.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const u=a[c];let l=dt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(l),l=this._sources.indexOf(l);let h=null;u.name&&(this._names.add(u.name),h=this._names.indexOf(u.name));const d={source:l,generatedLine:u.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:u.generatedColumn+(o.generatedOffset.generatedLine===u.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:u.originalLine,originalColumn:u.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(t,n,r){const i=n||null,s=r||ue.GENERATED_ORDER;let o;switch(s){case ue.GENERATED_ORDER:o=this._generatedMappings;break;case ue.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let u=null;return c.source!==null&&(u=this._sources.at(c.source),u=dt.computeSourceURL(a,u,this._sourceMapURL)),{source:u,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return Hh.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=dt.getArg(t,"line"),r={source:dt.getArg(t,"source"),originalLine:n,originalColumn:dt.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",dt.compareByOriginalPositions,Hh.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:dt.getArg(o,"generatedLine",null),column:dt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:dt.getArg(o,"generatedLine",null),column:dt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function qN(e,t){let n=e;typeof e=="string"&&(n=dt.parseSourceMapInput(e));const r=n.sections!=null?new KN(n,t):new Eo(n,t);return Promise.resolve(r)}function XN(e,t){return Eo.fromSourceMap(e,t)}var L1={};const ZN=v1.SourceMapGenerator,Cc=_o,JN=/(\r?\n)/,YN=10,cs="$$$isSourceNode$$$";let QN=class cf{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[cs]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new cf,s=t.split(JN);let o=0;const a=function(){const f=m(),p=m()||"";return f+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,u=0,l=null,h;return n.eachMapping(function(f){if(l!==null)if(c<f.generatedLine)d(l,a()),c++,u=0;else{h=s[o]||"";const p=h.substr(0,f.generatedColumn-u);s[o]=h.substr(f.generatedColumn-u),u=f.generatedColumn,d(l,p),l=f;return}for(;c<f.generatedLine;)i.add(a()),c++;u<f.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,f.generatedColumn)),s[o]=h.substr(f.generatedColumn),u=f.generatedColumn),l=f},this),o<s.length&&(l&&d(l,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(f){const p=n.sourceContentFor(f);p!=null&&(r!=null&&(f=Cc.join(r,f)),i.setSourceContent(f,p))}),i;function d(f,p){if(f===null||f.source===void 0)i.add(p);else{const m=r?Cc.join(r,f.source):f.source;i.add(new cf(f.originalLine,f.originalColumn,m,p,f.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[cs]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[cs]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[cs]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[cs]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Cc.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][cs]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(Cc.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new ZN(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(u,l){n.code+=u,l.source!==null&&l.line!==null&&l.column!==null?((s!==l.source||o!==l.line||a!==l.column||c!==l.name)&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name}),s=l.source,o=l.line,a=l.column,c=l.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,d=u.length;h<d;h++)u.charCodeAt(h)===YN?(n.line++,n.column=0,h+1===d?(s=null,i=!1):i&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name})):n.column++}),this.walkSourceContents(function(u,l){r.setSourceContent(u,l)}),{code:n.code,map:r}}};L1.SourceNode=QN;var t4=L1.SourceNode;const e4=au(32,126).map(e=>String.fromCharCode(e)),n4=cn({name:"Whitespace",pattern:/ +/}),r4=cn({name:"WhitespaceSkipped",pattern:/ +/,group:ke.SKIPPED}),Vh=cn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),M1=cn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:e4}),Kh=cn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),qh=cn({name:"EscapedDollar",pattern:"$$"}),Xh=cn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Zh=cn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),U1=cn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function i4(e,t=""){return cn({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const P1=Object.keys(Sc).map(e=>i4(`\\$(${e})`,e)),s4=[n4,Vh,...P1,Kh,M1,Zh,qh,U1,Xh],o4=new ke(s4,{skipValidations:!qn,ensureOptimizations:qn}),a4=new ke([r4,Vh,...P1,Kh,M1,Zh,qh,U1,Xh],{skipValidations:!qn,ensureOptimizations:qn});function Jh(e,t=!1){return t?a4.tokenize(e):o4.tokenize(e)}function D1(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function B1(e){e.active={...e.reset}}function F1(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case qh:s("$");break;case Zh:if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r();break;case Kh:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Vh:{t.x=t.active.leftedge??0,++t.y;break}default:{const u=c.tokenType.name,l=Sc[u],h=jC(Tt[l]),d=zC(Tt[l]);l==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):v(h)?t.active.color=h:v(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(v(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){B1(t);const u=String.fromCharCode(t.writefullwidth).repeat(c),l=t.x+t.y*t.width;h4(l,l+u.length,t.active.color,t.active.bg,t),u4(l,u,t)}}}function c4(e,t,n){const r=Jh(e);r.tokens&&(F1(r.tokens,t),B1(t))}function l4(e,t,n){const r=Jh(e);if(!r.tokens)return;const i=D1(t,n,Tt.WHITE,Tt.BLACK);return i.measureonly=!0,F1(r.tokens,i),i.x>0&&++i.y,i}function u4(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++)}function h4(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r}let $1=0;const j1=qn,f4=["Command","lines"];class d4 extends PO{constructor(){super(my,{traceInitPerf:qn,skipValidations:!qn,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});bt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));bt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(oo)}])}));bt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));bt(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));bt(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));bt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Wg)}));bt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(oh)}));bt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(jg)}])}));bt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(zg)}));bt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Hg),this.SUBRULE(this.words),this.CONSUME(Gg)}));bt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(ns),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));bt(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));bt(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));bt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));bt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(fh),this.SUBRULE(this.words)}));bt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(iy),this.SUBRULE(this.words)}));bt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(dh),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));bt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(lc),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(oo)),this.CONSUME4(ns),this.CONSUME4(ph)}}])}));bt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(lc),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(ns),this.CONSUME(ph)}}])}));bt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(lc),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));bt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(ns),this.CONSUME(mh),this.CONSUME(dh),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));bt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(ns),this.CONSUME(mh),this.OPTION(()=>this.SUBRULE(this.command_fork))}));bt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(cy),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));bt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(ly),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));bt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(uy),this.SUBRULE(this.words)}));bt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(hy),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));bt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(fy)}));bt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(dy)}));bt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(ay)}));bt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(ah),this.SUBRULE2(this.and_test)})}));bt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(lh),this.SUBRULE2(this.not_test)})}));bt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(ch),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));bt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));bt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(qg)},{ALT:()=>this.CONSUME(Xg)},{ALT:()=>this.CONSUME(Zg)},{ALT:()=>this.CONSUME(Jg)},{ALT:()=>this.CONSUME(Yg)},{ALT:()=>this.CONSUME(Qg)}])}));bt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(ah),this.SUBRULE2(this.and_test_value)})}));bt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(lh),this.SUBRULE2(this.not_test_value)})}));bt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(ch),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));bt(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));bt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(uh)},{ALT:()=>this.CONSUME(hh)}]),this.SUBRULE(this.term)}));bt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));bt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(ey)},{ALT:()=>this.CONSUME(fh)},{ALT:()=>this.CONSUME(ny)},{ALT:()=>this.CONSUME(ry)}]),this.SUBRULE(this.factor)}));bt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(uh)},{ALT:()=>this.CONSUME(hh)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));bt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(ty),this.SUBRULE(this.factor)})}));bt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));bt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Vg)},{ALT:()=>this.CONSUME(He)},{ALT:()=>this.CONSUME(Kg)},{ALT:()=>{this.CONSUME(sy),this.SUBRULE(this.expr),this.CONSUME(oy)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=f4.some(o=>n.includes(o));return this.RULE(n,()=>{const a=($1++).toString().padStart(3),c=s?"font-weight: bold;":"";if(j1&&!this.RECORDING_PHASE){const u=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${u.join(" ")}`,c)}r(),j1&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),$1--},i)}}const ls=new d4;if(lk){const e=ls.getGAstProductions(),t=qO(e);console.info(t)}const p4=ls.getBaseCstVisitorConstructor();var at=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(at||{}),Ti=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(Ti||{}),or=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(or||{}),Nc=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Nc||{});function m4(e){return!!(e!=null&&e.tokenType)}function Ir(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class g4 extends p4{constructor(){super();bt(this,"unique",0);qn&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&m4(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():v(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:Ir(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:Ir(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:Ir(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:Ir(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:Ir(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,"if","",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=ie(),i=ie();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=ie(),i=ie();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,"if",r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=ie(),i=ie();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=ie(),i=ie(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=ie(),i=ie(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){return this.createcodenode(n,{type:22,words:this.go(n.words)})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=Ir(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=Ir(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=Ir(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(Ir(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const y4=new g4,tn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Lc="zss.js";function Mt(e,t){return new t4(e.startLine??1,e.startColumn??1,Lc,t)}function Yh(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Qh(e){return`'${Yh(e)}'`}function Mc(e){if(e.startsWith('"'))return Mc(e.replaceAll(/(^"|"$)/g,""));const t=Jh(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===Xh?`', api.get('${Yh(r.image.substring(1))}'), '`:Yh(r.image)).join("")}'].join('')`}function Ri(e){return e.filter(t=>t!==void 0).map(jt)}function z1(e){return Mt(e,"")}function _4(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function me(e,t,n){return Mt(e,[`api.${t}(`,..._4(n,", "),")"])}function b4(e){if(e.type===at.COMPARE&&e.compare.type===at.COMPARE_ITEM)switch(e.compare.method){case Ti.IS_EQ:return me(e,"isEq",[jt(e.lhs),jt(e.rhs)]);case Ti.IS_NOT_EQ:return me(e,"isNotEq",[jt(e.lhs),jt(e.rhs)]);case Ti.IS_LESS_THAN:return me(e,"isLessThan",[jt(e.lhs),jt(e.rhs)]);case Ti.IS_GREATER_THAN:return me(e,"isGreaterThan",[jt(e.lhs),jt(e.rhs)]);case Ti.IS_LESS_THAN_OR_EQ:return me(e,"isLessThanOrEq",[jt(e.lhs),jt(e.rhs)]);case Ti.IS_GREATER_THAN_OR_EQ:return me(e,"isGreaterThanOrEq",[jt(e.lhs),jt(e.rhs)])}return Mt(e,"")}function Ii(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",jt(n),")"])}function W1(e,t,n){return e.prepend(`api.${t}(`),e.add([jt(n),")"])}function w4(e,t){if(e.type===at.OPERATOR_ITEM)switch(e.operator){case or.PLUS:return Ii(t,"opPlus",e.rhs);case or.MINUS:return Ii(t,"opMinus",e.rhs);case or.POWER:return Ii(t,"opPower",e.rhs);case or.MULTIPLY:return Ii(t,"opMultiply",e.rhs);case or.DIVIDE:return Ii(t,"opDivide",e.rhs);case or.MOD_DIVIDE:return Ii(t,"opModDivide",e.rhs);case or.FLOOR_DIVIDE:return Ii(t,"opFloorDivide",e.rhs);case or.UNI_PLUS:return W1(t,"opUniPlus",e.rhs);case or.UNI_MINUS:return W1(t,"opUniMinus",e.rhs)}return Mt(e,"")}function v4(e){if(e.type===at.OPERATOR){const t=e.lhs?jt(e.lhs):Mt(e,"");return e.items.forEach(n=>w4(n,t)),t}return Mt(e,"")}function Uc(e,t){return Mt(e,[me(e,"jump",[`${t}`]),"; continue;"])}function Or(e){return tn.linelookup[e??""]??-1}function tf(e,t){tn.linelookup[e]=t}function ko(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case at.WHILE:case at.REPEAT:case at.FOREACH:case at.ELSE_IF:i.type===t&&(i.done=n);break;case at.IF_BLOCK:case at.IF_CHECK:i.type===t&&(i.skip=n);break;case at.LINE:ko(i.stmts,t,n);break}}}function H1(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case at.WHILE:case at.REPEAT:case at.FOREACH:case at.ELSE_IF:i.type===t&&tf(i.done,n);break;case at.IF_BLOCK:case at.IF_CHECK:i.type===t&&tf(i.skip,n);break;case at.LINE:H1(i.stmts,t,n);break}}}function jt(e){var t;switch(e.type){case at.PROGRAM:return Mt(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(jt).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Lc}`]);case at.API:return Mt(e,["  ",me(e,e.method,Ri(e.words)),`;
`]);case at.LINE:return Mt(e,[`case ${e.lineindex}:
`,...e.stmts.map(jt).flat(),`  break;
`]);case at.MARK:return Mt(e,`  // ${e.comment}
`);case at.GOTO:{const n=Or(e.id);return Mt(e,["  ",Uc(e,n),`
`])}case at.COUNT:return Mt(e,`${e.index}`);case at.LITERAL:switch(e.literal){case Nc.NUMBER:return Mt(e,`${e.value}`);case Nc.STRING:return Mt(e,Qh(e.value));case Nc.TEMPLATE:return Mt(e,Mc(e.value))}return z1(e);case at.TEXT:return Mt(e,["  ",me(e,"text",[Mc(e.value)]),`;
`]);case at.STAT:if(tn.isfirststat){tn.isfirststat=!1;const n=e.value.trim().split(" ").map(Qh);return Mt(e,["  ",me(e,"stat",n),`;
`])}return Mt(e,`  // skipped ${e.value}
`);case at.LABEL:{const n=Ct(e.name),r=e.active?"label":"comment";tn.labels[n]||(tn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return tn.labels[n].push(i),Mt(e,`  // ${i} '${n}' ${r}
`)}case at.HYPERLINK:return Mt(e,["  ",me(e,"hyperlink",[Mc(e.text),...Ri(e.link)]),`;
`]);case at.MOVE:{const n=me(e,"command",[Qh("go"),Ri(e.words)].flat());return e.wait?Mt(e,["  if (",n,`) { continue; };
`]):Mt(e,["  ",n,`;
`])}case at.COMMAND:return Mt(e,["  ",me(e,"command",Ri(e.words)),`;
`]);case at.IF:{const n=((t=e.block)==null?void 0:t.type)===at.IF_BLOCK?e.block:void 0;if(v(n)){ko([e.check],at.IF_CHECK,n.skip);const r=Mt(e,jt(e.check));return n.lines.forEach(i=>r.add(jt(i))),H1(n.altlines,at.ELSE_IF,Or(n.done)),n.altlines.forEach(i=>r.add(jt(i))),r}return Mt(e,jt(e.check))}case at.IF_CHECK:{const n=Or(e.skip);return n===-1?Mt(e,["  ",me(e,e.method,Ri(e.words)),`;
`]):Mt(e,["  if (!",me(e,e.method,Ri(e.words)),") { ",Uc(e,n),` }
`])}case at.ELSE_IF:case at.ELSE:{const n=Mt(e,"");return e.lines.forEach(r=>n.add(jt(r))),n}case at.WHILE:{const n=Or(e.loop),r=Or(e.done),i=Mt(e,"");return ko(e.lines,at.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case at.BREAK:s.goto=r;break;case at.CONTINUE:s.goto=n;break}i.add(jt(s))}),i}case at.REPEAT:{const n=Or(e.loop),r=Or(e.done),i=Mt(e,"");return ko(e.lines,at.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case at.BREAK:s.goto=r;break;case at.CONTINUE:s.goto=n;break}i.add(jt(s))}),i}case at.WAITFOR:{const n=Mt(e,"");return n.add(["  if (!",me(e,"if",Ri(e.words)),`) { api.i(${e.lineindex-1}); }
`]),n}case at.FOREACH:{const n=Or(e.loop),r=Or(e.done),i=Mt(e,"");return ko(e.lines,at.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case at.BREAK:s.goto=r;break;case at.CONTINUE:s.goto=n;break}i.add(jt(s))}),i}case at.BREAK:return Mt(e,["  ",Uc(e,e.goto),`
`]);case at.CONTINUE:return Mt(e,["  ",Uc(e,e.goto),`
`]);case at.OR:return me(e,"or",e.items.map(jt));case at.AND:return me(e,"and",e.items.map(jt));case at.NOT:return me(e,"not",e.items.map(jt));case at.COMPARE:return b4(e);case at.OPERATOR:return v4(e);case at.EXPR:return me(e,"expr",e.words.map(jt));default:return console.error("<unsupported node>",e.type,e),z1(e)}}function ar(e){if(v(e))switch(e.type===at.LINE&&++tn.lineindex,e.lineindex=tn.lineindex,e.type){case at.PROGRAM:e.lines.forEach(ar);break;case at.LINE:e.stmts.forEach(ar);break;case at.MARK:tf(e.id,e.lineindex);break;case at.IF:ar(e.check),ar(e.block);break;case at.IF_BLOCK:e.lines.forEach(ar),e.altlines.forEach(ar);break;case at.ELSE_IF:e.lines.forEach(ar);break;case at.ELSE:case at.WHILE:case at.REPEAT:case at.FOREACH:e.lines.forEach(ar);break;case at.MOVE:case at.COMMAND:case at.WAITFOR:case at.IF_CHECK:e.words.forEach(ar);break}}function E4(e){return tn.labels={},tn.internal=1,tn.lineindex=0,tn.isfirststat=!0,ar(e),{...jt(e).toStringWithSourceMap({file:`${Lc}.map`}),...tn}}function k4(e){return Ht(e)?e.length>0?1:0:e??0}function Ce(e){return`${e??""}`}function G1(e){return`${e}_chip`}function S4(e,t,n){var c,u;const r=G1(e),i=us(r);let s;Ht(i.lb)||(i.lb=ur(Object.entries(n.labels??{})),i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((c=n.errors)==null?void 0:c.length)??0)!==0?1:0);function o(l,h){T.words=h;const d=RN(t,l);return v(d)?d(a,h):l!=="send"?o("send",[l,...h]):0}const a={halt(){P4(r)},id(){return e},senderid(l=e){return`vm:${l??e}`},set(l,h){const[d,f]=ON(t,a,l,h);if(d)return f},get(l){const[h,d]=IN(t,a,l);if(h)return d},bucket(l){const h=a.get("bucket");Ht(h)?h.push(l):a.set("bucket",[l])},tick(l){const h=St(i.ps)?i.ps:0,d=h%l===0;if(i.ps=h+1,d===!1)return!1;if(a.shouldtick()===!1)return w1(t,a),!1;i.lc=0,i.ys=0,T.get=a.get,CN(t,a);try{const f=s==null?void 0:s.next();f!=null&&f.done&&(i.es=1)}catch(f){Vt(z,"crash",f.message),i.es=1}return w1(t,a),!0},isended(){return i.es===1},shouldtick(){return i.es===0||a.hm()!==0},shouldhalt(){return St(i.lc)?++i.lc>_r.HALT_AT_COUNT:!0},hm(){if(Ht(i.mg)&&Ht(i.lb)){const[l]=i.mg;if(v(l))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===l)return f.find(p=>St(p)&&p>0)??0}}return 0},yield(){i.ys=1},jump(l){i.ec=l},sy(){return!!i.ys||a.shouldhalt()},send(l,h,d,f){z.emit(`${a.senderid(l)}:${h}`,d,f)},lock(l){i.lk=l},unlock(){i.lk=""},message(l){i.lk&&l.sender!==i.lk||(i.mg=[l.target,l.data,l.id,l.sender,l.player,l.session])},zap(l){if(Ht(i.lb))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===l){const p=f.findIndex(m=>m>0);p>=0&&(f[p]*=-1)}}},restore(l){if(Ht(i.lb))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===l)for(let p=0;p<f.length;p++)f[h]=Math.abs(f[h])}},getcase(){i.ec=St(i.ec)?i.ec:1;const l=a.hm();if(l&&Ht(i.mg)){const[,h,d,f]=i.mg;a.set("sender",d),v(h)&&a.set("arg",h),f&&a.set("player",f),i.mg=void 0,i.ys=0,i.es=0,i.ec=l}return i.ec},nextcase(){const l=St(i.ec)?i.ec:1;return i.ec=l+1,i.ec},endofprogram(){a.yield(),i.es=1},stacktrace(l){const h=ck.parse(l),[d]=h.filter(f=>f.fileName===Lc);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(l){return o("text",[l])},stat(...l){return o("stat",l)},hyperlink(...l){return o("hyperlink",l)},command(...l){if(l.length===0)return 0;const[h,...d]=l;return o(Ce(h),d)},if(...l){const[h,d]=J(l,0,[K.ANY]),f=k4(h);return f&&d<l.length&&a.command(...l.slice(d)),f?1:0},repeatstart(l,...h){const[d,f]=J(h,0,[K.NUMBER]),p=`repeatcount${l}`,m=`repeatwords${l}`;i[p]=d,i[m]=f<h.length?h.slice(f):void 0},repeat(l){const h=`repeatcount${l}`,d=`repeatwords${l}`;if(!St(i[h]))return 0;const f=i[h];i[h]=f-1;const p=f>0,m=i[d];return p&&Ht(m)&&a.command(...m),p?1:0},foreachstart(l,...h){const[d,f,p,m]=J(h,0,[K.STRING,K.NUMBER,K.NUMBER,K.MAYBE_NUMBER]);let b=Math.min(f,p),_=Math.max(f,p);const w=(m??0)||1;if(w<0){const E=b;b=_,_=E}return a.set(d,b-w),0},foreach(l,...h){const[d,f,p,m,b]=J(h,0,[K.STRING,K.NUMBER,K.NUMBER,K.MAYBE_NUMBER]);let _=Math.min(f,p),w=Math.max(f,p);const E=(m??0)||1;if(E<0){const I=_;_=w,w=I}let A=a.get(d);!St(A)||A<_||A>w?A=_:A+=E;const L=A<=w?1:0;return L&&(a.set(d,A),b<h.length&&a.command(...h.slice(b))),L},or(...l){let h=0;for(let d=0;d<l.length;){const[f,p]=J(l,d,[K.ANY]);if(h=f,h)break;d=p}return h},and(...l){let h=0;for(let d=0;d<l.length;){const[f,p]=J(l,d,[K.ANY]);if(h=f,!h)break;d=p}return h},not(...l){const[h]=J(l,0,[K.ANY]);return h?0:1},expr(...l){const[h]=J(l,0,[K.ANY]);return h},isEq(l,h){const[d]=J([l],0,[K.ANY]),[f]=J([h],0,[K.ANY]);return typeof d=="object"||typeof f=="object"?W_(d,f)?1:0:d===f?1:0},isNotEq(l,h){return this.isEq(l,h)?0:1},isLessThan(l,h){const[d]=J([l],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return d<f?1:0},isGreaterThan(l,h){const[d]=J([l],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return d>f?1:0},isLessThanOrEq(l,h){const[d]=J([l],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return d<=f?1:0},isGreaterThanOrEq(l,h){const[d]=J([l],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return d>=f?1:0},opPlus(l,h){const[d]=J([l],0,[K.ANY]),[f]=J([h],0,[K.ANY]);return d+f},opMinus(l,h){const[d]=J([l],0,[K.ANY]),[f]=J([h],0,[K.ANY]);return d-f},opPower(l,h){const[d]=J([l],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return Math.pow(d,f)},opMultiply(l,h){const[d]=J([l],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return d*f},opDivide(l,h){const[d]=J([l],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return d/f},opModDivide(l,h){const[d]=J([l],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return d%f},opFloorDivide(l,h){const[d]=J([l],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return Math.floor(d/f)},opUniPlus(l){const[h]=J([l],0,[K.NUMBER]);return+h},opUniMinus(l){const[h]=J([l],0,[K.NUMBER]);return-h}};return s=(u=n.code)==null?void 0:u.call(n,a),a}function ef(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];Ht(r)?r.forEach(i=>{t.push(ef(i))}):t.push(ef(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function A4(e){const t=gy(`${e}
`);if(t.errors.length>0)return t;ls.input=t.tokens;const n=ls.program();if(ls.errors.length>0)return{tokens:t.tokens,errors:ls.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=y4.go(n);return r?(ef(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const nf=Object.getPrototypeOf(function*(){}).constructor;function x4(e,t){const n=`compile-${e}`;console.time(n);const r=A4(t);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=E4(r.ast);if(i.code){uk&&console.info(i.code);try{return{...r,...i,source:i.code,code:new nf("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new nf("api"," ")}}}return{...r,...i,source:"",code:new nf("api"," ")}}function T4(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=x4(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},has(i){return v(t[i])},isended(i){const s=t[i];return v(s)?s.isended():!0},halt(i){const s=t[i];return v(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},tick(i,s,o,a,c){var l;let u=t[i];if(!v(t[i])){const h=n(a,c);if(u=t[i]=S4(i,s,h),(l=h.errors)!=null&&l.length){const[d]=h.errors,f=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((_,w)=>[_,w]);p.slice(f-5,f).forEach(([_,w])=>{Vt(z,"build",`$grey${w+1} $grey${_}`)});const[m,b]=p[f]??[];if(vt(m)&&v(b)){const _=(d.column??1)-1,w=_+d.length,E=_<m.length?m:`${m}*`,A=E.substring(0,_),L=E.substring(_,w),I=E.substring(w);Vt(z,"build",`$red${b+1} $grey${A}$red${L}$grey${I}`)}return d.message.split(`
`).forEach(_=>{Vt(z,"build",_)}),!1}}return!!(u!=null&&u.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=vf(i.target),a=t[s];if(v(a)){const c={...i,target:o};a.message(c)}}};return r}function R4(e,t,n,r){const i=[],s=Math.abs(n-e),o=Math.abs(r-t),a=e<n?1:-1,c=t<r?1:-1;let u=s-o;for(i.push({x:e,y:t});e!==n||t!==r;){const l=2*u;l>-o&&(u-=o,e+=a),l<s&&(u+=s,t+=c),i.push({x:e,y:t})}return i}function V1(e,t,n,r,i){e.push({x:t+r,y:n+i}),e.push({x:t-r,y:n+i}),e.push({x:t+r,y:n-i}),e.push({x:t-r,y:n-i})}function I4(e,t,n){const r=[];let i=5-4*n,s=0,o=n,a=(-2*n+5)*4,c=3*4;for(;s<=o;)V1(r,e,t,s,o),V1(r,e,t,o,s),i>0?(i+=a,o-=1,s+=1,a+=4*4,c+=2*2):(i+=c,s+=1,a+=2*4,c+=2*4);return r}let K1=0;function O4(){switch(K1++){case 0:return Tt.BLUE;case 1:return Tt.GREEN;case 2:return Tt.CYAN;case 3:return Tt.RED;case 4:return Tt.PURPLE;case 5:return Tt.YELLOW;default:return K1=0,Tt.WHITE}}const C4=new Us;function N4(e,t,n,r,i){var I,R;const s=[];let o=t;const a=o===0,c=ee,u=mn,l=a?Tt.BLACK:Tt.ONCLEAR,h=$p(e,o++,c,u,l);s.push(h);const d=o++,f=zE(e,d);s.push(f);const p=WE(e,o++,c,u,r.isdark?1:0);s.push(p);const m=$p(e,o++,c,u,Tt.ONCLEAR);s.push(m);const b={...D1(ee,mn,O4(),Tt.ONCLEAR),...m},_=HE(e,o++);i&&s.push(_);for(let D=0;D<r.terrain.length;++D){const C=r.terrain[D],q=Ih(n,C,0,Tt.BLACK,Tt.ONCLEAR);h.char[D]=q.char,h.color[D]=q.color,h.bg[D]=q.bg}function w(D,C){if(!(D<0||D>=c||C<0||C>=u))return p.alphas[D+C*c]}const E=Object.values(r.objects??{});for(let D=0;D<E.length;++D){const C=E[D];if(v(C.removed))continue;const q=C.id??"",ot=Ih(n,C,1,Tt.WHITE,Tt.ONCLEAR),O=jE(e,d,q);if(O.x=C.x??0,O.y=C.y??0,O.char=ot.char,O.color=ot.color,O.bg=ot.bg,f.sprites.push(O),r.isdark&&St(ot.light)){const N=I4(O.x,O.y,ot.light);for(let j=0;j<N.length;++j){let M=0;const tt=N[j],G=R4(O.x,O.y,tt.x,tt.y);for(let Q=0;Q<G.length;Q++){const U=G[Q];if(U.x<0||U.x>=c||U.y<0||U.y>=u)break;const ut=C4.subVectors(U,O).length()/(ot.light+1),nt=1-on(ut+M,0,1),kt=U.x+U.y*c;p.alphas[kt]=on(p.alphas[kt]-nt,0,1);const Dt=XC(r,U);if(Dt<0||!v(r==null?void 0:r.lookup))break;if(U.x!==O.x||U.y!==O.y){const $t=xi(r,r.lookup[Dt]??"");v($t)&&(M+=.5)}const wt=r.terrain[Dt],_t=An(n,wt),Wt=(wt==null?void 0:wt.collision)??(_t==null?void 0:_t.collision);if(lu(Kt.ISWALK,Wt))break}}}const k=[[.01,.01,.01],[.01,1,.01],[.01,.01,.01]].flat(),g=ur(p.alphas);for(let N=0;N<p.alphas.length;++N){const j=N%c,M=Math.floor(N/c),tt=[[w(j-1,M-1),w(j,M-1),w(j+1,M-1)],[w(j-1,M),w(j,M),w(j+1,M)],[w(j-1,M+1),w(j,M+1),w(j+1,M+1)]].flat().map((U,B)=>v(U)?[U*k[B],k[B]]:void 0).filter(v),G=tt.map(([,U])=>U).reduce((U,B)=>U+B,0),Q=tt.map(([U])=>U).reduce((U,B)=>U+B,0);g[N]=Q/G}if(p.alphas=ur(g),vt(C.tickertext)&&St(C.tickertime)&&C.tickertext.length){const N=ee,j=l4(C.tickertext,N,mn-1),M=(j==null?void 0:j.measuredwidth)??1,tt=C.x??0,G=C.y??0,Q=G<mn*.5;b.x=tt-Math.floor(M*.5),b.y=G+(Q?1:-1),b.x+M>ee&&(b.x=ee-M),b.x<0&&(b.x=0),c4(C.tickertext,b)}q===e&&(_.focusx=O.x,_.focusy=O.y,_.focusid=q)}const A=Pe(Ft.MAIN),L=Xr(A,Ft.MAIN);if(vt(L.palette)){const D=Ai(A,Et.PALETTE,L.palette);v((I=D==null?void 0:D.palette)==null?void 0:I.bits)&&s.push(jp(e,o++,"image/palette",Array.from(D.palette.bits)))}if(vt(L.charset)){const D=Ai(A,Et.CHARSET,L.charset);v((R=D==null?void 0:D.charset)==null?void 0:R.bits)&&s.push(jp(e,o++,"image/charset",Array.from(D.charset.bits)))}return s}const Yr=T4();var Ft=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.CONTENT="content",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Ft||{});const ge={session:ie(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function q1(){return ge.session}function rf(){return ge.operator}function L4(e){ge.operator=e}function Pc(){return[...ge.books.values()]}function M4(){const[e]=ge.books.values();return e}function Qr(e){const t=Ct(e);return ge.books.get(e)??Pc().find(n=>n.name===t)}function Dc(e,t){v(Qr(t))&&(ge.software[e]=t)}function Pe(e){return Qr(ge.software[e])}function X1(e){const t=Xy([]);return vt(e)&&(t.name=e),J1(t),sn(z,`created [book] ${t.name}`),t}function U4(e){let t=Qr(e);return v(t)||(t=Xy([]),t.name=e),J1(t),sn(z,`created [book] ${t.name}`),t}function $n(e,t){let n=v(t)?U4(t):Pe(e);return v(n)||(v(n)||(n=M4()),v(n)||(n=X1(t)),v(n)&&sn(z,`opened [book] ${n.name} for ${e}`)),Dc(e,n.id),n}function ti(e,t,n){return Rh($n(e),n,t)}function us(e){const t=$n("main");return Xr(t,e)}function Z1(){const e=$n("main");return Xr(e,"main")}function P4(e){const t=$n("main");return Oh(t,e)}function D4(e,t){ge.books.clear(),e.forEach(r=>{ge.books.set(r.id,r),r.name==="main"&&(ge.software.main=r.id)});const n=Qr(t);if(v(n)&&Dc("main",n.id),!ge.software.main){const r=ge.books.values().next();r.value&&(ge.software.main=r.value.id)}}function J1(e){return ge.books.set(e.id,e),e.id}function B4(e){const t=Qr(e);t&&ge.books.delete(t.id)}function F4(e){if(!vt(e)||!e)return Vt(z,"login",`failed for playerid ==>${e}<==`,e);const t=Pe("main");if(!v(t))return Vt(z,"login:main","login failed to find book 'main'",e);const n=wc(t,e);if(v(n))return!0;const r=Zy(t,Et.BOARD).filter(o=>{const a=is(o);return v(a.title)});if(r.length===0)return Vt(z,"login:title","login failed to find board with 'title' stat",e);const i=bc(t,"player");if(!v(i))return Vt(z,"login:player","login failed to find object type 'player'",e);const s=Si(i0(e,r));if(v(s)){const o=i.name??"player",a=Fh(s,{x:0,y:0},o,e);if(v(a==null?void 0:a.id))return a.player=e,Ch(t,e,s.id),!0}return!1}function Y1(e){const t=Pe("main"),n=wc(t,e);Ch(t,e,""),Ec(t,n,xi(n,e)),h1(n,e),Oh(t,e),Oh(t,G1(e))}function $4(e){const t=Pe("main"),n=Qy(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;pf(c)&&v(e[c])===!1&&(e[c]=0,Ch(t,c,i.id))}}}function j4(e){Yr.message(e)}function Q1(e,t,n,r,i=q_){if(!v(e)||!v(t)||!v(n))return;const s={...T};T.book=e,T.board=t,T.element=n,T.elementid=n.id??"",T.elementisplayer=pf(T.elementid),T.fromplayer=T.elementisplayer?T.elementid:ge.operator;const o=An(e,n),a=n.cycle??(o==null?void 0:o.cycle)??i,c=n.id??"",u=Dh(n);if(Yr.tick(c,go.CODE_PAGE,St(a)?a:i,u,r),St(n==null?void 0:n.tickertime)&&T.timestamp-n.tickertime>No*5&&(n.tickertime=0,n.tickertext=""),T.elementisplayer){const l=us(T.elementid);l.inputcurrent=0}H_(s).forEach(l=>{T[l]=s[l]})}function z4(e,t){ge.loaders.set(e,t)}function W4(){const e=Pe("main");if(!v(e))return;const t=e.timestamp+1,n=_r.HALT_AT_COUNT;_r.HALT_AT_COUNT=n*2,ge.loaders.forEach((i,s)=>{Yr.tick(s,go.LOADER,1,"loader",i),Yr.isended(s)&&(Yr.halt(s),ge.loaders.delete(s))}),_r.HALT_AT_COUNT=n,e.timestamp=t,T.timestamp=t,Qy(e).forEach(i=>{const s=BC(e,i,t);for(let o=0;o<s.length;++o){const{id:a,type:c,code:u,object:l}=s[o];c===Et.ERROR?Yr.halt(a):Q1(e,i,l,u)}})}function H4(e,t=""){var s;const n=$n("main");if(!v(n))return;const r=`${e}_cli`;T.fromplayer=e,T.timestamp=n.timestamp,T.book=n,T.board=wc(n,e),T.element=xi(T.board,e),T.elementid=((s=T.element)==null?void 0:s.id)??"",T.elementisplayer=!0;const i=_r.HALT_AT_COUNT;_r.HALT_AT_COUNT=i*8,Op(z,"running",n.timestamp,r,t),Yr.once(r,go.CLI,"cli",t),_r.HALT_AT_COUNT=i}function Bc(e){const t=$n("main"),n=ss(t,e);if(!v(t)||!v(n)||!v(T.element))return;const r=`${e}_run`,i=Dh(T.element),s=(n==null?void 0:n.code)??"";Yr.once(r,go.CODE_PAGE,i,s)}function G4(e){const t=Pe("main"),n=wc(t,e),r=[];if(!v(t)||!v(n))return r;const i=fo(t,n.over??""),s=fo(t,n.under??""),o=[i,n,s].filter(v);let a=0;for(let c=0;c<o.length;++c){const u=o[c],l=N4(e,a,t,u,u===n);a+=l.length,r.push(...l)}return r}function V4(e){const t=Pe(Ft.MAIN),n=Xr(t,Ft.GADGETSTORE);delete n[e]}tk(e=>{const t=Pe(Ft.MAIN),n=Xr(t,Ft.GADGETSTORE);let r=n[e];return v(r)||(n[e]=r=Ql()),r});const sf=Mi("gadgetserver",["tock"],e=>{if(!sf.session(e))return;const t=Pe(Ft.MAIN),n=(t==null?void 0:t.activelist)??[],r=Xr(t,Ft.GADGETSYNC);switch(e.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=di(s);o.layers=G4(s);const a=r[s]??{},c=bf(a,o);c.length&&(r[s]=ur(o),_E(sf,c,s))}break;case"desync":e.player&&yE(sf,di(e.player),e.player);break;case"clearscroll":e.player&&ek(e.player);break;case"clearplayer":e.player&&V4(e.player);break}});function Fc(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var t_={exports:{}};/*!

  JSZip v3.10.1 - A JavaScript class for generating and reading zip files
  <http://stuartk.com/jszip>

  (c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
  Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

  JSZip uses the library pako released under the MIT license :
  https://github.com/nodeca/pako/blob/main/LICENSE
  */(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(u,l){if(!i[u]){if(!r[u]){var h=typeof Fc=="function"&&Fc;if(!l&&h)return h(u,!0);if(a)return a(u,!0);var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[u]={exports:{}};r[u][0].call(f.exports,function(p){var m=r[u][1][p];return o(m||p)},f,f.exports,n,r,i,s)}return i[u].exports}for(var a=typeof Fc=="function"&&Fc,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var u,l,h,d,f,p,m,b=[],_=0,w=c.length,E=w,A=s.getTypeOf(c)!=="string";_<c.length;)E=w-_,h=A?(u=c[_++],l=_<w?c[_++]:0,_<w?c[_++]:0):(u=c.charCodeAt(_++),l=_<w?c.charCodeAt(_++):0,_<w?c.charCodeAt(_++):0),d=u>>2,f=(3&u)<<4|l>>4,p=1<E?(15&l)<<2|h>>6:64,m=2<E?63&h:64,b.push(a.charAt(d)+a.charAt(f)+a.charAt(p)+a.charAt(m));return b.join("")},i.decode=function(c){var u,l,h,d,f,p,m=0,b=0,_="data:";if(c.substr(0,_.length)===_)throw new Error("Invalid base64 input, it looks like a data url.");var w,E=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&E--,c.charAt(c.length-2)===a.charAt(64)&&E--,E%1!=0)throw new Error("Invalid base64 input, bad content length.");for(w=o.uint8array?new Uint8Array(0|E):new Array(0|E);m<c.length;)u=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,l=(15&d)<<4|(f=a.indexOf(c.charAt(m++)))>>2,h=(3&f)<<6|(p=a.indexOf(c.charAt(m++))),w[b++]=u,f!==64&&(w[b++]=l),p!==64&&(w[b++]=h);return w}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function u(l,h,d,f,p){this.compressedSize=l,this.uncompressedSize=h,this.crc32=d,this.compression=f,this.compressedContent=p}u.prototype={getContentWorker:function(){var l=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return l.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(l,h,d){return l.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],u=0;u<256;u++){a=u;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;c[u]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(u,l,h,d){var f=o,p=d+h;u^=-1;for(var m=d;m<p;m++)u=u>>>8^f[255&(u^l[m])];return-1^u}(0|c,a,a.length,0):function(u,l,h,d){var f=o,p=d+h;u^=-1;for(var m=d;m<p;m++)u=u>>>8^f[255&(u^l.charCodeAt(m))];return-1^u}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),u=s?"uint8array":"array";function l(h,d){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(l,c),l.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,h.data),!1)},l.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},i.compressWorker=function(h){return new l("Deflate",h)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(f,p){var m,b="";for(m=0;m<p;m++)b+=String.fromCharCode(255&f),f>>>=8;return b}function o(f,p,m,b,_,w){var E,A,L=f.file,I=f.compression,R=w!==u.utf8encode,D=a.transformTo("string",w(L.name)),C=a.transformTo("string",u.utf8encode(L.name)),q=L.comment,ot=a.transformTo("string",w(q)),O=a.transformTo("string",u.utf8encode(q)),k=C.length!==L.name.length,g=O.length!==q.length,N="",j="",M="",tt=L.dir,G=L.date,Q={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(Q.crc32=f.crc32,Q.compressedSize=f.compressedSize,Q.uncompressedSize=f.uncompressedSize);var U=0;p&&(U|=8),R||!k&&!g||(U|=2048);var B=0,ut=0;tt&&(B|=16),_==="UNIX"?(ut=798,B|=function(nt,kt){var Dt=nt;return nt||(Dt=kt?16893:33204),(65535&Dt)<<16}(L.unixPermissions,tt)):(ut=20,B|=function(nt){return 63&(nt||0)}(L.dosPermissions)),E=G.getUTCHours(),E<<=6,E|=G.getUTCMinutes(),E<<=5,E|=G.getUTCSeconds()/2,A=G.getUTCFullYear()-1980,A<<=4,A|=G.getUTCMonth()+1,A<<=5,A|=G.getUTCDate(),k&&(j=s(1,1)+s(l(D),4)+C,N+="up"+s(j.length,2)+j),g&&(M=s(1,1)+s(l(ot),4)+O,N+="uc"+s(M.length,2)+M);var et="";return et+=`
\0`,et+=s(U,2),et+=I.magic,et+=s(E,2),et+=s(A,2),et+=s(Q.crc32,4),et+=s(Q.compressedSize,4),et+=s(Q.uncompressedSize,4),et+=s(D.length,2),et+=s(N.length,2),{fileRecord:h.LOCAL_FILE_HEADER+et+D+N,dirRecord:h.CENTRAL_FILE_HEADER+s(ut,2)+et+s(ot.length,2)+"\0\0\0\0"+s(B,4)+s(b,4)+D+N+ot}}var a=n("../utils"),c=n("../stream/GenericWorker"),u=n("../utf8"),l=n("../crc32"),h=n("../signature");function d(f,p,m,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(f){var p=f.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-b-1))/m:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var p=this.streamFiles&&!f.file.dir;if(p){var m=o(f,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var p=this.streamFiles&&!f.file.dir,m=o(f,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(b){return h.DATA_DESCRIPTOR+s(b.crc32,4)+s(b.compressedSize,4)+s(b.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-f,b=function(_,w,E,A,L){var I=a.transformTo("string",L(A));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(_,2)+s(_,2)+s(w,4)+s(E,4)+s(I.length,2)+I}(this.dirRecords.length,m,f,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var p=this;return f.on("data",function(m){p.processChunk(m)}),f.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),f.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var p=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var m=0;m<p.length;m++)try{p[m].error(f)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,p=0;p<f.length;p++)f[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,u){var l=new o(c.streamFiles,u,c.platform,c.encodeFileName),h=0;try{a.forEach(function(d,f){h++;var p=function(w,E){var A=w||E,L=s[A];if(!L)throw new Error(A+" is not a valid compression method !");return L}(f.options.compression,c.compression),m=f.options.compressionOptions||c.compressionOptions||{},b=f.dir,_=f.date;f._compressWorker(p,m).withStreamInfo("file",{name:d,dir:b,date:_,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(l)}),l.entriesCount=h}catch(d){l.error(d)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),u=n("./stream/Crc32Probe"),l=n("./nodejsUtils");function h(d){return new o.Promise(function(f,p){var m=d.decompressed.getContentWorker().pipe(new u);m.on("error",function(b){p(b)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}r.exports=function(d,f){var p=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(m){var b=new c(f);return b.load(m),b}).then(function(m){var b=[o.Promise.resolve(m)],_=m.files;if(f.checkCRC32)for(var w=0;w<_.length;w++)b.push(h(_[w]));return o.Promise.all(b)}).then(function(m){for(var b=m.shift(),_=b.files,w=0;w<_.length;w++){var E=_[w],A=E.fileNameStr,L=s.resolve(E.fileNameStr);p.file(L,E.decompressed,{binary:!0,optimizedBinaryString:!0,date:E.date,dir:E.dir,comment:E.fileCommentStr.length?E.fileCommentStr:null,unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions,createFolders:f.createFolders}),E.dir||(p.file(L).unsafeOriginalName=A)}return b.zipComment.length&&(p.comment=b.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,u){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(u)}s.inherits(a,o),a.prototype._bindStream=function(c){var u=this;(this._stream=c).pause(),c.on("data",function(l){u.push({data:l,meta:{percent:0}})}).on("error",function(l){u.isPaused?this.generatedError=l:u.error(l)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,u){s.call(this,c),this._helper=a;var l=this;a.on("data",function(h,d){l.push(h)||l._helper.pause(),u&&u(d)}).on("error",function(h){l.emit("error",h)}).on("end",function(){l.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,o)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var o=new Buffer(s);return o.fill(0),o},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(L,I,R){var D,C=a.getTypeOf(I),q=a.extend(R||{},l);q.date=q.date||new Date,q.compression!==null&&(q.compression=q.compression.toUpperCase()),typeof q.unixPermissions=="string"&&(q.unixPermissions=parseInt(q.unixPermissions,8)),q.unixPermissions&&16384&q.unixPermissions&&(q.dir=!0),q.dosPermissions&&16&q.dosPermissions&&(q.dir=!0),q.dir&&(L=_(L)),q.createFolders&&(D=b(L))&&w.call(this,D,!0);var ot=C==="string"&&q.binary===!1&&q.base64===!1;R&&R.binary!==void 0||(q.binary=!ot),(I instanceof h&&I.uncompressedSize===0||q.dir||!I||I.length===0)&&(q.base64=!1,q.binary=!0,I="",q.compression="STORE",C="string");var O=null;O=I instanceof h||I instanceof c?I:p.isNode&&p.isStream(I)?new m(L,I):a.prepareContent(L,I,q.binary,q.optimizedBinaryString,q.base64);var k=new d(L,O,q);this.files[L]=k}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),u=n("./stream/StreamHelper"),l=n("./defaults"),h=n("./compressedObject"),d=n("./zipObject"),f=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),b=function(L){L.slice(-1)==="/"&&(L=L.substring(0,L.length-1));var I=L.lastIndexOf("/");return 0<I?L.substring(0,I):""},_=function(L){return L.slice(-1)!=="/"&&(L+="/"),L},w=function(L,I){return I=I!==void 0?I:l.createFolders,L=_(L),this.files[L]||s.call(this,L,null,{dir:!0,createFolders:I}),this.files[L]};function E(L){return Object.prototype.toString.call(L)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(L){var I,R,D;for(I in this.files)D=this.files[I],(R=I.slice(this.root.length,I.length))&&I.slice(0,this.root.length)===this.root&&L(R,D)},filter:function(L){var I=[];return this.forEach(function(R,D){L(R,D)&&I.push(D)}),I},file:function(L,I,R){if(arguments.length!==1)return L=this.root+L,s.call(this,L,I,R),this;if(E(L)){var D=L;return this.filter(function(q,ot){return!ot.dir&&D.test(q)})}var C=this.files[this.root+L];return C&&!C.dir?C:null},folder:function(L){if(!L)return this;if(E(L))return this.filter(function(C,q){return q.dir&&L.test(C)});var I=this.root+L,R=w.call(this,I),D=this.clone();return D.root=R.name,D},remove:function(L){L=this.root+L;var I=this.files[L];if(I||(L.slice(-1)!=="/"&&(L+="/"),I=this.files[L]),I&&!I.dir)delete this.files[L];else for(var R=this.filter(function(C,q){return q.name.slice(0,L.length)===L}),D=0;D<R.length;D++)delete this.files[R[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(L){var I,R={};try{if((R=a.extend(L||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");a.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var D=R.comment||this.comment||"";I=f.generateWorker(this,R,D)}catch(C){(I=new c("error")).error(C)}return new u(I,R.type||"string",R.mimeType)},generateAsync:function(L,I){return this.generateInternalStream(L).accumulate(I)},generateNodeStream:function(L,I){return(L=L||{}).type||(L.type="nodebuffer"),this.generateInternalStream(L).toNodejsStream(I)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===u&&this.data[d+2]===l&&this.data[d+3]===h)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&u===d[1]&&l===d[2]&&h===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,u=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)u=(u<<8)+this.byteAt(c);return this.index+=a,u},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),u=n("./NodeBufferReader"),l=n("./Uint8ArrayReader");r.exports=function(h){var d=s.getTypeOf(h);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new u(h):o.uint8array?new l(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(l){u.dataIsReady=!0,u.data=l,u.max=l&&l.length||0,u.type=s.getTypeOf(l),u.isPaused||u._tickAndRepeat()},function(l){u.error(l)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,u);break;case"uint8array":c=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":c=this.data.slice(this.index,u)}return this.index=u,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),u=n("../support"),l=n("../external"),h=null;if(u.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new l.Promise(function(b,_){var w=[],E=p._internalType,A=p._outputType,L=p._mimeType;p.on("data",function(I,R){w.push(I),m&&m(R)}).on("error",function(I){w=[],_(I)}).on("end",function(){try{var I=function(R,D,C){switch(R){case"blob":return s.newBlob(s.transformTo("arraybuffer",D),C);case"base64":return c.encode(D);default:return s.transformTo(R,D)}}(A,function(R,D){var C,q=0,ot=null,O=0;for(C=0;C<D.length;C++)O+=D[C].length;switch(R){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for(ot=new Uint8Array(O),C=0;C<D.length;C++)ot.set(D[C],q),q+=D[C].length;return ot;case"nodebuffer":return Buffer.concat(D);default:throw new Error("concat : unsupported type '"+R+"'")}}(E,w),L);b(I)}catch(R){_(R)}w=[]}).resume()})}function f(p,m,b){var _=m;switch(m){case"blob":case"arraybuffer":_="uint8array";break;case"base64":_="string"}try{this._internalType=_,this._outputType=m,this._mimeType=b,s.checkSupport(_),this._worker=p.pipe(new o(_)),p.lock()}catch(w){this._worker=new a("error"),this._worker.error(w)}}f.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var b=this;return p==="data"?this._worker.on(p,function(_){m.call(b,_.data,_.meta)}):this._worker.on(p,function(){s.delay(m,arguments,b)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),u=new Array(256),l=0;l<256;l++)u[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;u[254]=u[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):function(p){var m,b,_,w,E,A=p.length,L=0;for(w=0;w<A;w++)(64512&(b=p.charCodeAt(w)))==55296&&w+1<A&&(64512&(_=p.charCodeAt(w+1)))==56320&&(b=65536+(b-55296<<10)+(_-56320),w++),L+=b<128?1:b<2048?2:b<65536?3:4;for(m=o.uint8array?new Uint8Array(L):new Array(L),w=E=0;E<L;w++)(64512&(b=p.charCodeAt(w)))==55296&&w+1<A&&(64512&(_=p.charCodeAt(w+1)))==56320&&(b=65536+(b-55296<<10)+(_-56320),w++),b<128?m[E++]=b:(b<2048?m[E++]=192|b>>>6:(b<65536?m[E++]=224|b>>>12:(m[E++]=240|b>>>18,m[E++]=128|b>>>12&63),m[E++]=128|b>>>6&63),m[E++]=128|63&b);return m}(f)},i.utf8decode=function(f){return o.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):function(p){var m,b,_,w,E=p.length,A=new Array(2*E);for(m=b=0;m<E;)if((_=p[m++])<128)A[b++]=_;else if(4<(w=u[_]))A[b++]=65533,m+=w-1;else{for(_&=w===2?31:w===3?15:7;1<w&&m<E;)_=_<<6|63&p[m++],w--;1<w?A[b++]=65533:_<65536?A[b++]=_:(_-=65536,A[b++]=55296|_>>10&1023,A[b++]=56320|1023&_)}return A.length!==b&&(A.subarray?A=A.subarray(0,b):A.length=b),s.applyFromCharCode(A)}(f=s.transformTo(o.uint8array?"uint8array":"array",f))},s.inherits(h,c),h.prototype.processChunk=function(f){var p=s.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var b=function(w,E){var A;for((E=E||w.length)>w.length&&(E=w.length),A=E-1;0<=A&&(192&w[A])==128;)A--;return A<0||A===0?E:A+u[w[A]]>E?A:E}(p),_=p;b!==p.length&&(o.uint8array?(_=p.subarray(0,b),this.leftOver=p.subarray(b,p.length)):(_=p.slice(0,b),this.leftOver=p.slice(b,p.length))),this.push({data:i.utf8decode(_),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,c),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function u(m){return m}function l(m,b){for(var _=0;_<m.length;++_)b[_]=255&m.charCodeAt(_);return b}n("setimmediate"),i.newBlob=function(m,b){i.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var _=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return _.append(m),_.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,b,_){var w=[],E=0,A=m.length;if(A<=_)return String.fromCharCode.apply(null,m);for(;E<A;)b==="array"||b==="nodebuffer"?w.push(String.fromCharCode.apply(null,m.slice(E,Math.min(E+_,A)))):w.push(String.fromCharCode.apply(null,m.subarray(E,Math.min(E+_,A)))),E+=_;return w.join("")},stringifyByChar:function(m){for(var b="",_=0;_<m.length;_++)b+=String.fromCharCode(m[_]);return b},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var b=65536,_=i.getTypeOf(m),w=!0;if(_==="uint8array"?w=h.applyCanBeUsed.uint8array:_==="nodebuffer"&&(w=h.applyCanBeUsed.nodebuffer),w)for(;1<b;)try{return h.stringifyByChunk(m,_,b)}catch{b=Math.floor(b/2)}return h.stringifyByChar(m)}function f(m,b){for(var _=0;_<m.length;_++)b[_]=m[_];return b}i.applyFromCharCode=d;var p={};p.string={string:u,array:function(m){return l(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return l(m,new Uint8Array(m.length))},nodebuffer:function(m){return l(m,a.allocBuffer(m.length))}},p.array={string:d,array:u,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return f(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:u,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:u,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return f(m,new Uint8Array(m.length))},nodebuffer:u},i.transformTo=function(m,b){if(b=b||"",!m)return b;i.checkSupport(m);var _=i.getTypeOf(b);return p[_][m](b)},i.resolve=function(m){for(var b=m.split("/"),_=[],w=0;w<b.length;w++){var E=b[w];E==="."||E===""&&w!==0&&w!==b.length-1||(E===".."?_.pop():_.push(E))}return _.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var b,_,w="";for(_=0;_<(m||"").length;_++)w+="\\x"+((b=m.charCodeAt(_))<16?"0":"")+b.toString(16).toUpperCase();return w},i.delay=function(m,b,_){setImmediate(function(){m.apply(_||null,b||[])})},i.inherits=function(m,b){function _(){}_.prototype=b.prototype,m.prototype=new _},i.extend=function(){var m,b,_={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&_[b]===void 0&&(_[b]=arguments[m][b]);return _},i.prepareContent=function(m,b,_,w,E){return c.Promise.resolve(b).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(L,I){var R=new FileReader;R.onload=function(D){L(D.target.result)},R.onerror=function(D){I(D.target.error)},R.readAsArrayBuffer(A)}):A}).then(function(A){var L=i.getTypeOf(A);return L?(L==="arraybuffer"?A=i.transformTo("uint8array",A):L==="string"&&(E?A=o.decode(A):_&&w!==!0&&(A=function(I){return l(I,s.uint8array?new Uint8Array(I.length):new Array(I.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),u=n("./support");function l(h){this.files=[],this.loadOptions=h}l.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(h)+")")}},isSignature:function(h,d){var f=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===d;return this.reader.setIndex(f),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=u.uint8array?"uint8array":"array",f=o.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,f,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var p=d-f;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),u=n("./utf8"),l=n("./compressions"),h=n("./support");function d(f,p){this.options=f,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var p,m;if(f.skip(22),this.fileNameLength=f.readInt(2),m=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(b){for(var _ in l)if(Object.prototype.hasOwnProperty.call(l,_)&&l[_].magic===b)return l[_];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var p=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(p),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var p,m,b,_=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<_;)p=f.readInt(2),m=f.readInt(2),b=f.readData(m),this.extraFields[p]={id:p,length:m,value:b};f.setIndex(_)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var _=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(_)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:u.utf8decode(p.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:u.utf8decode(p.readData(f.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,b){this.name=p,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),u=n("./compressedObject"),l=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,b="string";try{if(!p)throw new Error("No output type specified.");var _=(b=p.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var w=!this._dataBinary;w&&!_&&(m=m.pipe(new c.Utf8EncodeWorker)),!w&&_&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(E){(m=new l("error")).error(E)}return new o(m,b,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof u&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),u.createWorkerFrom(b,p,m)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)s.prototype[h[f]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var u=0,l=new c(p),h=s.document.createTextNode("");l.observe(h,{characterData:!0}),o=function(){h.data=u=++u%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var f=[];function p(){var m,b;a=!0;for(var _=f.length;_;){for(b=f,f=[],m=-1;++m<_;)b[m]();_=f.length}a=!1}r.exports=function(m){f.push(m)!==1||a||o()}}).call(this,typeof Be<"u"?Be:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],u=["FULFILLED"],l=["PENDING"];function h(_){if(typeof _!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,_!==o&&m(this,_)}function d(_,w,E){this.promise=_,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}function f(_,w,E){s(function(){var A;try{A=w(E)}catch(L){return a.reject(_,L)}A===_?a.reject(_,new TypeError("Cannot resolve promise with itself")):a.resolve(_,A)})}function p(_){var w=_&&_.then;if(_&&(typeof _=="object"||typeof _=="function")&&typeof w=="function")return function(){w.apply(_,arguments)}}function m(_,w){var E=!1;function A(R){E||(E=!0,a.reject(_,R))}function L(R){E||(E=!0,a.resolve(_,R))}var I=b(function(){w(L,A)});I.status==="error"&&A(I.value)}function b(_,w){var E={};try{E.value=_(w),E.status="success"}catch(A){E.status="error",E.value=A}return E}(r.exports=h).prototype.finally=function(_){if(typeof _!="function")return this;var w=this.constructor;return this.then(function(E){return w.resolve(_()).then(function(){return E})},function(E){return w.resolve(_()).then(function(){throw E})})},h.prototype.catch=function(_){return this.then(null,_)},h.prototype.then=function(_,w){if(typeof _!="function"&&this.state===u||typeof w!="function"&&this.state===c)return this;var E=new this.constructor(o);return this.state!==l?f(E,this.state===u?_:w,this.outcome):this.queue.push(new d(E,_,w)),E},d.prototype.callFulfilled=function(_){a.resolve(this.promise,_)},d.prototype.otherCallFulfilled=function(_){f(this.promise,this.onFulfilled,_)},d.prototype.callRejected=function(_){a.reject(this.promise,_)},d.prototype.otherCallRejected=function(_){f(this.promise,this.onRejected,_)},a.resolve=function(_,w){var E=b(p,w);if(E.status==="error")return a.reject(_,E.value);var A=E.value;if(A)m(_,A);else{_.state=u,_.outcome=w;for(var L=-1,I=_.queue.length;++L<I;)_.queue[L].callFulfilled(w)}return _},a.reject=function(_,w){_.state=c,_.outcome=w;for(var E=-1,A=_.queue.length;++E<A;)_.queue[E].callRejected(w);return _},h.resolve=function(_){return _ instanceof this?_:a.resolve(new this(o),_)},h.reject=function(_){var w=new this(o);return a.reject(w,_)},h.all=function(_){var w=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=_.length,A=!1;if(!E)return this.resolve([]);for(var L=new Array(E),I=0,R=-1,D=new this(o);++R<E;)C(_[R],R);return D;function C(q,ot){w.resolve(q).then(function(O){L[ot]=O,++I!==E||A||(A=!0,a.resolve(D,L))},function(O){A||(A=!0,a.reject(D,O))})}},h.race=function(_){var w=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=_.length,A=!1;if(!E)return this.resolve([]);for(var L=-1,I=new this(o);++L<E;)R=_[L],w.resolve(R).then(function(D){A||(A=!0,a.resolve(I,D))},function(D){A||(A=!0,a.reject(I,D))});var R;return I}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),u=n("./zlib/zstream"),l=Object.prototype.toString,h=0,d=-1,f=0,p=8;function m(_){if(!(this instanceof m))return new m(_);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},_||{});var w=this.options;w.raw&&0<w.windowBits?w.windowBits=-w.windowBits:w.gzip&&0<w.windowBits&&w.windowBits<16&&(w.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var E=s.deflateInit2(this.strm,w.level,w.method,w.windowBits,w.memLevel,w.strategy);if(E!==h)throw new Error(c[E]);if(w.header&&s.deflateSetHeader(this.strm,w.header),w.dictionary){var A;if(A=typeof w.dictionary=="string"?a.string2buf(w.dictionary):l.call(w.dictionary)==="[object ArrayBuffer]"?new Uint8Array(w.dictionary):w.dictionary,(E=s.deflateSetDictionary(this.strm,A))!==h)throw new Error(c[E]);this._dict_set=!0}}function b(_,w){var E=new m(w);if(E.push(_,!0),E.err)throw E.msg||c[E.err];return E.result}m.prototype.push=function(_,w){var E,A,L=this.strm,I=this.options.chunkSize;if(this.ended)return!1;A=w===~~w?w:w===!0?4:0,typeof _=="string"?L.input=a.string2buf(_):l.call(_)==="[object ArrayBuffer]"?L.input=new Uint8Array(_):L.input=_,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new o.Buf8(I),L.next_out=0,L.avail_out=I),(E=s.deflate(L,A))!==1&&E!==h)return this.onEnd(E),!(this.ended=!0);L.avail_out!==0&&(L.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(L.output,L.next_out))):this.onData(o.shrinkBuf(L.output,L.next_out)))}while((0<L.avail_in||L.avail_out===0)&&E!==1);return A===4?(E=s.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===h):A!==2||(this.onEnd(h),!(L.avail_out=0))},m.prototype.onData=function(_){this.chunks.push(_)},m.prototype.onEnd=function(_){_===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},i.Deflate=m,i.deflate=b,i.deflateRaw=function(_,w){return(w=w||{}).raw=!0,b(_,w)},i.gzip=function(_,w){return(w=w||{}).gzip=!0,b(_,w)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),u=n("./zlib/messages"),l=n("./zlib/zstream"),h=n("./zlib/gzheader"),d=Object.prototype.toString;function f(m){if(!(this instanceof f))return new f(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var _=s.inflateInit2(this.strm,b.windowBits);if(_!==c.Z_OK)throw new Error(u[_]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(m,b){var _=new f(b);if(_.push(m,!0),_.err)throw _.msg||u[_.err];return _.result}f.prototype.push=function(m,b){var _,w,E,A,L,I,R=this.strm,D=this.options.chunkSize,C=this.options.dictionary,q=!1;if(this.ended)return!1;w=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?R.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?R.input=new Uint8Array(m):R.input=m,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new o.Buf8(D),R.next_out=0,R.avail_out=D),(_=s.inflate(R,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&C&&(I=typeof C=="string"?a.string2buf(C):d.call(C)==="[object ArrayBuffer]"?new Uint8Array(C):C,_=s.inflateSetDictionary(this.strm,I)),_===c.Z_BUF_ERROR&&q===!0&&(_=c.Z_OK,q=!1),_!==c.Z_STREAM_END&&_!==c.Z_OK)return this.onEnd(_),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&_!==c.Z_STREAM_END&&(R.avail_in!==0||w!==c.Z_FINISH&&w!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(E=a.utf8border(R.output,R.next_out),A=R.next_out-E,L=a.buf2string(R.output,E),R.next_out=A,R.avail_out=D-A,A&&o.arraySet(R.output,R.output,E,A,0),this.onData(L)):this.onData(o.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(q=!0)}while((0<R.avail_in||R.avail_out===0)&&_!==c.Z_STREAM_END);return _===c.Z_STREAM_END&&(w=c.Z_FINISH),w===c.Z_FINISH?(_=s.inflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===c.Z_OK):w!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(R.avail_out=0))},f.prototype.onData=function(m){this.chunks.push(m)},f.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=f,i.inflate=p,i.inflateRaw=function(m,b){return(b=b||{}).raw=!0,p(m,b)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var l=u.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)l.hasOwnProperty(h)&&(c[h]=l[h])}}return c},i.shrinkBuf=function(c,u){return c.length===u?c:c.subarray?c.subarray(0,u):(c.length=u,c)};var o={arraySet:function(c,u,l,h,d){if(u.subarray&&c.subarray)c.set(u.subarray(l,l+h),d);else for(var f=0;f<h;f++)c[d+f]=u[l+f]},flattenChunks:function(c){var u,l,h,d,f,p;for(u=h=0,l=c.length;u<l;u++)h+=c[u].length;for(p=new Uint8Array(h),u=d=0,l=c.length;u<l;u++)f=c[u],p.set(f,d),d+=f.length;return p}},a={arraySet:function(c,u,l,h,d){for(var f=0;f<h;f++)c[d+f]=u[l+f]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function l(h,d){if(d<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,d));for(var f="",p=0;p<d;p++)f+=String.fromCharCode(h[p]);return f}c[254]=c[254]=1,i.string2buf=function(h){var d,f,p,m,b,_=h.length,w=0;for(m=0;m<_;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),w+=f<128?1:f<2048?2:f<65536?3:4;for(d=new s.Buf8(w),m=b=0;b<w;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),f<128?d[b++]=f:(f<2048?d[b++]=192|f>>>6:(f<65536?d[b++]=224|f>>>12:(d[b++]=240|f>>>18,d[b++]=128|f>>>12&63),d[b++]=128|f>>>6&63),d[b++]=128|63&f);return d},i.buf2binstring=function(h){return l(h,h.length)},i.binstring2buf=function(h){for(var d=new s.Buf8(h.length),f=0,p=d.length;f<p;f++)d[f]=h.charCodeAt(f);return d},i.buf2string=function(h,d){var f,p,m,b,_=d||h.length,w=new Array(2*_);for(f=p=0;f<_;)if((m=h[f++])<128)w[p++]=m;else if(4<(b=c[m]))w[p++]=65533,f+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&f<_;)m=m<<6|63&h[f++],b--;1<b?w[p++]=65533:m<65536?w[p++]=m:(m-=65536,w[p++]=55296|m>>10&1023,w[p++]=56320|1023&m)}return l(w,p)},i.utf8border=function(h,d){var f;for((d=d||h.length)>h.length&&(d=h.length),f=d-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?d:f+c[h[f]]>d?f:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var u=65535&s|0,l=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;l=l+(u=u+o[c++]|0)|0,--h;);u%=65521,l%=65521}return u|l<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,u){var l=s,h=u+c;o^=-1;for(var d=u;d<h;d++)o=o>>>8^l[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),u=n("./crc32"),l=n("./messages"),h=0,d=4,f=0,p=-2,m=-1,b=4,_=2,w=8,E=9,A=286,L=30,I=19,R=2*A+1,D=15,C=3,q=258,ot=q+C+1,O=42,k=113,g=1,N=2,j=3,M=4;function tt(y,X){return y.msg=l[X],X}function G(y){return(y<<1)-(4<y?9:0)}function Q(y){for(var X=y.length;0<=--X;)y[X]=0}function U(y){var X=y.state,V=X.pending;V>y.avail_out&&(V=y.avail_out),V!==0&&(o.arraySet(y.output,X.pending_buf,X.pending_out,V,y.next_out),y.next_out+=V,X.pending_out+=V,y.total_out+=V,y.avail_out-=V,X.pending-=V,X.pending===0&&(X.pending_out=0))}function B(y,X){a._tr_flush_block(y,0<=y.block_start?y.block_start:-1,y.strstart-y.block_start,X),y.block_start=y.strstart,U(y.strm)}function ut(y,X){y.pending_buf[y.pending++]=X}function et(y,X){y.pending_buf[y.pending++]=X>>>8&255,y.pending_buf[y.pending++]=255&X}function nt(y,X){var V,x,S=y.max_chain_length,$=y.strstart,Z=y.prev_length,Y=y.nice_match,H=y.strstart>y.w_size-ot?y.strstart-(y.w_size-ot):0,rt=y.window,ht=y.w_mask,it=y.prev,pt=y.strstart+q,Qt=rt[$+Z-1],Pt=rt[$+Z];y.prev_length>=y.good_match&&(S>>=2),Y>y.lookahead&&(Y=y.lookahead);do if(rt[(V=X)+Z]===Pt&&rt[V+Z-1]===Qt&&rt[V]===rt[$]&&rt[++V]===rt[$+1]){$+=2,V++;do;while(rt[++$]===rt[++V]&&rt[++$]===rt[++V]&&rt[++$]===rt[++V]&&rt[++$]===rt[++V]&&rt[++$]===rt[++V]&&rt[++$]===rt[++V]&&rt[++$]===rt[++V]&&rt[++$]===rt[++V]&&$<pt);if(x=q-(pt-$),$=pt-q,Z<x){if(y.match_start=X,Y<=(Z=x))break;Qt=rt[$+Z-1],Pt=rt[$+Z]}}while((X=it[X&ht])>H&&--S!=0);return Z<=y.lookahead?Z:y.lookahead}function kt(y){var X,V,x,S,$,Z,Y,H,rt,ht,it=y.w_size;do{if(S=y.window_size-y.lookahead-y.strstart,y.strstart>=it+(it-ot)){for(o.arraySet(y.window,y.window,it,it,0),y.match_start-=it,y.strstart-=it,y.block_start-=it,X=V=y.hash_size;x=y.head[--X],y.head[X]=it<=x?x-it:0,--V;);for(X=V=it;x=y.prev[--X],y.prev[X]=it<=x?x-it:0,--V;);S+=it}if(y.strm.avail_in===0)break;if(Z=y.strm,Y=y.window,H=y.strstart+y.lookahead,rt=S,ht=void 0,ht=Z.avail_in,rt<ht&&(ht=rt),V=ht===0?0:(Z.avail_in-=ht,o.arraySet(Y,Z.input,Z.next_in,ht,H),Z.state.wrap===1?Z.adler=c(Z.adler,Y,ht,H):Z.state.wrap===2&&(Z.adler=u(Z.adler,Y,ht,H)),Z.next_in+=ht,Z.total_in+=ht,ht),y.lookahead+=V,y.lookahead+y.insert>=C)for($=y.strstart-y.insert,y.ins_h=y.window[$],y.ins_h=(y.ins_h<<y.hash_shift^y.window[$+1])&y.hash_mask;y.insert&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[$+C-1])&y.hash_mask,y.prev[$&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=$,$++,y.insert--,!(y.lookahead+y.insert<C)););}while(y.lookahead<ot&&y.strm.avail_in!==0)}function Dt(y,X){for(var V,x;;){if(y.lookahead<ot){if(kt(y),y.lookahead<ot&&X===h)return g;if(y.lookahead===0)break}if(V=0,y.lookahead>=C&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+C-1])&y.hash_mask,V=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),V!==0&&y.strstart-V<=y.w_size-ot&&(y.match_length=nt(y,V)),y.match_length>=C)if(x=a._tr_tally(y,y.strstart-y.match_start,y.match_length-C),y.lookahead-=y.match_length,y.match_length<=y.max_lazy_match&&y.lookahead>=C){for(y.match_length--;y.strstart++,y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+C-1])&y.hash_mask,V=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart,--y.match_length!=0;);y.strstart++}else y.strstart+=y.match_length,y.match_length=0,y.ins_h=y.window[y.strstart],y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+1])&y.hash_mask;else x=a._tr_tally(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++;if(x&&(B(y,!1),y.strm.avail_out===0))return g}return y.insert=y.strstart<C-1?y.strstart:C-1,X===d?(B(y,!0),y.strm.avail_out===0?j:M):y.last_lit&&(B(y,!1),y.strm.avail_out===0)?g:N}function wt(y,X){for(var V,x,S;;){if(y.lookahead<ot){if(kt(y),y.lookahead<ot&&X===h)return g;if(y.lookahead===0)break}if(V=0,y.lookahead>=C&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+C-1])&y.hash_mask,V=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),y.prev_length=y.match_length,y.prev_match=y.match_start,y.match_length=C-1,V!==0&&y.prev_length<y.max_lazy_match&&y.strstart-V<=y.w_size-ot&&(y.match_length=nt(y,V),y.match_length<=5&&(y.strategy===1||y.match_length===C&&4096<y.strstart-y.match_start)&&(y.match_length=C-1)),y.prev_length>=C&&y.match_length<=y.prev_length){for(S=y.strstart+y.lookahead-C,x=a._tr_tally(y,y.strstart-1-y.prev_match,y.prev_length-C),y.lookahead-=y.prev_length-1,y.prev_length-=2;++y.strstart<=S&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+C-1])&y.hash_mask,V=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),--y.prev_length!=0;);if(y.match_available=0,y.match_length=C-1,y.strstart++,x&&(B(y,!1),y.strm.avail_out===0))return g}else if(y.match_available){if((x=a._tr_tally(y,0,y.window[y.strstart-1]))&&B(y,!1),y.strstart++,y.lookahead--,y.strm.avail_out===0)return g}else y.match_available=1,y.strstart++,y.lookahead--}return y.match_available&&(x=a._tr_tally(y,0,y.window[y.strstart-1]),y.match_available=0),y.insert=y.strstart<C-1?y.strstart:C-1,X===d?(B(y,!0),y.strm.avail_out===0?j:M):y.last_lit&&(B(y,!1),y.strm.avail_out===0)?g:N}function _t(y,X,V,x,S){this.good_length=y,this.max_lazy=X,this.nice_length=V,this.max_chain=x,this.func=S}function Wt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*R),this.dyn_dtree=new o.Buf16(2*(2*L+1)),this.bl_tree=new o.Buf16(2*(2*I+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(D+1),this.heap=new o.Buf16(2*A+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function $t(y){var X;return y&&y.state?(y.total_in=y.total_out=0,y.data_type=_,(X=y.state).pending=0,X.pending_out=0,X.wrap<0&&(X.wrap=-X.wrap),X.status=X.wrap?O:k,y.adler=X.wrap===2?0:1,X.last_flush=h,a._tr_init(X),f):tt(y,p)}function ye(y){var X=$t(y);return X===f&&function(V){V.window_size=2*V.w_size,Q(V.head),V.max_lazy_match=s[V.level].max_lazy,V.good_match=s[V.level].good_length,V.nice_match=s[V.level].nice_length,V.max_chain_length=s[V.level].max_chain,V.strstart=0,V.block_start=0,V.lookahead=0,V.insert=0,V.match_length=V.prev_length=C-1,V.match_available=0,V.ins_h=0}(y.state),X}function Se(y,X,V,x,S,$){if(!y)return p;var Z=1;if(X===m&&(X=6),x<0?(Z=0,x=-x):15<x&&(Z=2,x-=16),S<1||E<S||V!==w||x<8||15<x||X<0||9<X||$<0||b<$)return tt(y,p);x===8&&(x=9);var Y=new Wt;return(y.state=Y).strm=y,Y.wrap=Z,Y.gzhead=null,Y.w_bits=x,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=S+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+C-1)/C),Y.window=new o.Buf8(2*Y.w_size),Y.head=new o.Buf16(Y.hash_size),Y.prev=new o.Buf16(Y.w_size),Y.lit_bufsize=1<<S+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new o.Buf8(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=X,Y.strategy=$,Y.method=V,ye(y)}s=[new _t(0,0,0,0,function(y,X){var V=65535;for(V>y.pending_buf_size-5&&(V=y.pending_buf_size-5);;){if(y.lookahead<=1){if(kt(y),y.lookahead===0&&X===h)return g;if(y.lookahead===0)break}y.strstart+=y.lookahead,y.lookahead=0;var x=y.block_start+V;if((y.strstart===0||y.strstart>=x)&&(y.lookahead=y.strstart-x,y.strstart=x,B(y,!1),y.strm.avail_out===0)||y.strstart-y.block_start>=y.w_size-ot&&(B(y,!1),y.strm.avail_out===0))return g}return y.insert=0,X===d?(B(y,!0),y.strm.avail_out===0?j:M):(y.strstart>y.block_start&&(B(y,!1),y.strm.avail_out),g)}),new _t(4,4,8,4,Dt),new _t(4,5,16,8,Dt),new _t(4,6,32,32,Dt),new _t(4,4,16,16,wt),new _t(8,16,32,32,wt),new _t(8,16,128,128,wt),new _t(8,32,128,256,wt),new _t(32,128,258,1024,wt),new _t(32,258,258,4096,wt)],i.deflateInit=function(y,X){return Se(y,X,w,15,8,0)},i.deflateInit2=Se,i.deflateReset=ye,i.deflateResetKeep=$t,i.deflateSetHeader=function(y,X){return y&&y.state?y.state.wrap!==2?p:(y.state.gzhead=X,f):p},i.deflate=function(y,X){var V,x,S,$;if(!y||!y.state||5<X||X<0)return y?tt(y,p):p;if(x=y.state,!y.output||!y.input&&y.avail_in!==0||x.status===666&&X!==d)return tt(y,y.avail_out===0?-5:p);if(x.strm=y,V=x.last_flush,x.last_flush=X,x.status===O)if(x.wrap===2)y.adler=0,ut(x,31),ut(x,139),ut(x,8),x.gzhead?(ut(x,(x.gzhead.text?1:0)+(x.gzhead.hcrc?2:0)+(x.gzhead.extra?4:0)+(x.gzhead.name?8:0)+(x.gzhead.comment?16:0)),ut(x,255&x.gzhead.time),ut(x,x.gzhead.time>>8&255),ut(x,x.gzhead.time>>16&255),ut(x,x.gzhead.time>>24&255),ut(x,x.level===9?2:2<=x.strategy||x.level<2?4:0),ut(x,255&x.gzhead.os),x.gzhead.extra&&x.gzhead.extra.length&&(ut(x,255&x.gzhead.extra.length),ut(x,x.gzhead.extra.length>>8&255)),x.gzhead.hcrc&&(y.adler=u(y.adler,x.pending_buf,x.pending,0)),x.gzindex=0,x.status=69):(ut(x,0),ut(x,0),ut(x,0),ut(x,0),ut(x,0),ut(x,x.level===9?2:2<=x.strategy||x.level<2?4:0),ut(x,3),x.status=k);else{var Z=w+(x.w_bits-8<<4)<<8;Z|=(2<=x.strategy||x.level<2?0:x.level<6?1:x.level===6?2:3)<<6,x.strstart!==0&&(Z|=32),Z+=31-Z%31,x.status=k,et(x,Z),x.strstart!==0&&(et(x,y.adler>>>16),et(x,65535&y.adler)),y.adler=1}if(x.status===69)if(x.gzhead.extra){for(S=x.pending;x.gzindex<(65535&x.gzhead.extra.length)&&(x.pending!==x.pending_buf_size||(x.gzhead.hcrc&&x.pending>S&&(y.adler=u(y.adler,x.pending_buf,x.pending-S,S)),U(y),S=x.pending,x.pending!==x.pending_buf_size));)ut(x,255&x.gzhead.extra[x.gzindex]),x.gzindex++;x.gzhead.hcrc&&x.pending>S&&(y.adler=u(y.adler,x.pending_buf,x.pending-S,S)),x.gzindex===x.gzhead.extra.length&&(x.gzindex=0,x.status=73)}else x.status=73;if(x.status===73)if(x.gzhead.name){S=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>S&&(y.adler=u(y.adler,x.pending_buf,x.pending-S,S)),U(y),S=x.pending,x.pending===x.pending_buf_size)){$=1;break}$=x.gzindex<x.gzhead.name.length?255&x.gzhead.name.charCodeAt(x.gzindex++):0,ut(x,$)}while($!==0);x.gzhead.hcrc&&x.pending>S&&(y.adler=u(y.adler,x.pending_buf,x.pending-S,S)),$===0&&(x.gzindex=0,x.status=91)}else x.status=91;if(x.status===91)if(x.gzhead.comment){S=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>S&&(y.adler=u(y.adler,x.pending_buf,x.pending-S,S)),U(y),S=x.pending,x.pending===x.pending_buf_size)){$=1;break}$=x.gzindex<x.gzhead.comment.length?255&x.gzhead.comment.charCodeAt(x.gzindex++):0,ut(x,$)}while($!==0);x.gzhead.hcrc&&x.pending>S&&(y.adler=u(y.adler,x.pending_buf,x.pending-S,S)),$===0&&(x.status=103)}else x.status=103;if(x.status===103&&(x.gzhead.hcrc?(x.pending+2>x.pending_buf_size&&U(y),x.pending+2<=x.pending_buf_size&&(ut(x,255&y.adler),ut(x,y.adler>>8&255),y.adler=0,x.status=k)):x.status=k),x.pending!==0){if(U(y),y.avail_out===0)return x.last_flush=-1,f}else if(y.avail_in===0&&G(X)<=G(V)&&X!==d)return tt(y,-5);if(x.status===666&&y.avail_in!==0)return tt(y,-5);if(y.avail_in!==0||x.lookahead!==0||X!==h&&x.status!==666){var Y=x.strategy===2?function(H,rt){for(var ht;;){if(H.lookahead===0&&(kt(H),H.lookahead===0)){if(rt===h)return g;break}if(H.match_length=0,ht=a._tr_tally(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++,ht&&(B(H,!1),H.strm.avail_out===0))return g}return H.insert=0,rt===d?(B(H,!0),H.strm.avail_out===0?j:M):H.last_lit&&(B(H,!1),H.strm.avail_out===0)?g:N}(x,X):x.strategy===3?function(H,rt){for(var ht,it,pt,Qt,Pt=H.window;;){if(H.lookahead<=q){if(kt(H),H.lookahead<=q&&rt===h)return g;if(H.lookahead===0)break}if(H.match_length=0,H.lookahead>=C&&0<H.strstart&&(it=Pt[pt=H.strstart-1])===Pt[++pt]&&it===Pt[++pt]&&it===Pt[++pt]){Qt=H.strstart+q;do;while(it===Pt[++pt]&&it===Pt[++pt]&&it===Pt[++pt]&&it===Pt[++pt]&&it===Pt[++pt]&&it===Pt[++pt]&&it===Pt[++pt]&&it===Pt[++pt]&&pt<Qt);H.match_length=q-(Qt-pt),H.match_length>H.lookahead&&(H.match_length=H.lookahead)}if(H.match_length>=C?(ht=a._tr_tally(H,1,H.match_length-C),H.lookahead-=H.match_length,H.strstart+=H.match_length,H.match_length=0):(ht=a._tr_tally(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++),ht&&(B(H,!1),H.strm.avail_out===0))return g}return H.insert=0,rt===d?(B(H,!0),H.strm.avail_out===0?j:M):H.last_lit&&(B(H,!1),H.strm.avail_out===0)?g:N}(x,X):s[x.level].func(x,X);if(Y!==j&&Y!==M||(x.status=666),Y===g||Y===j)return y.avail_out===0&&(x.last_flush=-1),f;if(Y===N&&(X===1?a._tr_align(x):X!==5&&(a._tr_stored_block(x,0,0,!1),X===3&&(Q(x.head),x.lookahead===0&&(x.strstart=0,x.block_start=0,x.insert=0))),U(y),y.avail_out===0))return x.last_flush=-1,f}return X!==d?f:x.wrap<=0?1:(x.wrap===2?(ut(x,255&y.adler),ut(x,y.adler>>8&255),ut(x,y.adler>>16&255),ut(x,y.adler>>24&255),ut(x,255&y.total_in),ut(x,y.total_in>>8&255),ut(x,y.total_in>>16&255),ut(x,y.total_in>>24&255)):(et(x,y.adler>>>16),et(x,65535&y.adler)),U(y),0<x.wrap&&(x.wrap=-x.wrap),x.pending!==0?f:1)},i.deflateEnd=function(y){var X;return y&&y.state?(X=y.state.status)!==O&&X!==69&&X!==73&&X!==91&&X!==103&&X!==k&&X!==666?tt(y,p):(y.state=null,X===k?tt(y,-3):f):p},i.deflateSetDictionary=function(y,X){var V,x,S,$,Z,Y,H,rt,ht=X.length;if(!y||!y.state||($=(V=y.state).wrap)===2||$===1&&V.status!==O||V.lookahead)return p;for($===1&&(y.adler=c(y.adler,X,ht,0)),V.wrap=0,ht>=V.w_size&&($===0&&(Q(V.head),V.strstart=0,V.block_start=0,V.insert=0),rt=new o.Buf8(V.w_size),o.arraySet(rt,X,ht-V.w_size,V.w_size,0),X=rt,ht=V.w_size),Z=y.avail_in,Y=y.next_in,H=y.input,y.avail_in=ht,y.next_in=0,y.input=X,kt(V);V.lookahead>=C;){for(x=V.strstart,S=V.lookahead-(C-1);V.ins_h=(V.ins_h<<V.hash_shift^V.window[x+C-1])&V.hash_mask,V.prev[x&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=x,x++,--S;);V.strstart=x,V.lookahead=C-1,kt(V)}return V.strstart+=V.lookahead,V.block_start=V.strstart,V.insert=V.lookahead,V.lookahead=0,V.match_length=V.prev_length=C-1,V.match_available=0,y.next_in=Y,y.input=H,y.avail_in=Z,V.wrap=$,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,u,l,h,d,f,p,m,b,_,w,E,A,L,I,R,D,C,q,ot,O,k,g,N;a=s.state,c=s.next_in,g=s.input,u=c+(s.avail_in-5),l=s.next_out,N=s.output,h=l-(o-s.avail_out),d=l+(s.avail_out-257),f=a.dmax,p=a.wsize,m=a.whave,b=a.wnext,_=a.window,w=a.hold,E=a.bits,A=a.lencode,L=a.distcode,I=(1<<a.lenbits)-1,R=(1<<a.distbits)-1;t:do{E<15&&(w+=g[c++]<<E,E+=8,w+=g[c++]<<E,E+=8),D=A[w&I];e:for(;;){if(w>>>=C=D>>>24,E-=C,(C=D>>>16&255)===0)N[l++]=65535&D;else{if(!(16&C)){if(!(64&C)){D=A[(65535&D)+(w&(1<<C)-1)];continue e}if(32&C){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}q=65535&D,(C&=15)&&(E<C&&(w+=g[c++]<<E,E+=8),q+=w&(1<<C)-1,w>>>=C,E-=C),E<15&&(w+=g[c++]<<E,E+=8,w+=g[c++]<<E,E+=8),D=L[w&R];n:for(;;){if(w>>>=C=D>>>24,E-=C,!(16&(C=D>>>16&255))){if(!(64&C)){D=L[(65535&D)+(w&(1<<C)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(ot=65535&D,E<(C&=15)&&(w+=g[c++]<<E,(E+=8)<C&&(w+=g[c++]<<E,E+=8)),f<(ot+=w&(1<<C)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(w>>>=C,E-=C,(C=l-h)<ot){if(m<(C=ot-C)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(k=_,(O=0)===b){if(O+=p-C,C<q){for(q-=C;N[l++]=_[O++],--C;);O=l-ot,k=N}}else if(b<C){if(O+=p+b-C,(C-=b)<q){for(q-=C;N[l++]=_[O++],--C;);if(O=0,b<q){for(q-=C=b;N[l++]=_[O++],--C;);O=l-ot,k=N}}}else if(O+=b-C,C<q){for(q-=C;N[l++]=_[O++],--C;);O=l-ot,k=N}for(;2<q;)N[l++]=k[O++],N[l++]=k[O++],N[l++]=k[O++],q-=3;q&&(N[l++]=k[O++],1<q&&(N[l++]=k[O++]))}else{for(O=l-ot;N[l++]=N[O++],N[l++]=N[O++],N[l++]=N[O++],2<(q-=3););q&&(N[l++]=N[O++],1<q&&(N[l++]=N[O++]))}break}}break}}while(c<u&&l<d);c-=q=E>>3,w&=(1<<(E-=q<<3))-1,s.next_in=c,s.next_out=l,s.avail_in=c<u?u-c+5:5-(c-u),s.avail_out=l<d?d-l+257:257-(l-d),a.hold=w,a.bits=E}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),u=n("./inftrees"),l=1,h=2,d=0,f=-2,p=1,m=852,b=592;function _(O){return(O>>>24&255)+(O>>>8&65280)+((65280&O)<<8)+((255&O)<<24)}function w(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function E(O){var k;return O&&O.state?(k=O.state,O.total_in=O.total_out=k.total=0,O.msg="",k.wrap&&(O.adler=1&k.wrap),k.mode=p,k.last=0,k.havedict=0,k.dmax=32768,k.head=null,k.hold=0,k.bits=0,k.lencode=k.lendyn=new s.Buf32(m),k.distcode=k.distdyn=new s.Buf32(b),k.sane=1,k.back=-1,d):f}function A(O){var k;return O&&O.state?((k=O.state).wsize=0,k.whave=0,k.wnext=0,E(O)):f}function L(O,k){var g,N;return O&&O.state?(N=O.state,k<0?(g=0,k=-k):(g=1+(k>>4),k<48&&(k&=15)),k&&(k<8||15<k)?f:(N.window!==null&&N.wbits!==k&&(N.window=null),N.wrap=g,N.wbits=k,A(O))):f}function I(O,k){var g,N;return O?(N=new w,(O.state=N).window=null,(g=L(O,k))!==d&&(O.state=null),g):f}var R,D,C=!0;function q(O){if(C){var k;for(R=new s.Buf32(512),D=new s.Buf32(32),k=0;k<144;)O.lens[k++]=8;for(;k<256;)O.lens[k++]=9;for(;k<280;)O.lens[k++]=7;for(;k<288;)O.lens[k++]=8;for(u(l,O.lens,0,288,R,0,O.work,{bits:9}),k=0;k<32;)O.lens[k++]=5;u(h,O.lens,0,32,D,0,O.work,{bits:5}),C=!1}O.lencode=R,O.lenbits=9,O.distcode=D,O.distbits=5}function ot(O,k,g,N){var j,M=O.state;return M.window===null&&(M.wsize=1<<M.wbits,M.wnext=0,M.whave=0,M.window=new s.Buf8(M.wsize)),N>=M.wsize?(s.arraySet(M.window,k,g-M.wsize,M.wsize,0),M.wnext=0,M.whave=M.wsize):(N<(j=M.wsize-M.wnext)&&(j=N),s.arraySet(M.window,k,g-N,j,M.wnext),(N-=j)?(s.arraySet(M.window,k,g-N,N,0),M.wnext=N,M.whave=M.wsize):(M.wnext+=j,M.wnext===M.wsize&&(M.wnext=0),M.whave<M.wsize&&(M.whave+=j))),0}i.inflateReset=A,i.inflateReset2=L,i.inflateResetKeep=E,i.inflateInit=function(O){return I(O,15)},i.inflateInit2=I,i.inflate=function(O,k){var g,N,j,M,tt,G,Q,U,B,ut,et,nt,kt,Dt,wt,_t,Wt,$t,ye,Se,y,X,V,x,S=0,$=new s.Buf8(4),Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!O||!O.state||!O.output||!O.input&&O.avail_in!==0)return f;(g=O.state).mode===12&&(g.mode=13),tt=O.next_out,j=O.output,Q=O.avail_out,M=O.next_in,N=O.input,G=O.avail_in,U=g.hold,B=g.bits,ut=G,et=Q,X=d;t:for(;;)switch(g.mode){case p:if(g.wrap===0){g.mode=13;break}for(;B<16;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}if(2&g.wrap&&U===35615){$[g.check=0]=255&U,$[1]=U>>>8&255,g.check=a(g.check,$,2,0),B=U=0,g.mode=2;break}if(g.flags=0,g.head&&(g.head.done=!1),!(1&g.wrap)||(((255&U)<<8)+(U>>8))%31){O.msg="incorrect header check",g.mode=30;break}if((15&U)!=8){O.msg="unknown compression method",g.mode=30;break}if(B-=4,y=8+(15&(U>>>=4)),g.wbits===0)g.wbits=y;else if(y>g.wbits){O.msg="invalid window size",g.mode=30;break}g.dmax=1<<y,O.adler=g.check=1,g.mode=512&U?10:12,B=U=0;break;case 2:for(;B<16;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}if(g.flags=U,(255&g.flags)!=8){O.msg="unknown compression method",g.mode=30;break}if(57344&g.flags){O.msg="unknown header flags set",g.mode=30;break}g.head&&(g.head.text=U>>8&1),512&g.flags&&($[0]=255&U,$[1]=U>>>8&255,g.check=a(g.check,$,2,0)),B=U=0,g.mode=3;case 3:for(;B<32;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}g.head&&(g.head.time=U),512&g.flags&&($[0]=255&U,$[1]=U>>>8&255,$[2]=U>>>16&255,$[3]=U>>>24&255,g.check=a(g.check,$,4,0)),B=U=0,g.mode=4;case 4:for(;B<16;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}g.head&&(g.head.xflags=255&U,g.head.os=U>>8),512&g.flags&&($[0]=255&U,$[1]=U>>>8&255,g.check=a(g.check,$,2,0)),B=U=0,g.mode=5;case 5:if(1024&g.flags){for(;B<16;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}g.length=U,g.head&&(g.head.extra_len=U),512&g.flags&&($[0]=255&U,$[1]=U>>>8&255,g.check=a(g.check,$,2,0)),B=U=0}else g.head&&(g.head.extra=null);g.mode=6;case 6:if(1024&g.flags&&(G<(nt=g.length)&&(nt=G),nt&&(g.head&&(y=g.head.extra_len-g.length,g.head.extra||(g.head.extra=new Array(g.head.extra_len)),s.arraySet(g.head.extra,N,M,nt,y)),512&g.flags&&(g.check=a(g.check,N,nt,M)),G-=nt,M+=nt,g.length-=nt),g.length))break t;g.length=0,g.mode=7;case 7:if(2048&g.flags){if(G===0)break t;for(nt=0;y=N[M+nt++],g.head&&y&&g.length<65536&&(g.head.name+=String.fromCharCode(y)),y&&nt<G;);if(512&g.flags&&(g.check=a(g.check,N,nt,M)),G-=nt,M+=nt,y)break t}else g.head&&(g.head.name=null);g.length=0,g.mode=8;case 8:if(4096&g.flags){if(G===0)break t;for(nt=0;y=N[M+nt++],g.head&&y&&g.length<65536&&(g.head.comment+=String.fromCharCode(y)),y&&nt<G;);if(512&g.flags&&(g.check=a(g.check,N,nt,M)),G-=nt,M+=nt,y)break t}else g.head&&(g.head.comment=null);g.mode=9;case 9:if(512&g.flags){for(;B<16;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}if(U!==(65535&g.check)){O.msg="header crc mismatch",g.mode=30;break}B=U=0}g.head&&(g.head.hcrc=g.flags>>9&1,g.head.done=!0),O.adler=g.check=0,g.mode=12;break;case 10:for(;B<32;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}O.adler=g.check=_(U),B=U=0,g.mode=11;case 11:if(g.havedict===0)return O.next_out=tt,O.avail_out=Q,O.next_in=M,O.avail_in=G,g.hold=U,g.bits=B,2;O.adler=g.check=1,g.mode=12;case 12:if(k===5||k===6)break t;case 13:if(g.last){U>>>=7&B,B-=7&B,g.mode=27;break}for(;B<3;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}switch(g.last=1&U,B-=1,3&(U>>>=1)){case 0:g.mode=14;break;case 1:if(q(g),g.mode=20,k!==6)break;U>>>=2,B-=2;break t;case 2:g.mode=17;break;case 3:O.msg="invalid block type",g.mode=30}U>>>=2,B-=2;break;case 14:for(U>>>=7&B,B-=7&B;B<32;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}if((65535&U)!=(U>>>16^65535)){O.msg="invalid stored block lengths",g.mode=30;break}if(g.length=65535&U,B=U=0,g.mode=15,k===6)break t;case 15:g.mode=16;case 16:if(nt=g.length){if(G<nt&&(nt=G),Q<nt&&(nt=Q),nt===0)break t;s.arraySet(j,N,M,nt,tt),G-=nt,M+=nt,Q-=nt,tt+=nt,g.length-=nt;break}g.mode=12;break;case 17:for(;B<14;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}if(g.nlen=257+(31&U),U>>>=5,B-=5,g.ndist=1+(31&U),U>>>=5,B-=5,g.ncode=4+(15&U),U>>>=4,B-=4,286<g.nlen||30<g.ndist){O.msg="too many length or distance symbols",g.mode=30;break}g.have=0,g.mode=18;case 18:for(;g.have<g.ncode;){for(;B<3;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}g.lens[Z[g.have++]]=7&U,U>>>=3,B-=3}for(;g.have<19;)g.lens[Z[g.have++]]=0;if(g.lencode=g.lendyn,g.lenbits=7,V={bits:g.lenbits},X=u(0,g.lens,0,19,g.lencode,0,g.work,V),g.lenbits=V.bits,X){O.msg="invalid code lengths set",g.mode=30;break}g.have=0,g.mode=19;case 19:for(;g.have<g.nlen+g.ndist;){for(;_t=(S=g.lencode[U&(1<<g.lenbits)-1])>>>16&255,Wt=65535&S,!((wt=S>>>24)<=B);){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}if(Wt<16)U>>>=wt,B-=wt,g.lens[g.have++]=Wt;else{if(Wt===16){for(x=wt+2;B<x;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}if(U>>>=wt,B-=wt,g.have===0){O.msg="invalid bit length repeat",g.mode=30;break}y=g.lens[g.have-1],nt=3+(3&U),U>>>=2,B-=2}else if(Wt===17){for(x=wt+3;B<x;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}B-=wt,y=0,nt=3+(7&(U>>>=wt)),U>>>=3,B-=3}else{for(x=wt+7;B<x;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}B-=wt,y=0,nt=11+(127&(U>>>=wt)),U>>>=7,B-=7}if(g.have+nt>g.nlen+g.ndist){O.msg="invalid bit length repeat",g.mode=30;break}for(;nt--;)g.lens[g.have++]=y}}if(g.mode===30)break;if(g.lens[256]===0){O.msg="invalid code -- missing end-of-block",g.mode=30;break}if(g.lenbits=9,V={bits:g.lenbits},X=u(l,g.lens,0,g.nlen,g.lencode,0,g.work,V),g.lenbits=V.bits,X){O.msg="invalid literal/lengths set",g.mode=30;break}if(g.distbits=6,g.distcode=g.distdyn,V={bits:g.distbits},X=u(h,g.lens,g.nlen,g.ndist,g.distcode,0,g.work,V),g.distbits=V.bits,X){O.msg="invalid distances set",g.mode=30;break}if(g.mode=20,k===6)break t;case 20:g.mode=21;case 21:if(6<=G&&258<=Q){O.next_out=tt,O.avail_out=Q,O.next_in=M,O.avail_in=G,g.hold=U,g.bits=B,c(O,et),tt=O.next_out,j=O.output,Q=O.avail_out,M=O.next_in,N=O.input,G=O.avail_in,U=g.hold,B=g.bits,g.mode===12&&(g.back=-1);break}for(g.back=0;_t=(S=g.lencode[U&(1<<g.lenbits)-1])>>>16&255,Wt=65535&S,!((wt=S>>>24)<=B);){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}if(_t&&!(240&_t)){for($t=wt,ye=_t,Se=Wt;_t=(S=g.lencode[Se+((U&(1<<$t+ye)-1)>>$t)])>>>16&255,Wt=65535&S,!($t+(wt=S>>>24)<=B);){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}U>>>=$t,B-=$t,g.back+=$t}if(U>>>=wt,B-=wt,g.back+=wt,g.length=Wt,_t===0){g.mode=26;break}if(32&_t){g.back=-1,g.mode=12;break}if(64&_t){O.msg="invalid literal/length code",g.mode=30;break}g.extra=15&_t,g.mode=22;case 22:if(g.extra){for(x=g.extra;B<x;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}g.length+=U&(1<<g.extra)-1,U>>>=g.extra,B-=g.extra,g.back+=g.extra}g.was=g.length,g.mode=23;case 23:for(;_t=(S=g.distcode[U&(1<<g.distbits)-1])>>>16&255,Wt=65535&S,!((wt=S>>>24)<=B);){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}if(!(240&_t)){for($t=wt,ye=_t,Se=Wt;_t=(S=g.distcode[Se+((U&(1<<$t+ye)-1)>>$t)])>>>16&255,Wt=65535&S,!($t+(wt=S>>>24)<=B);){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}U>>>=$t,B-=$t,g.back+=$t}if(U>>>=wt,B-=wt,g.back+=wt,64&_t){O.msg="invalid distance code",g.mode=30;break}g.offset=Wt,g.extra=15&_t,g.mode=24;case 24:if(g.extra){for(x=g.extra;B<x;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}g.offset+=U&(1<<g.extra)-1,U>>>=g.extra,B-=g.extra,g.back+=g.extra}if(g.offset>g.dmax){O.msg="invalid distance too far back",g.mode=30;break}g.mode=25;case 25:if(Q===0)break t;if(nt=et-Q,g.offset>nt){if((nt=g.offset-nt)>g.whave&&g.sane){O.msg="invalid distance too far back",g.mode=30;break}kt=nt>g.wnext?(nt-=g.wnext,g.wsize-nt):g.wnext-nt,nt>g.length&&(nt=g.length),Dt=g.window}else Dt=j,kt=tt-g.offset,nt=g.length;for(Q<nt&&(nt=Q),Q-=nt,g.length-=nt;j[tt++]=Dt[kt++],--nt;);g.length===0&&(g.mode=21);break;case 26:if(Q===0)break t;j[tt++]=g.length,Q--,g.mode=21;break;case 27:if(g.wrap){for(;B<32;){if(G===0)break t;G--,U|=N[M++]<<B,B+=8}if(et-=Q,O.total_out+=et,g.total+=et,et&&(O.adler=g.check=g.flags?a(g.check,j,et,tt-et):o(g.check,j,et,tt-et)),et=Q,(g.flags?U:_(U))!==g.check){O.msg="incorrect data check",g.mode=30;break}B=U=0}g.mode=28;case 28:if(g.wrap&&g.flags){for(;B<32;){if(G===0)break t;G--,U+=N[M++]<<B,B+=8}if(U!==(4294967295&g.total)){O.msg="incorrect length check",g.mode=30;break}B=U=0}g.mode=29;case 29:X=1;break t;case 30:X=-3;break t;case 31:return-4;case 32:default:return f}return O.next_out=tt,O.avail_out=Q,O.next_in=M,O.avail_in=G,g.hold=U,g.bits=B,(g.wsize||et!==O.avail_out&&g.mode<30&&(g.mode<27||k!==4))&&ot(O,O.output,O.next_out,et-O.avail_out)?(g.mode=31,-4):(ut-=O.avail_in,et-=O.avail_out,O.total_in+=ut,O.total_out+=et,g.total+=et,g.wrap&&et&&(O.adler=g.check=g.flags?a(g.check,j,et,O.next_out-et):o(g.check,j,et,O.next_out-et)),O.data_type=g.bits+(g.last?64:0)+(g.mode===12?128:0)+(g.mode===20||g.mode===15?256:0),(ut==0&&et===0||k===4)&&X===d&&(X=-5),X)},i.inflateEnd=function(O){if(!O||!O.state)return f;var k=O.state;return k.window&&(k.window=null),O.state=null,d},i.inflateGetHeader=function(O,k){var g;return O&&O.state&&2&(g=O.state).wrap?((g.head=k).done=!1,d):f},i.inflateSetDictionary=function(O,k){var g,N=k.length;return O&&O.state?(g=O.state).wrap!==0&&g.mode!==11?f:g.mode===11&&o(1,k,N,0)!==g.check?-3:ot(O,k,N,N)?(g.mode=31,-4):(g.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(l,h,d,f,p,m,b,_){var w,E,A,L,I,R,D,C,q,ot=_.bits,O=0,k=0,g=0,N=0,j=0,M=0,tt=0,G=0,Q=0,U=0,B=null,ut=0,et=new s.Buf16(16),nt=new s.Buf16(16),kt=null,Dt=0;for(O=0;O<=15;O++)et[O]=0;for(k=0;k<f;k++)et[h[d+k]]++;for(j=ot,N=15;1<=N&&et[N]===0;N--);if(N<j&&(j=N),N===0)return p[m++]=20971520,p[m++]=20971520,_.bits=1,0;for(g=1;g<N&&et[g]===0;g++);for(j<g&&(j=g),O=G=1;O<=15;O++)if(G<<=1,(G-=et[O])<0)return-1;if(0<G&&(l===0||N!==1))return-1;for(nt[1]=0,O=1;O<15;O++)nt[O+1]=nt[O]+et[O];for(k=0;k<f;k++)h[d+k]!==0&&(b[nt[h[d+k]]++]=k);if(R=l===0?(B=kt=b,19):l===1?(B=o,ut-=257,kt=a,Dt-=257,256):(B=c,kt=u,-1),O=g,I=m,tt=k=U=0,A=-1,L=(Q=1<<(M=j))-1,l===1&&852<Q||l===2&&592<Q)return 1;for(;;){for(D=O-tt,q=b[k]<R?(C=0,b[k]):b[k]>R?(C=kt[Dt+b[k]],B[ut+b[k]]):(C=96,0),w=1<<O-tt,g=E=1<<M;p[I+(U>>tt)+(E-=w)]=D<<24|C<<16|q|0,E!==0;);for(w=1<<O-1;U&w;)w>>=1;if(w!==0?(U&=w-1,U+=w):U=0,k++,--et[O]==0){if(O===N)break;O=h[d+b[k]]}if(j<O&&(U&L)!==A){for(tt===0&&(tt=j),I+=g,G=1<<(M=O-tt);M+tt<N&&!((G-=et[M+tt])<=0);)M++,G<<=1;if(Q+=1<<M,l===1&&852<Q||l===2&&592<Q)return 1;p[A=U&L]=j<<24|M<<16|I-m|0}}return U!==0&&(p[I+U]=O-tt<<24|64<<16|0),_.bits=j,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(S){for(var $=S.length;0<=--$;)S[$]=0}var u=0,l=29,h=256,d=h+1+l,f=30,p=19,m=2*d+1,b=15,_=16,w=7,E=256,A=16,L=17,I=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ot=new Array(2*(d+2));c(ot);var O=new Array(2*f);c(O);var k=new Array(512);c(k);var g=new Array(256);c(g);var N=new Array(l);c(N);var j,M,tt,G=new Array(f);function Q(S,$,Z,Y,H){this.static_tree=S,this.extra_bits=$,this.extra_base=Z,this.elems=Y,this.max_length=H,this.has_stree=S&&S.length}function U(S,$){this.dyn_tree=S,this.max_code=0,this.stat_desc=$}function B(S){return S<256?k[S]:k[256+(S>>>7)]}function ut(S,$){S.pending_buf[S.pending++]=255&$,S.pending_buf[S.pending++]=$>>>8&255}function et(S,$,Z){S.bi_valid>_-Z?(S.bi_buf|=$<<S.bi_valid&65535,ut(S,S.bi_buf),S.bi_buf=$>>_-S.bi_valid,S.bi_valid+=Z-_):(S.bi_buf|=$<<S.bi_valid&65535,S.bi_valid+=Z)}function nt(S,$,Z){et(S,Z[2*$],Z[2*$+1])}function kt(S,$){for(var Z=0;Z|=1&S,S>>>=1,Z<<=1,0<--$;);return Z>>>1}function Dt(S,$,Z){var Y,H,rt=new Array(b+1),ht=0;for(Y=1;Y<=b;Y++)rt[Y]=ht=ht+Z[Y-1]<<1;for(H=0;H<=$;H++){var it=S[2*H+1];it!==0&&(S[2*H]=kt(rt[it]++,it))}}function wt(S){var $;for($=0;$<d;$++)S.dyn_ltree[2*$]=0;for($=0;$<f;$++)S.dyn_dtree[2*$]=0;for($=0;$<p;$++)S.bl_tree[2*$]=0;S.dyn_ltree[2*E]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function _t(S){8<S.bi_valid?ut(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function Wt(S,$,Z,Y){var H=2*$,rt=2*Z;return S[H]<S[rt]||S[H]===S[rt]&&Y[$]<=Y[Z]}function $t(S,$,Z){for(var Y=S.heap[Z],H=Z<<1;H<=S.heap_len&&(H<S.heap_len&&Wt($,S.heap[H+1],S.heap[H],S.depth)&&H++,!Wt($,Y,S.heap[H],S.depth));)S.heap[Z]=S.heap[H],Z=H,H<<=1;S.heap[Z]=Y}function ye(S,$,Z){var Y,H,rt,ht,it=0;if(S.last_lit!==0)for(;Y=S.pending_buf[S.d_buf+2*it]<<8|S.pending_buf[S.d_buf+2*it+1],H=S.pending_buf[S.l_buf+it],it++,Y===0?nt(S,H,$):(nt(S,(rt=g[H])+h+1,$),(ht=R[rt])!==0&&et(S,H-=N[rt],ht),nt(S,rt=B(--Y),Z),(ht=D[rt])!==0&&et(S,Y-=G[rt],ht)),it<S.last_lit;);nt(S,E,$)}function Se(S,$){var Z,Y,H,rt=$.dyn_tree,ht=$.stat_desc.static_tree,it=$.stat_desc.has_stree,pt=$.stat_desc.elems,Qt=-1;for(S.heap_len=0,S.heap_max=m,Z=0;Z<pt;Z++)rt[2*Z]!==0?(S.heap[++S.heap_len]=Qt=Z,S.depth[Z]=0):rt[2*Z+1]=0;for(;S.heap_len<2;)rt[2*(H=S.heap[++S.heap_len]=Qt<2?++Qt:0)]=1,S.depth[H]=0,S.opt_len--,it&&(S.static_len-=ht[2*H+1]);for($.max_code=Qt,Z=S.heap_len>>1;1<=Z;Z--)$t(S,rt,Z);for(H=pt;Z=S.heap[1],S.heap[1]=S.heap[S.heap_len--],$t(S,rt,1),Y=S.heap[1],S.heap[--S.heap_max]=Z,S.heap[--S.heap_max]=Y,rt[2*H]=rt[2*Z]+rt[2*Y],S.depth[H]=(S.depth[Z]>=S.depth[Y]?S.depth[Z]:S.depth[Y])+1,rt[2*Z+1]=rt[2*Y+1]=H,S.heap[1]=H++,$t(S,rt,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(Pt,Tn){var Ao,cr,xo,he,$c,af,Nr=Tn.dyn_tree,a_=Tn.max_code,aL=Tn.stat_desc.static_tree,cL=Tn.stat_desc.has_stree,lL=Tn.stat_desc.extra_bits,c_=Tn.stat_desc.extra_base,To=Tn.stat_desc.max_length,jc=0;for(he=0;he<=b;he++)Pt.bl_count[he]=0;for(Nr[2*Pt.heap[Pt.heap_max]+1]=0,Ao=Pt.heap_max+1;Ao<m;Ao++)To<(he=Nr[2*Nr[2*(cr=Pt.heap[Ao])+1]+1]+1)&&(he=To,jc++),Nr[2*cr+1]=he,a_<cr||(Pt.bl_count[he]++,$c=0,c_<=cr&&($c=lL[cr-c_]),af=Nr[2*cr],Pt.opt_len+=af*(he+$c),cL&&(Pt.static_len+=af*(aL[2*cr+1]+$c)));if(jc!==0){do{for(he=To-1;Pt.bl_count[he]===0;)he--;Pt.bl_count[he]--,Pt.bl_count[he+1]+=2,Pt.bl_count[To]--,jc-=2}while(0<jc);for(he=To;he!==0;he--)for(cr=Pt.bl_count[he];cr!==0;)a_<(xo=Pt.heap[--Ao])||(Nr[2*xo+1]!==he&&(Pt.opt_len+=(he-Nr[2*xo+1])*Nr[2*xo],Nr[2*xo+1]=he),cr--)}}(S,$),Dt(rt,Qt,S.bl_count)}function y(S,$,Z){var Y,H,rt=-1,ht=$[1],it=0,pt=7,Qt=4;for(ht===0&&(pt=138,Qt=3),$[2*(Z+1)+1]=65535,Y=0;Y<=Z;Y++)H=ht,ht=$[2*(Y+1)+1],++it<pt&&H===ht||(it<Qt?S.bl_tree[2*H]+=it:H!==0?(H!==rt&&S.bl_tree[2*H]++,S.bl_tree[2*A]++):it<=10?S.bl_tree[2*L]++:S.bl_tree[2*I]++,rt=H,Qt=(it=0)===ht?(pt=138,3):H===ht?(pt=6,3):(pt=7,4))}function X(S,$,Z){var Y,H,rt=-1,ht=$[1],it=0,pt=7,Qt=4;for(ht===0&&(pt=138,Qt=3),Y=0;Y<=Z;Y++)if(H=ht,ht=$[2*(Y+1)+1],!(++it<pt&&H===ht)){if(it<Qt)for(;nt(S,H,S.bl_tree),--it!=0;);else H!==0?(H!==rt&&(nt(S,H,S.bl_tree),it--),nt(S,A,S.bl_tree),et(S,it-3,2)):it<=10?(nt(S,L,S.bl_tree),et(S,it-3,3)):(nt(S,I,S.bl_tree),et(S,it-11,7));rt=H,Qt=(it=0)===ht?(pt=138,3):H===ht?(pt=6,3):(pt=7,4)}}c(G);var V=!1;function x(S,$,Z,Y){et(S,(u<<1)+(Y?1:0),3),function(H,rt,ht,it){_t(H),ut(H,ht),ut(H,~ht),s.arraySet(H.pending_buf,H.window,rt,ht,H.pending),H.pending+=ht}(S,$,Z)}i._tr_init=function(S){V||(function(){var $,Z,Y,H,rt,ht=new Array(b+1);for(H=Y=0;H<l-1;H++)for(N[H]=Y,$=0;$<1<<R[H];$++)g[Y++]=H;for(g[Y-1]=H,H=rt=0;H<16;H++)for(G[H]=rt,$=0;$<1<<D[H];$++)k[rt++]=H;for(rt>>=7;H<f;H++)for(G[H]=rt<<7,$=0;$<1<<D[H]-7;$++)k[256+rt++]=H;for(Z=0;Z<=b;Z++)ht[Z]=0;for($=0;$<=143;)ot[2*$+1]=8,$++,ht[8]++;for(;$<=255;)ot[2*$+1]=9,$++,ht[9]++;for(;$<=279;)ot[2*$+1]=7,$++,ht[7]++;for(;$<=287;)ot[2*$+1]=8,$++,ht[8]++;for(Dt(ot,d+1,ht),$=0;$<f;$++)O[2*$+1]=5,O[2*$]=kt($,5);j=new Q(ot,R,h+1,d,b),M=new Q(O,D,0,f,b),tt=new Q(new Array(0),C,0,p,w)}(),V=!0),S.l_desc=new U(S.dyn_ltree,j),S.d_desc=new U(S.dyn_dtree,M),S.bl_desc=new U(S.bl_tree,tt),S.bi_buf=0,S.bi_valid=0,wt(S)},i._tr_stored_block=x,i._tr_flush_block=function(S,$,Z,Y){var H,rt,ht=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(it){var pt,Qt=4093624447;for(pt=0;pt<=31;pt++,Qt>>>=1)if(1&Qt&&it.dyn_ltree[2*pt]!==0)return o;if(it.dyn_ltree[18]!==0||it.dyn_ltree[20]!==0||it.dyn_ltree[26]!==0)return a;for(pt=32;pt<h;pt++)if(it.dyn_ltree[2*pt]!==0)return a;return o}(S)),Se(S,S.l_desc),Se(S,S.d_desc),ht=function(it){var pt;for(y(it,it.dyn_ltree,it.l_desc.max_code),y(it,it.dyn_dtree,it.d_desc.max_code),Se(it,it.bl_desc),pt=p-1;3<=pt&&it.bl_tree[2*q[pt]+1]===0;pt--);return it.opt_len+=3*(pt+1)+5+5+4,pt}(S),H=S.opt_len+3+7>>>3,(rt=S.static_len+3+7>>>3)<=H&&(H=rt)):H=rt=Z+5,Z+4<=H&&$!==-1?x(S,$,Z,Y):S.strategy===4||rt===H?(et(S,2+(Y?1:0),3),ye(S,ot,O)):(et(S,4+(Y?1:0),3),function(it,pt,Qt,Pt){var Tn;for(et(it,pt-257,5),et(it,Qt-1,5),et(it,Pt-4,4),Tn=0;Tn<Pt;Tn++)et(it,it.bl_tree[2*q[Tn]+1],3);X(it,it.dyn_ltree,pt-1),X(it,it.dyn_dtree,Qt-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,ht+1),ye(S,S.dyn_ltree,S.dyn_dtree)),wt(S),Y&&_t(S)},i._tr_tally=function(S,$,Z){return S.pending_buf[S.d_buf+2*S.last_lit]=$>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&$,S.pending_buf[S.l_buf+S.last_lit]=255&Z,S.last_lit++,$===0?S.dyn_ltree[2*Z]++:(S.matches++,$--,S.dyn_ltree[2*(g[Z]+h+1)]++,S.dyn_dtree[2*B($)]++),S.last_lit===S.lit_bufsize-1},i._tr_align=function(S){et(S,2,3),nt(S,E,ot),function($){$.bi_valid===16?(ut($,$.bi_buf),$.bi_buf=0,$.bi_valid=0):8<=$.bi_valid&&($.pending_buf[$.pending++]=255&$.bi_buf,$.bi_buf>>=8,$.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,u,l,h,d=1,f={},p=!1,m=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,c={}.toString.call(o.process)==="[object process]"?function(A){process.nextTick(function(){w(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,L=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=L,A}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",E,!1):o.attachEvent("onmessage",E),function(A){o.postMessage(h+A,"*")}):o.MessageChannel?((l=new MessageChannel).port1.onmessage=function(A){w(A.data)},function(A){l.port2.postMessage(A)}):m&&"onreadystatechange"in m.createElement("script")?(u=m.documentElement,function(A){var L=m.createElement("script");L.onreadystatechange=function(){w(A),L.onreadystatechange=null,u.removeChild(L),L=null},u.appendChild(L)}):function(A){setTimeout(w,0,A)},b.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var L=new Array(arguments.length-1),I=0;I<L.length;I++)L[I]=arguments[I+1];var R={callback:A,args:L};return f[d]=R,c(d),d++},b.clearImmediate=_}function _(A){delete f[A]}function w(A){if(p)setTimeout(w,0,A);else{var L=f[A];if(L){p=!0;try{(function(I){var R=I.callback,D=I.args;switch(D.length){case 0:R();break;case 1:R(D[0]);break;case 2:R(D[0],D[1]);break;case 3:R(D[0],D[1],D[2]);break;default:R.apply(a,D)}})(L)}finally{_(A),p=!1}}}}function E(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(h)===0&&w(+A.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Be<"u"?Be:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(t_);var K4=t_.exports,of=Ni(K4);const e_={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(e_);var xn=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},hs,So,Oi;class q4{constructor(...t){hs.set(this,new Map),So.set(this,new Map),Oi.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),xn(this,Oi,"f").has(r)||xn(this,Oi,"f").set(r,new Set);const s=xn(this,Oi,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&xn(this,So,"f").set(r,a),o=!1,c)continue;const u=xn(this,hs,"f").get(a);if(u&&u!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${u} -> ${a}". Pass \`force=true\` to override this definition.`);xn(this,hs,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:xn(this,hs,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&xn(this,So,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:xn(this,Oi,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of xn(this,Oi,"f").values())Object.freeze(t);return this}_getTestState(){return{types:xn(this,hs,"f"),extensions:xn(this,So,"f")}}}hs=new WeakMap,So=new WeakMap,Oi=new WeakMap;var X4=new q4(e_)._freeze();function n_(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return X4.getType(e)??"application/octet-stream"}async function Z4(e,t){try{sn(z,e.name);const n=await e.arrayBuffer();(await new of().loadAsync(n)).forEach((s,o)=>{o.async("uint8array").then(a=>{const c=n_(s,a),u=new File([a],o.name,{type:c});t(u)}).catch(a=>{Vt(z,"crash",a.message)})})}catch(n){Vt(z,"crash",n.message)}}async function J4(e,t){try{sn(z,e.name);const n=await e.arrayBuffer(),r=e.name.split(".").slice(-1)[0]??"";t(Ct(r),new Uint8Array(n))}catch(n){Vt(z,"crash",n.message)}}function r_(e,t){function n(r){if(v(t))switch(r){case"text/plain":t.text().then(i=>Lp(z,"text",t.name,i,e)).catch(i=>Vt(z,"crash",i.message));break;case"application/zip":Z4(t,i=>r_(e,i)).catch(i=>Vt(z,"crash",i.message));break;case"application/octet-stream":J4(t,(i,s)=>Lp(z,"binary",i,s,e)).catch(i=>Vt(z,"crash",i.message));break;default:t.arrayBuffer().then(i=>{const s=n_(t.name,new Uint8Array(i));if(s)n(s);else return Vt(z,"loadfile",`unsupported file ${t.name}`)}).catch(i=>Vt(z,"crash",i.message));return}}n((t==null?void 0:t.type)??"")}function i_(e,t){function n(r){Vt(e,"crash",r.message)}t().catch(n)}function Y4(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function Q4(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const tL=new Date("1980/09/02");async function eL(e){return console.info("saved",e),new Promise((t,n)=>{const r=new of;for(let i=0;i<e.length;++i){const s=e[i],o=TC(s);if(o){const a=vC(o);v(a)&&r.file(s.id,a,{date:tL})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(Q4(i))}).catch(n)})}async function nL(e){return new Promise((t,n)=>{const r=new of;r.loadAsync(Y4(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),u=RC(EC(c));v(u)&&i.push(u)}t(i)}).catch(n)})}const rL=16,Ci={},iL=64;let s_=0;const Cr={},fs={};async function o_(e=""){const t=Pc(),n=Pe(Ft.MAIN);if(t.length&&v(n)){const r=await eL(t),i=`${e}${new Date().toISOString()} ${n.name} ${r.length} chars`;EE(De,i,r,rf())}}const De=Mi("vm",["tick","second"],e=>{var t;if(De.session(e))switch(e.target){case"operator":v(e.player)&&(L4(e.player),Gt(De,`operator set to ${e.player}`),De.reply(e,"ackoperator",!0,e.player));break;case"books":i_(De,async()=>{if(e.player&&Ht(e.data)){const[n,r]=e.data,i=await nL(n),s=i.map(o=>o.name);D4(i,r),Gt(De,`loading ${s.join(", ")}`),De.reply(e,"ackbooks",!0,e.player)}});break;case"login":v(e.player)&&F4(e.player)&&(Ci[e.player]=0,Gt(De,`login from ${e.player}`),De.reply(e,"acklogin",!0,e.player));break;case"endgame":v(e.player)&&(Y1(e.player),bE(De,e.player));break;case"doot":v(e.player)&&(Ci[e.player]=0,Op(De,"active",e.player));break;case"input":if(v(e.player)){const n=us(e.player),[r=je.NONE,i=0]=e.data??[je.NONE,0];Ht(n.inputqueue)||(n.inputqueue=[]),r!==je.NONE&&n.inputqueue.push([r,i])}break;case"codewatch":if(v(e.player)&&Ht(e.data)){const[n,r]=e.data;if(!v(fs[r])){const i=Cp(n,r);fs[r]=Dp(i,s=>{const o=Qr(n),a=ss(o,r);v(a)&&(a.code=s,xC(a))})}Cr[n]=Cr[n]??{},Cr[n][r]=Cr[n][r]??new Set,Cr[n][r].add(e.player)}break;case"coderelease":if(e.player&&Ht(e.data)){const[n,r]=e.data;v(Cr[n])&&v(Cr[n][r])&&(Cr[n][r].delete(e.player),Cr[n][r].size===0&&((t=fs[r])==null||t.call(fs),fs[r]=void 0))}break;case"tick":e.player!=="locked"&&W4();break;case"second":{$4(Ci);const n=Object.keys(Ci);for(let r=0;r<n.length;++r)++Ci[n[r]];for(let r=0;r<n.length;++r){const i=n[r];Ci[i]>=rL&&(delete Ci[i],Y1(i),sn(De,"player logout",i),De.emit("logout",void 0,i))}X_()===!1&&++s_>=iL&&(s_=0,Np(De,"autosave",rf()));break}case"flush":i_(De,async()=>{vt(e.data)?await o_(`${e.data} `):await o_()});break;case"cli":vt(e.player)&&H4(e.player,e.data);break;case"loader":if(vt(e.player)&&Ht(e.data)){const[n,r]=e.data;vt(n)&&(n==="file"?r_(e.player,r):wN(n,r))}break;default:j4(e);break}},q1());function sL(){vE(De)}const{forward:oL}=K_(e=>postMessage(e));onmessage=function(t){oL(t.data)},setTimeout(sL,100)})();

var Oj=Object.defineProperty;var Ij=(wi,Jn,Mn)=>Jn in wi?Oj(wi,Jn,{enumerable:!0,configurable:!0,writable:!0,value:Mn}):wi[Jn]=Mn;var Ft=(wi,Jn,Mn)=>Ij(wi,typeof Jn!="symbol"?Jn+"":Jn,Mn);(function(){"use strict";const wi=new Set,Jn={emit(t,e,n,r,i){Jn.invoke(Lv(t,e,n,r,i))},invoke(t){wi.forEach(e=>e.handle(t))},connect(t){wi.add(t)},disconnect(t){wi.delete(t)}};var Mn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lo(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function JE(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Tp={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Mn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var d=function(){var f=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=f-(c=f|0)};return d.next=d,d.uint32=function(){return d()*4294967296},d.fract53=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.version="Alea 0.9",d.args=i,d.exportState=function(){return[s,o,a,c]},d.importState=function(f){s=+f[0]||0,o=+f[1]||0,a=+f[2]||0,c=+f[3]||0},d}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Tp);var QE=Tp.exports,Ap=lo(QE),Rp={};(function(t){var e=Mn&&Mn.__spreadArray||function(l,u,d){if(d||arguments.length===2)for(var f=0,h=u.length,p;f<h;f++)(p||!(f in u))&&(p||(p=Array.prototype.slice.call(u,0,f)),p[f]=u[f]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,d){return u.length>d.length?u:d})}function i(l){return l.reduce(function(u,d){return u.length<d.length?u:d})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,d=u===void 0?"":u,f=l.capitalize,h=f===void 0?!0:f,p=l.adjectiveCount,m=p===void 0?1:p,b=l.addAdverb,_=b===void 0?!1:b,v=e(e(e([],e([],Array(m),!0).map(function(T){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),_?[n(t.adverbs)]:[],!0);return h&&(v=v.map(function(T){return T.charAt(0).toUpperCase()+T.substr(1)})),v.join(d)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,d=u===void 0?1:u,f=l.addAdverb,h=f===void 0?!1:f;return t.adjectives.length*d*t.nouns.length*t.verbs.length*(h?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,d=u===void 0?1:u,f=l.addAdverb,h=f===void 0?!1:f,p=l.separator,m=p===void 0?"":p;return r(t.adjectives).length*d+d*m.length+r(t.nouns).length+m.length+r(t.verbs).length+(h?r(t.adverbs).length+m.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,d=u===void 0?1:u,f=l.addAdverb,h=f===void 0?!1:f,p=l.separator,m=p===void 0?"":p;return i(t.adjectives).length*d+d*m.length+i(t.nouns).length+m.length+i(t.verbs).length+(h?i(t.adverbs).length+m.length:0)}t.minLength=c,t.default=s})(Rp);var Sp=lo(Rp);const tv="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ev=t=>crypto.getRandomValues(new Uint8Array(t)),nv=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=t[a[c]&r]||"",o.length===s)return o}}},Op=(t,e=21)=>nv(t,e,ev),rv=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=tv[n[t]&63];return e};var Ip="abcdefghijklmnopqrstuvwxyz",Np="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Cp="0123456789",iv="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",sv="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const ov=Cp,av=Ip,cv=Np;var lv=ov+av+cv,wh={lowercase:Ip,uppercase:Np,numbers:Cp,nolookalikes:iv,nolookalikesSafe:sv,alphanumeric:lv};function je(){return`sid_${rv(12).replaceAll("-",".")}`}Op(wh.numbers,4),Op(`${wh.numbers}${wh.lowercase}`,16);function Hr(t){return(t==null?void 0:t.startsWith("pid_"))??!1}function uv(){return Sp({capitalize:!1,adjectiveCount:1})}function hv(){return Sp({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var fv=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),dv=Object.prototype.hasOwnProperty;function xh(t,e){return dv.call(t,e)}function Eh(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)xh(t,i)&&r.push(i);return r}function Un(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function vh(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function As(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Lp(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function kh(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(kh(t[e]))return!0}else if(typeof t=="object"){for(var r=Eh(t),i=r.length,s=0;s<i;s++)if(kh(t[r[s]]))return!0}}return!1}function Mp(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Up=function(t){fv(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,Mp(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Mp(n,{name:r,index:i,operation:s,tree:o}),c}return e}(Error),Ue=Up,pv=Un,uo={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=Vc(n,this.path);r&&(r=Un(r));var i=Rs(n,{op:"remove",path:this.from}).removed;return Rs(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=Vc(n,this.from);return Rs(n,{op:"add",path:this.path,value:Un(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:wa(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},mv={add:function(t,e,n){return vh(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:uo.move,copy:uo.copy,test:uo.test,_get:uo._get};function Vc(t,e){if(e=="")return t;var n={op:"_get",path:e};return Rs(t,n),n.value}function Rs(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):Zc(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=Vc(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=wa(t,e.value),o.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new Ue("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=Un(t));var a=e.path||"",c=a.split("/"),l=t,u=1,d=c.length,f=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=Zc;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=Lp(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&f===void 0&&(l[h]===void 0?f=c.slice(0,u).join("/"):u==d-1&&(f=e.path),f!==void 0&&p(e,0,t,f)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!vh(h))throw new Ue("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);vh(h)&&(h=~~h)}if(u>=d){if(n&&e.op==="add"&&h>l.length)throw new Ue("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=mv[e.op].call(e,l,h,t);if(o.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=d){var o=uo[e.op].call(e,l,h,t);if(o.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[h],n&&u<d&&(!l||typeof l!="object"))throw new Ue("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function Th(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new Ue("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Un(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=Rs(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function gv(t,e,n){var r=Rs(t,e);if(r.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function Zc(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new Ue("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(uo[t.op]){if(typeof t.path!="string")throw new Ue("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new Ue('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new Ue("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new Ue("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&kh(t.value))throw new Ue("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Ue("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new Ue("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=Fp([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Ue("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new Ue("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function Fp(t,e,n){try{if(!Array.isArray(t))throw new Ue("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Th(Un(e),Un(t),n||!0);else{n=n||Zc;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof Ue)return i;throw i}}function wa(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!wa(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!wa(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var _v=Object.freeze({__proto__:null,JsonPatchError:Ue,_areEquals:wa,applyOperation:Rs,applyPatch:Th,applyReducer:gv,deepClone:pv,getValueByPointer:Vc,validate:Fp,validator:Zc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Ah=new WeakMap,yv=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),bv=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function wv(t){return Ah.get(t)}function xv(t,e){return t.observers.get(e)}function Ev(t,e){t.observers.delete(e.callback)}function vv(t,e){e.unobserve()}function kv(t,e){var n=[],r,i=wv(t);if(!i)i=new yv(t),Ah.set(t,i);else{var s=xv(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Un(t),e){r.callback=e,r.next=null;var o=function(){Rh(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){Rh(r),clearTimeout(r.next),Ev(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new bv(e,r)),r}function Rh(t,e){e===void 0&&(e=!1);var n=Ah.get(t.object);Sh(n.value,t.object,t.patches,"",e),t.patches.length&&Th(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function Sh(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=Eh(e),o=Eh(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(xh(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var d=e[l];typeof u=="object"&&u!=null&&typeof d=="object"&&d!=null&&Array.isArray(u)===Array.isArray(d)?Sh(u,d,n,r+"/"+As(l),i):u!==d&&(i&&n.push({op:"test",path:r+"/"+As(l),value:Un(u)}),n.push({op:"replace",path:r+"/"+As(l),value:Un(d)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+As(l),value:Un(u)}),n.push({op:"remove",path:r+"/"+As(l)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!xh(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+As(l),value:Un(e[l])})}}}function Bp(t,e,n){n===void 0&&(n=!1);var r=[];return Sh(t,e,r,"",n),r}var Tv=Object.freeze({__proto__:null,compare:Bp,generate:Rh,observe:kv,unobserve:vv});Object.assign({},_v,Tv,{JsonPatchError:Up,deepClone:Un,escapePathComponent:As,unescapePathComponent:Lp});var Av=typeof Element<"u",Rv=typeof Map=="function",Sv=typeof Set=="function",Ov=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Xc(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!Xc(t[r],e[r]))return!1;return!0}var s;if(Rv&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=t.entries();!(r=s.next()).done;)if(!Xc(r.value[1],e.get(r.value[0])))return!1;return!0}if(Sv&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(Ov&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(Av&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!Xc(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var Iv=function(e,n){try{return Xc(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},Nv=lo(Iv);function x(t){return t!=null}const dr=Object.keys;function Qn(t){return Un(t)}function Cv(t){return typeof t=="boolean"}function kt(t){return typeof t=="number"&&isNaN(t)===!1}function gt(t){return typeof t=="string"}function ce(t){return Array.isArray(t)}function Oh(t){return t}var At=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(At||{}),Mt=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))(Mt||{}),Fn=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(Fn||{}),dt=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t[t.AWAY=16]="AWAY",t[t.TOWARD=17]="TOWARD",t[t.PLAYER=18]="PLAYER",t[t.FIND=19]="FIND",t[t.FLEE=20]="FLEE",t[t.TO=21]="TO",t[t.MID=22]="MID",t[t.OVER=23]="OVER",t[t.UNDER=24]="UNDER",t))(dt||{}),vt=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.HOTKEY=11]="HOTKEY",t[t.COPYIT=12]="COPYIT",t[t.OPENIT=13]="OPENIT",t[t.ZSSEDIT=14]="ZSSEDIT",t[t.CHAREDIT=15]="CHAREDIT",t[t.COLOREDIT=16]="COLOREDIT",t))(vt||{});function Ot(t){return(t==null?void 0:t.toLowerCase().trim())??""}function Lv(t,e,n,r,i){return{session:t,player:e,id:je(),sender:n,target:r,data:i}}function tr(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function ho(t,e=[],n=Oh,r=""){const i=je(),s=Ot(t),o=e.map(Ot);let a=r;const c={id(){return i},name(){return t},session(l){return x(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,d){Jn.emit(a,l,i,u,d)},reply(l,u,d){c.emit(l.player,`${l.sender}:${u}`,d)},replynext(l,u,d){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,d),64)},handle(l){const{target:u,path:d}=tr(l.target),f=Ot(u);!a&&f==="ready"&&(a=l.session),f==="bridge"&&x(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===f)!==-1&&n(l),(i===u||f==="all"||s===f)&&n({...l,target:d})}};return Jn.connect(c),c}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Mv=4,Pp=0,Dp=1,Uv=2;function fo(t){let e=t.length;for(;--e>=0;)t[e]=0}const Fv=0,$p=1,Bv=2,Pv=3,Dv=258,Ih=29,xa=256,Ea=xa+1+Ih,po=30,Nh=19,jp=2*Ea+1,Ss=15,Ch=16,$v=7,Lh=256,zp=16,Kp=17,Wp=18,Mh=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),qc=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),jv=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Hp=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zv=512,xi=new Array((Ea+2)*2);fo(xi);const va=new Array(po*2);fo(va);const ka=new Array(zv);fo(ka);const Ta=new Array(Dv-Pv+1);fo(Ta);const Uh=new Array(Ih);fo(Uh);const Jc=new Array(po);fo(Jc);function Fh(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let Gp,Yp,Vp;function Bh(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}const Zp=t=>t<256?ka[t]:ka[256+(t>>>7)],Aa=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},Bn=(t,e,n)=>{t.bi_valid>Ch-n?(t.bi_buf|=e<<t.bi_valid&65535,Aa(t,t.bi_buf),t.bi_buf=e>>Ch-t.bi_valid,t.bi_valid+=n-Ch):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},Gr=(t,e,n)=>{Bn(t,n[e*2],n[e*2+1])},Xp=(t,e)=>{let n=0;do n|=t&1,t>>>=1,n<<=1;while(--e>0);return n>>>1},Kv=t=>{t.bi_valid===16?(Aa(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},Wv=(t,e)=>{const n=e.dyn_tree,r=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,u,d,f,h,p,m=0;for(f=0;f<=Ss;f++)t.bl_count[f]=0;for(n[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<jp;l++)u=t.heap[l],f=n[n[u*2+1]*2+1]+1,f>c&&(f=c,m++),n[u*2+1]=f,!(u>r)&&(t.bl_count[f]++,h=0,u>=a&&(h=o[u-a]),p=n[u*2],t.opt_len+=p*(f+h),s&&(t.static_len+=p*(i[u*2+1]+h)));if(m!==0){do{for(f=c-1;t.bl_count[f]===0;)f--;t.bl_count[f]--,t.bl_count[f+1]+=2,t.bl_count[c]--,m-=2}while(m>0);for(f=c;f!==0;f--)for(u=t.bl_count[f];u!==0;)d=t.heap[--l],!(d>r)&&(n[d*2+1]!==f&&(t.opt_len+=(f-n[d*2+1])*n[d*2],n[d*2+1]=f),u--)}},qp=(t,e,n)=>{const r=new Array(Ss+1);let i=0,s,o;for(s=1;s<=Ss;s++)i=i+n[s-1]<<1,r[s]=i;for(o=0;o<=e;o++){let a=t[o*2+1];a!==0&&(t[o*2]=Xp(r[a]++,a))}},Hv=()=>{let t,e,n,r,i;const s=new Array(Ss+1);for(n=0,r=0;r<Ih-1;r++)for(Uh[r]=n,t=0;t<1<<Mh[r];t++)Ta[n++]=r;for(Ta[n-1]=r,i=0,r=0;r<16;r++)for(Jc[r]=i,t=0;t<1<<qc[r];t++)ka[i++]=r;for(i>>=7;r<po;r++)for(Jc[r]=i<<7,t=0;t<1<<qc[r]-7;t++)ka[256+i++]=r;for(e=0;e<=Ss;e++)s[e]=0;for(t=0;t<=143;)xi[t*2+1]=8,t++,s[8]++;for(;t<=255;)xi[t*2+1]=9,t++,s[9]++;for(;t<=279;)xi[t*2+1]=7,t++,s[7]++;for(;t<=287;)xi[t*2+1]=8,t++,s[8]++;for(qp(xi,Ea+1,s),t=0;t<po;t++)va[t*2+1]=5,va[t*2]=Xp(t,5);Gp=new Fh(xi,Mh,xa+1,Ea,Ss),Yp=new Fh(va,qc,0,po,Ss),Vp=new Fh(new Array(0),jv,0,Nh,$v)},Jp=t=>{let e;for(e=0;e<Ea;e++)t.dyn_ltree[e*2]=0;for(e=0;e<po;e++)t.dyn_dtree[e*2]=0;for(e=0;e<Nh;e++)t.bl_tree[e*2]=0;t.dyn_ltree[Lh*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Qp=t=>{t.bi_valid>8?Aa(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},tm=(t,e,n,r)=>{const i=e*2,s=n*2;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]},Ph=(t,e,n)=>{const r=t.heap[n];let i=n<<1;for(;i<=t.heap_len&&(i<t.heap_len&&tm(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!tm(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r},em=(t,e,n)=>{let r,i,s=0,o,a;if(t.sym_next!==0)do r=t.pending_buf[t.sym_buf+s++]&255,r+=(t.pending_buf[t.sym_buf+s++]&255)<<8,i=t.pending_buf[t.sym_buf+s++],r===0?Gr(t,i,e):(o=Ta[i],Gr(t,o+xa+1,e),a=Mh[o],a!==0&&(i-=Uh[o],Bn(t,i,a)),r--,o=Zp(r),Gr(t,o,n),a=qc[o],a!==0&&(r-=Jc[o],Bn(t,r,a)));while(s<t.sym_next);Gr(t,Lh,e)},Dh=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,c=-1,l;for(t.heap_len=0,t.heap_max=jp,o=0;o<s;o++)n[o*2]!==0?(t.heap[++t.heap_len]=c=o,t.depth[o]=0):n[o*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,n[l*2]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=r[l*2+1]);for(e.max_code=c,o=t.heap_len>>1;o>=1;o--)Ph(t,n,o);l=s;do o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Ph(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[l*2]=n[o*2]+n[a*2],t.depth[l]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[o*2+1]=n[a*2+1]=l,t.heap[1]=l++,Ph(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],Wv(t,e),qp(n,c,t.bl_count)},nm=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),e[(n+1)*2+1]=65535,r=0;r<=n;r++)s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)&&(a<l?t.bl_tree[s*2]+=a:s!==0?(s!==i&&t.bl_tree[s*2]++,t.bl_tree[zp*2]++):a<=10?t.bl_tree[Kp*2]++:t.bl_tree[Wp*2]++,a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4))},rm=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),r=0;r<=n;r++)if(s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)){if(a<l)do Gr(t,s,t.bl_tree);while(--a!==0);else s!==0?(s!==i&&(Gr(t,s,t.bl_tree),a--),Gr(t,zp,t.bl_tree),Bn(t,a-3,2)):a<=10?(Gr(t,Kp,t.bl_tree),Bn(t,a-3,3)):(Gr(t,Wp,t.bl_tree),Bn(t,a-11,7));a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4)}},Gv=t=>{let e;for(nm(t,t.dyn_ltree,t.l_desc.max_code),nm(t,t.dyn_dtree,t.d_desc.max_code),Dh(t,t.bl_desc),e=Nh-1;e>=3&&t.bl_tree[Hp[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},Yv=(t,e,n,r)=>{let i;for(Bn(t,e-257,5),Bn(t,n-1,5),Bn(t,r-4,4),i=0;i<r;i++)Bn(t,t.bl_tree[Hp[i]*2+1],3);rm(t,t.dyn_ltree,e-1),rm(t,t.dyn_dtree,n-1)},Vv=t=>{let e=4093624447,n;for(n=0;n<=31;n++,e>>>=1)if(e&1&&t.dyn_ltree[n*2]!==0)return Pp;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return Dp;for(n=32;n<xa;n++)if(t.dyn_ltree[n*2]!==0)return Dp;return Pp};let im=!1;const Zv=t=>{im||(Hv(),im=!0),t.l_desc=new Bh(t.dyn_ltree,Gp),t.d_desc=new Bh(t.dyn_dtree,Yp),t.bl_desc=new Bh(t.bl_tree,Vp),t.bi_buf=0,t.bi_valid=0,Jp(t)},sm=(t,e,n,r)=>{Bn(t,(Fv<<1)+(r?1:0),3),Qp(t),Aa(t,n),Aa(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n},Xv=t=>{Bn(t,$p<<1,3),Gr(t,Lh,xi),Kv(t)},qv=(t,e,n,r)=>{let i,s,o=0;t.level>0?(t.strm.data_type===Uv&&(t.strm.data_type=Vv(t)),Dh(t,t.l_desc),Dh(t,t.d_desc),o=Gv(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&e!==-1?sm(t,e,n,r):t.strategy===Mv||s===i?(Bn(t,($p<<1)+(r?1:0),3),em(t,xi,va)):(Bn(t,(Bv<<1)+(r?1:0),3),Yv(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),em(t,t.dyn_ltree,t.dyn_dtree)),Jp(t),r&&Qp(t)},Jv=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[n*2]++:(t.matches++,e--,t.dyn_ltree[(Ta[n]+xa+1)*2]++,t.dyn_dtree[Zp(e)*2]++),t.sym_next===t.sym_end);var Qv=Zv,tk=sm,ek=qv,nk=Jv,rk=Xv,ik={_tr_init:Qv,_tr_stored_block:tk,_tr_flush_block:ek,_tr_tally:nk,_tr_align:rk},Ra=(t,e,n,r)=>{let i=t&65535|0,s=t>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+e[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const sk=()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;e[n]=t}return e},ok=new Uint32Array(sk());var an=(t,e,n,r)=>{const i=ok,s=r+n;t^=-1;for(let o=r;o<s;o++)t=t>>>8^i[(t^e[o])&255];return t^-1},Os={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Is={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ak,_tr_stored_block:$h,_tr_flush_block:ck,_tr_tally:Vi,_tr_align:lk}=ik,{Z_NO_FLUSH:Zi,Z_PARTIAL_FLUSH:uk,Z_FULL_FLUSH:hk,Z_FINISH:pr,Z_BLOCK:om,Z_OK:fn,Z_STREAM_END:am,Z_STREAM_ERROR:Yr,Z_DATA_ERROR:fk,Z_BUF_ERROR:jh,Z_DEFAULT_COMPRESSION:dk,Z_FILTERED:pk,Z_HUFFMAN_ONLY:Qc,Z_RLE:mk,Z_FIXED:gk,Z_DEFAULT_STRATEGY:_k,Z_UNKNOWN:yk,Z_DEFLATED:tl}=Is,bk=9,wk=15,xk=8,zh=256+1+29,Ek=30,vk=19,kk=2*zh+1,Tk=15,Zt=3,Xi=258,Vr=Xi+Zt+1,Ak=32,mo=42,Kh=57,Wh=69,Hh=73,Gh=91,Yh=103,Ns=113,Sa=666,An=1,go=2,Cs=3,_o=4,Rk=3,Ls=(t,e)=>(t.msg=Os[e],e),cm=t=>t*2-(t>4?9:0),qi=t=>{let e=t.length;for(;--e>=0;)t[e]=0},Sk=t=>{let e,n,r,i=t.w_size;e=t.hash_size,r=e;do n=t.head[--r],t.head[r]=n>=i?n-i:0;while(--e);e=i,r=e;do n=t.prev[--r],t.prev[r]=n>=i?n-i:0;while(--e)};let Ji=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const er=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},nr=(t,e)=>{ck(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,er(t.strm)},se=(t,e)=>{t.pending_buf[t.pending++]=e},Oa=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},Vh=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),t.state.wrap===1?t.adler=Ra(t.adler,e,i,n):t.state.wrap===2&&(t.adler=an(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},lm=(t,e)=>{let n=t.max_chain_length,r=t.strstart,i,s,o=t.prev_length,a=t.nice_match;const c=t.strstart>t.w_size-Vr?t.strstart-(t.w_size-Vr):0,l=t.window,u=t.w_mask,d=t.prev,f=t.strstart+Xi;let h=l[r+o-1],p=l[r+o];t.prev_length>=t.good_match&&(n>>=2),a>t.lookahead&&(a=t.lookahead);do if(i=e,!(l[i+o]!==p||l[i+o-1]!==h||l[i]!==l[r]||l[++i]!==l[r+1])){r+=2,i++;do;while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<f);if(s=Xi-(f-r),r=f-Xi,s>o){if(t.match_start=e,o=s,s>=a)break;h=l[r+o-1],p=l[r+o]}}while((e=d[e&u])>c&&--n!==0);return o<=t.lookahead?o:t.lookahead},yo=t=>{const e=t.w_size;let n,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Vr)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),Sk(t),r+=e),t.strm.avail_in===0)break;if(n=Vh(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=Zt)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=Ji(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=Ji(t,t.ins_h,t.window[i+Zt-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<Zt)););}while(t.lookahead<Vr&&t.strm.avail_in!==0)},um=(t,e)=>{let n=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,r,i,s,o=0,a=t.strm.avail_in;do{if(r=65535,s=t.bi_valid+42>>3,t.strm.avail_out<s||(s=t.strm.avail_out-s,i=t.strstart-t.block_start,r>i+t.strm.avail_in&&(r=i+t.strm.avail_in),r>s&&(r=s),r<n&&(r===0&&e!==pr||e===Zi||r!==i+t.strm.avail_in)))break;o=e===pr&&r===i+t.strm.avail_in?1:0,$h(t,0,0,o),t.pending_buf[t.pending-4]=r,t.pending_buf[t.pending-3]=r>>8,t.pending_buf[t.pending-2]=~r,t.pending_buf[t.pending-1]=~r>>8,er(t.strm),i&&(i>r&&(i=r),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,r-=i),r&&(Vh(t.strm,t.strm.output,t.strm.next_out,r),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r)}while(o===0);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?_o:e!==Zi&&e!==pr&&t.strm.avail_in===0&&t.strstart===t.block_start?go:(s=t.window_size-t.strstart,t.strm.avail_in>s&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,s+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),s>t.strm.avail_in&&(s=t.strm.avail_in),s&&(Vh(t.strm,t.window,t.strstart,s),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.high_water<t.strstart&&(t.high_water=t.strstart),s=t.bi_valid+42>>3,s=t.pending_buf_size-s>65535?65535:t.pending_buf_size-s,n=s>t.w_size?t.w_size:s,i=t.strstart-t.block_start,(i>=n||(i||e===pr)&&e!==Zi&&t.strm.avail_in===0&&i<=s)&&(r=i>s?s:i,o=e===pr&&t.strm.avail_in===0&&r===i?1:0,$h(t,t.block_start,r,o),t.block_start+=r,er(t.strm)),o?Cs:An)},Zh=(t,e)=>{let n,r;for(;;){if(t.lookahead<Vr){if(yo(t),t.lookahead<Vr&&e===Zi)return An;if(t.lookahead===0)break}if(n=0,t.lookahead>=Zt&&(t.ins_h=Ji(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-Vr&&(t.match_length=lm(t,n)),t.match_length>=Zt)if(r=Vi(t,t.strstart-t.match_start,t.match_length-Zt),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=Zt){t.match_length--;do t.strstart++,t.ins_h=Ji(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Ji(t,t.ins_h,t.window[t.strstart+1]);else r=Vi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(nr(t,!1),t.strm.avail_out===0))return An}return t.insert=t.strstart<Zt-1?t.strstart:Zt-1,e===pr?(nr(t,!0),t.strm.avail_out===0?Cs:_o):t.sym_next&&(nr(t,!1),t.strm.avail_out===0)?An:go},bo=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<Vr){if(yo(t),t.lookahead<Vr&&e===Zi)return An;if(t.lookahead===0)break}if(n=0,t.lookahead>=Zt&&(t.ins_h=Ji(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=Zt-1,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Vr&&(t.match_length=lm(t,n),t.match_length<=5&&(t.strategy===pk||t.match_length===Zt&&t.strstart-t.match_start>4096)&&(t.match_length=Zt-1)),t.prev_length>=Zt&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-Zt,r=Vi(t,t.strstart-1-t.prev_match,t.prev_length-Zt),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=Ji(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=Zt-1,t.strstart++,r&&(nr(t,!1),t.strm.avail_out===0))return An}else if(t.match_available){if(r=Vi(t,0,t.window[t.strstart-1]),r&&nr(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return An}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Vi(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<Zt-1?t.strstart:Zt-1,e===pr?(nr(t,!0),t.strm.avail_out===0?Cs:_o):t.sym_next&&(nr(t,!1),t.strm.avail_out===0)?An:go},Ok=(t,e)=>{let n,r,i,s;const o=t.window;for(;;){if(t.lookahead<=Xi){if(yo(t),t.lookahead<=Xi&&e===Zi)return An;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=Zt&&t.strstart>0&&(i=t.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){s=t.strstart+Xi;do;while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<s);t.match_length=Xi-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=Zt?(n=Vi(t,1,t.match_length-Zt),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=Vi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(nr(t,!1),t.strm.avail_out===0))return An}return t.insert=0,e===pr?(nr(t,!0),t.strm.avail_out===0?Cs:_o):t.sym_next&&(nr(t,!1),t.strm.avail_out===0)?An:go},Ik=(t,e)=>{let n;for(;;){if(t.lookahead===0&&(yo(t),t.lookahead===0)){if(e===Zi)return An;break}if(t.match_length=0,n=Vi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(nr(t,!1),t.strm.avail_out===0))return An}return t.insert=0,e===pr?(nr(t,!0),t.strm.avail_out===0?Cs:_o):t.sym_next&&(nr(t,!1),t.strm.avail_out===0)?An:go};function Zr(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const Ia=[new Zr(0,0,0,0,um),new Zr(4,4,8,4,Zh),new Zr(4,5,16,8,Zh),new Zr(4,6,32,32,Zh),new Zr(4,4,16,16,bo),new Zr(8,16,32,32,bo),new Zr(8,16,128,128,bo),new Zr(8,32,128,256,bo),new Zr(32,128,258,1024,bo),new Zr(32,258,258,4096,bo)],Nk=t=>{t.window_size=2*t.w_size,qi(t.head),t.max_lazy_match=Ia[t.level].max_lazy,t.good_match=Ia[t.level].good_length,t.nice_match=Ia[t.level].nice_length,t.max_chain_length=Ia[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=Zt-1,t.match_available=0,t.ins_h=0};function Ck(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=tl,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(kk*2),this.dyn_dtree=new Uint16Array((2*Ek+1)*2),this.bl_tree=new Uint16Array((2*vk+1)*2),qi(this.dyn_ltree),qi(this.dyn_dtree),qi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Tk+1),this.heap=new Uint16Array(2*zh+1),qi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*zh+1),qi(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Na=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==mo&&e.status!==Kh&&e.status!==Wh&&e.status!==Hh&&e.status!==Gh&&e.status!==Yh&&e.status!==Ns&&e.status!==Sa?1:0},hm=t=>{if(Na(t))return Ls(t,Yr);t.total_in=t.total_out=0,t.data_type=yk;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?Kh:e.wrap?mo:Ns,t.adler=e.wrap===2?0:1,e.last_flush=-2,ak(e),fn},fm=t=>{const e=hm(t);return e===fn&&Nk(t.state),e},Lk=(t,e)=>Na(t)||t.state.wrap!==2?Yr:(t.state.gzhead=e,fn),dm=(t,e,n,r,i,s)=>{if(!t)return Yr;let o=1;if(e===dk&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>bk||n!==tl||r<8||r>15||e<0||e>9||s<0||s>gk||r===8&&o!==1)return Ls(t,Yr);r===8&&(r=9);const a=new Ck;return t.state=a,a.strm=t,a.status=mo,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+Zt-1)/Zt),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=e,a.strategy=s,a.method=n,fm(t)},Mk=(t,e)=>dm(t,e,tl,wk,xk,_k),Uk=(t,e)=>{if(Na(t)||e>om||e<0)return t?Ls(t,Yr):Yr;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===Sa&&e!==pr)return Ls(t,t.avail_out===0?jh:Yr);const r=n.last_flush;if(n.last_flush=e,n.pending!==0){if(er(t),t.avail_out===0)return n.last_flush=-1,fn}else if(t.avail_in===0&&cm(e)<=cm(r)&&e!==pr)return Ls(t,jh);if(n.status===Sa&&t.avail_in!==0)return Ls(t,jh);if(n.status===mo&&n.wrap===0&&(n.status=Ns),n.status===mo){let i=tl+(n.w_bits-8<<4)<<8,s=-1;if(n.strategy>=Qc||n.level<2?s=0:n.level<6?s=1:n.level===6?s=2:s=3,i|=s<<6,n.strstart!==0&&(i|=Ak),i+=31-i%31,Oa(n,i),n.strstart!==0&&(Oa(n,t.adler>>>16),Oa(n,t.adler&65535)),t.adler=1,n.status=Ns,er(t),n.pending!==0)return n.last_flush=-1,fn}if(n.status===Kh){if(t.adler=0,se(n,31),se(n,139),se(n,8),n.gzhead)se(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),se(n,n.gzhead.time&255),se(n,n.gzhead.time>>8&255),se(n,n.gzhead.time>>16&255),se(n,n.gzhead.time>>24&255),se(n,n.level===9?2:n.strategy>=Qc||n.level<2?4:0),se(n,n.gzhead.os&255),n.gzhead.extra&&n.gzhead.extra.length&&(se(n,n.gzhead.extra.length&255),se(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=an(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=Wh;else if(se(n,0),se(n,0),se(n,0),se(n,0),se(n,0),se(n,n.level===9?2:n.strategy>=Qc||n.level<2?4:0),se(n,Rk),n.status=Ns,er(t),n.pending!==0)return n.last_flush=-1,fn}if(n.status===Wh){if(n.gzhead.extra){let i=n.pending,s=(n.gzhead.extra.length&65535)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(t.adler=an(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=a,er(t),n.pending!==0)return n.last_flush=-1,fn;i=0,s-=a}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(t.adler=an(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=Hh}if(n.status===Hh){if(n.gzhead.name){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=an(t.adler,n.pending_buf,n.pending-i,i)),er(t),n.pending!==0)return n.last_flush=-1,fn;i=0}n.gzindex<n.gzhead.name.length?s=n.gzhead.name.charCodeAt(n.gzindex++)&255:s=0,se(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=an(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=Gh}if(n.status===Gh){if(n.gzhead.comment){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=an(t.adler,n.pending_buf,n.pending-i,i)),er(t),n.pending!==0)return n.last_flush=-1,fn;i=0}n.gzindex<n.gzhead.comment.length?s=n.gzhead.comment.charCodeAt(n.gzindex++)&255:s=0,se(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=an(t.adler,n.pending_buf,n.pending-i,i))}n.status=Yh}if(n.status===Yh){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(er(t),n.pending!==0))return n.last_flush=-1,fn;se(n,t.adler&255),se(n,t.adler>>8&255),t.adler=0}if(n.status=Ns,er(t),n.pending!==0)return n.last_flush=-1,fn}if(t.avail_in!==0||n.lookahead!==0||e!==Zi&&n.status!==Sa){let i=n.level===0?um(n,e):n.strategy===Qc?Ik(n,e):n.strategy===mk?Ok(n,e):Ia[n.level].func(n,e);if((i===Cs||i===_o)&&(n.status=Sa),i===An||i===Cs)return t.avail_out===0&&(n.last_flush=-1),fn;if(i===go&&(e===uk?lk(n):e!==om&&($h(n,0,0,!1),e===hk&&(qi(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),er(t),t.avail_out===0))return n.last_flush=-1,fn}return e!==pr?fn:n.wrap<=0?am:(n.wrap===2?(se(n,t.adler&255),se(n,t.adler>>8&255),se(n,t.adler>>16&255),se(n,t.adler>>24&255),se(n,t.total_in&255),se(n,t.total_in>>8&255),se(n,t.total_in>>16&255),se(n,t.total_in>>24&255)):(Oa(n,t.adler>>>16),Oa(n,t.adler&65535)),er(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?fn:am)},Fk=t=>{if(Na(t))return Yr;const e=t.state.status;return t.state=null,e===Ns?Ls(t,fk):fn},Bk=(t,e)=>{let n=e.length;if(Na(t))return Yr;const r=t.state,i=r.wrap;if(i===2||i===1&&r.status!==mo||r.lookahead)return Yr;if(i===1&&(t.adler=Ra(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){i===0&&(qi(r.head),r.strstart=0,r.block_start=0,r.insert=0);let c=new Uint8Array(r.w_size);c.set(e.subarray(n-r.w_size,n),0),e=c,n=r.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,yo(r);r.lookahead>=Zt;){let c=r.strstart,l=r.lookahead-(Zt-1);do r.ins_h=Ji(r,r.ins_h,r.window[c+Zt-1]),r.prev[c&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=c,c++;while(--l);r.strstart=c,r.lookahead=Zt-1,yo(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=Zt-1,r.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,r.wrap=i,fn};var Pk=Mk,Dk=dm,$k=fm,jk=hm,zk=Lk,Kk=Uk,Wk=Fk,Hk=Bk,Gk="pako deflate (from Nodeca project)",Ca={deflateInit:Pk,deflateInit2:Dk,deflateReset:$k,deflateResetKeep:jk,deflateSetHeader:zk,deflate:Kk,deflateEnd:Wk,deflateSetDictionary:Hk,deflateInfo:Gk};const Yk=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Vk=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)Yk(n,r)&&(t[r]=n[r])}}return t},Zk=t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,s=t.length;r<s;r++){let o=t[r];n.set(o,i),i+=o.length}return n},el={assign:Vk,flattenChunks:Zk};let pm=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{pm=!1}const La=new Uint8Array(256);for(let t=0;t<256;t++)La[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;La[254]=La[254]=1;var Xk=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,i,s,o=t.length,a=0;for(i=0;i<o;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|n&63):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|n&63):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|n&63);return e};const qk=(t,e)=>{if(e<65534&&t.subarray&&pm)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n};var Jk=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,i;const s=new Array(n*2);for(i=0,r=0;r<n;){let o=t[r++];if(o<128){s[i++]=o;continue}let a=La[o];if(a>4){s[i++]=65533,r+=a-1;continue}for(o&=a===2?31:a===3?15:7;a>1&&r<n;)o=o<<6|t[r++]&63,a--;if(a>1){s[i++]=65533;continue}o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|o&1023)}return qk(s,i)},Qk=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(t[n]&192)===128;)n--;return n<0||n===0?e:n+La[t[n]]>e?n:e},Ma={string2buf:Xk,buf2string:Jk,utf8border:Qk};function tT(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var mm=tT;const gm=Object.prototype.toString,{Z_NO_FLUSH:eT,Z_SYNC_FLUSH:nT,Z_FULL_FLUSH:rT,Z_FINISH:iT,Z_OK:nl,Z_STREAM_END:sT,Z_DEFAULT_COMPRESSION:oT,Z_DEFAULT_STRATEGY:aT,Z_DEFLATED:cT}=Is;function Ua(t){this.options=el.assign({level:oT,method:cT,chunkSize:16384,windowBits:15,memLevel:8,strategy:aT},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new mm,this.strm.avail_out=0;let n=Ca.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==nl)throw new Error(Os[n]);if(e.header&&Ca.deflateSetHeader(this.strm,e.header),e.dictionary){let r;if(typeof e.dictionary=="string"?r=Ma.string2buf(e.dictionary):gm.call(e.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(e.dictionary):r=e.dictionary,n=Ca.deflateSetDictionary(this.strm,r),n!==nl)throw new Error(Os[n]);this._dict_set=!0}}Ua.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?iT:eT,typeof t=="string"?n.input=Ma.string2buf(t):gm.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===nT||s===rT)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(i=Ca.deflate(n,s),i===sT)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Ca.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===nl;if(n.avail_out===0){this.onData(n.output);continue}if(s>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(n.avail_in===0)break}return!0},Ua.prototype.onData=function(t){this.chunks.push(t)},Ua.prototype.onEnd=function(t){t===nl&&(this.result=el.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Xh(t,e){const n=new Ua(e);if(n.push(t,!0),n.err)throw n.msg||Os[n.err];return n.result}function lT(t,e){return e=e||{},e.raw=!0,Xh(t,e)}function uT(t,e){return e=e||{},e.gzip=!0,Xh(t,e)}var hT=Ua,fT=Xh,dT=lT,pT=uT,mT=Is,gT={Deflate:hT,deflate:fT,deflateRaw:dT,gzip:pT,constants:mT};const rl=16209,_T=16191;var yT=function(e,n){let r,i,s,o,a,c,l,u,d,f,h,p,m,b,_,v,T,A,C,R,S,U,I,P;const W=e.state;r=e.next_in,I=e.input,i=r+(e.avail_in-5),s=e.next_out,P=e.output,o=s-(n-e.avail_out),a=s+(e.avail_out-257),c=W.dmax,l=W.wsize,u=W.whave,d=W.wnext,f=W.window,h=W.hold,p=W.bits,m=W.lencode,b=W.distcode,_=(1<<W.lenbits)-1,v=(1<<W.distbits)-1;t:do{p<15&&(h+=I[r++]<<p,p+=8,h+=I[r++]<<p,p+=8),T=m[h&_];e:for(;;){if(A=T>>>24,h>>>=A,p-=A,A=T>>>16&255,A===0)P[s++]=T&65535;else if(A&16){C=T&65535,A&=15,A&&(p<A&&(h+=I[r++]<<p,p+=8),C+=h&(1<<A)-1,h>>>=A,p-=A),p<15&&(h+=I[r++]<<p,p+=8,h+=I[r++]<<p,p+=8),T=b[h&v];n:for(;;){if(A=T>>>24,h>>>=A,p-=A,A=T>>>16&255,A&16){if(R=T&65535,A&=15,p<A&&(h+=I[r++]<<p,p+=8,p<A&&(h+=I[r++]<<p,p+=8)),R+=h&(1<<A)-1,R>c){e.msg="invalid distance too far back",W.mode=rl;break t}if(h>>>=A,p-=A,A=s-o,R>A){if(A=R-A,A>u&&W.sane){e.msg="invalid distance too far back",W.mode=rl;break t}if(S=0,U=f,d===0){if(S+=l-A,A<C){C-=A;do P[s++]=f[S++];while(--A);S=s-R,U=P}}else if(d<A){if(S+=l+d-A,A-=d,A<C){C-=A;do P[s++]=f[S++];while(--A);if(S=0,d<C){A=d,C-=A;do P[s++]=f[S++];while(--A);S=s-R,U=P}}}else if(S+=d-A,A<C){C-=A;do P[s++]=f[S++];while(--A);S=s-R,U=P}for(;C>2;)P[s++]=U[S++],P[s++]=U[S++],P[s++]=U[S++],C-=3;C&&(P[s++]=U[S++],C>1&&(P[s++]=U[S++]))}else{S=s-R;do P[s++]=P[S++],P[s++]=P[S++],P[s++]=P[S++],C-=3;while(C>2);C&&(P[s++]=P[S++],C>1&&(P[s++]=P[S++]))}}else if(A&64){e.msg="invalid distance code",W.mode=rl;break t}else{T=b[(T&65535)+(h&(1<<A)-1)];continue n}break}}else if(A&64)if(A&32){W.mode=_T;break t}else{e.msg="invalid literal/length code",W.mode=rl;break t}else{T=m[(T&65535)+(h&(1<<A)-1)];continue e}break}}while(r<i&&s<a);C=p>>3,r-=C,p-=C<<3,h&=(1<<p)-1,e.next_in=r,e.next_out=s,e.avail_in=r<i?5+(i-r):5-(r-i),e.avail_out=s<a?257+(a-s):257-(s-a),W.hold=h,W.bits=p};const wo=15,_m=852,ym=592,bm=0,qh=1,wm=2,bT=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),wT=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),xT=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ET=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Fa=(t,e,n,r,i,s,o,a)=>{const c=a.bits;let l=0,u=0,d=0,f=0,h=0,p=0,m=0,b=0,_=0,v=0,T,A,C,R,S,U=null,I;const P=new Uint16Array(wo+1),W=new Uint16Array(wo+1);let L=null,N,E,D;for(l=0;l<=wo;l++)P[l]=0;for(u=0;u<r;u++)P[e[n+u]]++;for(h=c,f=wo;f>=1&&P[f]===0;f--);if(h>f&&(h=f),f===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,a.bits=1,0;for(d=1;d<f&&P[d]===0;d++);for(h<d&&(h=d),b=1,l=1;l<=wo;l++)if(b<<=1,b-=P[l],b<0)return-1;if(b>0&&(t===bm||f!==1))return-1;for(W[1]=0,l=1;l<wo;l++)W[l+1]=W[l]+P[l];for(u=0;u<r;u++)e[n+u]!==0&&(o[W[e[n+u]]++]=u);if(t===bm?(U=L=o,I=20):t===qh?(U=bT,L=wT,I=257):(U=xT,L=ET,I=0),v=0,u=0,l=d,S=s,p=h,m=0,C=-1,_=1<<h,R=_-1,t===qh&&_>_m||t===wm&&_>ym)return 1;for(;;){N=l-m,o[u]+1<I?(E=0,D=o[u]):o[u]>=I?(E=L[o[u]-I],D=U[o[u]-I]):(E=96,D=0),T=1<<l-m,A=1<<p,d=A;do A-=T,i[S+(v>>m)+A]=N<<24|E<<16|D|0;while(A!==0);for(T=1<<l-1;v&T;)T>>=1;if(T!==0?(v&=T-1,v+=T):v=0,u++,--P[l]===0){if(l===f)break;l=e[n+o[u]]}if(l>h&&(v&R)!==C){for(m===0&&(m=h),S+=d,p=l-m,b=1<<p;p+m<f&&(b-=P[p+m],!(b<=0));)p++,b<<=1;if(_+=1<<p,t===qh&&_>_m||t===wm&&_>ym)return 1;C=v&R,i[C]=h<<24|p<<16|S-s|0}}return v!==0&&(i[S+v]=l-m<<24|64<<16|0),a.bits=h,0};const vT=0,xm=1,Em=2,{Z_FINISH:vm,Z_BLOCK:kT,Z_TREES:il,Z_OK:Ms,Z_STREAM_END:TT,Z_NEED_DICT:AT,Z_STREAM_ERROR:mr,Z_DATA_ERROR:km,Z_MEM_ERROR:Tm,Z_BUF_ERROR:RT,Z_DEFLATED:Am}=Is,sl=16180,Rm=16181,Sm=16182,Om=16183,Im=16184,Nm=16185,Cm=16186,Lm=16187,Mm=16188,Um=16189,ol=16190,Ei=16191,Jh=16192,Fm=16193,Qh=16194,Bm=16195,Pm=16196,Dm=16197,$m=16198,al=16199,cl=16200,jm=16201,zm=16202,Km=16203,Wm=16204,Hm=16205,tf=16206,Gm=16207,Ym=16208,ke=16209,Vm=16210,Zm=16211,ST=852,OT=592,IT=15,Xm=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function NT(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Us=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<sl||e.mode>Zm?1:0},qm=t=>{if(Us(t))return mr;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=sl,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(ST),e.distcode=e.distdyn=new Int32Array(OT),e.sane=1,e.back=-1,Ms},Jm=t=>{if(Us(t))return mr;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,qm(t)},Qm=(t,e)=>{let n;if(Us(t))return mr;const r=t.state;return e<0?(n=0,e=-e):(n=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?mr:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,Jm(t))},tg=(t,e)=>{if(!t)return mr;const n=new NT;t.state=n,n.strm=t,n.window=null,n.mode=sl;const r=Qm(t,e);return r!==Ms&&(t.state=null),r},CT=t=>tg(t,IT);let eg=!0,ef,nf;const LT=t=>{if(eg){ef=new Int32Array(512),nf=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Fa(xm,t.lens,0,288,ef,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Fa(Em,t.lens,0,32,nf,0,t.work,{bits:5}),eg=!1}t.lencode=ef,t.lenbits=9,t.distcode=nf,t.distbits=5},ng=(t,e,n,r)=>{let i;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(e.subarray(n-r,n-r+i),s.wnext),r-=i,r?(s.window.set(e.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},MT=(t,e)=>{let n,r,i,s,o,a,c,l,u,d,f,h,p,m,b=0,_,v,T,A,C,R,S,U;const I=new Uint8Array(4);let P,W;const L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Us(t)||!t.output||!t.input&&t.avail_in!==0)return mr;n=t.state,n.mode===Ei&&(n.mode=Jh),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,d=a,f=c,U=Ms;t:for(;;)switch(n.mode){case sl:if(n.wrap===0){n.mode=Jh;break}for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&2&&l===35615){n.wbits===0&&(n.wbits=15),n.check=0,I[0]=l&255,I[1]=l>>>8&255,n.check=an(n.check,I,2,0),l=0,u=0,n.mode=Rm;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",n.mode=ke;break}if((l&15)!==Am){t.msg="unknown compression method",n.mode=ke;break}if(l>>>=4,u-=4,S=(l&15)+8,n.wbits===0&&(n.wbits=S),S>15||S>n.wbits){t.msg="invalid window size",n.mode=ke;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=l&512?Um:Ei,l=0,u=0;break;case Rm:for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.flags=l,(n.flags&255)!==Am){t.msg="unknown compression method",n.mode=ke;break}if(n.flags&57344){t.msg="unknown header flags set",n.mode=ke;break}n.head&&(n.head.text=l>>8&1),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,n.check=an(n.check,I,2,0)),l=0,u=0,n.mode=Sm;case Sm:for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.time=l),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,I[2]=l>>>16&255,I[3]=l>>>24&255,n.check=an(n.check,I,4,0)),l=0,u=0,n.mode=Om;case Om:for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.xflags=l&255,n.head.os=l>>8),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,n.check=an(n.check,I,2,0)),l=0,u=0,n.mode=Im;case Im:if(n.flags&1024){for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,n.check=an(n.check,I,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=Nm;case Nm:if(n.flags&1024&&(h=n.length,h>a&&(h=a),h&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+h),S)),n.flags&512&&n.wrap&4&&(n.check=an(n.check,r,h,s)),a-=h,s+=h,n.length-=h),n.length))break t;n.length=0,n.mode=Cm;case Cm:if(n.flags&2048){if(a===0)break t;h=0;do S=r[s+h++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S));while(S&&h<a);if(n.flags&512&&n.wrap&4&&(n.check=an(n.check,r,h,s)),a-=h,s+=h,S)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=Lm;case Lm:if(n.flags&4096){if(a===0)break t;h=0;do S=r[s+h++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S));while(S&&h<a);if(n.flags&512&&n.wrap&4&&(n.check=an(n.check,r,h,s)),a-=h,s+=h,S)break t}else n.head&&(n.head.comment=null);n.mode=Mm;case Mm:if(n.flags&512){for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.check&65535)){t.msg="header crc mismatch",n.mode=ke;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Ei;break;case Um:for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}t.adler=n.check=Xm(l),l=0,u=0,n.mode=ol;case ol:if(n.havedict===0)return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,AT;t.adler=n.check=1,n.mode=Ei;case Ei:if(e===kT||e===il)break t;case Jh:if(n.last){l>>>=u&7,u-=u&7,n.mode=tf;break}for(;u<3;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}switch(n.last=l&1,l>>>=1,u-=1,l&3){case 0:n.mode=Fm;break;case 1:if(LT(n),n.mode=al,e===il){l>>>=2,u-=2;break t}break;case 2:n.mode=Pm;break;case 3:t.msg="invalid block type",n.mode=ke}l>>>=2,u-=2;break;case Fm:for(l>>>=u&7,u-=u&7;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if((l&65535)!==(l>>>16^65535)){t.msg="invalid stored block lengths",n.mode=ke;break}if(n.length=l&65535,l=0,u=0,n.mode=Qh,e===il)break t;case Qh:n.mode=Bm;case Bm:if(h=n.length,h){if(h>a&&(h=a),h>c&&(h=c),h===0)break t;i.set(r.subarray(s,s+h),o),a-=h,s+=h,c-=h,o+=h,n.length-=h;break}n.mode=Ei;break;case Pm:for(;u<14;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.nlen=(l&31)+257,l>>>=5,u-=5,n.ndist=(l&31)+1,l>>>=5,u-=5,n.ncode=(l&15)+4,l>>>=4,u-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=ke;break}n.have=0,n.mode=Dm;case Dm:for(;n.have<n.ncode;){for(;u<3;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.lens[L[n.have++]]=l&7,l>>>=3,u-=3}for(;n.have<19;)n.lens[L[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,P={bits:n.lenbits},U=Fa(vT,n.lens,0,19,n.lencode,0,n.work,P),n.lenbits=P.bits,U){t.msg="invalid code lengths set",n.mode=ke;break}n.have=0,n.mode=$m;case $m:for(;n.have<n.nlen+n.ndist;){for(;b=n.lencode[l&(1<<n.lenbits)-1],_=b>>>24,v=b>>>16&255,T=b&65535,!(_<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(T<16)l>>>=_,u-=_,n.lens[n.have++]=T;else{if(T===16){for(W=_+2;u<W;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(l>>>=_,u-=_,n.have===0){t.msg="invalid bit length repeat",n.mode=ke;break}S=n.lens[n.have-1],h=3+(l&3),l>>>=2,u-=2}else if(T===17){for(W=_+3;u<W;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=_,u-=_,S=0,h=3+(l&7),l>>>=3,u-=3}else{for(W=_+7;u<W;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=_,u-=_,S=0,h=11+(l&127),l>>>=7,u-=7}if(n.have+h>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=ke;break}for(;h--;)n.lens[n.have++]=S}}if(n.mode===ke)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=ke;break}if(n.lenbits=9,P={bits:n.lenbits},U=Fa(xm,n.lens,0,n.nlen,n.lencode,0,n.work,P),n.lenbits=P.bits,U){t.msg="invalid literal/lengths set",n.mode=ke;break}if(n.distbits=6,n.distcode=n.distdyn,P={bits:n.distbits},U=Fa(Em,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,P),n.distbits=P.bits,U){t.msg="invalid distances set",n.mode=ke;break}if(n.mode=al,e===il)break t;case al:n.mode=cl;case cl:if(a>=6&&c>=258){t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,yT(t,f),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,n.mode===Ei&&(n.back=-1);break}for(n.back=0;b=n.lencode[l&(1<<n.lenbits)-1],_=b>>>24,v=b>>>16&255,T=b&65535,!(_<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(v&&!(v&240)){for(A=_,C=v,R=T;b=n.lencode[R+((l&(1<<A+C)-1)>>A)],_=b>>>24,v=b>>>16&255,T=b&65535,!(A+_<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=A,u-=A,n.back+=A}if(l>>>=_,u-=_,n.back+=_,n.length=T,v===0){n.mode=Hm;break}if(v&32){n.back=-1,n.mode=Ei;break}if(v&64){t.msg="invalid literal/length code",n.mode=ke;break}n.extra=v&15,n.mode=jm;case jm:if(n.extra){for(W=n.extra;u<W;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=zm;case zm:for(;b=n.distcode[l&(1<<n.distbits)-1],_=b>>>24,v=b>>>16&255,T=b&65535,!(_<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(!(v&240)){for(A=_,C=v,R=T;b=n.distcode[R+((l&(1<<A+C)-1)>>A)],_=b>>>24,v=b>>>16&255,T=b&65535,!(A+_<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=A,u-=A,n.back+=A}if(l>>>=_,u-=_,n.back+=_,v&64){t.msg="invalid distance code",n.mode=ke;break}n.offset=T,n.extra=v&15,n.mode=Km;case Km:if(n.extra){for(W=n.extra;u<W;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=ke;break}n.mode=Wm;case Wm:if(c===0)break t;if(h=f-c,n.offset>h){if(h=n.offset-h,h>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=ke;break}h>n.wnext?(h-=n.wnext,p=n.wsize-h):p=n.wnext-h,h>n.length&&(h=n.length),m=n.window}else m=i,p=o-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do i[o++]=m[p++];while(--h);n.length===0&&(n.mode=cl);break;case Hm:if(c===0)break t;i[o++]=n.length,c--,n.mode=cl;break;case tf:if(n.wrap){for(;u<32;){if(a===0)break t;a--,l|=r[s++]<<u,u+=8}if(f-=c,t.total_out+=f,n.total+=f,n.wrap&4&&f&&(t.adler=n.check=n.flags?an(n.check,i,f,o-f):Ra(n.check,i,f,o-f)),f=c,n.wrap&4&&(n.flags?l:Xm(l))!==n.check){t.msg="incorrect data check",n.mode=ke;break}l=0,u=0}n.mode=Gm;case Gm:if(n.wrap&&n.flags){for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.total&4294967295)){t.msg="incorrect length check",n.mode=ke;break}l=0,u=0}n.mode=Ym;case Ym:U=TT;break t;case ke:U=km;break t;case Vm:return Tm;case Zm:default:return mr}return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,(n.wsize||f!==t.avail_out&&n.mode<ke&&(n.mode<tf||e!==vm))&&ng(t,t.output,t.next_out,f-t.avail_out),d-=t.avail_in,f-=t.avail_out,t.total_in+=d,t.total_out+=f,n.total+=f,n.wrap&4&&f&&(t.adler=n.check=n.flags?an(n.check,i,f,t.next_out-f):Ra(n.check,i,f,t.next_out-f)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Ei?128:0)+(n.mode===al||n.mode===Qh?256:0),(d===0&&f===0||e===vm)&&U===Ms&&(U=RT),U},UT=t=>{if(Us(t))return mr;let e=t.state;return e.window&&(e.window=null),t.state=null,Ms},FT=(t,e)=>{if(Us(t))return mr;const n=t.state;return n.wrap&2?(n.head=e,e.done=!1,Ms):mr},BT=(t,e)=>{const n=e.length;let r,i,s;return Us(t)||(r=t.state,r.wrap!==0&&r.mode!==ol)?mr:r.mode===ol&&(i=1,i=Ra(i,e,n,0),i!==r.check)?km:(s=ng(t,e,n,n),s?(r.mode=Vm,Tm):(r.havedict=1,Ms))};var PT=Jm,DT=Qm,$T=qm,jT=CT,zT=tg,KT=MT,WT=UT,HT=FT,GT=BT,YT="pako inflate (from Nodeca project)",vi={inflateReset:PT,inflateReset2:DT,inflateResetKeep:$T,inflateInit:jT,inflateInit2:zT,inflate:KT,inflateEnd:WT,inflateGetHeader:HT,inflateSetDictionary:GT,inflateInfo:YT};function VT(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var ZT=VT;const rg=Object.prototype.toString,{Z_NO_FLUSH:XT,Z_FINISH:qT,Z_OK:Ba,Z_STREAM_END:rf,Z_NEED_DICT:sf,Z_STREAM_ERROR:JT,Z_DATA_ERROR:ig,Z_MEM_ERROR:QT}=Is;function Pa(t){this.options=el.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new mm,this.strm.avail_out=0;let n=vi.inflateInit2(this.strm,e.windowBits);if(n!==Ba)throw new Error(Os[n]);if(this.header=new ZT,vi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Ma.string2buf(e.dictionary):rg.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=vi.inflateSetDictionary(this.strm,e.dictionary),n!==Ba)))throw new Error(Os[n])}Pa.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?qT:XT,rg.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=vi.inflate(n,o),s===sf&&i&&(s=vi.inflateSetDictionary(n,i),s===Ba?s=vi.inflate(n,o):s===ig&&(s=sf));n.avail_in>0&&s===rf&&n.state.wrap>0&&t[n.next_in]!==0;)vi.inflateReset(n),s=vi.inflate(n,o);switch(s){case JT:case ig:case sf:case QT:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(n.avail_out===0||s===rf))if(this.options.to==="string"){let c=Ma.utf8border(n.output,n.next_out),l=n.next_out-c,u=Ma.buf2string(n.output,c);n.next_out=l,n.avail_out=r-l,l&&n.output.set(n.output.subarray(c,c+l),0),this.onData(u)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(s===Ba&&a===0)){if(s===rf)return s=vi.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Pa.prototype.onData=function(t){this.chunks.push(t)},Pa.prototype.onEnd=function(t){t===Ba&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=el.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function of(t,e){const n=new Pa(e);if(n.push(t),n.err)throw n.msg||Os[n.err];return n.result}function tA(t,e){return e=e||{},e.raw=!0,of(t,e)}var eA=Pa,nA=of,rA=tA,iA=of,sA=Is,oA={Inflate:eA,inflate:nA,inflateRaw:rA,ungzip:iA,constants:sA};const{Deflate:aA,deflate:cA,deflateRaw:lA,gzip:uA}=gT,{Inflate:hA,inflate:fA,inflateRaw:dA,ungzip:pA}=oA;var mA=aA,gA=cA,_A=lA,yA=uA,bA=hA,wA=fA,xA=dA,EA=pA,vA=Is,kA={Deflate:mA,deflate:gA,deflateRaw:_A,gzip:yA,Inflate:bA,inflate:wA,inflateRaw:xA,ungzip:EA,constants:vA};function sg(t){let e=t.r.toString(16),n=t.g.toString(16),r=t.b.toString(16);return e.length<2&&(e="0"+e),n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),e+n+r}const TA=t=>new Promise((e,n)=>{try{const r=kA.inflate(t),i=AA(r);e(i)}catch(r){n(r)}}),AA=t=>{const e=new DataView(t.buffer),n={version:e.getUint32(0,!0),layers:[]},r=e.getUint32(4,!0);let i=8;for(let s=0;s<r;s++){const o={width:0,height:0,raster:[]};o.width=e.getUint32(i,!0),i+=4,o.height=e.getUint32(i,!0),i+=4,o.raster=Array(o.height*o.width);for(let a=0;a<o.width;a++)for(let c=0;c<o.height;c++){const l={asciiCode:e.getUint32(i,!0),transparent:!1,color:{r:0,g:0,b:0,hex:""},bg:{r:0,g:0,b:0,hex:""}};i+=4,l.color.r=e.getUint8(i++),l.color.g=e.getUint8(i++),l.color.b=e.getUint8(i++),l.color.hex=sg(l.color),l.bg.r=e.getUint8(i++),l.bg.g=e.getUint8(i++),l.bg.b=e.getUint8(i++),l.bg.hex=sg(l.bg),l.transparent=l.bg.r===255&&l.bg.g===0&&l.bg.b===255,o.raster[a+o.width*c]=l}n.layers.push(o)}return n};function RA(t){return typeof t=="object"&&gt(t.session)&&gt(t.player)&&gt(t.id)&&gt(t.sender)&&gt(t.target)}function de(t,e,n,...r){return t.emit(e,"error",[`$red${n}$blue>>`,...r]),!1}function SA(t,e,...n){return t.emit(e,"info",n),!0}function pe(t,e,...n){return t.emit(e,"log",n),!0}function OA(t,e,n){t.emit(e,"toast",n)}function IA(t,e,n){t.emit(e,"bridge:streamstart",n)}function NA(t,e){t.emit(e,"bridge:streamstop",void 0)}function CA(t,e,n){t.emit(e,"bridge:chatstart",n)}function LA(t,e){t.emit(e,"bridge:chatstop")}function MA(t,e,n,r,i,s,o){t.emit(e,"bridge:fetch",[n,r,i,s,o])}function UA(t,e){t.emit(e,"bridge:talkstart",e)}function FA(t,e){t.emit(e,"bridge:talkstop",e)}function BA(t,e){t.emit(e,"bridge:mediastart",e)}function PA(t,e){t.emit(e,"bridge:mediastop",e)}function DA(t,e,n){t.emit(e,"bridge:start",n)}function $A(t,e,n){t.emit(e,"bridge:tab",n)}function jA(t,e,n){t.emit(e,"gadgetclient:paint",n)}function zA(t,e,n){t.emit(e,"gadgetclient:patch",n)}function KA(t,e){t.emit(e,"gadgetserver:clearscroll")}function WA(t){t.emit("","ready")}function og(t,e){t.emit(e,"register:loginfail")}function af(t,e){t.emit(e,"register:loginready",!0)}function HA(t,e,n,r){t.emit(e,"register:savemem",[n,r])}function GA(t,e,n){t.emit(e,"register:forkmem",[n])}function cf(t,e,n){t.emit(e,"register:copy",n)}function YA(t,e,n,r){t.emit(e,"register:copyjsonfile",[n,r])}function ag(t,e,n,r){t.emit(e,"register:downloadjsonfile",[n,r])}function VA(t,e){t.emit(e,"register:dev",void 0)}function ZA(t,e){t.emit(e,"register:share",void 0)}function XA(t,e){t.emit(e,"register:nuke",void 0)}function qA(t,e){t.emit(e,"register:enterar",void 0)}function JA(t,e,n,r){t.emit(e,"synth:tts",[n,r])}function QA(t,e,n,r,i){t.emit(e,"synth:play",[n,r,i])}function tR(t,e,n){t.emit(e,"synth:focus",n)}function eR(t,e,n){t.emit(e,"synth:bpm",n)}function nR(t,e,n){t.emit(e,"synth:playvolume",n)}function rR(t,e,n){t.emit(e,"synth:bgplayvolume",n)}function iR(t,e,n){t.emit(e,"synth:ttsvolume",n)}function lf(t,e,n,r,i){t.emit(e,"synth:voice",[n,r,i])}function cg(t,e,n,r,i,s){t.emit(e,"synth:voicefx",[n,r,i,s])}function sR(t,e,n,r){t.emit(e,"register:config",[n,r])}function oR(t,e){t.emit(e,"register:configshow")}function aR(t,e){t.emit(e,"register:inspector")}function lg(t,e,n,r,i,s){t.emit(e,"register:editor:open",[n,r,i,s])}function cR(t,e){t.emit(e,"vm:local")}function ug(t,e){t.emit(e,"vm:logout")}function ll(t,e){const[n,r]=e;return`${t}:${[n,r].filter(x).join(":")}`}function lR(t,e,n){t.emit(e,"vm:cli",n)}function uR(t,e){t.emit(e,"vm:restart")}function hg(t,e){t.emit(e,"vm:flush")}function hR(t,e){t.emit(e,"vm:fork")}function fR(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function dR(t,e){return{filename:t,json:e}}function pR(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function mR(t,e){const n={filename:t,cursor:0,content:void 0};return TA(e).then(r=>{n.content=r}).catch(()=>{}),n}function Da(t,e,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=fR(i,s);break;case"json":o=dR(i,s);break;case"binary":o=pR(i,s);break;case"rexpaint":o=mR(i,s);break}setTimeout(()=>{t.emit(e,"vm:loader",[n,r,i,o])},1)}function gR(t){const e=new Set;function n(s){RA(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),Jn.invoke(s))}const r=ho("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){Jn.disconnect(r)}return{forward:n,disconnect:i}}function _R(t){switch(t.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const e=tr(t.target);switch(e.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const uf=66.666,ul=Math.round(1e3/uf),fg=3;function dg(t){return new Promise(e=>setTimeout(e,t))}const hf=ho("clock");let ff=0,hl=0,df=0,pg=performance.now();function mg(){const t=performance.now(),e=t-pg;df+=e,df>=uf&&(df%=uf,hf.emit("","tick",hl),hf.emit("","tock",hl),++ff,++hl,ff>=ul&&(ff%=ul,hf.emit("","second",hl))),pg=t,setTimeout(mg,2)}mg();function yR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var gg={exports:{}},ze=gg.exports={},Xr,qr;function pf(){throw new Error("setTimeout has not been defined")}function mf(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Xr=setTimeout:Xr=pf}catch{Xr=pf}try{typeof clearTimeout=="function"?qr=clearTimeout:qr=mf}catch{qr=mf}})();function _g(t){if(Xr===setTimeout)return setTimeout(t,0);if((Xr===pf||!Xr)&&setTimeout)return Xr=setTimeout,setTimeout(t,0);try{return Xr(t,0)}catch{try{return Xr.call(null,t,0)}catch{return Xr.call(this,t,0)}}}function bR(t){if(qr===clearTimeout)return clearTimeout(t);if((qr===mf||!qr)&&clearTimeout)return qr=clearTimeout,clearTimeout(t);try{return qr(t)}catch{try{return qr.call(null,t)}catch{return qr.call(this,t)}}}var ki=[],xo=!1,Fs,fl=-1;function wR(){!xo||!Fs||(xo=!1,Fs.length?ki=Fs.concat(ki):fl=-1,ki.length&&yg())}function yg(){if(!xo){var t=_g(wR);xo=!0;for(var e=ki.length;e;){for(Fs=ki,ki=[];++fl<e;)Fs&&Fs[fl].run();fl=-1,e=ki.length}Fs=null,xo=!1,bR(t)}}ze.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];ki.push(new bg(t,e)),ki.length===1&&!xo&&_g(yg)};function bg(t,e){this.fun=t,this.array=e}bg.prototype.run=function(){this.fun.apply(null,this.array)},ze.title="browser",ze.browser=!0,ze.env={},ze.argv=[],ze.version="",ze.versions={};function Ti(){}ze.on=Ti,ze.addListener=Ti,ze.once=Ti,ze.off=Ti,ze.removeListener=Ti,ze.removeAllListeners=Ti,ze.emit=Ti,ze.prependListener=Ti,ze.prependOnceListener=Ti,ze.listeners=function(t){return[]},ze.binding=function(t){throw new Error("process.binding is not supported")},ze.cwd=function(){return"/"},ze.chdir=function(t){throw new Error("process.chdir is not supported")},ze.umask=function(){return 0};var xR=gg.exports;const Ir=yR(xR);var Kt={},gf=Symbol.for("react.transitional.element"),ER=Symbol.for("react.portal"),vR=Symbol.for("react.fragment"),kR=Symbol.for("react.strict_mode"),TR=Symbol.for("react.profiler"),AR=Symbol.for("react.consumer"),RR=Symbol.for("react.context"),SR=Symbol.for("react.forward_ref"),OR=Symbol.for("react.suspense"),IR=Symbol.for("react.memo"),wg=Symbol.for("react.lazy"),xg=Symbol.iterator;function NR(t){return t===null||typeof t!="object"?null:(t=xg&&t[xg]||t["@@iterator"],typeof t=="function"?t:null)}var Eg={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},vg=Object.assign,kg={};function Eo(t,e,n){this.props=t,this.context=e,this.refs=kg,this.updater=n||Eg}Eo.prototype.isReactComponent={},Eo.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},Eo.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Tg(){}Tg.prototype=Eo.prototype;function _f(t,e,n){this.props=t,this.context=e,this.refs=kg,this.updater=n||Eg}var yf=_f.prototype=new Tg;yf.constructor=_f,vg(yf,Eo.prototype),yf.isPureReactComponent=!0;var Ag=Array.isArray,Te={H:null,A:null,T:null,S:null,V:null},Rg=Object.prototype.hasOwnProperty;function bf(t,e,n,r,i,s){return n=s.ref,{$$typeof:gf,type:t,key:e,ref:n!==void 0?n:null,props:s}}function CR(t,e){return bf(t.type,e,void 0,void 0,void 0,t.props)}function wf(t){return typeof t=="object"&&t!==null&&t.$$typeof===gf}function LR(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Sg=/\/+/g;function xf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?LR(""+t.key):e.toString(36)}function Og(){}function MR(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(Og,Og):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function vo(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case gf:case ER:o=!0;break;case wg:return o=t._init,vo(o(t._payload),e,n,r,i)}}if(o)return i=i(t),o=r===""?"."+xf(t,0):r,Ag(i)?(n="",o!=null&&(n=o.replace(Sg,"$&/")+"/"),vo(i,e,n,"",function(l){return l})):i!=null&&(wf(i)&&(i=CR(i,n+(i.key==null||t&&t.key===i.key?"":(""+i.key).replace(Sg,"$&/")+"/")+o)),e.push(i)),1;o=0;var a=r===""?".":r+":";if(Ag(t))for(var c=0;c<t.length;c++)r=t[c],s=a+xf(r,c),o+=vo(r,e,n,s,i);else if(c=NR(t),typeof c=="function")for(t=c.call(t),c=0;!(r=t.next()).done;)r=r.value,s=a+xf(r,c++),o+=vo(r,e,n,s,i);else if(s==="object"){if(typeof t.then=="function")return vo(MR(t),e,n,r,i);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return o}function dl(t,e,n){if(t==null)return t;var r=[],i=0;return vo(t,r,"","",function(s){return e.call(n,s,i++)}),r}function UR(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ig=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof Ir=="object"&&typeof Ir.emit=="function"){Ir.emit("uncaughtException",t);return}console.error(t)};function FR(){}Kt.Children={map:dl,forEach:function(t,e,n){dl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return dl(t,function(){e++}),e},toArray:function(t){return dl(t,function(e){return e})||[]},only:function(t){if(!wf(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},Kt.Component=Eo,Kt.Fragment=vR,Kt.Profiler=TR,Kt.PureComponent=_f,Kt.StrictMode=kR,Kt.Suspense=OR,Kt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Te,Kt.__COMPILER_RUNTIME={__proto__:null,c:function(t){return Te.H.useMemoCache(t)}},Kt.cache=function(t){return function(){return t.apply(null,arguments)}},Kt.cloneElement=function(t,e,n){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var r=vg({},t.props),i=t.key,s=void 0;if(e!=null)for(o in e.ref!==void 0&&(s=void 0),e.key!==void 0&&(i=""+e.key),e)!Rg.call(e,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&e.ref===void 0||(r[o]=e[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return bf(t.type,i,void 0,void 0,s,r)},Kt.createContext=function(t){return t={$$typeof:RR,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:AR,_context:t},t},Kt.createElement=function(t,e,n){var r,i={},s=null;if(e!=null)for(r in e.key!==void 0&&(s=""+e.key),e)Rg.call(e,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return bf(t,s,void 0,void 0,null,i)},Kt.createRef=function(){return{current:null}},Kt.forwardRef=function(t){return{$$typeof:SR,render:t}},Kt.isValidElement=wf,Kt.lazy=function(t){return{$$typeof:wg,_payload:{_status:-1,_result:t},_init:UR}},Kt.memo=function(t,e){return{$$typeof:IR,type:t,compare:e===void 0?null:e}},Kt.startTransition=function(t){var e=Te.T,n={};Te.T=n;try{var r=t(),i=Te.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(FR,Ig)}catch(s){Ig(s)}finally{Te.T=e}},Kt.unstable_useCacheRefresh=function(){return Te.H.useCacheRefresh()},Kt.use=function(t){return Te.H.use(t)},Kt.useActionState=function(t,e,n){return Te.H.useActionState(t,e,n)},Kt.useCallback=function(t,e){return Te.H.useCallback(t,e)},Kt.useContext=function(t){return Te.H.useContext(t)},Kt.useDebugValue=function(){},Kt.useDeferredValue=function(t,e){return Te.H.useDeferredValue(t,e)},Kt.useEffect=function(t,e,n){var r=Te.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(t,e)},Kt.useId=function(){return Te.H.useId()},Kt.useImperativeHandle=function(t,e,n){return Te.H.useImperativeHandle(t,e,n)},Kt.useInsertionEffect=function(t,e){return Te.H.useInsertionEffect(t,e)},Kt.useLayoutEffect=function(t,e){return Te.H.useLayoutEffect(t,e)},Kt.useMemo=function(t,e){return Te.H.useMemo(t,e)},Kt.useOptimistic=function(t,e){return Te.H.useOptimistic(t,e)},Kt.useReducer=function(t,e,n){return Te.H.useReducer(t,e,n)},Kt.useRef=function(t){return Te.H.useRef(t)},Kt.useState=function(t){return Te.H.useState(t)},Kt.useSyncExternalStore=function(t,e,n){return Te.H.useSyncExternalStore(t,e,n)},Kt.useTransition=function(){return Te.H.useTransition()},Kt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Ng="0123456789abcdef",Cg=[],pl=[];for(let t=0;t<256;t++)Cg[t]=Ng[t>>4&15]+Ng[t&15],t<16&&(t<10?pl[48+t]=t:pl[87+t]=t);const Lg=t=>{const e=t.length;let n="",r=0;for(;r<e;)n+=Cg[t[r++]];return n},ml=t=>{const e=t.length>>1,n=e<<1,r=new Uint8Array(e);let i=0,s=0;for(;s<n;)r[i++]=pl[t.charCodeAt(s++)]<<4|pl[t.charCodeAt(s++)];return r};for(var Mg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",BR=typeof Uint8Array>"u"?[]:new Uint8Array(256),gl=0;gl<Mg.length;gl++)BR[Mg.charCodeAt(gl)]=gl;new TextDecoder,new TextEncoder;const Ug=typeof window<"u"?window:self,Fg=Ug.crypto||Ug.msCrypto||{};Fg.subtle||Fg.webkitSubtle;const ko=globalThis||void 0||self,Nr=()=>new Map,Ef=t=>{const e=Nr();return t.forEach((n,r)=>{e.set(r,n)}),e},Qi=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},PR=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},DR=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},To=()=>new Set,vf=t=>t[t.length-1],$R=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Bs=Array.from,jR=Array.isArray;class zR{constructor(){this._observers=Nr()}on(e,n){return Qi(this._observers,e,To).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Bs((this._observers.get(e)||Nr()).values()).forEach(r=>r(...n))}destroy(){this._observers=Nr()}}const ts=Math.floor,_l=Math.abs,Bg=(t,e)=>t<e?t:e,Ps=(t,e)=>t>e?t:e,Pg=t=>t!==0?t<0:1/t<0,Dg=1,$g=2,kf=4,Tf=8,$a=32,Ai=64,rr=128,yl=31,Af=63,Ds=127,KR=2147483647,jg=Number.MAX_SAFE_INTEGER,WR=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&ts(t)===t),HR=t=>t.toLowerCase(),GR=/^\s*/g,YR=t=>t.replace(GR,""),VR=/([A-Z])/g,zg=(t,e)=>YR(t.replace(VR,n=>`${e}${HR(n)}`)),ZR=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},ja=typeof TextEncoder<"u"?new TextEncoder:null,XR=ja?t=>ja.encode(t):ZR;let za=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});za&&za.decode(new Uint8Array).length===1&&(za=null);class Ka{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const bl=()=>new Ka,qR=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Jr=t=>{const e=new Uint8Array(qR(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},JR=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(Ps(n,e)*2),t.cpos=0)},cn=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},Rf=cn,ne=(t,e)=>{for(;e>Ds;)cn(t,rr|Ds&e),e=ts(e/128);cn(t,Ds&e)},Sf=(t,e)=>{const n=Pg(e);for(n&&(e=-e),cn(t,(e>Af?rr:0)|(n?Ai:0)|Af&e),e=ts(e/64);e>0;)cn(t,(e>Ds?rr:0)|Ds&e),e=ts(e/128)},Of=new Uint8Array(3e4),QR=Of.length/3,tS=(t,e)=>{if(e.length<QR){const n=ja.encodeInto(e,Of).written||0;ne(t,n);for(let r=0;r<n;r++)cn(t,Of[r])}else ir(t,XR(e))},eS=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;ne(t,r);for(let i=0;i<r;i++)cn(t,n.codePointAt(i))},Ao=ja&&ja.encodeInto?tS:eS,wl=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Bg(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(Ps(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},ir=(t,e)=>{ne(t,e.byteLength),wl(t,e)},If=(t,e)=>{JR(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},nS=(t,e)=>If(t,4).setFloat32(0,e,!1),rS=(t,e)=>If(t,8).setFloat64(0,e,!1),iS=(t,e)=>If(t,8).setBigInt64(0,e,!1),Kg=new DataView(new ArrayBuffer(4)),sS=t=>(Kg.setFloat32(0,t),Kg.getFloat32(0)===t),Wa=(t,e)=>{switch(typeof e){case"string":cn(t,119),Ao(t,e);break;case"number":WR(e)&&_l(e)<=KR?(cn(t,125),Sf(t,e)):sS(e)?(cn(t,124),nS(t,e)):(cn(t,123),rS(t,e));break;case"bigint":cn(t,122),iS(t,e);break;case"object":if(e===null)cn(t,126);else if(jR(e)){cn(t,117),ne(t,e.length);for(let n=0;n<e.length;n++)Wa(t,e[n])}else if(e instanceof Uint8Array)cn(t,116),ir(t,e);else{cn(t,118);const n=Object.keys(e);ne(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];Ao(t,i),Wa(t,e[i])}}break;case"boolean":cn(t,e?120:121);break;default:cn(t,127)}};class Wg extends Ka{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ne(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Hg=t=>{t.count>0&&(Sf(t.encoder,t.count===1?t.s:-t.s),t.count>1&&ne(t.encoder,t.count-2))};class xl{constructor(){this.encoder=new Ka,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Hg(this),this.count=1,this.s=e)}toUint8Array(){return Hg(this),Jr(this.encoder)}}const Gg=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Sf(t.encoder,e),t.count>1&&ne(t.encoder,t.count-2)}};class Nf{constructor(){this.encoder=new Ka,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Gg(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Gg(this),Jr(this.encoder)}}class oS{constructor(){this.sarr=[],this.s="",this.lensE=new xl}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Ka;return this.sarr.push(this.s),this.s="",Ao(e,this.sarr.join("")),wl(e,this.lensE.toUint8Array()),Jr(e)}}const es=t=>new Error(t),Qr=()=>{throw es("Method unimplemented")},ti=()=>{throw es("Unexpected case")},Yg=es("Unexpected end of array"),Vg=es("Integer out of Range");class El{constructor(e){this.arr=e,this.pos=0}}const Ro=t=>new El(t),aS=t=>t.pos!==t.arr.length,cS=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},sr=t=>cS(t,Wt(t)),So=t=>t.arr[t.pos++],Wt=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&Ds)*n,n*=128,i<rr)return e;if(e>jg)throw Vg}throw Yg},Cf=t=>{let e=t.arr[t.pos++],n=e&Af,r=64;const i=(e&Ai)>0?-1:1;if(!(e&rr))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&Ds)*r,r*=128,e<rr)return i*n;if(n>jg)throw Vg}throw Yg},Oo=za?t=>za.decode(sr(t)):t=>{let e=Wt(t);if(e===0)return"";{let n=String.fromCodePoint(So(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(So(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},Lf=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},lS=[t=>{},t=>null,Cf,t=>Lf(t,4).getFloat32(0,!1),t=>Lf(t,8).getFloat64(0,!1),t=>Lf(t,8).getBigInt64(0,!1),t=>!1,t=>!0,Oo,t=>{const e=Wt(t),n={};for(let r=0;r<e;r++){const i=Oo(t);n[i]=Ha(t)}return n},t=>{const e=Wt(t),n=[];for(let r=0;r<e;r++)n.push(Ha(t));return n},sr],Ha=t=>lS[127-So(t)](t);class Zg extends El{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),aS(this)?this.count=Wt(this)+1:this.count=-1),this.count--,this.s}}class vl extends El{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Cf(this);const e=Pg(this.s);this.count=1,e&&(this.s=-this.s,this.count=Wt(this)+2)}return this.count--,this.s}}class Mf extends El{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Cf(this),n=e&1;this.diff=ts(e/2),this.count=1,n&&(this.count=Wt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class uS{constructor(e){this.decoder=new vl(e),this.str=Oo(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const hS=crypto.getRandomValues.bind(crypto),Xg=()=>hS(new Uint32Array(1))[0],fS="10000000-1000-4000-8000"+-1e11,dS=()=>fS.replace(/[018]/g,t=>(t^Xg()&15>>t/4).toString(16)),qg=t=>new Promise(t);Promise.all.bind(Promise);var Jg={},kl={};kl.byteLength=gS,kl.toByteArray=yS,kl.fromByteArray=xS;for(var ei=[],gr=[],pS=typeof Uint8Array<"u"?Uint8Array:Array,Uf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Io=0,mS=Uf.length;Io<mS;++Io)ei[Io]=Uf[Io],gr[Uf.charCodeAt(Io)]=Io;gr[45]=62,gr[95]=63;function Qg(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function gS(t){var e=Qg(t),n=e[0],r=e[1];return(n+r)*3/4-r}function _S(t,e,n){return(e+n)*3/4-n}function yS(t){var e,n=Qg(t),r=n[0],i=n[1],s=new pS(_S(t,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=gr[t.charCodeAt(c)]<<18|gr[t.charCodeAt(c+1)]<<12|gr[t.charCodeAt(c+2)]<<6|gr[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=gr[t.charCodeAt(c)]<<2|gr[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=gr[t.charCodeAt(c)]<<10|gr[t.charCodeAt(c+1)]<<4|gr[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function bS(t){return ei[t>>18&63]+ei[t>>12&63]+ei[t>>6&63]+ei[t&63]}function wS(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(bS(r));return i.join("")}function xS(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(wS(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(ei[e>>2]+ei[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(ei[e>>10]+ei[e>>4&63]+ei[e<<2&63]+"=")),i.join("")}var Ff={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ff.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,d=n?i-1:0,f=n?-1:1,h=t[e+d];for(d+=f,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+t[e+d],d+=f,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+t[e+d],d+=f,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)},Ff.write=function(t,e,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,d=u>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,p=r?1:-1,m=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+d>=1?e+=f/c:e+=f*Math.pow(2,1-d),e*c>=2&&(o++,c/=2),o+d>=u?(a=0,o=u):o+d>=1?(a=(e*c-1)*Math.pow(2,i),o=o+d):(a=e*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;t[n+h]=a&255,h+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[n+h]=o&255,h+=p,o/=256,l-=8);t[n+h-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=kl,n=Ff,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=C,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const O=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(O,g),O.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(O){if(O>i)throw new RangeError('The value "'+O+'" is invalid for option "size"');const g=new s(O);return Object.setPrototypeOf(g,u.prototype),g}function u(O,g,y){if(typeof O=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(O)}return d(O,g,y)}u.poolSize=8192;function d(O,g,y){if(typeof O=="string")return m(O,g);if(o.isView(O))return _(O);if(O==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O);if(pt(O,o)||O&&pt(O.buffer,o)||typeof a<"u"&&(pt(O,a)||O&&pt(O.buffer,a)))return v(O,g,y);if(typeof O=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const M=O.valueOf&&O.valueOf();if(M!=null&&M!==O)return u.from(M,g,y);const z=T(O);if(z)return z;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof O[Symbol.toPrimitive]=="function")return u.from(O[Symbol.toPrimitive]("string"),g,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O)}u.from=function(O,g,y){return d(O,g,y)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function f(O){if(typeof O!="number")throw new TypeError('"size" argument must be of type number');if(O<0)throw new RangeError('The value "'+O+'" is invalid for option "size"')}function h(O,g,y){return f(O),O<=0?l(O):g!==void 0?typeof y=="string"?l(O).fill(g,y):l(O).fill(g):l(O)}u.alloc=function(O,g,y){return h(O,g,y)};function p(O){return f(O),l(O<0?0:A(O)|0)}u.allocUnsafe=function(O){return p(O)},u.allocUnsafeSlow=function(O){return p(O)};function m(O,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const y=R(O,g)|0;let M=l(y);const z=M.write(O,g);return z!==y&&(M=M.slice(0,z)),M}function b(O){const g=O.length<0?0:A(O.length)|0,y=l(g);for(let M=0;M<g;M+=1)y[M]=O[M]&255;return y}function _(O){if(pt(O,s)){const g=new s(O);return v(g.buffer,g.byteOffset,g.byteLength)}return b(O)}function v(O,g,y){if(g<0||O.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(O.byteLength<g+(y||0))throw new RangeError('"length" is outside of buffer bounds');let M;return g===void 0&&y===void 0?M=new s(O):y===void 0?M=new s(O,g):M=new s(O,g,y),Object.setPrototypeOf(M,u.prototype),M}function T(O){if(u.isBuffer(O)){const g=A(O.length)|0,y=l(g);return y.length===0||O.copy(y,0,0,g),y}if(O.length!==void 0)return typeof O.length!="number"||St(O.length)?l(0):b(O);if(O.type==="Buffer"&&Array.isArray(O.data))return b(O.data)}function A(O){if(O>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return O|0}function C(O){return+O!=O&&(O=0),u.alloc(+O)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,y){if(pt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),pt(y,s)&&(y=u.from(y,y.offset,y.byteLength)),!u.isBuffer(g)||!u.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===y)return 0;let M=g.length,z=y.length;for(let Q=0,it=Math.min(M,z);Q<it;++Q)if(g[Q]!==y[Q]){M=g[Q],z=y[Q];break}return M<z?-1:z<M?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,y){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let M;if(y===void 0)for(y=0,M=0;M<g.length;++M)y+=g[M].length;const z=u.allocUnsafe(y);let Q=0;for(M=0;M<g.length;++M){let it=g[M];if(pt(it,s))Q+it.length>z.length?(u.isBuffer(it)||(it=u.from(it)),it.copy(z,Q)):s.prototype.set.call(z,it,Q);else if(u.isBuffer(it))it.copy(z,Q);else throw new TypeError('"list" argument must be an Array of Buffers');Q+=it.length}return z};function R(O,g){if(u.isBuffer(O))return O.length;if(o.isView(O)||pt(O,o))return O.byteLength;if(typeof O!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof O);const y=O.length,M=arguments.length>2&&arguments[2]===!0;if(!M&&y===0)return 0;let z=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return ct(O).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return mt(O).length;default:if(z)return M?-1:ct(O).length;g=(""+g).toLowerCase(),z=!0}}u.byteLength=R;function S(O,g,y){let M=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,g>>>=0,y<=g))return"";for(O||(O="utf8");;)switch(O){case"hex":return H(this,g,y);case"utf8":case"utf-8":return $(this,g,y);case"ascii":return at(this,g,y);case"latin1":case"binary":return Y(this,g,y);case"base64":return Z(this,g,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return wt(this,g,y);default:if(M)throw new TypeError("Unknown encoding: "+O);O=(O+"").toLowerCase(),M=!0}}u.prototype._isBuffer=!0;function U(O,g,y){const M=O[g];O[g]=O[y],O[y]=M}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<g;y+=2)U(this,y,y+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<g;y+=4)U(this,y,y+3),U(this,y+1,y+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<g;y+=8)U(this,y,y+7),U(this,y+1,y+6),U(this,y+2,y+5),U(this,y+3,y+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?$(this,0,g):S.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const y=t.INSPECT_MAX_BYTES;return g=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,y,M,z,Q){if(pt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(y===void 0&&(y=0),M===void 0&&(M=g?g.length:0),z===void 0&&(z=0),Q===void 0&&(Q=this.length),y<0||M>g.length||z<0||Q>this.length)throw new RangeError("out of range index");if(z>=Q&&y>=M)return 0;if(z>=Q)return-1;if(y>=M)return 1;if(y>>>=0,M>>>=0,z>>>=0,Q>>>=0,this===g)return 0;let it=Q-z,zt=M-y;const Ne=Math.min(it,zt),we=this.slice(z,Q),Ce=g.slice(y,M);for(let he=0;he<Ne;++he)if(we[he]!==Ce[he]){it=we[he],zt=Ce[he];break}return it<zt?-1:zt<it?1:0};function I(O,g,y,M,z){if(O.length===0)return-1;if(typeof y=="string"?(M=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,St(y)&&(y=z?0:O.length-1),y<0&&(y=O.length+y),y>=O.length){if(z)return-1;y=O.length-1}else if(y<0)if(z)y=0;else return-1;if(typeof g=="string"&&(g=u.from(g,M)),u.isBuffer(g))return g.length===0?-1:P(O,g,y,M,z);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?z?s.prototype.indexOf.call(O,g,y):s.prototype.lastIndexOf.call(O,g,y):P(O,[g],y,M,z);throw new TypeError("val must be string, number or Buffer")}function P(O,g,y,M,z){let Q=1,it=O.length,zt=g.length;if(M!==void 0&&(M=String(M).toLowerCase(),M==="ucs2"||M==="ucs-2"||M==="utf16le"||M==="utf-16le")){if(O.length<2||g.length<2)return-1;Q=2,it/=2,zt/=2,y/=2}function Ne(Ce,he){return Q===1?Ce[he]:Ce.readUInt16BE(he*Q)}let we;if(z){let Ce=-1;for(we=y;we<it;we++)if(Ne(O,we)===Ne(g,Ce===-1?0:we-Ce)){if(Ce===-1&&(Ce=we),we-Ce+1===zt)return Ce*Q}else Ce!==-1&&(we-=we-Ce),Ce=-1}else for(y+zt>it&&(y=it-zt),we=y;we>=0;we--){let Ce=!0;for(let he=0;he<zt;he++)if(Ne(O,we+he)!==Ne(g,he)){Ce=!1;break}if(Ce)return we}return-1}u.prototype.includes=function(g,y,M){return this.indexOf(g,y,M)!==-1},u.prototype.indexOf=function(g,y,M){return I(this,g,y,M,!0)},u.prototype.lastIndexOf=function(g,y,M){return I(this,g,y,M,!1)};function W(O,g,y,M){y=Number(y)||0;const z=O.length-y;M?(M=Number(M),M>z&&(M=z)):M=z;const Q=g.length;M>Q/2&&(M=Q/2);let it;for(it=0;it<M;++it){const zt=parseInt(g.substr(it*2,2),16);if(St(zt))return it;O[y+it]=zt}return it}function L(O,g,y,M){return xt(ct(g,O.length-y),O,y,M)}function N(O,g,y,M){return xt(ft(g),O,y,M)}function E(O,g,y,M){return xt(mt(g),O,y,M)}function D(O,g,y,M){return xt(J(g,O.length-y),O,y,M)}u.prototype.write=function(g,y,M,z){if(y===void 0)z="utf8",M=this.length,y=0;else if(M===void 0&&typeof y=="string")z=y,M=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(M)?(M=M>>>0,z===void 0&&(z="utf8")):(z=M,M=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Q=this.length-y;if((M===void 0||M>Q)&&(M=Q),g.length>0&&(M<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");z||(z="utf8");let it=!1;for(;;)switch(z){case"hex":return W(this,g,y,M);case"utf8":case"utf-8":return L(this,g,y,M);case"ascii":case"latin1":case"binary":return N(this,g,y,M);case"base64":return E(this,g,y,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,g,y,M);default:if(it)throw new TypeError("Unknown encoding: "+z);z=(""+z).toLowerCase(),it=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Z(O,g,y){return g===0&&y===O.length?e.fromByteArray(O):e.fromByteArray(O.slice(g,y))}function $(O,g,y){y=Math.min(O.length,y);const M=[];let z=g;for(;z<y;){const Q=O[z];let it=null,zt=Q>239?4:Q>223?3:Q>191?2:1;if(z+zt<=y){let Ne,we,Ce,he;switch(zt){case 1:Q<128&&(it=Q);break;case 2:Ne=O[z+1],(Ne&192)===128&&(he=(Q&31)<<6|Ne&63,he>127&&(it=he));break;case 3:Ne=O[z+1],we=O[z+2],(Ne&192)===128&&(we&192)===128&&(he=(Q&15)<<12|(Ne&63)<<6|we&63,he>2047&&(he<55296||he>57343)&&(it=he));break;case 4:Ne=O[z+1],we=O[z+2],Ce=O[z+3],(Ne&192)===128&&(we&192)===128&&(Ce&192)===128&&(he=(Q&15)<<18|(Ne&63)<<12|(we&63)<<6|Ce&63,he>65535&&he<1114112&&(it=he))}}it===null?(it=65533,zt=1):it>65535&&(it-=65536,M.push(it>>>10&1023|55296),it=56320|it&1023),M.push(it),z+=zt}return rt(M)}const st=4096;function rt(O){const g=O.length;if(g<=st)return String.fromCharCode.apply(String,O);let y="",M=0;for(;M<g;)y+=String.fromCharCode.apply(String,O.slice(M,M+=st));return y}function at(O,g,y){let M="";y=Math.min(O.length,y);for(let z=g;z<y;++z)M+=String.fromCharCode(O[z]&127);return M}function Y(O,g,y){let M="";y=Math.min(O.length,y);for(let z=g;z<y;++z)M+=String.fromCharCode(O[z]);return M}function H(O,g,y){const M=O.length;(!g||g<0)&&(g=0),(!y||y<0||y>M)&&(y=M);let z="";for(let Q=g;Q<y;++Q)z+=fe[O[Q]];return z}function wt(O,g,y){const M=O.slice(g,y);let z="";for(let Q=0;Q<M.length-1;Q+=2)z+=String.fromCharCode(M[Q]+M[Q+1]*256);return z}u.prototype.slice=function(g,y){const M=this.length;g=~~g,y=y===void 0?M:~~y,g<0?(g+=M,g<0&&(g=0)):g>M&&(g=M),y<0?(y+=M,y<0&&(y=0)):y>M&&(y=M),y<g&&(y=g);const z=this.subarray(g,y);return Object.setPrototypeOf(z,u.prototype),z};function lt(O,g,y){if(O%1!==0||O<0)throw new RangeError("offset is not uint");if(O+g>y)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,y,M){g=g>>>0,y=y>>>0,M||lt(g,y,this.length);let z=this[g],Q=1,it=0;for(;++it<y&&(Q*=256);)z+=this[g+it]*Q;return z},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,y,M){g=g>>>0,y=y>>>0,M||lt(g,y,this.length);let z=this[g+--y],Q=1;for(;y>0&&(Q*=256);)z+=this[g+--y]*Q;return z},u.prototype.readUint8=u.prototype.readUInt8=function(g,y){return g=g>>>0,y||lt(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,y){return g=g>>>0,y||lt(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,y){return g=g>>>0,y||lt(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,y){return g=g>>>0,y||lt(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,y){return g=g>>>0,y||lt(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=$t(function(g){g=g>>>0,et(g,"offset");const y=this[g],M=this[g+7];(y===void 0||M===void 0)&&B(g,this.length-8);const z=y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,Q=this[++g]+this[++g]*2**8+this[++g]*2**16+M*2**24;return BigInt(z)+(BigInt(Q)<<BigInt(32))}),u.prototype.readBigUInt64BE=$t(function(g){g=g>>>0,et(g,"offset");const y=this[g],M=this[g+7];(y===void 0||M===void 0)&&B(g,this.length-8);const z=y*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],Q=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M;return(BigInt(z)<<BigInt(32))+BigInt(Q)}),u.prototype.readIntLE=function(g,y,M){g=g>>>0,y=y>>>0,M||lt(g,y,this.length);let z=this[g],Q=1,it=0;for(;++it<y&&(Q*=256);)z+=this[g+it]*Q;return Q*=128,z>=Q&&(z-=Math.pow(2,8*y)),z},u.prototype.readIntBE=function(g,y,M){g=g>>>0,y=y>>>0,M||lt(g,y,this.length);let z=y,Q=1,it=this[g+--z];for(;z>0&&(Q*=256);)it+=this[g+--z]*Q;return Q*=128,it>=Q&&(it-=Math.pow(2,8*y)),it},u.prototype.readInt8=function(g,y){return g=g>>>0,y||lt(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,y){g=g>>>0,y||lt(g,2,this.length);const M=this[g]|this[g+1]<<8;return M&32768?M|4294901760:M},u.prototype.readInt16BE=function(g,y){g=g>>>0,y||lt(g,2,this.length);const M=this[g+1]|this[g]<<8;return M&32768?M|4294901760:M},u.prototype.readInt32LE=function(g,y){return g=g>>>0,y||lt(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,y){return g=g>>>0,y||lt(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=$t(function(g){g=g>>>0,et(g,"offset");const y=this[g],M=this[g+7];(y===void 0||M===void 0)&&B(g,this.length-8);const z=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(M<<24);return(BigInt(z)<<BigInt(32))+BigInt(y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=$t(function(g){g=g>>>0,et(g,"offset");const y=this[g],M=this[g+7];(y===void 0||M===void 0)&&B(g,this.length-8);const z=(y<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(z)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M)}),u.prototype.readFloatLE=function(g,y){return g=g>>>0,y||lt(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,y){return g=g>>>0,y||lt(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,y){return g=g>>>0,y||lt(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,y){return g=g>>>0,y||lt(g,8,this.length),n.read(this,g,!1,52,8)};function ht(O,g,y,M,z,Q){if(!u.isBuffer(O))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>z||g<Q)throw new RangeError('"value" argument is out of bounds');if(y+M>O.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,y,M,z){if(g=+g,y=y>>>0,M=M>>>0,!z){const zt=Math.pow(2,8*M)-1;ht(this,g,y,M,zt,0)}let Q=1,it=0;for(this[y]=g&255;++it<M&&(Q*=256);)this[y+it]=g/Q&255;return y+M},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,y,M,z){if(g=+g,y=y>>>0,M=M>>>0,!z){const zt=Math.pow(2,8*M)-1;ht(this,g,y,M,zt,0)}let Q=M-1,it=1;for(this[y+Q]=g&255;--Q>=0&&(it*=256);)this[y+Q]=g/it&255;return y+M},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,1,255,0),this[y]=g&255,y+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,2,65535,0),this[y]=g&255,this[y+1]=g>>>8,y+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,2,65535,0),this[y]=g>>>8,this[y+1]=g&255,y+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,4,4294967295,0),this[y+3]=g>>>24,this[y+2]=g>>>16,this[y+1]=g>>>8,this[y]=g&255,y+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,4,4294967295,0),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4};function jt(O,g,y,M,z){ot(g,M,z,O,y,7);let Q=Number(g&BigInt(4294967295));O[y++]=Q,Q=Q>>8,O[y++]=Q,Q=Q>>8,O[y++]=Q,Q=Q>>8,O[y++]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return O[y++]=it,it=it>>8,O[y++]=it,it=it>>8,O[y++]=it,it=it>>8,O[y++]=it,y}function ie(O,g,y,M,z){ot(g,M,z,O,y,7);let Q=Number(g&BigInt(4294967295));O[y+7]=Q,Q=Q>>8,O[y+6]=Q,Q=Q>>8,O[y+5]=Q,Q=Q>>8,O[y+4]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return O[y+3]=it,it=it>>8,O[y+2]=it,it=it>>8,O[y+1]=it,it=it>>8,O[y]=it,y+8}u.prototype.writeBigUInt64LE=$t(function(g,y=0){return jt(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=$t(function(g,y=0){return ie(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,y,M,z){if(g=+g,y=y>>>0,!z){const Ne=Math.pow(2,8*M-1);ht(this,g,y,M,Ne-1,-Ne)}let Q=0,it=1,zt=0;for(this[y]=g&255;++Q<M&&(it*=256);)g<0&&zt===0&&this[y+Q-1]!==0&&(zt=1),this[y+Q]=(g/it>>0)-zt&255;return y+M},u.prototype.writeIntBE=function(g,y,M,z){if(g=+g,y=y>>>0,!z){const Ne=Math.pow(2,8*M-1);ht(this,g,y,M,Ne-1,-Ne)}let Q=M-1,it=1,zt=0;for(this[y+Q]=g&255;--Q>=0&&(it*=256);)g<0&&zt===0&&this[y+Q+1]!==0&&(zt=1),this[y+Q]=(g/it>>0)-zt&255;return y+M},u.prototype.writeInt8=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,1,127,-128),g<0&&(g=255+g+1),this[y]=g&255,y+1},u.prototype.writeInt16LE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,2,32767,-32768),this[y]=g&255,this[y+1]=g>>>8,y+2},u.prototype.writeInt16BE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,2,32767,-32768),this[y]=g>>>8,this[y+1]=g&255,y+2},u.prototype.writeInt32LE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,4,2147483647,-2147483648),this[y]=g&255,this[y+1]=g>>>8,this[y+2]=g>>>16,this[y+3]=g>>>24,y+4},u.prototype.writeInt32BE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4},u.prototype.writeBigInt64LE=$t(function(g,y=0){return jt(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=$t(function(g,y=0){return ie(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Dt(O,g,y,M,z,Q){if(y+M>O.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function Bt(O,g,y,M,z){return g=+g,y=y>>>0,z||Dt(O,g,y,4),n.write(O,g,y,M,23,4),y+4}u.prototype.writeFloatLE=function(g,y,M){return Bt(this,g,y,!0,M)},u.prototype.writeFloatBE=function(g,y,M){return Bt(this,g,y,!1,M)};function ae(O,g,y,M,z){return g=+g,y=y>>>0,z||Dt(O,g,y,8),n.write(O,g,y,M,52,8),y+8}u.prototype.writeDoubleLE=function(g,y,M){return ae(this,g,y,!0,M)},u.prototype.writeDoubleBE=function(g,y,M){return ae(this,g,y,!1,M)},u.prototype.copy=function(g,y,M,z){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(M||(M=0),!z&&z!==0&&(z=this.length),y>=g.length&&(y=g.length),y||(y=0),z>0&&z<M&&(z=M),z===M||g.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(M<0||M>=this.length)throw new RangeError("Index out of range");if(z<0)throw new RangeError("sourceEnd out of bounds");z>this.length&&(z=this.length),g.length-y<z-M&&(z=g.length-y+M);const Q=z-M;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(y,M,z):s.prototype.set.call(g,this.subarray(M,z),y),Q},u.prototype.fill=function(g,y,M,z){if(typeof g=="string"){if(typeof y=="string"?(z=y,y=0,M=this.length):typeof M=="string"&&(z=M,M=this.length),z!==void 0&&typeof z!="string")throw new TypeError("encoding must be a string");if(typeof z=="string"&&!u.isEncoding(z))throw new TypeError("Unknown encoding: "+z);if(g.length===1){const it=g.charCodeAt(0);(z==="utf8"&&it<128||z==="latin1")&&(g=it)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(y<0||this.length<y||this.length<M)throw new RangeError("Out of range index");if(M<=y)return this;y=y>>>0,M=M===void 0?this.length:M>>>0,g||(g=0);let Q;if(typeof g=="number")for(Q=y;Q<M;++Q)this[Q]=g;else{const it=u.isBuffer(g)?g:u.from(g,z),zt=it.length;if(zt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(Q=0;Q<M-y;++Q)this[Q+y]=it[Q%zt]}return this};const Yt={};function Ie(O,g,y){Yt[O]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${O}]`,this.stack,delete this.name}get code(){return O}set code(z){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:z,writable:!0})}toString(){return`${this.name} [${O}]: ${this.message}`}}}Ie("ERR_BUFFER_OUT_OF_BOUNDS",function(O){return O?`${O} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ie("ERR_INVALID_ARG_TYPE",function(O,g){return`The "${O}" argument must be of type number. Received type ${typeof g}`},TypeError),Ie("ERR_OUT_OF_RANGE",function(O,g,y){let M=`The value of "${O}" is out of range.`,z=y;return Number.isInteger(y)&&Math.abs(y)>2**32?z=$e(String(y)):typeof y=="bigint"&&(z=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&(z=$e(z)),z+="n"),M+=` It must be ${g}. Received ${z}`,M},RangeError);function $e(O){let g="",y=O.length;const M=O[0]==="-"?1:0;for(;y>=M+4;y-=3)g=`_${O.slice(y-3,y)}${g}`;return`${O.slice(0,y)}${g}`}function k(O,g,y){et(g,"offset"),(O[g]===void 0||O[g+y]===void 0)&&B(g,O.length-(y+1))}function ot(O,g,y,M,z,Q){if(O>y||O<g){const it=typeof g=="bigint"?"n":"";let zt;throw g===0||g===BigInt(0)?zt=`>= 0${it} and < 2${it} ** ${(Q+1)*8}${it}`:zt=`>= -(2${it} ** ${(Q+1)*8-1}${it}) and < 2 ** ${(Q+1)*8-1}${it}`,new Yt.ERR_OUT_OF_RANGE("value",zt,O)}k(M,z,Q)}function et(O,g){if(typeof O!="number")throw new Yt.ERR_INVALID_ARG_TYPE(g,"number",O)}function B(O,g,y){throw Math.floor(O)!==O?(et(O,y),new Yt.ERR_OUT_OF_RANGE("offset","an integer",O)):g<0?new Yt.ERR_BUFFER_OUT_OF_BOUNDS:new Yt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,O)}const F=/[^+/0-9A-Za-z-_]/g;function V(O){if(O=O.split("=")[0],O=O.trim().replace(F,""),O.length<2)return"";for(;O.length%4!==0;)O=O+"=";return O}function ct(O,g){g=g||1/0;let y;const M=O.length;let z=null;const Q=[];for(let it=0;it<M;++it){if(y=O.charCodeAt(it),y>55295&&y<57344){if(!z){if(y>56319){(g-=3)>-1&&Q.push(239,191,189);continue}else if(it+1===M){(g-=3)>-1&&Q.push(239,191,189);continue}z=y;continue}if(y<56320){(g-=3)>-1&&Q.push(239,191,189),z=y;continue}y=(z-55296<<10|y-56320)+65536}else z&&(g-=3)>-1&&Q.push(239,191,189);if(z=null,y<128){if((g-=1)<0)break;Q.push(y)}else if(y<2048){if((g-=2)<0)break;Q.push(y>>6|192,y&63|128)}else if(y<65536){if((g-=3)<0)break;Q.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((g-=4)<0)break;Q.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return Q}function ft(O){const g=[];for(let y=0;y<O.length;++y)g.push(O.charCodeAt(y)&255);return g}function J(O,g){let y,M,z;const Q=[];for(let it=0;it<O.length&&!((g-=2)<0);++it)y=O.charCodeAt(it),M=y>>8,z=y%256,Q.push(z),Q.push(M);return Q}function mt(O){return e.toByteArray(V(O))}function xt(O,g,y,M){let z;for(z=0;z<M&&!(z+y>=g.length||z>=O.length);++z)g[z+y]=O[z];return z}function pt(O,g){return O instanceof g||O!=null&&O.constructor!=null&&O.constructor.name!=null&&O.constructor.name===g.name}function St(O){return O!==O}const fe=function(){const O="0123456789abcdef",g=new Array(256);for(let y=0;y<16;++y){const M=y*16;for(let z=0;z<16;++z)g[M+z]=O[y]+O[z]}return g}();function $t(O){return typeof BigInt>"u"?qn:O}function qn(){throw new Error("BigInt not supported")}})(Jg);const dn=Jg.Buffer,t_=t=>t===void 0?null:t;class ES{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let e_=new ES,vS=!0;try{typeof localStorage<"u"&&localStorage&&(e_=localStorage,vS=!1)}catch{}const kS=e_,TS=Object.assign,AS=Object.keys,RS=(t,e)=>{for(const n in t)e(t[n],n)},n_=t=>AS(t).length,SS=t=>{for(const e in t)return!1;return!0},OS=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},IS=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),NS=(t,e)=>t===e||n_(t)===n_(e)&&OS(t,(n,r)=>(n!==void 0||IS(e,r))&&e[r]===n),CS=Object.freeze,r_=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&r_(t[e])}return CS(t)},Bf=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Bf(t,e,n+1)}},LS=t=>t,MS=(t,e)=>e.includes(t);var i_={};const Ga=typeof Ir<"u"&&Ir.release&&/node|io\.js/.test(Ir.release.name)&&Object.prototype.toString.call(typeof Ir<"u"?Ir:0)==="[object process]";let ni;const US=()=>{if(ni===void 0)if(Ga){ni=Nr();const t=Ir.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&ni.set(e,""),e=r):e!==null&&(ni.set(e,r),e=null)}e!==null&&ni.set(e,"")}else typeof location=="object"?(ni=Nr(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");ni.set(`--${zg(e,"-")}`,n),ni.set(`-${zg(e,"-")}`,n)}})):ni=Nr();return ni},Pf=t=>US().has(t),Tl=t=>t_(Ga?i_[t.toUpperCase().replaceAll("-","_")]:kS.getItem(t)),s_=t=>Pf("--"+t)||Tl(t)!==null;s_("production");const FS=Ga&&MS(i_.FORCE_COLOR,["true","1","2"])||!Pf("--no-colors")&&!s_("no-color")&&(!Ga||Ir.stdout.isTTY)&&(!Ga||Pf("--color")||Tl("COLORTERM")!==null||(Tl("TERM")||"").includes("color")),BS=t=>new Uint8Array(t),PS=t=>{const e=BS(t.byteLength);return e.set(t),e};class DS{constructor(e,n){this.left=e,this.right=n}}const Ri=(t,e)=>new DS(t,e);typeof DOMParser<"u"&&new DOMParser;const $S=t=>PR(t,(e,n)=>`${n}:${e};`).join(""),Si=Symbol,o_=Si(),a_=Si(),jS=Si(),zS=Si(),KS=Si(),c_=Si(),WS=Si(),Df=Si(),HS=Si(),GS=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},YS={[o_]:Ri("font-weight","bold"),[a_]:Ri("font-weight","normal"),[jS]:Ri("color","blue"),[KS]:Ri("color","green"),[zS]:Ri("color","grey"),[c_]:Ri("color","red"),[WS]:Ri("color","purple"),[Df]:Ri("color","orange"),[HS]:Ri("color","black")},l_=FS?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=Nr();let i=[],s=0;for(;s<t.length;s++){const a=t[s],c=YS[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=$S(r);s>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const a=t[s];a instanceof Symbol||i.push(a)}return i}:GS,VS=(...t)=>{console.log(...l_(t)),u_.forEach(e=>e.print(t))},ZS=(...t)=>{console.warn(...l_(t)),t.unshift(Df),u_.forEach(e=>e.print(t))},u_=To(),h_=t=>({[Symbol.iterator](){return this},next:t}),XS=(t,e)=>h_(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),$f=(t,e)=>h_(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class jf{constructor(e,n){this.clock=e,this.len=n}}class Ya{constructor(){this.clients=new Map}}const f_=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];S_(t,s,a.clock,a.len,n)}}),qS=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=ts((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},d_=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&qS(n,e.clock)!==null},zf=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=Ps(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},JS=t=>{const e=new Ya;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)$R(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return zf(e),e},Al=(t,e,n,r)=>{Qi(t.clients,e,()=>[]).push(new jf(n,r))},QS=()=>new Ya,tO=t=>{const e=QS();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new jf(a,c))}}i.length>0&&e.clients.set(r,i)}),e},No=(t,e)=>{ne(t.restEncoder,e.clients.size),Bs(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),ne(t.restEncoder,n);const i=r.length;ne(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},Kf=t=>{const e=new Ya,n=Wt(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Wt(t.restDecoder),s=Wt(t.restDecoder);if(s>0){const o=Qi(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new jf(t.readDsClock(),t.readDsLen()))}}return e},p_=(t,e,n)=>{const r=new Ya,i=Wt(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=Wt(t.restDecoder),a=Wt(t.restDecoder),c=n.clients.get(o)||[],l=ln(n,o);for(let u=0;u<a;u++){const d=t.readDsClock(),f=d+t.readDsLen();if(d<l){l<f&&Al(r,o,l,f-l);let h=ri(c,d),p=c[h];for(!p.deleted&&p.id.clock<d&&(c.splice(h+1,0,$l(e,p,d-p.id.clock)),h++);h<c.length&&(p=c[h++],p.id.clock<f);)p.deleted||(f<p.id.clock+p.length&&c.splice(h,0,$l(e,p,f-p.id.clock)),p.delete(e))}else Al(r,o,d,f-d)}}if(r.clients.size>0){const s=new $s;return ne(s.restEncoder,0),No(s,r),s.toUint8Array()}return null},m_=Xg;class Co extends zR{constructor({guid:e=dS(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=m_(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new T_,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=qg(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>qg(l=>{const u=d=>{(d===void 0||d===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&me(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Bs(this.subdocs).map(e=>e.guid))}transact(e,n=null){return me(this,e,n)}get(e,n=pn){const r=Qi(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==pn&&i!==n)if(i===pn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Fo)}getText(e=""){return this.get(e,Oi)}getMap(e=""){return this.get(e,Bo)}getXmlElement(e=""){return this.get(e,Do)}getXmlFragment(e=""){return this.get(e,js)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,Bs(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new Co({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,me(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class g_{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Wt(this.restDecoder)}readDsLen(){return Wt(this.restDecoder)}}class __ extends g_{readLeftID(){return Xt(Wt(this.restDecoder),Wt(this.restDecoder))}readRightID(){return Xt(Wt(this.restDecoder),Wt(this.restDecoder))}readClient(){return Wt(this.restDecoder)}readInfo(){return So(this.restDecoder)}readString(){return Oo(this.restDecoder)}readParentInfo(){return Wt(this.restDecoder)===1}readTypeRef(){return Wt(this.restDecoder)}readLen(){return Wt(this.restDecoder)}readAny(){return Ha(this.restDecoder)}readBuf(){return PS(sr(this.restDecoder))}readJSON(){return JSON.parse(Oo(this.restDecoder))}readKey(){return Oo(this.restDecoder)}}class eO{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Wt(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Wt(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Lo extends eO{constructor(e){super(e),this.keys=[],Wt(e),this.keyClockDecoder=new Mf(sr(e)),this.clientDecoder=new vl(sr(e)),this.leftClockDecoder=new Mf(sr(e)),this.rightClockDecoder=new Mf(sr(e)),this.infoDecoder=new Zg(sr(e),So),this.stringDecoder=new uS(sr(e)),this.parentInfoDecoder=new Zg(sr(e),So),this.typeRefDecoder=new vl(sr(e)),this.lenDecoder=new vl(sr(e))}readLeftID(){return new Mo(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Mo(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Ha(this.restDecoder)}readBuf(){return sr(this.restDecoder)}readJSON(){return Ha(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class nO{constructor(){this.restEncoder=bl()}toUint8Array(){return Jr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ne(this.restEncoder,e)}writeDsLen(e){ne(this.restEncoder,e)}}class Va extends nO{writeLeftID(e){ne(this.restEncoder,e.client),ne(this.restEncoder,e.clock)}writeRightID(e){ne(this.restEncoder,e.client),ne(this.restEncoder,e.clock)}writeClient(e){ne(this.restEncoder,e)}writeInfo(e){Rf(this.restEncoder,e)}writeString(e){Ao(this.restEncoder,e)}writeParentInfo(e){ne(this.restEncoder,e?1:0)}writeTypeRef(e){ne(this.restEncoder,e)}writeLen(e){ne(this.restEncoder,e)}writeAny(e){Wa(this.restEncoder,e)}writeBuf(e){ir(this.restEncoder,e)}writeJSON(e){Ao(this.restEncoder,JSON.stringify(e))}writeKey(e){Ao(this.restEncoder,e)}}class rO{constructor(){this.restEncoder=bl(),this.dsCurrVal=0}toUint8Array(){return Jr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,ne(this.restEncoder,n)}writeDsLen(e){e===0&&ti(),ne(this.restEncoder,e-1),this.dsCurrVal+=e}}class $s extends rO{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Nf,this.clientEncoder=new xl,this.leftClockEncoder=new Nf,this.rightClockEncoder=new Nf,this.infoEncoder=new Wg(Rf),this.stringEncoder=new oS,this.parentInfoEncoder=new Wg(Rf),this.typeRefEncoder=new xl,this.lenEncoder=new xl}toUint8Array(){const e=bl();return ne(e,0),ir(e,this.keyClockEncoder.toUint8Array()),ir(e,this.clientEncoder.toUint8Array()),ir(e,this.leftClockEncoder.toUint8Array()),ir(e,this.rightClockEncoder.toUint8Array()),ir(e,Jr(this.infoEncoder)),ir(e,this.stringEncoder.toUint8Array()),ir(e,Jr(this.parentInfoEncoder)),ir(e,this.typeRefEncoder.toUint8Array()),ir(e,this.lenEncoder.toUint8Array()),wl(e,Jr(this.restEncoder)),Jr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Wa(this.restEncoder,e)}writeBuf(e){ir(this.restEncoder,e)}writeJSON(e){Wa(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const iO=(t,e,n,r)=>{r=Ps(r,e[0].id.clock);const i=ri(e,r);ne(t.restEncoder,e.length-i),t.writeClient(n),ne(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},Wf=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{ln(e,s)>i&&r.set(s,i)}),Gf(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),ne(t.restEncoder,r.size),Bs(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{iO(t,e.clients.get(i),i,s)})},sO=(t,e)=>{const n=Nr(),r=Wt(t.restDecoder);for(let i=0;i<r;i++){const s=Wt(t.restDecoder),o=new Array(s),a=t.readClient();let c=Wt(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(yl&u){case 0:{const d=t.readLen();o[l]=new _r(Xt(a,c),d),c+=d;break}case 10:{const d=Wt(t.restDecoder);o[l]=new yr(Xt(a,c),d),c+=d;break}default:{const d=(u&(Ai|rr))===0,f=new Qe(Xt(a,c),null,(u&rr)===rr?t.readLeftID():null,null,(u&Ai)===Ai?t.readRightID():null,d?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,d&&(u&$a)===$a?t.readString():null,Q_(t,u));o[l]=f,c+=f.length}}}}return n},oO=(t,e,n)=>{const r=[];let i=Bs(n.keys()).sort((h,p)=>h-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new T_,c=new Map,l=(h,p)=>{const m=c.get(h);(m==null||m>p)&&c.set(h,p)};let u=o.refs[o.i++];const d=new Map,f=()=>{for(const h of r){const p=h.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[h]),i=i.filter(b=>b!==p)}r.length=0};for(;;){if(u.constructor!==yr){const p=Qi(d,u.id.client,()=>ln(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),f();else{const m=u.getMissing(t,e);if(m!==null){r.push(u);const b=n.get(m)||{refs:[],i:0};if(b.refs.length===b.i)l(m,ln(e,m)),f();else{u=b.refs[b.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),d.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new $s;return Wf(h,a,new Map),ne(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},aO=(t,e)=>Wf(t,e.doc.store,e.beforeState),cO=(t,e,n,r=new Lo(t))=>me(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=sO(r,o),l=oO(i,a,c),u=a.pendingStructs;if(u){for(const[f,h]of u.missing)if(h<ln(a,f)){s=!0;break}if(l){for(const[f,h]of l.missing){const p=u.missing.get(f);(p==null||p>h)&&u.missing.set(f,h)}u.update=Ol([u.update,l.update])}}else a.pendingStructs=l;const d=p_(r,i,a);if(a.pendingDs){const f=new Lo(Ro(a.pendingDs));Wt(f.restDecoder);const h=p_(f,i,a);d&&h?a.pendingDs=Ol([d,h]):a.pendingDs=d||h}else a.pendingDs=d;if(s){const f=a.pendingStructs.update;a.pendingStructs=null,y_(i.doc,f)}},n,!1),y_=(t,e,n,r=Lo)=>{const i=Ro(e);cO(i,t,n,new r(i))},b_=(t,e,n)=>y_(t,e,n,__),lO=(t,e,n=new Map)=>{Wf(t,e.store,n),No(t,tO(e.store))},uO=(t,e=new Uint8Array([0]),n=new $s)=>{const r=w_(e);lO(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(EO(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===Va)return wO(i.map((s,o)=>o===0?s:kO(s)));if(n.constructor===$s)return Ol(i)}return i[0]},hO=(t,e)=>uO(t,e,new Va),fO=t=>{const e=new Map,n=Wt(t.restDecoder);for(let r=0;r<n;r++){const i=Wt(t.restDecoder),s=Wt(t.restDecoder);e.set(i,s)}return e},w_=t=>fO(new g_(Ro(t)));class dO{constructor(){this.l=[]}}const x_=()=>new dO,E_=(t,e)=>t.l.push(e),v_=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},k_=(t,e,n)=>Bf(t.l,[e,n]);class Mo{constructor(e,n){this.client=e,this.clock=n}}const Rl=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Xt=(t,e)=>new Mo(t,e),pO=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw ti()},Uo=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!d_(e.ds,t.id),Hf=(t,e)=>{const n=Qi(t.meta,Hf,To),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<ln(r,s)&&ns(t,Xt(s,i))}),f_(t,e.ds,i=>{}),n.add(e))};class T_{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Gf=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},ln=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},A_=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw ti()}n.push(e)},ri=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=ts(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=ts((n+r)/2)}throw ti()},Yf=(t,e)=>{const n=t.clients.get(e.client);return n[ri(n,e.clock)]},Vf=(t,e,n)=>{const r=ri(e,n),i=e[r];return i.id.clock<n&&i instanceof Qe?(e.splice(r+1,0,$l(t,i,n-i.id.clock)),r+1):r},ns=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[Vf(t,n,e.clock)]},R_=(t,e,n)=>{const r=e.clients.get(n.client),i=ri(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==_r&&r.splice(i+1,0,$l(t,s,n.clock-s.id.clock+1)),s},mO=(t,e,n)=>{const r=t.clients.get(e.id.client);r[ri(r,e.id.clock)]=n},S_=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=Vf(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&Vf(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class gO{constructor(e,n,r){this.doc=e,this.deleteSet=new Ya,this.beforeState=Gf(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const O_=(t,e)=>e.deleteSet.clients.size===0&&!DR(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(zf(e.deleteSet),aO(t,e),No(t,e.deleteSet),!0),I_=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Qi(t.changed,e,To).add(n)},Sl=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Qe&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},_O=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=ri(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const d=s[l];if(a.clock+a.len<=d.id.clock)break;d instanceof Qe&&d.deleted&&!d.keep&&n(d)&&d.gc(e,!1)}}}},yO=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Bg(i.length-1,1+ri(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+Sl(i,c)}})},N_=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{zf(s),n.afterState=Gf(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,d)=>u.path.length-d.path.length),k_(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Bf(a,[]),n._needFormattingCleanup&&PO(n)}finally{r.gc&&_O(s,i,r.gcFilter),yO(s,i),n.afterState.forEach((u,d)=>{const f=n.beforeState.get(d)||0;if(f!==u){const h=i.clients.get(d),p=Ps(ri(h,f),1);for(let m=h.length-1;m>=p;)m-=1+Sl(h,m)}});for(let u=o.length-1;u>=0;u--){const{client:d,clock:f}=o[u].id,h=i.clients.get(d),p=ri(h,f);p+1<h.length&&Sl(h,p+1)>1||p>0&&Sl(h,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(VS(Df,o_,"[yjs] ",a_,c_,"Changed the client-id because another client seems to be using it."),r.clientID=m_()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Va;O_(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new $s;O_(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):N_(t,e+1)}}},me=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new gO(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&N_(i,0)}}return o};function*bO(t){const e=Wt(t.restDecoder);for(let n=0;n<e;n++){const r=Wt(t.restDecoder),i=t.readClient();let s=Wt(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=Wt(t.restDecoder);yield new yr(Xt(i,s),c),s+=c}else if(yl&a){const c=(a&(Ai|rr))===0,l=new Qe(Xt(i,s),null,(a&rr)===rr?t.readLeftID():null,null,(a&Ai)===Ai?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&$a)===$a?t.readString():null,Q_(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new _r(Xt(i,s),c),s+=c}}}}class Zf{constructor(e,n){this.gen=bO(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===yr);return this.curr}}class Xf{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const wO=t=>Ol(t,__,Va),xO=(t,e)=>{if(t.constructor===_r){const{client:n,clock:r}=t.id;return new _r(Xt(n,r+e),t.length-e)}else if(t.constructor===yr){const{client:n,clock:r}=t.id;return new yr(Xt(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new Qe(Xt(r,i+e),null,Xt(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},Ol=(t,e=Lo,n=$s)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(Ro(u)));let i=r.map(u=>new Zf(u,!0)),s=null;const o=new n,a=new Xf(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,h)=>{if(f.curr.id.client===h.curr.id.client){const p=f.curr.id.clock-h.curr.id.clock;return p===0?f.curr.constructor===h.curr.constructor?0:f.curr.constructor===yr?1:-1:p}else return h.curr.id.client-f.curr.id.client}),i.length!==0;){const u=i[0],d=u.curr.id.client;if(s!==null){let f=u.curr,h=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=u.next(),h=!0;if(f===null||f.id.client!==d||h&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(d!==s.struct.id.client)rs(a,s.struct,s.offset),s={struct:f,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===yr)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{rs(a,s.struct,s.offset);const p=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new yr(Xt(d,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-f.id.clock;p>0&&(s.struct.constructor===yr?s.struct.length-=p:f=xO(f,p)),s.struct.mergeWith(f)||(rs(a,s.struct,s.offset),s={struct:f,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let f=u.curr;f!==null&&f.id.client===d&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==yr;f=u.next())rs(a,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(rs(a,s.struct,s.offset),s=null),qf(a);const c=r.map(u=>Kf(u)),l=JS(c);return No(o,l),o.toUint8Array()},EO=(t,e,n=Lo,r=$s)=>{const i=w_(e),s=new r,o=new Xf(s),a=new n(Ro(t)),c=new Zf(a,!1);for(;c.curr;){const u=c.curr,d=u.id.client,f=i.get(d)||0;if(c.curr.constructor===yr){c.next();continue}if(u.id.clock+u.length>f)for(rs(o,u,Ps(f-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===d;)rs(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===d&&c.curr.id.clock+c.curr.length<=f;)c.next()}qf(o);const l=Kf(a);return No(s,l),s.toUint8Array()},C_=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Jr(t.encoder.restEncoder)}),t.encoder.restEncoder=bl(),t.written=0)},rs=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&C_(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),ne(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},qf=t=>{C_(t);const e=t.encoder.restEncoder;ne(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];ne(e,r.written),wl(e,r.restEncoder)}},vO=(t,e,n,r)=>{const i=new n(Ro(t)),s=new Zf(i,!1),o=new r,a=new Xf(o);for(let l=s.curr;l!==null;l=s.next())rs(a,e(l),0);qf(a);const c=Kf(i);return No(o,c),o.toUint8Array()},kO=t=>vO(t,LS,Lo,Va),L_="You must not compute changes after the event-handler fired.";class Il{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=TO(this.currentTarget,this.target))}deletes(e){return d_(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw es(L_);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=vf(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=vf(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=vf(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw es(L_);const n=this.target,r=To(),i=To(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const TO=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},wn=()=>{ZS("Invalid access: Add Yjs type to a document before reading data.")},M_=80;let Jf=0;class AO{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Jf++}}const RO=t=>{t.timestamp=Jf++},U_=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Jf++},SO=(t,e,n)=>{if(t.length>=M_){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return U_(r,e,n),r}else{const r=new AO(e,n);return t.push(r),r}},Nl=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>_l(e-s.index)<_l(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,RO(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&_l(n.index-i)<r.parent.length/M_?(U_(n,r,i),n):SO(t._searchMarker,r,i)},Za=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=Ps(e,i.index+n))}},Cl=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;Qi(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;k_(r._eH,n,e)};class pn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=x_(),this._dEH=x_(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Qr()}clone(){throw Qr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){E_(this._eH,e)}observeDeep(e){E_(this._dEH,e)}unobserve(e){v_(this._eH,e)}unobserveDeep(e){v_(this._dEH,e)}toJSON(){}}const F_=(t,e,n)=>{t.doc??wn(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},B_=t=>{t.doc??wn();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},Xa=(t,e)=>{let n=0,r=t._start;for(t.doc??wn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},P_=(t,e)=>{const n=[];return Xa(t,(r,i)=>{n.push(e(r,i,t))}),n},OO=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},D_=(t,e)=>{t.doc??wn();const n=Nl(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Ll=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Qe(Xt(o,ln(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ks(l)),i.integrate(t,0),l=[])};r.forEach(d=>{if(d===null)l.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(d);break;default:switch(u(),d.constructor){case Uint8Array:case ArrayBuffer:i=new Qe(Xt(o,ln(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new qa(new Uint8Array(d))),i.integrate(t,0);break;case Co:i=new Qe(Xt(o,ln(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Qa(d)),i.integrate(t,0);break;default:if(d instanceof pn)i=new Qe(Xt(o,ln(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ii(d)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},$_=()=>es("Length exceeded!"),j_=(t,e,n,r)=>{if(n>e._length)throw $_();if(n===0)return e._searchMarker&&Za(e._searchMarker,n,r.length),Ll(t,e,null,r);const i=n,s=Nl(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&ns(t,Xt(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&Za(e._searchMarker,i,r.length),Ll(t,e,o,r)},IO=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Ll(t,e,i,n)},z_=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=Nl(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&ns(t,Xt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&ns(t,Xt(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw $_();e._searchMarker&&Za(e._searchMarker,i,-s+r)},Ml=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Qf=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new Ks([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Ks([r]);break;case Uint8Array:a=new qa(r);break;case Co:a=new Qa(r);break;default:if(r instanceof pn)a=new Ii(r);else throw new Error("Unexpected content type")}new Qe(Xt(o,ln(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},td=(t,e)=>{t.doc??wn();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},K_=t=>{const e={};return t.doc??wn(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},W_=(t,e)=>{t.doc??wn();const n=t._map.get(e);return n!==void 0&&!n.deleted},NO=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Uo(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},Ul=t=>(t.doc??wn(),XS(t._map.entries(),e=>!e[1].deleted));class CO extends Il{}class Fo extends pn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Fo;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Fo}clone(){const e=new Fo;return e.insert(0,this.toArray().map(n=>n instanceof pn?n.clone():n)),e}get length(){return this.doc??wn(),this._length}_callObserver(e,n){super._callObserver(e,n),Cl(this,e,new CO(this,e))}insert(e,n){this.doc!==null?me(this.doc,r=>{j_(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?me(this.doc,n=>{IO(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?me(this.doc,r=>{z_(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return D_(this,e)}toArray(){return B_(this)}slice(e=0,n=this.length){return F_(this,e,n)}toJSON(){return this.map(e=>e instanceof pn?e.toJSON():e)}map(e){return P_(this,e)}forEach(e){Xa(this,e)}[Symbol.iterator](){return OO(this)}_write(e){e.writeTypeRef(rI)}}const LO=t=>new Fo;class MO extends Il{constructor(e,n,r){super(e,n),this.keysChanged=r}}class Bo extends pn{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Bo}clone(){const e=new Bo;return this.forEach((n,r)=>{e.set(r,n instanceof pn?n.clone():n)}),e}_callObserver(e,n){Cl(this,e,new MO(this,e,n))}toJSON(){this.doc??wn();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof pn?i.toJSON():i}}),e}get size(){return[...Ul(this)].length}keys(){return $f(Ul(this),e=>e[0])}values(){return $f(Ul(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return $f(Ul(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??wn(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?me(this.doc,n=>{Ml(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?me(this.doc,r=>{Qf(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return td(this,e)}has(e){return W_(this,e)}clear(){this.doc!==null?me(this.doc,e=>{this.forEach(function(n,r,i){Ml(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(iI)}}const UO=t=>new Bo,is=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&NS(t,e);class ed{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&ti(),this.right.content.constructor){case Je:this.right.deleted||Po(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const H_=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Je:e.right.deleted||Po(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&ns(t,Xt(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Fl=(t,e,n,r)=>{const i=new Map,s=r?Nl(e,n):null;if(s){const o=new ed(s.p.left,s.p,s.index,i);return H_(t,o,n-s.index)}else{const o=new ed(null,e._start,0,i);return H_(t,o,n)}},G_=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Je&&is(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Qe(Xt(s,ln(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new Je(a,o));u.integrate(t,0),n.right=u,n.forward()})},Po=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},Y_=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Je&&is(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},V_=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!is(l,c)){o.set(a,l);const{left:u,right:d}=n;n.right=new Qe(Xt(s,ln(i.store,s)),u,u&&u.lastId,d,d&&d.id,e,null,new Je(a,c)),n.right.integrate(t,0),n.forward()}}return o},nd=(t,e,n,r,i)=>{n.currentAttributes.forEach((f,h)=>{i[h]===void 0&&(i[h]=null)});const s=t.doc,o=s.clientID;Y_(n,i);const a=V_(t,e,n,i),c=r.constructor===String?new ii(r):r instanceof pn?new Ii(r):new zs(r);let{left:l,right:u,index:d}=n;e._searchMarker&&Za(e._searchMarker,n.index,c.getLength()),u=new Qe(Xt(o,ln(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=d,n.forward(),G_(t,e,n,a)},Z_=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;Y_(n,i);const a=V_(t,e,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Je));){if(!n.right.deleted)switch(n.right.content.constructor){case Je:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(is(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&ns(t,Xt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Qe(Xt(o,ln(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new ii(c)),n.right.integrate(t,0),n.forward()}G_(t,e,n,a)},X_=(t,e,n,r,i)=>{let s=e;const o=Nr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Je){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Je:{const{key:u,value:d}=l,f=r.get(u)??null;(o.get(u)!==l||f===d)&&(e.delete(t),a++,!c&&(i.get(u)??null)===d&&f!==d&&(f===null?i.delete(u):i.set(u,f))),!c&&!e.deleted&&Po(i,l);break}}}e=e.right}return a},FO=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Je){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},BO=t=>{let e=0;return me(t.doc,n=>{let r=t._start,i=t._start,s=Nr();const o=Ef(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Je:Po(o,i.content);break;default:e+=X_(n,r,i,s,o),s=Ef(o),r=i;break}i=i.right}}),e},PO=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&S_(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Je&&o.constructor!==_r&&e.add(o.parent)})}me(n,r=>{f_(t,t.deleteSet,i=>{if(i instanceof _r||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Je?e.add(s):FO(r,i)});for(const i of e)BO(i)})},q_=(t,e,n)=>{const r=n,i=Ef(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Ii:case zs:case ii:n<e.right.length&&ns(t,Xt(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&X_(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&Za(o._searchMarker,e.index,-r+n),e};class DO extends Il{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];me(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,d=0;const f=()=>{if(a!==null){let h=null;switch(a){case"delete":d>0&&(h={delete:d}),d=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((p,m)=>{p!==null&&(h.attributes[m]=p)}))),l="";break;case"retain":u>0&&(h={retain:u},SS(c)||(h.attributes=TS({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case Ii:case zs:this.adds(o)?this.deletes(o)||(f(),a="insert",l=o.content.getContent()[0],f()):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),d+=1):o.deleted||(a!=="retain"&&(f(),a="retain"),u+=1);break;case ii:this.adds(o)?this.deletes(o)||(a!=="insert"&&(f(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),d+=o.length):o.deleted||(a!=="retain"&&(f(),a="retain"),u+=o.length);break;case Je:{const{key:h,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(h)??null;is(m,p)?p!==null&&o.delete(r):(a==="retain"&&f(),is(p,s.get(h)??null)?delete c[h]:c[h]=p)}}else if(this.deletes(o)){s.set(h,p);const m=i.get(h)??null;is(m,p)||(a==="retain"&&f(),c[h]=m)}else if(!o.deleted){s.set(h,p);const m=c[h];m!==void 0&&(is(m,p)?m!==null&&o.delete(r):(a==="retain"&&f(),p===null?delete c[h]:c[h]=p))}o.deleted||(a==="insert"&&f(),Po(i,o.content));break}}o=o.right}for(f();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Oi extends pn{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??wn(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Oi}clone(){const e=new Oi;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new DO(this,e,n);Cl(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??wn();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===ii&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?me(this.doc,r=>{const i=new ed(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&nd(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Z_(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&q_(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??wn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const d={};let f=!1;s.forEach((p,m)=>{f=!0,d[m]=p});const h={insert:a};f&&(h.attributes=d),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(Uo(c,e)||n!==void 0&&Uo(c,n))switch(c.content.constructor){case ii:{const d=s.get("ychange");e!==void 0&&!Uo(c,e)?(d===void 0||d.user!==c.id.client||d.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Uo(c,n)?(d===void 0||d.user!==c.id.client||d.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):d!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case Ii:case zs:{l();const d={insert:c.content.getContent()[0]};if(s.size>0){const f={};d.attributes=f,s.forEach((h,p)=>{f[p]=h})}i.push(d);break}case Je:Uo(c,e)&&(l(),Po(s,c.content));break}c=c.right}l()};return e||n?me(o,d=>{e&&Hf(d,e),n&&Hf(d,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?me(i,s=>{const o=Fl(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),nd(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?me(i,s=>{const o=Fl(s,this,e,!r);nd(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?me(r,i=>{q_(i,Fl(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?me(i,s=>{const o=Fl(s,this,e,!1);o.right!==null&&Z_(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?me(this.doc,n=>{Ml(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?me(this.doc,r=>{Qf(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return td(this,e)}getAttributes(){return K_(this)}_write(e){e.writeTypeRef(sI)}}const $O=t=>new Oi;class rd{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??wn()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===Do||n.constructor===js)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class js extends pn{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new js}clone(){const e=new js;return e.insert(0,this.toArray().map(n=>n instanceof pn?n.clone():n)),e}get length(){return this.doc??wn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new rd(this,e)}querySelector(e){e=e.toUpperCase();const r=new rd(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Bs(new rd(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Cl(this,e,new KO(this,n,e))}toString(){return P_(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Xa(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?me(this.doc,r=>{j_(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)me(this.doc,r=>{const i=e&&e instanceof pn?e._item:e;Ll(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw es("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?me(this.doc,r=>{z_(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return B_(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return D_(this,e)}slice(e=0,n=this.length){return F_(this,e,n)}forEach(e){Xa(this,e)}_write(e){e.writeTypeRef(aI)}}const jO=t=>new js;class Do extends js{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Do(this.nodeName)}clone(){const e=new Do(this.nodeName),n=this.getAttributes();return RS(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof pn?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?me(this.doc,n=>{Ml(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?me(this.doc,r=>{Qf(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return td(this,e)}hasAttribute(e){return W_(this,e)}getAttributes(e){return e?NO(this,e):K_(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Xa(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(oI),e.writeKey(this.nodeName)}}const zO=t=>new Do(t.readKey());class KO extends Il{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Bl extends Bo{constructor(e){super(),this.hookName=e}_copy(){return new Bl(this.hookName)}clone(){const e=new Bl(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(cI),e.writeKey(this.hookName)}}const WO=t=>new Bl(t.readKey());class Pl extends Oi{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Pl}clone(){const e=new Pl;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(lI)}}const HO=t=>new Pl;class id{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Qr()}mergeWith(e){return!1}write(e,n,r){throw Qr()}integrate(e,n){throw Qr()}}const GO=0;class _r extends id{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),A_(e.doc.store,this)}write(e,n){e.writeInfo(GO),e.writeLen(this.length-n)}getMissing(e,n){return null}}class qa{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new qa(this.content)}splice(e){throw Qr()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const YO=t=>new qa(t.readBuf());class Ja{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ja(this.len)}splice(e){const n=new Ja(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){Al(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const VO=t=>new Ja(t.readLen()),J_=(t,e)=>new Co({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Qa{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Qa(J_(this.doc.guid,this.opts))}splice(e){throw Qr()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const ZO=t=>new Qa(J_(t.readString(),t.readAny()));class zs{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new zs(this.embed)}splice(e){throw Qr()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const XO=t=>new zs(t.readJSON());class Je{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Je(this.key,this.value)}splice(e){throw Qr()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const qO=t=>new Je(t.readKey(),t.readJSON());class Dl{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Dl(this.arr)}splice(e){const n=new Dl(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const JO=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Dl(n)},QO=Tl("node_env")==="development";class Ks{constructor(e){this.arr=e,QO&&r_(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ks(this.arr)}splice(e){const n=new Ks(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const tI=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new Ks(n)};class ii{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ii(this.str)}splice(e){const n=new ii(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const eI=t=>new ii(t.readString()),nI=[LO,UO,$O,zO,jO,WO,HO],rI=0,iI=1,sI=2,oI=3,aI=4,cI=5,lI=6;class Ii{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ii(this.type._copy())}splice(e){throw Qr()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const uI=t=>new Ii(nI[t.readTypeRef()](t)),$l=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new Qe(Xt(r,i+n),e,Xt(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Xt(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class Qe extends id{constructor(e,n,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?$g:0}set marker(e){(this.info&Tf)>0!==e&&(this.info^=Tf)}get marker(){return(this.info&Tf)>0}get keep(){return(this.info&Dg)>0}set keep(e){this.keep!==e&&(this.info^=Dg)}get countable(){return(this.info&$g)>0}get deleted(){return(this.info&kf)>0}set deleted(e){this.deleted!==e&&(this.info^=kf)}markDeleted(){this.info|=kf}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=ln(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=ln(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Mo&&this.id.client!==this.parent.client&&this.parent.clock>=ln(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=R_(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=ns(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===_r||this.right&&this.right.constructor===_r)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Qe?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Qe&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Mo){const r=Yf(n,this.parent);r.constructor===_r?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=R_(e,e.doc.store,Xt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Rl(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Rl(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Yf(e.doc.store,i.origin)))s.has(Yf(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),A_(e.doc.store,this),this.content.integrate(e,this),I_(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new _r(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Xt(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Rl(e.origin,this.lastId)&&this.right===e&&Rl(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Al(e.deleteSet,this.id.client,this.id.clock,this.length),I_(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw ti();this.content.gc(e),n?mO(e,this,new _r(this.id,this.length)):this.content=new Ja(this.length)}write(e,n){const r=n>0?Xt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&yl|(r===null?0:rr)|(i===null?0:Ai)|(s===null?0:$a);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=pO(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Mo?(e.writeParentInfo(!1),e.writeLeftID(a)):ti();s!==null&&e.writeString(s)}this.content.write(e,n)}}const Q_=(t,e)=>hI[e&yl](t),hI=[()=>{ti()},VO,JO,YO,eI,XO,qO,uI,tI,ZO,()=>{ti()}],fI=10;class yr extends id{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){ti()}write(e,n){e.writeInfo(fI),ne(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const ty=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ko<"u"?ko:{},ey="__ $YJS$ __";ty[ey]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),ty[ey]=!0;let ny=!1;const or=new Co;function ry(t,e,n){const r=or.getMap();if(!r.has(t))switch(e){case 0:case 1:r.set(t,n);break}}function dI(t,e){ry(t,0,e)}function sd(t,e){const n=new Oi(e);ry(t,1,n)}function pI(t,e){or.getMap().set(t,e)}function mI(t,e){const n=or.getMap(),r=new Oi(e);n.set(t,r)}function iy(t,e){const n=or.getMap();function r(i){const s=n.get(t);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&e(s)}return n.has(t)&&e(n.get(t)),n.observeDeep(r),()=>{n.observeDeep(r)}}function gI(t,e){return iy(t,n=>{kt(n)&&e(n)})}function sy(t,e){return iy(t,n=>{n instanceof Oi&&e(n.toJSON())})}const Ws=ho("modem",["second"],t=>{if(Ws.session(t))switch(t.target){case"second":!ny&&t.data%2===0&&Ws.emit(t.player,"modem:join");break;case"join":t.sender!==Ws.id()&&Ws.reply(t,"joinack",Lg(hO(or)));break;case"joinack":t.sender!==Ws.id()&&(ny=!0,b_(or,ml(t.data),or));break;case"sync":{t.sender!==Ws.id()&&x(t.data)&&b_(or,ml(t.data),or);break}}});function oy(t,e){e!==or&&Ws.emit("","modem:sync",Lg(t))}or.on("update",oy),or.on("destroy",()=>{or.off("update",oy)});function _I(t,e){return t%e}function yI(t,e){return Math.floor(t/e)}function bI(t,e){return{x:_I(t,e),y:yI(t,e)}}function si(t,e){return t.x+t.y*e}function $o(t,e,n,r,i,s){return t>=s&&t<=r&&e>=n&&e<=i}function ay(t,e,n,r){const i=[],s=Math.min(t,n),o=Math.max(t,n),a=Math.min(e,r),c=Math.max(e,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function cy(t,e,n,r){const i=[],s=Math.abs(n-t),o=Math.abs(r-e),a=t<n?1:-1,c=e<r?1:-1;let l=s-o;for(i.push({x:t,y:e});t!==n||e!==r;){const u=2*l;u>-o&&(l-=o,t+=a),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const ly="176",wI="",Cr="srgb",uy="srgb-linear",hy="linear",od="srgb";function Lr(t,e,n){return Math.max(e,Math.min(n,t))}function xI(t,e){return(t%e+e)%e}function ad(t,e,n){return(1-n)*t+n*e}class tc{constructor(e=0,n=0){tc.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Lr(this.x,e.x,n.x),this.y=Lr(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=Lr(this.x,e,n),this.y=Lr(this.y,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Lr(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Lr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ec{constructor(e,n,r,i,s,o,a,c,l){ec.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l)}set(e,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],d=r[7],f=r[2],h=r[5],p=r[8],m=i[0],b=i[3],_=i[6],v=i[1],T=i[4],A=i[7],C=i[2],R=i[5],S=i[8];return s[0]=o*m+a*v+c*C,s[3]=o*b+a*T+c*R,s[6]=o*_+a*A+c*S,s[1]=l*m+u*v+d*C,s[4]=l*b+u*T+d*R,s[7]=l*_+u*A+d*S,s[2]=f*m+h*v+p*C,s[5]=f*b+h*T+p*R,s[8]=f*_+h*A+p*S,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=u*o-a*l,f=a*c-u*s,h=l*s-o*c,p=n*d+r*f+i*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=d*m,e[1]=(i*l-u*r)*m,e[2]=(a*r-i*o)*m,e[3]=f*m,e[4]=(u*n-i*c)*m,e[5]=(i*s-a*n)*m,e[6]=h*m,e[7]=(r*c-l*n)*m,e[8]=(o*n-r*s)*m,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(cd.makeScale(e,n)),this}rotate(e){return this.premultiply(cd.makeRotation(-e)),this}translate(e,n){return this.premultiply(cd.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const cd=new ec,fy=new ec().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),dy=new ec().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function EI(){const t={enabled:!0,workingColorSpace:uy,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===od&&(i.r=jo(i.r),i.g=jo(i.g),i.b=jo(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===od&&(i.r=zo(i.r),i.g=zo(i.g),i.b=zo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===wI?hy:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[uy]:{primaries:e,whitePoint:r,transfer:hy,toXYZ:fy,fromXYZ:dy,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Cr},outputColorSpaceConfig:{drawingBufferColorSpace:Cr}},[Cr]:{primaries:e,whitePoint:r,transfer:od,toXYZ:fy,fromXYZ:dy,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Cr}}}),t}const Mr=EI();function jo(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function zo(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const py={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ss={h:0,s:0,l:0},jl={h:0,s:0,l:0};function ld(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class ud{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Cr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Mr.toWorkingColorSpace(this,n),this}setRGB(e,n,r,i=Mr.workingColorSpace){return this.r=e,this.g=n,this.b=r,Mr.toWorkingColorSpace(this,i),this}setHSL(e,n,r,i=Mr.workingColorSpace){if(e=xI(e,1),n=Lr(n,0,1),r=Lr(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=ld(o,s,e+1/3),this.g=ld(o,s,e),this.b=ld(o,s,e-1/3)}return Mr.toWorkingColorSpace(this,i),this}setStyle(e,n=Cr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Cr){const r=py[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=jo(e.r),this.g=jo(e.g),this.b=jo(e.b),this}copyLinearToSRGB(e){return this.r=zo(e.r),this.g=zo(e.g),this.b=zo(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Cr){return Mr.fromWorkingColorSpace(xn.copy(this),e),Math.round(Lr(xn.r*255,0,255))*65536+Math.round(Lr(xn.g*255,0,255))*256+Math.round(Lr(xn.b*255,0,255))}getHexString(e=Cr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Mr.workingColorSpace){Mr.fromWorkingColorSpace(xn.copy(this),n);const r=xn.r,i=xn.g,s=xn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const d=o-a;switch(l=u<=.5?d/(o+a):d/(2-o-a),o){case r:c=(i-s)/d+(i<s?6:0);break;case i:c=(s-r)/d+2;break;case s:c=(r-i)/d+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,n=Mr.workingColorSpace){return Mr.fromWorkingColorSpace(xn.copy(this),n),e.r=xn.r,e.g=xn.g,e.b=xn.b,e}getStyle(e=Cr){Mr.fromWorkingColorSpace(xn.copy(this),e);const n=xn.r,r=xn.g,i=xn.b;return e!==Cr?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,n,r){return this.getHSL(ss),this.setHSL(ss.h+e,ss.s+n,ss.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(ss),e.getHSL(jl);const r=ad(ss.h,jl.h,n),i=ad(ss.s,jl.s,n),s=ad(ss.l,jl.l,n);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const xn=new ud;ud.NAMES=py,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ly}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ly),new tc,new tc;function tn(t,e,n){return Math.max(e,Math.min(n,t))}function my(t){return t/180*Math.PI}function gy(t){return t*180/Math.PI}const vI=Ap("089fad0j9awfem09wavefc09uwaef");function kI(){return vI()}function TI(t){return Ap(t)()}function br(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(kI()*i)}function _y(t,e,n){const r=Math.min(e,n),s=Math.max(e,n)-r+1;return r+Math.floor(TI(t)*s)}function yy(t,e,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function AI(t){return t[br(0,t.length-1)]}function RI(t,e){return e[_y(t,0,e.length-1)]}function Ae(...t){return AI(t.flat())}function by(t,...e){return RI(t,e.flat())}function SI(t){return[...new Set(t)].filter(x)}function Hs(t){return x(t)&&x(t.x)&&x(t.y)}function Ke(t,e){switch(e){case dt.NORTH:--t.y;break;case dt.SOUTH:++t.y;break;case dt.WEST:--t.x;break;case dt.EAST:++t.x;break}return t}function OI(t,e){return t<0?dt.WEST:t>0?dt.EAST:e<0?dt.NORTH:e>0?dt.SOUTH:dt.IDLE}function Ur(t,e){return OI(e.x-t.x,e.y-t.y)}const hd={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function Fr(t){return ce(t)&&wy(t[0])}function wy(t){return x(dt[t])&&gt(t)}function II(t){const e=dt[t];return x(e)?e:dt.IDLE}function fd(t){if(gt(t))return hd[Ot(t)]}function NI(t){if(Fr(t))return t;if(wy(t))return[t];const e=fd(t);if(x(e))return[e]}function xy(t){const e=w.words[t],n=NI(e);return Fr(n)?[n,t+1]:[void 0,t]}function Ey(t){var i,s;const e=[];let[n,r]=xy(t);for(;Fr(n);){switch(e.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=nt(w.words,r,[j.NUMBER,j.NUMBER]);e.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=nt(w.words,r,[j.DIR]);e.push(c.destpt.x,c.destpt.y),r=l;break}case"TO":{const[c,l,u]=nt(w.words,r,[j.DIR,j.DIR]),d=((i=w.element)==null?void 0:i.x)??0,f=((s=w.element)==null?void 0:s.y)??0;c.destpt.x-=d,c.destpt.y-=f,l.destpt.x-=d,l.destpt.y-=f,e.push(d+c.destpt.x+l.destpt.x,f+c.destpt.y+l.destpt.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[e,r]}const[o,a]=xy(r);n=o,r=a}return e.length?[e,r]:[void 0,t]}function CI(t){return x(t)&&t<At.ONBLACK?t:void 0}function LI(t){return x(t)&&t>At.WHITE&&t<At.ONCLEAR?t-At.ONBLACK:void 0}const nc={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function oi(t){return ce(t)&&ky(t[0])}function vy(t){return oi(t)&&t[0].startsWith("ON")}function ky(t){return x(At[t])&&gt(t)}function zl(t){if(gt(t))return nc[Ot(t)]}function Ty(t){return t.map(e=>At[e]).find(e=>x(e)&&e<At.ONBLACK)}function Ay(t){return t.map(e=>At[e]).find(e=>x(e)&&e>=At.ONBLACK)}function MI(t){if(oi(t))return t;if(ky(t))return[t];const e=zl(t);if(x(e))return[e]}function Ry(t){const e=w.words[t],n=MI(e);return oi(n)?[n,t+1]:[void 0,t]}function dd(t){const e=[];let n=t;const[r,i]=Ry(t);if(oi(r)&&(e.push(...r),n=i),oi(e)&&!vy(e)){const[s,o]=Ry(i);vy(s)&&(n=o)}return e.length?[e,n]:[void 0,t]}function Sy(t){const e={};return t.every(n=>{const r=At[n];x(r)&&(r<At.ONBLACK?e.color=r:e.bg=r-At.ONBLACK)}),e}function Ko(t){return ce(t)&&typeof t[0]=="string"}function UI(t){const e=w.words[t];return gt(e)?[e,t+1]:[void 0,t]}function Oy(t){const e=w.words[t];if(Ko(e))return[e,t+1];const[n,r]=dd(t),[i,s]=UI(r);return gt(i)?[[i,n],s]:[void 0,t]}function Kl(t){if(!Ko(t))return;const[e]=t;return e}function pd(t){if(!Ko(t))return;const[,e]=t,n=x(e)?Ty(e):void 0;return x(n)?n:void 0}function Iy(t){if(!Ko(t))return;const[,e]=t,n=x(e)?Ay(e):void 0;return x(n)?n:void 0}var md;try{md=new TextDecoder}catch{}var yt,wr,K=0,ge={},qt,os,xr=0,ai=0,un,Ni,Pn=[],Vt,Ny={useRecords:!1,mapsAsObjects:!0};class Cy{}const Ly=new Cy;Ly.name="MessagePack 0xC1";var as=!1,My=2,Uy;try{new Function("")}catch{My=1/0}class rc{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(yt)return Vy(()=>(wd(),this?this.unpack(e,n):rc.prototype.unpack.call(Ny,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof dn<"u"?dn.from(e):new Uint8Array(e)),typeof n=="object"?(wr=n.end||e.length,K=n.start||0):(K=0,wr=n>-1?n:e.length),ai=0,os=null,un=null,yt=e;try{Vt=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw yt=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof rc){if(ge=this,this.structures)return qt=this.structures,Wl(n);(!qt||qt.length>0)&&(qt=[])}else ge=Ny,(!qt||qt.length>0)&&(qt=[]);return Wl(n)}unpackMultiple(e,n){let r,i=0;try{as=!0;let s=e.length,o=this?this.unpack(e,s):Hl.unpack(e,s);if(n){if(n(o,i,K)===!1)return;for(;K<s;)if(i=K,n(Wl(),i,K)===!1)return}else{for(r=[o];K<s;)i=K,r.push(Wl());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{as=!1,wd()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function Wl(t){try{if(!ge.trusted&&!as){let n=qt.sharedLength||0;n<qt.length&&(qt.length=n)}let e;if(ge.randomAccessStructure&&yt[K]<64&&yt[K]>=32&&Uy?(e=Uy(yt,K,wr,ge),yt=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),K=wr):e=We(),un&&(K=un.postBundlePosition,un=null),as&&(qt.restoreStructures=null),K==wr)qt&&qt.restoreStructures&&Fy(),qt=null,yt=null,Ni&&(Ni=null);else{if(K>wr)throw new Error("Unexpected end of MessagePack data");if(!as){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw qt&&qt.restoreStructures&&Fy(),wd(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||K>wr)&&(e.incomplete=!0),e}}function Fy(){for(let t in qt.restoreStructures)qt[t]=qt.restoreStructures[t];qt.restoreStructures=null}function We(){let t=yt[K++];if(t<160)if(t<128){if(t<64)return t;{let e=qt[t&63]||ge.getStructures&&Py()[t&63];return e?(e.read||(e.read=gd(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,ge.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=Wy();r==="__proto__"&&(r="__proto_"),e[r]=We()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(We(),We());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=We();return ge.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(ai>=K)return os.slice(K-xr,(K+=e)-xr);if(ai==0&&wr<140){let n=e<16?yd(e):jy(e);if(n!=null)return n}return _d(e)}else{let e;switch(t){case 192:return null;case 193:return un?(e=We(),e>0?un[1].slice(un.position1,un.position1+=e):un[0].slice(un.position0,un.position0-=e)):Ly;case 194:return!1;case 195:return!0;case 196:if(e=yt[K++],e===void 0)throw new Error("Unexpected end of buffer");return bd(e);case 197:return e=Vt.getUint16(K),K+=2,bd(e);case 198:return e=Vt.getUint32(K),K+=4,bd(e);case 199:return Gs(yt[K++]);case 200:return e=Vt.getUint16(K),K+=2,Gs(e);case 201:return e=Vt.getUint32(K),K+=4,Gs(e);case 202:if(e=Vt.getFloat32(K),ge.useFloat32>2){let n=xd[(yt[K]&127)<<1|yt[K+1]>>7];return K+=4,(n*e+(e>0?.5:-.5)>>0)/n}return K+=4,e;case 203:return e=Vt.getFloat64(K),K+=8,e;case 204:return yt[K++];case 205:return e=Vt.getUint16(K),K+=2,e;case 206:return e=Vt.getUint32(K),K+=4,e;case 207:return ge.int64AsType==="number"?(e=Vt.getUint32(K)*4294967296,e+=Vt.getUint32(K+4)):ge.int64AsType==="string"?e=Vt.getBigUint64(K).toString():ge.int64AsType==="auto"?(e=Vt.getBigUint64(K),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Vt.getBigUint64(K),K+=8,e;case 208:return Vt.getInt8(K++);case 209:return e=Vt.getInt16(K),K+=2,e;case 210:return e=Vt.getInt32(K),K+=4,e;case 211:return ge.int64AsType==="number"?(e=Vt.getInt32(K)*4294967296,e+=Vt.getUint32(K+4)):ge.int64AsType==="string"?e=Vt.getBigInt64(K).toString():ge.int64AsType==="auto"?(e=Vt.getBigInt64(K),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Vt.getBigInt64(K),K+=8,e;case 212:if(e=yt[K++],e==114)return Gy(yt[K++]&63);{let n=Pn[e];if(n)return n.read?(K++,n.read(We())):n.noBuffer?(K++,n()):n(yt.subarray(K,++K));throw new Error("Unknown extension "+e)}case 213:return e=yt[K],e==114?(K++,Gy(yt[K++]&63,yt[K++])):Gs(2);case 214:return Gs(4);case 215:return Gs(8);case 216:return Gs(16);case 217:return e=yt[K++],ai>=K?os.slice(K-xr,(K+=e)-xr):BI(e);case 218:return e=Vt.getUint16(K),K+=2,ai>=K?os.slice(K-xr,(K+=e)-xr):PI(e);case 219:return e=Vt.getUint32(K),K+=4,ai>=K?os.slice(K-xr,(K+=e)-xr):DI(e);case 220:return e=Vt.getUint16(K),K+=2,Dy(e);case 221:return e=Vt.getUint32(K),K+=4,Dy(e);case 222:return e=Vt.getUint16(K),K+=2,$y(e);case 223:return e=Vt.getUint32(K),K+=4,$y(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const FI=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function gd(t,e){function n(){if(n.count++>My){let i=t.read=new Function("r","return function(){return "+(ge.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":FI.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(We);return t.highByte===0&&(t.read=By(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=We()}return ge.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?By(e,n):n}const By=(t,e)=>function(){let n=yt[K++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=qt[r]||Py()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=gd(i,t)),i.read()};function Py(){let t=Vy(()=>(yt=null,ge.getStructures()));return qt=ge._mergeStructures(t,qt)}var _d=ic,BI=ic,PI=ic,DI=ic;function ic(t){let e;if(t<16&&(e=yd(t)))return e;if(t>64&&md)return md.decode(yt.subarray(K,K+=t));const n=K+t,r=[];for(e="";K<n;){const i=yt[K++];if(!(i&128))r.push(i);else if((i&224)===192){const s=yt[K++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=yt[K++]&63,o=yt[K++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=yt[K++]&63,o=yt[K++]&63,a=yt[K++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=hn.apply(String,r),r.length=0)}return r.length>0&&(e+=hn.apply(String,r)),e}function Dy(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=We();return ge.freezeData?Object.freeze(e):e}function $y(t){if(ge.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=Wy();r==="__proto__"&&(r="__proto_"),e[r]=We()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(We(),We());return e}}var hn=String.fromCharCode;function jy(t){let e=K,n=new Array(t);for(let r=0;r<t;r++){const i=yt[K++];if((i&128)>0){K=e;return}n[r]=i}return hn.apply(String,n)}function yd(t){if(t<4)if(t<2){if(t===0)return"";{let e=yt[K++];if((e&128)>1){K-=1;return}return hn(e)}}else{let e=yt[K++],n=yt[K++];if((e&128)>0||(n&128)>0){K-=2;return}if(t<3)return hn(e,n);let r=yt[K++];if((r&128)>0){K-=3;return}return hn(e,n,r)}else{let e=yt[K++],n=yt[K++],r=yt[K++],i=yt[K++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){K-=4;return}if(t<6){if(t===4)return hn(e,n,r,i);{let s=yt[K++];if((s&128)>0){K-=5;return}return hn(e,n,r,i,s)}}else if(t<8){let s=yt[K++],o=yt[K++];if((s&128)>0||(o&128)>0){K-=6;return}if(t<7)return hn(e,n,r,i,s,o);let a=yt[K++];if((a&128)>0){K-=7;return}return hn(e,n,r,i,s,o,a)}else{let s=yt[K++],o=yt[K++],a=yt[K++],c=yt[K++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){K-=8;return}if(t<10){if(t===8)return hn(e,n,r,i,s,o,a,c);{let l=yt[K++];if((l&128)>0){K-=9;return}return hn(e,n,r,i,s,o,a,c,l)}}else if(t<12){let l=yt[K++],u=yt[K++];if((l&128)>0||(u&128)>0){K-=10;return}if(t<11)return hn(e,n,r,i,s,o,a,c,l,u);let d=yt[K++];if((d&128)>0){K-=11;return}return hn(e,n,r,i,s,o,a,c,l,u,d)}else{let l=yt[K++],u=yt[K++],d=yt[K++],f=yt[K++];if((l&128)>0||(u&128)>0||(d&128)>0||(f&128)>0){K-=12;return}if(t<14){if(t===12)return hn(e,n,r,i,s,o,a,c,l,u,d,f);{let h=yt[K++];if((h&128)>0){K-=13;return}return hn(e,n,r,i,s,o,a,c,l,u,d,f,h)}}else{let h=yt[K++],p=yt[K++];if((h&128)>0||(p&128)>0){K-=14;return}if(t<15)return hn(e,n,r,i,s,o,a,c,l,u,d,f,h,p);let m=yt[K++];if((m&128)>0){K-=15;return}return hn(e,n,r,i,s,o,a,c,l,u,d,f,h,p,m)}}}}}function zy(){let t=yt[K++],e;if(t<192)e=t-160;else switch(t){case 217:e=yt[K++];break;case 218:e=Vt.getUint16(K),K+=2;break;case 219:e=Vt.getUint32(K),K+=4;break;default:throw new Error("Expected string")}return ic(e)}function bd(t){return ge.copyBuffers?Uint8Array.prototype.slice.call(yt,K,K+=t):yt.subarray(K,K+=t)}function Gs(t){let e=yt[K++];if(Pn[e]){let n;return Pn[e](yt.subarray(K,n=K+=t),r=>{K=r;try{return We()}finally{K=n}})}else throw new Error("Unknown extension type "+e)}var Ky=new Array(4096);function Wy(){let t=yt[K++];if(t>=160&&t<192){if(t=t-160,ai>=K)return os.slice(K-xr,(K+=t)-xr);if(!(ai==0&&wr<180))return _d(t)}else return K--,Hy(We());let e=(t<<5^(t>1?Vt.getUint16(K):t>0?yt[K]:0))&4095,n=Ky[e],r=K,i=K+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=Vt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=yt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return K=r,n.string;i-=3,r=K}for(n=[],Ky[e]=n,n.bytes=t;r<i;)s=Vt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=yt[r++],n.push(s);let a=t<16?yd(t):jy(t);return a!=null?n.string=a:n.string=_d(t)}function Hy(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const Gy=(t,e)=>{let n=We().map(Hy),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=qt[t];return i&&(i.isShared||as)&&((qt.restoreStructures||(qt.restoreStructures=[]))[t]=i),qt[t]=n,n.read=gd(n,r),n.read()};Pn[0]=()=>{},Pn[0].noBuffer=!0,Pn[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let $I={Error,TypeError,ReferenceError};Pn[101]=()=>{let t=We();return($I[t[0]]||Error)(t[1],{cause:t[2]})},Pn[105]=t=>{if(ge.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Vt.getUint32(K-4);Ni||(Ni=new Map);let n=yt[K],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Ni.set(e,i);let s=We();return i.used?Object.assign(r,s):(i.target=s,s)},Pn[112]=t=>{if(ge.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Vt.getUint32(K-4),n=Ni.get(e);return n.used=!0,n.target},Pn[115]=()=>new Set(We());const Yy=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let jI=typeof globalThis=="object"?globalThis:window;Pn[116]=t=>{let e=t[0],n=Yy[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new jI[n](Uint8Array.prototype.slice.call(t,1).buffer)},Pn[120]=()=>{let t=We();return new RegExp(t[0],t[1])};const zI=[];Pn[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=K;return K+=e-t.length,un=zI,un=[zy(),zy()],un.position0=0,un.position1=0,un.postBundlePosition=K,K=n,We()},Pn[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function Vy(t){let e=wr,n=K,r=xr,i=ai,s=os,o=Ni,a=un,c=new Uint8Array(yt.slice(0,wr)),l=qt,u=qt.slice(0,qt.length),d=ge,f=as,h=t();return wr=e,K=n,xr=r,ai=i,os=s,Ni=o,un=a,yt=c,as=f,qt=l,qt.splice(0,qt.length,...u),ge=d,Vt=new DataView(yt.buffer,yt.byteOffset,yt.byteLength),h}function wd(){yt=null,Ni=null,qt=null}const xd=new Array(147);for(let t=0;t<256;t++)xd[t]=+("1e"+Math.floor(45.15-t*.30103));var Hl=new rc({useRecords:!1});const KI=Hl.unpack;Hl.unpackMultiple,Hl.unpack;let WI=new Float32Array(1);new Uint8Array(WI.buffer,0,4);let Gl;try{Gl=new TextEncoder}catch{}let Ed,Zy;const Yl=typeof dn<"u",Vl=Yl?function(t){return dn.allocUnsafeSlow(t)}:Uint8Array,Xy=Yl?dn:Uint8Array,qy=Yl?4294967296:2144337920;let q,sc,_e,G=0,Rn,Le=null,HI;const GI=21760,YI=/[\u0080-\uFFFF]/,Wo=Symbol("record-id");class VI extends rc{constructor(e){super(e),this.offset=0;let n,r,i,s,o=Xy.prototype.utf8Write?function(N,E){return q.utf8Write(N,E,q.byteLength-E)}:Gl&&Gl.encodeInto?function(N,E){return Gl.encodeInto(N,q.subarray(E)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let d=e.maxOwnStructures;d==null&&(d=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let f=u>32||d+u>64,h=u+64,p=u+d+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],b=0,_=0;this.pack=this.encode=function(N,E){if(q||(q=new Vl(8192),_e=q.dataView||(q.dataView=new DataView(q.buffer,0,8192)),G=0),Rn=q.length-10,Rn-G<2048?(q=new Vl(q.length),_e=q.dataView||(q.dataView=new DataView(q.buffer,0,q.length)),Rn=q.length-10,G=0):G=G+7&2147483640,n=G,E&eN&&(G+=E&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof N!="string"?(Le=[],Le.size=1/0):Le=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let Z=i.sharedLength||0;if(Z>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let $=0;$<Z;$++){let st=i[$];if(!st)continue;let rt,at=i.transitions;for(let Y=0,H=st.length;Y<H;Y++){let wt=st[Y];rt=at[wt],rt||(rt=at[wt]=Object.create(null)),at=rt}at[Wo]=$+64}this.lastNamedStructuresLength=Z}c||(i.nextId=Z+64)}r&&(r=!1);let D;try{a.randomAccessStructure&&N&&N.constructor&&N.constructor===Object?L(N):A(N);let Z=Le;if(Le&&tb(n,A,0),s&&s.idsToInsert){let $=s.idsToInsert.sort((Y,H)=>Y.offset>H.offset?1:-1),st=$.length,rt=-1;for(;Z&&st>0;){let Y=$[--st].offset+n;Y<Z.stringsPosition+n&&rt===-1&&(rt=0),Y>Z.position+n?rt>=0&&(rt+=6):(rt>=0&&(_e.setUint32(Z.position+n,_e.getUint32(Z.position+n)+rt),rt=-1),Z=Z.previous,st++)}rt>=0&&Z&&_e.setUint32(Z.position+n,_e.getUint32(Z.position+n)+rt),G+=$.length*6,G>Rn&&I(G),a.offset=G;let at=XI(q.subarray(n,G),$);return s=null,at}return a.offset=G,E&QI?(q.start=n,q.end=G,q):q.subarray(n,G)}catch(Z){throw D=Z,Z}finally{if(i&&(v(),r&&a.saveStructures)){let Z=i.sharedLength||0,$=q.subarray(n,G),st=qI(i,a);if(!D)return a.saveStructures(st,st.isCompatible)===!1?a.pack(N,E):(a.lastNamedStructuresLength=Z,q.length>1073741824&&(q=null),$)}q.length>1073741824&&(q=null),E&tN&&(G=n)}};const v=()=>{_<10&&_++;let N=i.sharedLength||0;if(i.length>N&&!c&&(i.length=N),b>1e4)i.transitions=null,_=0,b=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let E=0,D=m.length;E<D;E++)m[E][Wo]=0;m=[]}},T=N=>{var E=N.length;E<16?q[G++]=144|E:E<65536?(q[G++]=220,q[G++]=E>>8,q[G++]=E&255):(q[G++]=221,_e.setUint32(G,E),G+=4);for(let D=0;D<E;D++)A(N[D])},A=N=>{G>Rn&&(q=I(G));var E=typeof N,D;if(E==="string"){let Z=N.length;if(Le&&Z>=4&&Z<4096){if((Le.size+=Z)>GI){let at,Y=(Le[0]?Le[0].length*3+Le[1].length:0)+10;G+Y>Rn&&(q=I(G+Y));let H;Le.position?(H=Le,q[G]=200,G+=3,q[G++]=98,at=G-n,G+=4,tb(n,A,0),_e.setUint16(at+n-3,G-n-at)):(q[G++]=214,q[G++]=98,at=G-n,G+=4),Le=["",""],Le.previous=H,Le.size=0,Le.position=at}let rt=YI.test(N);Le[rt?0:1]+=N,q[G++]=193,A(rt?-Z:Z);return}let $;Z<32?$=1:Z<256?$=2:Z<65536?$=3:$=5;let st=Z*3;if(G+st>Rn&&(q=I(G+st)),Z<64||!o){let rt,at,Y,H=G+$;for(rt=0;rt<Z;rt++)at=N.charCodeAt(rt),at<128?q[H++]=at:at<2048?(q[H++]=at>>6|192,q[H++]=at&63|128):(at&64512)===55296&&((Y=N.charCodeAt(rt+1))&64512)===56320?(at=65536+((at&1023)<<10)+(Y&1023),rt++,q[H++]=at>>18|240,q[H++]=at>>12&63|128,q[H++]=at>>6&63|128,q[H++]=at&63|128):(q[H++]=at>>12|224,q[H++]=at>>6&63|128,q[H++]=at&63|128);D=H-G-$}else D=o(N,G+$);D<32?q[G++]=160|D:D<256?($<2&&q.copyWithin(G+2,G+1,G+1+D),q[G++]=217,q[G++]=D):D<65536?($<3&&q.copyWithin(G+3,G+2,G+2+D),q[G++]=218,q[G++]=D>>8,q[G++]=D&255):($<5&&q.copyWithin(G+5,G+3,G+3+D),q[G++]=219,_e.setUint32(G,D),G+=4),G+=D}else if(E==="number")if(N>>>0===N)N<32||N<128&&this.useRecords===!1||N<64&&!this.randomAccessStructure?q[G++]=N:N<256?(q[G++]=204,q[G++]=N):N<65536?(q[G++]=205,q[G++]=N>>8,q[G++]=N&255):(q[G++]=206,_e.setUint32(G,N),G+=4);else if(N>>0===N)N>=-32?q[G++]=256+N:N>=-128?(q[G++]=208,q[G++]=N+256):N>=-32768?(q[G++]=209,_e.setInt16(G,N),G+=2):(q[G++]=210,_e.setInt32(G,N),G+=4);else{let Z;if((Z=this.useFloat32)>0&&N<4294967296&&N>=-2147483648){q[G++]=202,_e.setFloat32(G,N);let $;if(Z<4||($=N*xd[(q[G]&127)<<1|q[G+1]>>7])>>0===$){G+=4;return}else G--}q[G++]=203,_e.setFloat64(G,N),G+=8}else if(E==="object"||E==="function")if(!N)q[G++]=192;else{if(s){let $=s.get(N);if($){if(!$.id){let st=s.idsToInsert||(s.idsToInsert=[]);$.id=st.push($)}q[G++]=214,q[G++]=112,_e.setUint32(G,$.id),G+=4;return}else s.set(N,{offset:G-n})}let Z=N.constructor;if(Z===Object)U(N);else if(Z===Array)T(N);else if(Z===Map)if(this.mapAsEmptyObject)q[G++]=128;else{D=N.size,D<16?q[G++]=128|D:D<65536?(q[G++]=222,q[G++]=D>>8,q[G++]=D&255):(q[G++]=223,_e.setUint32(G,D),G+=4);for(let[$,st]of N)A($),A(st)}else{for(let $=0,st=Ed.length;$<st;$++){let rt=Zy[$];if(N instanceof rt){let at=Ed[$];if(at.write){at.type&&(q[G++]=212,q[G++]=at.type,q[G++]=0);let ht=at.write.call(this,N);ht===N?Array.isArray(N)?T(N):U(N):A(ht);return}let Y=q,H=_e,wt=G;q=null;let lt;try{lt=at.pack.call(this,N,ht=>(q=Y,Y=null,G+=ht,G>Rn&&I(G),{target:q,targetView:_e,position:G-ht}),A)}finally{Y&&(q=Y,_e=H,G=wt,Rn=q.length-10)}lt&&(lt.length+G>Rn&&I(lt.length+G),G=ZI(lt,q,G,at.type));return}}if(Array.isArray(N))T(N);else{if(N.toJSON){const $=N.toJSON();if($!==N)return A($)}if(E==="function")return A(this.writeFunction&&this.writeFunction(N));U(N)}}}else if(E==="boolean")q[G++]=N?195:194;else if(E==="bigint"){if(N<BigInt(1)<<BigInt(63)&&N>=-(BigInt(1)<<BigInt(63)))q[G++]=211,_e.setBigInt64(G,N);else if(N<BigInt(1)<<BigInt(64)&&N>0)q[G++]=207,_e.setBigUint64(G,N);else if(this.largeBigIntToFloat)q[G++]=203,_e.setFloat64(G,Number(N));else{if(this.largeBigIntToString)return A(N.toString());if(this.useBigIntExtension&&N<BigInt(2)**BigInt(1023)&&N>-(BigInt(2)**BigInt(1023))){q[G++]=199,G++,q[G++]=66;let Z=[],$;do{let st=N&BigInt(255);$=(st&BigInt(128))===(N<BigInt(0)?BigInt(128):BigInt(0)),Z.push(st),N>>=BigInt(8)}while(!((N===BigInt(0)||N===BigInt(-1))&&$));q[G-2]=Z.length;for(let st=Z.length;st>0;)q[G++]=Number(Z[--st]);return}else throw new RangeError(N+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}G+=8}else if(E==="undefined")this.encodeUndefinedAsNil?q[G++]=192:(q[G++]=212,q[G++]=0,q[G++]=0);else throw new Error("Unknown type: "+E)},C=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?N=>{let E;if(this.skipValues){E=[];for(let $ in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty($))&&!this.skipValues.includes(N[$])&&E.push($)}else E=Object.keys(N);let D=E.length;D<16?q[G++]=128|D:D<65536?(q[G++]=222,q[G++]=D>>8,q[G++]=D&255):(q[G++]=223,_e.setUint32(G,D),G+=4);let Z;if(this.coercibleKeyAsNumber)for(let $=0;$<D;$++){Z=E[$];let st=Number(Z);A(isNaN(st)?Z:st),A(N[Z])}else for(let $=0;$<D;$++)A(Z=E[$]),A(N[Z])}:N=>{q[G++]=222;let E=G-n;G+=2;let D=0;for(let Z in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(Z))&&(A(Z),A(N[Z]),D++);if(D>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');q[E+++n]=D>>8,q[E+n]=D&255},R=this.useRecords===!1?C:e.progressiveRecords&&!f?N=>{let E,D=i.transitions||(i.transitions=Object.create(null)),Z=G++-n,$;for(let st in N)if(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st)){if(E=D[st],E)D=E;else{let rt=Object.keys(N),at=D;D=i.transitions;let Y=0;for(let H=0,wt=rt.length;H<wt;H++){let lt=rt[H];E=D[lt],E||(E=D[lt]=Object.create(null),Y++),D=E}Z+n+1==G?(G--,P(D,rt,Y)):W(D,rt,Z,Y),$=!0,D=at[st]}A(N[st])}if(!$){let st=D[Wo];st?q[Z+n]=st:W(D,Object.keys(N),Z,0)}}:N=>{let E,D=i.transitions||(i.transitions=Object.create(null)),Z=0;for(let st in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st))&&(E=D[st],E||(E=D[st]=Object.create(null),Z++),D=E);let $=D[Wo];$?$>=96&&f?(q[G++]=(($-=96)&31)+96,q[G++]=$>>5):q[G++]=$:P(D,D.__keys__||Object.keys(N),Z);for(let st in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st))&&A(N[st])},S=typeof this.useRecords=="function"&&this.useRecords,U=S?N=>{S(N)?R(N):C(N)}:R,I=N=>{let E;if(N>16777216){if(N-n>qy)throw new Error("Packed buffer would be larger than maximum buffer size");E=Math.min(qy,Math.round(Math.max((N-n)*(N>67108864?1.25:2),4194304)/4096)*4096)}else E=(Math.max(N-n<<2,q.length-1)>>12)+1<<12;let D=new Vl(E);return _e=D.dataView||(D.dataView=new DataView(D.buffer,0,E)),N=Math.min(N,q.length),q.copy?q.copy(D,0,n,N):D.set(q.slice(n,N)),G-=n,n=0,Rn=D.length-10,q=D},P=(N,E,D)=>{let Z=i.nextId;Z||(Z=64),Z<h&&this.shouldShareStructure&&!this.shouldShareStructure(E)?(Z=i.nextOwnId,Z<p||(Z=h),i.nextOwnId=Z+1):(Z>=p&&(Z=h),i.nextId=Z+1);let $=E.highByte=Z>=96&&f?Z-96>>5:-1;N[Wo]=Z,N.__keys__=E,i[Z-64]=E,Z<h?(E.isShared=!0,i.sharedLength=Z-63,r=!0,$>=0?(q[G++]=(Z&31)+96,q[G++]=$):q[G++]=Z):($>=0?(q[G++]=213,q[G++]=114,q[G++]=(Z&31)+96,q[G++]=$):(q[G++]=212,q[G++]=114,q[G++]=Z),D&&(b+=_*D),m.length>=d&&(m.shift()[Wo]=0),m.push(N),A(E))},W=(N,E,D,Z)=>{let $=q,st=G,rt=Rn,at=n;q=sc,G=0,n=0,q||(sc=q=new Vl(8192)),Rn=q.length-10,P(N,E,Z),sc=q;let Y=G;if(q=$,G=st,Rn=rt,n=at,Y>1){let H=G+Y-1;H>Rn&&I(H);let wt=D+n;q.copyWithin(wt+Y,wt+1,G),q.set(sc.slice(0,Y),wt),G=H}else q[D+n]=sc[0]},L=N=>{let E=HI(N,q,n,G,i,I,(D,Z,$)=>{if($)return r=!0;G=Z;let st=q;return A(D),v(),st!==q?{position:G,targetView:_e,target:q}:G},this);if(E===0)return U(N);G=E}}useBuffer(e){q=e,q.dataView||(q.dataView=new DataView(q.buffer,q.byteOffset,q.byteLength)),G=0}set position(e){G=e}get position(){return G}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Zy=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Cy],Ed=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?Jy(t,16,e):Qy(Yl?dn.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==Xy&&this.moreTypes?Jy(t,Yy.indexOf(n.name),e):Qy(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function Jy(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function Qy(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function ZI(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function XI(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function tb(t,e,n){if(Le.length>0){_e.setUint32(Le.position+t,G+n-Le.position-t),Le.stringsPosition=G-t;let r=Le;Le=null,e(r[0]),e(r[1])}}function qI(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let eb=new VI({useRecords:!1});const JI=eb.pack;eb.pack;const QI=512,tN=1024,eN=2048,tt=ho("SOFTWARE");function Re(){return null}function Ho(t,e,n={}){if(!x(t))return;const r=[],i=Object.keys(t);for(let s=0;s<i.length;++s){let o=i[s],a=t[o];const c=n[o];x(c)&&(a=c(a));const l=e[o];x(l)&&(o=l),a!==null&&r.push(o,a)}return r}function oc(t,e,n={}){if(x(t))try{const r={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];x(a)&&(s=a);const c=n[s];x(c)&&(o=c(o)),r[s]=o}return r}catch(r){de(tt,"","binary",r.message)}}function nN(t){try{const e=Qn(t);return JI(e)}catch(e){de(tt,"","binary",e.message)}}function rN(t){try{return KI(t)}catch(e){de(tt,"","binary",e.message)}}function nb(){return{id:je()}}var Zl=(t=>(t[t.kind=0]="kind",t[t.id=1]="id",t[t.x=2]="x",t[t.y=3]="y",t[t.lx=4]="lx",t[t.ly=5]="ly",t[t.code=6]="code",t[t.name=7]="name",t[t.char=8]="char",t[t.color=9]="color",t[t.bg=10]="bg",t[t.light=11]="light",t[t.player=12]="player",t[t.bucket=13]="bucket",t[t.pushable=14]="pushable",t[t.collision=15]="collision",t[t.breakable=16]="breakable",t[t.tickertext=17]="tickertext",t[t.tickertime=18]="tickertime",t[t.p1=19]="p1",t[t.p2=20]="p2",t[t.p3=21]="p3",t[t.cycle=22]="cycle",t[t.stepx=23]="stepx",t[t.stepy=24]="stepy",t[t.sender=25]="sender",t[t.arg=26]="arg",t[t.stopped=27]="stopped",t[t.removed=28]="removed",t[t.party=29]="party",t[t.group=30]="group",t[t.lightdir=31]="lightdir",t))(Zl||{});function Xl(t){return x(t==null?void 0:t.id)?Ho(t,Zl,{category:Re,kinddata:Re,stopped:Re,removed:Re,bucket:Re}):Ho(t,Zl,{id:Re,x:Re,y:Re,lx:Re,ly:Re,code:Re,category:Re,kinddata:Re,stopped:Re,removed:Re,bucket:Re})}function ql(t){return oc(t,Zl)}function mn(t){var e;return(((e=t==null?void 0:t.id)==null?void 0:e.length)??0)>0}function ac(t,e){if(!x(t)||!oi(e))return;const{color:n,bg:r}=Sy(e);x(n)&&(t.color=n),x(r)&&(t.bg=r)}function Ci(t){var e;return Ot((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"")}const Tt=60,Ht=25,vd=Tt*Ht;var _t=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(_t||{});function iN(){return new Array(Tt*Ht).map(()=>{})}function Jl(t=Oh){const e={terrain:iN(),objects:{},id:""};return t(e)}var kd=(t=>(t[t.terrain=0]="terrain",t[t.objects=1]="objects",t[t.isdark=2]="isdark",t[t.over=3]="over",t[t.under=4]="under",t[t.exitnorth=5]="exitnorth",t[t.exitsouth=6]="exitsouth",t[t.exitwest=7]="exitwest",t[t.exiteast=8]="exiteast",t[t.timelimit=9]="timelimit",t[t.restartonzap=10]="restartonzap",t[t.maxplayershots=11]="maxplayershots",t[t.camera=12]="camera",t[t.graphics=13]="graphics",t))(kd||{});function sN(t){return Ho(t,kd,{terrain:e=>e.map(Xl),objects:e=>Object.values(e).filter(n=>!n.removed).map(Xl),id:Re,named:Re,lookup:Re,codepage:Re,distmaps:Re,overboard:Re,underboard:Re})}function oN(t){return oc(t,kd,{terrain:e=>e.map(ql),objects:e=>{const n={};for(let r=0;r<e.length;++r){const i=ql(e[r]);x(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Ql(t){return $o(t.x,t.y,0,Tt-1,Ht-1,0)}function Br(t,e){return!x(t)||!x(e==null?void 0:e.x)||!x(e==null?void 0:e.y)||e.x<0||e.x>=Tt||e.y<0||e.y>=Ht?-1:e.x+e.y*Tt}function te(t,e){const n=Br(t,e);if(n<0||!x(t==null?void 0:t.lookup))return;const r=Sn(t,t.lookup[n]??"");return x(r)?r:t.terrain[n]}function aN(t,e){const n=Sn(t,e);if(x(n))return n;const r=parseFloat(e),i=bI(isNaN(r)?-1:r,Tt);return cs(t,i.x,i.y)}function cs(t,e,n){return(e>=0&&e<Tt)??(n>=0&&n<Ht)?t==null?void 0:t.terrain[e+n*Tt]:void 0}function Se(t,e){if(!x(t)||!x(e)||!x(e.x)||!x(e.y)||e.x<0||e.x>=Tt||e.y<0||e.y>=Ht)return;const n=Qn(e),r=e.x+e.y*Tt;return t.terrain[r]=n,delete t.distmaps,t.terrain[r]}function Td(t,e){if(!x(t)||!x(e))return;const n=Qn(e);return n.id=n.id??je(),t.objects[n.id]=n,t.objects[n.id]}function cN(t,e,n){return Se(t,{...e,kind:n})}function Ad(t,e,n,r){return Td(t,{...e,kind:n,id:r})}function Sn(t,e){if(t)return t.objects[e]}function lN(t,e){const n=Br(t,e);if(n<0||!x(t==null?void 0:t.lookup))return;const r=Sn(t,t.lookup[n]??"");if(x(r))return r}function rb(t,e){return x(t==null?void 0:t.objects[e])?(delete t.objects[e],!0):!1}function uN(t,e,n){if(!x(t)||!x(e))return;const r=t.objects[n];if(x(r))return r;if(Hs(e))return sb(e,uc(t,"player"))}function cc(t,e){const n=t??Mt.ISWALK,r=e??Mt.ISWALK;switch(n){case Mt.ISWALK:return r!==Mt.ISWALK;case Mt.ISSWIM:return r!==Mt.ISSWIM;case Mt.ISSOLID:return!0;case Mt.ISBULLET:return r!==Mt.ISWALK&&r!==Mt.ISSWIM}}function lc(t,e,n){const r=t==null?void 0:t.objects[n];if(x(r))return r;const i=uc(t,"player");return x(e)?(e.x<0&&(e.x=br(0,Tt-1)),e.y<0&&(e.y=br(0,Ht-1)),sb(e,i)):Ae(...i)}function uc(t,e){var r,i;return[...((i=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?t==null?void 0:t.objects[s]:t==null?void 0:t.terrain[s]).filter(x)}function hN(t){const e=[];for(let n=0;n<Ht;++n)for(let r=0;r<Tt;++r){const i={x:r,y:n},s=te(t,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&e.push(i)}return e}function Rd(t,e){const n=Kl(e),r=pd(e),i=Iy(e);return uc(t,n??"").filter(s=>{var o,a,c;return!(x(n)&&Ot((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||x(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??At.WHITE)!==r||x(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??At.BLACK)!==i)}).filter(x)}function ib(t,e){return x(t)?e.map(n=>{var r;if(typeof n=="string"){const i=t.objects[n];if(x(i))return i;const s=uc(t,Ot(n));if(s.length)return s}else if(Hs(n)&&n.x>=0&&n.x<Tt&&n.y>=0&&n.y<Ht){const i=n.x+n.y*Tt,s=(r=t.lookup)==null?void 0:r[i];return x(s)?t.objects[s]:t.terrain[i]}}).flat().filter(x):[]}function sb(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function ob(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}const Sd=14,hc=3,ls=8,us=14,tu=16,fN=16,dN=16;var eu=(t=>(t[t.FAR=1]="FAR",t[t.MID=1.5]="MID",t[t.NEAR=3]="NEAR",t))(eu||{});function fc(t,e){return new Array(t).fill(e)}function pN(t,e,n,r,i,s=0){const o=r*i;return{id:`tiles:${t}:${e}`,type:1,tag:n,width:r,height:i,char:fc(o,0),color:fc(o,0),bg:fc(o,s),wall:fc(o,0)}}function mN(t,e,n,r=1,i=15){return{id:`sprites:${t}:${e}:${n}`,x:0,y:0,char:r,color:i,bg:At.ONCLEAR}}function gN(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function _N(t,e,n,r,i=0){const s=n*r;return{id:`dither:${t}:${e}`,type:3,width:n,height:r,alphas:fc(s,i)}}function yN(t,e,n,r){return{id:`media:${t}:${e}`,type:4,mime:n,media:r}}function bN(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:1.5,graphics:"flat",facing:0}}function ab(t,e){return`${t}:${e}`}const wN=1,xN=16,EN=256;var On=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(On||{});function Od(t){const e=Math.floor(t.length/hc);if(e*hc!==t.length)return;const n=ob(3,e);for(let r=0;r<n.bits.length;++r)n.bits[r]=t[r];return n}function vN(t,e){return t&1<<e?255:0}function cb(t){const e=Math.floor(t.length/Sd);if(e*Sd!==t.length)return;const n=Math.ceil(e/tu),r=ls*tu,i=ob(r,us*n);let s=0,o=0,a=0;for(let c=0;c<t.length;++c){const l=o*us+a,u=t[c];for(let d=0;d<ls;++d){const f=s*ls+d;i.bits[f+l*r]=vN(u,7-d)}++a,a===us&&(a=0,++s,s===tu&&(s=0,++o))}return i}const kN=ml("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),lb=ml("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var ub=typeof ko=="object"&&ko&&ko.Object===Object&&ko,TN=typeof self=="object"&&self&&self.Object===Object&&self,ci=ub||TN||Function("return this")(),Er=ci.Symbol,hb=Object.prototype,AN=hb.hasOwnProperty,RN=hb.toString,dc=Er?Er.toStringTag:void 0;function SN(t){var e=AN.call(t,dc),n=t[dc];try{t[dc]=void 0;var r=!0}catch{}var i=RN.call(t);return r&&(e?t[dc]=n:delete t[dc]),i}var ON=Object.prototype,IN=ON.toString;function NN(t){return IN.call(t)}var CN="[object Null]",LN="[object Undefined]",fb=Er?Er.toStringTag:void 0;function hs(t){return t==null?t===void 0?LN:CN:fb&&fb in Object(t)?SN(t):NN(t)}function Pr(t){return t!=null&&typeof t=="object"}var MN="[object Symbol]";function nu(t){return typeof t=="symbol"||Pr(t)&&hs(t)==MN}function ru(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var ee=Array.isArray,UN=1/0,db=Er?Er.prototype:void 0,pb=db?db.toString:void 0;function mb(t){if(typeof t=="string")return t;if(ee(t))return ru(t,mb)+"";if(nu(t))return pb?pb.call(t):"";var e=t+"";return e=="0"&&1/t==-UN?"-0":e}var FN=/\s/;function BN(t){for(var e=t.length;e--&&FN.test(t.charAt(e)););return e}var PN=/^\s+/;function DN(t){return t&&t.slice(0,BN(t)+1).replace(PN,"")}function vr(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var gb=NaN,$N=/^[-+]0x[0-9a-f]+$/i,jN=/^0b[01]+$/i,zN=/^0o[0-7]+$/i,KN=parseInt;function WN(t){if(typeof t=="number")return t;if(nu(t))return gb;if(vr(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=vr(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=DN(t);var n=jN.test(t);return n||zN.test(t)?KN(t.slice(2),n?2:8):$N.test(t)?gb:+t}var _b=1/0,HN=17976931348623157e292;function GN(t){if(!t)return t===0?t:0;if(t=WN(t),t===_b||t===-_b){var e=t<0?-1:1;return e*HN}return t===t?t:0}function iu(t){var e=GN(t),n=e%1;return e===e?n?e-n:e:0}function Go(t){return t}var YN="[object AsyncFunction]",VN="[object Function]",ZN="[object GeneratorFunction]",XN="[object Proxy]";function Li(t){if(!vr(t))return!1;var e=hs(t);return e==VN||e==ZN||e==YN||e==XN}var Id=ci["__core-js_shared__"],yb=function(){var t=/[^.]+$/.exec(Id&&Id.keys&&Id.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function qN(t){return!!yb&&yb in t}var JN=Function.prototype,QN=JN.toString;function Ys(t){if(t!=null){try{return QN.call(t)}catch{}try{return t+""}catch{}}return""}var tC=/[\\^$.*+?()[\]{}|]/g,eC=/^\[object .+?Constructor\]$/,nC=Function.prototype,rC=Object.prototype,iC=nC.toString,sC=rC.hasOwnProperty,oC=RegExp("^"+iC.call(sC).replace(tC,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function aC(t){if(!vr(t)||qN(t))return!1;var e=Li(t)?oC:eC;return e.test(Ys(t))}function cC(t,e){return t==null?void 0:t[e]}function Vs(t,e){var n=cC(t,e);return aC(n)?n:void 0}var Nd=Vs(ci,"WeakMap"),bb=Object.create,lC=function(){function t(){}return function(e){if(!vr(e))return{};if(bb)return bb(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function uC(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function en(){}function hC(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var fC=800,dC=16,pC=Date.now;function mC(t){var e=0,n=0;return function(){var r=pC(),i=dC-(r-n);if(n=r,i>0){if(++e>=fC)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function gC(t){return function(){return t}}var su=function(){try{var t=Vs(Object,"defineProperty");return t({},"",{}),t}catch{}}(),_C=su?function(t,e){return su(t,"toString",{configurable:!0,enumerable:!1,value:gC(e),writable:!0})}:Go,yC=mC(_C);function wb(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function xb(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function bC(t){return t!==t}function wC(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function Cd(t,e,n){return e===e?wC(t,e,n):xb(t,bC,n)}function Eb(t,e){var n=t==null?0:t.length;return!!n&&Cd(t,e,0)>-1}var xC=9007199254740991,EC=/^(?:0|[1-9]\d*)$/;function ou(t,e){var n=typeof t;return e=e??xC,!!e&&(n=="number"||n!="symbol"&&EC.test(t))&&t>-1&&t%1==0&&t<e}function Ld(t,e,n){e=="__proto__"&&su?su(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function pc(t,e){return t===e||t!==t&&e!==e}var vC=Object.prototype,kC=vC.hasOwnProperty;function au(t,e,n){var r=t[e];(!(kC.call(t,e)&&pc(r,n))||n===void 0&&!(e in t))&&Ld(t,e,n)}function Md(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?Ld(n,a,c):au(n,a,c)}return n}var vb=Math.max;function TC(t,e,n){return e=vb(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=vb(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),uC(t,this,a)}}function Ud(t,e){return yC(TC(t,e,Go),t+"")}var AC=9007199254740991;function Fd(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=AC}function li(t){return t!=null&&Fd(t.length)&&!Li(t)}function kb(t,e,n){if(!vr(n))return!1;var r=typeof e;return(r=="number"?li(n)&&ou(e,n.length):r=="string"&&e in n)?pc(n[e],t):!1}function RC(t){return Ud(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&kb(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var SC=Object.prototype;function mc(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||SC;return t===n}function OC(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var IC="[object Arguments]";function Tb(t){return Pr(t)&&hs(t)==IC}var Ab=Object.prototype,NC=Ab.hasOwnProperty,CC=Ab.propertyIsEnumerable,cu=Tb(function(){return arguments}())?Tb:function(t){return Pr(t)&&NC.call(t,"callee")&&!CC.call(t,"callee")};function LC(){return!1}var Rb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Sb=Rb&&typeof module=="object"&&module&&!module.nodeType&&module,MC=Sb&&Sb.exports===Rb,Ob=MC?ci.Buffer:void 0,UC=Ob?Ob.isBuffer:void 0,gc=UC||LC,FC="[object Arguments]",BC="[object Array]",PC="[object Boolean]",DC="[object Date]",$C="[object Error]",jC="[object Function]",zC="[object Map]",KC="[object Number]",WC="[object Object]",HC="[object RegExp]",GC="[object Set]",YC="[object String]",VC="[object WeakMap]",ZC="[object ArrayBuffer]",XC="[object DataView]",qC="[object Float32Array]",JC="[object Float64Array]",QC="[object Int8Array]",t6="[object Int16Array]",e6="[object Int32Array]",n6="[object Uint8Array]",r6="[object Uint8ClampedArray]",i6="[object Uint16Array]",s6="[object Uint32Array]",xe={};xe[qC]=xe[JC]=xe[QC]=xe[t6]=xe[e6]=xe[n6]=xe[r6]=xe[i6]=xe[s6]=!0,xe[FC]=xe[BC]=xe[ZC]=xe[PC]=xe[XC]=xe[DC]=xe[$C]=xe[jC]=xe[zC]=xe[KC]=xe[WC]=xe[HC]=xe[GC]=xe[YC]=xe[VC]=!1;function o6(t){return Pr(t)&&Fd(t.length)&&!!xe[hs(t)]}function lu(t){return function(e){return t(e)}}var Ib=typeof exports=="object"&&exports&&!exports.nodeType&&exports,_c=Ib&&typeof module=="object"&&module&&!module.nodeType&&module,a6=_c&&_c.exports===Ib,Bd=a6&&ub.process,fs=function(){try{var t=_c&&_c.require&&_c.require("util").types;return t||Bd&&Bd.binding&&Bd.binding("util")}catch{}}(),Nb=fs&&fs.isTypedArray,Pd=Nb?lu(Nb):o6,c6=Object.prototype,l6=c6.hasOwnProperty;function Cb(t,e){var n=ee(t),r=!n&&cu(t),i=!n&&!r&&gc(t),s=!n&&!r&&!i&&Pd(t),o=n||r||i||s,a=o?OC(t.length,String):[],c=a.length;for(var l in t)(e||l6.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||ou(l,c)))&&a.push(l);return a}function Lb(t,e){return function(n){return t(e(n))}}var u6=Lb(Object.keys,Object),h6=Object.prototype,f6=h6.hasOwnProperty;function Mb(t){if(!mc(t))return u6(t);var e=[];for(var n in Object(t))f6.call(t,n)&&n!="constructor"&&e.push(n);return e}function kr(t){return li(t)?Cb(t):Mb(t)}var d6=Object.prototype,p6=d6.hasOwnProperty,Dn=RC(function(t,e){if(mc(e)||li(e)){Md(e,kr(e),t);return}for(var n in e)p6.call(e,n)&&au(t,n,e[n])});function m6(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var g6=Object.prototype,_6=g6.hasOwnProperty;function y6(t){if(!vr(t))return m6(t);var e=mc(t),n=[];for(var r in t)r=="constructor"&&(e||!_6.call(t,r))||n.push(r);return n}function Ub(t){return li(t)?Cb(t,!0):y6(t)}var b6=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,w6=/^\w*$/;function Dd(t,e){if(ee(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||nu(t)?!0:w6.test(t)||!b6.test(t)||e!=null&&t in Object(e)}var yc=Vs(Object,"create");function x6(){this.__data__=yc?yc(null):{},this.size=0}function E6(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var v6="__lodash_hash_undefined__",k6=Object.prototype,T6=k6.hasOwnProperty;function A6(t){var e=this.__data__;if(yc){var n=e[t];return n===v6?void 0:n}return T6.call(e,t)?e[t]:void 0}var R6=Object.prototype,S6=R6.hasOwnProperty;function O6(t){var e=this.__data__;return yc?e[t]!==void 0:S6.call(e,t)}var I6="__lodash_hash_undefined__";function N6(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=yc&&e===void 0?I6:e,this}function Zs(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Zs.prototype.clear=x6,Zs.prototype.delete=E6,Zs.prototype.get=A6,Zs.prototype.has=O6,Zs.prototype.set=N6;function C6(){this.__data__=[],this.size=0}function uu(t,e){for(var n=t.length;n--;)if(pc(t[n][0],e))return n;return-1}var L6=Array.prototype,M6=L6.splice;function U6(t){var e=this.__data__,n=uu(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():M6.call(e,n,1),--this.size,!0}function F6(t){var e=this.__data__,n=uu(e,t);return n<0?void 0:e[n][1]}function B6(t){return uu(this.__data__,t)>-1}function P6(t,e){var n=this.__data__,r=uu(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Mi(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Mi.prototype.clear=C6,Mi.prototype.delete=U6,Mi.prototype.get=F6,Mi.prototype.has=B6,Mi.prototype.set=P6;var bc=Vs(ci,"Map");function D6(){this.size=0,this.__data__={hash:new Zs,map:new(bc||Mi),string:new Zs}}function $6(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function hu(t,e){var n=t.__data__;return $6(e)?n[typeof e=="string"?"string":"hash"]:n.map}function j6(t){var e=hu(this,t).delete(t);return this.size-=e?1:0,e}function z6(t){return hu(this,t).get(t)}function K6(t){return hu(this,t).has(t)}function W6(t,e){var n=hu(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Ui(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ui.prototype.clear=D6,Ui.prototype.delete=j6,Ui.prototype.get=z6,Ui.prototype.has=K6,Ui.prototype.set=W6;var H6="Expected a function";function $d(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(H6);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new($d.Cache||Ui),n}$d.Cache=Ui;var G6=500;function Y6(t){var e=$d(t,function(r){return n.size===G6&&n.clear(),r}),n=e.cache;return e}var V6=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Z6=/\\(\\)?/g,X6=Y6(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(V6,function(n,r,i,s){e.push(i?s.replace(Z6,"$1"):r||n)}),e});function Fb(t){return t==null?"":mb(t)}function fu(t,e){return ee(t)?t:Dd(t,e)?[t]:X6(Fb(t))}var q6=1/0;function wc(t){if(typeof t=="string"||nu(t))return t;var e=t+"";return e=="0"&&1/t==-q6?"-0":e}function jd(t,e){e=fu(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[wc(e[n++])];return n&&n==r?t:void 0}function J6(t,e,n){var r=t==null?void 0:jd(t,e);return r===void 0?n:r}function zd(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var Bb=Er?Er.isConcatSpreadable:void 0;function Q6(t){return ee(t)||cu(t)||!!(Bb&&t&&t[Bb])}function Kd(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=Q6),i||(i=[]);++s<o;){var a=t[s];n(a)?zd(i,a):r||(i[i.length]=a)}return i}function ar(t){var e=t==null?0:t.length;return e?Kd(t):[]}var Pb=Lb(Object.getPrototypeOf,Object);function Wd(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function tL(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:Wd(t,e,n)}var eL="\\ud800-\\udfff",nL="\\u0300-\\u036f",rL="\\ufe20-\\ufe2f",iL="\\u20d0-\\u20ff",sL=nL+rL+iL,oL="\\ufe0e\\ufe0f",aL="\\u200d",cL=RegExp("["+aL+eL+sL+oL+"]");function Db(t){return cL.test(t)}function lL(t){return t.split("")}var $b="\\ud800-\\udfff",uL="\\u0300-\\u036f",hL="\\ufe20-\\ufe2f",fL="\\u20d0-\\u20ff",dL=uL+hL+fL,pL="\\ufe0e\\ufe0f",mL="["+$b+"]",Hd="["+dL+"]",Gd="\\ud83c[\\udffb-\\udfff]",gL="(?:"+Hd+"|"+Gd+")",jb="[^"+$b+"]",zb="(?:\\ud83c[\\udde6-\\uddff]){2}",Kb="[\\ud800-\\udbff][\\udc00-\\udfff]",_L="\\u200d",Wb=gL+"?",Hb="["+pL+"]?",yL="(?:"+_L+"(?:"+[jb,zb,Kb].join("|")+")"+Hb+Wb+")*",bL=Hb+Wb+yL,wL="(?:"+[jb+Hd+"?",Hd,zb,Kb,mL].join("|")+")",xL=RegExp(Gd+"(?="+Gd+")|"+wL+bL,"g");function EL(t){return t.match(xL)||[]}function vL(t){return Db(t)?EL(t):lL(t)}function kL(t){return function(e){e=Fb(e);var n=Db(e)?vL(e):void 0,r=n?n[0]:e.charAt(0),i=n?tL(n,1).join(""):e.slice(1);return r[t]()+i}}var Gb=kL("toUpperCase");function TL(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function AL(){this.__data__=new Mi,this.size=0}function RL(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function SL(t){return this.__data__.get(t)}function OL(t){return this.__data__.has(t)}var IL=200;function NL(t,e){var n=this.__data__;if(n instanceof Mi){var r=n.__data__;if(!bc||r.length<IL-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ui(r)}return n.set(t,e),this.size=n.size,this}function ui(t){var e=this.__data__=new Mi(t);this.size=e.size}ui.prototype.clear=AL,ui.prototype.delete=RL,ui.prototype.get=SL,ui.prototype.has=OL,ui.prototype.set=NL;function CL(t,e){return t&&Md(e,kr(e),t)}var Yb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Vb=Yb&&typeof module=="object"&&module&&!module.nodeType&&module,LL=Vb&&Vb.exports===Yb,Zb=LL?ci.Buffer:void 0,Xb=Zb?Zb.allocUnsafe:void 0;function ML(t,e){var n=t.length,r=Xb?Xb(n):new t.constructor(n);return t.copy(r),r}function Yd(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function qb(){return[]}var UL=Object.prototype,FL=UL.propertyIsEnumerable,Jb=Object.getOwnPropertySymbols,Vd=Jb?function(t){return t==null?[]:(t=Object(t),Yd(Jb(t),function(e){return FL.call(t,e)}))}:qb;function BL(t,e){return Md(t,Vd(t),e)}var PL=Object.getOwnPropertySymbols,DL=PL?function(t){for(var e=[];t;)zd(e,Vd(t)),t=Pb(t);return e}:qb;function Qb(t,e,n){var r=e(t);return ee(t)?r:zd(r,n(t))}function Zd(t){return Qb(t,kr,Vd)}function $L(t){return Qb(t,Ub,DL)}var Xd=Vs(ci,"DataView"),qd=Vs(ci,"Promise"),Yo=Vs(ci,"Set"),t1="[object Map]",jL="[object Object]",e1="[object Promise]",n1="[object Set]",r1="[object WeakMap]",i1="[object DataView]",zL=Ys(Xd),KL=Ys(bc),WL=Ys(qd),HL=Ys(Yo),GL=Ys(Nd),Tr=hs;(Xd&&Tr(new Xd(new ArrayBuffer(1)))!=i1||bc&&Tr(new bc)!=t1||qd&&Tr(qd.resolve())!=e1||Yo&&Tr(new Yo)!=n1||Nd&&Tr(new Nd)!=r1)&&(Tr=function(t){var e=hs(t),n=e==jL?t.constructor:void 0,r=n?Ys(n):"";if(r)switch(r){case zL:return i1;case KL:return t1;case WL:return e1;case HL:return n1;case GL:return r1}return e});var YL=Object.prototype,VL=YL.hasOwnProperty;function ZL(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&VL.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var du=ci.Uint8Array;function XL(t){var e=new t.constructor(t.byteLength);return new du(e).set(new du(t)),e}function qL(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var JL=/\w*$/;function QL(t){var e=new t.constructor(t.source,JL.exec(t));return e.lastIndex=t.lastIndex,e}var s1=Er?Er.prototype:void 0,o1=s1?s1.valueOf:void 0;function t2(t){return o1?Object(o1.call(t)):{}}function e2(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var n2="[object Boolean]",r2="[object Date]",i2="[object Map]",s2="[object Number]",o2="[object RegExp]",a2="[object Set]",c2="[object String]",l2="[object Symbol]",u2="[object ArrayBuffer]",h2="[object DataView]",f2="[object Float32Array]",d2="[object Float64Array]",p2="[object Int8Array]",m2="[object Int16Array]",g2="[object Int32Array]",_2="[object Uint8Array]",y2="[object Uint8ClampedArray]",b2="[object Uint16Array]",w2="[object Uint32Array]";function x2(t,e,n){var r=t.constructor;switch(e){case u2:return XL(t);case n2:case r2:return new r(+t);case h2:return qL(t);case f2:case d2:case p2:case m2:case g2:case _2:case y2:case b2:case w2:return e2(t);case i2:return new r;case s2:case c2:return new r(t);case o2:return QL(t);case a2:return new r;case l2:return t2(t)}}function E2(t){return typeof t.constructor=="function"&&!mc(t)?lC(Pb(t)):{}}var v2="[object Map]";function k2(t){return Pr(t)&&Tr(t)==v2}var a1=fs&&fs.isMap,T2=a1?lu(a1):k2,A2="[object Set]";function R2(t){return Pr(t)&&Tr(t)==A2}var c1=fs&&fs.isSet,S2=c1?lu(c1):R2,l1="[object Arguments]",O2="[object Array]",I2="[object Boolean]",N2="[object Date]",C2="[object Error]",u1="[object Function]",L2="[object GeneratorFunction]",M2="[object Map]",U2="[object Number]",h1="[object Object]",F2="[object RegExp]",B2="[object Set]",P2="[object String]",D2="[object Symbol]",$2="[object WeakMap]",j2="[object ArrayBuffer]",z2="[object DataView]",K2="[object Float32Array]",W2="[object Float64Array]",H2="[object Int8Array]",G2="[object Int16Array]",Y2="[object Int32Array]",V2="[object Uint8Array]",Z2="[object Uint8ClampedArray]",X2="[object Uint16Array]",q2="[object Uint32Array]",ye={};ye[l1]=ye[O2]=ye[j2]=ye[z2]=ye[I2]=ye[N2]=ye[K2]=ye[W2]=ye[H2]=ye[G2]=ye[Y2]=ye[M2]=ye[U2]=ye[h1]=ye[F2]=ye[B2]=ye[P2]=ye[D2]=ye[V2]=ye[Z2]=ye[X2]=ye[q2]=!0,ye[C2]=ye[u1]=ye[$2]=!1;function pu(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!vr(t))return t;var a=ee(t);if(a)return o=ZL(t),hC(t,o);var c=Tr(t),l=c==u1||c==L2;if(gc(t))return ML(t);if(c==h1||c==l1||l&&!i)return o=l?{}:E2(t),BL(t,CL(o,t));if(!ye[c])return i?t:{};o=x2(t,c),s||(s=new ui);var u=s.get(t);if(u)return u;s.set(t,o),S2(t)?t.forEach(function(h){o.add(pu(h,e,n,h,t,s))}):T2(t)&&t.forEach(function(h,p){o.set(p,pu(h,e,n,p,t,s))});var d=Zd,f=a?void 0:d(t);return wb(f||t,function(h,p){f&&(p=h,h=t[p]),au(o,p,pu(h,e,n,p,t,s))}),o}var J2=4;function gn(t){return pu(t,J2)}function xc(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var Q2="__lodash_hash_undefined__";function tM(t){return this.__data__.set(t,Q2),this}function eM(t){return this.__data__.has(t)}function Vo(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Ui;++e<n;)this.add(t[e])}Vo.prototype.add=Vo.prototype.push=tM,Vo.prototype.has=eM;function f1(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function Jd(t,e){return t.has(e)}var nM=1,rM=2;function d1(t,e,n,r,i,s){var o=n&nM,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var d=-1,f=!0,h=n&rM?new Vo:void 0;for(s.set(t,e),s.set(e,t);++d<a;){var p=t[d],m=e[d];if(r)var b=o?r(m,p,d,e,t,s):r(p,m,d,t,e,s);if(b!==void 0){if(b)continue;f=!1;break}if(h){if(!f1(e,function(_,v){if(!Jd(h,v)&&(p===_||i(p,_,n,r,s)))return h.push(v)})){f=!1;break}}else if(!(p===m||i(p,m,n,r,s))){f=!1;break}}return s.delete(t),s.delete(e),f}function iM(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function Qd(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var sM=1,oM=2,aM="[object Boolean]",cM="[object Date]",lM="[object Error]",uM="[object Map]",hM="[object Number]",fM="[object RegExp]",dM="[object Set]",pM="[object String]",mM="[object Symbol]",gM="[object ArrayBuffer]",_M="[object DataView]",p1=Er?Er.prototype:void 0,t0=p1?p1.valueOf:void 0;function yM(t,e,n,r,i,s,o){switch(n){case _M:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case gM:return!(t.byteLength!=e.byteLength||!s(new du(t),new du(e)));case aM:case cM:case hM:return pc(+t,+e);case lM:return t.name==e.name&&t.message==e.message;case fM:case pM:return t==e+"";case uM:var a=iM;case dM:var c=r&sM;if(a||(a=Qd),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=oM,o.set(t,e);var u=d1(a(t),a(e),r,i,s,o);return o.delete(t),u;case mM:if(t0)return t0.call(t)==t0.call(e)}return!1}var bM=1,wM=Object.prototype,xM=wM.hasOwnProperty;function EM(t,e,n,r,i,s){var o=n&bM,a=Zd(t),c=a.length,l=Zd(e),u=l.length;if(c!=u&&!o)return!1;for(var d=c;d--;){var f=a[d];if(!(o?f in e:xM.call(e,f)))return!1}var h=s.get(t),p=s.get(e);if(h&&p)return h==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var b=o;++d<c;){f=a[d];var _=t[f],v=e[f];if(r)var T=o?r(v,_,f,e,t,s):r(_,v,f,t,e,s);if(!(T===void 0?_===v||i(_,v,n,r,s):T)){m=!1;break}b||(b=f=="constructor")}if(m&&!b){var A=t.constructor,C=e.constructor;A!=C&&"constructor"in t&&"constructor"in e&&!(typeof A=="function"&&A instanceof A&&typeof C=="function"&&C instanceof C)&&(m=!1)}return s.delete(t),s.delete(e),m}var vM=1,m1="[object Arguments]",g1="[object Array]",mu="[object Object]",kM=Object.prototype,_1=kM.hasOwnProperty;function TM(t,e,n,r,i,s){var o=ee(t),a=ee(e),c=o?g1:Tr(t),l=a?g1:Tr(e);c=c==m1?mu:c,l=l==m1?mu:l;var u=c==mu,d=l==mu,f=c==l;if(f&&gc(t)){if(!gc(e))return!1;o=!0,u=!1}if(f&&!u)return s||(s=new ui),o||Pd(t)?d1(t,e,n,r,i,s):yM(t,e,c,n,r,i,s);if(!(n&vM)){var h=u&&_1.call(t,"__wrapped__"),p=d&&_1.call(e,"__wrapped__");if(h||p){var m=h?t.value():t,b=p?e.value():e;return s||(s=new ui),i(m,b,n,r,s)}}return f?(s||(s=new ui),EM(t,e,n,r,i,s)):!1}function e0(t,e,n,r,i){return t===e?!0:t==null||e==null||!Pr(t)&&!Pr(e)?t!==t&&e!==e:TM(t,e,n,r,e0,i)}var AM=1,RM=2;function SM(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new ui,d;if(!(d===void 0?e0(l,c,AM|RM,r,u):d))return!1}}return!0}function y1(t){return t===t&&!vr(t)}function OM(t){for(var e=kr(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,y1(i)]}return e}function b1(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function IM(t){var e=OM(t);return e.length==1&&e[0][2]?b1(e[0][0],e[0][1]):function(n){return n===t||SM(n,t,e)}}function NM(t,e){return t!=null&&e in Object(t)}function w1(t,e,n){e=fu(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=wc(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&Fd(i)&&ou(o,i)&&(ee(t)||cu(t)))}function CM(t,e){return t!=null&&w1(t,e,NM)}var LM=1,MM=2;function UM(t,e){return Dd(t)&&y1(e)?b1(wc(t),e):function(n){var r=J6(n,t);return r===void 0&&r===e?CM(n,t):e0(e,r,LM|MM)}}function FM(t){return function(e){return e==null?void 0:e[t]}}function BM(t){return function(e){return jd(e,t)}}function PM(t){return Dd(t)?FM(wc(t)):BM(t)}function hi(t){return typeof t=="function"?t:t==null?Go:typeof t=="object"?ee(t)?UM(t[0],t[1]):IM(t):PM(t)}function DM(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function $M(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var jM=$M();function zM(t,e){return t&&jM(t,e,kr)}function KM(t,e){return function(n,r){if(n==null)return n;if(!li(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var Xs=KM(zM);function WM(t,e,n,r){return Xs(t,function(i,s,o){e(r,i,n(i),o)}),r}function HM(t,e){return function(n,r){var i=ee(n)?DM:WM,s=e?e():{};return i(n,t,hi(r),s)}}var x1=Object.prototype,GM=x1.hasOwnProperty,n0=Ud(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&kb(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=Ub(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||pc(u,x1[l])&&!GM.call(t,l))&&(t[l]=s[l])}return t});function E1(t){return Pr(t)&&li(t)}var YM=200;function VM(t,e,n,r){var i=-1,s=Eb,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=YM&&(s=Jd,o=!1,e=new Vo(e));t:for(;++i<a;){var u=t[i],d=u;if(u=u!==0?u:0,o&&d===d){for(var f=l;f--;)if(e[f]===d)continue t;c.push(u)}else s(e,d,r)||c.push(u)}return c}var gu=Ud(function(t,e){return E1(t)?VM(t,Kd(e,1,E1,!0)):[]});function Zo(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function _n(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:iu(e),Wd(t,e<0?0:e,r)):[]}function Ec(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:iu(e),e=r-e,Wd(t,0,e<0?0:e)):[]}function ZM(t){return typeof t=="function"?t:Go}function Ct(t,e){var n=ee(t)?wb:Xs;return n(t,ZM(e))}function XM(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function qM(t,e){var n=!0;return Xs(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function Dr(t,e,n){var r=ee(t)?XM:qM;return r(t,hi(e))}function v1(t,e){var n=[];return Xs(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function Ar(t,e){var n=ee(t)?Yd:v1;return n(t,hi(e))}function JM(t){return function(e,n,r){var i=Object(e);if(!li(e)){var s=hi(n);e=kr(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var QM=Math.max;function t8(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:iu(n);return i<0&&(i=QM(r+i,0)),xb(t,hi(e),i)}var Xo=JM(t8);function $r(t){return t&&t.length?t[0]:void 0}function e8(t,e){var n=-1,r=li(t)?Array(t.length):[];return Xs(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function Et(t,e){var n=ee(t)?ru:e8;return n(t,hi(e))}function Rr(t,e){return Kd(Et(t,e))}var n8=Object.prototype,r8=n8.hasOwnProperty,k1=HM(function(t,e,n){r8.call(t,n)?t[n].push(e):Ld(t,n,[e])}),i8=Object.prototype,s8=i8.hasOwnProperty;function o8(t,e){return t!=null&&s8.call(t,e)}function It(t,e){return t!=null&&w1(t,e,o8)}var a8="[object String]";function $n(t){return typeof t=="string"||!ee(t)&&Pr(t)&&hs(t)==a8}function c8(t,e){return ru(e,function(n){return t[n]})}function Ze(t){return t==null?[]:c8(t,kr(t))}var l8=Math.max;function In(t,e,n,r){t=li(t)?t:Ze(t),n=n&&!r?iu(n):0;var i=t.length;return n<0&&(n=l8(i+n,0)),$n(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Cd(t,e,n)>-1}function T1(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return Cd(t,e,i)}var u8="[object Map]",h8="[object Set]",f8=Object.prototype,d8=f8.hasOwnProperty;function be(t){if(t==null)return!0;if(li(t)&&(ee(t)||typeof t=="string"||typeof t.splice=="function"||gc(t)||Pd(t)||cu(t)))return!t.length;var e=Tr(t);if(e==u8||e==h8)return!t.size;if(mc(t))return!Mb(t).length;for(var n in t)if(d8.call(t,n))return!1;return!0}var p8="[object RegExp]";function m8(t){return Pr(t)&&hs(t)==p8}var A1=fs&&fs.isRegExp,Fi=A1?lu(A1):m8;function Bi(t){return t===void 0}var g8="Expected a function";function _8(t){if(typeof t!="function")throw new TypeError(g8);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function y8(t,e,n,r){if(!vr(t))return t;e=fu(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=wc(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=vr(u)?u:ou(e[i+1])?[]:{})}au(a,c,l),a=a[c]}return t}function b8(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=jd(t,o);n(a,o)&&y8(s,fu(o,t),a)}return s}function jr(t,e){if(t==null)return{};var n=ru($L(t),function(r){return[r]});return e=hi(e),b8(t,n,function(r,i){return e(r,i[0])})}function w8(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function jn(t,e,n){var r=ee(t)?TL:w8,i=arguments.length<3;return r(t,hi(e),n,i,Xs)}function _u(t,e){var n=ee(t)?Yd:v1;return n(t,_8(hi(e)))}function x8(t,e){var n;return Xs(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function r0(t,e,n){var r=ee(t)?f1:x8;return r(t,hi(e))}var E8=1/0,v8=Yo&&1/Qd(new Yo([,-0]))[1]==E8?function(t){return new Yo(t)}:en,k8=200;function T8(t,e,n){var r=-1,i=Eb,s=t.length,o=!0,a=[],c=a;if(s>=k8){var l=v8(t);if(l)return Qd(l);o=!1,i=Jd,c=new Vo}else c=a;t:for(;++r<s;){var u=t[r],d=u;if(u=u!==0?u:0,o&&d===d){for(var f=c.length;f--;)if(c[f]===d)continue t;a.push(u)}else i(c,d,n)||(c!==a&&c.push(d),a.push(u))}return a}function yu(t){return t&&t.length?T8(t):[]}function i0(t){console&&console.error&&console.error(`Error: ${t}`)}function R1(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function S1(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function O1(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function A8(t){return R8(t)?t.LABEL:t.name}function R8(t){return $n(t.LABEL)&&t.LABEL!==""}class fi{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Ct(this.definition,n=>{n.accept(e)})}}class zn extends fi{constructor(e){super([]),this.idx=1,Dn(this,jr(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class qo extends fi{constructor(e){super(e.definition),this.orgText="",Dn(this,jr(e,n=>n!==void 0))}}class Kn extends fi{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Dn(this,jr(e,n=>n!==void 0))}}class Wn extends fi{constructor(e){super(e.definition),this.idx=1,Dn(this,jr(e,n=>n!==void 0))}}class di extends fi{constructor(e){super(e.definition),this.idx=1,Dn(this,jr(e,n=>n!==void 0))}}class pi extends fi{constructor(e){super(e.definition),this.idx=1,Dn(this,jr(e,n=>n!==void 0))}}class nn extends fi{constructor(e){super(e.definition),this.idx=1,Dn(this,jr(e,n=>n!==void 0))}}class zr extends fi{constructor(e){super(e.definition),this.idx=1,Dn(this,jr(e,n=>n!==void 0))}}class Kr extends fi{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Dn(this,jr(e,n=>n!==void 0))}}class Me{constructor(e){this.idx=1,Dn(this,jr(e,n=>n!==void 0))}accept(e){e.visit(this)}}function S8(t){return Et(t,bu)}function bu(t){function e(n){return Et(n,bu)}if(t instanceof zn){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return $n(t.label)&&(n.label=t.label),n}else{if(t instanceof Kn)return{type:"Alternative",definition:e(t.definition)};if(t instanceof Wn)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof di)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof pi)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:bu(new Me({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof zr)return{type:"RepetitionWithSeparator",idx:t.idx,separator:bu(new Me({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof nn)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Kr)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof Me){const n={type:"Terminal",name:t.terminalType.name,label:A8(t.terminalType),idx:t.idx};$n(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=Fi(r)?r.source:r),n}else{if(t instanceof qo)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class qs{visit(e){const n=e;switch(n.constructor){case zn:return this.visitNonTerminal(n);case Kn:return this.visitAlternative(n);case Wn:return this.visitOption(n);case di:return this.visitRepetitionMandatory(n);case pi:return this.visitRepetitionMandatoryWithSeparator(n);case zr:return this.visitRepetitionWithSeparator(n);case nn:return this.visitRepetition(n);case Kr:return this.visitAlternation(n);case Me:return this.visitTerminal(n);case qo:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function O8(t){return t instanceof Kn||t instanceof Wn||t instanceof nn||t instanceof di||t instanceof pi||t instanceof zr||t instanceof Me||t instanceof qo}function wu(t,e=[]){return t instanceof Wn||t instanceof nn||t instanceof zr?!0:t instanceof Kr?r0(t.definition,r=>wu(r,e)):t instanceof zn&&In(e,t)?!1:t instanceof fi?(t instanceof zn&&e.push(t),Dr(t.definition,r=>wu(r,e))):!1}function I8(t){return t instanceof Kr}function mi(t){if(t instanceof zn)return"SUBRULE";if(t instanceof Wn)return"OPTION";if(t instanceof Kr)return"OR";if(t instanceof di)return"AT_LEAST_ONE";if(t instanceof pi)return"AT_LEAST_ONE_SEP";if(t instanceof zr)return"MANY_SEP";if(t instanceof nn)return"MANY";if(t instanceof Me)return"CONSUME";throw Error("non exhaustive match")}class xu{walk(e,n=[]){Ct(e.definition,(r,i)=>{const s=_n(e.definition,i+1);if(r instanceof zn)this.walkProdRef(r,s,n);else if(r instanceof Me)this.walkTerminal(r,s,n);else if(r instanceof Kn)this.walkFlat(r,s,n);else if(r instanceof Wn)this.walkOption(r,s,n);else if(r instanceof di)this.walkAtLeastOne(r,s,n);else if(r instanceof pi)this.walkAtLeastOneSep(r,s,n);else if(r instanceof zr)this.walkManySep(r,s,n);else if(r instanceof nn)this.walkMany(r,s,n);else if(r instanceof Kr)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new Wn({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=I1(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new Wn({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=I1(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);Ct(e.definition,s=>{const o=new Kn({definition:[s]});this.walk(o,i)})}}function I1(t,e,n){return[new Wn({definition:[new Me({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function vc(t){if(t instanceof zn)return vc(t.referencedRule);if(t instanceof Me)return L8(t);if(O8(t))return N8(t);if(I8(t))return C8(t);throw Error("non exhaustive match")}function N8(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=wu(s),e=e.concat(vc(s)),r=r+1,i=n.length>r;return yu(e)}function C8(t){const e=Et(t.definition,n=>vc(n));return yu(ar(e))}function L8(t){return[t.terminalType]}const N1="_~IN~_";class M8 extends xu{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=F8(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new Kn({definition:s}),a=vc(o);this.follows[i]=a}}function U8(t){const e={};return Ct(t,n=>{const r=new M8(n).startWalking();Dn(e,r)}),e}function F8(t,e){return t.name+e+N1}function Ut(t){return t.charCodeAt(0)}function s0(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function kc(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function Jo(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function B8(){throw Error("Internal Error - Should never get here!")}function C1(t){return t.type==="Character"}const Eu=[];for(let t=Ut("0");t<=Ut("9");t++)Eu.push(t);const vu=[Ut("_")].concat(Eu);for(let t=Ut("a");t<=Ut("z");t++)vu.push(t);for(let t=Ut("A");t<=Ut("Z");t++)vu.push(t);const L1=[Ut(" "),Ut("\f"),Ut(`
`),Ut("\r"),Ut("	"),Ut("\v"),Ut("	"),Ut(""),Ut(""),Ut(""),Ut(""),Ut(""),Ut(""),Ut(""),Ut(""),Ut(""),Ut(""),Ut(""),Ut(""),Ut(""),Ut("\u2028"),Ut("\u2029"),Ut(""),Ut(""),Ut(""),Ut("\uFEFF")],P8=/[0-9a-fA-F]/,ku=/[0-9]/,D8=/[1-9]/;class $8{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":kc(r,"global");break;case"i":kc(r,"ignoreCase");break;case"m":kc(r,"multiLine");break;case"u":kc(r,"unicode");break;case"y":kc(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}Jo(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return B8()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;Jo(n);break}if(!(e===!0&&n===void 0)&&Jo(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),Jo(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Ut(`
`),Ut("\r"),Ut("\u2028"),Ut("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=Eu;break;case"D":e=Eu,n=!0;break;case"s":e=L1;break;case"S":e=L1,n=!0;break;case"w":e=vu;break;case"W":e=vu,n=!0;break}if(Jo(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=Ut("\f");break;case"n":e=Ut(`
`);break;case"r":e=Ut("\r");break;case"t":e=Ut("	");break;case"v":e=Ut("\v");break}if(Jo(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Ut("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:Ut(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:Ut(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,C1(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,C1(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else s0(r.value,e),e.push(Ut("-")),s0(i.value,e)}else s0(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Ut("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(D8.test(e)===!1)throw Error("Expecting a positive integer");for(;ku.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(ku.test(e)===!1)throw Error("Expecting an integer");for(;ku.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Ut(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return ku.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(P8.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class o0{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let Tu={};const j8=new $8;function Au(t){const e=t.toString();if(Tu.hasOwnProperty(e))return Tu[e];{const n=j8.pattern(e);return Tu[e]=n,n}}function z8(){Tu={}}const M1="Complement Sets are not supported for first char optimization",Ru=`Unable to use "first char" lexer optimizations:
`;function K8(t,e=!1){try{const n=Au(t);return a0(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===M1)e&&R1(`${Ru}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),i0(`${Ru}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function a0(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)a0(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Su(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(M1);Ct(o.value,c=>{if(typeof c=="number")Su(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)Su(u,e,n);else{for(let u=l.from;u<=l.to&&u<Ac;u++)Su(u,e,n);if(l.to>=Ac){const u=l.from>=Ac?l.from:Ac,d=l.to,f=ds(u),h=ds(d);for(let p=f;p<=h;p++)e[p]=p}}}});break;case"Group":a0(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&c0(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ze(e)}function Su(t,e,n){const r=ds(t);e[r]=r,n===!0&&W8(t,e)}function W8(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=ds(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=ds(i.charCodeAt(0));e[s]=s}}}function U1(t,e){return Xo(t.value,n=>{if(typeof n=="number")return In(e,n);{const r=n;return Xo(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function c0(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?ee(t.value)?Dr(t.value,c0):c0(t.value):!1}class H8 extends o0{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){In(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?U1(e,this.targetCharCodes)===void 0&&(this.found=!0):U1(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function l0(t,e){if(e instanceof RegExp){const n=Au(e),r=new H8(t);return r.visit(n),r.found}else return Xo(e,n=>In(t,n.charCodeAt(0)))!==void 0}const Js="PATTERN",Tc="defaultMode",Ou="modes";let F1=typeof new RegExp("(?:)").sticky=="boolean";function G8(t,e){e=n0(e,{useSticky:F1,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(v,T)=>T()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{m3()});let r;n("Reject Lexer.NA",()=>{r=_u(t,v=>v[Js]===rn.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=Et(r,v=>{const T=v[Js];if(Fi(T)){const A=T.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!T.ignoreCase?A:A.length===2&&A[0]==="\\"&&!In(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:e.useSticky?P1(T):B1(T)}else{if(Li(T))return i=!0,{exec:T};if(typeof T=="object")return i=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const A=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),C=new RegExp(A);return e.useSticky?P1(C):B1(C)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=Et(r,v=>v.tokenTypeIdx),a=Et(r,v=>{const T=v.GROUP;if(T!==rn.SKIPPED){if($n(T))return T;if(Bi(T))return!1;throw Error("non exhaustive match")}}),c=Et(r,v=>{const T=v.LONGER_ALT;if(T)return ee(T)?Et(T,C=>T1(r,C)):[T1(r,T)]}),l=Et(r,v=>v.PUSH_MODE),u=Et(r,v=>It(v,"POP_MODE"))});let d;n("Line Terminator Handling",()=>{const v=j1(e.lineTerminatorCharacters);d=Et(r,T=>!1),e.positionTracking!=="onlyOffset"&&(d=Et(r,T=>It(T,"LINE_BREAKS")?!!T.LINE_BREAKS:$1(T,v)===!1&&l0(v,T.PATTERN)))});let f,h,p,m;n("Misc Mapping #2",()=>{f=Et(r,D1),h=Et(s,f3),p=jn(r,(v,T)=>{const A=T.GROUP;return $n(A)&&A!==rn.SKIPPED&&(v[A]=[]),v},{}),m=Et(s,(v,T)=>({pattern:s[T],longerAlt:c[T],canLineTerminator:d[T],isCustom:f[T],short:h[T],group:a[T],push:l[T],pop:u[T],tokenTypeIdx:o[T],tokenType:r[T]}))});let b=!0,_=[];return e.safeMode||n("First Char Optimization",()=>{_=jn(r,(v,T,A)=>{if(typeof T.PATTERN=="string"){const C=T.PATTERN.charCodeAt(0),R=ds(C);u0(v,R,m[A])}else if(ee(T.START_CHARS_HINT)){let C;Ct(T.START_CHARS_HINT,R=>{const S=typeof R=="string"?R.charCodeAt(0):R,U=ds(S);C!==U&&(C=U,u0(v,U,m[A]))})}else if(Fi(T.PATTERN))if(T.PATTERN.unicode)b=!1,e.ensureOptimizations&&i0(`${Ru}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const C=K8(T.PATTERN,e.ensureOptimizations);be(C)&&(b=!1),Ct(C,R=>{u0(v,R,m[A])})}else e.ensureOptimizations&&i0(`${Ru}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),b=!1;return v},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:_,hasCustom:i,canBeOptimized:b}}function Y8(t,e){let n=[];const r=Z8(t);n=n.concat(r.errors);const i=X8(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(V8(s)),n=n.concat(i3(s)),n=n.concat(s3(s,e)),n=n.concat(o3(s)),n}function V8(t){let e=[];const n=Ar(t,r=>Fi(r[Js]));return e=e.concat(J8(n)),e=e.concat(e3(n)),e=e.concat(n3(n)),e=e.concat(r3(n)),e=e.concat(Q8(n)),e}function Z8(t){const e=Ar(t,i=>!It(i,Js)),n=Et(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Fe.MISSING_PATTERN,tokenTypes:[i]})),r=gu(t,e);return{errors:n,valid:r}}function X8(t){const e=Ar(t,i=>{const s=i[Js];return!Fi(s)&&!Li(s)&&!It(s,"exec")&&!$n(s)}),n=Et(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Fe.INVALID_PATTERN,tokenTypes:[i]})),r=gu(t,e);return{errors:n,valid:r}}const q8=/[^\\][$]/;function J8(t){class e extends o0{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Ar(t,i=>{const s=i.PATTERN;try{const o=Au(s),a=new e;return a.visit(o),a.found}catch{return q8.test(s.source)}});return Et(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Fe.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function Q8(t){const e=Ar(t,r=>r.PATTERN.test(""));return Et(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Fe.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const t3=/[^\\[][\^]|^\^/;function e3(t){class e extends o0{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Ar(t,i=>{const s=i.PATTERN;try{const o=Au(s),a=new e;return a.visit(o),a.found}catch{return t3.test(s.source)}});return Et(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Fe.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function n3(t){const e=Ar(t,r=>{const i=r[Js];return i instanceof RegExp&&(i.multiline||i.global)});return Et(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Fe.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function r3(t){const e=[];let n=Et(t,s=>jn(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!In(e,a)&&a.PATTERN!==rn.NA&&(e.push(a),o.push(a)),o),[]));n=xc(n);const r=Ar(n,s=>s.length>1);return Et(r,s=>{const o=Et(s,c=>c.name);return{message:`The same RegExp pattern ->${$r(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Fe.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function i3(t){const e=Ar(t,r=>{if(!It(r,"GROUP"))return!1;const i=r.GROUP;return i!==rn.SKIPPED&&i!==rn.NA&&!$n(i)});return Et(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Fe.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function s3(t,e){const n=Ar(t,i=>i.PUSH_MODE!==void 0&&!In(e,i.PUSH_MODE));return Et(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Fe.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function o3(t){const e=[],n=jn(t,(r,i,s)=>{const o=i.PATTERN;return o===rn.NA||($n(o)?r.push({str:o,idx:s,tokenType:i}):Fi(o)&&c3(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Ct(t,(r,i)=>{Ct(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&a3(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:Fe.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function a3(t,e){if(Fi(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(Li(e))return e(t,0,[],{});if(It(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function c3(t){return Xo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function B1(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function P1(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function l3(t,e,n){const r=[];return It(t,Tc)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Tc+`> property in its definition
`,type:Fe.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),It(t,Ou)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Ou+`> property in its definition
`,type:Fe.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),It(t,Ou)&&It(t,Tc)&&!It(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${Tc}: <${t.defaultMode}>which does not exist
`,type:Fe.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),It(t,Ou)&&Ct(t.modes,(i,s)=>{Ct(i,(o,a)=>{if(Bi(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Fe.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(It(o,"LONGER_ALT")){const c=ee(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Ct(c,l=>{!Bi(l)&&!In(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Fe.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function u3(t,e,n){const r=[];let i=!1;const s=xc(ar(Ze(t.modes))),o=_u(s,c=>c[Js]===rn.NA),a=j1(n);return e&&Ct(o,c=>{const l=$1(c,a);if(l!==!1){const d={message:p3(c,l),type:l.issue,tokenType:c};r.push(d)}else It(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):l0(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Fe.NO_LINE_BREAKS_FLAGS}),r}function h3(t){const e={},n=kr(t);return Ct(n,r=>{const i=t[r];if(ee(i))e[r]=[];else throw Error("non exhaustive match")}),e}function D1(t){const e=t.PATTERN;if(Fi(e))return!1;if(Li(e))return!0;if(It(e,"exec"))return!0;if($n(e))return!1;throw Error("non exhaustive match")}function f3(t){return $n(t)&&t.length===1?t.charCodeAt(0):!1}const d3={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function $1(t,e){if(It(t,"LINE_BREAKS"))return!1;if(Fi(t.PATTERN)){try{l0(e,t.PATTERN)}catch(n){return{issue:Fe.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if($n(t.PATTERN))return!1;if(D1(t))return{issue:Fe.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function p3(t,e){if(e.issue===Fe.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===Fe.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function j1(t){return Et(t,n=>$n(n)?n.charCodeAt(0):n)}function u0(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const Ac=256;let Iu=[];function ds(t){return t<Ac?t:Iu[t]}function m3(){if(be(Iu)){Iu=new Array(65536);for(let t=0;t<65536;t++)Iu[t]=t>255?255+~~(t/255):t}}function Rc(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function Nu(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let z1=1;const K1={};function Sc(t){const e=g3(t);_3(e),b3(e),y3(e),Ct(e,n=>{n.isParent=n.categoryMatches.length>0})}function g3(t){let e=gn(t),n=t,r=!0;for(;r;){n=xc(ar(Et(n,s=>s.CATEGORIES)));const i=gu(n,e);e=e.concat(i),be(i)?r=!1:n=i}return e}function _3(t){Ct(t,e=>{H1(e)||(K1[z1]=e,e.tokenTypeIdx=z1++),G1(e)&&!ee(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),G1(e)||(e.CATEGORIES=[]),w3(e)||(e.categoryMatches=[]),x3(e)||(e.categoryMatchesMap={})})}function y3(t){Ct(t,e=>{e.categoryMatches=[],Ct(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(K1[r].tokenTypeIdx)})})}function b3(t){Ct(t,e=>{W1([],e)})}function W1(t,e){Ct(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),Ct(e.CATEGORIES,n=>{const r=t.concat(e);In(r,n)||W1(r,n)})}function H1(t){return It(t,"tokenTypeIdx")}function G1(t){return It(t,"CATEGORIES")}function w3(t){return It(t,"categoryMatches")}function x3(t){return It(t,"categoryMatchesMap")}function E3(t){return It(t,"tokenTypeIdx")}const v3={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var Fe;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Fe||(Fe={}));const Oc={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:v3,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Oc);let rn=class{constructor(e,n=Oc){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=S1(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Dn({},Oc,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Oc.lineTerminatorsPattern)this.config.lineTerminatorsPattern=d3;else if(this.config.lineTerminatorCharacters===Oc.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),ee(e)?i={modes:{defaultMode:gn(e)},defaultMode:Tc}:(s=!1,i=gn(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(l3(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(u3(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Ct(i.modes,(a,c)=>{i.modes[c]=_u(a,l=>Bi(l))});const o=kr(i.modes);if(Ct(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Y8(a,o))}),be(this.lexerDefinitionErrors)){Sc(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=G8(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Dn({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!be(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Et(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Ct(this.lexerDefinitionWarning,a=>{R1(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(F1?(this.chopInput=Go,this.match=this.matchWithTest):(this.updateLastIndex=en,this.match=this.matchWithExec),s&&(this.handleModes=en),this.trackStartLines===!1&&(this.computeNewColumn=Go),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=en),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=jn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!be(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{z8()}),this.TRACE_INIT("toFastProperties",()=>{O1(this)})})}tokenize(e,n=this.defaultMode){if(!be(this.lexerDefinitionErrors)){const i=Et(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,l,u,d,f,h,p,m,b,_;const v=e,T=v.length;let A=0,C=0;const R=this.hasCustom?0:Math.floor(e.length/10),S=new Array(R),U=[];let I=this.trackStartLines?1:void 0,P=this.trackStartLines?1:void 0;const W=h3(this.emptyGroups),L=this.trackStartLines,N=this.config.lineTerminatorsPattern;let E=0,D=[],Z=[];const $=[],st=[];Object.freeze(st);let rt;function at(){return D}function Y(jt){const ie=ds(jt),Dt=Z[ie];return Dt===void 0?st:Dt}const H=jt=>{if($.length===1&&jt.tokenType.PUSH_MODE===void 0){const ie=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(jt);U.push({offset:jt.startOffset,line:jt.startLine,column:jt.startColumn,length:jt.image.length,message:ie})}else{$.pop();const ie=Zo($);D=this.patternIdxToConfig[ie],Z=this.charCodeToPatternIdxToConfig[ie],E=D.length;const Dt=this.canModeBeOptimized[ie]&&this.config.safeMode===!1;Z&&Dt?rt=Y:rt=at}};function wt(jt){$.push(jt),Z=this.charCodeToPatternIdxToConfig[jt],D=this.patternIdxToConfig[jt],E=D.length,E=D.length;const ie=this.canModeBeOptimized[jt]&&this.config.safeMode===!1;Z&&ie?rt=Y:rt=at}wt.call(this,n);let lt;const ht=this.config.recoveryEnabled;for(;A<T;){c=null;const jt=v.charCodeAt(A),ie=rt(jt),Dt=ie.length;for(r=0;r<Dt;r++){lt=ie[r];const Bt=lt.pattern;l=null;const ae=lt.short;if(ae!==!1?jt===ae&&(c=Bt):lt.isCustom===!0?(_=Bt.exec(v,A,S,W),_!==null?(c=_[0],_.payload!==void 0&&(l=_.payload)):c=null):(this.updateLastIndex(Bt,A),c=this.match(Bt,e,A)),c!==null){if(a=lt.longerAlt,a!==void 0){const Yt=a.length;for(s=0;s<Yt;s++){const Ie=D[a[s]],$e=Ie.pattern;if(u=null,Ie.isCustom===!0?(_=$e.exec(v,A,S,W),_!==null?(o=_[0],_.payload!==void 0&&(u=_.payload)):o=null):(this.updateLastIndex($e,A),o=this.match($e,e,A)),o&&o.length>c.length){c=o,l=u,lt=Ie;break}}}break}}if(c!==null){if(d=c.length,f=lt.group,f!==void 0&&(h=lt.tokenTypeIdx,p=this.createTokenInstance(c,A,h,lt.tokenType,I,P,d),this.handlePayload(p,l),f===!1?C=this.addToken(S,C,p):W[f].push(p)),e=this.chopInput(e,d),A=A+d,P=this.computeNewColumn(P,d),L===!0&&lt.canLineTerminator===!0){let Bt=0,ae,Yt;N.lastIndex=0;do ae=N.test(c),ae===!0&&(Yt=N.lastIndex-1,Bt++);while(ae===!0);Bt!==0&&(I=I+Bt,P=d-Yt,this.updateTokenEndLineColumnLocation(p,f,Yt,Bt,I,P,d))}this.handleModes(lt,H,wt,p)}else{const Bt=A,ae=I,Yt=P;let Ie=ht===!1;for(;Ie===!1&&A<T;)for(e=this.chopInput(e,1),A++,i=0;i<E;i++){const $e=D[i],k=$e.pattern,ot=$e.short;if(ot!==!1?v.charCodeAt(A)===ot&&(Ie=!0):$e.isCustom===!0?Ie=k.exec(v,A,S,W)!==null:(this.updateLastIndex(k,A),Ie=k.exec(e)!==null),Ie===!0)break}if(m=A-Bt,P=this.computeNewColumn(P,m),b=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(v,Bt,m,ae,Yt),U.push({offset:Bt,line:ae,column:Yt,length:m,message:b}),ht===!1)break}}return this.hasCustom||(S.length=C),{tokens:S,groups:W,errors:U}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}};rn.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",rn.NA=/NOT_APPLICABLE/;function Ic(t){return Y1(t)?t.LABEL:t.name}function Y1(t){return $n(t.LABEL)&&t.LABEL!==""}const k3="parent",V1="categories",Z1="label",X1="group",q1="push_mode",J1="pop_mode",Q1="longer_alt",tw="line_breaks",ew="start_chars_hint";function cr(t){return T3(t)}function T3(t){const e=t.pattern,n={};if(n.name=t.name,Bi(e)||(n.PATTERN=e),It(t,k3))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return It(t,V1)&&(n.CATEGORIES=t[V1]),Sc([n]),It(t,Z1)&&(n.LABEL=t[Z1]),It(t,X1)&&(n.GROUP=t[X1]),It(t,J1)&&(n.POP_MODE=t[J1]),It(t,q1)&&(n.PUSH_MODE=t[q1]),It(t,Q1)&&(n.LONGER_ALT=t[Q1]),It(t,tw)&&(n.LINE_BREAKS=t[tw]),It(t,ew)&&(n.START_CHARS_HINT=t[ew]),n}const Qs=cr({name:"EOF",pattern:rn.NA});Sc([Qs]);function Cu(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function A3(t,e){return Rc(t,e)}const nw={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${Y1(t)?`--> ${Ic(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+$r(e).image+"'";if(r)return s+r+a;{const c=jn(t,(f,h)=>f.concat(h),[]),l=Et(c,f=>`[${Et(f,h=>Ic(h)).join(", ")}]`),d=`one of these possible Token sequences:
${Et(l,(f,h)=>`  ${h+1}. ${f}`).join(`
`)}`;return s+d+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+$r(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Et(t,l=>`[${Et(l,u=>Ic(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(nw);const R3={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},to={buildDuplicateFoundError(t,e){function n(u){return u instanceof Me?u.terminalType.name:u instanceof zn?u.nonTerminalName:""}const r=t.name,i=$r(e),s=i.idx,o=mi(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=Et(t.prefixPath,i=>Ic(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=Et(t.prefixPath,i=>Ic(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=mi(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=Et(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof qo?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function S3(t,e){const n=new O3(t,e);return n.resolveRefs(),n.errors}class O3 extends qs{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Ct(Ze(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:Nn.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class I3 extends xu{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=gn(this.path.ruleStack).reverse(),this.occurrenceStack=gn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){be(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class N3 extends I3{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Kn({definition:i});this.possibleTokTypes=vc(s),this.found=!0}}}class Lu extends xu{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class C3 extends Lu{walkMany(e,n,r){if(e.idx===this.occurrence){const i=$r(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class rw extends Lu{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=$r(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class L3 extends Lu{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=$r(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class iw extends Lu{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=$r(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function h0(t,e,n=[]){n=gn(n);let r=[],i=0;function s(a){return a.concat(_n(t,i+1))}function o(a){const c=h0(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof Kn)return o(a.definition);if(a instanceof zn)return o(a.definition);if(a instanceof Wn)r=o(a.definition);else if(a instanceof di){const c=a.definition.concat([new nn({definition:a.definition})]);return o(c)}else if(a instanceof pi){const c=[new Kn({definition:a.definition}),new nn({definition:[new Me({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof zr){const c=a.definition.concat([new nn({definition:[new Me({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof nn){const c=a.definition.concat([new nn({definition:a.definition})]);r=o(c)}else{if(a instanceof Kr)return Ct(a.definition,c=>{be(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Me)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:_n(t,i)}),r}function sw(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],d=[];for(d.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!be(d);){const f=d.pop();if(f===o){a&&Zo(d).idx<=l&&d.pop();continue}const h=f.def,p=f.idx,m=f.ruleStack,b=f.occurrenceStack;if(be(h))continue;const _=h[0];if(_===i){const v={idx:p,def:_n(h),ruleStack:Ec(m),occurrenceStack:Ec(b)};d.push(v)}else if(_ instanceof Me)if(p<c-1){const v=p+1,T=e[v];if(n(T,_.terminalType)){const A={idx:v,def:_n(h),ruleStack:m,occurrenceStack:b};d.push(A)}}else if(p===c-1)u.push({nextTokenType:_.terminalType,nextTokenOccurrence:_.idx,ruleStack:m,occurrenceStack:b}),a=!0;else throw Error("non exhaustive match");else if(_ instanceof zn){const v=gn(m);v.push(_.nonTerminalName);const T=gn(b);T.push(_.idx);const A={idx:p,def:_.definition.concat(s,_n(h)),ruleStack:v,occurrenceStack:T};d.push(A)}else if(_ instanceof Wn){const v={idx:p,def:_n(h),ruleStack:m,occurrenceStack:b};d.push(v),d.push(o);const T={idx:p,def:_.definition.concat(_n(h)),ruleStack:m,occurrenceStack:b};d.push(T)}else if(_ instanceof di){const v=new nn({definition:_.definition,idx:_.idx}),T=_.definition.concat([v],_n(h)),A={idx:p,def:T,ruleStack:m,occurrenceStack:b};d.push(A)}else if(_ instanceof pi){const v=new Me({terminalType:_.separator}),T=new nn({definition:[v].concat(_.definition),idx:_.idx}),A=_.definition.concat([T],_n(h)),C={idx:p,def:A,ruleStack:m,occurrenceStack:b};d.push(C)}else if(_ instanceof zr){const v={idx:p,def:_n(h),ruleStack:m,occurrenceStack:b};d.push(v),d.push(o);const T=new Me({terminalType:_.separator}),A=new nn({definition:[T].concat(_.definition),idx:_.idx}),C=_.definition.concat([A],_n(h)),R={idx:p,def:C,ruleStack:m,occurrenceStack:b};d.push(R)}else if(_ instanceof nn){const v={idx:p,def:_n(h),ruleStack:m,occurrenceStack:b};d.push(v),d.push(o);const T=new nn({definition:_.definition,idx:_.idx}),A=_.definition.concat([T],_n(h)),C={idx:p,def:A,ruleStack:m,occurrenceStack:b};d.push(C)}else if(_ instanceof Kr)for(let v=_.definition.length-1;v>=0;v--){const T=_.definition[v],A={idx:p,def:T.definition.concat(_n(h)),ruleStack:m,occurrenceStack:b};d.push(A),d.push(o)}else if(_ instanceof Kn)d.push({idx:p,def:_.definition.concat(_n(h)),ruleStack:m,occurrenceStack:b});else if(_ instanceof qo)d.push(M3(_,p,m,b));else throw Error("non exhaustive match")}return u}function M3(t,e,n,r){const i=gn(n);i.push(t.name);const s=gn(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var Be;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(Be||(Be={}));function ow(t){if(t instanceof Wn||t==="Option")return Be.OPTION;if(t instanceof nn||t==="Repetition")return Be.REPETITION;if(t instanceof di||t==="RepetitionMandatory")return Be.REPETITION_MANDATORY;if(t instanceof pi||t==="RepetitionMandatoryWithSeparator")return Be.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof zr||t==="RepetitionWithSeparator")return Be.REPETITION_WITH_SEPARATOR;if(t instanceof Kr||t==="Alternation")return Be.ALTERNATION;throw Error("non exhaustive match")}function U3(t,e,n,r,i,s){const o=d0(t,e,n),a=uw(o)?Nu:Rc;return s(o,r,a,i)}function F3(t,e,n,r,i,s){const o=p0(t,e,i,n),a=uw(o)?Nu:Rc;return s(o[0],a,r)}function B3(t,e,n,r){const i=t.length,s=Dr(t,o=>Dr(o,a=>a.length===1));if(e)return function(o){const a=Et(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,d=a[c];if(!(d!==void 0&&d.call(this)===!1))t:for(let f=0;f<u;f++){const h=l[f],p=h.length;for(let m=0;m<p;m++){const b=this.LA(m+1);if(n(b,h[m])===!1)continue t}return c}}};if(s&&!r){const o=Et(t,c=>ar(c)),a=jn(o,(c,l,u)=>(Ct(l,d=>{It(c,d.tokenTypeIdx)||(c[d.tokenTypeIdx]=u),Ct(d.categoryMatches,f=>{It(c,f)||(c[f]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],d=u.length;for(let f=0;f<d;f++){const h=this.LA(f+1);if(n(h,u[f])===!1)continue t}return o}}}}function P3(t,e,n){const r=Dr(t,s=>s.length===1),i=t.length;if(r&&!n){const s=ar(t);if(s.length===1&&be(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=jn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Ct(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue t}return!0}return!1}}class D3 extends xu{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,Be.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,Be.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,Be.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,Be.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,Be.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class aw extends qs{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,Be.OPTION)}visitRepetition(e){this.checkIsTarget(e,Be.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,Be.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,Be.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,Be.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,Be.ALTERNATION)}}function cw(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function f0(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function $3(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function lw(t,e){const n=Et(t,o=>h0([o],1)),r=cw(n.length),i=Et(n,o=>{const a={};return Ct(o,c=>{const l=f0(c.partialPath);Ct(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=cw(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const d=l[u].partialPath,f=l[u].suffixDef,h=f0(d);if($3(i,h,c)||be(f)||d.length===e){const m=r[c];if(m0(m,d)===!1){m.push(d);for(let b=0;b<h.length;b++){const _=h[b];i[c][_]=!0}}}else{const m=h0(f,o+1,d);s[c]=s[c].concat(m),Ct(m,b=>{const _=f0(b.partialPath);Ct(_,v=>{i[c][v]=!0})})}}}}return r}function d0(t,e,n,r){const i=new aw(t,Be.ALTERNATION,r);return e.accept(i),lw(i.result,n)}function p0(t,e,n,r){const i=new aw(t,n);e.accept(i);const s=i.result,a=new D3(e,t,n).startWalking(),c=new Kn({definition:s}),l=new Kn({definition:a});return lw([c,l],r)}function m0(t,e){t:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function j3(t,e){return t.length<e.length&&Dr(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function uw(t){return Dr(t,e=>Dr(e,n=>Dr(n,r=>be(r.categoryMatches))))}function z3(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return Et(e,n=>Object.assign({type:Nn.CUSTOM_LOOKAHEAD_VALIDATION},n))}function K3(t,e,n,r){const i=Rr(t,c=>W3(c,n)),s=nU(t,e,n),o=Rr(t,c=>J3(c,n)),a=Rr(t,c=>Y3(c,t,r,n));return i.concat(s,o,a)}function W3(t,e){const n=new G3;t.accept(n);const r=n.allProductions,i=k1(r,H3),s=jr(i,a=>a.length>1);return Et(Ze(s),a=>{const c=$r(a),l=e.buildDuplicateFoundError(t,a),u=mi(c),d={message:l,type:Nn.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},f=hw(c);return f&&(d.parameter=f),d})}function H3(t){return`${mi(t)}_#_${t.idx}_#_${hw(t)}`}function hw(t){return t instanceof Me?t.terminalType.name:t instanceof zn?t.nonTerminalName:""}class G3 extends qs{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function Y3(t,e,n,r){const i=[];if(jn(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:Nn.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function V3(t,e,n){const r=[];let i;return In(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:Nn.INVALID_RULE_OVERRIDE,ruleName:t})),r}function fw(t,e,n,r=[]){const i=[],s=Mu(e.definition);if(be(s))return[];{const o=t.name;In(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:Nn.LEFT_RECURSION,ruleName:o});const c=gu(s,r.concat([t])),l=Rr(c,u=>{const d=gn(r);return d.push(u),fw(t,u,n,d)});return i.concat(l)}}function Mu(t){let e=[];if(be(t))return e;const n=$r(t);if(n instanceof zn)e.push(n.referencedRule);else if(n instanceof Kn||n instanceof Wn||n instanceof di||n instanceof pi||n instanceof zr||n instanceof nn)e=e.concat(Mu(n.definition));else if(n instanceof Kr)e=ar(Et(n.definition,s=>Mu(s.definition)));else if(!(n instanceof Me))throw Error("non exhaustive match");const r=wu(n),i=t.length>1;if(r&&i){const s=_n(t);return e.concat(Mu(s))}else return e}class g0 extends qs{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function Z3(t,e){const n=new g0;t.accept(n);const r=n.alternations;return Rr(r,s=>{const o=Ec(s.definition);return Rr(o,(a,c)=>{const l=sw([a],[],Rc,1);return be(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:Nn.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function X3(t,e,n){const r=new g0;t.accept(r);let i=r.alternations;return i=_u(i,o=>o.ignoreAmbiguities===!0),Rr(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=d0(a,t,c,o),u=tU(l,o,t,n),d=eU(l,o,t,n);return u.concat(d)})}class q3 extends qs{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function J3(t,e){const n=new g0;t.accept(n);const r=n.alternations;return Rr(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:Nn.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function Q3(t,e,n){const r=[];return Ct(t,i=>{const s=new q3;i.accept(s);const o=s.allProductions;Ct(o,a=>{const c=ow(a),l=a.maxLookahead||e,u=a.idx,f=p0(u,i,c,l)[0];if(be(ar(f))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:Nn.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function tU(t,e,n,r){const i=[],s=jn(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||Ct(c,u=>{const d=[l];Ct(t,(f,h)=>{l!==h&&m0(f,u)&&e.definition[h].ignoreAmbiguities!==!0&&d.push(h)}),d.length>1&&!m0(i,u)&&(i.push(u),a.push({alts:d,path:u}))}),a),[]);return Et(s,a=>{const c=Et(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:Nn.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function eU(t,e,n,r){const i=jn(t,(o,a,c)=>{const l=Et(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return xc(Rr(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Ar(i,f=>e.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<c&&j3(f.path,l));return Et(u,f=>{const h=[f.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:h,prefixPath:f.path}),type:Nn.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:h}})}))}function nU(t,e,n){const r=[],i=Et(e,s=>s.name);return Ct(t,s=>{const o=s.name;if(In(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:Nn.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function rU(t){const e=n0(t,{errMsgProvider:R3}),n={};return Ct(t.rules,r=>{n[r.name]=r}),S3(n,e.errMsgProvider)}function iU(t){return t=n0(t,{errMsgProvider:to}),K3(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const dw="MismatchedTokenException",pw="NoViableAltException",mw="EarlyExitException",gw="NotAllInputParsedException",_w=[dw,pw,mw,gw];Object.freeze(_w);function Uu(t){return In(_w,t.name)}class Fu extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class yw extends Fu{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=dw}}class sU extends Fu{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=pw}}class oU extends Fu{constructor(e,n){super(e,n),this.name=gw}}class aU extends Fu{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=mw}}const _0={},bw="InRuleRecoveryException";class cU extends Error{constructor(e){super(e),this.name=bw}}class lU{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=It(e,"recoveryEnabled")?e.recoveryEnabled:Pi.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=uU)}getTokenToInsert(e){const n=Cu(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const d=()=>{const f=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:f,ruleName:this.getCurrRuleFullName()}),p=new yw(h,l,this.LA(0));p.resyncedTokens=Ec(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){d();return}else if(r.call(this)){d(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new cU("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||be(n))return!1;const r=this.LA(1);return Xo(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return In(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Xo(e,s=>A3(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return _0;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return Et(e,(r,i)=>i===0?_0:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=Et(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return ar(e)}getFollowSetFromFollowKey(e){if(e===_0)return[Qs];const n=e.ruleName+e.idxInCallingRule+N1+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,Qs)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Ec(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=gn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return Et(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function uU(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const f=this.getCurrRuleFullName(),h=this.getGAstProductions()[f];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const d=c.isEndOfRule;this.RULE_STACK.length===1&&d&&l===void 0&&(l=Qs,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const hU=4,ps=8,ww=1<<ps,xw=2<<ps,y0=3<<ps,b0=4<<ps,w0=5<<ps,Bu=6<<ps;function x0(t,e,n){return n|e|t}class fU{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:Pi.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(be(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return Rr(e,n=>fw(n,n,to))}validateEmptyOrAlternatives(e){return Rr(e,n=>Z3(n,to))}validateAmbiguousAlternationAlternatives(e,n){return Rr(e,r=>X3(r,n,to))}validateSomeNonEmptyLookaheadPath(e,n){return Q3(e,n,to)}buildLookaheadForAlternation(e){return U3(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,B3)}buildLookaheadForOptional(e){return F3(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,ow(e.prodType),P3)}}class dU{initLooksAhead(e){this.dynamicTokensEnabled=It(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Pi.dynamicTokensEnabled,this.maxLookahead=It(e,"maxLookahead")?e.maxLookahead:Pi.maxLookahead,this.lookaheadStrategy=It(e,"lookaheadStrategy")?e.lookaheadStrategy:new fU({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Ct(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=mU(n);Ct(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${mi(l)}${u}`,()=>{const d=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=x0(this.fullRuleNameToShort[n.name],ww,l.idx);this.setLaFuncCache(f,d)})}),Ct(i,l=>{this.computeLookaheadFunc(n,l.idx,y0,"Repetition",l.maxLookahead,mi(l))}),Ct(s,l=>{this.computeLookaheadFunc(n,l.idx,xw,"Option",l.maxLookahead,mi(l))}),Ct(o,l=>{this.computeLookaheadFunc(n,l.idx,b0,"RepetitionMandatory",l.maxLookahead,mi(l))}),Ct(a,l=>{this.computeLookaheadFunc(n,l.idx,Bu,"RepetitionMandatoryWithSeparator",l.maxLookahead,mi(l))}),Ct(c,l=>{this.computeLookaheadFunc(n,l.idx,w0,"RepetitionWithSeparator",l.maxLookahead,mi(l))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=x0(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return x0(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class pU extends qs{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const Pu=new pU;function mU(t){Pu.reset(),t.accept(Pu);const e=Pu.dslMethods;return Pu.reset(),e}function Ew(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function vw(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function gU(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function _U(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const yU="name";function kw(t,e){Object.defineProperty(t,yU,{enumerable:!1,configurable:!0,writable:!1,value:e})}function bU(t,e){const n=kr(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function wU(t,e){const n=function(){};kw(n,t+"BaseSemantics");const r={visit:function(i,s){if(ee(i)&&(i=i[0]),!Bi(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=EU(this,e);if(!be(i)){const s=Et(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function xU(t,e,n){const r=function(){};kw(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Ct(e,s=>{i[s]=bU}),r.prototype=i,r.prototype.constructor=r,r}var E0;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(E0||(E0={}));function EU(t,e){return vU(t,e)}function vU(t,e){const n=Ar(e,i=>Li(t[i])===!1),r=Et(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:E0.MISSING_METHOD,methodName:i}));return xc(r)}class kU{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=It(e,"nodeLocationTracking")?e.nodeLocationTracking:Pi.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=en,this.cstFinallyStateUpdate=en,this.cstPostTerminal=en,this.cstPostNonTerminal=en,this.cstPostRule=en;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=vw,this.setNodeLocationFromNode=vw,this.cstPostRule=en,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=en,this.setNodeLocationFromNode=en,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Ew,this.setNodeLocationFromNode=Ew,this.cstPostRule=en,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=en,this.setNodeLocationFromNode=en,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=en,this.setNodeLocationFromNode=en,this.cstPostRule=en,this.setInitialNodeLocation=en;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];gU(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];_U(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(Bi(this.baseCstVisitorConstructor)){const e=wU(this.className,kr(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Bi(this.baseCstVisitorWithDefaultsConstructor)){const e=xU(this.className,kr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class TU{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):ju}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?ju:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class AU{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=zu){if(In(this.definedRulesNames,e)){const o={message:to.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Nn.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=zu){const i=V3(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(Uu(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return S8(Ze(this.gastProductionsCache))}}class RU{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Nu,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},It(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(ee(e)){if(be(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(ee(e))this.tokensMap=jn(e,(s,o)=>(s[o.name]=o,s),{});else if(It(e,"modes")&&Dr(ar(Ze(e.modes)),E3)){const s=ar(Ze(e.modes)),o=yu(s);this.tokensMap=jn(o,(a,c)=>(a[c.name]=c,a),{})}else if(vr(e))this.tokensMap=gn(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Qs;const r=It(e,"modes")?ar(Ze(e.modes)):Ze(e),i=Dr(r,s=>be(s.categoryMatches));this.tokenMatcher=i?Nu:Rc,Sc(Ze(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=It(r,"resyncEnabled")?r.resyncEnabled:zu.resyncEnabled,s=It(r,"recoveryValueFunc")?r.recoveryValueFunc:zu.recoveryValueFunc,o=this.ruleShortNameIdx<<hU+ps;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const d=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(d),d}catch(d){return this.invokeRuleCatch(d,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(d){return this.invokeRuleCatch(d,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Uu(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(xw,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(b0,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,Be.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,b0,e,L3)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Bu,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,iw],a,Bu,e,iw)}else throw this.raiseEarlyExitException(e,Be.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(y0,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,y0,e,C3,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(w0,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,rw],a,w0,e,rw)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,Bu,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(ww,n),i=ee(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new oU(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw Uu(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new yw(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===bw?r:s}}else throw r}saveRecogState(){const e=this.errors,n=gn(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Qs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class SU{initErrorHandler(e){this._errors=[],this.errorMessageProvider=It(e,"errorMessageProvider")?e.errorMessageProvider:Pi.errorMessageProvider}SAVE_ERROR(e){if(Uu(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:gn(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return gn(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=p0(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new aU(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=d0(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new sU(c,this.LA(1),a))}}class OU{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(Bi(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return sw([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=$r(e.ruleStack),i=this.getGAstProductions()[n];return new N3(i,e).startWalking()}}const Du={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Du);const Tw=!0,Aw=Math.pow(2,ps)-1,Rw=cr({name:"RECORDING_PHASE_TOKEN",pattern:rn.NA});Sc([Rw]);const Sw=Cu(Rw,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Sw);const IU={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class NU{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return ju}topLevelRuleRecord(e,n){try{const r=new qo({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return Nc.call(this,Wn,e,n)}atLeastOneInternalRecord(e,n){Nc.call(this,di,n,e)}atLeastOneSepFirstInternalRecord(e,n){Nc.call(this,pi,n,e,Tw)}manyInternalRecord(e,n){Nc.call(this,nn,n,e)}manySepFirstInternalRecord(e,n){Nc.call(this,zr,n,e,Tw)}orInternalRecord(e,n){return CU.call(this,e,n)}subruleInternalRecord(e,n,r){if($u(n),!e||It(e,"ruleName")===!1){const a=new Error(`<SUBRULE${Ow(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Zo(this.recordingProdStack),s=e.ruleName,o=new zn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?IU:Du}consumeInternalRecord(e,n,r){if($u(n),!H1(e)){const o=new Error(`<CONSUME${Ow(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Zo(this.recordingProdStack),s=new Me({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),Sw}}function Nc(t,e,n,r=!1){$u(n);const i=Zo(this.recordingProdStack),s=Li(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),It(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Du}function CU(t,e){$u(e);const n=Zo(this.recordingProdStack),r=ee(t)===!1,i=r===!1?t:t.DEF,s=new Kr({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});It(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=r0(i,a=>Li(a.GATE));return s.hasPredicates=o,n.definition.push(s),Ct(i,a=>{const c=new Kn({definition:[]});s.definition.push(c),It(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:It(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Du}function Ow(t){return t===0?"":`${t}`}function $u(t){if(t<0||t>Aw){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${Aw+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class LU{initPerformanceTracer(e){if(It(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Pi.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=S1(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function MU(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const ju=Cu(Qs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(ju);const Pi=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:nw,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),zu=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Nn;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Nn||(Nn={}));let v0=class ZE{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{O1(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Ct(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=rU({rules:Ze(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(be(r)&&this.skipValidations===!1){const i=iU({rules:Ze(this.gastProductionsCache),tokenTypes:Ze(this.tokensMap),errMsgProvider:to,grammarName:n}),s=z3({lookaheadStrategy:this.lookaheadStrategy,rules:Ze(this.gastProductionsCache),tokenTypes:Ze(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),be(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=U8(Ze(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ze(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ze(this.gastProductionsCache))})),!ZE.DEFER_DEFINITION_ERRORS_HANDLING&&!be(this.definitionErrors))throw e=Et(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),It(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=It(n,"skipValidations")?n.skipValidations:Pi.skipValidations}};v0.DEFER_DEFINITION_ERRORS_HANDLING=!1,MU(v0,[lU,dU,kU,TU,RU,AU,SU,OU,NU,LU]);class UU extends v0{constructor(e,n=Pi){const r=gn(n);r.outputCst=!0,super(e,r)}}function FU(t){const e=new BU,n=Ze(t);return Et(n,r=>e.visitRule(r))}class BU extends qs{visitRule(e){const n=this.visitEach(e.definition),r=k1(n,s=>s.propertyName),i=Et(r,(s,o)=>{const a=!r0(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=Et(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:Ku(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:Ku(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:Ku(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:Ku(e)}]}visitEachAndOverrideWith(e,n){return Et(this.visitEach(e),r=>Dn({},r,n))}visitEach(e){return ar(Et(e,n=>this.visit(n)))}}function Ku(t){return t instanceof zn?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function PU(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(ar(Et(t,r=>DU(r)))),e.includeVisitorInterface&&(n=n.concat(KU(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function DU(t){const e=$U(t),n=jU(t);return[e,n]}function $U(t){const e=Nw(t.name),n=k0(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function jU(t){return`export type ${k0(t.name)} = {
  ${Et(t.properties,n=>zU(n)).join(`
  `)}
};`}function zU(t){const e=HU(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function KU(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Et(e,n=>WU(n)).join(`
  `)}
}`}function WU(t){const e=k0(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function HU(t){if(ee(t)){const e=yu(Et(t,r=>Iw(r)));return"("+jn(e,(r,i)=>r+" | "+i)+")"}else return Iw(t)}function Iw(t){return t.kind==="token"?"IToken":Nw(t.name)}function Nw(t){return Gb(t)+"CstNode"}function k0(t){return Gb(t)+"CstChildren"}const GU={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function YU(t,e){const n=Object.assign(Object.assign({},GU),e),r=FU(t);return PU(r,n)}const gi=!!JSON.parse("false"),VU=!!JSON.parse("false");JSON.parse("false");const ZU=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const Di={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return ls*Di.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return us*Di.DRAW_CHAR_SCALE}},Wu=yy(32,126).map(t=>String.fromCharCode(t));function Gt(t){return cr({...t,name:`token_${t.name}`})}function ms(t,e=!1){return Gt(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:yn,group:rn.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:yn})}const Cc=Gt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),XU=Gt({name:"whitespace",pattern:/ +/,group:rn.SKIPPED}),qU=Gt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:rn.SKIPPED}),T0=Gt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Qo=Gt({name:"command",pattern:/#/,start_chars_hint:["#"]});let Cw=!1;function JU(t,e,n){if(!Cw)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Cc)return null;let i=e;for(;t[i]===" ";)i++;if("@#/?':!".includes(t[i]))return null;let s=e+1;for(;s<t.length&&t[s]!==`
`;)s++;const o=t.substring(e,s);return o.trim().length===0?null:[o]}const Lw=Gt({name:"text",pattern:JU,line_breaks:!1,start_chars_hint:Wu.filter(t=>"@#/?':!".includes(t)===!1)}),Mw=Gt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),A0=Gt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Uw=Gt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Fw=Gt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),yn=Gt({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:Wu}),Bw=Gt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Pw=Gt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Dw=Gt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:yn}),$w=Gt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:yn}),jw=Gt({name:"islessthan",pattern:/<|below/,longer_alt:yn}),zw=Gt({name:"isgreaterthan",pattern:/>|above/,longer_alt:yn}),Kw=Gt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:yn}),Ww=Gt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:yn}),R0=Gt({name:"or",pattern:/or/i,longer_alt:yn}),S0=Gt({name:"not",pattern:/not/i,longer_alt:yn}),O0=Gt({name:"and",pattern:/and/i,longer_alt:yn}),I0=Gt({name:"plus",pattern:/\+/}),N0=Gt({name:"minus",pattern:/-/}),Hw=Gt({name:"power",pattern:/\*\*/}),Gw=Gt({name:"multiply",pattern:/\*/}),C0=Gt({name:"divide",pattern:/\//}),Yw=Gt({name:"moddivide",pattern:/%/}),Vw=Gt({name:"floordivide",pattern:/%%/}),Zw=Gt({name:"query",pattern:/\?/}),Xw=Gt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),qw=Gt({name:"rparen",pattern:/\)/,pop_mode:!0}),Jw=Gt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:Wu,longer_alt:yn}),Qw=Gt({name:"command_toast",pattern:/toast .*/,start_chars_hint:Wu,longer_alt:yn}),L0=Gt({name:"if",pattern:/if|try|take|give/,longer_alt:yn}),Hu=ms("do"),M0=ms("done"),U0=ms("else"),tx=ms("while"),ex=ms("repeat"),nx=ms("waitfor"),rx=Gt({name:"foreach",pattern:/foreach|for/,longer_alt:yn}),ix=ms("break"),sx=ms("continue");function ox(t){return[...t,Pw,Dw,$w,Kw,jw,Ww,zw,R0,S0,O0,I0,N0,Hw,Gw,C0,Vw,Yw,Zw,Xw,qw,Bw,yn]}const ax=ox([Lw,T0,Jw,Qw,Qo,Mw,A0,Uw,Fw,Cc,XU,ix,sx,M0,Hu,U0,rx,L0,ex,nx,tx]),QU=new rn({defaultMode:"use_newlines",modes:{use_newlines:ax,ignore_newlines:ox([qU])}},{skipValidations:!gi,ensureOptimizations:gi,positionTracking:"full"});function cx(t){Cw=!0;const e=QU.tokenize(t||` 
`),[n]=(ce(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(Cu(Cc,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function tF(t,e,n=!0){if(n){const[r,...i]=e;switch(Ot(r??"")){default:return{type:vt.OBJECT,values:e};case"loader":return{type:vt.LOADER,values:i};case"board":return{type:vt.BOARD,values:i};case"object":return{type:vt.OBJECT,values:i};case"terrain":return{type:vt.TERRAIN,values:i};case"charset":return{type:vt.CHARSET,values:i};case"palette":return{type:vt.PALETTE,values:i}}}else{const[r,i,...s]=e,o=Ot(i??""),a=[r,t,...s];switch(o){default:return{type:vt.CONST,values:e};case"rn":case"range":return{type:vt.RANGE,values:a};case"sl":case"select":return{type:vt.SELECT,values:a};case"nm":case"number":return{type:vt.NUMBER,values:a};case"tx":case"text":return{type:vt.TEXT,values:a};case"hk":case"hotkey":return{type:vt.HOTKEY,values:a};case"copyit":return{type:vt.COPYIT,values:a};case"openit":return{type:vt.OPENIT,values:a};case"zssedit":return{type:vt.ZSSEDIT,values:a};case"charedit":return{type:vt.CHAREDIT,values:a};case"coloredit":return{type:vt.COLOREDIT,values:a}}}}function lr(t){switch(t){case vt.LOADER:return"loader";case vt.BOARD:return"board";case vt.OBJECT:return"object";case vt.TERRAIN:return"terrain";case vt.CHARSET:return"charset";case vt.PALETTE:return"palette";case vt.CONST:return"const";case vt.RANGE:return"range";case vt.SELECT:return"select";case vt.NUMBER:return"number";case vt.TEXT:return"text";case vt.HOTKEY:return"hotkey";case vt.COPYIT:return"copyit";case vt.OPENIT:return"openit";case vt.ZSSEDIT:return"zssedit";case vt.CHAREDIT:return"charedit";case vt.COLOREDIT:return"coloredit"}}var F0=(t=>(t[t.width=0]="width",t[t.height=1]="height",t[t.bits=2]="bits",t))(F0||{});function lx(t){return Ho(t,F0,{bits:e=>Array.from(e)})}function ux(t){return oc(t,F0,{bits:e=>new Uint8Array(e)})}function eF(t,e){return{id:je(),code:t,...e}}var B0=(t=>(t[t.id=0]="id",t[t.code=1]="code",t[t.board=2]="board",t[t.object=3]="object",t[t.terrain=4]="terrain",t[t.charset=5]="charset",t[t.palette=6]="palette",t[t.eighttrack=7]="eighttrack",t))(B0||{});function nF(t){return Ho(t,B0,{board:sN,object:Xl,terrain:Xl,charset:lx,palette:lx,stats:Re})}function rF(t){return oc(t,B0,{board:oN,object:ql,terrain:ql,charset:ux,palette:ux})}function Lc(t){const e={...eo(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function iF(t){return x(t)?(t.stats=void 0,eo(t)):{}}function hx(t){const e=cx(t),n={};let r=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===T0){const o=s.image.slice(1),[a,c]=o.split(";").map(f=>f.trim()),l=a.split(" "),u=tF(gt(c)?c:"",l,r),d=Ot(u.values.join(" "));switch(r=!1,u.type){case vt.LOADER:n.type=_t.LOADER,n.name=d;break;case vt.BOARD:n.type=_t.BOARD,n.name=d;break;case vt.OBJECT:n.type=_t.OBJECT,n.name=d||"object";break;case vt.TERRAIN:n.type=_t.TERRAIN,n.name=d;break;case vt.CHARSET:n.type=_t.CHARSET,n.name=d;break;case vt.PALETTE:n.type=_t.PALETTE,n.name=d;break;case vt.CONST:{const[f,h]=u.values;if(gt(f)){const p=Ot(f);if(gt(h)){const m=parseFloat(h);n[p]=kt(m)?m:h}else kt(h)?n[p]=h:n[p]=1}break}case vt.RANGE:case vt.SELECT:case vt.NUMBER:case vt.TEXT:case vt.HOTKEY:case vt.ZSSEDIT:case vt.CHAREDIT:case vt.COLOREDIT:{const[f,...h]=u.values;if(gt(f)){const p=Ot(f);n[p]=[lr(u.type),...h]}break}}}}return n}function eo(t){var e;return x(t)?(x((e=t.stats)==null?void 0:e.type)||(t.stats=hx(t.code),x(t.stats.type)||(t.stats.type=_t.OBJECT)),t.stats):{}}function fx(t){switch(t){default:case _t.ERROR:return"error";case _t.LOADER:return lr(vt.LOADER);case _t.BOARD:return lr(vt.BOARD);case _t.OBJECT:return lr(vt.OBJECT);case _t.TERRAIN:return lr(vt.TERRAIN);case _t.CHARSET:return lr(vt.CHARSET);case _t.PALETTE:return lr(vt.PALETTE)}}function $i(t){return eo(t).type??_t.ERROR}function ji(t){return fx($i(t))}function He(t){return eo(t).name??""}function P0(t,e){return eo(t)[e]}const Gu=new ud;function sF(t){if(!gt(t))return;const e=zl(t);if(x(e)&&x(At[e]))return At[e];const n=Ot(t),r=dt[n];if(x(r))return r}function D0(t,e){const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r],s=t[i];if(!ce(s))switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[i]=t[i];break;case"color":case"bg":case"lightdir":e[i]=sF(t[i])??t[i];break;case"ispushable":e.pushable=1;break;case"notpushable":e.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=Mt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=Mt.ISSWIM;break;case"issolid":e.collision=Mt.ISSOLID;break;case"isbullet":e.collision=Mt.ISBULLET;break;case"isbreakable":e.breakable=1;break;case"notbreakable":e.breakable=0;break}}}function Ee(t){var e;if(x(t))switch($i(t)){default:return;case _t.ERROR:return t.code??"";case _t.LOADER:return t.code??"";case _t.BOARD:{x(t.board)||(t.board=Jl()),t.board.id=t.id;const n=Lc(t);return n.isdark&&(t.board.isdark=1),n.notdark&&(t.board.isdark=0),kt(n.startx)&&(t.board.startx=n.startx),kt(n.starty)&&(t.board.starty=n.starty),gt(n.over)&&(t.board.over=n.over),gt(n.under)&&(t.board.under=n.under),gt(n.camera)&&(t.board.camera=n.camera),gt(n.graphics)&&(t.board.graphics=n.graphics),kt(n.facing)&&(t.board.facing=n.facing),gt(n.exitnorth)&&(t.board.exitnorth=n.exitnorth),gt(n.exitsouth)&&(t.board.exitsouth=n.exitsouth),gt(n.exitwest)&&(t.board.exitwest=n.exitwest),gt(n.exiteast)&&(t.board.exiteast=n.exiteast),kt(n.timelimit)&&(t.board.timelimit=n.timelimit),n.restartonzap&&(t.board.restartonzap=1),n.norestartonzap&&(t.board.restartonzap=0),kt(n.maxplayershots)&&(t.board.maxplayershots=n.maxplayershots),t.board}case _t.OBJECT:return x(t.object)||(t.object=nb()),t.object.id=t.id,t.object.name=He(t),t.object.category=Fn.ISOBJECT,D0(Lc(t),t.object),t.object;case _t.TERRAIN:return x(t.terrain)||(t.terrain=nb()),t.terrain.id=t.id,t.terrain.name=He(t),t.terrain.category=Fn.ISTERRAIN,D0(Lc(t),t.terrain),t.terrain;case _t.PALETTE:{if(x(t.palette)||(t.palette=Od(lb)),x((e=t.palette)==null?void 0:e.bits)){const n=Lc(t),r=dr(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&gt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){Gu.set(o);const c=a*hc,l=Gu.r*63,u=Gu.g*63,d=Gu.b*63;t.palette.bits[c+0]=tn(l,0,63),t.palette.bits[c+1]=tn(u,0,63),t.palette.bits[c+2]=tn(d,0,63)}}}}return t.palette}case _t.CHARSET:return x(t.charset)||(t.charset=cb(kN)),t.charset}}function dx(t){return{id:je(),name:uv(),timestamp:0,activelist:[],pages:t,flags:{}}}var $0=(t=>(t[t.id=0]="id",t[t.name=1]="name",t[t.timestamp=2]="timestamp",t[t.activelist=3]="activelist",t[t.pages=4]="pages",t[t.flags=5]="flags",t[t.token=6]="token",t))($0||{});function oF(t){return Ho(t,$0,{pages:e=>e.map(nF),flags:e=>{const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(e[i]).length===0&&delete e[i]}return e}})}function aF(t){return oc(t,$0,{pages:e=>e.map(rF)})}function px(t){x(t)&&(t.token=`${hv()}${br(1111,9999)}`)}function zi(t,e){if(!x(t))return;const n=Ot(e);return t.pages.find(i=>i.id===e||n===He(i))}function Ge(t,e,n){if(!x(t))return;const r=Ot(n);return t.pages.find(s=>$i(s)===e&&(s.id===n||r===He(s)))}function j0(t,e,n){let r=Ge(t,e,n);if(!x(r)){const i=fx(e);return r=eF(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),gx(t,r),[r,!0]}return[r,!1]}function no(t,e){return x(t)?t.pages.filter(n=>$i(n)===e):[]}function Hn(t,e,n){if(!x(t))return[];const r=Ot(n);return t.pages.filter(s=>$i(s)===e).filter(s=>{const o=eo(s),a=Ot(He(s));return s.id===n||r===a||x(o[n])})}function z0(t){return x(t)?Qn(t.pages).sort((n,r)=>{const i=$i(n),s=$i(r);return i===s?He(n).localeCompare(He(r)):s-i}):[]}function mx(t,e){if(x(e)){const n=Ge(t,_t.TERRAIN,e.kind??"");if(x(n))return n;const r=Ge(t,_t.OBJECT,e.kind??"");if(x(r))return r}}function gx(t,e){if(!x(t)||!x(e))return!1;const n=zi(t,e.id);return x(n)?!1:(t.pages.push(e),px(t),!0)}function _x(t,e){const n=zi(t,e);if(x(t)&&x(n)){const r=Ot(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==He(i)),px(t),n}}function gs(t,e){if(x(e)&&x(e.kind))return x(e.kinddata)||(e.kinddata=x(e.id)?ro(t,e.kind):Mc(t,e.kind)),e.kinddata}function le(t,e,n){const r=gs(t,e);return(e==null?void 0:e[n])??(r==null?void 0:r[n])??P0(zi(t,(r==null?void 0:r.id)??""),n)}function ta(t,e,n,r,i){const s=gs(t,e);return{char:(e==null?void 0:e.char)??(s==null?void 0:s.char)??n,color:(e==null?void 0:e.color)??(s==null?void 0:s.color)??r,bg:(e==null?void 0:e.bg)??(s==null?void 0:s.bg)??i,light:(e==null?void 0:e.light)??(s==null?void 0:s.light)??0}}function ro(t,e){const n=e??"",r=Ge(t,_t.OBJECT,n);if(x(r)){const i=Ee(r);return{...Qn(i),name:n,code:r.code}}}function Mc(t,e){const n=e??"",r=Ge(t,_t.TERRAIN,n);if(x(r)){const i=Ee(r);return{...Qn(i),name:n,code:r.code}}}function _s(t,e){const n=zi(t,e);return Ee(n)}function cF(t,e){return!!(t!=null&&t.flags[e])}function Ki(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function yx(t,e){t&&delete t.flags[e]}function bx(t,e,n){const r=Ki(t,e);return r==null?void 0:r[n]}function lF(t,e,n,r){const i=Ki(t,e);return i&&(i[n]=r),r}function io(t,e){const n=bx(t,e,"board");return _s(t,gt(n)?n:"")}function uF(t,e){return(t==null?void 0:t.activelist.includes(e))??!1}function Yu(t,e,n){if(!x(t))return;lF(t,e,"board",n);const r=_s(t,n);x(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function ea(t,e,n,r){if(!x(t))return;const i=io(t,e);if(!x(i))return;const s=Sn(i,e);if(!mn(s)||!(s!=null&&s.id))return;const o=_s(t,n);if(!x(o)||(Pe(t,o),W0(t,o,Mt.ISWALK,r)))return;delete i.objects[s.id];const a=Br(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Br(o,s);o.lookup&&(o.lookup[c]=s.id),Yu(t,e,o.id)}function hF(t){const n=((t==null?void 0:t.activelist)??[]).map(r=>{const i=bx(t,r,"board");return gt(i)?i:""});return SI(n)}function na(t){const e=hF(t),n=new Set,r=[];for(let i=0;i<e.length;++i){const s=_s(t,e[i]);if(x(s)&&!n.has(s.id)){if(gt(s.over))if(gt(s.overboard)){const o=_s(t,s.overboard);x(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=Hn(t,_t.BOARD,s.over);if(o.length){const a=Ae(o),c=Ee(a);x(c)&&(s.overboard=c.id)}}else gt(s.overboard)&&delete s.overboard;if(r.push(s),gt(s.under))if(gt(s.underboard)){const o=_s(t,s.underboard);x(o)||delete s.underboard}else{const o=Hn(t,_t.BOARD,s.under);if(o.length){const a=Ae(o),c=Ee(a);x(c)&&(s.underboard=c.id)}}else gt(s.underboard)&&delete s.underboard}}return r}function fF(t,e,n,r,i){if(!x(e))return;x(e.distmaps)||(e.distmaps={});const s=`${n}.${r.x}.${r.y}.${i.x}.${i.y}`;let o=e.distmaps[s];if(!x(o)){o=new Array(vd).fill(-2);const a=[{...i}];let c=0;for(;a.length;){const l=a.shift();if(x(l)&&Ql(l)){const u=si(l,Tt);if(o[u]===-2){const d=cs(e,l.x,l.y);cc(n,le(t,d,"collision")??Mt.ISWALK)||(o[u]=c,a.push({x:l.x,y:l.y-1},{x:l.x,y:l.y+1},{x:l.x-1,y:l.y},{x:l.x+1,y:l.y})),++c}}}e.distmaps[s]=o}return o}function wx(t,e){return Ql(t)?e[si(t,Tt)]:-1}function xx(t,e,n,r,i,s){if(!x(t)||!x(e))return;const o=fF(t,e,n,r,i);if(!x(o))return;const a=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let c;if(s){let l=s?0:1e4;for(let u=0;u<a.length;++u){const d=wx(a[u],o);d>=0&&d>l&&(l=d,c=a[u])}}else{let l=1e5;for(let u=0;u<a.length;++u){const d=wx(a[u],o);d>=0&&d<l&&(l=d,c=a[u])}}return c}function Pe(t,e){var a;if(!x(t)||!x(e)||x(e.lookup)&&x(e.named))return;const n=new Array(Tt*Ht).fill(void 0),r={},i=Object.values(e.objects);for(let c=0;c<i.length;++c){const l=i[c];if(x(l.x)&&x(l.y)&&x(l.id)&&!x(l.removed)){l.category=Fn.ISOBJECT,n[l.x+l.y*Tt]=l.id;const u=Ot(l.name??((a=l.kinddata)==null?void 0:a.name)??"");r[u]||(r[u]=new Set),r[u].add(l.id)}}let s=0,o=0;for(let c=0;c<e.terrain.length;++c){const l=e.terrain[c];if(x(l)){l.x=s,l.y=o,l.category=Fn.ISTERRAIN;const u=Ci(l);r[u]||(r[u]=new Set),r[u].add(c)}++s,s>=Tt&&(s=0,++o)}e.lookup=n,e.named=r}function Uc(t,e){x(e)&&(delete e.named,delete e.lookup,Pe(t,e))}function Ex(t,e,n,r){var s;if(!x(t)||!x(e)||!x(e.named)||!x(n))return;const i=Ot(n.name??((s=n.kinddata)==null?void 0:s.name)??"");e.named[i]||(e.named[i]=new Set),e.named[i].add((n==null?void 0:n.id)??r??"")}function dF(t,e,n){if(!(!x(t)||!x(e)||!x(e.lookup)||!x(n==null?void 0:n.id))&&!x(n.removed)){const r=n.x??0,i=n.y??0;e.lookup[r+i*Tt]=n.id}}function pF(t,e,n){var r;if(x(t)&&x(e)&&x(n==null?void 0:n.x)&&x(n.y)){const i=Ci(n),s=Br(e,n);x((r=e.named)==null?void 0:r[i])&&e.named[i].delete(s)}}function K0(t,e,n){var r;if(x(t)&&x(e)&&x(n==null?void 0:n.id)){if(x(e.lookup)&&x(n.x)&&x(n.y)){const s=n.x+n.y*Tt;e.lookup[s]===n.id&&(e.lookup[s]=void 0)}const i=Ci(n);x((r=e.named)==null?void 0:r[i])&&x(n.id)&&e.named[i].delete(n.id)}}function Vu(t,e,n,r,i,s){const o=dt.MID;if(!x(t)||!x(e)||!x(n))return{dir:i,startpt:s,destpt:s,layer:o};const a={x:n.x??0,y:n.y??0},c={x:n.lx??a.x,y:n.ly??a.y},l=Ur(c,a),u=Tt-1,d=Ht-1;for(let f=0;f<i.length;++f){const h=II(i[f]);switch(h){case dt.IDLE:break;case dt.NORTH:case dt.SOUTH:case dt.WEST:case dt.EAST:Ke(a,h);break;case dt.BY:{const[p,m]=i.slice(f+1);kt(p)&&kt(m)&&(a.x=tn(a.x+p,0,u),a.y=tn(a.y+m,0,d)),f+=2;break}case dt.TO:case dt.AT:{const[p,m]=i.slice(f+1);kt(p)&&kt(m)&&(a.x=tn(p,0,u),a.y=tn(m,0,d)),f+=2;break}case dt.FLOW:Ke(a,l);break;case dt.SEEK:{const p=uN(e,n,r);Hs(p)&&Ke(a,Ur(s,p));break}case dt.RNDNS:Ke(a,Ae(dt.NORTH,dt.SOUTH));break;case dt.RNDNE:Ke(a,Ae(dt.NORTH,dt.EAST));break;case dt.RND:Ke(a,Ae(dt.NORTH,dt.SOUTH,dt.WEST,dt.EAST));break;case dt.CW:case dt.CCW:case dt.OPP:case dt.RNDP:{const p=Vu(t,e,n,r,i.slice(f+1),s);switch(a.x=s.x,a.y=s.y,h){case dt.CW:switch(Ur(s,p.destpt)){case dt.NORTH:Ke(a,dt.EAST);break;case dt.SOUTH:Ke(a,dt.WEST);break;case dt.EAST:Ke(a,dt.SOUTH);break;case dt.WEST:Ke(a,dt.NORTH);break}break;case dt.CCW:switch(Ur(s,p.destpt)){case dt.NORTH:Ke(a,dt.WEST);break;case dt.SOUTH:Ke(a,dt.EAST);break;case dt.EAST:Ke(a,dt.NORTH);break;case dt.WEST:Ke(a,dt.SOUTH);break}break;case dt.OPP:switch(Ur(s,p.destpt)){case dt.NORTH:Ke(a,dt.SOUTH);break;case dt.SOUTH:Ke(a,dt.NORTH);break;case dt.EAST:Ke(a,dt.WEST);break;case dt.WEST:Ke(a,dt.EAST);break}break;case dt.RNDP:switch(Ur(s,p.destpt)){case dt.NORTH:case dt.SOUTH:a.x+=Ae(-1,1);break;case dt.WEST:case dt.EAST:a.y+=Ae(-1,1);break}break}break}case dt.FLEE:case dt.AWAY:{const[p,m]=i.slice(f+1);if(kt(p)&&kt(m)){const b={x:tn(p,0,u),y:tn(m,0,d)},_=le(t,n,"collision"),v=xx(t,e,_,a,b,!0);x(v)&&(a.x=v.x,a.y=v.y)}f+=2;break}case dt.FIND:case dt.TOWARD:{const[p,m]=i.slice(f+1);if(kt(p)&&kt(m)){const b={x:tn(p,0,u),y:tn(m,0,d)};if(br(1,100)<5)Ke(a,Ae(dt.NORTH,dt.SOUTH,dt.WEST,dt.EAST));else{const _=le(t,n,"collision"),v=xx(t,e,_,a,b,!1);if(x(v))if(v.x!==p&&v.y!==m&&lN(e,v))switch(Ur(s,v)){case dt.EAST:case dt.WEST:a.y+=Ae(-1,1);break;case dt.NORTH:case dt.SOUTH:a.x+=Ae(-1,1);break}else a.x=v.x,a.y=v.y}}f+=2;break}case dt.PLAYER:{const p=lc(e,s,r);Hs(p)&&(a.x=p.x,a.y=p.y);break}case dt.OVER:case dt.UNDER:{const p=Vu(t,e,n,r,i.slice(f+1),s);return p.layer=h,p}}}return{dir:i,startpt:s,destpt:a,layer:o}}function mF(t,e,n,r){if(x(t)&&x(e)&&x(n)){const[i,s]=n,o=ro(t,i);if(x(o)&&x(o.name)){const a=Ad(e,r,i);return ac(a,s),a}}}function _i(t,e,n,r,i){if(x(t)&&x(e)&&x(n)){const[s,o]=n,a=Mc(t,s);if(x(a)){const l=cN(e,r,s);if(x(l)){ac(l,o);const u=si(r,Tt);return gs(t,l),Ex(t,e,l,u),l}}const c=ro(t,s);if(x(c)&&x(c.name)){const l=Ad(e,r,s,i);if(x(l))return ac(l,o),dF(t,e,l),gs(t,l),Ex(t,e,l),l}}}function En(t,e,n,r){return!x(n)||Ci(n)==="player"?!1:(n.id?(n.removed=r,K0(t,e,n)):(Se(e,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),pF(t,e,n)),!0)}function W0(t,e,n,r){if(!x(t)||!x(e)||!x(e.lookup)||r.x<0||r.x>=Tt||r.y<0||r.y>=Ht)return!0;const i=r.x+r.y*Tt,s=Sn(e,e.lookup[i]??"404");if(x(s))return!0;const o=e.terrain[i];return x(o)?cc(n,le(t,o,"collision")??Mt.ISWALK):!1}function gF(t,e,n,r){const i=Sn(e,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=le(t,i,"collision");return W0(t,e,a,r)}function H0(t,e,n,r){var f;const i=Sn(e,(n==null?void 0:n.id)??"");if(!x(t)||!x(e)||!x(i)||!x(i.x)||!x(i.y)||!x(e.lookup)||!x(n)||r.x<0||r.x>=Tt||r.y<0||r.y>=Ht)return{name:"edge",kind:"edge",collision:Mt.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Br(e,i),o=Br(e,r),a=le(t,i,"collision")??Mt.ISWALK,c=Hr(i==null?void 0:i.id),l=Sn(e,e.lookup[o]??""),u=Hr((l==null?void 0:l.id)??"");if(x(l)&&(!c||!u)){const h=le(t,n,"group")??"",p=le(t,l,"group")??"";if((h||p)&&h!=p)return{...l};if(a===Mt.ISBULLET)return{...l};if(!!le(t,l,"pushable")){const b=Ur({x:i.x,y:i.y},r),_=Ke({x:l.x??0,y:l.y??0},b),v=H0(t,e,l,_);if(x(v))return{...l}}else return{...l}}const d=e.terrain[o];if(x(d)){const h=d.collision??((f=d==null?void 0:d.kinddata)==null?void 0:f.collision)??Mt.ISWALK;if(cc(a,h))return{...d,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,x(i.removed)||(e.lookup[s]=void 0,e.lookup[o]=i.id??"")}function _F(t,e,n){const r=[];if(!x(t)||!x(e))return r;const i=Object.values(e.objects);for(let s=0;s<i.length;++s){const o=i[s];x(o.id)&&x(o.removed)&&n-o.removed>ul*5&&(r.push(o.id),rb(e,o.id))}return r}function yF(t,e,n,r=fg){const i=[];if(!x(t)||!x(e))return i;e.lookup=void 0,Pe(t,e);const s=Object.values(e.objects);for(let a=0;a<s.length;++a){const c=s[a];if(!x(c.id))continue;c.lx=c.x,c.ly=c.y;const l=gs(t,c),u=`${(l==null?void 0:l.code)??""}
${c.code??""}`;if(u){if(c.removed){const d=n-c.removed,f=le(t,c,"cycle")??r;if(d>f)continue}i.push({id:c.id,type:_t.OBJECT,code:u,object:c,terrain:void 0})}}const o=_F(t,e,n);for(let a=0;a<o.length;++a)i.push({id:o[a],type:_t.ERROR,code:"",object:void 0,terrain:void 0});return i}function vx(t,e,n){const r=[],i=[];if(!x(t)||!x(e))return{objectelements:r,terrainelements:i};function s(a){const c=le(t,a,n);return x(c)||le(t,a,"group")===n}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c)&&r.push(c)}for(let a=0;a<vd;++a){const c=e.terrain[a];x(c)&&s(c)&&i.push(c)}return{objectelements:r,terrainelements:i}}var kx={exports:{}},G0={exports:{}},Tx;function bF(){return Tx||(Tx=1,function(t,e){(function(n,r){t.exports=r()})(Mn,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function d(m){if(m)for(var b=0;b<u.length;b++)m[u[b]]!==void 0&&this["set"+r(u[b])](m[u[b]])}d.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof d)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new d(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",b=this.getLineNumber()||"",_=this.getColumnNumber()||"",v=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+b+":"+_+")":"[eval]:"+b+":"+_:v?v+" ("+m+":"+b+":"+_+")":m+":"+b+":"+_}},d.fromString=function(b){var _=b.indexOf("("),v=b.lastIndexOf(")"),T=b.substring(0,_),A=b.substring(_+1,v).split(","),C=b.substring(v+1);if(C.indexOf("@")===0)var R=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(C,""),S=R[1],U=R[2],I=R[3];return new d({functionName:T,args:A||void 0,fileName:S,lineNumber:U||void 0,columnNumber:I||void 0})};for(var f=0;f<s.length;f++)d.prototype["get"+r(s[f])]=i(s[f]),d.prototype["set"+r(s[f])]=function(m){return function(b){this[m]=!!b}}(s[f]);for(var h=0;h<o.length;h++)d.prototype["get"+r(o[h])]=i(o[h]),d.prototype["set"+r(o[h])]=function(m){return function(b){if(!n(b))throw new TypeError(m+" must be a Number");this[m]=Number(b)}}(o[h]);for(var p=0;p<a.length;p++)d.prototype["get"+r(a[p])]=i(a[p]),d.prototype["set"+r(a[p])]=function(m){return function(b){this[m]=String(b)}}(a[p]);return d})}(G0)),G0.exports}(function(t,e){(function(n,r){t.exports=r(bF())})(Mn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var d=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=d.match(/ (\(.+\)$)/);d=f?d.replace(f[0],""):d;var h=this.extractLocation(f?f[1]:d),p=f&&d||void 0,m=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:p,fileName:m,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var d=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=u.match(d),h=f&&f[1]?f[1]:void 0,p=this.extractLocation(u.replace(d,""));return new r({functionName:h,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),d=[],f=2,h=u.length;f<h;f+=2){var p=l.exec(u[f]);p&&d.push(new r({fileName:p[2],lineNumber:p[1],source:u[f]}))}return d},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),d=[],f=0,h=u.length;f<h;f+=2){var p=l.exec(u[f]);p&&d.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[f]}))}return d},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var d=u.split("@"),f=this.extractLocation(d.pop()),h=d.shift()||"",p=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;h.match(/\(([^)]*)\)/)&&(m=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:b,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:u})},this)}}})})(kx);var wF=kx.exports,xF=lo(wF);function Wi(t){const e={},n={tick(){},everytick(){},listcommands(){return dr(e)},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}function Ye(t){return`${t??""}`}function Fc(t,e){const n=parseFloat(Ye(t));return isNaN(n)?e:n}function Ax(t,e,n){var i;const[r]=nt(e,0,[j.MAYBE_NAME]);QA(tt,t,((i=w.board)==null?void 0:i.id)??"",r??"",n)}function Gn(t,e,n,r){const[i,s]=nt(r,0,[j.NUMBER_OR_STRING,j.MAYBE_NUMBER_OR_STRING]);cg(tt,t,e,n,i,s)}const EF=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function Rx(t,e,n){const[r,i]=nt(n,0,[j.NUMBER_OR_STRING]);if(kt(r))lf(tt,t,e,"volume",r);else if(EF.includes(Ot(r))){const[s,o]=nt(n,i,[j.NUMBER_OR_STRING,j.MAYBE_NUMBER_OR_STRING]);cg(tt,t,e,r,s,o)}else{const[s]=nt(n,i,[j.MAYBE_NUMBER_OR_STRING]);if(kt(s)){const o=n.length-i,a=new Array(o).fill(j.NUMBER),c=nt(n,i,a).slice(0,o),l=c.length===1?c[0]:c;lf(tt,t,e,r,l)}else{const[o]=nt(n,i,[j.MAYBE_NUMBER_OR_STRING]);lf(tt,t,e,r,o)}}}const Y0=Wi().command("talk",(t,e)=>{const[n]=nt(e,0,[j.ANY]);switch(Ot(n)){default:UA(tt,w.elementfocus);break;case"stop":FA(tt,w.elementfocus);break}return 0}).command("media",(t,e)=>{const[n]=nt(e,0,[j.ANY]);switch(Ot(n)){default:BA(tt,w.elementfocus);break;case"stop":PA(tt,w.elementfocus);break}return 0}).command("tts",(t,e)=>{const[n,r]=nt(e,0,[j.STRING]),i=e.slice(r).map(Ye).join("");return JA(tt,w.elementfocus,n,i),0}).command("bpm",(t,e)=>{const[n]=nt(e,0,[j.NUMBER]);return eR(tt,w.elementfocus,n),0}).command("vol",(t,e)=>{const[n]=nt(e,0,[j.NUMBER]);return nR(tt,w.elementfocus,n),0}).command("bgvol",(t,e)=>{const[n]=nt(e,0,[j.NUMBER]);return rR(tt,w.elementfocus,n),0}).command("ttsvol",(t,e)=>{const[n]=nt(e,0,[j.NUMBER]);return iR(tt,w.elementfocus,n),0}).command("play",(t,e)=>(Ax(w.elementfocus,e,!1),0)).command("bgplay",(t,e)=>(Ax(w.elementfocus,e,!0),0)).command("synth",(t,e)=>{for(let n=0;n<8;++n)Rx(w.elementfocus,n,e);return 0}).command("echo",(t,e)=>{for(let n=0;n<3;++n)Gn(w.elementfocus,n,"echo",e);return 0}).command("fcrush",(t,e)=>{for(let n=0;n<3;++n)Gn(w.elementfocus,n,"fc",e);return 0}).command("phaser",(t,e)=>{for(let n=0;n<3;++n)Gn(w.elementfocus,n,"phaser",e);return 0}).command("reverb",(t,e)=>{for(let n=0;n<3;++n)Gn(w.elementfocus,n,"reverb",e);return 0}).command("distort",(t,e)=>{for(let n=0;n<3;++n)Gn(w.elementfocus,n,"distort",e);return 0}).command("vibrato",(t,e)=>{for(let n=0;n<3;++n)Gn(w.elementfocus,n,"vibrato",e);return 0}).command("autowah",(t,e)=>{for(let n=0;n<3;++n)Gn(w.elementfocus,n,"autowah",e);return 0});for(let t=0;t<8;++t)Y0.command(`synth${t+1}`,(e,n)=>(Rx(w.elementfocus,t,n),0));for(let t=0;t<3;++t){const e=t+1;Y0.command(`echo${e}`,(n,r)=>(Gn(w.elementfocus,t,"echo",r),0)).command(`fcrush${e}`,(n,r)=>(Gn(w.elementfocus,t,"fcrush",r),0)).command(`phaser${e}`,(n,r)=>(Gn(w.elementfocus,t,"phaser",r),0)).command(`reverb${e}`,(n,r)=>(Gn(w.elementfocus,t,"reverb",r),0)).command(`distort${e}`,(n,r)=>(Gn(w.elementfocus,t,"distort",r),0)).command(`vibrato${e}`,(n,r)=>(Gn(w.elementfocus,t,"vibrato",r),0)).command(`autowah${e}`,(n,r)=>(Gn(w.elementfocus,t,"autowah",r),0))}const vF=yy(32,126).map(t=>String.fromCharCode(t)),kF=cr({name:"Whitespace",pattern:/ +/}),TF=cr({name:"WhitespaceSkipped",pattern:/ +/,group:rn.SKIPPED}),V0=cr({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),Sx=cr({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:vF}),Z0=cr({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),X0=cr({name:"EscapedDollar",pattern:"$$"}),q0=cr({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),J0=cr({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),Ox=cr({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function AF(t,e=""){return cr({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const Ix=Object.keys(nc).map(t=>AF(`\\$(${t})`,t)),RF=[kF,V0,...Ix,Z0,Sx,J0,X0,Ox,q0],SF=new rn(RF,{skipValidations:!gi,ensureOptimizations:gi}),OF=new rn([TF,V0,...Ix,Z0,Sx,J0,X0,Ox,q0],{skipValidations:!gi,ensureOptimizations:gi});function Q0(t,e=!1){return e?OF.tokenize(t):SF.tokenize(t)}function tp(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function Nx(t){t.active={...t.reset}}function Cx(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case X0:s("$");break;case J0:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case Z0:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case V0:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=nc[l],d=CI(At[u]),f=LI(At[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):x(d)?e.active.color=d:x(f)?e.active.bg=f:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(x(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){Nx(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;NF(u,u+l.length,e.active.color,e.active.bg,e),IF(u,l,e)}}}function Lx(t,e,n){const r=Q0(t);r.tokens&&(Cx(r.tokens,e),n&&Nx(e),e.changed())}function Mx(t,e,n){const r=Q0(t);if(!r.tokens)return;const i=tp(e,n,At.WHITE,At.BLACK);return i.measureonly=!0,Cx(r.tokens,i),i.x>0&&++i.y,i}function IF(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++);n.changed()}function NF(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function Ux(t,e,n){if(!Hs(w.element))return 0;const[r,i]=nt(e,0,[j.DIR,j.MAYBE_KIND]),s=i??["bullet"],o=mF(w.book,w.board,s,{x:w.element.x,y:w.element.y});if(x(o)){x(n)&&(o.arg=n),o.party=w.elementid,o.collision=Mt.ISBULLET,o.breakable=1,o.stepx=r.destpt.x-w.element.x,o.stepy=r.destpt.y-w.element.y,o.bg=At.ONCLEAR;const a=gs(w.book,o),c=o.code??(a==null?void 0:a.code)??"";ME(w.book,w.board,o,c,1)}return t.yield(),0}function Zu(t,e,n,r){var u,d;if(!Hs(w.element)||!x(w.book)||!x(w.board)||!x(w.element))return 0;Pe(w.book,w.board);const[i,s]=nt(e,0,[j.DIR,j.KIND]),o=te(w.board,i.destpt);if((o==null?void 0:o.category)===Fn.ISOBJECT&&(o!=null&&o.pushable)){const f={x:((u=w.element)==null?void 0:u.x)??0,y:((d=w.element)==null?void 0:d.y)??0},h=Ke(i.destpt,Ur(f,i.destpt));H0(w.book,w.board,o,h)}const[a]=s,c=Mc(w.book,a);x(c)&&_i(w.book,w.board,s,i.destpt,n);const l=ro(w.book,a);if(x(l)){const f=ro(w.book,a)??Mc(w.book,a),h=le(w.book,f,"collision")??Mt.ISWALK;if(!W0(w.book,w.board,h,i.destpt)){const m=_i(w.book,w.board,s,i.destpt,n);x(m)&&x(r)&&(m.arg=r)}}return 0}const CF=Wi().command("board",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;const[n,r]=nt(e,0,[j.STRING]),[i,s]=nt(e,r,[j.MAYBE_NUMBER,j.MAYBE_NUMBER]),o=Hn(w.book,_t.BOARD,n);if(o.length){const a=Ae(...o);x(a)&&ea(w.book,w.elementfocus,a.id,{x:i??Math.round(Tt*.5),y:s??Math.round(Ht*.5)})}return 0}).command("build",(t,e)=>{if(!x(w.book)||!x(w.board)||!x(w.element))return 0;const[n,r]=nt(e,0,[j.NAME,j.MAYBE_STRING]);if(gt(r)){const s=Hn(w.book,_t.BOARD,r),o=Ae(...s);return x(o)&&t.set(n,o.id),0}const i=Jl();return x(i)&&t.set(n,i.id),0}).command("shove",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;Pe(w.book,w.board);const[n,r]=nt(e,0,[j.DIR,j.DIR]),i=te(w.board,n.destpt);return mn(i)&&ks(w.book,w.board,i,r.destpt),0}).command("duplicate",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;Pe(w.book,w.board);const[n,r]=nt(e,0,[j.DIR,j.DIR]),i=te(w.board,n.destpt);return mn(i),0}).command("write",(t,e)=>{var d;if(!x(w.book)||!x(w.board))return 0;Pe(w.book,w.board);const[n,r,i]=nt(e,0,[j.DIR,j.COLOR,j.STRING]),{color:s,bg:o}=Sy(r),a=((d=Mx(i,256,1))==null?void 0:d.measuredwidth)??1,c=tp(256,1,s??At.WHITE,o??At.BLACK);Lx(i,c,!1);const l=a-1;switch(Ur(n.startpt,n.destpt)){case dt.EAST:for(let f=0;f<a;++f)Se(w.board,{x:n.destpt.x+f,y:n.destpt.y,name:"text",char:c.char[f],color:c.color[f],bg:c.bg[f]});break;case dt.WEST:for(let f=0;f<a;++f)Se(w.board,{x:n.destpt.x+f-l,y:n.destpt.y,name:"text",char:c.char[f],color:c.color[f],bg:c.bg[f]});break;case dt.NORTH:for(let f=0;f<a;++f)Se(w.board,{x:n.destpt.x,y:n.destpt.y+f-l,name:"text",char:c.char[f],color:c.color[f],bg:c.bg[f]});break;case dt.SOUTH:for(let f=0;f<a;++f)Se(w.board,{x:n.destpt.x,y:n.destpt.y+f,name:"text",char:c.char[f],color:c.color[f],bg:c.bg[f]});break}return 0}).command("change",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;Pe(w.book,w.board);const[n,r]=nt(e,0,[j.KIND,j.KIND]);(Kl(n)??"")==="empty"&&hN(w.board).forEach(c=>{_i(w.book,w.board,r,c)});const s=Kl(r),o=pd(r),a=Iy(r);return Rd(w.board,n).forEach(c=>{if(Ci(c)===s)x(o)&&(c.color=o),x(a)&&(c.bg=a);else if(En(w.book,w.board,c,w.timestamp),s!=="empty"){const l={x:c.x??0,y:c.y??0};_i(w.book,w.board,r,l)}}),0}).command("put",(t,e)=>Zu(t,e)).command("putwith",(t,e)=>{const[n,r]=nt(e,0,[j.ANY]);return Zu(t,e.slice(r),void 0,n)}).command("oneof",(t,e)=>{const[n,r]=nt(e,0,[j.ANY]);return x(w.board)&&Sn(w.board,n)?0:Zu(t,e.slice(r),n)}).command("oneofwith",(t,e)=>{const[n,r,i]=nt(e,0,[j.ANY,j.ANY]);return x(w.board)&&Sn(w.board,r)?0:Zu(t,e.slice(i),r,n)}).command("shoot",Ux).command("shootwith",(t,e)=>{const[n,r]=nt(e,0,[j.ANY]);return Ux(t,e.slice(r),n)}),ys="$dkpurple",LF="$196",MF="$205",sn="$yellow$205$205$205$196";function Oe(t,e,n){SA(t,e,n)}function UF(t,e,n){const r=LF.repeat(n);Oe(t,e,`${ys}${r}`)}function ep(t,e,n){const r=MF.repeat(n);Oe(t,e,`${ys}${r}`)}function np(t,e,n){Oe(t,e,`${ys} ${" ".repeat(n.length)} `),UF(t,e,n.length+2),Oe(t,e,`${ys} $white${n} `),ep(t,e,n.length+2)}function so(t,e,n){Oe(t,e,`${ys} ${" ".repeat(n.length)} `),Oe(t,e,`${ys} $gray${n} `),ep(t,e,n.length+2)}function Bc(t,e,n,r){Oe(t,e,`${ys} $white${n} $blue${r}`)}function Yn(t,e,n){Oe(t,e,`${ys}$blue${n}`)}function FF(t,e,n,r){Oe(t,e,`!${n};${r}`)}var BF=`desc;$DKGRAYname and type of codepage
`,PF=Object.freeze({__proto__:null,default:BF}),DF="desc;changes object into specified element",$F=Object.freeze({__proto__:null,default:DF}),jF="desc;like #play but for sound effects",zF=Object.freeze({__proto__:null,default:jF}),KF="",WF=Object.freeze({__proto__:null,default:KF}),HF="",GF=Object.freeze({__proto__:null,default:HF}),YF="",VF=Object.freeze({__proto__:null,default:YF}),ZF="",XF=Object.freeze({__proto__:null,default:ZF}),qF="",JF=Object.freeze({__proto__:null,default:qF}),QF="",tB=Object.freeze({__proto__:null,default:QF}),eB="",nB=Object.freeze({__proto__:null,default:eB}),rB="",iB=Object.freeze({__proto__:null,default:rB}),sB="",oB=Object.freeze({__proto__:null,default:sB}),aB="",cB=Object.freeze({__proto__:null,default:aB}),lB="",uB=Object.freeze({__proto__:null,default:lB}),hB="",fB=Object.freeze({__proto__:null,default:hB}),dB="",pB=Object.freeze({__proto__:null,default:dB}),mB="",gB=Object.freeze({__proto__:null,default:mB}),_B="",yB=Object.freeze({__proto__:null,default:_B}),bB=`desc;$DKGRAYstarts a section of an if-do-done block
`,wB=Object.freeze({__proto__:null,default:bB}),xB=`desc;$DKGRAYcompletes an if-do-done block
`,EB=Object.freeze({__proto__:null,default:xB}),vB="",kB=Object.freeze({__proto__:null,default:vB}),TB="",AB=Object.freeze({__proto__:null,default:TB}),RB="",SB=Object.freeze({__proto__:null,default:RB}),OB=`desc;$DKGRAYelse logic in an if-do-done block
`,IB=Object.freeze({__proto__:null,default:OB}),NB=`desc;$DKGRAYconditional else logic in an if-do-done block
`,CB=Object.freeze({__proto__:null,default:NB}),LB="",MB=Object.freeze({__proto__:null,default:LB}),UB="",FB=Object.freeze({__proto__:null,default:UB}),BB="",PB=Object.freeze({__proto__:null,default:BB}),DB="",$B=Object.freeze({__proto__:null,default:DB}),jB="",zB=Object.freeze({__proto__:null,default:jB}),KB="",WB=Object.freeze({__proto__:null,default:KB}),HB="",GB=Object.freeze({__proto__:null,default:HB}),YB="",VB=Object.freeze({__proto__:null,default:YB}),ZB=`desc;$DKGRAYhalt until the next cycle
`,XB=Object.freeze({__proto__:null,default:ZB}),qB=`desc;$DKGRAYevals condition for true or false
`,JB=Object.freeze({__proto__:null,default:qB}),QB="",tP=Object.freeze({__proto__:null,default:QB}),eP="",nP=Object.freeze({__proto__:null,default:eP}),rP="",iP=Object.freeze({__proto__:null,default:rP}),sP="",oP=Object.freeze({__proto__:null,default:sP}),aP="",cP=Object.freeze({__proto__:null,default:aP}),lP="",uP=Object.freeze({__proto__:null,default:lP}),hP="",fP=Object.freeze({__proto__:null,default:hP}),dP="",pP=Object.freeze({__proto__:null,default:dP}),mP="",gP=Object.freeze({__proto__:null,default:mP}),_P="",yP=Object.freeze({__proto__:null,default:_P}),bP="",wP=Object.freeze({__proto__:null,default:bP}),xP="",EP=Object.freeze({__proto__:null,default:xP}),vP="",kP=Object.freeze({__proto__:null,default:vP}),TP="",AP=Object.freeze({__proto__:null,default:TP}),RP="",SP=Object.freeze({__proto__:null,default:RP}),OP="",IP=Object.freeze({__proto__:null,default:OP}),NP="",CP=Object.freeze({__proto__:null,default:NP}),LP="",MP=Object.freeze({__proto__:null,default:LP}),UP="",FP=Object.freeze({__proto__:null,default:UP}),BP="",PP=Object.freeze({__proto__:null,default:BP}),DP="",$P=Object.freeze({__proto__:null,default:DP}),jP=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,zP=Object.freeze({__proto__:null,default:jP}),KP="",WP=Object.freeze({__proto__:null,default:KP}),HP="",GP=Object.freeze({__proto__:null,default:HP}),YP="",VP=Object.freeze({__proto__:null,default:YP}),ZP="",XP=Object.freeze({__proto__:null,default:ZP}),qP="",JP=Object.freeze({__proto__:null,default:qP}),QP="",tD=Object.freeze({__proto__:null,default:QP}),eD="",nD=Object.freeze({__proto__:null,default:eD}),rD="",iD=Object.freeze({__proto__:null,default:rD}),sD="",oD=Object.freeze({__proto__:null,default:sD}),aD="",cD=Object.freeze({__proto__:null,default:aD}),lD="",uD=Object.freeze({__proto__:null,default:lD}),hD="",fD=Object.freeze({__proto__:null,default:hD}),dD="",pD=Object.freeze({__proto__:null,default:dD}),mD="",gD=Object.freeze({__proto__:null,default:mD}),_D="",yD=Object.freeze({__proto__:null,default:_D}),bD="",wD=Object.freeze({__proto__:null,default:bD}),xD="",ED=Object.freeze({__proto__:null,default:xD}),vD="",kD=Object.freeze({__proto__:null,default:vD}),TD="",AD=Object.freeze({__proto__:null,default:TD}),RD=`desc;$DKGRAYdesignates an inactive label or comment
`,SD=Object.freeze({__proto__:null,default:RD}),OD=`desc;$DKGRAYadds hyperlink text

`,ID=Object.freeze({__proto__:null,default:OD}),ND=`desc;$DKGRAYsends the given message when hotkey is pressed

`,CD=Object.freeze({__proto__:null,default:ND}),LD=`desc;$DKGRAYread number input into given stat/flag
`,MD=Object.freeze({__proto__:null,default:LD}),UD=`desc;$DKGRAYa slider input from 1 to 9 

`,FD=Object.freeze({__proto__:null,default:UD}),BD=`desc;$DKGRAYlist with label value pairs to pick from
`,PD=Object.freeze({__proto__:null,default:BD}),DD=`desc;$DKGRAYread text input into given stat/flag
`,$D=Object.freeze({__proto__:null,default:DD}),jD=`desc;$DKGRAYdesignates a starting point for running code
`,zD=Object.freeze({__proto__:null,default:jD}),KD=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,WD=Object.freeze({__proto__:null,default:KD}),HD=`desc;$DKGRAYwill move the object in the given direction
`,GD=Object.freeze({__proto__:null,default:HD}),YD=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,VD=Object.freeze({__proto__:null,default:YD}),ZD=`desc;$DKGRAYcustom 8x14 charset
`,XD=Object.freeze({__proto__:null,default:ZD}),qD=`desc;$DKGRAYsets stat to given value

`,JD=Object.freeze({__proto__:null,default:qD}),QD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,t$=Object.freeze({__proto__:null,default:QD}),e$=`desc;$DKGRAYread external content and/or handle events
`,n$=Object.freeze({__proto__:null,default:e$}),r$=`desc;$DKGRAYread number input into given stat/flag
`,i$=Object.freeze({__proto__:null,default:r$}),s$=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,o$=Object.freeze({__proto__:null,default:s$}),a$=`desc;$DKGRAYcustom palette colors
`,c$=Object.freeze({__proto__:null,default:a$}),l$=`desc;$DKGRAYa slider input from 1 to 9 

`,u$=Object.freeze({__proto__:null,default:l$}),h$=`desc;$DKGRAYlist with label value pairs to pick from
`,f$=Object.freeze({__proto__:null,default:h$}),d$=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,p$=Object.freeze({__proto__:null,default:d$}),m$=`desc;$DKGRAYread text input into given stat/flag
`,g$=Object.freeze({__proto__:null,default:m$}),_$=`desc;$DKGRAYadds text
`,y$=Object.freeze({__proto__:null,default:_$}),b$=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,w$=Object.freeze({__proto__:null,default:b$}),x$=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,E$=Object.freeze({__proto__:null,default:x$}),v$=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,k$=Object.freeze({__proto__:null,default:v$}),T$=`header;player settings
#set user "name goes here"
`,A$=Object.freeze({__proto__:null,default:T$}),R$=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,S$=Object.freeze({__proto__:null,default:R$});const Fx=Object.assign({"./editor/codepagename.txt":PF,"./editor/command/become.txt":$F,"./editor/command/bgplay.txt":zF,"./editor/command/bgvol.txt":WF,"./editor/command/bind.txt":GF,"./editor/command/board.txt":VF,"./editor/command/bpm.txt":XF,"./editor/command/break.txt":JF,"./editor/command/change.txt":tB,"./editor/command/char.txt":nB,"./editor/command/charset.txt":iB,"./editor/command/clear.txt":oB,"./editor/command/color.txt":cB,"./editor/command/continue.txt":uB,"./editor/command/copy.txt":fB,"./editor/command/cycle.txt":pB,"./editor/command/die.txt":gB,"./editor/command/distort.txt":yB,"./editor/command/do.txt":wB,"./editor/command/done.txt":EB,"./editor/command/duplicate.txt":kB,"./editor/command/echo.txt":AB,"./editor/command/edge.txt":SB,"./editor/command/else.txt":IB,"./editor/command/elseif.txt":CB,"./editor/command/end.txt":MB,"./editor/command/endgame.txt":FB,"./editor/command/endwith.txt":PB,"./editor/command/fcrush.txt":$B,"./editor/command/fetch.txt":zB,"./editor/command/fetchwith.txt":WB,"./editor/command/foreach.txt":GB,"./editor/command/go.txt":VB,"./editor/command/idle.txt":XB,"./editor/command/if.txt":JB,"./editor/command/lock.txt":tP,"./editor/command/oneof.txt":nP,"./editor/command/oneofwith.txt":iP,"./editor/command/palette.txt":oP,"./editor/command/phaser.txt":cP,"./editor/command/pivot.txt":uP,"./editor/command/play.txt":fP,"./editor/command/put.txt":pP,"./editor/command/putwith.txt":gP,"./editor/command/readbin.txt":yP,"./editor/command/readjson.txt":wP,"./editor/command/readline.txt":EP,"./editor/command/readrexpaint.txt":kP,"./editor/command/remix.txt":AP,"./editor/command/repeat.txt":SP,"./editor/command/restore.txt":IP,"./editor/command/reverb.txt":CP,"./editor/command/revert.txt":MP,"./editor/command/run.txt":FP,"./editor/command/runwith.txt":PP,"./editor/command/set.txt":$P,"./editor/command/shoot.txt":zP,"./editor/command/shootwith.txt":WP,"./editor/command/shove.txt":GP,"./editor/command/snapshot.txt":VP,"./editor/command/synth.txt":XP,"./editor/command/toast.txt":JP,"./editor/command/tts.txt":tD,"./editor/command/ttsvol.txt":nD,"./editor/command/twitchbroadcast.txt":iD,"./editor/command/twitchchat.txt":oD,"./editor/command/unlock.txt":cD,"./editor/command/vibrato.txt":uD,"./editor/command/vol.txt":fD,"./editor/command/waitfor.txt":pD,"./editor/command/walk.txt":gD,"./editor/command/weave.txt":yD,"./editor/command/while.txt":wD,"./editor/command/with.txt":ED,"./editor/command/write.txt":kD,"./editor/command/zap.txt":AD,"./editor/comment.txt":SD,"./editor/hyperlink.txt":ID,"./editor/hyperlink/hotkey.txt":CD,"./editor/hyperlink/number.txt":MD,"./editor/hyperlink/range.txt":FD,"./editor/hyperlink/select.txt":PD,"./editor/hyperlink/text.txt":$D,"./editor/label.txt":zD,"./editor/shortgo.txt":WD,"./editor/shorttry.txt":GD,"./editor/stat/board.txt":VD,"./editor/stat/charset.txt":XD,"./editor/stat/const.txt":JD,"./editor/stat/hotkey.txt":t$,"./editor/stat/loader.txt":n$,"./editor/stat/number.txt":i$,"./editor/stat/object.txt":o$,"./editor/stat/palette.txt":c$,"./editor/stat/range.txt":u$,"./editor/stat/select.txt":f$,"./editor/stat/terrain.txt":p$,"./editor/stat/text.txt":g$,"./editor/text.txt":y$,"./help/controls.txt":w$,"./help/developer.txt":E$,"./help/menu.txt":k$,"./help/player.txt":A$,"./help/text.txt":S$}),Bx={};dr(Fx).forEach(t=>{const e=t.replace(".txt","").replace("./","").replaceAll("/",":");Bx[e]=Fx[t].default});function O$(t){const e=Ot(t.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=Bx[e];if(x(n))return n;const{target:r,path:i}=tr(e);switch(r){case"editor":{const s=tr(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function I$(t,e){const n=(t??"").split(`
`);for(let r=0;r<n.length;++r)e(n[r].split(";"))}function N$(t,e){const[n,...r]=e,i=r[0]??"",s=r[1]??"";switch(Ot(n.trim())){case"header":np(tt,t,i);break;case"section":so(tt,t,i);break;case"option":Bc(tt,t,i,s);break;default:n.trimStart().startsWith("!")?FF(tt,t,n.trimStart().slice(1),i):Oe(tt,t,n);break}}function Hi(t){const[e,n]=nt(t,0,[j.ANY,j.ANY]);if(Ot(e)==="send"&&Fr(n)){const[,r,i]=nt(t,0,[j.NAME,j.DIR]);return{targetdir:r,label:t.slice(i).join(" ")}}else if(gt(e)){const[r,i,s]=nt(t,0,[j.NAME,j.MAYBE_NAME]);return gt(i)&&i.startsWith(":")?{targetname:r,label:[i.substring(1).trim(),...t.slice(s)].join(" ")}:{targetname:"self",label:[r,...t.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function ra(){hg(tt,fr())}function Pc(t){I$(O$(`help:${t}`),e=>N$(w.elementfocus,e))}function Px(t){switch(t.label){case"helpmenu":Pc("menu");break;case"helpcontrols":Pc("controls");break;case"helptext":Pc("text");break;case"helpdeveloper":Pc("developer");break;case"helpplayer":Pc("player");break;default:{const e=ue(Pt.MAIN),n=na(e);x(t.targetname)?da(t.targetname,t.label,void 0,n):x(t.targetdir)&&da(t.targetdir.destpt,t.label,void 0,n);break}}}const C$=Wi().command("shortsend",(t,e)=>{const n=Hi(e);return Px(n),0}).command("send",(t,e)=>{const n=Hi(["send",...e]);return Px(n),0}).command("stat",(t,e)=>{const[n,...r]=e.map(Ye),i=r.join(" ");function s(o,a){if(x(o)&&(t.command("pageopen",o.id),a)){const c=He(o),l=ji(o);Oe(tt,w.elementfocus,`!pageopen ${o.id};$blue[${l}]$white ${c}`)}}switch(Ot(n)){case lr(vt.LOADER):{const[o,a]=vs(Pt.CONTENT,i,_t.LOADER);s(o,a);break}default:{const[o,a]=vs(Pt.CONTENT,[n,...r].join(" "),_t.OBJECT);s(o,a);break}case lr(vt.BOARD):{const[o,a]=vs(Pt.CONTENT,i,_t.BOARD);s(o,a);break}case lr(vt.OBJECT):{const[o,a]=vs(Pt.CONTENT,i,_t.OBJECT);s(o,a);break}case lr(vt.TERRAIN):{const[o,a]=vs(Pt.CONTENT,i,_t.TERRAIN);s(o,a);break}case lr(vt.CHARSET):{const[o,a]=vs(Pt.CONTENT,i,_t.CHARSET);s(o,a);break}case lr(vt.PALETTE):{const[o,a]=vs(Pt.CONTENT,i,_t.PALETTE);s(o,a);break}}return 0}).command("text",(t,e)=>{const n=e.map(Ye).join(" ");if(x(w.element)&&w.elementisplayer){const{user:r}=Sr(w.elementid),i=gt(r)?r:"player";w.element.tickertext=`${i}: ${n}`,w.element.tickertime=w.timestamp;const s=ta(w.book,w.element,1,At.WHITE,At.BLACK);pe(tt,w.elementid,`$${At[s.color]}$ON${At[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${n}`),Da(tt,w.elementid,void 0,"text","chat:message:game",`${i}:${n}`)}return 0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=Ye(n),s=Hi(r);if(x(s.targetname)){const{user:o}=Sr(w.elementid),a=gt(o)?o:"player",c=ta(w.book,w.element,1,At.WHITE,At.BLACK),l=`$${At[c.color]}$ON${At[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;pe(tt,w.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(t,e)=>{const[n,r]=nt(e,0,[j.MAYBE_NAME,j.MAYBE_STRING]);return gt(n)&&gt(r)?sR(tt,w.elementfocus,n,r):oR(tt,w.elementfocus),0}).command("bookcreate",(t,e)=>{const[n]=nt(e,0,[j.MAYBE_NAME]),r=OE(n);return x(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=nt(e,0,[j.NAME]),r=Wr(n);return x(r)?(pe(tt,w.elementfocus,`opened [book] ${r.name}`),fh(Pt.MAIN,r.id),t.command("pages")):de(tt,w.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(t,e)=>{const[n]=nt(e,0,[j.NAME]),r=ue(Pt.MAIN),i=Wr(n);return x(i)&&(r===i&&fh(Pt.MAIN,""),N4(n),pe(tt,w.elementfocus,`trashed [book] ${i.name}`),ra(),t.command("pages")),0}).command("boardopen",(t,e)=>{const[n]=nt(e,0,[j.NAME]),r=Hn(w.book,_t.BOARD,n);if(r.length){const i=Ae(...r);x(i)&&ea(w.book,w.elementfocus,i.id,{x:br(0,Tt-1),y:br(0,Ht-1)})}return 0}).command("pageopen",(t,e)=>{const[n,r]=nt(e,0,[j.NAME,j.MAYBE_NAME]),i=bn(Pt.MAIN);if(!x(i))return 0;const s=zi(i,n);if(x(s)){const o=He(s),a=ji(s);pe(tt,w.elementfocus,`opened [${a}] ${o}`);const c=[s.id,r];sd(ll(i.id,c),s.code);const l=ji(s);lg(tt,w.elementfocus,i.id,c,l,`${o} - ${i.name}`)}else de(tt,"pageopen",`page ${n} not found`,w.elementfocus);return 0}).command("pagetrash",(t,e)=>{const[n]=nt(e,0,[j.NAME]),r=bn(Pt.MAIN),i=_x(r,n);if(x(n)){const s=He(i),o=ji(i);pe(tt,w.elementfocus,`trashed [${o}] ${s}`),ra(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(Ye).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{so(tt,w.elementfocus,"books");const t=ue(Pt.MAIN);Bc(tt,w.elementfocus,"main",`${(t==null?void 0:t.name)??"empty"} $GREEN${(t==null?void 0:t.id)??""}`);const e=ue(Pt.CONTENT);Bc(tt,w.elementfocus,"content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),ep(tt,w.elementfocus,7);const n=ha();return n.length?n.forEach(r=>{Oe(tt,w.elementfocus,`!bookopen ${r.id};${r.name}`)}):Yn(tt,w.elementfocus,"no books found"),Oe(tt,w.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const t=bn(Pt.MAIN);return x(t)&&(so(tt,w.elementfocus,"pages"),Bc(tt,w.elementfocus,"main",`${t.name} $GREEN${t.id}`),t.pages.length?z0(t).forEach(n=>{const r=He(n),i=ji(n);Oe(tt,w.elementfocus,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(Oe(tt,w.elementfocus,""),Yn(tt,w.elementfocus,"$white no pages found"),Yn(tt,w.elementfocus,"$white use @ to create a page"),Yn(tt,w.elementfocus,"$white @board name of board"),Yn(tt,w.elementfocus,"$white @object name of object"),Yn(tt,w.elementfocus,"$white @terrain name of terrain"),Yn(tt,w.elementfocus,"$white You can omit the type and it will default to object"),Yn(tt,w.elementfocus,"$white @object name of object"),Yn(tt,w.elementfocus,"$white @name of object"))),0}).command("boards",()=>{so(tt,w.elementfocus,"boards");const t=bn(Pt.MAIN);if(x(t)){Bc(tt,w.elementfocus,"main",`${t.name} $GREEN${t.id}`);const e=z0(t);e.filter(n=>$i(n)===_t.BOARD).forEach(n=>{const r=He(n),i=ji(n);Oe(tt,w.elementfocus,`!boardopen ${n.id};$blue[${i}]$white ${r}`)}),e.length===0&&(Oe(tt,w.elementfocus,""),Yn(tt,w.elementfocus,"$white no boards found"),Yn(tt,w.elementfocus,"$white use @ to create a board"),Yn(tt,w.elementfocus,"$white @board name of board"))}return 0}).command("trash",()=>{so(tt,w.elementfocus,"$REDTRASH"),Yn(tt,w.elementfocus,"books");const t=ha();t.length&&(t.forEach(n=>{Oe(tt,w.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Oe(tt,w.elementfocus,""));const e=ue(Pt.MAIN);return x(e)&&(Yn(tt,w.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=He(n);Oe(tt,w.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),Oe(tt,w.elementfocus,"")),0}).command("dev",()=>(ra(),VA(tt,w.elementfocus),0)).command("share",()=>(ra(),ZA(tt,w.elementfocus),0)).command("save",()=>(ra(),0)).command("fork",()=>(hR(tt,w.elementfocus),0)).command("nuke",()=>(XA(tt,w.elementfocus),0)).command("restart",()=>(uR(tt,w.elementfocus),ra(),0)).command("export",()=>{np(tt,w.elementfocus,"E X P O R T"),so(tt,w.elementfocus,"books");const t=ha();return t.length&&t.forEach(e=>Oe(tt,w.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(t,e)=>{const[n]=nt(e,0,[j.NAME]),r=Wr(n);return x(r)&&(np(tt,w.elementfocus,"E X P O R T"),so(tt,w.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=z0(r);Oe(tt,w.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=He(s),a=ji(s);Oe(tt,w.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(t,e)=>{const[n]=nt(e,0,[j.NAME]),r=Wr(n);return x(r)&&ag(tt,w.elementfocus,Qn(r),`${r.name}.book.json`),0}).command("pageexport",(t,e)=>{const[n]=nt(e,0,[j.NAME]),{target:r,path:i}=tr(n),s=Wr(r),o=zi(s,i);return x(o)&&ag(tt,w.elementfocus,Qn(o),`${He(o)}.${ji(o)}.json`),0}).command("gadget",()=>(aR(tt,w.elementfocus),0)).command("joincode",(t,e)=>{const[n]=nt(e,0,[j.MAYBE_NAME]);return DA(tt,w.elementfocus,!!n),0}).command("jointab",(t,e)=>{const[n]=nt(e,0,[j.MAYBE_NAME]);return $A(tt,w.elementfocus,!!n),0}).command("startlookingglass",()=>(qA(tt,w.elementfocus),0)),L$=Wi().command("toast",(t,e)=>{const n=e.map(Ye).join("");return OA(tt,w.elementfocus,n),0}).command("palette",(t,e)=>{const[n]=nt(e,0,[j.NAME]),r=NE(),i=Ge(w.book,_t.PALETTE,n);return x(i)?(r.palette=i.id,pe(tt,w.elementfocus,`loaded palette ${n}`)):de(tt,w.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(t,e)=>{const[n]=nt(e,0,[j.NAME]),r=NE(),i=Ge(w.book,_t.CHARSET,n);return x(i)?(r.charset=i.id,pe(tt,w.elementfocus,`loaded charset ${n}`)):de(tt,w.elementfocus,"not-found",`unabled to find charset ${n}`),0}),rp={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Dc(t){return ce(t)&&Dx(t[0])}function Dx(t){return x(Fn[t])&&gt(t)}function $x(t){if(gt(t))return rp[Ot(t)]}function jx(t){if(Dc(t))return t;if(Dx(t))return[t];const e=$x(t);if(x(e))return[e]}function M$(t){const e=w.words[t],n=jx(e);if(Dc(n))return[n,t+1];const[r,i]=Xn(t),s=jx(r);return Dc(s)?[s,i]:[void 0,t]}const ip={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Mt.ISSOLID,Mt.ISWALK,Mt.ISSWIM,Mt.ISBULLET,Mt.ISWALK,Mt.ISSWIM;function Xu(t){return ce(t)&&sp(t[0])}function sp(t){return x(Mt[t])&&gt(t)}function U$(t){if(gt(t))return ip[Ot(t)]}function F$(t){const e=w.words[t];if(Xu(e))return[e,t+1];if(sp(e))return[[e],t+1];const[n,r]=Xn(t);return Xu(n)?[n,r]:sp(n)?[[n],r]:[void 0,t]}const B$=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),zx=new Set(["char","color","bg","group","party","player","pushable","collision","breakable","p1","p2","p3","cycle","stepx","stepy","light","lightdir","sender","arg"]),P$=["NORTH","SOUTH","WEST","EAST"];function D$(t){const e=Sr(t);if(kt(e.inputcurrent)||(e.inputcurrent=0),ce(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[n]=e.inputqueue,[r=On.NONE,i=0]=n??[On.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&wN?1:0,e.inputctrl=i&xN?1:0,e.inputshift=i&EN?1:0,r){case On.MOVE_UP:case On.MOVE_DOWN:case On.MOVE_LEFT:case On.MOVE_RIGHT:e.inputmove=[P$[r-On.MOVE_UP]];break;case On.OK_BUTTON:e.inputok=1;break;case On.CANCEL_BUTTON:e.inputcancel=1;break;case On.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==On.NONE&&o!==r}),e}function $$(t){const e=rp[t];if(x(e))return e;const n=ip[t];if(x(n))return n;const r=nc[t];if(x(r))return r;const i=hd[t];if(x(i))return i}const j$=Wi({get(t,e){var o,a,c,l,u,d,f,h,p,m,b,_,v,T,A,C,R,S,U,I,P;const n=$$(e);if(x(n))return[!0,n];if(w.elementisplayer&&B$.has(e)){const W=D$(w.elementid)[e];return[x(W),W]}const r=lc(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus),i=(r==null?void 0:r.id)??w.elementfocus??fr();switch(e){case"camera":case"graphics":case"facing":if(x((c=w.board)==null?void 0:c[e]))return[!0,(l=w.board)==null?void 0:l[e]];break;case"isdark":return[!0,(u=w.board)!=null&&u.isdark?1:0];case"startx":return[!0,((d=w.board)==null?void 0:d.startx)??0];case"starty":return[!0,((f=w.board)==null?void 0:f.starty)??0];case"over":return[!0,((h=w.board)==null?void 0:h.over)??""];case"under":return[!0,((p=w.board)==null?void 0:p.under)??""];case"exitnorth":return[!0,((m=w.board)==null?void 0:m.exitnorth)??""];case"exitsouth":return[!0,((b=w.board)==null?void 0:b.exitsouth)??""];case"exitwest":return[!0,((_=w.board)==null?void 0:_.exitwest)??""];case"exiteast":return[!0,((v=w.board)==null?void 0:v.exiteast)??""];case"timelimit":return[!0,((T=w.board)==null?void 0:T.timelimit)??0];case"restartonzap":return[!0,((A=w.board)==null?void 0:A.restartonzap)??0];case"maxplayershots":return[!0,((C=w.board)==null?void 0:C.maxplayershots)??0];case"boardid":return[!0,((R=w.board)==null?void 0:R.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((S=w.element)==null?void 0:S.id)??""];case"thisx":return[!0,((U=w.element)==null?void 0:U.x)??-1];case"thisy":return[!0,((I=w.element)==null?void 0:I.y)??-1];default:{const W=(P=w.element)==null?void 0:P[e];if(zx.has(e))return[!0,W];break}}const s=Sr(i)[e];return[x(s),s]},set(t,e,n){var o,a;const r=lc(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus),i=(r==null?void 0:r.id)??w.elementfocus;switch(e){case"camera":case"graphics":case"facing":break;case"isdark":if(x(w.board))return w.board.isdark=n?1:0,[!0,w.board.isdark];break;case"startx":if(x(w.board))return w.board.startx=Fc(n,0),[!0,w.board.startx];break;case"starty":if(x(w.board))return w.board.starty=Fc(n,0),[!0,w.board.starty];break;case"over":if(x(w.board))return w.board.over=Ye(n),[!0,w.board.over];break;case"under":if(x(w.board))return[!0,w.board.under=Ye(n)];break;case"exitnorth":if(x(w.board))return[!0,w.board.exitnorth=Ye(n)];break;case"exitsouth":if(x(w.board))return[!0,w.board.exitsouth=Ye(n)];break;case"exitwest":if(x(w.board))return[!0,w.board.exitwest=Ye(n)];break;case"exiteast":if(x(w.board))return[!0,w.board.exiteast=Ye(n)];break;case"timelimit":if(x(w.board))return[!0,w.board.timelimit=Fc(n,0)];break;case"restartonzap":if(x(w.board))return[!0,w.board.restartonzap=n?1:0];break;case"maxplayershots":if(x(w.board))return[!0,w.board.maxplayershots=Fc(n,0)];break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(zx.has(e))return x(w.element)&&(w.element[e]=n),[!0,n];break}}const s=Sr(i);return x(s)?(s[e]=n,[!0,n]):[!1,n]},everytick(){var t,e,n,r,i;if(!((t=w.element)!=null&&t.removed)&&(x((e=w.element)==null?void 0:e.stepx)||x((n=w.element)==null?void 0:n.stepy))){const s={x:((r=w.element)==null?void 0:r.x)??0,y:((i=w.element)==null?void 0:i.y)??0};ks(w.book,w.board,w.element,{x:s.x+(w.element.stepx??0),y:s.y+(w.element.stepy??0)})===!1&&(w.element.stepx=0,w.element.stepy=0,le(w.book,w.element,"breakable")&&En(w.book,w.board,w.element,w.timestamp))}}}).command("clear",(t,e)=>{for(let n=0;n<e.length;++n)t.set(Ye(e[n]),0);return 0}).command("set",(t,e)=>{const[n,r]=nt(e,0,[j.NAME,j.ANY]);return t.set(n,r??1),0}).command("become",(t,e)=>{var r,i;const[n]=nt(e,0,[j.KIND]);if(Pe(w.book,w.board),K0(w.book,w.board,w.element),En(w.book,w.board,w.element,w.timestamp)){const s={x:((r=w.element)==null?void 0:r.x)??0,y:((i=w.element)==null?void 0:i.y)??0};_i(w.book,w.board,n,s)}return t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[n]=nt(e,0,[j.ANY]);if(Fr(n)){const[r,i]=nt(e,0,[j.DIR,j.NUMBER]),s=te(w.board,r.destpt);x(s)&&(s.char=i)}else x(w.element)&&kt(n)&&(w.element.char=n);return 0}).command("color",(t,e)=>{const[n]=nt(e,0,[j.ANY]);if(Fr(n)){const[r,i]=nt(e,0,[j.DIR,j.COLOR]),s=te(w.board,r.destpt);x(s)&&ac(w.element,i)}else{const[r]=nt(e,0,[j.COLOR]);x(w.element)&&x(r)&&ac(w.element,r)}return 0}).command("go",(t,e)=>{if(x(w.element)){const[n]=nt(e,0,[j.DIR]);if(ks(w.book,w.board,w.element,n.destpt),t.yield(),w.element.x===n.destpt.x&&w.element.y===n.destpt.y)return 0}return 1}).command("walk",(t,e)=>{if(!x(w.element))return 0;const[n]=nt(e,0,[j.DIR]),r=w.element.x??0,i=w.element.y??0;return w.element.stepx=n.destpt.x-r,w.element.stepy=n.destpt.y-i,0}).command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=nt(e,0,[j.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(Ye(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(Ye(e[0])),0)).command("cycle",(t,e)=>{if(x(w.element)){const[n]=nt(e,0,[j.NUMBER]);w.element.cycle=tn(Math.round(n),1,255)}return 0}).command("die",t=>(En(w.book,w.board,w.element,w.timestamp),t.endofprogram(),0)).command("endgame",()=>(ug(tt,w.elementfocus),0)).command("run",(t,e)=>{const[n]=nt(e,0,[j.NAME]);return dh(n),0}).command("runwith",(t,e)=>{const[n,r]=nt(e,0,[j.ANY,j.NAME]);return t.set("arg",n),dh(r),0}),qu={};function z$(t){var e;return(e=qu[t])==null?void 0:e.arg}function K$(t){var e;return(e=qu[t])==null?void 0:e.format}function bs(t){var e;return(e=qu[t])==null?void 0:e.content}function W$(t,e,n,r,i){const s=ue(Pt.MAIN);if(!x(s))return;const o=no(s,_t.LOADER).filter(a=>{const c=eo(a),l=c.format,u=gt(l)?new RegExp(l).test(e):!1,d=c.event,f=gt(d)?new RegExp(d).test(n):!1;return gt(l)&&gt(d)?u&&f:gt(l)?u:gt(d)?f:!1});for(let a=0;a<o.length;++a){const c=`${je()}_loader`;qu[c]={arg:t,format:e,content:r,player:i},F4(c,o[a].code)}}function Kx(t,e){if(!x(t))return;const n=Ot(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const H$=(t,e)=>{const n=bs(t.id());if(!x(n))return 0;const[r,i]=nt(e,0,[j.NAME]),s=Ot(r);switch(s){case"seek":{const[o]=nt(e,i,[j.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=nt(e,i,[j.NAME]);t.set(o,Kx(n,s));break}case"text":{const[o,a]=nt(e,i,[j.NAME,j.NAME]),c=Kx(n,o);if(kt(c)&&gt(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),d=new TextDecoder("utf-8").decode(l);t.set(a,d),n.cursor+=c}break}case"palette":{const[o]=nt(e,i,[j.NAME]),[a]=j0(w.book,_t.PALETTE,o),c=Ee(a);if(x(c)){const l=dN*hc,u=Od(new Uint8Array(n.bytes.buffer,n.cursor,l));x(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=nt(e,i,[j.NAME]),[a]=j0(w.book,_t.CHARSET,o),c=Ee(a);if(x(c)){const l=tu*fN*Sd,u=cb(new Uint8Array(n.bytes.buffer,n.cursor,l));x(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},ia=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",Ju=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(!Ju(t[n],e[n]))return!1;return!0}if(ia(t)&&ia(e)){const n=Object.entries(t),r=new Set(Object.keys(e));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Ju(s,e[i]))return!1;r.delete(i)}return r.size===0}return!1},Qu=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if(ia(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},G$=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",Wx=t=>t>="0"&&t<="9"||t==="-",Y$=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var X;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(X||(X={}));const Hx={"(":X.TOK_LPAREN,")":X.TOK_RPAREN,"*":X.TOK_STAR,",":X.TOK_COMMA,".":X.TOK_DOT,":":X.TOK_COLON,"@":X.TOK_CURRENT,$:X.TOK_ROOT,"]":X.TOK_RBRACKET,"{":X.TOK_LBRACE,"}":X.TOK_RBRACE},V$={"!":!0,"<":!0,"=":!0,">":!0},Z$={"	":!0,"\n":!0,"\r":!0," ":!0};class X${constructor(){this._current=0}tokenize(e){const n=[];this._current=0;let r,i,s;for(;this._current<e.length;)if(G$(e[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(e),n.push({start:r,type:X.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Hx[e[this._current]]!==void 0)n.push({start:this._current,type:Hx[e[this._current]],value:e[this._current]}),this._current+=1;else if(Wx(e[this._current]))s=this.consumeNumber(e),n.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),n.push(s);else if(e[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(e),n.push({start:r,type:X.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(e),n.push({start:r,type:X.TOK_LITERAL,value:i});else if(e[this._current]==="`"){r=this._current;const o=this.consumeLiteral(e);n.push({start:r,type:X.TOK_LITERAL,value:o})}else if(V$[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&n.push(s);else if(Z$[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")r=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,n.push({start:r,type:X.TOK_AND,value:"&&"})):n.push({start:r,type:X.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")r=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,n.push({start:r,type:X.TOK_OR,value:"||"})):n.push({start:r,type:X.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(e){const n=this._current;for(this._current+=1;this._current<e.length&&Y$(e[this._current]);)this._current+=1;return e.slice(n,this._current)}consumeQuotedIdentifier(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=='"'&&this._current<r;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(n,this._current))}consumeRawStringLiteral(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=="'"&&this._current<r;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(e){const n=this._current;this._current+=1;const r=e.length;for(;Wx(e[this._current])&&this._current<r;)this._current+=1;const i=parseInt(e.slice(n,this._current),10);return{start:n,value:i,type:X.TOK_NUMBER}}consumeLBracket(e){const n=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:n,type:X.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:n,type:X.TOK_FLATTEN,value:"[]"}):{start:n,type:X.TOK_LBRACKET,value:"["}}consumeOperator(e){const n=this._current,r=e[n];if(this._current+=1,r==="!")return e[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_NE,value:"!="}):{start:n,type:X.TOK_NOT,value:"!"};if(r==="<")return e[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_LTE,value:"<="}):{start:n,type:X.TOK_LT,value:"<"};if(r===">")return e[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_GTE,value:">="}):{start:n,type:X.TOK_GT,value:">"};if(r==="="&&e[this._current]==="=")return this._current+=1,{start:n,type:X.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const n=this._current,r=e.length;for(;e[this._current]!=="`"&&this._current<r;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const n='[{"',r=["true","false","null"],i="-0123456789";if(e==="")return!1;if(n.includes(e[0])||r.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const q$=new X$,vn={[X.TOK_EOF]:0,[X.TOK_UNQUOTEDIDENTIFIER]:0,[X.TOK_QUOTEDIDENTIFIER]:0,[X.TOK_RBRACKET]:0,[X.TOK_RPAREN]:0,[X.TOK_COMMA]:0,[X.TOK_RBRACE]:0,[X.TOK_NUMBER]:0,[X.TOK_CURRENT]:0,[X.TOK_EXPREF]:0,[X.TOK_ROOT]:0,[X.TOK_PIPE]:1,[X.TOK_OR]:2,[X.TOK_AND]:3,[X.TOK_EQ]:5,[X.TOK_GT]:5,[X.TOK_LT]:5,[X.TOK_GTE]:5,[X.TOK_LTE]:5,[X.TOK_NE]:5,[X.TOK_FLATTEN]:9,[X.TOK_STAR]:20,[X.TOK_FILTER]:21,[X.TOK_DOT]:40,[X.TOK_NOT]:45,[X.TOK_LBRACE]:50,[X.TOK_LBRACKET]:55,[X.TOK_LPAREN]:60};class J${constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==X.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(e){this.tokens=[...q$.tokenize(e),{type:X.TOK_EOF,value:"",start:e.length}]}expression(e){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;e<vn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let n,r,i;switch(e.type){case X.TOK_LITERAL:return{type:"Literal",value:e.value};case X.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case X.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===X.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case X.TOK_NOT:return r=this.expression(vn.Not),{type:"NotExpression",children:[r]};case X.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===X.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(vn.Star),{type:"ValueProjection",children:[n,r]};case X.TOK_FILTER:return this.led(e.type,{type:"Identity"});case X.TOK_LBRACE:return this.parseMultiselectHash();case X.TOK_FLATTEN:return n={type:X.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(vn.Flatten),{type:"Projection",children:[n,r]};case X.TOK_LBRACKET:return this.lookahead(0)===X.TOK_NUMBER||this.lookahead(0)===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===X.TOK_STAR&&this.lookahead(1)===X.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(vn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case X.TOK_CURRENT:return{type:X.TOK_CURRENT};case X.TOK_ROOT:return{type:X.TOK_ROOT};case X.TOK_EXPREF:return i=this.expression(vn.Expref),{type:"ExpressionReference",children:[i]};case X.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(i={type:X.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(X.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,n){let r;switch(e){case X.TOK_DOT:const i=vn.Dot;return this.lookahead(0)!==X.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case X.TOK_PIPE:return r=this.expression(vn.Pipe),{type:X.TOK_PIPE,children:[n,r]};case X.TOK_OR:return r=this.expression(vn.Or),{type:"OrExpression",children:[n,r]};case X.TOK_AND:return r=this.expression(vn.And),{type:"AndExpression",children:[n,r]};case X.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(a={type:X.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===X.TOK_COMMA&&this.match(X.TOK_COMMA),o.push(a);return this.match(X.TOK_RPAREN),{name:s,type:"Function",children:o};case X.TOK_FILTER:const l=this.expression(0);return this.match(X.TOK_RBRACKET),r=this.lookahead(0)===X.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(vn.Filter),{type:"FilterProjection",children:[n,r,l]};case X.TOK_FLATTEN:const u={type:X.TOK_FLATTEN,children:[n]},d=this.parseProjectionRHS(vn.Flatten);return{type:"Projection",children:[u,d]};case X.TOK_EQ:case X.TOK_NE:case X.TOK_GT:case X.TOK_GTE:case X.TOK_LT:case X.TOK_LTE:return this.parseComparator(n,e);case X.TOK_LBRACKET:const f=this.lookaheadToken(0);return f.type===X.TOK_NUMBER||f.type===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(X.TOK_STAR),this.match(X.TOK_RBRACKET),r=this.parseProjectionRHS(vn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${e}, got: ${n.type}`)}}errorToken(e,n=""){const r=new Error(n||`Invalid token (${e.type}): "${e.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===X.TOK_COLON||this.lookahead(1)===X.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(X.TOK_RBRACKET),e}projectIfSlice(e,n){const r={type:"IndexExpression",children:[e,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(vn.Star)],type:"Projection"}:r}parseSliceExpression(){const e=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==X.TOK_RBRACKET&&n<3;){if(r===X.TOK_COLON)n+=1,this.advance();else if(r===X.TOK_NUMBER)e[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(X.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,n){const r=this.expression(vn[n]);return{type:"Comparator",name:n,children:[e,r]}}parseDotRHS(e){const n=this.lookahead(0);if([X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER,X.TOK_STAR].includes(n))return this.expression(e);if(n===X.TOK_LBRACKET)return this.match(X.TOK_LBRACKET),this.parseMultiselectList();if(n===X.TOK_LBRACE)return this.match(X.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(vn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===X.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===X.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===X.TOK_DOT)return this.match(X.TOK_DOT),this.parseDotRHS(e);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==X.TOK_RBRACKET;){const n=this.expression(0);if(e.push(n),this.lookahead(0)===X.TOK_COMMA&&(this.match(X.TOK_COMMA),this.lookahead(0)===X.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(X.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],n=[X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(X.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===X.TOK_COMMA)this.match(X.TOK_COMMA);else if(this.lookahead(0)===X.TOK_RBRACE){this.match(X.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const Q$=new J$;var ut;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ut||(ut={}));class t5{constructor(e){this.TYPE_NAME_TABLE={[ut.TYPE_NUMBER]:"number",[ut.TYPE_ANY]:"any",[ut.TYPE_STRING]:"string",[ut.TYPE_ARRAY]:"array",[ut.TYPE_OBJECT]:"object",[ut.TYPE_BOOLEAN]:"boolean",[ut.TYPE_EXPREF]:"expression",[ut.TYPE_NULL]:"null",[ut.TYPE_ARRAY_NUMBER]:"Array<number>",[ut.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>ia(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ut.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ut.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ut.TYPE_NUMBER,ut.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),d=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(d)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(d)]}`);return u>d?1:u<d?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ut.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ut.TYPE_NUMBER?n:r===ut.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ut.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ut.TYPE_NUMBER:return"number";case ut.TYPE_STRING:return"string";case ut.TYPE_ARRAY:return"array";case ut.TYPE_OBJECT:return"object";case ut.TYPE_BOOLEAN:return"boolean";case ut.TYPE_EXPREF:return"expref";case ut.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ut.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ut.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]},{types:[ut.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ut.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ut.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY,ut.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ut.TYPE_EXPREF]},{types:[ut.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ut.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ut.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ut.TYPE_ARRAY_STRING,ut.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ut.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ut.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ut.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ut.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ut.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,n,r){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:n.bind(this),_signature:r}}callFunction(e,n){const r=this.functionTable[e];if(r===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,n,r._signature),r._func.call(this,n)}validateInputSignatures(e,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${r+1} must occur last`)}validateArgs(e,n,r){var i,s;let o;this.validateInputSignatures(e,r);const a=r.filter(m=>{var b;return(b=!m.optional)!==null&&b!==void 0?b:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,d=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${e}() takes ${d}${a} argument${o&&"s"||""} but received ${n.length}`);let f,h,p;for(let m=0;m<r.length;m+=1){p=!1,f=r[m].types,h=this.getTypeName(n[m]);let b;for(b=0;b<f.length;b+=1)if(h!==void 0&&this.typeMatches(h,f[b],n[m])){p=!0;break}if(!p&&h!==void 0){const _=f.map(v=>this.TYPE_NAME_TABLE[v]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${m+1} to be type (${_}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(e,n,r){if(n===ut.TYPE_ANY)return!0;if(n===ut.TYPE_ARRAY_STRING||n===ut.TYPE_ARRAY_NUMBER||n===ut.TYPE_ARRAY){if(n===ut.TYPE_ARRAY)return e===ut.TYPE_ARRAY;if(e===ut.TYPE_ARRAY){let i;n===ut.TYPE_ARRAY_NUMBER?i=ut.TYPE_NUMBER:n===ut.TYPE_ARRAY_STRING&&(i=ut.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return e===n;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return ut.TYPE_STRING;case"[object Number]":return ut.TYPE_NUMBER;case"[object Array]":return ut.TYPE_ARRAY;case"[object Boolean]":return ut.TYPE_BOOLEAN;case"[object Null]":return ut.TYPE_NULL;case"[object Object]":return e.jmespathType===X.TOK_EXPREF?ut.TYPE_EXPREF:ut.TYPE_OBJECT;default:return}}createKeyFunction(e,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(e,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class e5{constructor(){this._rootValue=null,this.runtime=new t5(this)}search(e,n){return this._rootValue=n,this.visit(e,n)}visit(e,n){let r,i,s,o,a,c,l,u,d,f,h;switch(e.type){case"Field":return n===null?null:ia(n)?(c=n[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],n),f=1;f<e.children.length;f+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],n),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let p=e.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...e.children],b=this.computeSliceParams(n.length,m),[_,v,T]=b;if(s=[],T>0)for(f=_;f<v;f+=T)s.push(n[f]);else for(f=_;f>v;f+=T)s.push(n[f]);return s;case"Projection":if(h=this.visit(e.children[0],n),!Array.isArray(h))return null;for(d=[],f=0;f<h.length;f+=1)i=this.visit(e.children[1],h[f]),i!==null&&d.push(i);return d;case"ValueProjection":if(h=this.visit(e.children[0],n),!ia(h))return null;d=[];const A=Object.values(h);for(f=0;f<A.length;f+=1)i=this.visit(e.children[1],A[f]),i!==null&&d.push(i);return d;case"FilterProjection":if(h=this.visit(e.children[0],n),!Array.isArray(h))return null;const C=[],R=[];for(f=0;f<h.length;f+=1)r=this.visit(e.children[2],h[f]),Qu(r)||C.push(h[f]);for(let L=0;L<C.length;L+=1)i=this.visit(e.children[1],C[L]),i!==null&&R.push(i);return R;case"Comparator":switch(o=this.visit(e.children[0],n),a=this.visit(e.children[1],n),e.name){case X.TOK_EQ:s=Ju(o,a);break;case X.TOK_NE:s=!Ju(o,a);break;case X.TOK_GT:s=o>a;break;case X.TOK_GTE:s=o>=a;break;case X.TOK_LT:s=o<a;break;case X.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case X.TOK_FLATTEN:const S=this.visit(e.children[0],n);if(!Array.isArray(S))return null;let U=[];for(f=0;f<S.length;f+=1)i=S[f],Array.isArray(i)?U=[...U,...i]:U.push(i);return U;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(d=[],f=0;f<e.children.length;f+=1)d.push(this.visit(e.children[f],n));return d;case"MultiSelectHash":if(n===null)return null;d={};let I;for(f=0;f<e.children.length;f+=1)I=e.children[f],d[I.name]=this.visit(I.value,n);return d;case"OrExpression":return r=this.visit(e.children[0],n),Qu(r)&&(r=this.visit(e.children[1],n)),r;case"AndExpression":return o=this.visit(e.children[0],n),Qu(o)?o:this.visit(e.children[1],n);case"NotExpression":return o=this.visit(e.children[0],n),Qu(o);case"Literal":return e.value;case X.TOK_PIPE:return l=this.visit(e.children[0],n),this.visit(e.children[1],l);case X.TOK_CURRENT:return n;case X.TOK_ROOT:return this._rootValue;case"Function":const P=[];for(let L=0;L<e.children.length;L+=1)P.push(this.visit(e.children[L],n));return this.runtime.callFunction(e.name,P);case"ExpressionReference":const W=e.children[0];return W.jmespathType=X.TOK_EXPREF,W;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?e-1:0:this.capSliceRange(e,r,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[r,i,s]}capSliceRange(e,n,r){let i=n;return i<0?(i+=e,i<0&&(i=r<0?-1:0)):i>=e&&(i=r<0?e-1:e),i}}const n5=new e5;ut.TYPE_ANY,ut.TYPE_ARRAY,ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING,ut.TYPE_BOOLEAN,ut.TYPE_EXPREF,ut.TYPE_NULL,ut.TYPE_NUMBER,ut.TYPE_OBJECT,ut.TYPE_STRING;function r5(t,e){const n=Q$.parse(e);return n5.search(n,t)}const i5=(t,e)=>{const n=bs(t.id());if(!x(n))return 0;const[r,i]=nt(e,0,[j.NAME,j.NAME]),s=r5(n.json,r);return t.set(i,s),0};function s5(t,e){return Math.sqrt(Math.pow(t.r-e.r,2)+Math.pow(t.g-e.g,2)+Math.pow(t.b-e.b,2))}const th=Od(lb);function Gx(t){let e;if(!x(th))return e;let n=1e9;for(let r=0;r<=At.BLACK;++r){const i=r*hc,s=th.bits[i],o=th.bits[i+1],a=th.bits[i+2],c=s5(t,{r:s,g:o,b:a,hex:""});c<n&&(e=r,n=c)}return e}const o5=(t,e)=>{var a,c,l,u;const n=bs(t.id());if(!x(n))return 0;const[r,i]=nt(e,0,[j.NAME]),s=Ot(r),o=((a=n.content)==null?void 0:a.layers)??[];switch(s){case"seek":{const[d]=nt(e,i,[j.NUMBER]);n.cursor=tn(d,0,o.length-1);break}case"layer":{const d=n.cursor+1;n.cursor=tn(d,0,o.length-1);break}case"char":{const[d,f,h]=nt(e,i,[j.NUMBER,j.NUMBER,j.NAME]),p=(c=n.content)==null?void 0:c.layers[n.cursor];x(p)&&$o(d,f,0,p.width-1,p.height-1,0)&&t.set(h,p.raster[d+f*p.width].asciiCode);break}case"color":{const[d,f,h]=nt(e,i,[j.NUMBER,j.NUMBER,j.NAME]),p=(l=n.content)==null?void 0:l.layers[n.cursor];x(p)&&$o(d,f,0,p.width-1,p.height-1,0)&&t.set(h,Gx(p.raster[d+f*p.width].color));break}case"bg":{const[d,f,h]=nt(e,i,[j.NUMBER,j.NUMBER,j.NAME]),p=(u=n.content)==null?void 0:u.layers[n.cursor];x(p)&&$o(d,f,0,p.width-1,p.height-1,0)&&t.set(h,Gx(p.raster[d+f*p.width].bg));break}}return 0},a5=(t,e)=>{const n=bs(t.id());if(!x(n))return 0;const[r,i]=nt(e,0,[j.NAME]);switch(Ot(r)){case"seek":{const[o]=nt(e,i,[j.NUMBER]);n.cursor=tn(o,0,n.lines.length-1);break}case"line":n.cursor=tn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[d,f]=nt(e,u,[j.NAME]);t.set(d,c[l]??0),++l,u=f}break}}return 0};function Yx(t){const e=ue(Pt.MAIN),n=na(e);x(t.targetdir)?da(t.targetdir.destpt,t.label,void 0,n):x(t.targetname)&&da(t.targetname,t.label,void 0,n)}const c5=Wi({get(t,e){var r,i,s;const n=K$(t.id());if(e==="format")return[!0,n];switch(n){case"text":{const o=bs(t.id());switch(e){case"filename":return[!0,o.filename];case"cursor":return[!0,o.cursor];case"lines":return[!0,o.lines.length]}break}case"json":{const o=bs(t.id());switch(e){case"filename":return[!0,o.filename]}break}case"binary":{const o=bs(t.id());switch(e){case"filename":return[!0,o.filename];case"cursor":return[!0,o.cursor];case"bytes":return[!0,o.bytes.length]}break}case"rexpaint":{const o=bs(t.id());switch(e){case"filename":return[!0,o.filename];case"layers":return[!0,((r=o.content)==null?void 0:r.layers.length)??0];case"width":return[!0,((i=o.content)==null?void 0:i.layers[o.cursor].width)??0];case"height":return[!0,((s=o.content)==null?void 0:s.layers[o.cursor].height)??0];case"cursor":return[!0,o.cursor]}break}}return[!1,void 0]}}).command("shortsend",(t,e)=>{const n=Hi(e);return Yx(n),0}).command("send",(t,e)=>{const n=Hi(["send",...e]);return Yx(n),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(Ye).join(" ");return pe(tt,w.elementfocus,"$175",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=Ye(n),s=Hi(r);return x(s.targetname)&&pe(tt,w.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",a5).command("readjson",i5).command("readbin",H$).command("readrexpaint",o5).command("withboard",(t,e)=>{const[n]=nt(e,0,[j.STRING]),r=Hn(w.book,_t.BOARD,n);if(r.length){const i=Ae(...r);x(i)&&(w.board=Ee(i),w.element={x:-1,y:-1})}return 0});function Vx(t,e,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=nt(i,a,[j.ANY]);ce(c)&&!Fr(c)&&!Dc(c)&&!Xu(c)&&!oi(c)?o.push(...c):o.push(c),a=l}switch(Ot(r)){case"get":case"post:json":MA(tt,w.elementfocus,t,e,n,r,o);break}return 0}const l5=Wi().command("fetch",(t,e)=>{const[n,r,i="get",s]=nt(e,0,[j.NAME,j.NAME,j.MAYBE_STRING]);return Vx(void 0,n,r,i,e,s),0}).command("fetchwith",(t,e)=>{const[n,r,i,s="get",o]=nt(e,0,[j.ANY,j.NAME,j.NAME,j.MAYBE_STRING]);return Vx(n,r,i,s,e,o),0}).command("chat",(t,e)=>{const[n]=nt(e,0,[j.MAYBE_NAME]);return n?CA(tt,w.elementfocus,n):LA(tt,w.elementfocus),0}).command("broadcast",(t,e)=>{const[n]=nt(e,0,[j.MAYBE_NAME]);return n?IA(tt,w.elementfocus,n):NA(tt,w.elementfocus),0});function Zx(t,e){var n,r;if(x(e.targetname))switch(e.targetname){case"all":for(const i of Object.keys(((n=w.board)==null?void 0:n.objects)??{}))t.send(w.elementfocus,i,e.label);break;case"self":t.message({session:tt.session(),player:w.elementfocus,id:je(),sender:t.id(),target:e.label});break;case"others":for(const i of Object.keys(((r=w.board)==null?void 0:r.objects)??{}))i!==t.id()&&t.send(w.elementfocus,i,e.label);break;default:{const i=ib(w.board,[e.targetname]);for(let s=0;s<i.length;++s){const o=i[s];x(o.id)&&t.send(w.elementfocus,o.id,e.label)}break}}else if(x(e.targetdir)){const i=te(w.board,e.targetdir.destpt);x(i==null?void 0:i.id)&&t.send(w.elementfocus,i.id,e.label)}}const u5=Wi({set(t,e,n){return Y4(t,e,n),[!1,void 0]},everytick(){const t=Ln(w.elementid),[e]=t;if(t.length===1&&gt(e)){if(x(w.element))if(e.trim().length===0){const n=qe(w.elementid);n.sidebar=[]}else w.element.tickertext=e,w.element.tickertime=w.timestamp}else if(t.length>1)if(w.elementisplayer){const n=qe(w.elementid);n.sidebar=t}else{const n=qe(w.elementfocus);n.scroll=t}}}).command("shortsend",(t,e)=>{const n=Hi(e);return Zx(t,n),0}).command("send",(t,e)=>{const n=Hi(["send",...e]);return Zx(t,n),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(Ye).join("");return Lt(w.elementid,n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=Ye(n),s=Hi(r);return x(s.targetname)&&Nt(w.elementid,t.id(),i,`${s.targetname}:${s.label}`.split(" "),t.get,t.set),0});function Xx(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=te(e,{x:s,y:i});mn(o)&&En(t,e,o,t.timestamp),Se(e,{x:s,y:i})}}function h5(t,e,n){for(let r=e.y;r<=n.y;++r)for(let i=e.x;i<=n.x;++i)Se(t,{x:i,y:r})}function qx(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=te(e,{x:s,y:i});mn(o)&&En(t,e,o,t.timestamp),Se(e,{x:s,y:i})}}function sa(t,e){x(t)&&(t.name=e.name,t.char=e.char,t.color=e.color,t.bg=e.bg,t.p1=e.p1,t.p2=e.p2,t.p3=e.p3,t.code=e.code,t.group=e.group,t.party=e.party,t.cycle=e.cycle,t.light=e.light,t.stepx=e.stepx,t.stepy=e.stepy,t.pushable=e.pushable,t.collision=e.collision,t.breakable=e.breakable,t.tickertext=e.tickertext,t.tickertime=e.tickertime)}function op(t,e,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return f5(t,e,n,i)}if(!x(w.book))return;const s=w.book,o=Ge(s,_t.BOARD,t),a=Ee(o);if(!x(a))return;const c=Ge(s,_t.BOARD,e),l=Ee(c);if(!x(l))return;Pe(s,a),Pe(s,l);let u=!1;if(x(a)&&x(l)){switch(i){case"all":Xx(s,l,n,r);break;case"object":qx(s,l,n,r);break;case"terrain":h5(l,n,r);break;default:u=!0;break}for(let d=n.y;d<=r.y;++d)for(let f=n.x;f<=r.x;++f){let h=!1,p=!1;switch(i){case"all":h=!0,p=!0;break;case"object":h=!0;break;case"terrain":p=!0;break}const m={x:f,y:d};let b,_=te(a,m);if(mn(_)?(b=cs(a,f,d),Hr(_==null?void 0:_.id)&&(_=void 0)):(b=_,_=void 0),x(b)&&(p||u&&le(s,b,"group")===i)){u&&Xx(s,l,m,m);const v=_i(s,l,[b.kind??""],m);sa(v,b)}if(x(_)&&(h||u&&le(s,_,"group")===i)){u&&qx(s,l,m,m);const v=_i(s,l,[_.kind??""],m);sa(v,_)}}Uc(s,l)}}function f5(t,e,n,r){if(!x(w.book))return;const i=w.book,s=Ge(i,_t.BOARD,t),o=Ee(s);if(!x(o))return;const a=Ge(i,_t.BOARD,e),c=Ee(a);if(x(c)&&(Pe(i,o),Pe(i,c),x(o)&&x(c))){const{terrainelements:l,objectelements:u}=vx(i,o,r);if(l.length===0&&u.length===0)return;const d={x:Tt,y:Ht};for(let f=0;f<l.length;++f){const h=l[f];kt(h.x)&&(d.x=Math.min(d.x,h.x)),kt(h.y)&&(d.y=Math.min(d.y,h.y))}for(let f=0;f<u.length;++f){const h=u[f];kt(h.x)&&(d.x=Math.min(d.x,h.x)),kt(h.y)&&(d.y=Math.min(d.y,h.y))}for(let f=0;f<l.length;++f){const h=l[f],p={x:n.x+(h.x??0)-d.x,y:n.y+(h.y??0)-d.y},m=te(c,p);x(m)&&(mn(m)&&En(i,c,m,i.timestamp),Se(c,p));const b=_i(i,c,[h.kind??""],p);sa(b,h)}for(let f=0;f<u.length;++f){const h=u[f],p={x:n.x+(h.x??0)-d.x,y:n.y+(h.y??0)-d.y},m=_i(i,c,[h.kind??""],p);sa(m,h)}Uc(i,c)}}function d5(t,e,n,r,i){if(!x(w.book))return;const s=w.book,o=Ge(s,_t.BOARD,t),a=Ee(o);if(!x(a))return;const c=Jl(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";Pe(s,a),Pe(s,c);const d=-Math.tan(e*.5),f=Math.sin(e),h=Math.round(12.5*d),p=Math.round(12.5*f),m=new Array(Ht).fill(0);cy(h,0,-h,Ht-1).forEach(A=>{A.x<0?m[A.y]=Math.min(m[A.y],A.x):m[A.y]=Math.max(m[A.y],A.x)});const _=new Array(Tt).fill(0);cy(0,p,Tt-1,-p).forEach(A=>{A.y<0?_[A.x]=Math.min(_[A.x],A.y):_[A.x]=Math.max(_[A.x],A.y)});const T=[m,_,m];for(let A=0;A<T.length;++A){const C=T[A];if(A!==1){for(let R=0;R<Ht;++R){const S=C[R],U=R*Tt;for(let I=0;I<Tt;I++){const P=(I+S+Tt)%Tt;u&&(c.terrain[P+U]=a.terrain[I+U])}}if(l){const R=Object.keys(a.objects);for(let S=0;S<R.length;++S){const U=R[S],{x:I,y:P}=a.objects[U];if(x(I)&&x(P)){const W=C[P];a.objects[U].x=(I+W+Tt)%Tt,a.objects[U].lx=a.objects[U].x}}}}if(A===1){for(let R=0;R<Tt;++R){const S=C[R];for(let U=0;U<Ht;++U){const I=(U+S+Ht)%Ht;u&&(c.terrain[R+I*Tt]=a.terrain[R+U*Tt])}}if(l){const R=Object.keys(a.objects);for(let S=0;S<R.length;++S){const U=R[S],{x:I,y:P}=a.objects[U];if(x(I)&&x(P)){const W=C[I];a.objects[U].y=(P+W+Ht)%Ht,a.objects[U].ly=a.objects[U].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,Pe(s,c),Pe(s,a)}}function p5(t,e){let n=0,r=0,i=0;for(;i<t.length;i++)n+=t[i];for(i=0,e*=n;e&&i<t.length;){if(r+=t[i],e<=r)return i;i++}return 0}var m5=p5;const g5=m5,Jt=function(){};Jt.prototype.FMX=0,Jt.prototype.FMY=0,Jt.prototype.FMXxFMY=0,Jt.prototype.T=0,Jt.prototype.N=0,Jt.prototype.initiliazedField=!1,Jt.prototype.generationComplete=!1,Jt.prototype.wave=null,Jt.prototype.compatible=null,Jt.prototype.weightLogWeights=null,Jt.prototype.sumOfWeights=0,Jt.prototype.sumOfWeightLogWeights=0,Jt.prototype.startingEntropy=0,Jt.prototype.sumsOfOnes=null,Jt.prototype.sumsOfWeights=null,Jt.prototype.sumsOfWeightLogWeights=null,Jt.prototype.entropies=null,Jt.prototype.propagator=null,Jt.prototype.observed=null,Jt.prototype.distribution=null,Jt.prototype.stack=null,Jt.prototype.stackSize=0,Jt.prototype.DX=[-1,0,1,0],Jt.prototype.DY=[0,1,0,-1],Jt.prototype.opposite=[2,3,0,1],Jt.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let t=0;t<this.FMXxFMY;t++){this.wave[t]=new Array(this.T),this.compatible[t]=new Array(this.T);for(let e=0;e<this.T;e++)this.compatible[t][e]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let t=0;t<this.T;t++)this.weightLogWeights[t]=this.weights[t]*Math.log(this.weights[t]),this.sumOfWeights+=this.weights[t],this.sumOfWeightLogWeights+=this.weightLogWeights[t];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},Jt.prototype.observe=function(t){let e=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=e){const c=1e-6*t();a+c<e&&(e=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=g5(this.distribution,t()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},Jt.prototype.propagate=function(){for(;this.stackSize>0;){const t=this.stack[this.stackSize-1];this.stackSize--;const e=t[0],n=e%this.FMX,r=e/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][t[1]],d=this.compatible[l];for(let f=0;f<u.length;f++){const h=u[f],p=d[h];p[i]--,p[i]==0&&this.ban(l,h)}}}},Jt.prototype.singleIteration=function(t){const e=this.observe(t);return e!==null?(this.generationComplete=e,!!e):(this.propagate(),null)},Jt.prototype.iterate=function(t,e){this.wave||this.initialize(),this.initiliazedField||this.clear(),t=t||0,e=e||Math.random;for(let n=0;n<t||t===0;n++){const r=this.singleIteration(e);if(r!==null)return!!r}return!0},Jt.prototype.generate=function(t){for(t=t||Math.random,this.wave||this.initialize(),this.clear();;){const e=this.singleIteration(t);if(e!==null)return!!e}},Jt.prototype.isGenerationComplete=function(){return this.generationComplete},Jt.prototype.ban=function(t,e){const n=this.compatible[t][e];for(let i=0;i<4;i++)n[i]=0;this.wave[t][e]=!1,this.stack[this.stackSize]=[t,e],this.stackSize++,this.sumsOfOnes[t]-=1,this.sumsOfWeights[t]-=this.weights[e],this.sumsOfWeightLogWeights[t]-=this.weightLogWeights[e];const r=this.sumsOfWeights[t];this.entropies[t]=Math.log(r)-this.sumsOfWeightLogWeights[t]/r},Jt.prototype.clear=function(){for(let t=0;t<this.FMXxFMY;t++){for(let e=0;e<this.T;e++){this.wave[t][e]=!0;for(let n=0;n<4;n++)this.compatible[t][e][n]=this.propagator[this.opposite[n]][e].length}this.sumsOfOnes[t]=this.weights.length,this.sumsOfWeights[t]=this.sumOfWeights,this.sumsOfWeightLogWeights[t]=this.sumOfWeightLogWeights,this.entropies[t]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var Jx=Jt;const Qx=Jx,Gi=function(e,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const d=n,f=new Array(d);for(let I=0;I<d;I++)f[I]=new Array(r);this.colors=[];const h={};for(let I=0;I<r;I++)for(let P=0;P<n;P++){const W=(I*n+P)*4,L=[e[W],e[W+1],e[W+2],e[W+3]],N=L.join("-");h.hasOwnProperty(N)||(h[N]=this.colors.length,this.colors.push(L)),f[P][I]=h[N]}const p=this.colors.length,m=Math.pow(p,i*i),b=function(P){let W=new Array(i*i);for(let L=0;L<i;L++)for(let N=0;N<i;N++)W[N+L*i]=P(N,L);return W},_=function(P,W){return b(function(L,N){return f[(P+L)%n][(W+N)%r]})},v=function(P){return b(function(W,L){return P[i-1-L+W*i]})},T=function(P){return b(function(W,L){return P[i-1-W+L*i]})},A=function(P){let W=0,L=1;for(let N=0;N<P.length;N++)W+=P[P.length-1-N]*L,L*=p;return W},C=function(P){let W=P,L=m;const N=new Array(i*i);for(let E=0;E<N.length;E++){L/=p;let D=0;for(;W>=L;)W-=L,D++;N[E]=D}return N},R={},S=[];for(let I=0;I<(a?r:r-i+1);I++)for(let P=0;P<(a?n:n-i+1);P++){const W=new Array(8);W[0]=_(P,I),W[1]=T(W[0]),W[2]=v(W[0]),W[3]=T(W[2]),W[4]=v(W[2]),W[5]=T(W[4]),W[6]=v(W[4]),W[7]=T(W[6]);for(let L=0;L<l;L++){const N=A(W[L]);R[N]?R[N]++:(S.push(N),R[N]=1)}}this.T=S.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let I=0;I<this.T;I++){const P=parseInt(S[I],10);this.patterns[I]=C(P),this.weights[I]=R[P]}const U=function(P,W,L,N){const E=L<0?0:L,D=L<0?L+i:i,Z=N<0?0:N,$=N<0?N+i:i;for(let st=Z;st<$;st++)for(let rt=E;rt<D;rt++)if(P[rt+i*st]!=W[rt-L+i*(st-N)])return!1;return!0};this.propagator=new Array(4);for(let I=0;I<4;I++){this.propagator[I]=new Array(this.T);for(let P=0;P<this.T;P++){const W=[];for(let L=0;L<this.T;L++)U(this.patterns[P],this.patterns[L],this.DX[I],this.DY[I])&&W.push(L);this.propagator[I][P]=W}}};Gi.prototype=Object.create(Qx.prototype),Gi.prototype.constructor=Gi,Gi.prototype.onBoundary=function(t,e){return!this.periodic&&(t+this.N>this.FMX||e+this.N>this.FMY||t<0||e<0)},Gi.prototype.clear=function(){if(Qx.prototype.clear.call(this),this.ground!==0){for(let t=0;t<this.FMX;t++){for(let e=0;e<this.T;e++)e!==this.ground&&this.ban(t+(this.FMY-1)*this.FMX,e);for(let e=0;e<this.FMY-1;e++)this.ban(t+e*this.FMX,this.ground)}this.propagate()}},Gi.prototype.graphics=function(t){return t=t||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t),t},Gi.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMY;e++){const n=e<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(e*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(e-n)*this.FMX]][i+n*this.N]];t[s]=o[0],t[s+1]=o[1],t[s+2]=o[2],t[s+3]=o[3]}}},Gi.prototype.graphicsIncomplete=function(t){for(let e=0;e<this.FMXxFMY;e++){const n=e%this.FMX,r=e/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let d=0;d<this.N;d++){let f=n-d;f<0&&(f+=this.FMX);let h=r-u;if(h<0&&(h+=this.FMY),this.onBoundary(f,h))continue;const p=f+h*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const b=this.colors[this.patterns[m][d+u*this.N]];s+=b[0],o+=b[1],a+=b[2],c+=b[3]}}const l=e*4;t[l]=s/i,t[l+1]=o/i,t[l+2]=a/i,t[l+3]=c/i}};var _5=Gi;const y5=Jx,ws=function(e,n,r,i,s){const o=e.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!e.unique;let c=null;n&&e.subsets&&e.subsets[n]&&(c=e.subsets[n]);const l=function(A){const C=new Array(o*o);for(let R=0;R<o;R++)for(let S=0;S<o;S++)C[S+R*o]=A(S,R);return C},u=function(A){return l(function(C,R){return A[o-1-R+C*o]})},d=function(A){return l(function(C,R){return A[o-1-C+R*o]})};this.tiles=[];const f=[],h=[],p={};let m,b,_;for(let T=0;T<e.tiles.length;T++){const A=e.tiles[T];if(c!==null&&c.indexOf(A.name)===-1)continue;switch(A.symmetry){case"L":_=4,m=function(R){return(R+1)%4},b=function(R){return R%2===0?R+1:R-1};break;case"T":_=4,m=function(R){return(R+1)%4},b=function(R){return R%2===0?R:4-R};break;case"I":_=2,m=function(R){return 1-R},b=function(R){return R};break;case"\\":_=2,m=function(R){return 1-R},b=function(R){return 1-R};break;case"F":_=8,m=function(R){return R<4?(R+1)%4:4+(R-1)%4},b=function(R){return R<4?R+4:R-4};break;default:_=1,m=function(R){return R},b=function(R){return R};break}this.T=h.length,p[A.name]=this.T;for(let R=0;R<_;R++)h.push([this.T+R,this.T+m(R),this.T+m(m(R)),this.T+m(m(m(R))),this.T+b(R),this.T+b(m(R)),this.T+b(m(m(R))),this.T+b(m(m(m(R))))]);let C;if(a)for(let R=0;R<_;R++)C=A.bitmap[R],this.tiles.push(l(function(S,U){return[C[(o*U+S)*4],C[(o*U+S)*4+1],C[(o*U+S)*4+2],C[(o*U+S)*4+3]]}));else{C=A.bitmap,this.tiles.push(l(function(R,S){return[C[(o*S+R)*4],C[(o*S+R)*4+1],C[(o*S+R)*4+2],C[(o*S+R)*4+3]]}));for(let R=1;R<_;R++)this.tiles.push(R<4?u(this.tiles[this.T+R-1]):d(this.tiles[this.T+R-4]))}for(let R=0;R<_;R++)f.push(A.weight||1)}this.T=h.length,this.weights=f,this.propagator=new Array(4);const v=new Array(4);for(let T=0;T<4;T++){this.propagator[T]=new Array(this.T),v[T]=new Array(this.T);for(let A=0;A<this.T;A++){v[T][A]=new Array(this.T);for(let C=0;C<this.T;C++)v[T][A][C]=!1}}for(let T=0;T<e.neighbors.length;T++){const A=e.neighbors[T],C=A.left.split(" ").filter(function(W){return W.length}),R=A.right.split(" ").filter(function(W){return W.length});if(c!==null&&(c.indexOf(C[0])===-1||c.indexOf(R[0])===-1))continue;const S=h[p[C[0]]][C.length==1?0:parseInt(C[1],10)],U=h[S][1],I=h[p[R[0]]][R.length==1?0:parseInt(R[1],10)],P=h[I][1];v[0][I][S]=!0,v[0][h[I][6]][h[S][6]]=!0,v[0][h[S][4]][h[I][4]]=!0,v[0][h[S][2]][h[I][2]]=!0,v[1][P][U]=!0,v[1][h[U][6]][h[P][6]]=!0,v[1][h[P][4]][h[U][4]]=!0,v[1][h[U][2]][h[P][2]]=!0}for(let T=0;T<this.T;T++)for(let A=0;A<this.T;A++)v[2][T][A]=v[0][A][T],v[3][T][A]=v[1][A][T];for(let T=0;T<4;T++)for(let A=0;A<this.T;A++){const C=[],R=v[T][A];for(let S=0;S<this.T;S++)R[S]&&C.push(S);this.propagator[T][A]=C}};ws.prototype=Object.create(y5.prototype),ws.prototype.constructor=ws,ws.prototype.onBoundary=function(t,e){return!this.periodic&&(t<0||e<0||t>=this.FMX||e>=this.FMY)},ws.prototype.graphics=function(t,e){return t=t||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t,e),t},ws.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMX;e++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[e+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(e*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];t[o]=a[0],t[o+1]=a[1],t[o+2]=a[2],t[o+3]=a[3]}}},ws.prototype.graphicsIncomplete=function(t,e){(!e||e.length!==4)&&(e=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(e&&s===this.T)t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];else{let d=0,f=0,h=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const b=this.tiles[m][l+c*this.tilesize],_=this.weights[m]*a;d+=b[0]*_,f+=b[1]*_,h+=b[2]*_,p+=b[3]*_}t[u]=d,t[u+1]=f,t[u+2]=h,t[u+3]=p}}}};var b5=ws,w5={OverlappingModel:_5,SimpleTiledModel:b5},x5=lo(w5);const tE=5;function eE(t,e,n,r,i,s,o){if(!x(w.book))return!1;const a=w.book,c=Ge(a,_t.BOARD,t),l=Ge(a,_t.BOARD,e),u=Ee(c),d=Ee(l);if(!x(u)||!x(d))return!1;Pe(a,u),Pe(a,d);let f=0;const h=new Map,p=new Map;let m=0;const b=32,_=new Uint8Array(vd*4);for(let S=0;S<Ht;++S)for(let U=0;U<Tt;++U){const I=te(d,{x:U,y:S}),P=(I==null?void 0:I.char)??0,W=(I==null?void 0:I.color)??b,L=(I==null?void 0:I.bg)??b;_[m++]=P,_[m++]=W,_[m++]=L;const N=gs(a,I),E=Ot((N==null?void 0:N.name)??"empty"),D=h.get(E);kt(D)?_[m++]=D:(h.set(E,f),p.set(f,E),_[m++]=f++)}const v=s.x-i.x+1,T=s.y-i.y+1,A=new x5.OverlappingModel(_,Tt,Ht,n,v,T,!1,!1,r,0);let C=0;for(;C<tE&&!A.generate();++C);if(C===tE)return!1;m=0;const R=A.graphics();for(let S=i.y;S<=s.y;++S)for(let U=i.x;U<=s.x;++U){const I={x:U,y:S},P=R[m++],W=R[m++],L=R[m++];switch(f=R[m++],o){case"all":{const st=te(u,{x:U,y:S});mn(st)&&En(a,u,st,a.timestamp),Se(u,{x:U,y:S});break}case"object":{const st=te(u,{x:U,y:S});mn(st)&&En(a,u,st,a.timestamp);break}case"terrain":Se(u,{x:U,y:S});break}let N=p.get(f)??"";const E=ro(a,N),D=Mc(a,N),Z=E??D;switch(o){case"all":break;case"object":x(D)&&(N="");break;case"terrain":x(E)&&(N="");break;default:if(le(a,D,"group")!==o&&(N=""),N){const st=te(u,{x:U,y:S});mn(st)&&En(a,u,st,a.timestamp),Se(u,{x:U,y:S})}break}const $=N?_i(a,u,[N],I):void 0;if(!(!x($)||!x(Z))&&(sa($,Z),P>0&&($.char=P),W<b&&($.color=W),L<b&&($.bg=L),mn($))){const st=Ae(uc(d,N));x(st)&&(Se(u,{...cs(d,st.x??0,st.y??0),x:U,y:S}),sa($,st))}}return!0}function nE(t){return`zss_snapshot_${t}`}const rE={x:0,y:0},iE={x:Tt-1,y:Ht-1},sE="all";function E5(t){const e=Ge(w.book,_t.BOARD,t),n=Ee(e);if(!x(n))return;const r=nE(n.id);_x(w.book,r);const[i]=vs(Pt.CONTENT,r,_t.BOARD),s=Ee(i);if(x(s))return op(t,s.id,rE,iE,sE),s}function v5(t){const e=Ge(w.book,_t.BOARD,t),n=Ee(e);if(!x(n))return;const r=nE(n.id),i=Ge(w.book,_t.BOARD,r),s=Ee(i);if(x(s))return op(s.id,t,rE,iE,sE),s}function k5(t,e,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return T5(t,e,i)}if(!x(w.book))return;const s=w.book,o=Ge(s,_t.BOARD,t),a=Ee(o);if(!x(a))return;const c=Jl();Pe(s,a);for(let l=n.y;l<=r.y;++l)for(let u=n.x;u<=r.x;++u){let d=!1,f=!1;switch(i){case"all":d=!0,f=!0;break;case"object":d=!0;break;case"terrain":f=!0;break}const h=(u+e.x+Tt)%Tt,p=(l+e.y+Ht)%Ht;if(d){const m=te(a,{x:u,y:l});mn(m)&&x(m==null?void 0:m.x)&&x(m==null?void 0:m.y)&&(m.x=h,m.lx=h,m.y=p,m.ly=p)}f&&(c.terrain[h+p*Tt]=a.terrain[u+l*Tt])}(i==="all"||i==="terrain")&&(a.terrain=[...c.terrain]),Uc(s,a)}function T5(t,e,n){if(!x(w.book))return;const r=w.book,i=Ge(r,_t.BOARD,t),s=Ee(i);if(!x(s))return;Pe(r,s);const{terrainelements:o,objectelements:a}=vx(r,s,n);if(o.length===0&&a.length===0)return;const c=a.map(p=>p.id??""),l=o.map(p=>si({x:p.x??0,y:p.y??0},Tt)),u=[],d=[];for(let p=0;p<o.length;++p){const m=o[p],b={x:m.x??-1,y:m.y??-1},_=te(s,b);x(_)&&mn(_)&&(u.push(_.id??""),u.push(_.id??""),d.push(si({x:_.x??0,y:_.y??0},Tt)))}let f=!1;for(let p=0;p<o.length;++p){const m=o[p],b=le(r,m,"collision")??Mt.ISWALK,_={x:m.x??-1,y:m.y??-1},v=si(_,Tt),T={x:_.x+e.x,y:_.y+e.y};if(Ql(T)){const A=te(s,T),C=(A==null?void 0:A.id)??"",R=si({x:(A==null?void 0:A.x)??0,y:(A==null?void 0:A.y)??0},Tt),S=le(r,A,"collision")??Mt.ISWALK;if(x(A)&&mn(A)&&u.includes(C)!==!0&&c.includes(C)!==!0){let U=!1;const I=d.includes(v),P=I?te(s,_):void 0,W=I?le(r,P,"pushable"):!1,L=I&&W;if(le(r,A,"pushable")&&(b!==Mt.ISWALK||I)){let N=I;x(P)&&W&&(f=ks(r,s,P,{x:(P.x??0)-e.x,y:(P.y??0)-e.y})!==!0,f||(N=!1)),(N||b!==Mt.ISWALK)&&(f=ks(r,s,A,{x:(A.x??0)+e.x,y:(A.y??0)+e.y})!==!0,f&&(U=L))}else(b!==Mt.ISWALK||L)&&(f=!0,U=L);U&&x(P)&&(f=ks(r,s,P,{x:(P.x??0)-e.x,y:(P.y??0)-e.y})!==!0)}else S===Mt.ISSOLID&&l.includes(R)===!1&&(f=!0)}else f=!0}if(f)return;for(let p=0;p<a.length;++p){const m=a[p],b=le(r,m,"collision"),_={x:m.x??0,y:m.y??0},v={x:_.x+e.x,y:_.y+e.y};if(Ql(v)){const T=te(s,v),A=(T==null?void 0:T.id)??"",C=le(r,T,"collision")??Mt.ISWALK,R=le(r,T,"group")??"";x(T)&&mn(T)&&u.includes(A)&&c.includes(A)!==!0?le(r,T,"pushable")?f=ks(r,s,T,v)!==!0:f=!0:cc(b,C)&&n!==R&&(f=!0)}else f=!0}if(f)return;(e.x>0||e.y>0)&&o.reverse();for(let p=0;p<o.length;++p){const m=o[p],b={x:m.x??-1,y:m.y??-1},_={x:b.x+e.x,y:b.y+e.y},v=cs(s,_.x,_.y);if(x(m)&&x(v)){Se(s,{...m,x:_.x,y:_.y}),Se(s,{...v,x:b.x,y:b.y});const T=te(s,b);mn(T)&&x(T)&&(T.x=(T.x??0)+e.x,T.y=(T.y??0)+e.y,T.lx=(T.lx??0)+e.x,T.ly=(T.ly??0)+e.y)}}Uc(r,s);for(let p=0;p<a.length;++p){const m=a[p],b={x:m.x??-1,y:m.y??-1},_={x:b.x+e.x,y:b.y+e.y};if(!ks(r,s,m,_))break}Uc(r,s)}function eh(t,e){let n="all";const r={x:0,y:0},i={x:Tt-1,y:Ht-1};for(let s=e;s<t.length;){const[o,a]=nt(t,s,[j.MAYBE_NUMBER_OR_STRING]);if(gt(o))n=Ot(o),s=a;else if(kt(o)){const[c,l,u,d]=nt(t,a,[j.NUMBER,j.MAYBE_NUMBER,j.MAYBE_NUMBER]);r.x=Math.min(o,l??o),r.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=d}else break}return{targetset:n,pt1:r,pt2:i}}const A5=Wi().command("snapshot",()=>(!x(w.book)||!x(w.board)||E5(w.board.id),0)).command("revert",()=>(!x(w.book)||!x(w.board)||v5(w.board.id),0)).command("copy",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;const[n,r]=nt(e,0,[j.STRING]),i=Hn(w.book,_t.BOARD,n),s=Ae(...i);if(x(s)){const o=eh(e,r);op(s.id,w.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;const[n,r,i,s]=nt(e,0,[j.STRING,j.NUMBER,j.NUMBER]),o=Hn(w.book,_t.BOARD,n),a=Ae(...o);if(x(a)){const c=eh(e,s);eE(w.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(t,e)=>{var o,a;if(!x(w.book)||!x(w.board))return 0;const[n,r]=nt(e,0,[j.DIR]),i={x:n.destpt.x-(((o=w.element)==null?void 0:o.x)??0),y:n.destpt.y-(((a=w.element)==null?void 0:a.y)??0)},s=eh(e,r);return k5(w.board.id,i,s.pt1,s.pt2,s.targetset),0}).command("pivot",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;const[n,r]=nt(e,0,[j.NUMBER]),i=eh(e,r);return d5(w.board.id,my(n),i.pt1,i.pt2,i.targetset),0});var xs=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(xs||{});const R5={audio:Y0,board:CF,cli:C$,display:L$,element:j$,runtime:u5,loader:c5,network:l5,transform:A5},ap=["audio","board","display","network","transform","element"],S5={0:[],1:["cli",...ap],2:["loader",...ap],3:["runtime",...ap]},O5={0:new Map,1:new Map,2:new Map,3:new Map};function oa(t){return(S5[t]??[]).map(n=>R5[n]).filter(x)}function cp(t){const e=[],n=oa(t);for(let r=0;r<n.length;++r)e.push(...n[r].listcommands());return e}function I5(t,e){const n=O5[t];if(!n.has(e)){let r;const i=oa(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!x(r));++s);n.set(e,r)}return n.get(e)}function N5(t,e,n){const r=oa(t);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(e,n);if(o)return[o,a]}}return[!1,void 0]}function C5(t,e,n,r){const i=oa(t);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(e,n,r);if(a)return[a,r]}}return[!1,void 0]}function L5(t,e){const n=oa(t);for(let r=0;r<n.length;++r)n[r].tick(e)}function oE(t,e){const n=oa(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}var aE={},cE={},lE={};const uE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");lE.encode=function(t){if(0<=t&&t<uE.length)return uE[t];throw new TypeError("Must be between 0 and 63: "+t)};const M5=lE,hE=5,fE=1<<hE,U5=fE-1,F5=fE;function B5(t){return t<0?(-t<<1)+1:(t<<1)+0}cE.encode=function(e){let n="",r,i=B5(e);do r=i&U5,i>>>=hE,i>0&&(r|=F5),n+=M5.encode(r);while(i>0);return n};var $c={};(function(t){function e(R,S,U){if(S in R)return R[S];if(arguments.length===3)return U;throw new Error('"'+S+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(R){const S=R.match(n);return S?{scheme:S[1],auth:S[2],host:S[3],port:S[4],path:S[5]}:null}t.urlParse=i;function s(R){let S="";return R.scheme&&(S+=R.scheme+":"),S+="//",R.auth&&(S+=R.auth+"@"),R.host&&(S+=R.host),R.port&&(S+=":"+R.port),R.path&&(S+=R.path),S}t.urlGenerate=s;const o=32;function a(R){const S=[];return function(U){for(let P=0;P<S.length;P++)if(S[P].input===U){const W=S[0];return S[0]=S[P],S[P]=W,S[0].result}const I=R(U);return S.unshift({input:U,result:I}),S.length>o&&S.pop(),I}}const c=a(function(S){let U=S;const I=i(S);if(I){if(!I.path)return S;U=I.path}const P=t.isAbsolute(U),W=[];let L=0,N=0;for(;;)if(L=N,N=U.indexOf("/",L),N===-1){W.push(U.slice(L));break}else for(W.push(U.slice(L,N));N<U.length&&U[N]==="/";)N++;let E=0;for(N=W.length-1;N>=0;N--){const D=W[N];D==="."?W.splice(N,1):D===".."?E++:E>0&&(D===""?(W.splice(N+1,E),E=0):(W.splice(N,2),E--))}return U=W.join("/"),U===""&&(U=P?"/":"."),I?(I.path=U,s(I)):U});t.normalize=c;function l(R,S){R===""&&(R="."),S===""&&(S=".");const U=i(S),I=i(R);if(I&&(R=I.path||"/"),U&&!U.scheme)return I&&(U.scheme=I.scheme),s(U);if(U||S.match(r))return S;if(I&&!I.host&&!I.path)return I.host=S,s(I);const P=S.charAt(0)==="/"?S:c(R.replace(/\/+$/,"")+"/"+S);return I?(I.path=P,s(I)):P}t.join=l,t.isAbsolute=function(R){return R.charAt(0)==="/"||n.test(R)};function u(R,S){R===""&&(R="."),R=R.replace(/\/$/,"");let U=0;for(;S.indexOf(R+"/")!==0;){const I=R.lastIndexOf("/");if(I<0||(R=R.slice(0,I),R.match(/^([^\/]+:\/)?\/*$/)))return S;++U}return Array(U+1).join("../")+S.substr(R.length+1)}t.relative=u;const d=function(){return!("__proto__"in Object.create(null))}();function f(R){return R}function h(R){return m(R)?"$"+R:R}t.toSetString=d?f:h;function p(R){return m(R)?R.slice(1):R}t.fromSetString=d?f:p;function m(R){if(!R)return!1;const S=R.length;if(S<9||R.charCodeAt(S-1)!==95||R.charCodeAt(S-2)!==95||R.charCodeAt(S-3)!==111||R.charCodeAt(S-4)!==116||R.charCodeAt(S-5)!==111||R.charCodeAt(S-6)!==114||R.charCodeAt(S-7)!==112||R.charCodeAt(S-8)!==95||R.charCodeAt(S-9)!==95)return!1;for(let U=S-10;U>=0;U--)if(R.charCodeAt(U)!==36)return!1;return!0}function b(R,S,U){let I=v(R.source,S.source);return I!==0||(I=R.originalLine-S.originalLine,I!==0)||(I=R.originalColumn-S.originalColumn,I!==0||U)||(I=R.generatedColumn-S.generatedColumn,I!==0)||(I=R.generatedLine-S.generatedLine,I!==0)?I:v(R.name,S.name)}t.compareByOriginalPositions=b;function _(R,S,U){let I=R.generatedLine-S.generatedLine;return I!==0||(I=R.generatedColumn-S.generatedColumn,I!==0||U)||(I=v(R.source,S.source),I!==0)||(I=R.originalLine-S.originalLine,I!==0)||(I=R.originalColumn-S.originalColumn,I!==0)?I:v(R.name,S.name)}t.compareByGeneratedPositionsDeflated=_;function v(R,S){return R===S?0:R===null?1:S===null?-1:R>S?1:-1}function T(R,S){let U=R.generatedLine-S.generatedLine;return U!==0||(U=R.generatedColumn-S.generatedColumn,U!==0)||(U=v(R.source,S.source),U!==0)||(U=R.originalLine-S.originalLine,U!==0)||(U=R.originalColumn-S.originalColumn,U!==0)?U:v(R.name,S.name)}t.compareByGeneratedPositionsInflated=T;function A(R){return JSON.parse(R.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=A;function C(R,S,U){if(S=S||"",R&&(R[R.length-1]!=="/"&&S[0]!=="/"&&(R+="/"),S=R+S),U){const I=i(U);if(!I)throw new Error("sourceMapURL could not be parsed");if(I.path){const P=I.path.lastIndexOf("/");P>=0&&(I.path=I.path.substring(0,P+1))}S=l(s(I),S)}return c(S)}t.computeSourceURL=C})($c);var lp={};let P5=class XE{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new XE;for(let i=0,s=e.length;i<s;i++)r.add(e[i],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),i=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};lp.ArraySet=P5;var dE={};const pE=$c;function D5(t,e){const n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||pE.compareByGeneratedPositionsInflated(t,e)<=0}let $5=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){D5(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(pE.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};dE.MappingList=$5;const jc=cE,Xe=$c,nh=lp.ArraySet,j5=dE.MappingList;let mE=class qE{constructor(e){e||(e={}),this._file=Xe.getArg(e,"file",null),this._sourceRoot=Xe.getArg(e,"sourceRoot",null),this._skipValidation=Xe.getArg(e,"skipValidation",!1),this._sources=new nh,this._names=new nh,this._mappings=new j5,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new qE({file:e.file,sourceRoot:n});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Xe.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;n!==null&&(s=Xe.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=e.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(e){const n=Xe.getArg(e,"generated"),r=Xe.getArg(e,"original",null);let i=Xe.getArg(e,"source",null),s=Xe.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=Xe.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Xe.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Xe.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let i=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=Xe.relative(s,i));const o=this._mappings.toArray().length>0?new nh:this._sources,a=new nh;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const d=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});d.source!=null&&(c.source=d.source,r!=null&&(c.source=Xe.join(r,c.source)),s!=null&&(c.source=Xe.relative(s,c.source)),c.originalLine=d.line,c.originalColumn=d.column,d.name!=null&&(c.name=d.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=Xe.join(r,c)),s!=null&&(c=Xe.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:i}))}}_serializeMappings(){let e=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,d;const f=this._mappings.toArray();for(let h=0,p=f.length;h<p;h++){if(l=f[h],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!Xe.compareByGeneratedPositionsInflated(l,f[h-1]))continue;c+=","}c+=jc.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(d=this._sources.indexOf(l.source),c+=jc.encode(d-o),o=d,c+=jc.encode(l.originalLine-1-i),i=l.originalLine-1,c+=jc.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=jc.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Xe.relative(n,r));const i=Xe.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};mE.prototype._version=3,aE.SourceMapGenerator=mE;var gE={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a==t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(gE);var zc={exports:{}},z5={},K5=Object.freeze({__proto__:null,default:z5}),_E=JE(K5);if((function(){return typeof window<"u"&&this===window}).call()){let t=null;zc.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},zc.exports.initialize=e=>t=e}else{const t=_E,e=_E;zc.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");t.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},zc.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var yE=zc.exports;const W5=yE;function H5(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Kc=null;var G5=function(){if(Kc)return Kc;const e=[];return Kc=W5().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,d,f){const h=new H5;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,d&&(h.name=f)),e[e.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,n=>{throw Kc=null,n}),Kc};const Rt=$c,up=gE,rh=lp.ArraySet,Y5=yE,V5=G5,hp=Symbol("smcInternal");class Ve{constructor(e,n){return e==hp?Promise.resolve(this):X5(e,n)}static initialize(e){Y5.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return q5(e,n)}static async with(e,n,r){const i=await new Ve(e,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Ve.prototype._version=3,Ve.GENERATED_ORDER=1,Ve.ORIGINAL_ORDER=2,Ve.GREATEST_LOWER_BOUND=1,Ve.LEAST_UPPER_BOUND=2;class Wc extends Ve{constructor(e,n){return super(hp).then(r=>{let i=e;typeof e=="string"&&(i=Rt.parseSourceMapInput(e));const s=Rt.getArg(i,"version");let o=Rt.getArg(i,"sources");const a=Rt.getArg(i,"names",[]);let c=Rt.getArg(i,"sourceRoot",null);const l=Rt.getArg(i,"sourcesContent",null),u=Rt.getArg(i,"mappings"),d=Rt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Rt.normalize(c)),o=o.map(String).map(Rt.normalize).map(function(f){return c&&Rt.isAbsolute(c)&&Rt.isAbsolute(f)?Rt.relative(c,f):f}),r._names=rh.fromArray(a.map(String),!0),r._sources=rh.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(f){return Rt.computeSourceURL(c,f,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=d,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,V5().then(f=>(r._wasm=f,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=Rt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new Wc(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const i=n||null,s=r||Ve.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Rt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(i,a)},()=>{switch(s){case Ve.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Ve.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=Rt.getArg(e,"source");const r=Rt.getArg(e,"line"),i=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:Rt.getArg(e,"line"),generatedColumn:Rt.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Rt.getArg(e,"bias",Ve.GREATEST_LOWER_BOUND);r==null&&(r=Ve.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Rt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Rt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Rt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Rt.getArg(i,"originalLine",null),column:Rt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=Rt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Rt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let n=Rt.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Rt.getArg(e,"line"),originalColumn:Rt.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Rt.getArg(e,"bias",Ve.GREATEST_LOWER_BOUND);i==null&&(i=Ve.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Rt.getArg(s,"generatedLine",null),column:Rt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Wc.prototype.consumer=Ve;class Z5 extends Ve{constructor(e,n){return super(hp).then(r=>{let i=e;typeof e=="string"&&(i=Rt.parseSourceMapInput(e));const s=Rt.getArg(i,"version"),o=Rt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new rh,r._names=new rh,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=Rt.getArg(c,"offset"),u=Rt.getArg(l,"line"),d=Rt.getArg(l,"column");if(u<a.line||u===a.line&&d<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new Ve(Rt.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:d+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(Rt.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(Rt.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:Rt.getArg(e,"line"),generatedColumn:Rt.getArg(e,"column")},r=up.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Rt.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=Rt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let d=null;l.name&&(this._names.add(l.name),d=this._names.indexOf(l.name));const f={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:d};r.push(f),typeof f.originalLine=="number"&&i.push(f)}}}eachMapping(e,n,r){const i=n||null,s=r||Ve.GENERATED_ORDER;let o;switch(s){case Ve.GENERATED_ORDER:o=this._generatedMappings;break;case Ve.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=Rt.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,n,r,i,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return up.search(e,n,s,o)}allGeneratedPositionsFor(e){const n=Rt.getArg(e,"line"),r={source:Rt.getArg(e,"source"),originalLine:n,originalColumn:Rt.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Rt.compareByOriginalPositions,up.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Rt.getArg(o,"generatedLine",null),column:Rt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Rt.getArg(o,"generatedLine",null),column:Rt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function X5(t,e){let n=t;typeof t=="string"&&(n=Rt.parseSourceMapInput(t));const r=n.sections!=null?new Z5(n,e):new Wc(n,e);return Promise.resolve(r)}function q5(t,e){return Wc.fromSourceMap(t,e)}var bE={};const J5=aE.SourceMapGenerator,ih=$c,Q5=/(\r?\n)/,t4=10,aa="$$$isSourceNode$$$";let e4=class kp{constructor(e,n,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=s??null,this[aa]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,n,r){const i=new kp,s=e.split(Q5);let o=0;const a=function(){const h=m(),p=m()||"";return h+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,d;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)f(u,a()),c++,l=0;else{d=s[o]||"";const p=d.substr(0,h.generatedColumn-l);s[o]=d.substr(h.generatedColumn-l),l=h.generatedColumn,f(u,p),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(d=s[o]||"",i.add(d.substr(0,h.generatedColumn)),s[o]=d.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&f(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const p=n.sourceContentFor(h);p!=null&&(r!=null&&(h=ih.join(r,h)),i.setSourceContent(h,p))}),i;function f(h,p){if(h===null||h.source===void 0)i.add(p);else{const m=r?ih.join(r,h.source):h.source;i.add(new kp(h.originalLine,h.originalColumn,m,p,h.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[aa]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[aa]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[aa]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[aa]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[ih.toSetString(e)]=n}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][aa]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)e(ih.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new J5(e);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let d=0,f=l.length;d<f;d++)l.charCodeAt(d)===t4?(n.line++,n.column=0,d+1===f?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};bE.SourceNode=e4;var n4=bE.SourceNode;let wE=0;const xE=gi,r4=["Command","lines"];class i4 extends UU{constructor(){super(ax,{traceInitPerf:gi,skipValidations:!gi,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Ft(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Ft(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Cc)}])}));Ft(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Ft(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Ft(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Ft(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(A0)}));Ft(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(T0)}));Ft(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Lw)}])}));Ft(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Mw)}));Ft(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Uw),this.SUBRULE(this.words),this.CONSUME(Fw)}));Ft(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Qo),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Ft(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Ft(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Ft(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Ft(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(C0),this.SUBRULE(this.words)}));Ft(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(Zw),this.SUBRULE(this.words)}));Ft(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(L0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Ft(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Hu),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Cc)),this.CONSUME4(Qo),this.CONSUME4(M0)}}])}));Ft(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Hu),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Qo),this.CONSUME(M0)}}])}));Ft(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Hu),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Ft(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Qo),this.CONSUME(U0),this.CONSUME(L0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ft(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Qo),this.CONSUME(U0),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ft(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(tx),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ft(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(ex),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ft(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(nx),this.SUBRULE(this.words)}));Ft(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(rx),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ft(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(ix)}));Ft(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(sx)}));Ft(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(Jw)}));Ft(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(Qw)}));Ft(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(R0),this.SUBRULE2(this.and_test)})}));Ft(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(O0),this.SUBRULE2(this.not_test)})}));Ft(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(S0),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Ft(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Ft(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Dw)},{ALT:()=>this.CONSUME($w)},{ALT:()=>this.CONSUME(jw)},{ALT:()=>this.CONSUME(zw)},{ALT:()=>this.CONSUME(Kw)},{ALT:()=>this.CONSUME(Ww)}])}));Ft(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(R0),this.SUBRULE2(this.and_test_value)})}));Ft(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(O0),this.SUBRULE2(this.not_test_value)})}));Ft(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(S0),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Ft(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Ft(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(I0)},{ALT:()=>this.CONSUME(N0)}]),this.SUBRULE(this.term)}));Ft(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Ft(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Gw)},{ALT:()=>this.CONSUME(C0)},{ALT:()=>this.CONSUME(Yw)},{ALT:()=>this.CONSUME(Vw)}]),this.SUBRULE(this.factor)}));Ft(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(I0)},{ALT:()=>this.CONSUME(N0)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Ft(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(Hw),this.SUBRULE(this.factor)})}));Ft(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Ft(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(A0)},{ALT:()=>this.CONSUME(Bw)},{ALT:()=>this.CONSUME(yn)},{ALT:()=>this.CONSUME(Pw)},{ALT:()=>{this.CONSUME(Xw),this.SUBRULE(this.words),this.CONSUME(qw)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=r4.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(wE++).toString().padStart(3),c=s?"font-weight: bold;":"";if(xE&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),xE&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),wE--},i)}}const ca=new i4;if(VU){const t=ca.getGAstProductions(),e=YU(t);console.info(e)}const s4=ca.getBaseCstVisitorConstructor();var bt=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(bt||{}),oo=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(oo||{}),yi=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(yi||{}),sh=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(sh||{});function ur(t,e){const[n]=t??[];return((n==null?void 0:n.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class o4 extends s4{constructor(){super();Ft(this,"unique",0);gi&&this.validateVisitor()}visit(n){if(ce(n)&&(n=n[0]),!!x(n))return this[n.name](n.children,n.location)}createcodenode(n,r){return[{...r,...n,lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():x(n)?[this.visit(n)].flat():[]}program(n,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:ur(n.token_label,":").slice(1).trim()}))}stmt_stat(n,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:ur(n.token_stat,"@").slice(1)}))}stmt_text(n,r){return this.createlinenode(r,this.createcodenode(r,{type:6,value:ur(n.token_text,"")}))}stmt_comment(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:ur(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:this.go(n.words),text:ur(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n,r){return n.words?this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n,r){return n.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n,r){return n.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n,r){const[i]=this.createlogicnode(r,ur(n.token_if,"if"),"",this.go(n.words)),[s]=this.go(n.command_if_block)??[];return this.createcodenode(r,{type:13,check:i,block:s})}command_if_block(n,r){const i=je(),s=je();return this.createcodenode(r,{type:15,skip:i,done:s,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(r,s,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n,r){const i=je(),s=je();return this.createcodenode(r,{type:16,done:s,lines:[this.createlogicnode(r,ur(n.token_if,"if"),i,this.go(n.words)),this.go(n.command_fork),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"skip")].flat()})}command_else(n,r){return this.createcodenode(r,{type:17,lines:this.go(n.command_fork)})}command_while(n,r){const i=je(),s=je();return this.createcodenode(r,{type:18,loop:i,done:s,lines:[this.createmarknode(r,i,"start of while"),this.createlogicnode(r,"if",s,this.go(n.words)),this.go(n.command_block),this.creategotonode(r,i,"loop of while"),this.createmarknode(r,s,"end of while")].flat()})}command_repeat(n,r){const i=je(),s=je(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:21,loop:i,done:s,lines:[this.createapinode(r,"repeatstart",a),this.createmarknode(r,i,"start of repeat"),this.createlogicnode(r,"repeat",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of repeat"),this.createmarknode(r,s,"end of repeat")].flat()})}command_foreach(n,r){const i=je(),s=je(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:23,loop:i,done:s,lines:[this.createapinode(r,"foreachstart",a),this.createmarknode(r,i,"start of foreach"),this.createlogicnode(r,"foreach",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of foreach"),this.createmarknode(r,s,"end of foreach")].flat()})}command_waitfor(n,r){const i=je();return this.createcodenode(r,{type:22,loop:i,lines:[this.createmarknode(r,i,"start of waitfor"),this.createlogicnode(r,"waitfor",i,this.go(n.words))].flat()})}command_break(n,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(n,r){return this.createcodenode(r,{type:20,goto:0})}command_play(n,r){const i=ur(n.token_command_play,""),s=i.replace("bgplay","").replace("play","").trim(),o=i.includes("bgplay");return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,o?"bgplay":"play"),this.createstringnode(r,s)].flat()}))}command_toast(n,r){const s=ur(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,"toast"),this.createstringnode(r,s)].flat()}))}expr(n,r){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(r,{type:24,items:this.go(n.and_test)})}and_test(n,r){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(r,{type:25,items:this.go(n.not_test)})}not_test(n,r){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(r,{type:26,items:this.go(n.not_test)}):[]}comparison(n,r){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[i,s]=this.go(n.arith_expr),[o]=this.go(n.comp_op);return this.createcodenode(r,{type:27,lhs:i,compare:o,rhs:s})}comp_op(n,r){return n.token_iseq?this.createcodenode(r,{type:28,method:0}):n.token_isnoteq?this.createcodenode(r,{type:28,method:1}):n.token_islessthan?this.createcodenode(r,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(n,r){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(r,{type:24,items:this.go(n.and_test_value)})}and_test_value(n,r){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(r,{type:25,items:this.go(n.not_test_value)})}not_test_value(n,r){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(r,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n,r){const i=this.go(n.term);return n.arith_expr_item?this.createcodenode(r,{type:29,lhs:i[0],items:this.go(n.arith_expr_item)}):i}arith_expr_item(n,r){return this.createcodenode(r,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n,r){return n.term_item?this.createcodenode(r,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n,r){let i=0;return n.token_multiply&&(i=4),n.token_divide&&(i=5),n.token_moddivide&&(i=6),n.token_floordivide&&(i=7),this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})}factor(n,r){if(n.power)return this.go(n.power);let i=0;return n.token_plus&&(i=8),n.token_minus&&(i=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})})}power(n,r){const i=this.go(n.token);return n.factor?this.createcodenode(r,{type:29,lhs:i[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):i}words(n){return this.go(n.expr)}token(n,r){if(n.token_label){const i=ur(n.token_label,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_stringliteraldouble){const i=ur(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=ur(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(ur(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return n.token_lparen?this.createcodenode(r,{type:31,words:this.go(n.words)}):[]}}const a4=new o4,Vn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},oh="zss.js";function Qt(t,e){return new n4(t.startLine??1,t.startColumn??1,oh,e)}function fp(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function dp(t){return`'${fp(t)}'`}function ah(t){if(t.startsWith('"'))return ah(t.replaceAll(/(^"|"$)/g,""));const e=Q0(t);return e.errors.length?t:`['${e.tokens.map(r=>r.tokenType===q0?`', api.get('${fp(r.image.substring(1))}'), '`:fp(r.image)).join("")}'].join('')`}function la(t){return t.filter(e=>e!==void 0).map(re)}function EE(t){return Qt(t,"")}function c4(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function on(t,e,n){return Qt(t,[`api.${e}(`,...c4(n,", "),")"])}function l4(t){if(t.type===bt.COMPARE&&t.compare.type===bt.COMPARE_ITEM)switch(t.compare.method){case oo.IS_EQ:return on(t,"isEq",[re(t.lhs),re(t.rhs)]);case oo.IS_NOT_EQ:return on(t,"isNotEq",[re(t.lhs),re(t.rhs)]);case oo.IS_LESS_THAN:return on(t,"isLessThan",[re(t.lhs),re(t.rhs)]);case oo.IS_GREATER_THAN:return on(t,"isGreaterThan",[re(t.lhs),re(t.rhs)]);case oo.IS_LESS_THAN_OR_EQ:return on(t,"isLessThanOrEq",[re(t.lhs),re(t.rhs)]);case oo.IS_GREATER_THAN_OR_EQ:return on(t,"isGreaterThanOrEq",[re(t.lhs),re(t.rhs)])}return Qt(t,"")}function ao(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",re(n),")"])}function vE(t,e,n){return t.prepend(`api.${e}(`),t.add([re(n),")"])}function u4(t,e){if(t.type===bt.OPERATOR_ITEM)switch(t.operator){case yi.PLUS:return ao(e,"opPlus",t.rhs);case yi.MINUS:return ao(e,"opMinus",t.rhs);case yi.POWER:return ao(e,"opPower",t.rhs);case yi.MULTIPLY:return ao(e,"opMultiply",t.rhs);case yi.DIVIDE:return ao(e,"opDivide",t.rhs);case yi.MOD_DIVIDE:return ao(e,"opModDivide",t.rhs);case yi.FLOOR_DIVIDE:return ao(e,"opFloorDivide",t.rhs);case yi.UNI_PLUS:return vE(e,"opUniPlus",t.rhs);case yi.UNI_MINUS:return vE(e,"opUniMinus",t.rhs)}return Qt(t,"")}function h4(t){if(t.type===bt.OPERATOR){const e=t.lhs?re(t.lhs):Qt(t,"");return t.items.forEach(n=>u4(n,e)),e}return Qt(t,"")}function ch(t,e){return Qt(t,[on(t,"jump",[`${e}`]),"; continue;"])}function Yi(t){return Vn.linelookup[t??""]??-1}function pp(t,e){Vn.linelookup[t]=e}function ua(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case bt.WHILE:case bt.REPEAT:case bt.FOREACH:case bt.ELSE_IF:i.type===e&&(i.done=n);break;case bt.IF_BLOCK:case bt.IF_CHECK:i.type===e&&(i.skip=n);break;case bt.LINE:ua(i.stmts,e,n);break}}}function kE(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case bt.WHILE:case bt.REPEAT:case bt.FOREACH:case bt.ELSE_IF:i.type===e&&pp(i.done,n);break;case bt.IF_BLOCK:case bt.IF_CHECK:i.type===e&&pp(i.skip,n);break;case bt.LINE:kE(i.stmts,e,n);break}}}function re(t){var e;switch(t.type){case bt.PROGRAM:return Qt(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(re).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${oh}`]);case bt.API:return Qt(t,["  ",on(t,t.method,la(t.words)),`;
`]);case bt.LINE:return Qt(t,[`case ${t.lineindex}:
`,...t.stmts.map(re).flat(),`  break;
`]);case bt.MARK:return Qt(t,`  // ${t.comment}
`);case bt.GOTO:{const n=Yi(t.id);return Qt(t,["  ",ch(t,n),`
`])}case bt.COUNT:return Qt(t,`${t.index}`);case bt.LITERAL:switch(t.literal){case sh.NUMBER:return Qt(t,`${t.value}`);case sh.STRING:return Qt(t,dp(t.value));case sh.TEMPLATE:return Qt(t,ah(t.value))}return EE(t);case bt.TEXT:return Qt(t,["  ",on(t,"text",[ah(t.value)]),`;
`]);case bt.STAT:if(Vn.isfirststat){Vn.isfirststat=!1;const n=t.value.trim().split(" ").map(dp);return Qt(t,["  ",on(t,"stat",n),`;
`])}return Qt(t,`  // skipped ${t.value}
`);case bt.LABEL:{const n=Ot(t.name),r=t.active?"label":"comment";Vn.labels[n]||(Vn.labels[n]=[]);const i=(t.active?1:-1)*t.lineindex;return Vn.labels[n].push(i),Qt(t,`  // ${i} '${n}' ${r}
`)}case bt.HYPERLINK:return Qt(t,["  ",on(t,"hyperlink",[ah(t.text),...la(t.link)]),`;
`]);case bt.MOVE:{const n=on(t,"command",[dp("go"),la(t.words)].flat());return t.wait?Qt(t,["  if (",n,`) { continue; };
`]):Qt(t,["  ",n,`;
`])}case bt.COMMAND:return Qt(t,["  if (",on(t,"command",la(t.words)),`) { continue; };
`]);case bt.IF:{const n=((e=t.block)==null?void 0:e.type)===bt.IF_BLOCK?t.block:void 0;if(x(n)){ua([t.check],bt.IF_CHECK,n.skip);const r=Qt(t,re(t.check));return n.lines.forEach(i=>r.add(re(i))),kE(n.altlines,bt.ELSE_IF,Yi(n.done)),n.altlines.forEach(i=>r.add(re(i))),r}return Qt(t,re(t.check))}case bt.IF_CHECK:{const n=Yi(t.skip);return n===-1?Qt(t,["  ",on(t,t.method,la(t.words)),`;
`]):Qt(t,["  if (!",on(t,t.method,la(t.words)),") { ",ch(t,n),` }
`])}case bt.ELSE_IF:case bt.ELSE:{const n=Qt(t,"");return t.lines.forEach(r=>n.add(re(r))),n}case bt.WHILE:{const n=Yi(t.loop),r=Yi(t.done),i=Qt(t,"");return ua(t.lines,bt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case bt.BREAK:s.goto=r;break;case bt.CONTINUE:s.goto=n;break}i.add(re(s))}),i}case bt.REPEAT:{const n=Yi(t.loop),r=Yi(t.done),i=Qt(t,"");return ua(t.lines,bt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case bt.BREAK:s.goto=r;break;case bt.CONTINUE:s.goto=n;break}i.add(re(s))}),i}case bt.WAITFOR:{const n=Qt(t,"");return ua(t.lines,bt.IF_CHECK,t.loop),t.lines.forEach(r=>{n.add(re(r))}),n}case bt.FOREACH:{const n=Yi(t.loop),r=Yi(t.done),i=Qt(t,"");return ua(t.lines,bt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case bt.BREAK:s.goto=r;break;case bt.CONTINUE:s.goto=n;break}i.add(re(s))}),i}case bt.BREAK:return Qt(t,["  ",ch(t,t.goto),`
`]);case bt.CONTINUE:return Qt(t,["  ",ch(t,t.goto),`
`]);case bt.OR:return on(t,"or",t.items.map(re));case bt.AND:return on(t,"and",t.items.map(re));case bt.NOT:return on(t,"not",t.items.map(re));case bt.COMPARE:return l4(t);case bt.OPERATOR:return h4(t);case bt.EXPR:return on(t,"expr",t.words.map(re));default:return console.error("<unsupported node>",t.type,t),EE(t)}}function bi(t){if(x(t))switch(t.type===bt.LINE&&++Vn.lineindex,t.lineindex=Vn.lineindex,t.type){case bt.PROGRAM:t.lines.forEach(bi);break;case bt.LINE:t.stmts.forEach(bi);break;case bt.MARK:pp(t.id,t.lineindex);break;case bt.IF:bi(t.check),bi(t.block);break;case bt.IF_BLOCK:t.lines.forEach(bi),t.altlines.forEach(bi);break;case bt.ELSE_IF:t.lines.forEach(bi);break;case bt.ELSE:case bt.WHILE:case bt.REPEAT:case bt.FOREACH:case bt.WAITFOR:t.lines.forEach(bi);break;case bt.MOVE:case bt.COMMAND:case bt.IF_CHECK:t.words.forEach(bi);break}}function f4(t){Vn.labels={},Vn.internal=1,Vn.lineindex=0,Vn.isfirststat=!0,bi(t)}function d4(t){return f4(t),{...re(t).toStringWithSourceMap({file:`${oh}.map`}),...Vn}}function TE(t){return ce(t)?t.length>0?1:0:t??0}function p4(t){return`${t}_chip`}function AE(t=""){return`vm:${t??""}`}function m4(t,e,n){var l,u;const r=p4(t),i=Sr(r);let s;const o=Qn(Object.entries(n.labels??{}));(!ce(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(d,f){w.words=f;const h=I5(e,d);return x(h)?h(c,f):d!=="send"?a("shortsend",[d,...f]):0}const c={halt(){O4(r)},id(){return t},set(d,f){const[h,p]=C5(e,c,d,f);if(h)return p},get(d){const[f,h]=N5(e,c,d);if(f)return h},tick(d){const f=kt(i.ps)?i.ps:0,h=f%d===0;if(i.ps=f+1,h===!1)return!1;if(c.shouldtick()===!1)return oE(e,c),!1;i.lc=0,i.ys=0,w.get=c.get,L5(e,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){de(tt,w.elementfocus,"crash",p.message),i.es=1}return oE(e,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return kt(i.lc)?++i.lc>Di.HALT_AT_COUNT:!0},hm(){if(ce(i.mg)&&ce(i.lb)){const[d]=i.mg;if(x(d))for(let f=0;f<i.lb.length;++f){const[h,p]=i.lb[f];if(h===d)return p.find(m=>kt(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(d){i.ec=d},sy(){return!!i.ys||c.shouldhalt()},send(d,f,h,p){tt.emit(d,`${AE(f)}:${h}`,p)},lock(d){i.lk=d},unlock(){i.lk=""},message(d){i.lk&&d.sender!==i.lk||(i.mg=[d.target,d.data,d.sender,d.player])},zap(d){if(ce(i.lb))for(let f=0;f<i.lb.length;++f){const[h,p]=i.lb[f];if(h===d){const m=p.findIndex(b=>b>0);m>=0&&(p[m]*=-1)}}},restore(d){if(ce(i.lb))for(let f=0;f<i.lb.length;++f){const[h,p]=i.lb[f];if(h===d)for(let m=0;m<p.length;m++)p[f]=Math.abs(p[f])}},getcase(){i.ec=kt(i.ec)?i.ec:1;const d=c.hm();if(d&&ce(i.mg)){const[,f,h,p]=i.mg;c.set("sender",h),x(f)&&c.set("arg",f),p&&(c.set("player",p),w.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=d}return i.ec},nextcase(){const d=kt(i.ec)?i.ec:1;return i.ec=d+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(d){const f=xF.parse(d),[h]=f.filter(p=>p.fileName===oh);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(d){return a("text",[d])},stat(...d){return a("stat",d)},hyperlink(...d){return a("hyperlink",d)},command(...d){if(d.length===0)return 0;const[f,...h]=d;return a(Ot(Ye(f)),h)},if(...d){const[f,h]=nt(d,0,[j.ANY]),p=TE(f);return p&&h<d.length&&c.command(...d.slice(h)),p?1:0},try(...d){const[,f]=nt(d,0,[j.DIR]),h=c.command("go",...d);return h&&f<d.length&&c.command(...d.slice(f)),h?1:0},take(...d){const[f,h,p]=nt(d,0,[j.NAME,j.ANY]),m=kt(h),b=m?p:1,_=c.get(f),v=m?h:1;if(!kt(_))return b<d.length&&c.command(...d.slice(b)),1;const T=_-v;return T<0?(b<d.length&&c.command(...d.slice(b)),1):(c.set(f,T),0)},give(...d){const[f,h,p]=nt(d,0,[j.NAME,j.ANY]),m=kt(h),b=m?p:1,_=c.get(f),v=m?h:1,T=_===void 0?1:0;return T&&b<d.length&&c.command(...d.slice(b)),c.set(f,Fc(_,0)+v),T},repeatstart(d,...f){const[h,p]=nt(f,0,[j.NUMBER]),m=`repeatcount${d}`,b=`repeatwords${d}`;i[m]=h,i[b]=p<f.length?f.slice(p):void 0},repeat(d){const f=`repeatcount${d}`,h=`repeatwords${d}`;if(!kt(i[f]))return 0;const p=i[f];i[f]=p-1;const m=p>0,b=i[h];return m&&ce(b)&&c.command(...b),m?1:0},foreachstart(d,...f){const[h,p,m,b]=nt(f,0,[j.NAME,j.NUMBER,j.NUMBER,j.MAYBE_NUMBER]);let _=Math.min(p,m),v=Math.max(p,m);const T=(b??0)||1;if(T<0){const A=_;_=v,v=A}return c.set(h,_-T),0},foreach(d,...f){const[h,p,m,b,_]=nt(f,0,[j.NAME,j.NUMBER,j.NUMBER,j.MAYBE_NUMBER]);let v=Math.min(p,m),T=Math.max(p,m);const A=(b??0)||1;if(A<0){const S=v;v=T,T=S}let C=c.get(h);!kt(C)||C<v||C>T?C=v:C+=A;const R=C<=T?1:0;return R&&(c.set(h,C),_<f.length&&c.command(...f.slice(_))),R},waitfor(...d){const[f]=nt(d,0,[j.ANY]),h=TE(f);return h||c.yield(),h?1:0},or(...d){let f=0;for(let h=0;h<d.length;){const[p,m]=nt(d,h,[j.ANY]);if(f=p,f)break;h=m}return f},and(...d){let f=0;for(let h=0;h<d.length;){const[p,m]=nt(d,h,[j.ANY]);if(f=p,!f)break;h=m}return f},not(...d){const[f]=nt(d,0,[j.ANY]);return f?0:1},expr(d){return d},isEq(d,f){const[h]=nt([d],0,[j.ANY]),[p]=nt([f],0,[j.ANY]);return typeof h=="object"||typeof p=="object"?Nv(h,p)?1:0:h===p?1:0},isNotEq(d,f){return this.isEq(d,f)?0:1},isLessThan(d,f){const[h]=nt([d],0,[j.NUMBER]),[p]=nt([f],0,[j.NUMBER]);return h<p?1:0},isGreaterThan(d,f){const[h]=nt([d],0,[j.NUMBER]),[p]=nt([f],0,[j.NUMBER]);return h>p?1:0},isLessThanOrEq(d,f){const[h]=nt([d],0,[j.NUMBER]),[p]=nt([f],0,[j.NUMBER]);return h<=p?1:0},isGreaterThanOrEq(d,f){const[h]=nt([d],0,[j.NUMBER]),[p]=nt([f],0,[j.NUMBER]);return h>=p?1:0},opPlus(d,f){const[h]=nt([d],0,[j.ANY]),[p]=nt([f],0,[j.ANY]);return h+p},opMinus(d,f){const[h]=nt([d],0,[j.ANY]),[p]=nt([f],0,[j.ANY]);return h-p},opPower(d,f){const[h]=nt([d],0,[j.NUMBER]),[p]=nt([f],0,[j.NUMBER]);return Math.pow(h,p)},opMultiply(d,f){const[h]=nt([d],0,[j.NUMBER]),[p]=nt([f],0,[j.NUMBER]);return h*p},opDivide(d,f){const[h]=nt([d],0,[j.NUMBER]),[p]=nt([f],0,[j.NUMBER]);return h/p},opModDivide(d,f){const[h]=nt([d],0,[j.NUMBER]),[p]=nt([f],0,[j.NUMBER]);return h%p},opFloorDivide(d,f){const[h]=nt([d],0,[j.NUMBER]),[p]=nt([f],0,[j.NUMBER]);return Math.floor(h/p)},opUniPlus(d){const[f]=nt([d],0,[j.NUMBER]);return+f},opUniMinus(d){const[f]=nt([d],0,[j.NUMBER]);return-f}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function mp(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];ce(r)?r.forEach(i=>{e.push(mp(i))}):e.push(mp(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function g4(t){const e=cx(`${t}
`);if(e.errors.length>0)return e;ca.input=e.tokens;const n=ca.program();if(ca.errors.length>0)return{tokens:e.tokens,errors:ca.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=a4.go(n);return r?(mp(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const gp=Object.getPrototypeOf(function*(){}).constructor;function _4(t,e){const n=`compile-${t}`;console.time(n);const r=g4(e);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=d4(r.ast);if(i.code){ZU&&console.info(i.code);try{return{...r,...i,source:i.code,code:new gp("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new gp("api"," ")}}}return{...r,...i,source:"",code:new gp("api"," ")}}function y4(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=_4(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},isended(i){const s=e[i];return x(s)?s.isended():!0},halt(i){const s=e[i];return x(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=e[i];x(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=e[i];if(!x(e[i])){const d=n(a,c);if(l=e[i]=m4(i,s,d),(u=d.errors)!=null&&u.length){const[f]=d.errors,h=((f==null?void 0:f.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((_,v)=>[_,v]);p.slice(h-5,h).forEach(([_,v])=>{de(tt,fr(),"build",`$grey${v+1} $grey${_}`)});const[m,b]=p[h]??[];if(gt(m)&&x(b)){const _=(f.column??1)-1,v=_+f.length,T=_<m.length?m:`${m}*`,A=T.substring(0,_),C=T.substring(_,v),R=T.substring(v);de(tt,fr(),"build",`$red${b+1} $grey${A}$red${C}$grey${R}`)}return f.message.split(`
`).forEach(_=>{de(tt,fr(),"build",_)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=tr(i.target),a=e[s];if(x(a)){const c={...i,target:o};a.message(c)}}};return r}const kn=new tc,Cn={},lh={};function RE(t,e,n,r,i,s=0){const o=`tiles:${t}:${e}`;return x(Cn[o])||(Cn[o]=pN(t,e,n,r,i,s)),Cn[o]}function b4(t,e,n,r){const i=`sprites:${t}:${e}:${n}`,s=`sprite:${t}:${e}:${r}`;return x(lh[s])||(lh[s]=mN(t,e,n)),lh[s].id=i,lh[s]}function w4(t,e){const n=`sprites:${t}:${e}`;return x(Cn[n])||(Cn[n]=gN(t,e)),Cn[n]}function x4(t,e,n,r,i=0){const s=`dither:${t}:${e}`;return x(Cn[s])||(Cn[s]=_N(t,e,n,r,i)),Cn[s]}function uh(t,e,n,r){const i=`media:${t}:${e}`;x(Cn[i])||(Cn[i]=yN(t,e,n,r));const s=Cn[i];return s.mime=n,s.media=r,s}function E4(t,e){const n=`control:${t}:${e}`;return x(Cn[n])||(Cn[n]=bN(t,e)),Cn[n]}const Es=3;function SE(t,e){const n=[],r=(t.x+.5)*ls,i=(t.y+.5)*us,s=e.x*ls,o=e.y*us,a=s-r,c=o-i;kn.x=a-Es,kn.y=c-Es,n.push(kn.angle()),kn.x=a+ls+Es,kn.y=c-Es,n.push(kn.angle()),kn.x=a-Es,kn.y=c+us+Es,n.push(kn.angle()),kn.x=a+ls+Es,kn.y=c+us+Es,n.push(kn.angle());const l=n.map(h=>Math.round(gy(h))),u=Math.min(...l),d=Math.max(...l);if(d-u>180){const h=l.filter(_=>_<180),p=l.filter(_=>_>180),m=Math.max(...h);return[Math.min(...p),m]}return[u,d]}function hh(t,e,n,r,i,s,o,a,c,l){var A;const u={x:c,y:l},d=Br(e,u);if(d===-1)return;kn.x=c-s.x,kn.y=l-s.y;const f=kn.length();if(f>o)return;const h=Math.round(gy(kn.angle()));let p=0;for(let C=0;C<r.length;++C){const[R,S,U]=r[C];R>S?(h>=R||h<=S)&&(p=Math.max(p,U)):h>=R&&h<=S&&(p=Math.max(p,U))}const m=o*.5;n[d]=Math.min(n[d],p+(f<m?0:(f-m)*a)),n[d]=tn(n[d],0,1);const b=Sn(e,((A=e.lookup)==null?void 0:A[d])??"");if(x(b)){const C=[...SE(s,u),.25];i.push(C)}const _=e.terrain[d],v=gs(t,_),T=(_==null?void 0:_.collision)??(v==null?void 0:v.collision);if(cc(Mt.ISBULLET,T)){const C=[...SE(s,u),1];i.push(C)}}function _p(t,e,n,r,i,s,o){if(!x(r)||!x(r.terrain)||!x(r.objects))return[];const a=[];let c=e;const l=Tt,u=Ht,d=o?At.BLACK:At.ONCLEAR,f=RE(t,c++,"terrain",l,u,d);a.push(f);const h=c++,p=w4(t,h);p.sprites=[],a.push(p);const m=r.isdark?1:0,b=x4(t,c++,l,u,m);a.push(b),b.alphas.fill(m);const _=RE(t,c++,"tickers",l,u,At.ONCLEAR);a.push(_),_.char.fill(0);const v={...tp(Tt,Ht,i,At.ONCLEAR),..._},T=E4(t,c++);if(s){a.push(T);const{graphics:U,camera:I,facing:P}=Sr(t),W=U??r.graphics??"",L=I??r.camera??"",N=P??r.facing??"";if(gt(W)){const E=Ot(W);switch(E){case"fpv":case"iso":case"mode7":T.graphics=E;break;default:case"flat":T.graphics="flat";break}}if(gt(L))switch(Ot(L)){default:case"mid":T.viewscale=eu.MID;break;case"near":T.viewscale=eu.NEAR;break;case"far":T.viewscale=eu.FAR;break}kt(N)&&(T.facing=my(N%360))}for(let U=0;U<r.terrain.length;++U){const I=r.terrain[U],P=ta(n,I,0,At.WHITE,o?At.BLACK:At.ONCLEAR),W=le(n,I,"collision");f.char[U]=P.char,f.color[U]=P.color,f.bg[U]=P.bg,f.wall[U]=W===Mt.ISSOLID?1:0}const A=Object.values(r.objects??{});for(let U=0;U<A.length;++U){const I=A[U];if(gt(I.tickertext)&&kt(I.tickertime)&&I.tickertext.length){const N=Tt,E=Mx(I.tickertext,N,Ht-1),D=(E==null?void 0:E.measuredwidth)??1,Z=I.x??0,$=I.y??0,st=$<Ht*.5;v.x=Z-Math.floor(D*.5),v.y=$+(st?1:-1),v.x+D>Tt&&(v.x=Tt-D),v.x<0&&(v.x=0),Lx(I.tickertext,v,!0)}if(x(I.removed))continue;const P=I.id??"",W=ta(n,I,1,At.WHITE,At.BLACK),L=b4(t,h,P,U);if(L.x=I.x??0,L.y=I.y??0,L.char=W.char,L.color=W.color,L.bg=W.bg,p.sprites.push(L),m){if(W.light>0){const N=Br(r,L),E=tn(Math.round(W.light),1,Ht),D=1/(E*.5);if(b.alphas[N]=0,E>1){const Z=[];for(let $=1;$<=E;++$){if($===2){const at=le(n,I,"lightdir");if(Fr(at)){const Y=Vu(n,r,I,"",at,L);switch(Ur(L,Y.destpt)){case dt.EAST:Z.push([45,315,1]);break;case dt.WEST:Z.push([225,135,1]);break;case dt.NORTH:Z.push([315,225,1]);break;case dt.SOUTH:Z.push([135,45,1]);break}}}const st=[];for(let at=L.y-$;at<=L.y+$;++at)hh(n,r,b.alphas,Z,st,L,E,D,L.x-$,at),hh(n,r,b.alphas,Z,st,L,E,D,L.x+$,at);const rt=$-1;for(let at=L.x-rt;at<=L.x+rt;++at)hh(n,r,b.alphas,Z,st,L,E,D,at,L.y-$),hh(n,r,b.alphas,Z,st,L,E,D,at,L.y+$);for(let at=0;at<st.length;++at){const Y=st[at];let H=0;for(H=0;H<Z.length;++H){const wt=Z[H];if(wt[1]>wt[0]&&Y[1]>=wt[0]&&Y[0]<=wt[1]&&Y[2]>=1&&wt[2]>=1){Z[H]=[Math.min(Y[0],wt[0]),Math.max(Y[1],wt[1]),1];break}}H===Z.length&&Z.push(Y)}}}}else if(Hr(P)){const N=Br(r,L);b.alphas[N]=0}}P===t&&(T.focusx=L.x,T.focusy=L.y,T.focusid=P)}a.push(uh(t,c++,"text/mood",m?"dark":"bright"));const C=ue(Pt.MAIN),R=Ki(C,Pt.MAIN);if(gt(R.palette)){const U=Ge(C,_t.PALETTE,R.palette),I=Ee(U);x(I==null?void 0:I.bits)&&a.push(uh(t,c++,"image/palette",Array.from(I.bits)))}if(gt(R.charset)){const U=Ge(C,_t.CHARSET,R.charset),I=Ee(U);x(I==null?void 0:I.bits)&&a.push(uh(t,c++,"image/charset",Array.from(I.bits)))}const S=Object.keys(r.objects).filter(Hr);return a.push(uh(t,c++,"text/players",S.join(","))),a}const hr=y4();var Pt=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.CONTENT="content",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(Pt||{});const ve={halt:!1,session:je(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function v4(){return ve.session}function fr(){return ve.operator}function k4(t){ve.operator=t}function T4(t){ve.halt=t}function A4(){return ve.halt}function ha(){return[...ve.books.values()]}function R4(){const[t]=ve.books.values();return t}function Wr(t){const e=Ot(t);return ve.books.get(t)??ha().find(n=>n.name===e)}function fh(t,e){x(Wr(e))&&(ve.software[t]=e)}function ue(t){return Wr(ve.software[t])}function OE(t){const e=dx([]);return gt(t)&&(e.name=t),yp(e),pe(tt,ve.operator,`created [book] ${e.name}`),e}function S4(t){let e=Wr(t);return x(e)||(e=dx([]),e.name=t),yp(e),pe(tt,ve.operator,`created [book] ${e.name}`),e}function bn(t,e){let n=x(e)?S4(e):ue(t);return x(n)||(x(n)||(n=R4()),x(n)||(n=OE(e)),x(n)&&pe(tt,ve.operator,`opened [book] ${n.name} for ${t}`)),fh(t,n.id),n}function vs(t,e,n){return j0(bn(t),n,e)}function Sr(t){const e=bn("main");return Ki(e,t)}function IE(t){const e=bn("main");return cF(e,t)}function NE(){const t=bn("main");return Ki(t,"main")}function O4(t){const e=bn("main");return yx(e,t)}function I4(t,e){ve.books.clear(),t.forEach(r=>{ve.books.set(r.id,r),r.name==="main"&&(ve.software.main=r.id)});const n=Wr(e);if(x(n)&&fh("main",n.id),!ve.software.main){const r=ve.books.values().next();r.value&&(ve.software.main=r.value.id)}}function yp(t){return ve.books.set(t.id,t),t.id}function N4(t){const e=Wr(t);e&&ve.books.delete(e.id)}function CE(t){if(!gt(t)||!t)return de(tt,t,"login",`failed for playerid ==>${t}<==`);const e=ue("main");if(!x(e))return de(tt,t,"login:main","login failed to find book 'main'");const n=io(e,t);if(x(n))return!0;const r=Hn(e,_t.BOARD,"title");if(r.length===0)return de(tt,t,"login:title","login failed to find board with 'title' stat");const i=ro(e,"player");if(!x(i))return de(tt,t,"login:player","login failed to find object type 'player'");const s=by(t,r),o=Ee(s);if(x(o)){const a=P0(s,"startx"),c=P0(s,"starty"),l=kt(a)?a:Math.round(Tt*.5),u=kt(c)?c:Math.round(Ht*.5),d=i.name??"player",f=Ad(o,{x:l,y:u},d,t);if(x(f==null?void 0:f.id))return f.player=t,Yu(e,t,o.id),!0}return!1}function C4(t){const e=ue("main"),n=io(e,t);if(!x(e))return;const r=[t];for(let i=0;i<e.activelist.length;++i){const s=e.activelist[i];s.startsWith(t)&&r.push(s)}for(let i=0;i<r.length;++i){const s=r[i];Yu(e,s,""),K0(e,n,Sn(n,s)),rb(n,s),hr.halt(s),yx(e,s)}}function Zn(t){const e=ue("main");return io(e,t)}function L4(t){const e=ue("main"),n=uF(e,t),r=io(e,t),i=Sn(r,t);return n&&x(i)}function M4(t){const e=ue("main"),n=na(e);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Hr(c)&&x(t[c])===!1&&(t[c]=0,Yu(e,c,i.id))}}}function LE(t){hr.message(t)}function fa(t,e,n,r){const i=Ci(e);gt(n.id)&&tt.emit(t,"vm:touched",[n.id,i,r])}function U4(t,e,n,r){const i=n.id??"";if(r.x<0){const s=Hn(t,_t.BOARD,(e==null?void 0:e.exitwest)??"");if(s.length){const o=Ae(s);ea(t,i,o.id,{x:Tt-1,y:r.y})}}else if(r.x>=Tt){const s=Hn(t,_t.BOARD,(e==null?void 0:e.exiteast)??"");if(s.length){const o=Ae(s);ea(t,i,o.id,{x:0,y:r.y})}}else if(r.y<0){const s=Hn(t,_t.BOARD,(e==null?void 0:e.exitnorth)??"");if(s.length){const o=Ae(s);ea(t,i,o.id,{x:r.x,y:Ht-1})}}else if(r.y>=Ht){const s=Hn(t,_t.BOARD,(e==null?void 0:e.exitsouth)??"");if(s.length){const o=Ae(s);ea(t,i,o.id,{x:r.x,y:0})}}}function ks(t,e,n,r){if(!x(n==null?void 0:n.id))return!1;const i=H0(t,e,n,r);if(x(i)){const s=Hr(i.id);return n.kind==="player"&&i.kind==="edge"?U4(t,e,n,r):fa("",i,n,"thud"),n.kind==="player"?fa(n.id,n,i,s?"bump":"touch"):n.collision===Mt.ISBULLET?le(t,i,"collision")===Mt.ISBULLET?fa("",n,i,"thud"):Hr(n.party)?fa(n.id,n,i,s?"partyshot":"shot"):fa("",n,i,s?"shot":"partyshot"):fa("",n,i,"bump"),le(t,i,"breakable")?(x(i==null?void 0:i.id)?En(w.book,w.board,i,w.timestamp):Se(e,{x:r.x,y:r.y}),!0):!1}return!0}function ME(t,e,n,r,i=fg){var u;if(!x(t)||!x(e)||!x(n))return;const s={...w};w.book=t,w.board=e,w.element=n,w.elementid=n.id??"",w.elementisplayer=Hr(w.elementid);const o=w.element.player??ve.operator;w.elementfocus=w.elementisplayer?w.elementid:o;const a=le(t,n,"cycle")??i,c=n.id??"",l=Ot(n.name??((u=n.kinddata)==null?void 0:u.name)??"");if(hr.tick(c,xs.RUNTIME,a,l,r),kt(n==null?void 0:n.tickertime)&&w.timestamp-n.tickertime>ul*5&&(n.tickertime=0,n.tickertext=""),w.elementisplayer){const d=Sr(w.elementid);kt(d.inputcurrent)&&(d.inputcurrent=0)}dr(s).forEach(d=>{w[d]=s[d]})}function F4(t,e){ve.loaders.set(t,e)}function B4(t){hr.halt(t)}function P4(){const t=hr.ids();for(let n=0;n<t.length;++n)hr.halt(t[n]);const e=ue("main");x(e)&&(e.flags={})}function D4(){const t=ue("main");if(!x(t))return;const e=t.timestamp+1,n=Di.HALT_AT_COUNT;Di.HALT_AT_COUNT=n*2,ve.loaders.forEach((i,s)=>{const o={...w};w.timestamp=t.timestamp,w.book=t,w.board=void 0,w.element=void 0,w.elementid=s,w.elementisplayer=!1,w.elementfocus=fr();const a=z$(s);x(a)&&hr.arg(s,a),hr.tick(s,xs.LOADER,1,"loader",i),hr.isended(s)&&(hr.halt(s),ve.loaders.delete(s)),dr(o).forEach(c=>{w[c]=o[c]})}),Di.HALT_AT_COUNT=n,t.timestamp=e,w.timestamp=e;const r=na(t);for(let i=0;i<r.length;++i){const s=r[i],o=yF(t,s,e);for(let a=0;a<o.length;++a){const{id:c,type:l,code:u,object:d}=o[a];l===_t.ERROR?hr.halt(c):ME(t,s,d,u)}}}function da(t,e,n,r){const i=ue("main");if(!x(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(x(c.id)){const l=`${AE(c.id)}:${e}`;tt.emit("",l,n)}}}if(Hs(t)){for(let o=0;o<r.length;++o){const a=r[o],c=te(a,t);x(c)&&s([c])}return}for(let o=0;o<r.length;++o){const a=r[o];switch(Ot(t)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(ib(a,[t]));break}}}}function $4(t){const e=Sr(t),n=e.playbuffer=gt(e.playbuffer)?e.playbuffer:"";n&&UE(t,n,!1)}function UE(t,e,n=!0){var o;const r=bn("main");if(!x(r))return;const i=`${t}_cli`;w.timestamp=r.timestamp,w.book=r,w.board=io(r,t),w.element=Sn(w.board,t),w.elementid=((o=w.element)==null?void 0:o.id)??"",w.elementisplayer=!0,w.elementfocus=w.elementid||t;const s=Di.HALT_AT_COUNT;if(Di.HALT_AT_COUNT=s*8,hr.once(i,xs.CLI,"cli",e),n){const a=Sr(t);a.playbuffer=e}Di.HALT_AT_COUNT=s}function dh(t){var a;const e=bn("main"),n=zi(e,t);if(!x(e)||!x(n)||!x(w.element))return;const r={...w},i=`${t}_run`,s=Ot(w.element.name??((a=w.element.kinddata)==null?void 0:a.name)??""),o=(n==null?void 0:n.code)??"";hr.once(i,xs.RUNTIME,s,o),dr(r).forEach(c=>{w[c]=r[c]})}function j4(t,e){const n=ue("main"),r=io(n,t),i=[],s=[],o=[];if(!x(n)||!x(r))return{over:i,under:s,layers:o};const a=r.graphics??"flat",c=_s(n,r.overboard??""),l=_s(n,r.underboard??"");return s.push(..._p(t,0,n,l,e,!1,!0)),o.push(..._p(t,s.length,n,r,e,!0,a!=="flat")),i.push(..._p(t,s.length+o.length,n,c,e,!1,!1)),{over:i,under:s,layers:o}}function pa(t,e=0){const n=[];let r=t;for(;r<w.words.length;){const[i,s]=Xn(r);if(ce(i)&&!Fr(i)&&!Dc(i)&&!Xu(i)&&!oi(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),e>0&&n.length>=e)return[n,r]}return[n,r]}function Xn(t){var r,i,s,o,a,c,l,u,d;const e=w.words[t],n=t+1;if($x(e)){const[f,h]=M$(t);if(x(f))return[f,h]}if(U$(e)){const[f,h]=F$(t);if(x(f))return[f,h]}if(zl(e)){const[f,h]=dd(t);if(x(f))return[f,h]}if(gt(e)&&Ot(e)==="rnd"){const[f,h]=Xn(n),[p,m]=Xn(h);return kt(f)&&kt(p)?[br(f,p),m]:kt(f)?[br(0,f),h]:[br(0,1),n]}if(fd(e)){const[f,h]=Ey(t);if(x(f))return[f,h]}if(!x(e))return[void 0,t];if(kt(e)||ce(e))return[e,n];if(gt(e)){const f=Ot(e),h=(r=w.get)==null?void 0:r.call(w,e);if(x(h))return[h,n];switch(f){case"aligned":case"alligned":{const p=lc(w.board,{x:((i=w.element)==null?void 0:i.x)??-1,y:((s=w.element)==null?void 0:s.y)??-1},w.elementfocus);return!x(w.element)||!x(p)?[0,n]:[w.element.x===p.x||w.element.y===p.y?1:0,n]}case"contact":{const p=lc(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus);if(!x(w.element)||!x(p))return[0,n];const m=(p.x??0)-(((c=w.element)==null?void 0:c.x)??0),b=(p.y??0)-(((l=w.element)==null?void 0:l.y)??0);return[m===0&&Math.abs(b)<2||b===0&&Math.abs(m)<2?1:0,n]}case"blocked":{const[p,m]=nt(w.words,n,[j.DIR]);return[gF(w.book,w.board,w.element,p.destpt)?1:0,m]}case"any":{const[p,m]=nt(w.words,n,[j.KIND]);return[Rd(w.board,p).length?1:0,m]}case"count":{const[p,m]=nt(w.words,n,[j.KIND]);return[Rd(w.board,p).length,m]}case"color":{const[p,m,b]=nt(w.words,n,[j.DIR,j.COLOR]),_=p.layer===dt.MID?te(w.board,p.destpt):cs(w.board,p.destpt.x,p.destpt.y);if(x(_)){const v=ta(w.book,_,-1,-1,-1);return[Ty(m)===v.color||Ay(m)===v.bg?1:0,b]}return[0,b]}case"detect":{const[p,m,b]=nt(w.words,n,[j.DIR,j.KIND]),_=p.layer===dt.MID?te(w.board,p.destpt):cs(w.board,p.destpt.x,p.destpt.y);if(x(_)){const v=Ot(Kl(m)),T=pd(m),A=ta(w.book,_,-1,-1,-1);if(v&&v===Ot(Ci(_)))return[1,b];if(x(T)&&T===A.color)return[1,b]}return[0,b]}case"rnd":return[br(0,1),n];case"abs":{const[p,m]=nt(w.words,n,[j.NUMBER]);return[Math.abs(p),m]}case"intceil":{const[p,m]=nt(w.words,n,[j.NUMBER]);return[Math.ceil(p),m]}case"intfloor":{const[p,m]=nt(w.words,n,[j.NUMBER]);return[Math.floor(p),m]}case"intround":{const[p,m]=nt(w.words,n,[j.NUMBER]);return[Math.round(p),m]}case"clamp":{const[p,m,b,_]=nt(w.words,n,[j.NUMBER,j.NUMBER,j.NUMBER]);return[tn(p,m,b),_]}case"min":{const[p,m]=pa(n);return[Math.min(...p),m]}case"max":{const[p,m]=pa(n);return[Math.max(...p),m]}case"pick":{const[p,m]=pa(n);return[Ae(p),m]}case"pickwith":{const[p,m]=nt(w.words,n,[j.NUMBER_OR_STRING]),[b,_]=pa(m);return[by(`${p}`,b),_]}case"random":{const[p,m]=pa(n,2),[b,_]=p;return[br(b,_??0),m]}case"randomwith":{const[p,m]=nt(w.words,n,[j.NUMBER_OR_STRING]),[b,_]=pa(m,2),[v,T]=b;return[_y(`${p}`,v,T??0),_]}case"run":{const[p,m]=nt(w.words,n,[j.NAME]);return dh(p),[(u=w.get)==null?void 0:u.call(w,"arg"),m]}case"runwith":{const[p,m,b]=nt(w.words,n,[j.ANY,j.NAME]);return x(w.element)&&(w.element.arg=p),dh(m),[(d=w.get)==null?void 0:d.call(w,"arg"),b]}}}return[e,n]}const w={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var j=(t=>(t[t.COLOR=0]="COLOR",t[t.KIND=1]="KIND",t[t.DIR=2]="DIR",t[t.NAME=3]="NAME",t[t.NUMBER=4]="NUMBER",t[t.STRING=5]="STRING",t[t.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",t[t.MAYBE_KIND=7]="MAYBE_KIND",t[t.MAYBE_NAME=8]="MAYBE_NAME",t[t.MAYBE_NUMBER=9]="MAYBE_NUMBER",t[t.MAYBE_STRING=10]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=11]="MAYBE_NUMBER_OR_STRING",t[t.ANY=12]="ANY",t))(j||{});function Tn(t,e,n){throw console.info(n,w.element,w.elementid,w.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function FE(t){var n,r;const e={x:((n=w.element)==null?void 0:n.x)??0,y:((r=w.element)==null?void 0:r.y)??0};return Vu(w.book,w.board,w.element,w.elementfocus,t,e)}function nt(t,e,n){const r=w.words;w.words=t;const i=[];let s=e;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=Oy(s);Ko(a)?(s=c,i.push(a)):Tn("kind",a,t);break}case 0:{if(zl(t[0])===void 0){const[a,c]=Xn(s);oi(a)?(s=c,i.push(a)):Tn("color",a,t)}else{const[a,c]=dd(s);oi(a)?(s=c,i.push(a)):Tn("color",a,t)}break}case 2:{if(fd(t[0])===void 0){const[a,c]=Xn(s);Fr(a)?(s=c,i.push(FE(a))):Tn("direction",a,t)}else{const[a,c]=Ey(s);Fr(a)?(s=c,i.push(FE(a))):Tn("direction",a,t)}break}case 3:{const a=w.words[s];gt(a)||Tn("string",a,t),++s,i.push(a);break}case 4:{const[a,c]=Xn(s);if(gt(a)){const l=parseFloat(a);kt(l)?i.push(l):Tn("number",a,t)}else kt(a)?i.push(a):Tn("number",a,t);s=c;break}case 5:{const[a,c]=Xn(s);gt(a)||Tn("string",a,t),s=c,i.push(a);break}case 6:{const[a,c]=Xn(s);let l=a;if(gt(l)){const u=parseFloat(l);kt(u)&&(l=u)}else kt(l)||Tn("number or string",l,t);s=c,i.push(l);break}case 7:{const[a,c]=Oy(s);a!==void 0&&!Ko(a)&&Tn("optional kind",a,t),s=c,i.push(a);break}case 8:{const a=w.words[s];a!==void 0&&!gt(a)&&Tn("optional string",a,t),++s,i.push(a);break}case 9:{const[a,c]=Xn(s);if(gt(a)){const l=parseFloat(a);kt(l)?i.push(l):Tn("optional number",a,t)}else kt(a)||a===void 0?i.push(a):Tn("optional number",a,t);s=c;break}case 10:{const[a,c]=Xn(s);a!==void 0&&!gt(a)&&Tn("optional string",a,t),s=c,i.push(a);break}case 11:{const[a,c]=Xn(s);let l=a;if(gt(l)){const u=parseFloat(l);kt(u)&&(l=u)}else l!==void 0&&!kt(l)&&Tn("number or string",l,t);s=c,i.push(l);break}case 12:{const[a,c]=Xn(s);s=c,i.push(a);break}}return w.words=r,[...i,s]}const ph={},ma={};function bp(){return{id:je(),layers:[],scroll:[],sidebar:[]}}const z4=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),K4=new Set(["tx","text"]),W4={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},BE={};let PE=t=>{let e=BE[t];return x(e)||(BE[t]=e=bp()),e};function H4(t){PE=t}function qe(t){return PE(t)}function wp(t){return x(ph[t])||(ph[t]=[]),ph[t]}function G4(t){const e=qe(t);e.scroll=[]}function Y4(t,e,n){Object.values(ma).forEach(r=>{if(r[e]!==void 0){const i=ab(t.id(),e);kt(n)&&pI(i,n),gt(n)&&mI(i,n)}})}function Ln(t){const e=wp(t);return ph[t]=[],e}function Lt(t,e){wp(t).push(e)}function Nt(t,e,n,r,i=()=>0,s=Oh){const o=[e,n,...r],a=Ot(`${o[3]}`),c={...w};function l(u,d){x(d)&&d!==i(u)&&(w.board=c.board,w.element=c.element,w.elementfocus=c.elementfocus,s(u,d))}if(z4.has(a)){const u=`${o[2]}`;ma[e]=ma[e]??{};const d=i(u)??W4[a];if(ma[e][u]===void 0){const f=ab(e,u);kt(d)&&dI(f,d),gt(d)&&sd(f,d),K4.has(a)?ma[e][u]=sy(f,h=>{l(u,h)}):ma[e][u]=gI(f,h=>{l(u,h)})}}wp(t).push(o)}H4(t=>{if(Hr(t)){const e=ue(Pt.MAIN),n=Ki(e,Pt.GADGETSTORE);let r=n[t];return x(r)||(n[t]=r=bp()),r}return bp()});let DE=0;function V4(){switch(DE++){case 0:return At.BLUE;case 1:return At.BLACK;case 2:return At.GREEN;case 3:return At.BLACK;case 4:return At.CYAN;case 5:return At.BLACK;case 6:return At.RED;case 7:return At.BLACK;case 8:return At.PURPLE;case 9:return At.BLACK;case 10:return At.YELLOW;case 11:return At.BLACK;case 12:return At.WHITE;default:return DE=0,At.BLACK}}const mh=ho("gadgetserver",["tock","second"],t=>{if(!mh.session(t))return;const e=ue(Pt.MAIN),n=(e==null?void 0:e.activelist)??[],r=Ki(e,Pt.GADGETSYNC);switch(t.target){case"tock":{const i=V4();for(let s=0;s<n.length;++s){const o=n[s],{over:a,under:c,layers:l}=j4(o,i),u=qe(o);u.over=a,u.under=c,u.layers=l;const d=r[o]??{},f=Bp(d,u);f.length&&(r[o]=Qn(u),zA(mh,o,f))}break}case"second":for(let i=0;i<n.length;++i){const s=n[i],o=Zn(s);x(o)&&tR(mh,s,o.id)}break;case"desync":jA(mh,t.player,qe(t.player));break;case"clearscroll":G4(t.player);break;case"clearplayer":{const i=ue(Pt.MAIN),s=Ki(i,Pt.GADGETSTORE);delete s[t.player];const o=Ki(i,Pt.GADGETSYNC);delete o[t.player];break}}});function gh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var $E={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var d=typeof gh=="function"&&gh;if(!u&&d)return d(l,!0);if(a)return a(l,!0);var f=new Error("Cannot find module '"+l+"'");throw f.code="MODULE_NOT_FOUND",f}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(p){var m=r[l][1][p];return o(m||p)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof gh=="function"&&gh,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,d,f,h,p,m,b=[],_=0,v=c.length,T=v,A=s.getTypeOf(c)!=="string";_<c.length;)T=v-_,d=A?(l=c[_++],u=_<v?c[_++]:0,_<v?c[_++]:0):(l=c.charCodeAt(_++),u=_<v?c.charCodeAt(_++):0,_<v?c.charCodeAt(_++):0),f=l>>2,h=(3&l)<<4|u>>4,p=1<T?(15&u)<<2|d>>6:64,m=2<T?63&d:64,b.push(a.charAt(f)+a.charAt(h)+a.charAt(p)+a.charAt(m));return b.join("")},i.decode=function(c){var l,u,d,f,h,p,m=0,b=0,_="data:";if(c.substr(0,_.length)===_)throw new Error("Invalid base64 input, it looks like a data url.");var v,T=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&T--,c.charAt(c.length-2)===a.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=o.uint8array?new Uint8Array(0|T):new Array(0|T);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(f=a.indexOf(c.charAt(m++)))>>4,u=(15&f)<<4|(h=a.indexOf(c.charAt(m++)))>>2,d=(3&h)<<6|(p=a.indexOf(c.charAt(m++))),v[b++]=l,h!==64&&(v[b++]=u),p!==64&&(v[b++]=d);return v}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,d,f,h,p){this.compressedSize=u,this.uncompressedSize=d,this.crc32=f,this.compression=h,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),d=this;return u.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,d,f){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(d.compressWorker(f)).pipe(new c("compressedSize")).withStreamInfo("compression",d)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,d,f){var h=o,p=f+d;l^=-1;for(var m=f;m<p;m++)l=l>>>8^h[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,d,f){var h=o,p=f+d;l^=-1;for(var m=f;m<p;m++)l=l>>>8^h[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(d,f){c.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=f,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,d.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(f){d.push({data:f,meta:d.meta})}},i.compressWorker=function(d){return new u("Deflate",d)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,p){var m,b="";for(m=0;m<p;m++)b+=String.fromCharCode(255&h),h>>>=8;return b}function o(h,p,m,b,_,v){var T,A,C=h.file,R=h.compression,S=v!==l.utf8encode,U=a.transformTo("string",v(C.name)),I=a.transformTo("string",l.utf8encode(C.name)),P=C.comment,W=a.transformTo("string",v(P)),L=a.transformTo("string",l.utf8encode(P)),N=I.length!==C.name.length,E=L.length!==P.length,D="",Z="",$="",st=C.dir,rt=C.date,at={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(at.crc32=h.crc32,at.compressedSize=h.compressedSize,at.uncompressedSize=h.uncompressedSize);var Y=0;p&&(Y|=8),S||!N&&!E||(Y|=2048);var H=0,wt=0;st&&(H|=16),_==="UNIX"?(wt=798,H|=function(ht,jt){var ie=ht;return ht||(ie=jt?16893:33204),(65535&ie)<<16}(C.unixPermissions,st)):(wt=20,H|=function(ht){return 63&(ht||0)}(C.dosPermissions)),T=rt.getUTCHours(),T<<=6,T|=rt.getUTCMinutes(),T<<=5,T|=rt.getUTCSeconds()/2,A=rt.getUTCFullYear()-1980,A<<=4,A|=rt.getUTCMonth()+1,A<<=5,A|=rt.getUTCDate(),N&&(Z=s(1,1)+s(u(U),4)+I,D+="up"+s(Z.length,2)+Z),E&&($=s(1,1)+s(u(W),4)+L,D+="uc"+s($.length,2)+$);var lt="";return lt+=`
\0`,lt+=s(Y,2),lt+=R.magic,lt+=s(T,2),lt+=s(A,2),lt+=s(at.crc32,4),lt+=s(at.compressedSize,4),lt+=s(at.uncompressedSize,4),lt+=s(U.length,2),lt+=s(D.length,2),{fileRecord:d.LOCAL_FILE_HEADER+lt+U+D,dirRecord:d.CENTRAL_FILE_HEADER+s(wt,2)+lt+s(W.length,2)+"\0\0\0\0"+s(H,4)+s(b,4)+U+D+W}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),d=n("../signature");function f(h,p,m,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,c),f.prototype.push=function(h){var p=h.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-b-1))/m:100}}))},f.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var p=this.streamFiles&&!h.file.dir;if(p){var m=o(h,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(h){this.accumulate=!1;var p=this.streamFiles&&!h.file.dir,m=o(h,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(b){return d.DATA_DESCRIPTOR+s(b.crc32,4)+s(b.compressedSize,4)+s(b.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var h=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-h,b=function(_,v,T,A,C){var R=a.transformTo("string",C(A));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(_,2)+s(_,2)+s(v,4)+s(T,4)+s(R.length,2)+R}(this.dirRecords.length,m,h,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(h){this._sources.push(h);var p=this;return h.on("data",function(m){p.processChunk(m)}),h.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),h.on("error",function(m){p.error(m)}),this},f.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(h){var p=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var m=0;m<p.length;m++)try{p[m].error(h)}catch{}return!0},f.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,p=0;p<h.length;p++)h[p].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),d=0;try{a.forEach(function(f,h){d++;var p=function(v,T){var A=v||T,C=s[A];if(!C)throw new Error(A+" is not a valid compression method !");return C}(h.options.compression,c.compression),m=h.options.compressionOptions||c.compressionOptions||{},b=h.dir,_=h.date;h._compressWorker(p,m).withStreamInfo("file",{name:f,dir:b,date:_,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=d}catch(f){u.error(f)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function d(f){return new o.Promise(function(h,p){var m=f.decompressed.getContentWorker().pipe(new l);m.on("error",function(b){p(b)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(f,h){var p=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,h.optimizedBinaryString,h.base64).then(function(m){var b=new c(h);return b.load(m),b}).then(function(m){var b=[o.Promise.resolve(m)],_=m.files;if(h.checkCRC32)for(var v=0;v<_.length;v++)b.push(d(_[v]));return o.Promise.all(b)}).then(function(m){for(var b=m.shift(),_=b.files,v=0;v<_.length;v++){var T=_[v],A=T.fileNameStr,C=s.resolve(T.fileNameStr);p.file(C,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:h.createFolders}),T.dir||(p.file(C).unsafeOriginalName=A)}return b.zipComment.length&&(p.comment=b.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(d,f){u.push(d)||u._helper.pause(),l&&l(f)}).on("error",function(d){u.emit("error",d)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof dn<"u",newBufferFrom:function(s,o){if(dn.from&&dn.from!==Uint8Array.from)return dn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new dn(s,o)},allocBuffer:function(s){if(dn.alloc)return dn.alloc(s);var o=new dn(s);return o.fill(0),o},isBuffer:function(s){return dn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(C,R,S){var U,I=a.getTypeOf(R),P=a.extend(S||{},u);P.date=P.date||new Date,P.compression!==null&&(P.compression=P.compression.toUpperCase()),typeof P.unixPermissions=="string"&&(P.unixPermissions=parseInt(P.unixPermissions,8)),P.unixPermissions&&16384&P.unixPermissions&&(P.dir=!0),P.dosPermissions&&16&P.dosPermissions&&(P.dir=!0),P.dir&&(C=_(C)),P.createFolders&&(U=b(C))&&v.call(this,U,!0);var W=I==="string"&&P.binary===!1&&P.base64===!1;S&&S.binary!==void 0||(P.binary=!W),(R instanceof d&&R.uncompressedSize===0||P.dir||!R||R.length===0)&&(P.base64=!1,P.binary=!0,R="",P.compression="STORE",I="string");var L=null;L=R instanceof d||R instanceof c?R:p.isNode&&p.isStream(R)?new m(C,R):a.prepareContent(C,R,P.binary,P.optimizedBinaryString,P.base64);var N=new f(C,L,P);this.files[C]=N}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),d=n("./compressedObject"),f=n("./zipObject"),h=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),b=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var R=C.lastIndexOf("/");return 0<R?C.substring(0,R):""},_=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},v=function(C,R){return R=R!==void 0?R:u.createFolders,C=_(C),this.files[C]||s.call(this,C,null,{dir:!0,createFolders:R}),this.files[C]};function T(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var R,S,U;for(R in this.files)U=this.files[R],(S=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&C(S,U)},filter:function(C){var R=[];return this.forEach(function(S,U){C(S,U)&&R.push(U)}),R},file:function(C,R,S){if(arguments.length!==1)return C=this.root+C,s.call(this,C,R,S),this;if(T(C)){var U=C;return this.filter(function(P,W){return!W.dir&&U.test(P)})}var I=this.files[this.root+C];return I&&!I.dir?I:null},folder:function(C){if(!C)return this;if(T(C))return this.filter(function(I,P){return P.dir&&C.test(I)});var R=this.root+C,S=v.call(this,R),U=this.clone();return U.root=S.name,U},remove:function(C){C=this.root+C;var R=this.files[C];if(R||(C.slice(-1)!=="/"&&(C+="/"),R=this.files[C]),R&&!R.dir)delete this.files[C];else for(var S=this.filter(function(I,P){return P.name.slice(0,C.length)===C}),U=0;U<S.length;U++)delete this.files[S[U].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var R,S={};try{if((S=a.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=S.type.toLowerCase(),S.compression=S.compression.toUpperCase(),S.type==="binarystring"&&(S.type="string"),!S.type)throw new Error("No output type specified.");a.checkSupport(S.type),S.platform!=="darwin"&&S.platform!=="freebsd"&&S.platform!=="linux"&&S.platform!=="sunos"||(S.platform="UNIX"),S.platform==="win32"&&(S.platform="DOS");var U=S.comment||this.comment||"";R=h.generateWorker(this,S,U)}catch(I){(R=new c("error")).error(I)}return new l(R,S.type||"string",S.mimeType)},generateAsync:function(C,R){return this.generateInternalStream(C).accumulate(R)},generateNodeStream:function(C,R){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(R)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),d=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===l&&this.data[f+2]===u&&this.data[f+3]===d)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),d=a.charCodeAt(3),f=this.readData(4);return c===f[0]&&l===f[1]&&u===f[2]&&d===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(d){var f=s.getTypeOf(d);return s.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new l(d):o.uint8array?new u(s.transformTo("uint8array",d)):new a(s.transformTo("array",d)):new c(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),d=null;if(l.nodestream)try{d=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(p,m){return new u.Promise(function(b,_){var v=[],T=p._internalType,A=p._outputType,C=p._mimeType;p.on("data",function(R,S){v.push(R),m&&m(S)}).on("error",function(R){v=[],_(R)}).on("end",function(){try{var R=function(S,U,I){switch(S){case"blob":return s.newBlob(s.transformTo("arraybuffer",U),I);case"base64":return c.encode(U);default:return s.transformTo(S,U)}}(A,function(S,U){var I,P=0,W=null,L=0;for(I=0;I<U.length;I++)L+=U[I].length;switch(S){case"string":return U.join("");case"array":return Array.prototype.concat.apply([],U);case"uint8array":for(W=new Uint8Array(L),I=0;I<U.length;I++)W.set(U[I],P),P+=U[I].length;return W;case"nodebuffer":return dn.concat(U);default:throw new Error("concat : unsupported type '"+S+"'")}}(T,v),C);b(R)}catch(S){_(S)}v=[]}).resume()})}function h(p,m,b){var _=m;switch(m){case"blob":case"arraybuffer":_="uint8array";break;case"base64":_="string"}try{this._internalType=_,this._outputType=m,this._mimeType=b,s.checkSupport(_),this._worker=p.pipe(new o(_)),p.lock()}catch(v){this._worker=new a("error"),this._worker.error(v)}}h.prototype={accumulate:function(p){return f(this,p)},on:function(p,m){var b=this;return p==="data"?this._worker.on(p,function(_){m.call(b,_.data,_.meta)}):this._worker.on(p,function(){s.delay(m,arguments,b)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof dn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function d(){c.call(this,"utf-8 decode"),this.leftOver=null}function f(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(p){var m,b,_,v,T,A=p.length,C=0;for(v=0;v<A;v++)(64512&(b=p.charCodeAt(v)))==55296&&v+1<A&&(64512&(_=p.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(_-56320),v++),C+=b<128?1:b<2048?2:b<65536?3:4;for(m=o.uint8array?new Uint8Array(C):new Array(C),v=T=0;T<C;v++)(64512&(b=p.charCodeAt(v)))==55296&&v+1<A&&(64512&(_=p.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(_-56320),v++),b<128?m[T++]=b:(b<2048?m[T++]=192|b>>>6:(b<65536?m[T++]=224|b>>>12:(m[T++]=240|b>>>18,m[T++]=128|b>>>12&63),m[T++]=128|b>>>6&63),m[T++]=128|63&b);return m}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(p){var m,b,_,v,T=p.length,A=new Array(2*T);for(m=b=0;m<T;)if((_=p[m++])<128)A[b++]=_;else if(4<(v=l[_]))A[b++]=65533,m+=v-1;else{for(_&=v===2?31:v===3?15:7;1<v&&m<T;)_=_<<6|63&p[m++],v--;1<v?A[b++]=65533:_<65536?A[b++]=_:(_-=65536,A[b++]=55296|_>>10&1023,A[b++]=56320|1023&_)}return A.length!==b&&(A.subarray?A=A.subarray(0,b):A.length=b),s.applyFromCharCode(A)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(d,c),d.prototype.processChunk=function(h){var p=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var b=function(v,T){var A;for((T=T||v.length)>v.length&&(T=v.length),A=T-1;0<=A&&(192&v[A])==128;)A--;return A<0||A===0?T:A+l[v[A]]>T?A:T}(p),_=p;b!==p.length&&(o.uint8array?(_=p.subarray(0,b),this.leftOver=p.subarray(b,p.length)):(_=p.slice(0,b),this.leftOver=p.slice(b,p.length))),this.push({data:i.utf8decode(_),meta:h.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=d,s.inherits(f,c),f.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,b){for(var _=0;_<m.length;++_)b[_]=255&m.charCodeAt(_);return b}n("setimmediate"),i.newBlob=function(m,b){i.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var _=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return _.append(m),_.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(m,b,_){var v=[],T=0,A=m.length;if(A<=_)return String.fromCharCode.apply(null,m);for(;T<A;)b==="array"||b==="nodebuffer"?v.push(String.fromCharCode.apply(null,m.slice(T,Math.min(T+_,A)))):v.push(String.fromCharCode.apply(null,m.subarray(T,Math.min(T+_,A)))),T+=_;return v.join("")},stringifyByChar:function(m){for(var b="",_=0;_<m.length;_++)b+=String.fromCharCode(m[_]);return b},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function f(m){var b=65536,_=i.getTypeOf(m),v=!0;if(_==="uint8array"?v=d.applyCanBeUsed.uint8array:_==="nodebuffer"&&(v=d.applyCanBeUsed.nodebuffer),v)for(;1<b;)try{return d.stringifyByChunk(m,_,b)}catch{b=Math.floor(b/2)}return d.stringifyByChar(m)}function h(m,b){for(var _=0;_<m.length;_++)b[_]=m[_];return b}i.applyFromCharCode=f;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:f,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return f(new Uint8Array(m))},array:function(m){return h(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:f,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:f,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,b){if(b=b||"",!m)return b;i.checkSupport(m);var _=i.getTypeOf(b);return p[_][m](b)},i.resolve=function(m){for(var b=m.split("/"),_=[],v=0;v<b.length;v++){var T=b[v];T==="."||T===""&&v!==0&&v!==b.length-1||(T===".."?_.pop():_.push(T))}return _.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var b,_,v="";for(_=0;_<(m||"").length;_++)v+="\\x"+((b=m.charCodeAt(_))<16?"0":"")+b.toString(16).toUpperCase();return v},i.delay=function(m,b,_){setImmediate(function(){m.apply(_||null,b||[])})},i.inherits=function(m,b){function _(){}_.prototype=b.prototype,m.prototype=new _},i.extend=function(){var m,b,_={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&_[b]===void 0&&(_[b]=arguments[m][b]);return _},i.prepareContent=function(m,b,_,v,T){return c.Promise.resolve(b).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(C,R){var S=new FileReader;S.onload=function(U){C(U.target.result)},S.onerror=function(U){R(U.target.error)},S.readAsArrayBuffer(A)}):A}).then(function(A){var C=i.getTypeOf(A);return C?(C==="arraybuffer"?A=i.transformTo("uint8array",A):C==="string"&&(T?A=o.decode(A):_&&v!==!0&&(A=function(R){return u(R,s.uint8array?new Uint8Array(R.length):new Array(R.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(d){this.files=[],this.loadOptions=d}u.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(d)+")")}},isSignature:function(d,f){var h=this.reader.index;this.reader.setIndex(d);var p=this.reader.readString(4)===f;return this.reader.setIndex(h),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),f=l.uint8array?"uint8array":"array",h=o.transformTo(f,d);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,f,h,p=this.zip64EndOfCentralSize-44;0<p;)d=this.reader.readInt(2),f=this.reader.readInt(4),h=this.reader.readData(f),this.zip64ExtensibleData[d]={id:d,length:f,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,f;for(d=0;d<this.files.length;d++)f=this.files[d],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(d=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var f=d;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var p=f-h;if(0<p)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(d){this.reader=s(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),d=n("./support");function f(h,p){this.options=h,this.loadOptions=p}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var p,m;if(h.skip(22),this.fileNameLength=h.readInt(2),m=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(b){for(var _ in u)if(Object.prototype.hasOwnProperty.call(u,_)&&u[_].magic===b)return u[_];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var p=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(p),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var p,m,b,_=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<_;)p=h.readInt(2),m=h.readInt(2),b=h.readData(m),this.extraFields[p]={id:p,length:m,value:b};h.setIndex(_)},handleUTF8:function(){var h=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var _=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(_)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,b){this.name=p,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,b="string";try{if(!p)throw new Error("No output type specified.");var _=(b=p.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var v=!this._dataBinary;v&&!_&&(m=m.pipe(new c.Utf8EncodeWorker)),!v&&_&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(T){(m=new u("error")).error(T)}return new o(m,b,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(b,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<d.length;h++)s.prototype[d[h]]=f;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),d=s.document.createTextNode("");u.observe(d,{characterData:!0}),o=function(){d.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var f=new s.MessageChannel;f.port1.onmessage=p,o=function(){f.port2.postMessage(0)}}var h=[];function p(){var m,b;a=!0;for(var _=h.length;_;){for(b=h,h=[],m=-1;++m<_;)b[m]();_=h.length}a=!1}r.exports=function(m){h.push(m)!==1||a||o()}}).call(this,typeof Mn<"u"?Mn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function d(_){if(typeof _!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,_!==o&&m(this,_)}function f(_,v,T){this.promise=_,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function h(_,v,T){s(function(){var A;try{A=v(T)}catch(C){return a.reject(_,C)}A===_?a.reject(_,new TypeError("Cannot resolve promise with itself")):a.resolve(_,A)})}function p(_){var v=_&&_.then;if(_&&(typeof _=="object"||typeof _=="function")&&typeof v=="function")return function(){v.apply(_,arguments)}}function m(_,v){var T=!1;function A(S){T||(T=!0,a.reject(_,S))}function C(S){T||(T=!0,a.resolve(_,S))}var R=b(function(){v(C,A)});R.status==="error"&&A(R.value)}function b(_,v){var T={};try{T.value=_(v),T.status="success"}catch(A){T.status="error",T.value=A}return T}(r.exports=d).prototype.finally=function(_){if(typeof _!="function")return this;var v=this.constructor;return this.then(function(T){return v.resolve(_()).then(function(){return T})},function(T){return v.resolve(_()).then(function(){throw T})})},d.prototype.catch=function(_){return this.then(null,_)},d.prototype.then=function(_,v){if(typeof _!="function"&&this.state===l||typeof v!="function"&&this.state===c)return this;var T=new this.constructor(o);return this.state!==u?h(T,this.state===l?_:v,this.outcome):this.queue.push(new f(T,_,v)),T},f.prototype.callFulfilled=function(_){a.resolve(this.promise,_)},f.prototype.otherCallFulfilled=function(_){h(this.promise,this.onFulfilled,_)},f.prototype.callRejected=function(_){a.reject(this.promise,_)},f.prototype.otherCallRejected=function(_){h(this.promise,this.onRejected,_)},a.resolve=function(_,v){var T=b(p,v);if(T.status==="error")return a.reject(_,T.value);var A=T.value;if(A)m(_,A);else{_.state=l,_.outcome=v;for(var C=-1,R=_.queue.length;++C<R;)_.queue[C].callFulfilled(v)}return _},a.reject=function(_,v){_.state=c,_.outcome=v;for(var T=-1,A=_.queue.length;++T<A;)_.queue[T].callRejected(v);return _},d.resolve=function(_){return _ instanceof this?_:a.resolve(new this(o),_)},d.reject=function(_){var v=new this(o);return a.reject(v,_)},d.all=function(_){var v=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=_.length,A=!1;if(!T)return this.resolve([]);for(var C=new Array(T),R=0,S=-1,U=new this(o);++S<T;)I(_[S],S);return U;function I(P,W){v.resolve(P).then(function(L){C[W]=L,++R!==T||A||(A=!0,a.resolve(U,C))},function(L){A||(A=!0,a.reject(U,L))})}},d.race=function(_){var v=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=_.length,A=!1;if(!T)return this.resolve([]);for(var C=-1,R=new this(o);++C<T;)S=_[C],v.resolve(S).then(function(U){A||(A=!0,a.resolve(R,U))},function(U){A||(A=!0,a.reject(R,U))});var S;return R}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,d=0,f=-1,h=0,p=8;function m(_){if(!(this instanceof m))return new m(_);this.options=o.assign({level:f,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},_||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var T=s.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(T!==d)throw new Error(c[T]);if(v.header&&s.deflateSetHeader(this.strm,v.header),v.dictionary){var A;if(A=typeof v.dictionary=="string"?a.string2buf(v.dictionary):u.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(T=s.deflateSetDictionary(this.strm,A))!==d)throw new Error(c[T]);this._dict_set=!0}}function b(_,v){var T=new m(v);if(T.push(_,!0),T.err)throw T.msg||c[T.err];return T.result}m.prototype.push=function(_,v){var T,A,C=this.strm,R=this.options.chunkSize;if(this.ended)return!1;A=v===~~v?v:v===!0?4:0,typeof _=="string"?C.input=a.string2buf(_):u.call(_)==="[object ArrayBuffer]"?C.input=new Uint8Array(_):C.input=_,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(R),C.next_out=0,C.avail_out=R),(T=s.deflate(C,A))!==1&&T!==d)return this.onEnd(T),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(C.output,C.next_out))):this.onData(o.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&T!==1);return A===4?(T=s.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===d):A!==2||(this.onEnd(d),!(C.avail_out=0))},m.prototype.onData=function(_){this.chunks.push(_)},m.prototype.onEnd=function(_){_===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},i.Deflate=m,i.deflate=b,i.deflateRaw=function(_,v){return(v=v||{}).raw=!0,b(_,v)},i.gzip=function(_,v){return(v=v||{}).gzip=!0,b(_,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),d=n("./zlib/gzheader"),f=Object.prototype.toString;function h(m){if(!(this instanceof h))return new h(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var _=s.inflateInit2(this.strm,b.windowBits);if(_!==c.Z_OK)throw new Error(l[_]);this.header=new d,s.inflateGetHeader(this.strm,this.header)}function p(m,b){var _=new h(b);if(_.push(m,!0),_.err)throw _.msg||l[_.err];return _.result}h.prototype.push=function(m,b){var _,v,T,A,C,R,S=this.strm,U=this.options.chunkSize,I=this.options.dictionary,P=!1;if(this.ended)return!1;v=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?S.input=a.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?S.input=new Uint8Array(m):S.input=m,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new o.Buf8(U),S.next_out=0,S.avail_out=U),(_=s.inflate(S,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&I&&(R=typeof I=="string"?a.string2buf(I):f.call(I)==="[object ArrayBuffer]"?new Uint8Array(I):I,_=s.inflateSetDictionary(this.strm,R)),_===c.Z_BUF_ERROR&&P===!0&&(_=c.Z_OK,P=!1),_!==c.Z_STREAM_END&&_!==c.Z_OK)return this.onEnd(_),!(this.ended=!0);S.next_out&&(S.avail_out!==0&&_!==c.Z_STREAM_END&&(S.avail_in!==0||v!==c.Z_FINISH&&v!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=a.utf8border(S.output,S.next_out),A=S.next_out-T,C=a.buf2string(S.output,T),S.next_out=A,S.avail_out=U-A,A&&o.arraySet(S.output,S.output,T,A,0),this.onData(C)):this.onData(o.shrinkBuf(S.output,S.next_out)))),S.avail_in===0&&S.avail_out===0&&(P=!0)}while((0<S.avail_in||S.avail_out===0)&&_!==c.Z_STREAM_END);return _===c.Z_STREAM_END&&(v=c.Z_FINISH),v===c.Z_FINISH?(_=s.inflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===c.Z_OK):v!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(S.avail_out=0))},h.prototype.onData=function(m){this.chunks.push(m)},h.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=h,i.inflate=p,i.inflateRaw=function(m,b){return(b=b||{}).raw=!0,p(m,b)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var d in u)u.hasOwnProperty(d)&&(c[d]=u[d])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,d,f){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+d),f);else for(var h=0;h<d;h++)c[f+h]=l[u+h]},flattenChunks:function(c){var l,u,d,f,h,p;for(l=d=0,u=c.length;l<u;l++)d+=c[l].length;for(p=new Uint8Array(d),l=f=0,u=c.length;l<u;l++)h=c[l],p.set(h,f),f+=h.length;return p}},a={arraySet:function(c,l,u,d,f){for(var h=0;h<d;h++)c[f+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(d,f){if(f<65537&&(d.subarray&&a||!d.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(d,f));for(var h="",p=0;p<f;p++)h+=String.fromCharCode(d[p]);return h}c[254]=c[254]=1,i.string2buf=function(d){var f,h,p,m,b,_=d.length,v=0;for(m=0;m<_;m++)(64512&(h=d.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=d.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),v+=h<128?1:h<2048?2:h<65536?3:4;for(f=new s.Buf8(v),m=b=0;b<v;m++)(64512&(h=d.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=d.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),h<128?f[b++]=h:(h<2048?f[b++]=192|h>>>6:(h<65536?f[b++]=224|h>>>12:(f[b++]=240|h>>>18,f[b++]=128|h>>>12&63),f[b++]=128|h>>>6&63),f[b++]=128|63&h);return f},i.buf2binstring=function(d){return u(d,d.length)},i.binstring2buf=function(d){for(var f=new s.Buf8(d.length),h=0,p=f.length;h<p;h++)f[h]=d.charCodeAt(h);return f},i.buf2string=function(d,f){var h,p,m,b,_=f||d.length,v=new Array(2*_);for(h=p=0;h<_;)if((m=d[h++])<128)v[p++]=m;else if(4<(b=c[m]))v[p++]=65533,h+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&h<_;)m=m<<6|63&d[h++],b--;1<b?v[p++]=65533:m<65536?v[p++]=m:(m-=65536,v[p++]=55296|m>>10&1023,v[p++]=56320|1023&m)}return u(v,p)},i.utf8border=function(d,f){var h;for((f=f||d.length)>d.length&&(f=d.length),h=f-1;0<=h&&(192&d[h])==128;)h--;return h<0||h===0?f:h+c[d[h]]>f?h:f}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,d=0;a!==0;){for(a-=d=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--d;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,d=l+c;o^=-1;for(var f=l;f<d;f++)o=o>>>8^u[255&(o^a[f])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),d=0,f=4,h=0,p=-2,m=-1,b=4,_=2,v=8,T=9,A=286,C=30,R=19,S=2*A+1,U=15,I=3,P=258,W=P+I+1,L=42,N=113,E=1,D=2,Z=3,$=4;function st(k,ot){return k.msg=u[ot],ot}function rt(k){return(k<<1)-(4<k?9:0)}function at(k){for(var ot=k.length;0<=--ot;)k[ot]=0}function Y(k){var ot=k.state,et=ot.pending;et>k.avail_out&&(et=k.avail_out),et!==0&&(o.arraySet(k.output,ot.pending_buf,ot.pending_out,et,k.next_out),k.next_out+=et,ot.pending_out+=et,k.total_out+=et,k.avail_out-=et,ot.pending-=et,ot.pending===0&&(ot.pending_out=0))}function H(k,ot){a._tr_flush_block(k,0<=k.block_start?k.block_start:-1,k.strstart-k.block_start,ot),k.block_start=k.strstart,Y(k.strm)}function wt(k,ot){k.pending_buf[k.pending++]=ot}function lt(k,ot){k.pending_buf[k.pending++]=ot>>>8&255,k.pending_buf[k.pending++]=255&ot}function ht(k,ot){var et,B,F=k.max_chain_length,V=k.strstart,ct=k.prev_length,ft=k.nice_match,J=k.strstart>k.w_size-W?k.strstart-(k.w_size-W):0,mt=k.window,xt=k.w_mask,pt=k.prev,St=k.strstart+P,fe=mt[V+ct-1],$t=mt[V+ct];k.prev_length>=k.good_match&&(F>>=2),ft>k.lookahead&&(ft=k.lookahead);do if(mt[(et=ot)+ct]===$t&&mt[et+ct-1]===fe&&mt[et]===mt[V]&&mt[++et]===mt[V+1]){V+=2,et++;do;while(mt[++V]===mt[++et]&&mt[++V]===mt[++et]&&mt[++V]===mt[++et]&&mt[++V]===mt[++et]&&mt[++V]===mt[++et]&&mt[++V]===mt[++et]&&mt[++V]===mt[++et]&&mt[++V]===mt[++et]&&V<St);if(B=P-(St-V),V=St-P,ct<B){if(k.match_start=ot,ft<=(ct=B))break;fe=mt[V+ct-1],$t=mt[V+ct]}}while((ot=pt[ot&xt])>J&&--F!=0);return ct<=k.lookahead?ct:k.lookahead}function jt(k){var ot,et,B,F,V,ct,ft,J,mt,xt,pt=k.w_size;do{if(F=k.window_size-k.lookahead-k.strstart,k.strstart>=pt+(pt-W)){for(o.arraySet(k.window,k.window,pt,pt,0),k.match_start-=pt,k.strstart-=pt,k.block_start-=pt,ot=et=k.hash_size;B=k.head[--ot],k.head[ot]=pt<=B?B-pt:0,--et;);for(ot=et=pt;B=k.prev[--ot],k.prev[ot]=pt<=B?B-pt:0,--et;);F+=pt}if(k.strm.avail_in===0)break;if(ct=k.strm,ft=k.window,J=k.strstart+k.lookahead,mt=F,xt=void 0,xt=ct.avail_in,mt<xt&&(xt=mt),et=xt===0?0:(ct.avail_in-=xt,o.arraySet(ft,ct.input,ct.next_in,xt,J),ct.state.wrap===1?ct.adler=c(ct.adler,ft,xt,J):ct.state.wrap===2&&(ct.adler=l(ct.adler,ft,xt,J)),ct.next_in+=xt,ct.total_in+=xt,xt),k.lookahead+=et,k.lookahead+k.insert>=I)for(V=k.strstart-k.insert,k.ins_h=k.window[V],k.ins_h=(k.ins_h<<k.hash_shift^k.window[V+1])&k.hash_mask;k.insert&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[V+I-1])&k.hash_mask,k.prev[V&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=V,V++,k.insert--,!(k.lookahead+k.insert<I)););}while(k.lookahead<W&&k.strm.avail_in!==0)}function ie(k,ot){for(var et,B;;){if(k.lookahead<W){if(jt(k),k.lookahead<W&&ot===d)return E;if(k.lookahead===0)break}if(et=0,k.lookahead>=I&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+I-1])&k.hash_mask,et=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),et!==0&&k.strstart-et<=k.w_size-W&&(k.match_length=ht(k,et)),k.match_length>=I)if(B=a._tr_tally(k,k.strstart-k.match_start,k.match_length-I),k.lookahead-=k.match_length,k.match_length<=k.max_lazy_match&&k.lookahead>=I){for(k.match_length--;k.strstart++,k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+I-1])&k.hash_mask,et=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart,--k.match_length!=0;);k.strstart++}else k.strstart+=k.match_length,k.match_length=0,k.ins_h=k.window[k.strstart],k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+1])&k.hash_mask;else B=a._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++;if(B&&(H(k,!1),k.strm.avail_out===0))return E}return k.insert=k.strstart<I-1?k.strstart:I-1,ot===f?(H(k,!0),k.strm.avail_out===0?Z:$):k.last_lit&&(H(k,!1),k.strm.avail_out===0)?E:D}function Dt(k,ot){for(var et,B,F;;){if(k.lookahead<W){if(jt(k),k.lookahead<W&&ot===d)return E;if(k.lookahead===0)break}if(et=0,k.lookahead>=I&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+I-1])&k.hash_mask,et=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),k.prev_length=k.match_length,k.prev_match=k.match_start,k.match_length=I-1,et!==0&&k.prev_length<k.max_lazy_match&&k.strstart-et<=k.w_size-W&&(k.match_length=ht(k,et),k.match_length<=5&&(k.strategy===1||k.match_length===I&&4096<k.strstart-k.match_start)&&(k.match_length=I-1)),k.prev_length>=I&&k.match_length<=k.prev_length){for(F=k.strstart+k.lookahead-I,B=a._tr_tally(k,k.strstart-1-k.prev_match,k.prev_length-I),k.lookahead-=k.prev_length-1,k.prev_length-=2;++k.strstart<=F&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+I-1])&k.hash_mask,et=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),--k.prev_length!=0;);if(k.match_available=0,k.match_length=I-1,k.strstart++,B&&(H(k,!1),k.strm.avail_out===0))return E}else if(k.match_available){if((B=a._tr_tally(k,0,k.window[k.strstart-1]))&&H(k,!1),k.strstart++,k.lookahead--,k.strm.avail_out===0)return E}else k.match_available=1,k.strstart++,k.lookahead--}return k.match_available&&(B=a._tr_tally(k,0,k.window[k.strstart-1]),k.match_available=0),k.insert=k.strstart<I-1?k.strstart:I-1,ot===f?(H(k,!0),k.strm.avail_out===0?Z:$):k.last_lit&&(H(k,!1),k.strm.avail_out===0)?E:D}function Bt(k,ot,et,B,F){this.good_length=k,this.max_lazy=ot,this.nice_length=et,this.max_chain=B,this.func=F}function ae(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*S),this.dyn_dtree=new o.Buf16(2*(2*C+1)),this.bl_tree=new o.Buf16(2*(2*R+1)),at(this.dyn_ltree),at(this.dyn_dtree),at(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(U+1),this.heap=new o.Buf16(2*A+1),at(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),at(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Yt(k){var ot;return k&&k.state?(k.total_in=k.total_out=0,k.data_type=_,(ot=k.state).pending=0,ot.pending_out=0,ot.wrap<0&&(ot.wrap=-ot.wrap),ot.status=ot.wrap?L:N,k.adler=ot.wrap===2?0:1,ot.last_flush=d,a._tr_init(ot),h):st(k,p)}function Ie(k){var ot=Yt(k);return ot===h&&function(et){et.window_size=2*et.w_size,at(et.head),et.max_lazy_match=s[et.level].max_lazy,et.good_match=s[et.level].good_length,et.nice_match=s[et.level].nice_length,et.max_chain_length=s[et.level].max_chain,et.strstart=0,et.block_start=0,et.lookahead=0,et.insert=0,et.match_length=et.prev_length=I-1,et.match_available=0,et.ins_h=0}(k.state),ot}function $e(k,ot,et,B,F,V){if(!k)return p;var ct=1;if(ot===m&&(ot=6),B<0?(ct=0,B=-B):15<B&&(ct=2,B-=16),F<1||T<F||et!==v||B<8||15<B||ot<0||9<ot||V<0||b<V)return st(k,p);B===8&&(B=9);var ft=new ae;return(k.state=ft).strm=k,ft.wrap=ct,ft.gzhead=null,ft.w_bits=B,ft.w_size=1<<ft.w_bits,ft.w_mask=ft.w_size-1,ft.hash_bits=F+7,ft.hash_size=1<<ft.hash_bits,ft.hash_mask=ft.hash_size-1,ft.hash_shift=~~((ft.hash_bits+I-1)/I),ft.window=new o.Buf8(2*ft.w_size),ft.head=new o.Buf16(ft.hash_size),ft.prev=new o.Buf16(ft.w_size),ft.lit_bufsize=1<<F+6,ft.pending_buf_size=4*ft.lit_bufsize,ft.pending_buf=new o.Buf8(ft.pending_buf_size),ft.d_buf=1*ft.lit_bufsize,ft.l_buf=3*ft.lit_bufsize,ft.level=ot,ft.strategy=V,ft.method=et,Ie(k)}s=[new Bt(0,0,0,0,function(k,ot){var et=65535;for(et>k.pending_buf_size-5&&(et=k.pending_buf_size-5);;){if(k.lookahead<=1){if(jt(k),k.lookahead===0&&ot===d)return E;if(k.lookahead===0)break}k.strstart+=k.lookahead,k.lookahead=0;var B=k.block_start+et;if((k.strstart===0||k.strstart>=B)&&(k.lookahead=k.strstart-B,k.strstart=B,H(k,!1),k.strm.avail_out===0)||k.strstart-k.block_start>=k.w_size-W&&(H(k,!1),k.strm.avail_out===0))return E}return k.insert=0,ot===f?(H(k,!0),k.strm.avail_out===0?Z:$):(k.strstart>k.block_start&&(H(k,!1),k.strm.avail_out),E)}),new Bt(4,4,8,4,ie),new Bt(4,5,16,8,ie),new Bt(4,6,32,32,ie),new Bt(4,4,16,16,Dt),new Bt(8,16,32,32,Dt),new Bt(8,16,128,128,Dt),new Bt(8,32,128,256,Dt),new Bt(32,128,258,1024,Dt),new Bt(32,258,258,4096,Dt)],i.deflateInit=function(k,ot){return $e(k,ot,v,15,8,0)},i.deflateInit2=$e,i.deflateReset=Ie,i.deflateResetKeep=Yt,i.deflateSetHeader=function(k,ot){return k&&k.state?k.state.wrap!==2?p:(k.state.gzhead=ot,h):p},i.deflate=function(k,ot){var et,B,F,V;if(!k||!k.state||5<ot||ot<0)return k?st(k,p):p;if(B=k.state,!k.output||!k.input&&k.avail_in!==0||B.status===666&&ot!==f)return st(k,k.avail_out===0?-5:p);if(B.strm=k,et=B.last_flush,B.last_flush=ot,B.status===L)if(B.wrap===2)k.adler=0,wt(B,31),wt(B,139),wt(B,8),B.gzhead?(wt(B,(B.gzhead.text?1:0)+(B.gzhead.hcrc?2:0)+(B.gzhead.extra?4:0)+(B.gzhead.name?8:0)+(B.gzhead.comment?16:0)),wt(B,255&B.gzhead.time),wt(B,B.gzhead.time>>8&255),wt(B,B.gzhead.time>>16&255),wt(B,B.gzhead.time>>24&255),wt(B,B.level===9?2:2<=B.strategy||B.level<2?4:0),wt(B,255&B.gzhead.os),B.gzhead.extra&&B.gzhead.extra.length&&(wt(B,255&B.gzhead.extra.length),wt(B,B.gzhead.extra.length>>8&255)),B.gzhead.hcrc&&(k.adler=l(k.adler,B.pending_buf,B.pending,0)),B.gzindex=0,B.status=69):(wt(B,0),wt(B,0),wt(B,0),wt(B,0),wt(B,0),wt(B,B.level===9?2:2<=B.strategy||B.level<2?4:0),wt(B,3),B.status=N);else{var ct=v+(B.w_bits-8<<4)<<8;ct|=(2<=B.strategy||B.level<2?0:B.level<6?1:B.level===6?2:3)<<6,B.strstart!==0&&(ct|=32),ct+=31-ct%31,B.status=N,lt(B,ct),B.strstart!==0&&(lt(B,k.adler>>>16),lt(B,65535&k.adler)),k.adler=1}if(B.status===69)if(B.gzhead.extra){for(F=B.pending;B.gzindex<(65535&B.gzhead.extra.length)&&(B.pending!==B.pending_buf_size||(B.gzhead.hcrc&&B.pending>F&&(k.adler=l(k.adler,B.pending_buf,B.pending-F,F)),Y(k),F=B.pending,B.pending!==B.pending_buf_size));)wt(B,255&B.gzhead.extra[B.gzindex]),B.gzindex++;B.gzhead.hcrc&&B.pending>F&&(k.adler=l(k.adler,B.pending_buf,B.pending-F,F)),B.gzindex===B.gzhead.extra.length&&(B.gzindex=0,B.status=73)}else B.status=73;if(B.status===73)if(B.gzhead.name){F=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>F&&(k.adler=l(k.adler,B.pending_buf,B.pending-F,F)),Y(k),F=B.pending,B.pending===B.pending_buf_size)){V=1;break}V=B.gzindex<B.gzhead.name.length?255&B.gzhead.name.charCodeAt(B.gzindex++):0,wt(B,V)}while(V!==0);B.gzhead.hcrc&&B.pending>F&&(k.adler=l(k.adler,B.pending_buf,B.pending-F,F)),V===0&&(B.gzindex=0,B.status=91)}else B.status=91;if(B.status===91)if(B.gzhead.comment){F=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>F&&(k.adler=l(k.adler,B.pending_buf,B.pending-F,F)),Y(k),F=B.pending,B.pending===B.pending_buf_size)){V=1;break}V=B.gzindex<B.gzhead.comment.length?255&B.gzhead.comment.charCodeAt(B.gzindex++):0,wt(B,V)}while(V!==0);B.gzhead.hcrc&&B.pending>F&&(k.adler=l(k.adler,B.pending_buf,B.pending-F,F)),V===0&&(B.status=103)}else B.status=103;if(B.status===103&&(B.gzhead.hcrc?(B.pending+2>B.pending_buf_size&&Y(k),B.pending+2<=B.pending_buf_size&&(wt(B,255&k.adler),wt(B,k.adler>>8&255),k.adler=0,B.status=N)):B.status=N),B.pending!==0){if(Y(k),k.avail_out===0)return B.last_flush=-1,h}else if(k.avail_in===0&&rt(ot)<=rt(et)&&ot!==f)return st(k,-5);if(B.status===666&&k.avail_in!==0)return st(k,-5);if(k.avail_in!==0||B.lookahead!==0||ot!==d&&B.status!==666){var ft=B.strategy===2?function(J,mt){for(var xt;;){if(J.lookahead===0&&(jt(J),J.lookahead===0)){if(mt===d)return E;break}if(J.match_length=0,xt=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++,xt&&(H(J,!1),J.strm.avail_out===0))return E}return J.insert=0,mt===f?(H(J,!0),J.strm.avail_out===0?Z:$):J.last_lit&&(H(J,!1),J.strm.avail_out===0)?E:D}(B,ot):B.strategy===3?function(J,mt){for(var xt,pt,St,fe,$t=J.window;;){if(J.lookahead<=P){if(jt(J),J.lookahead<=P&&mt===d)return E;if(J.lookahead===0)break}if(J.match_length=0,J.lookahead>=I&&0<J.strstart&&(pt=$t[St=J.strstart-1])===$t[++St]&&pt===$t[++St]&&pt===$t[++St]){fe=J.strstart+P;do;while(pt===$t[++St]&&pt===$t[++St]&&pt===$t[++St]&&pt===$t[++St]&&pt===$t[++St]&&pt===$t[++St]&&pt===$t[++St]&&pt===$t[++St]&&St<fe);J.match_length=P-(fe-St),J.match_length>J.lookahead&&(J.match_length=J.lookahead)}if(J.match_length>=I?(xt=a._tr_tally(J,1,J.match_length-I),J.lookahead-=J.match_length,J.strstart+=J.match_length,J.match_length=0):(xt=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++),xt&&(H(J,!1),J.strm.avail_out===0))return E}return J.insert=0,mt===f?(H(J,!0),J.strm.avail_out===0?Z:$):J.last_lit&&(H(J,!1),J.strm.avail_out===0)?E:D}(B,ot):s[B.level].func(B,ot);if(ft!==Z&&ft!==$||(B.status=666),ft===E||ft===Z)return k.avail_out===0&&(B.last_flush=-1),h;if(ft===D&&(ot===1?a._tr_align(B):ot!==5&&(a._tr_stored_block(B,0,0,!1),ot===3&&(at(B.head),B.lookahead===0&&(B.strstart=0,B.block_start=0,B.insert=0))),Y(k),k.avail_out===0))return B.last_flush=-1,h}return ot!==f?h:B.wrap<=0?1:(B.wrap===2?(wt(B,255&k.adler),wt(B,k.adler>>8&255),wt(B,k.adler>>16&255),wt(B,k.adler>>24&255),wt(B,255&k.total_in),wt(B,k.total_in>>8&255),wt(B,k.total_in>>16&255),wt(B,k.total_in>>24&255)):(lt(B,k.adler>>>16),lt(B,65535&k.adler)),Y(k),0<B.wrap&&(B.wrap=-B.wrap),B.pending!==0?h:1)},i.deflateEnd=function(k){var ot;return k&&k.state?(ot=k.state.status)!==L&&ot!==69&&ot!==73&&ot!==91&&ot!==103&&ot!==N&&ot!==666?st(k,p):(k.state=null,ot===N?st(k,-3):h):p},i.deflateSetDictionary=function(k,ot){var et,B,F,V,ct,ft,J,mt,xt=ot.length;if(!k||!k.state||(V=(et=k.state).wrap)===2||V===1&&et.status!==L||et.lookahead)return p;for(V===1&&(k.adler=c(k.adler,ot,xt,0)),et.wrap=0,xt>=et.w_size&&(V===0&&(at(et.head),et.strstart=0,et.block_start=0,et.insert=0),mt=new o.Buf8(et.w_size),o.arraySet(mt,ot,xt-et.w_size,et.w_size,0),ot=mt,xt=et.w_size),ct=k.avail_in,ft=k.next_in,J=k.input,k.avail_in=xt,k.next_in=0,k.input=ot,jt(et);et.lookahead>=I;){for(B=et.strstart,F=et.lookahead-(I-1);et.ins_h=(et.ins_h<<et.hash_shift^et.window[B+I-1])&et.hash_mask,et.prev[B&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=B,B++,--F;);et.strstart=B,et.lookahead=I-1,jt(et)}return et.strstart+=et.lookahead,et.block_start=et.strstart,et.insert=et.lookahead,et.lookahead=0,et.match_length=et.prev_length=I-1,et.match_available=0,k.next_in=ft,k.input=J,k.avail_in=ct,et.wrap=V,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,d,f,h,p,m,b,_,v,T,A,C,R,S,U,I,P,W,L,N,E,D;a=s.state,c=s.next_in,E=s.input,l=c+(s.avail_in-5),u=s.next_out,D=s.output,d=u-(o-s.avail_out),f=u+(s.avail_out-257),h=a.dmax,p=a.wsize,m=a.whave,b=a.wnext,_=a.window,v=a.hold,T=a.bits,A=a.lencode,C=a.distcode,R=(1<<a.lenbits)-1,S=(1<<a.distbits)-1;t:do{T<15&&(v+=E[c++]<<T,T+=8,v+=E[c++]<<T,T+=8),U=A[v&R];e:for(;;){if(v>>>=I=U>>>24,T-=I,(I=U>>>16&255)===0)D[u++]=65535&U;else{if(!(16&I)){if(!(64&I)){U=A[(65535&U)+(v&(1<<I)-1)];continue e}if(32&I){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}P=65535&U,(I&=15)&&(T<I&&(v+=E[c++]<<T,T+=8),P+=v&(1<<I)-1,v>>>=I,T-=I),T<15&&(v+=E[c++]<<T,T+=8,v+=E[c++]<<T,T+=8),U=C[v&S];n:for(;;){if(v>>>=I=U>>>24,T-=I,!(16&(I=U>>>16&255))){if(!(64&I)){U=C[(65535&U)+(v&(1<<I)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(W=65535&U,T<(I&=15)&&(v+=E[c++]<<T,(T+=8)<I&&(v+=E[c++]<<T,T+=8)),h<(W+=v&(1<<I)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(v>>>=I,T-=I,(I=u-d)<W){if(m<(I=W-I)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(N=_,(L=0)===b){if(L+=p-I,I<P){for(P-=I;D[u++]=_[L++],--I;);L=u-W,N=D}}else if(b<I){if(L+=p+b-I,(I-=b)<P){for(P-=I;D[u++]=_[L++],--I;);if(L=0,b<P){for(P-=I=b;D[u++]=_[L++],--I;);L=u-W,N=D}}}else if(L+=b-I,I<P){for(P-=I;D[u++]=_[L++],--I;);L=u-W,N=D}for(;2<P;)D[u++]=N[L++],D[u++]=N[L++],D[u++]=N[L++],P-=3;P&&(D[u++]=N[L++],1<P&&(D[u++]=N[L++]))}else{for(L=u-W;D[u++]=D[L++],D[u++]=D[L++],D[u++]=D[L++],2<(P-=3););P&&(D[u++]=D[L++],1<P&&(D[u++]=D[L++]))}break}}break}}while(c<l&&u<f);c-=P=T>>3,v&=(1<<(T-=P<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<f?f-u+257:257-(u-f),a.hold=v,a.bits=T}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,d=2,f=0,h=-2,p=1,m=852,b=592;function _(L){return(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(L){var N;return L&&L.state?(N=L.state,L.total_in=L.total_out=N.total=0,L.msg="",N.wrap&&(L.adler=1&N.wrap),N.mode=p,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new s.Buf32(m),N.distcode=N.distdyn=new s.Buf32(b),N.sane=1,N.back=-1,f):h}function A(L){var N;return L&&L.state?((N=L.state).wsize=0,N.whave=0,N.wnext=0,T(L)):h}function C(L,N){var E,D;return L&&L.state?(D=L.state,N<0?(E=0,N=-N):(E=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?h:(D.window!==null&&D.wbits!==N&&(D.window=null),D.wrap=E,D.wbits=N,A(L))):h}function R(L,N){var E,D;return L?(D=new v,(L.state=D).window=null,(E=C(L,N))!==f&&(L.state=null),E):h}var S,U,I=!0;function P(L){if(I){var N;for(S=new s.Buf32(512),U=new s.Buf32(32),N=0;N<144;)L.lens[N++]=8;for(;N<256;)L.lens[N++]=9;for(;N<280;)L.lens[N++]=7;for(;N<288;)L.lens[N++]=8;for(l(u,L.lens,0,288,S,0,L.work,{bits:9}),N=0;N<32;)L.lens[N++]=5;l(d,L.lens,0,32,U,0,L.work,{bits:5}),I=!1}L.lencode=S,L.lenbits=9,L.distcode=U,L.distbits=5}function W(L,N,E,D){var Z,$=L.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new s.Buf8($.wsize)),D>=$.wsize?(s.arraySet($.window,N,E-$.wsize,$.wsize,0),$.wnext=0,$.whave=$.wsize):(D<(Z=$.wsize-$.wnext)&&(Z=D),s.arraySet($.window,N,E-D,Z,$.wnext),(D-=Z)?(s.arraySet($.window,N,E-D,D,0),$.wnext=D,$.whave=$.wsize):($.wnext+=Z,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=Z))),0}i.inflateReset=A,i.inflateReset2=C,i.inflateResetKeep=T,i.inflateInit=function(L){return R(L,15)},i.inflateInit2=R,i.inflate=function(L,N){var E,D,Z,$,st,rt,at,Y,H,wt,lt,ht,jt,ie,Dt,Bt,ae,Yt,Ie,$e,k,ot,et,B,F=0,V=new s.Buf8(4),ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!L||!L.state||!L.output||!L.input&&L.avail_in!==0)return h;(E=L.state).mode===12&&(E.mode=13),st=L.next_out,Z=L.output,at=L.avail_out,$=L.next_in,D=L.input,rt=L.avail_in,Y=E.hold,H=E.bits,wt=rt,lt=at,ot=f;t:for(;;)switch(E.mode){case p:if(E.wrap===0){E.mode=13;break}for(;H<16;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}if(2&E.wrap&&Y===35615){V[E.check=0]=255&Y,V[1]=Y>>>8&255,E.check=a(E.check,V,2,0),H=Y=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&Y)<<8)+(Y>>8))%31){L.msg="incorrect header check",E.mode=30;break}if((15&Y)!=8){L.msg="unknown compression method",E.mode=30;break}if(H-=4,k=8+(15&(Y>>>=4)),E.wbits===0)E.wbits=k;else if(k>E.wbits){L.msg="invalid window size",E.mode=30;break}E.dmax=1<<k,L.adler=E.check=1,E.mode=512&Y?10:12,H=Y=0;break;case 2:for(;H<16;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}if(E.flags=Y,(255&E.flags)!=8){L.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){L.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=Y>>8&1),512&E.flags&&(V[0]=255&Y,V[1]=Y>>>8&255,E.check=a(E.check,V,2,0)),H=Y=0,E.mode=3;case 3:for(;H<32;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}E.head&&(E.head.time=Y),512&E.flags&&(V[0]=255&Y,V[1]=Y>>>8&255,V[2]=Y>>>16&255,V[3]=Y>>>24&255,E.check=a(E.check,V,4,0)),H=Y=0,E.mode=4;case 4:for(;H<16;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}E.head&&(E.head.xflags=255&Y,E.head.os=Y>>8),512&E.flags&&(V[0]=255&Y,V[1]=Y>>>8&255,E.check=a(E.check,V,2,0)),H=Y=0,E.mode=5;case 5:if(1024&E.flags){for(;H<16;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}E.length=Y,E.head&&(E.head.extra_len=Y),512&E.flags&&(V[0]=255&Y,V[1]=Y>>>8&255,E.check=a(E.check,V,2,0)),H=Y=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(rt<(ht=E.length)&&(ht=rt),ht&&(E.head&&(k=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),s.arraySet(E.head.extra,D,$,ht,k)),512&E.flags&&(E.check=a(E.check,D,ht,$)),rt-=ht,$+=ht,E.length-=ht),E.length))break t;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(rt===0)break t;for(ht=0;k=D[$+ht++],E.head&&k&&E.length<65536&&(E.head.name+=String.fromCharCode(k)),k&&ht<rt;);if(512&E.flags&&(E.check=a(E.check,D,ht,$)),rt-=ht,$+=ht,k)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(rt===0)break t;for(ht=0;k=D[$+ht++],E.head&&k&&E.length<65536&&(E.head.comment+=String.fromCharCode(k)),k&&ht<rt;);if(512&E.flags&&(E.check=a(E.check,D,ht,$)),rt-=ht,$+=ht,k)break t}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;H<16;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}if(Y!==(65535&E.check)){L.msg="header crc mismatch",E.mode=30;break}H=Y=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),L.adler=E.check=0,E.mode=12;break;case 10:for(;H<32;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}L.adler=E.check=_(Y),H=Y=0,E.mode=11;case 11:if(E.havedict===0)return L.next_out=st,L.avail_out=at,L.next_in=$,L.avail_in=rt,E.hold=Y,E.bits=H,2;L.adler=E.check=1,E.mode=12;case 12:if(N===5||N===6)break t;case 13:if(E.last){Y>>>=7&H,H-=7&H,E.mode=27;break}for(;H<3;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}switch(E.last=1&Y,H-=1,3&(Y>>>=1)){case 0:E.mode=14;break;case 1:if(P(E),E.mode=20,N!==6)break;Y>>>=2,H-=2;break t;case 2:E.mode=17;break;case 3:L.msg="invalid block type",E.mode=30}Y>>>=2,H-=2;break;case 14:for(Y>>>=7&H,H-=7&H;H<32;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}if((65535&Y)!=(Y>>>16^65535)){L.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&Y,H=Y=0,E.mode=15,N===6)break t;case 15:E.mode=16;case 16:if(ht=E.length){if(rt<ht&&(ht=rt),at<ht&&(ht=at),ht===0)break t;s.arraySet(Z,D,$,ht,st),rt-=ht,$+=ht,at-=ht,st+=ht,E.length-=ht;break}E.mode=12;break;case 17:for(;H<14;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}if(E.nlen=257+(31&Y),Y>>>=5,H-=5,E.ndist=1+(31&Y),Y>>>=5,H-=5,E.ncode=4+(15&Y),Y>>>=4,H-=4,286<E.nlen||30<E.ndist){L.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;H<3;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}E.lens[ct[E.have++]]=7&Y,Y>>>=3,H-=3}for(;E.have<19;)E.lens[ct[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,et={bits:E.lenbits},ot=l(0,E.lens,0,19,E.lencode,0,E.work,et),E.lenbits=et.bits,ot){L.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;Bt=(F=E.lencode[Y&(1<<E.lenbits)-1])>>>16&255,ae=65535&F,!((Dt=F>>>24)<=H);){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}if(ae<16)Y>>>=Dt,H-=Dt,E.lens[E.have++]=ae;else{if(ae===16){for(B=Dt+2;H<B;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}if(Y>>>=Dt,H-=Dt,E.have===0){L.msg="invalid bit length repeat",E.mode=30;break}k=E.lens[E.have-1],ht=3+(3&Y),Y>>>=2,H-=2}else if(ae===17){for(B=Dt+3;H<B;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}H-=Dt,k=0,ht=3+(7&(Y>>>=Dt)),Y>>>=3,H-=3}else{for(B=Dt+7;H<B;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}H-=Dt,k=0,ht=11+(127&(Y>>>=Dt)),Y>>>=7,H-=7}if(E.have+ht>E.nlen+E.ndist){L.msg="invalid bit length repeat",E.mode=30;break}for(;ht--;)E.lens[E.have++]=k}}if(E.mode===30)break;if(E.lens[256]===0){L.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,et={bits:E.lenbits},ot=l(u,E.lens,0,E.nlen,E.lencode,0,E.work,et),E.lenbits=et.bits,ot){L.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,et={bits:E.distbits},ot=l(d,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,et),E.distbits=et.bits,ot){L.msg="invalid distances set",E.mode=30;break}if(E.mode=20,N===6)break t;case 20:E.mode=21;case 21:if(6<=rt&&258<=at){L.next_out=st,L.avail_out=at,L.next_in=$,L.avail_in=rt,E.hold=Y,E.bits=H,c(L,lt),st=L.next_out,Z=L.output,at=L.avail_out,$=L.next_in,D=L.input,rt=L.avail_in,Y=E.hold,H=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;Bt=(F=E.lencode[Y&(1<<E.lenbits)-1])>>>16&255,ae=65535&F,!((Dt=F>>>24)<=H);){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}if(Bt&&!(240&Bt)){for(Yt=Dt,Ie=Bt,$e=ae;Bt=(F=E.lencode[$e+((Y&(1<<Yt+Ie)-1)>>Yt)])>>>16&255,ae=65535&F,!(Yt+(Dt=F>>>24)<=H);){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}Y>>>=Yt,H-=Yt,E.back+=Yt}if(Y>>>=Dt,H-=Dt,E.back+=Dt,E.length=ae,Bt===0){E.mode=26;break}if(32&Bt){E.back=-1,E.mode=12;break}if(64&Bt){L.msg="invalid literal/length code",E.mode=30;break}E.extra=15&Bt,E.mode=22;case 22:if(E.extra){for(B=E.extra;H<B;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}E.length+=Y&(1<<E.extra)-1,Y>>>=E.extra,H-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;Bt=(F=E.distcode[Y&(1<<E.distbits)-1])>>>16&255,ae=65535&F,!((Dt=F>>>24)<=H);){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}if(!(240&Bt)){for(Yt=Dt,Ie=Bt,$e=ae;Bt=(F=E.distcode[$e+((Y&(1<<Yt+Ie)-1)>>Yt)])>>>16&255,ae=65535&F,!(Yt+(Dt=F>>>24)<=H);){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}Y>>>=Yt,H-=Yt,E.back+=Yt}if(Y>>>=Dt,H-=Dt,E.back+=Dt,64&Bt){L.msg="invalid distance code",E.mode=30;break}E.offset=ae,E.extra=15&Bt,E.mode=24;case 24:if(E.extra){for(B=E.extra;H<B;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}E.offset+=Y&(1<<E.extra)-1,Y>>>=E.extra,H-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){L.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(at===0)break t;if(ht=lt-at,E.offset>ht){if((ht=E.offset-ht)>E.whave&&E.sane){L.msg="invalid distance too far back",E.mode=30;break}jt=ht>E.wnext?(ht-=E.wnext,E.wsize-ht):E.wnext-ht,ht>E.length&&(ht=E.length),ie=E.window}else ie=Z,jt=st-E.offset,ht=E.length;for(at<ht&&(ht=at),at-=ht,E.length-=ht;Z[st++]=ie[jt++],--ht;);E.length===0&&(E.mode=21);break;case 26:if(at===0)break t;Z[st++]=E.length,at--,E.mode=21;break;case 27:if(E.wrap){for(;H<32;){if(rt===0)break t;rt--,Y|=D[$++]<<H,H+=8}if(lt-=at,L.total_out+=lt,E.total+=lt,lt&&(L.adler=E.check=E.flags?a(E.check,Z,lt,st-lt):o(E.check,Z,lt,st-lt)),lt=at,(E.flags?Y:_(Y))!==E.check){L.msg="incorrect data check",E.mode=30;break}H=Y=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;H<32;){if(rt===0)break t;rt--,Y+=D[$++]<<H,H+=8}if(Y!==(4294967295&E.total)){L.msg="incorrect length check",E.mode=30;break}H=Y=0}E.mode=29;case 29:ot=1;break t;case 30:ot=-3;break t;case 31:return-4;case 32:default:return h}return L.next_out=st,L.avail_out=at,L.next_in=$,L.avail_in=rt,E.hold=Y,E.bits=H,(E.wsize||lt!==L.avail_out&&E.mode<30&&(E.mode<27||N!==4))&&W(L,L.output,L.next_out,lt-L.avail_out)?(E.mode=31,-4):(wt-=L.avail_in,lt-=L.avail_out,L.total_in+=wt,L.total_out+=lt,E.total+=lt,E.wrap&&lt&&(L.adler=E.check=E.flags?a(E.check,Z,lt,L.next_out-lt):o(E.check,Z,lt,L.next_out-lt)),L.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(wt==0&&lt===0||N===4)&&ot===f&&(ot=-5),ot)},i.inflateEnd=function(L){if(!L||!L.state)return h;var N=L.state;return N.window&&(N.window=null),L.state=null,f},i.inflateGetHeader=function(L,N){var E;return L&&L.state&&2&(E=L.state).wrap?((E.head=N).done=!1,f):h},i.inflateSetDictionary=function(L,N){var E,D=N.length;return L&&L.state?(E=L.state).wrap!==0&&E.mode!==11?h:E.mode===11&&o(1,N,D,0)!==E.check?-3:W(L,N,D,D)?(E.mode=31,-4):(E.havedict=1,f):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,d,f,h,p,m,b,_){var v,T,A,C,R,S,U,I,P,W=_.bits,L=0,N=0,E=0,D=0,Z=0,$=0,st=0,rt=0,at=0,Y=0,H=null,wt=0,lt=new s.Buf16(16),ht=new s.Buf16(16),jt=null,ie=0;for(L=0;L<=15;L++)lt[L]=0;for(N=0;N<h;N++)lt[d[f+N]]++;for(Z=W,D=15;1<=D&&lt[D]===0;D--);if(D<Z&&(Z=D),D===0)return p[m++]=20971520,p[m++]=20971520,_.bits=1,0;for(E=1;E<D&&lt[E]===0;E++);for(Z<E&&(Z=E),L=rt=1;L<=15;L++)if(rt<<=1,(rt-=lt[L])<0)return-1;if(0<rt&&(u===0||D!==1))return-1;for(ht[1]=0,L=1;L<15;L++)ht[L+1]=ht[L]+lt[L];for(N=0;N<h;N++)d[f+N]!==0&&(b[ht[d[f+N]]++]=N);if(S=u===0?(H=jt=b,19):u===1?(H=o,wt-=257,jt=a,ie-=257,256):(H=c,jt=l,-1),L=E,R=m,st=N=Y=0,A=-1,C=(at=1<<($=Z))-1,u===1&&852<at||u===2&&592<at)return 1;for(;;){for(U=L-st,P=b[N]<S?(I=0,b[N]):b[N]>S?(I=jt[ie+b[N]],H[wt+b[N]]):(I=96,0),v=1<<L-st,E=T=1<<$;p[R+(Y>>st)+(T-=v)]=U<<24|I<<16|P|0,T!==0;);for(v=1<<L-1;Y&v;)v>>=1;if(v!==0?(Y&=v-1,Y+=v):Y=0,N++,--lt[L]==0){if(L===D)break;L=d[f+b[N]]}if(Z<L&&(Y&C)!==A){for(st===0&&(st=Z),R+=E,rt=1<<($=L-st);$+st<D&&!((rt-=lt[$+st])<=0);)$++,rt<<=1;if(at+=1<<$,u===1&&852<at||u===2&&592<at)return 1;p[A=Y&C]=Z<<24|$<<16|R-m|0}}return Y!==0&&(p[R+Y]=L-st<<24|64<<16|0),_.bits=Z,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(F){for(var V=F.length;0<=--V;)F[V]=0}var l=0,u=29,d=256,f=d+1+u,h=30,p=19,m=2*f+1,b=15,_=16,v=7,T=256,A=16,C=17,R=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],W=new Array(2*(f+2));c(W);var L=new Array(2*h);c(L);var N=new Array(512);c(N);var E=new Array(256);c(E);var D=new Array(u);c(D);var Z,$,st,rt=new Array(h);function at(F,V,ct,ft,J){this.static_tree=F,this.extra_bits=V,this.extra_base=ct,this.elems=ft,this.max_length=J,this.has_stree=F&&F.length}function Y(F,V){this.dyn_tree=F,this.max_code=0,this.stat_desc=V}function H(F){return F<256?N[F]:N[256+(F>>>7)]}function wt(F,V){F.pending_buf[F.pending++]=255&V,F.pending_buf[F.pending++]=V>>>8&255}function lt(F,V,ct){F.bi_valid>_-ct?(F.bi_buf|=V<<F.bi_valid&65535,wt(F,F.bi_buf),F.bi_buf=V>>_-F.bi_valid,F.bi_valid+=ct-_):(F.bi_buf|=V<<F.bi_valid&65535,F.bi_valid+=ct)}function ht(F,V,ct){lt(F,ct[2*V],ct[2*V+1])}function jt(F,V){for(var ct=0;ct|=1&F,F>>>=1,ct<<=1,0<--V;);return ct>>>1}function ie(F,V,ct){var ft,J,mt=new Array(b+1),xt=0;for(ft=1;ft<=b;ft++)mt[ft]=xt=xt+ct[ft-1]<<1;for(J=0;J<=V;J++){var pt=F[2*J+1];pt!==0&&(F[2*J]=jt(mt[pt]++,pt))}}function Dt(F){var V;for(V=0;V<f;V++)F.dyn_ltree[2*V]=0;for(V=0;V<h;V++)F.dyn_dtree[2*V]=0;for(V=0;V<p;V++)F.bl_tree[2*V]=0;F.dyn_ltree[2*T]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}function Bt(F){8<F.bi_valid?wt(F,F.bi_buf):0<F.bi_valid&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}function ae(F,V,ct,ft){var J=2*V,mt=2*ct;return F[J]<F[mt]||F[J]===F[mt]&&ft[V]<=ft[ct]}function Yt(F,V,ct){for(var ft=F.heap[ct],J=ct<<1;J<=F.heap_len&&(J<F.heap_len&&ae(V,F.heap[J+1],F.heap[J],F.depth)&&J++,!ae(V,ft,F.heap[J],F.depth));)F.heap[ct]=F.heap[J],ct=J,J<<=1;F.heap[ct]=ft}function Ie(F,V,ct){var ft,J,mt,xt,pt=0;if(F.last_lit!==0)for(;ft=F.pending_buf[F.d_buf+2*pt]<<8|F.pending_buf[F.d_buf+2*pt+1],J=F.pending_buf[F.l_buf+pt],pt++,ft===0?ht(F,J,V):(ht(F,(mt=E[J])+d+1,V),(xt=S[mt])!==0&&lt(F,J-=D[mt],xt),ht(F,mt=H(--ft),ct),(xt=U[mt])!==0&&lt(F,ft-=rt[mt],xt)),pt<F.last_lit;);ht(F,T,V)}function $e(F,V){var ct,ft,J,mt=V.dyn_tree,xt=V.stat_desc.static_tree,pt=V.stat_desc.has_stree,St=V.stat_desc.elems,fe=-1;for(F.heap_len=0,F.heap_max=m,ct=0;ct<St;ct++)mt[2*ct]!==0?(F.heap[++F.heap_len]=fe=ct,F.depth[ct]=0):mt[2*ct+1]=0;for(;F.heap_len<2;)mt[2*(J=F.heap[++F.heap_len]=fe<2?++fe:0)]=1,F.depth[J]=0,F.opt_len--,pt&&(F.static_len-=xt[2*J+1]);for(V.max_code=fe,ct=F.heap_len>>1;1<=ct;ct--)Yt(F,mt,ct);for(J=St;ct=F.heap[1],F.heap[1]=F.heap[F.heap_len--],Yt(F,mt,1),ft=F.heap[1],F.heap[--F.heap_max]=ct,F.heap[--F.heap_max]=ft,mt[2*J]=mt[2*ct]+mt[2*ft],F.depth[J]=(F.depth[ct]>=F.depth[ft]?F.depth[ct]:F.depth[ft])+1,mt[2*ct+1]=mt[2*ft+1]=J,F.heap[1]=J++,Yt(F,mt,1),2<=F.heap_len;);F.heap[--F.heap_max]=F.heap[1],function($t,qn){var O,g,y,M,z,Q,it=qn.dyn_tree,zt=qn.max_code,Ne=qn.stat_desc.static_tree,we=qn.stat_desc.has_stree,Ce=qn.stat_desc.extra_bits,he=qn.stat_desc.extra_base,Yc=qn.stat_desc.max_length,bh=0;for(M=0;M<=b;M++)$t.bl_count[M]=0;for(it[2*$t.heap[$t.heap_max]+1]=0,O=$t.heap_max+1;O<m;O++)Yc<(M=it[2*it[2*(g=$t.heap[O])+1]+1]+1)&&(M=Yc,bh++),it[2*g+1]=M,zt<g||($t.bl_count[M]++,z=0,he<=g&&(z=Ce[g-he]),Q=it[2*g],$t.opt_len+=Q*(M+z),we&&($t.static_len+=Q*(Ne[2*g+1]+z)));if(bh!==0){do{for(M=Yc-1;$t.bl_count[M]===0;)M--;$t.bl_count[M]--,$t.bl_count[M+1]+=2,$t.bl_count[Yc]--,bh-=2}while(0<bh);for(M=Yc;M!==0;M--)for(g=$t.bl_count[M];g!==0;)zt<(y=$t.heap[--O])||(it[2*y+1]!==M&&($t.opt_len+=(M-it[2*y+1])*it[2*y],it[2*y+1]=M),g--)}}(F,V),ie(mt,fe,F.bl_count)}function k(F,V,ct){var ft,J,mt=-1,xt=V[1],pt=0,St=7,fe=4;for(xt===0&&(St=138,fe=3),V[2*(ct+1)+1]=65535,ft=0;ft<=ct;ft++)J=xt,xt=V[2*(ft+1)+1],++pt<St&&J===xt||(pt<fe?F.bl_tree[2*J]+=pt:J!==0?(J!==mt&&F.bl_tree[2*J]++,F.bl_tree[2*A]++):pt<=10?F.bl_tree[2*C]++:F.bl_tree[2*R]++,mt=J,fe=(pt=0)===xt?(St=138,3):J===xt?(St=6,3):(St=7,4))}function ot(F,V,ct){var ft,J,mt=-1,xt=V[1],pt=0,St=7,fe=4;for(xt===0&&(St=138,fe=3),ft=0;ft<=ct;ft++)if(J=xt,xt=V[2*(ft+1)+1],!(++pt<St&&J===xt)){if(pt<fe)for(;ht(F,J,F.bl_tree),--pt!=0;);else J!==0?(J!==mt&&(ht(F,J,F.bl_tree),pt--),ht(F,A,F.bl_tree),lt(F,pt-3,2)):pt<=10?(ht(F,C,F.bl_tree),lt(F,pt-3,3)):(ht(F,R,F.bl_tree),lt(F,pt-11,7));mt=J,fe=(pt=0)===xt?(St=138,3):J===xt?(St=6,3):(St=7,4)}}c(rt);var et=!1;function B(F,V,ct,ft){lt(F,(l<<1)+(ft?1:0),3),function(J,mt,xt,pt){Bt(J),wt(J,xt),wt(J,~xt),s.arraySet(J.pending_buf,J.window,mt,xt,J.pending),J.pending+=xt}(F,V,ct)}i._tr_init=function(F){et||(function(){var V,ct,ft,J,mt,xt=new Array(b+1);for(J=ft=0;J<u-1;J++)for(D[J]=ft,V=0;V<1<<S[J];V++)E[ft++]=J;for(E[ft-1]=J,J=mt=0;J<16;J++)for(rt[J]=mt,V=0;V<1<<U[J];V++)N[mt++]=J;for(mt>>=7;J<h;J++)for(rt[J]=mt<<7,V=0;V<1<<U[J]-7;V++)N[256+mt++]=J;for(ct=0;ct<=b;ct++)xt[ct]=0;for(V=0;V<=143;)W[2*V+1]=8,V++,xt[8]++;for(;V<=255;)W[2*V+1]=9,V++,xt[9]++;for(;V<=279;)W[2*V+1]=7,V++,xt[7]++;for(;V<=287;)W[2*V+1]=8,V++,xt[8]++;for(ie(W,f+1,xt),V=0;V<h;V++)L[2*V+1]=5,L[2*V]=jt(V,5);Z=new at(W,S,d+1,f,b),$=new at(L,U,0,h,b),st=new at(new Array(0),I,0,p,v)}(),et=!0),F.l_desc=new Y(F.dyn_ltree,Z),F.d_desc=new Y(F.dyn_dtree,$),F.bl_desc=new Y(F.bl_tree,st),F.bi_buf=0,F.bi_valid=0,Dt(F)},i._tr_stored_block=B,i._tr_flush_block=function(F,V,ct,ft){var J,mt,xt=0;0<F.level?(F.strm.data_type===2&&(F.strm.data_type=function(pt){var St,fe=4093624447;for(St=0;St<=31;St++,fe>>>=1)if(1&fe&&pt.dyn_ltree[2*St]!==0)return o;if(pt.dyn_ltree[18]!==0||pt.dyn_ltree[20]!==0||pt.dyn_ltree[26]!==0)return a;for(St=32;St<d;St++)if(pt.dyn_ltree[2*St]!==0)return a;return o}(F)),$e(F,F.l_desc),$e(F,F.d_desc),xt=function(pt){var St;for(k(pt,pt.dyn_ltree,pt.l_desc.max_code),k(pt,pt.dyn_dtree,pt.d_desc.max_code),$e(pt,pt.bl_desc),St=p-1;3<=St&&pt.bl_tree[2*P[St]+1]===0;St--);return pt.opt_len+=3*(St+1)+5+5+4,St}(F),J=F.opt_len+3+7>>>3,(mt=F.static_len+3+7>>>3)<=J&&(J=mt)):J=mt=ct+5,ct+4<=J&&V!==-1?B(F,V,ct,ft):F.strategy===4||mt===J?(lt(F,2+(ft?1:0),3),Ie(F,W,L)):(lt(F,4+(ft?1:0),3),function(pt,St,fe,$t){var qn;for(lt(pt,St-257,5),lt(pt,fe-1,5),lt(pt,$t-4,4),qn=0;qn<$t;qn++)lt(pt,pt.bl_tree[2*P[qn]+1],3);ot(pt,pt.dyn_ltree,St-1),ot(pt,pt.dyn_dtree,fe-1)}(F,F.l_desc.max_code+1,F.d_desc.max_code+1,xt+1),Ie(F,F.dyn_ltree,F.dyn_dtree)),Dt(F),ft&&Bt(F)},i._tr_tally=function(F,V,ct){return F.pending_buf[F.d_buf+2*F.last_lit]=V>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&V,F.pending_buf[F.l_buf+F.last_lit]=255&ct,F.last_lit++,V===0?F.dyn_ltree[2*ct]++:(F.matches++,V--,F.dyn_ltree[2*(E[ct]+d+1)]++,F.dyn_dtree[2*H(V)]++),F.last_lit===F.lit_bufsize-1},i._tr_align=function(F){lt(F,2,3),ht(F,T,W),function(V){V.bi_valid===16?(wt(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):8<=V.bi_valid&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)}(F)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,d,f=1,h={},p=!1,m=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,c={}.toString.call(o.process)==="[object process]"?function(A){Ir.nextTick(function(){v(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,C=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=C,A}}()?(d="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",T,!1):o.attachEvent("onmessage",T),function(A){o.postMessage(d+A,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(A){v(A.data)},function(A){u.port2.postMessage(A)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(A){var C=m.createElement("script");C.onreadystatechange=function(){v(A),C.onreadystatechange=null,l.removeChild(C),C=null},l.appendChild(C)}):function(A){setTimeout(v,0,A)},b.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var C=new Array(arguments.length-1),R=0;R<C.length;R++)C[R]=arguments[R+1];var S={callback:A,args:C};return h[f]=S,c(f),f++},b.clearImmediate=_}function _(A){delete h[A]}function v(A){if(p)setTimeout(v,0,A);else{var C=h[A];if(C){p=!0;try{(function(R){var S=R.callback,U=R.args;switch(U.length){case 0:S();break;case 1:S(U[0]);break;case 2:S(U[0],U[1]);break;case 3:S(U[0],U[1],U[2]);break;default:S.apply(a,U)}})(C)}finally{_(A),p=!1}}}}function T(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(d)===0&&v(+A.data.slice(d.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Mn<"u"?Mn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})($E);var Z4=$E.exports,xp=lo(Z4);const jE={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(jE);var Or=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},ga,Hc,co;class X4{constructor(...e){ga.set(this,new Map),Hc.set(this,new Map),co.set(this,new Map);for(const n of e)this.define(n)}define(e,n=!1){for(let[r,i]of Object.entries(e)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Or(this,co,"f").has(r)||Or(this,co,"f").set(r,new Set);const s=Or(this,co,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Or(this,Hc,"f").set(r,a),o=!1,c)continue;const l=Or(this,ga,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Or(this,ga,"f").set(a,r)}}return this}getType(e){if(typeof e!="string")return null;const n=e.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<e.length;return!(r.length<n.length-1)&&i?null:Or(this,ga,"f").get(r)??null}getExtension(e){var n;return typeof e!="string"?null:(e=(n=e==null?void 0:e.split)==null?void 0:n.call(e,";")[0],(e&&Or(this,Hc,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:Or(this,co,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of Or(this,co,"f").values())Object.freeze(e);return this}_getTestState(){return{types:Or(this,ga,"f"),extensions:Or(this,Hc,"f")}}}ga=new WeakMap,Hc=new WeakMap,co=new WeakMap;var q4=new X4(jE)._freeze();function zE(t,e){switch([...e.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:if(t.endsWith(".xp"))return"application/rexpaint";break}return q4.getType(t)??"application/octet-stream"}async function J4(t,e,n){try{pe(tt,t,"parsezipfile",e.name);const r=await e.arrayBuffer();(await new xp().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=zE(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{de(tt,t,"crash",c.message)})})}catch(r){de(tt,t,"crash",r.message)}}async function KE(t,e,n){try{pe(tt,e,"parsebinaryfile",t.name);const r=await t.arrayBuffer();n(new Uint8Array(r))}catch(r){de(tt,e,"crash",r.message)}}function WE(t,e){function n(r){if(x(e))switch(r){case"text/plain":e.text().then(i=>Da(tt,t,void 0,"text",`file:${e.name}`,i)).catch(i=>de(tt,t,"crash",i.message));break;case"application/json":e.text().then(i=>Da(tt,t,void 0,"json",`file:${e.name}`,i)).catch(i=>de(tt,t,"crash",i.message));break;case"application/zip":J4(t,e,i=>WE(t,i)).catch(i=>de(tt,t,"crash",i.message));break;case"application/rexpaint":KE(e,t,i=>Da(tt,t,void 0,"rexpaint",`file:${e.name}`,i)).catch(i=>de(tt,t,"crash",i.message));break;case"application/octet-stream":KE(e,t,i=>Da(tt,t,void 0,"binary",`file:${e.name}`,i)).catch(i=>de(tt,t,"crash",i.message));break;default:e.arrayBuffer().then(i=>{const s=zE(e.name,new Uint8Array(i));if(s)n(s);else return de(tt,t,"parsewebfile",`unsupported file ${e.name}`)}).catch(i=>de(tt,t,"crash",i.message));return}}n((e==null?void 0:e.type)??"")}function _a(t,e,n){n().catch(r=>{console.error(r),de(t,e,"crash",r==null?void 0:r.message)})}function Q4(t){const[e,n]=t.split(":"),r=x(n);return[r?e:"self",r?n:t]}function tj(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-e.length%4)%4);return e+n}function ej(t){return t.replace(/\+/g,"-").replace(/\//g,"_")}const nj=new Date("1980/09/02");async function HE(t){return console.info("saved",t),new Promise((e,n)=>{const r=new xp;for(let i=0;i<t.length;++i){const s=t[i],o=oF(s);if(o){const a=nN(o);x(a)&&r.file(s.id,a,{date:nj})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{e(ej(i))}).catch(n)})}async function rj(t){return new Promise((e,n)=>{const r=new xp;r.loadAsync(tj(t),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=aF(rN(c));x(l)&&i.push(l)}e(i)}).catch(n)})}function Ep(t,e){return`${t.x},${t.y},${e.x},${e.y}`}let De;function ij(){return!!De}function GE(t,e,n){const r=Math.min(e.x,n.x),i=Math.min(e.y,n.y),s=Math.max(e.x,n.x),o=Math.max(e.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let d=i;d<=o;++d)for(let f=r;f<=s;++f){const h={x:f-r,y:d-i},p=te(t,{x:f,y:d});(p==null?void 0:p.category)===Fn.ISOBJECT?(l.push(Qn(cs(t,f,d))),Ci(p)!=="player"&&u.push({...Qn(p),...h,id:"blank"})):l.push({...Qn(p),...h})}return{board:t.id,width:a,height:c,terrain:l,objects:u}}function sj(t,e,n,r){const i=Zn(t);if(x(i))switch(De=GE(i,e,n),r){case"copyobjects":De.terrain=[];break;case"copyterrain":De.objects=[];break}}function oj(t,e,n){const r=Ep(e,n);Lt(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),Lt(t,sn),Nt(t,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Nt(t,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Nt(t,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=qe(t);i.scroll=Ln(t)}function aj(t,e,n,r){const i=bn(Pt.MAIN);if(!x(i))return;const s=Zn(t);if(x(s)){switch(De=GE(s,e,n),r){case"cutobjects":De.terrain=[];break;case"cutterrain":De.objects=[];break}switch(r){case"cutall":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=te(s,{x:a,y:o});(c==null?void 0:c.category)===Fn.ISOBJECT&&En(i,s,c,i.timestamp),Se(s,{x:a,y:o})}break}case"cutobjects":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=te(s,{x:a,y:o});(c==null?void 0:c.category)===Fn.ISOBJECT&&En(i,s,c,i.timestamp)}break}case"cutterrain":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a)Se(s,{x:a,y:o});break}}}}function cj(t,e,n){const r=Ep(e,n);Lt(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),Lt(t,sn),Nt(t,"batch","cut terrain & objects",[`cutall:${r}`,"hk","1"]),Nt(t,"batch","cut objects",[`cutobjects:${r}`,"hk","2"]),Nt(t,"batch","cut terrain",[`cutterrain:${r}`,"hk","3"]);const i=qe(t);i.scroll=Ln(t)}function lj(t,e,n,r){const i=Zn(t);if(!x(i)||!x(De))return;const s=Math.min(e.x,n.x),o=Math.min(e.y,n.y),a=Math.max(e.x,n.x),c=Math.max(e.y,n.y),l=a-s+1,u=c-o+1,d=Math.min(De.width,l),f=Math.min(De.height,u);switch(r){case"pasteall":{for(let h=0;h<f;++h)for(let p=0;p<d;++p){const m=si({x:p,y:h},De.width);Se(i,{...De.terrain[m],x:s+p,y:o+h})}for(let h=0;h<De.objects.length;++h){const p=De.objects[h];x(p.x)&&x(p.y)&&$o(p.x,p.y,0,l-1,u-1,0)&&Td(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let h=0;h<De.objects.length;++h){const p=De.objects[h];x(p.x)&&x(p.y)&&$o(p.x,p.y,0,l-1,u-1,0)&&Td(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let h=0;h<f;++h)for(let p=0;p<d;++p){const m=si({x:p,y:h},De.width);Se(i,{...De.terrain[m],x:s+p,y:o+h})}break;case"pasteterraintiled":for(let h=o;h<=c;++h)for(let p=s;p<=a;++p){const m=(p-s)%De.width,b=(h-o)%De.height,_=si({x:m,y:b},De.width);Se(i,{...De.terrain[_],x:p,y:h})}break}}function uj(t,e,n){const r=Ep(e,n);Lt(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),Lt(t,sn),Nt(t,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Nt(t,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Nt(t,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Nt(t,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=qe(t);i.scroll=Ln(t)}function _h(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function hj(t,e,n,r){const i=Zn(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){kt(u)&&(s=u,ay(e.x,e.y,n.x,n.y).forEach(d=>{const f=te(i,d);x(f)&&(f[l]=u)}))}Lt(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),Lt(t,sn),Nt(t,`batch:${_h(e,n)}`,"char",[r,"charedit"],o,a);const c=qe(t);c.scroll=Ln(t)}function fj(t,e,n,r){const i=Zn(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){if(kt(u)){s=u;for(let d=e.y;d<=n.y;++d)for(let f=e.x;f<=n.x;++f){const h=te(i,{x:f,y:d});x(h)&&(h[l]=u)}}}Lt(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),Lt(t,sn),Nt(t,`batch:${_h(e,n)}`,"color",[r,"coloredit"],o,a);const c=qe(t);c.scroll=Ln(t)}function dj(t,e,n,r){const i=Zn(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){kt(u)&&(s=u,ay(e.x,e.y,n.x,n.y).forEach(d=>{const f=te(i,d);x(f)&&(f[l]=u)}))}Lt(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),Lt(t,sn),Nt(t,`batch:${_h(e,n)}`,"color",[r,"coloredit"],o,a);const c=qe(t);c.scroll=Ln(t)}const Gc={stat:"",patternsize:2,mirror:1};function pj(t,e,n){const r=bn(Pt.MAIN);if(!x(r))return;const i=Zn(t);if(!x(i))return;const s=_h(e,n);Lt(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),Lt(t,sn),Nt(t,"batch","copy elements",[`copy:${s}`,"hk","1"," 1 ","next"]),Nt(t,"batch","cut elements",[`cut:${s}`,"hk","2"," 2 ","next"]),ij()&&Nt(t,"batch","paste elements",[`paste:${s}`,"hk","3"," 3 ","next"]),Nt(t,"batch","copy coords",[`copycoords:${s}`,"hk","5"," 5 "]);function o(h){const{target:p}=tr(h);return Gc[p]}function a(h,p){if(kt(p)||gt(p)){const{target:m}=tr(h);Gc[m]=p}}Nt(t,"batch","remix",[`stat:${s}`,"text"],o,a),Nt(t,"batch","patternsize",[`patternsize:${s}`,"number","1","5"],o,a),Nt(t,"batch","mirror",[`mirror:${s}`,"number","1","8"],o,a),Nt(t,"batch","run",[`remixrun:${s}`,"hk","r"," R "]),Lt(t,sn),Nt(t,"batch","set chars:",[`chars:${s}`,"hk","a"," A ","next"]),Nt(t,"batch","set colors:",[`colors:${s}`,"hk","c"," C ","next"]),Nt(t,"batch","set bgs:",[`bgs:${s}`,"hk","b"," B ","next"]),Lt(t,sn),Nt(t,"batch","make empty",[`empty:${s}`,"hk","0"," 0 ","next"]),Lt(t,sn),Lt(t,"codepages:");const c=Math.min(e.x,n.x),l=Math.min(e.y,n.y),u=Math.max(e.x,n.x),d=Math.max(e.y,n.y),f=new Set;for(let h=l;h<=d;++h)for(let p=c;p<=u;++p){const m=te(i,{x:p,y:h}),b=mx(r,m);x(b)&&!f.has(b.id)&&(f.add(b.id),Nt(t,"batch",`edit @${He(b)}`,[`pageopen:${b.id}`]))}}function vp(t,e){return`inspect:${e!=null&&e.id?e.id:Br(t,e)}`}function mj(t,e,n){const r=bn(Pt.MAIN);if(!x(r))return;const i=Zn(t);if(!x(i))return;function s(f){var p;return(e==null?void 0:e[f])??((p=e==null?void 0:e.kinddata)==null?void 0:p[f])??0}function o(f,h){x(e)&&(e[f]=h)}const a=e.category===Fn.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=vp(i,e);Lt(t,`${a}: ${c} ${l}`),Lt(t,sn),Nt(t,u,"color",[n,"coloredit"],s,o);const d=qe(t);d.scroll=Ln(t)}function gj(t,e,n){const r=bn(Pt.MAIN);if(!x(r))return;const i=Zn(t);if(!x(i))return;function s(f){var p;return(e==null?void 0:e[f])??((p=e==null?void 0:e.kinddata)==null?void 0:p[f])??0}function o(f,h){x(e)&&(e[f]=h)}const a=e.category===Fn.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=vp(i,e);Lt(t,`${a}: ${c} ${l}`),Lt(t,sn),Nt(t,u,"char",[n,"charedit"],s,o);const d=qe(t);d.scroll=Ln(t)}function _j(t,e,n,r,i,s){var d,f,h;function o(p){var b;const m=(r==null?void 0:r[p])??((b=r==null?void 0:r.kinddata)==null?void 0:b[p]);if(!x(m))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Mt.ISWALK;case"pushable":return 0;case"breakable":return 0}return m}function a(p,m){x(r)&&(r[p]=m)}s?Lt(t,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):Lt(t,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),Lt(t,sn);const c=vp(e,r);s?(Nt(t,c,"cycle",["cycle","number","1","255"],o,a),Nt(t,c,"collision",["collision","select","iswalking",`${Mt.ISWALK}`,"isswimming",`${Mt.ISSWIM}`],o,a)):Nt(t,c,"collision",["collision","select","iswalkable",`${Mt.ISWALK}`,"isswimable",`${Mt.ISSWIM}`,"issolid",`${Mt.ISSOLID}`],o,a),s&&Nt(t,c,"pushable",["pushable","select","no","0","yes","1"],o,a),Nt(t,c,"breakable",["breakable","select","no","0","yes","1"],o,a);const l=Lc(n),u=dr(l);for(let p=0;p<u.length;++p){const m=u[p];switch(m){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(ce(l[m])){const[b,_,...v]=l[m];gt(_)&&Nt(t,c,_||m,[m,b,...v],o,a)}break}}Nt(t,c,"copy coords",["copycoords","hk","5"," 5 "]),Lt(t,sn),Nt(t,c,`char: ${r.char??((d=r.kinddata)==null?void 0:d.char)??1}`,["char","hk","a"," A ","next"],o,a),Nt(t,c,`color: ${r.color??((f=r.kinddata)==null?void 0:f.color)??15}`,["color","hk","c"," C ","next"],o,a),Nt(t,c,`bg: ${r.bg??((h=r.kinddata)==null?void 0:h.bg)??0}`,["bg","hk","b"," B ","next"],o,a),Lt(t,sn),Nt(t,c,"make empty",["empty","hk","0"],o,a),Lt(t,sn),Nt(t,"batch",`edit @${He(n)}`,[`pageopen:${n.id}`,"hk","z"])}function yj(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function bj(t,e,n,r){const i=bn(Pt.MAIN);if(!x(i))return;const s=Zn(t);if(x(s))switch(r){case"emptyall":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=te(s,{x:a,y:o});(c==null?void 0:c.category)===Fn.ISOBJECT&&En(i,s,c,i.timestamp),Se(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=te(s,{x:a,y:o});(c==null?void 0:c.category)===Fn.ISOBJECT&&En(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a)Se(s,{x:a,y:o});break}}}function wj(t,e,n){const r=yj(e,n);Lt(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),Lt(t,sn),Nt(t,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),Nt(t,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),Nt(t,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=qe(t);i.scroll=Ln(t)}function xj(t,e,n){const r=bn(Pt.MAIN);if(!x(r))return;const i=Zn(t);if(!x(i))return;if(Pe(r,i),e.x===n.x&&e.y===n.y){const o=te(i,e),a=mx(r,o);x(o)&&x(a)&&_j(t,i,a,o,e,mn(o)),o!=null&&o.kind||(Lt(t,`empty: ${e.x}, ${e.y}`),Lt(t,sn),Nt(t,"empty","copy coords",[`copycoords:${e.x},${e.y}`,"hk","5"," 5 "]))}else pj(t,e,n);const s=qe(t);s.scroll=Ln(t)}function Ej(t,e){const n=ue(Pt.MAIN);if(!x(n))return;const r=Zn(e);if(!x(r))return;const i=tr(t),s=aN(r,i.target);if(x(s))switch(i.path){case"copycoords":cf(tt,fr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":mj(e,s,i.path);break;case"char":gj(e,s,i.path);break;case"empty":En(n,r,s,n.timestamp);break;case"code":_a(tt,e,async()=>{const o=Ci(s),a="object";pe(tt,e,`opened [${a}] ${o}`);const c=[r.id,s.id];sd(ll(n.id,c),s.code??""),KA(tt,e),await dg(800),lg(tt,e,n.id,c,a,`${o} - ${n.name}`)});break;default:console.info("unknown inspect",i);break}}function vj(t,e){const n=Zn(e);if(!x(n))return;const r=tr(t),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":oj(e,c,l);break;case"copyall":case"copyobjects":case"copyterrain":sj(e,c,l,r.target);break;case"cut":cj(e,c,l);break;case"cutall":case"cutobjects":case"cutterrain":aj(e,c,l,r.target);break;case"paste":uj(e,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":lj(e,c,l,r.target);break;case"empty":wj(e,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":bj(e,c,l,r.target);break;case"chars":hj(e,c,l,"char");break;case"colors":fj(e,c,l,"color");break;case"bgs":dj(e,c,l,"bg");break;case"copycoords":cf(tt,e,[i,s,o,a].join(" "));break;case"remixrun":{const u=Hn(w.book,_t.BOARD,Gc.stat),d=Ae(...u);x(d)&&eE(n.id,d.id,Gc.patternsize,Gc.mirror,c,l,"all");break}case"pageopen":_a(tt,e,async()=>{await dg(800),lR(tt,e,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}const kj=16,Ts={},yh={},Tj=60;let YE=0;const ya={},ba={};async function VE(t){const e=ha(),n=ue(Pt.MAIN);if(e.length&&x(n)){const r=await HE(e),i=`${t?"autosave ":""}${new Date().toISOString()} ${n.name} ${r.length} chars`;HA(oe,fr(),i,r)}}async function Aj(){const t=ha(),e=ue(Pt.MAIN);if(t.length&&x(e)){const n=await HE(t);GA(oe,fr(),n)}}const oe=ho("vm",["tick","second"],t=>{var n;if(!oe.session(t))return;const e=fr();switch(t.target){case"operator":k4(t.player),pe(oe,t.player,`operator set to ${t.player}`),oe.replynext(t,"ackoperator",!0);break;case"zsswords":{const r=ue(Pt.MAIN);oe.replynext(t,"ackzsswords",{cli:cp(xs.CLI),loader:cp(xs.LOADER),runtime:cp(xs.RUNTIME),flags:[...dr(Sr(t.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isbreakable","notbreakable","p1","p2","p3","cycle","stepx","stepy","light","lightdir","sender","arg"],kinds:[...no(r,_t.OBJECT).map(i=>He(i)),...dr(rp)],altkinds:[...no(r,_t.TERRAIN),...no(r,_t.BOARD),...no(r,_t.PALETTE),...no(r,_t.CHARSET),...no(r,_t.LOADER)].map(i=>He(i)),colors:[...dr(nc)],dirs:[...dr(hd).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...dr(ip)],exprs:["aligned","alligned","contact","blocked","any","count","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":t.player===e&&_a(oe,t.player,async()=>{if(ce(t.data)){const[r,i]=t.data,s=await rj(r),o=s.map(a=>a.name);I4(s,i),pe(oe,t.player,`loading ${o.join(", ")}`),af(oe,t.player)}});break;case"search":L4(t.player)||af(oe,t.player);break;case"logout":C4(t.player),delete Ts[t.player],pe(oe,e,`player ${t.player} logout`),af(oe,t.player);break;case"login":CE(t.player)?(Ts[t.player]=0,pe(oe,fr(),`login from ${t.player}`),oe.replynext(t,"acklogin",!0)):og(oe,t.player);break;case"local":CE(t.player)?(Ts[t.player]=0,pe(oe,fr(),`login from ${t.player}`)):og(oe,t.player);break;case"doot":Ts[t.player]=0,yh[t.player]=yh[t.player]??0,yh[t.player]%32===0&&pe(oe,t.player,`$whiteactive $blue${t.player}`),++yh[t.player];break;case"input":{if(t.player.includes("local")&&!IE(t.player)&&cR(oe,t.player),!t.player.includes("local")||IE(t.player)){const r=Sr(t.player),[i=On.NONE,s=0]=t.data??[On.NONE,0];ce(r.inputqueue)||(r.inputqueue=[]),i!==On.NONE&&r.inputqueue.push([i,s])}break}case"codewatch":if(ce(t.data)){const[r,i]=t.data,s=ll(r,i);x(ba[s])||(ba[s]=sy(s,o=>{const[a,c]=i,l=Wr(r),u=zi(l,a);if(x(u))if($i(u)===_t.BOARD&&x(c)){const d=Ee(u),f=Sn(d,c);x(f)&&(f.code=o,D0(hx(o),f))}else u.code=o,iF(u)})),ya[s]=ya[s]??new Set,ya[s].add(t.player)}break;case"coderelease":if(ce(t.data)){const[r,i]=t.data,[,s]=i,o=ll(r,i);x(ya[o])&&(ya[o].delete(t.player),ya[o].size===0&&((n=ba[o])==null||n.call(ba),ba[o]=void 0,gt(s)&&B4(s)))}break;case"halt":t.player===e&&Cv(t.data)&&T4(t.data);break;case"tick":A4()||D4();break;case"synthsend":if(gt(t.data)){const[r,i]=Q4(t.data),s=ue(Pt.MAIN);da(r,i,void 0,na(s))}break;case"second":{M4(Ts);const r=Object.keys(Ts);for(let i=0;i<r.length;++i)++Ts[r[i]];for(let i=0;i<r.length;++i){const s=r[i];Ts[s]>=kj&&ug(oe,s)}++YE>=Tj&&(YE=0,_a(oe,t.player,async()=>{await VE(!0)}));break}case"copyjsonfile":if(t.player===e){const r=ue(Pt.MAIN);if(x(r)&&ce(t.data)){const[i]=t.data,s=zi(r,i);x(s)&&YA(oe,e,s,`${He(s)}.${ji(s)}.json`)}}break;case"refscroll":{Lt(t.player,"stat refs"),Lt(t.player,sn),Nt(t.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),Nt(t.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]),Nt(t.player,"refscroll","notes:",["notesscroll","hk","n"," N ","next"]);const r=qe(t.player);r.scroll=Ln(t.player);break}case"fork":t.player===e&&_a(oe,t.player,async()=>{await Aj()});break;case"flush":t.player===e&&_a(oe,t.player,async()=>{await VE()});break;case"cli":UE(t.player,t.data);break;case"clirepeatlast":$4(t.player);break;case"restart":t.player===e&&(P4(),hg(oe,t.player));break;case"inspect":if(ce(t.data)){const[r,i]=t.data;xj(t.player,r,i)}break;case"loader":if(ce(t.data)){const[r,i,s,o]=t.data;if(i==="file")WE(t.player,o);else if(i==="json"&&/file:.*\.book.json/.test(s)){pe(oe,t.player,`loading ${s}`);const a=JSON.parse(o.json),c=ue(Pt.MAIN);x(c)&&x(a.data)&&gt(a.exported)&&(yp(a.data),pe(oe,t.player,`loaded ${a.exported}`))}else if(i==="json"&&/file:.*\..*\.json/.test(s)){pe(oe,t.player,`loading ${s}`);const a=JSON.parse(o.json),c=ue(Pt.MAIN);x(c)&&x(a.data)&&gt(a.exported)&&(gx(c,a.data),pe(oe,t.player,`loaded ${a.exported}`))}else W$(r,i,s,o,t.player)}break;default:{const{target:r,path:i}=tr(t.target);switch(Ot(r)){case"refscroll":switch(i){case"charscroll":{Nt(t.player,"refscroll","char",["char","charedit"]);const s=qe(t.player);s.scroll=Ln(t.player);break}case"colorscroll":{Nt(t.player,"refscroll","color",["color","coloredit"]);const s=qe(t.player);s.scroll=Ln(t.player);break}case"notesscroll":{Lt(t.player,"duration             cdefgab - notes "),Lt(t.player,"y - 64nd note        x - rest"),Lt(t.player,"t - 32nd note        "),Lt(t.player,"s - 16th note.       drums"),Lt(t.player,"i - eight note.      0 - tick"),Lt(t.player,"q - quarter note     1 - tweet"),Lt(t.player,"h - half note        2 - cowbell"),Lt(t.player,"w - whole note       p - clap"),Lt(t.player,"                     4 - high snare"),Lt(t.player,"mods                 5 - high woodblock"),Lt(t.player,"3 - triplet          6 - low snare"),Lt(t.player,". - time and a half  7 - low tom"),Lt(t.player,"# - sharp            8 - low woodblock"),Lt(t.player,"! - flat             9 - bass drum");const s=qe(t.player);s.scroll=Ln(t.player);break}}break;case"batch":vj(i,t.player);break;case"empty":{const s=tr(i);switch(s.target){case"copycoords":cf(oe,fr(),s.path.split(",").join(" "));break}break}case"inspect":Ej(i,t.player);break;case"touched":if(ce(t.data)){const[s,o,a]=t.data;LE({...t,target:`${s}:${a}`,data:void 0,sender:o})}break;default:{const s=tr(i);if(Ot(s.target)==="self"||!s.path)t.target=t.target.replace("self:",""),LE(t);else{const o=ue(Pt.MAIN);da(s.target,s.path,void 0,na(o))}break}}break}}},v4());function Rj(){WA(oe)}const{forward:Sj}=gR(t=>{_R(t)&&postMessage(t)});onmessage=function(e){Sj(e.data)},setTimeout(Rj,100)})();

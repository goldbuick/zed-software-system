var dW=Object.defineProperty;var pW=(bi,nn,tr)=>nn in bi?dW(bi,nn,{enumerable:!0,configurable:!0,writable:!0,value:tr}):bi[nn]=tr;var At=(bi,nn,tr)=>pW(bi,typeof nn!="symbol"?nn+"":nn,tr);(function(){"use strict";const bi=new Set,nn={emit(e,t,r,n,i){nn.invoke(oT(e,t,r,n,i))},invoke(e){bi.forEach(t=>t.handle(e))},connect(e){bi.add(e)},disconnect(e){bi.delete(e)}};var tr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ps(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function AA(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var D0={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(tr,function(){return r.importState=function(i){var s=new r;return s.importState(i),s},r;function r(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var u=n();s=u(" "),o=u(" "),a=u(" ");for(var l=0;l<i.length;l++)s-=u(i[l]),s<0&&(s+=1),o-=u(i[l]),o<0&&(o+=1),a-=u(i[l]),a<0&&(a+=1);u=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function n(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(D0);var TA=D0.exports,j0=ps(TA),z0={};(function(e){var t=tr&&tr.__spreadArray||function(u,l,h){if(h||arguments.length===2)for(var d=0,f=l.length,m;d<f;d++)(m||!(d in l))&&(m||(m=Array.prototype.slice.call(l,0,d)),m[d]=l[d]);return u.concat(m||Array.prototype.slice.call(l))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function r(u){return u[Math.floor(Math.random()*u.length)]}function n(u){return u.reduce(function(l,h){return l.length>h.length?l:h})}function i(u){return u.reduce(function(l,h){return l.length<h.length?l:h})}function s(u){u===void 0&&(u={}),typeof u=="string"&&(u={separator:u}),typeof u=="boolean"&&(u={capitalize:u});var l=u.separator,h=l===void 0?"":l,d=u.capitalize,f=d===void 0?!0:d,m=u.adjectiveCount,p=m===void 0?1:m,g=u.addAdverb,y=g===void 0?!1:g,b=t(t(t([],t([],Array(p),!0).map(function(T){return r(e.adjectives)}),!0),[r(e.nouns),r(e.verbs)],!1),y?[r(e.adverbs)]:[],!0);return f&&(b=b.map(function(T){return T.charAt(0).toUpperCase()+T.substr(1)})),b.join(h)}e.humanId=s;function o(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,d=u.addAdverb,f=d===void 0?!1:d;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(f?e.adverbs.length:1)}e.poolSize=o;function a(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,d=u.addAdverb,f=d===void 0?!1:d,m=u.separator,p=m===void 0?"":m;return n(e.adjectives).length*h+h*p.length+n(e.nouns).length+p.length+n(e.verbs).length+(f?n(e.adverbs).length+p.length:0)}e.maxLength=a;function c(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,d=u.addAdverb,f=d===void 0?!1:d,m=u.separator,p=m===void 0?"":m;return i(e.adjectives).length*h+h*p.length+i(e.nouns).length+p.length+i(e.verbs).length+(f?i(e.adverbs).length+p.length:0)}e.minLength=c,e.default=s})(z0);var W0=ps(z0);const SA="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let RA=e=>crypto.getRandomValues(new Uint8Array(e)),OA=(e,t,r)=>{let n=(2<<Math.log2(e.length-1))-1,i=-~(1.6*n*t/e.length);return(s=t)=>{let o="";for(;;){let a=r(i),c=i|0;for(;c--;)if(o+=e[a[c]&n]||"",o.length>=s)return o}}},H0=(e,t=21)=>OA(e,t|0,RA),IA=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=SA[r[e]&63];return t};var G0="abcdefghijklmnopqrstuvwxyz",K0="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Y0="0123456789",NA="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",CA="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const LA=Y0,MA=G0,UA=K0;var PA=LA+MA+UA,hf={lowercase:G0,uppercase:K0,numbers:Y0,nolookalikes:NA,nolookalikesSafe:CA,alphanumeric:PA};function We(){return`sid_${IA(12).replaceAll("-",".")}`}H0(hf.numbers,4),H0(`${hf.numbers}${hf.lowercase}`,16);function Er(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function FA(){return W0({capitalize:!1,adjectiveCount:1})}function $A(){return W0({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var BA=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)i.hasOwnProperty(s)&&(n[s]=i[s])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),DA=Object.prototype.hasOwnProperty;function df(e,t){return DA.call(e,t)}function pf(e){if(Array.isArray(e)){for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(e);var n=[];for(var i in e)df(e,i)&&n.push(i);return n}function Br(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function mf(e){for(var t=0,r=e.length,n;t<r;){if(n=e.charCodeAt(t),n>=48&&n<=57){t++;continue}return!1}return!0}function ms(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function q0(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function gf(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,r=e.length;t<r;t++)if(gf(e[t]))return!0}else if(typeof e=="object"){for(var n=pf(e),i=n.length,s=0;s<i;s++)if(gf(e[n[s]]))return!0}}return!1}function V0(e,t){var r=[e];for(var n in t){var i=typeof t[n]=="object"?JSON.stringify(t[n],null,2):t[n];typeof i<"u"&&r.push(n+": "+i)}return r.join(`
`)}var X0=function(e){BA(t,e);function t(r,n,i,s,o){var a=this.constructor,c=e.call(this,V0(r,{name:n,index:i,operation:s,tree:o}))||this;return c.name=n,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=V0(r,{name:n,index:i,operation:s,tree:o}),c}return t}(Error),$e=X0,jA=Br,Js={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var n=e[t];return delete e[t],{newDocument:r,removed:n}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:function(e,t,r){var n=kc(r,this.path);n&&(n=Br(n));var i=gs(r,{op:"remove",path:this.from}).removed;return gs(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:n}},copy:function(e,t,r){var n=kc(r,this.from);return gs(r,{op:"add",path:this.path,value:Br(n)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:sa(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}},zA={add:function(e,t,r){return mf(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){var n=e.splice(t,1);return{newDocument:r,removed:n[0]}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:Js.move,copy:Js.copy,test:Js.test,_get:Js._get};function kc(e,t){if(t=="")return e;var r={op:"_get",path:t};return gs(e,r),r.value}function gs(e,t,r,n,i,s){if(r===void 0&&(r=!1),n===void 0&&(n=!0),i===void 0&&(i=!0),s===void 0&&(s=0),r&&(typeof r=="function"?r(t,0,e,t.path):xc(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=kc(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=sa(e,t.value),o.test===!1)throw new $e("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(r)throw new $e("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{n||(e=Br(e));var a=t.path||"",c=a.split("/"),u=e,l=1,h=c.length,d=void 0,f=void 0,m=void 0;for(typeof r=="function"?m=r:m=xc;;){if(f=c[l],f&&f.indexOf("~")!=-1&&(f=q0(f)),i&&(f=="__proto__"||f=="prototype"&&l>0&&c[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&d===void 0&&(u[f]===void 0?d=c.slice(0,l).join("/"):l==h-1&&(d=t.path),d!==void 0&&m(t,0,e,d)),l++,Array.isArray(u)){if(f==="-")f=u.length;else{if(r&&!mf(f))throw new $e("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);mf(f)&&(f=~~f)}if(l>=h){if(r&&t.op==="add"&&f>u.length)throw new $e("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=zA[t.op].call(t,u,f,e);if(o.test===!1)throw new $e("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(l>=h){var o=Js[t.op].call(t,u,f,e);if(o.test===!1)throw new $e("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(u=u[f],r&&l<h&&(!u||typeof u!="object"))throw new $e("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function yf(e,t,r,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!0),r&&!Array.isArray(t))throw new $e("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(e=Br(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=gs(e,t[o],r,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function WA(e,t,r){var n=gs(e,t);if(n.test===!1)throw new $e("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return n.newDocument}function xc(e,t,r,n){if(typeof e!="object"||e===null||Array.isArray(e))throw new $e("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(Js[e.op]){if(typeof e.path!="string")throw new $e("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new $e('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new $e("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new $e("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);if((e.op==="add"||e.op==="replace"||e.op==="test")&&gf(e.value))throw new $e("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);if(r){if(e.op=="add"){var i=e.path.split("/").length,s=n.split("/").length;if(i!==s+1&&i!==s)throw new $e("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==n)throw new $e("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=J0([o],r);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new $e("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new $e("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function J0(e,t,r){try{if(!Array.isArray(e))throw new $e("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)yf(Br(t),Br(e),r||!0);else{r=r||xc;for(var n=0;n<e.length;n++)r(e[n],n,t,void 0)}}catch(i){if(i instanceof $e)return i;throw i}}function sa(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=Array.isArray(e),n=Array.isArray(t),i,s,o;if(r&&n){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!sa(e[i],t[i]))return!1;return!0}if(r!=n)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!sa(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var HA=Object.freeze({__proto__:null,JsonPatchError:$e,_areEquals:sa,applyOperation:gs,applyPatch:yf,applyReducer:WA,deepClone:jA,getValueByPointer:kc,validate:J0,validator:xc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var _f=new WeakMap,GA=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),KA=function(){function e(t,r){this.callback=t,this.observer=r}return e}();function YA(e){return _f.get(e)}function qA(e,t){return e.observers.get(t)}function VA(e,t){e.observers.delete(t.callback)}function XA(e,t){t.unobserve()}function JA(e,t){var r=[],n,i=YA(e);if(!i)i=new GA(e),_f.set(e,i);else{var s=qA(i,t);n=s&&s.observer}if(n)return n;if(n={},i.value=Br(e),t){n.callback=t,n.next=null;var o=function(){bf(n)},a=function(){clearTimeout(n.next),n.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return n.patches=r,n.object=e,n.unobserve=function(){bf(n),clearTimeout(n.next),VA(i,n),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new KA(t,n)),n}function bf(e,t){t===void 0&&(t=!1);var r=_f.get(e.object);wf(r.value,e.object,e.patches,"",t),e.patches.length&&yf(r.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function wf(e,t,r,n,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=pf(t),o=pf(e),a=!1,c=o.length-1;c>=0;c--){var u=o[c],l=e[u];if(df(t,u)&&!(t[u]===void 0&&l!==void 0&&Array.isArray(t)===!1)){var h=t[u];typeof l=="object"&&l!=null&&typeof h=="object"&&h!=null&&Array.isArray(l)===Array.isArray(h)?wf(l,h,r,n+"/"+ms(u),i):l!==h&&(i&&r.push({op:"test",path:n+"/"+ms(u),value:Br(l)}),r.push({op:"replace",path:n+"/"+ms(u),value:Br(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&r.push({op:"test",path:n+"/"+ms(u),value:Br(l)}),r.push({op:"remove",path:n+"/"+ms(u)}),a=!0):(i&&r.push({op:"test",path:n,value:e}),r.push({op:"replace",path:n,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var u=s[c];!df(e,u)&&t[u]!==void 0&&r.push({op:"add",path:n+"/"+ms(u),value:Br(t[u])})}}}function Z0(e,t,r){r===void 0&&(r=!1);var n=[];return wf(e,t,n,"",r),n}var ZA=Object.freeze({__proto__:null,compare:Z0,generate:bf,observe:JA,unobserve:XA});Object.assign({},HA,ZA,{JsonPatchError:X0,deepClone:Br,escapePathComponent:ms,unescapePathComponent:q0});var QA=typeof Element<"u",tT=typeof Map=="function",eT=typeof Set=="function",rT=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ac(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n,i;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(!Ac(e[n],t[n]))return!1;return!0}var s;if(tT&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(n=s.next()).done;)if(!t.has(n.value[0]))return!1;for(s=e.entries();!(n=s.next()).done;)if(!Ac(n.value[1],t.get(n.value[0])))return!1;return!0}if(eT&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(n=s.next()).done;)if(!t.has(n.value[0]))return!1;return!0}if(rT&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(e[n]!==t[n])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),r=i.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[n]))return!1;if(QA&&e instanceof Element)return!1;for(n=r;n--!==0;)if(!((i[n]==="_owner"||i[n]==="__v"||i[n]==="__o")&&e.$$typeof)&&!Ac(e[i[n]],t[i[n]]))return!1;return!0}return e!==e&&t!==t}var nT=function(t,r){try{return Ac(t,r)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}},iT=ps(nT);function w(e){return e!=null}const Dr=Object.keys;function Ln(e){return Br(e)}function sT(e){return typeof e=="boolean"}function Et(e){return typeof e=="number"&&isNaN(e)===!1}function yt(e){return typeof e=="string"}function pe(e){return Array.isArray(e)}function vf(e){return e}var zt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(zt||{}),Ht=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e[e.ISGHOST=4]="ISGHOST",e))(Ht||{}),jr=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(jr||{}),bt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e[e.AWAY=16]="AWAY",e[e.TOWARD=17]="TOWARD",e[e.FIND=18]="FIND",e[e.FLEE=19]="FLEE",e[e.TO=20]="TO",e[e.MID=21]="MID",e[e.OVER=22]="OVER",e[e.UNDER=23]="UNDER",e))(bt||{}),Ut=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.HOTKEY=11]="HOTKEY",e[e.COPYIT=12]="COPYIT",e[e.OPENIT=13]="OPENIT",e[e.VIEWIT=14]="VIEWIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(Ut||{});function Dt(e){return yt(e)?e.toLowerCase().trim():""}function oT(e,t,r,n,i){return{session:e,player:t,id:We(),sender:r,target:n,data:i}}function zr(e){const[t,...r]=e.split(":");return{target:t,path:r.join(":")}}function Zs(e,t=[],r=vf,n=""){const i=We(),s=Dt(e),o=t.map(Dt);let a=n;const c={id(){return i},name(){return e},session(u){return w(u)?u.session===a?u.session:"":a},topics(){return t},emit(u,l,h){nn.emit(a,u,i,l,h)},reply(u,l,h){c.emit(u.player,`${u.sender}:${l}`,h)},replynext(u,l,h){setTimeout(()=>c.emit(u.player,`${u.sender}:${l}`,h),64)},handle(u){const{target:l,path:h}=zr(u.target),d=Dt(l);!a&&d==="ready"&&(a=u.session),d==="session_reset"&&(a=""),o.findIndex(f=>f==="all"||f===d)!==-1&&r(u),(i===l||d==="all"||s===d)&&r({...u,target:h})}};return nn.connect(c),c}function aT(e){return typeof e=="object"&&yt(e.session)&&yt(e.player)&&yt(e.id)&&yt(e.sender)&&yt(e.target)}function _e(e,t,r,...n){return e.emit(t,"error",[`$red${r}$blue>>`,...n]),!1}function cT(e,t,...r){return e.emit(t,"info",r),!0}function Re(e,t,...r){return e.emit(t,"log",r),!0}function Tc(e,t,r){e.emit(t,"toast",r)}function lT(e,t,r){e.emit(t,"bridge:streamstart",r)}function uT(e,t){e.emit(t,"bridge:streamstop",void 0)}function fT(e,t,r){e.emit(t,"bridge:chatstart",r)}function hT(e,t){e.emit(t,"bridge:chatstop")}function dT(e,t,r,n,i,s,o){e.emit(t,"bridge:fetch",[r,n,i,s,o])}function pT(e,t){e.emit(t,"bridge:talkstart",t)}function mT(e,t){e.emit(t,"bridge:talkstop",t)}function gT(e,t){e.emit(t,"bridge:mediastart",t)}function yT(e,t){e.emit(t,"bridge:mediastop",t)}function _T(e,t,r){e.emit(t,"bridge:start",r)}function bT(e,t,r){e.emit(t,"bridge:tab",r)}function wT(e,t,r){e.emit(t,"gadgetclient:paint",r)}function vT(e,t,r){e.emit(t,"gadgetclient:patch",r)}function ET(e,t){e.emit(t,"gadgetserver:clearscroll")}function kT(e,t){e.emit(t,"gadgetserver:clearplayer")}function xT(e){e.emit("","ready")}function Q0(e,t){e.emit(t,"register:loginfail")}function Ef(e,t){e.emit(t,"register:loginready",!0)}function AT(e,t,r,n){e.emit(t,"register:savemem",[r,n])}function TT(e,t,r){e.emit(t,"register:forkmem",[r])}function ST(e,t,r,n){e.emit(t,"register:itchiopublishmem",[r,n])}function kf(e,t,r){e.emit(t,"register:copy",r)}function RT(e,t,r,n){e.emit(t,"register:copyjsonfile",[r,n])}function tm(e,t,r,n){e.emit(t,"register:downloadjsonfile",[r,n])}function OT(e,t){e.emit(t,"register:dev",void 0)}function IT(e,t){e.emit(t,"register:share",void 0)}function NT(e,t){e.emit(t,"register:nuke",void 0)}function CT(e,t){e.emit(t,"register:enterar",void 0)}function LT(e,t,r,n){e.emit(t,"synth:tts",[r,n])}function MT(e,t,r,n){e.emit(t,"synth:play",[r,n])}function UT(e,t,r,n,i){e.emit(t,"synth:bgplay",[r,n,i])}function PT(e,t,r){e.emit(t,"synth:bpm",r)}function FT(e,t,r){e.emit(t,"synth:playvolume",r)}function $T(e,t,r){e.emit(t,"synth:bgplayvolume",r)}function BT(e,t,r){e.emit(t,"synth:ttsvolume",r)}function xf(e,t,r,n,i){e.emit(t,"synth:voice",[r,n,i])}function em(e,t,r,n,i,s){e.emit(t,"synth:voicefx",[r,n,i,s])}function rm(e,t,r,n){e.emit(t,"register:config",[r,n])}function DT(e,t){e.emit(t,"register:configshow")}function jT(e,t){e.emit(t,"register:inspector")}function zT(e,t){e.emit(t,"register:terminal:full")}function nm(e,t,r,n,i,s){e.emit(t,"register:editor:open",[r,n,i,s])}function WT(e,t,r,n){e.emit(t,"vm:zztsearch",[r,n])}function HT(e,t){e.emit(t,"vm:zztrandom")}function GT(e,t){e.emit(t,"vm:local")}function Af(e,t){e.emit(t,"vm:logout")}function im(e,t,r,n,i){e.emit(t,"vm:touched",[r,n,i])}function KT(e,t){e.emit(t,"vm:readzipfilelist")}function Sc(e,t){const[r,n]=t;return`${e}:${[r,n].filter(w).join(":")}`}function YT(e,t,r){e.emit(t,"vm:cli",r)}function qT(e,t){e.emit(t,"vm:restart")}function sm(e,t){e.emit(t,"vm:flush")}function VT(e,t){e.emit(t,"vm:fork")}function XT(e,t){e.emit(t,"vm:itchiopublish")}function JT(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function ZT(e,t){return{filename:e,json:t}}function QT(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function Tf(e,t,r,n,i,s){let o;switch(n){case"file":o=s;break;case"text":o=JT(i,s);break;case"json":o=ZT(i,s);break;case"binary":o=QT(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[r,n,i,o])},1)}function tS(e){const t=new Set;function r(s){aT(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),nn.invoke(s))}const n=Zs("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){nn.disconnect(n)}return{forward:r,disconnect:i}}function eS(e){switch(e.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const t=zr(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const Sf=66.666,Rc=Math.round(1e3/Sf),om=3;function Oc(e){return new Promise(t=>setTimeout(t,e))}const Rf=Zs("clock");let Of=0,Ic=0,If=0,am=performance.now();function cm(){const e=performance.now(),t=e-am;If+=t,If>=Sf&&(If%=Sf,Rf.emit("","tick",Ic),Rf.emit("","tock",Ic),++Of,++Ic,Of>=Rc&&(Of%=Rc,Rf.emit("","second",Ic))),am=e,setTimeout(cm,2)}cm();function rS(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var lm={exports:{}},He=lm.exports={},Vn,Xn;function Nf(){throw new Error("setTimeout has not been defined")}function Cf(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Vn=setTimeout:Vn=Nf}catch{Vn=Nf}try{typeof clearTimeout=="function"?Xn=clearTimeout:Xn=Cf}catch{Xn=Cf}})();function um(e){if(Vn===setTimeout)return setTimeout(e,0);if((Vn===Nf||!Vn)&&setTimeout)return Vn=setTimeout,setTimeout(e,0);try{return Vn(e,0)}catch{try{return Vn.call(null,e,0)}catch{return Vn.call(this,e,0)}}}function nS(e){if(Xn===clearTimeout)return clearTimeout(e);if((Xn===Cf||!Xn)&&clearTimeout)return Xn=clearTimeout,clearTimeout(e);try{return Xn(e)}catch{try{return Xn.call(null,e)}catch{return Xn.call(this,e)}}}var wi=[],Qs=!1,ys,Nc=-1;function iS(){!Qs||!ys||(Qs=!1,ys.length?wi=ys.concat(wi):Nc=-1,wi.length&&fm())}function fm(){if(!Qs){var e=um(iS);Qs=!0;for(var t=wi.length;t;){for(ys=wi,wi=[];++Nc<t;)ys&&ys[Nc].run();Nc=-1,t=wi.length}ys=null,Qs=!1,nS(e)}}He.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];wi.push(new hm(e,t)),wi.length===1&&!Qs&&um(fm)};function hm(e,t){this.fun=e,this.array=t}hm.prototype.run=function(){this.fun.apply(null,this.array)},He.title="browser",He.browser=!0,He.env={},He.argv=[],He.version="",He.versions={};function vi(){}He.on=vi,He.addListener=vi,He.once=vi,He.off=vi,He.removeListener=vi,He.removeAllListeners=vi,He.emit=vi,He.prependListener=vi,He.prependOnceListener=vi,He.listeners=function(e){return[]},He.binding=function(e){throw new Error("process.binding is not supported")},He.cwd=function(){return"/"},He.chdir=function(e){throw new Error("process.chdir is not supported")},He.umask=function(){return 0};var sS=lm.exports;const Mn=rS(sS);var re={},Lf=Symbol.for("react.transitional.element"),oS=Symbol.for("react.portal"),aS=Symbol.for("react.fragment"),cS=Symbol.for("react.strict_mode"),lS=Symbol.for("react.profiler"),uS=Symbol.for("react.consumer"),fS=Symbol.for("react.context"),hS=Symbol.for("react.forward_ref"),dS=Symbol.for("react.suspense"),pS=Symbol.for("react.memo"),dm=Symbol.for("react.lazy"),pm=Symbol.iterator;function mS(e){return e===null||typeof e!="object"?null:(e=pm&&e[pm]||e["@@iterator"],typeof e=="function"?e:null)}var mm={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},gm=Object.assign,ym={};function to(e,t,r){this.props=e,this.context=t,this.refs=ym,this.updater=r||mm}to.prototype.isReactComponent={},to.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},to.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function _m(){}_m.prototype=to.prototype;function Mf(e,t,r){this.props=e,this.context=t,this.refs=ym,this.updater=r||mm}var Uf=Mf.prototype=new _m;Uf.constructor=Mf,gm(Uf,to.prototype),Uf.isPureReactComponent=!0;var bm=Array.isArray,Oe={H:null,A:null,T:null,S:null,V:null},wm=Object.prototype.hasOwnProperty;function Pf(e,t,r,n,i,s){return r=s.ref,{$$typeof:Lf,type:e,key:t,ref:r!==void 0?r:null,props:s}}function gS(e,t){return Pf(e.type,t,void 0,void 0,void 0,e.props)}function Ff(e){return typeof e=="object"&&e!==null&&e.$$typeof===Lf}function yS(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var vm=/\/+/g;function $f(e,t){return typeof e=="object"&&e!==null&&e.key!=null?yS(""+e.key):t.toString(36)}function Em(){}function _S(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(Em,Em):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function eo(e,t,r,n,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Lf:case oS:o=!0;break;case dm:return o=e._init,eo(o(e._payload),t,r,n,i)}}if(o)return i=i(e),o=n===""?"."+$f(e,0):n,bm(i)?(r="",o!=null&&(r=o.replace(vm,"$&/")+"/"),eo(i,t,r,"",function(u){return u})):i!=null&&(Ff(i)&&(i=gS(i,r+(i.key==null||e&&e.key===i.key?"":(""+i.key).replace(vm,"$&/")+"/")+o)),t.push(i)),1;o=0;var a=n===""?".":n+":";if(bm(e))for(var c=0;c<e.length;c++)n=e[c],s=a+$f(n,c),o+=eo(n,t,r,s,i);else if(c=mS(e),typeof c=="function")for(e=c.call(e),c=0;!(n=e.next()).done;)n=n.value,s=a+$f(n,c++),o+=eo(n,t,r,s,i);else if(s==="object"){if(typeof e.then=="function")return eo(_S(e),t,r,n,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return o}function Cc(e,t,r){if(e==null)return e;var n=[],i=0;return eo(e,n,"","",function(s){return t.call(r,s,i++)}),n}function bS(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var km=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof Mn=="object"&&typeof Mn.emit=="function"){Mn.emit("uncaughtException",e);return}console.error(e)};function wS(){}re.Children={map:Cc,forEach:function(e,t,r){Cc(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return Cc(e,function(){t++}),t},toArray:function(e){return Cc(e,function(t){return t})||[]},only:function(e){if(!Ff(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},re.Component=to,re.Fragment=aS,re.Profiler=lS,re.PureComponent=Mf,re.StrictMode=cS,re.Suspense=dS,re.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Oe,re.__COMPILER_RUNTIME={__proto__:null,c:function(e){return Oe.H.useMemoCache(e)}},re.cache=function(e){return function(){return e.apply(null,arguments)}},re.cloneElement=function(e,t,r){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var n=gm({},e.props),i=e.key,s=void 0;if(t!=null)for(o in t.ref!==void 0&&(s=void 0),t.key!==void 0&&(i=""+t.key),t)!wm.call(t,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&t.ref===void 0||(n[o]=t[o]);var o=arguments.length-2;if(o===1)n.children=r;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];n.children=a}return Pf(e.type,i,void 0,void 0,s,n)},re.createContext=function(e){return e={$$typeof:fS,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:uS,_context:e},e},re.createElement=function(e,t,r){var n,i={},s=null;if(t!=null)for(n in t.key!==void 0&&(s=""+t.key),t)wm.call(t,n)&&n!=="key"&&n!=="__self"&&n!=="__source"&&(i[n]=t[n]);var o=arguments.length-2;if(o===1)i.children=r;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(e&&e.defaultProps)for(n in o=e.defaultProps,o)i[n]===void 0&&(i[n]=o[n]);return Pf(e,s,void 0,void 0,null,i)},re.createRef=function(){return{current:null}},re.forwardRef=function(e){return{$$typeof:hS,render:e}},re.isValidElement=Ff,re.lazy=function(e){return{$$typeof:dm,_payload:{_status:-1,_result:e},_init:bS}},re.memo=function(e,t){return{$$typeof:pS,type:e,compare:t===void 0?null:t}},re.startTransition=function(e){var t=Oe.T,r={};Oe.T=r;try{var n=e(),i=Oe.S;i!==null&&i(r,n),typeof n=="object"&&n!==null&&typeof n.then=="function"&&n.then(wS,km)}catch(s){km(s)}finally{Oe.T=t}},re.unstable_useCacheRefresh=function(){return Oe.H.useCacheRefresh()},re.use=function(e){return Oe.H.use(e)},re.useActionState=function(e,t,r){return Oe.H.useActionState(e,t,r)},re.useCallback=function(e,t){return Oe.H.useCallback(e,t)},re.useContext=function(e){return Oe.H.useContext(e)},re.useDebugValue=function(){},re.useDeferredValue=function(e,t){return Oe.H.useDeferredValue(e,t)},re.useEffect=function(e,t,r){var n=Oe.H;if(typeof r=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return n.useEffect(e,t)},re.useId=function(){return Oe.H.useId()},re.useImperativeHandle=function(e,t,r){return Oe.H.useImperativeHandle(e,t,r)},re.useInsertionEffect=function(e,t){return Oe.H.useInsertionEffect(e,t)},re.useLayoutEffect=function(e,t){return Oe.H.useLayoutEffect(e,t)},re.useMemo=function(e,t){return Oe.H.useMemo(e,t)},re.useOptimistic=function(e,t){return Oe.H.useOptimistic(e,t)},re.useReducer=function(e,t,r){return Oe.H.useReducer(e,t,r)},re.useRef=function(e){return Oe.H.useRef(e)},re.useState=function(e){return Oe.H.useState(e)},re.useSyncExternalStore=function(e,t,r){return Oe.H.useSyncExternalStore(e,t,r)},re.useTransition=function(){return Oe.H.useTransition()},re.version="19.1.1";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const xm="0123456789abcdef",Am=[],Lc=[];for(let e=0;e<256;e++)Am[e]=xm[e>>4&15]+xm[e&15],e<16&&(e<10?Lc[48+e]=e:Lc[87+e]=e);const Tm=e=>{const t=e.length;let r="",n=0;for(;n<t;)r+=Am[e[n++]];return r},Mc=e=>{const t=e.length>>1,r=t<<1,n=new Uint8Array(t);let i=0,s=0;for(;s<r;)n[i++]=Lc[e.charCodeAt(s++)]<<4|Lc[e.charCodeAt(s++)];return n};for(var Sm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vS=typeof Uint8Array>"u"?[]:new Uint8Array(256),Uc=0;Uc<Sm.length;Uc++)vS[Sm.charCodeAt(Uc)]=Uc;new TextDecoder,new TextEncoder;const Rm=typeof window<"u"?window:self,Om=Rm.crypto||Rm.msCrypto||{};Om.subtle||Om.webkitSubtle;const ro=globalThis||void 0||self,Un=()=>new Map,Bf=e=>{const t=Un();return e.forEach((r,n)=>{t.set(n,r)}),t},zi=(e,t,r)=>{let n=e.get(t);return n===void 0&&e.set(t,n=r()),n},ES=(e,t)=>{const r=[];for(const[n,i]of e)r.push(t(i,n));return r},kS=(e,t)=>{for(const[r,n]of e)if(t(n,r))return!0;return!1},no=()=>new Set,Df=e=>e[e.length-1],xS=(e,t)=>{for(let r=0;r<t.length;r++)e.push(t[r])},_s=Array.from,AS=Array.isArray;class TS{constructor(){this._observers=Un()}on(t,r){return zi(this._observers,t,no).add(r),r}once(t,r){const n=(...i)=>{this.off(t,n),r(...i)};this.on(t,n)}off(t,r){const n=this._observers.get(t);n!==void 0&&(n.delete(r),n.size===0&&this._observers.delete(t))}emit(t,r){return _s((this._observers.get(t)||Un()).values()).forEach(n=>n(...r))}destroy(){this._observers=Un()}}const Wi=Math.floor,Pc=Math.abs,Im=(e,t)=>e<t?e:t,bs=(e,t)=>e>t?e:t,Nm=e=>e!==0?e<0:1/e<0,Cm=1,Lm=2,jf=4,zf=8,oa=32,Ei=64,sn=128,Fc=31,Wf=63,ws=127,SS=2147483647,Mm=Number.MAX_SAFE_INTEGER,RS=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Wi(e)===e),OS=e=>e.toLowerCase(),IS=/^\s*/g,NS=e=>e.replace(IS,""),CS=/([A-Z])/g,Um=(e,t)=>NS(e.replace(CS,r=>`${t}${OS(r)}`)),LS=e=>{const t=unescape(encodeURIComponent(e)),r=t.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=t.codePointAt(i);return n},aa=typeof TextEncoder<"u"?new TextEncoder:null,MS=aa?e=>aa.encode(e):LS;let ca=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ca&&ca.decode(new Uint8Array).length===1&&(ca=null);class la{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const $c=()=>new la,US=e=>{let t=e.cpos;for(let r=0;r<e.bufs.length;r++)t+=e.bufs[r].length;return t},Jn=e=>{const t=new Uint8Array(US(e));let r=0;for(let n=0;n<e.bufs.length;n++){const i=e.bufs[n];t.set(i,r),r+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),r),t},PS=(e,t)=>{const r=e.cbuf.length;r-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(bs(r,t)*2),e.cpos=0)},lr=(e,t)=>{const r=e.cbuf.length;e.cpos===r&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(r*2),e.cpos=0),e.cbuf[e.cpos++]=t},Hf=lr,de=(e,t)=>{for(;t>ws;)lr(e,sn|ws&t),t=Wi(t/128);lr(e,ws&t)},Gf=(e,t)=>{const r=Nm(t);for(r&&(t=-t),lr(e,(t>Wf?sn:0)|(r?Ei:0)|Wf&t),t=Wi(t/64);t>0;)lr(e,(t>ws?sn:0)|ws&t),t=Wi(t/128)},Kf=new Uint8Array(3e4),FS=Kf.length/3,$S=(e,t)=>{if(t.length<FS){const r=aa.encodeInto(t,Kf).written||0;de(e,r);for(let n=0;n<r;n++)lr(e,Kf[n])}else on(e,MS(t))},BS=(e,t)=>{const r=unescape(encodeURIComponent(t)),n=r.length;de(e,n);for(let i=0;i<n;i++)lr(e,r.codePointAt(i))},io=aa&&aa.encodeInto?$S:BS,Bc=(e,t)=>{const r=e.cbuf.length,n=e.cpos,i=Im(r-n,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),n),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(bs(r*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},on=(e,t)=>{de(e,t.byteLength),Bc(e,t)},Yf=(e,t)=>{PS(e,t);const r=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,r},DS=(e,t)=>Yf(e,4).setFloat32(0,t,!1),jS=(e,t)=>Yf(e,8).setFloat64(0,t,!1),zS=(e,t)=>Yf(e,8).setBigInt64(0,t,!1),Pm=new DataView(new ArrayBuffer(4)),WS=e=>(Pm.setFloat32(0,e),Pm.getFloat32(0)===e),ua=(e,t)=>{switch(typeof t){case"string":lr(e,119),io(e,t);break;case"number":RS(t)&&Pc(t)<=SS?(lr(e,125),Gf(e,t)):WS(t)?(lr(e,124),DS(e,t)):(lr(e,123),jS(e,t));break;case"bigint":lr(e,122),zS(e,t);break;case"object":if(t===null)lr(e,126);else if(AS(t)){lr(e,117),de(e,t.length);for(let r=0;r<t.length;r++)ua(e,t[r])}else if(t instanceof Uint8Array)lr(e,116),on(e,t);else{lr(e,118);const r=Object.keys(t);de(e,r.length);for(let n=0;n<r.length;n++){const i=r[n];io(e,i),ua(e,t[i])}}break;case"boolean":lr(e,t?120:121);break;default:lr(e,127)}};class Fm extends la{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&de(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const $m=e=>{e.count>0&&(Gf(e.encoder,e.count===1?e.s:-e.s),e.count>1&&de(e.encoder,e.count-2))};class Dc{constructor(){this.encoder=new la,this.s=0,this.count=0}write(t){this.s===t?this.count++:($m(this),this.count=1,this.s=t)}toUint8Array(){return $m(this),Jn(this.encoder)}}const Bm=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);Gf(e.encoder,t),e.count>1&&de(e.encoder,e.count-2)}};class qf{constructor(){this.encoder=new la,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Bm(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Bm(this),Jn(this.encoder)}}class HS{constructor(){this.sarr=[],this.s="",this.lensE=new Dc}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new la;return this.sarr.push(this.s),this.s="",io(t,this.sarr.join("")),Bc(t,this.lensE.toUint8Array()),Jn(t)}}const Hi=e=>new Error(e),Zn=()=>{throw Hi("Method unimplemented")},Qn=()=>{throw Hi("Unexpected case")},Dm=Hi("Unexpected end of array"),jm=Hi("Integer out of Range");class jc{constructor(t){this.arr=t,this.pos=0}}const so=e=>new jc(e),GS=e=>e.pos!==e.arr.length,KS=(e,t)=>{const r=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,r},an=e=>KS(e,ie(e)),oo=e=>e.arr[e.pos++],ie=e=>{let t=0,r=1;const n=e.arr.length;for(;e.pos<n;){const i=e.arr[e.pos++];if(t=t+(i&ws)*r,r*=128,i<sn)return t;if(t>Mm)throw jm}throw Dm},Vf=e=>{let t=e.arr[e.pos++],r=t&Wf,n=64;const i=(t&Ei)>0?-1:1;if(!(t&sn))return i*r;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],r=r+(t&ws)*n,n*=128,t<sn)return i*r;if(r>Mm)throw jm}throw Dm},ao=ca?e=>ca.decode(an(e)):e=>{let t=ie(e);if(t===0)return"";{let r=String.fromCodePoint(oo(e));if(--t<100)for(;t--;)r+=String.fromCodePoint(oo(e));else for(;t>0;){const n=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+n);e.pos+=n,r+=String.fromCodePoint.apply(null,i),t-=n}return decodeURIComponent(escape(r))}},Xf=(e,t)=>{const r=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,r},YS=[e=>{},e=>null,Vf,e=>Xf(e,4).getFloat32(0,!1),e=>Xf(e,8).getFloat64(0,!1),e=>Xf(e,8).getBigInt64(0,!1),e=>!1,e=>!0,ao,e=>{const t=ie(e),r={};for(let n=0;n<t;n++){const i=ao(e);r[i]=fa(e)}return r},e=>{const t=ie(e),r=[];for(let n=0;n<t;n++)r.push(fa(e));return r},an],fa=e=>YS[127-oo(e)](e);class zm extends jc{constructor(t,r){super(t),this.reader=r,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),GS(this)?this.count=ie(this)+1:this.count=-1),this.count--,this.s}}class zc extends jc{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Vf(this);const t=Nm(this.s);this.count=1,t&&(this.s=-this.s,this.count=ie(this)+2)}return this.count--,this.s}}class Jf extends jc{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Vf(this),r=t&1;this.diff=Wi(t/2),this.count=1,r&&(this.count=ie(this)+2)}return this.s+=this.diff,this.count--,this.s}}class qS{constructor(t){this.decoder=new zc(t),this.str=ao(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),r=this.str.slice(this.spos,t);return this.spos=t,r}}const VS=crypto.getRandomValues.bind(crypto),Wm=()=>VS(new Uint32Array(1))[0],XS="10000000-1000-4000-8000"+-1e11,JS=()=>XS.replace(/[018]/g,e=>(e^Wm()&15>>e/4).toString(16)),Hm=e=>new Promise(e);Promise.all.bind(Promise);var Gm={},Wc={};Wc.byteLength=tR,Wc.toByteArray=rR,Wc.fromByteArray=sR;for(var ti=[],mn=[],ZS=typeof Uint8Array<"u"?Uint8Array:Array,Zf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",co=0,QS=Zf.length;co<QS;++co)ti[co]=Zf[co],mn[Zf.charCodeAt(co)]=co;mn[45]=62,mn[95]=63;function Km(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");r===-1&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function tR(e){var t=Km(e),r=t[0],n=t[1];return(r+n)*3/4-n}function eR(e,t,r){return(t+r)*3/4-r}function rR(e){var t,r=Km(e),n=r[0],i=r[1],s=new ZS(eR(e,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)t=mn[e.charCodeAt(c)]<<18|mn[e.charCodeAt(c+1)]<<12|mn[e.charCodeAt(c+2)]<<6|mn[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=mn[e.charCodeAt(c)]<<2|mn[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=mn[e.charCodeAt(c)]<<10|mn[e.charCodeAt(c+1)]<<4|mn[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function nR(e){return ti[e>>18&63]+ti[e>>12&63]+ti[e>>6&63]+ti[e&63]}function iR(e,t,r){for(var n,i=[],s=t;s<r;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(nR(n));return i.join("")}function sR(e){for(var t,r=e.length,n=r%3,i=[],s=16383,o=0,a=r-n;o<a;o+=s)i.push(iR(e,o,o+s>a?a:o+s));return n===1?(t=e[r-1],i.push(ti[t>>2]+ti[t<<4&63]+"==")):n===2&&(t=(e[r-2]<<8)+e[r-1],i.push(ti[t>>10]+ti[t>>4&63]+ti[t<<2&63]+"=")),i.join("")}var Qf={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Qf.read=function(e,t,r,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,u=c>>1,l=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,s=f&(1<<-l)-1,f>>=-l,l+=a;l>0;s=s*256+e[t+h],h+=d,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=n;l>0;o=o*256+e[t+h],h+=d,l-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-u}return(f?-1:1)*o*Math.pow(2,s-n)},Qf.write=function(e,t,r,n,i,s){var o,a,c,u=s*8-i-1,l=(1<<u)-1,h=l>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,m=n?1:-1,p=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?t+=d/c:t+=d*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=l?(a=0,o=l):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o=o+h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=a&255,f+=m,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[r+f]=o&255,f+=m,o/=256,u-=8);e[r+f-m]|=p*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=Wc,r=Qf,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=l,e.SlowBuffer=x,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const C=new s(1),_={foo:function(){return 42}};return Object.setPrototypeOf(_,s.prototype),Object.setPrototypeOf(C,_),C.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function u(C){if(C>i)throw new RangeError('The value "'+C+'" is invalid for option "size"');const _=new s(C);return Object.setPrototypeOf(_,l.prototype),_}function l(C,_,v){if(typeof C=="number"){if(typeof _=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(C)}return h(C,_,v)}l.poolSize=8192;function h(C,_,v){if(typeof C=="string")return p(C,_);if(o.isView(C))return y(C);if(C==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof C);if(gt(C,o)||C&&gt(C.buffer,o)||typeof a<"u"&&(gt(C,a)||C&&gt(C.buffer,a)))return b(C,_,v);if(typeof C=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const F=C.valueOf&&C.valueOf();if(F!=null&&F!==C)return l.from(F,_,v);const Y=T(C);if(Y)return Y;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof C[Symbol.toPrimitive]=="function")return l.from(C[Symbol.toPrimitive]("string"),_,v);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof C)}l.from=function(C,_,v){return h(C,_,v)},Object.setPrototypeOf(l.prototype,s.prototype),Object.setPrototypeOf(l,s);function d(C){if(typeof C!="number")throw new TypeError('"size" argument must be of type number');if(C<0)throw new RangeError('The value "'+C+'" is invalid for option "size"')}function f(C,_,v){return d(C),C<=0?u(C):_!==void 0?typeof v=="string"?u(C).fill(_,v):u(C).fill(_):u(C)}l.alloc=function(C,_,v){return f(C,_,v)};function m(C){return d(C),u(C<0?0:A(C)|0)}l.allocUnsafe=function(C){return m(C)},l.allocUnsafeSlow=function(C){return m(C)};function p(C,_){if((typeof _!="string"||_==="")&&(_="utf8"),!l.isEncoding(_))throw new TypeError("Unknown encoding: "+_);const v=I(C,_)|0;let F=u(v);const Y=F.write(C,_);return Y!==v&&(F=F.slice(0,Y)),F}function g(C){const _=C.length<0?0:A(C.length)|0,v=u(_);for(let F=0;F<_;F+=1)v[F]=C[F]&255;return v}function y(C){if(gt(C,s)){const _=new s(C);return b(_.buffer,_.byteOffset,_.byteLength)}return g(C)}function b(C,_,v){if(_<0||C.byteLength<_)throw new RangeError('"offset" is outside of buffer bounds');if(C.byteLength<_+(v||0))throw new RangeError('"length" is outside of buffer bounds');let F;return _===void 0&&v===void 0?F=new s(C):v===void 0?F=new s(C,_):F=new s(C,_,v),Object.setPrototypeOf(F,l.prototype),F}function T(C){if(l.isBuffer(C)){const _=A(C.length)|0,v=u(_);return v.length===0||C.copy(v,0,0,_),v}if(C.length!==void 0)return typeof C.length!="number"||Ft(C.length)?u(0):g(C);if(C.type==="Buffer"&&Array.isArray(C.data))return g(C.data)}function A(C){if(C>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return C|0}function x(C){return+C!=C&&(C=0),l.alloc(+C)}l.isBuffer=function(_){return _!=null&&_._isBuffer===!0&&_!==l.prototype},l.compare=function(_,v){if(gt(_,s)&&(_=l.from(_,_.offset,_.byteLength)),gt(v,s)&&(v=l.from(v,v.offset,v.byteLength)),!l.isBuffer(_)||!l.isBuffer(v))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(_===v)return 0;let F=_.length,Y=v.length;for(let at=0,D=Math.min(F,Y);at<D;++at)if(_[at]!==v[at]){F=_[at],Y=v[at];break}return F<Y?-1:Y<F?1:0},l.isEncoding=function(_){switch(String(_).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(_,v){if(!Array.isArray(_))throw new TypeError('"list" argument must be an Array of Buffers');if(_.length===0)return l.alloc(0);let F;if(v===void 0)for(v=0,F=0;F<_.length;++F)v+=_[F].length;const Y=l.allocUnsafe(v);let at=0;for(F=0;F<_.length;++F){let D=_[F];if(gt(D,s))at+D.length>Y.length?(l.isBuffer(D)||(D=l.from(D)),D.copy(Y,at)):s.prototype.set.call(Y,D,at);else if(l.isBuffer(D))D.copy(Y,at);else throw new TypeError('"list" argument must be an Array of Buffers');at+=D.length}return Y};function I(C,_){if(l.isBuffer(C))return C.length;if(o.isView(C)||gt(C,o))return C.byteLength;if(typeof C!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof C);const v=C.length,F=arguments.length>2&&arguments[2]===!0;if(!F&&v===0)return 0;let Y=!1;for(;;)switch(_){case"ascii":case"latin1":case"binary":return v;case"utf8":case"utf-8":return dt(C).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v*2;case"hex":return v>>>1;case"base64":return _t(C).length;default:if(Y)return F?-1:dt(C).length;_=(""+_).toLowerCase(),Y=!0}}l.byteLength=I;function R(C,_,v){let F=!1;if((_===void 0||_<0)&&(_=0),_>this.length||((v===void 0||v>this.length)&&(v=this.length),v<=0)||(v>>>=0,_>>>=0,v<=_))return"";for(C||(C="utf8");;)switch(C){case"hex":return P(this,_,v);case"utf8":case"utf-8":return U(this,_,v);case"ascii":return K(this,_,v);case"latin1":case"binary":return W(this,_,v);case"base64":return j(this,_,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return st(this,_,v);default:if(F)throw new TypeError("Unknown encoding: "+C);C=(C+"").toLowerCase(),F=!0}}l.prototype._isBuffer=!0;function $(C,_,v){const F=C[_];C[_]=C[v],C[v]=F}l.prototype.swap16=function(){const _=this.length;if(_%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let v=0;v<_;v+=2)$(this,v,v+1);return this},l.prototype.swap32=function(){const _=this.length;if(_%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let v=0;v<_;v+=4)$(this,v,v+3),$(this,v+1,v+2);return this},l.prototype.swap64=function(){const _=this.length;if(_%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let v=0;v<_;v+=8)$(this,v,v+7),$(this,v+1,v+6),$(this,v+2,v+5),$(this,v+3,v+4);return this},l.prototype.toString=function(){const _=this.length;return _===0?"":arguments.length===0?U(this,0,_):R.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(_){if(!l.isBuffer(_))throw new TypeError("Argument must be a Buffer");return this===_?!0:l.compare(this,_)===0},l.prototype.inspect=function(){let _="";const v=e.INSPECT_MAX_BYTES;return _=this.toString("hex",0,v).replace(/(.{2})/g,"$1 ").trim(),this.length>v&&(_+=" ... "),"<Buffer "+_+">"},n&&(l.prototype[n]=l.prototype.inspect),l.prototype.compare=function(_,v,F,Y,at){if(gt(_,s)&&(_=l.from(_,_.offset,_.byteLength)),!l.isBuffer(_))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof _);if(v===void 0&&(v=0),F===void 0&&(F=_?_.length:0),Y===void 0&&(Y=0),at===void 0&&(at=this.length),v<0||F>_.length||Y<0||at>this.length)throw new RangeError("out of range index");if(Y>=at&&v>=F)return 0;if(Y>=at)return-1;if(v>=F)return 1;if(v>>>=0,F>>>=0,Y>>>=0,at>>>=0,this===_)return 0;let D=at-Y,Z=F-v;const Bt=Math.min(D,Z),jt=this.slice(Y,at),Gt=_.slice(v,F);for(let Ot=0;Ot<Bt;++Ot)if(jt[Ot]!==Gt[Ot]){D=jt[Ot],Z=Gt[Ot];break}return D<Z?-1:Z<D?1:0};function M(C,_,v,F,Y){if(C.length===0)return-1;if(typeof v=="string"?(F=v,v=0):v>2147483647?v=2147483647:v<-2147483648&&(v=-2147483648),v=+v,Ft(v)&&(v=Y?0:C.length-1),v<0&&(v=C.length+v),v>=C.length){if(Y)return-1;v=C.length-1}else if(v<0)if(Y)v=0;else return-1;if(typeof _=="string"&&(_=l.from(_,F)),l.isBuffer(_))return _.length===0?-1:H(C,_,v,F,Y);if(typeof _=="number")return _=_&255,typeof s.prototype.indexOf=="function"?Y?s.prototype.indexOf.call(C,_,v):s.prototype.lastIndexOf.call(C,_,v):H(C,[_],v,F,Y);throw new TypeError("val must be string, number or Buffer")}function H(C,_,v,F,Y){let at=1,D=C.length,Z=_.length;if(F!==void 0&&(F=String(F).toLowerCase(),F==="ucs2"||F==="ucs-2"||F==="utf16le"||F==="utf-16le")){if(C.length<2||_.length<2)return-1;at=2,D/=2,Z/=2,v/=2}function Bt(Gt,Ot){return at===1?Gt[Ot]:Gt.readUInt16BE(Ot*at)}let jt;if(Y){let Gt=-1;for(jt=v;jt<D;jt++)if(Bt(C,jt)===Bt(_,Gt===-1?0:jt-Gt)){if(Gt===-1&&(Gt=jt),jt-Gt+1===Z)return Gt*at}else Gt!==-1&&(jt-=jt-Gt),Gt=-1}else for(v+Z>D&&(v=D-Z),jt=v;jt>=0;jt--){let Gt=!0;for(let Ot=0;Ot<Z;Ot++)if(Bt(C,jt+Ot)!==Bt(_,Ot)){Gt=!1;break}if(Gt)return jt}return-1}l.prototype.includes=function(_,v,F){return this.indexOf(_,v,F)!==-1},l.prototype.indexOf=function(_,v,F){return M(this,_,v,F,!0)},l.prototype.lastIndexOf=function(_,v,F){return M(this,_,v,F,!1)};function X(C,_,v,F){v=Number(v)||0;const Y=C.length-v;F?(F=Number(F),F>Y&&(F=Y)):F=Y;const at=_.length;F>at/2&&(F=at/2);let D;for(D=0;D<F;++D){const Z=parseInt(_.substr(D*2,2),16);if(Ft(Z))return D;C[v+D]=Z}return D}function O(C,_,v,F){return Rt(dt(_,C.length-v),C,v,F)}function N(C,_,v,F){return Rt(pt(_),C,v,F)}function E(C,_,v,F){return Rt(_t(_),C,v,F)}function L(C,_,v,F){return Rt(it(_,C.length-v),C,v,F)}l.prototype.write=function(_,v,F,Y){if(v===void 0)Y="utf8",F=this.length,v=0;else if(F===void 0&&typeof v=="string")Y=v,F=this.length,v=0;else if(isFinite(v))v=v>>>0,isFinite(F)?(F=F>>>0,Y===void 0&&(Y="utf8")):(Y=F,F=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const at=this.length-v;if((F===void 0||F>at)&&(F=at),_.length>0&&(F<0||v<0)||v>this.length)throw new RangeError("Attempt to write outside buffer bounds");Y||(Y="utf8");let D=!1;for(;;)switch(Y){case"hex":return X(this,_,v,F);case"utf8":case"utf-8":return O(this,_,v,F);case"ascii":case"latin1":case"binary":return N(this,_,v,F);case"base64":return E(this,_,v,F);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,_,v,F);default:if(D)throw new TypeError("Unknown encoding: "+Y);Y=(""+Y).toLowerCase(),D=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function j(C,_,v){return _===0&&v===C.length?t.fromByteArray(C):t.fromByteArray(C.slice(_,v))}function U(C,_,v){v=Math.min(C.length,v);const F=[];let Y=_;for(;Y<v;){const at=C[Y];let D=null,Z=at>239?4:at>223?3:at>191?2:1;if(Y+Z<=v){let Bt,jt,Gt,Ot;switch(Z){case 1:at<128&&(D=at);break;case 2:Bt=C[Y+1],(Bt&192)===128&&(Ot=(at&31)<<6|Bt&63,Ot>127&&(D=Ot));break;case 3:Bt=C[Y+1],jt=C[Y+2],(Bt&192)===128&&(jt&192)===128&&(Ot=(at&15)<<12|(Bt&63)<<6|jt&63,Ot>2047&&(Ot<55296||Ot>57343)&&(D=Ot));break;case 4:Bt=C[Y+1],jt=C[Y+2],Gt=C[Y+3],(Bt&192)===128&&(jt&192)===128&&(Gt&192)===128&&(Ot=(at&15)<<18|(Bt&63)<<12|(jt&63)<<6|Gt&63,Ot>65535&&Ot<1114112&&(D=Ot))}}D===null?(D=65533,Z=1):D>65535&&(D-=65536,F.push(D>>>10&1023|55296),D=56320|D&1023),F.push(D),Y+=Z}return Q(F)}const V=4096;function Q(C){const _=C.length;if(_<=V)return String.fromCharCode.apply(String,C);let v="",F=0;for(;F<_;)v+=String.fromCharCode.apply(String,C.slice(F,F+=V));return v}function K(C,_,v){let F="";v=Math.min(C.length,v);for(let Y=_;Y<v;++Y)F+=String.fromCharCode(C[Y]&127);return F}function W(C,_,v){let F="";v=Math.min(C.length,v);for(let Y=_;Y<v;++Y)F+=String.fromCharCode(C[Y]);return F}function P(C,_,v){const F=C.length;(!_||_<0)&&(_=0),(!v||v<0||v>F)&&(v=F);let Y="";for(let at=_;at<v;++at)Y+=ye[C[at]];return Y}function st(C,_,v){const F=C.slice(_,v);let Y="";for(let at=0;at<F.length-1;at+=2)Y+=String.fromCharCode(F[at]+F[at+1]*256);return Y}l.prototype.slice=function(_,v){const F=this.length;_=~~_,v=v===void 0?F:~~v,_<0?(_+=F,_<0&&(_=0)):_>F&&(_=F),v<0?(v+=F,v<0&&(v=0)):v>F&&(v=F),v<_&&(v=_);const Y=this.subarray(_,v);return Object.setPrototypeOf(Y,l.prototype),Y};function G(C,_,v){if(C%1!==0||C<0)throw new RangeError("offset is not uint");if(C+_>v)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(_,v,F){_=_>>>0,v=v>>>0,F||G(_,v,this.length);let Y=this[_],at=1,D=0;for(;++D<v&&(at*=256);)Y+=this[_+D]*at;return Y},l.prototype.readUintBE=l.prototype.readUIntBE=function(_,v,F){_=_>>>0,v=v>>>0,F||G(_,v,this.length);let Y=this[_+--v],at=1;for(;v>0&&(at*=256);)Y+=this[_+--v]*at;return Y},l.prototype.readUint8=l.prototype.readUInt8=function(_,v){return _=_>>>0,v||G(_,1,this.length),this[_]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(_,v){return _=_>>>0,v||G(_,2,this.length),this[_]|this[_+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(_,v){return _=_>>>0,v||G(_,2,this.length),this[_]<<8|this[_+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(_,v){return _=_>>>0,v||G(_,4,this.length),(this[_]|this[_+1]<<8|this[_+2]<<16)+this[_+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(_,v){return _=_>>>0,v||G(_,4,this.length),this[_]*16777216+(this[_+1]<<16|this[_+2]<<8|this[_+3])},l.prototype.readBigUInt64LE=Jt(function(_){_=_>>>0,ct(_,"offset");const v=this[_],F=this[_+7];(v===void 0||F===void 0)&&z(_,this.length-8);const Y=v+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24,at=this[++_]+this[++_]*2**8+this[++_]*2**16+F*2**24;return BigInt(Y)+(BigInt(at)<<BigInt(32))}),l.prototype.readBigUInt64BE=Jt(function(_){_=_>>>0,ct(_,"offset");const v=this[_],F=this[_+7];(v===void 0||F===void 0)&&z(_,this.length-8);const Y=v*2**24+this[++_]*2**16+this[++_]*2**8+this[++_],at=this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+F;return(BigInt(Y)<<BigInt(32))+BigInt(at)}),l.prototype.readIntLE=function(_,v,F){_=_>>>0,v=v>>>0,F||G(_,v,this.length);let Y=this[_],at=1,D=0;for(;++D<v&&(at*=256);)Y+=this[_+D]*at;return at*=128,Y>=at&&(Y-=Math.pow(2,8*v)),Y},l.prototype.readIntBE=function(_,v,F){_=_>>>0,v=v>>>0,F||G(_,v,this.length);let Y=v,at=1,D=this[_+--Y];for(;Y>0&&(at*=256);)D+=this[_+--Y]*at;return at*=128,D>=at&&(D-=Math.pow(2,8*v)),D},l.prototype.readInt8=function(_,v){return _=_>>>0,v||G(_,1,this.length),this[_]&128?(255-this[_]+1)*-1:this[_]},l.prototype.readInt16LE=function(_,v){_=_>>>0,v||G(_,2,this.length);const F=this[_]|this[_+1]<<8;return F&32768?F|4294901760:F},l.prototype.readInt16BE=function(_,v){_=_>>>0,v||G(_,2,this.length);const F=this[_+1]|this[_]<<8;return F&32768?F|4294901760:F},l.prototype.readInt32LE=function(_,v){return _=_>>>0,v||G(_,4,this.length),this[_]|this[_+1]<<8|this[_+2]<<16|this[_+3]<<24},l.prototype.readInt32BE=function(_,v){return _=_>>>0,v||G(_,4,this.length),this[_]<<24|this[_+1]<<16|this[_+2]<<8|this[_+3]},l.prototype.readBigInt64LE=Jt(function(_){_=_>>>0,ct(_,"offset");const v=this[_],F=this[_+7];(v===void 0||F===void 0)&&z(_,this.length-8);const Y=this[_+4]+this[_+5]*2**8+this[_+6]*2**16+(F<<24);return(BigInt(Y)<<BigInt(32))+BigInt(v+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24)}),l.prototype.readBigInt64BE=Jt(function(_){_=_>>>0,ct(_,"offset");const v=this[_],F=this[_+7];(v===void 0||F===void 0)&&z(_,this.length-8);const Y=(v<<24)+this[++_]*2**16+this[++_]*2**8+this[++_];return(BigInt(Y)<<BigInt(32))+BigInt(this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+F)}),l.prototype.readFloatLE=function(_,v){return _=_>>>0,v||G(_,4,this.length),r.read(this,_,!0,23,4)},l.prototype.readFloatBE=function(_,v){return _=_>>>0,v||G(_,4,this.length),r.read(this,_,!1,23,4)},l.prototype.readDoubleLE=function(_,v){return _=_>>>0,v||G(_,8,this.length),r.read(this,_,!0,52,8)},l.prototype.readDoubleBE=function(_,v){return _=_>>>0,v||G(_,8,this.length),r.read(this,_,!1,52,8)};function rt(C,_,v,F,Y,at){if(!l.isBuffer(C))throw new TypeError('"buffer" argument must be a Buffer instance');if(_>Y||_<at)throw new RangeError('"value" argument is out of bounds');if(v+F>C.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(_,v,F,Y){if(_=+_,v=v>>>0,F=F>>>0,!Y){const Z=Math.pow(2,8*F)-1;rt(this,_,v,F,Z,0)}let at=1,D=0;for(this[v]=_&255;++D<F&&(at*=256);)this[v+D]=_/at&255;return v+F},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(_,v,F,Y){if(_=+_,v=v>>>0,F=F>>>0,!Y){const Z=Math.pow(2,8*F)-1;rt(this,_,v,F,Z,0)}let at=F-1,D=1;for(this[v+at]=_&255;--at>=0&&(D*=256);)this[v+at]=_/D&255;return v+F},l.prototype.writeUint8=l.prototype.writeUInt8=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,1,255,0),this[v]=_&255,v+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,2,65535,0),this[v]=_&255,this[v+1]=_>>>8,v+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,2,65535,0),this[v]=_>>>8,this[v+1]=_&255,v+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,4,4294967295,0),this[v+3]=_>>>24,this[v+2]=_>>>16,this[v+1]=_>>>8,this[v]=_&255,v+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,4,4294967295,0),this[v]=_>>>24,this[v+1]=_>>>16,this[v+2]=_>>>8,this[v+3]=_&255,v+4};function wt(C,_,v,F,Y){ft(_,F,Y,C,v,7);let at=Number(_&BigInt(4294967295));C[v++]=at,at=at>>8,C[v++]=at,at=at>>8,C[v++]=at,at=at>>8,C[v++]=at;let D=Number(_>>BigInt(32)&BigInt(4294967295));return C[v++]=D,D=D>>8,C[v++]=D,D=D>>8,C[v++]=D,D=D>>8,C[v++]=D,v}function Tt(C,_,v,F,Y){ft(_,F,Y,C,v,7);let at=Number(_&BigInt(4294967295));C[v+7]=at,at=at>>8,C[v+6]=at,at=at>>8,C[v+5]=at,at=at>>8,C[v+4]=at;let D=Number(_>>BigInt(32)&BigInt(4294967295));return C[v+3]=D,D=D>>8,C[v+2]=D,D=D>>8,C[v+1]=D,D=D>>8,C[v]=D,v+8}l.prototype.writeBigUInt64LE=Jt(function(_,v=0){return wt(this,_,v,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Jt(function(_,v=0){return Tt(this,_,v,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(_,v,F,Y){if(_=+_,v=v>>>0,!Y){const Bt=Math.pow(2,8*F-1);rt(this,_,v,F,Bt-1,-Bt)}let at=0,D=1,Z=0;for(this[v]=_&255;++at<F&&(D*=256);)_<0&&Z===0&&this[v+at-1]!==0&&(Z=1),this[v+at]=(_/D>>0)-Z&255;return v+F},l.prototype.writeIntBE=function(_,v,F,Y){if(_=+_,v=v>>>0,!Y){const Bt=Math.pow(2,8*F-1);rt(this,_,v,F,Bt-1,-Bt)}let at=F-1,D=1,Z=0;for(this[v+at]=_&255;--at>=0&&(D*=256);)_<0&&Z===0&&this[v+at+1]!==0&&(Z=1),this[v+at]=(_/D>>0)-Z&255;return v+F},l.prototype.writeInt8=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,1,127,-128),_<0&&(_=255+_+1),this[v]=_&255,v+1},l.prototype.writeInt16LE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,2,32767,-32768),this[v]=_&255,this[v+1]=_>>>8,v+2},l.prototype.writeInt16BE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,2,32767,-32768),this[v]=_>>>8,this[v+1]=_&255,v+2},l.prototype.writeInt32LE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,4,2147483647,-2147483648),this[v]=_&255,this[v+1]=_>>>8,this[v+2]=_>>>16,this[v+3]=_>>>24,v+4},l.prototype.writeInt32BE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,4,2147483647,-2147483648),_<0&&(_=4294967295+_+1),this[v]=_>>>24,this[v+1]=_>>>16,this[v+2]=_>>>8,this[v+3]=_&255,v+4},l.prototype.writeBigInt64LE=Jt(function(_,v=0){return wt(this,_,v,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Jt(function(_,v=0){return Tt(this,_,v,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function It(C,_,v,F,Y,at){if(v+F>C.length)throw new RangeError("Index out of range");if(v<0)throw new RangeError("Index out of range")}function St(C,_,v,F,Y){return _=+_,v=v>>>0,Y||It(C,_,v,4),r.write(C,_,v,F,23,4),v+4}l.prototype.writeFloatLE=function(_,v,F){return St(this,_,v,!0,F)},l.prototype.writeFloatBE=function(_,v,F){return St(this,_,v,!1,F)};function Pt(C,_,v,F,Y){return _=+_,v=v>>>0,Y||It(C,_,v,8),r.write(C,_,v,F,52,8),v+8}l.prototype.writeDoubleLE=function(_,v,F){return Pt(this,_,v,!0,F)},l.prototype.writeDoubleBE=function(_,v,F){return Pt(this,_,v,!1,F)},l.prototype.copy=function(_,v,F,Y){if(!l.isBuffer(_))throw new TypeError("argument should be a Buffer");if(F||(F=0),!Y&&Y!==0&&(Y=this.length),v>=_.length&&(v=_.length),v||(v=0),Y>0&&Y<F&&(Y=F),Y===F||_.length===0||this.length===0)return 0;if(v<0)throw new RangeError("targetStart out of bounds");if(F<0||F>=this.length)throw new RangeError("Index out of range");if(Y<0)throw new RangeError("sourceEnd out of bounds");Y>this.length&&(Y=this.length),_.length-v<Y-F&&(Y=_.length-v+F);const at=Y-F;return this===_&&typeof s.prototype.copyWithin=="function"?this.copyWithin(v,F,Y):s.prototype.set.call(_,this.subarray(F,Y),v),at},l.prototype.fill=function(_,v,F,Y){if(typeof _=="string"){if(typeof v=="string"?(Y=v,v=0,F=this.length):typeof F=="string"&&(Y=F,F=this.length),Y!==void 0&&typeof Y!="string")throw new TypeError("encoding must be a string");if(typeof Y=="string"&&!l.isEncoding(Y))throw new TypeError("Unknown encoding: "+Y);if(_.length===1){const D=_.charCodeAt(0);(Y==="utf8"&&D<128||Y==="latin1")&&(_=D)}}else typeof _=="number"?_=_&255:typeof _=="boolean"&&(_=Number(_));if(v<0||this.length<v||this.length<F)throw new RangeError("Out of range index");if(F<=v)return this;v=v>>>0,F=F===void 0?this.length:F>>>0,_||(_=0);let at;if(typeof _=="number")for(at=v;at<F;++at)this[at]=_;else{const D=l.isBuffer(_)?_:l.from(_,Y),Z=D.length;if(Z===0)throw new TypeError('The value "'+_+'" is invalid for argument "value"');for(at=0;at<F-v;++at)this[at+v]=D[at%Z]}return this};const Mt={};function Vt(C,_,v){Mt[C]=class extends v{constructor(){super(),Object.defineProperty(this,"message",{value:_.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${C}]`,this.stack,delete this.name}get code(){return C}set code(Y){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Y,writable:!0})}toString(){return`${this.name} [${C}]: ${this.message}`}}}Vt("ERR_BUFFER_OUT_OF_BOUNDS",function(C){return C?`${C} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Vt("ERR_INVALID_ARG_TYPE",function(C,_){return`The "${C}" argument must be of type number. Received type ${typeof _}`},TypeError),Vt("ERR_OUT_OF_RANGE",function(C,_,v){let F=`The value of "${C}" is out of range.`,Y=v;return Number.isInteger(v)&&Math.abs(v)>2**32?Y=ee(String(v)):typeof v=="bigint"&&(Y=String(v),(v>BigInt(2)**BigInt(32)||v<-(BigInt(2)**BigInt(32)))&&(Y=ee(Y)),Y+="n"),F+=` It must be ${_}. Received ${Y}`,F},RangeError);function ee(C){let _="",v=C.length;const F=C[0]==="-"?1:0;for(;v>=F+4;v-=3)_=`_${C.slice(v-3,v)}${_}`;return`${C.slice(0,v)}${_}`}function S(C,_,v){ct(_,"offset"),(C[_]===void 0||C[_+v]===void 0)&&z(_,C.length-(v+1))}function ft(C,_,v,F,Y,at){if(C>v||C<_){const D=typeof _=="bigint"?"n":"";let Z;throw _===0||_===BigInt(0)?Z=`>= 0${D} and < 2${D} ** ${(at+1)*8}${D}`:Z=`>= -(2${D} ** ${(at+1)*8-1}${D}) and < 2 ** ${(at+1)*8-1}${D}`,new Mt.ERR_OUT_OF_RANGE("value",Z,C)}S(F,Y,at)}function ct(C,_){if(typeof C!="number")throw new Mt.ERR_INVALID_ARG_TYPE(_,"number",C)}function z(C,_,v){throw Math.floor(C)!==C?(ct(C,v),new Mt.ERR_OUT_OF_RANGE("offset","an integer",C)):_<0?new Mt.ERR_BUFFER_OUT_OF_BOUNDS:new Mt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${_}`,C)}const B=/[^+/0-9A-Za-z-_]/g;function tt(C){if(C=C.split("=")[0],C=C.trim().replace(B,""),C.length<2)return"";for(;C.length%4!==0;)C=C+"=";return C}function dt(C,_){_=_||1/0;let v;const F=C.length;let Y=null;const at=[];for(let D=0;D<F;++D){if(v=C.charCodeAt(D),v>55295&&v<57344){if(!Y){if(v>56319){(_-=3)>-1&&at.push(239,191,189);continue}else if(D+1===F){(_-=3)>-1&&at.push(239,191,189);continue}Y=v;continue}if(v<56320){(_-=3)>-1&&at.push(239,191,189),Y=v;continue}v=(Y-55296<<10|v-56320)+65536}else Y&&(_-=3)>-1&&at.push(239,191,189);if(Y=null,v<128){if((_-=1)<0)break;at.push(v)}else if(v<2048){if((_-=2)<0)break;at.push(v>>6|192,v&63|128)}else if(v<65536){if((_-=3)<0)break;at.push(v>>12|224,v>>6&63|128,v&63|128)}else if(v<1114112){if((_-=4)<0)break;at.push(v>>18|240,v>>12&63|128,v>>6&63|128,v&63|128)}else throw new Error("Invalid code point")}return at}function pt(C){const _=[];for(let v=0;v<C.length;++v)_.push(C.charCodeAt(v)&255);return _}function it(C,_){let v,F,Y;const at=[];for(let D=0;D<C.length&&!((_-=2)<0);++D)v=C.charCodeAt(D),F=v>>8,Y=v%256,at.push(Y),at.push(F);return at}function _t(C){return t.toByteArray(tt(C))}function Rt(C,_,v,F){let Y;for(Y=0;Y<F&&!(Y+v>=_.length||Y>=C.length);++Y)_[Y+v]=C[Y];return Y}function gt(C,_){return C instanceof _||C!=null&&C.constructor!=null&&C.constructor.name!=null&&C.constructor.name===_.name}function Ft(C){return C!==C}const ye=function(){const C="0123456789abcdef",_=new Array(256);for(let v=0;v<16;++v){const F=v*16;for(let Y=0;Y<16;++Y)_[F+Y]=C[v]+C[Y]}return _}();function Jt(C){return typeof BigInt>"u"?Qe:C}function Qe(){throw new Error("BigInt not supported")}})(Gm);const er=Gm.Buffer,Ym=e=>e===void 0?null:e;class oR{constructor(){this.map=new Map}setItem(t,r){this.map.set(t,r)}getItem(t){return this.map.get(t)}}let qm=new oR,aR=!0;try{typeof localStorage<"u"&&localStorage&&(qm=localStorage,aR=!1)}catch{}const cR=qm,lR=Object.assign,uR=Object.keys,fR=(e,t)=>{for(const r in e)t(e[r],r)},Vm=e=>uR(e).length,hR=e=>{for(const t in e)return!1;return!0},dR=(e,t)=>{for(const r in e)if(!t(e[r],r))return!1;return!0},pR=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),mR=(e,t)=>e===t||Vm(e)===Vm(t)&&dR(e,(r,n)=>(r!==void 0||pR(t,n))&&t[n]===r),gR=Object.freeze,Xm=e=>{for(const t in e){const r=e[t];(typeof r=="object"||typeof r=="function")&&Xm(e[t])}return gR(e)},th=(e,t,r=0)=>{try{for(;r<e.length;r++)e[r](...t)}finally{r<e.length&&th(e,t,r+1)}},yR=e=>e,_R=(e,t)=>t.includes(e);var Jm={};const ha=typeof Mn<"u"&&Mn.release&&/node|io\.js/.test(Mn.release.name)&&Object.prototype.toString.call(typeof Mn<"u"?Mn:0)==="[object process]";let ei;const bR=()=>{if(ei===void 0)if(ha){ei=Un();const e=Mn.argv;let t=null;for(let r=0;r<e.length;r++){const n=e[r];n[0]==="-"?(t!==null&&ei.set(t,""),t=n):t!==null&&(ei.set(t,n),t=null)}t!==null&&ei.set(t,"")}else typeof location=="object"?(ei=Un(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,r]=e.split("=");ei.set(`--${Um(t,"-")}`,r),ei.set(`-${Um(t,"-")}`,r)}})):ei=Un();return ei},eh=e=>bR().has(e),Hc=e=>Ym(ha?Jm[e.toUpperCase().replaceAll("-","_")]:cR.getItem(e)),Zm=e=>eh("--"+e)||Hc(e)!==null;Zm("production");const wR=ha&&_R(Jm.FORCE_COLOR,["true","1","2"])||!eh("--no-colors")&&!Zm("no-color")&&(!ha||Mn.stdout.isTTY)&&(!ha||eh("--color")||Hc("COLORTERM")!==null||(Hc("TERM")||"").includes("color")),vR=e=>new Uint8Array(e),ER=e=>{const t=vR(e.byteLength);return t.set(e),t};class kR{constructor(t,r){this.left=t,this.right=r}}const ki=(e,t)=>new kR(e,t);typeof DOMParser<"u"&&new DOMParser;const xR=e=>ES(e,(t,r)=>`${r}:${t};`).join(""),xi=Symbol,Qm=xi(),tg=xi(),AR=xi(),TR=xi(),SR=xi(),eg=xi(),RR=xi(),rh=xi(),OR=xi(),IR=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],r=[];let n=0;for(;n<e.length;n++){const s=e[n];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(n>0&&r.push(t.join(""));n<e.length;n++){const s=e[n];s instanceof Symbol||r.push(s)}return r},NR={[Qm]:ki("font-weight","bold"),[tg]:ki("font-weight","normal"),[AR]:ki("color","blue"),[SR]:ki("color","green"),[TR]:ki("color","grey"),[eg]:ki("color","red"),[RR]:ki("color","purple"),[rh]:ki("color","orange"),[OR]:ki("color","black")},rg=wR?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],r=[],n=Un();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=NR[a];if(c!==void 0)n.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=xR(n);s>0||u.length>0?(t.push("%c"+a),r.push(u)):t.push(a)}else break}}for(s>0&&(i=r,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:IR,CR=(...e)=>{console.log(...rg(e)),ng.forEach(t=>t.print(e))},LR=(...e)=>{console.warn(...rg(e)),e.unshift(rh),ng.forEach(t=>t.print(e))},ng=no(),ig=e=>({[Symbol.iterator](){return this},next:e}),MR=(e,t)=>ig(()=>{let r;do r=e.next();while(!r.done&&!t(r.value));return r}),nh=(e,t)=>ig(()=>{const{done:r,value:n}=e.next();return{done:r,value:r?void 0:t(n)}});class ih{constructor(t,r){this.clock=t,this.len=r}}class da{constructor(){this.clients=new Map}}const sg=(e,t,r)=>t.clients.forEach((n,i)=>{const s=e.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let c=0,u=n[c];c<n.length&&u.clock<a;u=n[++c])vg(e,s,u.clock,u.len,r)}}),UR=(e,t)=>{let r=0,n=e.length-1;for(;r<=n;){const i=Wi((r+n)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;r=i+1}else n=i-1}return null},og=(e,t)=>{const r=e.clients.get(t.client);return r!==void 0&&UR(r,t.clock)!==null},sh=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let r,n;for(r=1,n=1;r<t.length;r++){const i=t[n-1],s=t[r];i.clock+i.len>=s.clock?i.len=bs(i.len,s.clock+s.len-i.clock):(n<r&&(t[n]=s),n++)}t.length=n})},PR=e=>{const t=new da;for(let r=0;r<e.length;r++)e[r].clients.forEach((n,i)=>{if(!t.clients.has(i)){const s=n.slice();for(let o=r+1;o<e.length;o++)xS(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return sh(t),t},Gc=(e,t,r,n)=>{zi(e.clients,t,()=>[]).push(new ih(r,n))},FR=()=>new da,$R=e=>{const t=FR();return e.clients.forEach((r,n)=>{const i=[];for(let s=0;s<r.length;s++){const o=r[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<r.length)for(let u=r[s+1];s+1<r.length&&u.deleted;u=r[++s+1])c+=u.length;i.push(new ih(a,c))}}i.length>0&&t.clients.set(n,i)}),t},lo=(e,t)=>{de(e.restEncoder,t.clients.size),_s(t.clients.entries()).sort((r,n)=>n[0]-r[0]).forEach(([r,n])=>{e.resetDsCurVal(),de(e.restEncoder,r);const i=n.length;de(e.restEncoder,i);for(let s=0;s<i;s++){const o=n[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},oh=e=>{const t=new da,r=ie(e.restDecoder);for(let n=0;n<r;n++){e.resetDsCurVal();const i=ie(e.restDecoder),s=ie(e.restDecoder);if(s>0){const o=zi(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new ih(e.readDsClock(),e.readDsLen()))}}return t},ag=(e,t,r)=>{const n=new da,i=ie(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=ie(e.restDecoder),a=ie(e.restDecoder),c=r.clients.get(o)||[],u=ur(r,o);for(let l=0;l<a;l++){const h=e.readDsClock(),d=h+e.readDsLen();if(h<u){u<d&&Gc(n,o,u,d-u);let f=ri(c,h),m=c[f];for(!m.deleted&&m.id.clock<h&&(c.splice(f+1,0,sl(t,m,h-m.id.clock)),f++);f<c.length&&(m=c[f++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(f,0,sl(t,m,d-m.id.clock)),m.delete(t))}else Gc(n,o,h,d-h)}}if(n.clients.size>0){const s=new vs;return de(s.restEncoder,0),lo(s,n),s.toUint8Array()}return null},cg=Wm;class uo extends TS{constructor({guid:t=JS(),collectionid:r=null,gc:n=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=n,this.gcFilter=i,this.clientID=cg(),this.guid=t,this.collectionid=r,this.share=new Map,this.store=new _g,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Hm(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const c=()=>Hm(u=>{const l=h=>{(h===void 0||h===!0)&&(this.off("sync",l),u())};this.on("sync",l)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&Ee(t.parent.doc,r=>{r.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(_s(this.subdocs).map(t=>t.guid))}transact(t,r=null){return Ee(this,t,r)}get(t,r=kr){const n=zi(this.share,t,()=>{const s=new r;return s._integrate(this,null),s}),i=n.constructor;if(r!==kr&&i!==r)if(i===kr){const s=new r;s._map=n._map,n._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=n._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=n._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return n}getArray(t=""){return this.get(t,mo)}getText(t=""){return this.get(t,Ai)}getMap(t=""){return this.get(t,go)}getXmlElement(t=""){return this.get(t,_o)}getXmlFragment(t=""){return this.get(t,Es)}toJSON(){const t={};return this.share.forEach((r,n)=>{t[n]=r.toJSON()}),t}destroy(){this.isDestroyed=!0,_s(this.subdocs).forEach(r=>r.destroy());const t=this._item;if(t!==null){this._item=null;const r=t.content;r.doc=new uo({guid:this.guid,...r.opts,shouldLoad:!1}),r.doc._item=t,Ee(t.parent.doc,n=>{const i=r.doc;t.deleted||n.subdocsAdded.add(i),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class lg{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return ie(this.restDecoder)}readDsLen(){return ie(this.restDecoder)}}class ug extends lg{readLeftID(){return ce(ie(this.restDecoder),ie(this.restDecoder))}readRightID(){return ce(ie(this.restDecoder),ie(this.restDecoder))}readClient(){return ie(this.restDecoder)}readInfo(){return oo(this.restDecoder)}readString(){return ao(this.restDecoder)}readParentInfo(){return ie(this.restDecoder)===1}readTypeRef(){return ie(this.restDecoder)}readLen(){return ie(this.restDecoder)}readAny(){return fa(this.restDecoder)}readBuf(){return ER(an(this.restDecoder))}readJSON(){return JSON.parse(ao(this.restDecoder))}readKey(){return ao(this.restDecoder)}}class BR{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=ie(this.restDecoder),this.dsCurrVal}readDsLen(){const t=ie(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class fo extends BR{constructor(t){super(t),this.keys=[],ie(t),this.keyClockDecoder=new Jf(an(t)),this.clientDecoder=new zc(an(t)),this.leftClockDecoder=new Jf(an(t)),this.rightClockDecoder=new Jf(an(t)),this.infoDecoder=new zm(an(t),oo),this.stringDecoder=new qS(an(t)),this.parentInfoDecoder=new zm(an(t),oo),this.typeRefDecoder=new zc(an(t)),this.lenDecoder=new zc(an(t))}readLeftID(){return new ho(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ho(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return fa(this.restDecoder)}readBuf(){return an(this.restDecoder)}readJSON(){return fa(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const r=this.stringDecoder.read();return this.keys.push(r),r}}}class DR{constructor(){this.restEncoder=$c()}toUint8Array(){return Jn(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){de(this.restEncoder,t)}writeDsLen(t){de(this.restEncoder,t)}}class pa extends DR{writeLeftID(t){de(this.restEncoder,t.client),de(this.restEncoder,t.clock)}writeRightID(t){de(this.restEncoder,t.client),de(this.restEncoder,t.clock)}writeClient(t){de(this.restEncoder,t)}writeInfo(t){Hf(this.restEncoder,t)}writeString(t){io(this.restEncoder,t)}writeParentInfo(t){de(this.restEncoder,t?1:0)}writeTypeRef(t){de(this.restEncoder,t)}writeLen(t){de(this.restEncoder,t)}writeAny(t){ua(this.restEncoder,t)}writeBuf(t){on(this.restEncoder,t)}writeJSON(t){io(this.restEncoder,JSON.stringify(t))}writeKey(t){io(this.restEncoder,t)}}class jR{constructor(){this.restEncoder=$c(),this.dsCurrVal=0}toUint8Array(){return Jn(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const r=t-this.dsCurrVal;this.dsCurrVal=t,de(this.restEncoder,r)}writeDsLen(t){t===0&&Qn(),de(this.restEncoder,t-1),this.dsCurrVal+=t}}class vs extends jR{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new qf,this.clientEncoder=new Dc,this.leftClockEncoder=new qf,this.rightClockEncoder=new qf,this.infoEncoder=new Fm(Hf),this.stringEncoder=new HS,this.parentInfoEncoder=new Fm(Hf),this.typeRefEncoder=new Dc,this.lenEncoder=new Dc}toUint8Array(){const t=$c();return de(t,0),on(t,this.keyClockEncoder.toUint8Array()),on(t,this.clientEncoder.toUint8Array()),on(t,this.leftClockEncoder.toUint8Array()),on(t,this.rightClockEncoder.toUint8Array()),on(t,Jn(this.infoEncoder)),on(t,this.stringEncoder.toUint8Array()),on(t,Jn(this.parentInfoEncoder)),on(t,this.typeRefEncoder.toUint8Array()),on(t,this.lenEncoder.toUint8Array()),Bc(t,Jn(this.restEncoder)),Jn(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){ua(this.restEncoder,t)}writeBuf(t){on(this.restEncoder,t)}writeJSON(t){ua(this.restEncoder,t)}writeKey(t){const r=this.keyMap.get(t);r===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(r)}}const zR=(e,t,r,n)=>{n=bs(n,t[0].id.clock);const i=ri(t,n);de(e.restEncoder,t.length-i),e.writeClient(r),de(e.restEncoder,n);const s=t[i];s.write(e,n-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},ah=(e,t,r)=>{const n=new Map;r.forEach((i,s)=>{ur(t,s)>i&&n.set(s,i)}),lh(t).forEach((i,s)=>{r.has(s)||n.set(s,0)}),de(e.restEncoder,n.size),_s(n.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{zR(e,t.clients.get(i),i,s)})},WR=(e,t)=>{const r=Un(),n=ie(e.restDecoder);for(let i=0;i<n;i++){const s=ie(e.restDecoder),o=new Array(s),a=e.readClient();let c=ie(e.restDecoder);r.set(a,{i:0,refs:o});for(let u=0;u<s;u++){const l=e.readInfo();switch(Fc&l){case 0:{const h=e.readLen();o[u]=new gn(ce(a,c),h),c+=h;break}case 10:{const h=ie(e.restDecoder);o[u]=new yn(ce(a,c),h),c+=h;break}default:{const h=(l&(Ei|sn))===0,d=new nr(ce(a,c),null,(l&sn)===sn?e.readLeftID():null,null,(l&Ei)===Ei?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(l&oa)===oa?e.readString():null,Kg(e,l));o[u]=d,c+=d.length}}}}return r},HR=(e,t,r)=>{const n=[];let i=_s(r.keys()).sort((f,m)=>f-m);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=r.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=r.get(i[i.length-1]);else return null;return f};let o=s();if(o===null)return null;const a=new _g,c=new Map,u=(f,m)=>{const p=c.get(f);(p==null||p>m)&&c.set(f,m)};let l=o.refs[o.i++];const h=new Map,d=()=>{for(const f of n){const m=f.id.client,p=r.get(m);p?(p.i--,a.clients.set(m,p.refs.slice(p.i)),r.delete(m),p.i=0,p.refs=[]):a.clients.set(m,[f]),i=i.filter(g=>g!==m)}n.length=0};for(;;){if(l.constructor!==yn){const m=zi(h,l.id.client,()=>ur(t,l.id.client))-l.id.clock;if(m<0)n.push(l),u(l.id.client,l.id.clock-1),d();else{const p=l.getMissing(e,t);if(p!==null){n.push(l);const g=r.get(p)||{refs:[],i:0};if(g.refs.length===g.i)u(p,ur(t,p)),d();else{l=g.refs[g.i++];continue}}else(m===0||m<l.length)&&(l.integrate(e,m),h.set(l.id.client,l.id.clock+l.length))}}if(n.length>0)l=n.pop();else if(o!==null&&o.i<o.refs.length)l=o.refs[o.i++];else{if(o=s(),o===null)break;l=o.refs[o.i++]}}if(a.clients.size>0){const f=new vs;return ah(f,a,new Map),de(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},GR=(e,t)=>ah(e,t.doc.store,t.beforeState),KR=(e,t,r,n=new fo(e))=>Ee(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=WR(n,o),u=HR(i,a,c),l=a.pendingStructs;if(l){for(const[d,f]of l.missing)if(f<ur(a,d)){s=!0;break}if(u){for(const[d,f]of u.missing){const m=l.missing.get(d);(m==null||m>f)&&l.missing.set(d,f)}l.update=qc([l.update,u.update])}}else a.pendingStructs=u;const h=ag(n,i,a);if(a.pendingDs){const d=new fo(so(a.pendingDs));ie(d.restDecoder);const f=ag(d,i,a);h&&f?a.pendingDs=qc([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,fg(i.doc,d)}},r,!1),fg=(e,t,r,n=fo)=>{const i=so(t);KR(i,e,r,new n(i))},hg=(e,t,r)=>fg(e,t,r,ug),YR=(e,t,r=new Map)=>{ah(e,t.store,r),lo(e,$R(t.store))},qR=(e,t=new Uint8Array([0]),r=new vs)=>{const n=dg(t);YR(r,e,n);const i=[r.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(oO(e.store.pendingStructs.update,t)),i.length>1){if(r.constructor===pa)return iO(i.map((s,o)=>o===0?s:cO(s)));if(r.constructor===vs)return qc(i)}return i[0]},VR=(e,t)=>qR(e,t,new pa),XR=e=>{const t=new Map,r=ie(e.restDecoder);for(let n=0;n<r;n++){const i=ie(e.restDecoder),s=ie(e.restDecoder);t.set(i,s)}return t},dg=e=>XR(new lg(so(e)));class JR{constructor(){this.l=[]}}const pg=()=>new JR,mg=(e,t)=>e.l.push(t),gg=(e,t)=>{const r=e.l,n=r.length;e.l=r.filter(i=>t!==i),n===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},yg=(e,t,r)=>th(e.l,[t,r]);class ho{constructor(t,r){this.client=t,this.clock=r}}const Kc=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,ce=(e,t)=>new ho(e,t),ZR=e=>{for(const[t,r]of e.doc.share.entries())if(r===e)return t;throw Qn()},po=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!og(t.ds,e.id),ch=(e,t)=>{const r=zi(e.meta,ch,no),n=e.doc.store;r.has(t)||(t.sv.forEach((i,s)=>{i<ur(n,s)&&Gi(e,ce(s,i))}),sg(e,t.ds,i=>{}),r.add(t))};class _g{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const lh=e=>{const t=new Map;return e.clients.forEach((r,n)=>{const i=r[r.length-1];t.set(n,i.id.clock+i.length)}),t},ur=(e,t)=>{const r=e.clients.get(t);if(r===void 0)return 0;const n=r[r.length-1];return n.id.clock+n.length},bg=(e,t)=>{let r=e.clients.get(t.id.client);if(r===void 0)r=[],e.clients.set(t.id.client,r);else{const n=r[r.length-1];if(n.id.clock+n.length!==t.id.clock)throw Qn()}r.push(t)},ri=(e,t)=>{let r=0,n=e.length-1,i=e[n],s=i.id.clock;if(s===t)return n;let o=Wi(t/(s+i.length-1)*n);for(;r<=n;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;r=o+1}else n=o-1;o=Wi((r+n)/2)}throw Qn()},uh=(e,t)=>{const r=e.clients.get(t.client);return r[ri(r,t.clock)]},fh=(e,t,r)=>{const n=ri(t,r),i=t[n];return i.id.clock<r&&i instanceof nr?(t.splice(n+1,0,sl(e,i,r-i.id.clock)),n+1):n},Gi=(e,t)=>{const r=e.doc.store.clients.get(t.client);return r[fh(e,r,t.clock)]},wg=(e,t,r)=>{const n=t.clients.get(r.client),i=ri(n,r.clock),s=n[i];return r.clock!==s.id.clock+s.length-1&&s.constructor!==gn&&n.splice(i+1,0,sl(e,s,r.clock-s.id.clock+1)),s},QR=(e,t,r)=>{const n=e.clients.get(t.id.client);n[ri(n,t.id.clock)]=r},vg=(e,t,r,n,i)=>{if(n===0)return;const s=r+n;let o=fh(e,t,r),a;do a=t[o++],s<a.id.clock+a.length&&fh(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class tO{constructor(t,r,n){this.doc=t,this.deleteSet=new da,this.beforeState=lh(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=r,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Eg=(e,t)=>t.deleteSet.clients.size===0&&!kS(t.afterState,(r,n)=>t.beforeState.get(n)!==r)?!1:(sh(t.deleteSet),GR(e,t),lo(e,t.deleteSet),!0),kg=(e,t,r)=>{const n=t._item;(n===null||n.id.clock<(e.beforeState.get(n.id.client)||0)&&!n.deleted)&&zi(e.changed,t,no).add(r)},Yc=(e,t)=>{let r=e[t],n=e[t-1],i=t;for(;i>0;r=n,n=e[--i-1]){if(n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)){r instanceof nr&&r.parentSub!==null&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},eO=(e,t,r)=>{for(const[n,i]of e.clients.entries()){const s=t.clients.get(n);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let u=ri(s,a.clock),l=s[u];u<s.length&&l.id.clock<c;l=s[++u]){const h=s[u];if(a.clock+a.len<=h.id.clock)break;h instanceof nr&&h.deleted&&!h.keep&&r(h)&&h.gc(t,!1)}}}},rO=(e,t)=>{e.clients.forEach((r,n)=>{const i=t.clients.get(n);for(let s=r.length-1;s>=0;s--){const o=r[s],a=Im(i.length-1,1+ri(i,o.clock+o.len-1));for(let c=a,u=i[c];c>0&&u.id.clock>=o.clock;u=i[c])c-=1+Yc(i,c)}})},xg=(e,t)=>{if(t<e.length){const r=e[t],n=r.doc,i=n.store,s=r.deleteSet,o=r._mergeStructs;try{sh(s),r.afterState=lh(r.doc.store),n.emit("beforeObserverCalls",[r,n]);const a=[];r.changed.forEach((c,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(r,c)})),a.push(()=>{r.changedParentTypes.forEach((c,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u,l._path=null}),c.sort((l,h)=>l.path.length-h.path.length),yg(u._dEH,c,r))})}),a.push(()=>n.emit("afterTransaction",[r,n])),th(a,[]),r._needFormattingCleanup&&EO(r)}finally{n.gc&&eO(s,i,n.gcFilter),rO(s,i),r.afterState.forEach((l,h)=>{const d=r.beforeState.get(h)||0;if(d!==l){const f=i.clients.get(h),m=bs(ri(f,d),1);for(let p=f.length-1;p>=m;)p-=1+Yc(f,p)}});for(let l=o.length-1;l>=0;l--){const{client:h,clock:d}=o[l].id,f=i.clients.get(h),m=ri(f,d);m+1<f.length&&Yc(f,m+1)>1||m>0&&Yc(f,m)}if(!r.local&&r.afterState.get(n.clientID)!==r.beforeState.get(n.clientID)&&(CR(rh,Qm,"[yjs] ",tg,eg,"Changed the client-id because another client seems to be using it."),n.clientID=cg()),n.emit("afterTransactionCleanup",[r,n]),n._observers.has("update")){const l=new pa;Eg(l,r)&&n.emit("update",[l.toUint8Array(),r.origin,n,r])}if(n._observers.has("updateV2")){const l=new vs;Eg(l,r)&&n.emit("updateV2",[l.toUint8Array(),r.origin,n,r])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:u}=r;(a.size>0||u.size>0||c.size>0)&&(a.forEach(l=>{l.clientID=n.clientID,l.collectionid==null&&(l.collectionid=n.collectionid),n.subdocs.add(l)}),u.forEach(l=>n.subdocs.delete(l)),n.emit("subdocs",[{loaded:c,added:a,removed:u},n,r]),u.forEach(l=>l.destroy())),e.length<=t+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,e])):xg(e,t+1)}}},Ee=(e,t,r=null,n=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new tO(e,r,n),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&xg(i,0)}}return o};function*nO(e){const t=ie(e.restDecoder);for(let r=0;r<t;r++){const n=ie(e.restDecoder),i=e.readClient();let s=ie(e.restDecoder);for(let o=0;o<n;o++){const a=e.readInfo();if(a===10){const c=ie(e.restDecoder);yield new yn(ce(i,s),c),s+=c}else if(Fc&a){const c=(a&(Ei|sn))===0,u=new nr(ce(i,s),null,(a&sn)===sn?e.readLeftID():null,null,(a&Ei)===Ei?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&oa)===oa?e.readString():null,Kg(e,a));yield u,s+=u.length}else{const c=e.readLen();yield new gn(ce(i,s),c),s+=c}}}}class hh{constructor(t,r){this.gen=nO(t),this.curr=null,this.done=!1,this.filterSkips=r,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===yn);return this.curr}}class dh{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const iO=e=>qc(e,ug,pa),sO=(e,t)=>{if(e.constructor===gn){const{client:r,clock:n}=e.id;return new gn(ce(r,n+t),e.length-t)}else if(e.constructor===yn){const{client:r,clock:n}=e.id;return new yn(ce(r,n+t),e.length-t)}else{const r=e,{client:n,clock:i}=r.id;return new nr(ce(n,i+t),null,ce(n,i+t-1),null,r.rightOrigin,r.parent,r.parentSub,r.content.splice(t))}},qc=(e,t=fo,r=vs)=>{if(e.length===1)return e[0];const n=e.map(l=>new t(so(l)));let i=n.map(l=>new hh(l,!0)),s=null;const o=new r,a=new dh(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const m=d.curr.id.clock-f.curr.id.clock;return m===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===yn?1:-1:m}else return f.curr.id.client-d.curr.id.client}),i.length!==0;){const l=i[0],h=l.curr.id.client;if(s!==null){let d=l.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=l.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Ki(a,s.struct,s.offset),s={struct:d,offset:0},l.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===yn)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Ki(a,s.struct,s.offset);const m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new yn(ce(h,s.struct.id.clock+s.struct.length),m),offset:0}}else{const m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===yn?s.struct.length-=m:d=sO(d,m)),s.struct.mergeWith(d)||(Ki(a,s.struct,s.offset),s={struct:d,offset:0},l.next())}}else s={struct:l.curr,offset:0},l.next();for(let d=l.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==yn;d=l.next())Ki(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Ki(a,s.struct,s.offset),s=null),ph(a);const c=n.map(l=>oh(l)),u=PR(c);return lo(o,u),o.toUint8Array()},oO=(e,t,r=fo,n=vs)=>{const i=dg(t),s=new n,o=new dh(s),a=new r(so(e)),c=new hh(a,!1);for(;c.curr;){const l=c.curr,h=l.id.client,d=i.get(h)||0;if(c.curr.constructor===yn){c.next();continue}if(l.id.clock+l.length>d)for(Ki(o,l,bs(d-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Ki(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}ph(o);const u=oh(a);return lo(s,u),s.toUint8Array()},Ag=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Jn(e.encoder.restEncoder)}),e.encoder.restEncoder=$c(),e.written=0)},Ki=(e,t,r)=>{e.written>0&&e.currClient!==t.id.client&&Ag(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),de(e.encoder.restEncoder,t.id.clock+r)),t.write(e.encoder,r),e.written++},ph=e=>{Ag(e);const t=e.encoder.restEncoder;de(t,e.clientStructs.length);for(let r=0;r<e.clientStructs.length;r++){const n=e.clientStructs[r];de(t,n.written),Bc(t,n.restEncoder)}},aO=(e,t,r,n)=>{const i=new r(so(e)),s=new hh(i,!1),o=new n,a=new dh(o);for(let u=s.curr;u!==null;u=s.next())Ki(a,t(u),0);ph(a);const c=oh(i);return lo(o,c),o.toUint8Array()},cO=e=>aO(e,yR,fo,pa),Tg="You must not compute changes after the event-handler fired.";class Vc{constructor(t,r){this.target=t,this.currentTarget=t,this.transaction=r,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=lO(this.currentTarget,this.target))}deletes(t){return og(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Hi(Tg);const t=new Map,r=this.target;this.transaction.changed.get(r).forEach(i=>{if(i!==null){const s=r._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Df(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Df(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Df(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Hi(Tg);const r=this.target,n=no(),i=no(),s=[];if(t={added:n,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(r).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let u=r._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=u.length,i.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),n.add(u)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const lO=(e,t)=>{const r=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)r.unshift(t._item.parentSub);else{let n=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(n+=i.length),i=i.right;r.unshift(n)}t=t._item.parent}return r},Tr=()=>{LR("Invalid access: Add Yjs type to a document before reading data.")},Sg=80;let mh=0;class uO{constructor(t,r){t.marker=!0,this.p=t,this.index=r,this.timestamp=mh++}}const fO=e=>{e.timestamp=mh++},Rg=(e,t,r)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=r,e.timestamp=mh++},hO=(e,t,r)=>{if(e.length>=Sg){const n=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Rg(n,t,r),n}else{const n=new uO(t,r);return e.push(n),n}},Xc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const r=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Pc(t-s.index)<Pc(t-o.index)?s:o);let n=e._start,i=0;for(r!==null&&(n=r.p,i=r.index,fO(r));n.right!==null&&i<t;){if(!n.deleted&&n.countable){if(t<i+n.length)break;i+=n.length}n=n.right}for(;n.left!==null&&i>t;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);return r!==null&&Pc(r.index-i)<n.parent.length/Sg?(Rg(r,n,i),r):hO(e._searchMarker,n,i)},ma=(e,t,r)=>{for(let n=e.length-1;n>=0;n--){const i=e[n];if(r>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(n,1);continue}i.p=s,s.marker=!0}(t<i.index||r>0&&t===i.index)&&(i.index=bs(t,i.index+r))}},Jc=(e,t,r)=>{const n=e,i=t.changedParentTypes;for(;zi(i,e,()=>[]).push(r),e._item!==null;)e=e._item.parent;yg(n._eH,r,t)};class kr{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=pg(),this._dEH=pg(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,r){this.doc=t,this._item=r}_copy(){throw Zn()}clone(){throw Zn()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,r){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){mg(this._eH,t)}observeDeep(t){mg(this._dEH,t)}unobserve(t){gg(this._eH,t)}unobserveDeep(t){gg(this._dEH,t)}toJSON(){}}const Og=(e,t,r)=>{e.doc??Tr(),t<0&&(t=e._length+t),r<0&&(r=e._length+r);let n=r-t;const i=[];let s=e._start;for(;s!==null&&n>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&n>0;a++)i.push(o[a]),n--;t=0}}s=s.right}return i},Ig=e=>{e.doc??Tr();const t=[];let r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const n=r.content.getContent();for(let i=0;i<n.length;i++)t.push(n[i])}r=r.right}return t},ga=(e,t)=>{let r=0,n=e._start;for(e.doc??Tr();n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let s=0;s<i.length;s++)t(i[s],r++,e)}n=n.right}},Ng=(e,t)=>{const r=[];return ga(e,(n,i)=>{r.push(t(n,i,e))}),r},dO=e=>{let t=e._start,r=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(r===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};r=t.content.getContent(),n=0,t=t.right}const i=r[n++];return r.length<=n&&(r=null),{done:!1,value:i}}}},Cg=(e,t)=>{e.doc??Tr();const r=Xc(e,t);let n=e._start;for(r!==null&&(n=r.p,t-=r.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(t<n.length)return n.content.getContent()[t];t-=n.length}},Zc=(e,t,r,n)=>{let i=r;const s=e.doc,o=s.clientID,a=s.store,c=r===null?t._start:r.right;let u=[];const l=()=>{u.length>0&&(i=new nr(ce(o,ur(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new xs(u)),i.integrate(e,0),u=[])};n.forEach(h=>{if(h===null)u.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(h);break;default:switch(l(),h.constructor){case Uint8Array:case ArrayBuffer:i=new nr(ce(o,ur(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ya(new Uint8Array(h))),i.integrate(e,0);break;case uo:i=new nr(ce(o,ur(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ba(h)),i.integrate(e,0);break;default:if(h instanceof kr)i=new nr(ce(o,ur(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Ti(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},Lg=()=>Hi("Length exceeded!"),Mg=(e,t,r,n)=>{if(r>t._length)throw Lg();if(r===0)return t._searchMarker&&ma(t._searchMarker,r,n.length),Zc(e,t,null,n);const i=r,s=Xc(t,r);let o=t._start;for(s!==null&&(o=s.p,r-=s.index,r===0&&(o=o.prev,r+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(r<=o.length){r<o.length&&Gi(e,ce(o.id.client,o.id.clock+r));break}r-=o.length}return t._searchMarker&&ma(t._searchMarker,i,n.length),Zc(e,t,o,n)},pO=(e,t,r)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Zc(e,t,i,r)},Ug=(e,t,r,n)=>{if(n===0)return;const i=r,s=n,o=Xc(t,r);let a=t._start;for(o!==null&&(a=o.p,r-=o.index);a!==null&&r>0;a=a.right)!a.deleted&&a.countable&&(r<a.length&&Gi(e,ce(a.id.client,a.id.clock+r)),r-=a.length);for(;n>0&&a!==null;)a.deleted||(n<a.length&&Gi(e,ce(a.id.client,a.id.clock+n)),a.delete(e),n-=a.length),a=a.right;if(n>0)throw Lg();t._searchMarker&&ma(t._searchMarker,i,-s+n)},Qc=(e,t,r)=>{const n=t._map.get(r);n!==void 0&&n.delete(e)},gh=(e,t,r,n)=>{const i=t._map.get(r)||null,s=e.doc,o=s.clientID;let a;if(n==null)a=new xs([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new xs([n]);break;case Uint8Array:a=new ya(n);break;case uo:a=new ba(n);break;default:if(n instanceof kr)a=new Ti(n);else throw new Error("Unexpected content type")}new nr(ce(o,ur(s.store,o)),i,i&&i.lastId,null,null,t,r,a).integrate(e,0)},yh=(e,t)=>{e.doc??Tr();const r=e._map.get(t);return r!==void 0&&!r.deleted?r.content.getContent()[r.length-1]:void 0},Pg=e=>{const t={};return e.doc??Tr(),e._map.forEach((r,n)=>{r.deleted||(t[n]=r.content.getContent()[r.length-1])}),t},Fg=(e,t)=>{e.doc??Tr();const r=e._map.get(t);return r!==void 0&&!r.deleted},mO=(e,t)=>{const r={};return e._map.forEach((n,i)=>{let s=n;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&po(s,t)&&(r[i]=s.content.getContent()[s.length-1])}),r},tl=e=>(e.doc??Tr(),MR(e._map.entries(),t=>!t[1].deleted));class gO extends Vc{}class mo extends kr{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const r=new mo;return r.push(t),r}_integrate(t,r){super._integrate(t,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new mo}clone(){const t=new mo;return t.insert(0,this.toArray().map(r=>r instanceof kr?r.clone():r)),t}get length(){return this.doc??Tr(),this._length}_callObserver(t,r){super._callObserver(t,r),Jc(this,t,new gO(this,t))}insert(t,r){this.doc!==null?Ee(this.doc,n=>{Mg(n,this,t,r)}):this._prelimContent.splice(t,0,...r)}push(t){this.doc!==null?Ee(this.doc,r=>{pO(r,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,r=1){this.doc!==null?Ee(this.doc,n=>{Ug(n,this,t,r)}):this._prelimContent.splice(t,r)}get(t){return Cg(this,t)}toArray(){return Ig(this)}slice(t=0,r=this.length){return Og(this,t,r)}toJSON(){return this.map(t=>t instanceof kr?t.toJSON():t)}map(t){return Ng(this,t)}forEach(t){ga(this,t)}[Symbol.iterator](){return dO(this)}_write(t){t.writeTypeRef(jO)}}const yO=e=>new mo;class _O extends Vc{constructor(t,r,n){super(t,r),this.keysChanged=n}}class go extends kr{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,r){super._integrate(t,r),this._prelimContent.forEach((n,i)=>{this.set(i,n)}),this._prelimContent=null}_copy(){return new go}clone(){const t=new go;return this.forEach((r,n)=>{t.set(n,r instanceof kr?r.clone():r)}),t}_callObserver(t,r){Jc(this,t,new _O(this,t,r))}toJSON(){this.doc??Tr();const t={};return this._map.forEach((r,n)=>{if(!r.deleted){const i=r.content.getContent()[r.length-1];t[n]=i instanceof kr?i.toJSON():i}}),t}get size(){return[...tl(this)].length}keys(){return nh(tl(this),t=>t[0])}values(){return nh(tl(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return nh(tl(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??Tr(),this._map.forEach((r,n)=>{r.deleted||t(r.content.getContent()[r.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?Ee(this.doc,r=>{Qc(r,this,t)}):this._prelimContent.delete(t)}set(t,r){return this.doc!==null?Ee(this.doc,n=>{gh(n,this,t,r)}):this._prelimContent.set(t,r),r}get(t){return yh(this,t)}has(t){return Fg(this,t)}clear(){this.doc!==null?Ee(this.doc,t=>{this.forEach(function(r,n,i){Qc(t,i,n)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(zO)}}const bO=e=>new go,Yi=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&mR(e,t);class _h{constructor(t,r,n,i){this.left=t,this.right=r,this.index=n,this.currentAttributes=i}forward(){switch(this.right===null&&Qn(),this.right.content.constructor){case rr:this.right.deleted||yo(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const $g=(e,t,r)=>{for(;t.right!==null&&r>0;){switch(t.right.content.constructor){case rr:t.right.deleted||yo(t.currentAttributes,t.right.content);break;default:t.right.deleted||(r<t.right.length&&Gi(e,ce(t.right.id.client,t.right.id.clock+r)),t.index+=t.right.length,r-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},el=(e,t,r,n)=>{const i=new Map,s=n?Xc(t,r):null;if(s){const o=new _h(s.p.left,s.p,s.index,i);return $g(e,o,r-s.index)}else{const o=new _h(null,t._start,0,i);return $g(e,o,r)}},Bg=(e,t,r,n)=>{for(;r.right!==null&&(r.right.deleted===!0||r.right.content.constructor===rr&&Yi(n.get(r.right.content.key),r.right.content.value));)r.right.deleted||n.delete(r.right.content.key),r.forward();const i=e.doc,s=i.clientID;n.forEach((o,a)=>{const c=r.left,u=r.right,l=new nr(ce(s,ur(i.store,s)),c,c&&c.lastId,u,u&&u.id,t,null,new rr(a,o));l.integrate(e,0),r.right=l,r.forward()})},yo=(e,t)=>{const{key:r,value:n}=t;n===null?e.delete(r):e.set(r,n)},Dg=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===rr&&Yi(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},jg=(e,t,r,n)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in n){const c=n[a],u=r.currentAttributes.get(a)??null;if(!Yi(u,c)){o.set(a,u);const{left:l,right:h}=r;r.right=new nr(ce(s,ur(i.store,s)),l,l&&l.lastId,h,h&&h.id,t,null,new rr(a,c)),r.right.integrate(e,0),r.forward()}}return o},bh=(e,t,r,n,i)=>{r.currentAttributes.forEach((d,f)=>{i[f]===void 0&&(i[f]=null)});const s=e.doc,o=s.clientID;Dg(r,i);const a=jg(e,t,r,i),c=n.constructor===String?new ni(n):n instanceof kr?new Ti(n):new ks(n);let{left:u,right:l,index:h}=r;t._searchMarker&&ma(t._searchMarker,r.index,c.getLength()),l=new nr(ce(o,ur(s.store,o)),u,u&&u.lastId,l,l&&l.id,t,null,c),l.integrate(e,0),r.right=l,r.index=h,r.forward(),Bg(e,t,r,a)},zg=(e,t,r,n,i)=>{const s=e.doc,o=s.clientID;Dg(r,i);const a=jg(e,t,r,i);t:for(;r.right!==null&&(n>0||a.size>0&&(r.right.deleted||r.right.content.constructor===rr));){if(!r.right.deleted)switch(r.right.content.constructor){case rr:{const{key:c,value:u}=r.right.content,l=i[c];if(l!==void 0){if(Yi(l,u))a.delete(c);else{if(n===0)break t;a.set(c,u)}r.right.delete(e)}else r.currentAttributes.set(c,u);break}default:n<r.right.length&&Gi(e,ce(r.right.id.client,r.right.id.clock+n)),n-=r.right.length;break}r.forward()}if(n>0){let c="";for(;n>0;n--)c+=`
`;r.right=new nr(ce(o,ur(s.store,o)),r.left,r.left&&r.left.lastId,r.right,r.right&&r.right.id,t,null,new ni(c)),r.right.integrate(e,0),r.forward()}Bg(e,t,r,a)},Wg=(e,t,r,n,i)=>{let s=t;const o=Un();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===rr){const u=s.content;o.set(u.key,u)}s=s.right}let a=0,c=!1;for(;t!==s;){if(r===t&&(c=!0),!t.deleted){const u=t.content;switch(u.constructor){case rr:{const{key:l,value:h}=u,d=n.get(l)??null;(o.get(l)!==u||d===h)&&(t.delete(e),a++,!c&&(i.get(l)??null)===h&&d!==h&&(d===null?i.delete(l):i.set(l,d))),!c&&!t.deleted&&yo(i,u);break}}}t=t.right}return a},wO=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const r=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===rr){const n=t.content.key;r.has(n)?t.delete(e):r.add(n)}t=t.left}},vO=e=>{let t=0;return Ee(e.doc,r=>{let n=e._start,i=e._start,s=Un();const o=Bf(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case rr:yo(o,i.content);break;default:t+=Wg(r,n,i,s,o),s=Bf(o),n=i;break}i=i.right}}),t},EO=e=>{const t=new Set,r=e.doc;for(const[n,i]of e.afterState.entries()){const s=e.beforeState.get(n)||0;i!==s&&vg(e,r.store.clients.get(n),s,i,o=>{!o.deleted&&o.content.constructor===rr&&o.constructor!==gn&&t.add(o.parent)})}Ee(r,n=>{sg(e,e.deleteSet,i=>{if(i instanceof gn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===rr?t.add(s):wO(n,i)});for(const i of t)vO(i)})},Hg=(e,t,r)=>{const n=r,i=Bf(t.currentAttributes),s=t.right;for(;r>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Ti:case ks:case ni:r<t.right.length&&Gi(e,ce(t.right.id.client,t.right.id.clock+r)),r-=t.right.length,t.right.delete(e);break}t.forward()}s&&Wg(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&ma(o._searchMarker,t.index,-n+r),t};class kO extends Vc{constructor(t,r,n){super(t,r),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,r=[];Ee(t,n=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let u="",l=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof u=="object"||u.length>0)&&(f={insert:u},i.size>0&&(f.attributes={},i.forEach((m,p)=>{m!==null&&(f.attributes[p]=m)}))),u="";break;case"retain":l>0&&(f={retain:l},hR(c)||(f.attributes=lR({},c))),l=0;break}f&&r.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case Ti:case ks:this.adds(o)?this.deletes(o)||(d(),a="insert",u=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),l+=1);break;case ni:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),l+=o.length);break;case rr:{const{key:f,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(f)??null;Yi(p,m)?m!==null&&o.delete(n):(a==="retain"&&d(),Yi(m,s.get(f)??null)?delete c[f]:c[f]=m)}}else if(this.deletes(o)){s.set(f,m);const p=i.get(f)??null;Yi(p,m)||(a==="retain"&&d(),c[f]=p)}else if(!o.deleted){s.set(f,m);const p=c[f];p!==void 0&&(Yi(p,m)?p!==null&&o.delete(n):(a==="retain"&&d(),m===null?delete c[f]:c[f]=m))}o.deleted||(a==="insert"&&d(),yo(i,o.content));break}}o=o.right}for(d();r.length>0;){const f=r[r.length-1];if(f.retain!==void 0&&f.attributes===void 0)r.pop();else break}}),this._delta=r}return this._delta}}class Ai extends kr{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Tr(),this._length}_integrate(t,r){super._integrate(t,r);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new Ai}clone(){const t=new Ai;return t.applyDelta(this.toDelta()),t}_callObserver(t,r){super._callObserver(t,r);const n=new kO(this,t,r);Jc(this,t,n),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??Tr();let t="",r=this._start;for(;r!==null;)!r.deleted&&r.countable&&r.content.constructor===ni&&(t+=r.content.str),r=r.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:r=!0}={}){this.doc!==null?Ee(this.doc,n=>{const i=new _h(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!r&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&bh(n,this,i,a,o.attributes||{})}else o.retain!==void 0?zg(n,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Hg(n,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,r,n){this.doc??Tr();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function u(){if(a.length>0){const h={};let d=!1;s.forEach((m,p)=>{d=!0,h[p]=m});const f={insert:a};d&&(f.attributes=h),i.push(f),a=""}}const l=()=>{for(;c!==null;){if(po(c,t)||r!==void 0&&po(c,r))switch(c.content.constructor){case ni:{const h=s.get("ychange");t!==void 0&&!po(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(u(),s.set("ychange",n?n("removed",c.id):{type:"removed"})):r!==void 0&&!po(c,r)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(u(),s.set("ychange",n?n("added",c.id):{type:"added"})):h!==void 0&&(u(),s.delete("ychange")),a+=c.content.str;break}case Ti:case ks:{u();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((f,m)=>{d[m]=f})}i.push(h);break}case rr:po(c,t)&&(u(),yo(s,c.content));break}c=c.right}u()};return t||r?Ee(o,h=>{t&&ch(h,t),r&&ch(h,r),l()},"cleanup"):l(),i}insert(t,r,n){if(r.length<=0)return;const i=this.doc;i!==null?Ee(i,s=>{const o=el(s,this,t,!n);n||(n={},o.currentAttributes.forEach((a,c)=>{n[c]=a})),bh(s,this,o,r,n)}):this._pending.push(()=>this.insert(t,r,n))}insertEmbed(t,r,n){const i=this.doc;i!==null?Ee(i,s=>{const o=el(s,this,t,!n);bh(s,this,o,r,n||{})}):this._pending.push(()=>this.insertEmbed(t,r,n||{}))}delete(t,r){if(r===0)return;const n=this.doc;n!==null?Ee(n,i=>{Hg(i,el(i,this,t,!0),r)}):this._pending.push(()=>this.delete(t,r))}format(t,r,n){if(r===0)return;const i=this.doc;i!==null?Ee(i,s=>{const o=el(s,this,t,!1);o.right!==null&&zg(s,this,o,r,n)}):this._pending.push(()=>this.format(t,r,n))}removeAttribute(t){this.doc!==null?Ee(this.doc,r=>{Qc(r,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,r){this.doc!==null?Ee(this.doc,n=>{gh(n,this,t,r)}):this._pending.push(()=>this.setAttribute(t,r))}getAttribute(t){return yh(this,t)}getAttributes(){return Pg(this)}_write(t){t.writeTypeRef(WO)}}const xO=e=>new Ai;class wh{constructor(t,r=()=>!0){this._filter=r,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??Tr()}[Symbol.iterator](){return this}next(){let t=this._currentNode,r=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(r)))do if(r=t.content.type,!t.deleted&&(r.constructor===_o||r.constructor===Es)&&r._start!==null)t=r._start;else for(;t!==null;){const n=t.next;if(n!==null){t=n;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Es extends kr{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,r){super._integrate(t,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Es}clone(){const t=new Es;return t.insert(0,this.toArray().map(r=>r instanceof kr?r.clone():r)),t}get length(){return this.doc??Tr(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new wh(this,t)}querySelector(t){t=t.toUpperCase();const n=new wh(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return n.done?null:n.value}querySelectorAll(t){return t=t.toUpperCase(),_s(new wh(this,r=>r.nodeName&&r.nodeName.toUpperCase()===t))}_callObserver(t,r){Jc(this,t,new SO(this,r,t))}toString(){return Ng(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,r={},n){const i=t.createDocumentFragment();return n!==void 0&&n._createAssociation(i,this),ga(this,s=>{i.insertBefore(s.toDOM(t,r,n),null)}),i}insert(t,r){this.doc!==null?Ee(this.doc,n=>{Mg(n,this,t,r)}):this._prelimContent.splice(t,0,...r)}insertAfter(t,r){if(this.doc!==null)Ee(this.doc,n=>{const i=t&&t instanceof kr?t._item:t;Zc(n,this,i,r)});else{const n=this._prelimContent,i=t===null?0:n.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Hi("Reference item not found");n.splice(i,0,...r)}}delete(t,r=1){this.doc!==null?Ee(this.doc,n=>{Ug(n,this,t,r)}):this._prelimContent.splice(t,r)}toArray(){return Ig(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Cg(this,t)}slice(t=0,r=this.length){return Og(this,t,r)}forEach(t){ga(this,t)}_write(t){t.writeTypeRef(GO)}}const AO=e=>new Es;class _o extends Es{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,r){super._integrate(t,r),this._prelimAttrs.forEach((n,i)=>{this.setAttribute(i,n)}),this._prelimAttrs=null}_copy(){return new _o(this.nodeName)}clone(){const t=new _o(this.nodeName),r=this.getAttributes();return fR(r,(n,i)=>{typeof n=="string"&&t.setAttribute(i,n)}),t.insert(0,this.toArray().map(n=>n instanceof kr?n.clone():n)),t}toString(){const t=this.getAttributes(),r=[],n=[];for(const a in t)n.push(a);n.sort();const i=n.length;for(let a=0;a<i;a++){const c=n[a];r.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=r.length>0?" "+r.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?Ee(this.doc,r=>{Qc(r,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,r){this.doc!==null?Ee(this.doc,n=>{gh(n,this,t,r)}):this._prelimAttrs.set(t,r)}getAttribute(t){return yh(this,t)}hasAttribute(t){return Fg(this,t)}getAttributes(t){return t?mO(this,t):Pg(this)}toDOM(t=document,r={},n){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return ga(this,o=>{i.appendChild(o.toDOM(t,r,n))}),n!==void 0&&n._createAssociation(i,this),i}_write(t){t.writeTypeRef(HO),t.writeKey(this.nodeName)}}const TO=e=>new _o(e.readKey());class SO extends Vc{constructor(t,r,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class rl extends go{constructor(t){super(),this.hookName=t}_copy(){return new rl(this.hookName)}clone(){const t=new rl(this.hookName);return this.forEach((r,n)=>{t.set(n,r)}),t}toDOM(t=document,r={},n){const i=r[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),n!==void 0&&n._createAssociation(s,this),s}_write(t){t.writeTypeRef(KO),t.writeKey(this.hookName)}}const RO=e=>new rl(e.readKey());class nl extends Ai{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new nl}clone(){const t=new nl;return t.applyDelta(this.toDelta()),t}toDOM(t=document,r,n){const i=t.createTextNode(this.toString());return n!==void 0&&n._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const r=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),r.push({nodeName:i,attrs:s})}r.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let n="";for(let i=0;i<r.length;i++){const s=r[i];n+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];n+=` ${a.key}="${a.value}"`}n+=">"}n+=t.insert;for(let i=r.length-1;i>=0;i--)n+=`</${r[i].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(YO)}}const OO=e=>new nl;class vh{constructor(t,r){this.id=t,this.length=r}get deleted(){throw Zn()}mergeWith(t){return!1}write(t,r,n){throw Zn()}integrate(t,r){throw Zn()}}const IO=0;class gn extends vh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,r){r>0&&(this.id.clock+=r,this.length-=r),bg(t.doc.store,this)}write(t,r){t.writeInfo(IO),t.writeLen(this.length-r)}getMissing(t,r){return null}}class ya{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ya(this.content)}splice(t){throw Zn()}mergeWith(t){return!1}integrate(t,r){}delete(t){}gc(t){}write(t,r){t.writeBuf(this.content)}getRef(){return 3}}const NO=e=>new ya(e.readBuf());class _a{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new _a(this.len)}splice(t){const r=new _a(this.len-t);return this.len=t,r}mergeWith(t){return this.len+=t.len,!0}integrate(t,r){Gc(t.deleteSet,r.id.client,r.id.clock,this.len),r.markDeleted()}delete(t){}gc(t){}write(t,r){t.writeLen(this.len-r)}getRef(){return 1}}const CO=e=>new _a(e.readLen()),Gg=(e,t)=>new uo({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class ba{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const r={};this.opts=r,t.gc||(r.gc=!1),t.autoLoad&&(r.autoLoad=!0),t.meta!==null&&(r.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ba(Gg(this.doc.guid,this.opts))}splice(t){throw Zn()}mergeWith(t){return!1}integrate(t,r){this.doc._item=r,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,r){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const LO=e=>new ba(Gg(e.readString(),e.readAny()));class ks{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ks(this.embed)}splice(t){throw Zn()}mergeWith(t){return!1}integrate(t,r){}delete(t){}gc(t){}write(t,r){t.writeJSON(this.embed)}getRef(){return 5}}const MO=e=>new ks(e.readJSON());class rr{constructor(t,r){this.key=t,this.value=r}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new rr(this.key,this.value)}splice(t){throw Zn()}mergeWith(t){return!1}integrate(t,r){const n=r.parent;n._searchMarker=null,n._hasFormatting=!0}delete(t){}gc(t){}write(t,r){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const UO=e=>new rr(e.readKey(),e.readJSON());class il{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new il(this.arr)}splice(t){const r=new il(this.arr.slice(t));return this.arr=this.arr.slice(0,t),r}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,r){}delete(t){}gc(t){}write(t,r){const n=this.arr.length;t.writeLen(n-r);for(let i=r;i<n;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const PO=e=>{const t=e.readLen(),r=[];for(let n=0;n<t;n++){const i=e.readString();i==="undefined"?r.push(void 0):r.push(JSON.parse(i))}return new il(r)},FO=Hc("node_env")==="development";class xs{constructor(t){this.arr=t,FO&&Xm(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new xs(this.arr)}splice(t){const r=new xs(this.arr.slice(t));return this.arr=this.arr.slice(0,t),r}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,r){}delete(t){}gc(t){}write(t,r){const n=this.arr.length;t.writeLen(n-r);for(let i=r;i<n;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const $O=e=>{const t=e.readLen(),r=[];for(let n=0;n<t;n++)r.push(e.readAny());return new xs(r)};class ni{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ni(this.str)}splice(t){const r=new ni(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"�",r.str="�"+r.str.slice(1)),r}mergeWith(t){return this.str+=t.str,!0}integrate(t,r){}delete(t){}gc(t){}write(t,r){t.writeString(r===0?this.str:this.str.slice(r))}getRef(){return 4}}const BO=e=>new ni(e.readString()),DO=[yO,bO,xO,TO,AO,RO,OO],jO=0,zO=1,WO=2,HO=3,GO=4,KO=5,YO=6;class Ti{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ti(this.type._copy())}splice(t){throw Zn()}mergeWith(t){return!1}integrate(t,r){this.type._integrate(t.doc,r)}delete(t){let r=this.type._start;for(;r!==null;)r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t),r=r.right;this.type._map.forEach(n=>{n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t)}),t.changed.delete(this.type)}gc(t){let r=this.type._start;for(;r!==null;)r.gc(t,!0),r=r.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(t,!0),n=n.left}),this.type._map=new Map}write(t,r){this.type._write(t)}getRef(){return 7}}const qO=e=>new Ti(DO[e.readTypeRef()](e)),sl=(e,t,r)=>{const{client:n,clock:i}=t.id,s=new nr(ce(n,i+r),t,ce(n,i+r-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(r));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=ce(t.redone.client,t.redone.clock+r)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=r,s};class nr extends vh{constructor(t,r,n,i,s,o,a,c){super(t,c.getLength()),this.origin=n,this.left=r,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Lm:0}set marker(t){(this.info&zf)>0!==t&&(this.info^=zf)}get marker(){return(this.info&zf)>0}get keep(){return(this.info&Cm)>0}set keep(t){this.keep!==t&&(this.info^=Cm)}get countable(){return(this.info&Lm)>0}get deleted(){return(this.info&jf)>0}set deleted(t){this.deleted!==t&&(this.info^=jf)}markDeleted(){this.info|=jf}getMissing(t,r){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=ur(r,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=ur(r,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ho&&this.id.client!==this.parent.client&&this.parent.clock>=ur(r,this.parent.client))return this.parent.client;if(this.origin&&(this.left=wg(t,r,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Gi(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===gn||this.right&&this.right.constructor===gn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===nr?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===nr&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===ho){const n=uh(r,this.parent);n.constructor===gn?this.parent=null:this.parent=n.content.type}return null}integrate(t,r){if(r>0&&(this.id.clock+=r,this.left=wg(t,t.doc.store,ce(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(r),this.length-=r),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,i;if(n!==null)i=n.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Kc(this.origin,i.origin)){if(i.id.client<this.id.client)n=i,s.clear();else if(Kc(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(uh(t.doc.store,i.origin)))s.has(uh(t.doc.store,i.origin))||(n=i,s.clear());else break;i=i.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),bg(t.doc.store,this),this.content.integrate(t,this),kg(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new gn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:ce(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Kc(t.origin,this.lastId)&&this.right===t&&Kc(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const r=this.parent._searchMarker;return r&&r.forEach(n=>{n.p===t&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const r=this.parent;this.countable&&this.parentSub===null&&(r._length-=this.length),this.markDeleted(),Gc(t.deleteSet,this.id.client,this.id.clock,this.length),kg(t,r,this.parentSub),this.content.delete(t)}}gc(t,r){if(!this.deleted)throw Qn();this.content.gc(t),r?QR(t,this,new gn(this.id,this.length)):this.content=new _a(this.length)}write(t,r){const n=r>0?ce(this.id.client,this.id.clock+r-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Fc|(n===null?0:sn)|(i===null?0:Ei)|(s===null?0:oa);if(t.writeInfo(o),n!==null&&t.writeLeftID(n),i!==null&&t.writeRightID(i),n===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const u=ZR(a);t.writeParentInfo(!0),t.writeString(u)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===ho?(t.writeParentInfo(!1),t.writeLeftID(a)):Qn();s!==null&&t.writeString(s)}this.content.write(t,r)}}const Kg=(e,t)=>VO[t&Fc](e),VO=[()=>{Qn()},CO,PO,NO,BO,MO,UO,qO,$O,LO,()=>{Qn()}],XO=10;class yn extends vh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,r){Qn()}write(t,r){t.writeInfo(XO),de(t.restEncoder,this.length-r)}getMissing(t,r){return null}}const Yg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ro<"u"?ro:{},qg="__ $YJS$ __";Yg[qg]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Yg[qg]=!0;let Vg=!1;const cn=new uo;function Xg(e,t,r){const n=cn.getMap();if(!n.has(e))switch(t){case 0:case 1:n.set(e,r);break}}function JO(e,t){Xg(e,0,t)}function Eh(e,t){const r=new Ai(t);Xg(e,1,r)}function ZO(e,t){cn.getMap().set(e,t)}function QO(e,t){const r=cn.getMap(),n=new Ai(t);r.set(e,n)}function Jg(e,t){const r=cn.getMap();function n(i){const s=r.get(e);for(let o=0;o<i.length;++o)(i[o].target===r||i[o].target===s)&&t(s)}return r.has(e)&&t(r.get(e)),r.observeDeep(n),()=>{r.observeDeep(n)}}function tI(e,t){return Jg(e,r=>{Et(r)&&t(r)})}function Zg(e,t){return Jg(e,r=>{r instanceof Ai&&t(r.toJSON())})}const As=Zs("modem",["second"],e=>{if(As.session(e))switch(e.target){case"second":!Vg&&e.data%2===0&&As.emit(e.player,"modem:join");break;case"join":e.sender!==As.id()&&As.reply(e,"joinack",Tm(VR(cn)));break;case"joinack":e.sender!==As.id()&&(Vg=!0,hg(cn,Mc(e.data),cn));break;case"sync":{e.sender!==As.id()&&w(e.data)&&hg(cn,Mc(e.data),cn);break}}});function Qg(e,t){t!==cn&&As.emit("","modem:sync",Tm(e))}cn.on("update",Qg),cn.on("destroy",()=>{cn.off("update",Qg)});function ty(e,t){return e%t}function ey(e,t){return Math.floor(e/t)}function eI(e,t){return{x:ty(e,t),y:ey(e,t)}}function Wr(e,t){return e.x+e.y*t}function bo(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function kh(e,t,r,n,i,s){return e>=s&&e<=n&&t>=r&&t<=i}function ry(e,t,r,n){const i=[],s=Math.min(e,r),o=Math.max(e,r),a=Math.min(t,n),c=Math.max(t,n);for(let u=a;u<=c;++u)for(let l=s;l<=o;++l)i.push({x:l,y:u});return i}function ny(e,t,r,n){const i=[],s=Math.abs(r-e),o=Math.abs(n-t),a=e<r?1:-1,c=t<n?1:-1;let u=s-o;for(i.push({x:e,y:t});e!==r||t!==n;){const l=2*u;l>-o&&(u-=o,e+=a),l<s&&(u+=s,t+=c),i.push({x:e,y:t})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const iy="176",rI="",Pn="srgb",sy="srgb-linear",oy="linear",xh="srgb";function Fn(e,t,r){return Math.max(t,Math.min(r,e))}function nI(e,t){return(e%t+t)%t}function Ah(e,t,r){return(1-r)*e+r*t}class wa{constructor(t=0,r=0){wa.prototype.isVector2=!0,this.x=t,this.y=r}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,r){return this.x=t,this.y=r,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,r){switch(t){case 0:this.x=r;break;case 1:this.y=r;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,r){return this.x=t.x+r.x,this.y=t.y+r.y,this}addScaledVector(t,r){return this.x+=t.x*r,this.y+=t.y*r,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,r){return this.x=t.x-r.x,this.y=t.y-r.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const r=this.x,n=this.y,i=t.elements;return this.x=i[0]*r+i[3]*n+i[6],this.y=i[1]*r+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,r){return this.x=Fn(this.x,t.x,r.x),this.y=Fn(this.y,t.y,r.y),this}clampScalar(t,r){return this.x=Fn(this.x,t,r),this.y=Fn(this.y,t,r),this}clampLength(t,r){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Fn(n,t,r))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const r=Math.sqrt(this.lengthSq()*t.lengthSq());if(r===0)return Math.PI/2;const n=this.dot(t)/r;return Math.acos(Fn(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const r=this.x-t.x,n=this.y-t.y;return r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,r){return this.x+=(t.x-this.x)*r,this.y+=(t.y-this.y)*r,this}lerpVectors(t,r,n){return this.x=t.x+(r.x-t.x)*n,this.y=t.y+(r.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,r=0){return this.x=t[r],this.y=t[r+1],this}toArray(t=[],r=0){return t[r]=this.x,t[r+1]=this.y,t}fromBufferAttribute(t,r){return this.x=t.getX(r),this.y=t.getY(r),this}rotateAround(t,r){const n=Math.cos(r),i=Math.sin(r),s=this.x-t.x,o=this.y-t.y;return this.x=s*n-o*i+t.x,this.y=s*i+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class va{constructor(t,r,n,i,s,o,a,c,u){va.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,r,n,i,s,o,a,c,u)}set(t,r,n,i,s,o,a,c,u){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=r,l[4]=s,l[5]=c,l[6]=n,l[7]=o,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const r=this.elements,n=t.elements;return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],this}extractBasis(t,r,n){return t.setFromMatrix3Column(this,0),r.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const r=t.elements;return this.set(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,r){const n=t.elements,i=r.elements,s=this.elements,o=n[0],a=n[3],c=n[6],u=n[1],l=n[4],h=n[7],d=n[2],f=n[5],m=n[8],p=i[0],g=i[3],y=i[6],b=i[1],T=i[4],A=i[7],x=i[2],I=i[5],R=i[8];return s[0]=o*p+a*b+c*x,s[3]=o*g+a*T+c*I,s[6]=o*y+a*A+c*R,s[1]=u*p+l*b+h*x,s[4]=u*g+l*T+h*I,s[7]=u*y+l*A+h*R,s[2]=d*p+f*b+m*x,s[5]=d*g+f*T+m*I,s[8]=d*y+f*A+m*R,this}multiplyScalar(t){const r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=t,r[4]*=t,r[7]*=t,r[2]*=t,r[5]*=t,r[8]*=t,this}determinant(){const t=this.elements,r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8];return r*o*l-r*a*u-n*s*l+n*a*c+i*s*u-i*o*c}invert(){const t=this.elements,r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=l*o-a*u,d=a*c-l*s,f=u*s-o*c,m=r*h+n*d+i*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=h*p,t[1]=(i*u-l*n)*p,t[2]=(a*n-i*o)*p,t[3]=d*p,t[4]=(l*r-i*c)*p,t[5]=(i*s-a*r)*p,t[6]=f*p,t[7]=(n*c-u*r)*p,t[8]=(o*r-n*s)*p,this}transpose(){let t;const r=this.elements;return t=r[1],r[1]=r[3],r[3]=t,t=r[2],r[2]=r[6],r[6]=t,t=r[5],r[5]=r[7],r[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const r=this.elements;return t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8],this}setUvTransform(t,r,n,i,s,o,a){const c=Math.cos(s),u=Math.sin(s);return this.set(n*c,n*u,-n*(c*o+u*a)+o+t,-i*u,i*c,-i*(-u*o+c*a)+a+r,0,0,1),this}scale(t,r){return this.premultiply(Th.makeScale(t,r)),this}rotate(t){return this.premultiply(Th.makeRotation(-t)),this}translate(t,r){return this.premultiply(Th.makeTranslation(t,r)),this}makeTranslation(t,r){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,r,0,0,1),this}makeRotation(t){const r=Math.cos(t),n=Math.sin(t);return this.set(r,-n,0,n,r,0,0,0,1),this}makeScale(t,r){return this.set(t,0,0,0,r,0,0,0,1),this}equals(t){const r=this.elements,n=t.elements;for(let i=0;i<9;i++)if(r[i]!==n[i])return!1;return!0}fromArray(t,r=0){for(let n=0;n<9;n++)this.elements[n]=t[n+r];return this}toArray(t=[],r=0){const n=this.elements;return t[r]=n[0],t[r+1]=n[1],t[r+2]=n[2],t[r+3]=n[3],t[r+4]=n[4],t[r+5]=n[5],t[r+6]=n[6],t[r+7]=n[7],t[r+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Th=new va,ay=new va().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),cy=new va().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function iI(){const e={enabled:!0,workingColorSpace:sy,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===xh&&(i.r=wo(i.r),i.g=wo(i.g),i.b=wo(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===xh&&(i.r=vo(i.r),i.g=vo(i.g),i.b=vo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===rI?oy:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],r=[.2126,.7152,.0722],n=[.3127,.329];return e.define({[sy]:{primaries:t,whitePoint:n,transfer:oy,toXYZ:ay,fromXYZ:cy,luminanceCoefficients:r,workingColorSpaceConfig:{unpackColorSpace:Pn},outputColorSpaceConfig:{drawingBufferColorSpace:Pn}},[Pn]:{primaries:t,whitePoint:n,transfer:xh,toXYZ:ay,fromXYZ:cy,luminanceCoefficients:r,outputColorSpaceConfig:{drawingBufferColorSpace:Pn}}}),e}const $n=iI();function wo(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function vo(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const ly={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},qi={h:0,s:0,l:0},ol={h:0,s:0,l:0};function Sh(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*6*(2/3-r):e}class Rh{constructor(t,r,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,r,n)}set(t,r,n){if(r===void 0&&n===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,r,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,r=Pn){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,$n.toWorkingColorSpace(this,r),this}setRGB(t,r,n,i=$n.workingColorSpace){return this.r=t,this.g=r,this.b=n,$n.toWorkingColorSpace(this,i),this}setHSL(t,r,n,i=$n.workingColorSpace){if(t=nI(t,1),r=Fn(r,0,1),n=Fn(n,0,1),r===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+r):n+r-n*r,o=2*n-s;this.r=Sh(o,s,t+1/3),this.g=Sh(o,s,t),this.b=Sh(o,s,t-1/3)}return $n.toWorkingColorSpace(this,i),this}setStyle(t,r=Pn){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,r);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,r);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,r);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,r);if(o===6)return this.setHex(parseInt(s,16),r);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,r);return this}setColorName(t,r=Pn){const n=ly[t.toLowerCase()];return n!==void 0?this.setHex(n,r):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=wo(t.r),this.g=wo(t.g),this.b=wo(t.b),this}copyLinearToSRGB(t){return this.r=vo(t.r),this.g=vo(t.g),this.b=vo(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Pn){return $n.fromWorkingColorSpace(Sr.copy(this),t),Math.round(Fn(Sr.r*255,0,255))*65536+Math.round(Fn(Sr.g*255,0,255))*256+Math.round(Fn(Sr.b*255,0,255))}getHexString(t=Pn){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,r=$n.workingColorSpace){$n.fromWorkingColorSpace(Sr.copy(this),r);const n=Sr.r,i=Sr.g,s=Sr.b,o=Math.max(n,i,s),a=Math.min(n,i,s);let c,u;const l=(a+o)/2;if(a===o)c=0,u=0;else{const h=o-a;switch(u=l<=.5?h/(o+a):h/(2-o-a),o){case n:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-n)/h+2;break;case s:c=(n-i)/h+4;break}c/=6}return t.h=c,t.s=u,t.l=l,t}getRGB(t,r=$n.workingColorSpace){return $n.fromWorkingColorSpace(Sr.copy(this),r),t.r=Sr.r,t.g=Sr.g,t.b=Sr.b,t}getStyle(t=Pn){$n.fromWorkingColorSpace(Sr.copy(this),t);const r=Sr.r,n=Sr.g,i=Sr.b;return t!==Pn?`color(${t} ${r.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(r*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(t,r,n){return this.getHSL(qi),this.setHSL(qi.h+t,qi.s+r,qi.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,r){return this.r=t.r+r.r,this.g=t.g+r.g,this.b=t.b+r.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,r){return this.r+=(t.r-this.r)*r,this.g+=(t.g-this.g)*r,this.b+=(t.b-this.b)*r,this}lerpColors(t,r,n){return this.r=t.r+(r.r-t.r)*n,this.g=t.g+(r.g-t.g)*n,this.b=t.b+(r.b-t.b)*n,this}lerpHSL(t,r){this.getHSL(qi),t.getHSL(ol);const n=Ah(qi.h,ol.h,r),i=Ah(qi.s,ol.s,r),s=Ah(qi.l,ol.l,r);return this.setHSL(n,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const r=this.r,n=this.g,i=this.b,s=t.elements;return this.r=s[0]*r+s[3]*n+s[6]*i,this.g=s[1]*r+s[4]*n+s[7]*i,this.b=s[2]*r+s[5]*n+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,r=0){return this.r=t[r],this.g=t[r+1],this.b=t[r+2],this}toArray(t=[],r=0){return t[r]=this.r,t[r+1]=this.g,t[r+2]=this.b,t}fromBufferAttribute(t,r){return this.r=t.getX(r),this.g=t.getY(r),this.b=t.getZ(r),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Sr=new Rh;Rh.NAMES=ly,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:iy}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=iy),new wa,new wa;function Ge(e,t,r){return Math.max(t,Math.min(r,e))}function uy(e){return e/180*Math.PI}function fy(e){return e*180/Math.PI}const sI=j0("089fad0j9awfem09wavefc09uwaef");function oI(){return sI()}function aI(e){return j0(e)()}function _n(e,t){const r=Math.min(e,t),i=Math.max(e,t)-r+1;return r+Math.floor(oI()*i)}function hy(e,t,r){const n=Math.min(t,r),s=Math.max(t,r)-n+1;return n+Math.floor(aI(e)*s)}function dy(e,t,r){typeof r!="number"&&(r=1);const n=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=r)n.push(o);return n}function cI(e){return e[_n(0,e.length-1)]}function lI(e,t){return t[hy(e,0,t.length-1)]}function bn(...e){return cI(e.flat())}function uI(e,...t){return lI(e,t.flat())}function fI(e){return[...new Set(e)].filter(w)}function Ea(e){return w(e)&&w(e.x)&&w(e.y)}function Be(e,t){switch(t){case bt.NORTH:--e.y;break;case bt.SOUTH:++e.y;break;case bt.WEST:--e.x;break;case bt.EAST:++e.x;break}return e}function Oh(e,t){return e<0?bt.WEST:e>0?bt.EAST:t<0?bt.NORTH:t>0?bt.SOUTH:bt.IDLE}function Bn(e,t){return Oh(t.x-e.x,t.y-e.y)}const Ih={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function Hr(e){return pe(e)&&py(e[0])}function py(e){return w(bt[e])&&yt(e)}function my(e){const t=bt[e];return w(t)?t:bt.IDLE}function al(e){if(yt(e))return Ih[Dt(e)]}function hI(e){if(Hr(e))return e;if(py(e))return[e];const t=al(e);if(w(t))return[t]}function gy(e){const t=k.words[e],r=hI(t);return Hr(r)?[r,e+1]:[void 0,e]}function yy(e){var i,s;const t=[];let[r,n]=gy(e);for(;Hr(r);){switch(t.push(...r),r[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,u,l]=ut(k.words,n,[q.NUMBER,q.NUMBER]);t.push(c,u),n=l;break}case"FLEE":case"FIND":{const[c,u]=ut(k.words,n,[q.KIND]);console.info("kind",c),n=u;break}case"TO":{const[c,u,l]=ut(k.words,n,[q.DIR,q.DIR]),h=((i=k.element)==null?void 0:i.x)??0,d=((s=k.element)==null?void 0:s.y)??0;c.destpt.x-=h,c.destpt.y-=d,u.destpt.x-=h,u.destpt.y-=d,t.push(h+c.destpt.x+u.destpt.x,d+c.destpt.y+u.destpt.y),n=l;break}}switch(r[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[t,n]}const[o,a]=gy(n);r=o,n=a}return t.length?[t,n]:[void 0,e]}function dI(e){return w(e)&&e<zt.ONBLACK?e:void 0}function Nh(e){return w(e)&&e>zt.WHITE&&e<zt.ONCLEAR?e-zt.ONBLACK:void 0}const ka={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Cr(e){return pe(e)&&_y(e[0])}function pI(e){return Cr(e)&&e[0].startsWith("ON")}function _y(e){return w(zt[e])&&yt(e)}function xa(e){if(yt(e))return ka[Dt(e)]}function Aa(e,t){return[w(e)?`${zt[e]}`:void 0,w(t)?`ON${zt[t]}`:void 0].filter(w)}function cl(e){return e.map(t=>zt[t]).find(t=>w(t)&&t<zt.ONBLACK)}function ll(e){return e.map(t=>zt[t]).find(t=>w(t)&&t>=zt.ONBLACK)}function mI(e){if(Cr(e))return e;if(_y(e))return[e];const t=xa(e);if(w(t))return[t]}function by(e){const t=k.words[e],r=mI(t);return Cr(r)?[r,e+1]:[void 0,e]}function ul(e){const t=[];let r=e;const n=parseFloat(k.words[e]);if(Et(n))return[Aa(n,void 0),e+1];const[i,s]=by(e);Cr(i)&&(t.push(...i),r=s);const[o,a]=by(s);return pI(o)&&(t.push(...o),r=a),t.length?[t,r]:[void 0,e]}function wy(e){const t={};for(let r=0;r<e.length;++r){const n=e[r],i=zt[n];w(i)&&(i<zt.ONBLACK?t.color=i:t.bg=Nh(i))}return t}var vy={exports:{}},Ch={exports:{}},Ey;function gI(){return Ey||(Ey=1,function(e,t){(function(r,n){e.exports=n()})(tr,function(){function r(p){return!isNaN(parseFloat(p))&&isFinite(p)}function n(p){return p.charAt(0).toUpperCase()+p.substring(1)}function i(p){return function(){return this[p]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],u=["evalOrigin"],l=s.concat(o,a,c,u);function h(p){if(p)for(var g=0;g<l.length;g++)p[l[g]]!==void 0&&this["set"+n(l[g])](p[l[g]])}h.prototype={getArgs:function(){return this.args},setArgs:function(p){if(Object.prototype.toString.call(p)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=p},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(p){if(p instanceof h)this.evalOrigin=p;else if(p instanceof Object)this.evalOrigin=new h(p);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var p=this.getFileName()||"",g=this.getLineNumber()||"",y=this.getColumnNumber()||"",b=this.getFunctionName()||"";return this.getIsEval()?p?"[eval] ("+p+":"+g+":"+y+")":"[eval]:"+g+":"+y:b?b+" ("+p+":"+g+":"+y+")":p+":"+g+":"+y}},h.fromString=function(g){var y=g.indexOf("("),b=g.lastIndexOf(")"),T=g.substring(0,y),A=g.substring(y+1,b).split(","),x=g.substring(b+1);if(x.indexOf("@")===0)var I=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(x,""),R=I[1],$=I[2],M=I[3];return new h({functionName:T,args:A||void 0,fileName:R,lineNumber:$||void 0,columnNumber:M||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+n(s[d])]=i(s[d]),h.prototype["set"+n(s[d])]=function(p){return function(g){this[p]=!!g}}(s[d]);for(var f=0;f<o.length;f++)h.prototype["get"+n(o[f])]=i(o[f]),h.prototype["set"+n(o[f])]=function(p){return function(g){if(!r(g))throw new TypeError(p+" must be a Number");this[p]=Number(g)}}(o[f]);for(var m=0;m<a.length;m++)h.prototype["get"+n(a[m])]=i(a[m]),h.prototype["set"+n(a[m])]=function(p){return function(g){this[p]=String(g)}}(a[m]);return h})}(Ch)),Ch.exports}(function(e,t){(function(r,n){e.exports=n(gI())})(tr,function(n){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var u=/(.+?)(?::(\d+))?(?::(\d+))?$/,l=u.exec(c.replace(/[()]/g,""));return[l[1],l[2]||void 0,l[3]||void 0]},parseV8OrIE:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(s)},this);return u.map(function(l){l.indexOf("(eval ")>-1&&(l=l.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=l.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),m=d&&h||void 0,p=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new n({functionName:m,fileName:p,lineNumber:f[1],columnNumber:f[2],source:l})},this)},parseFFOrSafari:function(c){var u=c.stack.split(`
`).filter(function(l){return!l.match(o)},this);return u.map(function(l){if(l.indexOf(" > eval")>-1&&(l=l.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),l.indexOf("@")===-1&&l.indexOf(":")===-1)return new n({functionName:l});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=l.match(h),f=d&&d[1]?d[1]:void 0,m=this.extractLocation(l.replace(h,""));return new n({functionName:f,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:l})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)/i,l=c.message.split(`
`),h=[],d=2,f=l.length;d<f;d+=2){var m=u.exec(l[d]);m&&h.push(new n({fileName:m[2],lineNumber:m[1],source:l[d]}))}return h},parseOpera10:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,l=c.stacktrace.split(`
`),h=[],d=0,f=l.length;d<f;d+=2){var m=u.exec(l[d]);m&&h.push(new n({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:l[d]}))}return h},parseOpera11:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(i)&&!l.match(/^Error created at/)},this);return u.map(function(l){var h=l.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",m=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,p;f.match(/\(([^)]*)\)/)&&(p=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var g=p===void 0||p==="[arguments not available]"?void 0:p.split(",");return new n({functionName:m,args:g,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:l})},this)}}})})(vy);var yI=vy.exports,_I=ps(yI);const Ct=60,Zt=25,Lh=Ct*Zt;var vt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(vt||{});const Mh=14,fl=3,Ts=8,Ss=14,hl=16,bI=16,wI=16;var dl=(e=>(e[e.FAR=1]="FAR",e[e.MID=1.5]="MID",e[e.NEAR=3]="NEAR",e))(dl||{});function Ta(e,t){return new Array(e).fill(t)}function vI(e,t,r,n,i,s=0){const o=n*i;return{id:`tiles:${e}:${t}`,type:1,tag:r,width:n,height:i,char:Ta(o,0),color:Ta(o,0),bg:Ta(o,s),wall:Ta(o,0)}}function EI(e,t,r,n=1,i=15){return{id:`sprites:${e}:${t}:${r}`,x:0,y:0,char:n,color:i,bg:zt.ONCLEAR}}function kI(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function xI(e,t,r,n,i=0){const s=r*n;return{id:`dither:${e}:${t}`,type:3,width:r,height:n,alphas:Ta(s,i)}}function AI(e,t,r,n){return{id:`media:${e}:${t}`,type:4,mime:r,media:n}}function TI(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5,graphics:"flat",facing:0}}function ky(e,t){return`${e}:${t}`}const SI=1,RI=16,OI=256;var Lr=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(Lr||{});const ii=!!JSON.parse("false"),II=!!JSON.parse("false");JSON.parse("false");const xy=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const Rs={HALT_AT_COUNT:256},lt=Zs("SOFTWARE");function Si(e){const t={},r={tick(){},everytick(){},listcommands(){return Dr(t)},...e,getcommand(n){return t[n]},command(n,i){return t[n]=i,r}};return r}function Ie(e){return`${e??""}`}function Sa(e,t){const r=parseFloat(Ie(e));return isNaN(r)?t:r}function Gr(e,t,r,n){const[i,s]=ut(n,0,[q.NUMBER_OR_STRING,q.MAYBE_NUMBER_OR_STRING]);em(lt,e,t,r,i,s)}const NI=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function Ay(e,t,r){const[n,i]=ut(r,0,[q.NUMBER_OR_STRING]);if(Et(n))xf(lt,e,t,"volume",n);else if(NI.includes(Dt(n))){const[s,o]=ut(r,i,[q.NUMBER_OR_STRING,q.MAYBE_NUMBER_OR_STRING]);em(lt,e,t,n,s,o)}else{const[s]=ut(r,i,[q.MAYBE_NUMBER_OR_STRING]);if(Et(s)){const o=r.length-i,a=new Array(o).fill(q.NUMBER),c=ut(r,i,a).slice(0,o),u=c.length===1?c[0]:c;xf(lt,e,t,n,u)}else{const[o]=ut(r,i,[q.MAYBE_NUMBER_OR_STRING]);xf(lt,e,t,n,o)}}}let Ty="en-US-GuyNeural";function Vi(e,t){var n;const[r]=ut(e,0,[q.MAYBE_NAME]);UT(lt,k.elementfocus,((n=k.board)==null?void 0:n.id)??"",r??"",t)}const Uh=Si().command("talk",(e,t)=>{const[r]=ut(t,0,[q.ANY]);switch(Dt(r)){default:pT(lt,k.elementfocus);break;case"stop":mT(lt,k.elementfocus);break}return 0}).command("media",(e,t)=>{const[r]=ut(t,0,[q.ANY]);switch(Dt(r)){default:gT(lt,k.elementfocus);break;case"stop":yT(lt,k.elementfocus);break}return 0}).command("tts",(e,t)=>{const r=t.map(Ie).join("");return LT(lt,k.elementfocus,Ty,r),0}).command("ttsvoice",(e,t)=>(Ty=t.map(Ie).join(""),0)).command("bpm",(e,t)=>{const[r]=ut(t,0,[q.NUMBER]);return PT(lt,k.elementfocus,r),0}).command("vol",(e,t)=>{const[r]=ut(t,0,[q.NUMBER]);return FT(lt,k.elementfocus,r),0}).command("bgvol",(e,t)=>{const[r]=ut(t,0,[q.NUMBER]);return $T(lt,k.elementfocus,r),0}).command("ttsvol",(e,t)=>{const[r]=ut(t,0,[q.NUMBER]);return BT(lt,k.elementfocus,r),0}).command("play",(e,t)=>{var n;const[r]=ut(t,0,[q.MAYBE_NAME]);return MT(lt,k.elementfocus,((n=k.board)==null?void 0:n.id)??"",r??""),0}).command("bgplay",(e,t)=>(Vi(t,""),0)).command("bgplayon64n",(e,t)=>(Vi(t,"@64n"),0)).command("bgplayon32n",(e,t)=>(Vi(t,"@32n"),0)).command("bgplayon16n",(e,t)=>(Vi(t,"@16n"),0)).command("bgplayon8n",(e,t)=>(Vi(t,"@8n"),0)).command("bgplayon4n",(e,t)=>(Vi(t,"@4n"),0)).command("bgplayon2n",(e,t)=>(Vi(t,"@2n"),0)).command("bgplayon1n",(e,t)=>(Vi(t,"@1m"),0)).command("synth",(e,t)=>{for(let r=0;r<8;++r)Ay(k.elementfocus,r,t);return 0}).command("echo",(e,t)=>{for(let r=0;r<3;++r)Gr(k.elementfocus,r,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let r=0;r<3;++r)Gr(k.elementfocus,r,"fc",t);return 0}).command("phaser",(e,t)=>{for(let r=0;r<3;++r)Gr(k.elementfocus,r,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let r=0;r<3;++r)Gr(k.elementfocus,r,"reverb",t);return 0}).command("distort",(e,t)=>{for(let r=0;r<3;++r)Gr(k.elementfocus,r,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let r=0;r<3;++r)Gr(k.elementfocus,r,"vibrato",t);return 0}).command("autowah",(e,t)=>{for(let r=0;r<3;++r)Gr(k.elementfocus,r,"autowah",t);return 0});for(let e=0;e<8;++e)Uh.command(`synth${e+1}`,(t,r)=>(Ay(k.elementfocus,e,r),0));for(let e=0;e<3;++e){const t=e+1;Uh.command(`echo${t}`,(r,n)=>(Gr(k.elementfocus,e,"echo",n),0)).command(`fcrush${t}`,(r,n)=>(Gr(k.elementfocus,e,"fcrush",n),0)).command(`phaser${t}`,(r,n)=>(Gr(k.elementfocus,e,"phaser",n),0)).command(`reverb${t}`,(r,n)=>(Gr(k.elementfocus,e,"reverb",n),0)).command(`distort${t}`,(r,n)=>(Gr(k.elementfocus,e,"distort",n),0)).command(`vibrato${t}`,(r,n)=>(Gr(k.elementfocus,e,"vibrato",n),0)).command(`autowah${t}`,(r,n)=>(Gr(k.elementfocus,e,"autowah",n),0))}var pl={},Ph,Sy;function CI(){if(Sy)return Ph;Sy=1;var e,t,r={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},n;function i(f){throw{name:"SyntaxError",message:f,at:e,text:n}}function s(f){return f&&f!==t&&i("Expected '"+f+"' instead of '"+t+"'"),t=n.charAt(e),e+=1,t}function o(){var f,m="";for(t==="-"&&(m="-",s("-"));t>="0"&&t<="9";)m+=t,s();if(t===".")for(m+=".";s()&&t>="0"&&t<="9";)m+=t;if(t==="e"||t==="E")for(m+=t,s(),(t==="-"||t==="+")&&(m+=t,s());t>="0"&&t<="9";)m+=t,s();return f=Number(m),isFinite(f)||i("Bad number"),f}function a(){var f,m,p="",g;if(t==='"')for(;s();){if(t==='"')return s(),p;if(t==="\\")if(s(),t==="u"){for(g=0,m=0;m<4&&(f=parseInt(s(),16),!!isFinite(f));m+=1)g=g*16+f;p+=String.fromCharCode(g)}else if(typeof r[t]=="string")p+=r[t];else break;else p+=t}i("Bad string")}function c(){for(;t&&t<=" ";)s()}function u(){switch(t){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null;default:i("Unexpected '"+t+"'")}}function l(){var f=[];if(t==="["){if(s("["),c(),t==="]")return s("]"),f;for(;t;){if(f.push(d()),c(),t==="]")return s("]"),f;s(","),c()}}i("Bad array")}function h(){var f,m={};if(t==="{"){if(s("{"),c(),t==="}")return s("}"),m;for(;t;){if(f=a(),c(),s(":"),Object.prototype.hasOwnProperty.call(m,f)&&i('Duplicate key "'+f+'"'),m[f]=d(),c(),t==="}")return s("}"),m;s(","),c()}}i("Bad object")}function d(){switch(c(),t){case"{":return h();case"[":return l();case'"':return a();case"-":return o();default:return t>="0"&&t<="9"?o():u()}}return Ph=function(f,m){var p;return n=f,e=0,t=" ",p=d(),c(),t&&i("Syntax error"),typeof m=="function"?function g(y,b){var T,A,x=y[b];if(x&&typeof x=="object")for(T in d)Object.prototype.hasOwnProperty.call(x,T)&&(A=g(x,T),typeof A>"u"?delete x[T]:x[T]=A);return m.call(y,b,x)}({"":p},""):p},Ph}var Fh,Ry;function LI(){if(Ry)return Fh;Ry=1;var e=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,t,r,n={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;function s(a){return e.lastIndex=0,e.test(a)?'"'+a.replace(e,function(c){var u=n[c];return typeof u=="string"?u:"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function o(a,c){var u,l,h,d,f=t,m,p=c[a];switch(p&&typeof p=="object"&&typeof p.toJSON=="function"&&(p=p.toJSON(a)),typeof i=="function"&&(p=i.call(c,a,p)),typeof p){case"string":return s(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(t+=r,m=[],Object.prototype.toString.apply(p)==="[object Array]"){for(d=p.length,u=0;u<d;u+=1)m[u]=o(u,p)||"null";return h=m.length===0?"[]":t?`[
`+t+m.join(`,
`+t)+`
`+f+"]":"["+m.join(",")+"]",t=f,h}if(i&&typeof i=="object")for(d=i.length,u=0;u<d;u+=1)l=i[u],typeof l=="string"&&(h=o(l,p),h&&m.push(s(l)+(t?": ":":")+h));else for(l in p)Object.prototype.hasOwnProperty.call(p,l)&&(h=o(l,p),h&&m.push(s(l)+(t?": ":":")+h));return h=m.length===0?"{}":t?`{
`+t+m.join(`,
`+t)+`
`+f+"}":"{"+m.join(",")+"}",t=f,h}}return Fh=function(a,c,u){var l;if(t="",r="",typeof u=="number")for(l=0;l<u;l+=1)r+=" ";else typeof u=="string"&&(r=u);if(i=c,c&&typeof c!="function"&&(typeof c!="object"||typeof c.length!="number"))throw new Error("JSON.stringify");return o("",{"":a})},Fh}var Oy;function MI(){return Oy||(Oy=1,pl.parse=CI(),pl.stringify=LI()),pl}var UI={}.toString,PI=Array.isArray||function(e){return UI.call(e)=="[object Array]"},Iy=Object.prototype.toString,Ny=function(t){var r=Iy.call(t),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&Iy.call(t.callee)==="[object Function]"),n},$h,Cy;function FI(){if(Cy)return $h;Cy=1;var e;if(!Object.keys){var t=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=Ny,i=Object.prototype.propertyIsEnumerable,s=!i.call({toString:null},"toString"),o=i.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(d){var f=d.constructor;return f&&f.prototype===d},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},l=function(){if(typeof window>"u")return!1;for(var d in window)try{if(!u["$"+d]&&t.call(window,d)&&window[d]!==null&&typeof window[d]=="object")try{c(window[d])}catch{return!0}}catch{return!0}return!1}(),h=function(d){if(typeof window>"u"||!l)return c(d);try{return c(d)}catch{return!1}};e=function(f){var m=f!==null&&typeof f=="object",p=r.call(f)==="[object Function]",g=n(f),y=m&&r.call(f)==="[object String]",b=[];if(!m&&!p&&!g)throw new TypeError("Object.keys called on a non-object");var T=o&&p;if(y&&f.length>0&&!t.call(f,0))for(var A=0;A<f.length;++A)b.push(String(A));if(g&&f.length>0)for(var x=0;x<f.length;++x)b.push(String(x));else for(var I in f)!(T&&I==="prototype")&&t.call(f,I)&&b.push(String(I));if(s)for(var R=h(f),$=0;$<a.length;++$)!(R&&a[$]==="constructor")&&t.call(f,a[$])&&b.push(a[$]);return b}}return $h=e,$h}var $I=Array.prototype.slice,BI=Ny,Ly=Object.keys,ml=Ly?function(t){return Ly(t)}:FI(),My=Object.keys;ml.shim=function(){if(Object.keys){var t=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);t||(Object.keys=function(n){return BI(n)?My($I.call(n)):My(n)})}else Object.keys=ml;return Object.keys||ml};var DI=ml,Uy={exports:{}},Py=Object,jI=Error,zI=EvalError,WI=RangeError,HI=ReferenceError,Fy=SyntaxError,Xi=TypeError,GI=URIError,KI=Math.abs,YI=Math.floor,qI=Math.max,VI=Math.min,XI=Math.pow,JI=Math.round,ZI=Number.isNaN||function(t){return t!==t},QI=ZI,tN=function(t){return QI(t)||t===0?t:t<0?-1:1},eN=Object.getOwnPropertyDescriptor,gl=eN;if(gl)try{gl([],"length")}catch{gl=null}var yl=gl,_l=Object.defineProperty||!1;if(_l)try{_l({},"a",{value:1})}catch{_l=!1}var bl=_l,Bh,$y;function rN(){return $y||($y=1,Bh=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;t[r]=i;for(var s in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,r);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),Bh}var Dh,By;function nN(){if(By)return Dh;By=1;var e=typeof Symbol<"u"&&Symbol,t=rN();return Dh=function(){return typeof e!="function"||typeof Symbol!="function"||typeof e("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Dh}var jh,Dy;function jy(){return Dy||(Dy=1,jh=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),jh}var zh,zy;function Wy(){if(zy)return zh;zy=1;var e=Py;return zh=e.getPrototypeOf||null,zh}var iN="Function.prototype.bind called on incompatible ",sN=Object.prototype.toString,oN=Math.max,aN="[object Function]",Hy=function(t,r){for(var n=[],i=0;i<t.length;i+=1)n[i]=t[i];for(var s=0;s<r.length;s+=1)n[s+t.length]=r[s];return n},cN=function(t,r){for(var n=[],i=r,s=0;i<t.length;i+=1,s+=1)n[s]=t[i];return n},lN=function(e,t){for(var r="",n=0;n<e.length;n+=1)r+=e[n],n+1<e.length&&(r+=t);return r},uN=function(t){var r=this;if(typeof r!="function"||sN.apply(r)!==aN)throw new TypeError(iN+r);for(var n=cN(arguments,1),i,s=function(){if(this instanceof i){var l=r.apply(this,Hy(n,arguments));return Object(l)===l?l:this}return r.apply(t,Hy(n,arguments))},o=oN(0,r.length-n.length),a=[],c=0;c<o;c++)a[c]="$"+c;if(i=Function("binder","return function ("+lN(a,",")+"){ return binder.apply(this,arguments); }")(s),r.prototype){var u=function(){};u.prototype=r.prototype,i.prototype=new u,u.prototype=null}return i},fN=uN,Ra=Function.prototype.bind||fN,Wh=Function.prototype.call,Hh=Function.prototype.apply,hN=typeof Reflect<"u"&&Reflect&&Reflect.apply,dN=Ra,pN=Hh,mN=Wh,gN=hN,Gy=gN||dN.call(mN,pN),yN=Ra,_N=Xi,bN=Wh,wN=Gy,Gh=function(t){if(t.length<1||typeof t[0]!="function")throw new _N("a function is required");return wN(yN,bN,t)},Kh,Ky;function vN(){if(Ky)return Kh;Ky=1;var e=Gh,t=yl,r;try{r=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var n=!!r&&t&&t(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return Kh=n&&typeof n.get=="function"?e([n.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,Kh}var Yh,Yy;function EN(){if(Yy)return Yh;Yy=1;var e=jy(),t=Wy(),r=vN();return Yh=e?function(i){return e(i)}:t?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return t(i)}:r?function(i){return r(i)}:null,Yh}var qh,qy;function kN(){if(qy)return qh;qy=1;var e=Function.prototype.call,t=Object.prototype.hasOwnProperty,r=Ra;return qh=r.call(e,t),qh}var se,xN=Py,AN=jI,TN=zI,SN=WI,RN=HI,Eo=Fy,ko=Xi,ON=GI,IN=KI,NN=YI,CN=qI,LN=VI,MN=XI,UN=JI,PN=tN,Vy=Function,Vh=function(e){try{return Vy('"use strict"; return ('+e+").constructor;")()}catch{}},Oa=yl,FN=bl,Xh=function(){throw new ko},$N=Oa?function(){try{return arguments.callee,Xh}catch{try{return Oa(arguments,"callee").get}catch{return Xh}}}():Xh,xo=nN()(),fr=EN(),BN=Wy(),DN=jy(),Xy=Hh,Ia=Wh,Ao={},jN=typeof Uint8Array>"u"||!fr?se:fr(Uint8Array),Os={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?se:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?se:ArrayBuffer,"%ArrayIteratorPrototype%":xo&&fr?fr([][Symbol.iterator]()):se,"%AsyncFromSyncIteratorPrototype%":se,"%AsyncFunction%":Ao,"%AsyncGenerator%":Ao,"%AsyncGeneratorFunction%":Ao,"%AsyncIteratorPrototype%":Ao,"%Atomics%":typeof Atomics>"u"?se:Atomics,"%BigInt%":typeof BigInt>"u"?se:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?se:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?se:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?se:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":AN,"%eval%":eval,"%EvalError%":TN,"%Float16Array%":typeof Float16Array>"u"?se:Float16Array,"%Float32Array%":typeof Float32Array>"u"?se:Float32Array,"%Float64Array%":typeof Float64Array>"u"?se:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?se:FinalizationRegistry,"%Function%":Vy,"%GeneratorFunction%":Ao,"%Int8Array%":typeof Int8Array>"u"?se:Int8Array,"%Int16Array%":typeof Int16Array>"u"?se:Int16Array,"%Int32Array%":typeof Int32Array>"u"?se:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":xo&&fr?fr(fr([][Symbol.iterator]())):se,"%JSON%":typeof JSON=="object"?JSON:se,"%Map%":typeof Map>"u"?se:Map,"%MapIteratorPrototype%":typeof Map>"u"||!xo||!fr?se:fr(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":xN,"%Object.getOwnPropertyDescriptor%":Oa,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?se:Promise,"%Proxy%":typeof Proxy>"u"?se:Proxy,"%RangeError%":SN,"%ReferenceError%":RN,"%Reflect%":typeof Reflect>"u"?se:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?se:Set,"%SetIteratorPrototype%":typeof Set>"u"||!xo||!fr?se:fr(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?se:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":xo&&fr?fr(""[Symbol.iterator]()):se,"%Symbol%":xo?Symbol:se,"%SyntaxError%":Eo,"%ThrowTypeError%":$N,"%TypedArray%":jN,"%TypeError%":ko,"%Uint8Array%":typeof Uint8Array>"u"?se:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?se:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?se:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?se:Uint32Array,"%URIError%":ON,"%WeakMap%":typeof WeakMap>"u"?se:WeakMap,"%WeakRef%":typeof WeakRef>"u"?se:WeakRef,"%WeakSet%":typeof WeakSet>"u"?se:WeakSet,"%Function.prototype.call%":Ia,"%Function.prototype.apply%":Xy,"%Object.defineProperty%":FN,"%Object.getPrototypeOf%":BN,"%Math.abs%":IN,"%Math.floor%":NN,"%Math.max%":CN,"%Math.min%":LN,"%Math.pow%":MN,"%Math.round%":UN,"%Math.sign%":PN,"%Reflect.getPrototypeOf%":DN};if(fr)try{null.error}catch(e){var zN=fr(fr(e));Os["%Error.prototype%"]=zN}var WN=function e(t){var r;if(t==="%AsyncFunction%")r=Vh("async function () {}");else if(t==="%GeneratorFunction%")r=Vh("function* () {}");else if(t==="%AsyncGeneratorFunction%")r=Vh("async function* () {}");else if(t==="%AsyncGenerator%"){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if(t==="%AsyncIteratorPrototype%"){var i=e("%AsyncGenerator%");i&&fr&&(r=fr(i.prototype))}return Os[t]=r,r},Jy={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Na=Ra,wl=kN(),HN=Na.call(Ia,Array.prototype.concat),GN=Na.call(Xy,Array.prototype.splice),Zy=Na.call(Ia,String.prototype.replace),vl=Na.call(Ia,String.prototype.slice),KN=Na.call(Ia,RegExp.prototype.exec),YN=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,qN=/\\(\\)?/g,VN=function(t){var r=vl(t,0,1),n=vl(t,-1);if(r==="%"&&n!=="%")throw new Eo("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&r!=="%")throw new Eo("invalid intrinsic syntax, expected opening `%`");var i=[];return Zy(t,YN,function(s,o,a,c){i[i.length]=a?Zy(c,qN,"$1"):o||s}),i},XN=function(t,r){var n=t,i;if(wl(Jy,n)&&(i=Jy[n],n="%"+i[0]+"%"),wl(Os,n)){var s=Os[n];if(s===Ao&&(s=WN(n)),typeof s>"u"&&!r)throw new ko("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:s}}throw new Eo("intrinsic "+t+" does not exist!")},El=function(t,r){if(typeof t!="string"||t.length===0)throw new ko("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new ko('"allowMissing" argument must be a boolean');if(KN(/^%?[^%]*%?$/,t)===null)throw new Eo("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=VN(t),i=n.length>0?n[0]:"",s=XN("%"+i+"%",r),o=s.name,a=s.value,c=!1,u=s.alias;u&&(i=u[0],GN(n,HN([0,1],u)));for(var l=1,h=!0;l<n.length;l+=1){var d=n[l],f=vl(d,0,1),m=vl(d,-1);if((f==='"'||f==="'"||f==="`"||m==='"'||m==="'"||m==="`")&&f!==m)throw new Eo("property names with quotes must have matching quotes");if((d==="constructor"||!h)&&(c=!0),i+="."+d,o="%"+i+"%",wl(Os,o))a=Os[o];else if(a!=null){if(!(d in a)){if(!r)throw new ko("base intrinsic for "+t+" exists, but the property is not available.");return}if(Oa&&l+1>=n.length){var p=Oa(a,d);h=!!p,h&&"get"in p&&!("originalValue"in p.get)?a=p.get:a=a[d]}else h=wl(a,d),a=a[d];h&&!c&&(Os[o]=a)}}return a},Qy=bl,JN=Fy,To=Xi,t_=yl,ZN=function(t,r,n){if(!t||typeof t!="object"&&typeof t!="function")throw new To("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new To("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new To("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new To("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new To("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new To("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,c=!!t_&&t_(t,r);if(Qy)Qy(t,r,{configurable:o===null&&c?c.configurable:!o,enumerable:i===null&&c?c.enumerable:!i,value:n,writable:s===null&&c?c.writable:!s});else if(a||!i&&!s&&!o)t[r]=n;else throw new JN("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Jh=bl,e_=function(){return!!Jh};e_.hasArrayLengthDefineBug=function(){if(!Jh)return null;try{return Jh([],"length",{value:1}).length!==1}catch{return!0}};var QN=e_,tC=El,r_=ZN,eC=QN(),n_=yl,i_=Xi,rC=tC("%Math.floor%"),nC=function(t,r){if(typeof t!="function")throw new i_("`fn` is not a function");if(typeof r!="number"||r<0||r>4294967295||rC(r)!==r)throw new i_("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,s=!0;if("length"in t&&n_){var o=n_(t,"length");o&&!o.configurable&&(i=!1),o&&!o.writable&&(s=!1)}return(i||s||!n)&&(eC?r_(t,"length",r,!0,!0):r_(t,"length",r)),t},iC=Ra,sC=Hh,oC=Gy,aC=function(){return oC(iC,sC,arguments)};(function(e){var t=nC,r=bl,n=Gh,i=aC;e.exports=function(o){var a=n(arguments),c=o.length-(arguments.length-1);return t(a,1+(c>0?c:0),!0)},r?r(e.exports,"apply",{value:i}):e.exports.apply=i})(Uy);var cC=Uy.exports,s_=El,o_=Gh,lC=o_([s_("%String.prototype.indexOf%")]),Zh=function(t,r){var n=s_(t,!!r);return typeof n=="function"&&lC(t,".prototype.")>-1?o_([n]):n},kl=(typeof JSON<"u"?JSON:MI()).stringify,uC=PI,fC=DI,hC=cC,xl=Zh,dC=xl("Array.prototype.join"),a_=xl("Array.prototype.indexOf"),pC=xl("Array.prototype.splice"),mC=xl("Array.prototype.sort"),c_=function(t,r){for(var n="",i=0;i<t;i+=1)n+=r;return n},gC=function(e,t,r){return r},yC=function(t){var r=arguments.length>1?arguments[1]:void 0,n=r&&r.space||"";typeof n=="number"&&(n=c_(n," "));var i=!!r&&typeof r.cycles=="boolean"&&r.cycles,s=r&&r.replacer?hC(r.replacer):gC;if(r&&typeof r.collapseEmpty<"u"&&typeof r.collapseEmpty!="boolean")throw new TypeError("`collapseEmpty` must be a boolean, if provided");var o=!!r&&r.collapseEmpty,a=typeof r=="function"?r:r&&r.cmp,c=a&&function(l){var h=a.length>2&&function(f){return l[f]};return function(d,f){return a({key:d,value:l[d]},{key:f,value:l[f]},h?{__proto__:null,get:h}:void 0)}},u=[];return function l(h,d,f,m){var p=n?`
`+c_(m,n):"",g=n?": ":":";if(f&&f.toJSON&&typeof f.toJSON=="function"&&(f=f.toJSON()),f=s(h,d,f),f!==void 0){if(typeof f!="object"||f===null)return kl(f);var y=function($,M){return o&&$.length===0?M:(M==="[]"?"[":"{")+dC($,",")+p+(M==="[]"?"]":"}")};if(uC(f)){for(var x=[],b=0;b<f.length;b++){var T=l(f,b,f[b],m+1)||kl(null);x[x.length]=p+n+T}return y(x,"[]")}if(a_(u,f)!==-1){if(i)return kl("__cycle__");throw new TypeError("Converting circular structure to JSON")}else u[u.length]=f;for(var A=mC(fC(f),c&&c(f)),x=[],b=0;b<A.length;b++){var d=A[b],I=l(f,d,f[d],m+1);if(I){var R=kl(d)+g+I;x[x.length]=p+n+R}}return pC(u,a_(u,f),1),y(x,"{}")}}({"":t},"",t,0)},_C=ps(yC),Qh;try{Qh=new TextDecoder}catch{}var kt,si,J=0,ke={},le,Ji,wn=0,oi=0,hr,Ri,Kr=[],ae,l_={useRecords:!1,mapsAsObjects:!0};class u_{}const f_=new u_;f_.name="MessagePack 0xC1";var Zi=!1,h_=2,bC;try{new Function("")}catch{h_=1/0}class Ca{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,r){if(kt)return T_(()=>(id(),this?this.unpack(t,r):Ca.prototype.unpack.call(l_,t,r)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof er<"u"?er.from(t):new Uint8Array(t)),typeof r=="object"?(si=r.end||t.length,J=r.start||0):(J=0,si=r>-1?r:t.length),oi=0,Ji=null,hr=null,kt=t;try{ae=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(n){throw kt=null,t instanceof Uint8Array?n:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof Ca){if(ke=this,this.structures)return le=this.structures,Al(r);(!le||le.length>0)&&(le=[])}else ke=l_,(!le||le.length>0)&&(le=[]);return Al(r)}unpackMultiple(t,r){let n,i=0;try{Zi=!0;let s=t.length,o=this?this.unpack(t,s):Tl.unpack(t,s);if(r){if(r(o,i,J)===!1)return;for(;J<s;)if(i=J,r(Al(),i,J)===!1)return}else{for(n=[o];J<s;)i=J,n.push(Al());return n}}catch(s){throw s.lastPosition=i,s.values=n,s}finally{Zi=!1,id()}}_mergeStructures(t,r){t=t||[],Object.isFrozen(t)&&(t=t.map(n=>n.slice(0)));for(let n=0,i=t.length;n<i;n++){let s=t[n];s&&(s.isShared=!0,n>=32&&(s.highByte=n-32>>5))}t.sharedLength=t.length;for(let n in r||[])if(n>=0){let i=t[n],s=r[n];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[n]=i),t[n]=s)}return this.structures=t}decode(t,r){return this.unpack(t,r)}}function Al(e){try{if(!ke.trusted&&!Zi){let r=le.sharedLength||0;r<le.length&&(le.length=r)}let t;if(ke.randomAccessStructure&&kt[J]<64&&kt[J]>=32&&bC||(t=Ke()),hr&&(J=hr.postBundlePosition,hr=null),Zi&&(le.restoreStructures=null),J==si)le&&le.restoreStructures&&d_(),le=null,kt=null,Ri&&(Ri=null);else{if(J>si)throw new Error("Unexpected end of MessagePack data");if(!Zi){let r;try{r=JSON.stringify(t,(n,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(n){r="(JSON view not available "+n+")"}throw new Error("Data read, but end of buffer not reached "+r)}}return t}catch(t){throw le&&le.restoreStructures&&d_(),id(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||J>si)&&(t.incomplete=!0),t}}function d_(){for(let e in le.restoreStructures)le[e]=le.restoreStructures[e];le.restoreStructures=null}function Ke(){let e=kt[J++];if(e<160)if(e<128){if(e<64)return e;{let t=le[e&63]||ke.getStructures&&m_()[e&63];return t?(t.read||(t.read=td(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,ke.mapsAsObjects){let t={};for(let r=0;r<e;r++){let n=v_();n==="__proto__"&&(n="__proto_"),t[n]=Ke()}return t}else{let t=new Map;for(let r=0;r<e;r++)t.set(Ke(),Ke());return t}else{e-=144;let t=new Array(e);for(let r=0;r<e;r++)t[r]=Ke();return ke.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(oi>=J)return Ji.slice(J-wn,(J+=t)-wn);if(oi==0&&si<140){let r=t<16?rd(t):__(t);if(r!=null)return r}return ed(t)}else{let t;switch(e){case 192:return null;case 193:return hr?(t=Ke(),t>0?hr[1].slice(hr.position1,hr.position1+=t):hr[0].slice(hr.position0,hr.position0-=t)):f_;case 194:return!1;case 195:return!0;case 196:if(t=kt[J++],t===void 0)throw new Error("Unexpected end of buffer");return nd(t);case 197:return t=ae.getUint16(J),J+=2,nd(t);case 198:return t=ae.getUint32(J),J+=4,nd(t);case 199:return Is(kt[J++]);case 200:return t=ae.getUint16(J),J+=2,Is(t);case 201:return t=ae.getUint32(J),J+=4,Is(t);case 202:if(t=ae.getFloat32(J),ke.useFloat32>2){let r=sd[(kt[J]&127)<<1|kt[J+1]>>7];return J+=4,(r*t+(t>0?.5:-.5)>>0)/r}return J+=4,t;case 203:return t=ae.getFloat64(J),J+=8,t;case 204:return kt[J++];case 205:return t=ae.getUint16(J),J+=2,t;case 206:return t=ae.getUint32(J),J+=4,t;case 207:return ke.int64AsType==="number"?(t=ae.getUint32(J)*4294967296,t+=ae.getUint32(J+4)):ke.int64AsType==="string"?t=ae.getBigUint64(J).toString():ke.int64AsType==="auto"?(t=ae.getBigUint64(J),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=ae.getBigUint64(J),J+=8,t;case 208:return ae.getInt8(J++);case 209:return t=ae.getInt16(J),J+=2,t;case 210:return t=ae.getInt32(J),J+=4,t;case 211:return ke.int64AsType==="number"?(t=ae.getInt32(J)*4294967296,t+=ae.getUint32(J+4)):ke.int64AsType==="string"?t=ae.getBigInt64(J).toString():ke.int64AsType==="auto"?(t=ae.getBigInt64(J),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=ae.getBigInt64(J),J+=8,t;case 212:if(t=kt[J++],t==114)return k_(kt[J++]&63);{let r=Kr[t];if(r)return r.read?(J++,r.read(Ke())):r.noBuffer?(J++,r()):r(kt.subarray(J,++J));throw new Error("Unknown extension "+t)}case 213:return t=kt[J],t==114?(J++,k_(kt[J++]&63,kt[J++])):Is(2);case 214:return Is(4);case 215:return Is(8);case 216:return Is(16);case 217:return t=kt[J++],oi>=J?Ji.slice(J-wn,(J+=t)-wn):vC(t);case 218:return t=ae.getUint16(J),J+=2,oi>=J?Ji.slice(J-wn,(J+=t)-wn):EC(t);case 219:return t=ae.getUint32(J),J+=4,oi>=J?Ji.slice(J-wn,(J+=t)-wn):kC(t);case 220:return t=ae.getUint16(J),J+=2,g_(t);case 221:return t=ae.getUint32(J),J+=4,g_(t);case 222:return t=ae.getUint16(J),J+=2,y_(t);case 223:return t=ae.getUint32(J),J+=4,y_(t);default:if(e>=224)return e-256;if(e===void 0){let r=new Error("Unexpected end of MessagePack data");throw r.incomplete=!0,r}throw new Error("Unknown MessagePack token "+e)}}}const wC=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function td(e,t){function r(){if(r.count++>h_){let i=e.read=new Function("r","return function(){return "+(ke.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":wC.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Ke);return e.highByte===0&&(e.read=p_(t,e.read)),i()}let n={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),n[o]=Ke()}return ke.freezeData?Object.freeze(n):n}return r.count=0,e.highByte===0?p_(t,r):r}const p_=(e,t)=>function(){let r=kt[J++];if(r===0)return t();let n=e<32?-(e+(r<<5)):e+(r<<5),i=le[n]||m_()[n];if(!i)throw new Error("Record id is not defined for "+n);return i.read||(i.read=td(i,e)),i.read()};function m_(){let e=T_(()=>(kt=null,ke.getStructures()));return le=ke._mergeStructures(e,le)}var ed=La,vC=La,EC=La,kC=La;function La(e){let t;if(e<16&&(t=rd(e)))return t;if(e>64&&Qh)return Qh.decode(kt.subarray(J,J+=e));const r=J+e,n=[];for(t="";J<r;){const i=kt[J++];if(!(i&128))n.push(i);else if((i&224)===192){const s=kt[J++]&63;n.push((i&31)<<6|s)}else if((i&240)===224){const s=kt[J++]&63,o=kt[J++]&63;n.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=kt[J++]&63,o=kt[J++]&63,a=kt[J++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|c&1023),n.push(c)}else n.push(i);n.length>=4096&&(t+=dr.apply(String,n),n.length=0)}return n.length>0&&(t+=dr.apply(String,n)),t}function g_(e){let t=new Array(e);for(let r=0;r<e;r++)t[r]=Ke();return ke.freezeData?Object.freeze(t):t}function y_(e){if(ke.mapsAsObjects){let t={};for(let r=0;r<e;r++){let n=v_();n==="__proto__"&&(n="__proto_"),t[n]=Ke()}return t}else{let t=new Map;for(let r=0;r<e;r++)t.set(Ke(),Ke());return t}}var dr=String.fromCharCode;function __(e){let t=J,r=new Array(e);for(let n=0;n<e;n++){const i=kt[J++];if((i&128)>0){J=t;return}r[n]=i}return dr.apply(String,r)}function rd(e){if(e<4)if(e<2){if(e===0)return"";{let t=kt[J++];if((t&128)>1){J-=1;return}return dr(t)}}else{let t=kt[J++],r=kt[J++];if((t&128)>0||(r&128)>0){J-=2;return}if(e<3)return dr(t,r);let n=kt[J++];if((n&128)>0){J-=3;return}return dr(t,r,n)}else{let t=kt[J++],r=kt[J++],n=kt[J++],i=kt[J++];if((t&128)>0||(r&128)>0||(n&128)>0||(i&128)>0){J-=4;return}if(e<6){if(e===4)return dr(t,r,n,i);{let s=kt[J++];if((s&128)>0){J-=5;return}return dr(t,r,n,i,s)}}else if(e<8){let s=kt[J++],o=kt[J++];if((s&128)>0||(o&128)>0){J-=6;return}if(e<7)return dr(t,r,n,i,s,o);let a=kt[J++];if((a&128)>0){J-=7;return}return dr(t,r,n,i,s,o,a)}else{let s=kt[J++],o=kt[J++],a=kt[J++],c=kt[J++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){J-=8;return}if(e<10){if(e===8)return dr(t,r,n,i,s,o,a,c);{let u=kt[J++];if((u&128)>0){J-=9;return}return dr(t,r,n,i,s,o,a,c,u)}}else if(e<12){let u=kt[J++],l=kt[J++];if((u&128)>0||(l&128)>0){J-=10;return}if(e<11)return dr(t,r,n,i,s,o,a,c,u,l);let h=kt[J++];if((h&128)>0){J-=11;return}return dr(t,r,n,i,s,o,a,c,u,l,h)}else{let u=kt[J++],l=kt[J++],h=kt[J++],d=kt[J++];if((u&128)>0||(l&128)>0||(h&128)>0||(d&128)>0){J-=12;return}if(e<14){if(e===12)return dr(t,r,n,i,s,o,a,c,u,l,h,d);{let f=kt[J++];if((f&128)>0){J-=13;return}return dr(t,r,n,i,s,o,a,c,u,l,h,d,f)}}else{let f=kt[J++],m=kt[J++];if((f&128)>0||(m&128)>0){J-=14;return}if(e<15)return dr(t,r,n,i,s,o,a,c,u,l,h,d,f,m);let p=kt[J++];if((p&128)>0){J-=15;return}return dr(t,r,n,i,s,o,a,c,u,l,h,d,f,m,p)}}}}}function b_(){let e=kt[J++],t;if(e<192)t=e-160;else switch(e){case 217:t=kt[J++];break;case 218:t=ae.getUint16(J),J+=2;break;case 219:t=ae.getUint32(J),J+=4;break;default:throw new Error("Expected string")}return La(t)}function nd(e){return ke.copyBuffers?Uint8Array.prototype.slice.call(kt,J,J+=e):kt.subarray(J,J+=e)}function Is(e){let t=kt[J++];if(Kr[t]){let r;return Kr[t](kt.subarray(J,r=J+=e),n=>{J=n;try{return Ke()}finally{J=r}})}else throw new Error("Unknown extension type "+t)}var w_=new Array(4096);function v_(){let e=kt[J++];if(e>=160&&e<192){if(e=e-160,oi>=J)return Ji.slice(J-wn,(J+=e)-wn);if(!(oi==0&&si<180))return ed(e)}else return J--,E_(Ke());let t=(e<<5^(e>1?ae.getUint16(J):e>0?kt[J]:0))&4095,r=w_[t],n=J,i=J+e-3,s,o=0;if(r&&r.bytes==e){for(;n<i;){if(s=ae.getUint32(n),s!=r[o++]){n=1879048192;break}n+=4}for(i+=3;n<i;)if(s=kt[n++],s!=r[o++]){n=1879048192;break}if(n===i)return J=n,r.string;i-=3,n=J}for(r=[],w_[t]=r,r.bytes=e;n<i;)s=ae.getUint32(n),r.push(s),n+=4;for(i+=3;n<i;)s=kt[n++],r.push(s);let a=e<16?rd(e):__(e);return a!=null?r.string=a:r.string=ed(e)}function E_(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";if(ke.allowArraysInMapKeys&&Array.isArray(e)&&e.flat().every(t=>["string","number","boolean","bigint"].includes(typeof t)))return e.flat().toString();throw new Error(`Invalid property type for record: ${typeof e}`)}const k_=(e,t)=>{let r=Ke().map(E_),n=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,r.highByte=t);let i=le[e];return i&&(i.isShared||Zi)&&((le.restoreStructures||(le.restoreStructures=[]))[e]=i),le[e]=r,r.read=td(r,n),r.read()};Kr[0]=()=>{},Kr[0].noBuffer=!0,Kr[66]=e=>{let t=e.byteLength%8||8,r=BigInt(e[0]&128?e[0]-256:e[0]);for(let n=1;n<t;n++)r<<=BigInt(8),r+=BigInt(e[n]);if(e.byteLength!==t){let n=new DataView(e.buffer,e.byteOffset,e.byteLength),i=(s,o)=>{let a=o-s;if(a<=40){let h=n.getBigUint64(s);for(let d=s+8;d<o;d+=8)h<<=64n,h|=n.getBigUint64(d);return h}let c=s+(a>>4<<3),u=i(s,c),l=i(c,o);return u<<BigInt((o-c)*8)|l};r=r<<BigInt((n.byteLength-t)*8)|i(t,n.byteLength)}return r};let x_={Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError:typeof AggregateError=="function"?AggregateError:null};Kr[101]=()=>{let e=Ke();if(!x_[e[0]]){let t=Error(e[1],{cause:e[2]});return t.name=e[0],t}return x_[e[0]](e[1],{cause:e[2]})},Kr[105]=e=>{if(ke.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=ae.getUint32(J-4);Ri||(Ri=new Map);let r=kt[J],n;r>=144&&r<160||r==220||r==221?n=[]:r>=128&&r<144||r==222||r==223?n=new Map:(r>=199&&r<=201||r>=212&&r<=216)&&kt[J+1]===115?n=new Set:n={};let i={target:n};Ri.set(t,i);let s=Ke();if(i.used)Object.assign(n,s);else return i.target=s;if(n instanceof Map)for(let[o,a]of s.entries())n.set(o,a);if(n instanceof Set)for(let o of Array.from(s))n.add(o);return n},Kr[112]=e=>{if(ke.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=ae.getUint32(J-4),r=Ri.get(t);return r.used=!0,r.target},Kr[115]=()=>new Set(Ke());const A_=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let xC=typeof globalThis=="object"?globalThis:window;Kr[116]=e=>{let t=e[0],r=Uint8Array.prototype.slice.call(e,1).buffer,n=A_[t];if(!n){if(t===16)return r;if(t===17)return new DataView(r);throw new Error("Could not find typed array for code "+t)}return new xC[n](r)},Kr[120]=()=>{let e=Ke();return new RegExp(e[0],e[1])};const AC=[];Kr[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],r=J;return J+=t-e.length,hr=AC,hr=[b_(),b_()],hr.position0=0,hr.position1=0,hr.postBundlePosition=J,J=r,Ke()},Kr[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function T_(e){let t=si,r=J,n=wn,i=oi,s=Ji,o=Ri,a=hr,c=new Uint8Array(kt.slice(0,si)),u=le,l=le.slice(0,le.length),h=ke,d=Zi,f=e();return si=t,J=r,wn=n,oi=i,Ji=s,Ri=o,hr=a,kt=c,Zi=d,le=u,le.splice(0,le.length,...l),ke=h,ae=new DataView(kt.buffer,kt.byteOffset,kt.byteLength),f}function id(){kt=null,Ri=null,le=null}const sd=new Array(147);for(let e=0;e<256;e++)sd[e]=+("1e"+Math.floor(45.15-e*.30103));var Tl=new Ca({useRecords:!1});const TC=Tl.unpack;Tl.unpackMultiple,Tl.unpack;let SC=new Float32Array(1);new Uint8Array(SC.buffer,0,4);let Sl;try{Sl=new TextEncoder}catch{}let od,S_;const So=typeof er<"u",Rl=So?function(e){return er.allocUnsafeSlow(e)}:Uint8Array,R_=So?er:Uint8Array,O_=So?4294967296:2144337920;let ot,Ma,ve,et=0,Rr,Pe=null,RC;const OC=21760,IC=/[\u0080-\uFFFF]/,Ro=Symbol("record-id");class NC extends Ca{constructor(t){super(t),this.offset=0;let r,n,i,s,o=R_.prototype.utf8Write?function(N,E){return ot.utf8Write(N,E,ot.byteLength-E)}:Sl&&Sl.encodeInto?function(N,E){return Sl.encodeInto(N,ot.subarray(E)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,u=t.structures||t.saveStructures,l=t.maxSharedStructures;if(l==null&&(l=u?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=u?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=l>32||h+l>64,f=l+64,m=l+h+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],g=0,y=0;this.pack=this.encode=function(N,E){if(ot||(ot=new Rl(8192),ve=ot.dataView||(ot.dataView=new DataView(ot.buffer,0,8192)),et=0),Rr=ot.length-10,Rr-et<2048?(ot=new Rl(ot.length),ve=ot.dataView||(ot.dataView=new DataView(ot.buffer,0,ot.length)),Rr=ot.length-10,et=0):et=et+7&2147483640,r=et,E&PC&&(et+=E&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof N!="string"?(Pe=[],Pe.size=1/0):Pe=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let j=i.sharedLength||0;if(j>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let U=0;U<j;U++){let V=i[U];if(!V)continue;let Q,K=i.transitions;for(let W=0,P=V.length;W<P;W++){let st=V[W];Q=K[st],Q||(Q=K[st]=Object.create(null)),K=Q}K[Ro]=U+64}this.lastNamedStructuresLength=j}c||(i.nextId=j+64)}n&&(n=!1);let L;try{a.randomAccessStructure&&N&&N.constructor&&N.constructor===Object?O(N):A(N);let j=Pe;if(Pe&&N_(r,A,0),s&&s.idsToInsert){let U=s.idsToInsert.sort((W,P)=>W.offset>P.offset?1:-1),V=U.length,Q=-1;for(;j&&V>0;){let W=U[--V].offset+r;W<j.stringsPosition+r&&Q===-1&&(Q=0),W>j.position+r?Q>=0&&(Q+=6):(Q>=0&&(ve.setUint32(j.position+r,ve.getUint32(j.position+r)+Q),Q=-1),j=j.previous,V++)}Q>=0&&j&&ve.setUint32(j.position+r,ve.getUint32(j.position+r)+Q),et+=U.length*6,et>Rr&&M(et),a.offset=et;let K=CC(ot.subarray(r,et),U);return s=null,K}return a.offset=et,E&MC?(ot.start=r,ot.end=et,ot):ot.subarray(r,et)}catch(j){throw L=j,j}finally{if(i&&(b(),n&&a.saveStructures)){let j=i.sharedLength||0,U=ot.subarray(r,et),V=LC(i,a);if(!L)return a.saveStructures(V,V.isCompatible)===!1?a.pack(N,E):(a.lastNamedStructuresLength=j,ot.length>1073741824&&(ot=null),U)}ot.length>1073741824&&(ot=null),E&UC&&(et=r)}};const b=()=>{y<10&&y++;let N=i.sharedLength||0;if(i.length>N&&!c&&(i.length=N),g>1e4)i.transitions=null,y=0,g=0,p.length>0&&(p=[]);else if(p.length>0&&!c){for(let E=0,L=p.length;E<L;E++)p[E][Ro]=0;p=[]}},T=N=>{var E=N.length;E<16?ot[et++]=144|E:E<65536?(ot[et++]=220,ot[et++]=E>>8,ot[et++]=E&255):(ot[et++]=221,ve.setUint32(et,E),et+=4);for(let L=0;L<E;L++)A(N[L])},A=N=>{et>Rr&&(ot=M(et));var E=typeof N,L;if(E==="string"){let j=N.length;if(Pe&&j>=4&&j<4096){if((Pe.size+=j)>OC){let K,W=(Pe[0]?Pe[0].length*3+Pe[1].length:0)+10;et+W>Rr&&(ot=M(et+W));let P;Pe.position?(P=Pe,ot[et]=200,et+=3,ot[et++]=98,K=et-r,et+=4,N_(r,A,0),ve.setUint16(K+r-3,et-r-K)):(ot[et++]=214,ot[et++]=98,K=et-r,et+=4),Pe=["",""],Pe.previous=P,Pe.size=0,Pe.position=K}let Q=IC.test(N);Pe[Q?0:1]+=N,ot[et++]=193,A(Q?-j:j);return}let U;j<32?U=1:j<256?U=2:j<65536?U=3:U=5;let V=j*3;if(et+V>Rr&&(ot=M(et+V)),j<64||!o){let Q,K,W,P=et+U;for(Q=0;Q<j;Q++)K=N.charCodeAt(Q),K<128?ot[P++]=K:K<2048?(ot[P++]=K>>6|192,ot[P++]=K&63|128):(K&64512)===55296&&((W=N.charCodeAt(Q+1))&64512)===56320?(K=65536+((K&1023)<<10)+(W&1023),Q++,ot[P++]=K>>18|240,ot[P++]=K>>12&63|128,ot[P++]=K>>6&63|128,ot[P++]=K&63|128):(ot[P++]=K>>12|224,ot[P++]=K>>6&63|128,ot[P++]=K&63|128);L=P-et-U}else L=o(N,et+U);L<32?ot[et++]=160|L:L<256?(U<2&&ot.copyWithin(et+2,et+1,et+1+L),ot[et++]=217,ot[et++]=L):L<65536?(U<3&&ot.copyWithin(et+3,et+2,et+2+L),ot[et++]=218,ot[et++]=L>>8,ot[et++]=L&255):(U<5&&ot.copyWithin(et+5,et+3,et+3+L),ot[et++]=219,ve.setUint32(et,L),et+=4),et+=L}else if(E==="number")if(N>>>0===N)N<32||N<128&&this.useRecords===!1||N<64&&!this.randomAccessStructure?ot[et++]=N:N<256?(ot[et++]=204,ot[et++]=N):N<65536?(ot[et++]=205,ot[et++]=N>>8,ot[et++]=N&255):(ot[et++]=206,ve.setUint32(et,N),et+=4);else if(N>>0===N)N>=-32?ot[et++]=256+N:N>=-128?(ot[et++]=208,ot[et++]=N+256):N>=-32768?(ot[et++]=209,ve.setInt16(et,N),et+=2):(ot[et++]=210,ve.setInt32(et,N),et+=4);else{let j;if((j=this.useFloat32)>0&&N<4294967296&&N>=-2147483648){ot[et++]=202,ve.setFloat32(et,N);let U;if(j<4||(U=N*sd[(ot[et]&127)<<1|ot[et+1]>>7])>>0===U){et+=4;return}else et--}ot[et++]=203,ve.setFloat64(et,N),et+=8}else if(E==="object"||E==="function")if(!N)ot[et++]=192;else{if(s){let U=s.get(N);if(U){if(!U.id){let V=s.idsToInsert||(s.idsToInsert=[]);U.id=V.push(U)}ot[et++]=214,ot[et++]=112,ve.setUint32(et,U.id),et+=4;return}else s.set(N,{offset:et-r})}let j=N.constructor;if(j===Object)$(N);else if(j===Array)T(N);else if(j===Map)if(this.mapAsEmptyObject)ot[et++]=128;else{L=N.size,L<16?ot[et++]=128|L:L<65536?(ot[et++]=222,ot[et++]=L>>8,ot[et++]=L&255):(ot[et++]=223,ve.setUint32(et,L),et+=4);for(let[U,V]of N)A(U),A(V)}else{for(let U=0,V=od.length;U<V;U++){let Q=S_[U];if(N instanceof Q){let K=od[U];if(K.write){K.type&&(ot[et++]=212,ot[et++]=K.type,ot[et++]=0);let rt=K.write.call(this,N);rt===N?Array.isArray(N)?T(N):$(N):A(rt);return}let W=ot,P=ve,st=et;ot=null;let G;try{G=K.pack.call(this,N,rt=>(ot=W,W=null,et+=rt,et>Rr&&M(et),{target:ot,targetView:ve,position:et-rt}),A)}finally{W&&(ot=W,ve=P,et=st,Rr=ot.length-10)}G&&(G.length+et>Rr&&M(G.length+et),et=I_(G,ot,et,K.type));return}}if(Array.isArray(N))T(N);else{if(N.toJSON){const U=N.toJSON();if(U!==N)return A(U)}if(E==="function")return A(this.writeFunction&&this.writeFunction(N));$(N)}}}else if(E==="boolean")ot[et++]=N?195:194;else if(E==="bigint"){if(N<9223372036854776e3&&N>=-9223372036854776e3)ot[et++]=211,ve.setBigInt64(et,N);else if(N<18446744073709552e3&&N>0)ot[et++]=207,ve.setBigUint64(et,N);else if(this.largeBigIntToFloat)ot[et++]=203,ve.setFloat64(et,Number(N));else{if(this.largeBigIntToString)return A(N.toString());if(this.useBigIntExtension||this.moreTypes){let j=N<0?BigInt(-1):BigInt(0),U;if(N>>BigInt(65536)===j){let V=BigInt(18446744073709552e3)-BigInt(1),Q=[];for(;Q.push(N&V),N>>BigInt(63)!==j;)N>>=BigInt(64);U=new Uint8Array(new BigUint64Array(Q).buffer),U.reverse()}else{let V=N<0,Q=(V?~N:N).toString(16);if(Q.length%2?Q="0"+Q:parseInt(Q.charAt(0),16)>=8&&(Q="00"+Q),So)U=er.from(Q,"hex");else{U=new Uint8Array(Q.length/2);for(let K=0;K<U.length;K++)U[K]=parseInt(Q.slice(K*2,K*2+2),16)}if(V)for(let K=0;K<U.length;K++)U[K]=~U[K]}U.length+et>Rr&&M(U.length+et),et=I_(U,ot,et,66);return}else throw new RangeError(N+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}et+=8}else if(E==="undefined")this.encodeUndefinedAsNil?ot[et++]=192:(ot[et++]=212,ot[et++]=0,ot[et++]=0);else throw new Error("Unknown type: "+E)},x=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?N=>{let E;if(this.skipValues){E=[];for(let U in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(U))&&!this.skipValues.includes(N[U])&&E.push(U)}else E=Object.keys(N);let L=E.length;L<16?ot[et++]=128|L:L<65536?(ot[et++]=222,ot[et++]=L>>8,ot[et++]=L&255):(ot[et++]=223,ve.setUint32(et,L),et+=4);let j;if(this.coercibleKeyAsNumber)for(let U=0;U<L;U++){j=E[U];let V=Number(j);A(isNaN(V)?j:V),A(N[j])}else for(let U=0;U<L;U++)A(j=E[U]),A(N[j])}:N=>{ot[et++]=222;let E=et-r;et+=2;let L=0;for(let j in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(j))&&(A(j),A(N[j]),L++);if(L>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');ot[E+++r]=L>>8,ot[E+r]=L&255},I=this.useRecords===!1?x:t.progressiveRecords&&!d?N=>{let E,L=i.transitions||(i.transitions=Object.create(null)),j=et++-r,U;for(let V in N)if(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(V)){if(E=L[V],E)L=E;else{let Q=Object.keys(N),K=L;L=i.transitions;let W=0;for(let P=0,st=Q.length;P<st;P++){let G=Q[P];E=L[G],E||(E=L[G]=Object.create(null),W++),L=E}j+r+1==et?(et--,H(L,Q,W)):X(L,Q,j,W),U=!0,L=K[V]}A(N[V])}if(!U){let V=L[Ro];V?ot[j+r]=V:X(L,Object.keys(N),j,0)}}:N=>{let E,L=i.transitions||(i.transitions=Object.create(null)),j=0;for(let V in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(V))&&(E=L[V],E||(E=L[V]=Object.create(null),j++),L=E);let U=L[Ro];U?U>=96&&d?(ot[et++]=((U-=96)&31)+96,ot[et++]=U>>5):ot[et++]=U:H(L,L.__keys__||Object.keys(N),j);for(let V in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(V))&&A(N[V])},R=typeof this.useRecords=="function"&&this.useRecords,$=R?N=>{R(N)?I(N):x(N)}:I,M=N=>{let E;if(N>16777216){if(N-r>O_)throw new Error("Packed buffer would be larger than maximum buffer size");E=Math.min(O_,Math.round(Math.max((N-r)*(N>67108864?1.25:2),4194304)/4096)*4096)}else E=(Math.max(N-r<<2,ot.length-1)>>12)+1<<12;let L=new Rl(E);return ve=L.dataView||(L.dataView=new DataView(L.buffer,0,E)),N=Math.min(N,ot.length),ot.copy?ot.copy(L,0,r,N):L.set(ot.slice(r,N)),et-=r,r=0,Rr=L.length-10,ot=L},H=(N,E,L)=>{let j=i.nextId;j||(j=64),j<f&&this.shouldShareStructure&&!this.shouldShareStructure(E)?(j=i.nextOwnId,j<m||(j=f),i.nextOwnId=j+1):(j>=m&&(j=f),i.nextId=j+1);let U=E.highByte=j>=96&&d?j-96>>5:-1;N[Ro]=j,N.__keys__=E,i[j-64]=E,j<f?(E.isShared=!0,i.sharedLength=j-63,n=!0,U>=0?(ot[et++]=(j&31)+96,ot[et++]=U):ot[et++]=j):(U>=0?(ot[et++]=213,ot[et++]=114,ot[et++]=(j&31)+96,ot[et++]=U):(ot[et++]=212,ot[et++]=114,ot[et++]=j),L&&(g+=y*L),p.length>=h&&(p.shift()[Ro]=0),p.push(N),A(E))},X=(N,E,L,j)=>{let U=ot,V=et,Q=Rr,K=r;ot=Ma,et=0,r=0,ot||(Ma=ot=new Rl(8192)),Rr=ot.length-10,H(N,E,j),Ma=ot;let W=et;if(ot=U,et=V,Rr=Q,r=K,W>1){let P=et+W-1;P>Rr&&M(P);let st=L+r;ot.copyWithin(st+W,st+1,et),ot.set(Ma.slice(0,W),st),et=P}else ot[L+r]=Ma[0]},O=N=>{let E=RC(N,ot,r,et,i,M,(L,j,U)=>{if(U)return n=!0;et=j;let V=ot;return A(L),b(),V!==ot?{position:et,targetView:ve,target:ot}:et},this);if(E===0)return $(N);et=E}}useBuffer(t){ot=t,ot.dataView||(ot.dataView=new DataView(ot.buffer,ot.byteOffset,ot.byteLength)),ve=ot.dataView,et=0}set position(t){et=t}get position(){return et}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}S_=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,DataView,u_],od=[{pack(e,t,r){let n=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&n>=0&&n<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,n)}else if(n>0&&n<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(n/1e3/4294967296>>0)),s.setUint32(o+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return t(0),r(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(n)))}}},{pack(e,t,r){if(this.setAsEmptyObject)return t(0),r({});let n=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),r(n)}},{pack(e,t,r){let{target:n,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=101,n[i++]=0),r([e.name,e.message,e.cause])}},{pack(e,t,r){let{target:n,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=120,n[i++]=0),r([e.source,e.flags])}},{pack(e,t){this.moreTypes?ad(e,16,t):cd(So?er.from(e):new Uint8Array(e),t)}},{pack(e,t){let r=e.constructor;r!==R_&&this.moreTypes?ad(e,A_.indexOf(r.name),t):cd(e,t)}},{pack(e,t){this.moreTypes?ad(e,17,t):cd(So?er.from(e):new Uint8Array(e),t)}},{pack(e,t){let{target:r,position:n}=t(1);r[n]=193}}];function ad(e,t,r,n){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=r(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=r(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=r(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function cd(e,t){let r=e.byteLength;var n,i;if(r<256){var{target:n,position:i}=t(r+2);n[i++]=196,n[i++]=r}else if(r<65536){var{target:n,position:i}=t(r+3);n[i++]=197,n[i++]=r>>8,n[i++]=r&255}else{var{target:n,position:i,targetView:s}=t(r+5);n[i++]=198,s.setUint32(i,r),i+=4}n.set(e,i)}function I_(e,t,r,n){let i=e.length;switch(i){case 1:t[r++]=212;break;case 2:t[r++]=213;break;case 4:t[r++]=214;break;case 8:t[r++]=215;break;case 16:t[r++]=216;break;default:i<256?(t[r++]=199,t[r++]=i):i<65536?(t[r++]=200,t[r++]=i>>8,t[r++]=i&255):(t[r++]=201,t[r++]=i>>24,t[r++]=i>>16&255,t[r++]=i>>8&255,t[r++]=i&255)}return t[r++]=n,t.set(e,r),r+=i,r}function CC(e,t){let r,n=t.length*6,i=e.length-n;for(;r=t.pop();){let s=r.offset,o=r.id;e.copyWithin(s+n,s,i),n-=6;let a=s+n;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function N_(e,t,r){if(Pe.length>0){ve.setUint32(Pe.position+e,et+r-Pe.position-e),Pe.stringsPosition=et-e;let n=Pe;Pe=null,t(n[0]),t(n[1])}}function LC(e,t){return e.isCompatible=r=>{let n=!r||(t.lastNamedStructuresLength||0)===r.length;return n||t._mergeStructures(r),n},e}let C_=new NC({useRecords:!1});C_.pack,C_.pack;const MC=512,UC=1024,PC=2048;function Ne(){return null}function Oo(e,t,r={}){if(!w(e))return;const n=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=r[o];w(c)&&(a=c(a));const u=t[o];w(u)&&(o=u),a!==null&&n.push(o,a)}return n}function Ua(e,t,r={}){if(w(e))try{const n={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];w(a)&&(s=a);const c=r[s];w(c)&&(o=c(o)),n[s]=o}return n}catch(n){_e(lt,"","binary",n.message)}}function FC(e){try{return _C(e)}catch(t){_e(lt,"","binary",t.message)}}function L_(e){if(yt(e)){try{return JSON.parse(e)}catch(t){_e(lt,"","binary",t.message)}return}try{return TC(e)}catch(t){_e(lt,"","binary",t.message)}}function M_(){return{id:We()}}var Ol=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.breakable=16]="breakable",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e[e.group=30]="group",e[e.lightdir=31]="lightdir",e[e.item=32]="item",e[e.p4=33]="p4",e[e.p5=34]="p5",e[e.p6=35]="p6",e[e.displaychar=36]="displaychar",e[e.displaycolor=37]="displaycolor",e[e.displaybg=38]="displaybg",e[e.shootx=39]="shootx",e[e.shooty=40]="shooty",e[e.p7=41]="p7",e[e.p8=42]="p8",e[e.p9=43]="p9",e[e.p10=44]="p10",e))(Ol||{});function Il(e){return w(e==null?void 0:e.id)?Oo(e,Ol,{category:Ne,kinddata:Ne,stopped:Ne,removed:Ne,bucket:Ne}):Oo(e,Ol,{id:Ne,x:Ne,y:Ne,lx:Ne,ly:Ne,code:Ne,category:Ne,kinddata:Ne,stopped:Ne,removed:Ne,bucket:Ne})}function Nl(e){return Ua(e,Ol)}function De(e){return(e==null?void 0:e.category)===jr.ISOBJECT}function Pa(e,t){if(!w(e)||!Cr(t))return;const{color:r,bg:n}=wy(t);w(r)&&(e.color=r),w(n)&&(e.bg=n)}function U_(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function P_(e){const t=Math.floor(e.length/fl);if(t*fl!==e.length)return;const r=U_(3,t);for(let n=0;n<r.bits.length;++n)r.bits[n]=e[n];return r}function $C(e,t){return e&1<<t?255:0}function F_(e){const t=Math.floor(e.length/Mh);if(t*Mh!==e.length)return;const r=Math.ceil(t/hl),n=Ts*hl,i=U_(n,Ss*r);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const u=o*Ss+a,l=e[c];for(let h=0;h<Ts;++h){const d=s*Ts+h;i.bits[d+u*n]=$C(l,7-h)}++a,a===Ss&&(a=0,++s,s===hl&&(s=0,++o))}return i}const BC=Mc("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),DC=Mc("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var $_=typeof ro=="object"&&ro&&ro.Object===Object&&ro,jC=typeof self=="object"&&self&&self.Object===Object&&self,ai=$_||jC||Function("return this")(),vn=ai.Symbol,B_=Object.prototype,zC=B_.hasOwnProperty,WC=B_.toString,Fa=vn?vn.toStringTag:void 0;function HC(e){var t=zC.call(e,Fa),r=e[Fa];try{e[Fa]=void 0;var n=!0}catch{}var i=WC.call(e);return n&&(t?e[Fa]=r:delete e[Fa]),i}var GC=Object.prototype,KC=GC.toString;function YC(e){return KC.call(e)}var qC="[object Null]",VC="[object Undefined]",D_=vn?vn.toStringTag:void 0;function Qi(e){return e==null?e===void 0?VC:qC:D_&&D_ in Object(e)?HC(e):YC(e)}function Dn(e){return e!=null&&typeof e=="object"}var XC="[object Symbol]";function Cl(e){return typeof e=="symbol"||Dn(e)&&Qi(e)==XC}function Ll(e,t){for(var r=-1,n=e==null?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}var he=Array.isArray,j_=vn?vn.prototype:void 0,z_=j_?j_.toString:void 0;function W_(e){if(typeof e=="string")return e;if(he(e))return Ll(e,W_)+"";if(Cl(e))return z_?z_.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var JC=/\s/;function ZC(e){for(var t=e.length;t--&&JC.test(e.charAt(t)););return t}var QC=/^\s+/;function tL(e){return e&&e.slice(0,ZC(e)+1).replace(QC,"")}function En(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var H_=NaN,eL=/^[-+]0x[0-9a-f]+$/i,rL=/^0b[01]+$/i,nL=/^0o[0-7]+$/i,iL=parseInt;function sL(e){if(typeof e=="number")return e;if(Cl(e))return H_;if(En(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=En(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=tL(e);var r=rL.test(e);return r||nL.test(e)?iL(e.slice(2),r?2:8):eL.test(e)?H_:+e}var G_=1/0,oL=17976931348623157e292;function aL(e){if(!e)return e===0?e:0;if(e=sL(e),e===G_||e===-G_){var t=e<0?-1:1;return t*oL}return e===e?e:0}function Ml(e){var t=aL(e),r=t%1;return t===t?r?t-r:t:0}function Io(e){return e}var cL="[object AsyncFunction]",lL="[object Function]",uL="[object GeneratorFunction]",fL="[object Proxy]";function Oi(e){if(!En(e))return!1;var t=Qi(e);return t==lL||t==uL||t==cL||t==fL}var ld=ai["__core-js_shared__"],K_=function(){var e=/[^.]+$/.exec(ld&&ld.keys&&ld.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function hL(e){return!!K_&&K_ in e}var dL=Function.prototype,pL=dL.toString;function Ns(e){if(e!=null){try{return pL.call(e)}catch{}try{return e+""}catch{}}return""}var mL=/[\\^$.*+?()[\]{}|]/g,gL=/^\[object .+?Constructor\]$/,yL=Function.prototype,_L=Object.prototype,bL=yL.toString,wL=_L.hasOwnProperty,vL=RegExp("^"+bL.call(wL).replace(mL,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function EL(e){if(!En(e)||hL(e))return!1;var t=Oi(e)?vL:gL;return t.test(Ns(e))}function kL(e,t){return e==null?void 0:e[t]}function Cs(e,t){var r=kL(e,t);return EL(r)?r:void 0}var ud=Cs(ai,"WeakMap"),Y_=Object.create,xL=function(){function e(){}return function(t){if(!En(t))return{};if(Y_)return Y_(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function AL(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function ir(){}function TL(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}var SL=800,RL=16,OL=Date.now;function IL(e){var t=0,r=0;return function(){var n=OL(),i=RL-(n-r);if(r=n,i>0){if(++t>=SL)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function NL(e){return function(){return e}}var Ul=function(){try{var e=Cs(Object,"defineProperty");return e({},"",{}),e}catch{}}(),CL=Ul?function(e,t){return Ul(e,"toString",{configurable:!0,enumerable:!1,value:NL(t),writable:!0})}:Io,LL=IL(CL);function q_(e,t){for(var r=-1,n=e==null?0:e.length;++r<n&&t(e[r],r,e)!==!1;);return e}function V_(e,t,r,n){for(var i=e.length,s=r+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function ML(e){return e!==e}function UL(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}function fd(e,t,r){return t===t?UL(e,t,r):V_(e,ML,r)}function X_(e,t){var r=e==null?0:e.length;return!!r&&fd(e,t,0)>-1}var PL=9007199254740991,FL=/^(?:0|[1-9]\d*)$/;function Pl(e,t){var r=typeof e;return t=t??PL,!!t&&(r=="number"||r!="symbol"&&FL.test(e))&&e>-1&&e%1==0&&e<t}function hd(e,t,r){t=="__proto__"&&Ul?Ul(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function $a(e,t){return e===t||e!==e&&t!==t}var $L=Object.prototype,BL=$L.hasOwnProperty;function Fl(e,t,r){var n=e[t];(!(BL.call(e,t)&&$a(n,r))||r===void 0&&!(t in e))&&hd(e,t,r)}function Ba(e,t,r,n){var i=!r;r||(r={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?hd(r,a,c):Fl(r,a,c)}return r}var J_=Math.max;function DL(e,t,r){return t=J_(t===void 0?e.length-1:t,0),function(){for(var n=arguments,i=-1,s=J_(n.length-t,0),o=Array(s);++i<s;)o[i]=n[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=n[i];return a[t]=r(o),AL(e,this,a)}}function dd(e,t){return LL(DL(e,t,Io),e+"")}var jL=9007199254740991;function pd(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=jL}function ci(e){return e!=null&&pd(e.length)&&!Oi(e)}function Z_(e,t,r){if(!En(r))return!1;var n=typeof t;return(n=="number"?ci(r)&&Pl(t,r.length):n=="string"&&t in r)?$a(r[t],e):!1}function zL(e){return dd(function(t,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&Z_(r[0],r[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++n<i;){var a=r[n];a&&e(t,a,n,s)}return t})}var WL=Object.prototype;function Da(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||WL;return e===r}function HL(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var GL="[object Arguments]";function Q_(e){return Dn(e)&&Qi(e)==GL}var tb=Object.prototype,KL=tb.hasOwnProperty,YL=tb.propertyIsEnumerable,$l=Q_(function(){return arguments}())?Q_:function(e){return Dn(e)&&KL.call(e,"callee")&&!YL.call(e,"callee")};function qL(){return!1}var eb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,rb=eb&&typeof module=="object"&&module&&!module.nodeType&&module,VL=rb&&rb.exports===eb,nb=VL?ai.Buffer:void 0,XL=nb?nb.isBuffer:void 0,ja=XL||qL,JL="[object Arguments]",ZL="[object Array]",QL="[object Boolean]",t6="[object Date]",e6="[object Error]",r6="[object Function]",n6="[object Map]",i6="[object Number]",s6="[object Object]",o6="[object RegExp]",a6="[object Set]",c6="[object String]",l6="[object WeakMap]",u6="[object ArrayBuffer]",f6="[object DataView]",h6="[object Float32Array]",d6="[object Float64Array]",p6="[object Int8Array]",m6="[object Int16Array]",g6="[object Int32Array]",y6="[object Uint8Array]",_6="[object Uint8ClampedArray]",b6="[object Uint16Array]",w6="[object Uint32Array]",Se={};Se[h6]=Se[d6]=Se[p6]=Se[m6]=Se[g6]=Se[y6]=Se[_6]=Se[b6]=Se[w6]=!0,Se[JL]=Se[ZL]=Se[u6]=Se[QL]=Se[f6]=Se[t6]=Se[e6]=Se[r6]=Se[n6]=Se[i6]=Se[s6]=Se[o6]=Se[a6]=Se[c6]=Se[l6]=!1;function v6(e){return Dn(e)&&pd(e.length)&&!!Se[Qi(e)]}function Bl(e){return function(t){return e(t)}}var ib=typeof exports=="object"&&exports&&!exports.nodeType&&exports,za=ib&&typeof module=="object"&&module&&!module.nodeType&&module,E6=za&&za.exports===ib,md=E6&&$_.process,ts=function(){try{var e=za&&za.require&&za.require("util").types;return e||md&&md.binding&&md.binding("util")}catch{}}(),sb=ts&&ts.isTypedArray,gd=sb?Bl(sb):v6,k6=Object.prototype,x6=k6.hasOwnProperty;function ob(e,t){var r=he(e),n=!r&&$l(e),i=!r&&!n&&ja(e),s=!r&&!n&&!i&&gd(e),o=r||n||i||s,a=o?HL(e.length,String):[],c=a.length;for(var u in e)(t||x6.call(e,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Pl(u,c)))&&a.push(u);return a}function ab(e,t){return function(r){return e(t(r))}}var A6=ab(Object.keys,Object),T6=Object.prototype,S6=T6.hasOwnProperty;function cb(e){if(!Da(e))return A6(e);var t=[];for(var r in Object(e))S6.call(e,r)&&r!="constructor"&&t.push(r);return t}function kn(e){return ci(e)?ob(e):cb(e)}var R6=Object.prototype,O6=R6.hasOwnProperty,Yr=zL(function(e,t){if(Da(t)||ci(t)){Ba(t,kn(t),e);return}for(var r in t)O6.call(t,r)&&Fl(e,r,t[r])});function I6(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var N6=Object.prototype,C6=N6.hasOwnProperty;function L6(e){if(!En(e))return I6(e);var t=Da(e),r=[];for(var n in e)n=="constructor"&&(t||!C6.call(e,n))||r.push(n);return r}function yd(e){return ci(e)?ob(e,!0):L6(e)}var M6=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,U6=/^\w*$/;function _d(e,t){if(he(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Cl(e)?!0:U6.test(e)||!M6.test(e)||t!=null&&e in Object(t)}var Wa=Cs(Object,"create");function P6(){this.__data__=Wa?Wa(null):{},this.size=0}function F6(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var $6="__lodash_hash_undefined__",B6=Object.prototype,D6=B6.hasOwnProperty;function j6(e){var t=this.__data__;if(Wa){var r=t[e];return r===$6?void 0:r}return D6.call(t,e)?t[e]:void 0}var z6=Object.prototype,W6=z6.hasOwnProperty;function H6(e){var t=this.__data__;return Wa?t[e]!==void 0:W6.call(t,e)}var G6="__lodash_hash_undefined__";function K6(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Wa&&t===void 0?G6:t,this}function Ls(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ls.prototype.clear=P6,Ls.prototype.delete=F6,Ls.prototype.get=j6,Ls.prototype.has=H6,Ls.prototype.set=K6;function Y6(){this.__data__=[],this.size=0}function Dl(e,t){for(var r=e.length;r--;)if($a(e[r][0],t))return r;return-1}var q6=Array.prototype,V6=q6.splice;function X6(e){var t=this.__data__,r=Dl(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():V6.call(t,r,1),--this.size,!0}function J6(e){var t=this.__data__,r=Dl(t,e);return r<0?void 0:t[r][1]}function Z6(e){return Dl(this.__data__,e)>-1}function Q6(e,t){var r=this.__data__,n=Dl(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function Ii(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ii.prototype.clear=Y6,Ii.prototype.delete=X6,Ii.prototype.get=J6,Ii.prototype.has=Z6,Ii.prototype.set=Q6;var Ha=Cs(ai,"Map");function tM(){this.size=0,this.__data__={hash:new Ls,map:new(Ha||Ii),string:new Ls}}function eM(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function jl(e,t){var r=e.__data__;return eM(t)?r[typeof t=="string"?"string":"hash"]:r.map}function rM(e){var t=jl(this,e).delete(e);return this.size-=t?1:0,t}function nM(e){return jl(this,e).get(e)}function iM(e){return jl(this,e).has(e)}function sM(e,t){var r=jl(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function Ni(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ni.prototype.clear=tM,Ni.prototype.delete=rM,Ni.prototype.get=nM,Ni.prototype.has=iM,Ni.prototype.set=sM;var oM="Expected a function";function bd(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(oM);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(bd.Cache||Ni),r}bd.Cache=Ni;var aM=500;function cM(e){var t=bd(e,function(n){return r.size===aM&&r.clear(),n}),r=t.cache;return t}var lM=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,uM=/\\(\\)?/g,fM=cM(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(lM,function(r,n,i,s){t.push(i?s.replace(uM,"$1"):n||r)}),t});function lb(e){return e==null?"":W_(e)}function zl(e,t){return he(e)?e:_d(e,t)?[e]:fM(lb(e))}function Ga(e){if(typeof e=="string"||Cl(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}function wd(e,t){t=zl(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[Ga(t[r++])];return r&&r==n?e:void 0}function hM(e,t,r){var n=e==null?void 0:wd(e,t);return n===void 0?r:n}function vd(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}var ub=vn?vn.isConcatSpreadable:void 0;function dM(e){return he(e)||$l(e)||!!(ub&&e&&e[ub])}function Ed(e,t,r,n,i){var s=-1,o=e.length;for(r||(r=dM),i||(i=[]);++s<o;){var a=e[s];r(a)?vd(i,a):n||(i[i.length]=a)}return i}function ln(e){var t=e==null?0:e.length;return t?Ed(e):[]}var fb=ab(Object.getPrototypeOf,Object);function kd(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),r=r>i?i:r,r<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}function pM(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:kd(e,t,r)}var mM="\\ud800-\\udfff",gM="\\u0300-\\u036f",yM="\\ufe20-\\ufe2f",_M="\\u20d0-\\u20ff",bM=gM+yM+_M,wM="\\ufe0e\\ufe0f",vM="\\u200d",EM=RegExp("["+vM+mM+bM+wM+"]");function hb(e){return EM.test(e)}function kM(e){return e.split("")}var db="\\ud800-\\udfff",xM="\\u0300-\\u036f",AM="\\ufe20-\\ufe2f",TM="\\u20d0-\\u20ff",SM=xM+AM+TM,RM="\\ufe0e\\ufe0f",OM="["+db+"]",xd="["+SM+"]",Ad="\\ud83c[\\udffb-\\udfff]",IM="(?:"+xd+"|"+Ad+")",pb="[^"+db+"]",mb="(?:\\ud83c[\\udde6-\\uddff]){2}",gb="[\\ud800-\\udbff][\\udc00-\\udfff]",NM="\\u200d",yb=IM+"?",_b="["+RM+"]?",CM="(?:"+NM+"(?:"+[pb,mb,gb].join("|")+")"+_b+yb+")*",LM=_b+yb+CM,MM="(?:"+[pb+xd+"?",xd,mb,gb,OM].join("|")+")",UM=RegExp(Ad+"(?="+Ad+")|"+MM+LM,"g");function PM(e){return e.match(UM)||[]}function FM(e){return hb(e)?PM(e):kM(e)}function $M(e){return function(t){t=lb(t);var r=hb(t)?FM(t):void 0,n=r?r[0]:t.charAt(0),i=r?pM(r,1).join(""):t.slice(1);return n[e]()+i}}var bb=$M("toUpperCase");function BM(e,t,r,n){var i=-1,s=e==null?0:e.length;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function DM(){this.__data__=new Ii,this.size=0}function jM(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function zM(e){return this.__data__.get(e)}function WM(e){return this.__data__.has(e)}var HM=200;function GM(e,t){var r=this.__data__;if(r instanceof Ii){var n=r.__data__;if(!Ha||n.length<HM-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ni(n)}return r.set(e,t),this.size=r.size,this}function li(e){var t=this.__data__=new Ii(e);this.size=t.size}li.prototype.clear=DM,li.prototype.delete=jM,li.prototype.get=zM,li.prototype.has=WM,li.prototype.set=GM;function KM(e,t){return e&&Ba(t,kn(t),e)}function YM(e,t){return e&&Ba(t,yd(t),e)}var wb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,vb=wb&&typeof module=="object"&&module&&!module.nodeType&&module,qM=vb&&vb.exports===wb,Eb=qM?ai.Buffer:void 0,kb=Eb?Eb.allocUnsafe:void 0;function VM(e,t){var r=e.length,n=kb?kb(r):new e.constructor(r);return e.copy(n),n}function Td(e,t){for(var r=-1,n=e==null?0:e.length,i=0,s=[];++r<n;){var o=e[r];t(o,r,e)&&(s[i++]=o)}return s}function xb(){return[]}var XM=Object.prototype,JM=XM.propertyIsEnumerable,Ab=Object.getOwnPropertySymbols,Sd=Ab?function(e){return e==null?[]:(e=Object(e),Td(Ab(e),function(t){return JM.call(e,t)}))}:xb;function ZM(e,t){return Ba(e,Sd(e),t)}var QM=Object.getOwnPropertySymbols,Tb=QM?function(e){for(var t=[];e;)vd(t,Sd(e)),e=fb(e);return t}:xb;function t2(e,t){return Ba(e,Tb(e),t)}function Sb(e,t,r){var n=t(e);return he(e)?n:vd(n,r(e))}function Rd(e){return Sb(e,kn,Sd)}function e2(e){return Sb(e,yd,Tb)}var Od=Cs(ai,"DataView"),Id=Cs(ai,"Promise"),No=Cs(ai,"Set"),Rb="[object Map]",r2="[object Object]",Ob="[object Promise]",Ib="[object Set]",Nb="[object WeakMap]",Cb="[object DataView]",n2=Ns(Od),i2=Ns(Ha),s2=Ns(Id),o2=Ns(No),a2=Ns(ud),xn=Qi;(Od&&xn(new Od(new ArrayBuffer(1)))!=Cb||Ha&&xn(new Ha)!=Rb||Id&&xn(Id.resolve())!=Ob||No&&xn(new No)!=Ib||ud&&xn(new ud)!=Nb)&&(xn=function(e){var t=Qi(e),r=t==r2?e.constructor:void 0,n=r?Ns(r):"";if(n)switch(n){case n2:return Cb;case i2:return Rb;case s2:return Ob;case o2:return Ib;case a2:return Nb}return t});var c2=Object.prototype,l2=c2.hasOwnProperty;function u2(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&l2.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var Wl=ai.Uint8Array;function f2(e){var t=new e.constructor(e.byteLength);return new Wl(t).set(new Wl(e)),t}function h2(e,t){var r=e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var d2=/\w*$/;function p2(e){var t=new e.constructor(e.source,d2.exec(e));return t.lastIndex=e.lastIndex,t}var Lb=vn?vn.prototype:void 0,Mb=Lb?Lb.valueOf:void 0;function m2(e){return Mb?Object(Mb.call(e)):{}}function g2(e,t){var r=e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var y2="[object Boolean]",_2="[object Date]",b2="[object Map]",w2="[object Number]",v2="[object RegExp]",E2="[object Set]",k2="[object String]",x2="[object Symbol]",A2="[object ArrayBuffer]",T2="[object DataView]",S2="[object Float32Array]",R2="[object Float64Array]",O2="[object Int8Array]",I2="[object Int16Array]",N2="[object Int32Array]",C2="[object Uint8Array]",L2="[object Uint8ClampedArray]",M2="[object Uint16Array]",U2="[object Uint32Array]";function P2(e,t,r){var n=e.constructor;switch(t){case A2:return f2(e);case y2:case _2:return new n(+e);case T2:return h2(e);case S2:case R2:case O2:case I2:case N2:case C2:case L2:case M2:case U2:return g2(e);case b2:return new n;case w2:case k2:return new n(e);case v2:return p2(e);case E2:return new n;case x2:return m2(e)}}function F2(e){return typeof e.constructor=="function"&&!Da(e)?xL(fb(e)):{}}var $2="[object Map]";function B2(e){return Dn(e)&&xn(e)==$2}var Ub=ts&&ts.isMap,D2=Ub?Bl(Ub):B2,j2="[object Set]";function z2(e){return Dn(e)&&xn(e)==j2}var Pb=ts&&ts.isSet,W2=Pb?Bl(Pb):z2,H2=2,Fb="[object Arguments]",G2="[object Array]",K2="[object Boolean]",Y2="[object Date]",q2="[object Error]",$b="[object Function]",V2="[object GeneratorFunction]",X2="[object Map]",J2="[object Number]",Bb="[object Object]",Z2="[object RegExp]",Q2="[object Set]",t3="[object String]",e3="[object Symbol]",r3="[object WeakMap]",n3="[object ArrayBuffer]",i3="[object DataView]",s3="[object Float32Array]",o3="[object Float64Array]",a3="[object Int8Array]",c3="[object Int16Array]",l3="[object Int32Array]",u3="[object Uint8Array]",f3="[object Uint8ClampedArray]",h3="[object Uint16Array]",d3="[object Uint32Array]",xe={};xe[Fb]=xe[G2]=xe[n3]=xe[i3]=xe[K2]=xe[Y2]=xe[s3]=xe[o3]=xe[a3]=xe[c3]=xe[l3]=xe[X2]=xe[J2]=xe[Bb]=xe[Z2]=xe[Q2]=xe[t3]=xe[e3]=xe[u3]=xe[f3]=xe[h3]=xe[d3]=!0,xe[q2]=xe[$b]=xe[r3]=!1;function Hl(e,t,r,n,i,s){var o,a=t&H2;if(o!==void 0)return o;if(!En(e))return e;var c=he(e);if(c)return o=u2(e),TL(e,o);var u=xn(e),l=u==$b||u==V2;if(ja(e))return VM(e);if(u==Bb||u==Fb||l&&!i)return o=l?{}:F2(e),a?t2(e,YM(o,e)):ZM(e,KM(o,e));if(!xe[u])return i?e:{};o=P2(e,u),s||(s=new li);var h=s.get(e);if(h)return h;s.set(e,o),W2(e)?e.forEach(function(m){o.add(Hl(m,t,r,m,e,s))}):D2(e)&&e.forEach(function(m,p){o.set(p,Hl(m,t,r,p,e,s))});var d=Rd,f=c?void 0:d(e);return q_(f||e,function(m,p){f&&(p=m,m=e[p]),Fl(o,p,Hl(m,t,r,p,e,s))}),o}var p3=4;function xr(e){return Hl(e,p3)}function Ka(e){for(var t=-1,r=e==null?0:e.length,n=0,i=[];++t<r;){var s=e[t];s&&(i[n++]=s)}return i}var m3="__lodash_hash_undefined__";function g3(e){return this.__data__.set(e,m3),this}function y3(e){return this.__data__.has(e)}function Co(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Ni;++t<r;)this.add(e[t])}Co.prototype.add=Co.prototype.push=g3,Co.prototype.has=y3;function Db(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function Nd(e,t){return e.has(t)}var _3=1,b3=2;function jb(e,t,r,n,i,s){var o=r&_3,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),l=s.get(t);if(u&&l)return u==t&&l==e;var h=-1,d=!0,f=r&b3?new Co:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var m=e[h],p=t[h];if(n)var g=o?n(p,m,h,t,e,s):n(m,p,h,e,t,s);if(g!==void 0){if(g)continue;d=!1;break}if(f){if(!Db(t,function(y,b){if(!Nd(f,b)&&(m===y||i(m,y,r,n,s)))return f.push(b)})){d=!1;break}}else if(!(m===p||i(m,p,r,n,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function w3(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}function Cd(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var v3=1,E3=2,k3="[object Boolean]",x3="[object Date]",A3="[object Error]",T3="[object Map]",S3="[object Number]",R3="[object RegExp]",O3="[object Set]",I3="[object String]",N3="[object Symbol]",C3="[object ArrayBuffer]",L3="[object DataView]",zb=vn?vn.prototype:void 0,Ld=zb?zb.valueOf:void 0;function M3(e,t,r,n,i,s,o){switch(r){case L3:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case C3:return!(e.byteLength!=t.byteLength||!s(new Wl(e),new Wl(t)));case k3:case x3:case S3:return $a(+e,+t);case A3:return e.name==t.name&&e.message==t.message;case R3:case I3:return e==t+"";case T3:var a=w3;case O3:var c=n&v3;if(a||(a=Cd),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;n|=E3,o.set(e,t);var l=jb(a(e),a(t),n,i,s,o);return o.delete(e),l;case N3:if(Ld)return Ld.call(e)==Ld.call(t)}return!1}var U3=1,P3=Object.prototype,F3=P3.hasOwnProperty;function $3(e,t,r,n,i,s){var o=r&U3,a=Rd(e),c=a.length,u=Rd(t),l=u.length;if(c!=l&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in t:F3.call(t,d)))return!1}var f=s.get(e),m=s.get(t);if(f&&m)return f==t&&m==e;var p=!0;s.set(e,t),s.set(t,e);for(var g=o;++h<c;){d=a[h];var y=e[d],b=t[d];if(n)var T=o?n(b,y,d,t,e,s):n(y,b,d,e,t,s);if(!(T===void 0?y===b||i(y,b,r,n,s):T)){p=!1;break}g||(g=d=="constructor")}if(p&&!g){var A=e.constructor,x=t.constructor;A!=x&&"constructor"in e&&"constructor"in t&&!(typeof A=="function"&&A instanceof A&&typeof x=="function"&&x instanceof x)&&(p=!1)}return s.delete(e),s.delete(t),p}var B3=1,Wb="[object Arguments]",Hb="[object Array]",Gl="[object Object]",D3=Object.prototype,Gb=D3.hasOwnProperty;function j3(e,t,r,n,i,s){var o=he(e),a=he(t),c=o?Hb:xn(e),u=a?Hb:xn(t);c=c==Wb?Gl:c,u=u==Wb?Gl:u;var l=c==Gl,h=u==Gl,d=c==u;if(d&&ja(e)){if(!ja(t))return!1;o=!0,l=!1}if(d&&!l)return s||(s=new li),o||gd(e)?jb(e,t,r,n,i,s):M3(e,t,c,r,n,i,s);if(!(r&B3)){var f=l&&Gb.call(e,"__wrapped__"),m=h&&Gb.call(t,"__wrapped__");if(f||m){var p=f?e.value():e,g=m?t.value():t;return s||(s=new li),i(p,g,r,n,s)}}return d?(s||(s=new li),$3(e,t,r,n,i,s)):!1}function Md(e,t,r,n,i){return e===t?!0:e==null||t==null||!Dn(e)&&!Dn(t)?e!==e&&t!==t:j3(e,t,r,n,Md,i)}var z3=1,W3=2;function H3(e,t,r,n){var i=r.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=r[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=r[i];var a=o[0],c=e[a],u=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var l=new li,h;if(!(h===void 0?Md(u,c,z3|W3,n,l):h))return!1}}return!0}function Kb(e){return e===e&&!En(e)}function G3(e){for(var t=kn(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,Kb(i)]}return t}function Yb(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}function K3(e){var t=G3(e);return t.length==1&&t[0][2]?Yb(t[0][0],t[0][1]):function(r){return r===e||H3(r,e,t)}}function Y3(e,t){return e!=null&&t in Object(e)}function qb(e,t,r){t=zl(t,e);for(var n=-1,i=t.length,s=!1;++n<i;){var o=Ga(t[n]);if(!(s=e!=null&&r(e,o)))break;e=e[o]}return s||++n!=i?s:(i=e==null?0:e.length,!!i&&pd(i)&&Pl(o,i)&&(he(e)||$l(e)))}function q3(e,t){return e!=null&&qb(e,t,Y3)}var V3=1,X3=2;function J3(e,t){return _d(e)&&Kb(t)?Yb(Ga(e),t):function(r){var n=hM(r,e);return n===void 0&&n===t?q3(r,e):Md(t,n,V3|X3)}}function Z3(e){return function(t){return t==null?void 0:t[e]}}function Q3(e){return function(t){return wd(t,e)}}function t8(e){return _d(e)?Z3(Ga(e)):Q3(e)}function ui(e){return typeof e=="function"?e:e==null?Io:typeof e=="object"?he(e)?J3(e[0],e[1]):K3(e):t8(e)}function e8(e,t,r,n){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(n,o,r(o),e)}return n}function r8(e){return function(t,r,n){for(var i=-1,s=Object(t),o=n(t),a=o.length;a--;){var c=o[++i];if(r(s[c],c,s)===!1)break}return t}}var n8=r8();function i8(e,t){return e&&n8(e,t,kn)}function s8(e,t){return function(r,n){if(r==null)return r;if(!ci(r))return e(r,n);for(var i=r.length,s=-1,o=Object(r);++s<i&&n(o[s],s,o)!==!1;);return r}}var Ms=s8(i8);function o8(e,t,r,n){return Ms(e,function(i,s,o){t(n,i,r(i),o)}),n}function a8(e,t){return function(r,n){var i=he(r)?e8:o8,s=t?t():{};return i(r,e,ui(n),s)}}var Vb=Object.prototype,c8=Vb.hasOwnProperty,Ud=dd(function(e,t){e=Object(e);var r=-1,n=t.length,i=n>2?t[2]:void 0;for(i&&Z_(t[0],t[1],i)&&(n=1);++r<n;)for(var s=t[r],o=yd(s),a=-1,c=o.length;++a<c;){var u=o[a],l=e[u];(l===void 0||$a(l,Vb[u])&&!c8.call(e,u))&&(e[u]=s[u])}return e});function Xb(e){return Dn(e)&&ci(e)}var l8=200;function u8(e,t,r,n){var i=-1,s=X_,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;t.length>=l8&&(s=Nd,o=!1,t=new Co(t));t:for(;++i<a;){var l=e[i],h=l;if(l=l!==0?l:0,o&&h===h){for(var d=u;d--;)if(t[d]===h)continue t;c.push(l)}else s(t,h,n)||c.push(l)}return c}var Kl=dd(function(e,t){return Xb(e)?u8(e,Ed(t,1,Xb,!0)):[]});function Lo(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function Ar(e,t,r){var n=e==null?0:e.length;return n?(t=t===void 0?1:Ml(t),kd(e,t<0?0:t,n)):[]}function Ya(e,t,r){var n=e==null?0:e.length;return n?(t=t===void 0?1:Ml(t),t=n-t,kd(e,0,t<0?0:t)):[]}function f8(e){return typeof e=="function"?e:Io}function Kt(e,t){var r=he(e)?q_:Ms;return r(e,f8(t))}function h8(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function d8(e,t){var r=!0;return Ms(e,function(n,i,s){return r=!!t(n,i,s),r}),r}function jn(e,t,r){var n=he(e)?h8:d8;return n(e,ui(t))}function Jb(e,t){var r=[];return Ms(e,function(n,i,s){t(n,i,s)&&r.push(n)}),r}function An(e,t){var r=he(e)?Td:Jb;return r(e,ui(t))}function p8(e){return function(t,r,n){var i=Object(t);if(!ci(t)){var s=ui(r);t=kn(t),r=function(a){return s(i[a],a,i)}}var o=e(t,r,n);return o>-1?i[s?t[o]:o]:void 0}}var m8=Math.max;function g8(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var i=r==null?0:Ml(r);return i<0&&(i=m8(n+i,0)),V_(e,ui(t),i)}var Mo=p8(g8);function zn(e){return e&&e.length?e[0]:void 0}function y8(e,t){var r=-1,n=ci(e)?Array(e.length):[];return Ms(e,function(i,s,o){n[++r]=t(i,s,o)}),n}function Lt(e,t){var r=he(e)?Ll:y8;return r(e,ui(t))}function Tn(e,t){return Ed(Lt(e,t))}var _8=Object.prototype,b8=_8.hasOwnProperty,Zb=a8(function(e,t,r){b8.call(e,r)?e[r].push(t):hd(e,r,[t])}),w8=Object.prototype,v8=w8.hasOwnProperty;function E8(e,t){return e!=null&&v8.call(e,t)}function Wt(e,t){return e!=null&&qb(e,t,E8)}var k8="[object String]";function qr(e){return typeof e=="string"||!he(e)&&Dn(e)&&Qi(e)==k8}function x8(e,t){return Ll(t,function(r){return e[r]})}function Xe(e){return e==null?[]:x8(e,kn(e))}var A8=Math.max;function Mr(e,t,r,n){e=ci(e)?e:Xe(e),r=r?Ml(r):0;var i=e.length;return r<0&&(r=A8(i+r,0)),qr(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&fd(e,t,r)>-1}function Qb(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var i=0;return fd(e,t,i)}var T8="[object Map]",S8="[object Set]",R8=Object.prototype,O8=R8.hasOwnProperty;function Ae(e){if(e==null)return!0;if(ci(e)&&(he(e)||typeof e=="string"||typeof e.splice=="function"||ja(e)||gd(e)||$l(e)))return!e.length;var t=xn(e);if(t==T8||t==S8)return!e.size;if(Da(e))return!cb(e).length;for(var r in e)if(O8.call(e,r))return!1;return!0}var I8="[object RegExp]";function N8(e){return Dn(e)&&Qi(e)==I8}var t1=ts&&ts.isRegExp,Ci=t1?Bl(t1):N8;function Li(e){return e===void 0}var C8="Expected a function";function L8(e){if(typeof e!="function")throw new TypeError(C8);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function M8(e,t,r,n){if(!En(e))return e;t=zl(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=Ga(t[i]),u=r;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var l=a[c];u=void 0,u===void 0&&(u=En(l)?l:Pl(t[i+1])?[]:{})}Fl(a,c,u),a=a[c]}return e}function U8(e,t,r){for(var n=-1,i=t.length,s={};++n<i;){var o=t[n],a=wd(e,o);r(a,o)&&M8(s,zl(o,e),a)}return s}function Wn(e,t){if(e==null)return{};var r=Ll(e2(e),function(n){return[n]});return t=ui(t),U8(e,r,function(n,i){return t(n,i[0])})}function P8(e,t,r,n,i){return i(e,function(s,o,a){r=n?(n=!1,s):t(r,s,o,a)}),r}function Vr(e,t,r){var n=he(e)?BM:P8,i=arguments.length<3;return n(e,ui(t),r,i,Ms)}function Yl(e,t){var r=he(e)?Td:Jb;return r(e,L8(ui(t)))}function F8(e,t){var r;return Ms(e,function(n,i,s){return r=t(n,i,s),!r}),!!r}function Pd(e,t,r){var n=he(e)?Db:F8;return n(e,ui(t))}var $8=1/0,B8=No&&1/Cd(new No([,-0]))[1]==$8?function(e){return new No(e)}:ir,D8=200;function j8(e,t,r){var n=-1,i=X_,s=e.length,o=!0,a=[],c=a;if(s>=D8){var u=B8(e);if(u)return Cd(u);o=!1,i=Nd,c=new Co}else c=a;t:for(;++n<s;){var l=e[n],h=l;if(l=l!==0?l:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue t;a.push(l)}else i(c,h,r)||(c!==a&&c.push(h),a.push(l))}return a}function ql(e){return e&&e.length?j8(e):[]}function Fd(e){console&&console.error&&console.error(`Error: ${e}`)}function e1(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function r1(e){const t=new Date().getTime(),r=e();return{time:new Date().getTime()-t,value:r}}function n1(e){function t(){}t.prototype=e;const r=new t;function n(){return typeof r.bar}return n(),n(),e}function z8(e){return W8(e)?e.LABEL:e.name}function W8(e){return qr(e.LABEL)&&e.LABEL!==""}class fi{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),Kt(this.definition,r=>{r.accept(t)})}}class Xr extends fi{constructor(t){super([]),this.idx=1,Yr(this,Wn(t,r=>r!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class Uo extends fi{constructor(t){super(t.definition),this.orgText="",Yr(this,Wn(t,r=>r!==void 0))}}class Jr extends fi{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Yr(this,Wn(t,r=>r!==void 0))}}class Zr extends fi{constructor(t){super(t.definition),this.idx=1,Yr(this,Wn(t,r=>r!==void 0))}}class hi extends fi{constructor(t){super(t.definition),this.idx=1,Yr(this,Wn(t,r=>r!==void 0))}}class di extends fi{constructor(t){super(t.definition),this.idx=1,Yr(this,Wn(t,r=>r!==void 0))}}class sr extends fi{constructor(t){super(t.definition),this.idx=1,Yr(this,Wn(t,r=>r!==void 0))}}class Hn extends fi{constructor(t){super(t.definition),this.idx=1,Yr(this,Wn(t,r=>r!==void 0))}}class Gn extends fi{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Yr(this,Wn(t,r=>r!==void 0))}}class Fe{constructor(t){this.idx=1,Yr(this,Wn(t,r=>r!==void 0))}accept(t){t.visit(this)}}function H8(e){return Lt(e,Vl)}function Vl(e){function t(r){return Lt(r,Vl)}if(e instanceof Xr){const r={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return qr(e.label)&&(r.label=e.label),r}else{if(e instanceof Jr)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Zr)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof hi)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof di)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Vl(new Fe({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Hn)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Vl(new Fe({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof sr)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof Gn)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Fe){const r={type:"Terminal",name:e.terminalType.name,label:z8(e.terminalType),idx:e.idx};qr(e.label)&&(r.terminalLabel=e.label);const n=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(r.pattern=Ci(n)?n.source:n),r}else{if(e instanceof Uo)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class Us{visit(t){const r=t;switch(r.constructor){case Xr:return this.visitNonTerminal(r);case Jr:return this.visitAlternative(r);case Zr:return this.visitOption(r);case hi:return this.visitRepetitionMandatory(r);case di:return this.visitRepetitionMandatoryWithSeparator(r);case Hn:return this.visitRepetitionWithSeparator(r);case sr:return this.visitRepetition(r);case Gn:return this.visitAlternation(r);case Fe:return this.visitTerminal(r);case Uo:return this.visitRule(r);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function G8(e){return e instanceof Jr||e instanceof Zr||e instanceof sr||e instanceof hi||e instanceof di||e instanceof Hn||e instanceof Fe||e instanceof Uo}function Xl(e,t=[]){return e instanceof Zr||e instanceof sr||e instanceof Hn?!0:e instanceof Gn?Pd(e.definition,n=>Xl(n,t)):e instanceof Xr&&Mr(t,e)?!1:e instanceof fi?(e instanceof Xr&&t.push(e),jn(e.definition,n=>Xl(n,t))):!1}function K8(e){return e instanceof Gn}function pi(e){if(e instanceof Xr)return"SUBRULE";if(e instanceof Zr)return"OPTION";if(e instanceof Gn)return"OR";if(e instanceof hi)return"AT_LEAST_ONE";if(e instanceof di)return"AT_LEAST_ONE_SEP";if(e instanceof Hn)return"MANY_SEP";if(e instanceof sr)return"MANY";if(e instanceof Fe)return"CONSUME";throw Error("non exhaustive match")}class Jl{walk(t,r=[]){Kt(t.definition,(n,i)=>{const s=Ar(t.definition,i+1);if(n instanceof Xr)this.walkProdRef(n,s,r);else if(n instanceof Fe)this.walkTerminal(n,s,r);else if(n instanceof Jr)this.walkFlat(n,s,r);else if(n instanceof Zr)this.walkOption(n,s,r);else if(n instanceof hi)this.walkAtLeastOne(n,s,r);else if(n instanceof di)this.walkAtLeastOneSep(n,s,r);else if(n instanceof Hn)this.walkManySep(n,s,r);else if(n instanceof sr)this.walkMany(n,s,r);else if(n instanceof Gn)this.walkOr(n,s,r);else throw Error("non exhaustive match")})}walkTerminal(t,r,n){}walkProdRef(t,r,n){}walkFlat(t,r,n){const i=r.concat(n);this.walk(t,i)}walkOption(t,r,n){const i=r.concat(n);this.walk(t,i)}walkAtLeastOne(t,r,n){const i=[new Zr({definition:t.definition})].concat(r,n);this.walk(t,i)}walkAtLeastOneSep(t,r,n){const i=i1(t,r,n);this.walk(t,i)}walkMany(t,r,n){const i=[new Zr({definition:t.definition})].concat(r,n);this.walk(t,i)}walkManySep(t,r,n){const i=i1(t,r,n);this.walk(t,i)}walkOr(t,r,n){const i=r.concat(n);Kt(t.definition,s=>{const o=new Jr({definition:[s]});this.walk(o,i)})}}function i1(e,t,r){return[new Zr({definition:[new Fe({terminalType:e.separator})].concat(e.definition)})].concat(t,r)}function qa(e){if(e instanceof Xr)return qa(e.referencedRule);if(e instanceof Fe)return V8(e);if(G8(e))return Y8(e);if(K8(e))return q8(e);throw Error("non exhaustive match")}function Y8(e){let t=[];const r=e.definition;let n=0,i=r.length>n,s,o=!0;for(;i&&o;)s=r[n],o=Xl(s),t=t.concat(qa(s)),n=n+1,i=r.length>n;return ql(t)}function q8(e){const t=Lt(e.definition,r=>qa(r));return ql(ln(t))}function V8(e){return[e.terminalType]}const s1="_~IN~_";class X8 extends Jl{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,r,n){}walkProdRef(t,r,n){const i=Z8(t.referencedRule,t.idx)+this.topProd.name,s=r.concat(n),o=new Jr({definition:s}),a=qa(o);this.follows[i]=a}}function J8(e){const t={};return Kt(e,r=>{const n=new X8(r).startWalking();Yr(t,n)}),t}function Z8(e,t){return e.name+t+s1}function qt(e){return e.charCodeAt(0)}function $d(e,t){Array.isArray(e)?e.forEach(function(r){t.push(r)}):t.push(e)}function Va(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function Po(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function Q8(){throw Error("Internal Error - Should never get here!")}function o1(e){return e.type==="Character"}const Zl=[];for(let e=qt("0");e<=qt("9");e++)Zl.push(e);const Ql=[qt("_")].concat(Zl);for(let e=qt("a");e<=qt("z");e++)Ql.push(e);for(let e=qt("A");e<=qt("Z");e++)Ql.push(e);const a1=[qt(" "),qt("\f"),qt(`
`),qt("\r"),qt("	"),qt("\v"),qt("	"),qt(" "),qt(" "),qt(" "),qt(" "),qt(" "),qt(" "),qt(" "),qt(" "),qt(" "),qt(" "),qt(" "),qt(" "),qt(" "),qt("\u2028"),qt("\u2029"),qt(" "),qt(" "),qt("　"),qt("\uFEFF")],tU=/[0-9a-fA-F]/,tu=/[0-9]/,eU=/[1-9]/;class rU{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const r=this.disjunction();this.consumeChar("/");const n={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Va(n,"global");break;case"i":Va(n,"ignoreCase");break;case"m":Va(n,"multiLine");break;case"u":Va(n,"unicode");break;case"y":Va(n,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:r,loc:this.loc(0)}}disjunction(){const t=[],r=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(r)}}alternative(){const t=[],r=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(r)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let r;switch(this.popChar()){case"=":r="Lookahead";break;case"!":r="NegativeLookahead";break}Po(r);const n=this.disjunction();return this.consumeChar(")"),{type:r,value:n,loc:this.loc(t)}}return Q8()}quantifier(t=!1){let r;const n=this.idx;switch(this.popChar()){case"*":r={atLeast:0,atMost:1/0};break;case"+":r={atLeast:1,atMost:1/0};break;case"?":r={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":r={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),r={atLeast:i,atMost:s}):r={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&r===void 0)return;Po(r);break}if(!(t===!0&&r===void 0)&&Po(r))return this.peekChar(0)==="?"?(this.consumeChar("?"),r.greedy=!1):r.greedy=!0,r.type="Quantifier",r.loc=this.loc(n),r}atom(){let t;const r=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),Po(t))return t.loc=this.loc(r),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[qt(`
`),qt("\r"),qt("\u2028"),qt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,r=!1;switch(this.popChar()){case"d":t=Zl;break;case"D":t=Zl,r=!0;break;case"s":t=a1;break;case"S":t=a1,r=!0;break;case"w":t=Ql;break;case"W":t=Ql,r=!0;break}if(Po(t))return{type:"Set",value:t,complement:r}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=qt("\f");break;case"n":t=qt(`
`);break;case"r":t=qt("\r");break;case"t":t=qt("	");break;case"v":t=qt("\v");break}if(Po(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:qt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:qt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:qt(t)}}}characterClass(){const t=[];let r=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),r=!0);this.isClassAtom();){const n=this.classAtom();if(n.type,o1(n)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,o1(i)){if(i.value<n.value)throw Error("Range out of order in character class");t.push({from:n.value,to:i.value})}else $d(n.value,t),t.push(qt("-")),$d(i.value,t)}else $d(n.value,t)}return this.consumeChar("]"),{type:"Set",complement:r,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:qt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const r=this.disjunction();this.consumeChar(")");const n={type:"Group",capturing:t,value:r};return t&&(n.idx=this.groupIdx),n}positiveInteger(){let t=this.popChar();if(eU.test(t)===!1)throw Error("Expecting a positive integer");for(;tu.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(tu.test(t)===!1)throw Error("Expecting an integer");for(;tu.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:qt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return tu.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let r="";for(let i=0;i<t;i++){const s=this.popChar();if(tU.test(s)===!1)throw Error("Expecting a HexDecimal digits");r+=s}return{type:"Character",value:parseInt(r,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class Bd{visitChildren(t){for(const r in t){const n=t[r];t.hasOwnProperty(r)&&(n.type!==void 0?this.visit(n):Array.isArray(n)&&n.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let eu={};const nU=new rU;function ru(e){const t=e.toString();if(eu.hasOwnProperty(t))return eu[t];{const r=nU.pattern(t);return eu[t]=r,r}}function iU(){eu={}}const c1="Complement Sets are not supported for first char optimization",nu=`Unable to use "first char" lexer optimizations:
`;function sU(e,t=!1){try{const r=ru(e);return Dd(r.value,{},r.flags.ignoreCase)}catch(r){if(r.message===c1)t&&e1(`${nu}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let n="";t&&(n=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Fd(`${nu}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+n)}}return[]}function Dd(e,t,r){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)Dd(e.value[i],t,r);break;case"Alternative":const n=e.value;for(let i=0;i<n.length;i++){const s=n[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":iu(o.value,t,r);break;case"Set":if(o.complement===!0)throw Error(c1);Kt(o.value,c=>{if(typeof c=="number")iu(c,t,r);else{const u=c;if(r===!0)for(let l=u.from;l<=u.to;l++)iu(l,t,r);else{for(let l=u.from;l<=u.to&&l<Ja;l++)iu(l,t,r);if(u.to>=Ja){const l=u.from>=Ja?u.from:Ja,h=u.to,d=es(l),f=es(h);for(let m=d;m<=f;m++)t[m]=m}}}});break;case"Group":Dd(o.value,t,r);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&jd(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Xe(t)}function iu(e,t,r){const n=es(e);t[n]=n,r===!0&&oU(e,t)}function oU(e,t){const r=String.fromCharCode(e),n=r.toUpperCase();if(n!==r){const i=es(n.charCodeAt(0));t[i]=i}else{const i=r.toLowerCase();if(i!==r){const s=es(i.charCodeAt(0));t[s]=s}}}function l1(e,t){return Mo(e.value,r=>{if(typeof r=="number")return Mr(t,r);{const n=r;return Mo(t,i=>n.from<=i&&i<=n.to)!==void 0}})}function jd(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?he(e.value)?jn(e.value,jd):jd(e.value):!1}class aU extends Bd{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){Mr(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?l1(t,this.targetCharCodes)===void 0&&(this.found=!0):l1(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function zd(e,t){if(t instanceof RegExp){const r=ru(t),n=new aU(e);return n.visit(r),n.found}else return Mo(t,r=>Mr(e,r.charCodeAt(0)))!==void 0}const Ps="PATTERN",Xa="defaultMode",su="modes";let u1=typeof new RegExp("(?:)").sticky=="boolean";function cU(e,t){t=Ud(t,{useSticky:u1,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(b,T)=>T()});const r=t.tracer;r("initCharCodeToOptimizedIndexMap",()=>{NU()});let n;r("Reject Lexer.NA",()=>{n=Yl(e,b=>b[Ps]===pr.NA)});let i=!1,s;r("Transform Patterns",()=>{i=!1,s=Lt(n,b=>{const T=b[Ps];if(Ci(T)){const A=T.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!T.ignoreCase?A:A.length===2&&A[0]==="\\"&&!Mr(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:t.useSticky?h1(T):f1(T)}else{if(Oi(T))return i=!0,{exec:T};if(typeof T=="object")return i=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const A=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),x=new RegExp(A);return t.useSticky?h1(x):f1(x)}}else throw Error("non exhaustive match")}})});let o,a,c,u,l;r("misc mapping",()=>{o=Lt(n,b=>b.tokenTypeIdx),a=Lt(n,b=>{const T=b.GROUP;if(T!==pr.SKIPPED){if(qr(T))return T;if(Li(T))return!1;throw Error("non exhaustive match")}}),c=Lt(n,b=>{const T=b.LONGER_ALT;if(T)return he(T)?Lt(T,x=>Qb(n,x)):[Qb(n,T)]}),u=Lt(n,b=>b.PUSH_MODE),l=Lt(n,b=>Wt(b,"POP_MODE"))});let h;r("Line Terminator Handling",()=>{const b=m1(t.lineTerminatorCharacters);h=Lt(n,T=>!1),t.positionTracking!=="onlyOffset"&&(h=Lt(n,T=>Wt(T,"LINE_BREAKS")?!!T.LINE_BREAKS:p1(T,b)===!1&&zd(b,T.PATTERN)))});let d,f,m,p;r("Misc Mapping #2",()=>{d=Lt(n,d1),f=Lt(s,RU),m=Vr(n,(b,T)=>{const A=T.GROUP;return qr(A)&&A!==pr.SKIPPED&&(b[A]=[]),b},{}),p=Lt(s,(b,T)=>({pattern:s[T],longerAlt:c[T],canLineTerminator:h[T],isCustom:d[T],short:f[T],group:a[T],push:u[T],pop:l[T],tokenTypeIdx:o[T],tokenType:n[T]}))});let g=!0,y=[];return t.safeMode||r("First Char Optimization",()=>{y=Vr(n,(b,T,A)=>{if(typeof T.PATTERN=="string"){const x=T.PATTERN.charCodeAt(0),I=es(x);Wd(b,I,p[A])}else if(he(T.START_CHARS_HINT)){let x;Kt(T.START_CHARS_HINT,I=>{const R=typeof I=="string"?I.charCodeAt(0):I,$=es(R);x!==$&&(x=$,Wd(b,$,p[A]))})}else if(Ci(T.PATTERN))if(T.PATTERN.unicode)g=!1,t.ensureOptimizations&&Fd(`${nu}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const x=sU(T.PATTERN,t.ensureOptimizations);Ae(x)&&(g=!1),Kt(x,I=>{Wd(b,I,p[A])})}else t.ensureOptimizations&&Fd(`${nu}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),g=!1;return b},[])}),{emptyGroups:m,patternIdxToConfig:p,charCodeToPatternIdxToConfig:y,hasCustom:i,canBeOptimized:g}}function lU(e,t){let r=[];const n=fU(e);r=r.concat(n.errors);const i=hU(n.valid),s=i.valid;return r=r.concat(i.errors),r=r.concat(uU(s)),r=r.concat(wU(s)),r=r.concat(vU(s,t)),r=r.concat(EU(s)),r}function uU(e){let t=[];const r=An(e,n=>Ci(n[Ps]));return t=t.concat(pU(r)),t=t.concat(yU(r)),t=t.concat(_U(r)),t=t.concat(bU(r)),t=t.concat(mU(r)),t}function fU(e){const t=An(e,i=>!Wt(i,Ps)),r=Lt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:je.MISSING_PATTERN,tokenTypes:[i]})),n=Kl(e,t);return{errors:r,valid:n}}function hU(e){const t=An(e,i=>{const s=i[Ps];return!Ci(s)&&!Oi(s)&&!Wt(s,"exec")&&!qr(s)}),r=Lt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:je.INVALID_PATTERN,tokenTypes:[i]})),n=Kl(e,t);return{errors:r,valid:n}}const dU=/[^\\][$]/;function pU(e){class t extends Bd{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const r=An(e,i=>{const s=i.PATTERN;try{const o=ru(s),a=new t;return a.visit(o),a.found}catch{return dU.test(s.source)}});return Lt(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:je.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function mU(e){const t=An(e,n=>n.PATTERN.test(""));return Lt(t,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' must not match an empty string",type:je.EMPTY_MATCH_PATTERN,tokenTypes:[n]}))}const gU=/[^\\[][\^]|^\^/;function yU(e){class t extends Bd{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const r=An(e,i=>{const s=i.PATTERN;try{const o=ru(s),a=new t;return a.visit(o),a.found}catch{return gU.test(s.source)}});return Lt(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:je.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function _U(e){const t=An(e,n=>{const i=n[Ps];return i instanceof RegExp&&(i.multiline||i.global)});return Lt(t,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:je.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[n]}))}function bU(e){const t=[];let r=Lt(e,s=>Vr(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Mr(t,a)&&a.PATTERN!==pr.NA&&(t.push(a),o.push(a)),o),[]));r=Ka(r);const n=An(r,s=>s.length>1);return Lt(n,s=>{const o=Lt(s,c=>c.name);return{message:`The same RegExp pattern ->${zn(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:je.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function wU(e){const t=An(e,n=>{if(!Wt(n,"GROUP"))return!1;const i=n.GROUP;return i!==pr.SKIPPED&&i!==pr.NA&&!qr(i)});return Lt(t,n=>({message:"Token Type: ->"+n.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:je.INVALID_GROUP_TYPE_FOUND,tokenTypes:[n]}))}function vU(e,t){const r=An(e,i=>i.PUSH_MODE!==void 0&&!Mr(t,i.PUSH_MODE));return Lt(r,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:je.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function EU(e){const t=[],r=Vr(e,(n,i,s)=>{const o=i.PATTERN;return o===pr.NA||(qr(o)?n.push({str:o,idx:s,tokenType:i}):Ci(o)&&xU(o)&&n.push({str:o.source,idx:s,tokenType:i})),n},[]);return Kt(e,(n,i)=>{Kt(r,({str:s,idx:o,tokenType:a})=>{if(i<o&&kU(s,n.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${n.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:je.UNREACHABLE_PATTERN,tokenTypes:[n,a]})}})}),t}function kU(e,t){if(Ci(t)){const r=t.exec(e);return r!==null&&r.index===0}else{if(Oi(t))return t(e,0,[],{});if(Wt(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function xU(e){return Mo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],r=>e.source.indexOf(r)!==-1)===void 0}function f1(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function h1(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function AU(e,t,r){const n=[];return Wt(e,Xa)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+Xa+`> property in its definition
`,type:je.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Wt(e,su)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+su+`> property in its definition
`,type:je.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Wt(e,su)&&Wt(e,Xa)&&!Wt(e.modes,e.defaultMode)&&n.push({message:`A MultiMode Lexer cannot be initialized with a ${Xa}: <${e.defaultMode}>which does not exist
`,type:je.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Wt(e,su)&&Kt(e.modes,(i,s)=>{Kt(i,(o,a)=>{if(Li(o))n.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:je.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Wt(o,"LONGER_ALT")){const c=he(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Kt(c,u=>{!Li(u)&&!Mr(i,u)&&n.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${u.name}> on token <${o.name}> outside of mode <${s}>
`,type:je.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),n}function TU(e,t,r){const n=[];let i=!1;const s=Ka(ln(Xe(e.modes))),o=Yl(s,c=>c[Ps]===pr.NA),a=m1(r);return t&&Kt(o,c=>{const u=p1(c,a);if(u!==!1){const h={message:IU(c,u),type:u.issue,tokenType:c};n.push(h)}else Wt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):zd(a,c.PATTERN)&&(i=!0)}),t&&!i&&n.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:je.NO_LINE_BREAKS_FLAGS}),n}function SU(e){const t={},r=kn(e);return Kt(r,n=>{const i=e[n];if(he(i))t[n]=[];else throw Error("non exhaustive match")}),t}function d1(e){const t=e.PATTERN;if(Ci(t))return!1;if(Oi(t))return!0;if(Wt(t,"exec"))return!0;if(qr(t))return!1;throw Error("non exhaustive match")}function RU(e){return qr(e)&&e.length===1?e.charCodeAt(0):!1}const OU={test:function(e){const t=e.length;for(let r=this.lastIndex;r<t;r++){const n=e.charCodeAt(r);if(n===10)return this.lastIndex=r+1,!0;if(n===13)return e.charCodeAt(r+1)===10?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0};function p1(e,t){if(Wt(e,"LINE_BREAKS"))return!1;if(Ci(e.PATTERN)){try{zd(t,e.PATTERN)}catch(r){return{issue:je.IDENTIFY_TERMINATOR,errMsg:r.message}}return!1}else{if(qr(e.PATTERN))return!1;if(d1(e))return{issue:je.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function IU(e,t){if(t.issue===je.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===je.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function m1(e){return Lt(e,r=>qr(r)?r.charCodeAt(0):r)}function Wd(e,t,r){e[t]===void 0?e[t]=[r]:e[t].push(r)}const Ja=256;let ou=[];function es(e){return e<Ja?e:ou[e]}function NU(){if(Ae(ou)){ou=new Array(65536);for(let e=0;e<65536;e++)ou[e]=e>255?255+~~(e/255):e}}function Za(e,t){const r=e.tokenTypeIdx;return r===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[r]===!0}function au(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let g1=1;const y1={};function Qa(e){const t=CU(e);LU(t),UU(t),MU(t),Kt(t,r=>{r.isParent=r.categoryMatches.length>0})}function CU(e){let t=xr(e),r=e,n=!0;for(;n;){r=Ka(ln(Lt(r,s=>s.CATEGORIES)));const i=Kl(r,t);t=t.concat(i),Ae(i)?n=!1:r=i}return t}function LU(e){Kt(e,t=>{b1(t)||(y1[g1]=t,t.tokenTypeIdx=g1++),w1(t)&&!he(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),w1(t)||(t.CATEGORIES=[]),PU(t)||(t.categoryMatches=[]),FU(t)||(t.categoryMatchesMap={})})}function MU(e){Kt(e,t=>{t.categoryMatches=[],Kt(t.categoryMatchesMap,(r,n)=>{t.categoryMatches.push(y1[n].tokenTypeIdx)})})}function UU(e){Kt(e,t=>{_1([],t)})}function _1(e,t){Kt(e,r=>{t.categoryMatchesMap[r.tokenTypeIdx]=!0}),Kt(t.CATEGORIES,r=>{const n=e.concat(t);Mr(n,r)||_1(n,r)})}function b1(e){return Wt(e,"tokenTypeIdx")}function w1(e){return Wt(e,"CATEGORIES")}function PU(e){return Wt(e,"categoryMatches")}function FU(e){return Wt(e,"categoryMatchesMap")}function $U(e){return Wt(e,"tokenTypeIdx")}const BU={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,r,n,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${r} characters.`}};var je;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(je||(je={}));const tc={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:BU,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(tc);let pr=class{constructor(t,r=tc){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=r1(s),u=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&u(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof r=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Yr({},tc,r);const n=this.config.traceInitPerf;n===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof n=="number"&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===tc.lineTerminatorsPattern)this.config.lineTerminatorsPattern=OU;else if(this.config.lineTerminatorCharacters===tc.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(r.safeMode&&r.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),he(t)?i={modes:{defaultMode:xr(t)},defaultMode:Xa}:(s=!1,i=xr(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(AU(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(TU(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Kt(i.modes,(a,c)=>{i.modes[c]=Yl(a,u=>Li(u))});const o=kn(i.modes);if(Kt(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(lU(a,o))}),Ae(this.lexerDefinitionErrors)){Qa(a);let u;this.TRACE_INIT("analyzeTokenTypes",()=>{u=cU(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:r.positionTracking,ensureOptimizations:r.ensureOptimizations,safeMode:r.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=u.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=u.charCodeToPatternIdxToConfig,this.emptyGroups=Yr({},this.emptyGroups,u.emptyGroups),this.hasCustom=u.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=u.canBeOptimized}})}),this.defaultMode=i.defaultMode,!Ae(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Lt(this.lexerDefinitionErrors,u=>u.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Kt(this.lexerDefinitionWarning,a=>{e1(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(u1?(this.chopInput=Io,this.match=this.matchWithTest):(this.updateLastIndex=ir,this.match=this.matchWithExec),s&&(this.handleModes=ir),this.trackStartLines===!1&&(this.computeNewColumn=Io),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=ir),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Vr(this.canModeBeOptimized,(c,u,l)=>(u===!1&&c.push(l),c),[]);if(r.ensureOptimizations&&!Ae(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{iU()}),this.TRACE_INIT("toFastProperties",()=>{n1(this)})})}tokenize(t,r=this.defaultMode){if(!Ae(this.lexerDefinitionErrors)){const i=Lt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,r)}tokenizeInternal(t,r){let n,i,s,o,a,c,u,l,h,d,f,m,p,g,y;const b=t,T=b.length;let A=0,x=0;const I=this.hasCustom?0:Math.floor(t.length/10),R=new Array(I),$=[];let M=this.trackStartLines?1:void 0,H=this.trackStartLines?1:void 0;const X=SU(this.emptyGroups),O=this.trackStartLines,N=this.config.lineTerminatorsPattern;let E=0,L=[],j=[];const U=[],V=[];Object.freeze(V);let Q;function K(){return L}function W(wt){const Tt=es(wt),It=j[Tt];return It===void 0?V:It}const P=wt=>{if(U.length===1&&wt.tokenType.PUSH_MODE===void 0){const Tt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(wt);$.push({offset:wt.startOffset,line:wt.startLine,column:wt.startColumn,length:wt.image.length,message:Tt})}else{U.pop();const Tt=Lo(U);L=this.patternIdxToConfig[Tt],j=this.charCodeToPatternIdxToConfig[Tt],E=L.length;const It=this.canModeBeOptimized[Tt]&&this.config.safeMode===!1;j&&It?Q=W:Q=K}};function st(wt){U.push(wt),j=this.charCodeToPatternIdxToConfig[wt],L=this.patternIdxToConfig[wt],E=L.length,E=L.length;const Tt=this.canModeBeOptimized[wt]&&this.config.safeMode===!1;j&&Tt?Q=W:Q=K}st.call(this,r);let G;const rt=this.config.recoveryEnabled;for(;A<T;){c=null;const wt=b.charCodeAt(A),Tt=Q(wt),It=Tt.length;for(n=0;n<It;n++){G=Tt[n];const St=G.pattern;u=null;const Pt=G.short;if(Pt!==!1?wt===Pt&&(c=St):G.isCustom===!0?(y=St.exec(b,A,R,X),y!==null?(c=y[0],y.payload!==void 0&&(u=y.payload)):c=null):(this.updateLastIndex(St,A),c=this.match(St,t,A)),c!==null){if(a=G.longerAlt,a!==void 0){const Mt=a.length;for(s=0;s<Mt;s++){const Vt=L[a[s]],ee=Vt.pattern;if(l=null,Vt.isCustom===!0?(y=ee.exec(b,A,R,X),y!==null?(o=y[0],y.payload!==void 0&&(l=y.payload)):o=null):(this.updateLastIndex(ee,A),o=this.match(ee,t,A)),o&&o.length>c.length){c=o,u=l,G=Vt;break}}}break}}if(c!==null){if(h=c.length,d=G.group,d!==void 0&&(f=G.tokenTypeIdx,m=this.createTokenInstance(c,A,f,G.tokenType,M,H,h),this.handlePayload(m,u),d===!1?x=this.addToken(R,x,m):X[d].push(m)),t=this.chopInput(t,h),A=A+h,H=this.computeNewColumn(H,h),O===!0&&G.canLineTerminator===!0){let St=0,Pt,Mt;N.lastIndex=0;do Pt=N.test(c),Pt===!0&&(Mt=N.lastIndex-1,St++);while(Pt===!0);St!==0&&(M=M+St,H=h-Mt,this.updateTokenEndLineColumnLocation(m,d,Mt,St,M,H,h))}this.handleModes(G,P,st,m)}else{const St=A,Pt=M,Mt=H;let Vt=rt===!1;for(;Vt===!1&&A<T;)for(t=this.chopInput(t,1),A++,i=0;i<E;i++){const ee=L[i],S=ee.pattern,ft=ee.short;if(ft!==!1?b.charCodeAt(A)===ft&&(Vt=!0):ee.isCustom===!0?Vt=S.exec(b,A,R,X)!==null:(this.updateLastIndex(S,A),Vt=S.exec(t)!==null),Vt===!0)break}if(p=A-St,H=this.computeNewColumn(H,p),g=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(b,St,p,Pt,Mt),$.push({offset:St,line:Pt,column:Mt,length:p,message:g}),rt===!1)break}}return this.hasCustom||(R.length=x),{tokens:R,groups:X,errors:$}}handleModes(t,r,n,i){if(t.pop===!0){const s=t.push;r(i),s!==void 0&&n.call(this,s)}else t.push!==void 0&&n.call(this,t.push)}chopInput(t,r){return t.substring(r)}updateLastIndex(t,r){t.lastIndex=r}updateTokenEndLineColumnLocation(t,r,n,i,s,o,a){let c,u;r!==void 0&&(c=n===a-1,u=c?-1:0,i===1&&c===!0||(t.endLine=s+u,t.endColumn=o-1+-u))}computeNewColumn(t,r){return t+r}createOffsetOnlyToken(t,r,n,i){return{image:t,startOffset:r,tokenTypeIdx:n,tokenType:i}}createStartOnlyToken(t,r,n,i,s,o){return{image:t,startOffset:r,startLine:s,startColumn:o,tokenTypeIdx:n,tokenType:i}}createFullToken(t,r,n,i,s,o,a){return{image:t,startOffset:r,endOffset:r+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:n,tokenType:i}}addTokenUsingPush(t,r,n){return t.push(n),r}addTokenUsingMemberAccess(t,r,n){return t[r]=n,r++,r}handlePayloadNoCustom(t,r){}handlePayloadWithCustom(t,r){r!==null&&(t.payload=r)}matchWithTest(t,r,n){return t.test(r)===!0?r.substring(n,t.lastIndex):null}matchWithExec(t,r){const n=t.exec(r);return n!==null?n[0]:null}};pr.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",pr.NA=/NOT_APPLICABLE/;function ec(e){return v1(e)?e.LABEL:e.name}function v1(e){return qr(e.LABEL)&&e.LABEL!==""}const DU="parent",E1="categories",k1="label",x1="group",A1="push_mode",T1="pop_mode",S1="longer_alt",R1="line_breaks",O1="start_chars_hint";function un(e){return jU(e)}function jU(e){const t=e.pattern,r={};if(r.name=e.name,Li(t)||(r.PATTERN=t),Wt(e,DU))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Wt(e,E1)&&(r.CATEGORIES=e[E1]),Qa([r]),Wt(e,k1)&&(r.LABEL=e[k1]),Wt(e,x1)&&(r.GROUP=e[x1]),Wt(e,T1)&&(r.POP_MODE=e[T1]),Wt(e,A1)&&(r.PUSH_MODE=e[A1]),Wt(e,S1)&&(r.LONGER_ALT=e[S1]),Wt(e,R1)&&(r.LINE_BREAKS=e[R1]),Wt(e,O1)&&(r.START_CHARS_HINT=e[O1]),r}const Fs=un({name:"EOF",pattern:pr.NA});Qa([Fs]);function cu(e,t,r,n,i,s,o,a){return{image:t,startOffset:r,endOffset:n,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function zU(e,t){return Za(e,t)}const I1={buildMismatchTokenMessage({expected:e,actual:t,previous:r,ruleName:n}){return`Expecting ${v1(e)?`--> ${ec(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:r,customUserDescription:n,ruleName:i}){const s="Expecting: ",a=`
but found: '`+zn(t).image+"'";if(n)return s+n+a;{const c=Vr(e,(d,f)=>d.concat(f),[]),u=Lt(c,d=>`[${Lt(d,f=>ec(f)).join(", ")}]`),h=`one of these possible Token sequences:
${Lt(u,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:r,ruleName:n}){const i="Expecting: ",o=`
but found: '`+zn(t).image+"'";if(r)return i+r+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Lt(e,u=>`[${Lt(u,l=>ec(l)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(I1);const WU={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},$s={buildDuplicateFoundError(e,t){function r(l){return l instanceof Fe?l.terminalType.name:l instanceof Xr?l.nonTerminalName:""}const n=e.name,i=zn(t),s=i.idx,o=pi(i),a=r(i),c=s>0;let u=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${n}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return u=u.replace(/[ \t]+/g," "),u=u.replace(/\s\s+/g,`
`),u},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=Lt(e.prefixPath,i=>ec(i)).join(", "),r=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${r}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=Lt(e.prefixPath,i=>ec(i)).join(", "),r=e.alternation.idx===0?"":e.alternation.idx;let n=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${r}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return n=n+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,n},buildEmptyRepetitionError(e){let t=pi(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,r=Lt(e.leftRecursionPath,s=>s.name),n=`${t} --> ${r.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${n}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof Uo?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function HU(e,t){const r=new GU(e,t);return r.resolveRefs(),r.errors}class GU extends Us{constructor(t,r){super(),this.nameToTopRule=t,this.errMsgProvider=r,this.errors=[]}resolveRefs(){Kt(Xe(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const r=this.nameToTopRule[t.nonTerminalName];if(r)t.referencedRule=r;else{const n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:n,type:Ur.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class KU extends Jl{constructor(t,r){super(),this.topProd=t,this.path=r,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=xr(this.path.ruleStack).reverse(),this.occurrenceStack=xr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,r=[]){this.found||super.walk(t,r)}walkProdRef(t,r,n){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=r.concat(n);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){Ae(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class YU extends KU{constructor(t,r){super(t,r),this.path=r,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,r,n){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=r.concat(n),s=new Jr({definition:i});this.possibleTokTypes=qa(s),this.found=!0}}}class lu extends Jl{constructor(t,r){super(),this.topRule=t,this.occurrence=r,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class qU extends lu{walkMany(t,r,n){if(t.idx===this.occurrence){const i=zn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,r,n)}}class N1 extends lu{walkManySep(t,r,n){if(t.idx===this.occurrence){const i=zn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,r,n)}}class VU extends lu{walkAtLeastOne(t,r,n){if(t.idx===this.occurrence){const i=zn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,r,n)}}class C1 extends lu{walkAtLeastOneSep(t,r,n){if(t.idx===this.occurrence){const i=zn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,r,n)}}function Hd(e,t,r=[]){r=xr(r);let n=[],i=0;function s(a){return a.concat(Ar(e,i+1))}function o(a){const c=Hd(s(a),t,r);return n.concat(c)}for(;r.length<t&&i<e.length;){const a=e[i];if(a instanceof Jr)return o(a.definition);if(a instanceof Xr)return o(a.definition);if(a instanceof Zr)n=o(a.definition);else if(a instanceof hi){const c=a.definition.concat([new sr({definition:a.definition})]);return o(c)}else if(a instanceof di){const c=[new Jr({definition:a.definition}),new sr({definition:[new Fe({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Hn){const c=a.definition.concat([new sr({definition:[new Fe({terminalType:a.separator})].concat(a.definition)})]);n=o(c)}else if(a instanceof sr){const c=a.definition.concat([new sr({definition:a.definition})]);n=o(c)}else{if(a instanceof Gn)return Kt(a.definition,c=>{Ae(c.definition)===!1&&(n=o(c.definition))}),n;if(a instanceof Fe)r.push(a.terminalType);else throw Error("non exhaustive match")}i++}return n.push({partialPath:r,suffixDef:Ar(e,i)}),n}function L1(e,t,r,n){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,u=c-n-1,l=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!Ae(h);){const d=h.pop();if(d===o){a&&Lo(h).idx<=u&&h.pop();continue}const f=d.def,m=d.idx,p=d.ruleStack,g=d.occurrenceStack;if(Ae(f))continue;const y=f[0];if(y===i){const b={idx:m,def:Ar(f),ruleStack:Ya(p),occurrenceStack:Ya(g)};h.push(b)}else if(y instanceof Fe)if(m<c-1){const b=m+1,T=t[b];if(r(T,y.terminalType)){const A={idx:b,def:Ar(f),ruleStack:p,occurrenceStack:g};h.push(A)}}else if(m===c-1)l.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:p,occurrenceStack:g}),a=!0;else throw Error("non exhaustive match");else if(y instanceof Xr){const b=xr(p);b.push(y.nonTerminalName);const T=xr(g);T.push(y.idx);const A={idx:m,def:y.definition.concat(s,Ar(f)),ruleStack:b,occurrenceStack:T};h.push(A)}else if(y instanceof Zr){const b={idx:m,def:Ar(f),ruleStack:p,occurrenceStack:g};h.push(b),h.push(o);const T={idx:m,def:y.definition.concat(Ar(f)),ruleStack:p,occurrenceStack:g};h.push(T)}else if(y instanceof hi){const b=new sr({definition:y.definition,idx:y.idx}),T=y.definition.concat([b],Ar(f)),A={idx:m,def:T,ruleStack:p,occurrenceStack:g};h.push(A)}else if(y instanceof di){const b=new Fe({terminalType:y.separator}),T=new sr({definition:[b].concat(y.definition),idx:y.idx}),A=y.definition.concat([T],Ar(f)),x={idx:m,def:A,ruleStack:p,occurrenceStack:g};h.push(x)}else if(y instanceof Hn){const b={idx:m,def:Ar(f),ruleStack:p,occurrenceStack:g};h.push(b),h.push(o);const T=new Fe({terminalType:y.separator}),A=new sr({definition:[T].concat(y.definition),idx:y.idx}),x=y.definition.concat([A],Ar(f)),I={idx:m,def:x,ruleStack:p,occurrenceStack:g};h.push(I)}else if(y instanceof sr){const b={idx:m,def:Ar(f),ruleStack:p,occurrenceStack:g};h.push(b),h.push(o);const T=new sr({definition:y.definition,idx:y.idx}),A=y.definition.concat([T],Ar(f)),x={idx:m,def:A,ruleStack:p,occurrenceStack:g};h.push(x)}else if(y instanceof Gn)for(let b=y.definition.length-1;b>=0;b--){const T=y.definition[b],A={idx:m,def:T.definition.concat(Ar(f)),ruleStack:p,occurrenceStack:g};h.push(A),h.push(o)}else if(y instanceof Jr)h.push({idx:m,def:y.definition.concat(Ar(f)),ruleStack:p,occurrenceStack:g});else if(y instanceof Uo)h.push(XU(y,m,p,g));else throw Error("non exhaustive match")}return l}function XU(e,t,r,n){const i=xr(r);i.push(e.name);const s=xr(n);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var ze;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(ze||(ze={}));function M1(e){if(e instanceof Zr||e==="Option")return ze.OPTION;if(e instanceof sr||e==="Repetition")return ze.REPETITION;if(e instanceof hi||e==="RepetitionMandatory")return ze.REPETITION_MANDATORY;if(e instanceof di||e==="RepetitionMandatoryWithSeparator")return ze.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Hn||e==="RepetitionWithSeparator")return ze.REPETITION_WITH_SEPARATOR;if(e instanceof Gn||e==="Alternation")return ze.ALTERNATION;throw Error("non exhaustive match")}function JU(e,t,r,n,i,s){const o=Kd(e,t,r),a=$1(o)?au:Za;return s(o,n,a,i)}function ZU(e,t,r,n,i,s){const o=Yd(e,t,i,r),a=$1(o)?au:Za;return s(o[0],a,n)}function QU(e,t,r,n){const i=e.length,s=jn(e,o=>jn(o,a=>a.length===1));if(t)return function(o){const a=Lt(o,c=>c.GATE);for(let c=0;c<i;c++){const u=e[c],l=u.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let d=0;d<l;d++){const f=u[d],m=f.length;for(let p=0;p<m;p++){const g=this.LA(p+1);if(r(g,f[p])===!1)continue t}return c}}};if(s&&!n){const o=Lt(e,c=>ln(c)),a=Vr(o,(c,u,l)=>(Kt(u,h=>{Wt(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=l),Kt(h.categoryMatches,d=>{Wt(c,d)||(c[d]=l)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let u=0;u<c;u++){const l=a[u],h=l.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(r(f,l[d])===!1)continue t}return o}}}}function tP(e,t,r){const n=jn(e,s=>s.length===1),i=e.length;if(n&&!r){const s=ln(e);if(s.length===1&&Ae(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Vr(s,(a,c,u)=>(a[c.tokenTypeIdx]=!0,Kt(c.categoryMatches,l=>{a[l]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const u=this.LA(c+1);if(t(u,o[c])===!1)continue t}return!0}return!1}}class eP extends Jl{constructor(t,r,n){super(),this.topProd=t,this.targetOccurrence=r,this.targetProdType=n}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,r,n,i){return t.idx===this.targetOccurrence&&this.targetProdType===r?(this.restDef=n.concat(i),!0):!1}walkOption(t,r,n){this.checkIsTarget(t,ze.OPTION,r,n)||super.walkOption(t,r,n)}walkAtLeastOne(t,r,n){this.checkIsTarget(t,ze.REPETITION_MANDATORY,r,n)||super.walkOption(t,r,n)}walkAtLeastOneSep(t,r,n){this.checkIsTarget(t,ze.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||super.walkOption(t,r,n)}walkMany(t,r,n){this.checkIsTarget(t,ze.REPETITION,r,n)||super.walkOption(t,r,n)}walkManySep(t,r,n){this.checkIsTarget(t,ze.REPETITION_WITH_SEPARATOR,r,n)||super.walkOption(t,r,n)}}class U1 extends Us{constructor(t,r,n){super(),this.targetOccurrence=t,this.targetProdType=r,this.targetRef=n,this.result=[]}checkIsTarget(t,r){t.idx===this.targetOccurrence&&this.targetProdType===r&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,ze.OPTION)}visitRepetition(t){this.checkIsTarget(t,ze.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,ze.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,ze.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,ze.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,ze.ALTERNATION)}}function P1(e){const t=new Array(e);for(let r=0;r<e;r++)t[r]=[];return t}function Gd(e){let t=[""];for(let r=0;r<e.length;r++){const n=e[r],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+n.tokenTypeIdx);for(let a=0;a<n.categoryMatches.length;a++){const c="_"+n.categoryMatches[a];i.push(o+c)}}t=i}return t}function rP(e,t,r){for(let n=0;n<e.length;n++){if(n===r)continue;const i=e[n];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function F1(e,t){const r=Lt(e,o=>Hd([o],1)),n=P1(r.length),i=Lt(r,o=>{const a={};return Kt(o,c=>{const u=Gd(c.partialPath);Kt(u,l=>{a[l]=!0})}),a});let s=r;for(let o=1;o<=t;o++){const a=s;s=P1(a.length);for(let c=0;c<a.length;c++){const u=a[c];for(let l=0;l<u.length;l++){const h=u[l].partialPath,d=u[l].suffixDef,f=Gd(h);if(rP(i,f,c)||Ae(d)||h.length===t){const p=n[c];if(qd(p,h)===!1){p.push(h);for(let g=0;g<f.length;g++){const y=f[g];i[c][y]=!0}}}else{const p=Hd(d,o+1,h);s[c]=s[c].concat(p),Kt(p,g=>{const y=Gd(g.partialPath);Kt(y,b=>{i[c][b]=!0})})}}}}return n}function Kd(e,t,r,n){const i=new U1(e,ze.ALTERNATION,n);return t.accept(i),F1(i.result,r)}function Yd(e,t,r,n){const i=new U1(e,r);t.accept(i);const s=i.result,a=new eP(t,e,r).startWalking(),c=new Jr({definition:s}),u=new Jr({definition:a});return F1([c,u],n)}function qd(e,t){t:for(let r=0;r<e.length;r++){const n=e[r];if(n.length===t.length){for(let i=0;i<n.length;i++){const s=t[i],o=n[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function nP(e,t){return e.length<t.length&&jn(e,(r,n)=>{const i=t[n];return r===i||i.categoryMatchesMap[r.tokenTypeIdx]})}function $1(e){return jn(e,t=>jn(t,r=>jn(r,n=>Ae(n.categoryMatches))))}function iP(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return Lt(t,r=>Object.assign({type:Ur.CUSTOM_LOOKAHEAD_VALIDATION},r))}function sP(e,t,r,n){const i=Tn(e,c=>oP(c,r)),s=_P(e,t,r),o=Tn(e,c=>pP(c,r)),a=Tn(e,c=>lP(c,e,n,r));return i.concat(s,o,a)}function oP(e,t){const r=new cP;e.accept(r);const n=r.allProductions,i=Zb(n,aP),s=Wn(i,a=>a.length>1);return Lt(Xe(s),a=>{const c=zn(a),u=t.buildDuplicateFoundError(e,a),l=pi(c),h={message:u,type:Ur.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:l,occurrence:c.idx},d=B1(c);return d&&(h.parameter=d),h})}function aP(e){return`${pi(e)}_#_${e.idx}_#_${B1(e)}`}function B1(e){return e instanceof Fe?e.terminalType.name:e instanceof Xr?e.nonTerminalName:""}class cP extends Us{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function lP(e,t,r,n){const i=[];if(Vr(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=n.buildDuplicateRuleNameError({topLevelRule:e,grammarName:r});i.push({message:o,type:Ur.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function uP(e,t,r){const n=[];let i;return Mr(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${r}<-as it is not defined in any of the super grammars `,n.push({message:i,type:Ur.INVALID_RULE_OVERRIDE,ruleName:e})),n}function D1(e,t,r,n=[]){const i=[],s=uu(t.definition);if(Ae(s))return[];{const o=e.name;Mr(s,e)&&i.push({message:r.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:n}),type:Ur.LEFT_RECURSION,ruleName:o});const c=Kl(s,n.concat([e])),u=Tn(c,l=>{const h=xr(n);return h.push(l),D1(e,l,r,h)});return i.concat(u)}}function uu(e){let t=[];if(Ae(e))return t;const r=zn(e);if(r instanceof Xr)t.push(r.referencedRule);else if(r instanceof Jr||r instanceof Zr||r instanceof hi||r instanceof di||r instanceof Hn||r instanceof sr)t=t.concat(uu(r.definition));else if(r instanceof Gn)t=ln(Lt(r.definition,s=>uu(s.definition)));else if(!(r instanceof Fe))throw Error("non exhaustive match");const n=Xl(r),i=e.length>1;if(n&&i){const s=Ar(e);return t.concat(uu(s))}else return t}class Vd extends Us{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function fP(e,t){const r=new Vd;e.accept(r);const n=r.alternations;return Tn(n,s=>{const o=Ya(s.definition);return Tn(o,(a,c)=>{const u=L1([a],[],Za,1);return Ae(u)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:Ur.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function hP(e,t,r){const n=new Vd;e.accept(n);let i=n.alternations;return i=Yl(i,o=>o.ignoreAmbiguities===!0),Tn(i,o=>{const a=o.idx,c=o.maxLookahead||t,u=Kd(a,e,c,o),l=gP(u,o,e,r),h=yP(u,o,e,r);return l.concat(h)})}class dP extends Us{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function pP(e,t){const r=new Vd;e.accept(r);const n=r.alternations;return Tn(n,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:Ur.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function mP(e,t,r){const n=[];return Kt(e,i=>{const s=new dP;i.accept(s);const o=s.allProductions;Kt(o,a=>{const c=M1(a),u=a.maxLookahead||t,l=a.idx,d=Yd(l,i,c,u)[0];if(Ae(ln(d))){const f=r.buildEmptyRepetitionError({topLevelRule:i,repetition:a});n.push({message:f,type:Ur.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),n}function gP(e,t,r,n){const i=[],s=Vr(e,(a,c,u)=>(t.definition[u].ignoreAmbiguities===!0||Kt(c,l=>{const h=[u];Kt(e,(d,f)=>{u!==f&&qd(d,l)&&t.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!qd(i,l)&&(i.push(l),a.push({alts:h,path:l}))}),a),[]);return Lt(s,a=>{const c=Lt(a.alts,l=>l+1);return{message:n.buildAlternationAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:Ur.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:t.idx,alternatives:a.alts}})}function yP(e,t,r,n){const i=Vr(e,(o,a,c)=>{const u=Lt(a,l=>({idx:c,path:l}));return o.concat(u)},[]);return Ka(Tn(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,u=o.path,l=An(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&nP(d.path,u));return Lt(l,d=>{const f=[d.idx+1,c+1],m=t.idx===0?"":t.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:f,prefixPath:d.path}),type:Ur.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:m,alternatives:f}})}))}function _P(e,t,r){const n=[],i=Lt(t,s=>s.name);return Kt(e,s=>{const o=s.name;if(Mr(i,o)){const a=r.buildNamespaceConflictError(s);n.push({message:a,type:Ur.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),n}function bP(e){const t=Ud(e,{errMsgProvider:WU}),r={};return Kt(e.rules,n=>{r[n.name]=n}),HU(r,t.errMsgProvider)}function wP(e){return e=Ud(e,{errMsgProvider:$s}),sP(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const j1="MismatchedTokenException",z1="NoViableAltException",W1="EarlyExitException",H1="NotAllInputParsedException",G1=[j1,z1,W1,H1];Object.freeze(G1);function fu(e){return Mr(G1,e.name)}class hu extends Error{constructor(t,r){super(t),this.token=r,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class K1 extends hu{constructor(t,r,n){super(t,r),this.previousToken=n,this.name=j1}}class vP extends hu{constructor(t,r,n){super(t,r),this.previousToken=n,this.name=z1}}class EP extends hu{constructor(t,r){super(t,r),this.name=H1}}class kP extends hu{constructor(t,r,n){super(t,r),this.previousToken=n,this.name=W1}}const Xd={},Y1="InRuleRecoveryException";class xP extends Error{constructor(t){super(t),this.name=Y1}}class AP{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Wt(t,"recoveryEnabled")?t.recoveryEnabled:Mi.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=TP)}getTokenToInsert(t){const r=cu(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return r.isInsertedInRecovery=!0,r}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,r,n,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const u=this.LA(1);let l=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:u,previous:d,ruleName:this.getCurrRuleFullName()}),m=new K1(f,u,this.LA(0));m.resyncedTokens=Ya(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(l,i)){h();return}else if(n.call(this)){h(),t.apply(this,r);return}else this.tokenMatcher(l,s)?c=!0:(l=this.SKIP_TOKEN(),this.addToResyncTokens(l,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,r,n){return!(n===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,r)))}getFollowsForInRuleRecovery(t,r){const n=this.getCurrentGrammarPath(t,r);return this.getNextPossibleTokenTypes(n)}tryInRuleRecovery(t,r){if(this.canRecoverWithSingleTokenInsertion(t,r))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new xP("sad sad panda")}canPerformInRuleRecovery(t,r){return this.canRecoverWithSingleTokenInsertion(t,r)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,r){if(!this.canTokenTypeBeInsertedInRecovery(t)||Ae(r))return!1;const n=this.LA(1);return Mo(r,s=>this.tokenMatcher(n,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const r=this.getCurrFollowKey(),n=this.getFollowSetFromFollowKey(r);return Mr(n,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let r=this.LA(1),n=2;for(;;){const i=Mo(t,s=>zU(r,s));if(i!==void 0)return i;r=this.LA(n),n++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Xd;const t=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return Lt(t,(n,i)=>i===0?Xd:{ruleName:this.shortRuleNameToFullName(n),idxInCallingRule:r[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=Lt(this.buildFullFollowKeyStack(),r=>this.getFollowSetFromFollowKey(r));return ln(t)}getFollowSetFromFollowKey(t){if(t===Xd)return[Fs];const r=t.ruleName+t.idxInCallingRule+s1+t.inRule;return this.resyncFollows[r]}addToResyncTokens(t,r){return this.tokenMatcher(t,Fs)||r.push(t),r}reSyncTo(t){const r=[];let n=this.LA(1);for(;this.tokenMatcher(n,t)===!1;)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,r);return Ya(r)}attemptInRepetitionRecovery(t,r,n,i,s,o,a){}getCurrentGrammarPath(t,r){const n=this.getHumanReadableRuleStack(),i=xr(this.RULE_OCCURRENCE_STACK);return{ruleStack:n,occurrenceStack:i,lastTok:t,lastTokOccurrence:r}}getHumanReadableRuleStack(){return Lt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function TP(e,t,r,n,i,s,o){const a=this.getKeyForAutomaticLookahead(n,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new s(f,i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,l=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&u===void 0&&(u=Fs,l=1),!(u===void 0||l===void 0)&&this.shouldInRepetitionRecoveryBeTried(u,l,o)&&this.tryInRepetitionRecovery(e,t,r,u)}const SP=4,rs=8,q1=1<<rs,V1=2<<rs,Jd=3<<rs,Zd=4<<rs,Qd=5<<rs,du=6<<rs;function tp(e,t,r){return r|t|e}class RP{constructor(t){var r;this.maxLookahead=(r=t==null?void 0:t.maxLookahead)!==null&&r!==void 0?r:Mi.maxLookahead}validate(t){const r=this.validateNoLeftRecursion(t.rules);if(Ae(r)){const n=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...r,...n,...i,...s]}return r}validateNoLeftRecursion(t){return Tn(t,r=>D1(r,r,$s))}validateEmptyOrAlternatives(t){return Tn(t,r=>fP(r,$s))}validateAmbiguousAlternationAlternatives(t,r){return Tn(t,n=>hP(n,r,$s))}validateSomeNonEmptyLookaheadPath(t,r){return mP(t,r,$s)}buildLookaheadForAlternation(t){return JU(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,QU)}buildLookaheadForOptional(t){return ZU(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,M1(t.prodType),tP)}}class OP{initLooksAhead(t){this.dynamicTokensEnabled=Wt(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Mi.dynamicTokensEnabled,this.maxLookahead=Wt(t,"maxLookahead")?t.maxLookahead:Mi.maxLookahead,this.lookaheadStrategy=Wt(t,"lookaheadStrategy")?t.lookaheadStrategy:new RP({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){Kt(t,r=>{this.TRACE_INIT(`${r.name} Rule Lookahead`,()=>{const{alternation:n,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=NP(r);Kt(n,u=>{const l=u.idx===0?"":u.idx;this.TRACE_INIT(`${pi(u)}${l}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:u.idx,rule:r,maxLookahead:u.maxLookahead||this.maxLookahead,hasPredicates:u.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=tp(this.fullRuleNameToShort[r.name],q1,u.idx);this.setLaFuncCache(d,h)})}),Kt(i,u=>{this.computeLookaheadFunc(r,u.idx,Jd,"Repetition",u.maxLookahead,pi(u))}),Kt(s,u=>{this.computeLookaheadFunc(r,u.idx,V1,"Option",u.maxLookahead,pi(u))}),Kt(o,u=>{this.computeLookaheadFunc(r,u.idx,Zd,"RepetitionMandatory",u.maxLookahead,pi(u))}),Kt(a,u=>{this.computeLookaheadFunc(r,u.idx,du,"RepetitionMandatoryWithSeparator",u.maxLookahead,pi(u))}),Kt(c,u=>{this.computeLookaheadFunc(r,u.idx,Qd,"RepetitionWithSeparator",u.maxLookahead,pi(u))})})})}computeLookaheadFunc(t,r,n,i,s,o){this.TRACE_INIT(`${o}${r===0?"":r}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:r,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=tp(this.fullRuleNameToShort[t.name],n,r);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,r){const n=this.getLastExplicitRuleShortName();return tp(n,t,r)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,r){this.lookAheadFuncsCache.set(t,r)}}class IP extends Us{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const pu=new IP;function NP(e){pu.reset(),e.accept(pu);const t=pu.dslMethods;return pu.reset(),t}function X1(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function J1(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function CP(e,t,r){e.children[r]===void 0?e.children[r]=[t]:e.children[r].push(t)}function LP(e,t,r){e.children[t]===void 0?e.children[t]=[r]:e.children[t].push(r)}const MP="name";function Z1(e,t){Object.defineProperty(e,MP,{enumerable:!1,configurable:!0,writable:!1,value:t})}function UP(e,t){const r=kn(e),n=r.length;for(let i=0;i<n;i++){const s=r[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const u=o[c];u.tokenTypeIdx===void 0&&this[u.name](u.children,t)}}}function PP(e,t){const r=function(){};Z1(r,e+"BaseSemantics");const n={visit:function(i,s){if(he(i)&&(i=i[0]),!Li(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=$P(this,t);if(!Ae(i)){const s=Lt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return r.prototype=n,r.prototype.constructor=r,r._RULE_NAMES=t,r}function FP(e,t,r){const n=function(){};Z1(n,e+"BaseSemanticsWithDefaults");const i=Object.create(r.prototype);return Kt(t,s=>{i[s]=UP}),n.prototype=i,n.prototype.constructor=n,n}var ep;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(ep||(ep={}));function $P(e,t){return BP(e,t)}function BP(e,t){const r=An(t,i=>Oi(e[i])===!1),n=Lt(r,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:ep.MISSING_METHOD,methodName:i}));return Ka(n)}class DP{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Wt(t,"nodeLocationTracking")?t.nodeLocationTracking:Mi.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=ir,this.cstFinallyStateUpdate=ir,this.cstPostTerminal=ir,this.cstPostNonTerminal=ir,this.cstPostRule=ir;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=J1,this.setNodeLocationFromNode=J1,this.cstPostRule=ir,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=ir,this.setNodeLocationFromNode=ir,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=X1,this.setNodeLocationFromNode=X1,this.cstPostRule=ir,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=ir,this.setNodeLocationFromNode=ir,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=ir,this.setNodeLocationFromNode=ir,this.cstPostRule=ir,this.setInitialNodeLocation=ir;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const r=this.LA(1);t.location={startOffset:r.startOffset,startLine:r.startLine,startColumn:r.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const r={name:t,children:Object.create(null)};this.setInitialNodeLocation(r),this.CST_STACK.push(r)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const r=this.LA(0),n=t.location;n.startOffset<=r.startOffset?(n.endOffset=r.endOffset,n.endLine=r.endLine,n.endColumn=r.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)}cstPostRuleOnlyOffset(t){const r=this.LA(0),n=t.location;n.startOffset<=r.startOffset?n.endOffset=r.endOffset:n.startOffset=NaN}cstPostTerminal(t,r){const n=this.CST_STACK[this.CST_STACK.length-1];CP(n,r,t),this.setNodeLocationFromToken(n.location,r)}cstPostNonTerminal(t,r){const n=this.CST_STACK[this.CST_STACK.length-1];LP(n,r,t),this.setNodeLocationFromNode(n.location,t.location)}getBaseCstVisitorConstructor(){if(Li(this.baseCstVisitorConstructor)){const t=PP(this.className,kn(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Li(this.baseCstVisitorWithDefaultsConstructor)){const t=FP(this.className,kn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class jP{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):yu}LA(t){const r=this.currIdx+t;return r<0||this.tokVectorLength<=r?yu:this.tokVector[r]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class zP{ACTION(t){return t.call(this)}consume(t,r,n){return this.consumeInternal(r,t,n)}subrule(t,r,n){return this.subruleInternal(r,t,n)}option(t,r){return this.optionInternal(r,t)}or(t,r){return this.orInternal(r,t)}many(t,r){return this.manyInternal(t,r)}atLeastOne(t,r){return this.atLeastOneInternal(t,r)}CONSUME(t,r){return this.consumeInternal(t,0,r)}CONSUME1(t,r){return this.consumeInternal(t,1,r)}CONSUME2(t,r){return this.consumeInternal(t,2,r)}CONSUME3(t,r){return this.consumeInternal(t,3,r)}CONSUME4(t,r){return this.consumeInternal(t,4,r)}CONSUME5(t,r){return this.consumeInternal(t,5,r)}CONSUME6(t,r){return this.consumeInternal(t,6,r)}CONSUME7(t,r){return this.consumeInternal(t,7,r)}CONSUME8(t,r){return this.consumeInternal(t,8,r)}CONSUME9(t,r){return this.consumeInternal(t,9,r)}SUBRULE(t,r){return this.subruleInternal(t,0,r)}SUBRULE1(t,r){return this.subruleInternal(t,1,r)}SUBRULE2(t,r){return this.subruleInternal(t,2,r)}SUBRULE3(t,r){return this.subruleInternal(t,3,r)}SUBRULE4(t,r){return this.subruleInternal(t,4,r)}SUBRULE5(t,r){return this.subruleInternal(t,5,r)}SUBRULE6(t,r){return this.subruleInternal(t,6,r)}SUBRULE7(t,r){return this.subruleInternal(t,7,r)}SUBRULE8(t,r){return this.subruleInternal(t,8,r)}SUBRULE9(t,r){return this.subruleInternal(t,9,r)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,r,n=_u){if(Mr(this.definedRulesNames,t)){const o={message:$s.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:Ur.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,r,n);return this[t]=i,i}OVERRIDE_RULE(t,r,n=_u){const i=uP(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,r,n);return this[t]=s,s}BACKTRACK(t,r){return function(){this.isBackTrackingStack.push(1);const n=this.saveRecogState();try{return t.apply(this,r),!0}catch(i){if(fu(i))return!1;throw i}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return H8(Xe(this.gastProductionsCache))}}class WP{initRecognizerEngine(t,r){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=au,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Wt(r,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(he(t)){if(Ae(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(he(t))this.tokensMap=Vr(t,(s,o)=>(s[o.name]=o,s),{});else if(Wt(t,"modes")&&jn(ln(Xe(t.modes)),$U)){const s=ln(Xe(t.modes)),o=ql(s);this.tokensMap=Vr(o,(a,c)=>(a[c.name]=c,a),{})}else if(En(t))this.tokensMap=xr(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Fs;const n=Wt(t,"modes")?ln(Xe(t.modes)):Xe(t),i=jn(n,s=>Ae(s.categoryMatches));this.tokenMatcher=i?au:Za,Qa(Xe(this.tokensMap))}defineRule(t,r,n){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Wt(n,"resyncEnabled")?n.resyncEnabled:_u.resyncEnabled,s=Wt(n,"recoveryValueFunc")?n.recoveryValueFunc:_u.recoveryValueFunc,o=this.ruleShortNameIdx<<SP+rs;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...l){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),r.apply(this,l);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...l){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),r.apply(this,l)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:r})}invokeRuleCatch(t,r,n){const i=this.RULE_STACK.length===1,s=r&&!this.isBackTracking()&&this.recoveryEnabled;if(fu(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return n(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),n(t);throw o}}else throw t}optionInternal(t,r){const n=this.getKeyForAutomaticLookahead(V1,r);return this.optionInternalLogic(t,r,n)}optionInternalLogic(t,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,r){const n=this.getKeyForAutomaticLookahead(Zd,t);return this.atLeastOneInternalLogic(t,r,n)}atLeastOneInternalLogic(t,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;const o=r.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=r;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,ze.REPETITION_MANDATORY,r.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,r],i,Zd,t,VU)}atLeastOneSepFirstInternal(t,r){const n=this.getKeyForAutomaticLookahead(du,t);this.atLeastOneSepFirstInternalLogic(t,r,n)}atLeastOneSepFirstInternalLogic(t,r,n){const i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,C1],a,du,t,C1)}else throw this.raiseEarlyExitException(t,ze.REPETITION_MANDATORY_WITH_SEPARATOR,r.ERR_MSG)}manyInternal(t,r){const n=this.getKeyForAutomaticLookahead(Jd,t);return this.manyInternalLogic(t,r,n)}manyInternalLogic(t,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;const a=r.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=r;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,r],i,Jd,t,qU,o)}manySepFirstInternal(t,r){const n=this.getKeyForAutomaticLookahead(Qd,t);this.manySepFirstInternalLogic(t,r,n)}manySepFirstInternalLogic(t,r,n){const i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,N1],a,Qd,t,N1)}}repetitionSepSecondInternal(t,r,n,i,s){for(;n();)this.CONSUME(r),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,r,n,i,s],n,du,t,s)}doSingleRepetition(t){const r=this.getLexerPosition();return t.call(this),this.getLexerPosition()>r}orInternal(t,r){const n=this.getKeyForAutomaticLookahead(q1,r),i=he(t)?t:t.DEF,o=this.getLaFuncFromCache(n).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(r,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),r=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new EP(r,t))}}subruleInternal(t,r,n){let i;try{const s=n!==void 0?n.ARGS:void 0;return this.subruleIdx=r,i=t.apply(this,s),this.cstPostNonTerminal(i,n!==void 0&&n.LABEL!==void 0?n.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,n,t.ruleName)}}subruleInternalError(t,r,n){throw fu(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,r!==void 0&&r.LABEL!==void 0?r.LABEL:n),delete t.partialCstResult),t}consumeInternal(t,r,n){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,n)}catch(s){i=this.consumeInternalRecovery(t,r,s)}return this.cstPostTerminal(n!==void 0&&n.LABEL!==void 0?n.LABEL:t.name,i),i}consumeInternalError(t,r,n){let i;const s=this.LA(0);throw n!==void 0&&n.ERR_MSG?i=n.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:r,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new K1(i,r,s))}consumeInternalRecovery(t,r,n){if(this.recoveryEnabled&&n.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,r);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===Y1?n:s}}else throw n}saveRecogState(){const t=this.errors,r=xr(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:r,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,r,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(r)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Fs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class HP{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Wt(t,"errorMessageProvider")?t.errorMessageProvider:Mi.errorMessageProvider}SAVE_ERROR(t){if(fu(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:xr(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return xr(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,r,n){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Yd(t,s,r,this.maxLookahead)[0],c=[];for(let l=1;l<=this.maxLookahead;l++)c.push(this.LA(l));const u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:n,ruleName:i});throw this.SAVE_ERROR(new kP(u,this.LA(1),this.LA(0)))}raiseNoAltException(t,r){const n=this.getCurrRuleFullName(),i=this.getGAstProductions()[n],s=Kd(t,i,this.maxLookahead),o=[];for(let u=1;u<=this.maxLookahead;u++)o.push(this.LA(u));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:r,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new vP(c,this.LA(1),a))}}class GP{initContentAssist(){}computeContentAssist(t,r){const n=this.gastProductionsCache[t];if(Li(n))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return L1([n],r,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const r=zn(t.ruleStack),i=this.getGAstProductions()[r];return new YU(i,t).startWalking()}}const mu={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(mu);const Q1=!0,tw=Math.pow(2,rs)-1,ew=un({name:"RECORDING_PHASE_TOKEN",pattern:pr.NA});Qa([ew]);const rw=cu(ew,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(rw);const KP={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class YP{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const r=t>0?t:"";this[`CONSUME${r}`]=function(n,i){return this.consumeInternalRecord(n,t,i)},this[`SUBRULE${r}`]=function(n,i){return this.subruleInternalRecord(n,t,i)},this[`OPTION${r}`]=function(n){return this.optionInternalRecord(n,t)},this[`OR${r}`]=function(n){return this.orInternalRecord(n,t)},this[`MANY${r}`]=function(n){this.manyInternalRecord(t,n)},this[`MANY_SEP${r}`]=function(n){this.manySepFirstInternalRecord(t,n)},this[`AT_LEAST_ONE${r}`]=function(n){this.atLeastOneInternalRecord(t,n)},this[`AT_LEAST_ONE_SEP${r}`]=function(n){this.atLeastOneSepFirstInternalRecord(t,n)}}this.consume=function(t,r,n){return this.consumeInternalRecord(r,t,n)},this.subrule=function(t,r,n){return this.subruleInternalRecord(r,t,n)},this.option=function(t,r){return this.optionInternalRecord(r,t)},this.or=function(t,r){return this.orInternalRecord(r,t)},this.many=function(t,r){this.manyInternalRecord(t,r)},this.atLeastOne=function(t,r){this.atLeastOneInternalRecord(t,r)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let r=0;r<10;r++){const n=r>0?r:"";delete t[`CONSUME${n}`],delete t[`SUBRULE${n}`],delete t[`OPTION${n}`],delete t[`OR${n}`],delete t[`MANY${n}`],delete t[`MANY_SEP${n}`],delete t[`AT_LEAST_ONE${n}`],delete t[`AT_LEAST_ONE_SEP${n}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,r){return()=>!0}LA_RECORD(t){return yu}topLevelRuleRecord(t,r){try{const n=new Uo({definition:[],name:t});return n.name=t,this.recordingProdStack.push(n),r.call(this),this.recordingProdStack.pop(),n}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw n}throw n}}optionInternalRecord(t,r){return rc.call(this,Zr,t,r)}atLeastOneInternalRecord(t,r){rc.call(this,hi,r,t)}atLeastOneSepFirstInternalRecord(t,r){rc.call(this,di,r,t,Q1)}manyInternalRecord(t,r){rc.call(this,sr,r,t)}manySepFirstInternalRecord(t,r){rc.call(this,Hn,r,t,Q1)}orInternalRecord(t,r){return qP.call(this,t,r)}subruleInternalRecord(t,r,n){if(gu(r),!t||Wt(t,"ruleName")===!1){const a=new Error(`<SUBRULE${nw(r)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Lo(this.recordingProdStack),s=t.ruleName,o=new Xr({idx:r,nonTerminalName:s,label:n==null?void 0:n.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?KP:mu}consumeInternalRecord(t,r,n){if(gu(r),!b1(t)){const o=new Error(`<CONSUME${nw(r)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Lo(this.recordingProdStack),s=new Fe({idx:r,terminalType:t,label:n==null?void 0:n.LABEL});return i.definition.push(s),rw}}function rc(e,t,r,n=!1){gu(r);const i=Lo(this.recordingProdStack),s=Oi(t)?t:t.DEF,o=new e({definition:[],idx:r});return n&&(o.separator=t.SEP),Wt(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),mu}function qP(e,t){gu(t);const r=Lo(this.recordingProdStack),n=he(e)===!1,i=n===!1?e:e.DEF,s=new Gn({definition:[],idx:t,ignoreAmbiguities:n&&e.IGNORE_AMBIGUITIES===!0});Wt(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=Pd(i,a=>Oi(a.GATE));return s.hasPredicates=o,r.definition.push(s),Kt(i,a=>{const c=new Jr({definition:[]});s.definition.push(c),Wt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Wt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),mu}function nw(e){return e===0?"":`${e}`}function gu(e){if(e<0||e>tw){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${tw+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class VP{initPerformanceTracer(t){if(Wt(t,"traceInitPerf")){const r=t.traceInitPerf,n=typeof r=="number";this.traceInitMaxIdent=n?r:1/0,this.traceInitPerf=n?r>0:r}else this.traceInitMaxIdent=0,this.traceInitPerf=Mi.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,r){if(this.traceInitPerf===!0){this.traceInitIndent++;const n=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${n}--> <${t}>`);const{time:i,value:s}=r1(r),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${n}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return r()}}function XP(e,t){t.forEach(r=>{const n=r.prototype;Object.getOwnPropertyNames(n).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(n,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=r.prototype[i]})})}const yu=cu(Fs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(yu);const Mi=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:I1,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),_u=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Ur;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Ur||(Ur={}));let rp=class EA{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const r=this.className;this.TRACE_INIT("toFastProps",()=>{n1(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Kt(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let n=[];if(this.TRACE_INIT("Grammar Resolving",()=>{n=bP({rules:Xe(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(n)}),this.TRACE_INIT("Grammar Validations",()=>{if(Ae(n)&&this.skipValidations===!1){const i=wP({rules:Xe(this.gastProductionsCache),tokenTypes:Xe(this.tokensMap),errMsgProvider:$s,grammarName:r}),s=iP({lookaheadStrategy:this.lookaheadStrategy,rules:Xe(this.gastProductionsCache),tokenTypes:Xe(this.tokensMap),grammarName:r});this.definitionErrors=this.definitionErrors.concat(i,s)}}),Ae(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=J8(Xe(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Xe(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Xe(this.gastProductionsCache))})),!EA.DEFER_DEFINITION_ERRORS_HANDLING&&!Ae(this.definitionErrors))throw t=Lt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,r){this.definitionErrors=[],this.selfAnalysisDone=!1;const n=this;if(n.initErrorHandler(r),n.initLexerAdapter(),n.initLooksAhead(r),n.initRecognizerEngine(t,r),n.initRecoverable(r),n.initTreeBuilder(r),n.initContentAssist(),n.initGastRecorder(r),n.initPerformanceTracer(r),Wt(r,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Wt(r,"skipValidations")?r.skipValidations:Mi.skipValidations}};rp.DEFER_DEFINITION_ERRORS_HANDLING=!1,XP(rp,[AP,OP,DP,jP,WP,zP,HP,GP,YP,VP]);class JP extends rp{constructor(t,r=Mi){const n=xr(r);n.outputCst=!0,super(t,n)}}function ZP(e){const t=new QP,r=Xe(e);return Lt(r,n=>t.visitRule(n))}class QP extends Us{visitRule(t){const r=this.visitEach(t.definition),n=Zb(r,s=>s.propertyName),i=Lt(n,(s,o)=>{const a=!Pd(s,u=>!u.canBeNull);let c=s[0].type;return s.length>1&&(c=Lt(s,u=>u.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:bu(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:bu(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:bu(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:bu(t)}]}visitEachAndOverrideWith(t,r){return Lt(this.visitEach(t),n=>Yr({},n,r))}visitEach(t){return ln(Lt(t,r=>this.visit(r)))}}function bu(e){return e instanceof Xr?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function tF(e,t){let r=[];return r=r.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),r=r.concat(ln(Lt(e,n=>eF(n)))),t.includeVisitorInterface&&(r=r.concat(sF(t.visitorInterfaceName,e))),r.join(`

`)+`
`}function eF(e){const t=rF(e),r=nF(e);return[t,r]}function rF(e){const t=sw(e.name),r=np(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${r};
}`}function nF(e){return`export type ${np(e.name)} = {
  ${Lt(e.properties,r=>iF(r)).join(`
  `)}
};`}function iF(e){const t=aF(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function sF(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Lt(t,r=>oF(r)).join(`
  `)}
}`}function oF(e){const t=np(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function aF(e){if(he(e)){const t=ql(Lt(e,n=>iw(n)));return"("+Vr(t,(n,i)=>n+" | "+i)+")"}else return iw(e)}function iw(e){return e.kind==="token"?"IToken":sw(e.name)}function sw(e){return bb(e)+"CstNode"}function np(e){return bb(e)+"CstChildren"}const cF={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function lF(e,t){const r=Object.assign(Object.assign({},cF),t),n=ZP(e);return tF(n,r)}const nc=dy(32,126).map(e=>String.fromCharCode(e));function Qt(e){return un({...e,name:`token_${e.name}`})}function ht(e){return Qt({name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:Ye})}const wu=Qt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),uF=Qt({name:"whitespace",pattern:/ +/,group:pr.SKIPPED}),fF=Qt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:pr.SKIPPED}),ip=Qt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Fo=Qt({name:"command",pattern:/#/,start_chars_hint:["#"]});let ow=!1;const hF="@#/?':!",dF=/[#\d]+/i,pF=/^(by|at|away|toward|find|flee|to|cw|ccw|opp|rndp)/i;function mF(e,t){if(!ow)return null;let r=t;const n=e[r-1]??"";if(r>0&&n!==" "&&n!==`
`)return null;if(e[r]===" "){for(;e[r]===" ";)r++;if(hF.includes(e[r]))return null}for(;r>0&&`$"@#':!/?
`.includes(e[r])===!1;)r--;switch(e[r]){case"?":case"/":{const o=e.substring(r+1,t+1).toLowerCase();if(o.indexOf(" ")<1||pF.test(o))return null;break}case"#":{const o=e.substring(r+1,r+4).toLowerCase();if(dF.test(o)===!1)return null;break}case'"':{for(r--;r>0&&e[r]===" ";)r--;if(!(r<1||e[r]===`
`))return null;break}case"@":case"'":case":":case"!":return null}let i=t;for(e[i]==='"'&&++i;i<e.length&&e[i]!==`
`;)i++;const s=e.substring(t,i);return s.trim().length===0||s.toLowerCase()==="do"?null:[s]}const aw=Qt({name:"text",pattern:mF,line_breaks:!1,start_chars_hint:nc}),cw=Qt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),sp=Qt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),lw=Qt({name:"hyperlink",pattern:/![^;\n]*/,start_chars_hint:["!"]}),uw=Qt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),Ye=Qt({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:nc}),vu=Qt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),op=Qt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),fw=ht("isterrain"),hw=ht("isobject"),dw=ht("issolid"),pw=ht("iswalk"),mw=ht("isswim"),gw=ht("isbullet"),yw=ht("isghost"),_w=ht("iswalking"),bw=ht("iswalkable"),ww=ht("isswimming"),vw=ht("isswimmable"),Ew=ht("black"),kw=ht("dkblue"),xw=ht("dkgreen"),Aw=ht("dkcyan"),Tw=ht("dkred"),Sw=ht("dkpurple"),Rw=ht("dkyellow"),Ow=ht("ltgray"),Iw=ht("dkgray"),Nw=ht("blue"),Cw=ht("green"),Lw=ht("cyan"),Mw=ht("red"),Uw=ht("purple"),Pw=ht("yellow"),Fw=ht("white"),$w=ht("brown"),Bw=ht("dkwhite"),Dw=ht("ltgrey"),jw=ht("gray"),zw=ht("grey"),Ww=ht("dkgrey"),Hw=ht("ltblack"),Gw=ht("onblack"),Kw=ht("ondkblue"),Yw=ht("ondkgreen"),qw=ht("ondkcyan"),Vw=ht("ondkred"),Xw=ht("ondkpurple"),Jw=ht("ondkyellow"),Zw=ht("onltgray"),Qw=ht("ondkgray"),tv=ht("onblue"),ev=ht("ongreen"),rv=ht("oncyan"),nv=ht("onred"),iv=ht("onpurple"),sv=ht("onyellow"),ov=ht("onwhite"),av=ht("onbrown"),cv=ht("ondkwhite"),lv=ht("onltgrey"),uv=ht("ongray"),fv=ht("ongrey"),hv=ht("ondkgrey"),dv=ht("onltblack"),pv=ht("onclear"),mv=ht("idle"),gv=ht("up"),yv=ht("down"),_v=ht("left"),bv=ht("right"),wv=ht("by"),vv=ht("at"),Ev=ht("flow"),kv=ht("seek"),xv=ht("rndns"),Av=ht("rndne"),Tv=ht("rnd"),Sv=ht("cw"),Rv=ht("ccw"),Ov=ht("opp"),Iv=ht("rndp"),Nv=ht("away"),Cv=ht("toward"),Lv=ht("find"),Mv=ht("flee"),Uv=ht("to"),Pv=ht("i"),Fv=ht("u"),$v=ht("north"),Bv=ht("n"),Dv=ht("d"),jv=ht("south"),zv=ht("s"),Wv=ht("l"),Hv=ht("west"),Gv=ht("w"),Kv=ht("r"),Yv=ht("east"),qv=ht("e"),Vv=ht("over"),Xv=ht("under"),Jv=Qt({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:Ye}),Zv=ht("contact"),Qv=ht("blocked"),tE=ht("any"),eE=ht("countof"),rE=ht("abs"),nE=ht("intceil"),iE=ht("intfloor"),sE=ht("intround"),oE=ht("clamp"),aE=ht("min"),cE=ht("max"),lE=ht("pick"),uE=ht("pickwith"),fE=ht("random"),hE=ht("randomwith"),dE=ht("run"),pE=ht("runwith"),mE=Qt({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),gE=Qt({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:Ye}),yE=Qt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:Ye}),_E=Qt({name:"islessthan",pattern:/<|below/i,longer_alt:Ye}),bE=Qt({name:"isgreaterthan",pattern:/>|above/i,longer_alt:Ye}),wE=Qt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:Ye}),vE=Qt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:Ye}),ap=Qt({name:"or",pattern:/or/i,longer_alt:Ye}),cp=Qt({name:"not",pattern:/not/i,longer_alt:Ye}),lp=Qt({name:"and",pattern:/and/i,longer_alt:Ye}),up=Qt({name:"plus",pattern:/\+/}),fp=Qt({name:"minus",pattern:/-/}),EE=Qt({name:"power",pattern:/\*\*/}),kE=Qt({name:"multiply",pattern:/\*/}),hp=Qt({name:"divide",pattern:/\//}),xE=Qt({name:"moddivide",pattern:/%/}),AE=Qt({name:"floordivide",pattern:/%%/}),TE=Qt({name:"query",pattern:/\?/}),SE=Qt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),RE=Qt({name:"rparen",pattern:/\)/,pop_mode:!0}),OE=Qt({name:"command_play",pattern:/(play|bgplay|bgplayon64n|bgplayon32n|bgplayon16n|bgplayon8n|bgplayon4n|bgplayon2n|bgplayon1n) .*/i,start_chars_hint:nc,longer_alt:Ye}),IE=Qt({name:"command_toast",pattern:/toast .*/i,start_chars_hint:nc,longer_alt:Ye}),NE=Qt({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:nc,longer_alt:Ye}),dp=Qt({name:"if",pattern:/if|try|take|give/i,longer_alt:Ye}),Eu=Qt({name:"do",pattern:new RegExp("(?<!(zap |send |restore ))(?<=\\s)do","i"),start_chars_hint:["d"],longer_alt:Ye}),pp=ht("done"),mp=ht("else"),CE=ht("while"),LE=ht("repeat"),ME=ht("waitfor"),UE=Qt({name:"foreach",pattern:/foreach|for/i,longer_alt:Ye}),PE=ht("break"),FE=ht("continue");function $E(e,t){return[...e,yv,...t,op,fw,hw,dw,bw,_w,pw,vw,ww,mw,gw,yw,Ew,kw,xw,Aw,Tw,Sw,Rw,Ow,Iw,Nw,Cw,Lw,Mw,Uw,Pw,Fw,$w,Bw,Dw,jw,zw,Ww,Hw,Gw,Kw,Yw,qw,Vw,Xw,Jw,Zw,Qw,tv,ev,rv,nv,iv,sv,ov,av,cv,lv,uv,fv,hv,dv,pv,mv,gv,_v,bv,wv,vv,Ev,kv,Iv,xv,Av,Tv,Sv,Rv,Ov,Nv,Cv,Lv,Mv,Uv,$v,jv,Hv,Yv,Vv,Xv,Jv,Zv,Qv,tE,eE,rE,nE,iE,sE,oE,aE,cE,uE,lE,hE,fE,pE,dE,mE,gE,yE,wE,_E,vE,bE,ap,cp,lp,up,fp,EE,kE,hp,AE,xE,TE,SE,RE,Pv,Fv,Bv,Dv,zv,Wv,Gv,Kv,qv,vu,Ye]}const BE=$E([aw,ip,OE,IE,NE,Fo,cw,sp,lw,uw,wu,uF],[PE,FE,pp,Eu,mp,UE,dp,LE,ME,CE]),gF=new pr({defaultMode:"use_newlines",modes:{use_newlines:BE,ignore_newlines:$E([fF],[])}},{skipValidations:!ii,ensureOptimizations:ii,positionTracking:"full"});function DE(e){ow=!0;const t=gF.tokenize(e||` 
`),[r]=(pe(t.tokens)?t.tokens:[]).slice(-1);return r&&r.tokenType.name!=="Newline"&&t.tokens.push(cu(wu,`
`,r.startOffset,r.endOffset??NaN,r.startLine??NaN,r.endLine??NaN,r.startColumn??NaN,r.endColumn??NaN)),t}function yF(e,t,r=!0){if(r){const[n,...i]=t;switch(Dt(n??"")){default:return{type:Ut.OBJECT,values:t};case"loader":return{type:Ut.LOADER,values:i};case"board":return{type:Ut.BOARD,values:i};case"object":return{type:Ut.OBJECT,values:i};case"terrain":return{type:Ut.TERRAIN,values:i};case"charset":return{type:Ut.CHARSET,values:i};case"palette":return{type:Ut.PALETTE,values:i}}}else{const[n,i,...s]=t,o=Dt(i??""),a=[n,e,...s];switch(o){default:return{type:Ut.CONST,values:t};case"rn":case"range":return{type:Ut.RANGE,values:a};case"sl":case"select":return{type:Ut.SELECT,values:a};case"nm":case"number":return{type:Ut.NUMBER,values:a};case"tx":case"text":return{type:Ut.TEXT,values:a};case"hk":case"hotkey":return{type:Ut.HOTKEY,values:a};case"copyit":return{type:Ut.COPYIT,values:a};case"openit":return{type:Ut.OPENIT,values:a};case"zssedit":return{type:Ut.ZSSEDIT,values:a};case"charedit":return{type:Ut.CHAREDIT,values:a};case"coloredit":return{type:Ut.COLOREDIT,values:a}}}}function fn(e){switch(e){case Ut.LOADER:return"loader";case Ut.BOARD:return"board";case Ut.OBJECT:return"object";case Ut.TERRAIN:return"terrain";case Ut.CHARSET:return"charset";case Ut.PALETTE:return"palette";case Ut.CONST:return"const";case Ut.RANGE:return"range";case Ut.SELECT:return"select";case Ut.NUMBER:return"number";case Ut.TEXT:return"text";case Ut.HOTKEY:return"hotkey";case Ut.COPYIT:return"copyit";case Ut.OPENIT:return"openit";case Ut.VIEWIT:return"viewit";case Ut.ZSSEDIT:return"zssedit";case Ut.CHAREDIT:return"charedit";case Ut.COLOREDIT:return"coloredit"}}var gp=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(gp||{});function jE(e){return Oo(e,gp,{bits:t=>Array.from(t)})}function zE(e){return Ua(e,gp,{bits:t=>new Uint8Array(t)})}function ku(e,t){return{id:We(),code:e,...t}}var yp=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(yp||{});function _F(e){return Oo(e,yp,{board:t7,object:Il,terrain:Il,charset:jE,palette:jE,stats:Ne})}function bF(e){return Ua(e,yp,{board:e7,object:Nl,terrain:Nl,charset:zE,palette:zE})}function ic(e){const t={...Bs(e)};return Object.keys(t).forEach(r=>{switch(r){case"type":case"name":delete t[r];break}}),t}function wF(e){return w(e)?(e.stats=void 0,Bs(e)):{}}function _p(e){const t=DE(e),r={};let n=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===ip){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),u=a.split(" "),l=yF(yt(c)?c:"",u,n),h=l.values.join(" ");switch(n=!1,l.type){case Ut.LOADER:r.type=vt.LOADER,r.name=h;break;case Ut.BOARD:r.type=vt.BOARD,r.name=h;break;case Ut.OBJECT:r.type=vt.OBJECT,r.name=h||"object";break;case Ut.TERRAIN:r.type=vt.TERRAIN,r.name=h;break;case Ut.CHARSET:r.type=vt.CHARSET,r.name=h;break;case Ut.PALETTE:r.type=vt.PALETTE,r.name=h;break;case Ut.CONST:{const[d,...f]=l.values;if(yt(d)){const m=Dt(d),p=f.join(" ");if(yt(p)){const g=parseFloat(p);r[m]=Et(g)?g:p}else r[m]=1}break}case Ut.RANGE:case Ut.SELECT:case Ut.NUMBER:case Ut.TEXT:case Ut.HOTKEY:case Ut.ZSSEDIT:case Ut.CHAREDIT:case Ut.COLOREDIT:{const[d,...f]=l.values;if(yt(d)){const m=Dt(d);r[m]=[fn(l.type),...f]}break}}}}return r}function Bs(e){var t;return w(e)?(w((t=e.stats)==null?void 0:t.type)||(e.stats=_p(e.code),w(e.stats.type)||(e.stats.type=vt.OBJECT)),e.stats):{}}function WE(e){switch(e){default:case vt.ERROR:return"error";case vt.LOADER:return fn(Ut.LOADER);case vt.BOARD:return fn(Ut.BOARD);case vt.OBJECT:return fn(Ut.OBJECT);case vt.TERRAIN:return fn(Ut.TERRAIN);case vt.CHARSET:return fn(Ut.CHARSET);case vt.PALETTE:return fn(Ut.PALETTE)}}function mi(e){return Bs(e).type??vt.ERROR}function gi(e){return WE(mi(e))}function be(e){return Bs(e).name??""}function vF(e,t){return Bs(e)[t]}const xu=new Rh;function EF(e){if(!yt(e))return;const t=xa(e);if(w(t)&&w(zt[t]))return zt[t];const r=Dt(e),n=bt[r];if(w(n))return n}function Au(e,t){const r=Object.keys(e);for(let n=0;n<r.length;++n){const i=r[n],s=e[i];if(pe(s)){const[o,...a]=s;switch(o){case"text":w(t[i])||(t[i]="");break;case"range":w(t[i])||(t[i]=4);break;case"number":w(t[i])||(t[i]=0);break;case"select":if(!w(t[i])){const[,c]=a;t[i]=c}break}continue}switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"cycle":case"stepx":case"stepy":case"shootx":case"shooty":case"displaychar":t[i]=s;break;case"color":case"bg":case"lightdir":case"displaycolor":case"displaybg":t[i]=EF(s)??s;break;case"isitem":t.item=1;break;case"notitem":t.item=0;break;case"ispushable":t.pushable=s===""?1:s;break;case"notpushable":t.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Ht.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Ht.ISSWIM;break;case"issolid":t.collision=Ht.ISSOLID;break;case"isbullet":t.collision=Ht.ISBULLET;break;case"isghost":t.collision=Ht.ISGHOST;break;case"isbreakable":t.breakable=1;break;case"notbreakable":t.breakable=0;break}}}function Ce(e){var t;if(w(e))switch(mi(e)){default:return;case vt.ERROR:return e.code??"";case vt.LOADER:return e.code??"";case vt.BOARD:{w(e.board)||(e.board=Qu()),e.board.id=e.id;const r=ic(e);return r.isdark&&(e.board.isdark=1),r.notdark&&(e.board.isdark=0),Et(r.startx)&&(e.board.startx=r.startx),Et(r.starty)&&(e.board.starty=r.starty),yt(r.over)&&(Dt(r.over)==="empty"?e.board.over=void 0:e.board.over=r.over,e.board.overboard=void 0),yt(r.under)&&(Dt(r.under)==="empty"?e.board.under=void 0:e.board.under=r.under,e.board.underboard=void 0),yt(r.camera)&&(Dt(r.camera)==="empty"?e.board.camera=void 0:e.board.camera=r.camera),yt(r.graphics)&&(Dt(r.graphics)==="empty"?e.board.graphics=void 0:e.board.graphics=r.graphics),Et(r.facing)&&(e.board.facing=r.facing),yt(r.facing)&&Dt(r.facing)==="empty"&&(e.board.facing=void 0),yt(r.exitnorth)&&(e.board.exitnorth=r.exitnorth),yt(r.exitsouth)&&(e.board.exitsouth=r.exitsouth),yt(r.exitwest)&&(e.board.exitwest=r.exitwest),yt(r.exiteast)&&(e.board.exiteast=r.exiteast),Et(r.timelimit)&&(e.board.timelimit=r.timelimit),r.restartonzap&&(e.board.restartonzap=1),r.norestartonzap&&(e.board.restartonzap=0),Et(r.maxplayershots)&&(e.board.maxplayershots=r.maxplayershots),e.board}case vt.OBJECT:return w(e.object)||(e.object=M_()),e.object.id=e.id,e.object.code=e.code,e.object.name=be(e),e.object.category=jr.ISOBJECT,Au(ic(e),e.object),e.object;case vt.TERRAIN:return w(e.terrain)||(e.terrain=M_()),e.terrain.id=e.id,e.terrain.name=be(e),e.terrain.category=jr.ISTERRAIN,Au(ic(e),e.terrain),e.terrain;case vt.PALETTE:{if(w(e.palette)||(e.palette=P_(DC)),w((t=e.palette)==null?void 0:t.bits)){const r=ic(e),n=Dr(r);for(let i=0;i<n.length;++i){const s=n[i].toLowerCase(),o=r[s];if(s.startsWith("color")&&yt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){xu.set(o);const c=a*fl,u=xu.r*63,l=xu.g*63,h=xu.b*63;e.palette.bits[c+0]=Ge(u,0,63),e.palette.bits[c+1]=Ge(l,0,63),e.palette.bits[c+2]=Ge(h,0,63)}}}}return e.palette}case vt.CHARSET:return w(e.charset)||(e.charset=F_(BC)),e.charset}}function bp(e){return{id:We(),name:FA(),timestamp:0,activelist:[],pages:e,flags:{}}}var wp=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(wp||{});function kF(e){return Oo(e,wp,{pages:t=>t.map(_F),flags:t=>{const r=Object.keys(t);for(let n=0;n<r.length;++n){const i=r[n];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function HE(e){return Ua(e,wp,{pages:t=>t.map(bF)})}function GE(e){w(e)&&(e.token=`${$A()}${_n(1111,9999)}`)}function Ds(e,t){if(!w(e))return;const r=Dt(t);return e.pages.find(i=>i.id===t||r===be(i))}function or(e,t,r){if(!w(e))return;const n=Dt(r);return e.pages.find(s=>mi(s)===t&&(s.id===r||n===be(s)))}function vp(e,t,r){let n=or(e,t,r);if(!w(n)){const i=WE(t);return n=ku(i==="object"?`@${r||"object"}
`:`@${i} ${r}
`,{}),oc(e,n),[n,!0]}return[n,!1]}function js(e,t){return w(e)?e.pages.filter(r=>mi(r)===t):[]}function KE(e,t,r){if(!w(e))return[];const n=Dt(r);return e.pages.filter(s=>mi(s)===t).filter(s=>{const o=Bs(s),a=Dt(be(s));return s.id===r||n===a||w(o[r])})}function sc(e){return w(e)?Ln(e.pages).sort((r,n)=>{const i=mi(r),s=mi(n);return i===s?be(r).localeCompare(be(n)):s-i}):[]}function YE(e,t){if(w(t)){const r=or(e,vt.TERRAIN,t.kind??"");if(w(r))return r;const n=or(e,vt.OBJECT,t.kind??"");if(w(n))return n}}function oc(e,t){if(!w(e)||!w(t))return!1;const r=Ds(e,t.id);return w(r)?!1:(e.pages.push(t),GE(e),!0)}function qE(e,t){const r=Ds(e,t);if(w(e)&&w(r)){const n=Dt(t);return e.pages=e.pages.filter(i=>i.id!==t&&n!==be(i)),GE(e),r}}function mr(e,t=1,r=zt.WHITE,n=zt.BLACK){const i=e==null?void 0:e.kinddata;return{name:Dt((e==null?void 0:e.name)??(i==null?void 0:i.name)),char:(e==null?void 0:e.displaychar)??(i==null?void 0:i.displaychar)??(e==null?void 0:e.char)??(i==null?void 0:i.char)??t,color:(e==null?void 0:e.displaycolor)??(i==null?void 0:i.displaycolor)??(e==null?void 0:e.color)??(i==null?void 0:i.color)??r,bg:(e==null?void 0:e.displaybg)??(i==null?void 0:i.displaybg)??(e==null?void 0:e.bg)??(i==null?void 0:i.bg)??n,light:(e==null?void 0:e.light)??(i==null?void 0:i.light)??0}}function xF(e,t){return!!(e!=null&&e.flags[t])}function Ui(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function VE(e,t){e&&delete e.flags[t]}function XE(e,t,r){const n=Ui(e,t);return n==null?void 0:n[r]}function AF(e,t,r,n){const i=Ui(e,t);return i&&(i[r]=n),n}function gr(e){if(!w(e)||w(e.lookup)&&w(e.named))return;const t=new Array(Ct*Zt).fill(void 0),r={},n=Object.values(e.objects);for(let o=0;o<n.length;++o){const a=n[o];if(w(a.x)&&w(a.y)&&w(a.id)&&!w(a.removed)){a.category=jr.ISOBJECT,t[a.x+a.y*Ct]=a.id,yt(a.code)&&!w(a.name)&&Au(_p(a.code),a);const c=mr(a);r[c.name]||(r[c.name]=new Set),r[c.name].add(a.id)}}let i=0,s=0;for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];if(w(a)){a.x=i,a.y=s,a.category=jr.ISTERRAIN;const c=mr(Rn(a));r[c.name]||(r[c.name]=new Set),r[c.name].add(o)}++i,i>=Ct&&(i=0,++s)}e.lookup=t,e.named=r}function ac(e){w(e)&&(delete e.named,delete e.lookup,gr(e))}function Ep(e,t,r){var i;if(!w(e)||!w(e.named)||!w(t))return;const n=Dt(t.name??((i=t.kinddata)==null?void 0:i.name)??"");e.named[n]||(e.named[n]=new Set),e.named[n].add((t==null?void 0:t.id)??r??"")}function JE(e,t){if(!(!w(e)||!w(e.lookup)||!w(t==null?void 0:t.id))&&!w(t.removed)&&Yt(t,"collision")!==Ht.ISGHOST){const r=t.x??0,n=t.y??0;e.lookup[r+n*Ct]=t.id}}function TF(e,t){var r;if(w(e)&&w(t==null?void 0:t.x)&&w(t.y)){const n=mr(t),i=ji(e,t);w((r=e.named)==null?void 0:r[n.name])&&e.named[n.name].delete(i)}}function Tu(e,t){var r;if(w(e)&&w(t==null?void 0:t.id)){if(w(e.lookup)&&w(t.x)&&w(t.y)){const i=t.x+t.y*Ct;e.lookup[i]===t.id&&(e.lookup[i]=void 0)}const n=mr(t);w((r=e.named)==null?void 0:r[n.name])&&w(t.id)&&e.named[n.name].delete(t.id)}}function kp(e,t,r,n=!1){if(!w(e)||!w(e.lookup)||r.x<0||r.x>=Ct||r.y<0||r.y>=Zt)return;const i=r.x+r.y*Ct,s=Nr(e,e.lookup[i]??"404");if(w(s))return n&&Er(s.id)?void 0:s;const o=e.terrain[i];if(w(o)&&_c(t,Yt(o,"collision")))return o}function SF(e,t,r){const n=Nr(e,(t==null?void 0:t.id)??""),i=(n==null?void 0:n.x)??-1,s=(n==null?void 0:n.y)??-1;if(i-r.x===0&&s-r.y===0)return!0;const o=Yt(n,"collision");return w(kp(e,o,r))}function ZE(e,t,r){var h;const n=Nr(e,(t==null?void 0:t.id)??"");if(!w(e)||!w(n)||!w(n.x)||!w(n.y)||!w(e.lookup)||r.x<0||r.x>=Ct||r.y<0||r.y>=Zt)return{name:"edge",kind:"edge",collision:Ht.ISSOLID,x:r.x,y:r.y};if(n.x-r.x===0&&n.y-r.y===0)return;const i=ji(e,n),s=ji(e,r),o=Yt(n,"collision");if(o===Ht.ISGHOST)return;const a=Er(n==null?void 0:n.id),c=Nr(e,e.lookup[s]??"");if(Yt(c,"collision")===Ht.ISGHOST)return;const u=Er((c==null?void 0:c.id)??"");if(w(c)&&(!a||!u)){const d=Yt(n,"group"),f=Yt(c,"group");return(d||f)&&d!=f?{...c}:{...c}}const l=e.terrain[s];if(w(l)){const d=l.collision??((h=l==null?void 0:l.kinddata)==null?void 0:h.collision)??Ht.ISWALK;if(_c(o,d))return{...l,x:r.x,y:r.y}}n.x=r.x,n.y=r.y,w(n.removed)||(e.lookup[i]=void 0,e.lookup[s]=n.id??"")}function RF(e,t){const r=[];if(!w(e))return r;const n=Object.values(e.objects);for(let i=0;i<n.length;++i){const s=n[i];w(s.id)&&w(s.removed)&&t-s.removed>Rc*5&&(r.push(s.id),Kx(e,s.id))}return r}function OF(e,t){const r=[];if(!w(e))return r;e.lookup=void 0,gr(e);const n=Object.values(e.objects);for(let s=0;s<n.length;++s){const o=n[s];if(!w(o.id))continue;o.lx=o.x,o.ly=o.y;const a=Rn(o),c=`${(a==null?void 0:a.code)??""}
${o.code??""}`;if(c){if(o.removed){const u=t-o.removed,l=Yt(o,"cycle");if(u>l)continue}r.push({id:o.id,type:vt.OBJECT,code:c,object:o,terrain:void 0})}}const i=RF(e,t);for(let s=0;s<i.length;++s)r.push({id:i[s],type:vt.ERROR,code:"",object:void 0,terrain:void 0});return r}function QE(e,t,r){const n=[],i=[];if(!w(e))return{objectelements:n,terrainelements:i};function s(a,c){switch(r){case"all":return!0;case"self":return(a==null?void 0:a.id)===t;case"others":return(a==null?void 0:a.id)!==t;case"terrain":return c===!0;case"object":return c===!1}const u=Yt(a,r);return w(u)||mr(a).name===r||Yt(a,"group")===r}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&n.push(c)}for(let a=0;a<Lh;++a){const c=e.terrain[a];w(c)&&s(c,!0)&&i.push(c)}return{objectelements:n,terrainelements:i}}function tk(e,t,r,n){for(let i=r.y;i<=n.y;++i)for(let s=r.x;s<=n.x;++s){const o=oe(t,{x:s,y:i});De(o)&&wr(t,o,e.timestamp),Me(t,{x:s,y:i})}}function IF(e,t,r){for(let n=t.y;n<=r.y;++n)for(let i=t.x;i<=r.x;++i)Me(e,{x:i,y:n})}function ek(e,t,r,n){for(let i=r.y;i<=n.y;++i)for(let s=r.x;s<=n.x;++s){const o=oe(t,{x:s,y:i});De(o)&&wr(t,o,e.timestamp),Me(t,{x:s,y:i})}}function $o(e,t){w(e)&&(e.name=t.name,e.char=t.char,e.color=t.color,e.bg=t.bg,e.displaychar=t.displaychar,e.displaycolor=t.displaycolor,e.displaybg=t.displaybg,e.p1=t.p1,e.p2=t.p2,e.p3=t.p3,e.p4=t.p4,e.p5=t.p5,e.p6=t.p6,e.code=t.code,e.item=t.item,e.group=t.group,e.party=t.party,e.cycle=t.cycle,e.light=t.light,e.lightdir=t.lightdir,e.stepx=t.stepx,e.stepy=t.stepy,e.shootx=t.shootx,e.shooty=t.shooty,e.pushable=t.pushable,e.collision=t.collision,e.breakable=t.breakable,e.tickertext=t.tickertext,e.tickertime=t.tickertime)}function Su(e,t,r,n,i){switch(i){case"all":case"object":case"terrain":break;default:return NF(e,t,r,"",i)}if(!w(k.book))return;const s=k.book,o=or(s,vt.BOARD,e),a=Ce(o);if(!w(a))return;const c=or(s,vt.BOARD,t),u=Ce(c);if(!w(u))return;gr(a),gr(u);let l=!1;if(w(a)&&w(u)){switch(i){case"all":tk(s,u,r,n);break;case"object":ek(s,u,r,n);break;case"terrain":IF(u,r,n);break;default:l=!0;break}for(let h=r.y;h<=n.y;++h)for(let d=r.x;d<=n.x;++d){let f=!1,m=!1;switch(i){case"all":f=!0,m=!0;break;case"object":f=!0;break;case"terrain":m=!0;break}const p={x:d,y:h};let g,y=oe(a,p);if(De(y)?(g=us(a,d,h),Er(y==null?void 0:y.id)&&(y=void 0)):(g=y,y=void 0),w(g)&&(m||l&&Yt(g,"group")===i)){l&&tk(s,u,p,p);const b=On(u,[g.kind??""],p);$o(b,g)}if(w(y)&&(f||l&&Yt(y,"group")===i)){l&&ek(s,u,p,p);const b=On(u,[y.kind??""],p);$o(b,y)}}ac(u)}}function NF(e,t,r,n,i){if(!w(k.book))return;const s=k.book,o=or(s,vt.BOARD,e),a=Ce(o);if(!w(a))return;const c=or(s,vt.BOARD,t),u=Ce(c);if(w(u)&&(gr(a),gr(u),w(a)&&w(u))){const{terrainelements:l,objectelements:h}=QE(a,n,i);if(l.length===0&&h.length===0)return;const d={x:Ct,y:Zt};for(let f=0;f<l.length;++f){const m=l[f];Et(m.x)&&(d.x=Math.min(d.x,m.x)),Et(m.y)&&(d.y=Math.min(d.y,m.y))}for(let f=0;f<h.length;++f){const m=h[f];Et(m.x)&&(d.x=Math.min(d.x,m.x)),Et(m.y)&&(d.y=Math.min(d.y,m.y))}for(let f=0;f<l.length;++f){const m=l[f],p={x:r.x+(m.x??0)-d.x,y:r.y+(m.y??0)-d.y},g=oe(u,p);w(g)&&(De(g)&&wr(u,g,s.timestamp),Me(u,p));const y=On(u,[m.kind??""],p);$o(y,m)}for(let f=0;f<h.length;++f){const m=h[f],p={x:r.x+(m.x??0)-d.x,y:r.y+(m.y??0)-d.y},g=On(u,[m.kind??""],p);$o(g,m)}ac(u)}}function CF(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function Ru(e,t,r){if(!w(e))return;AF(e,t,"board",r);const n=br(r);w(n)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function Bo(e,t,r,n,i=!1){const s=qe(t);if(!w(e)||!w(s))return;const o=Nr(s,t);if(!De(o)||!(o!=null&&o.id))return;const a=br(r);if(!w(a))return;gr(a);const c=kp(a,Ht.ISWALK,n,!0);if(i===!1&&w(c))if(Yt(c,"item"))Ve(t,o,c,"touch");else return;Tu(s,o),delete s.objects[o.id],o.x=n.x,o.y=n.y,a.objects[o.id]=o,Ep(a,o),JE(a,o),Ru(e,t,a.id)}function LF(e){const r=((e==null?void 0:e.activelist)??[]).map(n=>{const i=XE(e,n,"board");return yt(i)?i:""});return fI(r)}function Do(e){const t=LF(e),r=new Set,n=[];for(let i=0;i<t.length;++i){const s=br(t[i]);if(w(s)&&!r.has(s.id)){if(yt(s.over))if(yt(s.overboard)){const o=br(s.overboard);w(o)?r.has(o.id)||n.push(o):delete s.overboard}else{const o=br(s.over);w(o)&&(s.overboard=o.id)}else yt(s.overboard)&&delete s.overboard;if(n.push(s),yt(s.under))if(yt(s.underboard)){const o=br(s.underboard);w(o)||delete s.underboard}else{const o=br(s.under);w(o)&&(s.underboard=o.id)}else yt(s.underboard)&&delete s.underboard}}return n}const MF=dy(32,126).map(e=>String.fromCharCode(e)),UF=un({name:"Whitespace",pattern:/ +/}),PF=un({name:"WhitespaceSkipped",pattern:/ +/,group:pr.SKIPPED}),xp=un({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),rk=un({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:MF}),Ap=un({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Tp=un({name:"EscapedDollar",pattern:"$$"}),Sp=un({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Rp=un({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),nk=un({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function FF(e,t=""){return un({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const ik=Object.keys(ka).map(e=>FF(`\\$(${e})`,e)),$F=[UF,xp,...ik,Ap,rk,Rp,Tp,nk,Sp],BF=new pr($F,{skipValidations:!ii,ensureOptimizations:ii}),DF=new pr([PF,xp,...ik,Ap,rk,Rp,Tp,nk,Sp],{skipValidations:!ii,ensureOptimizations:ii}),sk=/\$CENTER/i;function jF(e){if(sk.test(e))return e.replace(sk,"")}function Op(e,t=!1){return t?DF.tokenize(e):BF.tokenize(e)}function Ip(e,t,r,n,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:r,bg:n,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:r,bg:n,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function ok(e){e.active={...e.reset}}function ak(e,t){const r=t.y;function n(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}n()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case Tp:s("$");break;case Rp:if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}n();break;case Ap:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case xp:{t.x=t.active.leftedge??0,++t.y;break}default:{const u=c.tokenType.name,l=ka[u],h=dI(zt[l]),d=Nh(zt[l]);l==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):w(h)?t.active.color=h:w(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(w(t.writefullwidth)&&(t.x>o||t.y===r)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){ok(t);const u=String.fromCharCode(t.writefullwidth).repeat(c),l=t.x+t.y*t.width;WF(l,l+u.length,t.active.color,t.active.bg,t),zF(l,u,t)}}}function ck(e,t,r){const n=Op(e);n.tokens&&(ak(n.tokens,t),r&&ok(t),t.changed())}function lk(e,t,r){const n=Op(e);if(!n.tokens)return;const i=Ip(t,r,zt.WHITE,zt.BLACK);return i.measureonly=!0,ak(n.tokens,i),i.x>0&&++i.y,i}function zF(e,t,r){let n=0;const i=e+t.length;for(let s=e;s<i;++s)r.char[s]=t.charCodeAt(n++);r.changed()}function WF(e,t,r,n,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=r,i.bg[a]=n;i.changed()}function Ou(e,t,r){var a;if(!w((a=k.element)==null?void 0:a.x)||!w(k.element.y))return 0;const[n,i]=ut(t,0,[q.DIR,q.MAYBE_KIND]);k.element.shootx=Ge(n.destpt.x-n.startpt.x,-1,1),k.element.shooty=Ge(n.destpt.y-n.startpt.y,-1,1);const s=i??["bullet"],o=Pz(k.board,s,{x:k.element.x,y:k.element.y});if(w(o)){w(r)&&(o.arg=r),o.cycle=1,o.party=k.elementid,o.collision=Ht.ISBULLET,o.breakable=1,o.stepx=n.destpt.x-k.element.x,o.stepy=n.destpt.y-k.element.y,o.bg=zt.ONCLEAR;const c=Rn(o),u=o.code??(c==null?void 0:c.code)??"";Px(k.book,k.board,o,u)}return e.yield(),0}function Iu(e,t,r){var i,s;if(!Ea(k.element)||!w(k.book)||!w(k.board)||!w(k.element))return 0;const[n]=ut(k.words,0,[q.ANY]);if(Hr(n)){const[o,a]=ut(e,0,[q.DIR,q.KIND]),{destpt:c}=o;if(c.x<0||c.x>=Ct||c.y<0||c.y>=Zt)return 0;const[u]=a,l={x:((i=k.element)==null?void 0:i.x)??0,y:((s=k.element)==null?void 0:s.y)??0},h=Rn({kind:u}),d=Yt(h,"collision");if(d===Ht.ISGHOST)return On(k.board,a,o.destpt,t),0;let f=oe(k.board,o.destpt);if(Yt(f,"pushable")){const p=Ln(o.destpt),g=Be(p,Bn(l,p));Yn(k.book,k.board,f,g),f=oe(k.board,o.destpt)}if(u==="empty")return wr(k.board,f,k.timestamp),0;if(De(f)&&wr(k.board,f,k.timestamp),De(h)||On(k.board,a,o.destpt,t),De(h)){const p=kp(k.board,d,o.destpt);if(!w(p)){const g=On(k.board,a,o.destpt,t);w(g)&&w(r)&&(g.arg=r)}}else{const[p,g]=ut(e,0,[q.ANY,q.KIND])}}return 0}function HF(e,t,r){if(!w(k.book)||!w(k.board))return 0;const[n,i]=ut(t,0,[q.DIR,q.DIR]),s=oe(k.board,n.destpt);return De(s),0}const GF={x:0,y:0},KF={x:Ct-1,y:Zt-1},YF="all",qF=Si().command("build",(e,t)=>{if(!w(k.book)||!w(k.board)||!w(k.element))return 0;const[r,n]=ut(t,0,[q.NAME,q.MAYBE_STRING]),i=Qu();if(w(i)){if(yt(n)){const s=br(n);w(s)&&Su(s.id,i.id,GF,KF,YF)}e.set(r,i.id)}return 0}).command("goto",(e,t)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ut(t,0,[q.STRING]),[i,s]=ut(t,n,[q.MAYBE_NUMBER,q.MAYBE_NUMBER]),o=br(r);if(!w(o))return 0;const a={x:i??o.startx??Math.round(Ct*.5),y:s??o.starty??Math.round(Zt*.5)},c=mr(k.element);if(c.name!=="player"){const u=Yt(k.element,"color"),l=Yt(k.element,"bg"),h=Aa(u,l),d=Zu(o,[c.name,h]),[f]=d.sort((m,p)=>{const g=m.y??1e4,y=p.y??1e4,b=g-y;if(b!==0)return b;const T=m.x??1e4,A=p.x??1e4;return T-A});w(f)&&Et(f.x)&&Et(f.y)&&(a.x=f.x,a.y=f.y)}return Bo(k.book,k.elementfocus,o.id,a,!0),0}).command("transport",(e,t)=>{var i;if(!w(k.book)||!w(k.board)||!w(k.element))return 0;const[r]=ut(t,0,[q.STRING]),n=Nr(k.board,r);if(w((i=k.element)==null?void 0:i.x)&&w(k.element.y)&&w(n==null?void 0:n.x)&&w(n.y)){let s=!0;const o={x:k.element.x,y:k.element.y},a=o.x-n.x,c=o.y-n.y;if(Yt(k.element,"shootx")!==a||Yt(k.element,"shooty")!==c)return 0;for(;s&&(o.x+=a,o.y+=c,!(o.x<0&&o.x>=Ct&&o.y<0&&o.y>=Zt));){const u=oe(k.board,o);(u==null?void 0:u.kind)===k.element.kind&&Yt(u,"shootx")===-a&&Yt(u,"shooty")===-c&&Yn(k.book,k.board,n,{x:o.x+a,y:o.y+c})&&(s=!1)}}return 0}).command("shove",(e,t)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ut(t,0,[q.DIR,q.DIR]),i=oe(k.board,r.destpt);return De(i)&&Yn(k.book,k.board,i,n.destpt),0}).command("duplicate",HF).command("write",(e,t)=>{var d;if(!w(k.book)||!w(k.board))return 0;const[r,n,i]=ut(t,0,[q.DIR,q.COLOR]),s=t.slice(i).map(Ie).join(" "),{color:o,bg:a}=wy(n),c=((d=lk(s,256,1))==null?void 0:d.measuredwidth)??1,u=Ip(256,1,o??zt.WHITE,a??zt.BLACK);ck(s,u,!1);const l=c-1;switch(Bn(r.startpt,r.destpt)){case bt.EAST:for(let f=0;f<c;++f)Me(k.board,{x:r.destpt.x+f,y:r.destpt.y,name:"text",char:u.char[f],color:u.color[f],bg:u.bg[f]});break;case bt.WEST:for(let f=0;f<c;++f)Me(k.board,{x:r.destpt.x+f-l,y:r.destpt.y,name:"text",char:u.char[f],color:u.color[f],bg:u.bg[f]});break;case bt.NORTH:for(let f=0;f<c;++f)Me(k.board,{x:r.destpt.x,y:r.destpt.y+f-l,name:"text",char:u.char[f],color:u.color[f],bg:u.bg[f]});break;case bt.SOUTH:for(let f=0;f<c;++f)Me(k.board,{x:r.destpt.x,y:r.destpt.y+f,name:"text",char:u.char[f],color:u.color[f],bg:u.bg[f]});break}return 0}).command("change",(e,t)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ut(t,0,[q.KIND,q.KIND]);(yc(r)??"")==="empty"&&Jz(k.board).forEach(c=>{On(k.board,n,c)});const s=yc(n),o=Ju(n),a=$x(n);return Zu(k.board,r).forEach(c=>{if(w(o)&&(c.color=o),w(a)&&(c.bg=a),mr(c).name!==s){const l=Yt(c,"color"),h=Yt(c,"bg");if(wr(k.board,c,k.timestamp),s!=="empty"){const d={x:c.x??0,y:c.y??0},f=On(k.board,n,d);w(f)&&(f.color=l,f.bg=h)}}}),0}).command("put",(e,t)=>Iu(t)).command("putwith",(e,t)=>{const[r,n]=ut(t,0,[q.ANY]);return Iu(t.slice(n),void 0,r)}).command("oneof",(e,t)=>{const[r,n]=ut(t,0,[q.ANY]);return w(k.board)&&Nr(k.board,r)?0:Iu(t.slice(n),r)}).command("oneofwith",(e,t)=>{const[r,n,i]=ut(t,0,[q.ANY,q.ANY]);return w(k.board)&&Nr(k.board,n)?0:Iu(t.slice(i),n,r)}).command("shoot",Ou).command("shootwith",(e,t)=>{const[r,n]=ut(t,0,[q.ANY]);return Ou(e,t.slice(n),r)}).command("throwstar",(e,t)=>Ou(e,[...t,"star"])).command("throwstarwith",(e,t)=>{const[r,n]=ut(t,0,[q.ANY]);return Ou(e,[...t.slice(n),"star"],r)});var zs=(e=>(e[e.Border=-1]="Border",e[e.Data=0]="Data",e[e.Function=1]="Function",e[e.Position=2]="Position",e[e.Timing=3]="Timing",e[e.Alignment=4]="Alignment",e))(zs||{}),VF=Object.defineProperty,XF=(e,t,r)=>t in e?VF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Nu=(e,t,r)=>(XF(e,typeof t!="symbol"?t+"":t,r),r);const JF=[0,1],uk=[1,0],fk=[2,3],hk=[3,2],ZF={L:JF,M:uk,Q:fk,H:hk},QF=/^[0-9]*$/,t$=/^[A-Z0-9 $%*+.\/:-]*$/,Np="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Cp=1,Lp=40,dk=3,e$=3,Cu=40,r$=10,pk=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],mk=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class n${constructor(t,r,n,i){if(this.version=t,this.ecc=r,Nu(this,"size"),Nu(this,"mask"),Nu(this,"modules",[]),Nu(this,"types",[]),t<Cp||t>Lp)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=t*4+17;const s=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const o=this.addEccAndInterleave(n);if(this.drawCodewords(o),i===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const u=this.getPenaltyScore();u<a&&(i=c,a=u),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(t,r){return t>=0&&t<this.size&&r>=0&&r<this.size&&this.modules[r][t]}drawFunctionPatterns(){for(let n=0;n<this.size;n++)this.setFunctionModule(6,n,n%2===0,zs.Timing),this.setFunctionModule(n,6,n%2===0,zs.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const t=this.getAlignmentPatternPositions(),r=t.length;for(let n=0;n<r;n++)for(let i=0;i<r;i++)n===0&&i===0||n===0&&i===r-1||n===r-1&&i===0||this.drawAlignmentPattern(t[n],t[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(t){const r=this.ecc[1]<<3|t;let n=r;for(let s=0;s<10;s++)n=n<<1^(n>>>9)*1335;const i=(r<<10|n)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,Fi(i,s));this.setFunctionModule(8,7,Fi(i,6)),this.setFunctionModule(8,8,Fi(i,7)),this.setFunctionModule(7,8,Fi(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,Fi(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,Fi(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,Fi(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let t=this.version;for(let n=0;n<12;n++)t=t<<1^(t>>>11)*7973;const r=this.version<<12|t;for(let n=0;n<18;n++){const i=Fi(r,n),s=this.size-11+n%3,o=Math.floor(n/3);this.setFunctionModule(s,o,i),this.setFunctionModule(o,s,i)}}drawFinderPattern(t,r){for(let n=-4;n<=4;n++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(n)),o=t+i,a=r+n;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,s!==2&&s!==4,zs.Position)}}drawAlignmentPattern(t,r){for(let n=-2;n<=2;n++)for(let i=-2;i<=2;i++)this.setFunctionModule(t+i,r+n,Math.max(Math.abs(i),Math.abs(n))!==1,zs.Alignment)}setFunctionModule(t,r,n,i=zs.Function){this.modules[r][t]=n,this.types[r][t]=i}addEccAndInterleave(t){const r=this.version,n=this.ecc;if(t.length!==Lu(r,n))throw new RangeError("Invalid argument");const i=mk[n[0]][r],s=pk[n[0]][r],o=Math.floor(Up(r)/8),a=i-o%i,c=Math.floor(o/i),u=[],l=h$(s);for(let d=0,f=0;d<i;d++){const m=t.slice(f,f+c-s+(d<a?0:1));f+=m.length;const p=d$(m,l);d<a&&m.push(0),u.push(m.concat(p))}const h=[];for(let d=0;d<u[0].length;d++)u.forEach((f,m)=>{(d!==c-s||m>=a)&&h.push(f[d])});return h}drawCodewords(t){if(t.length!==Math.floor(Up(this.version)/8))throw new RangeError("Invalid argument");let r=0;for(let n=this.size-1;n>=1;n-=2){n===6&&(n=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const o=n-s,c=(n+1&2)===0?this.size-1-i:i;!this.types[c][o]&&r<t.length*8&&(this.modules[c][o]=Fi(t[r>>>3],7-(r&7)),r++)}}}applyMask(t){if(t<0||t>7)throw new RangeError("Mask value out of range");for(let r=0;r<this.size;r++)for(let n=0;n<this.size;n++){let i;switch(t){case 0:i=(n+r)%2===0;break;case 1:i=r%2===0;break;case 2:i=n%3===0;break;case 3:i=(n+r)%3===0;break;case 4:i=(Math.floor(n/3)+Math.floor(r/2))%2===0;break;case 5:i=n*r%2+n*r%3===0;break;case 6:i=(n*r%2+n*r%3)%2===0;break;case 7:i=((n+r)%2+n*r%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[r][n]&&i&&(this.modules[r][n]=!this.modules[r][n])}}getPenaltyScore(){let t=0;for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let u=0;u<this.size;u++)this.modules[s][u]===o?(a++,a===5?t+=dk:a>5&&t++):(this.finderPenaltyAddHistory(a,c),o||(t+=this.finderPenaltyCountPatterns(c)*Cu),o=this.modules[s][u],a=1);t+=this.finderPenaltyTerminateAndCount(o,a,c)*Cu}for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let u=0;u<this.size;u++)this.modules[u][s]===o?(a++,a===5?t+=dk:a>5&&t++):(this.finderPenaltyAddHistory(a,c),o||(t+=this.finderPenaltyCountPatterns(c)*Cu),o=this.modules[u][s],a=1);t+=this.finderPenaltyTerminateAndCount(o,a,c)*Cu}for(let s=0;s<this.size-1;s++)for(let o=0;o<this.size-1;o++){const a=this.modules[s][o];a===this.modules[s][o+1]&&a===this.modules[s+1][o]&&a===this.modules[s+1][o+1]&&(t+=e$)}let r=0;for(const s of this.modules)r=s.reduce((o,a)=>o+(a?1:0),r);const n=this.size*this.size,i=Math.ceil(Math.abs(r*20-n*10)/n)-1;return t+=i*r$,t}getAlignmentPatternPositions(){if(this.version===1)return[];{const t=Math.floor(this.version/7)+2,r=this.version===32?26:Math.ceil((this.version*4+4)/(t*2-2))*2,n=[6];for(let i=this.size-7;n.length<t;i-=r)n.splice(1,0,i);return n}}finderPenaltyCountPatterns(t){const r=t[1],n=r>0&&t[2]===r&&t[3]===r*3&&t[4]===r&&t[5]===r;return(n&&t[0]>=r*4&&t[6]>=r?1:0)+(n&&t[6]>=r*4&&t[0]>=r?1:0)}finderPenaltyTerminateAndCount(t,r,n){return t&&(this.finderPenaltyAddHistory(r,n),r=0),r+=this.size,this.finderPenaltyAddHistory(r,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(t,r){r[0]===0&&(t+=this.size),r.pop(),r.unshift(t)}}function Pi(e,t,r){if(t<0||t>31||e>>>t)throw new RangeError("Value out of range");for(let n=t-1;n>=0;n--)r.push(e>>>n&1)}function Fi(e,t){return(e>>>t&1)!==0}class Mp{constructor(t,r,n){if(this.mode=t,this.numChars=r,this.bitData=n,r<0)throw new RangeError("Invalid argument");this.bitData=n.slice()}getData(){return this.bitData.slice()}}const i$=[1,10,12,14],s$=[2,9,11,13],o$=[4,8,16,16];function gk(e,t){return e[Math.floor((t+7)/17)+1]}function yk(e){const t=[];for(const r of e)Pi(r,8,t);return new Mp(o$,e.length,t)}function a$(e){if(!_k(e))throw new RangeError("String contains non-numeric characters");const t=[];for(let r=0;r<e.length;){const n=Math.min(e.length-r,3);Pi(Number.parseInt(e.substring(r,r+n),10),n*3+1,t),r+=n}return new Mp(i$,e.length,t)}function c$(e){if(!bk(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");const t=[];let r;for(r=0;r+2<=e.length;r+=2){let n=Np.indexOf(e.charAt(r))*45;n+=Np.indexOf(e.charAt(r+1)),Pi(n,11,t)}return r<e.length&&Pi(Np.indexOf(e.charAt(r)),6,t),new Mp(s$,e.length,t)}function l$(e){return e===""?[]:_k(e)?[a$(e)]:bk(e)?[c$(e)]:[yk(f$(e))]}function _k(e){return QF.test(e)}function bk(e){return t$.test(e)}function u$(e,t){let r=0;for(const n of e){const i=gk(n.mode,t);if(n.numChars>=1<<i)return Number.POSITIVE_INFINITY;r+=4+i+n.bitData.length}return r}function f$(e){e=encodeURI(e);const t=[];for(let r=0;r<e.length;r++)e.charAt(r)!=="%"?t.push(e.charCodeAt(r)):(t.push(Number.parseInt(e.substring(r+1,r+3),16)),r+=2);return t}function Up(e){if(e<Cp||e>Lp)throw new RangeError("Version number out of range");let t=(16*e+128)*e+64;if(e>=2){const r=Math.floor(e/7)+2;t-=(25*r-10)*r-55,e>=7&&(t-=36)}return t}function Lu(e,t){return Math.floor(Up(e)/8)-pk[t[0]][e]*mk[t[0]][e]}function h$(e){if(e<1||e>255)throw new RangeError("Degree out of range");const t=[];for(let n=0;n<e-1;n++)t.push(0);t.push(1);let r=1;for(let n=0;n<e;n++){for(let i=0;i<t.length;i++)t[i]=Pp(t[i],r),i+1<t.length&&(t[i]^=t[i+1]);r=Pp(r,2)}return t}function d$(e,t){const r=t.map(n=>0);for(const n of e){const i=n^r.shift();r.push(0),t.forEach((s,o)=>r[o]^=Pp(s,i))}return r}function Pp(e,t){if(e>>>8||t>>>8)throw new RangeError("Byte out of range");let r=0;for(let n=7;n>=0;n--)r=r<<1^(r>>>7)*285,r^=(t>>>n&1)*e;return r}function p$(e,t,r=1,n=40,i=-1,s=!0){if(!(Cp<=r&&r<=n&&n<=Lp)||i<-1||i>7)throw new RangeError("Invalid value");let o,a;for(o=r;;o++){const h=Lu(o,t)*8,d=u$(e,o);if(d<=h){a=d;break}if(o>=n)throw new RangeError("Data too long")}for(const h of[uk,fk,hk])s&&a<=Lu(o,h)*8&&(t=h);const c=[];for(const h of e){Pi(h.mode[0],4,c),Pi(h.numChars,gk(h.mode,o),c);for(const d of h.getData())c.push(d)}const u=Lu(o,t)*8;Pi(0,Math.min(4,u-c.length),c),Pi(0,(8-c.length%8)%8,c);for(let h=236;c.length<u;h^=253)Pi(h,8,c);const l=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((h,d)=>l[d>>>3]|=h<<7-(d&7)),new n$(o,t,l,i)}function m$(e,t){var h;const{ecc:r="L",boostEcc:n=!1,minVersion:i=1,maxVersion:s=40,maskPattern:o=-1,border:a=1}=t||{},c=typeof e=="string"?l$(e):Array.isArray(e)?[yk(e)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof e}`);const u=p$(c,ZF[r],i,s,o,n),l=g$({version:u.version,maskPattern:u.mask,size:u.size,data:u.modules,types:u.types},a);return t!=null&&t.invert&&(l.data=l.data.map(d=>d.map(f=>!f))),(h=t==null?void 0:t.onEncoded)==null||h.call(t,l),l}function g$(e,t=1){if(!t)return e;const{size:r}=e,n=r+t*2;e.size=n,e.data.forEach(s=>{for(let o=0;o<t;o++)s.unshift(!1),s.push(!1)});for(let s=0;s<t;s++)e.data.unshift(Array.from({length:n},o=>!1)),e.data.push(Array.from({length:n},o=>!1));const i=zs.Border;e.types.forEach(s=>{for(let o=0;o<t;o++)s.unshift(i),s.push(i)});for(let s=0;s<t;s++)e.types.unshift(Array.from({length:n},o=>i)),e.types.push(Array.from({length:n},o=>i));return e}function y$(e,t,r,n=!1){return t<0||r<0||t>=e.length||r>=e.length?n:e[r][t]}function _$(e,t={}){const r={WHITE_ALL:"█",WHITE_BLACK:"▀",BLACK_WHITE:"▄",BLACK_ALL:" "},n=m$(e,t),i=!1,s=!0,o=(u,l)=>y$(n.data,u,l,!0),a=[];let c="";for(let u=0;u<n.size;u+=2){for(let l=0;l<n.size;l++)o(l,u)===i&&o(l,u+1)===i?c+=r.WHITE_ALL:o(l,u)===i&&o(l,u+1)===s?c+=r.WHITE_BLACK:o(l,u)===s&&o(l,u+1)===i?c+=r.BLACK_WHITE:c+=r.BLACK_ALL;a.push(c),c=""}return a.join(`
`)}const ns="$dkpurple",b$="$196",w$="$205",Je="$yellow$205$205$205$196";function we(e,t,r){cT(e,t,r)}function v$(e,t,r){const n=b$.repeat(r);we(e,t,`${ns}${n}`)}function Fp(e,t,r){const n=w$.repeat(r);we(e,t,`${ns}${n}`)}function $p(e,t,r){we(e,t,`${ns} ${" ".repeat(r.length)} `),v$(e,t,r.length+2),we(e,t,`${ns} $white${r} `),Fp(e,t,r.length+2)}function Ws(e,t,r){we(e,t,`${ns} ${" ".repeat(r.length)} `),we(e,t,`${ns} $gray${r} `),Fp(e,t,r.length+2)}function Hs(e,t,r,n){we(e,t,`${ns} $white${r} $blue${n}`)}function jo(e,t,r){we(e,t,`${ns}$blue${r}`)}function E$(e,t,r,n){we(e,t,`!${r};${n}`)}function k$(e,t,r,n,i=!0){if(i){const s=_$(r).split(`
`),o={32:32,9600:223,9604:220,9608:219};for(let a=0;a<s.length;a++){const c=[...s[a]].map(u=>`$${o[u.charCodeAt(0)]}`).join("");we(e,t,c)}}we(e,t,`!copyit ${r};${n}`),zT(e,t)}var x$=`desc;$DKGRAYname and type of codepage
`,A$=Object.freeze({__proto__:null,default:x$}),T$="desc;changes object into specified element",S$=Object.freeze({__proto__:null,default:T$}),R$="desc;like #play but for sound effects",O$=Object.freeze({__proto__:null,default:R$}),I$="",N$=Object.freeze({__proto__:null,default:I$}),C$="",L$=Object.freeze({__proto__:null,default:C$}),M$="",U$=Object.freeze({__proto__:null,default:M$}),P$="",F$=Object.freeze({__proto__:null,default:P$}),$$="",B$=Object.freeze({__proto__:null,default:$$}),D$="",j$=Object.freeze({__proto__:null,default:D$}),z$="",W$=Object.freeze({__proto__:null,default:z$}),H$="",G$=Object.freeze({__proto__:null,default:H$}),K$="",Y$=Object.freeze({__proto__:null,default:K$}),q$="",V$=Object.freeze({__proto__:null,default:q$}),X$="",J$=Object.freeze({__proto__:null,default:X$}),Z$="",Q$=Object.freeze({__proto__:null,default:Z$}),tB="",eB=Object.freeze({__proto__:null,default:tB}),rB="",nB=Object.freeze({__proto__:null,default:rB}),iB="",sB=Object.freeze({__proto__:null,default:iB}),oB=`desc;$DKGRAYstarts a section of an if-do-done block
`,aB=Object.freeze({__proto__:null,default:oB}),cB=`desc;$DKGRAYcompletes an if-do-done block
`,lB=Object.freeze({__proto__:null,default:cB}),uB="",fB=Object.freeze({__proto__:null,default:uB}),hB="",dB=Object.freeze({__proto__:null,default:hB}),pB="",mB=Object.freeze({__proto__:null,default:pB}),gB=`desc;$DKGRAYelse logic in an if-do-done block
`,yB=Object.freeze({__proto__:null,default:gB}),_B=`desc;$DKGRAYconditional else logic in an if-do-done block
`,bB=Object.freeze({__proto__:null,default:_B}),wB="",vB=Object.freeze({__proto__:null,default:wB}),EB="",kB=Object.freeze({__proto__:null,default:EB}),xB="",AB=Object.freeze({__proto__:null,default:xB}),TB="",SB=Object.freeze({__proto__:null,default:TB}),RB="",OB=Object.freeze({__proto__:null,default:RB}),IB="",NB=Object.freeze({__proto__:null,default:IB}),CB="",LB=Object.freeze({__proto__:null,default:CB}),MB="",UB=Object.freeze({__proto__:null,default:MB}),PB=`desc;$DKGRAYhalt until the next cycle
`,FB=Object.freeze({__proto__:null,default:PB}),$B=`desc;$DKGRAYevals condition for true or false
`,BB=Object.freeze({__proto__:null,default:$B}),DB="",jB=Object.freeze({__proto__:null,default:DB}),zB="",WB=Object.freeze({__proto__:null,default:zB}),HB="",GB=Object.freeze({__proto__:null,default:HB}),KB="",YB=Object.freeze({__proto__:null,default:KB}),qB="",VB=Object.freeze({__proto__:null,default:qB}),XB="",JB=Object.freeze({__proto__:null,default:XB}),ZB="",QB=Object.freeze({__proto__:null,default:ZB}),tD="",eD=Object.freeze({__proto__:null,default:tD}),rD="",nD=Object.freeze({__proto__:null,default:rD}),iD="",sD=Object.freeze({__proto__:null,default:iD}),oD="",aD=Object.freeze({__proto__:null,default:oD}),cD="",lD=Object.freeze({__proto__:null,default:cD}),uD="",fD=Object.freeze({__proto__:null,default:uD}),hD="",dD=Object.freeze({__proto__:null,default:hD}),pD="",mD=Object.freeze({__proto__:null,default:pD}),gD="",yD=Object.freeze({__proto__:null,default:gD}),_D="",bD=Object.freeze({__proto__:null,default:_D}),wD="",vD=Object.freeze({__proto__:null,default:wD}),ED="",kD=Object.freeze({__proto__:null,default:ED}),xD="",AD=Object.freeze({__proto__:null,default:xD}),TD="",SD=Object.freeze({__proto__:null,default:TD}),RD=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,OD=Object.freeze({__proto__:null,default:RD}),ID="",ND=Object.freeze({__proto__:null,default:ID}),CD="",LD=Object.freeze({__proto__:null,default:CD}),MD="",UD=Object.freeze({__proto__:null,default:MD}),PD="",FD=Object.freeze({__proto__:null,default:PD}),$D="",BD=Object.freeze({__proto__:null,default:$D}),DD="",jD=Object.freeze({__proto__:null,default:DD}),zD="",WD=Object.freeze({__proto__:null,default:zD}),HD="",GD=Object.freeze({__proto__:null,default:HD}),KD="",YD=Object.freeze({__proto__:null,default:KD}),qD="",VD=Object.freeze({__proto__:null,default:qD}),XD="",JD=Object.freeze({__proto__:null,default:XD}),ZD="",QD=Object.freeze({__proto__:null,default:ZD}),t4="",e4=Object.freeze({__proto__:null,default:t4}),r4="",n4=Object.freeze({__proto__:null,default:r4}),i4="",s4=Object.freeze({__proto__:null,default:i4}),o4="",a4=Object.freeze({__proto__:null,default:o4}),c4="",l4=Object.freeze({__proto__:null,default:c4}),u4="",f4=Object.freeze({__proto__:null,default:u4}),h4="",d4=Object.freeze({__proto__:null,default:h4}),p4=`desc;$DKGRAYdesignates an inactive label or comment
`,m4=Object.freeze({__proto__:null,default:p4}),g4=`desc;$DKGRAYadds hyperlink text

`,y4=Object.freeze({__proto__:null,default:g4}),_4=`desc;$DKGRAYsends the given message when hotkey is pressed

`,b4=Object.freeze({__proto__:null,default:_4}),w4=`desc;$DKGRAYread number input into given stat/flag
`,v4=Object.freeze({__proto__:null,default:w4}),E4=`desc;$DKGRAYa slider input from 1 to 9 

`,k4=Object.freeze({__proto__:null,default:E4}),x4=`desc;$DKGRAYlist with label value pairs to pick from
`,A4=Object.freeze({__proto__:null,default:x4}),T4=`desc;$DKGRAYread text input into given stat/flag
`,S4=Object.freeze({__proto__:null,default:T4}),R4=`desc;$DKGRAYdesignates a starting point for running code
`,O4=Object.freeze({__proto__:null,default:R4}),I4=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,N4=Object.freeze({__proto__:null,default:I4}),C4=`desc;$DKGRAYwill move the object in the given direction
`,L4=Object.freeze({__proto__:null,default:C4}),M4=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,U4=Object.freeze({__proto__:null,default:M4}),P4=`desc;$DKGRAYcustom 8x14 charset
`,F4=Object.freeze({__proto__:null,default:P4}),$4=`desc;$DKGRAYsets stat to given value

`,B4=Object.freeze({__proto__:null,default:$4}),D4=`desc;$DKGRAYsends the given message when hotkey is pressed

`,j4=Object.freeze({__proto__:null,default:D4}),z4=`desc;$DKGRAYread external content and/or handle events
`,W4=Object.freeze({__proto__:null,default:z4}),H4=`desc;$DKGRAYread number input into given stat/flag
`,G4=Object.freeze({__proto__:null,default:H4}),K4=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,Y4=Object.freeze({__proto__:null,default:K4}),q4=`desc;$DKGRAYcustom palette colors
`,V4=Object.freeze({__proto__:null,default:q4}),X4=`desc;$DKGRAYa slider input from 1 to 9 

`,J4=Object.freeze({__proto__:null,default:X4}),Z4=`desc;$DKGRAYlist with label value pairs to pick from
`,Q4=Object.freeze({__proto__:null,default:Z4}),t5=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,e5=Object.freeze({__proto__:null,default:t5}),r5=`desc;$DKGRAYread text input into given stat/flag
`,n5=Object.freeze({__proto__:null,default:r5}),i5=`desc;$DKGRAYadds text
`,s5=Object.freeze({__proto__:null,default:i5}),o5=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,a5=Object.freeze({__proto__:null,default:o5}),c5=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,l5=Object.freeze({__proto__:null,default:c5}),u5=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,f5=Object.freeze({__proto__:null,default:u5}),h5=`$white no pages found
$white use @ to create a page
$white @board name of board
$white @object name of object
$white @terrain name of terrain
$white You can omit the type and it will default to object
$white @object name of object
$white @name of object`,d5=Object.freeze({__proto__:null,default:h5}),p5=`header;player settings
#set user "name goes here"
`,m5=Object.freeze({__proto__:null,default:p5}),g5=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,y5=Object.freeze({__proto__:null,default:g5});const wk=Object.assign({"./editor/codepagename.txt":A$,"./editor/command/become.txt":S$,"./editor/command/bgplay.txt":O$,"./editor/command/bgvol.txt":N$,"./editor/command/bind.txt":L$,"./editor/command/board.txt":U$,"./editor/command/bpm.txt":F$,"./editor/command/break.txt":B$,"./editor/command/change.txt":j$,"./editor/command/char.txt":W$,"./editor/command/charset.txt":G$,"./editor/command/clear.txt":Y$,"./editor/command/color.txt":V$,"./editor/command/continue.txt":J$,"./editor/command/copy.txt":Q$,"./editor/command/cycle.txt":eB,"./editor/command/die.txt":nB,"./editor/command/distort.txt":sB,"./editor/command/do.txt":aB,"./editor/command/done.txt":lB,"./editor/command/duplicate.txt":fB,"./editor/command/echo.txt":dB,"./editor/command/edge.txt":mB,"./editor/command/else.txt":yB,"./editor/command/elseif.txt":bB,"./editor/command/end.txt":vB,"./editor/command/endgame.txt":kB,"./editor/command/endwith.txt":AB,"./editor/command/fcrush.txt":SB,"./editor/command/fetch.txt":OB,"./editor/command/fetchwith.txt":NB,"./editor/command/foreach.txt":LB,"./editor/command/go.txt":UB,"./editor/command/idle.txt":FB,"./editor/command/if.txt":BB,"./editor/command/lock.txt":jB,"./editor/command/oneof.txt":WB,"./editor/command/oneofwith.txt":GB,"./editor/command/palette.txt":YB,"./editor/command/phaser.txt":VB,"./editor/command/pivot.txt":JB,"./editor/command/play.txt":QB,"./editor/command/put.txt":eD,"./editor/command/putwith.txt":nD,"./editor/command/readbin.txt":sD,"./editor/command/readjson.txt":aD,"./editor/command/readline.txt":lD,"./editor/command/readrexpaint.txt":fD,"./editor/command/remix.txt":dD,"./editor/command/repeat.txt":mD,"./editor/command/restore.txt":yD,"./editor/command/reverb.txt":bD,"./editor/command/revert.txt":vD,"./editor/command/run.txt":kD,"./editor/command/runwith.txt":AD,"./editor/command/set.txt":SD,"./editor/command/shoot.txt":OD,"./editor/command/shootwith.txt":ND,"./editor/command/shove.txt":LD,"./editor/command/snapshot.txt":UD,"./editor/command/synth.txt":FD,"./editor/command/toast.txt":BD,"./editor/command/tts.txt":jD,"./editor/command/ttsvol.txt":WD,"./editor/command/twitchbroadcast.txt":GD,"./editor/command/twitchchat.txt":YD,"./editor/command/unlock.txt":VD,"./editor/command/vibrato.txt":JD,"./editor/command/vol.txt":QD,"./editor/command/waitfor.txt":e4,"./editor/command/walk.txt":n4,"./editor/command/weave.txt":s4,"./editor/command/while.txt":a4,"./editor/command/with.txt":l4,"./editor/command/write.txt":f4,"./editor/command/zap.txt":d4,"./editor/comment.txt":m4,"./editor/hyperlink.txt":y4,"./editor/hyperlink/hotkey.txt":b4,"./editor/hyperlink/number.txt":v4,"./editor/hyperlink/range.txt":k4,"./editor/hyperlink/select.txt":A4,"./editor/hyperlink/text.txt":S4,"./editor/label.txt":O4,"./editor/shortgo.txt":N4,"./editor/shorttry.txt":L4,"./editor/stat/board.txt":U4,"./editor/stat/charset.txt":F4,"./editor/stat/const.txt":B4,"./editor/stat/hotkey.txt":j4,"./editor/stat/loader.txt":W4,"./editor/stat/number.txt":G4,"./editor/stat/object.txt":Y4,"./editor/stat/palette.txt":V4,"./editor/stat/range.txt":J4,"./editor/stat/select.txt":Q4,"./editor/stat/terrain.txt":e5,"./editor/stat/text.txt":n5,"./editor/text.txt":s5,"./help/controls.txt":a5,"./help/developer.txt":l5,"./help/menu.txt":f5,"./help/nopages.txt":d5,"./help/player.txt":m5,"./help/text.txt":y5}),vk={};Dr(wk).forEach(e=>{const t=e.replace(".txt","").replace("./","").replaceAll("/",":");vk[t]=wk[e].default});function _5(e){const t=Dt(e.trim().replaceAll(`
`,"").replace(/:+$/,"")),r=vk[t];if(w(r))return r;const{target:n,path:i}=zr(t);switch(n){case"editor":{const s=zr(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function b5(e,t){const r=(e??"").split(`
`);for(let n=0;n<r.length;++n)t(r[n].split(";"))}function w5(e,t){const[r,...n]=t,i=n[0]??"",s=n[1]??"";switch(Dt(r.trim())){case"header":$p(lt,e,i);break;case"section":Ws(lt,e,i);break;case"option":Hs(lt,e,i,s);break;default:r.trimStart().startsWith("!")?E$(lt,e,r.trimStart().slice(1),i):we(lt,e,r);break}}function $i(e,t=!1){const[r]=ut(e,0,[q.ANY]);if(t&&Hr(r)){const[,n,i,s]=ut(e,0,[q.NAME,q.DIR,q.MAYBE_NAME]);return yt(i)&&i.startsWith(":")?{targetdir:n,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetdir:n,label:e.slice(s-1).join(" ")}}else if(yt(r)){const[n,i,s]=ut(e,0,[q.NAME,q.MAYBE_NAME]);if(yt(i)&&i.startsWith(":")){const a=[i.substring(1).trim(),...e.slice(s)];return{targetname:n,label:a.join(" ")}}return{targetname:"self",label:[n,...e.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function Gs(){sm(lt,$r())}function zo(e){b5(_5(`help:${e}`),t=>w5(k.elementfocus,t))}function Ek(e){switch(e.label){case"helpmenu":zo("menu");break;case"helpcontrols":zo("controls");break;case"helptext":zo("text");break;case"helpdeveloper":zo("developer");break;case"helpplayer":zo("player");break;default:{const t=ge(Xt.MAIN),r=Do(t);w(e.targetname)?Jo(e.targetname,e.label,void 0,r):w(e.targetdir)&&Jo(e.targetdir.destpt,e.label,void 0,r);break}}}const v5=Si().command("shortsend",(e,t)=>{const r=$i(t);return Ek(r),0}).command("send",(e,t)=>{const r=$i(t,!0);return Ek(r),0}).command("stat",(e,t)=>{const[r,...n]=t.map(Ie),i=n.join(" ");function s(o,a){if(w(o)&&(e.command("pageopen",o.id),a)){const c=be(o),u=gi(o);we(lt,k.elementfocus,`!pageopen ${o.id};$blue[${u}]$white ${c}`)}}switch(Dt(r)){case fn(Ut.LOADER):{const[o,a]=ls(Xt.MAIN,i,vt.LOADER);s(o,a);break}default:{const[o,a]=ls(Xt.MAIN,[r,...n].join(" "),vt.OBJECT);s(o,a);break}case fn(Ut.BOARD):{const[o,a]=ls(Xt.MAIN,i,vt.BOARD);s(o,a);break}case fn(Ut.OBJECT):{const[o,a]=ls(Xt.MAIN,i,vt.OBJECT);s(o,a);break}case fn(Ut.TERRAIN):{const[o,a]=ls(Xt.MAIN,i,vt.TERRAIN);s(o,a);break}case fn(Ut.CHARSET):{const[o,a]=ls(Xt.MAIN,i,vt.CHARSET);s(o,a);break}case fn(Ut.PALETTE):{const[o,a]=ls(Xt.MAIN,i,vt.PALETTE);s(o,a);break}}return 0}).command("text",(e,t)=>{const r=t.map(Ie).join(" ");if(w(k.element)&&k.elementisplayer){const{user:n}=In(k.elementid),i=yt(n)?n:"player";k.element.tickertext=`${i}: ${r}`,k.element.tickertime=k.timestamp;const s=mr(k.element);Re(lt,k.elementid,`$${zt[s.color]}$ON${zt[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${r}`),Tf(lt,k.elementid,void 0,"text","chat:message:game",`${i}:${r}`)}return 0}).command("hyperlink",(e,t)=>{const[r,...n]=t,i=Ie(r),s=$i(n);if(w(s.targetname)){const{user:o}=In(k.elementid),a=yt(o)?o:"player",c=mr(k.element),u=`$${zt[c.color]}$ON${zt[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;Re(lt,k.elementid,`!${s.targetname}:${s.label};${u}`)}return 0}).command("config",(e,t)=>{const[r,n]=ut(t,0,[q.MAYBE_NAME,q.MAYBE_STRING]);return yt(r)&&yt(n)?rm(lt,k.elementfocus,r,n):DT(lt,k.elementfocus),0}).command("bookcreate",(e,t)=>{const[r]=ut(t,0,[q.MAYBE_NAME]),n=Nx(r);return w(n)&&e.command("bookopen",n.id),0}).command("bookopen",(e,t)=>{const[r]=ut(t,0,[q.NAME]),n=Kn(r);return w(n)?(rm(lt,k.elementfocus,"selected",n.id),Gs()):_e(lt,k.elementfocus,"bookopen",`book ${r} not found`),0}).command("booktrash",(e,t)=>{const[r]=ut(t,0,[q.NAME]),n=ge(Xt.MAIN),i=Kn(r);return w(i)&&(n===i&&Ix(Xt.MAIN,""),Bz(r),Re(lt,k.elementfocus,`trashed [book] ${i.name}`),Gs(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[r]=ut(t,0,[q.NAME]),n=br(r);return w(n)&&Bo(k.book,k.elementfocus,n.id,{x:_n(0,Ct-1),y:_n(0,Zt-1)},!0),0}).command("pageopen",(e,t)=>{const[r,n]=ut(t,0,[q.NAME,q.MAYBE_NAME]);let i,s;const o=Sn();for(let a=0;a<o.length&&(s=o[a],i=Ds(s,r),!w(i));++a);if(w(i)&&w(s)){const a=be(i),c=gi(i);Re(lt,k.elementfocus,`opened [${c}] ${a}`);const u=[i.id,n];Eh(Sc(s.id,u),i.code);const l=gi(i);nm(lt,k.elementfocus,s.id,u,l,`${a} - ${s.name}`)}else _e(lt,"pageopen",`page ${r} not found`,k.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[r]=ut(t,0,[q.NAME]),n=_r(Xt.MAIN),i=qE(n,r);if(w(r)){const s=be(i),o=gi(i);Re(lt,k.elementfocus,`trashed [${o}] ${s}`),Gs(),e.command("pages")}return 0}).command("help",(e,t)=>{const r=t.map(Ie).join(" ")||"menu";return e.command(`help${r}`),0}).command("books",()=>{Ws(lt,k.elementfocus,"books");const e=ge(Xt.MAIN);Hs(lt,k.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=ge(Xt.MAIN);Hs(lt,k.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),Fp(lt,k.elementfocus,7);const r=Sn();return r.length?r.forEach(n=>{we(lt,k.elementfocus,`!bookopen ${n.id};${n.name}`)}):jo(lt,k.elementfocus,"no books found"),we(lt,k.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=_r(Xt.MAIN);if(!w(e))return 0;Ws(lt,k.elementfocus,"pages"),Hs(lt,k.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?sc(e).forEach(n=>{const i=be(n),s=gi(n);we(lt,k.elementfocus,`!pageopen ${n.id};$blue[${s}]$white ${i}`)}):(we(lt,k.elementfocus,""),zo("nopages"));const t=Sn();for(let r=0;r<t.length;++r){const n=t[r];n.id!==e.id&&(Hs(lt,k.elementfocus,"content",`${n.name} $GREEN${n.id}`),sc(n).forEach(s=>{const o=be(s),a=gi(s);we(lt,k.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Ws(lt,k.elementfocus,"boards");const e=_r(Xt.MAIN);if(w(e)){Hs(lt,k.elementfocus,"main",`${e.name} $GREEN${e.id}`);const r=sc(e);r.filter(n=>mi(n)===vt.BOARD).forEach(n=>{const i=be(n);we(lt,k.elementfocus,`!boardopen ${n.id};$blue[#goto]$white ${i}`)}),r.length===0&&(we(lt,k.elementfocus,""),jo(lt,k.elementfocus,"$white no boards found"),jo(lt,k.elementfocus,"$white use @ to create a board"),jo(lt,k.elementfocus,"$white @board name of board"))}const t=Sn();for(let r=0;r<t.length;++r){const n=t[r];n.id!==e.id&&(Hs(lt,k.elementfocus,"content",`${n.name} $GREEN${n.id}`),sc(n).filter(s=>mi(s)===vt.BOARD).forEach(s=>{const o=be(s);we(lt,k.elementfocus,`!boardopen ${s.id};$blue[#goto]$white ${o}`)}))}return 0}).command("trash",()=>{Ws(lt,k.elementfocus,"$REDTRASH"),jo(lt,k.elementfocus,"books");const e=Sn();e.length&&(e.forEach(r=>{we(lt,k.elementfocus,`!booktrash ${r.id};$REDTRASH ${r.name}`)}),we(lt,k.elementfocus,""));const t=ge(Xt.MAIN);return w(t)&&(jo(lt,k.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(r=>{const n=be(r);we(lt,k.elementfocus,`!pagetrash ${r.id};$REDTRASH ${n}`)}),we(lt,k.elementfocus,"")),0}).command("dev",()=>(Gs(),OT(lt,k.elementfocus),0)).command("share",()=>(Gs(),IT(lt,k.elementfocus),0)).command("save",()=>(Gs(),0)).command("fork",()=>(VT(lt,k.elementfocus),0)).command("itchiopublish",()=>(XT(lt,k.elementfocus),0)).command("nuke",()=>(NT(lt,k.elementfocus),0)).command("restart",()=>(qT(lt,k.elementfocus),Gs(),0)).command("export",()=>{$p(lt,k.elementfocus,"E X P O R T"),Ws(lt,k.elementfocus,"books");const e=Sn();return e.length&&e.forEach(t=>we(lt,k.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[r]=ut(t,0,[q.NAME]),n=Kn(r);return w(n)&&($p(lt,k.elementfocus,"E X P O R T"),Ws(lt,k.elementfocus,"pages"),setTimeout(()=>{if(n.pages.length){const i=sc(n);we(lt,k.elementfocus,`!bookallexport ${r};$blue[all]$white export book`),i.forEach(s=>{const o=be(s),a=gi(s);we(lt,k.elementfocus,`!pageexport ${r}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[r]=ut(t,0,[q.NAME]),n=Kn(r);return w(n)&&tm(lt,k.elementfocus,Ln(n),`${n.name}.book.json`),0}).command("pageexport",(e,t)=>{const[r]=ut(t,0,[q.NAME]),{target:n,path:i}=zr(r),s=Kn(n),o=Ds(s,i);return w(o)&&tm(lt,k.elementfocus,Ln(o),`${be(o)}.${gi(o)}.json`),0}).command("gadget",()=>(jT(lt,k.elementfocus),0)).command("zztsearch",(e,t)=>{const[r,n]=ut(t,0,[q.NAME,q.MAYBE_NAME]),i=w(n)?r:"title",s=w(n)?n:r;return WT(lt,k.elementfocus,i,s),0}).command("zztrandom",()=>(HT(lt,k.elementfocus),0)).command("joincode",(e,t)=>{const[r]=ut(t,0,[q.MAYBE_NAME]);return _T(lt,k.elementfocus,!!r),0}).command("jointab",(e,t)=>{const[r]=ut(t,0,[q.MAYBE_NAME]);return bT(lt,k.elementfocus,!!r),0}).command("startlookingglass",()=>(CT(lt,k.elementfocus),0)),E5=Si().command("toast",(e,t)=>{const r=t.map(Ie).join("");return Tc(lt,k.elementfocus,r),0}).command("ticker",(e,t)=>{const r=t.map(Ie).join("");return w(k.element)&&(k.element.tickertext=r,k.element.tickertime=k.timestamp),0}).command("palette",(e,t)=>{const[r]=ut(t,0,[q.NAME]),n=Lx(),i=or(k.book,vt.PALETTE,r);return w(i)?(n.palette=i.id,Re(lt,k.elementfocus,`loaded palette ${r}`)):_e(lt,k.elementfocus,"not-found",`unabled to find palette ${r}`),0}).command("charset",(e,t)=>{const[r]=ut(t,0,[q.NAME]),n=Lx(),i=or(k.book,vt.CHARSET,r);return w(i)?(n.charset=i.id,Re(lt,k.elementfocus,`loaded charset ${r}`)):_e(lt,k.elementfocus,"not-found",`unabled to find charset ${r}`),0}),Bp={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",isghost:"ISGHOST",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Ht.ISSOLID,Ht.ISWALK,Ht.ISSWIM,Ht.ISBULLET,Ht.ISGHOST,Ht.ISWALK,Ht.ISSWIM;function Mu(e){return pe(e)&&Dp(e[0])}function Dp(e){return w(Ht[e])&&yt(e)}function k5(e){if(yt(e))return Bp[Dt(e)]}function x5(e){const t=k.words[e];if(Mu(t))return[t,e+1];if(Dp(t))return[[t],e+1];const[r,n]=Pr(e);return Mu(r)?[r,n]:Dp(r)?[[r],n]:[void 0,e]}function Wo(e,t=0){const r=[];let n=e;for(;n<k.words.length;){const[i,s]=Pr(n);if(pe(i)&&!Hr(i)&&!cc(i)&&!Mu(i)&&!Cr(i)&&r.push(...i),i==="|")return[r,s];if(n=s,r.push(i),t>0&&r.length>=t)return[r,n]}return[r,n]}function Pr(e){var n,i,s,o,a,c,u,l,h;const t=k.words[e],r=e+1;if(xk(t)){const[d,f]=A5(e);if(w(d))return[d,f]}if(k5(t)){const[d,f]=x5(e);if(w(d))return[d,f]}if(xa(t)){const[d,f]=ul(e);if(w(d))return[d,f]}if(yt(t)&&Dt(t)==="rnd"){const[d,f]=Pr(r),[m,p]=Pr(f);return Et(d)&&Et(m)?[_n(d,m),p]:Et(d)?[_n(0,d),f]:[_n(0,1),r]}if(al(t)){const[d,f]=yy(e);if(w(d))return[d,f]}if(!w(t))return[void 0,e];if(Et(t)||pe(t))return[t,r];if(yt(t)){const d=Dt(t),f=(n=k.get)==null?void 0:n.call(k,t);if(w(f))return[f,r];switch(d){case"aligned":case"alligned":{const m=bc(k.board,{x:((i=k.element)==null?void 0:i.x)??-1,y:((s=k.element)==null?void 0:s.y)??-1},k.elementfocus);return!w(k.element)||!w(m)?[0,r]:[k.element.x===m.x||k.element.y===m.y?1:0,r]}case"contact":{const m=bc(k.board,{x:((o=k.element)==null?void 0:o.x)??-1,y:((a=k.element)==null?void 0:a.y)??-1},k.elementfocus);if(!w(k.element)||!w(m))return[0,r];const p=(m.x??0)-(((c=k.element)==null?void 0:c.x)??0),g=(m.y??0)-(((u=k.element)==null?void 0:u.y)??0);return[p===0&&Math.abs(g)<2||g===0&&Math.abs(p)<2?1:0,r]}case"blocked":{const[m,p]=ut(k.words,r,[q.DIR]);return[SF(k.board,k.element,m.destpt)?1:0,p]}case"any":{const[m]=ut(k.words,r,[q.ANY]);if(Hr(m)){const[b,T,A]=ut(k.words,r,[q.DIR,q.COLOR_OR_KIND]),x=b.layer===bt.MID?oe(k.board,b.destpt):us(k.board,b.destpt.x,b.destpt.y);if(w(x)){const I=mr(x);if(Cr(T))return[cl(T)===I.color||ll(T)===I.bg?[x]:[],A];const R=Dt(yc(T)),$=Ju(T);if((R.length&&R!==I.name||w($)&&$!==I.color)===!1)return[[x],A]}return[[],A]}const[p,g]=ut(k.words,r,[q.COLOR_OR_KIND]);return Cr(p)?[Bx(k.board,p),g]:[Zu(k.board,p),g]}case"countof":{const[m]=ut(k.words,r,[q.ANY]);if(Hr(m)){const[b,T,A]=ut(k.words,r,[q.DIR,q.COLOR_OR_KIND]),x=b.layer===bt.MID?oe(k.board,b.destpt):us(k.board,b.destpt.x,b.destpt.y);if(w(x)){const I=mr(x);if(Cr(T))return[cl(T)===I.color||ll(T)===I.bg?1:0,A];const R=Dt(yc(T)),$=Ju(T),M=R.length?R===I.name:!0,H=w($)?$===I.color:!0;if(M&&H)return[1,A]}return[0,A]}const[p,g]=ut(k.words,r,[q.COLOR_OR_KIND]);return Cr(p)?[Bx(k.board,p).length,g]:[Zu(k.board,p).length,g]}case"rnd":return[_n(0,1),r];case"abs":{const[m,p]=ut(k.words,r,[q.NUMBER]);return[Math.abs(m),p]}case"intceil":{const[m,p]=ut(k.words,r,[q.NUMBER]);return[Math.ceil(m),p]}case"intfloor":{const[m,p]=ut(k.words,r,[q.NUMBER]);return[Math.floor(m),p]}case"intround":{const[m,p]=ut(k.words,r,[q.NUMBER]);return[Math.round(m),p]}case"clamp":{const[m,p,g,y]=ut(k.words,r,[q.NUMBER,q.NUMBER,q.NUMBER]);return[Ge(m,p,g),y]}case"min":{const[m,p]=Wo(r);return[Math.min(...m),p]}case"max":{const[m,p]=Wo(r);return[Math.max(...m),p]}case"pick":{const[m,p]=Wo(r);return[bn(m),p]}case"pickwith":{const[m,p]=ut(k.words,r,[q.NUMBER_OR_STRING]),[g,y]=Wo(p);return[uI(`${m}`,g),y]}case"random":{const[m,p]=Wo(r,2),[g,y]=m;return[_n(g,y??0),p]}case"randomwith":{const[m,p]=ut(k.words,r,[q.NUMBER_OR_STRING]),[g,y]=Wo(p,2),[b,T]=g;return[hy(`${m}`,b,T??0),y]}case"run":{const[m,p]=ut(k.words,r,[q.NAME]);return Xu(m),[(l=k.get)==null?void 0:l.call(k,"arg"),p]}case"runwith":{const[m,p,g]=ut(k.words,r,[q.ANY,q.NAME]);return w(k.element)&&(k.element.arg=m),Xu(p),[(h=k.get)==null?void 0:h.call(k,"arg"),g]}}}return[t,r]}const jp={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function cc(e){return pe(e)&&kk(e[0])}function kk(e){return w(jr[e])&&yt(e)}function xk(e){if(yt(e))return jp[Dt(e)]}function Ak(e){if(cc(e))return e;if(kk(e))return[e];const t=xk(e);if(w(t))return[t]}function A5(e){const t=k.words[e],r=Ak(t);if(cc(r))return[r,e+1];const[n,i]=Pr(e),s=Ak(n);return cc(s)?[s,i]:[void 0,e]}const T5=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Tk=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"]),S5=["NORTH","SOUTH","WEST","EAST"];function R5(e){const t=In(e);if(Et(t.inputcurrent)||(t.inputcurrent=0),pe(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[r]=t.inputqueue,[n=Lr.NONE,i=0]=r??[Lr.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&SI?1:0,t.inputctrl=i&RI?1:0,t.inputshift=i&OI?1:0,n){case Lr.MOVE_UP:case Lr.MOVE_DOWN:case Lr.MOVE_LEFT:case Lr.MOVE_RIGHT:t.inputmove=[S5[n-Lr.MOVE_UP]];break;case Lr.OK_BUTTON:t.inputok=1;break;case Lr.CANCEL_BUTTON:t.inputcancel=1;break;case Lr.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=n,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==Lr.NONE&&o!==n}),t}function O5(e){const t=jp[e];if(w(t))return t;const r=Bp[e];if(w(r))return r;const n=ka[e];if(w(n))return n;const i=Ih[e];if(w(i))return i}function Sk(){var t,r;if(wr(k.board,k.element,k.timestamp),!!Yt(k.element,"item")){const n={x:((t=k.element)==null?void 0:t.x)??-1,y:((r=k.element)==null?void 0:r.y)??-1},i=bc(k.board,n,k.elementfocus);w(i)&&(i.x=n.x,i.y=n.y)}}const I5=Si({get(e,t){var u,l,h,d,f,m,p,g,y,b,T,A,x,I,R,$,M,H,X,O,N;const r=O5(t);if(w(r))return[!0,r];if(k.elementisplayer&&T5.has(t)){const E=R5(k.elementid)[t];return[w(E),E]}const n=bc(k.board,{x:((u=k.element)==null?void 0:u.x)??-1,y:((l=k.element)==null?void 0:l.y)??-1},k.elementfocus),i=(n==null?void 0:n.id)??k.elementfocus??$r(),s=(h=k.element)==null?void 0:h.sender,o=Hx(k.board,yt(s)?s:""),a=(o==null?void 0:o.id)??"";switch(t){case"camera":case"graphics":case"facing":if(w((d=k.board)==null?void 0:d[t]))return[!0,(f=k.board)==null?void 0:f[t]];break;case"isdark":return[!0,(m=k.board)!=null&&m.isdark?1:0];case"startx":return[!0,((p=k.board)==null?void 0:p.startx)??0];case"starty":return[!0,((g=k.board)==null?void 0:g.starty)??0];case"over":return[!0,((y=k.board)==null?void 0:y.over)??""];case"under":return[!0,((b=k.board)==null?void 0:b.under)??""];case"exitnorth":return[!0,((T=k.board)==null?void 0:T.exitnorth)??""];case"exitsouth":return[!0,((A=k.board)==null?void 0:A.exitsouth)??""];case"exitwest":return[!0,((x=k.board)==null?void 0:x.exitwest)??""];case"exiteast":return[!0,((I=k.board)==null?void 0:I.exiteast)??""];case"timelimit":return[!0,((R=k.board)==null?void 0:R.timelimit)??0];case"restartonzap":return[!0,(($=k.board)==null?void 0:$.restartonzap)??0];case"maxplayershots":return[!0,((M=k.board)==null?void 0:M.maxplayershots)??0];case"currenttick":return[!0,k.timestamp];case"boardid":return[!0,((H=k.board)==null?void 0:H.id)??""];case"playerid":return[!0,i];case"playerx":return[!0,(n==null?void 0:n.x)??-1];case"playery":return[!0,(n==null?void 0:n.y)??-1];case"thisid":return[!0,((X=k.element)==null?void 0:X.id)??""];case"thisx":return[!0,((O=k.element)==null?void 0:O.x)??-1];case"thisy":return[!0,((N=k.element)==null?void 0:N.y)??-1];case"senderid":return[!0,a];case"senderx":return[!0,(o==null?void 0:o.x)??-1];case"sendery":return[!0,(o==null?void 0:o.y)??-1];default:{if(Tk.has(t))return[!0,Yt(k.element,t)??0];break}}const c=In(i)[t];return[w(c),c]},set(e,t,r){var o,a;const n=bc(k.board,{x:((o=k.element)==null?void 0:o.x)??-1,y:((a=k.element)==null?void 0:a.y)??-1},k.elementfocus),i=(n==null?void 0:n.id)??k.elementfocus;switch(t){case"camera":case"graphics":case"facing":break;case"isdark":if(w(k.board))return k.board.isdark=r?1:0,[!0,k.board.isdark];break;case"startx":if(w(k.board))return k.board.startx=Sa(r,0),[!0,k.board.startx];break;case"starty":if(w(k.board))return k.board.starty=Sa(r,0),[!0,k.board.starty];break;case"over":if(w(k.board))return k.board.over=Ie(r),[!0,k.board.over];break;case"under":if(w(k.board))return[!0,k.board.under=Ie(r)];break;case"exitnorth":if(w(k.board))return[!0,k.board.exitnorth=Ie(r)];break;case"exitsouth":if(w(k.board))return[!0,k.board.exitsouth=Ie(r)];break;case"exitwest":if(w(k.board))return[!0,k.board.exitwest=Ie(r)];break;case"exiteast":if(w(k.board))return[!0,k.board.exiteast=Ie(r)];break;case"timelimit":if(w(k.board))return[!0,k.board.timelimit=Sa(r,0)];break;case"restartonzap":if(w(k.board))return[!0,k.board.restartonzap=r?1:0];break;case"maxplayershots":if(w(k.board))return[!0,k.board.maxplayershots=Sa(r,0)];break;case"currenttick":return[!1,r];case"boardid":return[!1,r];case"playerid":return[!1,r];case"playerx":return[!1,r];case"playery":return[!1,r];case"thisid":return[!1,r];case"thisx":return[!1,r];case"thisy":return[!1,r];case"senderid":return[!1,r];case"senderx":return[!1,r];case"sendery":return[!1,r];default:{if(Tk.has(t))return w(k.element)&&(k.element[t]=r),[!0,r];break}}const s=In(i);return w(s)?(s[t]=r,[!0,r]):[!1,r]},everytick(){var e,t,r,n,i;if(!((e=k.element)!=null&&e.removed)&&(w((t=k.element)==null?void 0:t.stepx)||w((r=k.element)==null?void 0:r.stepy))){const s={x:((n=k.element)==null?void 0:n.x)??0,y:((i=k.element)==null?void 0:i.y)??0};Yn(k.book,k.board,k.element,{x:s.x+(k.element.stepx??0),y:s.y+(k.element.stepy??0)})===!1&&Yt(k.element,"breakable")&&wr(k.board,k.element,k.timestamp)}}}).command("clear",(e,t)=>{for(let r=0;r<t.length;++r)e.set(Ie(t[r]),0);return 0}).command("set",(e,t)=>{const[r,n]=ut(t,0,[q.NAME,q.ANY]);return e.set(r,n??1),0}).command("become",(e,t)=>{var c,u;const[r]=ut(t,0,[q.KIND]);gr(k.board);const n=mr(k.element),[i,s]=r,o=[...Aa(n.color,n.bg),...s??[]],a=[i,o];if(Tu(k.board,k.element),wr(k.board,k.element,k.timestamp)){const l={x:((c=k.element)==null?void 0:c.x)??0,y:((u=k.element)==null?void 0:u.y)??0};On(k.board,a,l)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[r]=ut(t,0,[q.ANY]);if(Hr(r)){const[n,i]=ut(t,0,[q.DIR,q.NUMBER]),s=oe(k.board,n.destpt);w(s)&&(s.char=i)}else w(k.element)&&Et(r)&&(k.element.char=r);return 0}).command("color",(e,t)=>{const[r]=ut(t,0,[q.ANY]);if(Hr(r)){const[n,i]=ut(t,0,[q.DIR,q.COLOR]),s=oe(k.board,n.destpt);w(s)&&Pa(k.element,i)}else{const[n]=ut(t,0,[q.COLOR]);w(k.element)&&w(n)&&Pa(k.element,n)}return 0}).command("go",(e,t)=>{if(w(k.element)){const[r]=ut(t,0,[q.DIR]);if(Yn(k.book,k.board,k.element,r.destpt),e.yield(),k.element.x===r.destpt.x&&k.element.y===r.destpt.y)return 0}return 1}).command("walk",(e,t)=>{if(!w(k.element))return 0;const[r]=ut(t,0,[q.DIR]),n=k.element.x??0,i=k.element.y??0;return k.element.stepx=r.destpt.x-n,k.element.stepy=r.destpt.y-i,0}).command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[r]=ut(t,0,[q.ANY]);return e.set("arg",r),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Ie(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Ie(t[0])),0)).command("cycle",(e,t)=>{if(w(k.element)){const[r]=ut(t,0,[q.NUMBER]);k.element.cycle=Ge(Math.round(r),1,255)}return 0}).command("die",e=>(Sk(),e.endofprogram(),0)).command("dieonend",()=>(Sk(),0)).command("endgame",()=>(Af(lt,k.elementfocus),0)).command("run",(e,t)=>{const[r]=ut(t,0,[q.NAME]);return Xu(r),0}).command("runwith",(e,t)=>{const[r,n]=ut(t,0,[q.ANY,q.NAME]);return e.set("arg",r),Xu(n),0}),Uu={};function N5(e){var t;return(t=Uu[e])==null?void 0:t.arg}function C5(e){var t;return(t=Uu[e])==null?void 0:t.format}function Ho(e){var t;return(t=Uu[e])==null?void 0:t.content}function Rk(e,t,r,n,i){const s=ge(Xt.MAIN);if(!w(s))return;const o=js(s,vt.LOADER).filter(a=>{const c=Bs(a),u=c.format,l=yt(u)?new RegExp(u).test(t):!1,h=c.event,d=yt(h)?new RegExp(h).test(r):!1;return yt(u)&&yt(h)?l&&d:yt(u)?l:yt(h)?d:!1});for(let a=0;a<o.length;++a){const c=`${We()}_loader`;Uu[c]={arg:e,format:t,content:n,player:i},Hz(c,o[a].code)}}function Ok(e,t){if(!w(e))return;const r=Dt(t),n=r.endsWith("le");switch(r){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,n);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,n);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,n);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,n);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,n);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,n);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,n);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,n);return e.cursor+=8,i}}}const L5=(e,t)=>{const r=Ho(e.id());if(!w(r))return 0;const[n,i]=ut(t,0,[q.NAME]),s=Dt(n);switch(s){case"seek":{const[o]=ut(t,i,[q.NUMBER]);r.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=ut(t,i,[q.NAME]);e.set(o,Ok(r,s));break}case"text":{const[o,a]=ut(t,i,[q.NAME,q.NAME]),c=Ok(r,o);if(Et(c)&&yt(a)){const u=new Uint8Array(r.bytes.buffer,r.cursor,c),h=new TextDecoder("utf-8").decode(u);e.set(a,h),r.cursor+=c}break}case"palette":{const[o]=ut(t,i,[q.NAME]),[a]=vp(k.book,vt.PALETTE,o),c=Ce(a);if(w(c)){const u=wI*fl,l=P_(new Uint8Array(r.bytes.buffer,r.cursor,u));w(l)&&(c.bits=l.bits),r.cursor+=u}break}case"charset":{const[o]=ut(t,i,[q.NAME]),[a]=vp(k.book,vt.CHARSET,o),c=Ce(a);if(w(c)){const u=hl*bI*Mh,l=F_(new Uint8Array(r.bytes.buffer,r.cursor,u));w(l)&&(c.bits=l.bits),r.cursor+=u}break}}return 0},Go=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",Pu=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(!Pu(e[r],t[r]))return!1;return!0}if(Go(e)&&Go(t)){const r=Object.entries(e),n=new Set(Object.keys(t));if(r.length!==n.size)return!1;for(const[i,s]of r){if(!Pu(s,t[i]))return!1;n.delete(i)}return n.size===0}return!1},Fu=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(Go(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},M5=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",Ik=e=>e>="0"&&e<="9"||e==="-",U5=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var nt;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(nt||(nt={}));const Nk={"(":nt.TOK_LPAREN,")":nt.TOK_RPAREN,"*":nt.TOK_STAR,",":nt.TOK_COMMA,".":nt.TOK_DOT,":":nt.TOK_COLON,"@":nt.TOK_CURRENT,$:nt.TOK_ROOT,"]":nt.TOK_RBRACKET,"{":nt.TOK_LBRACE,"}":nt.TOK_RBRACE},P5={"!":!0,"<":!0,"=":!0,">":!0},F5={"	":!0,"\n":!0,"\r":!0," ":!0};class $5{constructor(){this._current=0}tokenize(t){const r=[];this._current=0;let n,i,s;for(;this._current<t.length;)if(M5(t[this._current]))n=this._current,i=this.consumeUnquotedIdentifier(t),r.push({start:n,type:nt.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Nk[t[this._current]]!==void 0)r.push({start:this._current,type:Nk[t[this._current]],value:t[this._current]}),this._current+=1;else if(Ik(t[this._current]))s=this.consumeNumber(t),r.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),r.push(s);else if(t[this._current]==='"')n=this._current,i=this.consumeQuotedIdentifier(t),r.push({start:n,type:nt.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")n=this._current,i=this.consumeRawStringLiteral(t),r.push({start:n,type:nt.TOK_LITERAL,value:i});else if(t[this._current]==="`"){n=this._current;const o=this.consumeLiteral(t);r.push({start:n,type:nt.TOK_LITERAL,value:o})}else if(P5[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&r.push(s);else if(F5[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")n=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,r.push({start:n,type:nt.TOK_AND,value:"&&"})):r.push({start:n,type:nt.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")n=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,r.push({start:n,type:nt.TOK_OR,value:"||"})):r.push({start:n,type:nt.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return r}consumeUnquotedIdentifier(t){const r=this._current;for(this._current+=1;this._current<t.length&&U5(t[this._current]);)this._current+=1;return t.slice(r,this._current)}consumeQuotedIdentifier(t){const r=this._current;this._current+=1;const n=t.length;for(;t[this._current]!=='"'&&this._current<n;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(r,this._current))}consumeRawStringLiteral(t){const r=this._current;this._current+=1;const n=t.length;for(;t[this._current]!=="'"&&this._current<n;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(r+1,this._current-1).replace("\\'","'")}consumeNumber(t){const r=this._current;this._current+=1;const n=t.length;for(;Ik(t[this._current])&&this._current<n;)this._current+=1;const i=parseInt(t.slice(r,this._current),10);return{start:r,value:i,type:nt.TOK_NUMBER}}consumeLBracket(t){const r=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:r,type:nt.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:r,type:nt.TOK_FLATTEN,value:"[]"}):{start:r,type:nt.TOK_LBRACKET,value:"["}}consumeOperator(t){const r=this._current,n=t[r];if(this._current+=1,n==="!")return t[this._current]==="="?(this._current+=1,{start:r,type:nt.TOK_NE,value:"!="}):{start:r,type:nt.TOK_NOT,value:"!"};if(n==="<")return t[this._current]==="="?(this._current+=1,{start:r,type:nt.TOK_LTE,value:"<="}):{start:r,type:nt.TOK_LT,value:"<"};if(n===">")return t[this._current]==="="?(this._current+=1,{start:r,type:nt.TOK_GTE,value:">="}):{start:r,type:nt.TOK_GT,value:">"};if(n==="="&&t[this._current]==="=")return this._current+=1,{start:r,type:nt.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const r=this._current,n=t.length;for(;t[this._current]!=="`"&&this._current<n;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(r,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const r='[{"',n=["true","false","null"],i="-0123456789";if(t==="")return!1;if(r.includes(t[0])||n.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const B5=new $5,Or={[nt.TOK_EOF]:0,[nt.TOK_UNQUOTEDIDENTIFIER]:0,[nt.TOK_QUOTEDIDENTIFIER]:0,[nt.TOK_RBRACKET]:0,[nt.TOK_RPAREN]:0,[nt.TOK_COMMA]:0,[nt.TOK_RBRACE]:0,[nt.TOK_NUMBER]:0,[nt.TOK_CURRENT]:0,[nt.TOK_EXPREF]:0,[nt.TOK_ROOT]:0,[nt.TOK_PIPE]:1,[nt.TOK_OR]:2,[nt.TOK_AND]:3,[nt.TOK_EQ]:5,[nt.TOK_GT]:5,[nt.TOK_LT]:5,[nt.TOK_GTE]:5,[nt.TOK_LTE]:5,[nt.TOK_NE]:5,[nt.TOK_FLATTEN]:9,[nt.TOK_STAR]:20,[nt.TOK_FILTER]:21,[nt.TOK_DOT]:40,[nt.TOK_NOT]:45,[nt.TOK_LBRACE]:50,[nt.TOK_LBRACKET]:55,[nt.TOK_LPAREN]:60};class D5{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const r=this.expression(0);if(this.lookahead(0)!==nt.TOK_EOF){const n=this.lookaheadToken(0);this.errorToken(n,`Unexpected token type: ${n.type}, value: ${n.value}`)}return r}loadTokens(t){this.tokens=[...B5.tokenize(t),{type:nt.TOK_EOF,value:"",start:t.length}]}expression(t){const r=this.lookaheadToken(0);this.advance();let n=this.nud(r),i=this.lookahead(0);for(;t<Or[i];)this.advance(),n=this.led(i,n),i=this.lookahead(0);return n}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let r,n,i;switch(t.type){case nt.TOK_LITERAL:return{type:"Literal",value:t.value};case nt.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case nt.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===nt.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case nt.TOK_NOT:return n=this.expression(Or.Not),{type:"NotExpression",children:[n]};case nt.TOK_STAR:return r={type:"Identity"},n=this.lookahead(0)===nt.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(Or.Star),{type:"ValueProjection",children:[r,n]};case nt.TOK_FILTER:return this.led(t.type,{type:"Identity"});case nt.TOK_LBRACE:return this.parseMultiselectHash();case nt.TOK_FLATTEN:return r={type:nt.TOK_FLATTEN,children:[{type:"Identity"}]},n=this.parseProjectionRHS(Or.Flatten),{type:"Projection",children:[r,n]};case nt.TOK_LBRACKET:return this.lookahead(0)===nt.TOK_NUMBER||this.lookahead(0)===nt.TOK_COLON?(n=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},n)):this.lookahead(0)===nt.TOK_STAR&&this.lookahead(1)===nt.TOK_RBRACKET?(this.advance(),this.advance(),n=this.parseProjectionRHS(Or.Star),{children:[{type:"Identity"},n],type:"Projection"}):this.parseMultiselectList();case nt.TOK_CURRENT:return{type:nt.TOK_CURRENT};case nt.TOK_ROOT:return{type:nt.TOK_ROOT};case nt.TOK_EXPREF:return i=this.expression(Or.Expref),{type:"ExpressionReference",children:[i]};case nt.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==nt.TOK_RPAREN;)this.lookahead(0)===nt.TOK_CURRENT?(i={type:nt.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(nt.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,r){let n;switch(t){case nt.TOK_DOT:const i=Or.Dot;return this.lookahead(0)!==nt.TOK_STAR?(n=this.parseDotRHS(i),{type:"Subexpression",children:[r,n]}):(this.advance(),n=this.parseProjectionRHS(i),{type:"ValueProjection",children:[r,n]});case nt.TOK_PIPE:return n=this.expression(Or.Pipe),{type:nt.TOK_PIPE,children:[r,n]};case nt.TOK_OR:return n=this.expression(Or.Or),{type:"OrExpression",children:[r,n]};case nt.TOK_AND:return n=this.expression(Or.And),{type:"AndExpression",children:[r,n]};case nt.TOK_LPAREN:const s=r.name,o=[];let a;for(;this.lookahead(0)!==nt.TOK_RPAREN;)this.lookahead(0)===nt.TOK_CURRENT?(a={type:nt.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===nt.TOK_COMMA&&this.match(nt.TOK_COMMA),o.push(a);return this.match(nt.TOK_RPAREN),{name:s,type:"Function",children:o};case nt.TOK_FILTER:const u=this.expression(0);return this.match(nt.TOK_RBRACKET),n=this.lookahead(0)===nt.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(Or.Filter),{type:"FilterProjection",children:[r,n,u]};case nt.TOK_FLATTEN:const l={type:nt.TOK_FLATTEN,children:[r]},h=this.parseProjectionRHS(Or.Flatten);return{type:"Projection",children:[l,h]};case nt.TOK_EQ:case nt.TOK_NE:case nt.TOK_GT:case nt.TOK_GTE:case nt.TOK_LT:case nt.TOK_LTE:return this.parseComparator(r,t);case nt.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===nt.TOK_NUMBER||d.type===nt.TOK_COLON?(n=this.parseIndexExpression(),this.projectIfSlice(r,n)):(this.match(nt.TOK_STAR),this.match(nt.TOK_RBRACKET),n=this.parseProjectionRHS(Or.Star),{type:"Projection",children:[r,n]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const r=this.lookaheadToken(0);this.errorToken(r,`Expected ${t}, got: ${r.type}`)}}errorToken(t,r=""){const n=new Error(r||`Invalid token (${t.type}): "${t.value}"`);throw n.name="ParserError",n}parseIndexExpression(){if(this.lookahead(0)===nt.TOK_COLON||this.lookahead(1)===nt.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(nt.TOK_RBRACKET),t}projectIfSlice(t,r){const n={type:"IndexExpression",children:[t,r]};return r.type==="Slice"?{children:[n,this.parseProjectionRHS(Or.Star)],type:"Projection"}:n}parseSliceExpression(){const t=[null,null,null];let r=0,n=this.lookahead(0);for(;n!==nt.TOK_RBRACKET&&r<3;){if(n===nt.TOK_COLON)r+=1,this.advance();else if(n===nt.TOK_NUMBER)t[r]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}n=this.lookahead(0)}return this.match(nt.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,r){const n=this.expression(Or[r]);return{type:"Comparator",name:r,children:[t,n]}}parseDotRHS(t){const r=this.lookahead(0);if([nt.TOK_UNQUOTEDIDENTIFIER,nt.TOK_QUOTEDIDENTIFIER,nt.TOK_STAR].includes(r))return this.expression(t);if(r===nt.TOK_LBRACKET)return this.match(nt.TOK_LBRACKET),this.parseMultiselectList();if(r===nt.TOK_LBRACE)return this.match(nt.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(Or[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===nt.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===nt.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===nt.TOK_DOT)return this.match(nt.TOK_DOT),this.parseDotRHS(t);const r=this.lookaheadToken(0);this.errorToken(r,`Syntax error, unexpected token: ${r.value}(${r.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==nt.TOK_RBRACKET;){const r=this.expression(0);if(t.push(r),this.lookahead(0)===nt.TOK_COMMA&&(this.match(nt.TOK_COMMA),this.lookahead(0)===nt.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(nt.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],r=[nt.TOK_UNQUOTEDIDENTIFIER,nt.TOK_QUOTEDIDENTIFIER];let n,i,s;for(;;){if(n=this.lookaheadToken(0),!r.includes(n.type))throw new Error(`Expecting an identifier token, got: ${n.type}`);if(i=n.value,this.advance(),this.match(nt.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===nt.TOK_COMMA)this.match(nt.TOK_COMMA);else if(this.lookahead(0)===nt.TOK_RBRACE){this.match(nt.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const j5=new D5;var mt;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(mt||(mt={}));class z5{constructor(t){this.TYPE_NAME_TABLE={[mt.TYPE_NUMBER]:"number",[mt.TYPE_ANY]:"any",[mt.TYPE_STRING]:"string",[mt.TYPE_ARRAY]:"array",[mt.TYPE_OBJECT]:"object",[mt.TYPE_BOOLEAN]:"boolean",[mt.TYPE_EXPREF]:"expression",[mt.TYPE_NULL]:"null",[mt.TYPE_ARRAY_NUMBER]:"Array<number>",[mt.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([r])=>Math.abs(r),this.functionAvg=([r])=>{let n=0;for(let i=0;i<r.length;i+=1)n+=r[i];return n/r.length},this.functionCeil=([r])=>Math.ceil(r),this.functionContains=r=>{const[n,i]=r;return n.includes(i)},this.functionEndsWith=r=>{const[n,i]=r;return n.includes(i,n.length-i.length)},this.functionFloor=([r])=>Math.floor(r),this.functionJoin=r=>{const[n,i]=r;return i.join(n)},this.functionKeys=([r])=>Object.keys(r),this.functionLength=([r])=>Go(r)?Object.keys(r).length:r.length,this.functionMap=r=>{if(!this._interpreter)return[];const n=[],i=this._interpreter,s=r[0],o=r[1];for(let a=0;a<o.length;a+=1)n.push(i.visit(s,o[a]));return n},this.functionMax=([r])=>{if(!r.length)return null;if(this.getTypeName(r[0])===mt.TYPE_NUMBER)return Math.max(...r);const i=r;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=r=>{const n=r[1],i=r[0],s=this.createKeyFunction(n,[mt.TYPE_NUMBER,mt.TYPE_STRING]);let o=-1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c>o&&(o=c,a=i[u]);return a},this.functionMerge=r=>{let n={};for(let i=0;i<r.length;i+=1){const s=r[i];n=Object.assign(n,s)}return n},this.functionMin=([r])=>{if(!r.length)return null;if(this.getTypeName(r[0])===mt.TYPE_NUMBER)return Math.min(...r);const i=r;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=r=>{const n=r[1],i=r[0],s=this.createKeyFunction(n,[mt.TYPE_NUMBER,mt.TYPE_STRING]);let o=1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c<o&&(o=c,a=i[u]);return a},this.functionNotNull=r=>{for(let n=0;n<r.length;n+=1)if(this.getTypeName(r[n])!==mt.TYPE_NULL)return r[n];return null},this.functionReverse=([r])=>{if(this.getTypeName(r)===mt.TYPE_STRING){const s=r;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=r.slice(0);return i.reverse(),i},this.functionSort=([r])=>[...r].sort(),this.functionSortBy=r=>{if(!this._interpreter)return[];const n=r[0].slice(0);if(n.length===0)return n;const i=this._interpreter,s=r[1],o=this.getTypeName(i.visit(s,n[0]));if(o!==void 0&&![mt.TYPE_NUMBER,mt.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<n.length;c+=1)a.push([c,n[c]]);a.sort((c,u)=>{const l=i.visit(s,c[1]),h=i.visit(s,u[1]);if(this.getTypeName(l)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(l)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return l>h?1:l<h?-1:c[0]-u[0]});for(let c=0;c<a.length;c+=1)n[c]=a[c][1];return n},this.functionStartsWith=([r,n])=>r.startsWith(n),this.functionSum=([r])=>r.reduce((n,i)=>n+i,0),this.functionToArray=([r])=>this.getTypeName(r)===mt.TYPE_ARRAY?r:[r],this.functionToNumber=([r])=>{const n=this.getTypeName(r);let i;return n===mt.TYPE_NUMBER?r:n===mt.TYPE_STRING&&(i=+r,!isNaN(i))?i:null},this.functionToString=([r])=>this.getTypeName(r)===mt.TYPE_STRING?r:JSON.stringify(r),this.functionType=([r])=>{switch(this.getTypeName(r)){case mt.TYPE_NUMBER:return"number";case mt.TYPE_STRING:return"string";case mt.TYPE_ARRAY:return"array";case mt.TYPE_OBJECT:return"object";case mt.TYPE_BOOLEAN:return"boolean";case mt.TYPE_EXPREF:return"expref";case mt.TYPE_NULL:return"null";default:return}},this.functionValues=([r])=>Object.values(r),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[mt.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[mt.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[mt.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[mt.TYPE_STRING,mt.TYPE_ARRAY]},{types:[mt.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[mt.TYPE_STRING]},{types:[mt.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[mt.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[mt.TYPE_STRING]},{types:[mt.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[mt.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[mt.TYPE_STRING,mt.TYPE_ARRAY,mt.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[mt.TYPE_EXPREF]},{types:[mt.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[mt.TYPE_ARRAY_NUMBER,mt.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[mt.TYPE_ARRAY]},{types:[mt.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[mt.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[mt.TYPE_ARRAY_NUMBER,mt.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[mt.TYPE_ARRAY]},{types:[mt.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[mt.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[mt.TYPE_STRING,mt.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[mt.TYPE_ARRAY_STRING,mt.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[mt.TYPE_ARRAY]},{types:[mt.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[mt.TYPE_STRING]},{types:[mt.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[mt.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[mt.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[mt.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[mt.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[mt.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[mt.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,r,n){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:r.bind(this),_signature:n}}callFunction(t,r){const n=this.functionTable[t];if(n===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,r,n._signature),n._func.call(this,r)}validateInputSignatures(t,r){for(let n=0;n<r.length;n+=1)if("variadic"in r[n]&&n!==r.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${n+1} must occur last`)}validateArgs(t,r,n){var i,s;let o;this.validateInputSignatures(t,n);const a=n.filter(p=>{var g;return(g=!p.optional)!==null&&g!==void 0?g:!1}).length,c=(s=(i=n[n.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,u=r.length<a,l=r.length>n.length,h=u&&(!c&&a>1||c)?"at least ":"";if(c&&u||!c&&(u||l))throw o=n.length>1,new Error(`ArgumentError: ${t}() takes ${h}${a} argument${o&&"s"||""} but received ${r.length}`);let d,f,m;for(let p=0;p<n.length;p+=1){m=!1,d=n[p].types,f=this.getTypeName(r[p]);let g;for(g=0;g<d.length;g+=1)if(f!==void 0&&this.typeMatches(f,d[g],r[p])){m=!0;break}if(!m&&f!==void 0){const y=d.map(b=>this.TYPE_NAME_TABLE[b]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${p+1} to be type (${y}) but received type ${this.TYPE_NAME_TABLE[f]} instead.`)}}}typeMatches(t,r,n){if(r===mt.TYPE_ANY)return!0;if(r===mt.TYPE_ARRAY_STRING||r===mt.TYPE_ARRAY_NUMBER||r===mt.TYPE_ARRAY){if(r===mt.TYPE_ARRAY)return t===mt.TYPE_ARRAY;if(t===mt.TYPE_ARRAY){let i;r===mt.TYPE_ARRAY_NUMBER?i=mt.TYPE_NUMBER:r===mt.TYPE_ARRAY_STRING&&(i=mt.TYPE_STRING);for(let s=0;s<n.length;s+=1){const o=this.getTypeName(n[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,n[s]))return!1}return!0}}else return t===r;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return mt.TYPE_STRING;case"[object Number]":return mt.TYPE_NUMBER;case"[object Array]":return mt.TYPE_ARRAY;case"[object Boolean]":return mt.TYPE_BOOLEAN;case"[object Null]":return mt.TYPE_NULL;case"[object Object]":return t.jmespathType===nt.TOK_EXPREF?mt.TYPE_EXPREF:mt.TYPE_OBJECT;default:return}}createKeyFunction(t,r){if(!this._interpreter)return;const n=this._interpreter;return s=>{const o=n.visit(t,s);if(!r.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${r.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class W5{constructor(){this._rootValue=null,this.runtime=new z5(this)}search(t,r){return this._rootValue=r,this.visit(t,r)}visit(t,r){let n,i,s,o,a,c,u,l,h,d,f;switch(t.type){case"Field":return r===null?null:Go(r)?(c=r[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],r),d=1;d<t.children.length;d+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return u=this.visit(t.children[0],r),l=this.visit(t.children[1],u),l;case"Index":if(!Array.isArray(r))return null;let m=t.value;return m<0&&(m=r.length+m),s=r[m],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(r))return null;const p=[...t.children],g=this.computeSliceParams(r.length,p),[y,b,T]=g;if(s=[],T>0)for(d=y;d<b;d+=T)s.push(r[d]);else for(d=y;d>b;d+=T)s.push(r[d]);return s;case"Projection":if(f=this.visit(t.children[0],r),!Array.isArray(f))return null;for(h=[],d=0;d<f.length;d+=1)i=this.visit(t.children[1],f[d]),i!==null&&h.push(i);return h;case"ValueProjection":if(f=this.visit(t.children[0],r),!Go(f))return null;h=[];const A=Object.values(f);for(d=0;d<A.length;d+=1)i=this.visit(t.children[1],A[d]),i!==null&&h.push(i);return h;case"FilterProjection":if(f=this.visit(t.children[0],r),!Array.isArray(f))return null;const x=[],I=[];for(d=0;d<f.length;d+=1)n=this.visit(t.children[2],f[d]),Fu(n)||x.push(f[d]);for(let O=0;O<x.length;O+=1)i=this.visit(t.children[1],x[O]),i!==null&&I.push(i);return I;case"Comparator":switch(o=this.visit(t.children[0],r),a=this.visit(t.children[1],r),t.name){case nt.TOK_EQ:s=Pu(o,a);break;case nt.TOK_NE:s=!Pu(o,a);break;case nt.TOK_GT:s=o>a;break;case nt.TOK_GTE:s=o>=a;break;case nt.TOK_LT:s=o<a;break;case nt.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case nt.TOK_FLATTEN:const R=this.visit(t.children[0],r);if(!Array.isArray(R))return null;let $=[];for(d=0;d<R.length;d+=1)i=R[d],Array.isArray(i)?$=[...$,...i]:$.push(i);return $;case"Identity":return r;case"MultiSelectList":if(r===null)return null;for(h=[],d=0;d<t.children.length;d+=1)h.push(this.visit(t.children[d],r));return h;case"MultiSelectHash":if(r===null)return null;h={};let M;for(d=0;d<t.children.length;d+=1)M=t.children[d],h[M.name]=this.visit(M.value,r);return h;case"OrExpression":return n=this.visit(t.children[0],r),Fu(n)&&(n=this.visit(t.children[1],r)),n;case"AndExpression":return o=this.visit(t.children[0],r),Fu(o)?o:this.visit(t.children[1],r);case"NotExpression":return o=this.visit(t.children[0],r),Fu(o);case"Literal":return t.value;case nt.TOK_PIPE:return u=this.visit(t.children[0],r),this.visit(t.children[1],u);case nt.TOK_CURRENT:return r;case nt.TOK_ROOT:return this._rootValue;case"Function":const H=[];for(let O=0;O<t.children.length;O+=1)H.push(this.visit(t.children[O],r));return this.runtime.callFunction(t.name,H);case"ExpressionReference":const X=t.children[0];return X.jmespathType=nt.TOK_EXPREF,X;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,r){let[n,i,s]=r;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return n=n===null?o?t-1:0:this.capSliceRange(t,n,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[n,i,s]}capSliceRange(t,r,n){let i=r;return i<0?(i+=t,i<0&&(i=n<0?-1:0)):i>=t&&(i=n<0?t-1:t),i}}const H5=new W5;mt.TYPE_ANY,mt.TYPE_ARRAY,mt.TYPE_ARRAY_NUMBER,mt.TYPE_ARRAY_STRING,mt.TYPE_BOOLEAN,mt.TYPE_EXPREF,mt.TYPE_NULL,mt.TYPE_NUMBER,mt.TYPE_OBJECT,mt.TYPE_STRING;function G5(e,t){const r=j5.parse(t);return H5.search(r,e)}const K5=(e,t)=>{const r=Ho(e.id());if(!w(r))return 0;const[n,i]=ut(t,0,[q.NAME,q.NAME]),s=G5(r.json,n);return e.set(i,s),0},Y5=(e,t)=>{const r=Ho(e.id());if(!w(r))return 0;const[n,i]=ut(t,0,[q.NAME]);switch(Dt(n)){case"seek":{const[o]=ut(t,i,[q.NUMBER]);r.cursor=Ge(o,0,r.lines.length-1);break}case"line":r.cursor=Ge(r.cursor+1,0,r.lines.length-1);break;default:{const o=r.lines[r.cursor]??"",c=new RegExp(n,"i").exec(o)??[];let u=1;for(let l=i;l<t.length;){const[h,d]=ut(t,l,[q.NAME]);e.set(h,c[u]??0),++u,l=d}break}}return 0};function Ck(e){const t=ge(Xt.MAIN),r=Do(t);w(e.targetdir)?Jo(e.targetdir.destpt,e.label,void 0,r):w(e.targetname)&&Jo(e.targetname,e.label,void 0,r)}const q5=Si({get(e,t){const r=C5(e.id());if(t==="format")return[!0,r];switch(r){case"text":{const n=Ho(e.id());switch(t){case"filename":return[!0,n.filename];case"cursor":return[!0,n.cursor];case"lines":return[!0,n.lines.length]}break}case"json":{const n=Ho(e.id());switch(t){case"filename":return[!0,n.filename]}break}case"binary":{const n=Ho(e.id());switch(t){case"filename":return[!0,n.filename];case"cursor":return[!0,n.cursor];case"bytes":return[!0,n.bytes.length]}break}}return[!1,void 0]}}).command("shortsend",(e,t)=>{const r=$i(t);return Ck(r),0}).command("send",(e,t)=>{const r=$i(t,!0);return Ck(r),0}).command("stat",()=>0).command("text",(e,t)=>{const r=t.map(Ie).join(" ");return Re(lt,k.elementfocus,"$175",r),0}).command("hyperlink",(e,t)=>{const[r,...n]=t,i=Ie(r),s=$i(n);return w(s.targetname)&&Re(lt,k.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",Y5).command("readjson",K5).command("readbin",L5).command("withboard",(e,t)=>{const[r]=ut(t,0,[q.STRING]),n=br(r);return w(n)&&(k.board=n,k.element={x:-1,y:-1}),0});function Lk(e,t,r,n,i,s){const o=[];for(let a=s;a<i.length;){const[c,u]=ut(i,a,[q.ANY]);pe(c)&&!Hr(c)&&!cc(c)&&!Mu(c)&&!Cr(c)?o.push(...c):o.push(c),a=u}switch(Dt(n)){case"get":case"post:json":dT(lt,k.elementfocus,e,t,r,n,o);break}return 0}const V5=Si().command("fetch",(e,t)=>{const[r,n,i="get",s]=ut(t,0,[q.NAME,q.NAME,q.MAYBE_STRING]);return Lk(void 0,r,n,i,t,s),0}).command("fetchwith",(e,t)=>{const[r,n,i,s="get",o]=ut(t,0,[q.ANY,q.NAME,q.NAME,q.MAYBE_STRING]);return Lk(r,n,i,s,t,o),0}).command("chat",(e,t)=>{const[r]=ut(t,0,[q.MAYBE_NAME]);return r?fT(lt,k.elementfocus,r):hT(lt,k.elementfocus),0}).command("broadcast",(e,t)=>{const[r]=ut(t,0,[q.MAYBE_NAME]);return r?lT(lt,k.elementfocus,r):uT(lt,k.elementfocus),0});function Mk(e,t){var r;if(w(t.targetname)){const n=Object.keys(((r=k.board)==null?void 0:r.objects)??{});switch(t.targetname){case"all":for(let i=0;i<n.length;++i){const s=n[i];e.send(k.elementfocus,s,t.label)}break;case"others":for(let i=0;i<n.length;++i){const s=n[i];s!==e.id()&&e.send(k.elementfocus,s,t.label)}break;case"self":k.elementid!==e.id()?e.send(k.elementfocus,k.elementid,t.label):e.message({session:lt.session(),player:k.elementfocus,id:We(),sender:k.elementid,target:t.label});break;default:{const i=Dx(k.board,[t.targetname]);for(let s=0;s<i.length;++s){const o=i[s];w(o.id)&&e.send(k.elementfocus,o.id,t.label)}break}}}else if(w(t.targetdir)){const n=oe(k.board,t.targetdir.destpt);w(n==null?void 0:n.id)&&e.send(k.elementfocus,n.id,t.label)}}const X5=Si({set(e,t,r){return l7(e,t,r),[!1,void 0]},everytick(){var r,n,i;const e=cr(k.elementid),[t]=e;if(e.length===1&&yt(t)){if(w(k.element))if(t.trim().length===0){const s=Ue(k.elementid);s.sidebar=[]}else k.element.tickertext=t,k.element.tickertime=k.timestamp}else if(e.length>1)if(k.elementisplayer){const s=Ue(k.elementid);s.sidebar=Xx(e)}else{const s=Ue(k.elementfocus);s.scrollname=((r=k.element)==null?void 0:r.name)??((i=(n=k.element)==null?void 0:n.kinddata)==null?void 0:i.name)??"",s.scroll=Xx(e)}}}).command("shortsend",(e,t)=>{const r=$i(t);return Mk(e,r),0}).command("send",(e,t)=>{const r=$i(t,!0);return Mk(e,r),0}).command("stat",()=>0).command("text",(e,t)=>{const r=t.map(Ie).join("");return Nt(k.elementid,r),0}).command("hyperlink",(e,t)=>{const[r,...n]=t,i=Ie(r),s=$i(n);return w(s.targetname)&&$t(k.elementid,e.id(),i,`${s.targetname}:${s.label}`.split(" "),e.get,e.set),0});function J5(e,t,r,n,i){if(!w(k.book))return;const s=k.book,o=or(s,vt.BOARD,e),a=Ce(o);if(!w(a))return;const c=Qu(),u=i==="all"||i==="object",l=i==="all"||i==="terrain";gr(a),gr(c);const h=-Math.tan(t*.5),d=Math.sin(t),f=Math.round(12.5*h),m=Math.round(12.5*d),p=new Array(Zt).fill(0);ny(f,0,-f,Zt-1).forEach(A=>{A.x<0?p[A.y]=Math.min(p[A.y],A.x):p[A.y]=Math.max(p[A.y],A.x)});const y=new Array(Ct).fill(0);ny(0,m,Ct-1,-m).forEach(A=>{A.y<0?y[A.x]=Math.min(y[A.x],A.y):y[A.x]=Math.max(y[A.x],A.y)});const T=[p,y,p];for(let A=0;A<T.length;++A){const x=T[A];if(A!==1){for(let I=0;I<Zt;++I){const R=x[I],$=I*Ct;for(let M=0;M<Ct;M++){const H=(M+R+Ct)%Ct;l&&(c.terrain[H+$]=a.terrain[M+$])}}if(u){const I=Object.keys(a.objects);for(let R=0;R<I.length;++R){const $=I[R],{x:M,y:H}=a.objects[$];if(w(M)&&w(H)){const X=x[H];a.objects[$].x=(M+X+Ct)%Ct,a.objects[$].lx=a.objects[$].x}}}}if(A===1){for(let I=0;I<Ct;++I){const R=x[I];for(let $=0;$<Zt;++$){const M=($+R+Zt)%Zt;l&&(c.terrain[I+M*Ct]=a.terrain[I+$*Ct])}}if(u){const I=Object.keys(a.objects);for(let R=0;R<I.length;++R){const $=I[R],{x:M,y:H}=a.objects[$];if(w(M)&&w(H)){const X=x[M];a.objects[$].y=(H+X+Zt)%Zt,a.objects[$].ly=a.objects[$].y}}}}l&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,gr(c),gr(a)}}function Z5(e,t){let r=0,n=0,i=0;for(;i<e.length;i++)r+=e[i];for(i=0,t*=r;t&&i<e.length;){if(n+=e[i],t<=n)return i;i++}return 0}var Q5=Z5;const tj=Q5,ue=function(){};ue.prototype.FMX=0,ue.prototype.FMY=0,ue.prototype.FMXxFMY=0,ue.prototype.T=0,ue.prototype.N=0,ue.prototype.initiliazedField=!1,ue.prototype.generationComplete=!1,ue.prototype.wave=null,ue.prototype.compatible=null,ue.prototype.weightLogWeights=null,ue.prototype.sumOfWeights=0,ue.prototype.sumOfWeightLogWeights=0,ue.prototype.startingEntropy=0,ue.prototype.sumsOfOnes=null,ue.prototype.sumsOfWeights=null,ue.prototype.sumsOfWeightLogWeights=null,ue.prototype.entropies=null,ue.prototype.propagator=null,ue.prototype.observed=null,ue.prototype.distribution=null,ue.prototype.stack=null,ue.prototype.stackSize=0,ue.prototype.DX=[-1,0,1,0],ue.prototype.DY=[0,1,0,-1],ue.prototype.opposite=[2,3,0,1],ue.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},ue.prototype.observe=function(e){let t=1e3,r=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,r=s)}}if(r===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[r][s]?this.weights[s]:0;const n=tj(this.distribution,e()),i=this.wave[r];for(let s=0;s<this.T;s++)i[s]!==(s===n)&&this.ban(r,s);return null},ue.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],r=t%this.FMX,n=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=r+s,c=n+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const u=a+c*this.FMX,l=this.propagator[i][e[1]],h=this.compatible[u];for(let d=0;d<l.length;d++){const f=l[d],m=h[f];m[i]--,m[i]==0&&this.ban(u,f)}}}},ue.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},ue.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let r=0;r<e||e===0;r++){const n=this.singleIteration(t);if(n!==null)return!!n}return!0},ue.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},ue.prototype.isGenerationComplete=function(){return this.generationComplete},ue.prototype.ban=function(e,t){const r=this.compatible[e][t];for(let i=0;i<4;i++)r[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const n=this.sumsOfWeights[e];this.entropies[e]=Math.log(n)-this.sumsOfWeightLogWeights[e]/n},ue.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let r=0;r<4;r++)this.compatible[e][t][r]=this.propagator[this.opposite[r]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var Uk=ue;const Pk=Uk,Bi=function(t,r,n,i,s,o,a,c,u,l){l=l||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const h=r,d=new Array(h);for(let M=0;M<h;M++)d[M]=new Array(n);this.colors=[];const f={};for(let M=0;M<n;M++)for(let H=0;H<r;H++){const X=(M*r+H)*4,O=[t[X],t[X+1],t[X+2],t[X+3]],N=O.join("-");f.hasOwnProperty(N)||(f[N]=this.colors.length,this.colors.push(O)),d[H][M]=f[N]}const m=this.colors.length,p=Math.pow(m,i*i),g=function(H){let X=new Array(i*i);for(let O=0;O<i;O++)for(let N=0;N<i;N++)X[N+O*i]=H(N,O);return X},y=function(H,X){return g(function(O,N){return d[(H+O)%r][(X+N)%n]})},b=function(H){return g(function(X,O){return H[i-1-O+X*i]})},T=function(H){return g(function(X,O){return H[i-1-X+O*i]})},A=function(H){let X=0,O=1;for(let N=0;N<H.length;N++)X+=H[H.length-1-N]*O,O*=m;return X},x=function(H){let X=H,O=p;const N=new Array(i*i);for(let E=0;E<N.length;E++){O/=m;let L=0;for(;X>=O;)X-=O,L++;N[E]=L}return N},I={},R=[];for(let M=0;M<(a?n:n-i+1);M++)for(let H=0;H<(a?r:r-i+1);H++){const X=new Array(8);X[0]=y(H,M),X[1]=T(X[0]),X[2]=b(X[0]),X[3]=T(X[2]),X[4]=b(X[2]),X[5]=T(X[4]),X[6]=b(X[4]),X[7]=T(X[6]);for(let O=0;O<u;O++){const N=A(X[O]);I[N]?I[N]++:(R.push(N),I[N]=1)}}this.T=R.length,this.ground=(l+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let M=0;M<this.T;M++){const H=parseInt(R[M],10);this.patterns[M]=x(H),this.weights[M]=I[H]}const $=function(H,X,O,N){const E=O<0?0:O,L=O<0?O+i:i,j=N<0?0:N,U=N<0?N+i:i;for(let V=j;V<U;V++)for(let Q=E;Q<L;Q++)if(H[Q+i*V]!=X[Q-O+i*(V-N)])return!1;return!0};this.propagator=new Array(4);for(let M=0;M<4;M++){this.propagator[M]=new Array(this.T);for(let H=0;H<this.T;H++){const X=[];for(let O=0;O<this.T;O++)$(this.patterns[H],this.patterns[O],this.DX[M],this.DY[M])&&X.push(O);this.propagator[M][H]=X}}};Bi.prototype=Object.create(Pk.prototype),Bi.prototype.constructor=Bi,Bi.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},Bi.prototype.clear=function(){if(Pk.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},Bi.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},Bi.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const r=t<this.FMY-this.N+1?0:this.N-1;for(let n=0;n<this.FMX;n++){const i=n<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+n)*4,o=this.colors[this.patterns[this.observed[n-i+(t-r)*this.FMX]][i+r*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},Bi.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const r=t%this.FMX,n=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let l=0;l<this.N;l++)for(let h=0;h<this.N;h++){let d=r-h;d<0&&(d+=this.FMX);let f=n-l;if(f<0&&(f+=this.FMY),this.onBoundary(d,f))continue;const m=d+f*this.FMX;for(let p=0;p<this.T;p++)if(this.wave[m][p]){i++;const g=this.colors[this.patterns[p][h+l*this.N]];s+=g[0],o+=g[1],a+=g[2],c+=g[3]}}const u=t*4;e[u]=s/i,e[u+1]=o/i,e[u+2]=a/i,e[u+3]=c/i}};var ej=Bi;const rj=Uk,is=function(t,r,n,i,s){const o=t.tilesize||16;this.FMX=n,this.FMY=i,this.FMXxFMY=n*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;r&&t.subsets&&t.subsets[r]&&(c=t.subsets[r]);const u=function(A){const x=new Array(o*o);for(let I=0;I<o;I++)for(let R=0;R<o;R++)x[R+I*o]=A(R,I);return x},l=function(A){return u(function(x,I){return A[o-1-I+x*o]})},h=function(A){return u(function(x,I){return A[o-1-x+I*o]})};this.tiles=[];const d=[],f=[],m={};let p,g,y;for(let T=0;T<t.tiles.length;T++){const A=t.tiles[T];if(c!==null&&c.indexOf(A.name)===-1)continue;switch(A.symmetry){case"L":y=4,p=function(I){return(I+1)%4},g=function(I){return I%2===0?I+1:I-1};break;case"T":y=4,p=function(I){return(I+1)%4},g=function(I){return I%2===0?I:4-I};break;case"I":y=2,p=function(I){return 1-I},g=function(I){return I};break;case"\\":y=2,p=function(I){return 1-I},g=function(I){return 1-I};break;case"F":y=8,p=function(I){return I<4?(I+1)%4:4+(I-1)%4},g=function(I){return I<4?I+4:I-4};break;default:y=1,p=function(I){return I},g=function(I){return I};break}this.T=f.length,m[A.name]=this.T;for(let I=0;I<y;I++)f.push([this.T+I,this.T+p(I),this.T+p(p(I)),this.T+p(p(p(I))),this.T+g(I),this.T+g(p(I)),this.T+g(p(p(I))),this.T+g(p(p(p(I))))]);let x;if(a)for(let I=0;I<y;I++)x=A.bitmap[I],this.tiles.push(u(function(R,$){return[x[(o*$+R)*4],x[(o*$+R)*4+1],x[(o*$+R)*4+2],x[(o*$+R)*4+3]]}));else{x=A.bitmap,this.tiles.push(u(function(I,R){return[x[(o*R+I)*4],x[(o*R+I)*4+1],x[(o*R+I)*4+2],x[(o*R+I)*4+3]]}));for(let I=1;I<y;I++)this.tiles.push(I<4?l(this.tiles[this.T+I-1]):h(this.tiles[this.T+I-4]))}for(let I=0;I<y;I++)d.push(A.weight||1)}this.T=f.length,this.weights=d,this.propagator=new Array(4);const b=new Array(4);for(let T=0;T<4;T++){this.propagator[T]=new Array(this.T),b[T]=new Array(this.T);for(let A=0;A<this.T;A++){b[T][A]=new Array(this.T);for(let x=0;x<this.T;x++)b[T][A][x]=!1}}for(let T=0;T<t.neighbors.length;T++){const A=t.neighbors[T],x=A.left.split(" ").filter(function(X){return X.length}),I=A.right.split(" ").filter(function(X){return X.length});if(c!==null&&(c.indexOf(x[0])===-1||c.indexOf(I[0])===-1))continue;const R=f[m[x[0]]][x.length==1?0:parseInt(x[1],10)],$=f[R][1],M=f[m[I[0]]][I.length==1?0:parseInt(I[1],10)],H=f[M][1];b[0][M][R]=!0,b[0][f[M][6]][f[R][6]]=!0,b[0][f[R][4]][f[M][4]]=!0,b[0][f[R][2]][f[M][2]]=!0,b[1][H][$]=!0,b[1][f[$][6]][f[H][6]]=!0,b[1][f[H][4]][f[$][4]]=!0,b[1][f[$][2]][f[H][2]]=!0}for(let T=0;T<this.T;T++)for(let A=0;A<this.T;A++)b[2][T][A]=b[0][A][T],b[3][T][A]=b[1][A][T];for(let T=0;T<4;T++)for(let A=0;A<this.T;A++){const x=[],I=b[T][A];for(let R=0;R<this.T;R++)I[R]&&x.push(R);this.propagator[T][A]=x}};is.prototype=Object.create(rj.prototype),is.prototype.constructor=is,is.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},is.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},is.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let r=0;r<this.FMY;r++){const n=this.tiles[this.observed[t+r*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(r*this.tilesize+i)*this.FMX*this.tilesize)*4,a=n[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},is.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let r=0;r<this.FMX;r++)for(let n=0;n<this.FMY;n++){const i=this.wave[r+n*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let u=0;u<this.tilesize;u++){const l=(r*this.tilesize+u+(n*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];else{let h=0,d=0,f=0,m=0;for(let p=0;p<this.T;p++)if(i[p]){const g=this.tiles[p][u+c*this.tilesize],y=this.weights[p]*a;h+=g[0]*y,d+=g[1]*y,f+=g[2]*y,m+=g[3]*y}e[l]=h,e[l+1]=d,e[l+2]=f,e[l+3]=m}}}};var nj=is,ij={OverlappingModel:ej,SimpleTiledModel:nj},sj=ps(ij);const Fk=5;function $k(e,t,r,n,i,s,o){if(!w(k.book))return!1;const a=k.book,c=or(a,vt.BOARD,e),u=or(a,vt.BOARD,t),l=Ce(c),h=Ce(u);if(!w(l)||!w(h))return!1;gr(l),gr(h);let d=0;const f=new Map,m=new Map;let p=0;const g=32,y=new Uint8Array(Lh*4);for(let R=0;R<Zt;++R)for(let $=0;$<Ct;++$){const M=oe(h,{x:$,y:R}),H=(M==null?void 0:M.char)??0,X=(M==null?void 0:M.color)??g,O=(M==null?void 0:M.bg)??g;y[p++]=H,y[p++]=X,y[p++]=O;const N=Rn(M),E=Dt((N==null?void 0:N.name)??"empty"),L=f.get(E);Et(L)?y[p++]=L:(f.set(E,d),m.set(d,E),y[p++]=d++)}const b=s.x-i.x+1,T=s.y-i.y+1,A=new sj.OverlappingModel(y,Ct,Zt,r,b,T,!1,!1,n,0);let x=0;for(;x<Fk&&!A.generate();++x);if(x===Fk)return!1;p=0;const I=A.graphics();for(let R=i.y;R<=s.y;++R)for(let $=i.x;$<=s.x;++$){const M={x:$,y:R},H=I[p++],X=I[p++],O=I[p++];switch(d=I[p++],o){case"all":{const j=oe(l,{x:$,y:R});De(j)&&wr(l,j,a.timestamp),Me(l,{x:$,y:R});break}case"object":{const j=oe(l,{x:$,y:R});De(j)&&wr(l,j,a.timestamp);break}case"terrain":Me(l,{x:$,y:R});break}let N=m.get(d)??"";const E=Rn({kind:N});switch(o){case"all":break;case"object":De(E)||(N="");break;case"terrain":De(E)&&(N="");break;default:if(Yt(E,"group")!==o&&(N=""),N){const j=oe(l,{x:$,y:R});De(j)&&wr(l,j,a.timestamp),Me(l,{x:$,y:R})}break}const L=N?On(l,[N],M):void 0;if(!(!w(L)||!w(E))&&($o(L,E),H>0&&(L.char=H),X<g&&(L.color=X),O<g&&(L.bg=O),De(L))){const j=bn(wc(h,N));w(j)&&(Me(l,{...us(h,j.x??0,j.y??0),x:$,y:R}),$o(L,j))}}return!0}function Bk(e){return`zss_snapshot_${e}`}const Dk={x:0,y:0},jk={x:Ct-1,y:Zt-1},zk="all";function oj(e){const t=or(k.book,vt.BOARD,e),r=Ce(t);if(!w(r))return;const n=Bk(r.id);qE(k.book,n);const[i]=ls(Xt.MAIN,n,vt.BOARD),s=Ce(i);if(w(s))return Su(e,s.id,Dk,jk,zk),s}function aj(e){const t=or(k.book,vt.BOARD,e),r=Ce(t);if(!w(r))return;const n=Bk(r.id),i=or(k.book,vt.BOARD,n),s=Ce(i);if(w(s))return Su(s.id,e,Dk,jk,zk),s}function cj(e,t,r,n,i,s){switch(s){case"all":case"object":case"terrain":break;default:return lj(e,t,i,s)}if(!w(k.book))return;const o=k.book,a=or(o,vt.BOARD,e),c=Ce(a);if(!w(c))return;const u=Qu();gr(c);for(let l=r.y;l<=n.y;++l)for(let h=r.x;h<=n.x;++h){let d=!1,f=!1;switch(s){case"all":d=!0,f=!0;break;case"object":d=!0;break;case"terrain":f=!0;break}const m=(h+t.x+Ct)%Ct,p=(l+t.y+Zt)%Zt;if(d){const g=oe(c,{x:h,y:l});De(g)&&w(g==null?void 0:g.x)&&w(g==null?void 0:g.y)&&(g.x=m,g.lx=m,g.y=p,g.ly=p)}f&&(u.terrain[m+p*Ct]=c.terrain[h+l*Ct])}(s==="all"||s==="terrain")&&(c.terrain=[...u.terrain]),ac(c)}function lj(e,t,r,n){if(!w(k.book))return;const i=k.book,s=or(i,vt.BOARD,e),o=Ce(s);if(!w(o))return;gr(o);const{terrainelements:a,objectelements:c}=QE(o,r,n);if(a.length===0&&c.length===0)return;const u=c.map(p=>p.id??""),l=a.map(p=>Wr({x:p.x??0,y:p.y??0},Ct)),h=[],d=[];for(let p=0;p<a.length;++p){const g=a[p],y={x:g.x??-1,y:g.y??-1},b=oe(o,y);w(b)&&De(b)&&(h.push(b.id??""),h.push(b.id??""),d.push(Wr({x:b.x??0,y:b.y??0},Ct)))}let f=!1;for(let p=0;p<a.length;++p){const g=a[p],y=Yt(g,"collision"),b={x:g.x??-1,y:g.y??-1},T=Wr(b,Ct),A={x:b.x+t.x,y:b.y+t.y};if(tf(A)){const x=oe(o,A),I=(x==null?void 0:x.id)??"",R=Wr({x:(x==null?void 0:x.x)??0,y:(x==null?void 0:x.y)??0},Ct),$=Yt(x,"collision");if(w(x)&&De(x)&&h.includes(I)!==!0&&u.includes(I)!==!0){let M=!1;const H=d.includes(T),X=H?oe(o,b):void 0,O=H?Yt(X,"pushable"):!1,N=H&&O;if(m0(g,x)&&(y!==Ht.ISWALK||H)){let E=H;w(X)&&O&&(f=Yn(i,o,X,{x:(X.x??0)-t.x,y:(X.y??0)-t.y})!==!0,f||(E=!1)),(E||y!==Ht.ISWALK)&&(f=Yn(i,o,x,{x:(x.x??0)+t.x,y:(x.y??0)+t.y})!==!0,f&&(M=N))}else(y!==Ht.ISWALK||N)&&(f=!0,M=N);M&&w(X)&&(f=Yn(i,o,X,{x:(X.x??0)-t.x,y:(X.y??0)-t.y})!==!0)}else $===Ht.ISSOLID&&l.includes(R)===!1&&(f=!0)}else f=!0}if(f)return;for(let p=0;p<c.length;++p){const g=c[p],y=Yt(g,"collision"),b={x:g.x??0,y:g.y??0},T={x:b.x+t.x,y:b.y+t.y};if(tf(T)){const A=oe(o,T),x=(A==null?void 0:A.id)??"",I=Yt(A,"collision"),R=Yt(A,"group");w(A)&&De(A)&&h.includes(x)&&u.includes(x)!==!0?m0(g,A)?f=Yn(i,o,A,T)!==!0:f=!0:_c(y,I)&&n!==R&&(f=!0)}else f=!0}if(f)return;(t.x>0||t.y>0)&&a.reverse();for(let p=0;p<a.length;++p){const g=a[p],y={x:g.x??-1,y:g.y??-1},b={x:y.x+t.x,y:y.y+t.y},T=us(o,b.x,b.y);if(w(g)&&w(T)){Me(o,{...g,x:b.x,y:b.y}),Me(o,{...T,x:y.x,y:y.y});const A=oe(o,y);De(A)&&w(A)&&(A.x=(A.x??0)+t.x,A.y=(A.y??0)+t.y,A.lx=(A.lx??0)+t.x,A.ly=(A.ly??0)+t.y)}}ac(o);for(let p=0;p<c.length;++p){const g=c[p],y={x:g.x??-1,y:g.y??-1},b={x:y.x+t.x,y:y.y+t.y};if(!Yn(i,o,g,b))break}ac(o)}function $u(e,t){let r="all";const n={x:0,y:0},i={x:Ct-1,y:Zt-1};for(let s=t;s<e.length;){const[o,a]=ut(e,s,[q.MAYBE_NUMBER_OR_STRING]);if(yt(o))r=Dt(o),s=a;else if(Et(o)){const[c,u,l,h]=ut(e,a,[q.NUMBER,q.MAYBE_NUMBER,q.MAYBE_NUMBER]);n.x=Math.min(o,u??o),n.y=Math.min(c,l??c),i.x=Math.max(o,u??o),i.y=Math.max(c,l??c),s=h}else break}return{targetset:r,pt1:n,pt2:i}}const uj=Si().command("snapshot",()=>(!w(k.book)||!w(k.board)||oj(k.board.id),0)).command("revert",()=>(!w(k.book)||!w(k.board)||aj(k.board.id),0)).command("copy",(e,t)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ut(t,0,[q.STRING]),i=bookreadcodepagesbytypeandstat(k.book,vt.BOARD,r),s=bn(...i);if(w(s)){const o=$u(t,n);Su(s.id,k.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(e,t)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n,i,s]=ut(t,0,[q.STRING,q.NUMBER,q.NUMBER]),o=bookreadcodepagesbytypeandstat(k.book,vt.BOARD,r),a=bn(...o);if(w(a)){const c=$u(t,s);$k(k.board.id,a.id,n,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(e,t)=>{var o,a;if(!w(k.book)||!w(k.board))return 0;const[r,n]=ut(t,0,[q.DIR]),i={x:r.destpt.x-(((o=k.element)==null?void 0:o.x)??0),y:r.destpt.y-(((a=k.element)==null?void 0:a.y)??0)},s=$u(t,n);return cj(k.board.id,i,s.pt1,s.pt2,k.elementid,s.targetset),0}).command("pivot",(e,t)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ut(t,0,[q.NUMBER]),i=$u(t,n);return J5(k.board.id,uy(r),i.pt1,i.pt2,i.targetset),0});var ss=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(ss||{});const fj={audio:Uh,board:qF,cli:v5,display:E5,element:I5,runtime:X5,loader:q5,network:V5,transform:uj},zp=["audio","board","display","network","transform","element"],hj={0:[],1:["cli",...zp],2:["loader",...zp],3:["runtime",...zp]},dj={0:new Map,1:new Map,2:new Map,3:new Map};function Ko(e){return(hj[e]??[]).map(r=>fj[r]).filter(w)}function Wp(e){const t=[],r=Ko(e);for(let n=0;n<r.length;++n)t.push(...r[n].listcommands());return t}function pj(e,t){const r=dj[e];if(!r.has(t)){let n;const i=Ko(e);for(let s=0;s<i.length&&(n=i[s].getcommand(t),!w(n));++s);r.set(t,n)}return r.get(t)}function mj(e,t,r){const n=Ko(e);for(let i=0;i<n.length;++i){const s=n[i];if(s.get!==void 0){const[o,a]=s.get(t,r);if(o)return[o,a]}}return[!1,void 0]}function gj(e,t,r,n){const i=Ko(e);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(t,r,n);if(a)return[a,n]}}return[!1,void 0]}function yj(e,t){const r=Ko(e);for(let n=0;n<r.length;++n)r[n].tick(t)}function Wk(e,t){const r=Ko(e);for(let n=0;n<r.length;++n)r[n].everytick(t)}var Hk={},Gk={},Kk={};const Yk="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Kk.encode=function(e){if(0<=e&&e<Yk.length)return Yk[e];throw new TypeError("Must be between 0 and 63: "+e)};const _j=Kk,qk=5,Vk=1<<qk,bj=Vk-1,wj=Vk;function vj(e){return e<0?(-e<<1)+1:(e<<1)+0}Gk.encode=function(t){let r="",n,i=vj(t);do n=i&bj,i>>>=qk,i>0&&(n|=wj),r+=_j.encode(n);while(i>0);return r};var hn={},Ks={},lc={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */lc.exports;var Xk;function Ej(){return Xk||(Xk=1,function(e,t){(function(r){var n=t&&!t.nodeType&&t,i=e&&!e.nodeType&&e,s=typeof tr=="object"&&tr;(s.global===s||s.window===s||s.self===s)&&(r=s);var o,a=2147483647,c=36,u=1,l=26,h=38,d=700,f=72,m=128,p="-",g=/^xn--/,y=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,T={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},A=c-u,x=Math.floor,I=String.fromCharCode,R;function $(K){throw new RangeError(T[K])}function M(K,W){for(var P=K.length,st=[];P--;)st[P]=W(K[P]);return st}function H(K,W){var P=K.split("@"),st="";P.length>1&&(st=P[0]+"@",K=P[1]),K=K.replace(b,".");var G=K.split("."),rt=M(G,W).join(".");return st+rt}function X(K){for(var W=[],P=0,st=K.length,G,rt;P<st;)G=K.charCodeAt(P++),G>=55296&&G<=56319&&P<st?(rt=K.charCodeAt(P++),(rt&64512)==56320?W.push(((G&1023)<<10)+(rt&1023)+65536):(W.push(G),P--)):W.push(G);return W}function O(K){return M(K,function(W){var P="";return W>65535&&(W-=65536,P+=I(W>>>10&1023|55296),W=56320|W&1023),P+=I(W),P}).join("")}function N(K){return K-48<10?K-22:K-65<26?K-65:K-97<26?K-97:c}function E(K,W){return K+22+75*(K<26)-((W!=0)<<5)}function L(K,W,P){var st=0;for(K=P?x(K/d):K>>1,K+=x(K/W);K>A*l>>1;st+=c)K=x(K/A);return x(st+(A+1)*K/(K+h))}function j(K){var W=[],P=K.length,st,G=0,rt=m,wt=f,Tt,It,St,Pt,Mt,Vt,ee,S,ft;for(Tt=K.lastIndexOf(p),Tt<0&&(Tt=0),It=0;It<Tt;++It)K.charCodeAt(It)>=128&&$("not-basic"),W.push(K.charCodeAt(It));for(St=Tt>0?Tt+1:0;St<P;){for(Pt=G,Mt=1,Vt=c;St>=P&&$("invalid-input"),ee=N(K.charCodeAt(St++)),(ee>=c||ee>x((a-G)/Mt))&&$("overflow"),G+=ee*Mt,S=Vt<=wt?u:Vt>=wt+l?l:Vt-wt,!(ee<S);Vt+=c)ft=c-S,Mt>x(a/ft)&&$("overflow"),Mt*=ft;st=W.length+1,wt=L(G-Pt,st,Pt==0),x(G/st)>a-rt&&$("overflow"),rt+=x(G/st),G%=st,W.splice(G++,0,rt)}return O(W)}function U(K){var W,P,st,G,rt,wt,Tt,It,St,Pt,Mt,Vt=[],ee,S,ft,ct;for(K=X(K),ee=K.length,W=m,P=0,rt=f,wt=0;wt<ee;++wt)Mt=K[wt],Mt<128&&Vt.push(I(Mt));for(st=G=Vt.length,G&&Vt.push(p);st<ee;){for(Tt=a,wt=0;wt<ee;++wt)Mt=K[wt],Mt>=W&&Mt<Tt&&(Tt=Mt);for(S=st+1,Tt-W>x((a-P)/S)&&$("overflow"),P+=(Tt-W)*S,W=Tt,wt=0;wt<ee;++wt)if(Mt=K[wt],Mt<W&&++P>a&&$("overflow"),Mt==W){for(It=P,St=c;Pt=St<=rt?u:St>=rt+l?l:St-rt,!(It<Pt);St+=c)ct=It-Pt,ft=c-Pt,Vt.push(I(E(Pt+ct%ft,0))),It=x(ct/ft);Vt.push(I(E(It,0))),rt=L(P,S,st==G),P=0,++st}++P,++W}return Vt.join("")}function V(K){return H(K,function(W){return g.test(W)?j(W.slice(4).toLowerCase()):W})}function Q(K){return H(K,function(W){return y.test(W)?"xn--"+U(W):W})}if(o={version:"1.4.1",ucs2:{decode:X,encode:O},decode:j,encode:U,toASCII:Q,toUnicode:V},n&&i)if(e.exports==n)i.exports=o;else for(R in o)o.hasOwnProperty(R)&&(n[R]=o[R]);else r.punycode=o})(tr)}(lc,lc.exports)),lc.exports}var kj={},xj=Object.freeze({__proto__:null,default:kj}),Aj=AA(xj),Hp,Jk;function Bu(){if(Jk)return Hp;Jk=1;var e=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&e?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,r=e&&t&&typeof t.get=="function"?t.get:null,n=e&&Map.prototype.forEach,i=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=i&&s&&typeof s.get=="function"?s.get:null,a=i&&Set.prototype.forEach,c=typeof WeakMap=="function"&&WeakMap.prototype,u=c?WeakMap.prototype.has:null,l=typeof WeakSet=="function"&&WeakSet.prototype,h=l?WeakSet.prototype.has:null,d=typeof WeakRef=="function"&&WeakRef.prototype,f=d?WeakRef.prototype.deref:null,m=Boolean.prototype.valueOf,p=Object.prototype.toString,g=Function.prototype.toString,y=String.prototype.match,b=String.prototype.slice,T=String.prototype.replace,A=String.prototype.toUpperCase,x=String.prototype.toLowerCase,I=RegExp.prototype.test,R=Array.prototype.concat,$=Array.prototype.join,M=Array.prototype.slice,H=Math.floor,X=typeof BigInt=="function"?BigInt.prototype.valueOf:null,O=Object.getOwnPropertySymbols,N=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,E=typeof Symbol=="function"&&typeof Symbol.iterator=="object",L=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===E||!0)?Symbol.toStringTag:null,j=Object.prototype.propertyIsEnumerable,U=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(D){return D.__proto__}:null);function V(D,Z){if(D===1/0||D===-1/0||D!==D||D&&D>-1e3&&D<1e3||I.call(/e/,Z))return Z;var Bt=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof D=="number"){var jt=D<0?-H(-D):H(D);if(jt!==D){var Gt=String(jt),Ot=b.call(Z,Gt.length+1);return T.call(Gt,Bt,"$&_")+"."+T.call(T.call(Ot,/([0-9]{3})/g,"$&_"),/_$/,"")}}return T.call(Z,Bt,"$&_")}var Q=Aj,K=Q.custom,W=S(K)?K:null,P={__proto__:null,double:'"',single:"'"},st={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};Hp=function D(Z,Bt,jt,Gt){var Ot=Bt||{};if(z(Ot,"quoteStyle")&&!z(P,Ot.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(z(Ot,"maxStringLength")&&(typeof Ot.maxStringLength=="number"?Ot.maxStringLength<0&&Ot.maxStringLength!==1/0:Ot.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var rn=z(Ot,"customInspect")?Ot.customInspect:!0;if(typeof rn!="boolean"&&rn!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(z(Ot,"indent")&&Ot.indent!==null&&Ot.indent!=="	"&&!(parseInt(Ot.indent,10)===Ot.indent&&Ot.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(z(Ot,"numericSeparator")&&typeof Ot.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Cn=Ot.numericSeparator;if(typeof Z>"u")return"undefined";if(Z===null)return"null";if(typeof Z=="boolean")return Z?"true":"false";if(typeof Z=="string")return ye(Z,Ot);if(typeof Z=="number"){if(Z===0)return 1/0/Z>0?"0":"-0";var pn=String(Z);return Cn?V(Z,pn):pn}if(typeof Z=="bigint"){var ds=String(Z)+"n";return Cn?V(Z,ds):ds}var C0=typeof Ot.depth>"u"?5:Ot.depth;if(typeof jt>"u"&&(jt=0),jt>=C0&&C0>0&&typeof Z=="object")return Tt(Z)?"[Array]":"[Object]";var na=F(Ot,jt);if(typeof Gt>"u")Gt=[];else if(dt(Gt,Z)>=0)return"[Circular]";function qn(ia,ff,hW){if(ff&&(Gt=M.call(Gt),Gt.push(ff)),hW){var vA={depth:Ot.depth};return z(Ot,"quoteStyle")&&(vA.quoteStyle=Ot.quoteStyle),D(ia,vA,jt+1,Gt)}return D(ia,Ot,jt+1,Gt)}if(typeof Z=="function"&&!St(Z)){var pA=tt(Z),mA=at(Z,qn);return"[Function"+(pA?": "+pA:" (anonymous)")+"]"+(mA.length>0?" { "+$.call(mA,", ")+" }":"")}if(S(Z)){var gA=E?T.call(String(Z),/^(Symbol\(.*\))_[^)]*$/,"$1"):N.call(Z);return typeof Z=="object"&&!E?Qe(gA):gA}if(Ft(Z)){for(var Ec="<"+x.call(String(Z.nodeName)),L0=Z.attributes||[],uf=0;uf<L0.length;uf++)Ec+=" "+L0[uf].name+"="+G(rt(L0[uf].value),"double",Ot);return Ec+=">",Z.childNodes&&Z.childNodes.length&&(Ec+="..."),Ec+="</"+x.call(String(Z.nodeName))+">",Ec}if(Tt(Z)){if(Z.length===0)return"[]";var M0=at(Z,qn);return na&&!v(M0)?"["+Y(M0,na)+"]":"[ "+$.call(M0,", ")+" ]"}if(Pt(Z)){var U0=at(Z,qn);return!("cause"in Error.prototype)&&"cause"in Z&&!j.call(Z,"cause")?"{ ["+String(Z)+"] "+$.call(R.call("[cause]: "+qn(Z.cause),U0),", ")+" }":U0.length===0?"["+String(Z)+"]":"{ ["+String(Z)+"] "+$.call(U0,", ")+" }"}if(typeof Z=="object"&&rn){if(W&&typeof Z[W]=="function"&&Q)return Q(Z,{depth:C0-jt});if(rn!=="symbol"&&typeof Z.inspect=="function")return Z.inspect()}if(pt(Z)){var yA=[];return n&&n.call(Z,function(ia,ff){yA.push(qn(ff,Z,!0)+" => "+qn(ia,Z))}),_("Map",r.call(Z),yA,na)}if(Rt(Z)){var _A=[];return a&&a.call(Z,function(ia){_A.push(qn(ia,Z))}),_("Set",o.call(Z),_A,na)}if(it(Z))return C("WeakMap");if(gt(Z))return C("WeakSet");if(_t(Z))return C("WeakRef");if(Vt(Z))return Qe(qn(Number(Z)));if(ft(Z))return Qe(qn(X.call(Z)));if(ee(Z))return Qe(m.call(Z));if(Mt(Z))return Qe(qn(String(Z)));if(typeof window<"u"&&Z===window)return"{ [object Window] }";if(typeof globalThis<"u"&&Z===globalThis||typeof tr<"u"&&Z===tr)return"{ [object globalThis] }";if(!It(Z)&&!St(Z)){var P0=at(Z,qn),bA=U?U(Z)===Object.prototype:Z instanceof Object||Z.constructor===Object,F0=Z instanceof Object?"":"null prototype",wA=!bA&&L&&Object(Z)===Z&&L in Z?b.call(B(Z),8,-1):F0?"Object":"",fW=bA||typeof Z.constructor!="function"?"":Z.constructor.name?Z.constructor.name+" ":"",$0=fW+(wA||F0?"["+$.call(R.call([],wA||[],F0||[]),": ")+"] ":"");return P0.length===0?$0+"{}":na?$0+"{"+Y(P0,na)+"}":$0+"{ "+$.call(P0,", ")+" }"}return String(Z)};function G(D,Z,Bt){var jt=Bt.quoteStyle||Z,Gt=P[jt];return Gt+D+Gt}function rt(D){return T.call(String(D),/"/g,"&quot;")}function wt(D){return!L||!(typeof D=="object"&&(L in D||typeof D[L]<"u"))}function Tt(D){return B(D)==="[object Array]"&&wt(D)}function It(D){return B(D)==="[object Date]"&&wt(D)}function St(D){return B(D)==="[object RegExp]"&&wt(D)}function Pt(D){return B(D)==="[object Error]"&&wt(D)}function Mt(D){return B(D)==="[object String]"&&wt(D)}function Vt(D){return B(D)==="[object Number]"&&wt(D)}function ee(D){return B(D)==="[object Boolean]"&&wt(D)}function S(D){if(E)return D&&typeof D=="object"&&D instanceof Symbol;if(typeof D=="symbol")return!0;if(!D||typeof D!="object"||!N)return!1;try{return N.call(D),!0}catch{}return!1}function ft(D){if(!D||typeof D!="object"||!X)return!1;try{return X.call(D),!0}catch{}return!1}var ct=Object.prototype.hasOwnProperty||function(D){return D in this};function z(D,Z){return ct.call(D,Z)}function B(D){return p.call(D)}function tt(D){if(D.name)return D.name;var Z=y.call(g.call(D),/^function\s*([\w$]+)/);return Z?Z[1]:null}function dt(D,Z){if(D.indexOf)return D.indexOf(Z);for(var Bt=0,jt=D.length;Bt<jt;Bt++)if(D[Bt]===Z)return Bt;return-1}function pt(D){if(!r||!D||typeof D!="object")return!1;try{r.call(D);try{o.call(D)}catch{return!0}return D instanceof Map}catch{}return!1}function it(D){if(!u||!D||typeof D!="object")return!1;try{u.call(D,u);try{h.call(D,h)}catch{return!0}return D instanceof WeakMap}catch{}return!1}function _t(D){if(!f||!D||typeof D!="object")return!1;try{return f.call(D),!0}catch{}return!1}function Rt(D){if(!o||!D||typeof D!="object")return!1;try{o.call(D);try{r.call(D)}catch{return!0}return D instanceof Set}catch{}return!1}function gt(D){if(!h||!D||typeof D!="object")return!1;try{h.call(D,h);try{u.call(D,u)}catch{return!0}return D instanceof WeakSet}catch{}return!1}function Ft(D){return!D||typeof D!="object"?!1:typeof HTMLElement<"u"&&D instanceof HTMLElement?!0:typeof D.nodeName=="string"&&typeof D.getAttribute=="function"}function ye(D,Z){if(D.length>Z.maxStringLength){var Bt=D.length-Z.maxStringLength,jt="... "+Bt+" more character"+(Bt>1?"s":"");return ye(b.call(D,0,Z.maxStringLength),Z)+jt}var Gt=st[Z.quoteStyle||"single"];Gt.lastIndex=0;var Ot=T.call(T.call(D,Gt,"\\$1"),/[\x00-\x1f]/g,Jt);return G(Ot,"single",Z)}function Jt(D){var Z=D.charCodeAt(0),Bt={8:"b",9:"t",10:"n",12:"f",13:"r"}[Z];return Bt?"\\"+Bt:"\\x"+(Z<16?"0":"")+A.call(Z.toString(16))}function Qe(D){return"Object("+D+")"}function C(D){return D+" { ? }"}function _(D,Z,Bt,jt){var Gt=jt?Y(Bt,jt):$.call(Bt,", ");return D+" ("+Z+") {"+Gt+"}"}function v(D){for(var Z=0;Z<D.length;Z++)if(dt(D[Z],`
`)>=0)return!1;return!0}function F(D,Z){var Bt;if(D.indent==="	")Bt="	";else if(typeof D.indent=="number"&&D.indent>0)Bt=$.call(Array(D.indent+1)," ");else return null;return{base:Bt,prev:$.call(Array(Z+1),Bt)}}function Y(D,Z){if(D.length===0)return"";var Bt=`
`+Z.prev+Z.base;return Bt+$.call(D,","+Bt)+`
`+Z.prev}function at(D,Z){var Bt=Tt(D),jt=[];if(Bt){jt.length=D.length;for(var Gt=0;Gt<D.length;Gt++)jt[Gt]=z(D,Gt)?Z(D[Gt],D):""}var Ot=typeof O=="function"?O(D):[],rn;if(E){rn={};for(var Cn=0;Cn<Ot.length;Cn++)rn["$"+Ot[Cn]]=Ot[Cn]}for(var pn in D)z(D,pn)&&(Bt&&String(Number(pn))===pn&&pn<D.length||E&&rn["$"+pn]instanceof Symbol||(I.call(/[^\w$]/,pn)?jt.push(Z(pn,D)+": "+Z(D[pn],D)):jt.push(pn+": "+Z(D[pn],D))));if(typeof O=="function")for(var ds=0;ds<Ot.length;ds++)j.call(D,Ot[ds])&&jt.push("["+Z(Ot[ds])+"]: "+Z(D[Ot[ds]],D));return jt}return Hp}var Gp,Zk;function Tj(){if(Zk)return Gp;Zk=1;var e=Bu(),t=Xi,r=function(a,c,u){for(var l=a,h;(h=l.next)!=null;l=h)if(h.key===c)return l.next=h.next,u||(h.next=a.next,a.next=h),h},n=function(a,c){if(a){var u=r(a,c);return u&&u.value}},i=function(a,c,u){var l=r(a,c);l?l.value=u:a.next={key:c,next:a.next,value:u}},s=function(a,c){return a?!!r(a,c):!1},o=function(a,c){if(a)return r(a,c,!0)};return Gp=function(){var c,u={assert:function(l){if(!u.has(l))throw new t("Side channel does not contain "+e(l))},delete:function(l){var h=c&&c.next,d=o(c,l);return d&&h&&h===d&&(c=void 0),!!d},get:function(l){return n(c,l)},has:function(l){return s(c,l)},set:function(l,h){c||(c={next:void 0}),i(c,l,h)}};return u},Gp}var Kp,Qk;function tx(){if(Qk)return Kp;Qk=1;var e=El,t=Zh,r=Bu(),n=Xi,i=e("%Map%",!0),s=t("Map.prototype.get",!0),o=t("Map.prototype.set",!0),a=t("Map.prototype.has",!0),c=t("Map.prototype.delete",!0),u=t("Map.prototype.size",!0);return Kp=!!i&&function(){var h,d={assert:function(f){if(!d.has(f))throw new n("Side channel does not contain "+r(f))},delete:function(f){if(h){var m=c(h,f);return u(h)===0&&(h=void 0),m}return!1},get:function(f){if(h)return s(h,f)},has:function(f){return h?a(h,f):!1},set:function(f,m){h||(h=new i),o(h,f,m)}};return d},Kp}var Yp,ex;function Sj(){if(ex)return Yp;ex=1;var e=El,t=Zh,r=Bu(),n=tx(),i=Xi,s=e("%WeakMap%",!0),o=t("WeakMap.prototype.get",!0),a=t("WeakMap.prototype.set",!0),c=t("WeakMap.prototype.has",!0),u=t("WeakMap.prototype.delete",!0);return Yp=s?function(){var h,d,f={assert:function(m){if(!f.has(m))throw new i("Side channel does not contain "+r(m))},delete:function(m){if(s&&m&&(typeof m=="object"||typeof m=="function")){if(h)return u(h,m)}else if(n&&d)return d.delete(m);return!1},get:function(m){return s&&m&&(typeof m=="object"||typeof m=="function")&&h?o(h,m):d&&d.get(m)},has:function(m){return s&&m&&(typeof m=="object"||typeof m=="function")&&h?c(h,m):!!d&&d.has(m)},set:function(m,p){s&&m&&(typeof m=="object"||typeof m=="function")?(h||(h=new s),a(h,m,p)):n&&(d||(d=n()),d.set(m,p))}};return f}:n,Yp}var qp,rx;function Rj(){if(rx)return qp;rx=1;var e=Xi,t=Bu(),r=Tj(),n=tx(),i=Sj(),s=i||n||r;return qp=function(){var a,c={assert:function(u){if(!c.has(u))throw new e("Side channel does not contain "+t(u))},delete:function(u){return!!a&&a.delete(u)},get:function(u){return a&&a.get(u)},has:function(u){return!!a&&a.has(u)},set:function(u,l){a||(a=s()),a.set(u,l)}};return c},qp}var Vp,nx;function Xp(){if(nx)return Vp;nx=1;var e=String.prototype.replace,t=/%20/g,r={RFC1738:"RFC1738",RFC3986:"RFC3986"};return Vp={default:r.RFC3986,formatters:{RFC1738:function(n){return e.call(n,t,"+")},RFC3986:function(n){return String(n)}},RFC1738:r.RFC1738,RFC3986:r.RFC3986},Vp}var Jp,ix;function sx(){if(ix)return Jp;ix=1;var e=Xp(),t=Object.prototype.hasOwnProperty,r=Array.isArray,n=function(){for(var g=[],y=0;y<256;++y)g.push("%"+((y<16?"0":"")+y.toString(16)).toUpperCase());return g}(),i=function(y){for(;y.length>1;){var b=y.pop(),T=b.obj[b.prop];if(r(T)){for(var A=[],x=0;x<T.length;++x)typeof T[x]<"u"&&A.push(T[x]);b.obj[b.prop]=A}}},s=function(y,b){for(var T=b&&b.plainObjects?{__proto__:null}:{},A=0;A<y.length;++A)typeof y[A]<"u"&&(T[A]=y[A]);return T},o=function g(y,b,T){if(!b)return y;if(typeof b!="object"&&typeof b!="function"){if(r(y))y.push(b);else if(y&&typeof y=="object")(T&&(T.plainObjects||T.allowPrototypes)||!t.call(Object.prototype,b))&&(y[b]=!0);else return[y,b];return y}if(!y||typeof y!="object")return[y].concat(b);var A=y;return r(y)&&!r(b)&&(A=s(y,T)),r(y)&&r(b)?(b.forEach(function(x,I){if(t.call(y,I)){var R=y[I];R&&typeof R=="object"&&x&&typeof x=="object"?y[I]=g(R,x,T):y.push(x)}else y[I]=x}),y):Object.keys(b).reduce(function(x,I){var R=b[I];return t.call(x,I)?x[I]=g(x[I],R,T):x[I]=R,x},A)},a=function(y,b){return Object.keys(b).reduce(function(T,A){return T[A]=b[A],T},y)},c=function(g,y,b){var T=g.replace(/\+/g," ");if(b==="iso-8859-1")return T.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(T)}catch{return T}},u=1024,l=function(y,b,T,A,x){if(y.length===0)return y;var I=y;if(typeof y=="symbol"?I=Symbol.prototype.toString.call(y):typeof y!="string"&&(I=String(y)),T==="iso-8859-1")return escape(I).replace(/%u[0-9a-f]{4}/gi,function(N){return"%26%23"+parseInt(N.slice(2),16)+"%3B"});for(var R="",$=0;$<I.length;$+=u){for(var M=I.length>=u?I.slice($,$+u):I,H=[],X=0;X<M.length;++X){var O=M.charCodeAt(X);if(O===45||O===46||O===95||O===126||O>=48&&O<=57||O>=65&&O<=90||O>=97&&O<=122||x===e.RFC1738&&(O===40||O===41)){H[H.length]=M.charAt(X);continue}if(O<128){H[H.length]=n[O];continue}if(O<2048){H[H.length]=n[192|O>>6]+n[128|O&63];continue}if(O<55296||O>=57344){H[H.length]=n[224|O>>12]+n[128|O>>6&63]+n[128|O&63];continue}X+=1,O=65536+((O&1023)<<10|M.charCodeAt(X)&1023),H[H.length]=n[240|O>>18]+n[128|O>>12&63]+n[128|O>>6&63]+n[128|O&63]}R+=H.join("")}return R},h=function(y){for(var b=[{obj:{o:y},prop:"o"}],T=[],A=0;A<b.length;++A)for(var x=b[A],I=x.obj[x.prop],R=Object.keys(I),$=0;$<R.length;++$){var M=R[$],H=I[M];typeof H=="object"&&H!==null&&T.indexOf(H)===-1&&(b.push({obj:I,prop:M}),T.push(H))}return i(b),y},d=function(y){return Object.prototype.toString.call(y)==="[object RegExp]"},f=function(y){return!y||typeof y!="object"?!1:!!(y.constructor&&y.constructor.isBuffer&&y.constructor.isBuffer(y))},m=function(y,b){return[].concat(y,b)},p=function(y,b){if(r(y)){for(var T=[],A=0;A<y.length;A+=1)T.push(b(y[A]));return T}return b(y)};return Jp={arrayToObject:s,assign:a,combine:m,compact:h,decode:c,encode:l,isBuffer:f,isRegExp:d,maybeMap:p,merge:o},Jp}var Zp,ox;function Oj(){if(ox)return Zp;ox=1;var e=Rj(),t=sx(),r=Xp(),n=Object.prototype.hasOwnProperty,i={brackets:function(g){return g+"[]"},comma:"comma",indices:function(g,y){return g+"["+y+"]"},repeat:function(g){return g}},s=Array.isArray,o=Array.prototype.push,a=function(p,g){o.apply(p,s(g)?g:[g])},c=Date.prototype.toISOString,u=r.default,l={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,filter:void 0,format:u,formatter:r.formatters[u],indices:!1,serializeDate:function(g){return c.call(g)},skipNulls:!1,strictNullHandling:!1},h=function(g){return typeof g=="string"||typeof g=="number"||typeof g=="boolean"||typeof g=="symbol"||typeof g=="bigint"},d={},f=function p(g,y,b,T,A,x,I,R,$,M,H,X,O,N,E,L,j,U){for(var V=g,Q=U,K=0,W=!1;(Q=Q.get(d))!==void 0&&!W;){var P=Q.get(g);if(K+=1,typeof P<"u"){if(P===K)throw new RangeError("Cyclic object value");W=!0}typeof Q.get(d)>"u"&&(K=0)}if(typeof M=="function"?V=M(y,V):V instanceof Date?V=O(V):b==="comma"&&s(V)&&(V=t.maybeMap(V,function(ft){return ft instanceof Date?O(ft):ft})),V===null){if(x)return $&&!L?$(y,l.encoder,j,"key",N):y;V=""}if(h(V)||t.isBuffer(V)){if($){var st=L?y:$(y,l.encoder,j,"key",N);return[E(st)+"="+E($(V,l.encoder,j,"value",N))]}return[E(y)+"="+E(String(V))]}var G=[];if(typeof V>"u")return G;var rt;if(b==="comma"&&s(V))L&&$&&(V=t.maybeMap(V,$)),rt=[{value:V.length>0?V.join(",")||null:void 0}];else if(s(M))rt=M;else{var wt=Object.keys(V);rt=H?wt.sort(H):wt}var Tt=R?String(y).replace(/\./g,"%2E"):String(y),It=T&&s(V)&&V.length===1?Tt+"[]":Tt;if(A&&s(V)&&V.length===0)return It+"[]";for(var St=0;St<rt.length;++St){var Pt=rt[St],Mt=typeof Pt=="object"&&Pt&&typeof Pt.value<"u"?Pt.value:V[Pt];if(!(I&&Mt===null)){var Vt=X&&R?String(Pt).replace(/\./g,"%2E"):String(Pt),ee=s(V)?typeof b=="function"?b(It,Vt):It:It+(X?"."+Vt:"["+Vt+"]");U.set(g,K);var S=e();S.set(d,U),a(G,p(Mt,ee,b,T,A,x,I,R,b==="comma"&&L&&s(V)?null:$,M,H,X,O,N,E,L,j,S))}}return G},m=function(g){if(!g)return l;if(typeof g.allowEmptyArrays<"u"&&typeof g.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof g.encodeDotInKeys<"u"&&typeof g.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(g.encoder!==null&&typeof g.encoder<"u"&&typeof g.encoder!="function")throw new TypeError("Encoder has to be a function.");var y=g.charset||l.charset;if(typeof g.charset<"u"&&g.charset!=="utf-8"&&g.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var b=r.default;if(typeof g.format<"u"){if(!n.call(r.formatters,g.format))throw new TypeError("Unknown format option provided.");b=g.format}var T=r.formatters[b],A=l.filter;(typeof g.filter=="function"||s(g.filter))&&(A=g.filter);var x;if(g.arrayFormat in i?x=g.arrayFormat:"indices"in g?x=g.indices?"indices":"repeat":x=l.arrayFormat,"commaRoundTrip"in g&&typeof g.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var I=typeof g.allowDots>"u"?g.encodeDotInKeys===!0?!0:l.allowDots:!!g.allowDots;return{addQueryPrefix:typeof g.addQueryPrefix=="boolean"?g.addQueryPrefix:l.addQueryPrefix,allowDots:I,allowEmptyArrays:typeof g.allowEmptyArrays=="boolean"?!!g.allowEmptyArrays:l.allowEmptyArrays,arrayFormat:x,charset:y,charsetSentinel:typeof g.charsetSentinel=="boolean"?g.charsetSentinel:l.charsetSentinel,commaRoundTrip:!!g.commaRoundTrip,delimiter:typeof g.delimiter>"u"?l.delimiter:g.delimiter,encode:typeof g.encode=="boolean"?g.encode:l.encode,encodeDotInKeys:typeof g.encodeDotInKeys=="boolean"?g.encodeDotInKeys:l.encodeDotInKeys,encoder:typeof g.encoder=="function"?g.encoder:l.encoder,encodeValuesOnly:typeof g.encodeValuesOnly=="boolean"?g.encodeValuesOnly:l.encodeValuesOnly,filter:A,format:b,formatter:T,serializeDate:typeof g.serializeDate=="function"?g.serializeDate:l.serializeDate,skipNulls:typeof g.skipNulls=="boolean"?g.skipNulls:l.skipNulls,sort:typeof g.sort=="function"?g.sort:null,strictNullHandling:typeof g.strictNullHandling=="boolean"?g.strictNullHandling:l.strictNullHandling}};return Zp=function(p,g){var y=p,b=m(g),T,A;typeof b.filter=="function"?(A=b.filter,y=A("",y)):s(b.filter)&&(A=b.filter,T=A);var x=[];if(typeof y!="object"||y===null)return"";var I=i[b.arrayFormat],R=I==="comma"&&b.commaRoundTrip;T||(T=Object.keys(y)),b.sort&&T.sort(b.sort);for(var $=e(),M=0;M<T.length;++M){var H=T[M],X=y[H];b.skipNulls&&X===null||a(x,f(X,H,I,R,b.allowEmptyArrays,b.strictNullHandling,b.skipNulls,b.encodeDotInKeys,b.encode?b.encoder:null,b.filter,b.sort,b.allowDots,b.serializeDate,b.format,b.formatter,b.encodeValuesOnly,b.charset,$))}var O=x.join(b.delimiter),N=b.addQueryPrefix===!0?"?":"";return b.charsetSentinel&&(b.charset==="iso-8859-1"?N+="utf8=%26%2310003%3B&":N+="utf8=%E2%9C%93&"),O.length>0?N+O:""},Zp}var Qp,ax;function Ij(){if(ax)return Qp;ax=1;var e=sx(),t=Object.prototype.hasOwnProperty,r=Array.isArray,n={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:e.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},i=function(d){return d.replace(/&#(\d+);/g,function(f,m){return String.fromCharCode(parseInt(m,10))})},s=function(d,f,m){if(d&&typeof d=="string"&&f.comma&&d.indexOf(",")>-1)return d.split(",");if(f.throwOnLimitExceeded&&m>=f.arrayLimit)throw new RangeError("Array limit exceeded. Only "+f.arrayLimit+" element"+(f.arrayLimit===1?"":"s")+" allowed in an array.");return d},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",c=function(f,m){var p={__proto__:null},g=m.ignoreQueryPrefix?f.replace(/^\?/,""):f;g=g.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var y=m.parameterLimit===1/0?void 0:m.parameterLimit,b=g.split(m.delimiter,m.throwOnLimitExceeded?y+1:y);if(m.throwOnLimitExceeded&&b.length>y)throw new RangeError("Parameter limit exceeded. Only "+y+" parameter"+(y===1?"":"s")+" allowed.");var T=-1,A,x=m.charset;if(m.charsetSentinel)for(A=0;A<b.length;++A)b[A].indexOf("utf8=")===0&&(b[A]===a?x="utf-8":b[A]===o&&(x="iso-8859-1"),T=A,A=b.length);for(A=0;A<b.length;++A)if(A!==T){var I=b[A],R=I.indexOf("]="),$=R===-1?I.indexOf("="):R+1,M,H;$===-1?(M=m.decoder(I,n.decoder,x,"key"),H=m.strictNullHandling?null:""):(M=m.decoder(I.slice(0,$),n.decoder,x,"key"),H=e.maybeMap(s(I.slice($+1),m,r(p[M])?p[M].length:0),function(O){return m.decoder(O,n.decoder,x,"value")})),H&&m.interpretNumericEntities&&x==="iso-8859-1"&&(H=i(String(H))),I.indexOf("[]=")>-1&&(H=r(H)?[H]:H);var X=t.call(p,M);X&&m.duplicates==="combine"?p[M]=e.combine(p[M],H):(!X||m.duplicates==="last")&&(p[M]=H)}return p},u=function(d,f,m,p){var g=0;if(d.length>0&&d[d.length-1]==="[]"){var y=d.slice(0,-1).join("");g=Array.isArray(f)&&f[y]?f[y].length:0}for(var b=p?f:s(f,m,g),T=d.length-1;T>=0;--T){var A,x=d[T];if(x==="[]"&&m.parseArrays)A=m.allowEmptyArrays&&(b===""||m.strictNullHandling&&b===null)?[]:e.combine([],b);else{A=m.plainObjects?{__proto__:null}:{};var I=x.charAt(0)==="["&&x.charAt(x.length-1)==="]"?x.slice(1,-1):x,R=m.decodeDotInKeys?I.replace(/%2E/g,"."):I,$=parseInt(R,10);!m.parseArrays&&R===""?A={0:b}:!isNaN($)&&x!==R&&String($)===R&&$>=0&&m.parseArrays&&$<=m.arrayLimit?(A=[],A[$]=b):R!=="__proto__"&&(A[R]=b)}b=A}return b},l=function(f,m,p,g){if(f){var y=p.allowDots?f.replace(/\.([^.[]+)/g,"[$1]"):f,b=/(\[[^[\]]*])/,T=/(\[[^[\]]*])/g,A=p.depth>0&&b.exec(y),x=A?y.slice(0,A.index):y,I=[];if(x){if(!p.plainObjects&&t.call(Object.prototype,x)&&!p.allowPrototypes)return;I.push(x)}for(var R=0;p.depth>0&&(A=T.exec(y))!==null&&R<p.depth;){if(R+=1,!p.plainObjects&&t.call(Object.prototype,A[1].slice(1,-1))&&!p.allowPrototypes)return;I.push(A[1])}if(A){if(p.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+p.depth+" and strictDepth is true");I.push("["+y.slice(A.index)+"]")}return u(I,m,p,g)}},h=function(f){if(!f)return n;if(typeof f.allowEmptyArrays<"u"&&typeof f.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof f.decodeDotInKeys<"u"&&typeof f.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(f.decoder!==null&&typeof f.decoder<"u"&&typeof f.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof f.charset<"u"&&f.charset!=="utf-8"&&f.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof f.throwOnLimitExceeded<"u"&&typeof f.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var m=typeof f.charset>"u"?n.charset:f.charset,p=typeof f.duplicates>"u"?n.duplicates:f.duplicates;if(p!=="combine"&&p!=="first"&&p!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var g=typeof f.allowDots>"u"?f.decodeDotInKeys===!0?!0:n.allowDots:!!f.allowDots;return{allowDots:g,allowEmptyArrays:typeof f.allowEmptyArrays=="boolean"?!!f.allowEmptyArrays:n.allowEmptyArrays,allowPrototypes:typeof f.allowPrototypes=="boolean"?f.allowPrototypes:n.allowPrototypes,allowSparse:typeof f.allowSparse=="boolean"?f.allowSparse:n.allowSparse,arrayLimit:typeof f.arrayLimit=="number"?f.arrayLimit:n.arrayLimit,charset:m,charsetSentinel:typeof f.charsetSentinel=="boolean"?f.charsetSentinel:n.charsetSentinel,comma:typeof f.comma=="boolean"?f.comma:n.comma,decodeDotInKeys:typeof f.decodeDotInKeys=="boolean"?f.decodeDotInKeys:n.decodeDotInKeys,decoder:typeof f.decoder=="function"?f.decoder:n.decoder,delimiter:typeof f.delimiter=="string"||e.isRegExp(f.delimiter)?f.delimiter:n.delimiter,depth:typeof f.depth=="number"||f.depth===!1?+f.depth:n.depth,duplicates:p,ignoreQueryPrefix:f.ignoreQueryPrefix===!0,interpretNumericEntities:typeof f.interpretNumericEntities=="boolean"?f.interpretNumericEntities:n.interpretNumericEntities,parameterLimit:typeof f.parameterLimit=="number"?f.parameterLimit:n.parameterLimit,parseArrays:f.parseArrays!==!1,plainObjects:typeof f.plainObjects=="boolean"?f.plainObjects:n.plainObjects,strictDepth:typeof f.strictDepth=="boolean"?!!f.strictDepth:n.strictDepth,strictNullHandling:typeof f.strictNullHandling=="boolean"?f.strictNullHandling:n.strictNullHandling,throwOnLimitExceeded:typeof f.throwOnLimitExceeded=="boolean"?f.throwOnLimitExceeded:!1}};return Qp=function(d,f){var m=h(f);if(d===""||d===null||typeof d>"u")return m.plainObjects?{__proto__:null}:{};for(var p=typeof d=="string"?c(d,m):d,g=m.plainObjects?{__proto__:null}:{},y=Object.keys(p),b=0;b<y.length;++b){var T=y[b],A=l(T,p[T],m,typeof d=="string");g=e.merge(g,A,m)}return m.allowSparse===!0?g:e.compact(g)},Qp}var t0,cx;function Nj(){if(cx)return t0;cx=1;var e=Oj(),t=Ij(),r=Xp();return t0={formats:r,parse:t,stringify:e},t0}var lx;function Cj(){if(lx)return Ks;lx=1;var e=Ej();function t(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var r=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),c=["%","/","?",";","#"].concat(a),u=["/","?","#"],l=255,h=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},p={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=Nj();function y(x,I,R){if(x&&typeof x=="object"&&x instanceof t)return x;var $=new t;return $.parse(x,I,R),$}t.prototype.parse=function(x,I,R){if(typeof x!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof x);var $=x.indexOf("?"),M=$!==-1&&$<x.indexOf("#")?"?":"#",H=x.split(M),X=/\\/g;H[0]=H[0].replace(X,"/"),x=H.join(M);var O=x;if(O=O.trim(),!R&&x.split("#").length===1){var N=i.exec(O);if(N)return this.path=O,this.href=O,this.pathname=N[1],N[2]?(this.search=N[2],I?this.query=g.parse(this.search.substr(1)):this.query=this.search.substr(1)):I&&(this.search="",this.query={}),this}var E=r.exec(O);if(E){E=E[0];var L=E.toLowerCase();this.protocol=L,O=O.substr(E.length)}if(R||E||O.match(/^\/\/[^@/]+@[^@/]+/)){var j=O.substr(0,2)==="//";j&&!(E&&m[E])&&(O=O.substr(2),this.slashes=!0)}if(!m[E]&&(j||E&&!p[E])){for(var U=-1,V=0;V<u.length;V++){var Q=O.indexOf(u[V]);Q!==-1&&(U===-1||Q<U)&&(U=Q)}var K,W;U===-1?W=O.lastIndexOf("@"):W=O.lastIndexOf("@",U),W!==-1&&(K=O.slice(0,W),O=O.slice(W+1),this.auth=decodeURIComponent(K)),U=-1;for(var V=0;V<c.length;V++){var Q=O.indexOf(c[V]);Q!==-1&&(U===-1||Q<U)&&(U=Q)}U===-1&&(U=O.length),this.host=O.slice(0,U),O=O.slice(U),this.parseHost(),this.hostname=this.hostname||"";var P=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!P)for(var st=this.hostname.split(/\./),V=0,G=st.length;V<G;V++){var rt=st[V];if(rt&&!rt.match(h)){for(var wt="",Tt=0,It=rt.length;Tt<It;Tt++)rt.charCodeAt(Tt)>127?wt+="x":wt+=rt[Tt];if(!wt.match(h)){var St=st.slice(0,V),Pt=st.slice(V+1),Mt=rt.match(d);Mt&&(St.push(Mt[1]),Pt.unshift(Mt[2])),Pt.length&&(O="/"+Pt.join(".")+O),this.hostname=St.join(".");break}}}this.hostname.length>l?this.hostname="":this.hostname=this.hostname.toLowerCase(),P||(this.hostname=e.toASCII(this.hostname));var Vt=this.port?":"+this.port:"",ee=this.hostname||"";this.host=ee+Vt,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),O[0]!=="/"&&(O="/"+O))}if(!f[L])for(var V=0,G=a.length;V<G;V++){var S=a[V];if(O.indexOf(S)!==-1){var ft=encodeURIComponent(S);ft===S&&(ft=escape(S)),O=O.split(S).join(ft)}}var ct=O.indexOf("#");ct!==-1&&(this.hash=O.substr(ct),O=O.slice(0,ct));var z=O.indexOf("?");if(z!==-1?(this.search=O.substr(z),this.query=O.substr(z+1),I&&(this.query=g.parse(this.query)),O=O.slice(0,z)):I&&(this.search="",this.query={}),O&&(this.pathname=O),p[L]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var Vt=this.pathname||"",B=this.search||"";this.path=Vt+B}return this.href=this.format(),this};function b(x){return typeof x=="string"&&(x=y(x)),x instanceof t?x.format():t.prototype.format.call(x)}t.prototype.format=function(){var x=this.auth||"";x&&(x=encodeURIComponent(x),x=x.replace(/%3A/i,":"),x+="@");var I=this.protocol||"",R=this.pathname||"",$=this.hash||"",M=!1,H="";this.host?M=x+this.host:this.hostname&&(M=x+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(M+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(H=g.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var X=this.search||H&&"?"+H||"";return I&&I.substr(-1)!==":"&&(I+=":"),this.slashes||(!I||p[I])&&M!==!1?(M="//"+(M||""),R&&R.charAt(0)!=="/"&&(R="/"+R)):M||(M=""),$&&$.charAt(0)!=="#"&&($="#"+$),X&&X.charAt(0)!=="?"&&(X="?"+X),R=R.replace(/[?#]/g,function(O){return encodeURIComponent(O)}),X=X.replace("#","%23"),I+M+R+X+$};function T(x,I){return y(x,!1,!0).resolve(I)}t.prototype.resolve=function(x){return this.resolveObject(y(x,!1,!0)).format()};function A(x,I){return x?y(x,!1,!0).resolveObject(I):I}return t.prototype.resolveObject=function(x){if(typeof x=="string"){var I=new t;I.parse(x,!1,!0),x=I}for(var R=new t,$=Object.keys(this),M=0;M<$.length;M++){var H=$[M];R[H]=this[H]}if(R.hash=x.hash,x.href==="")return R.href=R.format(),R;if(x.slashes&&!x.protocol){for(var X=Object.keys(x),O=0;O<X.length;O++){var N=X[O];N!=="protocol"&&(R[N]=x[N])}return p[R.protocol]&&R.hostname&&!R.pathname&&(R.pathname="/",R.path=R.pathname),R.href=R.format(),R}if(x.protocol&&x.protocol!==R.protocol){if(!p[x.protocol]){for(var E=Object.keys(x),L=0;L<E.length;L++){var j=E[L];R[j]=x[j]}return R.href=R.format(),R}if(R.protocol=x.protocol,!x.host&&!m[x.protocol]){for(var G=(x.pathname||"").split("/");G.length&&!(x.host=G.shift()););x.host||(x.host=""),x.hostname||(x.hostname=""),G[0]!==""&&G.unshift(""),G.length<2&&G.unshift(""),R.pathname=G.join("/")}else R.pathname=x.pathname;if(R.search=x.search,R.query=x.query,R.host=x.host||"",R.auth=x.auth,R.hostname=x.hostname||x.host,R.port=x.port,R.pathname||R.search){var U=R.pathname||"",V=R.search||"";R.path=U+V}return R.slashes=R.slashes||x.slashes,R.href=R.format(),R}var Q=R.pathname&&R.pathname.charAt(0)==="/",K=x.host||x.pathname&&x.pathname.charAt(0)==="/",W=K||Q||R.host&&x.pathname,P=W,st=R.pathname&&R.pathname.split("/")||[],G=x.pathname&&x.pathname.split("/")||[],rt=R.protocol&&!p[R.protocol];if(rt&&(R.hostname="",R.port=null,R.host&&(st[0]===""?st[0]=R.host:st.unshift(R.host)),R.host="",x.protocol&&(x.hostname=null,x.port=null,x.host&&(G[0]===""?G[0]=x.host:G.unshift(x.host)),x.host=null),W=W&&(G[0]===""||st[0]==="")),K)R.host=x.host||x.host===""?x.host:R.host,R.hostname=x.hostname||x.hostname===""?x.hostname:R.hostname,R.search=x.search,R.query=x.query,st=G;else if(G.length)st||(st=[]),st.pop(),st=st.concat(G),R.search=x.search,R.query=x.query;else if(x.search!=null){if(rt){R.host=st.shift(),R.hostname=R.host;var wt=R.host&&R.host.indexOf("@")>0?R.host.split("@"):!1;wt&&(R.auth=wt.shift(),R.hostname=wt.shift(),R.host=R.hostname)}return R.search=x.search,R.query=x.query,(R.pathname!==null||R.search!==null)&&(R.path=(R.pathname?R.pathname:"")+(R.search?R.search:"")),R.href=R.format(),R}if(!st.length)return R.pathname=null,R.search?R.path="/"+R.search:R.path=null,R.href=R.format(),R;for(var Tt=st.slice(-1)[0],It=(R.host||x.host||st.length>1)&&(Tt==="."||Tt==="..")||Tt==="",St=0,Pt=st.length;Pt>=0;Pt--)Tt=st[Pt],Tt==="."?st.splice(Pt,1):Tt===".."?(st.splice(Pt,1),St++):St&&(st.splice(Pt,1),St--);if(!W&&!P)for(;St--;St)st.unshift("..");W&&st[0]!==""&&(!st[0]||st[0].charAt(0)!=="/")&&st.unshift(""),It&&st.join("/").substr(-1)!=="/"&&st.push("");var Mt=st[0]===""||st[0]&&st[0].charAt(0)==="/";if(rt){R.hostname=Mt?"":st.length?st.shift():"",R.host=R.hostname;var wt=R.host&&R.host.indexOf("@")>0?R.host.split("@"):!1;wt&&(R.auth=wt.shift(),R.hostname=wt.shift(),R.host=R.hostname)}return W=W||R.host&&st.length,W&&!Mt&&st.unshift(""),st.length>0?R.pathname=st.join("/"):(R.pathname=null,R.path=null),(R.pathname!==null||R.search!==null)&&(R.path=(R.pathname?R.pathname:"")+(R.search?R.search:"")),R.auth=x.auth||R.auth,R.slashes=R.slashes||x.slashes,R.href=R.format(),R},t.prototype.parseHost=function(){var x=this.host,I=n.exec(x);I&&(I=I[0],I!==":"&&(this.port=I.substr(1)),x=x.substr(0,x.length-I.length)),x&&(this.hostname=x)},Ks.parse=y,Ks.resolve=T,Ks.resolveObject=A,Ks.format=b,Ks.Url=t,Ks}var Lj=typeof URL=="function"?URL:Cj().URL;const os=Lj;function Mj(e,t,r){if(t in e)return e[t];if(arguments.length===3)return r;throw new Error('"'+t+'" is a required argument.')}hn.getArg=Mj;const ux=function(){return!("__proto__"in Object.create(null))}();function fx(e){return e}function Uj(e){return hx(e)?"$"+e:e}hn.toSetString=ux?fx:Uj;function Pj(e){return hx(e)?e.slice(1):e}hn.fromSetString=ux?fx:Pj;function hx(e){if(!e)return!1;const t=e.length;if(t<9||e.charCodeAt(t-1)!==95||e.charCodeAt(t-2)!==95||e.charCodeAt(t-3)!==111||e.charCodeAt(t-4)!==116||e.charCodeAt(t-5)!==111||e.charCodeAt(t-6)!==114||e.charCodeAt(t-7)!==112||e.charCodeAt(t-8)!==95||e.charCodeAt(t-9)!==95)return!1;for(let r=t-10;r>=0;r--)if(e.charCodeAt(r)!==36)return!1;return!0}function dx(e,t){return e===t?0:e===null?1:t===null?-1:e>t?1:-1}function Fj(e,t){let r=e.generatedLine-t.generatedLine;return r!==0||(r=e.generatedColumn-t.generatedColumn,r!==0)||(r=dx(e.source,t.source),r!==0)||(r=e.originalLine-t.originalLine,r!==0)||(r=e.originalColumn-t.originalColumn,r!==0)?r:dx(e.name,t.name)}hn.compareByGeneratedPositionsInflated=Fj;function $j(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))}hn.parseSourceMapInput=$j;const e0="http:",uc=`${e0}//host`;function r0(e){return t=>{const r=Yo(t),n=n0(t),i=new os(t,n);e(i);const s=i.toString();return r==="absolute"?s:r==="scheme-relative"?s.slice(e0.length):r==="path-absolute"?s.slice(uc.length):i0(n,s)}}function as(e,t){return new os(e,t).toString()}function Bj(e,t){let r=0;do{const n=e+r++;if(t.indexOf(n)===-1)return n}while(!0)}function n0(e){const t=e.split("..").length-1,r=Bj("p",e);let n=`${uc}/`;for(let i=0;i<t;i++)n+=`${r}/`;return n}const Dj=/^[A-Za-z0-9\+\-\.]+:/;function Yo(e){return e[0]==="/"?e[1]==="/"?"scheme-relative":"path-absolute":Dj.test(e)?"absolute":"path-relative"}function i0(e,t){typeof e=="string"&&(e=new os(e)),typeof t=="string"&&(t=new os(t));const r=t.pathname.split("/"),n=e.pathname.split("/");for(n.length>0&&!n[n.length-1]&&n.pop();r.length>0&&n.length>0&&r[0]===n[0];)r.shift(),n.shift();return n.map(()=>"..").concat(r).join("/")+t.search+t.hash}const jj=r0(e=>{e.pathname=e.pathname.replace(/\/?$/,"/")}),zj=r0(e=>{e.href=new os(".",e.toString()).toString()}),fc=r0(e=>{});hn.normalize=fc;function s0(e,t){const r=Yo(t),n=Yo(e);if(e=jj(e),r==="absolute")return as(t,void 0);if(n==="absolute")return as(t,e);if(r==="scheme-relative")return fc(t);if(n==="scheme-relative")return as(t,as(e,uc)).slice(e0.length);if(r==="path-absolute")return fc(t);if(n==="path-absolute")return as(t,as(e,uc)).slice(uc.length);const i=n0(t+e),s=as(t,as(e,i));return i0(i,s)}hn.join=s0;function Wj(e,t){const r=Hj(e,t);return typeof r=="string"?r:fc(t)}hn.relative=Wj;function Hj(e,t){if(Yo(e)!==Yo(t))return null;const n=n0(e+t),i=new os(e,n),s=new os(t,n);try{new os("",s.toString())}catch{return null}return s.protocol!==i.protocol||s.user!==i.user||s.password!==i.password||s.hostname!==i.hostname||s.port!==i.port?null:i0(i,s)}function Gj(e,t,r){e&&Yo(t)==="path-absolute"&&(t=t.replace(/^\//,""));let n=fc(t||"");return e&&(n=s0(e,n)),r&&(n=s0(zj(r),n)),n}hn.computeSourceURL=Gj;var o0={};let Kj=class kA{constructor(){this._array=[],this._set=new Map}static fromArray(t,r){const n=new kA;for(let i=0,s=t.length;i<s;i++)n.add(t[i],r);return n}size(){return this._set.size}add(t,r){const n=this.has(t),i=this._array.length;(!n||r)&&this._array.push(t),n||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const r=this._set.get(t);if(r>=0)return r;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};o0.ArraySet=Kj;var px={};const mx=hn;function Yj(e,t){const r=e.generatedLine,n=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return n>r||n==r&&s>=i||mx.compareByGeneratedPositionsInflated(e,t)<=0}let qj=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,r){this._array.forEach(t,r)}add(t){Yj(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(mx.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};px.MappingList=qj;const hc=Gk,Ze=hn,Du=o0.ArraySet,Vj=px.MappingList;let gx=class xA{constructor(t){t||(t={}),this._file=Ze.getArg(t,"file",null),this._sourceRoot=Ze.getArg(t,"sourceRoot",null),this._skipValidation=Ze.getArg(t,"skipValidation",!1),this._sources=new Du,this._names=new Du,this._mappings=new Vj,this._sourcesContents=null}static fromSourceMap(t){const r=t.sourceRoot,n=new xA({file:t.file,sourceRoot:r});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,r!=null&&(s.source=Ze.relative(r,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),n.addMapping(s)}),t.sources.forEach(function(i){let s=i;r!=null&&(s=Ze.relative(r,i)),n._sources.has(s)||n._sources.add(s);const o=t.sourceContentFor(i);o!=null&&n.setSourceContent(i,o)}),n}addMapping(t){const r=Ze.getArg(t,"generated"),n=Ze.getArg(t,"original",null);let i=Ze.getArg(t,"source",null),s=Ze.getArg(t,"name",null);this._skipValidation||this._validateMapping(r,n,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:r.line,generatedColumn:r.column,originalLine:n&&n.line,originalColumn:n&&n.column,source:i,name:s})}setSourceContent(t,r){let n=t;this._sourceRoot!=null&&(n=Ze.relative(this._sourceRoot,n)),r!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Ze.toSetString(n)]=r):this._sourcesContents&&(delete this._sourcesContents[Ze.toSetString(n)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,r,n){let i=r;if(r==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=Ze.relative(s,i));const o=this._mappings.toArray().length>0?new Du:this._sources,a=new Du;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,n!=null&&(c.source=Ze.join(n,c.source)),s!=null&&(c.source=Ze.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const u=c.source;u!=null&&!o.has(u)&&o.add(u);const l=c.name;l!=null&&!a.has(l)&&a.add(l)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const u=t.sourceContentFor(c);u!=null&&(n!=null&&(c=Ze.join(n,c)),s!=null&&(c=Ze.relative(s,c)),this.setSourceContent(c,u))},this)}_validateMapping(t,r,n,i){if(r&&typeof r.line!="number"&&typeof r.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!r&&!n&&!i)){if(!(t&&"line"in t&&"column"in t&&r&&"line"in r&&"column"in r&&t.line>0&&t.column>=0&&r.line>0&&r.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:n,original:r,name:i}))}}_serializeMappings(){let t=0,r=1,n=0,i=0,s=0,o=0,a="",c,u,l,h;const d=this._mappings.toArray();for(let f=0,m=d.length;f<m;f++){if(u=d[f],c="",u.generatedLine!==r)for(t=0;u.generatedLine!==r;)c+=";",r++;else if(f>0){if(!Ze.compareByGeneratedPositionsInflated(u,d[f-1]))continue;c+=","}c+=hc.encode(u.generatedColumn-t),t=u.generatedColumn,u.source!=null&&(h=this._sources.indexOf(u.source),c+=hc.encode(h-o),o=h,c+=hc.encode(u.originalLine-1-i),i=u.originalLine-1,c+=hc.encode(u.originalColumn-n),n=u.originalColumn,u.name!=null&&(l=this._names.indexOf(u.name),c+=hc.encode(l-s),s=l)),a+=c}return a}_generateSourcesContent(t,r){return t.map(function(n){if(!this._sourcesContents)return null;r!=null&&(n=Ze.relative(r,n));const i=Ze.toSetString(n);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};gx.prototype._version=3,Hk.SourceMapGenerator=gx;var yx={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(r,n,i,s,o,a){const c=Math.floor((n-r)/2)+r,u=o(i,s[c],!0);return u===0?c:u>0?n-c>1?t(c,n,i,s,o,a):a===e.LEAST_UPPER_BOUND?n<s.length?n:-1:c:c-r>1?t(r,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:r<0?-1:r}e.search=function(n,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,n,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(yx);var a0={exports:{}};let dc=null;a0.exports=function(){if(typeof dc=="string")return fetch(dc).then(t=>t.arrayBuffer());if(dc instanceof ArrayBuffer)return Promise.resolve(dc);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},a0.exports.initialize=e=>{dc=e};var _x=a0.exports;const Xj=_x;function Jj(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let pc=null;var Zj=function(){if(pc)return pc;const t=[];return pc=Xj().then(r=>WebAssembly.instantiate(r,{env:{mapping_callback(n,i,s,o,a,c,u,l,h,d){const f=new Jj;f.generatedLine=n+1,f.generatedColumn=i,s&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=u+1,f.originalColumn=l,h&&(f.name=d)),t[t.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(r=>({exports:r.instance.exports,withMappingCallback:(n,i)=>{t.push(n);try{i()}finally{t.pop()}}})).then(null,r=>{throw pc=null,r}),pc};const ne=hn,Qj=yx,c0=o0.ArraySet,tz=_x,ez=Zj,l0=Symbol("smcInternal");class yr{constructor(t,r){return t==l0?Promise.resolve(this):nz(t,r)}static initialize(t){tz.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,r){return iz(t,r)}static async with(t,r,n){const i=await new yr(t,r);try{return await n(i)}finally{i.destroy()}}eachMapping(t,r,n){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}yr.prototype._version=3,yr.GENERATED_ORDER=1,yr.ORIGINAL_ORDER=2,yr.GREATEST_LOWER_BOUND=1,yr.LEAST_UPPER_BOUND=2;class mc extends yr{constructor(t,r){return super(l0).then(n=>{let i=t;typeof t=="string"&&(i=ne.parseSourceMapInput(t));const s=ne.getArg(i,"version"),o=ne.getArg(i,"sources").map(String),a=ne.getArg(i,"names",[]),c=ne.getArg(i,"sourceRoot",null),u=ne.getArg(i,"sourcesContent",null),l=ne.getArg(i,"mappings"),h=ne.getArg(i,"file",null),d=ne.getArg(i,"x_google_ignoreList",null);if(s!=n._version)throw new Error("Unsupported version: "+s);return n._sourceLookupCache=new Map,n._names=c0.fromArray(a.map(String),!0),n._sources=c0.fromArray(o,!0),n._absoluteSources=c0.fromArray(n._sources.toArray().map(function(f){return ne.computeSourceURL(c,f,r)}),!0),n.sourceRoot=c,n.sourcesContent=u,n._mappings=l,n._sourceMapURL=r,n.file=h,n.x_google_ignoreList=d,n._computedColumnSpans=!1,n._mappingsPtr=0,n._wasm=null,ez().then(f=>(n._wasm=f,n))})}_findSourceIndex(t){const r=this._sourceLookupCache.get(t);if(typeof r=="number")return r;const n=ne.computeSourceURL(null,t,this._sourceMapURL);if(this._absoluteSources.has(n)){const s=this._absoluteSources.indexOf(n);return this._sourceLookupCache.set(t,s),s}const i=ne.computeSourceURL(this.sourceRoot,t,this._sourceMapURL);if(this._absoluteSources.has(i)){const s=this._absoluteSources.indexOf(i);return this._sourceLookupCache.set(t,s),s}return-1}static fromSourceMap(t,r){return new mc(t.toString())}get sources(){return this._absoluteSources.toArray()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(),this._mappingsPtr}_parseMappings(){const t=this._mappings,r=t.length,n=this._wasm.exports.allocate_mappings(r)>>>0,i=new Uint8Array(this._wasm.exports.memory.buffer,n,r);for(let o=0;o<r;o++)i[o]=t.charCodeAt(o);const s=this._wasm.exports.parse_mappings(n);if(!s){const o=this._wasm.exports.get_last_error();let a=`Error parsing mappings (code ${o}): `;switch(o){case 1:a+="the mappings contained a negative line, column, source index, or name index";break;case 2:a+="the mappings contained a number larger than 2**32";break;case 3:a+="reached EOF while in the middle of parsing a VLQ";break;case 4:a+="invalid base 64 character while parsing a VLQ";break;default:a+="unknown error code";break}throw new Error(a)}this._mappingsPtr=s}eachMapping(t,r,n){const i=r||null,s=n||yr.GENERATED_ORDER;this._wasm.withMappingCallback(o=>{o.source!==null&&(o.source=this._absoluteSources.at(o.source),o.name!==null&&(o.name=this._names.at(o.name))),this._computedColumnSpans&&o.lastGeneratedColumn===null&&(o.lastGeneratedColumn=1/0),t.call(i,o)},()=>{switch(s){case yr.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case yr.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let r=ne.getArg(t,"source");const n=ne.getArg(t,"line"),i=t.column||0;if(r=this._findSourceIndex(r),r<0)return[];if(n<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),r,n-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const r={generatedLine:ne.getArg(t,"line"),generatedColumn:ne.getArg(t,"column")};if(r.generatedLine<1)throw new Error("Line numbers must be >= 1");if(r.generatedColumn<0)throw new Error("Column numbers must be >= 0");let n=ne.getArg(t,"bias",yr.GREATEST_LOWER_BOUND);n==null&&(n=yr.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),r.generatedLine-1,r.generatedColumn,n)}),i&&i.generatedLine===r.generatedLine){let s=ne.getArg(i,"source",null);s!==null&&(s=this._absoluteSources.at(s));let o=ne.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:ne.getArg(i,"originalLine",null),column:ne.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,r){if(!this.sourcesContent)return null;const n=this._findSourceIndex(t);if(n>=0)return this.sourcesContent[n];if(r)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){let r=ne.getArg(t,"source");if(r=this._findSourceIndex(r),r<0)return{line:null,column:null,lastColumn:null};const n={source:r,originalLine:ne.getArg(t,"line"),originalColumn:ne.getArg(t,"column")};if(n.originalLine<1)throw new Error("Line numbers must be >= 1");if(n.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=ne.getArg(t,"bias",yr.GREATEST_LOWER_BOUND);i==null&&(i=yr.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),n.source,n.originalLine-1,n.originalColumn,i)}),s&&s.source===n.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:ne.getArg(s,"generatedLine",null),column:ne.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}mc.prototype.consumer=yr;class rz extends yr{constructor(t,r){return super(l0).then(n=>{let i=t;typeof t=="string"&&(i=ne.parseSourceMapInput(t));const s=ne.getArg(i,"version"),o=ne.getArg(i,"sections");if(s!=n._version)throw new Error("Unsupported version: "+s);let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const u=ne.getArg(c,"offset"),l=ne.getArg(u,"line"),h=ne.getArg(u,"column");if(l<a.line||l===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=u,new yr(ne.getArg(c,"map"),r).then(f=>({generatedOffset:{generatedLine:l+1,generatedColumn:h+1},consumer:f}))})).then(c=>(n._sections=c,n))})}get sources(){const t=[];for(let r=0;r<this._sections.length;r++)for(let n=0;n<this._sections[r].consumer.sources.length;n++)t.push(this._sections[r].consumer.sources[n]);return t}originalPositionFor(t){const r={generatedLine:ne.getArg(t,"line"),generatedColumn:ne.getArg(t,"column")},n=Qj.search(r,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-(o.generatedOffset.generatedColumn-1)}),i=this._sections[n];return i?i.consumer.originalPositionFor({line:r.generatedLine-(i.generatedOffset.generatedLine-1),column:r.generatedColumn-(i.generatedOffset.generatedLine===r.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,r){for(let n=0;n<this._sections.length;n++){const s=this._sections[n].consumer.sourceContentFor(t,!0);if(s)return s}if(r)return null;throw new Error('"'+t+'" is not in the SourceMap.')}_findSectionIndex(t){for(let r=0;r<this._sections.length;r++){const{consumer:n}=this._sections[r];if(n._findSourceIndex(t)!==-1)return r}return-1}generatedPositionFor(t){const r=this._findSectionIndex(ne.getArg(t,"source")),n=r>=0?this._sections[r]:null,i=r>=0&&r+1<this._sections.length?this._sections[r+1]:null,s=n&&n.consumer.generatedPositionFor(t);if(s&&s.line!==null){const o=n.generatedOffset.generatedLine-1,a=n.generatedOffset.generatedColumn-1;return s.line===1&&(s.column+=a,typeof s.lastColumn=="number"&&(s.lastColumn+=a)),s.lastColumn===1/0&&i&&s.line===i.generatedOffset.generatedLine&&(s.lastColumn=i.generatedOffset.generatedColumn-2),s.line+=o,s}return{line:null,column:null,lastColumn:null}}allGeneratedPositionsFor(t){const r=this._findSectionIndex(ne.getArg(t,"source")),n=r>=0?this._sections[r]:null,i=r>=0&&r+1<this._sections.length?this._sections[r+1]:null;return n?n.consumer.allGeneratedPositionsFor(t).map(s=>{const o=n.generatedOffset.generatedLine-1,a=n.generatedOffset.generatedColumn-1;return s.line===1&&(s.column+=a,typeof s.lastColumn=="number"&&(s.lastColumn+=a)),s.lastColumn===1/0&&i&&s.line===i.generatedOffset.generatedLine&&(s.lastColumn=i.generatedOffset.generatedColumn-2),s.line+=o,s}):[]}eachMapping(t,r,n){this._sections.forEach((i,s)=>{const o=s+1<this._sections.length?this._sections[s+1]:null,{generatedOffset:a}=i,c=a.generatedLine-1,u=a.generatedColumn-1;i.consumer.eachMapping(function(l){l.generatedLine===1&&(l.generatedColumn+=u,typeof l.lastGeneratedColumn=="number"&&(l.lastGeneratedColumn+=u)),l.lastGeneratedColumn===1/0&&o&&l.generatedLine===o.generatedOffset.generatedLine&&(l.lastGeneratedColumn=o.generatedOffset.generatedColumn-2),l.generatedLine+=c,t.call(this,l)},r,n)})}computeColumnSpans(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.computeColumnSpans()}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function nz(e,t){let r=e;typeof e=="string"&&(r=ne.parseSourceMapInput(e));const n=r.sections!=null?new rz(r,t):new mc(r,t);return Promise.resolve(n)}function iz(e,t){return mc.fromSourceMap(e,t)}var bx={};const sz=Hk.SourceMapGenerator,ju=hn,oz=/(\r?\n)/,az=10,qo="$$$isSourceNode$$$";let cz=class B0{constructor(t,r,n,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=r??null,this.source=n??null,this.name=s??null,this[qo]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,r,n){const i=new B0,s=t.split(oz);let o=0;const a=function(){const f=p(),m=p()||"";return f+m;function p(){return o<s.length?s[o++]:void 0}};let c=1,u=0,l=null,h;return r.eachMapping(function(f){if(l!==null)if(c<f.generatedLine)d(l,a()),c++,u=0;else{h=s[o]||"";const m=h.substr(0,f.generatedColumn-u);s[o]=h.substr(f.generatedColumn-u),u=f.generatedColumn,d(l,m),l=f;return}for(;c<f.generatedLine;)i.add(a()),c++;u<f.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,f.generatedColumn)),s[o]=h.substr(f.generatedColumn),u=f.generatedColumn),l=f},this),o<s.length&&(l&&d(l,a()),i.add(s.splice(o).join(""))),r.sources.forEach(function(f){const m=r.sourceContentFor(f);m!=null&&(n!=null&&(f=ju.join(n,f)),i.setSourceContent(f,m))}),i;function d(f,m){if(f===null||f.source===void 0)i.add(m);else{const p=n?ju.join(n,f.source):f.source;i.add(new B0(f.originalLine,f.originalColumn,p,m,f.name))}}}add(t){if(Array.isArray(t))t.forEach(function(r){this.add(r)},this);else if(t[qo]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let r=t.length-1;r>=0;r--)this.prepend(t[r]);else if(t[qo]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let r;for(let n=0,i=this.children.length;n<i;n++)r=this.children[n],r[qo]?r.walk(t):r!==""&&t(r,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let r,n;const i=this.children.length;if(i>0){for(r=[],n=0;n<i-1;n++)r.push(this.children[n]),r.push(t);r.push(this.children[n]),this.children=r}return this}replaceRight(t,r){const n=this.children[this.children.length-1];return n[qo]?n.replaceRight(t,r):typeof n=="string"?this.children[this.children.length-1]=n.replace(t,r):this.children.push("".replace(t,r)),this}setSourceContent(t,r){this.sourceContents[ju.toSetString(t)]=r}walkSourceContents(t){for(let n=0,i=this.children.length;n<i;n++)this.children[n][qo]&&this.children[n].walkSourceContents(t);const r=Object.keys(this.sourceContents);for(let n=0,i=r.length;n<i;n++)t(ju.fromSetString(r[n]),this.sourceContents[r[n]])}toString(){let t="";return this.walk(function(r){t+=r}),t}toStringWithSourceMap(t){const r={code:"",line:1,column:0},n=new sz(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(u,l){r.code+=u,l.source!==null&&l.line!==null&&l.column!==null?((s!==l.source||o!==l.line||a!==l.column||c!==l.name)&&n.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:r.line,column:r.column},name:l.name}),s=l.source,o=l.line,a=l.column,c=l.name,i=!0):i&&(n.addMapping({generated:{line:r.line,column:r.column}}),s=null,i=!1);for(let h=0,d=u.length;h<d;h++)u.charCodeAt(h)===az?(r.line++,r.column=0,h+1===d?(s=null,i=!1):i&&n.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:r.line,column:r.column},name:l.name})):r.column++}),this.walkSourceContents(function(u,l){n.setSourceContent(u,l)}),{code:r.code,map:n}}};bx.SourceNode=cz;var lz=bx.SourceNode;let wx=0;const vx=ii,uz=["Command","lines"];class fz extends JP{constructor(){super(BE,{traceInitPerf:ii,skipValidations:!ii,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});At(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));At(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(wu)}])}));At(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));At(this,"inline_go",this.RULED("inline_go",()=>{this.SUBRULE(this.short_go),this.OPTION(()=>this.SUBRULE(this.inline))}));At(this,"inline_try",this.RULED("inline_try",()=>{this.SUBRULE(this.short_try),this.OPTION(()=>this.SUBRULE(this.inline))}));At(this,"inline_command",this.RULED("inline_command",()=>{this.SUBRULE(this.stmt_command),this.OPTION(()=>this.SUBRULE(this.inline))}));At(this,"inline",this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.structured_cmd)},{ALT:()=>this.SUBRULE(this.inline_go)},{ALT:()=>this.SUBRULE(this.inline_try)},{ALT:()=>this.SUBRULE(this.inline_command)}])}));At(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(sp)}));At(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(ip)}));At(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(aw)}])}));At(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(cw)}));At(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(lw),this.CONSUME(uw)}));At(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Fo),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));At(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));At(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(hp),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])}));At(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(TE),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])}));At(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(dp),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));At(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Eu),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(wu)),this.CONSUME4(Fo),this.CONSUME4(pp)}}])}));At(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Eu),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Fo),this.CONSUME(pp)}}])}));At(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Eu),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));At(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Fo),this.CONSUME(mp),this.CONSUME(dp),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));At(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Fo),this.CONSUME(mp),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))}));At(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(CE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));At(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(LE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));At(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(ME),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));At(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(UE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));At(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(PE)}));At(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(FE)}));At(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(OE)}));At(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(IE)}));At(this,"command_ticker",this.RULED("command_ticker",()=>{this.CONSUME(NE)}));At(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(ap),this.SUBRULE2(this.and_test,{LABEL:"RHS"})})}));At(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(lp),this.SUBRULE2(this.not_test,{LABEL:"RHS"})})}));At(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(cp),this.SUBRULE1(this.not_test,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));At(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr,{LABEL:"LHS"}),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr,{LABEL:"RHS"})})}));At(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(gE)},{ALT:()=>this.CONSUME(yE)},{ALT:()=>this.CONSUME(_E)},{ALT:()=>this.CONSUME(bE)},{ALT:()=>this.CONSUME(wE)},{ALT:()=>this.CONSUME(vE)}])}));At(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(ap),this.SUBRULE2(this.and_test_value,{LABEL:"RHS"})})}));At(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(lp),this.SUBRULE2(this.not_test_value,{LABEL:"RHS"})})}));At(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(cp),this.SUBRULE1(this.not_test_value,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));At(this,"arith_expr",this.RULED("arith_expr",()=>{this.OR([{ALT:()=>this.SUBRULE(this.token_expr,{LABEL:"LHS"})},{ALT:()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item,{LABEL:"RHS"}))}}])}));At(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(up)},{ALT:()=>this.CONSUME(fp)}]),this.SUBRULE(this.term)}));At(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));At(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(kE)},{ALT:()=>this.CONSUME(hp)},{ALT:()=>this.CONSUME(xE)},{ALT:()=>this.CONSUME(AE)}]),this.SUBRULE(this.factor)}));At(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(up)},{ALT:()=>this.CONSUME(fp)}]),this.SUBRULE(this.factor,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE(this.power)}])}));At(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(EE),this.SUBRULE(this.factor)})}));At(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));At(this,"kind",this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)}));At(this,"category",this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(fw)},{ALT:()=>this.CONSUME(hw)}])}));At(this,"collision",this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(dw)},{ALT:()=>this.CONSUME(pw)},{ALT:()=>this.CONSUME(mw)},{ALT:()=>this.CONSUME(gw)},{ALT:()=>this.CONSUME(yw)},{ALT:()=>this.CONSUME(_w)},{ALT:()=>this.CONSUME(bw)},{ALT:()=>this.CONSUME(ww)},{ALT:()=>this.CONSUME(vw)}])}));At(this,"color",this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(Ew)},{ALT:()=>this.CONSUME(kw)},{ALT:()=>this.CONSUME(xw)},{ALT:()=>this.CONSUME(Aw)},{ALT:()=>this.CONSUME(Tw)},{ALT:()=>this.CONSUME(Sw)},{ALT:()=>this.CONSUME(Rw)},{ALT:()=>this.CONSUME(Ow)},{ALT:()=>this.CONSUME(Iw)},{ALT:()=>this.CONSUME(Nw)},{ALT:()=>this.CONSUME(Cw)},{ALT:()=>this.CONSUME(Lw)},{ALT:()=>this.CONSUME(Mw)},{ALT:()=>this.CONSUME(Uw)},{ALT:()=>this.CONSUME(Pw)},{ALT:()=>this.CONSUME(Fw)},{ALT:()=>this.CONSUME($w)},{ALT:()=>this.CONSUME(Bw)},{ALT:()=>this.CONSUME(Dw)},{ALT:()=>this.CONSUME(jw)},{ALT:()=>this.CONSUME(zw)},{ALT:()=>this.CONSUME(Ww)},{ALT:()=>this.CONSUME(Hw)},{ALT:()=>this.CONSUME(Gw)},{ALT:()=>this.CONSUME(Kw)},{ALT:()=>this.CONSUME(Yw)},{ALT:()=>this.CONSUME(qw)},{ALT:()=>this.CONSUME(Vw)},{ALT:()=>this.CONSUME(Xw)},{ALT:()=>this.CONSUME(Jw)},{ALT:()=>this.CONSUME(Zw)},{ALT:()=>this.CONSUME(Qw)},{ALT:()=>this.CONSUME(tv)},{ALT:()=>this.CONSUME(ev)},{ALT:()=>this.CONSUME(rv)},{ALT:()=>this.CONSUME(nv)},{ALT:()=>this.CONSUME(iv)},{ALT:()=>this.CONSUME(sv)},{ALT:()=>this.CONSUME(ov)},{ALT:()=>this.CONSUME(av)},{ALT:()=>this.CONSUME(cv)},{ALT:()=>this.CONSUME(lv)},{ALT:()=>this.CONSUME(uv)},{ALT:()=>this.CONSUME(fv)},{ALT:()=>this.CONSUME(hv)},{ALT:()=>this.CONSUME(dv)},{ALT:()=>this.CONSUME(pv)}])}));At(this,"dir_mod",this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(Sv)},{ALT:()=>this.CONSUME(Rv)},{ALT:()=>this.CONSUME(Ov)},{ALT:()=>this.CONSUME(Iv)},{ALT:()=>this.CONSUME(Vv)},{ALT:()=>this.CONSUME(Xv)}])}));At(this,"dir",this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(mv)},{ALT:()=>this.CONSUME(gv)},{ALT:()=>this.CONSUME(yv)},{ALT:()=>this.CONSUME(_v)},{ALT:()=>this.CONSUME(bv)},{ALT:()=>{this.CONSUME(wv),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)}},{ALT:()=>{this.CONSUME(vv),this.SUBRULE3(this.simple_token),this.SUBRULE4(this.simple_token)}},{ALT:()=>{this.CONSUME(Nv),this.SUBRULE5(this.simple_token),this.SUBRULE6(this.simple_token)}},{ALT:()=>{this.CONSUME(Cv),this.SUBRULE7(this.simple_token),this.SUBRULE8(this.simple_token)}},{ALT:()=>this.CONSUME(Ev)},{ALT:()=>this.CONSUME(kv)},{ALT:()=>this.CONSUME(xv)},{ALT:()=>this.CONSUME(Av)},{ALT:()=>this.CONSUME(Tv)},{ALT:()=>{this.CONSUME(Lv),this.SUBRULE1(this.kind)}},{ALT:()=>{this.CONSUME(Mv),this.SUBRULE2(this.kind)}},{ALT:()=>{this.CONSUME(Uv),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)}},{ALT:()=>this.CONSUME(Pv)},{ALT:()=>this.CONSUME(Fv)},{ALT:()=>this.CONSUME($v)},{ALT:()=>this.CONSUME(Bv)},{ALT:()=>this.CONSUME(Dv)},{ALT:()=>this.CONSUME(jv)},{ALT:()=>this.CONSUME(zv)},{ALT:()=>this.CONSUME(Wv)},{ALT:()=>this.CONSUME(Hv)},{ALT:()=>this.CONSUME(Gv)},{ALT:()=>this.CONSUME(Kv)},{ALT:()=>this.CONSUME(Yv)},{ALT:()=>this.CONSUME(qv)}])}));At(this,"expr_any",this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])}));At(this,"token_expr_any",this.RULED("token_expr_any",()=>{this.CONSUME(tE),this.SUBRULE(this.expr_any)}));At(this,"token_expr_count",this.RULED("token_expr_count",()=>{this.CONSUME(eE),this.SUBRULE(this.expr_any)}));At(this,"token_expr_blocked",this.RULED("token_expr_blocked",()=>{this.CONSUME(Qv),this.SUBRULE(this.dir)}));At(this,"token_expr_abs",this.RULED("token_expr_abs",()=>{this.CONSUME(rE),this.SUBRULE(this.simple_token)}));At(this,"token_expr_intceil",this.RULED("token_expr_intceil",()=>{this.CONSUME(nE),this.SUBRULE(this.simple_token)}));At(this,"token_expr_intfloor",this.RULED("token_expr_intfloor",()=>{this.CONSUME(iE),this.SUBRULE(this.simple_token)}));At(this,"token_expr_intround",this.RULED("token_expr_intround",()=>{this.CONSUME(sE),this.SUBRULE(this.simple_token)}));At(this,"token_expr_clamp",this.RULED("token_expr_clamp",()=>{this.CONSUME(oE),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)}));At(this,"token_expr_min",this.RULED("token_expr_min",()=>{this.CONSUME(aE),this.SUBRULE(this.simple_tokens)}));At(this,"token_expr_max",this.RULED("token_expr_max",()=>{this.CONSUME(cE),this.SUBRULE(this.simple_tokens)}));At(this,"token_expr_pick",this.RULED("token_expr_pick",()=>{this.CONSUME(lE),this.SUBRULE(this.simple_tokens)}));At(this,"token_expr_pickwith",this.RULED("token_expr_pickwith",()=>{this.CONSUME(uE),this.SUBRULE(this.simple_token),this.SUBRULE(this.simple_tokens)}));At(this,"token_expr_random",this.RULED("token_expr_random",()=>{this.CONSUME(fE),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))}));At(this,"token_expr_randomwith",this.RULED("token_expr_randomwith",()=>{this.CONSUME(hE),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))}));At(this,"token_expr_run",this.RULED("token_expr_run",()=>{this.CONSUME(dE),this.SUBRULE(this.string_token)}));At(this,"token_expr_runwith",this.RULED("token_expr_runwith",()=>{this.CONSUME(pE),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)}));At(this,"token_expr",this.RULED("token_expr",()=>{this.OR([{ALT:()=>this.CONSUME(Jv)},{ALT:()=>this.CONSUME(Zv)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_blocked)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])}));At(this,"string_token",this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(Ye)},{ALT:()=>this.CONSUME(vu)}])}));At(this,"simple_token",this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(op)},{ALT:()=>this.CONSUME(Ye)},{ALT:()=>this.CONSUME(vu)}])}));At(this,"simple_tokens",this.RULED("simple_tokens",()=>{this.AT_LEAST_ONE(this.simple_token)}));At(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(sp)},{ALT:()=>this.CONSUME(vu)},{ALT:()=>this.CONSUME(Ye)},{ALT:()=>this.CONSUME(op)},{ALT:()=>this.CONSUME(mE)},{ALT:()=>{this.CONSUME(SE),this.SUBRULE(this.expr),this.CONSUME(RE)}}])}));this.performSelfAnalysis()}PEEK(r,n,...i){console.info(r,i.map(s=>[s.image,s.tokenType]),n)}RULED(r,n,i){const s=uz.some(o=>r.includes(o));return this.RULE(r,()=>{const a=(wx++).toString().padStart(3),c=s?"font-weight: bold;":"";if(vx&&!this.RECORDING_PHASE){const u=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${r} ${u.join(" ")}`,c)}n(),vx&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${r} `,c),wx--},i)}}const Vo=new fz;if(II){const e=Vo.getGAstProductions(),t=lF(e);console.info(t)}const hz=Vo.getBaseCstVisitorConstructor();var xt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(xt||{}),Ys=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(Ys||{}),yi=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(yi||{}),zu=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(zu||{});function Le(e,t){const[r]=e??[];return((r==null?void 0:r.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class dz extends hz{constructor(){super();At(this,"unique",0);ii&&this.validateVisitor()}visit(r){if(pe(r)&&(r=r[0]),!!w(r))return this[r.name](r.children,r.location)}createcodenode(r,n){return[{...n,...r,lineindex:0}]}createstringnode(r,n){return this.createcodenode(r,{type:12,literal:1,value:n})}createtemplatenode(r,n){return this.createcodenode(r,{type:12,literal:2,value:n})}createmarknode(r,n,i){return this.createlinenode(r,this.createcodenode(r,{type:3,id:n,comment:i}))}creategotonode(r,n,i){return this.createlinenode(r,this.createcodenode(r,{type:4,id:n,comment:i}))}createlinenode(r,n){return this.createcodenode(r,{type:2,stmts:n})}createapinode(r,n,i){return this.createlinenode(r,this.createcodenode(r,{type:1,words:i,method:n}))}createlogicnode(r,n,i,s){return this.createlinenode(r,this.createcodenode(r,{type:14,skip:i,words:s,method:n}))}createcountnode(r){return this.createcodenode(r,{type:5,index:this.unique++})}createexprnodeondemand(r,n){return r.length===1?r[0]:this.createcodenode(n,{type:31,words:r})[0]}go(r){return Array.isArray(r)?r.map(n=>this.visit(n)).flat():w(r)?[this.visit(r)].flat():[]}program(r,n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(r.line)].flat()})}line(r){return r.stmt?this.go(r.stmt):[]}stmt(r){return r.stmt_label?this.go(r.stmt_label):r.stmt_stat?this.go(r.stmt_stat):r.stmt_text?this.go(r.stmt_text):r.stmt_comment?this.go(r.stmt_comment):r.stmt_hyperlink?this.go(r.stmt_hyperlink):r.stmt_command?this.go(r.stmt_command):r.short_go?this.go(r.short_go):r.short_try?this.go(r.short_try):[]}inline_go(r){const n=[];return r.short_go&&n.push(...this.go(r.short_go)),r.inline&&n.push(...this.go(r.inline)),n}inline_try(r){const n=[];return r.short_try&&n.push(...this.go(r.short_try)),r.inline&&n.push(...this.go(r.inline)),n}inline_command(r){const n=[];return r.stmt_command&&n.push(...this.go(r.stmt_command)),r.inline&&n.push(...this.go(r.inline)),n}inline(r){const n=[];return r.stmt_stat&&n.push(...this.go(r.stmt_stat)),r.stmt_text&&n.push(...this.go(r.stmt_text)),r.stmt_comment&&n.push(...this.go(r.stmt_comment)),r.stmt_hyperlink&&n.push(...this.go(r.stmt_hyperlink)),r.inline_go&&n.push(...this.go(r.inline_go)),r.inline_try&&n.push(...this.go(r.inline_try)),r.inline_command&&n.push(...this.go(r.inline_command)),r.structured_cmd&&n.push(...this.go(r.structured_cmd)),n}stmt_label(r,n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:Le(r.token_label,":").slice(1).trim()}))}stmt_stat(r,n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:Le(r.token_stat,"@").slice(1)}))}stmt_text(r,n){const i=Le(r.token_text,"");return this.createlinenode(n,this.createcodenode(n,{type:6,value:i}))}stmt_comment(r,n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:Le(r.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(r,n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:Le(r.token_hyperlink,"!").slice(1),text:Le(r.token_hyperlinktext,";").slice(1)}))}stmt_command(r,n){return r.structured_cmd?this.go(r.structured_cmd):this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(r.words)}))}structured_cmd(r){return r.command_if?this.go(r.command_if):r.command_while?this.go(r.command_while):r.command_repeat?this.go(r.command_repeat):r.command_waitfor?this.go(r.command_waitfor):r.command_foreach?this.go(r.command_foreach):r.command_break?this.go(r.command_break):r.command_continue?this.go(r.command_continue):[]}short_go(r,n){return r.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:[this.go(r.string_token),this.go(r.dir)].flat()})):[]}short_try(r,n){return r.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:[this.go(r.string_token),this.go(r.dir)].flat()})):[]}command_if(r,n){const[i]=this.createlogicnode(n,Le(r.token_if,"if").toLowerCase(),"",this.go(r.words)),[s]=this.go(r.command_if_block)??[];return this.createcodenode(n,{type:13,check:i,block:s})}command_if_block(r,n){const i=We(),s=We();return this.createcodenode(n,{type:15,skip:i,done:s,lines:[this.go(r.inline),this.go(r.line),this.creategotonode(n,s,"end of if"),this.createmarknode(n,i,"alt logic")].flat(),altlines:[this.go(r.command_else_if),this.go(r.command_else),this.createmarknode(n,s,"end of if")].flat()})}command_block(r){return[this.go(r.inline),this.go(r.line)].flat()}command_fork(r){return[this.go(r.inline),this.go(r.line)].flat()}command_else_if(r,n){const i=We(),s=We();return this.createcodenode(n,{type:16,done:s,lines:[this.createlogicnode(n,Le(r.token_if,"if"),i,this.go(r.words)),this.go(r.command_fork),this.creategotonode(n,s,"end of if"),this.createmarknode(n,i,"skip")].flat()})}command_else(r,n){const i=[];return r.words&&i.push(...this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(r.words)}))),r.command_fork&&i.push(...this.go(r.command_fork)),this.createcodenode(n,{type:17,lines:i})}command_while(r,n){const i=We(),s=We();return this.createcodenode(n,{type:18,loop:i,done:s,lines:[this.createmarknode(n,i,"start of while"),this.createlogicnode(n,"if",s,this.go(r.words)),this.go(r.command_block),this.creategotonode(n,i,"loop of while"),this.createmarknode(n,s,"end of while")].flat()})}command_repeat(r,n){const i=We(),s=We(),a=[this.createcountnode(n),this.go(r.words)].flat();return this.createcodenode(n,{type:21,loop:i,done:s,lines:[this.createapinode(n,"repeatstart",a),this.createmarknode(n,i,"start of repeat"),this.createlogicnode(n,"repeat",s,a),this.go(r.command_block),this.creategotonode(n,i,"loop of repeat"),this.createmarknode(n,s,"end of repeat")].flat()})}command_foreach(r,n){const i=We(),s=We(),a=[this.createcountnode(n),this.go(r.words)].flat();return this.createcodenode(n,{type:23,loop:i,done:s,lines:[this.createapinode(n,"foreachstart",a),this.createmarknode(n,i,"start of foreach"),this.createlogicnode(n,"foreach",s,a),this.go(r.command_block),this.creategotonode(n,i,"loop of foreach"),this.createmarknode(n,s,"end of foreach")].flat()})}command_waitfor(r,n){const i=We();return this.createcodenode(n,{type:22,loop:i,lines:[this.createmarknode(n,i,"start of waitfor"),this.createlogicnode(n,"waitfor",i,this.go(r.words))].flat()})}command_break(r,n){return this.createcodenode(n,{type:19,goto:0})}command_continue(r,n){return this.createcodenode(n,{type:20,goto:0})}command_play(r,n){const i=Le(r.token_command_play,"").trim(),[s,...o]=i.split(" ");return[this.createstringnode(n,s),this.createstringnode(n,o.join(" "))].flat()}command_toast(r,n){const s=Le(r.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(n,"toast"),this.createtemplatenode(n,s)].flat()}command_ticker(r,n){const s=Le(r.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(n,"ticker"),this.createtemplatenode(n,s)].flat()}expr(r,n){return r.RHS?this.createcodenode(n,{type:24,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}and_test(r,n){return r.RHS?this.createcodenode(n,{type:25,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}not_test(r,n){return r.comparison?this.go(r.comparison):r.LHS?this.createcodenode(n,{type:26,items:this.go(r.LHS)}):[]}comparison(r,n){if(r.RHS){const[i]=this.go(r.comp_op);return this.createcodenode(n,{type:27,compare:i,lhs:this.createexprnodeondemand(this.go(r.LHS),n),rhs:this.createexprnodeondemand(this.go(r.RHS),n)})}return this.go(r.LHS)}comp_op(r,n){return r.token_iseq?this.createcodenode(n,{type:28,method:0}):r.token_isnoteq?this.createcodenode(n,{type:28,method:1}):r.token_islessthan?this.createcodenode(n,{type:28,method:2}):r.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):r.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):r.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(r,n){return r.RHS?this.createcodenode(n,{type:24,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}and_test_value(r,n){return r.RHS?this.createcodenode(n,{type:25,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}not_test_value(r,n){return r.arith_expr?this.go(r.arith_expr):r.LHS?this.createcodenode(n,{type:26,items:this.go(r.LHS)}):[]}arith_expr(r,n){if(r.LHS)return this.go(r.LHS);const i=this.go(r.term);return r.RHS?this.createcodenode(n,{type:29,lhs:i[0],items:this.go(r.RHS)}):i}arith_expr_item(r,n){return this.createcodenode(n,{type:30,operator:r.token_plus?1:2,rhs:this.go(r.term)[0]})}term(r,n){return r.term_item?this.createcodenode(n,{type:29,lhs:this.go(r.factor)[0],items:this.go(r.term_item)}):this.go(r.factor)}term_item(r,n){let i=0;return r.token_multiply&&(i=4),r.token_divide&&(i=5),r.token_moddivide&&(i=6),r.token_floordivide&&(i=7),this.createcodenode(n,{type:30,operator:i,rhs:this.go(r.factor)[0]})}factor(r,n){if(r.power)return this.go(r.power);let i=0;return r.token_plus&&(i=8),r.token_minus&&(i=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:i,rhs:this.go(r.LHS)[0]})})}power(r,n){const i=this.go(r.token);return r.factor?this.createcodenode(n,{type:29,lhs:i[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(r.factor)[0]})}):i}words(r){return this.go(r.expr)}kind(r){return[this.go(r.color),this.go(r.string_token)].flat()}category(r,n){return r.token_isterrain?this.createcodenode(n,{type:12,literal:1,value:"isterrain"}):r.token_isobject?this.createcodenode(n,{type:12,literal:1,value:"isobject"}):[]}collision(r,n){return r.token_iswalkable?this.createcodenode(n,{type:12,literal:1,value:"iswalkable"}):r.token_iswalking?this.createcodenode(n,{type:12,literal:1,value:"iswalking"}):r.token_iswalk?this.createcodenode(n,{type:12,literal:1,value:"iswalk"}):r.token_isswimmable?this.createcodenode(n,{type:12,literal:1,value:"isswimmable"}):r.token_isswimming?this.createcodenode(n,{type:12,literal:1,value:"isswimming"}):r.token_isswim?this.createcodenode(n,{type:12,literal:1,value:"isswim"}):r.token_issolid?this.createcodenode(n,{type:12,literal:1,value:"issolid"}):r.token_isbullet?this.createcodenode(n,{type:12,literal:1,value:"isbullet"}):r.token_isghost?this.createcodenode(n,{type:12,literal:1,value:"isghost"}):[]}color(r,n){let i="ERROR";return r.token_black&&(i="black"),r.token_dkblue&&(i="dkblue"),r.token_dkgreen&&(i="dkgreen"),r.token_dkcyan&&(i="dkcyan"),r.token_dkred&&(i="dkred"),r.token_dkpurple&&(i="dkpurple"),r.token_dkyellow&&(i="dkyellow"),r.token_ltgray&&(i="ltgray"),r.token_dkgray&&(i="dkgray"),r.token_blue&&(i="blue"),r.token_green&&(i="green"),r.token_cyan&&(i="cyan"),r.token_red&&(i="red"),r.token_purple&&(i="purple"),r.token_yellow&&(i="yellow"),r.token_white&&(i="white"),r.token_brown&&(i="brown"),r.token_dkwhite&&(i="dkwhite"),r.token_ltgrey&&(i="ltgrey"),r.token_gray&&(i="gray"),r.token_grey&&(i="grey"),r.token_dkgrey&&(i="dkgrey"),r.token_ltblack&&(i="ltblack"),r.token_onblack&&(i="onblack"),r.token_ondkblue&&(i="ondkblue"),r.token_ondkgreen&&(i="ondkgreen"),r.token_ondkcyan&&(i="ondkcyan"),r.token_ondkred&&(i="ondkred"),r.token_ondkpurple&&(i="ondkpurple"),r.token_ondkyellow&&(i="ondkyellow"),r.token_onltgray&&(i="onltgray"),r.token_ondkgray&&(i="ondkgray"),r.token_onblue&&(i="onblue"),r.token_ongreen&&(i="ongreen"),r.token_oncyan&&(i="oncyan"),r.token_onred&&(i="onred"),r.token_onpurple&&(i="onpurple"),r.token_onyellow&&(i="onyellow"),r.token_onwhite&&(i="onwhite"),r.token_onbrown&&(i="onbrown"),r.token_ondkwhite&&(i="ondkwhite"),r.token_onltgrey&&(i="onltgrey"),r.token_ongray&&(i="ongray"),r.token_ongrey&&(i="ongrey"),r.token_ondkgrey&&(i="ondkgrey"),r.token_onltblack&&(i="onltblack"),r.token_onclear&&(i="onclear"),this.createcodenode(n,{type:12,literal:1,value:i})}dir_mod(r,n){let i="ERROR";return r.token_cw&&(i="cw"),r.token_ccw&&(i="ccw"),r.token_opp&&(i="opp"),r.token_rndp&&(i="rndp"),r.token_over&&(i="over"),r.token_under&&(i="under"),this.createcodenode(n,{type:12,literal:1,value:i})}dir(r,n){const i=this.go(r.dir_mod)??[];return r.token_i&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"i"})),r.token_idle&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"idle"})),r.token_n&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"n"})),r.token_u&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"u"})),r.token_north&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"north"})),r.token_up&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"up"})),r.token_s&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"s"})),r.token_d&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"d"})),r.token_south&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"south"})),r.token_down&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"down"})),r.token_w&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"w"})),r.token_l&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"l"})),r.token_west&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"west"})),r.token_left&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"left"})),r.token_e&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"e"})),r.token_r&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"r"})),r.token_east&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"east"})),r.token_right&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"right"})),r.token_rnd&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"rnd"})),r.token_rndne&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"rndne"})),r.token_rndns&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"rndns"})),r.token_flow&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"flow"})),r.token_seek&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"seek"})),r.token_by&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"by"}),...this.go(r.simple_token)),r.token_at&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"at"}),...this.go(r.simple_token)),r.token_away&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"away"}),...this.go(r.simple_token)),r.token_toward&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"toward"}),...this.go(r.simple_token)),r.token_find&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"find"}),...this.go(r.kind)),r.token_flee&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"flee"}),...this.go(r.kind)),r.token_to&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"to"}),...this.go(r.dir)),i.flat()}expr_any(r){return[this.go(r.dir),this.go(r.kind),this.go(r.color)].flat()}token_expr_any(r,n){return[this.createcodenode(n,{type:12,literal:1,value:"any"}),this.go(r.expr_any)].flat()}token_expr_count(r,n){return[this.createcodenode(n,{type:12,literal:1,value:"countof"}),this.go(r.expr_any)].flat()}token_expr_blocked(r,n){return[this.createcodenode(n,{type:12,literal:1,value:"blocked"}),this.go(r.dir)].flat()}token_expr_abs(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"abs"}),...this.go(r.simple_token)]}token_expr_intceil(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intceil"}),...this.go(r.simple_token)]}token_expr_intfloor(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intfloor"}),...this.go(r.simple_token)]}token_expr_intround(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intround"}),...this.go(r.simple_token)]}token_expr_clamp(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"clamp"}),...this.go(r.simple_token)]}token_expr_min(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"min"}),...this.go(r.simple_tokens)]}token_expr_max(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"max"}),...this.go(r.simple_tokens)]}token_expr_pick(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"pick"}),...this.go(r.simple_tokens)]}token_expr_pickwith(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"pickwith"}),...this.go(r.simple_tokens)]}token_expr_random(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"random"}),...this.go(r.simple_token)]}token_expr_randomwith(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"randomwith"}),...this.go(r.simple_token)]}token_expr_run(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"run"}),...this.go(r.string_token)]}token_expr_runwith(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"runwith"}),...this.go(r.simple_token),...this.go(r.string_token)]}token_expr(r,n){return r.token_expr_aligned?this.createcodenode(n,{type:12,literal:1,value:"aligned"}):r.token_contact?this.createcodenode(n,{type:12,literal:1,value:"contact"}):r.token_expr_any?this.go(r.token_expr_any):r.token_expr_count?this.go(r.token_expr_count):r.token_expr_blocked?this.go(r.token_expr_blocked):r.token_expr_abs?this.go(r.token_expr_abs):r.token_expr_intceil?this.go(r.token_expr_intceil):r.token_expr_intfloor?this.go(r.token_expr_intfloor):r.token_expr_intround?this.go(r.token_expr_intround):r.token_expr_clamp?this.go(r.token_expr_clamp):r.token_expr_min?this.go(r.token_expr_min):r.token_expr_max?this.go(r.token_expr_max):r.token_expr_pick?this.go(r.token_expr_pick):r.token_expr_pickwith?this.go(r.token_expr_pickwith):r.token_expr_random?this.go(r.token_expr_random):r.token_expr_randomwith?this.go(r.token_expr_randomwith):r.token_expr_run?this.go(r.token_expr_run):r.token_expr_runwith?this.go(r.token_expr_runwith):[]}string_token(r,n){if(r.token_stringliteraldouble){const i=Le(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Le(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}return[]}simple_token(r,n){if(r.token_stringliteraldouble){const i=Le(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Le(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_numberliteral){const i=parseFloat(Le(r.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:i})}return[]}simple_tokens(r,n){if(r.token_stringliteraldouble){const i=Le(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Le(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_numberliteral){const i=parseFloat(Le(r.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:i})}return[]}token(r,n){if(r.category)return this.go(r.category);if(r.collision)return this.go(r.collision);if(r.color)return this.go(r.color);if(r.dir)return this.go(r.dir);if(r.command_play)return this.go(r.command_play);if(r.command_toast)return this.go(r.command_toast);if(r.command_ticker)return this.go(r.command_ticker);if(r.token_label){const i=Le(r.token_label,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_stringliteraldouble){const i=Le(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Le(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_numberliteral){const i=parseFloat(Le(r.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:i})}if(r.token_lparen)return[this.createexprnodeondemand(this.go(r.expr),n)];if(r.token_stop){const i=Le(r.token_stop,"");return this.createcodenode(n,{type:12,literal:1,value:i})}return[]}}const pz=new dz,Qr={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Wu="zss.js";function fe(e,t){return new lz(e.startLine??1,e.startColumn??1,Wu,t)}function u0(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Hu(e){return`'${u0(e)}'`}function f0(e){const t=Op(e);return t.errors.length?e:`['${t.tokens.map(n=>{if(n.tokenType===Sp){const i=u0(n.image.substring(1));return Dt(i)==="center"?"$CENTER":`', api.get('${i}'), '`}return u0(n.image)}).join("")}'].join('')`}function gc(e){return e.filter(t=>t!==void 0).map(me)}function Ex(e){return fe(e,"")}function mz(e,t){const r=[];return e.forEach(n=>{r.push(n,t)}),r.pop(),r}function ar(e,t,r){return fe(e,[`api.${t}(`,...mz(r,", "),")"])}function gz(e){if(e.type===xt.COMPARE&&e.compare.type===xt.COMPARE_ITEM)switch(e.compare.method){case Ys.IS_EQ:return ar(e,"isEq",[me(e.lhs),me(e.rhs)]);case Ys.IS_NOT_EQ:return ar(e,"isNotEq",[me(e.lhs),me(e.rhs)]);case Ys.IS_LESS_THAN:return ar(e,"isLessThan",[me(e.lhs),me(e.rhs)]);case Ys.IS_GREATER_THAN:return ar(e,"isGreaterThan",[me(e.lhs),me(e.rhs)]);case Ys.IS_LESS_THAN_OR_EQ:return ar(e,"isLessThanOrEq",[me(e.lhs),me(e.rhs)]);case Ys.IS_GREATER_THAN_OR_EQ:return ar(e,"isGreaterThanOrEq",[me(e.lhs),me(e.rhs)])}return fe(e,"")}function qs(e,t,r){return e.prepend(`api.${t}(`),e.add([", ",me(r),")"])}function kx(e,t,r){return e.prepend(`api.${t}(`),e.add([me(r),")"])}function yz(e,t){if(e.type===xt.OPERATOR_ITEM)switch(e.operator){case yi.PLUS:return qs(t,"opPlus",e.rhs);case yi.MINUS:return qs(t,"opMinus",e.rhs);case yi.POWER:return qs(t,"opPower",e.rhs);case yi.MULTIPLY:return qs(t,"opMultiply",e.rhs);case yi.DIVIDE:return qs(t,"opDivide",e.rhs);case yi.MOD_DIVIDE:return qs(t,"opModDivide",e.rhs);case yi.FLOOR_DIVIDE:return qs(t,"opFloorDivide",e.rhs);case yi.UNI_PLUS:return kx(t,"opUniPlus",e.rhs);case yi.UNI_MINUS:return kx(t,"opUniMinus",e.rhs)}return fe(e,"")}function _z(e){if(e.type===xt.OPERATOR){const t=e.lhs?me(e.lhs):fe(e,"");return e.items.forEach(r=>yz(r,t)),t}return fe(e,"")}function Gu(e,t){return fe(e,[ar(e,"jump",[`${t}`]),"; continue;"])}function Di(e){return Qr.linelookup[e??""]??-1}function h0(e,t){Qr.linelookup[e]=t}function Xo(e,t,r){for(let n=0;n<e.length;++n){const i=e[n];switch(i.type){case xt.WHILE:case xt.REPEAT:case xt.FOREACH:case xt.ELSE_IF:i.type===t&&(i.done=r);break;case xt.IF_BLOCK:case xt.IF_CHECK:i.type===t&&(i.skip=r);break;case xt.LINE:Xo(i.stmts,t,r);break}}}function xx(e,t,r){for(let n=0;n<e.length;++n){const i=e[n];switch(i.type){case xt.WHILE:case xt.REPEAT:case xt.FOREACH:case xt.ELSE_IF:i.type===t&&h0(i.done,r);break;case xt.IF_BLOCK:case xt.IF_CHECK:i.type===t&&h0(i.skip,r);break;case xt.LINE:xx(i.stmts,t,r);break}}}function me(e){var t;switch(e.type){case xt.PROGRAM:return fe(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { return 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(me).flat(),`default:
`,`  return 0;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Wu}`]);case xt.API:return fe(e,["  ",ar(e,e.method,gc(e.words)),`;
`]);case xt.LINE:return fe(e,[`case ${e.lineindex}:
`,...e.stmts.map(me).flat(),`  break;
`]);case xt.MARK:return fe(e,`  // ${e.comment}
`);case xt.GOTO:{const r=Di(e.id);return fe(e,["  ",Gu(e,r),`
`])}case xt.COUNT:return fe(e,`${e.index}`);case xt.LITERAL:switch(e.literal){case zu.NUMBER:return fe(e,`${e.value}`);case zu.STRING:return fe(e,Hu(e.value));case zu.TEMPLATE:return fe(e,f0(e.value))}return Ex(e);case xt.TEXT:return fe(e,["  ",ar(e,"text",[f0(e.value)]),`;
`]);case xt.STAT:if(Qr.isfirststat){Qr.isfirststat=!1;const r=e.value.trim().split(" ").map(Hu);return fe(e,["  ",ar(e,"stat",r),`;
`])}return fe(e,`  // skipped ${e.value}
`);case xt.LABEL:{const r=Dt(e.name),n=e.active?"label":"comment";Qr.labels[r]||(Qr.labels[r]=[]);const i=(e.active?1:-1)*e.lineindex;return Qr.labels[r].push(i),fe(e,`  // ${i} '${r}' ${n}
`)}case xt.HYPERLINK:return fe(e,["  ",ar(e,"hyperlink",[f0(e.text),...e.link.split(" ").filter(r=>r.length>0).map(Hu)]),`;
`]);case xt.MOVE:{const r=ar(e,"command",[Hu("go"),gc(e.words)].flat());return e.wait?fe(e,["  if (",r,`) { continue; };
`]):fe(e,["  ",r,`;
`])}case xt.COMMAND:return fe(e,["  if (",ar(e,"command",gc(e.words)),`) { continue; };
`]);case xt.IF:{const r=((t=e.block)==null?void 0:t.type)===xt.IF_BLOCK?e.block:void 0;if(w(r)){Xo([e.check],xt.IF_CHECK,r.skip);const n=fe(e,me(e.check));return r.lines.forEach(i=>n.add(me(i))),xx(r.altlines,xt.ELSE_IF,Di(r.done)),r.altlines.forEach(i=>n.add(me(i))),n}return fe(e,me(e.check))}case xt.IF_CHECK:{const r=Di(e.skip);return r===-1?fe(e,["  ",ar(e,e.method,gc(e.words)),`;
`]):fe(e,["  if (!",ar(e,e.method,gc(e.words)),") { ",Gu(e,r),` }
`])}case xt.ELSE_IF:case xt.ELSE:{const r=fe(e,"");return e.lines.forEach(n=>r.add(me(n))),r}case xt.WHILE:{const r=Di(e.loop),n=Di(e.done),i=fe(e,"");return Xo(e.lines,xt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case xt.BREAK:s.goto=n;break;case xt.CONTINUE:s.goto=r;break}i.add(me(s))}),i}case xt.REPEAT:{const r=Di(e.loop),n=Di(e.done),i=fe(e,"");return Xo(e.lines,xt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case xt.BREAK:s.goto=n;break;case xt.CONTINUE:s.goto=r;break}i.add(me(s))}),i}case xt.WAITFOR:{const r=fe(e,"");return Xo(e.lines,xt.IF_CHECK,e.loop),e.lines.forEach(n=>{r.add(me(n))}),r}case xt.FOREACH:{const r=Di(e.loop),n=Di(e.done),i=fe(e,"");return Xo(e.lines,xt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case xt.BREAK:s.goto=n;break;case xt.CONTINUE:s.goto=r;break}i.add(me(s))}),i}case xt.BREAK:return fe(e,["  ",Gu(e,e.goto),`
`]);case xt.CONTINUE:return fe(e,["  ",Gu(e,e.goto),`
`]);case xt.OR:return ar(e,"or",e.items.map(me));case xt.AND:return ar(e,"and",e.items.map(me));case xt.NOT:return ar(e,"not",e.items.map(me));case xt.COMPARE:return gz(e);case xt.OPERATOR:return _z(e);case xt.EXPR:return ar(e,"expr",e.words.map(me));default:return console.error("<unsupported node>",e.type,e),Ex(e)}}function _i(e){if(w(e))switch(e.type===xt.LINE&&++Qr.lineindex,e.lineindex=Qr.lineindex,e.type){case xt.PROGRAM:e.lines.forEach(_i);break;case xt.LINE:e.stmts.forEach(_i);break;case xt.MARK:h0(e.id,e.lineindex);break;case xt.IF:_i(e.check),_i(e.block);break;case xt.IF_BLOCK:e.lines.forEach(_i),e.altlines.forEach(_i);break;case xt.ELSE_IF:e.lines.forEach(_i);break;case xt.ELSE:case xt.WHILE:case xt.REPEAT:case xt.FOREACH:case xt.WAITFOR:e.lines.forEach(_i);break;case xt.MOVE:case xt.COMMAND:case xt.IF_CHECK:e.words.forEach(_i);break}}function bz(e){Qr.labels={},Qr.internal=1,Qr.lineindex=0,Qr.isfirststat=!0,_i(e)}function wz(e){return bz(e),{...me(e).toStringWithSourceMap({file:`${Wu}.map`}),...Qr}}function Ax(e){return pe(e)?e.length>0?1:0:e??0}function vz(e){return`${e}_chip`}function Tx(e=""){return`vm:${e??""}`}function Ez(e,t,r){var u;const n=vz(e),i=In(n);let s;const o=Ln(Object.entries(r.labels??{}));(!pe(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((u=r.errors)==null?void 0:u.length)??0)!==0?1:0);function a(l,h){k.words=h;const d=pj(t,l);return w(d)?d(c,h):l!=="send"?a("shortsend",[l,...h]):0}const c={halt(){Fz(n)},id(){return e},set(l,h){const[d,f]=gj(t,c,l,h);if(d)return f},get(l){const[h,d]=mj(t,c,l);if(h)return d},tick(l){const h=Et(i.ps)?i.ps:0,d=h%l===0;if(i.ps=h+1,d===!1)return!1;if(c.shouldtick()===!1)return Wk(t,c),!1;i.lc=0,i.ys=0,k.get=c.get,yj(t,c);try{s!=null&&s(c)||(i.es=1)}catch(f){_e(lt,k.elementfocus,"crash",f.message),i.es=1}return Wk(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Et(i.lc)?++i.lc>Rs.HALT_AT_COUNT:!0},haslabel(l){if(pe(i.lb))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===l)return(f.find(p=>Et(p)&&p>0)??0)>0}return!1},hm(){if(pe(i.mg)&&pe(i.lb)){const[l]=i.mg;if(w(l))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===l)return f.find(m=>Et(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(l){i.ec=l},sy(){return!!i.ys||c.shouldhalt()},send(l,h,d,f){lt.emit(l,`${Tx(h)}:${d}`,f)},lock(l){i.lk=l},unlock(){i.lk=""},message(l){i.lk&&l.sender!==i.lk||c.haslabel(l.target)&&(i.mg=[l.target,l.data,l.sender,l.player])},zap(l){if(pe(i.lb))for(let h=0;h<i.lb.length;++h){const d=i.lb[h];if(d[0]===l){const f=d[1].findIndex(m=>m>0);if(f>=0&&w(d[1])){d[1][f]*=-1;break}}}},restore(l){if(pe(i.lb))for(let h=0;h<i.lb.length;++h){const d=i.lb[h];if(d[0]===l)for(let f=0;f<d[1].length;f++)d[1][f]=Math.abs(d[1][f])}},getcase(){i.ec=Et(i.ec)?i.ec:1;const l=c.hm();if(l&&pe(i.mg)){const[,h,d,f]=i.mg;c.set("sender",d),w(h)&&c.set("arg",h),f&&(c.set("player",f),k.elementfocus=f),i.mg=void 0,i.ys=0,i.es=0,i.ec=l}return i.ec},nextcase(){const l=Et(i.ec)?i.ec:1;return i.ec=l+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(l){const h=_I.parse(l),[d]=h.filter(f=>f.fileName===Wu);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(l){return a("text",[l])},stat(...l){return a("stat",l)},hyperlink(...l){return a("hyperlink",l)},command(...l){if(l.length===0)return 0;const[h,...d]=l;return a(Dt(Ie(h)),d)},if(...l){const[h,d]=ut(l,0,[q.ANY]),f=Ax(h);return f&&d<l.length&&c.command(...l.slice(d)),f?1:0},try(...l){const[,h]=ut(l,0,[q.DIR]),d=c.command("go",...l);return d&&h<l.length&&c.command(...l.slice(h)),d?1:0},take(...l){const[h,d,f]=ut(l,0,[q.NAME,q.ANY]),m=Et(d),p=m?f:1,g=c.get(h),y=m?d:1;if(!Et(g))return p<l.length&&c.command(...l.slice(p)),1;const b=g-y;return b<0?(p<l.length&&c.command(...l.slice(p)),1):(c.set(h,b),0)},give(...l){const[h,d,f]=ut(l,0,[q.NAME,q.ANY]),m=Et(d),p=m?f:1,g=c.get(h),y=m?d:1,b=g===void 0?1:0;return b&&p<l.length&&c.command(...l.slice(p)),c.set(h,Sa(g,0)+y),b},repeatstart(l,...h){const[d,f]=ut(h,0,[q.NUMBER]),m=`repeatcount${l}`,p=`repeatwords${l}`;i[m]=d,i[p]=f<h.length?h.slice(f):void 0},repeat(l){const h=`repeatcount${l}`,d=`repeatwords${l}`;if(!Et(i[h]))return 0;const f=i[h];i[h]=f-1;const m=f>0,p=i[d];return m&&pe(p)&&c.command(...p),m?1:0},foreachstart(l,...h){const[d,f,m,p]=ut(h,0,[q.NAME,q.NUMBER,q.NUMBER,q.MAYBE_NUMBER]);let g=Math.min(f,m),y=Math.max(f,m);const b=(p??0)||1;if(b<0){const T=g;g=y,y=T}return c.set(d,g-b),0},foreach(l,...h){const[d,f,m,p,g]=ut(h,0,[q.NAME,q.NUMBER,q.NUMBER,q.MAYBE_NUMBER]);let y=Math.min(f,m),b=Math.max(f,m);const T=(p??0)||1;if(T<0){const I=y;y=b,b=I}let A=c.get(d);!Et(A)||A<y||A>b?A=y:A+=T;const x=A<=b?1:0;return x&&(c.set(d,A),g<h.length&&c.command(...h.slice(g))),x},waitfor(...l){const[h]=ut(l,0,[q.ANY]),d=Ax(h);return d||c.yield(),d?1:0},or(...l){let h=0;for(let d=0;d<l.length;){const[f,m]=ut(l,d,[q.ANY]);if(h=f,h)break;d=m}return h},and(...l){let h=0;for(let d=0;d<l.length;){const[f,m]=ut(l,d,[q.ANY]);if(h=f,!h)break;d=m}return h},not(...l){const[h]=ut(l,0,[q.ANY]);return h?0:1},expr(...l){const[h]=ut(l,0,[q.ANY]);return h},isEq(l,h){const[d]=ut([l],0,[q.ANY]),[f]=ut([h],0,[q.ANY]);return typeof d=="object"||typeof f=="object"?iT(d,f)?1:0:d===f?1:0},isNotEq(l,h){return this.isEq(l,h)?0:1},isLessThan(l,h){const[d]=ut([l],0,[q.NUMBER]),[f]=ut([h],0,[q.NUMBER]);return d<f?1:0},isGreaterThan(l,h){const[d]=ut([l],0,[q.NUMBER]),[f]=ut([h],0,[q.NUMBER]);return d>f?1:0},isLessThanOrEq(l,h){const[d]=ut([l],0,[q.NUMBER]),[f]=ut([h],0,[q.NUMBER]);return d<=f?1:0},isGreaterThanOrEq(l,h){const[d]=ut([l],0,[q.NUMBER]),[f]=ut([h],0,[q.NUMBER]);return d>=f?1:0},opPlus(l,h){const[d]=ut([l],0,[q.ANY]),[f]=ut([h],0,[q.ANY]);return d+f},opMinus(l,h){const[d]=ut([l],0,[q.ANY]),[f]=ut([h],0,[q.ANY]);return d-f},opPower(l,h){const[d]=ut([l],0,[q.NUMBER]),[f]=ut([h],0,[q.NUMBER]);return Math.pow(d,f)},opMultiply(l,h){const[d]=ut([l],0,[q.NUMBER]),[f]=ut([h],0,[q.NUMBER]);return d*f},opDivide(l,h){const[d]=ut([l],0,[q.NUMBER]),[f]=ut([h],0,[q.NUMBER]);return d/f},opModDivide(l,h){const[d]=ut([l],0,[q.NUMBER]),[f]=ut([h],0,[q.NUMBER]);return d%f},opFloorDivide(l,h){const[d]=ut([l],0,[q.NUMBER]),[f]=ut([h],0,[q.NUMBER]);return Math.floor(d/f)},opUniPlus(l){const[h]=ut([l],0,[q.NUMBER]);return+h},opUniMinus(l){const[h]=ut([l],0,[q.NUMBER]);return-h}};return s=r.code,c}function d0(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(r=>{if(r!=="parent"){const n=e[r];pe(n)?n.forEach(i=>{t.push(d0(i))}):t.push(d0(n))}}),e.range={start:Math.min(...t.filter(r=>r).map(r=>(r==null?void 0:r.start)??0)),end:Math.max(...t.filter(r=>r).map(r=>(r==null?void 0:r.end)??0))},e.range}function kz(e){const t=DE(`${e}
`);if(t.errors.length>0)return t;Vo.input=t.tokens;const r=Vo.program();if(Vo.errors.length>0)return{tokens:t.tokens,errors:Vo.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[n]=pz.go(r);return n?(d0(n),{tokens:t.tokens,cst:r,ast:n}):{tokens:t.tokens,cst:r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}function xz(e,t){const r=`compile-${e}`;console.time(r);const n=kz(t);if(console.timeEnd(r),xy&&console.info(t,n.errors),n.errors&&n.errors.length>0)return console.info(t,n.tokens,n.errors),n;if(!n.ast)return{...n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=wz(n.ast);if(i.code){xy&&console.info(i.code);try{return{...n,...i,source:i.code,code:new Function("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Function("api"," ")}}}return{...n,...i,source:"",code:new Function("api"," ")}}function Az(){const e={},t={};function r(i,s){const o=e[s];if(o)return o;const a=xz(i,s);return e[s]=a,a}const n={ids(){return Object.keys(t)},isended(i){const s=t[i];return w(s)?s.isended():!0},halt(i){const s=t[i];return w(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=n.ids();for(let s=0;s<i.length;++s)n.isended(i[s])&&n.halt(i[s])},arg(i,s){const o=t[i];w(o)&&o.set("arg",s)},tick(i,s,o,a,c){var l;let u=t[i];if(!w(t[i])){const h=r(a,c);if(u=t[i]=Ez(i,s,h),(l=h.errors)!=null&&l.length){const[d]=h.errors,f=((d==null?void 0:d.line)??2)-1,m=c.replaceAll(`\r
`,"").split(`
`).map((A,x)=>[A,x]),p=m.slice(f-2,f);for(let A=0;A<p.length;++A){const[x,I]=p[A];_e(lt,$r(),"build",`$grey${I+1} $grey${x}`)}const[g,y]=m[f]??[];if(yt(g)&&w(y)){const A=(d.column??1)-1,x=A+d.length,I=A<g.length?g:`${g}*`,R=I.substring(0,A),$=I.substring(A,x),M=I.substring(x);_e(lt,$r(),"build",`$red${y+1} $grey${R}$red${$}$grey${M}`)}const b=m.slice(f+1,f+3);for(let A=0;A<b.length;++A){const[x,I]=b[A];_e(lt,$r(),"build",`$grey${I+1} $grey${x}`)}const T=d.message.split(`
`).slice(0,4).join(" ");return _e(lt,$r(),"build",T),!1}}return!!(u!=null&&u.tick(o))},once(i,s,o,a){const c=n.tick(i,s,1,o,a);return n.halt(i)&&c},message(i){const{target:s,path:o}=zr(i.target),a=t[s];if(w(a)){const c={...i,target:o};a.message(c)}}};return n}const Ir=new wa,Fr={},Ku={};function Sx(e,t,r,n,i,s=0){const o=`tiles:${e}:${t}`;return w(Fr[o])||(Fr[o]=vI(e,t,r,n,i,s)),Fr[o]}function Tz(e,t,r,n){const i=`sprites:${e}:${t}:${r}`,s=`sprite:${e}:${t}:${n}`;return w(Ku[s])||(Ku[s]=EI(e,t,r)),Ku[s].id=i,Ku[s]}function Sz(e,t){const r=`sprites:${e}:${t}`;return w(Fr[r])||(Fr[r]=kI(e,t)),Fr[r]}function Rz(e,t,r,n,i=0){const s=`dither:${e}:${t}`;return w(Fr[s])||(Fr[s]=xI(e,t,r,n,i)),Fr[s]}function Yu(e,t,r,n){const i=`media:${e}:${t}`;w(Fr[i])||(Fr[i]=AI(e,t,r,n));const s=Fr[i];return s.mime=r,s.media=n,s}function Oz(e,t){const r=`control:${e}:${t}`;return w(Fr[r])||(Fr[r]=TI(e,t)),Fr[r]}const cs=3;function Rx(e,t){const r=[],n=(e.x+.5)*Ts,i=(e.y+.5)*Ss,s=t.x*Ts,o=t.y*Ss,a=s-n,c=o-i;Ir.x=a-cs,Ir.y=c-cs,r.push(Ir.angle()),Ir.x=a+Ts+cs,Ir.y=c-cs,r.push(Ir.angle()),Ir.x=a-cs,Ir.y=c+Ss+cs,r.push(Ir.angle()),Ir.x=a+Ts+cs,Ir.y=c+Ss+cs,r.push(Ir.angle());const u=r.map(f=>Math.round(fy(f))),l=Math.min(...u),h=Math.max(...u);if(h-l>180){const f=u.filter(y=>y<180),m=u.filter(y=>y>180),p=Math.max(...f);return[Math.min(...m),p]}return[l,h]}function qu(e,t,r,n,i,s,o,a,c){var T;const u={x:a,y:c},l=ji(e,u);if(l===-1)return;Ir.x=a-i.x,Ir.y=Math.round((c-i.y)*1.333);const h=Ir.length();if(h>s)return;const d=Math.round(fy(Ir.angle()));let f=0;for(let A=0;A<r.length;++A){const[x,I,R]=r[A];x>I?(d>=x||d<=I)&&(f=Math.max(f,R)):d>=x&&d<=I&&(f=Math.max(f,R))}const m=s*.5;t[l]=Math.min(t[l],f+(h<m?0:(h-m)*o)),t[l]=Ge(t[l],0,1);const p=Nr(e,((T=e.lookup)==null?void 0:T[l])??"");if(w(p)){const A=[...Rx(i,u),.25];n.push(A)}const g=e.terrain[l],y=Rn(g),b=(g==null?void 0:g.collision)??(y==null?void 0:y.collision);if(_c(Ht.ISBULLET,b)){const A=[...Rx(i,u),1];n.push(A)}}function p0(e,t,r,n,i,s){if(!w(r)||!w(r.terrain)||!w(r.objects))return[];const o=[];let a=t;const c=Ct,u=Zt,l=s?zt.BLACK:zt.ONCLEAR,h=Sx(e,a++,"terrain",c,u,l);o.push(h);const d=a++,f=Sz(e,d);f.sprites=[],o.push(f);const m=r.isdark?1:0,p=Rz(e,a++,c,u,m);o.push(p),p.alphas.fill(m);const g=Sx(e,a++,"tickers",c,u,zt.ONCLEAR);o.push(g),g.char.fill(0);const y={...Ip(Ct,Zt,n,zt.ONCLEAR),...g},b=Oz(e,a++);if(i){o.push(b);const{graphics:$,camera:M,facing:H}=In(e),X=r.graphics??$??"",O=r.camera??M??"",N=r.facing??H??"";if(yt(X)){const E=Dt(X);switch(E){case"fpv":case"iso":case"flat":case"mode7":b.graphics=E;break;default:b.graphics="flat";break}}if(yt(O))switch(Dt(O)){default:case"mid":b.viewscale=dl.MID;break;case"near":b.viewscale=dl.NEAR;break;case"far":b.viewscale=dl.FAR;break}Et(N)&&(b.facing=uy(N%360))}for(let $=0;$<r.terrain.length;++$){const M=r.terrain[$],H=mr(M,0,zt.WHITE,s?zt.BLACK:zt.ONCLEAR),X=Yt(M,"collision");h.char[$]=H.char,h.color[$]=H.color,h.bg[$]=H.bg,h.wall[$]=X===Ht.ISSOLID?1:0}const T=Object.values(r.objects??{}),A=new Set;for(let $=0;$<T.length;++$){const M=T[$];Er(M.id)&&Et(M.x)&&Et(M.y)&&A.add(Wr(M,Ct))}for(let $=0;$<T.length;++$){const M=T[$];if(w(M.removed))continue;const H=M.id??"";if(Er(H)===!1&&Et(M.x)&&Et(M.y)&&A.has(Wr(M,Ct))===!0)continue;const X=mr(M),O=Tz(e,d,H,$);if(O.x=M.x??0,O.y=M.y??0,O.char=X.char,O.color=X.color,O.bg=X.bg,f.sprites.push(O),m){if(X.light>0){const N=ji(r,O),E=Ge(Math.round(X.light),1,Zt),L=1/(E*.5);if(p.alphas[N]=0,E>1){const j=[];for(let U=1;U<=E;++U){if(U===2){const K=Yt(M,"lightdir");if(Hr(K)){const W=ef(r,M,"",K,O);switch(Bn(O,W.destpt)){case bt.EAST:j.push([45,315,1]);break;case bt.WEST:j.push([225,135,1]);break;case bt.NORTH:j.push([315,225,1]);break;case bt.SOUTH:j.push([135,45,1]);break}}}const V=[];for(let K=O.y-U;K<=O.y+U;++K)qu(r,p.alphas,j,V,O,E,L,O.x-U,K),qu(r,p.alphas,j,V,O,E,L,O.x+U,K);const Q=U-1;for(let K=O.x-Q;K<=O.x+Q;++K)qu(r,p.alphas,j,V,O,E,L,K,O.y-U),qu(r,p.alphas,j,V,O,E,L,K,O.y+U);for(let K=0;K<V.length;++K){const W=V[K];let P=0;for(P=0;P<j.length;++P){const st=j[P];if(st[1]>st[0]&&W[1]>=st[0]&&W[0]<=st[1]&&W[2]>=1&&st[2]>=1){j[P]=[Math.min(W[0],st[0]),Math.max(W[1],st[1]),1];break}}P===j.length&&j.push(W)}}}}else if(Er(H)){const N=ji(r,O);p.alphas[N]=0}}H===e&&(b.focusx=O.x,b.focusy=O.y,b.focusid=H)}for(let $=0;$<T.length;++$){const M=T[$];if(yt(M.tickertext)&&Et(M.tickertime)&&M.tickertext.length){const H=Ct,X=lk(M.tickertext,H,Zt-1),O=(X==null?void 0:X.measuredwidth)??1,N=M.x??0,E=M.y??0,L=E<Zt*.5;y.x=N-Math.floor(O*.5),y.y=E+(L?2:-2),y.x+O>Ct&&(y.x=Ct-O),y.x<0&&(y.x=0);const j={x:y.x,y:y.y};ck(M.tickertext,y,!0);for(let U=0;U<O;++U){const V=Wr({x:j.x+U,y:j.y},Ct);p.alphas[V]=Math.max(p.alphas[V],.666)}}}o.push(Yu(e,a++,"text/mood",m?"dark":"bright"));const x=ge(Xt.MAIN),I=Ui(x,Xt.MAIN);if(yt(I.palette)){const $=or(x,vt.PALETTE,I.palette),M=Ce($);w(M==null?void 0:M.bits)&&o.push(Yu(e,a++,"image/palette",Array.from(M.bits)))}if(yt(I.charset)){const $=or(x,vt.CHARSET,I.charset),M=Ce($);w(M==null?void 0:M.bits)&&o.push(Yu(e,a++,"image/charset",Array.from(M.bits)))}const R=Object.keys(r.objects).filter(Er);return o.push(Yu(e,a++,"text/players",R.join(","))),o}const dn=Az();var Xt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Xt||{});const Te={halt:!1,session:We(),operator:"",software:{main:"",content:""},books:new Map,loaders:new Map};function Iz(){return Te.session}function $r(){return Te.operator}function Nz(e){Te.operator=e}function Cz(e){Te.halt=e}function Lz(){return Te.halt}function Sn(){return[...Te.books.values()]}function Mz(){const[e]=Te.books.values();return e}function Ox(){const e=Sn(),t=ge("main"),[r]=e.filter(n=>n.id!==(t==null?void 0:t.id));return r??t}function Kn(e){const t=Dt(e);return Te.books.get(e)??Sn().find(r=>r.name===t)}function Ix(e,t){w(Kn(t))&&(Te.software[e]=t)}function ge(e){return Kn(Te.software[e])}function Nx(e){const t=bp([]);return yt(e)&&(t.name=e),Vu(t),Re(lt,Te.operator,`created [book] ${t.name}`),t}function Uz(e){let t=Kn(e);return w(t)||(t=bp([]),t.name=e),Vu(t),Re(lt,Te.operator,`created [book] ${t.name}`),t}function _r(e,t){let r=w(t)?Uz(t):ge(e);return w(r)||(w(r)||(r=Mz()),w(r)||(r=Nx(t)),w(r)&&Re(lt,Te.operator,`opened [book] ${r.name} for ${e}`)),Ix(e,r.id),r}function ls(e,t,r){return vp(_r(e),r,t)}function tn(e,t){const r=ge("main"),n=bn(KE(r,e,t));if(w(n))return n;const i=Sn();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==(r==null?void 0:r.id)){const a=bn(KE(o,e,t));if(w(a))return a}}}function Rn(e){if(w(e==null?void 0:e.kinddata))return e.kinddata;if(!yt(e==null?void 0:e.kind)||!e.kind)return;const t=tn(vt.OBJECT,e.kind);if(w(t))return e.kinddata=Ce(t),e.kinddata;const r=tn(vt.TERRAIN,e.kind);if(w(r))return e.kinddata=Ce(r),e.kinddata}function Yt(e,t){const r=e==null?void 0:e.kinddata,n=(r==null?void 0:r.id)??"",i=e==null?void 0:e[t];if(w(i))return i;const s=r==null?void 0:r[t];if(w(s))return s;const o=tn(vt.OBJECT,n)??tn(vt.TERRAIN,n),a=vF(o,t);if(w(a))return a;switch(t){case"group":return"";case"cycle":return om;case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"item":case"pushable":case"breakable":return 0;case"collision":return Ht.ISWALK;default:return}}function m0(e,t){const r={x:(e==null?void 0:e.x)??-1,y:(e==null?void 0:e.y)??-1},n={x:(t==null?void 0:t.x)??-1,y:(t==null?void 0:t.y)??-1},i=Bn(r,n),s=Yt(t,"pushable");return Et(s)?s!==0:yt(s)?s.trim().split(" ").map(o=>my(al(o))).some(o=>o===i):!1}function On(e,t,r,n){if(!w(e)||!w(t))return;const[i,s]=t,o=tn(vt.OBJECT,i);if(w(o)){const c=w0(e,r,i,n);if(w(c))return Pa(c,s),JE(e,c),Rn(c),Ep(e,c),c}const a=tn(vt.TERRAIN,i);if(w(a)){const c=r7(e,r,i);if(w(c)){Pa(c,s);const u=Wr(r,Ct);return Rn(c),Ep(e,c,u),c}}}function Pz(e,t,r){if(!w(e)||!w(t))return;const[n,i]=t,s=tn(vt.OBJECT,n);if(w(s)){const o=w0(e,r,n);return Pa(o,i),o}}function br(e){const t=tn(vt.BOARD,e);return Ce(t)}function In(e){const t=_r("main");return Ui(t,e)}function Cx(e){const t=_r("main");return xF(t,e)}function Lx(){const e=_r("main");return Ui(e,"main")}function Fz(e){const t=_r("main");return VE(t,e)}function $z(e,t){Te.books.clear(),e.forEach(n=>{Te.books.set(n.id,n),n.name==="main"&&(Te.software.main=n.id)});const r=Kn(t);if(w(r)&&(Te.software.main=r.id),!Te.software.main){const n=Te.books.values().next();n.value&&(Te.software.main=n.value.id)}}function Vu(e){return Te.books.set(e.id,e),e.id}function Bz(e){const t=Kn(e);t&&Te.books.delete(t.id)}function Mx(e){if(!yt(e)||!e)return _e(lt,e,"login",`failed for playerid ==>${e}<==`);const t=ge("main");if(!w(t))return _e(lt,e,"login:main","login failed to find book 'main'","login",`failed for playerid ==>${e}<==`);let r=qe(e);if(w(r==null?void 0:r.objects[e]))return!0;if(!w(r)){const u=tn(vt.BOARD,"title");r=Ce(u)}if(!w(r))return _e(lt,e,"login:title","login failed to find board with 'title' stat");const n=tn(vt.OBJECT,"player");if(!w(n))return _e(lt,e,"login:player","login failed to find object type 'player'");const i=r.startx??0,s=r.starty??0,o=Et(i)?i:Math.round(Ct*.5),a=Et(s)?s:Math.round(Zt*.5),c=w0(r,{x:o,y:a},"player",e);return w(c==null?void 0:c.id)?(c.player=e,Ru(t,e,r.id),!0):!1}function Dz(e){const t=ge("main");if(!w(t))return;const r=[];for(let i=0;i<t.activelist.length;++i){const s=t.activelist[i];s.startsWith(e)&&r.push(s)}const n=qe(e);for(let i=0;i<r.length;++i){const s=r[i];Ru(t,s,""),Tu(n,Nr(n,s)),Kx(n,s),dn.halt(s),VE(t,s)}}function qe(e){const t=ge("main"),r=XE(t,e,"board"),n=tn(vt.BOARD,r);return Ce(n)}function jz(e){const t=ge("main"),r=CF(t,e),n=qe(e),i=Nr(n,e);return r&&w(i)}function zz(e){const t=ge("main"),r=Do(t);for(let n=0;n<r.length;++n){const i=r[n],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Er(c)&&(Ru(t,c,i.id),w(e[c])||(e[c]=0))}}}function Ux(e){dn.message(e)}function Ve(e,t,r,n){if(yt(r.id))if(yt(t.id))im(lt,e,t.id,r.id,n);else{const i=`${Wr({x:t.x??0,y:t.y??0},Ct)}`;im(lt,e,i,r.id,n)}}function Wz(e,t,r,n){const i=r.id??"";if(n.x<0){const s=br((t==null?void 0:t.exitwest)??"");w(s)&&Bo(e,i,s.id,{x:Ct-1,y:n.y})}else if(n.x>=Ct){const s=br((t==null?void 0:t.exiteast)??"");w(s)&&Bo(e,i,s.id,{x:0,y:n.y})}else if(n.y<0){const s=br((t==null?void 0:t.exitnorth)??"");w(s)&&Bo(e,i,s.id,{x:n.x,y:Zt-1})}else if(n.y>=Zt){const s=br((t==null?void 0:t.exitsouth)??"");w(s)&&Bo(e,i,s.id,{x:n.x,y:0})}}function Yn(e,t,r,n){if(!w(r==null?void 0:r.id))return!1;let i=ZE(t,r,n);const s=Yt(r,"collision");if(w(i)&&s!==Ht.ISBULLET){const o=Er(r==null?void 0:r.id),a=!!Yt(i,"item");if(m0(r,i)&&(!o||!a)){const u=Bn({x:r.x??0,y:r.y??0},n),l=Be({x:i.x??0,y:i.y??0},u);Yn(e,t,i,l)}}if(i=ZE(t,r,n),w(i)){const o=Er(r.id),a=Er(r.party??r.id),c=Yt(r,"collision")===Ht.ISBULLET,u=r.kind??"";let l="";r.party&&a&&(l=r.party),o&&(l=r.id);const h=Er(i.id),d=Er(i.party??i.id),f=Yt(i,"collision")===Ht.ISBULLET,m=i.kind??"",p=a===d;let g="";if(i.party&&d&&(g=i.party),h&&(g=i.id??""),o&&m==="edge")Wz(e,t,r,n);else if(o)h?(Ve(p?"":g,i,r,"thud"),Ve(p?"":l,r,i,"bump")):f?(Ve(p?"":g,i,r,p?"partyshot":"shot"),Ve(l,r,i,"thud")):(Ve(p?"":g,i,r,"thud"),Ve(p?"":l,r,i,"touch"));else if(c)if(h)Ve(p?"":g,i,r,"thud"),Ve(p?"":l,r,i,p?"partyshot":"shot");else if(f)Ve(p?"":g,i,r,"thud"),Ve(p?"":l,r,i,"thud");else switch(Ve(p?"":g,i,r,"thud"),m){case"object":case"scroll":Ve(p?"":l,r,i,"shot");break;default:Ve(p?"":l,r,i,p?"partyshot":"shot");break}else if(h)Ve(p?"":g,i,r,"thud"),Ve(p?"":l,r,i,"bump");else if(f){switch(u){case"object":case"scroll":Ve(p?"":l,r,i,"shot");break;default:Ve(p?"":l,r,i,p?"partyshot":"shot");break}Ve(p?"":l,r,i,"thud")}else Ve(p?"":g,i,r,"thud"),Ve(p?"":l,r,i,"bump");if(c&&Yt(i,"breakable")){if(w(i==null?void 0:i.id)){const y=oe(t,{x:i.x??-1,y:i.y??-1});w(y)&&wr(k.board,y,k.timestamp)}else Me(t,{x:n.x,y:n.y});return!0}return!1}return!0}function Px(e,t,r,n){var u;if(!w(e)||!w(t)||!w(r))return;const i={...k};k.book=e,k.board=t,k.element=r,k.elementid=r.id??"",k.elementisplayer=Er(k.elementid);const s=k.element.player??Te.operator;k.elementfocus=k.elementisplayer?k.elementid:s;const o=Yt(r,"cycle"),a=r.id??"",c=Dt(r.name??((u=r.kinddata)==null?void 0:u.name)??"");if(dn.tick(a,ss.RUNTIME,o,c,n),Et(r==null?void 0:r.tickertime)&&k.timestamp-r.tickertime>Rc*5&&(r.tickertime=0,r.tickertext=""),k.elementisplayer){const l=In(k.elementid);Et(l.inputcurrent)&&(l.inputcurrent=0)}Dr(i).forEach(l=>{k[l]=i[l]})}function Hz(e,t){Te.loaders.set(e,t)}function Gz(e){dn.halt(e)}function Kz(){const e=dn.ids();for(let r=0;r<e.length;++r)dn.halt(e[r]);const t=ge("main");w(t)&&(t.flags={})}function Yz(e=!1){const t=ge("main");if(!w(t))return;const r=t.timestamp+1,n=Rs.HALT_AT_COUNT;Rs.HALT_AT_COUNT=n*2,Te.loaders.forEach((s,o)=>{const a={...k};k.timestamp=t.timestamp,k.book=t,k.board=void 0,k.element=void 0,k.elementid=o,k.elementisplayer=!1,k.elementfocus=$r();const c=N5(o);w(c)&&dn.arg(o,c),dn.tick(o,ss.LOADER,1,"loader",s),dn.isended(o)&&(dn.halt(o),Te.loaders.delete(o)),Dr(a).forEach(u=>{k[u]=a[u]})}),Rs.HALT_AT_COUNT=n,t.timestamp=r,k.timestamp=r;const i=Do(t);for(let s=0;s<i.length;++s){const o=i[s];for(let u=0;u<o.terrain.length;++u)Rn(o.terrain[u]);const a=Object.keys(o.objects);for(let u=0;u<a.length;++u){const l=a[u];Rn(o.objects[l])}const c=OF(o,r);for(let u=0;u<c.length;++u){const{id:l,type:h,code:d,object:f}=c[u];h===vt.ERROR?dn.halt(l):(!e||Er((f==null?void 0:f.id)??""))&&Px(t,o,f,d)}}}function Jo(e,t,r,n){const i=ge("main");if(!w(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(w(c.id)){const u=`${Tx(c.id)}:${t}`;lt.emit("",u,r)}}}if(Ea(e)){for(let o=0;o<n.length;++o){const a=n[o],c=oe(a,e);w(c)&&s([c])}return}for(let o=0;o<n.length;++o){const a=n[o];switch(Dt(e)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(Dx(a,[e]));break}}}}function qz(e){const t=In(e),r=t.playbuffer=yt(t.playbuffer)?t.playbuffer:"";r&&Fx(e,r,!1)}function Fx(e,t,r=!0){var o;const n=_r("main");if(!w(n))return;const i=`${e}_cli`;k.timestamp=n.timestamp,k.book=n,k.board=qe(e),k.element=Nr(k.board,e),k.elementid=((o=k.element)==null?void 0:o.id)??"",k.elementisplayer=!0,k.elementfocus=k.elementid||e;const s=Rs.HALT_AT_COUNT;if(Rs.HALT_AT_COUNT=s*8,dn.once(i,ss.CLI,"cli",t),r){const a=In(e);a.playbuffer=t}Rs.HALT_AT_COUNT=s}function Xu(e){var a;const t=_r("main"),r=Ds(t,e);if(!w(t)||!w(r)||!w(k.element))return;const n={...k},i=`${e}_run`,s=Dt(k.element.name??((a=k.element.kinddata)==null?void 0:a.name)??""),o=(r==null?void 0:r.code)??"";dn.once(i,ss.RUNTIME,s,o),Dr(n).forEach(c=>{k[c]=n[c]})}function Vz(e,t){const r=ge("main"),n=qe(e),i=[],s=[],o=[];if(!w(r)||!w(n))return{board:"",over:i,under:s,layers:o};const a=n.graphics??"flat",c=br(n.overboard??""),u=br(n.underboard??"");return s.push(...p0(e,0,u,t,!1,!0)),o.push(...p0(e,s.length,n,t,!0,a!=="flat")),i.push(...p0(e,s.length+o.length,c,t,!1,!1)),{board:n.id,over:i,under:s,layers:o}}function Vs(e){return pe(e)&&typeof e[0]=="string"}function Xz(e){const t=k.words[e];return yt(t)?[t,e+1]:[void 0,e]}function g0(e){const t=k.words[e];if(Vs(t))return[t,e+1];const[r,n]=ul(e),[i,s]=Xz(n);return yt(i)&&(i==="empty"||Rn({kind:i}))?[[i,r],s]:[void 0,e]}function yc(e){if(!Vs(e))return;const[t]=e;return t}function Ju(e){if(!Vs(e))return;const[,t]=e,r=w(t)?cl(t):void 0;return w(r)?r:void 0}function $x(e){if(!Vs(e))return;const[,t]=e,r=w(t)?ll(t):void 0;return w(r)?Nh(r):void 0}function _c(e,t){const r=e??Ht.ISWALK,n=t??Ht.ISWALK;if(r===Ht.ISGHOST||n===Ht.ISGHOST)return!1;switch(r){case Ht.ISWALK:return n!==Ht.ISWALK;case Ht.ISSWIM:return n!==Ht.ISSWIM;case Ht.ISSOLID:return!0;case Ht.ISBULLET:return n!==Ht.ISWALK&&n!==Ht.ISSWIM}}function bc(e,t,r){const n=e==null?void 0:e.objects[r];if(w(n))return n;const i=wc(e,"player");return w(t)?(t.x<0&&(t.x=_n(0,Ct-1)),t.y<0&&(t.y=_n(0,Zt-1)),jx(t,i)):bn(...i)}function wc(e,t){var i;const r=(i=e==null?void 0:e.named)==null?void 0:i[t];return w(r)?[...r.values()].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(w):[]}function Jz(e){const t=[];for(let r=0;r<Zt;++r)for(let n=0;n<Ct;++n){const i={x:n,y:r},s=oe(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function y0(e,t,r,n){if(!w(e))return!1;const i=mr(e);return!(w(t)&&t!==i.name||w(r)&&r!==i.color||w(n)&&n!==i.bg)}function Zu(e,t){const r=yc(t),n=Ju(t),i=$x(t);return wc(e,r??"").filter(s=>y0(s,r,n,i))}function Bx(e,t){const r=w(t)?cl(t):void 0,n=w(t)?ll(t):void 0,i=[];if(w(e)){for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];w(a)&&y0(a,void 0,r,n)&&i.push(a)}const s=Object.values(e.objects);for(let o=0;o<s.length;++o){const a=s[o];y0(a,void 0,r,n)&&i.push(a)}}return i}function Dx(e,t){return w(e)?t.map(r=>{var n;if(typeof r=="string"){const i=e.objects[r];if(w(i))return i;const s=wc(e,Dt(r));if(s.length)return s}else if(Ea(r)&&r.x>=0&&r.x<Ct&&r.y>=0&&r.y<Zt){const i=r.x+r.y*Ct,s=(n=e.lookup)==null?void 0:n[i];return w(s)?e.objects[s]:e.terrain[i]}}).flat().filter(w):[]}function jx(e,t){let r=0,n;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(n===void 0||c<r)&&(r=c,n=s)}}return n}function Zz(e,t,r,n){if(!w(e))return;w(e.distmaps)||(e.distmaps={});const i=`${t}.${r.x}.${r.y}.${n.x}.${n.y}`;let s=e.distmaps[i];if(!w(s)){s=new Array(Lh).fill(-2);const o=[{...n}];let a=0;for(;o.length;){const c=o.shift();if(w(c)&&tf(c)){const u=Wr(c,Ct);if(s[u]===-2){const l=us(e,c.x,c.y);_c(t,Yt(l,"collision"))||(s[u]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}e.distmaps[i]=s}return s}function zx(e,t){return tf(e)?t[Wr(e,Ct)]:-1}function Wx(e,t,r,n,i){if(!w(e))return;const s=Zz(e,t,r,n);if(!w(s))return;const o=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let a;if(i){let c=i?0:1e4;for(let u=0;u<o.length;++u){const l=zx(o[u],s);l>=0&&l>c&&(c=l,a=o[u])}}else{let c=1e5;for(let u=0;u<o.length;++u){const l=zx(o[u],s);l>=0&&l<c&&(c=l,a=o[u])}}return a}function Qz(){return new Array(Ct*Zt).map(()=>{})}function Qu(e=vf){const t={terrain:Qz(),objects:{},id:""};return e(t)}var _0=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e[e.graphics=13]="graphics",e))(_0||{});function t7(e){return Oo(e,_0,{terrain:t=>t.map(Il),objects:t=>Object.values(t).filter(r=>!r.removed).map(Il),id:Ne,named:Ne,lookup:Ne,codepage:Ne,distmaps:Ne,overboard:Ne,underboard:Ne})}function e7(e){return Ua(e,_0,{terrain:t=>t.map(Nl),objects:t=>{const r={};for(let n=0;n<t.length;++n){const i=Nl(t[n]);w(i==null?void 0:i.id)&&(r[i.id]=i)}return r}})}function tf(e){return kh(e.x,e.y,0,Ct-1,Zt-1,0)}function ji(e,t){return!w(e)||!w(t==null?void 0:t.x)||!w(t==null?void 0:t.y)||t.x<0||t.x>=Ct||t.y<0||t.y>=Zt?-1:t.x+t.y*Ct}function oe(e,t){const r=ji(e,t);if(r<0||!w(e==null?void 0:e.lookup))return;const n=Nr(e,e.lookup[r]??"");return w(n)?n:e.terrain[r]}function Hx(e,t){const r=Nr(e,t);if(w(r))return r;const n=parseFloat(t),i=eI(isNaN(n)?-1:n,Ct);return us(e,i.x,i.y)}function us(e,t,r){return(t>=0&&t<Ct)??(r>=0&&r<Zt)?e==null?void 0:e.terrain[t+r*Ct]:void 0}function Me(e,t){if(!w(e)||!w(t)||!w(t.x)||!w(t.y)||t.x<0||t.x>=Ct||t.y<0||t.y>=Zt)return;const r=Ln(t),n=t.x+t.y*Ct;return e.terrain[n]=r,delete e.distmaps,e.terrain[n]}function b0(e,t){if(!w(e)||!w(t))return;const r=Ln(t);return r.id=r.id??We(),e.objects[r.id]=r,e.objects[r.id]}function r7(e,t,r){return Me(e,{...t,kind:r})}function w0(e,t,r,n){return b0(e,{...t,kind:r,id:n})}function Nr(e,t){if(e)return e.objects[t]}function Gx(e,t){const r=ji(e,t);if(r<0||!w(e==null?void 0:e.lookup))return;const n=Nr(e,e.lookup[r]??"");if(w(n))return n}function wr(e,t,r){return!w(t)||mr(t).name==="player"?!1:(t.id?(t.removed=r,Tu(e,t)):(Me(e,{x:(t==null?void 0:t.x)??0,y:(t==null?void 0:t.y)??0}),TF(e,t)),!0)}function Kx(e,t){return w(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function n7(e,t,r){if(!w(e)||!w(t))return;const n=e.objects[r];if(w(n))return n;if(Ea(t))return jx(t,wc(e,"player"))}function ef(e,t,r,n,i){const s=bt.MID;if(!w(e)||!w(t))return{dir:n,startpt:i,destpt:i,layer:s};const o={x:t.x??0,y:t.y??0},a={x:o.x+(t.stepx??0),y:o.y+(t.stepy??0)},c=Bn(o,a),u=Ct-1,l=Zt-1;for(let h=0;h<n.length;++h){const d=my(n[h]);switch(d){case bt.IDLE:break;case bt.NORTH:case bt.SOUTH:case bt.WEST:case bt.EAST:Be(o,d);break;case bt.BY:{const[f,m]=n.slice(h+1);Et(f)&&Et(m)&&(o.x=Ge(o.x+f,0,u),o.y=Ge(o.y+m,0,l)),h+=2;break}case bt.TO:{const[f,m]=n.slice(h+1);Et(f)&&Et(m)&&(o.x=Ge(f,0,u),o.y=Ge(m,0,l)),h+=2;break}case bt.AT:{const[f,m]=n.slice(h+1);Et(f)&&Et(m)&&(o.x=Ge(f,0,u),o.y=Ge(m,0,l)),h+=2;break}case bt.FLOW:Be(o,c);break;case bt.SEEK:{const f=n7(e,t,r);Ea(f)&&Be(o,Bn(i,f));break}case bt.RNDNS:Be(o,bn(bt.NORTH,bt.SOUTH));break;case bt.RNDNE:Be(o,bn(bt.NORTH,bt.EAST));break;case bt.RND:Be(o,bn(bt.NORTH,bt.SOUTH,bt.WEST,bt.EAST));break;case bt.CW:case bt.CCW:case bt.OPP:case bt.RNDP:{const f=ef(e,t,r,n.slice(h+1),i);switch(o.x=i.x,o.y=i.y,d){case bt.CW:switch(Bn(i,f.destpt)){case bt.NORTH:Be(o,bt.EAST);break;case bt.SOUTH:Be(o,bt.WEST);break;case bt.EAST:Be(o,bt.SOUTH);break;case bt.WEST:Be(o,bt.NORTH);break}break;case bt.CCW:switch(Bn(i,f.destpt)){case bt.NORTH:Be(o,bt.WEST);break;case bt.SOUTH:Be(o,bt.EAST);break;case bt.EAST:Be(o,bt.NORTH);break;case bt.WEST:Be(o,bt.SOUTH);break}break;case bt.OPP:switch(Bn(i,f.destpt)){case bt.NORTH:Be(o,bt.SOUTH);break;case bt.SOUTH:Be(o,bt.NORTH);break;case bt.EAST:Be(o,bt.WEST);break;case bt.WEST:Be(o,bt.EAST);break}break;case bt.RNDP:switch(Bn(i,f.destpt)){case bt.NORTH:case bt.SOUTH:o.x+=bn(-1,1);break;case bt.WEST:case bt.EAST:o.y+=bn(-1,1);break}break}return{dir:n,startpt:i,destpt:o,layer:s}}case bt.FLEE:break;case bt.AWAY:{const[f,m]=n.slice(h+1);if(Et(f)&&Et(m)){const p={x:Ge(f,0,u),y:Ge(m,0,l)},g=p.x-o.x,y=p.y-o.y;if(Math.abs(g)>1||Math.abs(y)>1){const b=Yt(t,"collision"),T=Wx(e,b,o,p,!0);w(T)&&T.x!==f&&T.y!==m&&!Gx(e,T)&&(o.x=T.x,o.y=T.y)}else{const b=Oh(-g,-y);Be(o,b)}}h+=2;break}case bt.FIND:break;case bt.TOWARD:{const[f,m]=n.slice(h+1);if(Et(f)&&Et(m)){const p={x:Ge(f,0,u),y:Ge(m,0,l)},g=p.x-o.x,y=p.y-o.y;if(Math.abs(g)>1||Math.abs(y)>1){const b=Yt(t,"collision"),T=Wx(e,b,o,p,!1);w(T)&&T.x!==f&&T.y!==m&&!Gx(e,T)&&(o.x=T.x,o.y=T.y)}else{const b=Oh(g,y);Be(o,b)}}h+=2;break}case bt.OVER:case bt.UNDER:{const f=ef(e,t,r,n.slice(h+1),i);return f.layer=d,f}}}return{dir:n,startpt:i,destpt:o,layer:s}}const k={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var q=(e=>(e[e.COLOR=0]="COLOR",e[e.KIND=1]="KIND",e[e.DIR=2]="DIR",e[e.NAME=3]="NAME",e[e.NUMBER=4]="NUMBER",e[e.STRING=5]="STRING",e[e.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",e[e.COLOR_OR_KIND=7]="COLOR_OR_KIND",e[e.MAYBE_KIND=8]="MAYBE_KIND",e[e.MAYBE_NAME=9]="MAYBE_NAME",e[e.MAYBE_NUMBER=10]="MAYBE_NUMBER",e[e.MAYBE_STRING=11]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",e[e.ANY=13]="ANY",e))(q||{});function vr(e,t,r){throw console.info(r,k.element,k.elementid,k.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function Yx(e){var r,n;const t={x:((r=k.element)==null?void 0:r.x)??0,y:((n=k.element)==null?void 0:n.y)??0};return ef(k.board,k.element,k.elementfocus,e,t)}function ut(e,t,r){const n=k.words;k.words=e;const i=[];let s=t;for(let o=0;o<r.length;++o)switch(r[o]){case 1:{const[a,c]=g0(s);Vs(a)?(s=c,i.push(a)):vr("kind",a,e);break}case 0:{if(xa(e[s])===void 0){const[a,c]=Pr(s);Cr(a)?(s=c,i.push(a)):vr("color",a,e)}else{const[a,c]=ul(s);Cr(a)?(s=c,i.push(a)):vr("color",a,e)}break}case 2:{if(al(e[s])===void 0){const[a,c]=Pr(s);Hr(a)?(s=c,i.push(Yx(a))):vr("direction",a,e)}else{const[a,c]=yy(s);Hr(a)?(s=c,i.push(Yx(a))):vr("direction",a,e)}break}case 3:{const a=k.words[s];yt(a)||vr("string",a,e),++s,i.push(a);break}case 4:{const[a,c]=Pr(s);if(yt(a)){const u=parseFloat(a);Et(u)?i.push(u):vr("number",a,e)}else Et(a)?i.push(a):vr("number",a,e);s=c;break}case 5:{const[a,c]=Pr(s);yt(a)||vr("string",a,e),s=c,i.push(a);break}case 6:{const[a,c]=Pr(s);let u=a;if(yt(u)){const l=parseFloat(u);Et(l)&&(u=l)}else Et(u)||vr("number or string",u,e);s=c,i.push(u);break}case 7:{const[a,c]=g0(s);if(Vs(a))s=c,i.push(a);else if(xa(e[s])===void 0){const[u,l]=Pr(s);Cr(u)?(s=l,i.push(u)):vr("color",u,e)}else{const[u,l]=ul(s);Cr(u)?(s=l,i.push(u)):vr("color or kind",u,e)}break}case 8:{const[a,c]=g0(s);a!==void 0&&!Vs(a)&&vr("optional kind",a,e),s=c,i.push(a);break}case 9:{const a=k.words[s];a!==void 0&&!yt(a)&&vr("optional string",a,e),++s,i.push(a);break}case 10:{const[a,c]=Pr(s);if(yt(a)){const u=parseFloat(a);Et(u)?i.push(u):vr("optional number",a,e)}else Et(a)||a===void 0?i.push(a):vr("optional number",a,e);s=c;break}case 11:{const[a,c]=Pr(s);a!==void 0&&!yt(a)&&vr("optional string",a,e),s=c,i.push(a);break}case 12:{const[a,c]=Pr(s);let u=a;if(yt(u)){const l=parseFloat(u);Et(l)&&(u=l)}else u!==void 0&&!Et(u)&&vr("number or string",u,e);s=c,i.push(u);break}case 13:{const[a,c]=Pr(s);s=c,i.push(a);break}}return k.words=n,[...i,s]}const rf={},Zo={};function v0(){return{id:We(),board:"",layers:[],scroll:[],sidebar:[]}}const i7=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),s7=new Set(["tx","text"]),o7={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},qx={};let Vx=e=>{let t=qx[e];return w(t)||(qx[e]=t=v0()),t};function a7(e){Vx=e}function Ue(e){return Vx(e)}function E0(e){return w(rf[e])||(rf[e]=[]),rf[e]}function c7(e){const t=Ue(e);t.scrollname="",t.scroll=[]}function l7(e,t,r){Object.values(Zo).forEach(n=>{if(n[t]!==void 0){const i=ky(e.id(),t);Et(r)&&ZO(i,r),yt(r)&&QO(i,r)}})}function cr(e){const t=E0(e);return rf[e]=[],t}function Xx(e){const t=[];for(let r=0;r<e.length;++r){const n=e[r];yt(n)&&w(jF(n))?t.push(" ",n," "):t.push(n)}return t}function Nt(e,t){E0(e).push(t)}function $t(e,t,r,n,i=()=>0,s=vf){const o=[t,r,...n],a=Dt(`${o[3]}`),c={...k};function u(l,h){w(h)&&h!==i(l)&&(k.board=c.board,k.element=c.element,k.elementfocus=c.elementfocus,s(l,h))}if(i7.has(a)){const l=`${o[2]}`;Zo[t]=Zo[t]??{};const h=i(l)??o7[a];if(Zo[t][l]===void 0){const d=ky(t,l);Et(h)&&JO(d,h),yt(h)&&Eh(d,h),s7.has(a)?Zo[t][l]=Zg(d,f=>{u(l,f)}):Zo[t][l]=tI(d,f=>{u(l,f)})}}E0(e).push(o)}a7(e=>{if(Er(e)){const t=ge(Xt.MAIN),r=Ui(t,Xt.GADGETSTORE);let n=r[e];return w(n)||(r[e]=n=v0()),n}return v0()});let Jx=0;function u7(){switch(Jx++){case 0:return zt.BLUE;case 1:return zt.BLACK;case 2:return zt.GREEN;case 3:return zt.BLACK;case 4:return zt.CYAN;case 5:return zt.BLACK;case 6:return zt.RED;case 7:return zt.BLACK;case 8:return zt.PURPLE;case 9:return zt.BLACK;case 10:return zt.YELLOW;case 11:return zt.BLACK;case 12:return zt.WHITE;default:return Jx=0,zt.BLACK}}const k0=Zs("gadgetserver",["tock"],e=>{if(!k0.session(e))return;const t=ge(Xt.MAIN),r=[...(t==null?void 0:t.activelist)??[],$r()],n=[...new Set(r.values())],i=Ui(t,Xt.GADGETSYNC);switch(e.target){case"tock":{const s=u7();for(let o=0;o<n.length;++o){const a=n[o],{board:c,over:u,under:l,layers:h}=Vz(a,s),d=Ue(a);d.board=c,d.over=u,d.under=l,d.layers=h;const f=i[a]??{},m=Z0(f,d);m.length&&(i[a]=Ln(d),vT(k0,a,m))}break}case"desync":wT(k0,e.player,Ue(e.player));break;case"clearscroll":c7(e.player);break;case"clearplayer":{const s=Ui(t,Xt.GADGETSTORE);delete s[e.player];const o=Ui(t,Xt.GADGETSYNC);delete o[e.player];break}}});function nf(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Zx={exports:{}};(function(e,t){(function(r){e.exports=r()})(function(){return function r(n,i,s){function o(u,l){if(!i[u]){if(!n[u]){var h=typeof nf=="function"&&nf;if(!l&&h)return h(u,!0);if(a)return a(u,!0);var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[u]={exports:{}};n[u][0].call(f.exports,function(m){var p=n[u][1][m];return o(p||m)},f,f.exports,r,n,i,s)}return i[u].exports}for(var a=typeof nf=="function"&&nf,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(r,n,i){var s=r("./utils"),o=r("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var u,l,h,d,f,m,p,g=[],y=0,b=c.length,T=b,A=s.getTypeOf(c)!=="string";y<c.length;)T=b-y,h=A?(u=c[y++],l=y<b?c[y++]:0,y<b?c[y++]:0):(u=c.charCodeAt(y++),l=y<b?c.charCodeAt(y++):0,y<b?c.charCodeAt(y++):0),d=u>>2,f=(3&u)<<4|l>>4,m=1<T?(15&l)<<2|h>>6:64,p=2<T?63&h:64,g.push(a.charAt(d)+a.charAt(f)+a.charAt(m)+a.charAt(p));return g.join("")},i.decode=function(c){var u,l,h,d,f,m,p=0,g=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var b,T=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&T--,c.charAt(c.length-2)===a.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=o.uint8array?new Uint8Array(0|T):new Array(0|T);p<c.length;)u=a.indexOf(c.charAt(p++))<<2|(d=a.indexOf(c.charAt(p++)))>>4,l=(15&d)<<4|(f=a.indexOf(c.charAt(p++)))>>2,h=(3&f)<<6|(m=a.indexOf(c.charAt(p++))),b[g++]=u,f!==64&&(b[g++]=l),m!==64&&(b[g++]=h);return b}},{"./support":30,"./utils":32}],2:[function(r,n,i){var s=r("./external"),o=r("./stream/DataWorker"),a=r("./stream/Crc32Probe"),c=r("./stream/DataLengthProbe");function u(l,h,d,f,m){this.compressedSize=l,this.uncompressedSize=h,this.crc32=d,this.compression=f,this.compressedContent=m}u.prototype={getContentWorker:function(){var l=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return l.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(l,h,d){return l.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},n.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,n,i){var s=r("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,n,i){var s=r("./utils"),o=function(){for(var a,c=[],u=0;u<256;u++){a=u;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;c[u]=a}return c}();n.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(u,l,h,d){var f=o,m=d+h;u^=-1;for(var p=d;p<m;p++)u=u>>>8^f[255&(u^l[p])];return-1^u}(0|c,a,a.length,0):function(u,l,h,d){var f=o,m=d+h;u^=-1;for(var p=d;p<m;p++)u=u>>>8^f[255&(u^l.charCodeAt(p))];return-1^u}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(r,n,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(r,n,i){var s=null;s=typeof Promise<"u"?Promise:r("lie"),n.exports={Promise:s}},{lie:37}],7:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=r("pako"),a=r("./utils"),c=r("./stream/GenericWorker"),u=s?"uint8array":"array";function l(h,d){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(l,c),l.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,h.data),!1)},l.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},i.compressWorker=function(h){return new l("Deflate",h)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,n,i){function s(f,m){var p,g="";for(p=0;p<m;p++)g+=String.fromCharCode(255&f),f>>>=8;return g}function o(f,m,p,g,y,b){var T,A,x=f.file,I=f.compression,R=b!==u.utf8encode,$=a.transformTo("string",b(x.name)),M=a.transformTo("string",u.utf8encode(x.name)),H=x.comment,X=a.transformTo("string",b(H)),O=a.transformTo("string",u.utf8encode(H)),N=M.length!==x.name.length,E=O.length!==H.length,L="",j="",U="",V=x.dir,Q=x.date,K={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(K.crc32=f.crc32,K.compressedSize=f.compressedSize,K.uncompressedSize=f.uncompressedSize);var W=0;m&&(W|=8),R||!N&&!E||(W|=2048);var P=0,st=0;V&&(P|=16),y==="UNIX"?(st=798,P|=function(rt,wt){var Tt=rt;return rt||(Tt=wt?16893:33204),(65535&Tt)<<16}(x.unixPermissions,V)):(st=20,P|=function(rt){return 63&(rt||0)}(x.dosPermissions)),T=Q.getUTCHours(),T<<=6,T|=Q.getUTCMinutes(),T<<=5,T|=Q.getUTCSeconds()/2,A=Q.getUTCFullYear()-1980,A<<=4,A|=Q.getUTCMonth()+1,A<<=5,A|=Q.getUTCDate(),N&&(j=s(1,1)+s(l($),4)+M,L+="up"+s(j.length,2)+j),E&&(U=s(1,1)+s(l(X),4)+O,L+="uc"+s(U.length,2)+U);var G="";return G+=`
\0`,G+=s(W,2),G+=I.magic,G+=s(T,2),G+=s(A,2),G+=s(K.crc32,4),G+=s(K.compressedSize,4),G+=s(K.uncompressedSize,4),G+=s($.length,2),G+=s(L.length,2),{fileRecord:h.LOCAL_FILE_HEADER+G+$+L,dirRecord:h.CENTRAL_FILE_HEADER+s(st,2)+G+s(X.length,2)+"\0\0\0\0"+s(P,4)+s(g,4)+$+L+X}}var a=r("../utils"),c=r("../stream/GenericWorker"),u=r("../utf8"),l=r("../crc32"),h=r("../signature");function d(f,m,p,g){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=g,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(f){var m=f.meta.percent||0,p=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-g-1))/p:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var m=this.streamFiles&&!f.file.dir;if(m){var p=o(f,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var m=this.streamFiles&&!f.file.dir,p=o(f,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(g){return h.DATA_DESCRIPTOR+s(g.crc32,4)+s(g.compressedSize,4)+s(g.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-f,g=function(y,b,T,A,x){var I=a.transformTo("string",x(A));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(y,2)+s(y,2)+s(b,4)+s(T,4)+s(I.length,2)+I}(this.dirRecords.length,p,f,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var m=this;return f.on("data",function(p){m.processChunk(p)}),f.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),f.on("error",function(p){m.error(p)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var m=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var p=0;p<m.length;p++)try{m[p].error(f)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,m=0;m<f.length;m++)f[m].lock()},n.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,n,i){var s=r("../compressions"),o=r("./ZipFileWorker");i.generateWorker=function(a,c,u){var l=new o(c.streamFiles,u,c.platform,c.encodeFileName),h=0;try{a.forEach(function(d,f){h++;var m=function(b,T){var A=b||T,x=s[A];if(!x)throw new Error(A+" is not a valid compression method !");return x}(f.options.compression,c.compression),p=f.options.compressionOptions||c.compressionOptions||{},g=f.dir,y=f.date;f._compressWorker(m,p).withStreamInfo("file",{name:d,dir:g,date:y,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(l)}),l.entriesCount=h}catch(d){l.error(d)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,n,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=r("./object")).loadAsync=r("./load"),s.support=r("./support"),s.defaults=r("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=r("./external"),n.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,n,i){var s=r("./utils"),o=r("./external"),a=r("./utf8"),c=r("./zipEntries"),u=r("./stream/Crc32Probe"),l=r("./nodejsUtils");function h(d){return new o.Promise(function(f,m){var p=d.decompressed.getContentWorker().pipe(new u);p.on("error",function(g){m(g)}).on("end",function(){p.streamInfo.crc32!==d.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}n.exports=function(d,f){var m=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(p){var g=new c(f);return g.load(p),g}).then(function(p){var g=[o.Promise.resolve(p)],y=p.files;if(f.checkCRC32)for(var b=0;b<y.length;b++)g.push(h(y[b]));return o.Promise.all(g)}).then(function(p){for(var g=p.shift(),y=g.files,b=0;b<y.length;b++){var T=y[b],A=T.fileNameStr,x=s.resolve(T.fileNameStr);m.file(x,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:f.createFolders}),T.dir||(m.file(x).unsafeOriginalName=A)}return g.zipComment.length&&(m.comment=g.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,n,i){var s=r("../utils"),o=r("../stream/GenericWorker");function a(c,u){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(u)}s.inherits(a,o),a.prototype._bindStream=function(c){var u=this;(this._stream=c).pause(),c.on("data",function(l){u.push({data:l,meta:{percent:0}})}).on("error",function(l){u.isPaused?this.generatedError=l:u.error(l)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,n,i){var s=r("readable-stream").Readable;function o(a,c,u){s.call(this,c),this._helper=a;var l=this;a.on("data",function(h,d){l.push(h)||l._helper.pause(),u&&u(d)}).on("error",function(h){l.emit("error",h)}).on("end",function(){l.push(null)})}r("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},n.exports=o},{"../utils":32,"readable-stream":16}],14:[function(r,n,i){n.exports={isNode:typeof er<"u",newBufferFrom:function(s,o){if(er.from&&er.from!==Uint8Array.from)return er.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new er(s,o)},allocBuffer:function(s){if(er.alloc)return er.alloc(s);var o=new er(s);return o.fill(0),o},isBuffer:function(s){return er.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(r,n,i){function s(x,I,R){var $,M=a.getTypeOf(I),H=a.extend(R||{},l);H.date=H.date||new Date,H.compression!==null&&(H.compression=H.compression.toUpperCase()),typeof H.unixPermissions=="string"&&(H.unixPermissions=parseInt(H.unixPermissions,8)),H.unixPermissions&&16384&H.unixPermissions&&(H.dir=!0),H.dosPermissions&&16&H.dosPermissions&&(H.dir=!0),H.dir&&(x=y(x)),H.createFolders&&($=g(x))&&b.call(this,$,!0);var X=M==="string"&&H.binary===!1&&H.base64===!1;R&&R.binary!==void 0||(H.binary=!X),(I instanceof h&&I.uncompressedSize===0||H.dir||!I||I.length===0)&&(H.base64=!1,H.binary=!0,I="",H.compression="STORE",M="string");var O=null;O=I instanceof h||I instanceof c?I:m.isNode&&m.isStream(I)?new p(x,I):a.prepareContent(x,I,H.binary,H.optimizedBinaryString,H.base64);var N=new d(x,O,H);this.files[x]=N}var o=r("./utf8"),a=r("./utils"),c=r("./stream/GenericWorker"),u=r("./stream/StreamHelper"),l=r("./defaults"),h=r("./compressedObject"),d=r("./zipObject"),f=r("./generate"),m=r("./nodejsUtils"),p=r("./nodejs/NodejsStreamInputAdapter"),g=function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var I=x.lastIndexOf("/");return 0<I?x.substring(0,I):""},y=function(x){return x.slice(-1)!=="/"&&(x+="/"),x},b=function(x,I){return I=I!==void 0?I:l.createFolders,x=y(x),this.files[x]||s.call(this,x,null,{dir:!0,createFolders:I}),this.files[x]};function T(x){return Object.prototype.toString.call(x)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var I,R,$;for(I in this.files)$=this.files[I],(R=I.slice(this.root.length,I.length))&&I.slice(0,this.root.length)===this.root&&x(R,$)},filter:function(x){var I=[];return this.forEach(function(R,$){x(R,$)&&I.push($)}),I},file:function(x,I,R){if(arguments.length!==1)return x=this.root+x,s.call(this,x,I,R),this;if(T(x)){var $=x;return this.filter(function(H,X){return!X.dir&&$.test(H)})}var M=this.files[this.root+x];return M&&!M.dir?M:null},folder:function(x){if(!x)return this;if(T(x))return this.filter(function(M,H){return H.dir&&x.test(M)});var I=this.root+x,R=b.call(this,I),$=this.clone();return $.root=R.name,$},remove:function(x){x=this.root+x;var I=this.files[x];if(I||(x.slice(-1)!=="/"&&(x+="/"),I=this.files[x]),I&&!I.dir)delete this.files[x];else for(var R=this.filter(function(M,H){return H.name.slice(0,x.length)===x}),$=0;$<R.length;$++)delete this.files[R[$].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var I,R={};try{if((R=a.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");a.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var $=R.comment||this.comment||"";I=f.generateWorker(this,R,$)}catch(M){(I=new c("error")).error(M)}return new u(I,R.type||"string",R.mimeType)},generateAsync:function(x,I){return this.generateInternalStream(x).accumulate(I)},generateNodeStream:function(x,I){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(I)}};n.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,n,i){n.exports=r("stream")},{stream:void 0}],17:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===u&&this.data[d+2]===l&&this.data[d+3]===h)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&u===d[1]&&l===d[2]&&h===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./DataReader":18}],18:[function(r,n,i){var s=r("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,u=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)u=(u<<8)+this.byteAt(c);return this.index+=a,u},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},n.exports=o},{"../utils":32}],19:[function(r,n,i){var s=r("./Uint8ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./DataReader":18}],21:[function(r,n,i){var s=r("./ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(r,n,i){var s=r("../utils"),o=r("../support"),a=r("./ArrayReader"),c=r("./StringReader"),u=r("./NodeBufferReader"),l=r("./Uint8ArrayReader");n.exports=function(h){var d=s.getTypeOf(h);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new u(h):o.uint8array?new l(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,n,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,n,i){var s=r("./GenericWorker"),o=r("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},n.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(r,n,i){var s=r("./GenericWorker"),o=r("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},n.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+c.data.length}o.prototype.processChunk.call(this,c)},n.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(c){o.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(l){u.dataIsReady=!0,u.data=l,u.max=l&&l.length||0,u.type=s.getTypeOf(l),u.isPaused||u._tickAndRepeat()},function(l){u.error(l)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,u);break;case"uint8array":c=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":c=this.data.slice(this.index,u)}return this.index=u,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(r,n,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},n.exports=s},{}],29:[function(r,n,i){var s=r("../utils"),o=r("./ConvertWorker"),a=r("./GenericWorker"),c=r("../base64"),u=r("../support"),l=r("../external"),h=null;if(u.nodestream)try{h=r("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(m,p){return new l.Promise(function(g,y){var b=[],T=m._internalType,A=m._outputType,x=m._mimeType;m.on("data",function(I,R){b.push(I),p&&p(R)}).on("error",function(I){b=[],y(I)}).on("end",function(){try{var I=function(R,$,M){switch(R){case"blob":return s.newBlob(s.transformTo("arraybuffer",$),M);case"base64":return c.encode($);default:return s.transformTo(R,$)}}(A,function(R,$){var M,H=0,X=null,O=0;for(M=0;M<$.length;M++)O+=$[M].length;switch(R){case"string":return $.join("");case"array":return Array.prototype.concat.apply([],$);case"uint8array":for(X=new Uint8Array(O),M=0;M<$.length;M++)X.set($[M],H),H+=$[M].length;return X;case"nodebuffer":return er.concat($);default:throw new Error("concat : unsupported type '"+R+"'")}}(T,b),x);g(I)}catch(R){y(R)}b=[]}).resume()})}function f(m,p,g){var y=p;switch(p){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=p,this._mimeType=g,s.checkSupport(y),this._worker=m.pipe(new o(y)),m.lock()}catch(b){this._worker=new a("error"),this._worker.error(b)}}f.prototype={accumulate:function(m){return d(this,m)},on:function(m,p){var g=this;return m==="data"?this._worker.on(m,function(y){p.call(g,y.data,y.meta)}):this._worker.on(m,function(){s.delay(p,arguments,g)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},m)}},n.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,n,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof er<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!r("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(r,n,i){for(var s=r("./utils"),o=r("./support"),a=r("./nodejsUtils"),c=r("./stream/GenericWorker"),u=new Array(256),l=0;l<256;l++)u[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;u[254]=u[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):function(m){var p,g,y,b,T,A=m.length,x=0;for(b=0;b<A;b++)(64512&(g=m.charCodeAt(b)))==55296&&b+1<A&&(64512&(y=m.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),x+=g<128?1:g<2048?2:g<65536?3:4;for(p=o.uint8array?new Uint8Array(x):new Array(x),b=T=0;T<x;b++)(64512&(g=m.charCodeAt(b)))==55296&&b+1<A&&(64512&(y=m.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),g<128?p[T++]=g:(g<2048?p[T++]=192|g>>>6:(g<65536?p[T++]=224|g>>>12:(p[T++]=240|g>>>18,p[T++]=128|g>>>12&63),p[T++]=128|g>>>6&63),p[T++]=128|63&g);return p}(f)},i.utf8decode=function(f){return o.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):function(m){var p,g,y,b,T=m.length,A=new Array(2*T);for(p=g=0;p<T;)if((y=m[p++])<128)A[g++]=y;else if(4<(b=u[y]))A[g++]=65533,p+=b-1;else{for(y&=b===2?31:b===3?15:7;1<b&&p<T;)y=y<<6|63&m[p++],b--;1<b?A[g++]=65533:y<65536?A[g++]=y:(y-=65536,A[g++]=55296|y>>10&1023,A[g++]=56320|1023&y)}return A.length!==g&&(A.subarray?A=A.subarray(0,g):A.length=g),s.applyFromCharCode(A)}(f=s.transformTo(o.uint8array?"uint8array":"array",f))},s.inherits(h,c),h.prototype.processChunk=function(f){var m=s.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var g=function(b,T){var A;for((T=T||b.length)>b.length&&(T=b.length),A=T-1;0<=A&&(192&b[A])==128;)A--;return A<0||A===0?T:A+u[b[A]]>T?A:T}(m),y=m;g!==m.length&&(o.uint8array?(y=m.subarray(0,g),this.leftOver=m.subarray(g,m.length)):(y=m.slice(0,g),this.leftOver=m.slice(g,m.length))),this.push({data:i.utf8decode(y),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,c),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,n,i){var s=r("./support"),o=r("./base64"),a=r("./nodejsUtils"),c=r("./external");function u(p){return p}function l(p,g){for(var y=0;y<p.length;++y)g[y]=255&p.charCodeAt(y);return g}r("setimmediate"),i.newBlob=function(p,g){i.checkSupport("blob");try{return new Blob([p],{type:g})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(p),y.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(p,g,y){var b=[],T=0,A=p.length;if(A<=y)return String.fromCharCode.apply(null,p);for(;T<A;)g==="array"||g==="nodebuffer"?b.push(String.fromCharCode.apply(null,p.slice(T,Math.min(T+y,A)))):b.push(String.fromCharCode.apply(null,p.subarray(T,Math.min(T+y,A)))),T+=y;return b.join("")},stringifyByChar:function(p){for(var g="",y=0;y<p.length;y++)g+=String.fromCharCode(p[y]);return g},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(p){var g=65536,y=i.getTypeOf(p),b=!0;if(y==="uint8array"?b=h.applyCanBeUsed.uint8array:y==="nodebuffer"&&(b=h.applyCanBeUsed.nodebuffer),b)for(;1<g;)try{return h.stringifyByChunk(p,y,g)}catch{g=Math.floor(g/2)}return h.stringifyByChar(p)}function f(p,g){for(var y=0;y<p.length;y++)g[y]=p[y];return g}i.applyFromCharCode=d;var m={};m.string={string:u,array:function(p){return l(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return l(p,new Uint8Array(p.length))},nodebuffer:function(p){return l(p,a.allocBuffer(p.length))}},m.array={string:d,array:u,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},m.arraybuffer={string:function(p){return d(new Uint8Array(p))},array:function(p){return f(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:u,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:d,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:u,nodebuffer:function(p){return a.newBufferFrom(p)}},m.nodebuffer={string:d,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:u},i.transformTo=function(p,g){if(g=g||"",!p)return g;i.checkSupport(p);var y=i.getTypeOf(g);return m[y][p](g)},i.resolve=function(p){for(var g=p.split("/"),y=[],b=0;b<g.length;b++){var T=g[b];T==="."||T===""&&b!==0&&b!==g.length-1||(T===".."?y.pop():y.push(T))}return y.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(p)?"nodebuffer":s.uint8array&&p instanceof Uint8Array?"uint8array":s.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!s[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var g,y,b="";for(y=0;y<(p||"").length;y++)b+="\\x"+((g=p.charCodeAt(y))<16?"0":"")+g.toString(16).toUpperCase();return b},i.delay=function(p,g,y){setImmediate(function(){p.apply(y||null,g||[])})},i.inherits=function(p,g){function y(){}y.prototype=g.prototype,p.prototype=new y},i.extend=function(){var p,g,y={};for(p=0;p<arguments.length;p++)for(g in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],g)&&y[g]===void 0&&(y[g]=arguments[p][g]);return y},i.prepareContent=function(p,g,y,b,T){return c.Promise.resolve(g).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(x,I){var R=new FileReader;R.onload=function($){x($.target.result)},R.onerror=function($){I($.target.error)},R.readAsArrayBuffer(A)}):A}).then(function(A){var x=i.getTypeOf(A);return x?(x==="arraybuffer"?A=i.transformTo("uint8array",A):x==="string"&&(T?A=o.decode(A):y&&b!==!0&&(A=function(I){return l(I,s.uint8array?new Uint8Array(I.length):new Array(I.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./signature"),c=r("./zipEntry"),u=r("./support");function l(h){this.files=[],this.loadOptions=h}l.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(h)+")")}},isSignature:function(h,d){var f=this.reader.index;this.reader.setIndex(h);var m=this.reader.readString(4)===d;return this.reader.setIndex(f),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=u.uint8array?"uint8array":"array",f=o.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,f,m=this.zip64EndOfCentralSize-44;0<m;)h=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var m=d-f;if(0<m)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./compressedObject"),c=r("./crc32"),u=r("./utf8"),l=r("./compressions"),h=r("./support");function d(f,m){this.options=f,this.loadOptions=m}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var m,p;if(f.skip(22),this.fileNameLength=f.readInt(2),p=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(g){for(var y in l)if(Object.prototype.hasOwnProperty.call(l,y)&&l[y].magic===g)return l[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var m=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(m),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var m,p,g,y=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<y;)m=f.readInt(2),p=f.readInt(2),g=f.readData(p),this.extraFields[m]={id:m,length:p,value:g};f.setIndex(y)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var y=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var m=s(f.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:u.utf8decode(m.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var m=s(f.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:u.utf8decode(m.readData(f.length-5))}return null}},n.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,n,i){function s(m,p,g){this.name=m,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=p,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var o=r("./stream/StreamHelper"),a=r("./stream/DataWorker"),c=r("./utf8"),u=r("./compressedObject"),l=r("./stream/GenericWorker");s.prototype={internalStream:function(m){var p=null,g="string";try{if(!m)throw new Error("No output type specified.");var y=(g=m.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),p=this._decompressWorker();var b=!this._dataBinary;b&&!y&&(p=p.pipe(new c.Utf8EncodeWorker)),!b&&y&&(p=p.pipe(new c.Utf8DecodeWorker))}catch(T){(p=new l("error")).error(T)}return new o(p,g,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof u&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new c.Utf8EncodeWorker)),u.createWorkerFrom(g,m,p)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)s.prototype[h[f]]=d;n.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,n,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var u=0,l=new c(m),h=s.document.createTextNode("");l.observe(h,{characterData:!0}),o=function(){h.data=u=++u%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var p=s.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},s.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var d=new s.MessageChannel;d.port1.onmessage=m,o=function(){d.port2.postMessage(0)}}var f=[];function m(){var p,g;a=!0;for(var y=f.length;y;){for(g=f,f=[],p=-1;++p<y;)g[p]();y=f.length}a=!1}n.exports=function(p){f.push(p)!==1||a||o()}}).call(this,typeof tr<"u"?tr:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,n,i){var s=r("immediate");function o(){}var a={},c=["REJECTED"],u=["FULFILLED"],l=["PENDING"];function h(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,y!==o&&p(this,y)}function d(y,b,T){this.promise=y,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function f(y,b,T){s(function(){var A;try{A=b(T)}catch(x){return a.reject(y,x)}A===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,A)})}function m(y){var b=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof b=="function")return function(){b.apply(y,arguments)}}function p(y,b){var T=!1;function A(R){T||(T=!0,a.reject(y,R))}function x(R){T||(T=!0,a.resolve(y,R))}var I=g(function(){b(x,A)});I.status==="error"&&A(I.value)}function g(y,b){var T={};try{T.value=y(b),T.status="success"}catch(A){T.status="error",T.value=A}return T}(n.exports=h).prototype.finally=function(y){if(typeof y!="function")return this;var b=this.constructor;return this.then(function(T){return b.resolve(y()).then(function(){return T})},function(T){return b.resolve(y()).then(function(){throw T})})},h.prototype.catch=function(y){return this.then(null,y)},h.prototype.then=function(y,b){if(typeof y!="function"&&this.state===u||typeof b!="function"&&this.state===c)return this;var T=new this.constructor(o);return this.state!==l?f(T,this.state===u?y:b,this.outcome):this.queue.push(new d(T,y,b)),T},d.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},d.prototype.otherCallFulfilled=function(y){f(this.promise,this.onFulfilled,y)},d.prototype.callRejected=function(y){a.reject(this.promise,y)},d.prototype.otherCallRejected=function(y){f(this.promise,this.onRejected,y)},a.resolve=function(y,b){var T=g(m,b);if(T.status==="error")return a.reject(y,T.value);var A=T.value;if(A)p(y,A);else{y.state=u,y.outcome=b;for(var x=-1,I=y.queue.length;++x<I;)y.queue[x].callFulfilled(b)}return y},a.reject=function(y,b){y.state=c,y.outcome=b;for(var T=-1,A=y.queue.length;++T<A;)y.queue[T].callRejected(b);return y},h.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},h.reject=function(y){var b=new this(o);return a.reject(b,y)},h.all=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=y.length,A=!1;if(!T)return this.resolve([]);for(var x=new Array(T),I=0,R=-1,$=new this(o);++R<T;)M(y[R],R);return $;function M(H,X){b.resolve(H).then(function(O){x[X]=O,++I!==T||A||(A=!0,a.resolve($,x))},function(O){A||(A=!0,a.reject($,O))})}},h.race=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=y.length,A=!1;if(!T)return this.resolve([]);for(var x=-1,I=new this(o);++x<T;)R=y[x],b.resolve(R).then(function($){A||(A=!0,a.resolve(I,$))},function($){A||(A=!0,a.reject(I,$))});var R;return I}},{immediate:36}],38:[function(r,n,i){var s={};(0,r("./lib/utils/common").assign)(s,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),n.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,n,i){var s=r("./zlib/deflate"),o=r("./utils/common"),a=r("./utils/strings"),c=r("./zlib/messages"),u=r("./zlib/zstream"),l=Object.prototype.toString,h=0,d=-1,f=0,m=8;function p(y){if(!(this instanceof p))return new p(y);this.options=o.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},y||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var T=s.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(T!==h)throw new Error(c[T]);if(b.header&&s.deflateSetHeader(this.strm,b.header),b.dictionary){var A;if(A=typeof b.dictionary=="string"?a.string2buf(b.dictionary):l.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(T=s.deflateSetDictionary(this.strm,A))!==h)throw new Error(c[T]);this._dict_set=!0}}function g(y,b){var T=new p(b);if(T.push(y,!0),T.err)throw T.msg||c[T.err];return T.result}p.prototype.push=function(y,b){var T,A,x=this.strm,I=this.options.chunkSize;if(this.ended)return!1;A=b===~~b?b:b===!0?4:0,typeof y=="string"?x.input=a.string2buf(y):l.call(y)==="[object ArrayBuffer]"?x.input=new Uint8Array(y):x.input=y,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new o.Buf8(I),x.next_out=0,x.avail_out=I),(T=s.deflate(x,A))!==1&&T!==h)return this.onEnd(T),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(x.output,x.next_out))):this.onData(o.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&T!==1);return A===4?(T=s.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===h):A!==2||(this.onEnd(h),!(x.avail_out=0))},p.prototype.onData=function(y){this.chunks.push(y)},p.prototype.onEnd=function(y){y===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=p,i.deflate=g,i.deflateRaw=function(y,b){return(b=b||{}).raw=!0,g(y,b)},i.gzip=function(y,b){return(b=b||{}).gzip=!0,g(y,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,n,i){var s=r("./zlib/inflate"),o=r("./utils/common"),a=r("./utils/strings"),c=r("./zlib/constants"),u=r("./zlib/messages"),l=r("./zlib/zstream"),h=r("./zlib/gzheader"),d=Object.prototype.toString;function f(p){if(!(this instanceof f))return new f(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||p&&p.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&!(15&g.windowBits)&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var y=s.inflateInit2(this.strm,g.windowBits);if(y!==c.Z_OK)throw new Error(u[y]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function m(p,g){var y=new f(g);if(y.push(p,!0),y.err)throw y.msg||u[y.err];return y.result}f.prototype.push=function(p,g){var y,b,T,A,x,I,R=this.strm,$=this.options.chunkSize,M=this.options.dictionary,H=!1;if(this.ended)return!1;b=g===~~g?g:g===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof p=="string"?R.input=a.binstring2buf(p):d.call(p)==="[object ArrayBuffer]"?R.input=new Uint8Array(p):R.input=p,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new o.Buf8($),R.next_out=0,R.avail_out=$),(y=s.inflate(R,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&M&&(I=typeof M=="string"?a.string2buf(M):d.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,y=s.inflateSetDictionary(this.strm,I)),y===c.Z_BUF_ERROR&&H===!0&&(y=c.Z_OK,H=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&y!==c.Z_STREAM_END&&(R.avail_in!==0||b!==c.Z_FINISH&&b!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=a.utf8border(R.output,R.next_out),A=R.next_out-T,x=a.buf2string(R.output,T),R.next_out=A,R.avail_out=$-A,A&&o.arraySet(R.output,R.output,T,A,0),this.onData(x)):this.onData(o.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(H=!0)}while((0<R.avail_in||R.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(b=c.Z_FINISH),b===c.Z_FINISH?(y=s.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):b!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(R.avail_out=0))},f.prototype.onData=function(p){this.chunks.push(p)},f.prototype.onEnd=function(p){p===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=f,i.inflate=m,i.inflateRaw=function(p,g){return(g=g||{}).raw=!0,m(p,g)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var l=u.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)l.hasOwnProperty(h)&&(c[h]=l[h])}}return c},i.shrinkBuf=function(c,u){return c.length===u?c:c.subarray?c.subarray(0,u):(c.length=u,c)};var o={arraySet:function(c,u,l,h,d){if(u.subarray&&c.subarray)c.set(u.subarray(l,l+h),d);else for(var f=0;f<h;f++)c[d+f]=u[l+f]},flattenChunks:function(c){var u,l,h,d,f,m;for(u=h=0,l=c.length;u<l;u++)h+=c[u].length;for(m=new Uint8Array(h),u=d=0,l=c.length;u<l;u++)f=c[u],m.set(f,d),d+=f.length;return m}},a={arraySet:function(c,u,l,h,d){for(var f=0;f<h;f++)c[d+f]=u[l+f]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(r,n,i){var s=r("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function l(h,d){if(d<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,d));for(var f="",m=0;m<d;m++)f+=String.fromCharCode(h[m]);return f}c[254]=c[254]=1,i.string2buf=function(h){var d,f,m,p,g,y=h.length,b=0;for(p=0;p<y;p++)(64512&(f=h.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=h.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),p++),b+=f<128?1:f<2048?2:f<65536?3:4;for(d=new s.Buf8(b),p=g=0;g<b;p++)(64512&(f=h.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=h.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),p++),f<128?d[g++]=f:(f<2048?d[g++]=192|f>>>6:(f<65536?d[g++]=224|f>>>12:(d[g++]=240|f>>>18,d[g++]=128|f>>>12&63),d[g++]=128|f>>>6&63),d[g++]=128|63&f);return d},i.buf2binstring=function(h){return l(h,h.length)},i.binstring2buf=function(h){for(var d=new s.Buf8(h.length),f=0,m=d.length;f<m;f++)d[f]=h.charCodeAt(f);return d},i.buf2string=function(h,d){var f,m,p,g,y=d||h.length,b=new Array(2*y);for(f=m=0;f<y;)if((p=h[f++])<128)b[m++]=p;else if(4<(g=c[p]))b[m++]=65533,f+=g-1;else{for(p&=g===2?31:g===3?15:7;1<g&&f<y;)p=p<<6|63&h[f++],g--;1<g?b[m++]=65533:p<65536?b[m++]=p:(p-=65536,b[m++]=55296|p>>10&1023,b[m++]=56320|1023&p)}return l(b,m)},i.utf8border=function(h,d){var f;for((d=d||h.length)>h.length&&(d=h.length),f=d-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?d:f+c[h[f]]>d?f:d}},{"./common":41}],43:[function(r,n,i){n.exports=function(s,o,a,c){for(var u=65535&s|0,l=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;l=l+(u=u+o[c++]|0)|0,--h;);u%=65521,l%=65521}return u|l<<16|0}},{}],44:[function(r,n,i){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,n,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();n.exports=function(o,a,c,u){var l=s,h=u+c;o^=-1;for(var d=u;d<h;d++)o=o>>>8^l[255&(o^a[d])];return-1^o}},{}],46:[function(r,n,i){var s,o=r("../utils/common"),a=r("./trees"),c=r("./adler32"),u=r("./crc32"),l=r("./messages"),h=0,d=4,f=0,m=-2,p=-1,g=4,y=2,b=8,T=9,A=286,x=30,I=19,R=2*A+1,$=15,M=3,H=258,X=H+M+1,O=42,N=113,E=1,L=2,j=3,U=4;function V(S,ft){return S.msg=l[ft],ft}function Q(S){return(S<<1)-(4<S?9:0)}function K(S){for(var ft=S.length;0<=--ft;)S[ft]=0}function W(S){var ft=S.state,ct=ft.pending;ct>S.avail_out&&(ct=S.avail_out),ct!==0&&(o.arraySet(S.output,ft.pending_buf,ft.pending_out,ct,S.next_out),S.next_out+=ct,ft.pending_out+=ct,S.total_out+=ct,S.avail_out-=ct,ft.pending-=ct,ft.pending===0&&(ft.pending_out=0))}function P(S,ft){a._tr_flush_block(S,0<=S.block_start?S.block_start:-1,S.strstart-S.block_start,ft),S.block_start=S.strstart,W(S.strm)}function st(S,ft){S.pending_buf[S.pending++]=ft}function G(S,ft){S.pending_buf[S.pending++]=ft>>>8&255,S.pending_buf[S.pending++]=255&ft}function rt(S,ft){var ct,z,B=S.max_chain_length,tt=S.strstart,dt=S.prev_length,pt=S.nice_match,it=S.strstart>S.w_size-X?S.strstart-(S.w_size-X):0,_t=S.window,Rt=S.w_mask,gt=S.prev,Ft=S.strstart+H,ye=_t[tt+dt-1],Jt=_t[tt+dt];S.prev_length>=S.good_match&&(B>>=2),pt>S.lookahead&&(pt=S.lookahead);do if(_t[(ct=ft)+dt]===Jt&&_t[ct+dt-1]===ye&&_t[ct]===_t[tt]&&_t[++ct]===_t[tt+1]){tt+=2,ct++;do;while(_t[++tt]===_t[++ct]&&_t[++tt]===_t[++ct]&&_t[++tt]===_t[++ct]&&_t[++tt]===_t[++ct]&&_t[++tt]===_t[++ct]&&_t[++tt]===_t[++ct]&&_t[++tt]===_t[++ct]&&_t[++tt]===_t[++ct]&&tt<Ft);if(z=H-(Ft-tt),tt=Ft-H,dt<z){if(S.match_start=ft,pt<=(dt=z))break;ye=_t[tt+dt-1],Jt=_t[tt+dt]}}while((ft=gt[ft&Rt])>it&&--B!=0);return dt<=S.lookahead?dt:S.lookahead}function wt(S){var ft,ct,z,B,tt,dt,pt,it,_t,Rt,gt=S.w_size;do{if(B=S.window_size-S.lookahead-S.strstart,S.strstart>=gt+(gt-X)){for(o.arraySet(S.window,S.window,gt,gt,0),S.match_start-=gt,S.strstart-=gt,S.block_start-=gt,ft=ct=S.hash_size;z=S.head[--ft],S.head[ft]=gt<=z?z-gt:0,--ct;);for(ft=ct=gt;z=S.prev[--ft],S.prev[ft]=gt<=z?z-gt:0,--ct;);B+=gt}if(S.strm.avail_in===0)break;if(dt=S.strm,pt=S.window,it=S.strstart+S.lookahead,_t=B,Rt=void 0,Rt=dt.avail_in,_t<Rt&&(Rt=_t),ct=Rt===0?0:(dt.avail_in-=Rt,o.arraySet(pt,dt.input,dt.next_in,Rt,it),dt.state.wrap===1?dt.adler=c(dt.adler,pt,Rt,it):dt.state.wrap===2&&(dt.adler=u(dt.adler,pt,Rt,it)),dt.next_in+=Rt,dt.total_in+=Rt,Rt),S.lookahead+=ct,S.lookahead+S.insert>=M)for(tt=S.strstart-S.insert,S.ins_h=S.window[tt],S.ins_h=(S.ins_h<<S.hash_shift^S.window[tt+1])&S.hash_mask;S.insert&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[tt+M-1])&S.hash_mask,S.prev[tt&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=tt,tt++,S.insert--,!(S.lookahead+S.insert<M)););}while(S.lookahead<X&&S.strm.avail_in!==0)}function Tt(S,ft){for(var ct,z;;){if(S.lookahead<X){if(wt(S),S.lookahead<X&&ft===h)return E;if(S.lookahead===0)break}if(ct=0,S.lookahead>=M&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+M-1])&S.hash_mask,ct=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),ct!==0&&S.strstart-ct<=S.w_size-X&&(S.match_length=rt(S,ct)),S.match_length>=M)if(z=a._tr_tally(S,S.strstart-S.match_start,S.match_length-M),S.lookahead-=S.match_length,S.match_length<=S.max_lazy_match&&S.lookahead>=M){for(S.match_length--;S.strstart++,S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+M-1])&S.hash_mask,ct=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart,--S.match_length!=0;);S.strstart++}else S.strstart+=S.match_length,S.match_length=0,S.ins_h=S.window[S.strstart],S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+1])&S.hash_mask;else z=a._tr_tally(S,0,S.window[S.strstart]),S.lookahead--,S.strstart++;if(z&&(P(S,!1),S.strm.avail_out===0))return E}return S.insert=S.strstart<M-1?S.strstart:M-1,ft===d?(P(S,!0),S.strm.avail_out===0?j:U):S.last_lit&&(P(S,!1),S.strm.avail_out===0)?E:L}function It(S,ft){for(var ct,z,B;;){if(S.lookahead<X){if(wt(S),S.lookahead<X&&ft===h)return E;if(S.lookahead===0)break}if(ct=0,S.lookahead>=M&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+M-1])&S.hash_mask,ct=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),S.prev_length=S.match_length,S.prev_match=S.match_start,S.match_length=M-1,ct!==0&&S.prev_length<S.max_lazy_match&&S.strstart-ct<=S.w_size-X&&(S.match_length=rt(S,ct),S.match_length<=5&&(S.strategy===1||S.match_length===M&&4096<S.strstart-S.match_start)&&(S.match_length=M-1)),S.prev_length>=M&&S.match_length<=S.prev_length){for(B=S.strstart+S.lookahead-M,z=a._tr_tally(S,S.strstart-1-S.prev_match,S.prev_length-M),S.lookahead-=S.prev_length-1,S.prev_length-=2;++S.strstart<=B&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+M-1])&S.hash_mask,ct=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),--S.prev_length!=0;);if(S.match_available=0,S.match_length=M-1,S.strstart++,z&&(P(S,!1),S.strm.avail_out===0))return E}else if(S.match_available){if((z=a._tr_tally(S,0,S.window[S.strstart-1]))&&P(S,!1),S.strstart++,S.lookahead--,S.strm.avail_out===0)return E}else S.match_available=1,S.strstart++,S.lookahead--}return S.match_available&&(z=a._tr_tally(S,0,S.window[S.strstart-1]),S.match_available=0),S.insert=S.strstart<M-1?S.strstart:M-1,ft===d?(P(S,!0),S.strm.avail_out===0?j:U):S.last_lit&&(P(S,!1),S.strm.avail_out===0)?E:L}function St(S,ft,ct,z,B){this.good_length=S,this.max_lazy=ft,this.nice_length=ct,this.max_chain=z,this.func=B}function Pt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*R),this.dyn_dtree=new o.Buf16(2*(2*x+1)),this.bl_tree=new o.Buf16(2*(2*I+1)),K(this.dyn_ltree),K(this.dyn_dtree),K(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16($+1),this.heap=new o.Buf16(2*A+1),K(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),K(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Mt(S){var ft;return S&&S.state?(S.total_in=S.total_out=0,S.data_type=y,(ft=S.state).pending=0,ft.pending_out=0,ft.wrap<0&&(ft.wrap=-ft.wrap),ft.status=ft.wrap?O:N,S.adler=ft.wrap===2?0:1,ft.last_flush=h,a._tr_init(ft),f):V(S,m)}function Vt(S){var ft=Mt(S);return ft===f&&function(ct){ct.window_size=2*ct.w_size,K(ct.head),ct.max_lazy_match=s[ct.level].max_lazy,ct.good_match=s[ct.level].good_length,ct.nice_match=s[ct.level].nice_length,ct.max_chain_length=s[ct.level].max_chain,ct.strstart=0,ct.block_start=0,ct.lookahead=0,ct.insert=0,ct.match_length=ct.prev_length=M-1,ct.match_available=0,ct.ins_h=0}(S.state),ft}function ee(S,ft,ct,z,B,tt){if(!S)return m;var dt=1;if(ft===p&&(ft=6),z<0?(dt=0,z=-z):15<z&&(dt=2,z-=16),B<1||T<B||ct!==b||z<8||15<z||ft<0||9<ft||tt<0||g<tt)return V(S,m);z===8&&(z=9);var pt=new Pt;return(S.state=pt).strm=S,pt.wrap=dt,pt.gzhead=null,pt.w_bits=z,pt.w_size=1<<pt.w_bits,pt.w_mask=pt.w_size-1,pt.hash_bits=B+7,pt.hash_size=1<<pt.hash_bits,pt.hash_mask=pt.hash_size-1,pt.hash_shift=~~((pt.hash_bits+M-1)/M),pt.window=new o.Buf8(2*pt.w_size),pt.head=new o.Buf16(pt.hash_size),pt.prev=new o.Buf16(pt.w_size),pt.lit_bufsize=1<<B+6,pt.pending_buf_size=4*pt.lit_bufsize,pt.pending_buf=new o.Buf8(pt.pending_buf_size),pt.d_buf=1*pt.lit_bufsize,pt.l_buf=3*pt.lit_bufsize,pt.level=ft,pt.strategy=tt,pt.method=ct,Vt(S)}s=[new St(0,0,0,0,function(S,ft){var ct=65535;for(ct>S.pending_buf_size-5&&(ct=S.pending_buf_size-5);;){if(S.lookahead<=1){if(wt(S),S.lookahead===0&&ft===h)return E;if(S.lookahead===0)break}S.strstart+=S.lookahead,S.lookahead=0;var z=S.block_start+ct;if((S.strstart===0||S.strstart>=z)&&(S.lookahead=S.strstart-z,S.strstart=z,P(S,!1),S.strm.avail_out===0)||S.strstart-S.block_start>=S.w_size-X&&(P(S,!1),S.strm.avail_out===0))return E}return S.insert=0,ft===d?(P(S,!0),S.strm.avail_out===0?j:U):(S.strstart>S.block_start&&(P(S,!1),S.strm.avail_out),E)}),new St(4,4,8,4,Tt),new St(4,5,16,8,Tt),new St(4,6,32,32,Tt),new St(4,4,16,16,It),new St(8,16,32,32,It),new St(8,16,128,128,It),new St(8,32,128,256,It),new St(32,128,258,1024,It),new St(32,258,258,4096,It)],i.deflateInit=function(S,ft){return ee(S,ft,b,15,8,0)},i.deflateInit2=ee,i.deflateReset=Vt,i.deflateResetKeep=Mt,i.deflateSetHeader=function(S,ft){return S&&S.state?S.state.wrap!==2?m:(S.state.gzhead=ft,f):m},i.deflate=function(S,ft){var ct,z,B,tt;if(!S||!S.state||5<ft||ft<0)return S?V(S,m):m;if(z=S.state,!S.output||!S.input&&S.avail_in!==0||z.status===666&&ft!==d)return V(S,S.avail_out===0?-5:m);if(z.strm=S,ct=z.last_flush,z.last_flush=ft,z.status===O)if(z.wrap===2)S.adler=0,st(z,31),st(z,139),st(z,8),z.gzhead?(st(z,(z.gzhead.text?1:0)+(z.gzhead.hcrc?2:0)+(z.gzhead.extra?4:0)+(z.gzhead.name?8:0)+(z.gzhead.comment?16:0)),st(z,255&z.gzhead.time),st(z,z.gzhead.time>>8&255),st(z,z.gzhead.time>>16&255),st(z,z.gzhead.time>>24&255),st(z,z.level===9?2:2<=z.strategy||z.level<2?4:0),st(z,255&z.gzhead.os),z.gzhead.extra&&z.gzhead.extra.length&&(st(z,255&z.gzhead.extra.length),st(z,z.gzhead.extra.length>>8&255)),z.gzhead.hcrc&&(S.adler=u(S.adler,z.pending_buf,z.pending,0)),z.gzindex=0,z.status=69):(st(z,0),st(z,0),st(z,0),st(z,0),st(z,0),st(z,z.level===9?2:2<=z.strategy||z.level<2?4:0),st(z,3),z.status=N);else{var dt=b+(z.w_bits-8<<4)<<8;dt|=(2<=z.strategy||z.level<2?0:z.level<6?1:z.level===6?2:3)<<6,z.strstart!==0&&(dt|=32),dt+=31-dt%31,z.status=N,G(z,dt),z.strstart!==0&&(G(z,S.adler>>>16),G(z,65535&S.adler)),S.adler=1}if(z.status===69)if(z.gzhead.extra){for(B=z.pending;z.gzindex<(65535&z.gzhead.extra.length)&&(z.pending!==z.pending_buf_size||(z.gzhead.hcrc&&z.pending>B&&(S.adler=u(S.adler,z.pending_buf,z.pending-B,B)),W(S),B=z.pending,z.pending!==z.pending_buf_size));)st(z,255&z.gzhead.extra[z.gzindex]),z.gzindex++;z.gzhead.hcrc&&z.pending>B&&(S.adler=u(S.adler,z.pending_buf,z.pending-B,B)),z.gzindex===z.gzhead.extra.length&&(z.gzindex=0,z.status=73)}else z.status=73;if(z.status===73)if(z.gzhead.name){B=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>B&&(S.adler=u(S.adler,z.pending_buf,z.pending-B,B)),W(S),B=z.pending,z.pending===z.pending_buf_size)){tt=1;break}tt=z.gzindex<z.gzhead.name.length?255&z.gzhead.name.charCodeAt(z.gzindex++):0,st(z,tt)}while(tt!==0);z.gzhead.hcrc&&z.pending>B&&(S.adler=u(S.adler,z.pending_buf,z.pending-B,B)),tt===0&&(z.gzindex=0,z.status=91)}else z.status=91;if(z.status===91)if(z.gzhead.comment){B=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>B&&(S.adler=u(S.adler,z.pending_buf,z.pending-B,B)),W(S),B=z.pending,z.pending===z.pending_buf_size)){tt=1;break}tt=z.gzindex<z.gzhead.comment.length?255&z.gzhead.comment.charCodeAt(z.gzindex++):0,st(z,tt)}while(tt!==0);z.gzhead.hcrc&&z.pending>B&&(S.adler=u(S.adler,z.pending_buf,z.pending-B,B)),tt===0&&(z.status=103)}else z.status=103;if(z.status===103&&(z.gzhead.hcrc?(z.pending+2>z.pending_buf_size&&W(S),z.pending+2<=z.pending_buf_size&&(st(z,255&S.adler),st(z,S.adler>>8&255),S.adler=0,z.status=N)):z.status=N),z.pending!==0){if(W(S),S.avail_out===0)return z.last_flush=-1,f}else if(S.avail_in===0&&Q(ft)<=Q(ct)&&ft!==d)return V(S,-5);if(z.status===666&&S.avail_in!==0)return V(S,-5);if(S.avail_in!==0||z.lookahead!==0||ft!==h&&z.status!==666){var pt=z.strategy===2?function(it,_t){for(var Rt;;){if(it.lookahead===0&&(wt(it),it.lookahead===0)){if(_t===h)return E;break}if(it.match_length=0,Rt=a._tr_tally(it,0,it.window[it.strstart]),it.lookahead--,it.strstart++,Rt&&(P(it,!1),it.strm.avail_out===0))return E}return it.insert=0,_t===d?(P(it,!0),it.strm.avail_out===0?j:U):it.last_lit&&(P(it,!1),it.strm.avail_out===0)?E:L}(z,ft):z.strategy===3?function(it,_t){for(var Rt,gt,Ft,ye,Jt=it.window;;){if(it.lookahead<=H){if(wt(it),it.lookahead<=H&&_t===h)return E;if(it.lookahead===0)break}if(it.match_length=0,it.lookahead>=M&&0<it.strstart&&(gt=Jt[Ft=it.strstart-1])===Jt[++Ft]&&gt===Jt[++Ft]&&gt===Jt[++Ft]){ye=it.strstart+H;do;while(gt===Jt[++Ft]&&gt===Jt[++Ft]&&gt===Jt[++Ft]&&gt===Jt[++Ft]&&gt===Jt[++Ft]&&gt===Jt[++Ft]&&gt===Jt[++Ft]&&gt===Jt[++Ft]&&Ft<ye);it.match_length=H-(ye-Ft),it.match_length>it.lookahead&&(it.match_length=it.lookahead)}if(it.match_length>=M?(Rt=a._tr_tally(it,1,it.match_length-M),it.lookahead-=it.match_length,it.strstart+=it.match_length,it.match_length=0):(Rt=a._tr_tally(it,0,it.window[it.strstart]),it.lookahead--,it.strstart++),Rt&&(P(it,!1),it.strm.avail_out===0))return E}return it.insert=0,_t===d?(P(it,!0),it.strm.avail_out===0?j:U):it.last_lit&&(P(it,!1),it.strm.avail_out===0)?E:L}(z,ft):s[z.level].func(z,ft);if(pt!==j&&pt!==U||(z.status=666),pt===E||pt===j)return S.avail_out===0&&(z.last_flush=-1),f;if(pt===L&&(ft===1?a._tr_align(z):ft!==5&&(a._tr_stored_block(z,0,0,!1),ft===3&&(K(z.head),z.lookahead===0&&(z.strstart=0,z.block_start=0,z.insert=0))),W(S),S.avail_out===0))return z.last_flush=-1,f}return ft!==d?f:z.wrap<=0?1:(z.wrap===2?(st(z,255&S.adler),st(z,S.adler>>8&255),st(z,S.adler>>16&255),st(z,S.adler>>24&255),st(z,255&S.total_in),st(z,S.total_in>>8&255),st(z,S.total_in>>16&255),st(z,S.total_in>>24&255)):(G(z,S.adler>>>16),G(z,65535&S.adler)),W(S),0<z.wrap&&(z.wrap=-z.wrap),z.pending!==0?f:1)},i.deflateEnd=function(S){var ft;return S&&S.state?(ft=S.state.status)!==O&&ft!==69&&ft!==73&&ft!==91&&ft!==103&&ft!==N&&ft!==666?V(S,m):(S.state=null,ft===N?V(S,-3):f):m},i.deflateSetDictionary=function(S,ft){var ct,z,B,tt,dt,pt,it,_t,Rt=ft.length;if(!S||!S.state||(tt=(ct=S.state).wrap)===2||tt===1&&ct.status!==O||ct.lookahead)return m;for(tt===1&&(S.adler=c(S.adler,ft,Rt,0)),ct.wrap=0,Rt>=ct.w_size&&(tt===0&&(K(ct.head),ct.strstart=0,ct.block_start=0,ct.insert=0),_t=new o.Buf8(ct.w_size),o.arraySet(_t,ft,Rt-ct.w_size,ct.w_size,0),ft=_t,Rt=ct.w_size),dt=S.avail_in,pt=S.next_in,it=S.input,S.avail_in=Rt,S.next_in=0,S.input=ft,wt(ct);ct.lookahead>=M;){for(z=ct.strstart,B=ct.lookahead-(M-1);ct.ins_h=(ct.ins_h<<ct.hash_shift^ct.window[z+M-1])&ct.hash_mask,ct.prev[z&ct.w_mask]=ct.head[ct.ins_h],ct.head[ct.ins_h]=z,z++,--B;);ct.strstart=z,ct.lookahead=M-1,wt(ct)}return ct.strstart+=ct.lookahead,ct.block_start=ct.strstart,ct.insert=ct.lookahead,ct.lookahead=0,ct.match_length=ct.prev_length=M-1,ct.match_available=0,S.next_in=pt,S.input=it,S.avail_in=dt,ct.wrap=tt,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,n,i){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,n,i){n.exports=function(s,o){var a,c,u,l,h,d,f,m,p,g,y,b,T,A,x,I,R,$,M,H,X,O,N,E,L;a=s.state,c=s.next_in,E=s.input,u=c+(s.avail_in-5),l=s.next_out,L=s.output,h=l-(o-s.avail_out),d=l+(s.avail_out-257),f=a.dmax,m=a.wsize,p=a.whave,g=a.wnext,y=a.window,b=a.hold,T=a.bits,A=a.lencode,x=a.distcode,I=(1<<a.lenbits)-1,R=(1<<a.distbits)-1;t:do{T<15&&(b+=E[c++]<<T,T+=8,b+=E[c++]<<T,T+=8),$=A[b&I];e:for(;;){if(b>>>=M=$>>>24,T-=M,(M=$>>>16&255)===0)L[l++]=65535&$;else{if(!(16&M)){if(!(64&M)){$=A[(65535&$)+(b&(1<<M)-1)];continue e}if(32&M){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}H=65535&$,(M&=15)&&(T<M&&(b+=E[c++]<<T,T+=8),H+=b&(1<<M)-1,b>>>=M,T-=M),T<15&&(b+=E[c++]<<T,T+=8,b+=E[c++]<<T,T+=8),$=x[b&R];r:for(;;){if(b>>>=M=$>>>24,T-=M,!(16&(M=$>>>16&255))){if(!(64&M)){$=x[(65535&$)+(b&(1<<M)-1)];continue r}s.msg="invalid distance code",a.mode=30;break t}if(X=65535&$,T<(M&=15)&&(b+=E[c++]<<T,(T+=8)<M&&(b+=E[c++]<<T,T+=8)),f<(X+=b&(1<<M)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(b>>>=M,T-=M,(M=l-h)<X){if(p<(M=X-M)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(N=y,(O=0)===g){if(O+=m-M,M<H){for(H-=M;L[l++]=y[O++],--M;);O=l-X,N=L}}else if(g<M){if(O+=m+g-M,(M-=g)<H){for(H-=M;L[l++]=y[O++],--M;);if(O=0,g<H){for(H-=M=g;L[l++]=y[O++],--M;);O=l-X,N=L}}}else if(O+=g-M,M<H){for(H-=M;L[l++]=y[O++],--M;);O=l-X,N=L}for(;2<H;)L[l++]=N[O++],L[l++]=N[O++],L[l++]=N[O++],H-=3;H&&(L[l++]=N[O++],1<H&&(L[l++]=N[O++]))}else{for(O=l-X;L[l++]=L[O++],L[l++]=L[O++],L[l++]=L[O++],2<(H-=3););H&&(L[l++]=L[O++],1<H&&(L[l++]=L[O++]))}break}}break}}while(c<u&&l<d);c-=H=T>>3,b&=(1<<(T-=H<<3))-1,s.next_in=c,s.next_out=l,s.avail_in=c<u?u-c+5:5-(c-u),s.avail_out=l<d?d-l+257:257-(l-d),a.hold=b,a.bits=T}},{}],49:[function(r,n,i){var s=r("../utils/common"),o=r("./adler32"),a=r("./crc32"),c=r("./inffast"),u=r("./inftrees"),l=1,h=2,d=0,f=-2,m=1,p=852,g=592;function y(O){return(O>>>24&255)+(O>>>8&65280)+((65280&O)<<8)+((255&O)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(O){var N;return O&&O.state?(N=O.state,O.total_in=O.total_out=N.total=0,O.msg="",N.wrap&&(O.adler=1&N.wrap),N.mode=m,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new s.Buf32(p),N.distcode=N.distdyn=new s.Buf32(g),N.sane=1,N.back=-1,d):f}function A(O){var N;return O&&O.state?((N=O.state).wsize=0,N.whave=0,N.wnext=0,T(O)):f}function x(O,N){var E,L;return O&&O.state?(L=O.state,N<0?(E=0,N=-N):(E=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?f:(L.window!==null&&L.wbits!==N&&(L.window=null),L.wrap=E,L.wbits=N,A(O))):f}function I(O,N){var E,L;return O?(L=new b,(O.state=L).window=null,(E=x(O,N))!==d&&(O.state=null),E):f}var R,$,M=!0;function H(O){if(M){var N;for(R=new s.Buf32(512),$=new s.Buf32(32),N=0;N<144;)O.lens[N++]=8;for(;N<256;)O.lens[N++]=9;for(;N<280;)O.lens[N++]=7;for(;N<288;)O.lens[N++]=8;for(u(l,O.lens,0,288,R,0,O.work,{bits:9}),N=0;N<32;)O.lens[N++]=5;u(h,O.lens,0,32,$,0,O.work,{bits:5}),M=!1}O.lencode=R,O.lenbits=9,O.distcode=$,O.distbits=5}function X(O,N,E,L){var j,U=O.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new s.Buf8(U.wsize)),L>=U.wsize?(s.arraySet(U.window,N,E-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(L<(j=U.wsize-U.wnext)&&(j=L),s.arraySet(U.window,N,E-L,j,U.wnext),(L-=j)?(s.arraySet(U.window,N,E-L,L,0),U.wnext=L,U.whave=U.wsize):(U.wnext+=j,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=j))),0}i.inflateReset=A,i.inflateReset2=x,i.inflateResetKeep=T,i.inflateInit=function(O){return I(O,15)},i.inflateInit2=I,i.inflate=function(O,N){var E,L,j,U,V,Q,K,W,P,st,G,rt,wt,Tt,It,St,Pt,Mt,Vt,ee,S,ft,ct,z,B=0,tt=new s.Buf8(4),dt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!O||!O.state||!O.output||!O.input&&O.avail_in!==0)return f;(E=O.state).mode===12&&(E.mode=13),V=O.next_out,j=O.output,K=O.avail_out,U=O.next_in,L=O.input,Q=O.avail_in,W=E.hold,P=E.bits,st=Q,G=K,ft=d;t:for(;;)switch(E.mode){case m:if(E.wrap===0){E.mode=13;break}for(;P<16;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(2&E.wrap&&W===35615){tt[E.check=0]=255&W,tt[1]=W>>>8&255,E.check=a(E.check,tt,2,0),P=W=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&W)<<8)+(W>>8))%31){O.msg="incorrect header check",E.mode=30;break}if((15&W)!=8){O.msg="unknown compression method",E.mode=30;break}if(P-=4,S=8+(15&(W>>>=4)),E.wbits===0)E.wbits=S;else if(S>E.wbits){O.msg="invalid window size",E.mode=30;break}E.dmax=1<<S,O.adler=E.check=1,E.mode=512&W?10:12,P=W=0;break;case 2:for(;P<16;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(E.flags=W,(255&E.flags)!=8){O.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){O.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=W>>8&1),512&E.flags&&(tt[0]=255&W,tt[1]=W>>>8&255,E.check=a(E.check,tt,2,0)),P=W=0,E.mode=3;case 3:for(;P<32;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}E.head&&(E.head.time=W),512&E.flags&&(tt[0]=255&W,tt[1]=W>>>8&255,tt[2]=W>>>16&255,tt[3]=W>>>24&255,E.check=a(E.check,tt,4,0)),P=W=0,E.mode=4;case 4:for(;P<16;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}E.head&&(E.head.xflags=255&W,E.head.os=W>>8),512&E.flags&&(tt[0]=255&W,tt[1]=W>>>8&255,E.check=a(E.check,tt,2,0)),P=W=0,E.mode=5;case 5:if(1024&E.flags){for(;P<16;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}E.length=W,E.head&&(E.head.extra_len=W),512&E.flags&&(tt[0]=255&W,tt[1]=W>>>8&255,E.check=a(E.check,tt,2,0)),P=W=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(Q<(rt=E.length)&&(rt=Q),rt&&(E.head&&(S=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),s.arraySet(E.head.extra,L,U,rt,S)),512&E.flags&&(E.check=a(E.check,L,rt,U)),Q-=rt,U+=rt,E.length-=rt),E.length))break t;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(Q===0)break t;for(rt=0;S=L[U+rt++],E.head&&S&&E.length<65536&&(E.head.name+=String.fromCharCode(S)),S&&rt<Q;);if(512&E.flags&&(E.check=a(E.check,L,rt,U)),Q-=rt,U+=rt,S)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(Q===0)break t;for(rt=0;S=L[U+rt++],E.head&&S&&E.length<65536&&(E.head.comment+=String.fromCharCode(S)),S&&rt<Q;);if(512&E.flags&&(E.check=a(E.check,L,rt,U)),Q-=rt,U+=rt,S)break t}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;P<16;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(W!==(65535&E.check)){O.msg="header crc mismatch",E.mode=30;break}P=W=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),O.adler=E.check=0,E.mode=12;break;case 10:for(;P<32;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}O.adler=E.check=y(W),P=W=0,E.mode=11;case 11:if(E.havedict===0)return O.next_out=V,O.avail_out=K,O.next_in=U,O.avail_in=Q,E.hold=W,E.bits=P,2;O.adler=E.check=1,E.mode=12;case 12:if(N===5||N===6)break t;case 13:if(E.last){W>>>=7&P,P-=7&P,E.mode=27;break}for(;P<3;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}switch(E.last=1&W,P-=1,3&(W>>>=1)){case 0:E.mode=14;break;case 1:if(H(E),E.mode=20,N!==6)break;W>>>=2,P-=2;break t;case 2:E.mode=17;break;case 3:O.msg="invalid block type",E.mode=30}W>>>=2,P-=2;break;case 14:for(W>>>=7&P,P-=7&P;P<32;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if((65535&W)!=(W>>>16^65535)){O.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&W,P=W=0,E.mode=15,N===6)break t;case 15:E.mode=16;case 16:if(rt=E.length){if(Q<rt&&(rt=Q),K<rt&&(rt=K),rt===0)break t;s.arraySet(j,L,U,rt,V),Q-=rt,U+=rt,K-=rt,V+=rt,E.length-=rt;break}E.mode=12;break;case 17:for(;P<14;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(E.nlen=257+(31&W),W>>>=5,P-=5,E.ndist=1+(31&W),W>>>=5,P-=5,E.ncode=4+(15&W),W>>>=4,P-=4,286<E.nlen||30<E.ndist){O.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;P<3;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}E.lens[dt[E.have++]]=7&W,W>>>=3,P-=3}for(;E.have<19;)E.lens[dt[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,ct={bits:E.lenbits},ft=u(0,E.lens,0,19,E.lencode,0,E.work,ct),E.lenbits=ct.bits,ft){O.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;St=(B=E.lencode[W&(1<<E.lenbits)-1])>>>16&255,Pt=65535&B,!((It=B>>>24)<=P);){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(Pt<16)W>>>=It,P-=It,E.lens[E.have++]=Pt;else{if(Pt===16){for(z=It+2;P<z;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(W>>>=It,P-=It,E.have===0){O.msg="invalid bit length repeat",E.mode=30;break}S=E.lens[E.have-1],rt=3+(3&W),W>>>=2,P-=2}else if(Pt===17){for(z=It+3;P<z;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}P-=It,S=0,rt=3+(7&(W>>>=It)),W>>>=3,P-=3}else{for(z=It+7;P<z;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}P-=It,S=0,rt=11+(127&(W>>>=It)),W>>>=7,P-=7}if(E.have+rt>E.nlen+E.ndist){O.msg="invalid bit length repeat",E.mode=30;break}for(;rt--;)E.lens[E.have++]=S}}if(E.mode===30)break;if(E.lens[256]===0){O.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,ct={bits:E.lenbits},ft=u(l,E.lens,0,E.nlen,E.lencode,0,E.work,ct),E.lenbits=ct.bits,ft){O.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,ct={bits:E.distbits},ft=u(h,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,ct),E.distbits=ct.bits,ft){O.msg="invalid distances set",E.mode=30;break}if(E.mode=20,N===6)break t;case 20:E.mode=21;case 21:if(6<=Q&&258<=K){O.next_out=V,O.avail_out=K,O.next_in=U,O.avail_in=Q,E.hold=W,E.bits=P,c(O,G),V=O.next_out,j=O.output,K=O.avail_out,U=O.next_in,L=O.input,Q=O.avail_in,W=E.hold,P=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;St=(B=E.lencode[W&(1<<E.lenbits)-1])>>>16&255,Pt=65535&B,!((It=B>>>24)<=P);){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(St&&!(240&St)){for(Mt=It,Vt=St,ee=Pt;St=(B=E.lencode[ee+((W&(1<<Mt+Vt)-1)>>Mt)])>>>16&255,Pt=65535&B,!(Mt+(It=B>>>24)<=P);){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}W>>>=Mt,P-=Mt,E.back+=Mt}if(W>>>=It,P-=It,E.back+=It,E.length=Pt,St===0){E.mode=26;break}if(32&St){E.back=-1,E.mode=12;break}if(64&St){O.msg="invalid literal/length code",E.mode=30;break}E.extra=15&St,E.mode=22;case 22:if(E.extra){for(z=E.extra;P<z;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}E.length+=W&(1<<E.extra)-1,W>>>=E.extra,P-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;St=(B=E.distcode[W&(1<<E.distbits)-1])>>>16&255,Pt=65535&B,!((It=B>>>24)<=P);){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(!(240&St)){for(Mt=It,Vt=St,ee=Pt;St=(B=E.distcode[ee+((W&(1<<Mt+Vt)-1)>>Mt)])>>>16&255,Pt=65535&B,!(Mt+(It=B>>>24)<=P);){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}W>>>=Mt,P-=Mt,E.back+=Mt}if(W>>>=It,P-=It,E.back+=It,64&St){O.msg="invalid distance code",E.mode=30;break}E.offset=Pt,E.extra=15&St,E.mode=24;case 24:if(E.extra){for(z=E.extra;P<z;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}E.offset+=W&(1<<E.extra)-1,W>>>=E.extra,P-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){O.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(K===0)break t;if(rt=G-K,E.offset>rt){if((rt=E.offset-rt)>E.whave&&E.sane){O.msg="invalid distance too far back",E.mode=30;break}wt=rt>E.wnext?(rt-=E.wnext,E.wsize-rt):E.wnext-rt,rt>E.length&&(rt=E.length),Tt=E.window}else Tt=j,wt=V-E.offset,rt=E.length;for(K<rt&&(rt=K),K-=rt,E.length-=rt;j[V++]=Tt[wt++],--rt;);E.length===0&&(E.mode=21);break;case 26:if(K===0)break t;j[V++]=E.length,K--,E.mode=21;break;case 27:if(E.wrap){for(;P<32;){if(Q===0)break t;Q--,W|=L[U++]<<P,P+=8}if(G-=K,O.total_out+=G,E.total+=G,G&&(O.adler=E.check=E.flags?a(E.check,j,G,V-G):o(E.check,j,G,V-G)),G=K,(E.flags?W:y(W))!==E.check){O.msg="incorrect data check",E.mode=30;break}P=W=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;P<32;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(W!==(4294967295&E.total)){O.msg="incorrect length check",E.mode=30;break}P=W=0}E.mode=29;case 29:ft=1;break t;case 30:ft=-3;break t;case 31:return-4;case 32:default:return f}return O.next_out=V,O.avail_out=K,O.next_in=U,O.avail_in=Q,E.hold=W,E.bits=P,(E.wsize||G!==O.avail_out&&E.mode<30&&(E.mode<27||N!==4))&&X(O,O.output,O.next_out,G-O.avail_out)?(E.mode=31,-4):(st-=O.avail_in,G-=O.avail_out,O.total_in+=st,O.total_out+=G,E.total+=G,E.wrap&&G&&(O.adler=E.check=E.flags?a(E.check,j,G,O.next_out-G):o(E.check,j,G,O.next_out-G)),O.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(st==0&&G===0||N===4)&&ft===d&&(ft=-5),ft)},i.inflateEnd=function(O){if(!O||!O.state)return f;var N=O.state;return N.window&&(N.window=null),O.state=null,d},i.inflateGetHeader=function(O,N){var E;return O&&O.state&&2&(E=O.state).wrap?((E.head=N).done=!1,d):f},i.inflateSetDictionary=function(O,N){var E,L=N.length;return O&&O.state?(E=O.state).wrap!==0&&E.mode!==11?f:E.mode===11&&o(1,N,L,0)!==E.check?-3:X(O,N,L,L)?(E.mode=31,-4):(E.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,n,i){var s=r("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(l,h,d,f,m,p,g,y){var b,T,A,x,I,R,$,M,H,X=y.bits,O=0,N=0,E=0,L=0,j=0,U=0,V=0,Q=0,K=0,W=0,P=null,st=0,G=new s.Buf16(16),rt=new s.Buf16(16),wt=null,Tt=0;for(O=0;O<=15;O++)G[O]=0;for(N=0;N<f;N++)G[h[d+N]]++;for(j=X,L=15;1<=L&&G[L]===0;L--);if(L<j&&(j=L),L===0)return m[p++]=20971520,m[p++]=20971520,y.bits=1,0;for(E=1;E<L&&G[E]===0;E++);for(j<E&&(j=E),O=Q=1;O<=15;O++)if(Q<<=1,(Q-=G[O])<0)return-1;if(0<Q&&(l===0||L!==1))return-1;for(rt[1]=0,O=1;O<15;O++)rt[O+1]=rt[O]+G[O];for(N=0;N<f;N++)h[d+N]!==0&&(g[rt[h[d+N]]++]=N);if(R=l===0?(P=wt=g,19):l===1?(P=o,st-=257,wt=a,Tt-=257,256):(P=c,wt=u,-1),O=E,I=p,V=N=W=0,A=-1,x=(K=1<<(U=j))-1,l===1&&852<K||l===2&&592<K)return 1;for(;;){for($=O-V,H=g[N]<R?(M=0,g[N]):g[N]>R?(M=wt[Tt+g[N]],P[st+g[N]]):(M=96,0),b=1<<O-V,E=T=1<<U;m[I+(W>>V)+(T-=b)]=$<<24|M<<16|H|0,T!==0;);for(b=1<<O-1;W&b;)b>>=1;if(b!==0?(W&=b-1,W+=b):W=0,N++,--G[O]==0){if(O===L)break;O=h[d+g[N]]}if(j<O&&(W&x)!==A){for(V===0&&(V=j),I+=E,Q=1<<(U=O-V);U+V<L&&!((Q-=G[U+V])<=0);)U++,Q<<=1;if(K+=1<<U,l===1&&852<K||l===2&&592<K)return 1;m[A=W&x]=j<<24|U<<16|I-p|0}}return W!==0&&(m[I+W]=O-V<<24|64<<16|0),y.bits=j,0}},{"../utils/common":41}],51:[function(r,n,i){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,n,i){var s=r("../utils/common"),o=0,a=1;function c(B){for(var tt=B.length;0<=--tt;)B[tt]=0}var u=0,l=29,h=256,d=h+1+l,f=30,m=19,p=2*d+1,g=15,y=16,b=7,T=256,A=16,x=17,I=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=new Array(2*(d+2));c(X);var O=new Array(2*f);c(O);var N=new Array(512);c(N);var E=new Array(256);c(E);var L=new Array(l);c(L);var j,U,V,Q=new Array(f);function K(B,tt,dt,pt,it){this.static_tree=B,this.extra_bits=tt,this.extra_base=dt,this.elems=pt,this.max_length=it,this.has_stree=B&&B.length}function W(B,tt){this.dyn_tree=B,this.max_code=0,this.stat_desc=tt}function P(B){return B<256?N[B]:N[256+(B>>>7)]}function st(B,tt){B.pending_buf[B.pending++]=255&tt,B.pending_buf[B.pending++]=tt>>>8&255}function G(B,tt,dt){B.bi_valid>y-dt?(B.bi_buf|=tt<<B.bi_valid&65535,st(B,B.bi_buf),B.bi_buf=tt>>y-B.bi_valid,B.bi_valid+=dt-y):(B.bi_buf|=tt<<B.bi_valid&65535,B.bi_valid+=dt)}function rt(B,tt,dt){G(B,dt[2*tt],dt[2*tt+1])}function wt(B,tt){for(var dt=0;dt|=1&B,B>>>=1,dt<<=1,0<--tt;);return dt>>>1}function Tt(B,tt,dt){var pt,it,_t=new Array(g+1),Rt=0;for(pt=1;pt<=g;pt++)_t[pt]=Rt=Rt+dt[pt-1]<<1;for(it=0;it<=tt;it++){var gt=B[2*it+1];gt!==0&&(B[2*it]=wt(_t[gt]++,gt))}}function It(B){var tt;for(tt=0;tt<d;tt++)B.dyn_ltree[2*tt]=0;for(tt=0;tt<f;tt++)B.dyn_dtree[2*tt]=0;for(tt=0;tt<m;tt++)B.bl_tree[2*tt]=0;B.dyn_ltree[2*T]=1,B.opt_len=B.static_len=0,B.last_lit=B.matches=0}function St(B){8<B.bi_valid?st(B,B.bi_buf):0<B.bi_valid&&(B.pending_buf[B.pending++]=B.bi_buf),B.bi_buf=0,B.bi_valid=0}function Pt(B,tt,dt,pt){var it=2*tt,_t=2*dt;return B[it]<B[_t]||B[it]===B[_t]&&pt[tt]<=pt[dt]}function Mt(B,tt,dt){for(var pt=B.heap[dt],it=dt<<1;it<=B.heap_len&&(it<B.heap_len&&Pt(tt,B.heap[it+1],B.heap[it],B.depth)&&it++,!Pt(tt,pt,B.heap[it],B.depth));)B.heap[dt]=B.heap[it],dt=it,it<<=1;B.heap[dt]=pt}function Vt(B,tt,dt){var pt,it,_t,Rt,gt=0;if(B.last_lit!==0)for(;pt=B.pending_buf[B.d_buf+2*gt]<<8|B.pending_buf[B.d_buf+2*gt+1],it=B.pending_buf[B.l_buf+gt],gt++,pt===0?rt(B,it,tt):(rt(B,(_t=E[it])+h+1,tt),(Rt=R[_t])!==0&&G(B,it-=L[_t],Rt),rt(B,_t=P(--pt),dt),(Rt=$[_t])!==0&&G(B,pt-=Q[_t],Rt)),gt<B.last_lit;);rt(B,T,tt)}function ee(B,tt){var dt,pt,it,_t=tt.dyn_tree,Rt=tt.stat_desc.static_tree,gt=tt.stat_desc.has_stree,Ft=tt.stat_desc.elems,ye=-1;for(B.heap_len=0,B.heap_max=p,dt=0;dt<Ft;dt++)_t[2*dt]!==0?(B.heap[++B.heap_len]=ye=dt,B.depth[dt]=0):_t[2*dt+1]=0;for(;B.heap_len<2;)_t[2*(it=B.heap[++B.heap_len]=ye<2?++ye:0)]=1,B.depth[it]=0,B.opt_len--,gt&&(B.static_len-=Rt[2*it+1]);for(tt.max_code=ye,dt=B.heap_len>>1;1<=dt;dt--)Mt(B,_t,dt);for(it=Ft;dt=B.heap[1],B.heap[1]=B.heap[B.heap_len--],Mt(B,_t,1),pt=B.heap[1],B.heap[--B.heap_max]=dt,B.heap[--B.heap_max]=pt,_t[2*it]=_t[2*dt]+_t[2*pt],B.depth[it]=(B.depth[dt]>=B.depth[pt]?B.depth[dt]:B.depth[pt])+1,_t[2*dt+1]=_t[2*pt+1]=it,B.heap[1]=it++,Mt(B,_t,1),2<=B.heap_len;);B.heap[--B.heap_max]=B.heap[1],function(Jt,Qe){var C,_,v,F,Y,at,D=Qe.dyn_tree,Z=Qe.max_code,Bt=Qe.stat_desc.static_tree,jt=Qe.stat_desc.has_stree,Gt=Qe.stat_desc.extra_bits,Ot=Qe.stat_desc.extra_base,rn=Qe.stat_desc.max_length,Cn=0;for(F=0;F<=g;F++)Jt.bl_count[F]=0;for(D[2*Jt.heap[Jt.heap_max]+1]=0,C=Jt.heap_max+1;C<p;C++)rn<(F=D[2*D[2*(_=Jt.heap[C])+1]+1]+1)&&(F=rn,Cn++),D[2*_+1]=F,Z<_||(Jt.bl_count[F]++,Y=0,Ot<=_&&(Y=Gt[_-Ot]),at=D[2*_],Jt.opt_len+=at*(F+Y),jt&&(Jt.static_len+=at*(Bt[2*_+1]+Y)));if(Cn!==0){do{for(F=rn-1;Jt.bl_count[F]===0;)F--;Jt.bl_count[F]--,Jt.bl_count[F+1]+=2,Jt.bl_count[rn]--,Cn-=2}while(0<Cn);for(F=rn;F!==0;F--)for(_=Jt.bl_count[F];_!==0;)Z<(v=Jt.heap[--C])||(D[2*v+1]!==F&&(Jt.opt_len+=(F-D[2*v+1])*D[2*v],D[2*v+1]=F),_--)}}(B,tt),Tt(_t,ye,B.bl_count)}function S(B,tt,dt){var pt,it,_t=-1,Rt=tt[1],gt=0,Ft=7,ye=4;for(Rt===0&&(Ft=138,ye=3),tt[2*(dt+1)+1]=65535,pt=0;pt<=dt;pt++)it=Rt,Rt=tt[2*(pt+1)+1],++gt<Ft&&it===Rt||(gt<ye?B.bl_tree[2*it]+=gt:it!==0?(it!==_t&&B.bl_tree[2*it]++,B.bl_tree[2*A]++):gt<=10?B.bl_tree[2*x]++:B.bl_tree[2*I]++,_t=it,ye=(gt=0)===Rt?(Ft=138,3):it===Rt?(Ft=6,3):(Ft=7,4))}function ft(B,tt,dt){var pt,it,_t=-1,Rt=tt[1],gt=0,Ft=7,ye=4;for(Rt===0&&(Ft=138,ye=3),pt=0;pt<=dt;pt++)if(it=Rt,Rt=tt[2*(pt+1)+1],!(++gt<Ft&&it===Rt)){if(gt<ye)for(;rt(B,it,B.bl_tree),--gt!=0;);else it!==0?(it!==_t&&(rt(B,it,B.bl_tree),gt--),rt(B,A,B.bl_tree),G(B,gt-3,2)):gt<=10?(rt(B,x,B.bl_tree),G(B,gt-3,3)):(rt(B,I,B.bl_tree),G(B,gt-11,7));_t=it,ye=(gt=0)===Rt?(Ft=138,3):it===Rt?(Ft=6,3):(Ft=7,4)}}c(Q);var ct=!1;function z(B,tt,dt,pt){G(B,(u<<1)+(pt?1:0),3),function(it,_t,Rt,gt){St(it),st(it,Rt),st(it,~Rt),s.arraySet(it.pending_buf,it.window,_t,Rt,it.pending),it.pending+=Rt}(B,tt,dt)}i._tr_init=function(B){ct||(function(){var tt,dt,pt,it,_t,Rt=new Array(g+1);for(it=pt=0;it<l-1;it++)for(L[it]=pt,tt=0;tt<1<<R[it];tt++)E[pt++]=it;for(E[pt-1]=it,it=_t=0;it<16;it++)for(Q[it]=_t,tt=0;tt<1<<$[it];tt++)N[_t++]=it;for(_t>>=7;it<f;it++)for(Q[it]=_t<<7,tt=0;tt<1<<$[it]-7;tt++)N[256+_t++]=it;for(dt=0;dt<=g;dt++)Rt[dt]=0;for(tt=0;tt<=143;)X[2*tt+1]=8,tt++,Rt[8]++;for(;tt<=255;)X[2*tt+1]=9,tt++,Rt[9]++;for(;tt<=279;)X[2*tt+1]=7,tt++,Rt[7]++;for(;tt<=287;)X[2*tt+1]=8,tt++,Rt[8]++;for(Tt(X,d+1,Rt),tt=0;tt<f;tt++)O[2*tt+1]=5,O[2*tt]=wt(tt,5);j=new K(X,R,h+1,d,g),U=new K(O,$,0,f,g),V=new K(new Array(0),M,0,m,b)}(),ct=!0),B.l_desc=new W(B.dyn_ltree,j),B.d_desc=new W(B.dyn_dtree,U),B.bl_desc=new W(B.bl_tree,V),B.bi_buf=0,B.bi_valid=0,It(B)},i._tr_stored_block=z,i._tr_flush_block=function(B,tt,dt,pt){var it,_t,Rt=0;0<B.level?(B.strm.data_type===2&&(B.strm.data_type=function(gt){var Ft,ye=4093624447;for(Ft=0;Ft<=31;Ft++,ye>>>=1)if(1&ye&&gt.dyn_ltree[2*Ft]!==0)return o;if(gt.dyn_ltree[18]!==0||gt.dyn_ltree[20]!==0||gt.dyn_ltree[26]!==0)return a;for(Ft=32;Ft<h;Ft++)if(gt.dyn_ltree[2*Ft]!==0)return a;return o}(B)),ee(B,B.l_desc),ee(B,B.d_desc),Rt=function(gt){var Ft;for(S(gt,gt.dyn_ltree,gt.l_desc.max_code),S(gt,gt.dyn_dtree,gt.d_desc.max_code),ee(gt,gt.bl_desc),Ft=m-1;3<=Ft&&gt.bl_tree[2*H[Ft]+1]===0;Ft--);return gt.opt_len+=3*(Ft+1)+5+5+4,Ft}(B),it=B.opt_len+3+7>>>3,(_t=B.static_len+3+7>>>3)<=it&&(it=_t)):it=_t=dt+5,dt+4<=it&&tt!==-1?z(B,tt,dt,pt):B.strategy===4||_t===it?(G(B,2+(pt?1:0),3),Vt(B,X,O)):(G(B,4+(pt?1:0),3),function(gt,Ft,ye,Jt){var Qe;for(G(gt,Ft-257,5),G(gt,ye-1,5),G(gt,Jt-4,4),Qe=0;Qe<Jt;Qe++)G(gt,gt.bl_tree[2*H[Qe]+1],3);ft(gt,gt.dyn_ltree,Ft-1),ft(gt,gt.dyn_dtree,ye-1)}(B,B.l_desc.max_code+1,B.d_desc.max_code+1,Rt+1),Vt(B,B.dyn_ltree,B.dyn_dtree)),It(B),pt&&St(B)},i._tr_tally=function(B,tt,dt){return B.pending_buf[B.d_buf+2*B.last_lit]=tt>>>8&255,B.pending_buf[B.d_buf+2*B.last_lit+1]=255&tt,B.pending_buf[B.l_buf+B.last_lit]=255&dt,B.last_lit++,tt===0?B.dyn_ltree[2*dt]++:(B.matches++,tt--,B.dyn_ltree[2*(E[dt]+h+1)]++,B.dyn_dtree[2*P(tt)]++),B.last_lit===B.lit_bufsize-1},i._tr_align=function(B){G(B,2,3),rt(B,T,X),function(tt){tt.bi_valid===16?(st(tt,tt.bi_buf),tt.bi_buf=0,tt.bi_valid=0):8<=tt.bi_valid&&(tt.pending_buf[tt.pending++]=255&tt.bi_buf,tt.bi_buf>>=8,tt.bi_valid-=8)}(B)}},{"../utils/common":41}],53:[function(r,n,i){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,n,i){(function(s){(function(o,a){if(!o.setImmediate){var c,u,l,h,d=1,f={},m=!1,p=o.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(o);g=g&&g.setTimeout?g:o,c={}.toString.call(o.process)==="[object process]"?function(A){Mn.nextTick(function(){b(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,x=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=x,A}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",T,!1):o.attachEvent("onmessage",T),function(A){o.postMessage(h+A,"*")}):o.MessageChannel?((l=new MessageChannel).port1.onmessage=function(A){b(A.data)},function(A){l.port2.postMessage(A)}):p&&"onreadystatechange"in p.createElement("script")?(u=p.documentElement,function(A){var x=p.createElement("script");x.onreadystatechange=function(){b(A),x.onreadystatechange=null,u.removeChild(x),x=null},u.appendChild(x)}):function(A){setTimeout(b,0,A)},g.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var x=new Array(arguments.length-1),I=0;I<x.length;I++)x[I]=arguments[I+1];var R={callback:A,args:x};return f[d]=R,c(d),d++},g.clearImmediate=y}function y(A){delete f[A]}function b(A){if(m)setTimeout(b,0,A);else{var x=f[A];if(x){m=!0;try{(function(I){var R=I.callback,$=I.args;switch($.length){case 0:R();break;case 1:R($[0]);break;case 2:R($[0],$[1]);break;case 3:R($[0],$[1],$[2]);break;default:R.apply(a,$)}})(x)}finally{y(A),m=!1}}}}function T(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(h)===0&&b(+A.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof tr<"u"?tr:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Zx);var f7=Zx.exports,x0=ps(f7);const Qx={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/dicom":["dcm"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg","one","onea"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"application/zip+dotlottie":["lottie"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a","m4b"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/ief":["ief"],"image/jaii":["jaii"],"image/jais":["jais"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpg","jpeg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/pjpeg":["jfif"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step":["step","stp","stpnc","p21","210"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Qx);var Nn=function(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)},Qo,vc,Xs;class h7{constructor(...t){Qo.set(this,new Map),vc.set(this,new Map),Xs.set(this,new Map);for(const r of t)this.define(r)}define(t,r=!1){for(let[n,i]of Object.entries(t)){n=n.toLowerCase(),i=i.map(a=>a.toLowerCase()),Nn(this,Xs,"f").has(n)||Nn(this,Xs,"f").set(n,new Set);const s=Nn(this,Xs,"f").get(n);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Nn(this,vc,"f").set(n,a),o=!1,c)continue;const u=Nn(this,Qo,"f").get(a);if(u&&u!=n&&!r)throw new Error(`"${n} -> ${a}" conflicts with "${u} -> ${a}". Pass \`force=true\` to override this definition.`);Nn(this,Qo,"f").set(a,n)}}return this}getType(t){if(typeof t!="string")return null;const r=t.replace(/^.*[/\\]/s,"").toLowerCase(),n=r.replace(/^.*\./s,"").toLowerCase(),i=r.length<t.length;return!(n.length<r.length-1)&&i?null:Nn(this,Qo,"f").get(n)??null}getExtension(t){var r;return typeof t!="string"?null:(t=(r=t==null?void 0:t.split)==null?void 0:r.call(t,";")[0],(t&&Nn(this,vc,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:Nn(this,Xs,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of Nn(this,Xs,"f").values())Object.freeze(t);return this}_getTestState(){return{types:Nn(this,Qo,"f"),extensions:Nn(this,vc,"f")}}}Qo=new WeakMap,vc=new WeakMap,Xs=new WeakMap;var d7=new h7(Qx)._freeze();function p7(e,t){console.info(t)}const m7=/; \$(\w+) ?(.*)/,g7=/title (.+?) (.*)/i;function A0(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function y7(e,t){const r=Ox();if(!w(r))return;const n=t.split(/\r?\n/),i={title:"",gendate:"",gentime:"",songs:[]};function s(m){return i.songs.find(p=>p.order===m)}function o(m,p){return{order:m,title:p,lines:[]}}for(let m=0;m<n.length;++m){const p=n[m],g=m7.exec(p);if(w(g)){const y=g[1].toLowerCase(),b=g[2];switch(y){case"title":i.title=b;break;case"gendate":i.gendate=b;break;case"gentime":i.gentime=b;break;case"song":{const T=g7.exec(b);if(w(T)){const A=parseFloat(T[1]),x=T[2],I=s(A);w(I)?I.title=x:i.songs.push(o(A,x))}else{const A=parseFloat(b);if(Et(A)){const x=s(A);w(x)||i.songs.push(o(A,""))}}break}}}else{const y=i.songs[i.songs.length-1];w(y)&&p.trim().length&&y.lines.push(p)}}i.songs.sort((m,p)=>m.order-p.order);const a=i.songs.map(m=>m.title),c=`@play_${Dt(i.title).replace(/\W/g,"")}
@cycle 1
@char 14
#end

:touch
"ALBUM: ${A0(i.title)}"
"$purple  ${A0(i.gendate)}"
"$purple  ${A0(i.gentime)}"
${a.map((m,p)=>`!song_${p};${p+1} ${m||"untitled"}`).join(`
`)}
#end

${i.songs.map((m,p)=>`:song_${p}
${m.lines.map(g=>`#play ${g}`).join(`
`)}
#end
`).join(`
`)}
`,u=ku(c,{}),l=be(u);oc(r,u),Tc(lt,e,`imported zzt zzm file ${l} into ${r.name} book`);const h=be(u),d=gi(u);we(lt,e,`!pageopen ${u.id};$blue[${d}]$white ${h}`);const f=`#put n ${l}`;k$(lt,e,f,f,!1)}const sf=60,_7=sf*25;function b7(e,t){let r=0;const n=new DataView(t.buffer);function i(){const L=n.getUint8(r);return r++,L}function s(){const L=n.getInt16(r,!0);return r+=2,L}function o(){const L=n.getInt32(r,!0);return r+=4,L}function a(L){let j="";const U=t.subarray(r,r+L);for(let V=0;V<U.length;++V)j+=String.fromCharCode(U[V]);return r+=L,j.replace("\r",`
`)}function c(L,j,U,V){const Q=On(L,j,U);if(w(Q)&&w(V)){const K=Dr(V);for(let W=0;W<K.length;++W){const P=K[W];Q[P]=V[P]}}}function u(L){let j="";for(let U=0;U<L.length;++U){const V=L.charCodeAt(U);V<32||V>127?j+=`$${V}`:j+=L[U]}return j}function l(L){return L.replaceAll(/\r?\n|\r/g,`
`).split(`
`).map(j=>j.replace("$","$CENTER ")).map(u).join(`
`)}function h(L,j,U,V,Q){const K=V.color%16,W=Math.floor(V.color/16)%8,P=Aa(K,W),st=Aa((W+8)%16,K),G={},rt=Q.find(wt=>wt.x===j&&wt.y===U);switch(w(rt)&&(Et(rt.cycle)&&rt.cycle>0&&(G.cycle=rt.cycle),w(rt.p1)&&(G.p1=rt.p1),w(rt.p2)&&(G.p2=rt.p2),w(rt.p3)&&(G.p3=rt.p3),w(rt.code)&&rt.code&&(G.code=l(rt.code)),w(rt.stepx)&&(G.stepx=rt.stepx),w(rt.stepy)&&(G.stepy=rt.stepy)),V.element){case 0:case 1:case 2:case 3:break;case 4:break;case 5:c(L,["ammo",P],{x:j,y:U},G);break;case 6:c(L,["torch",P],{x:j,y:U},G);break;case 7:c(L,["gem",P],{x:j,y:U},G);break;case 8:c(L,["key",P],{x:j,y:U},G);break;case 9:c(L,["door",st],{x:j,y:U},G);break;case 10:c(L,["scroll",P],{x:j,y:U},G);break;case 11:{G.p3=d(rt==null?void 0:rt.p3)??"",c(L,["passage",P],{x:j,y:U},G);break}case 12:c(L,["duplicator",P],{x:j,y:U},{...G,stepx:0,stepy:0,shootx:G.stepx??0,shooty:G.stepy??0});break;case 13:c(L,["bomb",P],{x:j,y:U},G);break;case 14:c(L,["energize",P],{x:j,y:U},G);break;case 15:c(L,["star",P],{x:j,y:U},G);break;case 16:c(L,["clockwise",P],{x:j,y:U},G);break;case 17:c(L,["counter",P],{x:j,y:U},G);break;case 18:c(L,["bullet",P],{x:j,y:U},G);break;case 19:c(L,["water",P],{x:j,y:U},G);break;case 20:c(L,["forest",P],{x:j,y:U},G);break;case 21:c(L,["solid",P],{x:j,y:U},G);break;case 22:c(L,["normal",P],{x:j,y:U},G);break;case 23:c(L,["breakable",P],{x:j,y:U},G);break;case 24:c(L,["boulder",P],{x:j,y:U},G);break;case 25:c(L,["sliderns",P],{x:j,y:U},G);break;case 26:c(L,["sliderew",P],{x:j,y:U},G);break;case 27:c(L,["fake",P],{x:j,y:U},G);break;case 28:c(L,["invisible",P],{x:j,y:U},G);break;case 29:c(L,["blinkwall",P],{x:j,y:U},{...G,stepx:0,stepy:0,shootx:G.stepx??0,shooty:G.stepy??0});break;case 30:c(L,["transporter",P],{x:j,y:U},{...G,stepx:0,stepy:0,shootx:G.stepx??0,shooty:G.stepy??0});break;case 31:c(L,["line",P],{x:j,y:U},G);break;case 32:c(L,["ricochet",P],{x:j,y:U},G);break;case 33:c(L,["blinkns",P],{x:j,y:U},G);break;case 34:c(L,["bear",P],{x:j,y:U},G);break;case 35:c(L,["ruffian",P],{x:j,y:U},G);break;case 36:c(L,["object",P],{x:j,y:U},{...G,char:(rt==null?void 0:rt.p1)??1});break;case 37:c(L,["slime",P],{x:j,y:U},G);break;case 38:c(L,["shark",P],{x:j,y:U},G);break;case 39:c(L,["spinninggun",P],{x:j,y:U},G);break;case 40:c(L,["pusher",P],{x:j,y:U},G);break;case 41:c(L,["lion",P],{x:j,y:U},G);break;case 42:c(L,["tiger",P],{x:j,y:U},G);break;case 43:c(L,["blinkns",P],{x:j,y:U},G);break;case 44:c(L,["head",P],{x:j,y:U},G);break;case 45:c(L,["segment",P],{x:j,y:U},G);break;case 46:break;case 47:c(L,["text",["WHITE","ONDKBLUE"]],{x:j,y:U},{...G,char:V.color});break;case 48:c(L,["text",["WHITE","ONDKGREEN"]],{x:j,y:U},{...G,char:V.color});break;case 49:c(L,["text",["WHITE","ONDKCYAN"]],{x:j,y:U},{...G,char:V.color});break;case 50:c(L,["text",["WHITE","ONDKRED"]],{x:j,y:U},{...G,char:V.color});break;case 51:c(L,["text",["WHITE","ONDKPURPLE"]],{x:j,y:U},{...G,char:V.color});break;case 52:c(L,["text",["WHITE","ONDKYELLOW"]],{x:j,y:U},{...G,char:V.color});break;case 53:c(L,["text",["WHITE","ONBLACK"]],{x:j,y:U},{...G,char:V.color});break}}function d(L){if(Et(L)&&L>0)return`zztboard${L}`}if(s()!=-1)return;const m=s(),p=s(),g=s(),y=a(7),b=s(),T=s(),A=s(),x=s(),I=s();s();const R=s(),$=i(),M=a(20).slice(0,$);for(let L=0;L<9;L++){const j=i();a(20).slice(0,j)}const H=s(),X=s(),O=i();console.info(p,g,y,b,T,A,x,I,R,H,X,O),r=512;const N=[];for(let L=0;L<m;++L){const j=s(),U=r,V=i(),K={boardname:a(50).slice(0,V),elements:[],stats:[]};for(;K.elements.length<_7;){let P=i();P===0&&(P=255);const st=i(),G=i();for(let rt=0;rt<P;++rt)K.elements.push({element:st,color:G})}K.maxplayershots=i(),K.isdark=i(),K.exitnorth=i(),K.exitsouth=i(),K.exitwest=i(),K.exiteast=i(),K.restartonzap=i(),K.messagelength=i(),K.message=a(58).slice(0,K.messagelength),K.playerenterx=i(),K.playerentery=i(),K.timelimit=s(),r+=16;const W=s()+1;for(;K.stats.length<W;){const P={};P.x=i()-1,P.y=i()-1,P.stepx=s(),P.stepy=s(),P.cycle=s(),P.p1=i(),P.p2=i(),P.p3=i(),P.follower=s(),P.leader=s(),P.underelement=i(),P.undercolor=i(),P.pointer=o(),P.currentinstruction=s();const st=s();r+=8,st<0?P.bind=Math.abs(st):P.code=a(st),K.stats.push(P)}N.push(K),r=U+j}const E=bp([]);E.name=M;for(let L=0;L<N.length;++L){const j=N[L],U=[`@zztboard${L}`,""];L===0?U.push("@title"):L===T&&U.push("@zztstartboard");for(let Tt=0;Tt<j.elements.length;++Tt)j.elements[Tt].element===4&&(U.push(`@startx ${ty(Tt,sf)}`),U.push(`@starty ${ey(Tt,sf)}`));Et(j.maxplayershots)&&U.push(`@maxplayershots ${j.maxplayershots}`),Et(j.isdark)&&U.push(`@isdark ${j.isdark}`),Et(j.restartonzap)&&U.push(`@restartonzap ${j.restartonzap}`),Et(j.timelimit)&&U.push(`@timelimit ${j.timelimit}`);const V=d(j.exitnorth);yt(V)&&U.push(`@exitnorth ${V}`);const Q=d(j.exitsouth);yt(Q)&&U.push(`@exitsouth ${Q}`);const K=d(j.exitwest);yt(K)&&U.push(`@exitwest ${K}`);const W=d(j.exiteast);yt(W)&&U.push(`@exiteast ${W}`);const P=`@board ${String(L).padStart(3,"0")}. ${j.boardname}
${U.join(`
`)}`,st=ku(P,{});oc(E,st);const G=Ce(st);if(!w(G))continue;let rt=0,wt=0;for(let Tt=0;Tt<j.elements.length;++Tt){const It=j.elements[Tt];h(G,rt,wt,It,j.stats),++rt,rt===sf&&(rt=0,++wt)}gr(G)}Vu(E),Tc(lt,e,`imported zzt file into ${E.name} book`)}function w7(e,t){const r=Ox();if(!w(r))return;const n=ku(t,{}),i=be(n);oc(r,n),Tc(lt,e,`imported zzt obj file ${i} into ${r.name} book`)}function tA(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return d7.getType(e)??"application/octet-stream"}function eA(e,t){if(!w(t))return"";switch(e){case"model/obj":return"obj";case"text/plain":return"txt";case"application/json":return"json";case"application/zip":return"zip";case"application/octet-stream":if(/.zzt$/i.test(t.name))return"zzt";if(/.brd$/i.test(t.name))return"brd";if(/.zzl$/i.test(t.name))return"zzl";if(/.zzm$/i.test(t.name))return"zzm";break}return""}let ta=[],of={};async function v7(e,t){try{Re(lt,e,"parsezipfile",t.name);const r=await t.arrayBuffer(),i=await new x0().loadAsync(r);ta=[],of={};const s=[];i.forEach((o,a)=>s.push([o,a]));for(let o=0;o<s.length;++o){const[a,c]=s[o],u=await c.async("uint8array"),l=tA(a,u),h=new File([u],c.name,{type:l});ta.push(h)}KT(lt,e)}catch(r){_e(lt,e,"crash",r.message)}}function E7(){const e=[];for(let t=0;t<ta.length;++t){const r=ta[t];e.push([eA(r.type,r),r.name])}return e}function k7(e,t){of[e.toLowerCase()]=t}function x7(e){return of[e.toLowerCase()]}async function A7(e){for(let t=0;t<ta.length;++t){const r=ta[t];of[r.name.toLowerCase()]&&(T0(e,r),await Oc(2e3))}await Oc(2e3),Af(lt,e)}function rA(e,t,r){if(!w(r))return;switch(eA(t,r)){case"obj":r.text().then(i=>w7(e,i)).catch(i=>_e(lt,e,"crash",i.message));break;case"txt":r.text().then(i=>Tf(lt,e,void 0,"text",`file:${r.name}`,i)).catch(i=>_e(lt,e,"crash",i.message));break;case"json":r.text().then(i=>Tf(lt,e,void 0,"json",`file:${r.name}`,i)).catch(i=>_e(lt,e,"crash",i.message));break;case"zip":v7(e,r).catch(i=>_e(lt,e,"crash",i.message));break;case"zzt":r.arrayBuffer().then(i=>{b7(e,new Uint8Array(i))}).catch(i=>_e(lt,e,"crash",i.message));break;case"brd":r.arrayBuffer().then(i=>{}).catch(i=>_e(lt,e,"crash",i.message));break;case"zzl":r.text().then(i=>{p7(e,i)}).catch(i=>_e(lt,e,"crash",i.message));break;case"zzm":r.text().then(i=>{y7(e,i)}).catch(i=>_e(lt,e,"crash",i.message));break;default:t||r.arrayBuffer().then(i=>{const s=tA(r.name,new Uint8Array(i));if(s)rA(e,s,r);else return _e(lt,e,"parsewebfile",`unsupported file ${r.name}`)}).catch(i=>_e(lt,e,"crash",i.message));return}}function T0(e,t){rA(e,(t==null?void 0:t.type)??"",t)}const af="https://bridge.zed.cafe";async function T7(e,t,r){const n=`offset=${r}&${e}=${t}`,i=new Request(`${af}/api/v1/search/files/?${n}`);return(await(await fetch(i)).json()).data.results}async function S7(){const e=new Request(`${af}/api/v1/get/random-file/`);return[(await(await fetch(e)).json()).data]}function R7(e){return`${af}/static/${e}`}async function O7(e,t){const n=await(await fetch(`${af}/zgames/${t}`)).arrayBuffer(),i=new File([n],t);T0(e,i)}function en(e,t,r){r().catch(n=>{console.error(n),_e(e,t,"crash",n==null?void 0:n.message)})}function I7(e){const[t,r]=e.split(":"),n=w(r);return[n?t:"self",n?r:e]}function N7(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r="=".repeat((4-t.length%4)%4);return t+r}function C7(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const L7=new Date("1980/09/02");async function S0(e){return console.info("saved",e),new Promise((t,r)=>{const n=new x0;for(let i=0;i<e.length;++i){const s=e[i],o=kF(s);if(o){const a=FC(o);w(a)&&n.file(s.id,a,{date:L7})}}n.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(C7(i))}).catch(r)})}async function M7(e){return new Promise((t,r)=>{const n=new x0,i=N7(e);n.loadAsync(i,{base64:!0}).then(async()=>{const s=[],o=[];n.forEach((a,c)=>o.push(c));for(let a=0;a<o.length;++a){const c=o[a],u=await c.async("uint8array"),l=L_(u);if(w(l)){const h=HE(l);w(h)&&s.push(h)}else{const h=await c.async("string"),d=L_(h);if(w(d)){const f=HE(d);w(f)&&s.push(f)}}}t(s)}).catch(r)})}function U7(e,t,r,n){const i=qe(e);if(!w(i))return;let s=0;function o(){return s}function a(u,l){Et(l)&&(s=l,ry(t.x,t.y,r.x,r.y).forEach(h=>{const d=oe(i,h);w(d)&&(d[u]=l)}))}Nt(e,`batch chars: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Je),$t(e,`batch:${bo(t,r)}`,"char",[n,"charedit"],o,a);const c=Ue(e);c.scrollname="bulk set char",c.scroll=cr(e)}function P7(e,t,r,n){const i=qe(e);if(!w(i))return;let s=0;function o(){return s}function a(u,l){if(Et(l)){s=l;for(let h=t.y;h<=r.y;++h)for(let d=t.x;d<=r.x;++d){const f=oe(i,{x:d,y:h});w(f)&&(f[u]=l)}}}Nt(e,`batch chars: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Je),$t(e,`batch:${bo(t,r)}`,"color",[n,"coloredit"],o,a);const c=Ue(e);c.scrollname="bulk set color",c.scroll=cr(e)}function F7(e,t,r,n){const i=qe(e);if(!w(i))return;let s=0;function o(){return s}function a(u,l){Et(l)&&(s=l,ry(t.x,t.y,r.x,r.y).forEach(h=>{const d=oe(i,h);w(d)&&(d[u]=l)}))}Nt(e,`batch chars: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Je),$t(e,`batch:${bo(t,r)}`,"color",[n,"coloredit"],o,a);const c=Ue(e);c.scrollname="bulk set bg",c.scroll=cr(e)}function $7(e,t,r,n){const i=_r(Xt.MAIN);if(!w(i))return;const s=qe(e);if(!w(s))return;const o=bo(t,r);Nt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Je),$t(e,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),$t(e,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),n&&$t(e,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),$t(e,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]),$t(e,"remix","remix coords",[`remix:${o}`,"hk","r"," R ","next"]),Nt(e,Je),$t(e,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),$t(e,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),$t(e,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),Nt(e,Je),$t(e,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),Nt(e,Je),Nt(e,"codepages:");const a=Math.min(t.x,r.x),c=Math.min(t.y,r.y),u=Math.max(t.x,r.x),l=Math.max(t.y,r.y),h=new Set;for(let f=c;f<=l;++f)for(let m=a;m<=u;++m){const p=oe(s,{x:m,y:f}),g=YE(i,p);w(g)&&!h.has(g.id)&&(h.add(g.id),$t(e,"batch",`edit @${be(g)}`,[`pageopen:${g.id}`]))}const d=tn(vt.BOARD,s.id);Nt(e,be(d)),$t(e,"batch",`id ${s.id}`,["","copyit",s.id]),$t(e,"batch","edit @board codepage",[`pageopen:${s.id}`])}function R0(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function B7(e,t){let r;const n=()=>{if(r)return r;const i=indexedDB.open(e);return i.onupgradeneeded=()=>i.result.createObjectStore(t),r=R0(i),r.then(s=>{s.onclose=()=>r=void 0},()=>{}),r};return(i,s)=>n().then(o=>s(o.transaction(t,i).objectStore(t)))}let O0;function nA(){return O0||(O0=B7("keyval-store","keyval")),O0}function iA(e,t=nA()){return t("readonly",r=>R0(r.get(e)))}function sA(e,t,r=nA()){return r("readwrite",n=>new Promise((i,s)=>{n.get(e).onsuccess=function(){try{n.put(t(this.result),e),i(R0(n.transaction))}catch(o){s(o)}}}))}function I0(e,t){return`${e.x},${e.y},${t.x},${t.y}`}async function oA(){return iA("secretheap")}async function aA(e){return sA("secretheap",e)}async function D7(){return!!await oA()}function cA(e,t,r){const n=Math.min(t.x,r.x),i=Math.min(t.y,r.y),s=Math.max(t.x,r.x),o=Math.max(t.y,r.y),a=s-n+1,c=o-i+1,u=[],l=[];for(let h=i;h<=o;++h)for(let d=n;d<=s;++d){const f={x:d-n,y:h-i},m=oe(e,{x:d,y:h});(m==null?void 0:m.category)===jr.ISOBJECT?(u.push(Ln(us(e,d,h))),mr(m).name!=="player"&&l.push({...Ln(m),...f,id:"blank"})):u.push({...Ln(m),...f})}return{board:e.id,width:a,height:c,terrain:u,objects:l}}async function j7(e,t,r,n){const i=qe(e);if(!w(i))return;const s=cA(i,t,r);switch(n){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await aA(()=>s)}function z7(e,t,r){const n=I0(t,r);Nt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Je),$t(e,"batch","copy terrain & objects",[`copyall:${n}`,"hk","1"]),$t(e,"batch","copy objects",[`copyobjects:${n}`,"hk","2"]),$t(e,"batch","copy terrain",[`copyterrain:${n}`,"hk","3"]);const i=Ue(e);i.scrollname="copy",i.scroll=cr(e)}async function W7(e,t,r,n){const i=_r(Xt.MAIN);if(!w(i))return;const s=qe(e);if(!w(s))return;const o=cA(s,t,r);switch(n){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(n){case"cutall":{for(let a=t.y;a<=r.y;++a)for(let c=t.x;c<=r.x;++c){const u=oe(s,{x:c,y:a});(u==null?void 0:u.category)===jr.ISOBJECT&&wr(s,u,i.timestamp),Me(s,{x:c,y:a})}break}case"cutobjects":{for(let a=t.y;a<=r.y;++a)for(let c=t.x;c<=r.x;++c){const u=oe(s,{x:c,y:a});(u==null?void 0:u.category)===jr.ISOBJECT&&wr(s,u,i.timestamp)}break}case"cutterrain":{for(let a=t.y;a<=r.y;++a)for(let c=t.x;c<=r.x;++c)Me(s,{x:c,y:a});break}}await aA(()=>o)}function H7(e,t,r){const n=I0(t,r);Nt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Je),$t(e,"batch","cut terrain & objects",[`cutall:${n}`,"hk","1"]),$t(e,"batch","cut objects",[`cutobjects:${n}`,"hk","2"]),$t(e,"batch","cut terrain",[`cutterrain:${n}`,"hk","3"]);const i=Ue(e);i.scrollname="cut",i.scroll=cr(e)}async function G7(e,t,r,n){const i=qe(e),s=await oA();if(!w(i)||!w(s))return;const o=Math.min(t.x,r.x),a=Math.min(t.y,r.y),c=Math.max(t.x,r.x),u=Math.max(t.y,r.y),l=c-o+1,h=u-a+1,d=Math.min(s.width,l),f=Math.min(s.height,h);switch(n){case"pasteall":{for(let m=0;m<f;++m)for(let p=0;p<d;++p){const g=Wr({x:p,y:m},s.width);Me(i,{...s.terrain[g],x:o+p,y:a+m})}for(let m=0;m<s.objects.length;++m){const p=s.objects[m];w(p.x)&&w(p.y)&&kh(p.x,p.y,0,l-1,h-1,0)&&b0(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break}case"pasteobjects":for(let m=0;m<s.objects.length;++m){const p=s.objects[m];w(p.x)&&w(p.y)&&kh(p.x,p.y,0,l-1,h-1,0)&&b0(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break;case"pasteterrain":for(let m=0;m<f;++m)for(let p=0;p<d;++p){const g=Wr({x:p,y:m},s.width);Me(i,{...s.terrain[g],x:o+p,y:a+m})}break;case"pasteterraintiled":for(let m=a;m<=u;++m)for(let p=o;p<=c;++p){const g=(p-o)%s.width,y=(m-a)%s.height,b=Wr({x:g,y},s.width);Me(i,{...s.terrain[b],x:p,y:m})}break}}function K7(e,t,r){const n=I0(t,r);Nt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Je),$t(e,"batch","paste terrain & objects",[`pasteall:${n}`,"hk","1"]),$t(e,"batch","paste objects",[`pasteobjects:${n}`,"hk","2"]),$t(e,"batch","paste terrain",[`pasteterrain:${n}`,"hk","3"]),$t(e,"batch","paste terrain tiled",[`pasteterraintiled:${n}`,"hk","4"]);const i=Ue(e);i.scrollname="paste",i.scroll=cr(e)}function N0(e,t){return`inspect:${t!=null&&t.id?t.id:ji(e,t)}`}function Y7(e,t,r){const n=_r(Xt.MAIN);if(!w(n))return;const i=qe(e);if(!w(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,f){w(t)&&(t[d]=f)}const a=t.category===jr.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=N0(i,t);Nt(e,`${a}: ${c} ${u}`),Nt(e,Je),$t(e,l,"color",[r,"coloredit"],s,o);const h=Ue(e);h.scrollname="color",h.scroll=cr(e)}function q7(e,t,r){const n=_r(Xt.MAIN);if(!w(n))return;const i=qe(e);if(!w(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,f){w(t)&&(t[d]=f)}const a=t.category===jr.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=N0(i,t);Nt(e,`${a}: ${c} ${u}`),Nt(e,Je),$t(e,l,"char",[r,"charedit"],s,o);const h=Ue(e);h.scrollname="char",h.scroll=cr(e)}function V7(e,t,r,n,i,s){var m,p,g;const o=_r(Xt.MAIN);if(!w(o))return;function a(y){var T;const b=(n==null?void 0:n[y])??((T=n==null?void 0:n.kinddata)==null?void 0:T[y]);if(!w(b))switch(y){case"color":return 15;case"bg":return 0;case"cycle":return om;case"collision":return Ht.ISWALK;case"pushable":return 0;case"breakable":return 0}return b}function c(y,b){w(n)&&(n[y]=b)}s?Nt(e,`object: ${n.name??n.kind??"ERR"} ${i.x}, ${i.y}`):Nt(e,`terrain: ${n.kind??"ERR"} ${i.x}, ${i.y}`);const u=N0(t,n);switch(s&&Nt(e,`cycle: ${Yt(n,"cycle")}`),Yt(n,"collision")){case Ht.ISWALK:Nt(e,"collision: iswalk");break;case Ht.ISSWIM:Nt(e,"collision: isswim");break;case Ht.ISSOLID:Nt(e,"collision: issolid");break;case Ht.ISBULLET:Nt(e,"collision: isbullet");break;case Ht.ISGHOST:Nt(e,"collision: isghost");break}if(s){const y=Yt(n,"pushable");Nt(e,`ispushable: ${y||"no"}`)}Nt(e,`isbreakable: ${Yt(n,"breakable")?"yes":"no"}`),Nt(e,Je);const h=ic(r),d=Dr(h);for(let y=0;y<d.length;++y){const b=d[y];switch(b){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(pe(h[b])){const[T,A,...x]=h[b];yt(A)&&$t(e,u,A||b,[b,T,...x],a,c)}break}}$t(e,u,"copy coords",["copycoords","hk","5"," 5 "]),Nt(e,Je),$t(e,u,`char: ${n.char??((m=n.kinddata)==null?void 0:m.char)??1}`,["char","hk","a"," A ","next"],a,c),$t(e,u,`color: ${n.color??((p=n.kinddata)==null?void 0:p.color)??15}`,["color","hk","c"," C ","next"],a,c),$t(e,u,`bg: ${n.bg??((g=n.kinddata)==null?void 0:g.bg)??0}`,["bg","hk","b"," B ","next"],a,c),Nt(e,Je),$t(e,u,"make empty",["empty","hk","0"],a,c),Nt(e,Je),$t(e,"batch",`edit @${be(r)}`,[`pageopen:${r.id}`]);const f=tn(vt.BOARD,t.id);Nt(e,be(f)),$t(e,"batch",`id ${t.id}`,["","copyit",t.id]),$t(e,"batch","edit @board codepage",[`pageopen:${t.id}`])}function X7(e,t,r,n){const i=_r(Xt.MAIN);if(!w(i))return;const s=qe(e);if(w(s))switch(n){case"emptyall":{for(let o=t.y;o<=r.y;++o)for(let a=t.x;a<=r.x;++a){const c=oe(s,{x:a,y:o});(c==null?void 0:c.category)===jr.ISOBJECT&&wr(s,c,i.timestamp),Me(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=r.y;++o)for(let a=t.x;a<=r.x;++a){const c=oe(s,{x:a,y:o});(c==null?void 0:c.category)===jr.ISOBJECT&&wr(s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=r.y;++o)for(let a=t.x;a<=r.x;++a)Me(s,{x:a,y:o});break}}}function J7(e,t,r){const n=_r(Xt.MAIN);if(!w(n))return;const i=qe(e);if(!w(i))return;const s=bo(t,r);Nt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Je),$t(e,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),$t(e,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),$t(e,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=Ue(e);o.scrollname="empty",o.scroll=cr(e)}async function Z7(e,t,r){const n=_r(Xt.MAIN),i=await D7();if(!w(n))return;const s=qe(e);if(!w(s))return;if(gr(s),t.x===r.x&&t.y===r.y){const a=oe(s,t),c=YE(n,a);if(w(a)&&w(c)&&V7(e,s,c,a,t,De(a)),!(a!=null&&a.kind)){Nt(e,`empty: ${t.x}, ${t.y}`),Nt(e,Je),$t(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]);const u=tn(vt.BOARD,s.id);Nt(e,be(u)),$t(e,"batch",`id ${s.id}`,["","copyit",s.id]),$t(e,"batch","edit @board codepage",[`pageopen:${s.id}`])}}else $7(e,t,r,i);const o=Ue(e);o.scrollname="inspect",o.scroll=cr(e)}function Q7(e,t){const r=ge(Xt.MAIN);if(!w(r))return;const n=qe(t);if(!w(n))return;const i=zr(e),s=Hx(n,i.target);if(w(s))switch(i.path){case"copycoords":kf(lt,$r(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":Y7(t,s,i.path);break;case"char":q7(t,s,i.path);break;case"empty":wr(n,s,r.timestamp);break;case"code":en(lt,t,async()=>{const o=mr(s),a="object";Re(lt,t,`opened [${a}] ${o.name}`);const c=[n.id,s.id];Eh(Sc(r.id,c),s.code??""),ET(lt,t),await Oc(800),nm(lt,t,r.id,c,a,`${name} - ${r.name}`)});break;default:console.info("unknown inspect",i);break}}async function tW(e,t){const r=qe(t);if(!w(r))return;const n=zr(e),[i,s,o,a]=n.path.split(",").map(l=>parseFloat(l)),c={x:Math.min(i,o),y:Math.min(s,a)},u={x:Math.max(i,o),y:Math.max(s,a)};switch(n.target){case"copy":z7(t,c,u);break;case"copyall":case"copyobjects":case"copyterrain":await j7(t,c,u,n.target);break;case"cut":H7(t,c,u);break;case"cutall":case"cutobjects":case"cutterrain":await W7(t,c,u,n.target);break;case"paste":K7(t,c,u);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await G7(t,c,u,n.target);break;case"empty":J7(t,c,u);break;case"emptyall":case"emptyobjects":case"emptyterrain":X7(t,c,u,n.target);break;case"chars":U7(t,c,u,"char");break;case"colors":P7(t,c,u,"color");break;case"bgs":F7(t,c,u,"bg");break;case"copycoords":kf(lt,t,[i,s,o,a].join(" "));break;case"pageopen":en(lt,t,async()=>{await Oc(800),YT(lt,t,`#pageopen ${n.path}`)});break;default:console.info("unknown batch",n);break}}async function eW(){return iA("remixconfig")}async function rW(e){return sA("remixconfig",e)}let fs={stat:"",patternsize:2,mirror:1};async function nW(e,t){const r=qe(t);if(!w(r))return;const n=zr(e),[i,s,o,a]=n.path.split(",").map(l=>parseFloat(l)),c={x:Math.min(i,o),y:Math.min(s,a)},u={x:Math.max(i,o),y:Math.max(s,a)};switch(n.target){case"remix":{await iW(t,c,u);break}case"remixrun":{const l=br(fs.stat);w(l)&&$k(r.id,l.id,fs.patternsize,fs.mirror,c,u,"all"),await rW(()=>fs);break}default:console.info("unknown remix",n);break}}async function iW(e,t,r){const n=await eW();fs={...fs,...n};const i=bo(t,r);Nt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Je);function s(c){const{target:u}=zr(c);return fs[u]}function o(c,u){if(Et(u)||yt(u)){const{target:l}=zr(c);fs[l]=u}}$t(e,"remix","source board",[`stat:${i}`,"text"],s,o),$t(e,"remix","patternsize",[`patternsize:${i}`,"number","1","5"],s,o),$t(e,"remix","mirror",[`mirror:${i}`,"number","1","8"],s,o),Nt(e,Je),$t(e,"remix","run",[`remixrun:${i}`,"hk","r"," R "]);const a=Ue(e);a.scrollname="remix",a.scroll=cr(e)}const sW=16,hs={},cf={},oW=60;let lA=0;const ea={},ra={};async function uA(e){const t=Sn(),r=ge(Xt.MAIN);if(t.length&&w(r)){const n=await S0(t),i=`${e?"autosave ":""}${new Date().toISOString()} ${r.name} ${n.length} chars`;AT(te,$r(),i,n)}}async function aW(){const e=Sn(),t=ge(Xt.MAIN);if(e.length&&w(t)){const r=await S0(e);TT(te,$r(),r)}}async function cW(){const e=Sn(),t=ge(Xt.MAIN);return e.length&&w(t)?S0(e):""}const fA="$176$176$177$177$178 ZZT BRIDGE $178$177$177$176$176";function hA(e){Nt(e,`Searching ${"$6".repeat(_n(1,6))}`);const t=Ue(e);t.scrollname=fA,t.scroll=cr(e)}function dA(e,t){for(let n=0;n<e.length;++n){const i=e[n],s=`pub: ${new Date(i.publish_date).toLocaleDateString()}`;Nt(t,`$white${i.title}`),Nt(t,`$yellow  ${i.author.join(", ")}`),Nt(t,`$dkgreen  ${i.genres.join(", ")}`),Nt(t,`$purple  ${s}`),i.screenshot&&$t(t,"zztbridge",i.screenshot,["screenshot","viewit",R7(i.screenshot)]),$t(t,"zztbridge",i.filename,["zztimport","hyperlink",`${i.letter}/${i.filename}`]),Nt(t," ")}const r=Ue(t);r.scrollname=fA,r.scroll=cr(t)}const lf={},te=Zs("vm",["tick","second"],e=>{var r;if(!te.session(e))return;const t=$r();switch(e.target){case"operator":Nz(e.player),Re(te,e.player,`operator set to ${e.player}`),te.replynext(e,"ackoperator",!0);break;case"zsswords":{const n=ge(Xt.MAIN);te.replynext(e,"ackzsswords",{cli:Wp(ss.CLI),loader:Wp(ss.LOADER),runtime:Wp(ss.RUNTIME),flags:[...Dr(In(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["currenttick","boardid","isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","playerid","playerx","playery","thisid","thisx","thisy","senderid","senderx","sendery","item","group","party","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isghost","isbreakable","notbreakable","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"],kinds:[...js(n,vt.OBJECT).map(i=>be(i)),...Dr(jp)],altkinds:[...js(n,vt.TERRAIN),...js(n,vt.BOARD),...js(n,vt.PALETTE),...js(n,vt.CHARSET),...js(n,vt.LOADER)].map(i=>be(i)),colors:[...Dr(ka)],dirs:[...Dr(Ih).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...Dr(Bp)],exprs:["aligned","alligned","contact","blocked","any","countof","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":e.player===t&&en(te,e.player,async()=>{if(pe(e.data)){const[n,i]=e.data,s=await M7(n),o=s.map(a=>a.name);$z(s,i),Re(te,e.player,`loading ${o.join(", ")}`),Ef(te,e.player)}});break;case"search":jz(e.player)||Ef(te,e.player);break;case"logout":Dz(e.player),delete hs[e.player],Re(te,t,`player ${e.player} logout`),Ef(te,e.player);break;case"login":Mx(e.player)?(kT(te,e.player),hs[e.player]=0,Re(te,$r(),`login from ${e.player}`),te.replynext(e,"acklogin",!0)):Q0(te,e.player);break;case"local":Mx(e.player)?(hs[e.player]=0,Re(te,$r(),`login from ${e.player}`)):Q0(te,e.player);break;case"doot":hs[e.player]=0,cf[e.player]=cf[e.player]??0,cf[e.player]%32===0&&Re(te,e.player,`$whiteactive $blue${e.player}`),++cf[e.player];break;case"input":{if(e.player.includes("local")&&!Cx(e.player)&&GT(te,e.player),!e.player.includes("local")||Cx(e.player)){const n=In(e.player),[i=Lr.NONE,s=0]=e.data??[Lr.NONE,0];pe(n.inputqueue)||(n.inputqueue=[]),i!==Lr.NONE&&n.inputqueue.push([i,s])}break}case"codewatch":if(pe(e.data)){const[n,i]=e.data,s=Sc(n,i);w(ra[s])||(ra[s]=Zg(s,o=>{const[a,c]=i,u=Kn(n),l=Ds(u,a);if(w(l))if(mi(l)===vt.BOARD&&w(c)){const h=Ce(l),d=Nr(h,c);w(d)&&(d.code=o,Au(_p(o),d))}else l.code=o,wF(l)})),ea[s]=ea[s]??new Set,ea[s].add(e.player)}break;case"coderelease":if(pe(e.data)){const[n,i]=e.data,[,s]=i,o=Sc(n,i);w(ea[o])&&(ea[o].delete(e.player),ea[o].size===0&&((r=ra[o])==null||r.call(ra),ra[o]=void 0,yt(s)&&Gz(s)))}break;case"halt":e.player===t&&sT(e.data)&&Cz(e.data);break;case"tick":{Yz(Lz());const n=Dr(lf);for(let i=0;i<n.length;++i){const s=n[i];--lf[s]}break}case"synthsend":if(yt(e.data)){const n=e.data,[i,s]=I7(n),o=lf[n];if(!w(o)||o<=0){lf[n]=2;const a=ge(Xt.MAIN);Jo(i,s,void 0,Do(a))}}break;case"second":{zz(hs);const n=Object.keys(hs);for(let i=0;i<n.length;++i)++hs[n[i]];for(let i=0;i<n.length;++i){const s=n[i];hs[s]>=sW&&Af(te,s)}++lA>=oW&&(lA=0,en(te,e.player,async()=>{await uA(!0)}));break}case"copyjsonfile":if(e.player===t){const n=ge(Xt.MAIN);if(w(n)&&pe(e.data)){const[i]=e.data,s=Ds(n,i);w(s)&&RT(te,t,s,`${be(s)}.${gi(s)}.json`)}}break;case"refscroll":{$t(e.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),$t(e.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]),$t(e.player,"refscroll","notes:",["notesscroll","hk","n"," N ","next"]);const n=Ue(e.player);n.scrollname="refscroll",n.scroll=cr(e.player);break}case"readzipfilelist":{const n=E7();Nt(e.player,"$CENTER Select Files"),$t(e.player,"zipfilelist","import selected",["importfiles"]);for(let s=0;s<n.length;++s){const[o,a]=n[s];$t(e.player,"zipfilelist",`[${o}] ${a}`,[Dt(a),"select","NO","0","YES","1"],c=>x7(c)?1:0,(c,u)=>{k7(c,!!u)})}const i=Ue(e.player);i.scrollname="zipfilelist",i.scroll=cr(e.player);break}case"fork":e.player===t&&en(te,e.player,async()=>{await aW()});break;case"zztsearch":en(te,e.player,async()=>{if(pe(e.data)){const[n,i]=e.data;let s=0;const o=[];for(;o.length<256;){hA(e.player);const a=await T7(n,i,s);if(s+=a.length,o.push(...a),a.length<25)break}dA(o,e.player)}});break;case"zztrandom":en(te,e.player,async()=>{hA(e.player);const n=await S7();dA(n,e.player)});break;case"itchiopublish":en(te,e.player,async()=>{if(e.player===t){const n=ge(Xt.MAIN);if(w(n)){const i=await cW();ST(te,e.player,n.name,i)}}});break;case"flush":e.player===t&&en(te,e.player,async()=>{await uA()});break;case"cli":Fx(e.player,e.data);break;case"clirepeatlast":qz(e.player);break;case"restart":e.player===t&&(Kz(),sm(te,e.player));break;case"inspect":en(te,e.player,async()=>{if(pe(e.data)){const[n,i]=e.data;await Z7(e.player,n,i)}});break;case"loader":if(pe(e.data)){const[n,i,s,o]=e.data;switch(i){case"file":T0(e.player,o);break;case"json":if(/file:.*\.book.json/.test(s)){Re(te,e.player,`loading ${s}`);const a=JSON.parse(o.json);w(a.data)&&yt(a.exported)&&(Vu(a.data),Re(te,e.player,`loaded ${a.exported}`))}else if(/file:.*\..*\.codepage.json/.test(s)){Re(te,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=ge(Xt.MAIN);w(c)&&w(a.data)&&yt(a.exported)&&(oc(c,a.data),Re(te,e.player,`loaded ${a.exported}`))}else Rk(n,i,s,o,e.player);break;default:Rk(n,i,s,o,e.player);break}}break;default:{const{target:n,path:i}=zr(e.target);switch(Dt(n)){case"refscroll":switch(i){case"charscroll":{$t(e.player,"refscroll","char",["char","charedit"]);const s=Ue(e.player);s.scrollname="chars",s.scroll=cr(e.player);break}case"colorscroll":{$t(e.player,"refscroll","color",["color","coloredit"]);const s=Ue(e.player);s.scrollname="colors",s.scroll=cr(e.player);break}case"notesscroll":{Nt(e.player,"duration             cdefgab - notes "),Nt(e.player,"y - 64th note        x - rest"),Nt(e.player,"t - 32nd note        "),Nt(e.player,"s - 16th note.       drums"),Nt(e.player,"i - eight note.      0 - tick"),Nt(e.player,"q - quarter note     1 - tweet"),Nt(e.player,"h - half note        2 - cowbell"),Nt(e.player,"w - whole note       p - clap"),Nt(e.player,"                     4 - high snare"),Nt(e.player,"mods                 5 - high woodblock"),Nt(e.player,"3 - triplet          6 - low snare"),Nt(e.player,". - time and a half  7 - low tom"),Nt(e.player,"# - sharp            8 - low woodblock"),Nt(e.player,"! - flat             9 - bass drum");const s=Ue(e.player);s.scrollname="music notation",s.scroll=cr(e.player);break}}break;case"batch":en(te,e.player,async()=>{await tW(i,e.player)});break;case"remix":en(te,e.player,async()=>{await nW(i,e.player)});break;case"empty":{const s=zr(i);switch(s.target){case"copycoords":kf(te,$r(),s.path.split(",").join(" "));break}break}case"inspect":Q7(i,e.player);break;case"touched":if(pe(e.data)){const[s,o,a]=e.data;Ux({...e,target:`${o}:${a}`,data:void 0,sender:s})}break;case"zztbridge":en(te,e.player,async()=>{yt(e.data)&&await O7(e.player,e.data)});break;case"zipfilelist":en(te,e.player,async()=>{await A7(e.player)});break;default:{const s=zr(i);if(Dt(s.target)==="self"||!s.path)e.target=e.target.replace("self:",""),Ux(e);else{const o=ge(Xt.MAIN);Jo(s.target,s.path,void 0,Do(o))}break}}break}}},Iz());function lW(){xT(te)}const{forward:uW}=tS(e=>{eS(e)&&postMessage(e)});onmessage=function(t){uW(t.data)},setTimeout(lW,100)})();

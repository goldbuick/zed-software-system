var $M=Object.defineProperty;var jM=(ti,Fn,xn)=>Fn in ti?$M(ti,Fn,{enumerable:!0,configurable:!0,writable:!0,value:xn}):ti[Fn]=xn;var Ot=(ti,Fn,xn)=>jM(ti,typeof Fn!="symbol"?Fn+"":Fn,xn);(function(){"use strict";const ti=new Set,Fn={emit(e,t,n,r,i){Fn.invoke(Gb(e,t,n,r,i))},invoke(e){switch(e.target){}ti.forEach(t=>t.handle(e))},connect(e){ti.add(e)},disconnect(e){ti.delete(e)}};var xn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ts(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ub(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var gd={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(xn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var u=r();s=u(" "),o=u(" "),a=u(" ");for(var l=0;l<i.length;l++)s-=u(i[l]),s<0&&(s+=1),o-=u(i[l]),o<0&&(o+=1),a-=u(i[l]),a<0&&(a+=1);u=null;var h=function(){var f=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=f-(c=f|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(f){s=+f[0]||0,o=+f[1]||0,a=+f[2]||0,c=+f[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(gd);var hb=gd.exports,yd=Ts(hb),_d={};(function(e){var t=xn&&xn.__spreadArray||function(u,l,h){if(h||arguments.length===2)for(var f=0,d=l.length,p;f<d;f++)(p||!(f in l))&&(p||(p=Array.prototype.slice.call(l,0,f)),p[f]=l[f]);return u.concat(p||Array.prototype.slice.call(l))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(u){return u[Math.floor(Math.random()*u.length)]}function r(u){return u.reduce(function(l,h){return l.length>h.length?l:h})}function i(u){return u.reduce(function(l,h){return l.length<h.length?l:h})}function s(u){u===void 0&&(u={}),typeof u=="string"&&(u={separator:u}),typeof u=="boolean"&&(u={capitalize:u});var l=u.separator,h=l===void 0?"":l,f=u.capitalize,d=f===void 0?!0:f,p=u.adjectiveCount,m=p===void 0?1:p,w=u.addAdverb,E=w===void 0?!1:w,T=t(t(t([],t([],Array(m),!0).map(function(v){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),E?[n(e.adverbs)]:[],!0);return d&&(T=T.map(function(v){return v.charAt(0).toUpperCase()+v.substr(1)})),T.join(h)}e.humanId=s;function o(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(d?e.adverbs.length:1)}e.poolSize=o;function a(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,m=p===void 0?"":p;return r(e.adjectives).length*h+h*m.length+r(e.nouns).length+m.length+r(e.verbs).length+(d?r(e.adverbs).length+m.length:0)}e.maxLength=a;function c(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,m=p===void 0?"":p;return i(e.adjectives).length*h+h*m.length+i(e.nouns).length+m.length+i(e.verbs).length+(d?i(e.adverbs).length+m.length:0)}e.minLength=c,e.default=s})(_d);var fb=Ts(_d);const db="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let pb=e=>crypto.getRandomValues(new Uint8Array(e)),mb=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},bd=(e,t=21)=>mb(e,t,pb),gb=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=db[n[e]&63];return t};var Ed="abcdefghijklmnopqrstuvwxyz",wd="ABCDEFGHIJKLMNOPQRSTUVWXYZ",xd="0123456789",yb="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",_b="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const bb=xd,Eb=Ed,wb=wd;var xb=bb+Eb+wb,Dl={lowercase:Ed,uppercase:wd,numbers:xd,nolookalikes:yb,nolookalikesSafe:_b,alphanumeric:xb};function Ce(){return`sid_${gb(12).replaceAll("-",".")}`}bd(Dl.numbers,4),bd(`${Dl.numbers}${Dl.lowercase}`,16);function As(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function kb(){return fb({capitalize:!1,adjectiveCount:1})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Tb=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ab=Object.prototype.hasOwnProperty;function $l(e,t){return Ab.call(e,t)}function jl(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)$l(e,i)&&r.push(i);return r}function kn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function zl(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function qi(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function kd(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Wl(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Wl(e[t]))return!0}else if(typeof e=="object"){for(var r=jl(e),i=r.length,s=0;s<i;s++)if(Wl(e[r[s]]))return!0}}return!1}function Td(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Ad=function(e){Tb(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,Td(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Td(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),ve=Ad,vb=kn,vs={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Ra(n,this.path);r&&(r=kn(r));var i=Ji(n,{op:"remove",path:this.from}).removed;return Ji(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Ra(n,this.from);return Ji(n,{op:"add",path:this.path,value:kn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:ko(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Sb={add:function(e,t,n){return zl(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:vs.move,copy:vs.copy,test:vs.test,_get:vs._get};function Ra(e,t){if(t=="")return e;var n={op:"_get",path:t};return Ji(e,n),n.value}function Ji(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Ia(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Ra(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=ko(e,t.value),o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new ve("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=kn(e));var a=t.path||"",c=a.split("/"),u=e,l=1,h=c.length,f=void 0,d=void 0,p=void 0;for(typeof n=="function"?p=n:p=Ia;;){if(d=c[l],d&&d.indexOf("~")!=-1&&(d=kd(d)),i&&(d=="__proto__"||d=="prototype"&&l>0&&c[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&f===void 0&&(u[d]===void 0?f=c.slice(0,l).join("/"):l==h-1&&(f=t.path),f!==void 0&&p(t,0,e,f)),l++,Array.isArray(u)){if(d==="-")d=u.length;else{if(n&&!zl(d))throw new ve("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);zl(d)&&(d=~~d)}if(l>=h){if(n&&t.op==="add"&&d>u.length)throw new ve("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=Sb[t.op].call(t,u,d,e);if(o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(l>=h){var o=vs[t.op].call(t,u,d,e);if(o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(u=u[d],n&&l<h&&(!u||typeof u!="object"))throw new ve("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Kl(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new ve("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=kn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=Ji(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function Rb(e,t,n){var r=Ji(e,t);if(r.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Ia(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new ve("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(vs[e.op]){if(typeof e.path!="string")throw new ve("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new ve('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new ve("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new ve("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Wl(e.value))throw new ve("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new ve("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new ve("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=vd([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new ve("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new ve("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function vd(e,t,n){try{if(!Array.isArray(e))throw new ve("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Kl(kn(t),kn(e),n||!0);else{n=n||Ia;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof ve)return i;throw i}}function ko(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!ko(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!ko(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var Ib=Object.freeze({__proto__:null,JsonPatchError:ve,_areEquals:ko,applyOperation:Ji,applyPatch:Kl,applyReducer:Rb,deepClone:vb,getValueByPointer:Ra,validate:vd,validator:Ia});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Gl=new WeakMap,Nb=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Ob=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function Cb(e){return Gl.get(e)}function Lb(e,t){return e.observers.get(t)}function Mb(e,t){e.observers.delete(t.callback)}function Ub(e,t){t.unobserve()}function Fb(e,t){var n=[],r,i=Cb(e);if(!i)i=new Nb(e),Gl.set(e,i);else{var s=Lb(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=kn(e),t){r.callback=t,r.next=null;var o=function(){Hl(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){Hl(r),clearTimeout(r.next),Mb(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new Ob(t,r)),r}function Hl(e,t){t===void 0&&(t=!1);var n=Gl.get(e.object);Yl(n.value,e.object,e.patches,"",t),e.patches.length&&Kl(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Yl(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=jl(t),o=jl(e),a=!1,c=o.length-1;c>=0;c--){var u=o[c],l=e[u];if($l(t,u)&&!(t[u]===void 0&&l!==void 0&&Array.isArray(t)===!1)){var h=t[u];typeof l=="object"&&l!=null&&typeof h=="object"&&h!=null&&Array.isArray(l)===Array.isArray(h)?Yl(l,h,n,r+"/"+qi(u),i):l!==h&&(i&&n.push({op:"test",path:r+"/"+qi(u),value:kn(l)}),n.push({op:"replace",path:r+"/"+qi(u),value:kn(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+qi(u),value:kn(l)}),n.push({op:"remove",path:r+"/"+qi(u)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var u=s[c];!$l(e,u)&&t[u]!==void 0&&n.push({op:"add",path:r+"/"+qi(u),value:kn(t[u])})}}}function Sd(e,t,n){n===void 0&&(n=!1);var r=[];return Yl(e,t,r,"",n),r}var Bb=Object.freeze({__proto__:null,compare:Sd,generate:Hl,observe:Fb,unobserve:Ub});Object.assign({},Ib,Bb,{JsonPatchError:Ad,deepClone:kn,escapePathComponent:qi,unescapePathComponent:kd});var Pb=typeof Element<"u",Db=typeof Map=="function",$b=typeof Set=="function",jb=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Na(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Na(e[r],t[r]))return!1;return!0}var s;if(Db&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Na(r.value[1],t.get(r.value[0])))return!1;return!0}if($b&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(jb&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(Pb&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Na(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var zb=function(t,n){try{return Na(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},Wb=Ts(zb);function x(e){return e!=null}const Gn=Object.keys;function Xe(e){return kn(e)}function Kb(e){return typeof e=="boolean"}function Ct(e){return typeof e=="number"&&isNaN(e)===!1}function St(e){return typeof e=="string"}function ne(e){return Array.isArray(e)}function Vl(e){return e}var Wt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(Wt||{}),Ht=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(Ht||{}),Hn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Hn||{}),yt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e))(yt||{}),wt=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.LINK=11]="LINK",e[e.HOTKEY=12]="HOTKEY",e[e.COPYIT=13]="COPYIT",e[e.OPENIT=14]="OPENIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(wt||{});function Mt(e){return e.toLowerCase().trim()}function Gb(e,t,n,r,i){return{session:e,id:Ce(),target:t,sender:n,data:r,player:i}}function Tr(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Ss(e,t=[],n=Vl,r=""){const i=Ce(),s=Mt(e),o=t.map(Mt);let a=r;const c={id(){return i},name(){return e},session(u){return x(u)?u.session===a?u.session:"":a},topics(){return t},emit(u,l,h){Fn.emit(a,u,i,l,h)},reply(u,l,h,f){c.emit(`${u.sender}:${l}`,h,f)},replynext(u,l,h,f){setTimeout(()=>c.emit(`${u.sender}:${l}`,h,f),64)},handle(u){const{target:l,path:h}=Tr(u.target),f=Mt(l);!a&&f==="ready"&&(a=u.session),f==="bridge"&&x(u.session)&&(a=u.session),o.findIndex(d=>d==="all"||d===f)!==-1&&n(u),(i===l||f==="all"||s===f)&&n({...u,target:h})}};return Fn.connect(c),c}function Hb(e){return x(e)&&typeof e=="object"&&St(e.id)&&St(e.target)&&St(e.sender)}function le(e,t,n,r){const i=r??"";return e.emit(`error:${t}`,n,i),_E(e,n,i)}function Yb(e,t,n){e.emit("broadcast:startstream",t,n)}function Vb(e,t){e.emit("broadcast:stopstream",void 0,t)}function Xb(e,t,n){e.emit("chat:connect",t,n)}function qb(e,t){e.emit("chat:disconnect",void 0,t)}function Jb(e,t,n){e.emit("gadgetclient:paint",t,n)}function Zb(e,t,n){e.emit("gadgetclient:patch",t,n)}function Qb(e,t){e.emit("gadgetserver:clearscroll",void 0,t)}function tE(e,t,n,r,i,s,o){e.emit("network:fetch",[t,n,r,i,s],o)}function eE(e,t,n){e.emit("network:start",t,n)}function nE(e,t,n){e.emit("network:tab",t,n)}function rE(e){e.emit("ready")}function Xl(e,t){e.emit("register:loginready",!0,t)}function iE(e,t,n,r){e.emit("register:savemem",[t,n],r)}function sE(e,t,n){e.emit("register:forkmem",[t],n)}function ql(e,t,n){e.emit("register:copy",t,n)}function oE(e,t,n,r){e.emit("register:copyjsonfile",[t,n],r)}function Rd(e,t,n,r){e.emit("register:downloadjsonfile",[t,n],r)}function aE(e,t){e.emit("register:dev",void 0,t)}function cE(e,t){e.emit("register:share",void 0,t)}function lE(e,t){e.emit("register:nuke",void 0,t)}function uE(e,t,n){e.emit("synth:tts",[t,n])}function hE(e,t){e.emit("synth:tta",[t])}function fE(e,t,n){e.emit("synth:play",[t,n])}function dE(e,t){e.emit("synth:bpm",t)}function pE(e,t){e.emit("synth:playvolume",t)}function mE(e,t){e.emit("synth:bgplayvolume",t)}function gE(e,t){e.emit("synth:ttsvolume",t)}function Jl(e,t,n,r){e.emit("synth:voice",[t,n,r])}function Id(e,t,n,r,i){e.emit("synth:voicefx",[t,n,r,i])}function ei(e,...t){return e.emit("tape:info",t),!0}function Nd(e,...t){return e.emit("tape:debug",t),!0}function yE(e,t,n){e.emit("tape:inspector",t,n)}function _E(e,...t){return e.emit("tape:error",t),!1}function Od(e,t,n,r,i,s,o){e.emit("tape:editor:open",[t,n,r,i,s],o)}function bE(e,t){e.emit("tape:editor:close",void 0,t)}function Cd(e,t){e.emit("vm:logout",void 0,t)}function Oa(e,t){const[n,r]=t;return`${e}:${[n,r].filter(x).join(":")}`}function EE(e,t,n){e.emit("vm:cli",t,n)}function wE(e,t){e.emit("vm:restart",void 0,t)}function Ld(e,t){e.emit("vm:flush",void 0,t)}function xE(e,t){e.emit("vm:fork",void 0,t)}function kE(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function TE(e,t){return{filename:e,json:t}}function AE(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function Zl(e,t,n,r,i,s){let o;switch(n){case"file":o=i;break;case"text":o=kE(r,i);break;case"json":o=TE(r,i);break;case"binary":o=AE(r,i);break}setTimeout(()=>{e.emit("vm:loader",[t,n,r,o],s)},1)}function vE(e){const t=new Set;function n(s){Hb(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Fn.invoke(s))}const r=Ss("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Fn.disconnect(r)}return{forward:n,disconnect:i}}const Ql=66.666,Ca=Math.round(1e3/Ql),SE=3;function Md(e){return new Promise(t=>setTimeout(t,e))}const tu=Ss("clock");let eu=0,La=0,nu=0,Ud=performance.now();function Fd(){const e=performance.now(),t=e-Ud;nu+=t,nu>=Ql&&(nu%=Ql,tu.emit("tick",La),tu.emit("tock",La),++eu,++La,eu>=Ca&&(eu%=Ca,tu.emit("second",La))),Ud=e,setTimeout(Fd,2)}Fd();const Bd=1,Pd=2,ru=4,iu=8,To=32,ni=64,Bn=128,Ma=31,su=63,Zi=127,RE=2147483647,Ti=Math.floor,Ua=Math.abs,Dd=(e,t)=>e<t?e:t,Qi=(e,t)=>e>t?e:t,$d=e=>e!==0?e<0:1/e<0,jd=Number.MAX_SAFE_INTEGER,IE=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Ti(e)===e),Rs=()=>new Set,ou=e=>e[e.length-1],NE=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Ai=Array.from,OE=Array.isArray,CE=e=>e.toLowerCase(),LE=/^\s*/g,ME=e=>e.replace(LE,""),UE=/([A-Z])/g,zd=(e,t)=>ME(e.replace(UE,n=>`${t}${CE(n)}`)),FE=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},Ao=typeof TextEncoder<"u"?new TextEncoder:null,BE=Ao?e=>Ao.encode(e):FE;let vo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});vo&&vo.decode(new Uint8Array).length===1&&(vo=null);const vi=e=>new Error(e),Ar=()=>{throw vi("Method unimplemented")},vr=()=>{throw vi("Unexpected case")};class So{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Si=()=>new So,PE=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},hr=e=>{const t=new Uint8Array(PE(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},DE=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Qi(n,t)*2),e.cpos=0)},qe=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},au=qe,$t=(e,t)=>{for(;t>Zi;)qe(e,Bn|Zi&t),t=Ti(t/128);qe(e,Zi&t)},cu=(e,t)=>{const n=$d(t);for(n&&(t=-t),qe(e,(t>su?Bn:0)|(n?ni:0)|su&t),t=Ti(t/64);t>0;)qe(e,(t>Zi?Bn:0)|Zi&t),t=Ti(t/128)},lu=new Uint8Array(3e4),$E=lu.length/3,jE=(e,t)=>{if(t.length<$E){const n=Ao.encodeInto(t,lu).written||0;$t(e,n);for(let r=0;r<n;r++)qe(e,lu[r])}else on(e,BE(t))},zE=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;$t(e,r);for(let i=0;i<r;i++)qe(e,n.codePointAt(i))},Is=Ao&&Ao.encodeInto?jE:zE,Fa=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=Dd(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Qi(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},on=(e,t)=>{$t(e,t.byteLength),Fa(e,t)},uu=(e,t)=>{DE(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},WE=(e,t)=>uu(e,4).setFloat32(0,t,!1),KE=(e,t)=>uu(e,8).setFloat64(0,t,!1),GE=(e,t)=>uu(e,8).setBigInt64(0,t,!1),Wd=new DataView(new ArrayBuffer(4)),HE=e=>(Wd.setFloat32(0,e),Wd.getFloat32(0)===e),Ro=(e,t)=>{switch(typeof t){case"string":qe(e,119),Is(e,t);break;case"number":IE(t)&&Ua(t)<=RE?(qe(e,125),cu(e,t)):HE(t)?(qe(e,124),WE(e,t)):(qe(e,123),KE(e,t));break;case"bigint":qe(e,122),GE(e,t);break;case"object":if(t===null)qe(e,126);else if(OE(t)){qe(e,117),$t(e,t.length);for(let n=0;n<t.length;n++)Ro(e,t[n])}else if(t instanceof Uint8Array)qe(e,116),on(e,t);else{qe(e,118);const n=Object.keys(t);$t(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Is(e,i),Ro(e,t[i])}}break;case"boolean":qe(e,t?120:121);break;default:qe(e,127)}};class Kd extends So{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&$t(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Gd=e=>{e.count>0&&(cu(e.encoder,e.count===1?e.s:-e.s),e.count>1&&$t(e.encoder,e.count-2))};class Ba{constructor(){this.encoder=new So,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Gd(this),this.count=1,this.s=t)}toUint8Array(){return Gd(this),hr(this.encoder)}}const Hd=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);cu(e.encoder,t),e.count>1&&$t(e.encoder,e.count-2)}};class hu{constructor(){this.encoder=new So,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Hd(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Hd(this),hr(this.encoder)}}class YE{constructor(){this.sarr=[],this.s="",this.lensE=new Ba}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new So;return this.sarr.push(this.s),this.s="",Is(t,this.sarr.join("")),Fa(t,this.lensE.toUint8Array()),hr(t)}}const Yd=vi("Unexpected end of array"),Vd=vi("Integer out of Range");class Pa{constructor(t){this.arr=t,this.pos=0}}const ts=e=>new Pa(e),VE=e=>e.pos!==e.arr.length,XE=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},dn=e=>XE(e,jt(e)),Ns=e=>e.arr[e.pos++],jt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&Zi)*n,n*=128,i<Bn)return t;if(t>jd)throw Vd}throw Yd},fu=e=>{let t=e.arr[e.pos++],n=t&su,r=64;const i=(t&ni)>0?-1:1;if(!(t&Bn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&Zi)*r,r*=128,t<Bn)return i*n;if(n>jd)throw Vd}throw Yd},Os=vo?e=>vo.decode(dn(e)):e=>{let t=jt(e);if(t===0)return"";{let n=String.fromCodePoint(Ns(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Ns(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},du=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},qE=[e=>{},e=>null,fu,e=>du(e,4).getFloat32(0,!1),e=>du(e,8).getFloat64(0,!1),e=>du(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Os,e=>{const t=jt(e),n={};for(let r=0;r<t;r++){const i=Os(e);n[i]=Io(e)}return n},e=>{const t=jt(e),n=[];for(let r=0;r<t;r++)n.push(Io(e));return n},dn],Io=e=>qE[127-Ns(e)](e);class Xd extends Pa{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),VE(this)?this.count=jt(this)+1:this.count=-1),this.count--,this.s}}class Da extends Pa{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=fu(this);const t=$d(this.s);this.count=1,t&&(this.s=-this.s,this.count=jt(this)+2)}return this.count--,this.s}}class pu extends Pa{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=fu(this),n=t&1;this.diff=Ti(t/2),this.count=1,n&&(this.count=jt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class JE{constructor(t){this.decoder=new Da(t),this.str=Os(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}var Yt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var No=Symbol.for("react.element"),ZE=Symbol.for("react.portal"),QE=Symbol.for("react.fragment"),tw=Symbol.for("react.strict_mode"),ew=Symbol.for("react.profiler"),nw=Symbol.for("react.provider"),rw=Symbol.for("react.context"),iw=Symbol.for("react.forward_ref"),sw=Symbol.for("react.suspense"),ow=Symbol.for("react.memo"),aw=Symbol.for("react.lazy"),qd=Symbol.iterator;function cw(e){return e===null||typeof e!="object"?null:(e=qd&&e[qd]||e["@@iterator"],typeof e=="function"?e:null)}var Jd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Zd=Object.assign,Qd={};function Cs(e,t,n){this.props=e,this.context=t,this.refs=Qd,this.updater=n||Jd}Cs.prototype.isReactComponent={},Cs.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Cs.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function tp(){}tp.prototype=Cs.prototype;function mu(e,t,n){this.props=e,this.context=t,this.refs=Qd,this.updater=n||Jd}var gu=mu.prototype=new tp;gu.constructor=mu,Zd(gu,Cs.prototype),gu.isPureReactComponent=!0;var ep=Array.isArray,np=Object.prototype.hasOwnProperty,yu={current:null},rp={key:!0,ref:!0,__self:!0,__source:!0};function ip(e,t,n){var r,i={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)np.call(t,r)&&!rp.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:No,type:e,key:s,ref:o,props:i,_owner:yu.current}}function lw(e,t){return{$$typeof:No,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function _u(e){return typeof e=="object"&&e!==null&&e.$$typeof===No}function uw(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var sp=/\/+/g;function bu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?uw(""+e.key):t.toString(36)}function $a(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case No:case ZE:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+bu(o,0):r,ep(i)?(n="",e!=null&&(n=e.replace(sp,"$&/")+"/"),$a(i,t,n,"",function(u){return u})):i!=null&&(_u(i)&&(i=lw(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(sp,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",ep(e))for(var a=0;a<e.length;a++){s=e[a];var c=r+bu(s,a);o+=$a(s,t,n,c,i)}else if(c=cw(e),typeof c=="function")for(e=c.call(e),a=0;!(s=e.next()).done;)s=s.value,c=r+bu(s,a++),o+=$a(s,t,n,c,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function ja(e,t,n){if(e==null)return e;var r=[],i=0;return $a(e,r,"","",function(s){return t.call(n,s,i++)}),r}function hw(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var pn={current:null},za={transition:null},fw={ReactCurrentDispatcher:pn,ReactCurrentBatchConfig:za,ReactCurrentOwner:yu};function op(){throw Error("act(...) is not supported in production builds of React.")}Yt.Children={map:ja,forEach:function(e,t,n){ja(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return ja(e,function(){t++}),t},toArray:function(e){return ja(e,function(t){return t})||[]},only:function(e){if(!_u(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Yt.Component=Cs,Yt.Fragment=QE,Yt.Profiler=ew,Yt.PureComponent=mu,Yt.StrictMode=tw,Yt.Suspense=sw,Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fw,Yt.act=op,Yt.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Zd({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=yu.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)np.call(t,c)&&!rp.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:No,type:e.type,key:i,ref:s,props:r,_owner:o}},Yt.createContext=function(e){return e={$$typeof:rw,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:nw,_context:e},e.Consumer=e},Yt.createElement=ip,Yt.createFactory=function(e){var t=ip.bind(null,e);return t.type=e,t},Yt.createRef=function(){return{current:null}},Yt.forwardRef=function(e){return{$$typeof:iw,render:e}},Yt.isValidElement=_u,Yt.lazy=function(e){return{$$typeof:aw,_payload:{_status:-1,_result:e},_init:hw}},Yt.memo=function(e,t){return{$$typeof:ow,type:e,compare:t===void 0?null:t}},Yt.startTransition=function(e){var t=za.transition;za.transition={};try{e()}finally{za.transition=t}},Yt.unstable_act=op,Yt.useCallback=function(e,t){return pn.current.useCallback(e,t)},Yt.useContext=function(e){return pn.current.useContext(e)},Yt.useDebugValue=function(){},Yt.useDeferredValue=function(e){return pn.current.useDeferredValue(e)},Yt.useEffect=function(e,t){return pn.current.useEffect(e,t)},Yt.useId=function(){return pn.current.useId()},Yt.useImperativeHandle=function(e,t,n){return pn.current.useImperativeHandle(e,t,n)},Yt.useInsertionEffect=function(e,t){return pn.current.useInsertionEffect(e,t)},Yt.useLayoutEffect=function(e,t){return pn.current.useLayoutEffect(e,t)},Yt.useMemo=function(e,t){return pn.current.useMemo(e,t)},Yt.useReducer=function(e,t,n){return pn.current.useReducer(e,t,n)},Yt.useRef=function(e){return pn.current.useRef(e)},Yt.useState=function(e){return pn.current.useState(e)},Yt.useSyncExternalStore=function(e,t,n){return pn.current.useSyncExternalStore(e,t,n)},Yt.useTransition=function(){return pn.current.useTransition()},Yt.version="18.3.1";const Ls=globalThis||void 0||self,fr=()=>new Map,Eu=e=>{const t=fr();return e.forEach((n,r)=>{t.set(r,n)}),t},Ri=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},dw=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},pw=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1};class mw{constructor(){this._observers=fr()}on(t,n){return Ri(this._observers,t,Rs).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Ai((this._observers.get(t)||fr()).values()).forEach(r=>r(...n))}destroy(){this._observers=fr()}}const gw=crypto.getRandomValues.bind(crypto),ap=()=>gw(new Uint32Array(1))[0],yw="10000000-1000-4000-8000"+-1e11,_w=()=>yw.replace(/[018]/g,e=>(e^ap()&15>>e/4).toString(16)),cp=e=>new Promise(e);Promise.all.bind(Promise);var lp={},Wa={};Wa.byteLength=ww,Wa.toByteArray=kw,Wa.fromByteArray=vw;for(var Sr=[],Yn=[],bw=typeof Uint8Array<"u"?Uint8Array:Array,wu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ms=0,Ew=wu.length;Ms<Ew;++Ms)Sr[Ms]=wu[Ms],Yn[wu.charCodeAt(Ms)]=Ms;Yn[45]=62,Yn[95]=63;function up(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function ww(e){var t=up(e),n=t[0],r=t[1];return(n+r)*3/4-r}function xw(e,t,n){return(t+n)*3/4-n}function kw(e){var t,n=up(e),r=n[0],i=n[1],s=new bw(xw(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=Yn[e.charCodeAt(c)]<<18|Yn[e.charCodeAt(c+1)]<<12|Yn[e.charCodeAt(c+2)]<<6|Yn[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=Yn[e.charCodeAt(c)]<<2|Yn[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=Yn[e.charCodeAt(c)]<<10|Yn[e.charCodeAt(c+1)]<<4|Yn[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function Tw(e){return Sr[e>>18&63]+Sr[e>>12&63]+Sr[e>>6&63]+Sr[e&63]}function Aw(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(Tw(r));return i.join("")}function vw(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(Aw(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(Sr[t>>2]+Sr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(Sr[t>>10]+Sr[t>>4&63]+Sr[t<<2&63]+"=")),i.join("")}var xu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */xu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,u=c>>1,l=-7,h=n?i-1:0,f=n?-1:1,d=e[t+h];for(h+=f,s=d&(1<<-l)-1,d>>=-l,l+=a;l>0;s=s*256+e[t+h],h+=f,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=r;l>0;o=o*256+e[t+h],h+=f,l-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-u}return(d?-1:1)*o*Math.pow(2,s-r)},xu.write=function(e,t,n,r,i,s){var o,a,c,u=s*8-i-1,l=(1<<u)-1,h=l>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,m=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?t+=f/c:t+=f*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=l?(a=0,o=l):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o=o+h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+d]=a&255,d+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[n+d]=o&255,d+=p,o/=256,u-=8);e[n+d-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=Wa,n=xu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=l,e.SlowBuffer=U,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const A=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(A,g),A.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function u(A){if(A>i)throw new RangeError('The value "'+A+'" is invalid for option "size"');const g=new s(A);return Object.setPrototypeOf(g,l.prototype),g}function l(A,g,y){if(typeof A=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(A)}return h(A,g,y)}l.poolSize=8192;function h(A,g,y){if(typeof A=="string")return m(A,g);if(o.isView(A))return E(A);if(A==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A);if(dt(A,o)||A&&dt(A.buffer,o)||typeof a<"u"&&(dt(A,a)||A&&dt(A.buffer,a)))return T(A,g,y);if(typeof A=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const O=A.valueOf&&A.valueOf();if(O!=null&&O!==A)return l.from(O,g,y);const $=v(A);if($)return $;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof A[Symbol.toPrimitive]=="function")return l.from(A[Symbol.toPrimitive]("string"),g,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A)}l.from=function(A,g,y){return h(A,g,y)},Object.setPrototypeOf(l.prototype,s.prototype),Object.setPrototypeOf(l,s);function f(A){if(typeof A!="number")throw new TypeError('"size" argument must be of type number');if(A<0)throw new RangeError('The value "'+A+'" is invalid for option "size"')}function d(A,g,y){return f(A),A<=0?u(A):g!==void 0?typeof y=="string"?u(A).fill(g,y):u(A).fill(g):u(A)}l.alloc=function(A,g,y){return d(A,g,y)};function p(A){return f(A),u(A<0?0:I(A)|0)}l.allocUnsafe=function(A){return p(A)},l.allocUnsafeSlow=function(A){return p(A)};function m(A,g){if((typeof g!="string"||g==="")&&(g="utf8"),!l.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const y=S(A,g)|0;let O=u(y);const $=O.write(A,g);return $!==y&&(O=O.slice(0,$)),O}function w(A){const g=A.length<0?0:I(A.length)|0,y=u(g);for(let O=0;O<g;O+=1)y[O]=A[O]&255;return y}function E(A){if(dt(A,s)){const g=new s(A);return T(g.buffer,g.byteOffset,g.byteLength)}return w(A)}function T(A,g,y){if(g<0||A.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(A.byteLength<g+(y||0))throw new RangeError('"length" is outside of buffer bounds');let O;return g===void 0&&y===void 0?O=new s(A):y===void 0?O=new s(A,g):O=new s(A,g,y),Object.setPrototypeOf(O,l.prototype),O}function v(A){if(l.isBuffer(A)){const g=I(A.length)|0,y=u(g);return y.length===0||A.copy(y,0,0,g),y}if(A.length!==void 0)return typeof A.length!="number"||vt(A.length)?u(0):w(A);if(A.type==="Buffer"&&Array.isArray(A.data))return w(A.data)}function I(A){if(A>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return A|0}function U(A){return+A!=A&&(A=0),l.alloc(+A)}l.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==l.prototype},l.compare=function(g,y){if(dt(g,s)&&(g=l.from(g,g.offset,g.byteLength)),dt(y,s)&&(y=l.from(y,y.offset,y.byteLength)),!l.isBuffer(g)||!l.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===y)return 0;let O=g.length,$=y.length;for(let tt=0,rt=Math.min(O,$);tt<rt;++tt)if(g[tt]!==y[tt]){O=g[tt],$=y[tt];break}return O<$?-1:$<O?1:0},l.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(g,y){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return l.alloc(0);let O;if(y===void 0)for(y=0,O=0;O<g.length;++O)y+=g[O].length;const $=l.allocUnsafe(y);let tt=0;for(O=0;O<g.length;++O){let rt=g[O];if(dt(rt,s))tt+rt.length>$.length?(l.isBuffer(rt)||(rt=l.from(rt)),rt.copy($,tt)):s.prototype.set.call($,rt,tt);else if(l.isBuffer(rt))rt.copy($,tt);else throw new TypeError('"list" argument must be an Array of Buffers');tt+=rt.length}return $};function S(A,g){if(l.isBuffer(A))return A.length;if(o.isView(A)||dt(A,o))return A.byteLength;if(typeof A!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof A);const y=A.length,O=arguments.length>2&&arguments[2]===!0;if(!O&&y===0)return 0;let $=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return at(A).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return pt(A).length;default:if($)return O?-1:at(A).length;g=(""+g).toLowerCase(),$=!0}}l.byteLength=S;function N(A,g,y){let O=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,g>>>=0,y<=g))return"";for(A||(A="utf8");;)switch(A){case"hex":return W(this,g,y);case"utf8":case"utf-8":return D(this,g,y);case"ascii":return ft(this,g,y);case"latin1":case"binary":return G(this,g,y);case"base64":return X(this,g,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return bt(this,g,y);default:if(O)throw new TypeError("Unknown encoding: "+A);A=(A+"").toLowerCase(),O=!0}}l.prototype._isBuffer=!0;function P(A,g,y){const O=A[g];A[g]=A[y],A[y]=O}l.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<g;y+=2)P(this,y,y+1);return this},l.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<g;y+=4)P(this,y,y+3),P(this,y+1,y+2);return this},l.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<g;y+=8)P(this,y,y+7),P(this,y+1,y+6),P(this,y+2,y+5),P(this,y+3,y+4);return this},l.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?D(this,0,g):N.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(g){if(!l.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:l.compare(this,g)===0},l.prototype.inspect=function(){let g="";const y=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(g+=" ... "),"<Buffer "+g+">"},r&&(l.prototype[r]=l.prototype.inspect),l.prototype.compare=function(g,y,O,$,tt){if(dt(g,s)&&(g=l.from(g,g.offset,g.byteLength)),!l.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(y===void 0&&(y=0),O===void 0&&(O=g?g.length:0),$===void 0&&($=0),tt===void 0&&(tt=this.length),y<0||O>g.length||$<0||tt>this.length)throw new RangeError("out of range index");if($>=tt&&y>=O)return 0;if($>=tt)return-1;if(y>=O)return 1;if(y>>>=0,O>>>=0,$>>>=0,tt>>>=0,this===g)return 0;let rt=tt-$,Dt=O-y;const Ee=Math.min(rt,Dt),ye=this.slice($,tt),we=g.slice(y,O);for(let ce=0;ce<Ee;++ce)if(ye[ce]!==we[ce]){rt=ye[ce],Dt=we[ce];break}return rt<Dt?-1:Dt<rt?1:0};function L(A,g,y,O,$){if(A.length===0)return-1;if(typeof y=="string"?(O=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,vt(y)&&(y=$?0:A.length-1),y<0&&(y=A.length+y),y>=A.length){if($)return-1;y=A.length-1}else if(y<0)if($)y=0;else return-1;if(typeof g=="string"&&(g=l.from(g,O)),l.isBuffer(g))return g.length===0?-1:V(A,g,y,O,$);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?$?s.prototype.indexOf.call(A,g,y):s.prototype.lastIndexOf.call(A,g,y):V(A,[g],y,O,$);throw new TypeError("val must be string, number or Buffer")}function V(A,g,y,O,$){let tt=1,rt=A.length,Dt=g.length;if(O!==void 0&&(O=String(O).toLowerCase(),O==="ucs2"||O==="ucs-2"||O==="utf16le"||O==="utf-16le")){if(A.length<2||g.length<2)return-1;tt=2,rt/=2,Dt/=2,y/=2}function Ee(we,ce){return tt===1?we[ce]:we.readUInt16BE(ce*tt)}let ye;if($){let we=-1;for(ye=y;ye<rt;ye++)if(Ee(A,ye)===Ee(g,we===-1?0:ye-we)){if(we===-1&&(we=ye),ye-we+1===Dt)return we*tt}else we!==-1&&(ye-=ye-we),we=-1}else for(y+Dt>rt&&(y=rt-Dt),ye=y;ye>=0;ye--){let we=!0;for(let ce=0;ce<Dt;ce++)if(Ee(A,ye+ce)!==Ee(g,ce)){we=!1;break}if(we)return ye}return-1}l.prototype.includes=function(g,y,O){return this.indexOf(g,y,O)!==-1},l.prototype.indexOf=function(g,y,O){return L(this,g,y,O,!0)},l.prototype.lastIndexOf=function(g,y,O){return L(this,g,y,O,!1)};function Z(A,g,y,O){y=Number(y)||0;const $=A.length-y;O?(O=Number(O),O>$&&(O=$)):O=$;const tt=g.length;O>tt/2&&(O=tt/2);let rt;for(rt=0;rt<O;++rt){const Dt=parseInt(g.substr(rt*2,2),16);if(vt(Dt))return rt;A[y+rt]=Dt}return rt}function C(A,g,y,O){return _t(at(g,A.length-y),A,y,O)}function R(A,g,y,O){return _t(ht(g),A,y,O)}function _(A,g,y,O){return _t(pt(g),A,y,O)}function B(A,g,y,O){return _t(Q(g,A.length-y),A,y,O)}l.prototype.write=function(g,y,O,$){if(y===void 0)$="utf8",O=this.length,y=0;else if(O===void 0&&typeof y=="string")$=y,O=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(O)?(O=O>>>0,$===void 0&&($="utf8")):($=O,O=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const tt=this.length-y;if((O===void 0||O>tt)&&(O=tt),g.length>0&&(O<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");$||($="utf8");let rt=!1;for(;;)switch($){case"hex":return Z(this,g,y,O);case"utf8":case"utf-8":return C(this,g,y,O);case"ascii":case"latin1":case"binary":return R(this,g,y,O);case"base64":return _(this,g,y,O);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,g,y,O);default:if(rt)throw new TypeError("Unknown encoding: "+$);$=(""+$).toLowerCase(),rt=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function X(A,g,y){return g===0&&y===A.length?t.fromByteArray(A):t.fromByteArray(A.slice(g,y))}function D(A,g,y){y=Math.min(A.length,y);const O=[];let $=g;for(;$<y;){const tt=A[$];let rt=null,Dt=tt>239?4:tt>223?3:tt>191?2:1;if($+Dt<=y){let Ee,ye,we,ce;switch(Dt){case 1:tt<128&&(rt=tt);break;case 2:Ee=A[$+1],(Ee&192)===128&&(ce=(tt&31)<<6|Ee&63,ce>127&&(rt=ce));break;case 3:Ee=A[$+1],ye=A[$+2],(Ee&192)===128&&(ye&192)===128&&(ce=(tt&15)<<12|(Ee&63)<<6|ye&63,ce>2047&&(ce<55296||ce>57343)&&(rt=ce));break;case 4:Ee=A[$+1],ye=A[$+2],we=A[$+3],(Ee&192)===128&&(ye&192)===128&&(we&192)===128&&(ce=(tt&15)<<18|(Ee&63)<<12|(ye&63)<<6|we&63,ce>65535&&ce<1114112&&(rt=ce))}}rt===null?(rt=65533,Dt=1):rt>65535&&(rt-=65536,O.push(rt>>>10&1023|55296),rt=56320|rt&1023),O.push(rt),$+=Dt}return et(O)}const lt=4096;function et(A){const g=A.length;if(g<=lt)return String.fromCharCode.apply(String,A);let y="",O=0;for(;O<g;)y+=String.fromCharCode.apply(String,A.slice(O,O+=lt));return y}function ft(A,g,y){let O="";y=Math.min(A.length,y);for(let $=g;$<y;++$)O+=String.fromCharCode(A[$]&127);return O}function G(A,g,y){let O="";y=Math.min(A.length,y);for(let $=g;$<y;++$)O+=String.fromCharCode(A[$]);return O}function W(A,g,y){const O=A.length;(!g||g<0)&&(g=0),(!y||y<0||y>O)&&(y=O);let $="";for(let tt=g;tt<y;++tt)$+=ue[A[tt]];return $}function bt(A,g,y){const O=A.slice(g,y);let $="";for(let tt=0;tt<O.length-1;tt+=2)$+=String.fromCharCode(O[tt]+O[tt+1]*256);return $}l.prototype.slice=function(g,y){const O=this.length;g=~~g,y=y===void 0?O:~~y,g<0?(g+=O,g<0&&(g=0)):g>O&&(g=O),y<0?(y+=O,y<0&&(y=0)):y>O&&(y=O),y<g&&(y=g);const $=this.subarray(g,y);return Object.setPrototypeOf($,l.prototype),$};function ot(A,g,y){if(A%1!==0||A<0)throw new RangeError("offset is not uint");if(A+g>y)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(g,y,O){g=g>>>0,y=y>>>0,O||ot(g,y,this.length);let $=this[g],tt=1,rt=0;for(;++rt<y&&(tt*=256);)$+=this[g+rt]*tt;return $},l.prototype.readUintBE=l.prototype.readUIntBE=function(g,y,O){g=g>>>0,y=y>>>0,O||ot(g,y,this.length);let $=this[g+--y],tt=1;for(;y>0&&(tt*=256);)$+=this[g+--y]*tt;return $},l.prototype.readUint8=l.prototype.readUInt8=function(g,y){return g=g>>>0,y||ot(g,1,this.length),this[g]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(g,y){return g=g>>>0,y||ot(g,2,this.length),this[g]|this[g+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(g,y){return g=g>>>0,y||ot(g,2,this.length),this[g]<<8|this[g+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},l.prototype.readBigUInt64LE=Ut(function(g){g=g>>>0,nt(g,"offset");const y=this[g],O=this[g+7];(y===void 0||O===void 0)&&F(g,this.length-8);const $=y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,tt=this[++g]+this[++g]*2**8+this[++g]*2**16+O*2**24;return BigInt($)+(BigInt(tt)<<BigInt(32))}),l.prototype.readBigUInt64BE=Ut(function(g){g=g>>>0,nt(g,"offset");const y=this[g],O=this[g+7];(y===void 0||O===void 0)&&F(g,this.length-8);const $=y*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],tt=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+O;return(BigInt($)<<BigInt(32))+BigInt(tt)}),l.prototype.readIntLE=function(g,y,O){g=g>>>0,y=y>>>0,O||ot(g,y,this.length);let $=this[g],tt=1,rt=0;for(;++rt<y&&(tt*=256);)$+=this[g+rt]*tt;return tt*=128,$>=tt&&($-=Math.pow(2,8*y)),$},l.prototype.readIntBE=function(g,y,O){g=g>>>0,y=y>>>0,O||ot(g,y,this.length);let $=y,tt=1,rt=this[g+--$];for(;$>0&&(tt*=256);)rt+=this[g+--$]*tt;return tt*=128,rt>=tt&&(rt-=Math.pow(2,8*y)),rt},l.prototype.readInt8=function(g,y){return g=g>>>0,y||ot(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},l.prototype.readInt16LE=function(g,y){g=g>>>0,y||ot(g,2,this.length);const O=this[g]|this[g+1]<<8;return O&32768?O|4294901760:O},l.prototype.readInt16BE=function(g,y){g=g>>>0,y||ot(g,2,this.length);const O=this[g+1]|this[g]<<8;return O&32768?O|4294901760:O},l.prototype.readInt32LE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},l.prototype.readInt32BE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},l.prototype.readBigInt64LE=Ut(function(g){g=g>>>0,nt(g,"offset");const y=this[g],O=this[g+7];(y===void 0||O===void 0)&&F(g,this.length-8);const $=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(O<<24);return(BigInt($)<<BigInt(32))+BigInt(y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),l.prototype.readBigInt64BE=Ut(function(g){g=g>>>0,nt(g,"offset");const y=this[g],O=this[g+7];(y===void 0||O===void 0)&&F(g,this.length-8);const $=(y<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt($)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+O)}),l.prototype.readFloatLE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),n.read(this,g,!0,23,4)},l.prototype.readFloatBE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),n.read(this,g,!1,23,4)},l.prototype.readDoubleLE=function(g,y){return g=g>>>0,y||ot(g,8,this.length),n.read(this,g,!0,52,8)},l.prototype.readDoubleBE=function(g,y){return g=g>>>0,y||ot(g,8,this.length),n.read(this,g,!1,52,8)};function ct(A,g,y,O,$,tt){if(!l.isBuffer(A))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>$||g<tt)throw new RangeError('"value" argument is out of bounds');if(y+O>A.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(g,y,O,$){if(g=+g,y=y>>>0,O=O>>>0,!$){const Dt=Math.pow(2,8*O)-1;ct(this,g,y,O,Dt,0)}let tt=1,rt=0;for(this[y]=g&255;++rt<O&&(tt*=256);)this[y+rt]=g/tt&255;return y+O},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(g,y,O,$){if(g=+g,y=y>>>0,O=O>>>0,!$){const Dt=Math.pow(2,8*O)-1;ct(this,g,y,O,Dt,0)}let tt=O-1,rt=1;for(this[y+tt]=g&255;--tt>=0&&(rt*=256);)this[y+tt]=g/rt&255;return y+O},l.prototype.writeUint8=l.prototype.writeUInt8=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,1,255,0),this[y]=g&255,y+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,2,65535,0),this[y]=g&255,this[y+1]=g>>>8,y+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,2,65535,0),this[y]=g>>>8,this[y+1]=g&255,y+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,4,4294967295,0),this[y+3]=g>>>24,this[y+2]=g>>>16,this[y+1]=g>>>8,this[y]=g&255,y+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,4,4294967295,0),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4};function Lt(A,g,y,O,$){st(g,O,$,A,y,7);let tt=Number(g&BigInt(4294967295));A[y++]=tt,tt=tt>>8,A[y++]=tt,tt=tt>>8,A[y++]=tt,tt=tt>>8,A[y++]=tt;let rt=Number(g>>BigInt(32)&BigInt(4294967295));return A[y++]=rt,rt=rt>>8,A[y++]=rt,rt=rt>>8,A[y++]=rt,rt=rt>>8,A[y++]=rt,y}function ee(A,g,y,O,$){st(g,O,$,A,y,7);let tt=Number(g&BigInt(4294967295));A[y+7]=tt,tt=tt>>8,A[y+6]=tt,tt=tt>>8,A[y+5]=tt,tt=tt>>8,A[y+4]=tt;let rt=Number(g>>BigInt(32)&BigInt(4294967295));return A[y+3]=rt,rt=rt>>8,A[y+2]=rt,rt=rt>>8,A[y+1]=rt,rt=rt>>8,A[y]=rt,y+8}l.prototype.writeBigUInt64LE=Ut(function(g,y=0){return Lt(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Ut(function(g,y=0){return ee(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(g,y,O,$){if(g=+g,y=y>>>0,!$){const Ee=Math.pow(2,8*O-1);ct(this,g,y,O,Ee-1,-Ee)}let tt=0,rt=1,Dt=0;for(this[y]=g&255;++tt<O&&(rt*=256);)g<0&&Dt===0&&this[y+tt-1]!==0&&(Dt=1),this[y+tt]=(g/rt>>0)-Dt&255;return y+O},l.prototype.writeIntBE=function(g,y,O,$){if(g=+g,y=y>>>0,!$){const Ee=Math.pow(2,8*O-1);ct(this,g,y,O,Ee-1,-Ee)}let tt=O-1,rt=1,Dt=0;for(this[y+tt]=g&255;--tt>=0&&(rt*=256);)g<0&&Dt===0&&this[y+tt+1]!==0&&(Dt=1),this[y+tt]=(g/rt>>0)-Dt&255;return y+O},l.prototype.writeInt8=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,1,127,-128),g<0&&(g=255+g+1),this[y]=g&255,y+1},l.prototype.writeInt16LE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,2,32767,-32768),this[y]=g&255,this[y+1]=g>>>8,y+2},l.prototype.writeInt16BE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,2,32767,-32768),this[y]=g>>>8,this[y+1]=g&255,y+2},l.prototype.writeInt32LE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,4,2147483647,-2147483648),this[y]=g&255,this[y+1]=g>>>8,this[y+2]=g>>>16,this[y+3]=g>>>24,y+4},l.prototype.writeInt32BE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4},l.prototype.writeBigInt64LE=Ut(function(g,y=0){return Lt(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Ut(function(g,y=0){return ee(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function At(A,g,y,O,$,tt){if(y+O>A.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function kt(A,g,y,O,$){return g=+g,y=y>>>0,$||At(A,g,y,4),n.write(A,g,y,O,23,4),y+4}l.prototype.writeFloatLE=function(g,y,O){return kt(this,g,y,!0,O)},l.prototype.writeFloatBE=function(g,y,O){return kt(this,g,y,!1,O)};function zt(A,g,y,O,$){return g=+g,y=y>>>0,$||At(A,g,y,8),n.write(A,g,y,O,52,8),y+8}l.prototype.writeDoubleLE=function(g,y,O){return zt(this,g,y,!0,O)},l.prototype.writeDoubleBE=function(g,y,O){return zt(this,g,y,!1,O)},l.prototype.copy=function(g,y,O,$){if(!l.isBuffer(g))throw new TypeError("argument should be a Buffer");if(O||(O=0),!$&&$!==0&&($=this.length),y>=g.length&&(y=g.length),y||(y=0),$>0&&$<O&&($=O),$===O||g.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(O<0||O>=this.length)throw new RangeError("Index out of range");if($<0)throw new RangeError("sourceEnd out of bounds");$>this.length&&($=this.length),g.length-y<$-O&&($=g.length-y+O);const tt=$-O;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(y,O,$):s.prototype.set.call(g,this.subarray(O,$),y),tt},l.prototype.fill=function(g,y,O,$){if(typeof g=="string"){if(typeof y=="string"?($=y,y=0,O=this.length):typeof O=="string"&&($=O,O=this.length),$!==void 0&&typeof $!="string")throw new TypeError("encoding must be a string");if(typeof $=="string"&&!l.isEncoding($))throw new TypeError("Unknown encoding: "+$);if(g.length===1){const rt=g.charCodeAt(0);($==="utf8"&&rt<128||$==="latin1")&&(g=rt)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(y<0||this.length<y||this.length<O)throw new RangeError("Out of range index");if(O<=y)return this;y=y>>>0,O=O===void 0?this.length:O>>>0,g||(g=0);let tt;if(typeof g=="number")for(tt=y;tt<O;++tt)this[tt]=g;else{const rt=l.isBuffer(g)?g:l.from(g,$),Dt=rt.length;if(Dt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(tt=0;tt<O-y;++tt)this[tt+y]=rt[tt%Dt]}return this};const Gt={};function be(A,g,y){Gt[A]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${A}]`,this.stack,delete this.name}get code(){return A}set code($){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:$,writable:!0})}toString(){return`${this.name} [${A}]: ${this.message}`}}}be("ERR_BUFFER_OUT_OF_BOUNDS",function(A){return A?`${A} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),be("ERR_INVALID_ARG_TYPE",function(A,g){return`The "${A}" argument must be of type number. Received type ${typeof g}`},TypeError),be("ERR_OUT_OF_RANGE",function(A,g,y){let O=`The value of "${A}" is out of range.`,$=y;return Number.isInteger(y)&&Math.abs(y)>2**32?$=Oe(String(y)):typeof y=="bigint"&&($=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&($=Oe($)),$+="n"),O+=` It must be ${g}. Received ${$}`,O},RangeError);function Oe(A){let g="",y=A.length;const O=A[0]==="-"?1:0;for(;y>=O+4;y-=3)g=`_${A.slice(y-3,y)}${g}`;return`${A.slice(0,y)}${g}`}function b(A,g,y){nt(g,"offset"),(A[g]===void 0||A[g+y]===void 0)&&F(g,A.length-(y+1))}function st(A,g,y,O,$,tt){if(A>y||A<g){const rt=typeof g=="bigint"?"n":"";let Dt;throw g===0||g===BigInt(0)?Dt=`>= 0${rt} and < 2${rt} ** ${(tt+1)*8}${rt}`:Dt=`>= -(2${rt} ** ${(tt+1)*8-1}${rt}) and < 2 ** ${(tt+1)*8-1}${rt}`,new Gt.ERR_OUT_OF_RANGE("value",Dt,A)}b(O,$,tt)}function nt(A,g){if(typeof A!="number")throw new Gt.ERR_INVALID_ARG_TYPE(g,"number",A)}function F(A,g,y){throw Math.floor(A)!==A?(nt(A,y),new Gt.ERR_OUT_OF_RANGE("offset","an integer",A)):g<0?new Gt.ERR_BUFFER_OUT_OF_BOUNDS:new Gt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,A)}const M=/[^+/0-9A-Za-z-_]/g;function H(A){if(A=A.split("=")[0],A=A.trim().replace(M,""),A.length<2)return"";for(;A.length%4!==0;)A=A+"=";return A}function at(A,g){g=g||1/0;let y;const O=A.length;let $=null;const tt=[];for(let rt=0;rt<O;++rt){if(y=A.charCodeAt(rt),y>55295&&y<57344){if(!$){if(y>56319){(g-=3)>-1&&tt.push(239,191,189);continue}else if(rt+1===O){(g-=3)>-1&&tt.push(239,191,189);continue}$=y;continue}if(y<56320){(g-=3)>-1&&tt.push(239,191,189),$=y;continue}y=($-55296<<10|y-56320)+65536}else $&&(g-=3)>-1&&tt.push(239,191,189);if($=null,y<128){if((g-=1)<0)break;tt.push(y)}else if(y<2048){if((g-=2)<0)break;tt.push(y>>6|192,y&63|128)}else if(y<65536){if((g-=3)<0)break;tt.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((g-=4)<0)break;tt.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return tt}function ht(A){const g=[];for(let y=0;y<A.length;++y)g.push(A.charCodeAt(y)&255);return g}function Q(A,g){let y,O,$;const tt=[];for(let rt=0;rt<A.length&&!((g-=2)<0);++rt)y=A.charCodeAt(rt),O=y>>8,$=y%256,tt.push($),tt.push(O);return tt}function pt(A){return t.toByteArray(H(A))}function _t(A,g,y,O){let $;for($=0;$<O&&!($+y>=g.length||$>=A.length);++$)g[$+y]=A[$];return $}function dt(A,g){return A instanceof g||A!=null&&A.constructor!=null&&A.constructor.name!=null&&A.constructor.name===g.name}function vt(A){return A!==A}const ue=function(){const A="0123456789abcdef",g=new Array(256);for(let y=0;y<16;++y){const O=y*16;for(let $=0;$<16;++$)g[O+$]=A[y]+A[$]}return g}();function Ut(A){return typeof BigInt>"u"?Un:A}function Un(){throw new Error("BigInt not supported")}})(lp);const tn=lp.Buffer;function Sw(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var hp={exports:{}},Le=hp.exports={},Rr,Ir;function ku(){throw new Error("setTimeout has not been defined")}function Tu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Rr=setTimeout:Rr=ku}catch{Rr=ku}try{typeof clearTimeout=="function"?Ir=clearTimeout:Ir=Tu}catch{Ir=Tu}})();function fp(e){if(Rr===setTimeout)return setTimeout(e,0);if((Rr===ku||!Rr)&&setTimeout)return Rr=setTimeout,setTimeout(e,0);try{return Rr(e,0)}catch{try{return Rr.call(null,e,0)}catch{return Rr.call(this,e,0)}}}function Rw(e){if(Ir===clearTimeout)return clearTimeout(e);if((Ir===Tu||!Ir)&&clearTimeout)return Ir=clearTimeout,clearTimeout(e);try{return Ir(e)}catch{try{return Ir.call(null,e)}catch{return Ir.call(this,e)}}}var ri=[],Us=!1,es,Ka=-1;function Iw(){!Us||!es||(Us=!1,es.length?ri=es.concat(ri):Ka=-1,ri.length&&dp())}function dp(){if(!Us){var e=fp(Iw);Us=!0;for(var t=ri.length;t;){for(es=ri,ri=[];++Ka<t;)es&&es[Ka].run();Ka=-1,t=ri.length}es=null,Us=!1,Rw(e)}}Le.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];ri.push(new pp(e,t)),ri.length===1&&!Us&&fp(dp)};function pp(e,t){this.fun=e,this.array=t}pp.prototype.run=function(){this.fun.apply(null,this.array)},Le.title="browser",Le.browser=!0,Le.env={},Le.argv=[],Le.version="",Le.versions={};function ii(){}Le.on=ii,Le.addListener=ii,Le.once=ii,Le.off=ii,Le.removeListener=ii,Le.removeAllListeners=ii,Le.emit=ii,Le.prependListener=ii,Le.prependOnceListener=ii,Le.listeners=function(e){return[]},Le.binding=function(e){throw new Error("process.binding is not supported")},Le.cwd=function(){return"/"},Le.chdir=function(e){throw new Error("process.chdir is not supported")},Le.umask=function(){return 0};var Nw=hp.exports;const Ii=Sw(Nw),mp=e=>e===void 0?null:e;class Ow{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let gp=new Ow,Cw=!0;try{typeof localStorage<"u"&&localStorage&&(gp=localStorage,Cw=!1)}catch{}const Lw=gp,Mw=Object.assign,Uw=Object.keys,Fw=(e,t)=>{for(const n in e)t(e[n],n)},yp=e=>Uw(e).length,Bw=e=>{for(const t in e)return!1;return!0},Pw=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Dw=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),$w=(e,t)=>e===t||yp(e)===yp(t)&&Pw(e,(n,r)=>(n!==void 0||Dw(t,r))&&t[r]===n),jw=Object.freeze,_p=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&_p(e[t])}return jw(e)},Au=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Au(e,t,n+1)}},zw=e=>e,Ww=(e,t)=>t.includes(e);var bp={};const Oo=typeof Ii<"u"&&Ii.release&&/node|io\.js/.test(Ii.release.name)&&Object.prototype.toString.call(typeof Ii<"u"?Ii:0)==="[object process]";let Nr;const Kw=()=>{if(Nr===void 0)if(Oo){Nr=fr();const e=Ii.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Nr.set(t,""),t=r):t!==null&&(Nr.set(t,r),t=null)}t!==null&&Nr.set(t,"")}else typeof location=="object"?(Nr=fr(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Nr.set(`--${zd(t,"-")}`,n),Nr.set(`-${zd(t,"-")}`,n)}})):Nr=fr();return Nr},vu=e=>Kw().has(e),Ga=e=>mp(Oo?bp[e.toUpperCase().replaceAll("-","_")]:Lw.getItem(e)),Ep=e=>vu("--"+e)||Ga(e)!==null;Ep("production");const Gw=Oo&&Ww(bp.FORCE_COLOR,["true","1","2"])||!vu("--no-colors")&&!Ep("no-color")&&(!Oo||Ii.stdout.isTTY)&&(!Oo||vu("--color")||Ga("COLORTERM")!==null||(Ga("TERM")||"").includes("color")),Hw=e=>new Uint8Array(e),Yw=e=>{const t=Hw(e.byteLength);return t.set(e),t};class Vw{constructor(t,n){this.left=t,this.right=n}}const si=(e,t)=>new Vw(e,t);typeof DOMParser<"u"&&new DOMParser;const Xw=e=>dw(e,(t,n)=>`${n}:${t};`).join(""),oi=Symbol,wp=oi(),xp=oi(),qw=oi(),Jw=oi(),Zw=oi(),kp=oi(),Qw=oi(),Su=oi(),tx=oi(),ex=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},nx={[wp]:si("font-weight","bold"),[xp]:si("font-weight","normal"),[qw]:si("color","blue"),[Zw]:si("color","green"),[Jw]:si("color","grey"),[kp]:si("color","red"),[Qw]:si("color","purple"),[Su]:si("color","orange"),[tx]:si("color","black")},Tp=Gw?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=fr();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=nx[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=Xw(r);s>0||u.length>0?(t.push("%c"+a),n.push(u)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:ex,rx=(...e)=>{console.log(...Tp(e)),Ap.forEach(t=>t.print(e))},ix=(...e)=>{console.warn(...Tp(e)),e.unshift(Su),Ap.forEach(t=>t.print(e))},Ap=Rs(),vp=e=>({[Symbol.iterator](){return this},next:e}),sx=(e,t)=>vp(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Ru=(e,t)=>vp(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Iu{constructor(t,n){this.clock=t,this.len=n}}class Co{constructor(){this.clients=new Map}}const Sp=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];Gp(e,s,a.clock,a.len,n)}}),ox=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Ti((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},Rp=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&ox(n,t.clock)!==null},Nu=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=Qi(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},ax=e=>{const t=new Co;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)NE(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return Nu(t),t},Ha=(e,t,n,r)=>{Ri(e.clients,t,()=>[]).push(new Iu(n,r))},cx=()=>new Co,lx=e=>{const t=cx();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let u=n[s+1];s+1<n.length&&u.deleted;u=n[++s+1])c+=u.length;i.push(new Iu(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Fs=(e,t)=>{$t(e.restEncoder,t.clients.size),Ai(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),$t(e.restEncoder,n);const i=r.length;$t(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Ou=e=>{const t=new Co,n=jt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=jt(e.restDecoder),s=jt(e.restDecoder);if(s>0){const o=Ri(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Iu(e.readDsClock(),e.readDsLen()))}}return t},Ip=(e,t,n)=>{const r=new Co,i=jt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=jt(e.restDecoder),a=jt(e.restDecoder),c=n.clients.get(o)||[],u=Je(n,o);for(let l=0;l<a;l++){const h=e.readDsClock(),f=h+e.readDsLen();if(h<u){u<f&&Ha(r,o,u,f-u);let d=Or(c,h),p=c[d];for(!p.deleted&&p.id.clock<h&&(c.splice(d+1,0,ac(t,p,h-p.id.clock)),d++);d<c.length&&(p=c[d++],p.id.clock<f);)p.deleted||(f<p.id.clock+p.length&&c.splice(d,0,ac(t,p,f-p.id.clock)),p.delete(t))}else Ha(r,o,h,f-h)}}if(r.clients.size>0){const s=new ns;return $t(s.restEncoder,0),Fs(s,r),s.toUint8Array()}return null},Np=ap;class Bs extends mw{constructor({guid:t=_w(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Np(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new zp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=cp(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const c=()=>cp(u=>{const l=h=>{(h===void 0||h===!0)&&(this.off("sync",l),u())};this.on("sync",l)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&fe(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Ai(this.subdocs).map(t=>t.guid))}transact(t,n=null){return fe(this,t,n)}get(t,n=en){const r=Ri(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==en&&i!==n)if(i===en){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,js)}getText(t=""){return this.get(t,ai)}getMap(t=""){return this.get(t,zs)}getXmlElement(t=""){return this.get(t,Ks)}getXmlFragment(t=""){return this.get(t,rs)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Ai(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Bs({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,fe(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Op{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return jt(this.restDecoder)}readDsLen(){return jt(this.restDecoder)}}class Cp extends Op{readLeftID(){return qt(jt(this.restDecoder),jt(this.restDecoder))}readRightID(){return qt(jt(this.restDecoder),jt(this.restDecoder))}readClient(){return jt(this.restDecoder)}readInfo(){return Ns(this.restDecoder)}readString(){return Os(this.restDecoder)}readParentInfo(){return jt(this.restDecoder)===1}readTypeRef(){return jt(this.restDecoder)}readLen(){return jt(this.restDecoder)}readAny(){return Io(this.restDecoder)}readBuf(){return Yw(dn(this.restDecoder))}readJSON(){return JSON.parse(Os(this.restDecoder))}readKey(){return Os(this.restDecoder)}}class ux{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=jt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=jt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Ps extends ux{constructor(t){super(t),this.keys=[],jt(t),this.keyClockDecoder=new pu(dn(t)),this.clientDecoder=new Da(dn(t)),this.leftClockDecoder=new pu(dn(t)),this.rightClockDecoder=new pu(dn(t)),this.infoDecoder=new Xd(dn(t),Ns),this.stringDecoder=new JE(dn(t)),this.parentInfoDecoder=new Xd(dn(t),Ns),this.typeRefDecoder=new Da(dn(t)),this.lenDecoder=new Da(dn(t))}readLeftID(){return new Ds(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Ds(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Io(this.restDecoder)}readBuf(){return dn(this.restDecoder)}readJSON(){return Io(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Lp{constructor(){this.restEncoder=Si()}toUint8Array(){return hr(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){$t(this.restEncoder,t)}writeDsLen(t){$t(this.restEncoder,t)}}class Lo extends Lp{writeLeftID(t){$t(this.restEncoder,t.client),$t(this.restEncoder,t.clock)}writeRightID(t){$t(this.restEncoder,t.client),$t(this.restEncoder,t.clock)}writeClient(t){$t(this.restEncoder,t)}writeInfo(t){au(this.restEncoder,t)}writeString(t){Is(this.restEncoder,t)}writeParentInfo(t){$t(this.restEncoder,t?1:0)}writeTypeRef(t){$t(this.restEncoder,t)}writeLen(t){$t(this.restEncoder,t)}writeAny(t){Ro(this.restEncoder,t)}writeBuf(t){on(this.restEncoder,t)}writeJSON(t){Is(this.restEncoder,JSON.stringify(t))}writeKey(t){Is(this.restEncoder,t)}}class Mp{constructor(){this.restEncoder=Si(),this.dsCurrVal=0}toUint8Array(){return hr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,$t(this.restEncoder,n)}writeDsLen(t){t===0&&vr(),$t(this.restEncoder,t-1),this.dsCurrVal+=t}}class ns extends Mp{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new hu,this.clientEncoder=new Ba,this.leftClockEncoder=new hu,this.rightClockEncoder=new hu,this.infoEncoder=new Kd(au),this.stringEncoder=new YE,this.parentInfoEncoder=new Kd(au),this.typeRefEncoder=new Ba,this.lenEncoder=new Ba}toUint8Array(){const t=Si();return $t(t,0),on(t,this.keyClockEncoder.toUint8Array()),on(t,this.clientEncoder.toUint8Array()),on(t,this.leftClockEncoder.toUint8Array()),on(t,this.rightClockEncoder.toUint8Array()),on(t,hr(this.infoEncoder)),on(t,this.stringEncoder.toUint8Array()),on(t,hr(this.parentInfoEncoder)),on(t,this.typeRefEncoder.toUint8Array()),on(t,this.lenEncoder.toUint8Array()),Fa(t,hr(this.restEncoder)),hr(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Ro(this.restEncoder,t)}writeBuf(t){on(this.restEncoder,t)}writeJSON(t){Ro(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const hx=(e,t,n,r)=>{r=Qi(r,t[0].id.clock);const i=Or(t,r);$t(e.restEncoder,t.length-i),e.writeClient(n),$t(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},Cu=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{Je(t,s)>i&&r.set(s,i)}),Va(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),$t(e.restEncoder,r.size),Ai(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{hx(e,t.clients.get(i),i,s)})},fx=(e,t)=>{const n=fr(),r=jt(e.restDecoder);for(let i=0;i<r;i++){const s=jt(e.restDecoder),o=new Array(s),a=e.readClient();let c=jt(e.restDecoder);n.set(a,{i:0,refs:o});for(let u=0;u<s;u++){const l=e.readInfo();switch(Ma&l){case 0:{const h=e.readLen();o[u]=new Vn(qt(a,c),h),c+=h;break}case 10:{const h=jt(e.restDecoder);o[u]=new Xn(qt(a,c),h),c+=h;break}default:{const h=(l&(ni|Bn))===0,f=new ze(qt(a,c),null,(l&Bn)===Bn?e.readLeftID():null,null,(l&ni)===ni?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(l&To)===To?e.readString():null,g0(e,l));o[u]=f,c+=f.length}}}}return n},dx=(e,t,n)=>{const r=[];let i=Ai(n.keys()).sort((d,p)=>d-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let d=n.get(i[i.length-1]);for(;d.refs.length===d.i;)if(i.pop(),i.length>0)d=n.get(i[i.length-1]);else return null;return d};let o=s();if(o===null)return null;const a=new zp,c=new Map,u=(d,p)=>{const m=c.get(d);(m==null||m>p)&&c.set(d,p)};let l=o.refs[o.i++];const h=new Map,f=()=>{for(const d of r){const p=d.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[d]),i=i.filter(w=>w!==p)}r.length=0};for(;;){if(l.constructor!==Xn){const p=Ri(h,l.id.client,()=>Je(t,l.id.client))-l.id.clock;if(p<0)r.push(l),u(l.id.client,l.id.clock-1),f();else{const m=l.getMissing(e,t);if(m!==null){r.push(l);const w=n.get(m)||{refs:[],i:0};if(w.refs.length===w.i)u(m,Je(t,m)),f();else{l=w.refs[w.i++];continue}}else(p===0||p<l.length)&&(l.integrate(e,p),h.set(l.id.client,l.id.clock+l.length))}}if(r.length>0)l=r.pop();else if(o!==null&&o.i<o.refs.length)l=o.refs[o.i++];else{if(o=s(),o===null)break;l=o.refs[o.i++]}}if(a.clients.size>0){const d=new ns;return Cu(d,a,new Map),$t(d.restEncoder,0),{missing:c,update:d.toUint8Array()}}return null},px=(e,t)=>Cu(e,t.doc.store,t.beforeState),mx=(e,t,n,r=new Ps(e))=>fe(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=fx(r,o),u=dx(i,a,c),l=a.pendingStructs;if(l){for(const[f,d]of l.missing)if(d<Je(a,f)){s=!0;break}if(u){for(const[f,d]of u.missing){const p=l.missing.get(f);(p==null||p>d)&&l.missing.set(f,d)}l.update=qa([l.update,u.update])}}else a.pendingStructs=u;const h=Ip(r,i,a);if(a.pendingDs){const f=new Ps(ts(a.pendingDs));jt(f.restDecoder);const d=Ip(f,i,a);h&&d?a.pendingDs=qa([h,d]):a.pendingDs=h||d}else a.pendingDs=h;if(s){const f=a.pendingStructs.update;a.pendingStructs=null,Up(i.doc,f)}},n,!1),Up=(e,t,n,r=Ps)=>{const i=ts(t);mx(i,e,n,new r(i))},gx=(e,t,n)=>Up(e,t,n,Cp),yx=(e,t,n=new Map)=>{Cu(e,t.store,n),Fs(e,lx(t.store))},_x=(e,t=new Uint8Array([0]),n=new ns)=>{const r=Fp(t);yx(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(Lx(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===Lo)return Ox(i.map((s,o)=>o===0?s:Ux(s)));if(n.constructor===ns)return qa(i)}return i[0]},bx=(e,t)=>_x(e,t,new Lo),Ex=e=>{const t=new Map,n=jt(e.restDecoder);for(let r=0;r<n;r++){const i=jt(e.restDecoder),s=jt(e.restDecoder);t.set(i,s)}return t},Fp=e=>Ex(new Op(ts(e))),Bp=(e,t)=>($t(e.restEncoder,t.size),Ai(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{$t(e.restEncoder,n),$t(e.restEncoder,r)}),e),wx=(e,t)=>Bp(e,Va(t.store)),xx=(e,t=new Mp)=>(e instanceof Map?Bp(t,e):wx(t,e),t.toUint8Array()),kx=e=>xx(e,new Lp);class Tx{constructor(){this.l=[]}}const Pp=()=>new Tx,Dp=(e,t)=>e.l.push(t),$p=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},jp=(e,t,n)=>Au(e.l,[t,n]);class Ds{constructor(t,n){this.client=t,this.clock=n}}const Ya=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,qt=(e,t)=>new Ds(e,t),Ax=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw vr()},$s=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Rp(t.ds,e.id),Lu=(e,t)=>{const n=Ri(e.meta,Lu,Rs),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<Je(r,s)&&Ni(e,qt(s,i))}),Sp(e,t.ds,i=>{}),n.add(t))};class zp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Va=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},Je=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Wp=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw vr()}n.push(t)},Or=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=Ti(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=Ti((n+r)/2)}throw vr()},Mu=(e,t)=>{const n=e.clients.get(t.client);return n[Or(n,t.clock)]},Uu=(e,t,n)=>{const r=Or(t,n),i=t[r];return i.id.clock<n&&i instanceof ze?(t.splice(r+1,0,ac(e,i,n-i.id.clock)),r+1):r},Ni=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Uu(e,n,t.clock)]},Kp=(e,t,n)=>{const r=t.clients.get(n.client),i=Or(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Vn&&r.splice(i+1,0,ac(e,s,n.clock-s.id.clock+1)),s},vx=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Or(r,t.id.clock)]=n},Gp=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=Uu(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&Uu(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class Sx{constructor(t,n,r){this.doc=t,this.deleteSet=new Co,this.beforeState=Va(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Hp=(e,t)=>t.deleteSet.clients.size===0&&!pw(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Nu(t.deleteSet),px(e,t),Fs(e,t.deleteSet),!0),Yp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Ri(e.changed,t,Rs).add(n)},Xa=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof ze&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},Rx=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let u=Or(s,a.clock),l=s[u];u<s.length&&l.id.clock<c;l=s[++u]){const h=s[u];if(a.clock+a.len<=h.id.clock)break;h instanceof ze&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},Ix=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Dd(i.length-1,1+Or(i,o.clock+o.len-1));for(let c=a,u=i[c];c>0&&u.id.clock>=o.clock;u=i[c])c-=1+Xa(i,c)}})},Vp=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Nu(s),n.afterState=Va(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u,l._path=null}),c.sort((l,h)=>l.path.length-h.path.length),jp(u._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Au(a,[]),n._needFormattingCleanup&&Xx(n)}finally{r.gc&&Rx(s,i,r.gcFilter),Ix(s,i),n.afterState.forEach((l,h)=>{const f=n.beforeState.get(h)||0;if(f!==l){const d=i.clients.get(h),p=Qi(Or(d,f),1);for(let m=d.length-1;m>=p;)m-=1+Xa(d,m)}});for(let l=o.length-1;l>=0;l--){const{client:h,clock:f}=o[l].id,d=i.clients.get(h),p=Or(d,f);p+1<d.length&&Xa(d,p+1)>1||p>0&&Xa(d,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(rx(Su,wp,"[yjs] ",xp,kp,"Changed the client-id because another client seems to be using it."),r.clientID=Np()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const l=new Lo;Hp(l,n)&&r.emit("update",[l.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const l=new ns;Hp(l,n)&&r.emit("updateV2",[l.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:u}=n;(a.size>0||u.size>0||c.size>0)&&(a.forEach(l=>{l.clientID=r.clientID,l.collectionid==null&&(l.collectionid=r.collectionid),r.subdocs.add(l)}),u.forEach(l=>r.subdocs.delete(l)),r.emit("subdocs",[{loaded:c,added:a,removed:u},r,n]),u.forEach(l=>l.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Vp(e,t+1)}}},fe=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new Sx(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&Vp(i,0)}}return o};function*Nx(e){const t=jt(e.restDecoder);for(let n=0;n<t;n++){const r=jt(e.restDecoder),i=e.readClient();let s=jt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=jt(e.restDecoder);yield new Xn(qt(i,s),c),s+=c}else if(Ma&a){const c=(a&(ni|Bn))===0,u=new ze(qt(i,s),null,(a&Bn)===Bn?e.readLeftID():null,null,(a&ni)===ni?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&To)===To?e.readString():null,g0(e,a));yield u,s+=u.length}else{const c=e.readLen();yield new Vn(qt(i,s),c),s+=c}}}}class Fu{constructor(t,n){this.gen=Nx(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Xn);return this.curr}}class Bu{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Ox=e=>qa(e,Cp,Lo),Cx=(e,t)=>{if(e.constructor===Vn){const{client:n,clock:r}=e.id;return new Vn(qt(n,r+t),e.length-t)}else if(e.constructor===Xn){const{client:n,clock:r}=e.id;return new Xn(qt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new ze(qt(r,i+t),null,qt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},qa=(e,t=Ps,n=ns)=>{if(e.length===1)return e[0];const r=e.map(l=>new t(ts(l)));let i=r.map(l=>new Fu(l,!0)),s=null;const o=new n,a=new Bu(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,d)=>{if(f.curr.id.client===d.curr.id.client){const p=f.curr.id.clock-d.curr.id.clock;return p===0?f.curr.constructor===d.curr.constructor?0:f.curr.constructor===Xn?1:-1:p}else return d.curr.id.client-f.curr.id.client}),i.length!==0;){const l=i[0],h=l.curr.id.client;if(s!==null){let f=l.curr,d=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=l.next(),d=!0;if(f===null||f.id.client!==h||d&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Oi(a,s.struct,s.offset),s={struct:f,offset:0},l.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===Xn)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{Oi(a,s.struct,s.offset);const p=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Xn(qt(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-f.id.clock;p>0&&(s.struct.constructor===Xn?s.struct.length-=p:f=Cx(f,p)),s.struct.mergeWith(f)||(Oi(a,s.struct,s.offset),s={struct:f,offset:0},l.next())}}else s={struct:l.curr,offset:0},l.next();for(let f=l.curr;f!==null&&f.id.client===h&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==Xn;f=l.next())Oi(a,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(Oi(a,s.struct,s.offset),s=null),Pu(a);const c=r.map(l=>Ou(l)),u=ax(c);return Fs(o,u),o.toUint8Array()},Lx=(e,t,n=Ps,r=ns)=>{const i=Fp(t),s=new r,o=new Bu(s),a=new n(ts(e)),c=new Fu(a,!1);for(;c.curr;){const l=c.curr,h=l.id.client,f=i.get(h)||0;if(c.curr.constructor===Xn){c.next();continue}if(l.id.clock+l.length>f)for(Oi(o,l,Qi(f-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Oi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=f;)c.next()}Pu(o);const u=Ou(a);return Fs(s,u),s.toUint8Array()},Xp=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:hr(e.encoder.restEncoder)}),e.encoder.restEncoder=Si(),e.written=0)},Oi=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Xp(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),$t(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Pu=e=>{Xp(e);const t=e.encoder.restEncoder;$t(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];$t(t,r.written),Fa(t,r.restEncoder)}},Mx=(e,t,n,r)=>{const i=new n(ts(e)),s=new Fu(i,!1),o=new r,a=new Bu(o);for(let u=s.curr;u!==null;u=s.next())Oi(a,t(u),0);Pu(a);const c=Ou(i);return Fs(o,c),o.toUint8Array()},Ux=e=>Mx(e,zw,Ps,Lo),qp="You must not compute changes after the event-handler fired.";class Ja{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Fx(this.currentTarget,this.target))}deletes(t){return Rp(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw vi(qp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=ou(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=ou(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=ou(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw vi(qp);const n=this.target,r=Rs(),i=Rs(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=u.length,i.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const Fx=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},an=()=>{ix("Invalid access: Add Yjs type to a document before reading data.")},Jp=80;let Du=0;class Bx{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Du++}}const Px=e=>{e.timestamp=Du++},Zp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Du++},Dx=(e,t,n)=>{if(e.length>=Jp){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Zp(r,t,n),r}else{const r=new Bx(t,n);return e.push(r),r}},Za=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Ua(t-s.index)<Ua(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,Px(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Ua(n.index-i)<r.parent.length/Jp?(Zp(n,r,i),n):Dx(e._searchMarker,r,i)},Mo=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=Qi(t,i.index+n))}},Qa=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;Ri(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;jp(r._eH,n,t)};class en{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Pp(),this._dEH=Pp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Ar()}clone(){throw Ar()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Dp(this._eH,t)}observeDeep(t){Dp(this._dEH,t)}unobserve(t){$p(this._eH,t)}unobserveDeep(t){$p(this._dEH,t)}toJSON(){}}const Qp=(e,t,n)=>{e.doc??an(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},t0=e=>{e.doc??an();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Uo=(e,t)=>{let n=0,r=e._start;for(e.doc??an();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},e0=(e,t)=>{const n=[];return Uo(e,(r,i)=>{n.push(t(r,i,e))}),n},$x=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},n0=(e,t)=>{e.doc??an();const n=Za(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},tc=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let u=[];const l=()=>{u.length>0&&(i=new ze(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ss(u)),i.integrate(e,0),u=[])};r.forEach(h=>{if(h===null)u.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(h);break;default:switch(l(),h.constructor){case Uint8Array:case ArrayBuffer:i=new ze(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Fo(new Uint8Array(h))),i.integrate(e,0);break;case Bs:i=new ze(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Po(h)),i.integrate(e,0);break;default:if(h instanceof en)i=new ze(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ci(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},r0=()=>vi("Length exceeded!"),i0=(e,t,n,r)=>{if(n>t._length)throw r0();if(n===0)return t._searchMarker&&Mo(t._searchMarker,n,r.length),tc(e,t,null,r);const i=n,s=Za(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Ni(e,qt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Mo(t._searchMarker,i,r.length),tc(e,t,o,r)},jx=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return tc(e,t,i,n)},s0=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=Za(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Ni(e,qt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Ni(e,qt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw r0();t._searchMarker&&Mo(t._searchMarker,i,-s+r)},ec=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},$u=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new ss([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ss([r]);break;case Uint8Array:a=new Fo(r);break;case Bs:a=new Po(r);break;default:if(r instanceof en)a=new ci(r);else throw new Error("Unexpected content type")}new ze(qt(o,Je(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},ju=(e,t)=>{e.doc??an();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},o0=e=>{const t={};return e.doc??an(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},a0=(e,t)=>{e.doc??an();const n=e._map.get(t);return n!==void 0&&!n.deleted},zx=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&$s(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},nc=e=>(e.doc??an(),sx(e._map.entries(),t=>!t[1].deleted));class Wx extends Ja{}class js extends en{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new js;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new js}clone(){const t=new js;return t.insert(0,this.toArray().map(n=>n instanceof en?n.clone():n)),t}get length(){return this.doc??an(),this._length}_callObserver(t,n){super._callObserver(t,n),Qa(this,t,new Wx(this,t))}insert(t,n){this.doc!==null?fe(this.doc,r=>{i0(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?fe(this.doc,n=>{jx(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?fe(this.doc,r=>{s0(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return n0(this,t)}toArray(){return t0(this)}slice(t=0,n=this.length){return Qp(this,t,n)}toJSON(){return this.map(t=>t instanceof en?t.toJSON():t)}map(t){return e0(this,t)}forEach(t){Uo(this,t)}[Symbol.iterator](){return $x(this)}_write(t){t.writeTypeRef(pk)}}const Kx=e=>new js;class Gx extends Ja{constructor(t,n,r){super(t,n),this.keysChanged=r}}class zs extends en{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new zs}clone(){const t=new zs;return this.forEach((n,r)=>{t.set(r,n instanceof en?n.clone():n)}),t}_callObserver(t,n){Qa(this,t,new Gx(this,t,n))}toJSON(){this.doc??an();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof en?i.toJSON():i}}),t}get size(){return[...nc(this)].length}keys(){return Ru(nc(this),t=>t[0])}values(){return Ru(nc(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Ru(nc(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??an(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?fe(this.doc,n=>{ec(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?fe(this.doc,r=>{$u(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return ju(this,t)}has(t){return a0(this,t)}clear(){this.doc!==null?fe(this.doc,t=>{this.forEach(function(n,r,i){ec(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(mk)}}const Hx=e=>new zs,Ci=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&$w(e,t);class zu{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&vr(),this.right.content.constructor){case je:this.right.deleted||Ws(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const c0=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case je:t.right.deleted||Ws(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Ni(e,qt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},rc=(e,t,n,r)=>{const i=new Map,s=r?Za(t,n):null;if(s){const o=new zu(s.p.left,s.p,s.index,i);return c0(e,o,n-s.index)}else{const o=new zu(null,t._start,0,i);return c0(e,o,n)}},l0=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===je&&Ci(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,u=n.right,l=new ze(qt(s,Je(i.store,s)),c,c&&c.lastId,u,u&&u.id,t,null,new je(a,o));l.integrate(e,0),n.right=l,n.forward()})},Ws=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},u0=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===je&&Ci(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},h0=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],u=n.currentAttributes.get(a)??null;if(!Ci(u,c)){o.set(a,u);const{left:l,right:h}=n;n.right=new ze(qt(s,Je(i.store,s)),l,l&&l.lastId,h,h&&h.id,t,null,new je(a,c)),n.right.integrate(e,0),n.forward()}}return o},Wu=(e,t,n,r,i)=>{n.currentAttributes.forEach((f,d)=>{i[d]===void 0&&(i[d]=null)});const s=e.doc,o=s.clientID;u0(n,i);const a=h0(e,t,n,i),c=r.constructor===String?new Cr(r):r instanceof en?new ci(r):new is(r);let{left:u,right:l,index:h}=n;t._searchMarker&&Mo(t._searchMarker,n.index,c.getLength()),l=new ze(qt(o,Je(s.store,o)),u,u&&u.lastId,l,l&&l.id,t,null,c),l.integrate(e,0),n.right=l,n.index=h,n.forward(),l0(e,t,n,a)},f0=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;u0(n,i);const a=h0(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===je));){if(!n.right.deleted)switch(n.right.content.constructor){case je:{const{key:c,value:u}=n.right.content,l=i[c];if(l!==void 0){if(Ci(l,u))a.delete(c);else{if(r===0)break t;a.set(c,u)}n.right.delete(e)}else n.currentAttributes.set(c,u);break}default:r<n.right.length&&Ni(e,qt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new ze(qt(o,Je(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Cr(c)),n.right.integrate(e,0),n.forward()}l0(e,t,n,a)},d0=(e,t,n,r,i)=>{let s=t;const o=fr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===je){const u=s.content;o.set(u.key,u)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const u=t.content;switch(u.constructor){case je:{const{key:l,value:h}=u,f=r.get(l)??null;(o.get(l)!==u||f===h)&&(t.delete(e),a++,!c&&(i.get(l)??null)===h&&f!==h&&(f===null?i.delete(l):i.set(l,f))),!c&&!t.deleted&&Ws(i,u);break}}}t=t.right}return a},Yx=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===je){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},Vx=e=>{let t=0;return fe(e.doc,n=>{let r=e._start,i=e._start,s=fr();const o=Eu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case je:Ws(o,i.content);break;default:t+=d0(n,r,i,s,o),s=Eu(o),r=i;break}i=i.right}}),t},Xx=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&Gp(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===je&&o.constructor!==Vn&&t.add(o.parent)})}fe(n,r=>{Sp(e,e.deleteSet,i=>{if(i instanceof Vn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===je?t.add(s):Yx(r,i)});for(const i of t)Vx(i)})},p0=(e,t,n)=>{const r=n,i=Eu(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case ci:case is:case Cr:n<t.right.length&&Ni(e,qt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&d0(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Mo(o._searchMarker,t.index,-r+n),t};class qx extends Ja{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];fe(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let u="",l=0,h=0;const f=()=>{if(a!==null){let d=null;switch(a){case"delete":h>0&&(d={delete:h}),h=0;break;case"insert":(typeof u=="object"||u.length>0)&&(d={insert:u},i.size>0&&(d.attributes={},i.forEach((p,m)=>{p!==null&&(d.attributes[m]=p)}))),u="";break;case"retain":l>0&&(d={retain:l},Bw(c)||(d.attributes=Mw({},c))),l=0;break}d&&n.push(d),a=null}};for(;o!==null;){switch(o.content.constructor){case ci:case is:this.adds(o)?this.deletes(o)||(f(),a="insert",u=o.content.getContent()[0],f()):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=1);break;case Cr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(f(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=o.length);break;case je:{const{key:d,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(d)??null;Ci(m,p)?p!==null&&o.delete(r):(a==="retain"&&f(),Ci(p,s.get(d)??null)?delete c[d]:c[d]=p)}}else if(this.deletes(o)){s.set(d,p);const m=i.get(d)??null;Ci(m,p)||(a==="retain"&&f(),c[d]=m)}else if(!o.deleted){s.set(d,p);const m=c[d];m!==void 0&&(Ci(m,p)?m!==null&&o.delete(r):(a==="retain"&&f(),p===null?delete c[d]:c[d]=p))}o.deleted||(a==="insert"&&f(),Ws(i,o.content));break}}o=o.right}for(f();n.length>0;){const d=n[n.length-1];if(d.retain!==void 0&&d.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class ai extends en{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??an(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new ai}clone(){const t=new ai;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new qx(this,t,n);Qa(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??an();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Cr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?fe(this.doc,r=>{const i=new zu(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Wu(r,this,i,a,o.attributes||{})}else o.retain!==void 0?f0(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&p0(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??an();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function u(){if(a.length>0){const h={};let f=!1;s.forEach((p,m)=>{f=!0,h[m]=p});const d={insert:a};f&&(d.attributes=h),i.push(d),a=""}}const l=()=>{for(;c!==null;){if($s(c,t)||n!==void 0&&$s(c,n))switch(c.content.constructor){case Cr:{const h=s.get("ychange");t!==void 0&&!$s(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(u(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!$s(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(u(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(u(),s.delete("ychange")),a+=c.content.str;break}case ci:case is:{u();const h={insert:c.content.getContent()[0]};if(s.size>0){const f={};h.attributes=f,s.forEach((d,p)=>{f[p]=d})}i.push(h);break}case je:$s(c,t)&&(u(),Ws(s,c.content));break}c=c.right}u()};return t||n?fe(o,h=>{t&&Lu(h,t),n&&Lu(h,n),l()},"cleanup"):l(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?fe(i,s=>{const o=rc(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Wu(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?fe(i,s=>{const o=rc(s,this,t,!r);Wu(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?fe(r,i=>{p0(i,rc(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?fe(i,s=>{const o=rc(s,this,t,!1);o.right!==null&&f0(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?fe(this.doc,n=>{ec(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?fe(this.doc,r=>{$u(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return ju(this,t)}getAttributes(){return o0(this)}_write(t){t.writeTypeRef(gk)}}const Jx=e=>new ai;class Ku{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??an()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Ks||n.constructor===rs)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class rs extends en{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new rs}clone(){const t=new rs;return t.insert(0,this.toArray().map(n=>n instanceof en?n.clone():n)),t}get length(){return this.doc??an(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Ku(this,t)}querySelector(t){t=t.toUpperCase();const r=new Ku(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Ai(new Ku(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Qa(this,t,new tk(this,n,t))}toString(){return e0(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Uo(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?fe(this.doc,r=>{i0(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)fe(this.doc,r=>{const i=t&&t instanceof en?t._item:t;tc(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw vi("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?fe(this.doc,r=>{s0(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return t0(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return n0(this,t)}slice(t=0,n=this.length){return Qp(this,t,n)}forEach(t){Uo(this,t)}_write(t){t.writeTypeRef(_k)}}const Zx=e=>new rs;class Ks extends rs{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Ks(this.nodeName)}clone(){const t=new Ks(this.nodeName),n=this.getAttributes();return Fw(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof en?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?fe(this.doc,n=>{ec(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?fe(this.doc,r=>{$u(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return ju(this,t)}hasAttribute(t){return a0(this,t)}getAttributes(t){return t?zx(this,t):o0(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Uo(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(yk),t.writeKey(this.nodeName)}}const Qx=e=>new Ks(e.readKey());class tk extends Ja{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class ic extends zs{constructor(t){super(),this.hookName=t}_copy(){return new ic(this.hookName)}clone(){const t=new ic(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(bk),t.writeKey(this.hookName)}}const ek=e=>new ic(e.readKey());class sc extends ai{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new sc}clone(){const t=new sc;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Ek)}}const nk=e=>new sc;class Gu{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Ar()}mergeWith(t){return!1}write(t,n,r){throw Ar()}integrate(t,n){throw Ar()}}const rk=0;class Vn extends Gu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Wp(t.doc.store,this)}write(t,n){t.writeInfo(rk),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Fo{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Fo(this.content)}splice(t){throw Ar()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const ik=e=>new Fo(e.readBuf());class Bo{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Bo(this.len)}splice(t){const n=new Bo(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Ha(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const sk=e=>new Bo(e.readLen()),m0=(e,t)=>new Bs({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Po{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Po(m0(this.doc.guid,this.opts))}splice(t){throw Ar()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const ok=e=>new Po(m0(e.readString(),e.readAny()));class is{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new is(this.embed)}splice(t){throw Ar()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const ak=e=>new is(e.readJSON());class je{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new je(this.key,this.value)}splice(t){throw Ar()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const ck=e=>new je(e.readKey(),e.readJSON());class oc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new oc(this.arr)}splice(t){const n=new oc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const lk=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new oc(n)},uk=Ga("node_env")==="development";class ss{constructor(t){this.arr=t,uk&&_p(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ss(this.arr)}splice(t){const n=new ss(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const hk=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new ss(n)};class Cr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Cr(this.str)}splice(t){const n=new Cr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const fk=e=>new Cr(e.readString()),dk=[Kx,Hx,Jx,Qx,Zx,ek,nk],pk=0,mk=1,gk=2,yk=3,_k=4,bk=5,Ek=6;class ci{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ci(this.type._copy())}splice(t){throw Ar()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const wk=e=>new ci(dk[e.readTypeRef()](e)),ac=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new ze(qt(r,i+n),t,qt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=qt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class ze extends Gu{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Pd:0}set marker(t){(this.info&iu)>0!==t&&(this.info^=iu)}get marker(){return(this.info&iu)>0}get keep(){return(this.info&Bd)>0}set keep(t){this.keep!==t&&(this.info^=Bd)}get countable(){return(this.info&Pd)>0}get deleted(){return(this.info&ru)>0}set deleted(t){this.deleted!==t&&(this.info^=ru)}markDeleted(){this.info|=ru}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Je(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Je(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ds&&this.id.client!==this.parent.client&&this.parent.clock>=Je(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Kp(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Ni(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Vn||this.right&&this.right.constructor===Vn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Ds){const r=Mu(n,this.parent);r.constructor===Vn?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=Kp(t,t.doc.store,qt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Ya(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Ya(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Mu(t.doc.store,i.origin)))s.has(Mu(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Wp(t.doc.store,this),this.content.integrate(t,this),Yp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Vn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:qt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Ya(t.origin,this.lastId)&&this.right===t&&Ya(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Ha(t.deleteSet,this.id.client,this.id.clock,this.length),Yp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw vr();this.content.gc(t),n?vx(t,this,new Vn(this.id,this.length)):this.content=new Bo(this.length)}write(t,n){const r=n>0?qt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Ma|(r===null?0:Bn)|(i===null?0:ni)|(s===null?0:To);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const u=Ax(a);t.writeParentInfo(!0),t.writeString(u)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Ds?(t.writeParentInfo(!1),t.writeLeftID(a)):vr();s!==null&&t.writeString(s)}this.content.write(t,n)}}const g0=(e,t)=>xk[t&Ma](e),xk=[()=>{vr()},sk,lk,ik,fk,ak,ck,wk,hk,ok,()=>{vr()}],kk=10;class Xn extends Gu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){vr()}write(t,n){t.writeInfo(kk),$t(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const y0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ls<"u"?Ls:{},_0="__ $YJS$ __";y0[_0]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),y0[_0]=!0;const Hu=0,b0=1,E0=2,Tk=(e,t)=>{$t(e,Hu);const n=kx(t);on(e,n)},w0=(e,t,n)=>{$t(e,b0),on(e,bx(t,n))},Ak=(e,t,n)=>w0(t,n,dn(e)),x0=(e,t,n)=>{try{gx(t,dn(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},vk=(e,t)=>{$t(e,E0),on(e,t)},Sk=x0,Rk=(e,t,n,r)=>{const i=jt(e);switch(i){case Hu:Ak(e,t,n);break;case b0:x0(e,n,r);break;case E0:Sk(e,n,r);break;default:throw new Error("Unknown message type")}return i};let k0=!1;const Lr=new Bs;function T0(e,t,n){const r=Lr.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function Ik(e,t){T0(e,0,t)}function Yu(e,t){const n=new ai(t);T0(e,1,n)}function Nk(e,t){Lr.getMap().set(e,t)}function Ok(e,t){const n=Lr.getMap(),r=new ai(t);n.set(e,r)}function A0(e,t){const n=Lr.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function Ck(e,t){return A0(e,n=>{Ct(n)&&t(n)})}function v0(e,t){return A0(e,n=>{n instanceof ai&&t(n.toJSON())})}function cc(e){return hr(e)}const qn=Ss("modem",["second"],e=>{if(qn.session(e))switch(e.target){case"second":!k0&&e.data%2===0&&qn.emit("modem:join");break;case"join":if(e.sender!==qn.id()){qn.reply(e,"joinack");const t=Si();Tk(t,Lr),qn.reply(e,"sync",cc(t));const n=Si();w0(n,Lr),qn.reply(e,"sync",cc(n))}break;case"joinack":e.sender!==qn.id()&&(k0=!0);break;case"sync":{if(e.sender!==qn.id()&&x(e.data))try{const t=ts(e.data),n=Si();Rk(t,n,Lr,qn)===Hu&&qn.emit("modem:sync",cc(n))}catch(t){le(qn,"sync",t.message)}break}}});function S0(e){const t=Si();vk(t,e),qn.emit("modem:sync",cc(t))}Lr.on("update",S0),Lr.on("destroy",()=>{Lr.off("update",S0)});function Lk(e,t){return e%t}function Mk(e,t){return Math.floor(e/t)}function R0(e,t){return{x:Lk(e,t),y:Mk(e,t)}}function lc(e,t){return e.x+e.y*t}function I0(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function N0(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let u=a;u<=c;++u)for(let l=s;l<=o;++l)i.push({x:l,y:u});return i}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const O0="170",Uk="",dr="srgb",C0="srgb-linear",L0="linear",Vu="srgb";function Gs(e,t,n){return Math.max(t,Math.min(n,e))}function Fk(e,t){return(e%t+t)%t}function Xu(e,t,n){return(1-n)*e+n*t}class Do{constructor(t=0,n=0){Do.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(Gs(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class $o{constructor(t,n,r,i,s,o,a,c,u){$o.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,u)}set(t,n,r,i,s,o,a,c,u){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=n,l[4]=s,l[5]=c,l[6]=r,l[7]=o,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],u=r[1],l=r[4],h=r[7],f=r[2],d=r[5],p=r[8],m=i[0],w=i[3],E=i[6],T=i[1],v=i[4],I=i[7],U=i[2],S=i[5],N=i[8];return s[0]=o*m+a*T+c*U,s[3]=o*w+a*v+c*S,s[6]=o*E+a*I+c*N,s[1]=u*m+l*T+h*U,s[4]=u*w+l*v+h*S,s[7]=u*E+l*I+h*N,s[2]=f*m+d*T+p*U,s[5]=f*w+d*v+p*S,s[8]=f*E+d*I+p*N,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8];return n*o*l-n*a*u-r*s*l+r*a*c+i*s*u-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=l*o-a*u,f=a*c-l*s,d=u*s-o*c,p=n*h+r*f+i*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=h*m,t[1]=(i*u-l*r)*m,t[2]=(a*r-i*o)*m,t[3]=f*m,t[4]=(l*n-i*c)*m,t[5]=(i*s-a*n)*m,t[6]=d*m,t[7]=(r*c-u*n)*m,t[8]=(o*n-r*s)*m,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),u=Math.sin(s);return this.set(r*c,r*u,-r*(c*o+u*a)+o+t,-i*u,i*c,-i*(-u*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(qu.makeScale(t,n)),this}rotate(t){return this.premultiply(qu.makeRotation(-t)),this}translate(t,n){return this.premultiply(qu.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const qu=new $o,Jn={enabled:!0,workingColorSpace:C0,spaces:{},convert:function(e,t,n){return this.enabled===!1||t===n||!t||!n||(this.spaces[t].transfer===Vu&&(e.r=Hs(e.r),e.g=Hs(e.g),e.b=Hs(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Vu&&(e.r=Ys(e.r),e.g=Ys(e.g),e.b=Ys(e.b))),e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===Uk?L0:this.spaces[e].transfer},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}};function Hs(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function Ys(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const M0=[.64,.33,.3,.6,.15,.06],U0=[.2126,.7152,.0722],F0=[.3127,.329],B0=new $o().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),P0=new $o().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);Jn.define({[C0]:{primaries:M0,whitePoint:F0,transfer:L0,toXYZ:B0,fromXYZ:P0,luminanceCoefficients:U0,workingColorSpaceConfig:{unpackColorSpace:dr},outputColorSpaceConfig:{drawingBufferColorSpace:dr}},[dr]:{primaries:M0,whitePoint:F0,transfer:Vu,toXYZ:B0,fromXYZ:P0,luminanceCoefficients:U0,outputColorSpaceConfig:{drawingBufferColorSpace:dr}}});const D0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Li={h:0,s:0,l:0},uc={h:0,s:0,l:0};function Ju(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class Zu{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=dr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Jn.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=Jn.workingColorSpace){return this.r=t,this.g=n,this.b=r,Jn.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=Jn.workingColorSpace){if(t=Fk(t,1),n=Gs(n,0,1),r=Gs(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=Ju(o,s,t+1/3),this.g=Ju(o,s,t),this.b=Ju(o,s,t-1/3)}return Jn.toWorkingColorSpace(this,i),this}setStyle(t,n=dr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=dr){const r=D0[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Hs(t.r),this.g=Hs(t.g),this.b=Hs(t.b),this}copyLinearToSRGB(t){return this.r=Ys(t.r),this.g=Ys(t.g),this.b=Ys(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=dr){return Jn.fromWorkingColorSpace(cn.copy(this),t),Math.round(Gs(cn.r*255,0,255))*65536+Math.round(Gs(cn.g*255,0,255))*256+Math.round(Gs(cn.b*255,0,255))}getHexString(t=dr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=Jn.workingColorSpace){Jn.fromWorkingColorSpace(cn.copy(this),n);const r=cn.r,i=cn.g,s=cn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,u;const l=(a+o)/2;if(a===o)c=0,u=0;else{const h=o-a;switch(u=l<=.5?h/(o+a):h/(2-o-a),o){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4;break}c/=6}return t.h=c,t.s=u,t.l=l,t}getRGB(t,n=Jn.workingColorSpace){return Jn.fromWorkingColorSpace(cn.copy(this),n),t.r=cn.r,t.g=cn.g,t.b=cn.b,t}getStyle(t=dr){Jn.fromWorkingColorSpace(cn.copy(this),t);const n=cn.r,r=cn.g,i=cn.b;return t!==dr?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL(Li),this.setHSL(Li.h+t,Li.s+n,Li.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL(Li),t.getHSL(uc);const r=Xu(Li.h,uc.h,n),i=Xu(Li.s,uc.s,n),s=Xu(Li.l,uc.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const cn=new Zu;Zu.NAMES=D0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:O0}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=O0),new Do,new Do;function Pn(e,t,n){return Math.max(t,Math.min(n,e))}function Qu(e){return e*180/Math.PI}const Bk=yd("089fad0j9awfem09wavefc09uwaef");function Pk(){return Bk()}function Dk(e){return yd(e)()}function Mi(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(Pk()*i)}function $0(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(Dk(e)*s)}function j0(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function $k(e){return e[Mi(0,e.length-1)]}function jk(e,t){return t[$0(e,0,t.length-1)]}function ln(...e){return $k(e.flat())}function z0(e,...t){return jk(e,t.flat())}function zk(e){return[...new Set(e)].filter(x)}var W0={exports:{}},th={exports:{}},K0;function Wk(){return K0||(K0=1,function(e,t){(function(n,r){e.exports=r()})(xn,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],u=["evalOrigin"],l=s.concat(o,a,c,u);function h(m){if(m)for(var w=0;w<l.length;w++)m[l[w]]!==void 0&&this["set"+r(l[w])](m[l[w]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",w=this.getLineNumber()||"",E=this.getColumnNumber()||"",T=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+w+":"+E+")":"[eval]:"+w+":"+E:T?T+" ("+m+":"+w+":"+E+")":m+":"+w+":"+E}},h.fromString=function(w){var E=w.indexOf("("),T=w.lastIndexOf(")"),v=w.substring(0,E),I=w.substring(E+1,T).split(","),U=w.substring(T+1);if(U.indexOf("@")===0)var S=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(U,""),N=S[1],P=S[2],L=S[3];return new h({functionName:v,args:I||void 0,fileName:N,lineNumber:P||void 0,columnNumber:L||void 0})};for(var f=0;f<s.length;f++)h.prototype["get"+r(s[f])]=i(s[f]),h.prototype["set"+r(s[f])]=function(m){return function(w){this[m]=!!w}}(s[f]);for(var d=0;d<o.length;d++)h.prototype["get"+r(o[d])]=i(o[d]),h.prototype["set"+r(o[d])]=function(m){return function(w){if(!n(w))throw new TypeError(m+" must be a Number");this[m]=Number(w)}}(o[d]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(m){return function(w){this[m]=String(w)}}(a[p]);return h})}(th)),th.exports}(function(e,t){(function(n,r){e.exports=r(Wk())})(xn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var u=/(.+?)(?::(\d+))?(?::(\d+))?$/,l=u.exec(c.replace(/[()]/g,""));return[l[1],l[2]||void 0,l[3]||void 0]},parseV8OrIE:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(s)},this);return u.map(function(l){l.indexOf("(eval ")>-1&&(l=l.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=l.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=h.match(/ (\(.+\)$)/);h=f?h.replace(f[0],""):h;var d=this.extractLocation(f?f[1]:h),p=f&&h||void 0,m=["eval","<anonymous>"].indexOf(d[0])>-1?void 0:d[0];return new r({functionName:p,fileName:m,lineNumber:d[1],columnNumber:d[2],source:l})},this)},parseFFOrSafari:function(c){var u=c.stack.split(`
`).filter(function(l){return!l.match(o)},this);return u.map(function(l){if(l.indexOf(" > eval")>-1&&(l=l.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),l.indexOf("@")===-1&&l.indexOf(":")===-1)return new r({functionName:l});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=l.match(h),d=f&&f[1]?f[1]:void 0,p=this.extractLocation(l.replace(h,""));return new r({functionName:d,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:l})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)/i,l=c.message.split(`
`),h=[],f=2,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera10:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,l=c.stacktrace.split(`
`),h=[],f=0,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera11:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(i)&&!l.match(/^Error created at/)},this);return u.map(function(l){var h=l.split("@"),f=this.extractLocation(h.pop()),d=h.shift()||"",p=d.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;d.match(/\(([^)]*)\)/)&&(m=d.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var w=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:w,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:l})},this)}}})})(W0);var Kk=W0.exports,Gk=Ts(Kk);const eh=14,hc=3,fc=8,dc=14,pc=16,Hk=16,Yk=16;function mc(e,t){return new Array(e).fill(t)}function Vk(e,t,n,r,i=0){const s=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:mc(s,0),color:mc(s,0),bg:mc(s,i)}}function Xk(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:Wt.ONCLEAR}}function qk(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function Jk(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:mc(s,i)}}function Zk(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function Qk(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5}}function G0(e,t){return`${e}:${t}`}const tT=1,eT=16,nT=256;var mn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(mn||{});const Mr=!!JSON.parse("false"),rT=!!JSON.parse("false");JSON.parse("false");const iT=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const li={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return fc*li.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return dc*li.DRAW_CHAR_SCALE}},j=Ss("SOFTWARE");function ui(e){const t={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},listcommands(){return Gn(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function xe(e){return`${e??""}`}function jo(e,t){const n=parseFloat(xe(e));return isNaN(n)?t:n}function H0(e,t){const[n]=it(e,0,[Y.MAYBE_NAME]);fE(j,n??"",t)}function Zn(e,t,n){const[r,i]=it(n,0,[Y.NUMBER_OR_STRING,Y.MAYBE_NUMBER_OR_STRING]);Id(j,e,t,r,i)}const sT=["echo","reverb","phaser","distortion","vibrato","fc"];function Y0(e,t){const[n,r]=it(t,0,[Y.NUMBER_OR_STRING]);if(Ct(n))Jl(j,e,"volume",n);else if(sT.includes(Mt(n))){const[i,s]=it(t,r,[Y.NUMBER_OR_STRING,Y.MAYBE_NUMBER_OR_STRING]);Id(j,e,n,i,s)}else{const[i]=it(t,r,[Y.MAYBE_NUMBER_OR_STRING]);if(Ct(i)){const s=t.length-r,o=new Array(s).fill(Y.NUMBER),a=it(t,r,o).slice(0,s),c=a.length===1?a[0]:a;Jl(j,e,n,c)}else{const[s]=it(t,r,[Y.MAYBE_NUMBER_OR_STRING]);Jl(j,e,n,s)}}}const nh=ui().command("tts",(e,t)=>{const[n,r]=it(t,0,[Y.STRING]),i=t.slice(r).map(xe).join("");return uE(j,n,i),0}).command("tta",(e,t)=>{const n=t.map(xe).join("");return hE(j,n),0}).command("bpm",(e,t)=>{const[n]=it(t,0,[Y.NUMBER]);return dE(j,n),0}).command("vol",(e,t)=>{const[n]=it(t,0,[Y.NUMBER]);return pE(j,n),0}).command("bgvol",(e,t)=>{const[n]=it(t,0,[Y.NUMBER]);return mE(j,n),0}).command("ttsvol",(e,t)=>{const[n]=it(t,0,[Y.NUMBER]);return gE(j,n),0}).command("play",(e,t)=>(H0(t,!1),0)).command("bgplay",(e,t)=>(H0(t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)Y0(n,t);return 0}).command("echo",(e,t)=>{for(let n=0;n<3;++n)Zn(n,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let n=0;n<3;++n)Zn(n,"fc",t);return 0}).command("phaser",(e,t)=>{for(let n=0;n<3;++n)Zn(n,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let n=0;n<3;++n)Zn(n,"reverb",t);return 0}).command("distort",(e,t)=>{for(let n=0;n<3;++n)Zn(n,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let n=0;n<3;++n)Zn(n,"vibrato",t);return 0});for(let e=0;e<8;++e)nh.command(`synth${e+1}`,(t,n)=>(Y0(e,n),0));for(let e=0;e<3;++e){const t=e+1;nh.command(`echo${t}`,(n,r)=>(Zn(e,"echo",r),0)).command(`fcrush${t}`,(n,r)=>(Zn(e,"fcrush",r),0)).command(`phaser${t}`,(n,r)=>(Zn(e,"phaser",r),0)).command(`reverb${t}`,(n,r)=>(Zn(e,"reverb",r),0)).command(`distort${t}`,(n,r)=>(Zn(e,"distort",r),0)).command(`vibrato${t}`,(n,r)=>(Zn(e,"vibrato",r),0))}function oT(e,t){let n=0,r=0,i=0;for(;i<e.length;i++)n+=e[i];for(i=0,t*=n;t&&i<e.length;){if(r+=e[i],t<=r)return i;i++}return 0}var aT=oT;const cT=aT,Jt=function(){};Jt.prototype.FMX=0,Jt.prototype.FMY=0,Jt.prototype.FMXxFMY=0,Jt.prototype.T=0,Jt.prototype.N=0,Jt.prototype.initiliazedField=!1,Jt.prototype.generationComplete=!1,Jt.prototype.wave=null,Jt.prototype.compatible=null,Jt.prototype.weightLogWeights=null,Jt.prototype.sumOfWeights=0,Jt.prototype.sumOfWeightLogWeights=0,Jt.prototype.startingEntropy=0,Jt.prototype.sumsOfOnes=null,Jt.prototype.sumsOfWeights=null,Jt.prototype.sumsOfWeightLogWeights=null,Jt.prototype.entropies=null,Jt.prototype.propagator=null,Jt.prototype.observed=null,Jt.prototype.distribution=null,Jt.prototype.stack=null,Jt.prototype.stackSize=0,Jt.prototype.DX=[-1,0,1,0],Jt.prototype.DY=[0,1,0,-1],Jt.prototype.opposite=[2,3,0,1],Jt.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},Jt.prototype.observe=function(e){let t=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=cT(this.distribution,e()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},Jt.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],n=t%this.FMX,r=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const u=a+c*this.FMX,l=this.propagator[i][e[1]],h=this.compatible[u];for(let f=0;f<l.length;f++){const d=l[f],p=h[d];p[i]--,p[i]==0&&this.ban(u,d)}}}},Jt.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},Jt.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let n=0;n<e||e===0;n++){const r=this.singleIteration(t);if(r!==null)return!!r}return!0},Jt.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},Jt.prototype.isGenerationComplete=function(){return this.generationComplete},Jt.prototype.ban=function(e,t){const n=this.compatible[e][t];for(let i=0;i<4;i++)n[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const r=this.sumsOfWeights[e];this.entropies[e]=Math.log(r)-this.sumsOfWeightLogWeights[e]/r},Jt.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let n=0;n<4;n++)this.compatible[e][t][n]=this.propagator[this.opposite[n]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var V0=Jt;const X0=V0,hi=function(t,n,r,i,s,o,a,c,u,l){l=l||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const h=n,f=new Array(h);for(let L=0;L<h;L++)f[L]=new Array(r);this.colors=[];const d={};for(let L=0;L<r;L++)for(let V=0;V<n;V++){const Z=(L*n+V)*4,C=[t[Z],t[Z+1],t[Z+2],t[Z+3]],R=C.join("-");d.hasOwnProperty(R)||(d[R]=this.colors.length,this.colors.push(C)),f[V][L]=d[R]}const p=this.colors.length,m=Math.pow(p,i*i),w=function(V){let Z=new Array(i*i);for(let C=0;C<i;C++)for(let R=0;R<i;R++)Z[R+C*i]=V(R,C);return Z},E=function(V,Z){return w(function(C,R){return f[(V+C)%n][(Z+R)%r]})},T=function(V){return w(function(Z,C){return V[i-1-C+Z*i]})},v=function(V){return w(function(Z,C){return V[i-1-Z+C*i]})},I=function(V){let Z=0,C=1;for(let R=0;R<V.length;R++)Z+=V[V.length-1-R]*C,C*=p;return Z},U=function(V){let Z=V,C=m;const R=new Array(i*i);for(let _=0;_<R.length;_++){C/=p;let B=0;for(;Z>=C;)Z-=C,B++;R[_]=B}return R},S={},N=[];for(let L=0;L<(a?r:r-i+1);L++)for(let V=0;V<(a?n:n-i+1);V++){const Z=new Array(8);Z[0]=E(V,L),Z[1]=v(Z[0]),Z[2]=T(Z[0]),Z[3]=v(Z[2]),Z[4]=T(Z[2]),Z[5]=v(Z[4]),Z[6]=T(Z[4]),Z[7]=v(Z[6]);for(let C=0;C<u;C++){const R=I(Z[C]);S[R]?S[R]++:(N.push(R),S[R]=1)}}this.T=N.length,this.ground=(l+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let L=0;L<this.T;L++){const V=parseInt(N[L],10);this.patterns[L]=U(V),this.weights[L]=S[V]}const P=function(V,Z,C,R){const _=C<0?0:C,B=C<0?C+i:i,X=R<0?0:R,D=R<0?R+i:i;for(let lt=X;lt<D;lt++)for(let et=_;et<B;et++)if(V[et+i*lt]!=Z[et-C+i*(lt-R)])return!1;return!0};this.propagator=new Array(4);for(let L=0;L<4;L++){this.propagator[L]=new Array(this.T);for(let V=0;V<this.T;V++){const Z=[];for(let C=0;C<this.T;C++)P(this.patterns[V],this.patterns[C],this.DX[L],this.DY[L])&&Z.push(C);this.propagator[L][V]=Z}}};hi.prototype=Object.create(X0.prototype),hi.prototype.constructor=hi,hi.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},hi.prototype.clear=function(){if(X0.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},hi.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},hi.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const n=t<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(t-n)*this.FMX]][i+n*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},hi.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const n=t%this.FMX,r=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let l=0;l<this.N;l++)for(let h=0;h<this.N;h++){let f=n-h;f<0&&(f+=this.FMX);let d=r-l;if(d<0&&(d+=this.FMY),this.onBoundary(f,d))continue;const p=f+d*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const w=this.colors[this.patterns[m][h+l*this.N]];s+=w[0],o+=w[1],a+=w[2],c+=w[3]}}const u=t*4;e[u]=s/i,e[u+1]=o/i,e[u+2]=a/i,e[u+3]=c/i}};var lT=hi;const uT=V0,Ui=function(t,n,r,i,s){const o=t.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;n&&t.subsets&&t.subsets[n]&&(c=t.subsets[n]);const u=function(I){const U=new Array(o*o);for(let S=0;S<o;S++)for(let N=0;N<o;N++)U[N+S*o]=I(N,S);return U},l=function(I){return u(function(U,S){return I[o-1-S+U*o]})},h=function(I){return u(function(U,S){return I[o-1-U+S*o]})};this.tiles=[];const f=[],d=[],p={};let m,w,E;for(let v=0;v<t.tiles.length;v++){const I=t.tiles[v];if(c!==null&&c.indexOf(I.name)===-1)continue;switch(I.symmetry){case"L":E=4,m=function(S){return(S+1)%4},w=function(S){return S%2===0?S+1:S-1};break;case"T":E=4,m=function(S){return(S+1)%4},w=function(S){return S%2===0?S:4-S};break;case"I":E=2,m=function(S){return 1-S},w=function(S){return S};break;case"\\":E=2,m=function(S){return 1-S},w=function(S){return 1-S};break;case"F":E=8,m=function(S){return S<4?(S+1)%4:4+(S-1)%4},w=function(S){return S<4?S+4:S-4};break;default:E=1,m=function(S){return S},w=function(S){return S};break}this.T=d.length,p[I.name]=this.T;for(let S=0;S<E;S++)d.push([this.T+S,this.T+m(S),this.T+m(m(S)),this.T+m(m(m(S))),this.T+w(S),this.T+w(m(S)),this.T+w(m(m(S))),this.T+w(m(m(m(S))))]);let U;if(a)for(let S=0;S<E;S++)U=I.bitmap[S],this.tiles.push(u(function(N,P){return[U[(o*P+N)*4],U[(o*P+N)*4+1],U[(o*P+N)*4+2],U[(o*P+N)*4+3]]}));else{U=I.bitmap,this.tiles.push(u(function(S,N){return[U[(o*N+S)*4],U[(o*N+S)*4+1],U[(o*N+S)*4+2],U[(o*N+S)*4+3]]}));for(let S=1;S<E;S++)this.tiles.push(S<4?l(this.tiles[this.T+S-1]):h(this.tiles[this.T+S-4]))}for(let S=0;S<E;S++)f.push(I.weight||1)}this.T=d.length,this.weights=f,this.propagator=new Array(4);const T=new Array(4);for(let v=0;v<4;v++){this.propagator[v]=new Array(this.T),T[v]=new Array(this.T);for(let I=0;I<this.T;I++){T[v][I]=new Array(this.T);for(let U=0;U<this.T;U++)T[v][I][U]=!1}}for(let v=0;v<t.neighbors.length;v++){const I=t.neighbors[v],U=I.left.split(" ").filter(function(Z){return Z.length}),S=I.right.split(" ").filter(function(Z){return Z.length});if(c!==null&&(c.indexOf(U[0])===-1||c.indexOf(S[0])===-1))continue;const N=d[p[U[0]]][U.length==1?0:parseInt(U[1],10)],P=d[N][1],L=d[p[S[0]]][S.length==1?0:parseInt(S[1],10)],V=d[L][1];T[0][L][N]=!0,T[0][d[L][6]][d[N][6]]=!0,T[0][d[N][4]][d[L][4]]=!0,T[0][d[N][2]][d[L][2]]=!0,T[1][V][P]=!0,T[1][d[P][6]][d[V][6]]=!0,T[1][d[V][4]][d[P][4]]=!0,T[1][d[P][2]][d[V][2]]=!0}for(let v=0;v<this.T;v++)for(let I=0;I<this.T;I++)T[2][v][I]=T[0][I][v],T[3][v][I]=T[1][I][v];for(let v=0;v<4;v++)for(let I=0;I<this.T;I++){const U=[],S=T[v][I];for(let N=0;N<this.T;N++)S[N]&&U.push(N);this.propagator[v][I]=U}};Ui.prototype=Object.create(uT.prototype),Ui.prototype.constructor=Ui,Ui.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},Ui.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},Ui.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[t+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},Ui.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let u=0;u<this.tilesize;u++){const l=(n*this.tilesize+u+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];else{let h=0,f=0,d=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const w=this.tiles[m][u+c*this.tilesize],E=this.weights[m]*a;h+=w[0]*E,f+=w[1]*E,d+=w[2]*E,p+=w[3]*E}e[l]=h,e[l+1]=f,e[l+2]=d,e[l+3]=p}}}};var hT=Ui,fT={OverlappingModel:lT,SimpleTiledModel:hT},dT=Ts(fT);function pT(e){return x(e)&&e<Wt.ONBLACK?e:void 0}function mT(e){return x(e)&&e>Wt.WHITE&&e<Wt.ONCLEAR?e-Wt.ONBLACK:void 0}const zo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Dn(e){return ne(e)&&J0(e[0])}function q0(e){return Dn(e)&&e[0].startsWith("ON")}function J0(e){return x(Wt[e])&&St(e)}function Z0(e){if(St(e))return zo[Mt(e)]}function gT(e){return e.map(t=>Wt[t]).find(t=>x(t)&&t<Wt.ONBLACK)}function yT(e){return e.map(t=>Wt[t]).find(t=>x(t)&&t>=Wt.ONBLACK)}function _T(e){if(Dn(e))return e;if(J0(e))return[e];const t=Z0(e);if(x(t))return[t]}function Q0(e){const t=k.words[e],n=_T(t);return Dn(n)?[n,e+1]:[void 0,e]}function gc(e){const t=[];let n=e;const[r,i]=Q0(e);if(Dn(r)&&(t.push(...r),n=i),Dn(t)&&!q0(t)){const[s,o]=Q0(i);q0(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function tm(e){const t={};return e.every(n=>{const r=Wt[n];x(r)&&(r<Wt.ONBLACK?t.color=r:t.bg=r-Wt.ONBLACK)}),t}function Vs(e){return ne(e)&&typeof e[0]=="string"}function bT(e){const t=k.words[e];return St(t)?[t,e+1]:[void 0,e]}function em(e){const t=k.words[e];if(Vs(t))return[t,e+1];const[n,r]=gc(e),[i,s]=bT(r);return St(i)?[[i,n],s]:[void 0,e]}function yc(e){if(!Vs(e))return;const[t]=e;return t}function nm(e){if(!Vs(e))return;const[,t]=e,n=x(t)?gT(t):void 0;return x(n)?n:void 0}function rm(e){if(!Vs(e))return;const[,t]=e,n=x(t)?yT(t):void 0;return x(n)?n:void 0}const Vt=60,Se=25,ET=Vt*Se;var Et=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(Et||{});function rh(e,t){const n=e??Ht.ISWALK,r=t??Ht.ISWALK;switch(n){case Ht.ISWALK:return r!==Ht.ISWALK;case Ht.ISSWIM:return r!==Ht.ISSWIM;case Ht.ISSOLID:return!0;case Ht.ISBULLET:return r!==Ht.ISWALK&&r!==Ht.ISSWIM}}function _c(e,t,n){const r=e==null?void 0:e.objects[n];if(x(r))return r;if(x(t)){const i=Xs(e,"player"),s={x:t.x??0,y:t.y??0};om(s,i)}}function Xs(e,t){var r,i;return t==="empty"?[...(e==null?void 0:e.terrain)??[]].map((o,a)=>{if(!(o!=null&&o.name)&&!(o!=null&&o.kind))return{...R0(a,Vt),name:"empty"}}).filter(x):[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(x)}function im(e,t){const n=yc(t),r=nm(t),i=rm(t);return e.filter(s=>{var o,a,c;return!(x(n)&&Mt((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||x(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??Wt.WHITE)!==r||x(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??Wt.BLACK)!==i)}).filter(x)}function sm(e,t){return x(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(x(i))return i;const s=Xs(e,Mt(n));if(s.length)return s}else if(go(n)&&n.x>=0&&n.x<Vt&&n.y>=0&&n.y<Se){const i=n.x+n.y*Vt,s=(r=e.lookup)==null?void 0:r[i];return x(s)?e.objects[s]:e.terrain[i]}}).flat().filter(x):[]}function om(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var ih;try{ih=new TextDecoder}catch{}var mt,Qn,z=0,de={},Zt,Fi,tr=0,Ur=0,Ze,fi,Tn=[],Xt,am={useRecords:!1,mapsAsObjects:!0};class cm{}const lm=new cm;lm.name="MessagePack 0xC1";var Bi=!1,um=2,hm;try{new Function("")}catch{um=1/0}class Wo{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(mt)return Tm(()=>(lh(),this?this.unpack(t,n):Wo.prototype.unpack.call(am,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof tn<"u"?tn.from(t):new Uint8Array(t)),typeof n=="object"?(Qn=n.end||t.length,z=n.start||0):(z=0,Qn=n>-1?n:t.length),Ur=0,Fi=null,Ze=null,mt=t;try{Xt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw mt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof Wo){if(de=this,this.structures)return Zt=this.structures,bc(n);(!Zt||Zt.length>0)&&(Zt=[])}else de=am,(!Zt||Zt.length>0)&&(Zt=[]);return bc(n)}unpackMultiple(t,n){let r,i=0;try{Bi=!0;let s=t.length,o=this?this.unpack(t,s):Ec.unpack(t,s);if(n){if(n(o,i,z)===!1)return;for(;z<s;)if(i=z,n(bc(),i,z)===!1)return}else{for(r=[o];z<s;)i=z,r.push(bc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Bi=!1,lh()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function bc(e){try{if(!de.trusted&&!Bi){let n=Zt.sharedLength||0;n<Zt.length&&(Zt.length=n)}let t;if(de.randomAccessStructure&&mt[z]<64&&mt[z]>=32&&hm?(t=hm(mt,z,Qn,de),mt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),z=Qn):t=Me(),Ze&&(z=Ze.postBundlePosition,Ze=null),Bi&&(Zt.restoreStructures=null),z==Qn)Zt&&Zt.restoreStructures&&fm(),Zt=null,mt=null,fi&&(fi=null);else{if(z>Qn)throw new Error("Unexpected end of MessagePack data");if(!Bi){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Zt&&Zt.restoreStructures&&fm(),lh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||z>Qn)&&(t.incomplete=!0),t}}function fm(){for(let e in Zt.restoreStructures)Zt[e]=Zt.restoreStructures[e];Zt.restoreStructures=null}function Me(){let e=mt[z++];if(e<160)if(e<128){if(e<64)return e;{let t=Zt[e&63]||de.getStructures&&pm()[e&63];return t?(t.read||(t.read=sh(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,de.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Em();r==="__proto__"&&(r="__proto_"),t[r]=Me()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Me(),Me());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=Me();return de.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Ur>=z)return Fi.slice(z-tr,(z+=t)-tr);if(Ur==0&&Qn<140){let n=t<16?ah(t):ym(t);if(n!=null)return n}return oh(t)}else{let t;switch(e){case 192:return null;case 193:return Ze?(t=Me(),t>0?Ze[1].slice(Ze.position1,Ze.position1+=t):Ze[0].slice(Ze.position0,Ze.position0-=t)):lm;case 194:return!1;case 195:return!0;case 196:if(t=mt[z++],t===void 0)throw new Error("Unexpected end of buffer");return ch(t);case 197:return t=Xt.getUint16(z),z+=2,ch(t);case 198:return t=Xt.getUint32(z),z+=4,ch(t);case 199:return os(mt[z++]);case 200:return t=Xt.getUint16(z),z+=2,os(t);case 201:return t=Xt.getUint32(z),z+=4,os(t);case 202:if(t=Xt.getFloat32(z),de.useFloat32>2){let n=uh[(mt[z]&127)<<1|mt[z+1]>>7];return z+=4,(n*t+(t>0?.5:-.5)>>0)/n}return z+=4,t;case 203:return t=Xt.getFloat64(z),z+=8,t;case 204:return mt[z++];case 205:return t=Xt.getUint16(z),z+=2,t;case 206:return t=Xt.getUint32(z),z+=4,t;case 207:return de.int64AsType==="number"?(t=Xt.getUint32(z)*4294967296,t+=Xt.getUint32(z+4)):de.int64AsType==="string"?t=Xt.getBigUint64(z).toString():de.int64AsType==="auto"?(t=Xt.getBigUint64(z),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Xt.getBigUint64(z),z+=8,t;case 208:return Xt.getInt8(z++);case 209:return t=Xt.getInt16(z),z+=2,t;case 210:return t=Xt.getInt32(z),z+=4,t;case 211:return de.int64AsType==="number"?(t=Xt.getInt32(z)*4294967296,t+=Xt.getUint32(z+4)):de.int64AsType==="string"?t=Xt.getBigInt64(z).toString():de.int64AsType==="auto"?(t=Xt.getBigInt64(z),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Xt.getBigInt64(z),z+=8,t;case 212:if(t=mt[z++],t==114)return xm(mt[z++]&63);{let n=Tn[t];if(n)return n.read?(z++,n.read(Me())):n.noBuffer?(z++,n()):n(mt.subarray(z,++z));throw new Error("Unknown extension "+t)}case 213:return t=mt[z],t==114?(z++,xm(mt[z++]&63,mt[z++])):os(2);case 214:return os(4);case 215:return os(8);case 216:return os(16);case 217:return t=mt[z++],Ur>=z?Fi.slice(z-tr,(z+=t)-tr):xT(t);case 218:return t=Xt.getUint16(z),z+=2,Ur>=z?Fi.slice(z-tr,(z+=t)-tr):kT(t);case 219:return t=Xt.getUint32(z),z+=4,Ur>=z?Fi.slice(z-tr,(z+=t)-tr):TT(t);case 220:return t=Xt.getUint16(z),z+=2,mm(t);case 221:return t=Xt.getUint32(z),z+=4,mm(t);case 222:return t=Xt.getUint16(z),z+=2,gm(t);case 223:return t=Xt.getUint32(z),z+=4,gm(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const wT=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function sh(e,t){function n(){if(n.count++>um){let i=e.read=new Function("r","return function(){return "+(de.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":wT.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Me);return e.highByte===0&&(e.read=dm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=Me()}return de.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?dm(t,n):n}const dm=(e,t)=>function(){let n=mt[z++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Zt[r]||pm()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=sh(i,e)),i.read()};function pm(){let e=Tm(()=>(mt=null,de.getStructures()));return Zt=de._mergeStructures(e,Zt)}var oh=Ko,xT=Ko,kT=Ko,TT=Ko;function Ko(e){let t;if(e<16&&(t=ah(e)))return t;if(e>64&&ih)return ih.decode(mt.subarray(z,z+=e));const n=z+e,r=[];for(t="";z<n;){const i=mt[z++];if(!(i&128))r.push(i);else if((i&224)===192){const s=mt[z++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=mt[z++]&63,o=mt[z++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=mt[z++]&63,o=mt[z++]&63,a=mt[z++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=Qe.apply(String,r),r.length=0)}return r.length>0&&(t+=Qe.apply(String,r)),t}function mm(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=Me();return de.freezeData?Object.freeze(t):t}function gm(e){if(de.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Em();r==="__proto__"&&(r="__proto_"),t[r]=Me()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Me(),Me());return t}}var Qe=String.fromCharCode;function ym(e){let t=z,n=new Array(e);for(let r=0;r<e;r++){const i=mt[z++];if((i&128)>0){z=t;return}n[r]=i}return Qe.apply(String,n)}function ah(e){if(e<4)if(e<2){if(e===0)return"";{let t=mt[z++];if((t&128)>1){z-=1;return}return Qe(t)}}else{let t=mt[z++],n=mt[z++];if((t&128)>0||(n&128)>0){z-=2;return}if(e<3)return Qe(t,n);let r=mt[z++];if((r&128)>0){z-=3;return}return Qe(t,n,r)}else{let t=mt[z++],n=mt[z++],r=mt[z++],i=mt[z++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){z-=4;return}if(e<6){if(e===4)return Qe(t,n,r,i);{let s=mt[z++];if((s&128)>0){z-=5;return}return Qe(t,n,r,i,s)}}else if(e<8){let s=mt[z++],o=mt[z++];if((s&128)>0||(o&128)>0){z-=6;return}if(e<7)return Qe(t,n,r,i,s,o);let a=mt[z++];if((a&128)>0){z-=7;return}return Qe(t,n,r,i,s,o,a)}else{let s=mt[z++],o=mt[z++],a=mt[z++],c=mt[z++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){z-=8;return}if(e<10){if(e===8)return Qe(t,n,r,i,s,o,a,c);{let u=mt[z++];if((u&128)>0){z-=9;return}return Qe(t,n,r,i,s,o,a,c,u)}}else if(e<12){let u=mt[z++],l=mt[z++];if((u&128)>0||(l&128)>0){z-=10;return}if(e<11)return Qe(t,n,r,i,s,o,a,c,u,l);let h=mt[z++];if((h&128)>0){z-=11;return}return Qe(t,n,r,i,s,o,a,c,u,l,h)}else{let u=mt[z++],l=mt[z++],h=mt[z++],f=mt[z++];if((u&128)>0||(l&128)>0||(h&128)>0||(f&128)>0){z-=12;return}if(e<14){if(e===12)return Qe(t,n,r,i,s,o,a,c,u,l,h,f);{let d=mt[z++];if((d&128)>0){z-=13;return}return Qe(t,n,r,i,s,o,a,c,u,l,h,f,d)}}else{let d=mt[z++],p=mt[z++];if((d&128)>0||(p&128)>0){z-=14;return}if(e<15)return Qe(t,n,r,i,s,o,a,c,u,l,h,f,d,p);let m=mt[z++];if((m&128)>0){z-=15;return}return Qe(t,n,r,i,s,o,a,c,u,l,h,f,d,p,m)}}}}}function _m(){let e=mt[z++],t;if(e<192)t=e-160;else switch(e){case 217:t=mt[z++];break;case 218:t=Xt.getUint16(z),z+=2;break;case 219:t=Xt.getUint32(z),z+=4;break;default:throw new Error("Expected string")}return Ko(t)}function ch(e){return de.copyBuffers?Uint8Array.prototype.slice.call(mt,z,z+=e):mt.subarray(z,z+=e)}function os(e){let t=mt[z++];if(Tn[t]){let n;return Tn[t](mt.subarray(z,n=z+=e),r=>{z=r;try{return Me()}finally{z=n}})}else throw new Error("Unknown extension type "+t)}var bm=new Array(4096);function Em(){let e=mt[z++];if(e>=160&&e<192){if(e=e-160,Ur>=z)return Fi.slice(z-tr,(z+=e)-tr);if(!(Ur==0&&Qn<180))return oh(e)}else return z--,wm(Me());let t=(e<<5^(e>1?Xt.getUint16(z):e>0?mt[z]:0))&4095,n=bm[t],r=z,i=z+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Xt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=mt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return z=r,n.string;i-=3,r=z}for(n=[],bm[t]=n,n.bytes=e;r<i;)s=Xt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=mt[r++],n.push(s);let a=e<16?ah(e):ym(e);return a!=null?n.string=a:n.string=oh(e)}function wm(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const xm=(e,t)=>{let n=Me().map(wm),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Zt[e];return i&&(i.isShared||Bi)&&((Zt.restoreStructures||(Zt.restoreStructures=[]))[e]=i),Zt[e]=n,n.read=sh(n,r),n.read()};Tn[0]=()=>{},Tn[0].noBuffer=!0,Tn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let AT={Error,TypeError,ReferenceError};Tn[101]=()=>{let e=Me();return(AT[e[0]]||Error)(e[1],{cause:e[2]})},Tn[105]=e=>{if(de.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Xt.getUint32(z-4);fi||(fi=new Map);let n=mt[z],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};fi.set(t,i);let s=Me();return i.used?Object.assign(r,s):(i.target=s,s)},Tn[112]=e=>{if(de.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Xt.getUint32(z-4),n=fi.get(t);return n.used=!0,n.target},Tn[115]=()=>new Set(Me());const km=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let vT=typeof globalThis=="object"?globalThis:window;Tn[116]=e=>{let t=e[0],n=km[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new vT[n](Uint8Array.prototype.slice.call(e,1).buffer)},Tn[120]=()=>{let e=Me();return new RegExp(e[0],e[1])};const ST=[];Tn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=z;return z+=t-e.length,Ze=ST,Ze=[_m(),_m()],Ze.position0=0,Ze.position1=0,Ze.postBundlePosition=z,z=n,Me()},Tn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Tm(e){let t=Qn,n=z,r=tr,i=Ur,s=Fi,o=fi,a=Ze,c=new Uint8Array(mt.slice(0,Qn)),u=Zt,l=Zt.slice(0,Zt.length),h=de,f=Bi,d=e();return Qn=t,z=n,tr=r,Ur=i,Fi=s,fi=o,Ze=a,mt=c,Bi=f,Zt=u,Zt.splice(0,Zt.length,...l),de=h,Xt=new DataView(mt.buffer,mt.byteOffset,mt.byteLength),d}function lh(){mt=null,fi=null,Zt=null}const uh=new Array(147);for(let e=0;e<256;e++)uh[e]=+("1e"+Math.floor(45.15-e*.30103));var Ec=new Wo({useRecords:!1});const RT=Ec.unpack;Ec.unpackMultiple,Ec.unpack;let IT=new Float32Array(1);new Uint8Array(IT.buffer,0,4);let wc;try{wc=new TextEncoder}catch{}let hh,Am;const xc=typeof tn<"u",kc=xc?function(e){return tn.allocUnsafeSlow(e)}:Uint8Array,vm=xc?tn:Uint8Array,Sm=xc?4294967296:2144337920;let J,Go,pe,K=0,gn,ke=null,NT;const OT=21760,CT=/[\u0080-\uFFFF]/,qs=Symbol("record-id");class LT extends Wo{constructor(t){super(t),this.offset=0;let n,r,i,s,o=vm.prototype.utf8Write?function(R,_){return J.utf8Write(R,_,J.byteLength-_)}:wc&&wc.encodeInto?function(R,_){return wc.encodeInto(R,J.subarray(_)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,u=t.structures||t.saveStructures,l=t.maxSharedStructures;if(l==null&&(l=u?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=u?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let f=l>32||h+l>64,d=l+64,p=l+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],w=0,E=0;this.pack=this.encode=function(R,_){if(J||(J=new kc(8192),pe=J.dataView||(J.dataView=new DataView(J.buffer,0,8192)),K=0),gn=J.length-10,gn-K<2048?(J=new kc(J.length),pe=J.dataView||(J.dataView=new DataView(J.buffer,0,J.length)),gn=J.length-10,K=0):K=K+7&2147483640,n=K,_&$T&&(K+=_&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof R!="string"?(ke=[],ke.size=1/0):ke=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let X=i.sharedLength||0;if(X>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let D=0;D<X;D++){let lt=i[D];if(!lt)continue;let et,ft=i.transitions;for(let G=0,W=lt.length;G<W;G++){let bt=lt[G];et=ft[bt],et||(et=ft[bt]=Object.create(null)),ft=et}ft[qs]=D+64}this.lastNamedStructuresLength=X}c||(i.nextId=X+64)}r&&(r=!1);let B;try{a.randomAccessStructure&&R&&R.constructor&&R.constructor===Object?C(R):I(R);let X=ke;if(ke&&Nm(n,I,0),s&&s.idsToInsert){let D=s.idsToInsert.sort((G,W)=>G.offset>W.offset?1:-1),lt=D.length,et=-1;for(;X&&lt>0;){let G=D[--lt].offset+n;G<X.stringsPosition+n&&et===-1&&(et=0),G>X.position+n?et>=0&&(et+=6):(et>=0&&(pe.setUint32(X.position+n,pe.getUint32(X.position+n)+et),et=-1),X=X.previous,lt++)}et>=0&&X&&pe.setUint32(X.position+n,pe.getUint32(X.position+n)+et),K+=D.length*6,K>gn&&L(K),a.offset=K;let ft=UT(J.subarray(n,K),D);return s=null,ft}return a.offset=K,_&PT?(J.start=n,J.end=K,J):J.subarray(n,K)}catch(X){throw B=X,X}finally{if(i&&(T(),r&&a.saveStructures)){let X=i.sharedLength||0,D=J.subarray(n,K),lt=FT(i,a);if(!B)return a.saveStructures(lt,lt.isCompatible)===!1?a.pack(R,_):(a.lastNamedStructuresLength=X,J.length>1073741824&&(J=null),D)}J.length>1073741824&&(J=null),_&DT&&(K=n)}};const T=()=>{E<10&&E++;let R=i.sharedLength||0;if(i.length>R&&!c&&(i.length=R),w>1e4)i.transitions=null,E=0,w=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let _=0,B=m.length;_<B;_++)m[_][qs]=0;m=[]}},v=R=>{var _=R.length;_<16?J[K++]=144|_:_<65536?(J[K++]=220,J[K++]=_>>8,J[K++]=_&255):(J[K++]=221,pe.setUint32(K,_),K+=4);for(let B=0;B<_;B++)I(R[B])},I=R=>{K>gn&&(J=L(K));var _=typeof R,B;if(_==="string"){let X=R.length;if(ke&&X>=4&&X<4096){if((ke.size+=X)>OT){let ft,G=(ke[0]?ke[0].length*3+ke[1].length:0)+10;K+G>gn&&(J=L(K+G));let W;ke.position?(W=ke,J[K]=200,K+=3,J[K++]=98,ft=K-n,K+=4,Nm(n,I,0),pe.setUint16(ft+n-3,K-n-ft)):(J[K++]=214,J[K++]=98,ft=K-n,K+=4),ke=["",""],ke.previous=W,ke.size=0,ke.position=ft}let et=CT.test(R);ke[et?0:1]+=R,J[K++]=193,I(et?-X:X);return}let D;X<32?D=1:X<256?D=2:X<65536?D=3:D=5;let lt=X*3;if(K+lt>gn&&(J=L(K+lt)),X<64||!o){let et,ft,G,W=K+D;for(et=0;et<X;et++)ft=R.charCodeAt(et),ft<128?J[W++]=ft:ft<2048?(J[W++]=ft>>6|192,J[W++]=ft&63|128):(ft&64512)===55296&&((G=R.charCodeAt(et+1))&64512)===56320?(ft=65536+((ft&1023)<<10)+(G&1023),et++,J[W++]=ft>>18|240,J[W++]=ft>>12&63|128,J[W++]=ft>>6&63|128,J[W++]=ft&63|128):(J[W++]=ft>>12|224,J[W++]=ft>>6&63|128,J[W++]=ft&63|128);B=W-K-D}else B=o(R,K+D);B<32?J[K++]=160|B:B<256?(D<2&&J.copyWithin(K+2,K+1,K+1+B),J[K++]=217,J[K++]=B):B<65536?(D<3&&J.copyWithin(K+3,K+2,K+2+B),J[K++]=218,J[K++]=B>>8,J[K++]=B&255):(D<5&&J.copyWithin(K+5,K+3,K+3+B),J[K++]=219,pe.setUint32(K,B),K+=4),K+=B}else if(_==="number")if(R>>>0===R)R<32||R<128&&this.useRecords===!1||R<64&&!this.randomAccessStructure?J[K++]=R:R<256?(J[K++]=204,J[K++]=R):R<65536?(J[K++]=205,J[K++]=R>>8,J[K++]=R&255):(J[K++]=206,pe.setUint32(K,R),K+=4);else if(R>>0===R)R>=-32?J[K++]=256+R:R>=-128?(J[K++]=208,J[K++]=R+256):R>=-32768?(J[K++]=209,pe.setInt16(K,R),K+=2):(J[K++]=210,pe.setInt32(K,R),K+=4);else{let X;if((X=this.useFloat32)>0&&R<4294967296&&R>=-2147483648){J[K++]=202,pe.setFloat32(K,R);let D;if(X<4||(D=R*uh[(J[K]&127)<<1|J[K+1]>>7])>>0===D){K+=4;return}else K--}J[K++]=203,pe.setFloat64(K,R),K+=8}else if(_==="object"||_==="function")if(!R)J[K++]=192;else{if(s){let D=s.get(R);if(D){if(!D.id){let lt=s.idsToInsert||(s.idsToInsert=[]);D.id=lt.push(D)}J[K++]=214,J[K++]=112,pe.setUint32(K,D.id),K+=4;return}else s.set(R,{offset:K-n})}let X=R.constructor;if(X===Object)P(R);else if(X===Array)v(R);else if(X===Map)if(this.mapAsEmptyObject)J[K++]=128;else{B=R.size,B<16?J[K++]=128|B:B<65536?(J[K++]=222,J[K++]=B>>8,J[K++]=B&255):(J[K++]=223,pe.setUint32(K,B),K+=4);for(let[D,lt]of R)I(D),I(lt)}else{for(let D=0,lt=hh.length;D<lt;D++){let et=Am[D];if(R instanceof et){let ft=hh[D];if(ft.write){ft.type&&(J[K++]=212,J[K++]=ft.type,J[K++]=0);let ct=ft.write.call(this,R);ct===R?Array.isArray(R)?v(R):P(R):I(ct);return}let G=J,W=pe,bt=K;J=null;let ot;try{ot=ft.pack.call(this,R,ct=>(J=G,G=null,K+=ct,K>gn&&L(K),{target:J,targetView:pe,position:K-ct}),I)}finally{G&&(J=G,pe=W,K=bt,gn=J.length-10)}ot&&(ot.length+K>gn&&L(ot.length+K),K=MT(ot,J,K,ft.type));return}}if(Array.isArray(R))v(R);else{if(R.toJSON){const D=R.toJSON();if(D!==R)return I(D)}if(_==="function")return I(this.writeFunction&&this.writeFunction(R));P(R)}}}else if(_==="boolean")J[K++]=R?195:194;else if(_==="bigint"){if(R<BigInt(1)<<BigInt(63)&&R>=-(BigInt(1)<<BigInt(63)))J[K++]=211,pe.setBigInt64(K,R);else if(R<BigInt(1)<<BigInt(64)&&R>0)J[K++]=207,pe.setBigUint64(K,R);else if(this.largeBigIntToFloat)J[K++]=203,pe.setFloat64(K,Number(R));else{if(this.largeBigIntToString)return I(R.toString());if(this.useBigIntExtension&&R<BigInt(2)**BigInt(1023)&&R>-(BigInt(2)**BigInt(1023))){J[K++]=199,K++,J[K++]=66;let X=[],D;do{let lt=R&BigInt(255);D=(lt&BigInt(128))===(R<BigInt(0)?BigInt(128):BigInt(0)),X.push(lt),R>>=BigInt(8)}while(!((R===BigInt(0)||R===BigInt(-1))&&D));J[K-2]=X.length;for(let lt=X.length;lt>0;)J[K++]=Number(X[--lt]);return}else throw new RangeError(R+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}K+=8}else if(_==="undefined")this.encodeUndefinedAsNil?J[K++]=192:(J[K++]=212,J[K++]=0,J[K++]=0);else throw new Error("Unknown type: "+_)},U=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?R=>{let _;if(this.skipValues){_=[];for(let D in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(D))&&!this.skipValues.includes(R[D])&&_.push(D)}else _=Object.keys(R);let B=_.length;B<16?J[K++]=128|B:B<65536?(J[K++]=222,J[K++]=B>>8,J[K++]=B&255):(J[K++]=223,pe.setUint32(K,B),K+=4);let X;if(this.coercibleKeyAsNumber)for(let D=0;D<B;D++){X=_[D];let lt=Number(X);I(isNaN(lt)?X:lt),I(R[X])}else for(let D=0;D<B;D++)I(X=_[D]),I(R[X])}:R=>{J[K++]=222;let _=K-n;K+=2;let B=0;for(let X in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(X))&&(I(X),I(R[X]),B++);if(B>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');J[_+++n]=B>>8,J[_+n]=B&255},S=this.useRecords===!1?U:t.progressiveRecords&&!f?R=>{let _,B=i.transitions||(i.transitions=Object.create(null)),X=K++-n,D;for(let lt in R)if(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(lt)){if(_=B[lt],_)B=_;else{let et=Object.keys(R),ft=B;B=i.transitions;let G=0;for(let W=0,bt=et.length;W<bt;W++){let ot=et[W];_=B[ot],_||(_=B[ot]=Object.create(null),G++),B=_}X+n+1==K?(K--,V(B,et,G)):Z(B,et,X,G),D=!0,B=ft[lt]}I(R[lt])}if(!D){let lt=B[qs];lt?J[X+n]=lt:Z(B,Object.keys(R),X,0)}}:R=>{let _,B=i.transitions||(i.transitions=Object.create(null)),X=0;for(let lt in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(lt))&&(_=B[lt],_||(_=B[lt]=Object.create(null),X++),B=_);let D=B[qs];D?D>=96&&f?(J[K++]=((D-=96)&31)+96,J[K++]=D>>5):J[K++]=D:V(B,B.__keys__||Object.keys(R),X);for(let lt in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(lt))&&I(R[lt])},N=typeof this.useRecords=="function"&&this.useRecords,P=N?R=>{N(R)?S(R):U(R)}:S,L=R=>{let _;if(R>16777216){if(R-n>Sm)throw new Error("Packed buffer would be larger than maximum buffer size");_=Math.min(Sm,Math.round(Math.max((R-n)*(R>67108864?1.25:2),4194304)/4096)*4096)}else _=(Math.max(R-n<<2,J.length-1)>>12)+1<<12;let B=new kc(_);return pe=B.dataView||(B.dataView=new DataView(B.buffer,0,_)),R=Math.min(R,J.length),J.copy?J.copy(B,0,n,R):B.set(J.slice(n,R)),K-=n,n=0,gn=B.length-10,J=B},V=(R,_,B)=>{let X=i.nextId;X||(X=64),X<d&&this.shouldShareStructure&&!this.shouldShareStructure(_)?(X=i.nextOwnId,X<p||(X=d),i.nextOwnId=X+1):(X>=p&&(X=d),i.nextId=X+1);let D=_.highByte=X>=96&&f?X-96>>5:-1;R[qs]=X,R.__keys__=_,i[X-64]=_,X<d?(_.isShared=!0,i.sharedLength=X-63,r=!0,D>=0?(J[K++]=(X&31)+96,J[K++]=D):J[K++]=X):(D>=0?(J[K++]=213,J[K++]=114,J[K++]=(X&31)+96,J[K++]=D):(J[K++]=212,J[K++]=114,J[K++]=X),B&&(w+=E*B),m.length>=h&&(m.shift()[qs]=0),m.push(R),I(_))},Z=(R,_,B,X)=>{let D=J,lt=K,et=gn,ft=n;J=Go,K=0,n=0,J||(Go=J=new kc(8192)),gn=J.length-10,V(R,_,X),Go=J;let G=K;if(J=D,K=lt,gn=et,n=ft,G>1){let W=K+G-1;W>gn&&L(W);let bt=B+n;J.copyWithin(bt+G,bt+1,K),J.set(Go.slice(0,G),bt),K=W}else J[B+n]=Go[0]},C=R=>{let _=NT(R,J,n,K,i,L,(B,X,D)=>{if(D)return r=!0;K=X;let lt=J;return I(B),T(),lt!==J?{position:K,targetView:pe,target:J}:K},this);if(_===0)return P(R);K=_}}useBuffer(t){J=t,J.dataView||(J.dataView=new DataView(J.buffer,J.byteOffset,J.byteLength)),K=0}set position(t){K=t}get position(){return K}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Am=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,cm],hh=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?Rm(e,16,t):Im(xc?tn.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==vm&&this.moreTypes?Rm(e,km.indexOf(n.name),t):Im(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function Rm(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function Im(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function MT(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function UT(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function Nm(e,t,n){if(ke.length>0){pe.setUint32(ke.position+e,K+n-ke.position-e),ke.stringsPosition=K-e;let r=ke;ke=null,t(r[0]),t(r[1])}}function FT(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let Om=new LT({useRecords:!1});const BT=Om.pack;Om.pack;const PT=512,DT=1024,$T=2048;function Ue(){return null}function Js(e,t,n={}){if(!x(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];x(c)&&(a=c(a));const u=t[o];x(u)&&(o=u),a!==null&&r.push(o,a)}return r}function Ho(e,t,n={}){if(x(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];x(a)&&(s=a);const c=n[s];x(c)&&(o=c(o)),r[s]=o}return r}catch(r){le(j,"binary",r.message)}}function jT(e){try{const t=Xe(e);return BT(t)}catch(t){le(j,"binary",t.message)}}function zT(e){try{return RT(e)}catch(t){le(j,"binary",t.message)}}function Cm(){return{id:Ce()}}var Tc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.destructible=16]="destructible",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e))(Tc||{});function Ac(e){return x(e==null?void 0:e.id)?Js(e,Tc,{category:Ue,kinddata:Ue,stopped:Ue,removed:Ue,bucket:Ue}):Js(e,Tc,{id:Ue,x:Ue,y:Ue,lx:Ue,ly:Ue,code:Ue,category:Ue,kinddata:Ue,stopped:Ue,removed:Ue,bucket:Ue})}function vc(e){return Ho(e,Tc)}function Yo(e){var t;return(((t=e==null?void 0:e.id)==null?void 0:t.length)??0)>0}function Sc(e,t){if(!x(e)||!Dn(t))return;const{color:n,bg:r}=tm(t);x(n)&&(e.color=n),x(r)&&(e.bg=r)}function Fr(e){var t;return Mt((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}function Lm(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function Mm(e){const t=Math.floor(e.length/hc);if(t*hc!==e.length){le(j,"size","wrong number of bytes for a palette");return}const n=Lm(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function WT(e,t){return e&1<<t?255:0}function Um(e){const t=Math.floor(e.length/eh);if(t*eh!==e.length){le(j,"size","wrong number of bytes for a charset");return}const n=Math.ceil(t/pc),r=fc*pc,i=Lm(r,dc*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const u=o*dc+a,l=e[c];for(let h=0;h<fc;++h){const f=s*fc+h;i.bits[f+u*r]=WT(l,7-h)}++a,a===dc&&(a=0,++s,s===pc&&(s=0,++o))}return i}const KT=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,129,165,129,129,189,153,129,126,0,0,0,0,0,126,255,219,255,255,195,231,255,126,0,0,0,0,0,0,108,254,254,254,254,124,56,16,0,0,0,0,0,0,16,56,124,254,124,56,16,0,0,0,0,0,0,24,60,60,231,231,231,24,24,60,0,0,0,0,0,24,60,126,255,255,126,24,24,60,0,0,0,0,0,0,0,0,24,60,60,24,0,0,0,0,0,255,255,255,255,255,231,195,195,231,255,255,255,255,255,0,0,0,0,60,102,66,66,102,60,0,0,0,0,255,255,255,255,195,153,189,189,153,195,255,255,255,255,0,0,30,14,26,50,120,204,204,204,120,0,0,0,0,0,60,102,102,102,60,24,126,24,24,0,0,0,0,0,63,51,63,48,48,48,112,240,224,0,0,0,0,0,127,99,127,99,99,99,103,231,230,192,0,0,0,0,24,24,219,60,231,60,219,24,24,0,0,0,0,0,128,192,224,248,254,248,224,192,128,0,0,0,0,0,2,6,14,62,254,62,14,6,2,0,0,0,0,0,24,60,126,24,24,24,126,60,24,0,0,0,0,0,102,102,102,102,102,102,0,102,102,0,0,0,0,0,127,219,219,219,123,27,27,27,27,0,0,0,0,124,198,96,56,108,198,198,108,56,12,198,124,0,0,0,0,0,0,0,0,0,254,254,254,0,0,0,0,0,24,60,126,24,24,24,126,60,24,126,0,0,0,0,24,60,126,24,24,24,24,24,24,0,0,0,0,0,24,24,24,24,24,24,126,60,24,0,0,0,0,0,0,0,24,12,254,12,24,0,0,0,0,0,0,0,0,0,48,96,254,96,48,0,0,0,0,0,0,0,0,0,0,192,192,192,254,0,0,0,0,0,0,0,0,0,40,108,254,108,40,0,0,0,0,0,0,0,0,16,56,56,124,124,254,254,0,0,0,0,0,0,0,254,254,124,124,56,56,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,60,60,60,24,24,0,24,24,0,0,0,0,102,102,102,36,0,0,0,0,0,0,0,0,0,0,0,108,108,254,108,108,108,254,108,108,0,0,0,24,24,124,198,194,192,124,6,134,198,124,24,24,0,0,0,0,0,194,198,12,24,48,102,198,0,0,0,0,0,56,108,108,56,118,220,204,204,118,0,0,0,0,48,48,48,96,0,0,0,0,0,0,0,0,0,0,0,12,24,48,48,48,48,48,24,12,0,0,0,0,0,48,24,12,12,12,12,12,24,48,0,0,0,0,0,0,0,102,60,255,60,102,0,0,0,0,0,0,0,0,0,24,24,126,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,48,0,0,0,0,0,0,0,0,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,2,6,12,24,48,96,192,128,0,0,0,0,0,0,124,198,206,222,246,230,198,198,124,0,0,0,0,0,24,56,120,24,24,24,24,24,126,0,0,0,0,0,124,198,6,12,24,48,96,198,254,0,0,0,0,0,124,198,6,6,60,6,6,198,124,0,0,0,0,0,12,28,60,108,204,254,12,12,30,0,0,0,0,0,254,192,192,192,252,6,6,198,124,0,0,0,0,0,56,96,192,192,252,198,198,198,124,0,0,0,0,0,254,198,6,12,24,48,48,48,48,0,0,0,0,0,124,198,198,198,124,198,198,198,124,0,0,0,0,0,124,198,198,198,126,6,6,12,120,0,0,0,0,0,0,24,24,0,0,0,24,24,0,0,0,0,0,0,0,24,24,0,0,0,24,24,48,0,0,0,0,0,6,12,24,48,96,48,24,12,6,0,0,0,0,0,0,0,0,126,0,0,126,0,0,0,0,0,0,0,96,48,24,12,6,12,24,48,96,0,0,0,0,0,124,198,198,12,24,24,0,24,24,0,0,0,0,0,124,198,198,222,222,222,220,192,124,0,0,0,0,0,16,56,108,198,198,254,198,198,198,0,0,0,0,0,252,102,102,102,124,102,102,102,252,0,0,0,0,0,60,102,194,192,192,192,194,102,60,0,0,0,0,0,248,108,102,102,102,102,102,108,248,0,0,0,0,0,254,102,98,104,120,104,98,102,254,0,0,0,0,0,254,102,98,104,120,104,96,96,240,0,0,0,0,0,60,102,194,192,192,222,198,102,58,0,0,0,0,0,198,198,198,198,254,198,198,198,198,0,0,0,0,0,60,24,24,24,24,24,24,24,60,0,0,0,0,0,30,12,12,12,12,12,204,204,120,0,0,0,0,0,230,102,108,108,120,108,108,102,230,0,0,0,0,0,240,96,96,96,96,96,98,102,254,0,0,0,0,0,198,238,254,254,214,198,198,198,198,0,0,0,0,0,198,230,246,254,222,206,198,198,198,0,0,0,0,0,56,108,198,198,198,198,198,108,56,0,0,0,0,0,252,102,102,102,124,96,96,96,240,0,0,0,0,0,124,198,198,198,198,214,222,124,12,14,0,0,0,0,252,102,102,102,124,108,102,102,230,0,0,0,0,0,124,198,198,96,56,12,198,198,124,0,0,0,0,0,126,126,90,24,24,24,24,24,60,0,0,0,0,0,198,198,198,198,198,198,198,198,124,0,0,0,0,0,198,198,198,198,198,198,108,56,16,0,0,0,0,0,198,198,198,198,214,214,254,124,108,0,0,0,0,0,198,198,108,56,56,56,108,198,198,0,0,0,0,0,102,102,102,102,60,24,24,24,60,0,0,0,0,0,254,198,140,24,48,96,194,198,254,0,0,0,0,0,60,48,48,48,48,48,48,48,60,0,0,0,0,0,128,192,224,112,56,28,14,6,2,0,0,0,0,0,60,12,12,12,12,12,12,12,60,0,0,0,16,56,108,198,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,48,48,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,12,124,204,204,118,0,0,0,0,0,224,96,96,120,108,102,102,102,124,0,0,0,0,0,0,0,0,124,198,192,192,198,124,0,0,0,0,0,28,12,12,60,108,204,204,204,118,0,0,0,0,0,0,0,0,124,198,254,192,198,124,0,0,0,0,0,56,108,100,96,240,96,96,96,240,0,0,0,0,0,0,0,0,118,204,204,204,124,12,204,120,0,0,0,224,96,96,108,118,102,102,102,230,0,0,0,0,0,24,24,0,56,24,24,24,24,60,0,0,0,0,0,6,6,0,14,6,6,6,6,102,102,60,0,0,0,224,96,96,102,108,120,108,102,230,0,0,0,0,0,56,24,24,24,24,24,24,24,60,0,0,0,0,0,0,0,0,236,254,214,214,214,198,0,0,0,0,0,0,0,0,220,102,102,102,102,102,0,0,0,0,0,0,0,0,124,198,198,198,198,124,0,0,0,0,0,0,0,0,220,102,102,102,124,96,96,240,0,0,0,0,0,0,118,204,204,204,124,12,12,30,0,0,0,0,0,0,220,118,102,96,96,240,0,0,0,0,0,0,0,0,124,198,112,28,198,124,0,0,0,0,0,16,48,48,252,48,48,48,54,28,0,0,0,0,0,0,0,0,204,204,204,204,204,118,0,0,0,0,0,0,0,0,102,102,102,102,60,24,0,0,0,0,0,0,0,0,198,198,214,214,254,108,0,0,0,0,0,0,0,0,198,108,56,56,108,198,0,0,0,0,0,0,0,0,198,198,198,198,126,6,12,248,0,0,0,0,0,0,254,204,24,48,102,254,0,0,0,0,0,14,24,24,24,112,24,24,24,14,0,0,0,0,0,24,24,24,24,0,24,24,24,24,0,0,0,0,0,112,24,24,24,14,24,24,24,112,0,0,0,0,0,118,220,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,56,108,198,198,254,0,0,0,0,0,0,60,102,194,192,192,194,102,60,12,6,124,0,0,0,204,204,0,204,204,204,204,204,118,0,0,0,0,12,24,48,0,124,198,254,192,198,124,0,0,0,0,16,56,108,0,120,12,124,204,204,118,0,0,0,0,0,204,204,0,120,12,124,204,204,118,0,0,0,0,96,48,24,0,120,12,124,204,204,118,0,0,0,0,56,108,56,0,120,12,124,204,204,118,0,0,0,0,0,0,0,60,102,96,102,60,12,6,60,0,0,0,16,56,108,0,124,198,254,192,198,124,0,0,0,0,0,204,204,0,124,198,254,192,198,124,0,0,0,0,96,48,24,0,124,198,254,192,198,124,0,0,0,0,0,102,102,0,56,24,24,24,24,60,0,0,0,0,24,60,102,0,56,24,24,24,24,60,0,0,0,0,96,48,24,0,56,24,24,24,24,60,0,0,0,0,198,198,16,56,108,198,198,254,198,198,0,0,0,56,108,56,0,56,108,198,198,254,198,198,0,0,0,24,48,96,0,254,102,96,124,96,102,254,0,0,0,0,0,0,0,204,118,54,126,216,216,110,0,0,0,0,0,62,108,204,204,254,204,204,204,206,0,0,0,0,16,56,108,0,124,198,198,198,198,124,0,0,0,0,0,198,198,0,124,198,198,198,198,124,0,0,0,0,96,48,24,0,124,198,198,198,198,124,0,0,0,0,48,120,204,0,204,204,204,204,204,118,0,0,0,0,96,48,24,0,204,204,204,204,204,118,0,0,0,0,0,198,198,0,198,198,198,198,126,6,12,120,0,0,198,198,56,108,198,198,198,198,108,56,0,0,0,0,198,198,0,198,198,198,198,198,198,124,0,0,0,0,24,24,60,102,96,96,102,60,24,24,0,0,0,0,56,108,100,96,240,96,96,96,230,252,0,0,0,0,0,102,102,60,24,126,24,126,24,24,0,0,0,0,248,204,204,248,196,204,222,204,204,198,0,0,0,0,14,27,24,24,24,126,24,24,24,24,216,112,0,0,24,48,96,0,120,12,124,204,204,118,0,0,0,0,12,24,48,0,56,24,24,24,24,60,0,0,0,0,24,48,96,0,124,198,198,198,198,124,0,0,0,0,24,48,96,0,204,204,204,204,204,118,0,0,0,0,0,118,220,0,220,102,102,102,102,102,0,0,0,118,220,0,198,230,246,254,222,206,198,198,0,0,0,0,60,108,108,62,0,126,0,0,0,0,0,0,0,0,56,108,108,56,0,124,0,0,0,0,0,0,0,0,0,48,48,0,48,48,96,198,198,124,0,0,0,0,0,0,0,0,0,254,192,192,192,0,0,0,0,0,0,0,0,0,0,254,6,6,6,0,0,0,0,0,192,192,198,204,216,48,96,220,134,12,24,62,0,0,192,192,198,204,216,48,102,206,158,62,6,6,0,0,0,24,24,0,24,24,60,60,60,24,0,0,0,0,0,0,0,54,108,216,108,54,0,0,0,0,0,0,0,0,0,216,108,54,108,216,0,0,0,0,0,17,68,17,68,17,68,17,68,17,68,17,68,17,68,85,170,85,170,85,170,85,170,85,170,85,170,85,170,221,119,221,119,221,119,221,119,221,119,221,119,221,119,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,248,24,24,24,24,24,24,24,24,24,24,24,248,24,248,24,24,24,24,24,24,54,54,54,54,54,54,54,246,54,54,54,54,54,54,0,0,0,0,0,0,0,254,54,54,54,54,54,54,0,0,0,0,0,248,24,248,24,24,24,24,24,24,54,54,54,54,54,246,6,246,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,0,0,0,0,0,254,6,246,54,54,54,54,54,54,54,54,54,54,54,246,6,254,0,0,0,0,0,0,54,54,54,54,54,54,54,254,0,0,0,0,0,0,24,24,24,24,24,248,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,248,24,24,24,24,24,24,24,24,24,24,24,24,24,31,0,0,0,0,0,0,24,24,24,24,24,24,24,255,0,0,0,0,0,0,0,0,0,0,0,0,0,255,24,24,24,24,24,24,24,24,24,24,24,24,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,255,0,0,0,0,0,0,24,24,24,24,24,24,24,255,24,24,24,24,24,24,24,24,24,24,24,31,24,31,24,24,24,24,24,24,54,54,54,54,54,54,54,55,54,54,54,54,54,54,54,54,54,54,54,55,48,63,0,0,0,0,0,0,0,0,0,0,0,63,48,55,54,54,54,54,54,54,54,54,54,54,54,247,0,255,0,0,0,0,0,0,0,0,0,0,0,255,0,247,54,54,54,54,54,54,54,54,54,54,54,55,48,55,54,54,54,54,54,54,0,0,0,0,0,255,0,255,0,0,0,0,0,0,54,54,54,54,54,247,0,247,54,54,54,54,54,54,24,24,24,24,24,255,0,255,0,0,0,0,0,0,54,54,54,54,54,54,54,255,0,0,0,0,0,0,0,0,0,0,0,255,0,255,24,24,24,24,24,24,0,0,0,0,0,0,0,255,54,54,54,54,54,54,54,54,54,54,54,54,54,63,0,0,0,0,0,0,24,24,24,24,24,31,24,31,0,0,0,0,0,0,0,0,0,0,0,31,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,63,54,54,54,54,54,54,54,54,54,54,54,54,54,255,54,54,54,54,54,54,24,24,24,24,24,255,24,255,24,24,24,24,24,24,24,24,24,24,24,24,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,31,24,24,24,24,24,24,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255,240,240,240,240,240,240,240,240,240,240,240,240,240,240,15,15,15,15,15,15,15,15,15,15,15,15,15,15,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,118,220,216,216,220,118,0,0,0,0,0,0,0,124,198,252,198,198,252,192,192,64,0,0,0,254,198,198,192,192,192,192,192,192,0,0,0,0,0,0,0,254,108,108,108,108,108,108,0,0,0,0,0,254,198,96,48,24,48,96,198,254,0,0,0,0,0,0,0,0,126,216,216,216,216,112,0,0,0,0,0,0,0,102,102,102,102,124,96,96,192,0,0,0,0,0,0,118,220,24,24,24,24,24,0,0,0,0,0,126,24,60,102,102,102,60,24,126,0,0,0,0,0,56,108,198,198,254,198,198,108,56,0,0,0,0,0,56,108,198,198,198,108,108,108,238,0,0,0,0,0,30,48,24,12,62,102,102,102,60,0,0,0,0,0,0,0,0,126,219,219,126,0,0,0,0,0,0,0,3,6,126,219,219,243,126,96,192,0,0,0,0,0,28,48,96,96,124,96,96,48,28,0,0,0,0,0,0,124,198,198,198,198,198,198,198,0,0,0,0,0,0,254,0,0,254,0,0,254,0,0,0,0,0,0,0,24,24,126,24,24,0,0,255,0,0,0,0,0,48,24,12,6,12,24,48,0,126,0,0,0,0,0,12,24,48,96,48,24,12,0,126,0,0,0,0,0,14,27,27,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,216,216,112,0,0,0,0,0,0,24,24,0,126,0,24,24,0,0,0,0,0,0,0,0,118,220,0,118,220,0,0,0,0,0,0,56,108,108,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,15,12,12,12,12,12,236,108,60,28,0,0,0,0,216,108,108,108,108,108,0,0,0,0,0,0,0,0,112,216,48,96,200,248,0,0,0,0,0,0,0,0,0,0,0,124,124,124,124,124,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),GT=new Uint8Array([0,0,0,0,0,42,0,42,0,0,42,42,42,0,0,42,0,42,42,21,0,42,42,42,21,21,21,21,21,63,21,63,21,21,63,63,63,21,21,63,21,63,63,63,21,63,63,63]);var Fm=typeof Ls=="object"&&Ls&&Ls.Object===Object&&Ls,HT=typeof self=="object"&&self&&self.Object===Object&&self,Br=Fm||HT||Function("return this")(),er=Br.Symbol,Bm=Object.prototype,YT=Bm.hasOwnProperty,VT=Bm.toString,Vo=er?er.toStringTag:void 0;function XT(e){var t=YT.call(e,Vo),n=e[Vo];try{e[Vo]=void 0;var r=!0}catch{}var i=VT.call(e);return r&&(t?e[Vo]=n:delete e[Vo]),i}var qT=Object.prototype,JT=qT.toString;function ZT(e){return JT.call(e)}var QT="[object Null]",tA="[object Undefined]",Pm=er?er.toStringTag:void 0;function Pi(e){return e==null?e===void 0?tA:QT:Pm&&Pm in Object(e)?XT(e):ZT(e)}function pr(e){return e!=null&&typeof e=="object"}var eA="[object Symbol]";function Rc(e){return typeof e=="symbol"||pr(e)&&Pi(e)==eA}function Ic(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var te=Array.isArray,nA=1/0,Dm=er?er.prototype:void 0,$m=Dm?Dm.toString:void 0;function jm(e){if(typeof e=="string")return e;if(te(e))return Ic(e,jm)+"";if(Rc(e))return $m?$m.call(e):"";var t=e+"";return t=="0"&&1/e==-nA?"-0":t}var rA=/\s/;function iA(e){for(var t=e.length;t--&&rA.test(e.charAt(t)););return t}var sA=/^\s+/;function oA(e){return e&&e.slice(0,iA(e)+1).replace(sA,"")}function nr(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var zm=NaN,aA=/^[-+]0x[0-9a-f]+$/i,cA=/^0b[01]+$/i,lA=/^0o[0-7]+$/i,uA=parseInt;function hA(e){if(typeof e=="number")return e;if(Rc(e))return zm;if(nr(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=nr(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=oA(e);var n=cA.test(e);return n||lA.test(e)?uA(e.slice(2),n?2:8):aA.test(e)?zm:+e}var Wm=1/0,fA=17976931348623157e292;function dA(e){if(!e)return e===0?e:0;if(e=hA(e),e===Wm||e===-Wm){var t=e<0?-1:1;return t*fA}return e===e?e:0}function Nc(e){var t=dA(e),n=t%1;return t===t?n?t-n:t:0}function Zs(e){return e}var pA="[object AsyncFunction]",mA="[object Function]",gA="[object GeneratorFunction]",yA="[object Proxy]";function di(e){if(!nr(e))return!1;var t=Pi(e);return t==mA||t==gA||t==pA||t==yA}var fh=Br["__core-js_shared__"],Km=function(){var e=/[^.]+$/.exec(fh&&fh.keys&&fh.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function _A(e){return!!Km&&Km in e}var bA=Function.prototype,EA=bA.toString;function as(e){if(e!=null){try{return EA.call(e)}catch{}try{return e+""}catch{}}return""}var wA=/[\\^$.*+?()[\]{}|]/g,xA=/^\[object .+?Constructor\]$/,kA=Function.prototype,TA=Object.prototype,AA=kA.toString,vA=TA.hasOwnProperty,SA=RegExp("^"+AA.call(vA).replace(wA,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function RA(e){if(!nr(e)||_A(e))return!1;var t=di(e)?SA:xA;return t.test(as(e))}function IA(e,t){return e==null?void 0:e[t]}function cs(e,t){var n=IA(e,t);return RA(n)?n:void 0}var dh=cs(Br,"WeakMap"),Gm=Object.create,NA=function(){function e(){}return function(t){if(!nr(t))return{};if(Gm)return Gm(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function OA(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function We(){}function CA(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var LA=800,MA=16,UA=Date.now;function FA(e){var t=0,n=0;return function(){var r=UA(),i=MA-(r-n);if(n=r,i>0){if(++t>=LA)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function BA(e){return function(){return e}}var Oc=function(){try{var e=cs(Object,"defineProperty");return e({},"",{}),e}catch{}}(),PA=Oc?function(e,t){return Oc(e,"toString",{configurable:!0,enumerable:!1,value:BA(t),writable:!0})}:Zs,DA=FA(PA);function Hm(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function Ym(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function $A(e){return e!==e}function jA(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function ph(e,t,n){return t===t?jA(e,t,n):Ym(e,$A,n)}function Vm(e,t){var n=e==null?0:e.length;return!!n&&ph(e,t,0)>-1}var zA=9007199254740991,WA=/^(?:0|[1-9]\d*)$/;function Cc(e,t){var n=typeof e;return t=t??zA,!!t&&(n=="number"||n!="symbol"&&WA.test(e))&&e>-1&&e%1==0&&e<t}function mh(e,t,n){t=="__proto__"&&Oc?Oc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Xo(e,t){return e===t||e!==e&&t!==t}var KA=Object.prototype,GA=KA.hasOwnProperty;function Lc(e,t,n){var r=e[t];(!(GA.call(e,t)&&Xo(r,n))||n===void 0&&!(t in e))&&mh(e,t,n)}function gh(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?mh(n,a,c):Lc(n,a,c)}return n}var Xm=Math.max;function HA(e,t,n){return t=Xm(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=Xm(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),OA(e,this,a)}}function yh(e,t){return DA(HA(e,t,Zs),e+"")}var YA=9007199254740991;function _h(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=YA}function Pr(e){return e!=null&&_h(e.length)&&!di(e)}function qm(e,t,n){if(!nr(n))return!1;var r=typeof t;return(r=="number"?Pr(n)&&Cc(t,n.length):r=="string"&&t in n)?Xo(n[t],e):!1}function VA(e){return yh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&qm(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var XA=Object.prototype;function qo(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||XA;return e===n}function qA(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var JA="[object Arguments]";function Jm(e){return pr(e)&&Pi(e)==JA}var Zm=Object.prototype,ZA=Zm.hasOwnProperty,QA=Zm.propertyIsEnumerable,Mc=Jm(function(){return arguments}())?Jm:function(e){return pr(e)&&ZA.call(e,"callee")&&!QA.call(e,"callee")};function tv(){return!1}var Qm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,tg=Qm&&typeof module=="object"&&module&&!module.nodeType&&module,ev=tg&&tg.exports===Qm,eg=ev?Br.Buffer:void 0,nv=eg?eg.isBuffer:void 0,Jo=nv||tv,rv="[object Arguments]",iv="[object Array]",sv="[object Boolean]",ov="[object Date]",av="[object Error]",cv="[object Function]",lv="[object Map]",uv="[object Number]",hv="[object Object]",fv="[object RegExp]",dv="[object Set]",pv="[object String]",mv="[object WeakMap]",gv="[object ArrayBuffer]",yv="[object DataView]",_v="[object Float32Array]",bv="[object Float64Array]",Ev="[object Int8Array]",wv="[object Int16Array]",xv="[object Int32Array]",kv="[object Uint8Array]",Tv="[object Uint8ClampedArray]",Av="[object Uint16Array]",vv="[object Uint32Array]",_e={};_e[_v]=_e[bv]=_e[Ev]=_e[wv]=_e[xv]=_e[kv]=_e[Tv]=_e[Av]=_e[vv]=!0,_e[rv]=_e[iv]=_e[gv]=_e[sv]=_e[yv]=_e[ov]=_e[av]=_e[cv]=_e[lv]=_e[uv]=_e[hv]=_e[fv]=_e[dv]=_e[pv]=_e[mv]=!1;function Sv(e){return pr(e)&&_h(e.length)&&!!_e[Pi(e)]}function Uc(e){return function(t){return e(t)}}var ng=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Zo=ng&&typeof module=="object"&&module&&!module.nodeType&&module,Rv=Zo&&Zo.exports===ng,bh=Rv&&Fm.process,Di=function(){try{var e=Zo&&Zo.require&&Zo.require("util").types;return e||bh&&bh.binding&&bh.binding("util")}catch{}}(),rg=Di&&Di.isTypedArray,Eh=rg?Uc(rg):Sv,Iv=Object.prototype,Nv=Iv.hasOwnProperty;function ig(e,t){var n=te(e),r=!n&&Mc(e),i=!n&&!r&&Jo(e),s=!n&&!r&&!i&&Eh(e),o=n||r||i||s,a=o?qA(e.length,String):[],c=a.length;for(var u in e)(t||Nv.call(e,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Cc(u,c)))&&a.push(u);return a}function sg(e,t){return function(n){return e(t(n))}}var Ov=sg(Object.keys,Object),Cv=Object.prototype,Lv=Cv.hasOwnProperty;function og(e){if(!qo(e))return Ov(e);var t=[];for(var n in Object(e))Lv.call(e,n)&&n!="constructor"&&t.push(n);return t}function rr(e){return Pr(e)?ig(e):og(e)}var Mv=Object.prototype,Uv=Mv.hasOwnProperty,An=VA(function(e,t){if(qo(t)||Pr(t)){gh(t,rr(t),e);return}for(var n in t)Uv.call(t,n)&&Lc(e,n,t[n])});function Fv(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var Bv=Object.prototype,Pv=Bv.hasOwnProperty;function Dv(e){if(!nr(e))return Fv(e);var t=qo(e),n=[];for(var r in e)r=="constructor"&&(t||!Pv.call(e,r))||n.push(r);return n}function ag(e){return Pr(e)?ig(e,!0):Dv(e)}var $v=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,jv=/^\w*$/;function wh(e,t){if(te(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Rc(e)?!0:jv.test(e)||!$v.test(e)||t!=null&&e in Object(t)}var Qo=cs(Object,"create");function zv(){this.__data__=Qo?Qo(null):{},this.size=0}function Wv(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Kv="__lodash_hash_undefined__",Gv=Object.prototype,Hv=Gv.hasOwnProperty;function Yv(e){var t=this.__data__;if(Qo){var n=t[e];return n===Kv?void 0:n}return Hv.call(t,e)?t[e]:void 0}var Vv=Object.prototype,Xv=Vv.hasOwnProperty;function qv(e){var t=this.__data__;return Qo?t[e]!==void 0:Xv.call(t,e)}var Jv="__lodash_hash_undefined__";function Zv(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Qo&&t===void 0?Jv:t,this}function ls(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ls.prototype.clear=zv,ls.prototype.delete=Wv,ls.prototype.get=Yv,ls.prototype.has=qv,ls.prototype.set=Zv;function Qv(){this.__data__=[],this.size=0}function Fc(e,t){for(var n=e.length;n--;)if(Xo(e[n][0],t))return n;return-1}var t2=Array.prototype,e2=t2.splice;function n2(e){var t=this.__data__,n=Fc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():e2.call(t,n,1),--this.size,!0}function r2(e){var t=this.__data__,n=Fc(t,e);return n<0?void 0:t[n][1]}function i2(e){return Fc(this.__data__,e)>-1}function s2(e,t){var n=this.__data__,r=Fc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function pi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}pi.prototype.clear=Qv,pi.prototype.delete=n2,pi.prototype.get=r2,pi.prototype.has=i2,pi.prototype.set=s2;var ta=cs(Br,"Map");function o2(){this.size=0,this.__data__={hash:new ls,map:new(ta||pi),string:new ls}}function a2(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Bc(e,t){var n=e.__data__;return a2(t)?n[typeof t=="string"?"string":"hash"]:n.map}function c2(e){var t=Bc(this,e).delete(e);return this.size-=t?1:0,t}function l2(e){return Bc(this,e).get(e)}function u2(e){return Bc(this,e).has(e)}function h2(e,t){var n=Bc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function mi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}mi.prototype.clear=o2,mi.prototype.delete=c2,mi.prototype.get=l2,mi.prototype.has=u2,mi.prototype.set=h2;var f2="Expected a function";function xh(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(f2);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(xh.Cache||mi),n}xh.Cache=mi;var d2=500;function p2(e){var t=xh(e,function(r){return n.size===d2&&n.clear(),r}),n=t.cache;return t}var m2=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,g2=/\\(\\)?/g,y2=p2(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(m2,function(n,r,i,s){t.push(i?s.replace(g2,"$1"):r||n)}),t});function cg(e){return e==null?"":jm(e)}function Pc(e,t){return te(e)?e:wh(e,t)?[e]:y2(cg(e))}var _2=1/0;function ea(e){if(typeof e=="string"||Rc(e))return e;var t=e+"";return t=="0"&&1/e==-_2?"-0":t}function kh(e,t){t=Pc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[ea(t[n++])];return n&&n==r?e:void 0}function b2(e,t,n){var r=e==null?void 0:kh(e,t);return r===void 0?n:r}function Th(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var lg=er?er.isConcatSpreadable:void 0;function E2(e){return te(e)||Mc(e)||!!(lg&&e&&e[lg])}function Ah(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=E2),i||(i=[]);++s<o;){var a=e[s];n(a)?Th(i,a):r||(i[i.length]=a)}return i}function $n(e){var t=e==null?0:e.length;return t?Ah(e):[]}var ug=sg(Object.getPrototypeOf,Object);function vh(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function w2(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:vh(e,t,n)}var x2="\\ud800-\\udfff",k2="\\u0300-\\u036f",T2="\\ufe20-\\ufe2f",A2="\\u20d0-\\u20ff",v2=k2+T2+A2,S2="\\ufe0e\\ufe0f",R2="\\u200d",I2=RegExp("["+R2+x2+v2+S2+"]");function hg(e){return I2.test(e)}function N2(e){return e.split("")}var fg="\\ud800-\\udfff",O2="\\u0300-\\u036f",C2="\\ufe20-\\ufe2f",L2="\\u20d0-\\u20ff",M2=O2+C2+L2,U2="\\ufe0e\\ufe0f",F2="["+fg+"]",Sh="["+M2+"]",Rh="\\ud83c[\\udffb-\\udfff]",B2="(?:"+Sh+"|"+Rh+")",dg="[^"+fg+"]",pg="(?:\\ud83c[\\udde6-\\uddff]){2}",mg="[\\ud800-\\udbff][\\udc00-\\udfff]",P2="\\u200d",gg=B2+"?",yg="["+U2+"]?",D2="(?:"+P2+"(?:"+[dg,pg,mg].join("|")+")"+yg+gg+")*",$2=yg+gg+D2,j2="(?:"+[dg+Sh+"?",Sh,pg,mg,F2].join("|")+")",z2=RegExp(Rh+"(?="+Rh+")|"+j2+$2,"g");function W2(e){return e.match(z2)||[]}function K2(e){return hg(e)?W2(e):N2(e)}function G2(e){return function(t){t=cg(t);var n=hg(t)?K2(t):void 0,r=n?n[0]:t.charAt(0),i=n?w2(n,1).join(""):t.slice(1);return r[e]()+i}}var _g=G2("toUpperCase");function H2(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function Y2(){this.__data__=new pi,this.size=0}function V2(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function X2(e){return this.__data__.get(e)}function q2(e){return this.__data__.has(e)}var J2=200;function Z2(e,t){var n=this.__data__;if(n instanceof pi){var r=n.__data__;if(!ta||r.length<J2-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new mi(r)}return n.set(e,t),this.size=n.size,this}function Dr(e){var t=this.__data__=new pi(e);this.size=t.size}Dr.prototype.clear=Y2,Dr.prototype.delete=V2,Dr.prototype.get=X2,Dr.prototype.has=q2,Dr.prototype.set=Z2;function Q2(e,t){return e&&gh(t,rr(t),e)}var bg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Eg=bg&&typeof module=="object"&&module&&!module.nodeType&&module,tS=Eg&&Eg.exports===bg,wg=tS?Br.Buffer:void 0,xg=wg?wg.allocUnsafe:void 0;function eS(e,t){var n=e.length,r=xg?xg(n):new e.constructor(n);return e.copy(r),r}function Ih(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function kg(){return[]}var nS=Object.prototype,rS=nS.propertyIsEnumerable,Tg=Object.getOwnPropertySymbols,Nh=Tg?function(e){return e==null?[]:(e=Object(e),Ih(Tg(e),function(t){return rS.call(e,t)}))}:kg;function iS(e,t){return gh(e,Nh(e),t)}var sS=Object.getOwnPropertySymbols,oS=sS?function(e){for(var t=[];e;)Th(t,Nh(e)),e=ug(e);return t}:kg;function Ag(e,t,n){var r=t(e);return te(e)?r:Th(r,n(e))}function Oh(e){return Ag(e,rr,Nh)}function aS(e){return Ag(e,ag,oS)}var Ch=cs(Br,"DataView"),Lh=cs(Br,"Promise"),Qs=cs(Br,"Set"),vg="[object Map]",cS="[object Object]",Sg="[object Promise]",Rg="[object Set]",Ig="[object WeakMap]",Ng="[object DataView]",lS=as(Ch),uS=as(ta),hS=as(Lh),fS=as(Qs),dS=as(dh),ir=Pi;(Ch&&ir(new Ch(new ArrayBuffer(1)))!=Ng||ta&&ir(new ta)!=vg||Lh&&ir(Lh.resolve())!=Sg||Qs&&ir(new Qs)!=Rg||dh&&ir(new dh)!=Ig)&&(ir=function(e){var t=Pi(e),n=t==cS?e.constructor:void 0,r=n?as(n):"";if(r)switch(r){case lS:return Ng;case uS:return vg;case hS:return Sg;case fS:return Rg;case dS:return Ig}return t});var pS=Object.prototype,mS=pS.hasOwnProperty;function gS(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&mS.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Dc=Br.Uint8Array;function yS(e){var t=new e.constructor(e.byteLength);return new Dc(t).set(new Dc(e)),t}function _S(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var bS=/\w*$/;function ES(e){var t=new e.constructor(e.source,bS.exec(e));return t.lastIndex=e.lastIndex,t}var Og=er?er.prototype:void 0,Cg=Og?Og.valueOf:void 0;function wS(e){return Cg?Object(Cg.call(e)):{}}function xS(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var kS="[object Boolean]",TS="[object Date]",AS="[object Map]",vS="[object Number]",SS="[object RegExp]",RS="[object Set]",IS="[object String]",NS="[object Symbol]",OS="[object ArrayBuffer]",CS="[object DataView]",LS="[object Float32Array]",MS="[object Float64Array]",US="[object Int8Array]",FS="[object Int16Array]",BS="[object Int32Array]",PS="[object Uint8Array]",DS="[object Uint8ClampedArray]",$S="[object Uint16Array]",jS="[object Uint32Array]";function zS(e,t,n){var r=e.constructor;switch(t){case OS:return yS(e);case kS:case TS:return new r(+e);case CS:return _S(e);case LS:case MS:case US:case FS:case BS:case PS:case DS:case $S:case jS:return xS(e);case AS:return new r;case vS:case IS:return new r(e);case SS:return ES(e);case RS:return new r;case NS:return wS(e)}}function WS(e){return typeof e.constructor=="function"&&!qo(e)?NA(ug(e)):{}}var KS="[object Map]";function GS(e){return pr(e)&&ir(e)==KS}var Lg=Di&&Di.isMap,HS=Lg?Uc(Lg):GS,YS="[object Set]";function VS(e){return pr(e)&&ir(e)==YS}var Mg=Di&&Di.isSet,XS=Mg?Uc(Mg):VS,Ug="[object Arguments]",qS="[object Array]",JS="[object Boolean]",ZS="[object Date]",QS="[object Error]",Fg="[object Function]",tR="[object GeneratorFunction]",eR="[object Map]",nR="[object Number]",Bg="[object Object]",rR="[object RegExp]",iR="[object Set]",sR="[object String]",oR="[object Symbol]",aR="[object WeakMap]",cR="[object ArrayBuffer]",lR="[object DataView]",uR="[object Float32Array]",hR="[object Float64Array]",fR="[object Int8Array]",dR="[object Int16Array]",pR="[object Int32Array]",mR="[object Uint8Array]",gR="[object Uint8ClampedArray]",yR="[object Uint16Array]",_R="[object Uint32Array]",me={};me[Ug]=me[qS]=me[cR]=me[lR]=me[JS]=me[ZS]=me[uR]=me[hR]=me[fR]=me[dR]=me[pR]=me[eR]=me[nR]=me[Bg]=me[rR]=me[iR]=me[sR]=me[oR]=me[mR]=me[gR]=me[yR]=me[_R]=!0,me[QS]=me[Fg]=me[aR]=!1;function $c(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!nr(e))return e;var a=te(e);if(a)return o=gS(e),CA(e,o);var c=ir(e),u=c==Fg||c==tR;if(Jo(e))return eS(e);if(c==Bg||c==Ug||u&&!i)return o=u?{}:WS(e),iS(e,Q2(o,e));if(!me[c])return i?e:{};o=zS(e,c),s||(s=new Dr);var l=s.get(e);if(l)return l;s.set(e,o),XS(e)?e.forEach(function(d){o.add($c(d,t,n,d,e,s))}):HS(e)&&e.forEach(function(d,p){o.set(p,$c(d,t,n,p,e,s))});var h=Oh,f=a?void 0:h(e);return Hm(f||e,function(d,p){f&&(p=d,d=e[p]),Lc(o,p,$c(d,t,n,p,e,s))}),o}var bR=4;function nn(e){return $c(e,bR)}function na(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var ER="__lodash_hash_undefined__";function wR(e){return this.__data__.set(e,ER),this}function xR(e){return this.__data__.has(e)}function to(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new mi;++t<n;)this.add(e[t])}to.prototype.add=to.prototype.push=wR,to.prototype.has=xR;function Pg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Mh(e,t){return e.has(t)}var kR=1,TR=2;function Dg(e,t,n,r,i,s){var o=n&kR,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),l=s.get(t);if(u&&l)return u==t&&l==e;var h=-1,f=!0,d=n&TR?new to:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var p=e[h],m=t[h];if(r)var w=o?r(m,p,h,t,e,s):r(p,m,h,e,t,s);if(w!==void 0){if(w)continue;f=!1;break}if(d){if(!Pg(t,function(E,T){if(!Mh(d,T)&&(p===E||i(p,E,n,r,s)))return d.push(T)})){f=!1;break}}else if(!(p===m||i(p,m,n,r,s))){f=!1;break}}return s.delete(e),s.delete(t),f}function AR(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Uh(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var vR=1,SR=2,RR="[object Boolean]",IR="[object Date]",NR="[object Error]",OR="[object Map]",CR="[object Number]",LR="[object RegExp]",MR="[object Set]",UR="[object String]",FR="[object Symbol]",BR="[object ArrayBuffer]",PR="[object DataView]",$g=er?er.prototype:void 0,Fh=$g?$g.valueOf:void 0;function DR(e,t,n,r,i,s,o){switch(n){case PR:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case BR:return!(e.byteLength!=t.byteLength||!s(new Dc(e),new Dc(t)));case RR:case IR:case CR:return Xo(+e,+t);case NR:return e.name==t.name&&e.message==t.message;case LR:case UR:return e==t+"";case OR:var a=AR;case MR:var c=r&vR;if(a||(a=Uh),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;r|=SR,o.set(e,t);var l=Dg(a(e),a(t),r,i,s,o);return o.delete(e),l;case FR:if(Fh)return Fh.call(e)==Fh.call(t)}return!1}var $R=1,jR=Object.prototype,zR=jR.hasOwnProperty;function WR(e,t,n,r,i,s){var o=n&$R,a=Oh(e),c=a.length,u=Oh(t),l=u.length;if(c!=l&&!o)return!1;for(var h=c;h--;){var f=a[h];if(!(o?f in t:zR.call(t,f)))return!1}var d=s.get(e),p=s.get(t);if(d&&p)return d==t&&p==e;var m=!0;s.set(e,t),s.set(t,e);for(var w=o;++h<c;){f=a[h];var E=e[f],T=t[f];if(r)var v=o?r(T,E,f,t,e,s):r(E,T,f,e,t,s);if(!(v===void 0?E===T||i(E,T,n,r,s):v)){m=!1;break}w||(w=f=="constructor")}if(m&&!w){var I=e.constructor,U=t.constructor;I!=U&&"constructor"in e&&"constructor"in t&&!(typeof I=="function"&&I instanceof I&&typeof U=="function"&&U instanceof U)&&(m=!1)}return s.delete(e),s.delete(t),m}var KR=1,jg="[object Arguments]",zg="[object Array]",jc="[object Object]",GR=Object.prototype,Wg=GR.hasOwnProperty;function HR(e,t,n,r,i,s){var o=te(e),a=te(t),c=o?zg:ir(e),u=a?zg:ir(t);c=c==jg?jc:c,u=u==jg?jc:u;var l=c==jc,h=u==jc,f=c==u;if(f&&Jo(e)){if(!Jo(t))return!1;o=!0,l=!1}if(f&&!l)return s||(s=new Dr),o||Eh(e)?Dg(e,t,n,r,i,s):DR(e,t,c,n,r,i,s);if(!(n&KR)){var d=l&&Wg.call(e,"__wrapped__"),p=h&&Wg.call(t,"__wrapped__");if(d||p){var m=d?e.value():e,w=p?t.value():t;return s||(s=new Dr),i(m,w,n,r,s)}}return f?(s||(s=new Dr),WR(e,t,n,r,i,s)):!1}function Bh(e,t,n,r,i){return e===t?!0:e==null||t==null||!pr(e)&&!pr(t)?e!==e&&t!==t:HR(e,t,n,r,Bh,i)}var YR=1,VR=2;function XR(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],u=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var l=new Dr,h;if(!(h===void 0?Bh(u,c,YR|VR,r,l):h))return!1}}return!0}function Kg(e){return e===e&&!nr(e)}function qR(e){for(var t=rr(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Kg(i)]}return t}function Gg(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function JR(e){var t=qR(e);return t.length==1&&t[0][2]?Gg(t[0][0],t[0][1]):function(n){return n===e||XR(n,e,t)}}function ZR(e,t){return e!=null&&t in Object(e)}function Hg(e,t,n){t=Pc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=ea(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&_h(i)&&Cc(o,i)&&(te(e)||Mc(e)))}function QR(e,t){return e!=null&&Hg(e,t,ZR)}var tI=1,eI=2;function nI(e,t){return wh(e)&&Kg(t)?Gg(ea(e),t):function(n){var r=b2(n,e);return r===void 0&&r===t?QR(n,e):Bh(t,r,tI|eI)}}function rI(e){return function(t){return t==null?void 0:t[e]}}function iI(e){return function(t){return kh(t,e)}}function sI(e){return wh(e)?rI(ea(e)):iI(e)}function $r(e){return typeof e=="function"?e:e==null?Zs:typeof e=="object"?te(e)?nI(e[0],e[1]):JR(e):sI(e)}function oI(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function aI(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var cI=aI();function lI(e,t){return e&&cI(e,t,rr)}function uI(e,t){return function(n,r){if(n==null)return n;if(!Pr(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var us=uI(lI);function hI(e,t,n,r){return us(e,function(i,s,o){t(r,i,n(i),o)}),r}function fI(e,t){return function(n,r){var i=te(n)?oI:hI,s=t?t():{};return i(n,e,$r(r),s)}}var Yg=Object.prototype,dI=Yg.hasOwnProperty,Ph=yh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&qm(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=ag(s),a=-1,c=o.length;++a<c;){var u=o[a],l=e[u];(l===void 0||Xo(l,Yg[u])&&!dI.call(e,u))&&(e[u]=s[u])}return e});function Vg(e){return pr(e)&&Pr(e)}var pI=200;function mI(e,t,n,r){var i=-1,s=Vm,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;t.length>=pI&&(s=Mh,o=!1,t=new to(t));t:for(;++i<a;){var l=e[i],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=u;f--;)if(t[f]===h)continue t;c.push(l)}else s(t,h,r)||c.push(l)}return c}var zc=yh(function(e,t){return Vg(e)?mI(e,Ah(t,1,Vg,!0)):[]});function eo(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function rn(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Nc(t),vh(e,t<0?0:t,r)):[]}function ra(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Nc(t),t=r-t,vh(e,0,t<0?0:t)):[]}function gI(e){return typeof e=="function"?e:Zs}function It(e,t){var n=te(e)?Hm:us;return n(e,gI(t))}function yI(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function _I(e,t){var n=!0;return us(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function mr(e,t,n){var r=te(e)?yI:_I;return r(e,$r(t))}function Xg(e,t){var n=[];return us(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function sr(e,t){var n=te(e)?Ih:Xg;return n(e,$r(t))}function bI(e){return function(t,n,r){var i=Object(t);if(!Pr(t)){var s=$r(n);t=rr(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var EI=Math.max;function wI(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:Nc(n);return i<0&&(i=EI(r+i,0)),Ym(e,$r(t),i)}var no=bI(wI);function gr(e){return e&&e.length?e[0]:void 0}function xI(e,t){var n=-1,r=Pr(e)?Array(e.length):[];return us(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function xt(e,t){var n=te(e)?Ic:xI;return n(e,$r(t))}function or(e,t){return Ah(xt(e,t))}var kI=Object.prototype,TI=kI.hasOwnProperty,qg=fI(function(e,t,n){TI.call(e,n)?e[n].push(t):mh(e,n,[t])}),AI=Object.prototype,vI=AI.hasOwnProperty;function SI(e,t){return e!=null&&vI.call(e,t)}function Rt(e,t){return e!=null&&Hg(e,t,SI)}var RI="[object String]";function vn(e){return typeof e=="string"||!te(e)&&pr(e)&&Pi(e)==RI}function II(e,t){return Ic(t,function(n){return e[n]})}function Be(e){return e==null?[]:II(e,rr(e))}var NI=Math.max;function yn(e,t,n,r){e=Pr(e)?e:Be(e),n=n&&!r?Nc(n):0;var i=e.length;return n<0&&(n=NI(i+n,0)),vn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&ph(e,t,n)>-1}function Jg(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return ph(e,t,i)}var OI="[object Map]",CI="[object Set]",LI=Object.prototype,MI=LI.hasOwnProperty;function ge(e){if(e==null)return!0;if(Pr(e)&&(te(e)||typeof e=="string"||typeof e.splice=="function"||Jo(e)||Eh(e)||Mc(e)))return!e.length;var t=ir(e);if(t==OI||t==CI)return!e.size;if(qo(e))return!og(e).length;for(var n in e)if(MI.call(e,n))return!1;return!0}var UI="[object RegExp]";function FI(e){return pr(e)&&Pi(e)==UI}var Zg=Di&&Di.isRegExp,gi=Zg?Uc(Zg):FI;function yi(e){return e===void 0}var BI="Expected a function";function PI(e){if(typeof e!="function")throw new TypeError(BI);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function DI(e,t,n,r){if(!nr(e))return e;t=Pc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=ea(t[i]),u=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var l=a[c];u=void 0,u===void 0&&(u=nr(l)?l:Cc(t[i+1])?[]:{})}Lc(a,c,u),a=a[c]}return e}function $I(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=kh(e,o);n(a,o)&&DI(s,Pc(o,e),a)}return s}function yr(e,t){if(e==null)return{};var n=Ic(aS(e),function(r){return[r]});return t=$r(t),$I(e,n,function(r,i){return t(r,i[0])})}function jI(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function Sn(e,t,n){var r=te(e)?H2:jI,i=arguments.length<3;return r(e,$r(t),n,i,us)}function Wc(e,t){var n=te(e)?Ih:Xg;return n(e,PI($r(t)))}function zI(e,t){var n;return us(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function Dh(e,t,n){var r=te(e)?Pg:zI;return r(e,$r(t))}var WI=1/0,KI=Qs&&1/Uh(new Qs([,-0]))[1]==WI?function(e){return new Qs(e)}:We,GI=200;function HI(e,t,n){var r=-1,i=Vm,s=e.length,o=!0,a=[],c=a;if(s>=GI){var u=KI(e);if(u)return Uh(u);o=!1,i=Mh,c=new to}else c=a;t:for(;++r<s;){var l=e[r],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=c.length;f--;)if(c[f]===h)continue t;a.push(l)}else i(c,h,n)||(c!==a&&c.push(h),a.push(l))}return a}function Kc(e){return e&&e.length?HI(e):[]}function $h(e){console&&console.error&&console.error(`Error: ${e}`)}function Qg(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function ty(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function ey(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function YI(e){return VI(e)?e.LABEL:e.name}function VI(e){return vn(e.LABEL)&&e.LABEL!==""}class jr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),It(this.definition,n=>{n.accept(t)})}}class Rn extends jr{constructor(t){super([]),this.idx=1,An(this,yr(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class ro extends jr{constructor(t){super(t.definition),this.orgText="",An(this,yr(t,n=>n!==void 0))}}class In extends jr{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,An(this,yr(t,n=>n!==void 0))}}class Nn extends jr{constructor(t){super(t.definition),this.idx=1,An(this,yr(t,n=>n!==void 0))}}class zr extends jr{constructor(t){super(t.definition),this.idx=1,An(this,yr(t,n=>n!==void 0))}}class Wr extends jr{constructor(t){super(t.definition),this.idx=1,An(this,yr(t,n=>n!==void 0))}}class Ke extends jr{constructor(t){super(t.definition),this.idx=1,An(this,yr(t,n=>n!==void 0))}}class _r extends jr{constructor(t){super(t.definition),this.idx=1,An(this,yr(t,n=>n!==void 0))}}class br extends jr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,An(this,yr(t,n=>n!==void 0))}}class Te{constructor(t){this.idx=1,An(this,yr(t,n=>n!==void 0))}accept(t){t.visit(this)}}function XI(e){return xt(e,Gc)}function Gc(e){function t(n){return xt(n,Gc)}if(e instanceof Rn){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return vn(e.label)&&(n.label=e.label),n}else{if(e instanceof In)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Nn)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof zr)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof Wr)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Gc(new Te({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof _r)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Gc(new Te({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Ke)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof br)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Te){const n={type:"Terminal",name:e.terminalType.name,label:YI(e.terminalType),idx:e.idx};vn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=gi(r)?r.source:r),n}else{if(e instanceof ro)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class hs{visit(t){const n=t;switch(n.constructor){case Rn:return this.visitNonTerminal(n);case In:return this.visitAlternative(n);case Nn:return this.visitOption(n);case zr:return this.visitRepetitionMandatory(n);case Wr:return this.visitRepetitionMandatoryWithSeparator(n);case _r:return this.visitRepetitionWithSeparator(n);case Ke:return this.visitRepetition(n);case br:return this.visitAlternation(n);case Te:return this.visitTerminal(n);case ro:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function qI(e){return e instanceof In||e instanceof Nn||e instanceof Ke||e instanceof zr||e instanceof Wr||e instanceof _r||e instanceof Te||e instanceof ro}function Hc(e,t=[]){return e instanceof Nn||e instanceof Ke||e instanceof _r?!0:e instanceof br?Dh(e.definition,r=>Hc(r,t)):e instanceof Rn&&yn(t,e)?!1:e instanceof jr?(e instanceof Rn&&t.push(e),mr(e.definition,r=>Hc(r,t))):!1}function JI(e){return e instanceof br}function Kr(e){if(e instanceof Rn)return"SUBRULE";if(e instanceof Nn)return"OPTION";if(e instanceof br)return"OR";if(e instanceof zr)return"AT_LEAST_ONE";if(e instanceof Wr)return"AT_LEAST_ONE_SEP";if(e instanceof _r)return"MANY_SEP";if(e instanceof Ke)return"MANY";if(e instanceof Te)return"CONSUME";throw Error("non exhaustive match")}class Yc{walk(t,n=[]){It(t.definition,(r,i)=>{const s=rn(t.definition,i+1);if(r instanceof Rn)this.walkProdRef(r,s,n);else if(r instanceof Te)this.walkTerminal(r,s,n);else if(r instanceof In)this.walkFlat(r,s,n);else if(r instanceof Nn)this.walkOption(r,s,n);else if(r instanceof zr)this.walkAtLeastOne(r,s,n);else if(r instanceof Wr)this.walkAtLeastOneSep(r,s,n);else if(r instanceof _r)this.walkManySep(r,s,n);else if(r instanceof Ke)this.walkMany(r,s,n);else if(r instanceof br)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new Nn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=ny(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new Nn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=ny(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);It(t.definition,s=>{const o=new In({definition:[s]});this.walk(o,i)})}}function ny(e,t,n){return[new Nn({definition:[new Te({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function ia(e){if(e instanceof Rn)return ia(e.referencedRule);if(e instanceof Te)return tN(e);if(qI(e))return ZI(e);if(JI(e))return QI(e);throw Error("non exhaustive match")}function ZI(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=Hc(s),t=t.concat(ia(s)),r=r+1,i=n.length>r;return Kc(t)}function QI(e){const t=xt(e.definition,n=>ia(n));return Kc($n(t))}function tN(e){return[e.terminalType]}const ry="_~IN~_";class eN extends Yc{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=rN(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new In({definition:s}),a=ia(o);this.follows[i]=a}}function nN(e){const t={};return It(e,n=>{const r=new eN(n).startWalking();An(t,r)}),t}function rN(e,t){return e.name+t+ry}function Nt(e){return e.charCodeAt(0)}function jh(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function sa(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function io(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function iN(){throw Error("Internal Error - Should never get here!")}function iy(e){return e.type==="Character"}const Vc=[];for(let e=Nt("0");e<=Nt("9");e++)Vc.push(e);const Xc=[Nt("_")].concat(Vc);for(let e=Nt("a");e<=Nt("z");e++)Xc.push(e);for(let e=Nt("A");e<=Nt("Z");e++)Xc.push(e);const sy=[Nt(" "),Nt("\f"),Nt(`
`),Nt("\r"),Nt("	"),Nt("\v"),Nt("	"),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt("\u2028"),Nt("\u2029"),Nt(""),Nt(""),Nt(""),Nt("\uFEFF")],sN=/[0-9a-fA-F]/,qc=/[0-9]/,oN=/[1-9]/;class aN{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":sa(r,"global");break;case"i":sa(r,"ignoreCase");break;case"m":sa(r,"multiLine");break;case"u":sa(r,"unicode");break;case"y":sa(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}io(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return iN()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;io(n);break}if(!(t===!0&&n===void 0)&&io(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),io(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Nt(`
`),Nt("\r"),Nt("\u2028"),Nt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=Vc;break;case"D":t=Vc,n=!0;break;case"s":t=sy;break;case"S":t=sy,n=!0;break;case"w":t=Xc;break;case"W":t=Xc,n=!0;break}if(io(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Nt("\f");break;case"n":t=Nt(`
`);break;case"r":t=Nt("\r");break;case"t":t=Nt("	");break;case"v":t=Nt("\v");break}if(io(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Nt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Nt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Nt(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,iy(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,iy(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else jh(r.value,t),t.push(Nt("-")),jh(i.value,t)}else jh(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Nt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(oN.test(t)===!1)throw Error("Expecting a positive integer");for(;qc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(qc.test(t)===!1)throw Error("Expecting an integer");for(;qc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Nt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return qc.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(sN.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class zh{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let Jc={};const cN=new aN;function Zc(e){const t=e.toString();if(Jc.hasOwnProperty(t))return Jc[t];{const n=cN.pattern(t);return Jc[t]=n,n}}function lN(){Jc={}}const oy="Complement Sets are not supported for first char optimization",Qc=`Unable to use "first char" lexer optimizations:
`;function uN(e,t=!1){try{const n=Zc(e);return Wh(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===oy)t&&Qg(`${Qc}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),$h(`${Qc}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Wh(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)Wh(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":tl(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(oy);It(o.value,c=>{if(typeof c=="number")tl(c,t,n);else{const u=c;if(n===!0)for(let l=u.from;l<=u.to;l++)tl(l,t,n);else{for(let l=u.from;l<=u.to&&l<aa;l++)tl(l,t,n);if(u.to>=aa){const l=u.from>=aa?u.from:aa,h=u.to,f=$i(l),d=$i(h);for(let p=f;p<=d;p++)t[p]=p}}}});break;case"Group":Wh(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Kh(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Be(t)}function tl(e,t,n){const r=$i(e);t[r]=r,n===!0&&hN(e,t)}function hN(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=$i(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=$i(i.charCodeAt(0));t[s]=s}}}function ay(e,t){return no(e.value,n=>{if(typeof n=="number")return yn(t,n);{const r=n;return no(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function Kh(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?te(e.value)?mr(e.value,Kh):Kh(e.value):!1}class fN extends zh{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){yn(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?ay(t,this.targetCharCodes)===void 0&&(this.found=!0):ay(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Gh(e,t){if(t instanceof RegExp){const n=Zc(t),r=new fN(e);return r.visit(n),r.found}else return no(t,n=>yn(e,n.charCodeAt(0)))!==void 0}const fs="PATTERN",oa="defaultMode",el="modes";let cy=typeof new RegExp("(?:)").sticky=="boolean";function dN(e,t){t=Ph(t,{useSticky:cy,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(T,v)=>v()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{FN()});let r;n("Reject Lexer.NA",()=>{r=Wc(e,T=>T[fs]===Ge.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=xt(r,T=>{const v=T[fs];if(gi(v)){const I=v.source;return I.length===1&&I!=="^"&&I!=="$"&&I!=="."&&!v.ignoreCase?I:I.length===2&&I[0]==="\\"&&!yn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],I[1])?I[1]:t.useSticky?uy(v):ly(v)}else{if(di(v))return i=!0,{exec:v};if(typeof v=="object")return i=!0,v;if(typeof v=="string"){if(v.length===1)return v;{const I=v.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),U=new RegExp(I);return t.useSticky?uy(U):ly(U)}}else throw Error("non exhaustive match")}})});let o,a,c,u,l;n("misc mapping",()=>{o=xt(r,T=>T.tokenTypeIdx),a=xt(r,T=>{const v=T.GROUP;if(v!==Ge.SKIPPED){if(vn(v))return v;if(yi(v))return!1;throw Error("non exhaustive match")}}),c=xt(r,T=>{const v=T.LONGER_ALT;if(v)return te(v)?xt(v,U=>Jg(r,U)):[Jg(r,v)]}),u=xt(r,T=>T.PUSH_MODE),l=xt(r,T=>Rt(T,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const T=dy(t.lineTerminatorCharacters);h=xt(r,v=>!1),t.positionTracking!=="onlyOffset"&&(h=xt(r,v=>Rt(v,"LINE_BREAKS")?!!v.LINE_BREAKS:fy(v,T)===!1&&Gh(T,v.PATTERN)))});let f,d,p,m;n("Misc Mapping #2",()=>{f=xt(r,hy),d=xt(s,LN),p=Sn(r,(T,v)=>{const I=v.GROUP;return vn(I)&&I!==Ge.SKIPPED&&(T[I]=[]),T},{}),m=xt(s,(T,v)=>({pattern:s[v],longerAlt:c[v],canLineTerminator:h[v],isCustom:f[v],short:d[v],group:a[v],push:u[v],pop:l[v],tokenTypeIdx:o[v],tokenType:r[v]}))});let w=!0,E=[];return t.safeMode||n("First Char Optimization",()=>{E=Sn(r,(T,v,I)=>{if(typeof v.PATTERN=="string"){const U=v.PATTERN.charCodeAt(0),S=$i(U);Hh(T,S,m[I])}else if(te(v.START_CHARS_HINT)){let U;It(v.START_CHARS_HINT,S=>{const N=typeof S=="string"?S.charCodeAt(0):S,P=$i(N);U!==P&&(U=P,Hh(T,P,m[I]))})}else if(gi(v.PATTERN))if(v.PATTERN.unicode)w=!1,t.ensureOptimizations&&$h(`${Qc}	Unable to analyze < ${v.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const U=uN(v.PATTERN,t.ensureOptimizations);ge(U)&&(w=!1),It(U,S=>{Hh(T,S,m[I])})}else t.ensureOptimizations&&$h(`${Qc}	TokenType: <${v.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),w=!1;return T},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:E,hasCustom:i,canBeOptimized:w}}function pN(e,t){let n=[];const r=gN(e);n=n.concat(r.errors);const i=yN(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(mN(s)),n=n.concat(AN(s)),n=n.concat(vN(s,t)),n=n.concat(SN(s)),n}function mN(e){let t=[];const n=sr(e,r=>gi(r[fs]));return t=t.concat(bN(n)),t=t.concat(xN(n)),t=t.concat(kN(n)),t=t.concat(TN(n)),t=t.concat(EN(n)),t}function gN(e){const t=sr(e,i=>!Rt(i,fs)),n=xt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Re.MISSING_PATTERN,tokenTypes:[i]})),r=zc(e,t);return{errors:n,valid:r}}function yN(e){const t=sr(e,i=>{const s=i[fs];return!gi(s)&&!di(s)&&!Rt(s,"exec")&&!vn(s)}),n=xt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Re.INVALID_PATTERN,tokenTypes:[i]})),r=zc(e,t);return{errors:n,valid:r}}const _N=/[^\\][$]/;function bN(e){class t extends zh{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=sr(e,i=>{const s=i.PATTERN;try{const o=Zc(s),a=new t;return a.visit(o),a.found}catch{return _N.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Re.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function EN(e){const t=sr(e,r=>r.PATTERN.test(""));return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Re.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const wN=/[^\\[][\^]|^\^/;function xN(e){class t extends zh{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=sr(e,i=>{const s=i.PATTERN;try{const o=Zc(s),a=new t;return a.visit(o),a.found}catch{return wN.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Re.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function kN(e){const t=sr(e,r=>{const i=r[fs];return i instanceof RegExp&&(i.multiline||i.global)});return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Re.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function TN(e){const t=[];let n=xt(e,s=>Sn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!yn(t,a)&&a.PATTERN!==Ge.NA&&(t.push(a),o.push(a)),o),[]));n=na(n);const r=sr(n,s=>s.length>1);return xt(r,s=>{const o=xt(s,c=>c.name);return{message:`The same RegExp pattern ->${gr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Re.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function AN(e){const t=sr(e,r=>{if(!Rt(r,"GROUP"))return!1;const i=r.GROUP;return i!==Ge.SKIPPED&&i!==Ge.NA&&!vn(i)});return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Re.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function vN(e,t){const n=sr(e,i=>i.PUSH_MODE!==void 0&&!yn(t,i.PUSH_MODE));return xt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Re.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function SN(e){const t=[],n=Sn(e,(r,i,s)=>{const o=i.PATTERN;return o===Ge.NA||(vn(o)?r.push({str:o,idx:s,tokenType:i}):gi(o)&&IN(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return It(e,(r,i)=>{It(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&RN(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Re.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function RN(e,t){if(gi(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(di(t))return t(e,0,[],{});if(Rt(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function IN(e){return no([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function ly(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function uy(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function NN(e,t,n){const r=[];return Rt(e,oa)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+oa+`> property in its definition
`,type:Re.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Rt(e,el)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+el+`> property in its definition
`,type:Re.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Rt(e,el)&&Rt(e,oa)&&!Rt(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${oa}: <${e.defaultMode}>which does not exist
`,type:Re.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Rt(e,el)&&It(e.modes,(i,s)=>{It(i,(o,a)=>{if(yi(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Re.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Rt(o,"LONGER_ALT")){const c=te(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];It(c,u=>{!yi(u)&&!yn(i,u)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${u.name}> on token <${o.name}> outside of mode <${s}>
`,type:Re.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function ON(e,t,n){const r=[];let i=!1;const s=na($n(Be(e.modes))),o=Wc(s,c=>c[fs]===Ge.NA),a=dy(n);return t&&It(o,c=>{const u=fy(c,a);if(u!==!1){const h={message:UN(c,u),type:u.issue,tokenType:c};r.push(h)}else Rt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):Gh(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Re.NO_LINE_BREAKS_FLAGS}),r}function CN(e){const t={},n=rr(e);return It(n,r=>{const i=e[r];if(te(i))t[r]=[];else throw Error("non exhaustive match")}),t}function hy(e){const t=e.PATTERN;if(gi(t))return!1;if(di(t))return!0;if(Rt(t,"exec"))return!0;if(vn(t))return!1;throw Error("non exhaustive match")}function LN(e){return vn(e)&&e.length===1?e.charCodeAt(0):!1}const MN={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function fy(e,t){if(Rt(e,"LINE_BREAKS"))return!1;if(gi(e.PATTERN)){try{Gh(t,e.PATTERN)}catch(n){return{issue:Re.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(vn(e.PATTERN))return!1;if(hy(e))return{issue:Re.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function UN(e,t){if(t.issue===Re.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Re.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function dy(e){return xt(e,n=>vn(n)?n.charCodeAt(0):n)}function Hh(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const aa=256;let nl=[];function $i(e){return e<aa?e:nl[e]}function FN(){if(ge(nl)){nl=new Array(65536);for(let e=0;e<65536;e++)nl[e]=e>255?255+~~(e/255):e}}function ca(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function rl(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let py=1;const my={};function la(e){const t=BN(e);PN(t),$N(t),DN(t),It(t,n=>{n.isParent=n.categoryMatches.length>0})}function BN(e){let t=nn(e),n=e,r=!0;for(;r;){n=na($n(xt(n,s=>s.CATEGORIES)));const i=zc(n,t);t=t.concat(i),ge(i)?r=!1:n=i}return t}function PN(e){It(e,t=>{yy(t)||(my[py]=t,t.tokenTypeIdx=py++),_y(t)&&!te(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),_y(t)||(t.CATEGORIES=[]),jN(t)||(t.categoryMatches=[]),zN(t)||(t.categoryMatchesMap={})})}function DN(e){It(e,t=>{t.categoryMatches=[],It(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(my[r].tokenTypeIdx)})})}function $N(e){It(e,t=>{gy([],t)})}function gy(e,t){It(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),It(t.CATEGORIES,n=>{const r=e.concat(t);yn(r,n)||gy(r,n)})}function yy(e){return Rt(e,"tokenTypeIdx")}function _y(e){return Rt(e,"CATEGORIES")}function jN(e){return Rt(e,"categoryMatches")}function zN(e){return Rt(e,"categoryMatchesMap")}function WN(e){return Rt(e,"tokenTypeIdx")}const KN={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Re;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Re||(Re={}));const ua={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:KN,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(ua);let Ge=class{constructor(t,n=ua){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=ty(s),u=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&u(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=An({},ua,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===ua.lineTerminatorsPattern)this.config.lineTerminatorsPattern=MN;else if(this.config.lineTerminatorCharacters===ua.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),te(t)?i={modes:{defaultMode:nn(t)},defaultMode:oa}:(s=!1,i=nn(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(NN(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(ON(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},It(i.modes,(a,c)=>{i.modes[c]=Wc(a,u=>yi(u))});const o=rr(i.modes);if(It(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(pN(a,o))}),ge(this.lexerDefinitionErrors)){la(a);let u;this.TRACE_INIT("analyzeTokenTypes",()=>{u=dN(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=u.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=u.charCodeToPatternIdxToConfig,this.emptyGroups=An({},this.emptyGroups,u.emptyGroups),this.hasCustom=u.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=u.canBeOptimized}})}),this.defaultMode=i.defaultMode,!ge(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=xt(this.lexerDefinitionErrors,u=>u.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}It(this.lexerDefinitionWarning,a=>{Qg(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(cy?(this.chopInput=Zs,this.match=this.matchWithTest):(this.updateLastIndex=We,this.match=this.matchWithExec),s&&(this.handleModes=We),this.trackStartLines===!1&&(this.computeNewColumn=Zs),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=We),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Sn(this.canModeBeOptimized,(c,u,l)=>(u===!1&&c.push(l),c),[]);if(n.ensureOptimizations&&!ge(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{lN()}),this.TRACE_INIT("toFastProperties",()=>{ey(this)})})}tokenize(t,n=this.defaultMode){if(!ge(this.lexerDefinitionErrors)){const i=xt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,u,l,h,f,d,p,m,w,E;const T=t,v=T.length;let I=0,U=0;const S=this.hasCustom?0:Math.floor(t.length/10),N=new Array(S),P=[];let L=this.trackStartLines?1:void 0,V=this.trackStartLines?1:void 0;const Z=CN(this.emptyGroups),C=this.trackStartLines,R=this.config.lineTerminatorsPattern;let _=0,B=[],X=[];const D=[],lt=[];Object.freeze(lt);let et;function ft(){return B}function G(Lt){const ee=$i(Lt),At=X[ee];return At===void 0?lt:At}const W=Lt=>{if(D.length===1&&Lt.tokenType.PUSH_MODE===void 0){const ee=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Lt);P.push({offset:Lt.startOffset,line:Lt.startLine,column:Lt.startColumn,length:Lt.image.length,message:ee})}else{D.pop();const ee=eo(D);B=this.patternIdxToConfig[ee],X=this.charCodeToPatternIdxToConfig[ee],_=B.length;const At=this.canModeBeOptimized[ee]&&this.config.safeMode===!1;X&&At?et=G:et=ft}};function bt(Lt){D.push(Lt),X=this.charCodeToPatternIdxToConfig[Lt],B=this.patternIdxToConfig[Lt],_=B.length,_=B.length;const ee=this.canModeBeOptimized[Lt]&&this.config.safeMode===!1;X&&ee?et=G:et=ft}bt.call(this,n);let ot;const ct=this.config.recoveryEnabled;for(;I<v;){c=null;const Lt=T.charCodeAt(I),ee=et(Lt),At=ee.length;for(r=0;r<At;r++){ot=ee[r];const kt=ot.pattern;u=null;const zt=ot.short;if(zt!==!1?Lt===zt&&(c=kt):ot.isCustom===!0?(E=kt.exec(T,I,N,Z),E!==null?(c=E[0],E.payload!==void 0&&(u=E.payload)):c=null):(this.updateLastIndex(kt,I),c=this.match(kt,t,I)),c!==null){if(a=ot.longerAlt,a!==void 0){const Gt=a.length;for(s=0;s<Gt;s++){const be=B[a[s]],Oe=be.pattern;if(l=null,be.isCustom===!0?(E=Oe.exec(T,I,N,Z),E!==null?(o=E[0],E.payload!==void 0&&(l=E.payload)):o=null):(this.updateLastIndex(Oe,I),o=this.match(Oe,t,I)),o&&o.length>c.length){c=o,u=l,ot=be;break}}}break}}if(c!==null){if(h=c.length,f=ot.group,f!==void 0&&(d=ot.tokenTypeIdx,p=this.createTokenInstance(c,I,d,ot.tokenType,L,V,h),this.handlePayload(p,u),f===!1?U=this.addToken(N,U,p):Z[f].push(p)),t=this.chopInput(t,h),I=I+h,V=this.computeNewColumn(V,h),C===!0&&ot.canLineTerminator===!0){let kt=0,zt,Gt;R.lastIndex=0;do zt=R.test(c),zt===!0&&(Gt=R.lastIndex-1,kt++);while(zt===!0);kt!==0&&(L=L+kt,V=h-Gt,this.updateTokenEndLineColumnLocation(p,f,Gt,kt,L,V,h))}this.handleModes(ot,W,bt,p)}else{const kt=I,zt=L,Gt=V;let be=ct===!1;for(;be===!1&&I<v;)for(t=this.chopInput(t,1),I++,i=0;i<_;i++){const Oe=B[i],b=Oe.pattern,st=Oe.short;if(st!==!1?T.charCodeAt(I)===st&&(be=!0):Oe.isCustom===!0?be=b.exec(T,I,N,Z)!==null:(this.updateLastIndex(b,I),be=b.exec(t)!==null),be===!0)break}if(m=I-kt,V=this.computeNewColumn(V,m),w=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(T,kt,m,zt,Gt),P.push({offset:kt,line:zt,column:Gt,length:m,message:w}),ct===!1)break}}return this.hasCustom||(N.length=U),{tokens:N,groups:Z,errors:P}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,u;n!==void 0&&(c=r===a-1,u=c?-1:0,i===1&&c===!0||(t.endLine=s+u,t.endColumn=o-1+-u))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};Ge.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",Ge.NA=/NOT_APPLICABLE/;function ha(e){return by(e)?e.LABEL:e.name}function by(e){return vn(e.LABEL)&&e.LABEL!==""}const GN="parent",Ey="categories",wy="label",xy="group",ky="push_mode",Ty="pop_mode",Ay="longer_alt",vy="line_breaks",Sy="start_chars_hint";function jn(e){return HN(e)}function HN(e){const t=e.pattern,n={};if(n.name=e.name,yi(t)||(n.PATTERN=t),Rt(e,GN))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Rt(e,Ey)&&(n.CATEGORIES=e[Ey]),la([n]),Rt(e,wy)&&(n.LABEL=e[wy]),Rt(e,xy)&&(n.GROUP=e[xy]),Rt(e,Ty)&&(n.POP_MODE=e[Ty]),Rt(e,ky)&&(n.PUSH_MODE=e[ky]),Rt(e,Ay)&&(n.LONGER_ALT=e[Ay]),Rt(e,vy)&&(n.LINE_BREAKS=e[vy]),Rt(e,Sy)&&(n.START_CHARS_HINT=e[Sy]),n}const ds=jn({name:"EOF",pattern:Ge.NA});la([ds]);function il(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function YN(e,t){return ca(e,t)}const Ry={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${by(e)?`--> ${ha(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+gr(t).image+"'";if(r)return s+r+a;{const c=Sn(e,(f,d)=>f.concat(d),[]),u=xt(c,f=>`[${xt(f,d=>ha(d)).join(", ")}]`),h=`one of these possible Token sequences:
${xt(u,(f,d)=>`  ${d+1}. ${f}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+gr(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${xt(e,u=>`[${xt(u,l=>ha(l)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Ry);const VN={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},ps={buildDuplicateFoundError(e,t){function n(l){return l instanceof Te?l.terminalType.name:l instanceof Rn?l.nonTerminalName:""}const r=e.name,i=gr(t),s=i.idx,o=Kr(i),a=n(i),c=s>0;let u=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return u=u.replace(/[ \t]+/g," "),u=u.replace(/\s\s+/g,`
`),u},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=xt(e.prefixPath,i=>ha(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=xt(e.prefixPath,i=>ha(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Kr(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=xt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof ro?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function XN(e,t){const n=new qN(e,t);return n.resolveRefs(),n.errors}class qN extends hs{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){It(Be(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:_n.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class JN extends Yc{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=nn(this.path.ruleStack).reverse(),this.occurrenceStack=nn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){ge(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class ZN extends JN{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new In({definition:i});this.possibleTokTypes=ia(s),this.found=!0}}}class sl extends Yc{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class QN extends sl{walkMany(t,n,r){if(t.idx===this.occurrence){const i=gr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Te&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class Iy extends sl{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=gr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Te&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class tO extends sl{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=gr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Te&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class Ny extends sl{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=gr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Te&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function Yh(e,t,n=[]){n=nn(n);let r=[],i=0;function s(a){return a.concat(rn(e,i+1))}function o(a){const c=Yh(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof In)return o(a.definition);if(a instanceof Rn)return o(a.definition);if(a instanceof Nn)r=o(a.definition);else if(a instanceof zr){const c=a.definition.concat([new Ke({definition:a.definition})]);return o(c)}else if(a instanceof Wr){const c=[new In({definition:a.definition}),new Ke({definition:[new Te({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof _r){const c=a.definition.concat([new Ke({definition:[new Te({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Ke){const c=a.definition.concat([new Ke({definition:a.definition})]);r=o(c)}else{if(a instanceof br)return It(a.definition,c=>{ge(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Te)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:rn(e,i)}),r}function Oy(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,u=c-r-1,l=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!ge(h);){const f=h.pop();if(f===o){a&&eo(h).idx<=u&&h.pop();continue}const d=f.def,p=f.idx,m=f.ruleStack,w=f.occurrenceStack;if(ge(d))continue;const E=d[0];if(E===i){const T={idx:p,def:rn(d),ruleStack:ra(m),occurrenceStack:ra(w)};h.push(T)}else if(E instanceof Te)if(p<c-1){const T=p+1,v=t[T];if(n(v,E.terminalType)){const I={idx:T,def:rn(d),ruleStack:m,occurrenceStack:w};h.push(I)}}else if(p===c-1)l.push({nextTokenType:E.terminalType,nextTokenOccurrence:E.idx,ruleStack:m,occurrenceStack:w}),a=!0;else throw Error("non exhaustive match");else if(E instanceof Rn){const T=nn(m);T.push(E.nonTerminalName);const v=nn(w);v.push(E.idx);const I={idx:p,def:E.definition.concat(s,rn(d)),ruleStack:T,occurrenceStack:v};h.push(I)}else if(E instanceof Nn){const T={idx:p,def:rn(d),ruleStack:m,occurrenceStack:w};h.push(T),h.push(o);const v={idx:p,def:E.definition.concat(rn(d)),ruleStack:m,occurrenceStack:w};h.push(v)}else if(E instanceof zr){const T=new Ke({definition:E.definition,idx:E.idx}),v=E.definition.concat([T],rn(d)),I={idx:p,def:v,ruleStack:m,occurrenceStack:w};h.push(I)}else if(E instanceof Wr){const T=new Te({terminalType:E.separator}),v=new Ke({definition:[T].concat(E.definition),idx:E.idx}),I=E.definition.concat([v],rn(d)),U={idx:p,def:I,ruleStack:m,occurrenceStack:w};h.push(U)}else if(E instanceof _r){const T={idx:p,def:rn(d),ruleStack:m,occurrenceStack:w};h.push(T),h.push(o);const v=new Te({terminalType:E.separator}),I=new Ke({definition:[v].concat(E.definition),idx:E.idx}),U=E.definition.concat([I],rn(d)),S={idx:p,def:U,ruleStack:m,occurrenceStack:w};h.push(S)}else if(E instanceof Ke){const T={idx:p,def:rn(d),ruleStack:m,occurrenceStack:w};h.push(T),h.push(o);const v=new Ke({definition:E.definition,idx:E.idx}),I=E.definition.concat([v],rn(d)),U={idx:p,def:I,ruleStack:m,occurrenceStack:w};h.push(U)}else if(E instanceof br)for(let T=E.definition.length-1;T>=0;T--){const v=E.definition[T],I={idx:p,def:v.definition.concat(rn(d)),ruleStack:m,occurrenceStack:w};h.push(I),h.push(o)}else if(E instanceof In)h.push({idx:p,def:E.definition.concat(rn(d)),ruleStack:m,occurrenceStack:w});else if(E instanceof ro)h.push(eO(E,p,m,w));else throw Error("non exhaustive match")}return l}function eO(e,t,n,r){const i=nn(n);i.push(e.name);const s=nn(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Ie;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Ie||(Ie={}));function Cy(e){if(e instanceof Nn||e==="Option")return Ie.OPTION;if(e instanceof Ke||e==="Repetition")return Ie.REPETITION;if(e instanceof zr||e==="RepetitionMandatory")return Ie.REPETITION_MANDATORY;if(e instanceof Wr||e==="RepetitionMandatoryWithSeparator")return Ie.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof _r||e==="RepetitionWithSeparator")return Ie.REPETITION_WITH_SEPARATOR;if(e instanceof br||e==="Alternation")return Ie.ALTERNATION;throw Error("non exhaustive match")}function nO(e,t,n,r,i,s){const o=Xh(e,t,n),a=Fy(o)?rl:ca;return s(o,r,a,i)}function rO(e,t,n,r,i,s){const o=qh(e,t,i,n),a=Fy(o)?rl:ca;return s(o[0],a,r)}function iO(e,t,n,r){const i=e.length,s=mr(e,o=>mr(o,a=>a.length===1));if(t)return function(o){const a=xt(o,c=>c.GATE);for(let c=0;c<i;c++){const u=e[c],l=u.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let f=0;f<l;f++){const d=u[f],p=d.length;for(let m=0;m<p;m++){const w=this.LA(m+1);if(n(w,d[m])===!1)continue t}return c}}};if(s&&!r){const o=xt(e,c=>$n(c)),a=Sn(o,(c,u,l)=>(It(u,h=>{Rt(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=l),It(h.categoryMatches,f=>{Rt(c,f)||(c[f]=l)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let u=0;u<c;u++){const l=a[u],h=l.length;for(let f=0;f<h;f++){const d=this.LA(f+1);if(n(d,l[f])===!1)continue t}return o}}}}function sO(e,t,n){const r=mr(e,s=>s.length===1),i=e.length;if(r&&!n){const s=$n(e);if(s.length===1&&ge(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Sn(s,(a,c,u)=>(a[c.tokenTypeIdx]=!0,It(c.categoryMatches,l=>{a[l]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const u=this.LA(c+1);if(t(u,o[c])===!1)continue t}return!0}return!1}}class oO extends Yc{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Ie.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Ie.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Ie.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Ie.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Ie.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class Ly extends hs{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Ie.OPTION)}visitRepetition(t){this.checkIsTarget(t,Ie.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Ie.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Ie.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Ie.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Ie.ALTERNATION)}}function My(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function Vh(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function aO(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function Uy(e,t){const n=xt(e,o=>Yh([o],1)),r=My(n.length),i=xt(n,o=>{const a={};return It(o,c=>{const u=Vh(c.partialPath);It(u,l=>{a[l]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=My(a.length);for(let c=0;c<a.length;c++){const u=a[c];for(let l=0;l<u.length;l++){const h=u[l].partialPath,f=u[l].suffixDef,d=Vh(h);if(aO(i,d,c)||ge(f)||h.length===t){const m=r[c];if(Jh(m,h)===!1){m.push(h);for(let w=0;w<d.length;w++){const E=d[w];i[c][E]=!0}}}else{const m=Yh(f,o+1,h);s[c]=s[c].concat(m),It(m,w=>{const E=Vh(w.partialPath);It(E,T=>{i[c][T]=!0})})}}}}return r}function Xh(e,t,n,r){const i=new Ly(e,Ie.ALTERNATION,r);return t.accept(i),Uy(i.result,n)}function qh(e,t,n,r){const i=new Ly(e,n);t.accept(i);const s=i.result,a=new oO(t,e,n).startWalking(),c=new In({definition:s}),u=new In({definition:a});return Uy([c,u],r)}function Jh(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function cO(e,t){return e.length<t.length&&mr(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function Fy(e){return mr(e,t=>mr(t,n=>mr(n,r=>ge(r.categoryMatches))))}function lO(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return xt(t,n=>Object.assign({type:_n.CUSTOM_LOOKAHEAD_VALIDATION},n))}function uO(e,t,n,r){const i=or(e,c=>hO(c,n)),s=kO(e,t,n),o=or(e,c=>bO(c,n)),a=or(e,c=>pO(c,e,r,n));return i.concat(s,o,a)}function hO(e,t){const n=new dO;e.accept(n);const r=n.allProductions,i=qg(r,fO),s=yr(i,a=>a.length>1);return xt(Be(s),a=>{const c=gr(a),u=t.buildDuplicateFoundError(e,a),l=Kr(c),h={message:u,type:_n.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:l,occurrence:c.idx},f=By(c);return f&&(h.parameter=f),h})}function fO(e){return`${Kr(e)}_#_${e.idx}_#_${By(e)}`}function By(e){return e instanceof Te?e.terminalType.name:e instanceof Rn?e.nonTerminalName:""}class dO extends hs{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function pO(e,t,n,r){const i=[];if(Sn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:_n.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function mO(e,t,n){const r=[];let i;return yn(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:_n.INVALID_RULE_OVERRIDE,ruleName:e})),r}function Py(e,t,n,r=[]){const i=[],s=ol(t.definition);if(ge(s))return[];{const o=e.name;yn(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:_n.LEFT_RECURSION,ruleName:o});const c=zc(s,r.concat([e])),u=or(c,l=>{const h=nn(r);return h.push(l),Py(e,l,n,h)});return i.concat(u)}}function ol(e){let t=[];if(ge(e))return t;const n=gr(e);if(n instanceof Rn)t.push(n.referencedRule);else if(n instanceof In||n instanceof Nn||n instanceof zr||n instanceof Wr||n instanceof _r||n instanceof Ke)t=t.concat(ol(n.definition));else if(n instanceof br)t=$n(xt(n.definition,s=>ol(s.definition)));else if(!(n instanceof Te))throw Error("non exhaustive match");const r=Hc(n),i=e.length>1;if(r&&i){const s=rn(e);return t.concat(ol(s))}else return t}class Zh extends hs{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function gO(e,t){const n=new Zh;e.accept(n);const r=n.alternations;return or(r,s=>{const o=ra(s.definition);return or(o,(a,c)=>{const u=Oy([a],[],ca,1);return ge(u)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:_n.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function yO(e,t,n){const r=new Zh;e.accept(r);let i=r.alternations;return i=Wc(i,o=>o.ignoreAmbiguities===!0),or(i,o=>{const a=o.idx,c=o.maxLookahead||t,u=Xh(a,e,c,o),l=wO(u,o,e,n),h=xO(u,o,e,n);return l.concat(h)})}class _O extends hs{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function bO(e,t){const n=new Zh;e.accept(n);const r=n.alternations;return or(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:_n.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function EO(e,t,n){const r=[];return It(e,i=>{const s=new _O;i.accept(s);const o=s.allProductions;It(o,a=>{const c=Cy(a),u=a.maxLookahead||t,l=a.idx,f=qh(l,i,c,u)[0];if(ge($n(f))){const d=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:d,type:_n.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function wO(e,t,n,r){const i=[],s=Sn(e,(a,c,u)=>(t.definition[u].ignoreAmbiguities===!0||It(c,l=>{const h=[u];It(e,(f,d)=>{u!==d&&Jh(f,l)&&t.definition[d].ignoreAmbiguities!==!0&&h.push(d)}),h.length>1&&!Jh(i,l)&&(i.push(l),a.push({alts:h,path:l}))}),a),[]);return xt(s,a=>{const c=xt(a.alts,l=>l+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:_n.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function xO(e,t,n,r){const i=Sn(e,(o,a,c)=>{const u=xt(a,l=>({idx:c,path:l}));return o.concat(u)},[]);return na(or(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,u=o.path,l=sr(i,f=>t.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<c&&cO(f.path,u));return xt(l,f=>{const d=[f.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:d,prefixPath:f.path}),type:_n.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:d}})}))}function kO(e,t,n){const r=[],i=xt(t,s=>s.name);return It(e,s=>{const o=s.name;if(yn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:_n.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function TO(e){const t=Ph(e,{errMsgProvider:VN}),n={};return It(e.rules,r=>{n[r.name]=r}),XN(n,t.errMsgProvider)}function AO(e){return e=Ph(e,{errMsgProvider:ps}),uO(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const Dy="MismatchedTokenException",$y="NoViableAltException",jy="EarlyExitException",zy="NotAllInputParsedException",Wy=[Dy,$y,jy,zy];Object.freeze(Wy);function al(e){return yn(Wy,e.name)}class cl extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Ky extends cl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Dy}}class vO extends cl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=$y}}class SO extends cl{constructor(t,n){super(t,n),this.name=zy}}class RO extends cl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=jy}}const Qh={},Gy="InRuleRecoveryException";class IO extends Error{constructor(t){super(t),this.name=Gy}}class NO{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Rt(t,"recoveryEnabled")?t.recoveryEnabled:_i.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=OO)}getTokenToInsert(t){const n=il(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const u=this.LA(1);let l=this.LA(1);const h=()=>{const f=this.LA(0),d=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:u,previous:f,ruleName:this.getCurrRuleFullName()}),p=new Ky(d,u,this.LA(0));p.resyncedTokens=ra(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(l,i)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(l,s)?c=!0:(l=this.SKIP_TOKEN(),this.addToResyncTokens(l,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new IO("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||ge(n))return!1;const r=this.LA(1);return no(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return yn(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=no(t,s=>YN(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Qh;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return xt(t,(r,i)=>i===0?Qh:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=xt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return $n(t)}getFollowSetFromFollowKey(t){if(t===Qh)return[ds];const n=t.ruleName+t.idxInCallingRule+ry+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,ds)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return ra(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=nn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return xt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function OO(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const f=this.getCurrRuleFullName(),d=this.getGAstProductions()[f];c=new s(d,i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,l=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&u===void 0&&(u=ds,l=1),!(u===void 0||l===void 0)&&this.shouldInRepetitionRecoveryBeTried(u,l,o)&&this.tryInRepetitionRecovery(e,t,n,u)}const CO=4,ji=8,Hy=1<<ji,Yy=2<<ji,tf=3<<ji,ef=4<<ji,nf=5<<ji,ll=6<<ji;function rf(e,t,n){return n|t|e}class LO{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:_i.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(ge(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return or(t,n=>Py(n,n,ps))}validateEmptyOrAlternatives(t){return or(t,n=>gO(n,ps))}validateAmbiguousAlternationAlternatives(t,n){return or(t,r=>yO(r,n,ps))}validateSomeNonEmptyLookaheadPath(t,n){return EO(t,n,ps)}buildLookaheadForAlternation(t){return nO(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,iO)}buildLookaheadForOptional(t){return rO(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Cy(t.prodType),sO)}}class MO{initLooksAhead(t){this.dynamicTokensEnabled=Rt(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:_i.dynamicTokensEnabled,this.maxLookahead=Rt(t,"maxLookahead")?t.maxLookahead:_i.maxLookahead,this.lookaheadStrategy=Rt(t,"lookaheadStrategy")?t.lookaheadStrategy:new LO({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){It(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=FO(n);It(r,u=>{const l=u.idx===0?"":u.idx;this.TRACE_INIT(`${Kr(u)}${l}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:u.idx,rule:n,maxLookahead:u.maxLookahead||this.maxLookahead,hasPredicates:u.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=rf(this.fullRuleNameToShort[n.name],Hy,u.idx);this.setLaFuncCache(f,h)})}),It(i,u=>{this.computeLookaheadFunc(n,u.idx,tf,"Repetition",u.maxLookahead,Kr(u))}),It(s,u=>{this.computeLookaheadFunc(n,u.idx,Yy,"Option",u.maxLookahead,Kr(u))}),It(o,u=>{this.computeLookaheadFunc(n,u.idx,ef,"RepetitionMandatory",u.maxLookahead,Kr(u))}),It(a,u=>{this.computeLookaheadFunc(n,u.idx,ll,"RepetitionMandatoryWithSeparator",u.maxLookahead,Kr(u))}),It(c,u=>{this.computeLookaheadFunc(n,u.idx,nf,"RepetitionWithSeparator",u.maxLookahead,Kr(u))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=rf(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return rf(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class UO extends hs{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const ul=new UO;function FO(e){ul.reset(),e.accept(ul);const t=ul.dslMethods;return ul.reset(),t}function Vy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function Xy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function BO(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function PO(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const DO="name";function qy(e,t){Object.defineProperty(e,DO,{enumerable:!1,configurable:!0,writable:!1,value:t})}function $O(e,t){const n=rr(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const u=o[c];u.tokenTypeIdx===void 0&&this[u.name](u.children,t)}}}function jO(e,t){const n=function(){};qy(n,e+"BaseSemantics");const r={visit:function(i,s){if(te(i)&&(i=i[0]),!yi(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=WO(this,t);if(!ge(i)){const s=xt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function zO(e,t,n){const r=function(){};qy(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return It(t,s=>{i[s]=$O}),r.prototype=i,r.prototype.constructor=r,r}var sf;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(sf||(sf={}));function WO(e,t){return KO(e,t)}function KO(e,t){const n=sr(t,i=>di(e[i])===!1),r=xt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:sf.MISSING_METHOD,methodName:i}));return na(r)}class GO{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Rt(t,"nodeLocationTracking")?t.nodeLocationTracking:_i.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=We,this.cstFinallyStateUpdate=We,this.cstPostTerminal=We,this.cstPostNonTerminal=We,this.cstPostRule=We;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Xy,this.setNodeLocationFromNode=Xy,this.cstPostRule=We,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=We,this.setNodeLocationFromNode=We,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Vy,this.setNodeLocationFromNode=Vy,this.cstPostRule=We,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=We,this.setNodeLocationFromNode=We,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=We,this.setNodeLocationFromNode=We,this.cstPostRule=We,this.setInitialNodeLocation=We;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];BO(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];PO(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(yi(this.baseCstVisitorConstructor)){const t=jO(this.className,rr(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(yi(this.baseCstVisitorWithDefaultsConstructor)){const t=zO(this.className,rr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class HO{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):dl}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?dl:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class YO{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=pl){if(yn(this.definedRulesNames,t)){const o={message:ps.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:_n.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=pl){const i=mO(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(al(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return XI(Be(this.gastProductionsCache))}}class VO{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=rl,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Rt(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(te(t)){if(ge(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(te(t))this.tokensMap=Sn(t,(s,o)=>(s[o.name]=o,s),{});else if(Rt(t,"modes")&&mr($n(Be(t.modes)),WN)){const s=$n(Be(t.modes)),o=Kc(s);this.tokensMap=Sn(o,(a,c)=>(a[c.name]=c,a),{})}else if(nr(t))this.tokensMap=nn(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=ds;const r=Rt(t,"modes")?$n(Be(t.modes)):Be(t),i=mr(r,s=>ge(s.categoryMatches));this.tokenMatcher=i?rl:ca,la(Be(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Rt(r,"resyncEnabled")?r.resyncEnabled:pl.resyncEnabled,s=Rt(r,"recoveryValueFunc")?r.recoveryValueFunc:pl.recoveryValueFunc,o=this.ruleShortNameIdx<<CO+ji;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...l){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...l){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(al(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(Yy,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(ef,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Ie.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,ef,t,tO)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(ll,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Ny],a,ll,t,Ny)}else throw this.raiseEarlyExitException(t,Ie.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(tf,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,tf,t,QN,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(nf,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Iy],a,nf,t,Iy)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,ll,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(Hy,n),i=te(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new SO(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw al(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Ky(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===Gy?r:s}}else throw r}saveRecogState(){const t=this.errors,n=nn(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),ds)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class XO{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Rt(t,"errorMessageProvider")?t.errorMessageProvider:_i.errorMessageProvider}SAVE_ERROR(t){if(al(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:nn(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return nn(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=qh(t,s,n,this.maxLookahead)[0],c=[];for(let l=1;l<=this.maxLookahead;l++)c.push(this.LA(l));const u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new RO(u,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=Xh(t,i,this.maxLookahead),o=[];for(let u=1;u<=this.maxLookahead;u++)o.push(this.LA(u));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new vO(c,this.LA(1),a))}}class qO{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(yi(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return Oy([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=gr(t.ruleStack),i=this.getGAstProductions()[n];return new ZN(i,t).startWalking()}}const hl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(hl);const Jy=!0,Zy=Math.pow(2,ji)-1,Qy=jn({name:"RECORDING_PHASE_TOKEN",pattern:Ge.NA});la([Qy]);const t_=il(Qy,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(t_);const JO={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class ZO{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return dl}topLevelRuleRecord(t,n){try{const r=new ro({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return fa.call(this,Nn,t,n)}atLeastOneInternalRecord(t,n){fa.call(this,zr,n,t)}atLeastOneSepFirstInternalRecord(t,n){fa.call(this,Wr,n,t,Jy)}manyInternalRecord(t,n){fa.call(this,Ke,n,t)}manySepFirstInternalRecord(t,n){fa.call(this,_r,n,t,Jy)}orInternalRecord(t,n){return QO.call(this,t,n)}subruleInternalRecord(t,n,r){if(fl(n),!t||Rt(t,"ruleName")===!1){const a=new Error(`<SUBRULE${e_(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=eo(this.recordingProdStack),s=t.ruleName,o=new Rn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?JO:hl}consumeInternalRecord(t,n,r){if(fl(n),!yy(t)){const o=new Error(`<CONSUME${e_(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=eo(this.recordingProdStack),s=new Te({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),t_}}function fa(e,t,n,r=!1){fl(n);const i=eo(this.recordingProdStack),s=di(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),Rt(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),hl}function QO(e,t){fl(t);const n=eo(this.recordingProdStack),r=te(e)===!1,i=r===!1?e:e.DEF,s=new br({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});Rt(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=Dh(i,a=>di(a.GATE));return s.hasPredicates=o,n.definition.push(s),It(i,a=>{const c=new In({definition:[]});s.definition.push(c),Rt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Rt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),hl}function e_(e){return e===0?"":`${e}`}function fl(e){if(e<0||e>Zy){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${Zy+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class tC{initPerformanceTracer(t){if(Rt(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=_i.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=ty(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function eC(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const dl=il(ds,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(dl);const _i=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Ry,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),pl=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var _n;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(_n||(_n={}));let of=class ab{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{ey(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),It(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=TO({rules:Be(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(ge(r)&&this.skipValidations===!1){const i=AO({rules:Be(this.gastProductionsCache),tokenTypes:Be(this.tokensMap),errMsgProvider:ps,grammarName:n}),s=lO({lookaheadStrategy:this.lookaheadStrategy,rules:Be(this.gastProductionsCache),tokenTypes:Be(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),ge(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=nN(Be(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Be(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Be(this.gastProductionsCache))})),!ab.DEFER_DEFINITION_ERRORS_HANDLING&&!ge(this.definitionErrors))throw t=xt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Rt(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Rt(n,"skipValidations")?n.skipValidations:_i.skipValidations}};of.DEFER_DEFINITION_ERRORS_HANDLING=!1,eC(of,[NO,MO,GO,HO,VO,YO,XO,qO,ZO,tC]);class nC extends of{constructor(t,n=_i){const r=nn(n);r.outputCst=!0,super(t,r)}}function rC(e){const t=new iC,n=Be(e);return xt(n,r=>t.visitRule(r))}class iC extends hs{visitRule(t){const n=this.visitEach(t.definition),r=qg(n,s=>s.propertyName),i=xt(r,(s,o)=>{const a=!Dh(s,u=>!u.canBeNull);let c=s[0].type;return s.length>1&&(c=xt(s,u=>u.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:ml(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:ml(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:ml(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:ml(t)}]}visitEachAndOverrideWith(t,n){return xt(this.visitEach(t),r=>An({},r,n))}visitEach(t){return $n(xt(t,n=>this.visit(n)))}}function ml(e){return e instanceof Rn?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function sC(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat($n(xt(e,r=>oC(r)))),t.includeVisitorInterface&&(n=n.concat(uC(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function oC(e){const t=aC(e),n=cC(e);return[t,n]}function aC(e){const t=r_(e.name),n=af(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function cC(e){return`export type ${af(e.name)} = {
  ${xt(e.properties,n=>lC(n)).join(`
  `)}
};`}function lC(e){const t=fC(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function uC(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${xt(t,n=>hC(n)).join(`
  `)}
}`}function hC(e){const t=af(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function fC(e){if(te(e)){const t=Kc(xt(e,r=>n_(r)));return"("+Sn(t,(r,i)=>r+" | "+i)+")"}else return n_(e)}function n_(e){return e.kind==="token"?"IToken":r_(e.name)}function r_(e){return _g(e)+"CstNode"}function af(e){return _g(e)+"CstChildren"}const dC={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function pC(e,t){const n=Object.assign(Object.assign({},dC),t),r=rC(e);return sC(r,n)}const gl=j0(32,126).map(e=>String.fromCharCode(e));function Kt(e){return jn({...e,name:`token_${e.name}`})}function Gr(e,t=!1){return Kt(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:sn,group:Ge.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:sn})}const da=Kt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),mC=Kt({name:"whitespace",pattern:/ +/,group:Ge.SKIPPED}),gC=Kt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Ge.SKIPPED}),cf=Kt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),so=Kt({name:"command",pattern:/#/,start_chars_hint:["#"]});let i_=!1;function yC(e,t,n){if(!i_)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==da)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const lf=Kt({name:"text",pattern:yC,line_breaks:!1,start_chars_hint:gl.filter(e=>"@#/?':!".includes(e)===!1)}),s_=Kt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),o_=Kt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),a_=Kt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),c_=Kt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),sn=Kt({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:gl}),l_=Kt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),u_=Kt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),h_=Kt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:sn}),f_=Kt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:sn}),d_=Kt({name:"islessthan",pattern:/<|below/,longer_alt:sn}),p_=Kt({name:"isgreaterthan",pattern:/>|above/,longer_alt:sn}),m_=Kt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:sn}),g_=Kt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:sn}),uf=Kt({name:"or",pattern:/or/i,longer_alt:sn}),hf=Kt({name:"not",pattern:/not/i,longer_alt:sn}),ff=Kt({name:"and",pattern:/and/i,longer_alt:sn}),df=Kt({name:"plus",pattern:/\+/}),pf=Kt({name:"minus",pattern:/-/}),y_=Kt({name:"power",pattern:/\*\*/}),__=Kt({name:"multiply",pattern:/\*/}),mf=Kt({name:"divide",pattern:/\//}),b_=Kt({name:"moddivide",pattern:/%/}),E_=Kt({name:"floordivide",pattern:/%%/}),w_=Kt({name:"query",pattern:/\?/}),x_=Kt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),k_=Kt({name:"rparen",pattern:/\)/,pop_mode:!0}),T_=Kt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:gl,longer_alt:sn}),A_=Kt({name:"command_toast",pattern:/toast .*/,start_chars_hint:gl,longer_alt:sn}),gf=Kt({name:"if",pattern:/if|try|take|give/,longer_alt:sn}),yl=Gr("do"),_C=Gr("to",!0),yf=Gr("done"),bC=Gr("then",!0),_f=Gr("else"),v_=Gr("while"),S_=Gr("repeat"),R_=Gr("waitfor"),I_=Kt({name:"foreach",pattern:/foreach|for/,longer_alt:sn}),N_=Gr("break"),O_=Gr("continue");function C_(e){return[...e,u_,h_,f_,m_,d_,g_,p_,uf,hf,ff,df,pf,y_,__,mf,E_,b_,w_,x_,k_,l_,sn]}const L_=C_([lf,cf,T_,A_,so,s_,o_,a_,c_,da,mC,N_,O_,yf,yl,_f,I_,gf,S_,bC,_C,R_,v_]),EC=new Ge({defaultMode:"use_newlines",modes:{use_newlines:L_,ignore_newlines:C_([gC])}},{skipValidations:!Mr,ensureOptimizations:Mr});function bf(e){i_=!0;const t=EC.tokenize(e||` 
`),[n]=(ne(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(il(da,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function wC(e,t,n=!0){if(n){const[r,...i]=t;switch(Mt(r??"")){default:return{type:wt.OBJECT,values:t};case"loader":return{type:wt.LOADER,values:i};case"board":return{type:wt.BOARD,values:i};case"object":return{type:wt.OBJECT,values:i};case"terrain":return{type:wt.TERRAIN,values:i};case"charset":return{type:wt.CHARSET,values:i};case"palette":return{type:wt.PALETTE,values:i}}}else{const[r,i,...s]=t,o=Mt(i??""),a=[r,e,...s];switch(o){default:return{type:wt.CONST,values:t};case"rn":case"range":return{type:wt.RANGE,values:a};case"sl":case"select":return{type:wt.SELECT,values:a};case"nm":case"number":return{type:wt.NUMBER,values:a};case"tx":case"text":return{type:wt.TEXT,values:a};case"ln":case"link":return{type:wt.LINK,values:a};case"hk":case"hotkey":return{type:wt.HOTKEY,values:a};case"copyit":return{type:wt.COPYIT,values:a};case"openit":return{type:wt.OPENIT,values:a};case"zssedit":return{type:wt.ZSSEDIT,values:a};case"charedit":return{type:wt.CHAREDIT,values:a};case"coloredit":return{type:wt.COLOREDIT,values:a}}}}function zn(e){switch(e){case wt.LOADER:return"loader";case wt.BOARD:return"board";case wt.OBJECT:return"object";case wt.TERRAIN:return"terrain";case wt.CHARSET:return"charset";case wt.PALETTE:return"palette";case wt.CONST:return"const";case wt.RANGE:return"range";case wt.SELECT:return"select";case wt.NUMBER:return"number";case wt.TEXT:return"text";case wt.LINK:return"link";case wt.HOTKEY:return"hotkey";case wt.COPYIT:return"copyit";case wt.OPENIT:return"openit";case wt.ZSSEDIT:return"zssedit";case wt.CHAREDIT:return"charedit";case wt.COLOREDIT:return"coloredit"}}var Ef=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(Ef||{});function M_(e){return Js(e,Ef,{bits:t=>Array.from(t)})}function U_(e){return Ho(e,Ef,{bits:t=>new Uint8Array(t)})}function xC(e,t){return{id:Ce(),code:e,...t}}var wf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(wf||{});function kC(e){return Js(e,wf,{board:qL,object:Ac,terrain:Ac,charset:M_,palette:M_,stats:Ue})}function TC(e){return Ho(e,wf,{board:JL,object:vc,terrain:vc,charset:U_,palette:U_})}function pa(e){const t={...ms(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function AC(e){return x(e)?(e.stats=void 0,ms(e)):{}}function F_(e){const t=bf(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===cf){const o=s.image.slice(1),[a,c]=o.split(";").map(f=>f.trim()),u=a.split(" "),l=wC(St(c)?c:"",u,r),h=Mt(l.values.join(" "));switch(r=!1,l.type){case wt.LOADER:n.type=Et.LOADER,n.name=h;break;case wt.BOARD:n.type=Et.BOARD,n.name=h;break;case wt.OBJECT:n.type=Et.OBJECT,n.name=h||"object";break;case wt.TERRAIN:n.type=Et.TERRAIN,n.name=h;break;case wt.CHARSET:n.type=Et.CHARSET,n.name=h;break;case wt.PALETTE:n.type=Et.PALETTE,n.name=h;break;case wt.CONST:{const[f,d]=l.values;if(St(f)){const p=Mt(f);if(St(d)){const m=parseFloat(d);n[p]=Ct(m)?m:d}else Ct(d)?n[p]=d:n[p]=1}break}case wt.RANGE:case wt.SELECT:case wt.NUMBER:case wt.TEXT:case wt.LINK:case wt.HOTKEY:case wt.ZSSEDIT:case wt.CHAREDIT:case wt.COLOREDIT:{const[f,...d]=l.values;if(St(f)){const p=Mt(f);n[p]=[zn(l.type),...d]}break}}}}return n}function ms(e){var t;return x(e)?(x((t=e.stats)==null?void 0:t.type)||(e.stats=F_(e.code),x(e.stats.type)||(e.stats.type=Et.OBJECT)),e.stats):{}}function B_(e){switch(e){default:case Et.ERROR:return"error";case Et.LOADER:return zn(wt.LOADER);case Et.BOARD:return zn(wt.BOARD);case Et.OBJECT:return zn(wt.OBJECT);case Et.TERRAIN:return zn(wt.TERRAIN);case Et.CHARSET:return zn(wt.CHARSET);case Et.PALETTE:return zn(wt.PALETTE)}}function zi(e){return ms(e).type??Et.ERROR}function Wi(e){return B_(zi(e))}function Ne(e){return ms(e).name??""}function P_(e,t){return ms(e)[t]}const _l=new Zu;function xf(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!ne(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"ispushable":t.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Ht.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Ht.ISSWIM;break;case"issolid":t.collision=Ht.ISSOLID;break;case"isbullet":t.collision=Ht.ISBULLET;break;case"isdestructible":t.destructible=1;break}}}function un(e){var t;if(x(e))switch(zi(e)){default:return;case Et.ERROR:return e.code??"";case Et.LOADER:return e.code??"";case Et.BOARD:{x(e.board)||(e.board=XL()),e.board.id=e.id;const n=pa(e);return e.board.isdark=n.isdark??e.board.isdark?1:0,e.board.startx=n.startx??e.board.startx,e.board.starty=n.starty??e.board.starty,e.board.over=n.over??e.board.over,e.board.under=n.under??e.board.under,e.board.exitnorth=n.exitnorth??e.board.exitnorth,e.board.exitsouth=n.exitsouth??e.board.exitsouth,e.board.exitwest=n.exitwest??e.board.exitwest,e.board.exiteast=n.exiteast??e.board.exiteast,e.board.timelimit=n.timelimit??e.board.timelimit,e.board.restartonzap=n.restartonzap??e.board.restartonzap,e.board.maxplayershots=n.maxplayershots??e.board.maxplayershots,e.board}case Et.OBJECT:return x(e.object)||(e.object=Cm()),e.object.name=Ne(e),e.object.category=Hn.ISOBJECT,xf(pa(e),e.object),e.object;case Et.TERRAIN:return x(e.terrain)||(e.terrain=Cm()),e.terrain.name=Ne(e),e.terrain.category=Hn.ISTERRAIN,xf(pa(e),e.terrain),e.terrain;case Et.PALETTE:{if(x(e.palette)||(e.palette=Mm(GT)),x((t=e.palette)==null?void 0:t.bits)){const n=pa(e),r=Gn(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&St(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){_l.set(o);const c=a*hc,u=_l.r*63,l=_l.g*63,h=_l.b*63;e.palette.bits[c+0]=Pn(u,0,63),e.palette.bits[c+1]=Pn(l,0,63),e.palette.bits[c+2]=Pn(h,0,63)}}}}return e.palette}case Et.CHARSET:return x(e.charset)||(e.charset=Um(KT)),e.charset}}function D_(e){return{id:Ce(),name:kb(),timestamp:0,activelist:[],pages:e,flags:{}}}var kf=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e))(kf||{});function vC(e){return Js(e,kf,{pages:t=>t.map(kC),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function SC(e){return Ho(e,kf,{pages:t=>t.map(TC)})}function bi(e,t){if(!x(e))return;const n=Mt(t);return e.pages.find(i=>i.id===t||n===Ne(i))}function On(e,t,n){if(!x(e))return;const r=Mt(n);return e.pages.find(s=>zi(s)===t&&(s.id===n||r===Ne(s)))}function Tf(e,t,n){let r=On(e,t,n);if(!x(r)){const i=B_(t);r=xC(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),j_(e,r)}return r}function gs(e,t){return x(e)?e.pages.filter(n=>zi(n)===t):[]}function Hr(e,t,n){if(!x(e))return[];const r=Mt(n);return e.pages.filter(s=>zi(s)===t).filter(s=>{const o=ms(s),a=Mt(Ne(s));return r===a||x(o[n])})}function Af(e){return x(e)?Xe(e.pages).sort((n,r)=>{const i=zi(n),s=zi(r);return i===s?Ne(n).localeCompare(Ne(r)):s-i}):[]}function $_(e,t){if(x(t)){const n=On(e,Et.TERRAIN,t.kind??"");if(x(n))return n;const r=On(e,Et.OBJECT,t.kind??"");if(x(r))return r}}function j_(e,t){if(!x(e)||!x(t))return!1;const n=bi(e,t.id);return x(n)?!1:(e.pages.push(t),!0)}function z_(e,t){const n=bi(e,t);if(x(e)&&x(n)){const r=Mt(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Ne(i)),n}}function Ei(e,t){if(x(t)&&x(t.kind))return x(t.kinddata)||(t.kinddata=x(t.id)?ma(e,t.kind):vf(e,t.kind)),t.kinddata}function W_(e,t,n){const r=Ei(e,t);return(t==null?void 0:t[n])??(r==null?void 0:r[n])}function K_(e,t,n,r,i){const s=Ei(e,t);return{char:(t==null?void 0:t.char)??(s==null?void 0:s.char)??n,color:(t==null?void 0:t.color)??(s==null?void 0:s.color)??r,bg:(t==null?void 0:t.bg)??(s==null?void 0:s.bg)??i,light:(t==null?void 0:t.light)??(s==null?void 0:s.light)??0}}function ma(e,t){const n=t??"",r=On(e,Et.OBJECT,n);if(x(r)){const i=un(r);return{...Xe(i),name:n,code:r.code}}}function vf(e,t){const n=t??"",r=On(e,Et.TERRAIN,n);if(x(r)){const i=un(r);return{...Xe(i),name:n,code:r.code}}}function oo(e,t){const n=bi(e,t);return un(n)}function wi(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function G_(e,t){e&&delete e.flags[t]}function H_(e,t,n){const r=wi(e,t);return r==null?void 0:r[n]}function RC(e,t,n,r){const i=wi(e,t);return i&&(i[n]=r),r}function ys(e,t){const n=H_(e,t,"board");return oo(e,St(n)?n:"")}function IC(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function bl(e,t,n){if(!x(e))return;RC(e,t,"board",n);const r=oo(e,n);x(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function ga(e,t,n,r){if(!x(e))return;const i=ys(e,t);if(!x(i))return;const s=Mn(i,t);if(!Yo(s)||!(s!=null&&s.id))return;const o=oo(e,n);if(!x(o)||(Er(e,o),Rf(e,o,Ht.ISWALK,r)))return;delete i.objects[s.id];const a=Zr(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Zr(o,s);o.lookup&&(o.lookup[c]=s.id),bl(e,t,o.id)}function NC(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=H_(e,r,"board");return St(i)?i:""});return zk(n)}function Sf(e){return NC(e).map(n=>oo(e,n)).filter(x)}function Rf(e,t,n,r){if(!x(e)||!x(t)||!x(t.lookup)||r.x<0||r.x>=Vt||r.y<0||r.y>=Se)return!0;const i=r.x+r.y*Vt,s=Mn(t,t.lookup[i]??"404");if(x(s))return!0;const o=t.terrain[i];if(x(o)){const a=Ei(e,o),c=o.collision??(a==null?void 0:a.collision);return rh(n,c)}return!1}function OC(e,t,n,r){const i=Mn(t,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=W_(e,i,"collision");return Rf(e,t,a,r)}function Y_(e,t,n,r){var l,h;const i=Mn(t,(n==null?void 0:n.id)??"");if(!x(e)||!x(t)||!x(i)||!x(i.x)||!x(i.y)||!x(t.lookup)||r.x<0||r.x>=Vt||r.y<0||r.y>=Se)return{name:"edge",kind:"edge",collision:Ht.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Zr(t,i),o=Zr(t,r),a=i.collision??((l=i==null?void 0:i.kinddata)==null?void 0:l.collision)??Ht.ISWALK,c=Mn(t,t.lookup[o]??"");if(x(c))return{...c};const u=t.terrain[o];if(x(u)){const f=u.collision??((h=u==null?void 0:u.kinddata)==null?void 0:h.collision)??Ht.ISWALK;if(rh(a,f))return{...u,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,x(i.removed)||(t.lookup[s]=void 0,t.lookup[o]=i.id??"")}function If(e,t,n,r){var s;if(!x(e)||!x(t)||!x(t.named)||!x(n))return;const i=Mt(n.name??((s=n.kinddata)==null?void 0:s.name)??"");t.named[i]||(t.named[i]=new Set),t.named[i].add((n==null?void 0:n.id)??r??"")}function CC(e,t,n){if(!(!x(e)||!x(t)||!x(t.lookup)||!x(n==null?void 0:n.id))&&!x(n.removed)){const r=n.x??0,i=n.y??0;t.lookup[r+i*Vt]=n.id}}function Er(e,t){var a;if(!x(e)||!x(t)||x(t.lookup)&&x(t.named))return;const n=new Array(Vt*Se).fill(void 0),r={},i=Object.values(t.objects);for(let c=0;c<i.length;++c){const u=i[c];if(x(u.x)&&x(u.y)&&x(u.id)&&!x(u.removed)){u.category=Hn.ISOBJECT,n[u.x+u.y*Vt]=u.id;const l=Mt(u.name??((a=u.kinddata)==null?void 0:a.name)??"");r[l]||(r[l]=new Set),r[l].add(u.id)}}let s=0,o=0;for(let c=0;c<t.terrain.length;++c){const u=t.terrain[c];if(x(u)){u.x=s,u.y=o,u.category=Hn.ISTERRAIN;const l=Fr(u);r[l]||(r[l]=new Set),r[l].add(c)}++s,s>=Vt&&(s=0,++o)}t.lookup=n,t.named=r}function Yr(e,t,n,r){return!x(n)||Fr(n)==="player"?!1:(n.id?(n.removed=r,Nf(e,t,n)):(kr(t,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),LC(e,t,n)),!0)}function LC(e,t,n){var r;if(x(e)&&x(t)&&x(n==null?void 0:n.x)&&x(n.y)){const i=Fr(n),s=Zr(t,n);x((r=t.named)==null?void 0:r[i])&&t.named[i].delete(s)}}function Nf(e,t,n){var r;if(x(e)&&x(t)&&x(n==null?void 0:n.id)){if(x(t.lookup)&&x(n.x)&&x(n.y)){const s=n.x+n.y*Vt;t.lookup[s]===n.id&&(t.lookup[s]=void 0)}const i=Fr(n);x((r=t.named)==null?void 0:r[i])&&x(n.id)&&t.named[i].delete(n.id)}}function MC(e,t,n){const r=[];if(!x(e)||!x(t))return r;const i=Object.values(t.objects);for(let s=0;s<i.length;++s){const o=i[s];x(o.id)&&x(o.removed)&&n-o.removed>Ca*5&&(r.push(o.id),V1(t,o.id))}return r}function UC(e,t,n){const r=[];if(!x(e)||!x(t))return r;t.lookup=void 0,Er(e,t);const i=Object.values(t.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!x(a.id))continue;a.lx=a.x,a.ly=a.y;const c=Ei(e,a),u=a.code??(c==null?void 0:c.code)??"";u&&r.push({id:a.id,type:Et.OBJECT,code:u,object:a,terrain:void 0})}const s=MC(e,t,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:Et.ERROR,code:"",object:void 0,terrain:void 0});return r}function FC(e,t,n,r){if(x(e)&&x(t)&&x(n)){const[i,s]=n,o=ma(e,i);if(x(o)&&x(o.name)){const a=cd(t,r,i);return Sc(a,s),a}}}function ya(e,t,n,r,i){if(x(e)&&x(t)&&x(n)){const[s,o]=n,a=vf(e,s);if(x(a)){const u=QL(t,r,s);if(x(u)){Sc(u,o);const l=lc(r,Vt);return If(e,t,u,l),u}}const c=ma(e,s);if(x(c)&&x(c.name)){const u=cd(t,r,s,i);if(x(u))return Sc(u,o),CC(e,t,u),If(e,t,u),u}}}const Ki="$dkpurple",BC="$196",PC="$205";function bn(e,t){return`$${e}${t}$blue`}function V_(e,t){return`$${e}${t}$ondkblue`}function Pt(e,t){ei(e,t)}function DC(e,t){const n=BC.repeat(t);Pt(e,`${Ki}${n}`)}function Of(e,t){const n=PC.repeat(t);Pt(e,`${Ki}${n}`)}function Gi(e,t){Pt(e,`${Ki} ${" ".repeat(t.length)} `),DC(e,t.length+2),Pt(e,`${Ki} $white${t} `),Of(e,t.length+2)}function Vr(e,t){Pt(e,`${Ki} ${" ".repeat(t.length)} `),Pt(e,`${Ki} $gray${t} `),Of(e,t.length+2)}function re(e,t,n){Pt(e,`${Ki} $white${t} $blue${n}`)}function se(e,t){Pt(e,`${Ki}$blue${t}`)}function X_(e){return`zss_snapshot_${e}`}function q_(e){const t=Gn(e);for(let n=0;n<t.length;++n){const r=e[t[n]];Fr(r)==="player"&&delete e[t[n]]}return e}function $C(e){const t=Gn(e);for(let n=0;n<t.length;++n){const r=e[t[n]];Fr(r)!=="player"&&delete e[t[n]]}return e}function jC(e){const t=On(k.book,Et.BOARD,e),n=un(t);if(!x(n))return;const r=X_(n.id);z_(k.book,r);const i=Vi(Ft.CONTENT,r,Et.BOARD),s=un(i);x(s)&&(s.terrain=Xe(n.terrain),s.objects=q_(Xe(n.objects)),Pt(j,`snapshot of ${Ne(t)} created as ${Ne(i)}`))}function zC(e){const t=On(k.book,Et.BOARD,e),n=un(t);if(!x(n))return;const r=X_(n.id),i=On(k.book,Et.BOARD,r),s=un(i);x(s)&&(n.terrain=Xe(s.terrain),n.objects={...q_(Xe(s.objects)),...$C(Xe(n.objects))})}const Cf=5;function Lf(e,t,n=2,r=1,i={x:0,y:0},s={x:Vt-1,y:Se-1}){const o=On(k.book,Et.BOARD,e),a=On(k.book,Et.BOARD,t),c=un(o),u=un(a);if(!x(c)||!x(u))return;Er(k.book,c),Er(k.book,u);let l=0;const h=new Map,f=new Map;let d=0;const p=32,m=new Uint8Array(ET*4);for(let L=0;L<Se;++L)for(let V=0;V<Vt;++V){const Z=Kn(u,{x:V,y:L}),C=(Z==null?void 0:Z.char)??0,R=(Z==null?void 0:Z.color)??p,_=(Z==null?void 0:Z.bg)??p;m[d++]=C,m[d++]=R,m[d++]=_;const B=Ei(k.book,Z),X=Mt((B==null?void 0:B.name)??"empty"),D=h.get(X);Ct(D)?m[d++]=D:(h.set(X,l),f.set(l,X),m[d++]=l++)}const w=Math.min(i.x,s.x),E=Math.min(i.y,s.y),T=Math.max(i.x,s.x),v=Math.max(i.y,s.y),I=T-w+1,U=v-E+1;Pt(j,`remixing ${w},${E} - ${T},${v} on ${e} with ${t} <${n},${r}>`);const S=new dT.OverlappingModel(m,Vt,Se,n,I,U,!1,!1,r,0);let N=0;for(;N<Cf&&!S.generate();++N);if(N===Cf){le(j,"boardremix",`failed to generate after ${Cf} tries`);return}d=0;const P=S.graphics();for(let L=E;L<=v;++L)for(let V=w;V<=T;++V){const Z=P[d++],C=P[d++],R=P[d++];l=P[d++];const _=Kn(c,{x:V,y:L});Yr(k.book,c,_,k.timestamp),kr(c,{x:V,y:L});const B=f.get(l)??"",X=ya(k.book,c,[B],{x:V,y:L});if(x(X)&&(Z>0&&(X.char=Z),C<p&&(X.color=C),R<p&&(X.bg=R),Yo(X))){const D=ln(Xs(u,B));x(D)&&(kr(c,{...od(u,D.x??0,D.y??0),x:V,y:L}),X.p1=D.p1,X.p2=D.p2,X.p3=D.p3,X.code=D.code,X.cycle=D.cycle,X.light=D.light,X.stepx=D.stepx,X.stepy=D.stepy,X.pushable=D.pushable,X.collision=D.collision,X.destructible=D.destructible)}}}const WC=j0(32,126).map(e=>String.fromCharCode(e)),KC=jn({name:"Whitespace",pattern:/ +/}),GC=jn({name:"WhitespaceSkipped",pattern:/ +/,group:Ge.SKIPPED}),Mf=jn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),J_=jn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:WC}),Uf=jn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Ff=jn({name:"EscapedDollar",pattern:"$$"}),Bf=jn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Pf=jn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),Z_=jn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function HC(e,t=""){return jn({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const Q_=Object.keys(zo).map(e=>HC(`\\$(${e})`,e)),YC=[KC,Mf,...Q_,Uf,J_,Pf,Ff,Z_,Bf],VC=new Ge(YC,{skipValidations:!Mr,ensureOptimizations:Mr}),XC=new Ge([GC,Mf,...Q_,Uf,J_,Pf,Ff,Z_,Bf],{skipValidations:!Mr,ensureOptimizations:Mr});function Df(e,t=!1){return t?XC.tokenize(e):VC.tokenize(e)}function $f(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function t1(e){e.active={...e.reset}}function e1(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case Ff:s("$");break;case Pf:if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r();break;case Uf:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Mf:{t.x=t.active.leftedge??0,++t.y;break}default:{const u=c.tokenType.name,l=zo[u],h=pT(Wt[l]),f=mT(Wt[l]);l==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):x(h)?t.active.color=h:x(f)?t.active.bg=f:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(x(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){t1(t);const u=String.fromCharCode(t.writefullwidth).repeat(c),l=t.x+t.y*t.width;JC(l,l+u.length,t.active.color,t.active.bg,t),qC(l,u,t)}}}function n1(e,t,n){const r=Df(e);r.tokens&&(e1(r.tokens,t),n&&t1(t),t.changed())}function r1(e,t,n){const r=Df(e);if(!r.tokens)return;const i=$f(t,n,Wt.WHITE,Wt.BLACK);return i.measureonly=!0,e1(r.tokens,i),i.x>0&&++i.y,i}function qC(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function JC(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function i1(e,t,n){if(!go(k.element))return 0;const[r,i]=it(t,0,[Y.DIR,Y.MAYBE_KIND]),s=i??["bullet"],o=FC(k.book,k.board,s,{x:k.element.x,y:k.element.y});if(x(o)){x(n)&&(o.arg=n),o.party=k.elementid,o.collision=Ht.ISBULLET,o.destructible=1,o.stepx=r.x-k.element.x,o.stepy=r.y-k.element.y,o.bg=Wt.ONCLEAR;const a=Ei(k.book,o),c=o.code??(a==null?void 0:a.code)??"";W1(k.book,k.board,o,c,1)}return e.yield(),0}function El(e,t,n,r){var h,f;if(!go(k.element)||!x(k.book)||!x(k.board)||!x(k.element))return 0;Er(k.book,k.board);const[i,s]=it(t,0,[Y.DIR,Y.KIND]),o=Kn(k.board,i);if((o==null?void 0:o.category)===Hn.ISOBJECT&&(o!=null&&o.pushable)){const d={x:((h=k.element)==null?void 0:h.x)??0,y:((f=k.element)==null?void 0:f.y)??0},p=Ye(i,Xi(d,i));Y_(k.book,k.board,o,p)}const[a]=s,c=ma(k.book,a)??vf(k.book,a),u=(c==null?void 0:c.collision)??Ht.ISWALK;if(!Rf(k.book,k.board,u,i)){const d=ya(k.book,k.board,s,i,n);x(d)&&x(r)&&(d.arg=r)}return 0}const ZC=ui().command("remix",(e,t)=>{if(!x(k.book)||!x(k.board))return 0;const[n,r,i]=it(t,0,[Y.NAME,Y.MAYBE_NUMBER,Y.MAYBE_NUMBER]),s=Hr(k.book,Et.BOARD,n),o=ln(...s);return x(o)&&Lf(k.board.id,o.id,r,i),0}).command("remixonly",(e,t)=>{if(!x(k.book)||!x(k.board))return 0;const[n,r,i,s,o,a,c]=it(t,0,[Y.NAME,Y.NUMBER,Y.NUMBER,Y.NUMBER,Y.NUMBER,Y.MAYBE_NUMBER,Y.MAYBE_NUMBER]),u=Hr(k.book,Et.BOARD,n),l=ln(...u);return x(l)&&Lf(k.board.id,l.id,a,c,{x:r,y:i},{x:s,y:o}),0}).command("board",(e,t)=>{if(!x(k.book)||!x(k.board))return 0;const[n,r]=it(t,0,[Y.NAME]);switch(Mt(n)){case"snapshot":jC(k.board.id);break;case"restart":zC(k.board.id);break;default:{const[i,s]=it(t,r,[Y.MAYBE_NUMBER,Y.MAYBE_NUMBER]),o=Hr(k.book,Et.BOARD,n);if(o.length){const a=ln(...o);x(a)&&ga(k.book,k.elementfocus,a.id,{x:i??Math.round(Vt*.5),y:s??Math.round(Se*.5)})}break}}return 0}).command("edge",(e,t)=>{var s,o;if(!x(k.book)||!x(k.board)||!x(k.element))return 0;const[n,r]=it(t,0,[Y.DIR,Y.NAME]),i=Hr(k.book,Et.BOARD,r);if(i.length){const a={x:((s=k.element)==null?void 0:s.x)??0,y:((o=k.element)==null?void 0:o.y)??0},c=Xi(a,n),u=ln(...i);switch(c){case yt.NORTH:k.board.exitnorth=u.id;break;case yt.SOUTH:k.board.exitsouth=u.id;break;case yt.WEST:k.board.exitwest=u.id;break;case yt.EAST:k.board.exiteast=u.id;break}}return 0}).command("shove",(e,t)=>{if(!x(k.book)||!x(k.board))return 0;Er(k.book,k.board);const[n,r]=it(t,0,[Y.DIR,Y.DIR]),i=Kn(k.board,n);return Yo(i)&&ed(k.book,k.board,i,r),0}).command("duplicate",()=>(!x(k.book)||!x(k.board),0)).command("replace",(e,t)=>{if(!x(k.book)||!x(k.board))return 0;Er(k.book,k.board);const[n,r]=it(t,0,[Y.DIR,Y.KIND]),i=Kn(k.board,n);return Yo(i)&&Yr(k.book,k.board,i,k.timestamp),ya(k.book,k.board,r,n),0}).command("write",(e,t)=>{var u;if(!x(k.book)||!x(k.board))return 0;Er(k.book,k.board);const[n,r,i]=it(t,0,[Y.DIR,Y.COLOR,Y.STRING]),{color:s,bg:o}=tm(r),a=((u=r1(i,256,1))==null?void 0:u.measuredwidth)??1,c=$f(256,1,s??Wt.WHITE,o??Wt.BLACK);n1(i,c,!1);for(let l=0;l<a;++l){const h=kr(k.board,{x:n.x+l,y:n.y,char:c.char[l],color:c.color[l],bg:c.bg[l]});if(x(h)){const f=(h.x??0)+(h.y??0)*Vt;If(k.book,k.board,h,f)}}return 0}).command("change",(e,t)=>{if(!x(k.book)||!x(k.board))return 0;Er(k.book,k.board);const[n,r]=it(t,0,[Y.KIND,Y.KIND]),i=yc(n)??"",s=Xs(k.board,i),o=im(s,n),a=yc(r),c=nm(r),u=rm(r);return o.forEach(l=>{if(Fr(l)===a)x(c)&&(l.color=c),x(u)&&(l.bg=u);else{if(x(l.id)&&Yr(k.book,k.board,l,k.timestamp))return 0;go(l)&&ya(k.book,k.board,r,l)}}),0}).command("putwith",(e,t)=>{const[n,r]=it(t,0,[Y.ANY]);return El(e,t.slice(r),void 0,n)}).command("put",(e,t)=>El(e,t)).command("oneof",(e,t)=>{const[n,r]=it(t,0,[Y.ANY]);return x(k.board)&&Mn(k.board,n)?0:El(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=it(t,0,[Y.ANY,Y.ANY]);return x(k.board)&&Mn(k.board,r)?0:El(e,t.slice(i),r,n)}).command("shootwith",(e,t)=>{const[n,r]=it(t,0,[Y.ANY]);return i1(e,t.slice(r),n)}).command("shoot",i1);function s1(e){const[t,n]=e.split(":"),r=x(n);return[r?t:"self",r?n:e]}const QC=navigator.userAgent.includes("Mac")?"cmd":"ctrl";function _a(){Ld(j,cr())}const t4=ui().command("send",(e,t)=>{const[n,r]=it(t,0,[Y.NAME,Y.ANY]);switch(Mt(n)){case"helpmenu":Gi(j,"H E L P"),Pt(j,""),re(j,"#help controls","zss controls and inputs"),Pt(j,"!helpcontrols;read help controls"),Pt(j,""),re(j,"#help text","text formatting"),Pt(j,"!helptext;read help text"),Pt(j,""),re(j,"#help developer","developer commands"),Pt(j,"!helpdeveloper;read help developer"),Pt(j,""),re(j,"#help player","player settings"),Pt(j,"!helpplayer;read help player"),Vr(j,"keyboard input"),re(j,"?","open console"),re(j,"esc","close console"),re(j,"tab","move console"),re(j,"up / down arrow keys","navigate console items"),re(j,"left / right arrow keys","change console items"),re(j,"enter","interact with console items"),re(j,"alt + arrow keys","skip words and console lines"),re(j,`${QC} + up / down arrow keys`,"input history");break;case"helpcontrols":Gi(j,"zss controls and inputs"),Vr(j,"keyboard input"),re(j,"arrow keys","move"),re(j,"shift + arrow keys","shoot"),re(j,"enter","ok / accept"),re(j,"escape","cancel / close"),re(j,"tab","menu / action"),Vr(j,"controller input"),re(j,"left stick","move"),re(j,"right stick","aim"),re(j,"a","ok / accept"),re(j,"b","cancel / close"),re(j,"y","menu / action"),re(j,"x","shoot"),re(j,"triggers","shoot");break;case"helptext":Gi(j,"text formatting"),Vr(j,"typography"),se(j,"plain text"),se(j,"$centering text"),se(j,'"\\"@quoted strings for special chars\\""'),se(j,"$$0-255 for ascii chars $159$176$240"),se(j,`use color names like ${bn("red","$$red")} to change foreground color`),se(j,`use color names like ${V_("ongreen","$$ongreen")} to change background color`),se(j,`use clear ${V_("onclear","to change background to")} transparent`),Vr(j,"hyperlinks"),se(j,`${bn("white",'"!hotkey"')} message shortcut;${bn("gray","Label")}`),se(j,`${bn("white",'"!range"')} flag [labelmin] [labelmax];${bn("gray","Input Label")}`),se(j,`${bn("white",'"!select"')} flag ...list of values;${bn("gray","Input Label")}`),se(j,`${bn("white",'"!number"')} flag [minvalue] [maxvalue];${bn("gray","Input Label")}`),se(j,`${bn("white",'"!text"')} flag;${bn("gray","Input Label")}`),se(j,`${bn("white",'"!copyit"')} flag;${bn("gray","Input Label")}`),se(j,`${bn("white",'"!openit"')} flag;${bn("gray","Input Label")}`);break;case"helpdeveloper":Gi(j,"developer commands"),re(j,"#books","list books in memory"),re(j,"#pages","list pages in opened book"),re(j,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),re(j,"#trash","list books and pages from open book you can delete"),re(j,"#save","flush state to register"),re(j,"#share","creates a click to copy share url and QR code");break;case"helpplayer":Gi(j,"player settings"),se(j,"todo");break;default:{const[i,s]=s1(n);nd(i==="self"&&k.elementisplayer?`${k.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(e,t)=>{let n;const[r,...i]=t.map(xe),s=i.join(" ");switch(Mt(r)){case zn(wt.LOADER):n=Vi(Ft.CONTENT,s,Et.LOADER);break;default:n=Vi(Ft.CONTENT,[r,...i].join(" "),Et.OBJECT);break;case zn(wt.BOARD):n=Vi(Ft.CONTENT,s,Et.BOARD);break;case zn(wt.OBJECT):n=Vi(Ft.CONTENT,s,Et.OBJECT);break;case zn(wt.TERRAIN):n=Vi(Ft.CONTENT,s,Et.TERRAIN);break;case zn(wt.CHARSET):n=Vi(Ft.CONTENT,s,Et.CHARSET);break;case zn(wt.PALETTE):n=Vi(Ft.CONTENT,s,Et.PALETTE);break}return x(n)&&e.command("pageopen",n.id),0}).command("text",(e,t)=>{const n=t.map(xe).join(" ");return x(k.element)&&(k.element.tickertext=n,k.element.tickertime=k.timestamp),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=xe(n),s=r.map(xe).join(" ");return ei(j,`!${s};${i}`),0}).command("bookcreate",(e,t)=>{const[n]=it(t,0,[Y.MAYBE_NAME]),r=$1(n);return x(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=it(t,0,[Y.NAME]),r=wr(n);return x(r)?(se(j,`opened [book] ${r.name}`),Ll(Ft.MAIN,r.id),e.command("pages")):le(j,"bookopen",`book ${n} not found`,k.elementfocus),0}).command("booktrash",(e,t)=>{const[n]=it(t,0,[Y.NAME]),r=he(Ft.MAIN),i=wr(n);return x(i)&&(r===i&&Ll(Ft.MAIN,""),FL(n),se(j,`trashed [book] ${i.name}`),_a(),e.command("pages")),0}).command("pageopenwith",(e,t)=>{const[n,r,i]=it(t,0,[Y.NAME,Y.MAYBE_NAME,Y.MAYBE_NAME]);return e.command("pageopen",r,i,n)}).command("pageopen",(e,t)=>{const[n,r,i]=it(t,0,[Y.NAME,Y.MAYBE_NAME,Y.MAYBE_NAME]),s=Ln(Ft.MAIN);if(!x(s))return 0;const o=bi(s,n);if(x(o)){const a=Ne(o),c=Wi(o);se(j,`opened [${c}] ${a}`);const u=[],l=bi(s,i??""),h=x(l)?bf(l.code):void 0;if(x(h))for(let p=0;p<h.tokens.length;++p){const m=h.tokens[p];m.tokenType===lf&&u.push(m.image)}const f=[o.id,r];Yu(Oa(s.id,f),o.code);const d=Wi(o);Od(j,s.id,f,d,`${a} - ${s.name}`,u,k.elementfocus)}else le(j,"pageopen",`page ${n} not found`,k.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=it(t,0,[Y.NAME]),r=Ln(Ft.MAIN),i=z_(r,n);if(x(n)){const s=Ne(i),o=Wi(i);se(j,`trashed [${o}] ${s}`),_a(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(xe).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{Vr(j,"books");const e=he(Ft.MAIN);re(j,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=he(Ft.CONTENT);re(j,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),Of(j,7);const n=mo();return n.length?n.forEach(r=>{Pt(j,`!bookopen ${r.id};${r.name}`)}):se(j,"no books found"),Pt(j,"!bookcreate;create a new book"),0}).command("pages",()=>{Vr(j,"pages");const e=Ln(Ft.MAIN);return x(e)&&(re(j,"main",`${e.name} $GREEN${e.id}`),e.pages.length?Af(e).forEach(n=>{const r=Ne(n),i=Wi(n);Pt(j,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(Pt(j,""),se(j,"$white no pages found"),se(j,"$white use @ to create a page"),se(j,"$white @board name of board"),se(j,"$white @object name of object"),se(j,"$white @terrain name of terrain"),se(j,"$white You can omit the type and it will default to object"),se(j,"$white @object name of object"),se(j,"$white @name of object"))),0}).command("trash",()=>{Vr(j,"$REDTRASH"),se(j,"books");const e=mo();e.length&&(e.forEach(n=>{Pt(j,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Pt(j,""));const t=he(Ft.MAIN);return x(t)&&(se(j,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Ne(n);Pt(j,`!pagetrash ${n.id};$REDTRASH ${r}`)}),Pt(j,"")),0}).command("dev",()=>(_a(),aE(j,k.elementfocus),0)).command("share",()=>(_a(),cE(j,k.elementfocus),0)).command("save",()=>(_a(),0)).command("fork",()=>(xE(j,k.elementfocus),0)).command("nuke",()=>(lE(j,k.elementfocus),0)).command("restart",()=>(wE(j,k.elementfocus),0)).command("export",()=>{Gi(j,"E X P O R T"),Vr(j,"books");const e=mo();return e.length&&e.forEach(t=>Pt(j,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=it(t,0,[Y.NAME]),r=wr(n);return x(r)&&(Gi(j,"E X P O R T"),Vr(j,"pages"),setTimeout(()=>{if(r.pages.length){const i=Af(r);Pt(j,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Ne(s),a=Wi(s);Pt(j,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=it(t,0,[Y.NAME]),r=wr(n);return x(r)&&Rd(j,Xe(r),`${r.name}.book.json`,k.elementfocus),0}).command("pageexport",(e,t)=>{const[n]=it(t,0,[Y.NAME]),{target:r,path:i}=Tr(n),s=wr(r),o=bi(s,i);return x(o)&&Rd(j,Xe(o),`${Ne(o)}.${Wi(o)}.json`,k.elementfocus),0}).command("gadget",()=>(yE(j,void 0,k.elementfocus),0)).command("joincode",(e,t)=>{const[n]=it(t,0,[Y.MAYBE_NAME]);return eE(j,!!n,k.elementfocus),0}).command("jointab",(e,t)=>{const[n]=it(t,0,[Y.MAYBE_NAME]);return nE(j,!!n,k.elementfocus),0}).command("twitchbroadcast",(e,t)=>{const[n]=it(t,0,[Y.NAME]);switch(Mt(n)){default:Yb(j,n,k.elementfocus);break;case"stop":Vb(j,k.elementfocus);break}return 0}),e4=ui().command("palette",(e,t)=>{const[n]=it(t,0,[Y.NAME]),r=j1(),i=On(k.book,Et.PALETTE,n);return x(i)?(r.palette=i.id,Pt(j,`loaded palette ${n}`)):le(j,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=it(t,0,[Y.NAME]),r=j1(),i=On(k.book,Et.CHARSET,n);return x(i)?(r.charset=i.id,Pt(j,`loaded charset ${n}`)):le(j,"not-found",`unabled to find charset ${n}`),0}),jf={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Xr(e){return ne(e)&&o1(e[0])}function o1(e){return x(Hn[e])&&St(e)}function a1(e){if(St(e))return jf[Mt(e)]}function c1(e){if(Xr(e))return e;if(o1(e))return[e];const t=a1(e);if(x(t))return[t]}function wl(e){const t=k.words[e],n=c1(t);if(Xr(n))return[n,e+1];const[r,i]=fn(e),s=c1(r);return Xr(s)?[s,i]:[void 0,e]}const zf={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Ht.ISSOLID,Ht.ISWALK,Ht.ISSWIM,Ht.ISBULLET,Ht.ISWALK,Ht.ISSWIM;function xi(e){return ne(e)&&Wf(e[0])}function Wf(e){return x(Ht[e])&&St(e)}function n4(e){if(St(e))return zf[Mt(e)]}function l1(e){const t=k.words[e];if(xi(t))return[t,e+1];if(Wf(t))return[[t],e+1];const[n,r]=fn(e);return xi(n)?[n,r]:Wf(n)?[[n],r]:[void 0,e]}const r4=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),u1=new Set(["party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),i4=["NORTH","SOUTH","WEST","EAST"];function s4(e){const t=Es(e);if(Ct(t.inputcurrent)||(t.inputcurrent=0),ne(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=mn.NONE,i=0]=n??[mn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&tT?1:0,t.inputctrl=i&eT?1:0,t.inputshift=i&nT?1:0,r){case mn.MOVE_UP:case mn.MOVE_DOWN:case mn.MOVE_LEFT:case mn.MOVE_RIGHT:t.inputmove=[i4[r-mn.MOVE_UP]];break;case mn.OK_BUTTON:t.inputok=1;break;case mn.CANCEL_BUTTON:t.inputcancel=1;break;case mn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==mn.NONE&&o!==r}),t}function o4(e){const t=jf[e];if(x(t))return t;const n=zf[e];if(x(n))return n;const r=zo[e];if(x(r))return r;const i=rd[e];if(x(i))return i}const a4=ui({get(e,t){var o,a,c,u,l,h,f,d,p,m,w,E,T,v,I,U,S;const n=o4(t);if(x(n))return[!0,n];if(k.elementisplayer&&r4.has(t)){const N=s4(k.elementid)[t];return[x(N),N]}const r=_c(k.board,k.element,k.elementfocus),i=(r==null?void 0:r.id)??k.elementfocus;switch(t){case"isdark":return[!0,(o=k.board)!=null&&o.isdark?1:0];case"startx":return[!0,((a=k.board)==null?void 0:a.startx)??0];case"starty":return[!0,((c=k.board)==null?void 0:c.starty)??0];case"over":return[!0,((u=k.board)==null?void 0:u.over)??""];case"under":return[!0,((l=k.board)==null?void 0:l.under)??""];case"exitnorth":return[!0,((h=k.board)==null?void 0:h.exitnorth)??""];case"exitsouth":return[!0,((f=k.board)==null?void 0:f.exitsouth)??""];case"exitwest":return[!0,((d=k.board)==null?void 0:d.exitwest)??""];case"exiteast":return[!0,((p=k.board)==null?void 0:p.exiteast)??""];case"timelimit":return[!0,((m=k.board)==null?void 0:m.timelimit)??0];case"restartonzap":return[!0,((w=k.board)==null?void 0:w.restartonzap)??0];case"maxplayershots":return[!0,((E=k.board)==null?void 0:E.maxplayershots)??0];case"boardid":return[!0,((T=k.board)==null?void 0:T.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((v=k.element)==null?void 0:v.id)??""];case"thisx":return[!0,((I=k.element)==null?void 0:I.x)??-1];case"thisy":return[!0,((U=k.element)==null?void 0:U.y)??-1];default:{const N=(S=k.element)==null?void 0:S[t];if(u1.has(t))return[!0,N];break}}const s=Es(i)[t];return[x(s),s]},set(e,t,n){const r=_c(k.board,k.element,k.elementfocus),i=(r==null?void 0:r.id)??k.elementfocus;switch(t){case"isdark":x(k.board)&&(k.board.isdark=n?1:0);break;case"startx":x(k.board)&&(k.board.startx=jo(n,0));break;case"starty":x(k.board)&&(k.board.starty=jo(n,0));break;case"over":x(k.board)&&(k.board.over=xe(n));break;case"under":x(k.board)&&(k.board.under=xe(n));break;case"exitnorth":x(k.board)&&(k.board.exitnorth=xe(n));break;case"exitsouth":x(k.board)&&(k.board.exitsouth=xe(n));break;case"exitwest":x(k.board)&&(k.board.exitwest=xe(n));break;case"exiteast":x(k.board)&&(k.board.exiteast=xe(n));break;case"timelimit":x(k.board)&&(k.board.timelimit=jo(n,0));break;case"restartonzap":x(k.board)&&(k.board.restartonzap=n?1:0);break;case"maxplayershots":x(k.board)&&(k.board.maxplayershots=jo(n,0));break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(u1.has(t))return x(k.element)&&(k.element[t]=n),[!0,n];break}}const s=Es(i);return x(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=k.element)!=null&&e.removed)&&(x((t=k.element)==null?void 0:t.stepx)||x((n=k.element)==null?void 0:n.stepy))){const s={x:((r=k.element)==null?void 0:r.x)??0,y:((i=k.element)==null?void 0:i.y)??0};ed(k.book,k.board,k.element,{x:s.x+(k.element.stepx??0),y:s.y+(k.element.stepy??0)})===!1&&(k.element.stepx=0,k.element.stepy=0,W_(k.book,k.element,"destructible")&&Yr(k.book,k.board,k.element,k.timestamp))}}}).command("clear",(e,t)=>(t.forEach(n=>e.set(xe(n),0)),0)).command("set",(e,t)=>{const[n,r]=it(t,0,[Y.NAME,Y.ANY]);return e.set(n,r),0}).command("become",(e,t)=>{var r,i;const[n]=it(t,0,[Y.KIND]);if(Er(k.book,k.board),Nf(k.book,k.board,k.element),Yr(k.book,k.board,k.element,k.timestamp)){const s={x:((r=k.element)==null?void 0:r.x)??0,y:((i=k.element)==null?void 0:i.y)??0};ya(k.book,k.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=it(t,0,[Y.NUMBER]);return x(k.element)&&(k.element.char=n),0}).command("color",(e,t)=>{const[n]=it(t,0,[Y.COLOR]);return x(k.element)&&x(n)&&Sc(k.element,n),0}).command("go",(e,t)=>{if(x(k.element)){const[n]=it(t,0,[Y.DIR]);if(ed(k.book,k.board,k.element,n),e.yield(),k.element.x===n.x&&k.element.y===n.y)return 0}return 1}).command("walk",(e,t)=>{if(!x(k.element))return 0;const[n]=it(t,0,[Y.DIR]),r=k.element.x??0,i=k.element.y??0;return k.element.stepx=n.x-r,k.element.stepy=n.y-i,0}),c4=ui().command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=it(t,0,[Y.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(xe(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(xe(t[0])),0)).command("cycle",(e,t)=>{if(x(k.element)){const[n]=it(t,0,[Y.NUMBER]);k.element.cycle=Pn(Math.round(n),1,255)}return 0}).command("die",e=>(Yr(k.book,k.board,k.element,k.timestamp),e.endofprogram(),0)).command("endgame",()=>(k.elementisplayer&&Cd(j,k.elementid),0)).command("run",(e,t)=>{const[n]=it(t,0,[Y.NAME]);return Ml(n),0}).command("runwith",(e,t)=>{const[n,r]=it(t,0,[Y.ANY,Y.NAME]);return e.set("arg",n),Ml(r),0}),xl={};function l4(e){var t;return(t=xl[e])==null?void 0:t.arg}function u4(e){var t;return(t=xl[e])==null?void 0:t.format}function ao(e){var t;return(t=xl[e])==null?void 0:t.content}function h4(e,t,n,r,i){const s=he(Ft.MAIN);if(!x(s))return;const o=gs(s,Et.LOADER).filter(a=>{const c=ms(a),u=c.format,l=St(u)?new RegExp(u).test(t):!1,h=c.event,f=St(h)?new RegExp(h).test(n):!1;return St(u)&&St(h)?l&&f:St(u)?l:St(h)?f:!1});for(let a=0;a<o.length;++a){const c=`${Ce()}_loader`;xl[c]={arg:e,format:t,content:r,player:i},jL(c,o[a].code)}}function h1(e,t){if(!x(e))return;const n=Mt(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const f4=(e,t)=>{const n=ao(e.id());if(!x(n))return 0;const[r,i]=it(t,0,[Y.NAME]),s=Mt(r);switch(s){case"seek":{const[o]=it(t,i,[Y.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=it(t,i,[Y.NAME]);e.set(o,h1(n,s));break}case"text":{const[o,a]=it(t,i,[Y.NAME,Y.NAME]),c=h1(n,o);if(Ct(c)&&St(a)){const u=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(u);e.set(a,h),n.cursor+=c}break}case"palette":{const[o]=it(t,i,[Y.NAME]),a=Tf(k.book,Et.PALETTE,o),c=un(a);if(x(c)){const u=Yk*hc,l=Mm(new Uint8Array(n.bytes.buffer,n.cursor,u));x(l)&&(c.bits=l.bits),n.cursor+=u}break}case"charset":{const[o]=it(t,i,[Y.NAME]),a=Tf(k.book,Et.CHARSET,o),c=un(a);if(x(c)){const u=pc*Hk*eh,l=Um(new Uint8Array(n.bytes.buffer,n.cursor,u));x(l)&&(c.bits=l.bits),n.cursor+=u}break}}return 0},co=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",kl=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!kl(e[n],t[n]))return!1;return!0}if(co(e)&&co(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!kl(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},Tl=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(co(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},d4=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",f1=e=>e>="0"&&e<="9"||e==="-",p4=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var q;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(q||(q={}));const d1={"(":q.TOK_LPAREN,")":q.TOK_RPAREN,"*":q.TOK_STAR,",":q.TOK_COMMA,".":q.TOK_DOT,":":q.TOK_COLON,"@":q.TOK_CURRENT,$:q.TOK_ROOT,"]":q.TOK_RBRACKET,"{":q.TOK_LBRACE,"}":q.TOK_RBRACE},m4={"!":!0,"<":!0,"=":!0,">":!0},g4={"	":!0,"\n":!0,"\r":!0," ":!0};class y4{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(d4(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:q.TOK_UNQUOTEDIDENTIFIER,value:i});else if(d1[t[this._current]]!==void 0)n.push({start:this._current,type:d1[t[this._current]],value:t[this._current]}),this._current+=1;else if(f1(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:q.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:q.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:q.TOK_LITERAL,value:o})}else if(m4[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(g4[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:q.TOK_AND,value:"&&"})):n.push({start:r,type:q.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:q.TOK_OR,value:"||"})):n.push({start:r,type:q.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&p4(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;f1(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:q.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:q.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:q.TOK_FLATTEN,value:"[]"}):{start:n,type:q.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_NE,value:"!="}):{start:n,type:q.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_LTE,value:"<="}):{start:n,type:q.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_GTE,value:">="}):{start:n,type:q.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:q.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const _4=new y4,hn={[q.TOK_EOF]:0,[q.TOK_UNQUOTEDIDENTIFIER]:0,[q.TOK_QUOTEDIDENTIFIER]:0,[q.TOK_RBRACKET]:0,[q.TOK_RPAREN]:0,[q.TOK_COMMA]:0,[q.TOK_RBRACE]:0,[q.TOK_NUMBER]:0,[q.TOK_CURRENT]:0,[q.TOK_EXPREF]:0,[q.TOK_ROOT]:0,[q.TOK_PIPE]:1,[q.TOK_OR]:2,[q.TOK_AND]:3,[q.TOK_EQ]:5,[q.TOK_GT]:5,[q.TOK_LT]:5,[q.TOK_GTE]:5,[q.TOK_LTE]:5,[q.TOK_NE]:5,[q.TOK_FLATTEN]:9,[q.TOK_STAR]:20,[q.TOK_FILTER]:21,[q.TOK_DOT]:40,[q.TOK_NOT]:45,[q.TOK_LBRACE]:50,[q.TOK_LBRACKET]:55,[q.TOK_LPAREN]:60};class b4{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==q.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[..._4.tokenize(t),{type:q.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<hn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case q.TOK_LITERAL:return{type:"Literal",value:t.value};case q.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case q.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===q.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case q.TOK_NOT:return r=this.expression(hn.Not),{type:"NotExpression",children:[r]};case q.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===q.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(hn.Star),{type:"ValueProjection",children:[n,r]};case q.TOK_FILTER:return this.led(t.type,{type:"Identity"});case q.TOK_LBRACE:return this.parseMultiselectHash();case q.TOK_FLATTEN:return n={type:q.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(hn.Flatten),{type:"Projection",children:[n,r]};case q.TOK_LBRACKET:return this.lookahead(0)===q.TOK_NUMBER||this.lookahead(0)===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===q.TOK_STAR&&this.lookahead(1)===q.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(hn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case q.TOK_CURRENT:return{type:q.TOK_CURRENT};case q.TOK_ROOT:return{type:q.TOK_ROOT};case q.TOK_EXPREF:return i=this.expression(hn.Expref),{type:"ExpressionReference",children:[i]};case q.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(i={type:q.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(q.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case q.TOK_DOT:const i=hn.Dot;return this.lookahead(0)!==q.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case q.TOK_PIPE:return r=this.expression(hn.Pipe),{type:q.TOK_PIPE,children:[n,r]};case q.TOK_OR:return r=this.expression(hn.Or),{type:"OrExpression",children:[n,r]};case q.TOK_AND:return r=this.expression(hn.And),{type:"AndExpression",children:[n,r]};case q.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(a={type:q.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===q.TOK_COMMA&&this.match(q.TOK_COMMA),o.push(a);return this.match(q.TOK_RPAREN),{name:s,type:"Function",children:o};case q.TOK_FILTER:const u=this.expression(0);return this.match(q.TOK_RBRACKET),r=this.lookahead(0)===q.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(hn.Filter),{type:"FilterProjection",children:[n,r,u]};case q.TOK_FLATTEN:const l={type:q.TOK_FLATTEN,children:[n]},h=this.parseProjectionRHS(hn.Flatten);return{type:"Projection",children:[l,h]};case q.TOK_EQ:case q.TOK_NE:case q.TOK_GT:case q.TOK_GTE:case q.TOK_LT:case q.TOK_LTE:return this.parseComparator(n,t);case q.TOK_LBRACKET:const f=this.lookaheadToken(0);return f.type===q.TOK_NUMBER||f.type===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(q.TOK_STAR),this.match(q.TOK_RBRACKET),r=this.parseProjectionRHS(hn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===q.TOK_COLON||this.lookahead(1)===q.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(q.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(hn.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==q.TOK_RBRACKET&&n<3;){if(r===q.TOK_COLON)n+=1,this.advance();else if(r===q.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(q.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(hn[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER,q.TOK_STAR].includes(n))return this.expression(t);if(n===q.TOK_LBRACKET)return this.match(q.TOK_LBRACKET),this.parseMultiselectList();if(n===q.TOK_LBRACE)return this.match(q.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(hn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===q.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===q.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===q.TOK_DOT)return this.match(q.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==q.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===q.TOK_COMMA&&(this.match(q.TOK_COMMA),this.lookahead(0)===q.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(q.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(q.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===q.TOK_COMMA)this.match(q.TOK_COMMA);else if(this.lookahead(0)===q.TOK_RBRACE){this.match(q.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const E4=new b4;var ut;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ut||(ut={}));class w4{constructor(t){this.TYPE_NAME_TABLE={[ut.TYPE_NUMBER]:"number",[ut.TYPE_ANY]:"any",[ut.TYPE_STRING]:"string",[ut.TYPE_ARRAY]:"array",[ut.TYPE_OBJECT]:"object",[ut.TYPE_BOOLEAN]:"boolean",[ut.TYPE_EXPREF]:"expression",[ut.TYPE_NULL]:"null",[ut.TYPE_ARRAY_NUMBER]:"Array<number>",[ut.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>co(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=-1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c>o&&(o=c,a=i[u]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c<o&&(o=c,a=i[u]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ut.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ut.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ut.TYPE_NUMBER,ut.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,u)=>{const l=i.visit(s,c[1]),h=i.visit(s,u[1]);if(this.getTypeName(l)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(l)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return l>h?1:l<h?-1:c[0]-u[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ut.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ut.TYPE_NUMBER?n:r===ut.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ut.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ut.TYPE_NUMBER:return"number";case ut.TYPE_STRING:return"string";case ut.TYPE_ARRAY:return"array";case ut.TYPE_OBJECT:return"object";case ut.TYPE_BOOLEAN:return"boolean";case ut.TYPE_EXPREF:return"expref";case ut.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ut.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ut.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]},{types:[ut.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ut.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ut.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY,ut.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ut.TYPE_EXPREF]},{types:[ut.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ut.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ut.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ut.TYPE_ARRAY_STRING,ut.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ut.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ut.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ut.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ut.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ut.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(m=>{var w;return(w=!m.optional)!==null&&w!==void 0?w:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,u=n.length<a,l=n.length>r.length,h=u&&(!c&&a>1||c)?"at least ":"";if(c&&u||!c&&(u||l))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${h}${a} argument${o&&"s"||""} but received ${n.length}`);let f,d,p;for(let m=0;m<r.length;m+=1){p=!1,f=r[m].types,d=this.getTypeName(n[m]);let w;for(w=0;w<f.length;w+=1)if(d!==void 0&&this.typeMatches(d,f[w],n[m])){p=!0;break}if(!p&&d!==void 0){const E=f.map(T=>this.TYPE_NAME_TABLE[T]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${m+1} to be type (${E}) but received type ${this.TYPE_NAME_TABLE[d]} instead.`)}}}typeMatches(t,n,r){if(n===ut.TYPE_ANY)return!0;if(n===ut.TYPE_ARRAY_STRING||n===ut.TYPE_ARRAY_NUMBER||n===ut.TYPE_ARRAY){if(n===ut.TYPE_ARRAY)return t===ut.TYPE_ARRAY;if(t===ut.TYPE_ARRAY){let i;n===ut.TYPE_ARRAY_NUMBER?i=ut.TYPE_NUMBER:n===ut.TYPE_ARRAY_STRING&&(i=ut.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ut.TYPE_STRING;case"[object Number]":return ut.TYPE_NUMBER;case"[object Array]":return ut.TYPE_ARRAY;case"[object Boolean]":return ut.TYPE_BOOLEAN;case"[object Null]":return ut.TYPE_NULL;case"[object Object]":return t.jmespathType===q.TOK_EXPREF?ut.TYPE_EXPREF:ut.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class x4{constructor(){this._rootValue=null,this.runtime=new w4(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,u,l,h,f,d;switch(t.type){case"Field":return n===null?null:co(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),f=1;f<t.children.length;f+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return u=this.visit(t.children[0],n),l=this.visit(t.children[1],u),l;case"Index":if(!Array.isArray(n))return null;let p=t.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...t.children],w=this.computeSliceParams(n.length,m),[E,T,v]=w;if(s=[],v>0)for(f=E;f<T;f+=v)s.push(n[f]);else for(f=E;f>T;f+=v)s.push(n[f]);return s;case"Projection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;for(h=[],f=0;f<d.length;f+=1)i=this.visit(t.children[1],d[f]),i!==null&&h.push(i);return h;case"ValueProjection":if(d=this.visit(t.children[0],n),!co(d))return null;h=[];const I=Object.values(d);for(f=0;f<I.length;f+=1)i=this.visit(t.children[1],I[f]),i!==null&&h.push(i);return h;case"FilterProjection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;const U=[],S=[];for(f=0;f<d.length;f+=1)r=this.visit(t.children[2],d[f]),Tl(r)||U.push(d[f]);for(let C=0;C<U.length;C+=1)i=this.visit(t.children[1],U[C]),i!==null&&S.push(i);return S;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case q.TOK_EQ:s=kl(o,a);break;case q.TOK_NE:s=!kl(o,a);break;case q.TOK_GT:s=o>a;break;case q.TOK_GTE:s=o>=a;break;case q.TOK_LT:s=o<a;break;case q.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case q.TOK_FLATTEN:const N=this.visit(t.children[0],n);if(!Array.isArray(N))return null;let P=[];for(f=0;f<N.length;f+=1)i=N[f],Array.isArray(i)?P=[...P,...i]:P.push(i);return P;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(h=[],f=0;f<t.children.length;f+=1)h.push(this.visit(t.children[f],n));return h;case"MultiSelectHash":if(n===null)return null;h={};let L;for(f=0;f<t.children.length;f+=1)L=t.children[f],h[L.name]=this.visit(L.value,n);return h;case"OrExpression":return r=this.visit(t.children[0],n),Tl(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),Tl(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),Tl(o);case"Literal":return t.value;case q.TOK_PIPE:return u=this.visit(t.children[0],n),this.visit(t.children[1],u);case q.TOK_CURRENT:return n;case q.TOK_ROOT:return this._rootValue;case"Function":const V=[];for(let C=0;C<t.children.length;C+=1)V.push(this.visit(t.children[C],n));return this.runtime.callFunction(t.name,V);case"ExpressionReference":const Z=t.children[0];return Z.jmespathType=q.TOK_EXPREF,Z;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const k4=new x4;ut.TYPE_ANY,ut.TYPE_ARRAY,ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING,ut.TYPE_BOOLEAN,ut.TYPE_EXPREF,ut.TYPE_NULL,ut.TYPE_NUMBER,ut.TYPE_OBJECT,ut.TYPE_STRING;function T4(e,t){const n=E4.parse(t);return k4.search(n,e)}const A4=(e,t)=>{const n=ao(e.id());if(!x(n))return 0;const[r,i]=it(t,0,[Y.NAME,Y.NAME]),s=T4(n.json,r);return e.set(i,s),0},v4=(e,t)=>{const n=ao(e.id());if(!x(n))return 0;const[r,i]=it(t,0,[Y.NAME]);switch(Mt(r)){case"seek":{const[o]=it(t,i,[Y.NUMBER]);n.cursor=Pn(o,0,n.lines.length-1);break}case"line":n.cursor=Pn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let u=1;for(let l=i;l<t.length;){const[h,f]=it(t,l,[Y.NAME]);e.set(h,c[u]??0),++u,l=f}break}}return 0},S4=ui({get(e,t){const n=u4(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=ao(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=ao(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=ao(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(e,t)=>{const[n,r]=it(t,0,[Y.NAME,Y.ANY]);return nd(n,r),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(xe).join(" ");return ei(j,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=xe(n),s=r.map(xe).join(" ");return ei(j,"$175",`!${s};${i}`),0}).command("txt",v4).command("json",A4).command("bin",f4).command("with",(e,t)=>{const[n]=it(t,0,[Y.NAME]),r=Hr(k.book,Et.BOARD,n);if(r.length){const i=ln(...r);x(i)&&(k.board=un(i),k.element={x:Mi(0,Vt-1),y:Mi(0,Se-1)})}return 0});function p1(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,u]=it(i,a,[Y.ANY]);ne(c)&&!xr(c)&&!Xr(c)&&!xi(c)&&!Dn(c)?o.push(...c):o.push(c),a=u}switch(Mt(r)){case"get":case"post:json":tE(j,e,t,n,r,o,k.elementfocus);break}return 0}const R4=ui().command("fetch",(e,t)=>{const[n,r,i="get",s]=it(t,0,[Y.NAME,Y.NAME,Y.MAYBE_STRING]);return p1(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=it(t,0,[Y.ANY,Y.NAME,Y.NAME,Y.MAYBE_STRING]);return p1(n,r,i,s,t,o),0}).command("twitchchat",(e,t)=>{const[n]=it(t,0,[Y.ANY]);switch(Mt(n)){default:Xb(j,n,k.elementfocus);break;case"close":qb(j,k.elementfocus);break}return 0}),I4=ui({set(e,t,n){return oM(e,t,n),[!1,void 0]},everytick(){const e=Qr(k.elementid),[t]=e;if(e.length===1&&St(t)){if(x(k.element))if(t.trim().length===0){const n=wn(k.elementid);n.sidebar=[]}else k.element.tickertext=t,k.element.tickertime=k.timestamp}else if(e.length>1)if(k.elementisplayer){const n=wn(k.elementid);n.sidebar=e}else{const n=wn(k.elementfocus);n.scroll=e}}}).command("send",(e,t)=>{var c,u;const[n,r]=it(t,0,[Y.NAME,Y.ANY]),[i,s]=s1(n);function o(l){for(let h=0;h<l.length;++h){const f=l[h];x(f.id)&&e.send(f.id,s,r)}}switch(Mt(i)){case"all":for(const l of Object.keys(((c=k.board)==null?void 0:c.objects)??{}))e.send(l,s,r);break;case"self":e.message({session:j.session(),id:Ce(),sender:e.id(),target:s,data:r});break;case"others":for(const l of Object.keys(((u=k.board)==null?void 0:u.objects)??{}))l!==e.id()&&e.send(l,s,r);break;default:{o(sm(k.board,[i]));break}}return 0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(xe).join("");return oe(k.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=xe(n);return Bt(k.elementid,e.id(),i,r,e.get,e.set),0});var Hi=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(Hi||{});const N4={audio:nh,board:ZC,cli:t4,display:e4,element:a4,runtime:I4,lifecycle:c4,loader:S4,network:R4},Kf=["audio","board","display","network","lifecycle","element"],O4={0:[],1:["cli",...Kf],2:["loader",...Kf],3:["runtime",...Kf]},C4={0:new Map,1:new Map,2:new Map,3:new Map};function lo(e){return(O4[e]??[]).map(n=>N4[n]).filter(x)}function Gf(e){const t=[],n=lo(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function L4(e,t){const n=C4[e];if(!n.has(t)){let r;const i=lo(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!x(r));++s);n.set(t,r)}return n.get(t)}function M4(e,t,n){const r=lo(e);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(t,n);if(s)return[s,o]}return[!1,void 0]}function U4(e,t,n,r){const i=lo(e);for(let s=0;s<i.length;++s){const[o]=i[s].set(t,n,r);if(o)return[o,r]}return[!1,void 0]}function F4(e,t){const n=lo(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function m1(e,t){const n=lo(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var g1={},y1={},_1={};const b1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");_1.encode=function(e){if(0<=e&&e<b1.length)return b1[e];throw new TypeError("Must be between 0 and 63: "+e)};const B4=_1,E1=5,w1=1<<E1,P4=w1-1,D4=w1;function $4(e){return e<0?(-e<<1)+1:(e<<1)+0}y1.encode=function(t){let n="",r,i=$4(t);do r=i&P4,i>>>=E1,i>0&&(r|=D4),n+=B4.encode(r);while(i>0);return n};var ba={};(function(e){function t(S,N,P){if(N in S)return S[N];if(arguments.length===3)return P;throw new Error('"'+N+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(S){const N=S.match(n);return N?{scheme:N[1],auth:N[2],host:N[3],port:N[4],path:N[5]}:null}e.urlParse=i;function s(S){let N="";return S.scheme&&(N+=S.scheme+":"),N+="//",S.auth&&(N+=S.auth+"@"),S.host&&(N+=S.host),S.port&&(N+=":"+S.port),S.path&&(N+=S.path),N}e.urlGenerate=s;const o=32;function a(S){const N=[];return function(P){for(let V=0;V<N.length;V++)if(N[V].input===P){const Z=N[0];return N[0]=N[V],N[V]=Z,N[0].result}const L=S(P);return N.unshift({input:P,result:L}),N.length>o&&N.pop(),L}}const c=a(function(N){let P=N;const L=i(N);if(L){if(!L.path)return N;P=L.path}const V=e.isAbsolute(P),Z=[];let C=0,R=0;for(;;)if(C=R,R=P.indexOf("/",C),R===-1){Z.push(P.slice(C));break}else for(Z.push(P.slice(C,R));R<P.length&&P[R]==="/";)R++;let _=0;for(R=Z.length-1;R>=0;R--){const B=Z[R];B==="."?Z.splice(R,1):B===".."?_++:_>0&&(B===""?(Z.splice(R+1,_),_=0):(Z.splice(R,2),_--))}return P=Z.join("/"),P===""&&(P=V?"/":"."),L?(L.path=P,s(L)):P});e.normalize=c;function u(S,N){S===""&&(S="."),N===""&&(N=".");const P=i(N),L=i(S);if(L&&(S=L.path||"/"),P&&!P.scheme)return L&&(P.scheme=L.scheme),s(P);if(P||N.match(r))return N;if(L&&!L.host&&!L.path)return L.host=N,s(L);const V=N.charAt(0)==="/"?N:c(S.replace(/\/+$/,"")+"/"+N);return L?(L.path=V,s(L)):V}e.join=u,e.isAbsolute=function(S){return S.charAt(0)==="/"||n.test(S)};function l(S,N){S===""&&(S="."),S=S.replace(/\/$/,"");let P=0;for(;N.indexOf(S+"/")!==0;){const L=S.lastIndexOf("/");if(L<0||(S=S.slice(0,L),S.match(/^([^\/]+:\/)?\/*$/)))return N;++P}return Array(P+1).join("../")+N.substr(S.length+1)}e.relative=l;const h=function(){return!("__proto__"in Object.create(null))}();function f(S){return S}function d(S){return m(S)?"$"+S:S}e.toSetString=h?f:d;function p(S){return m(S)?S.slice(1):S}e.fromSetString=h?f:p;function m(S){if(!S)return!1;const N=S.length;if(N<9||S.charCodeAt(N-1)!==95||S.charCodeAt(N-2)!==95||S.charCodeAt(N-3)!==111||S.charCodeAt(N-4)!==116||S.charCodeAt(N-5)!==111||S.charCodeAt(N-6)!==114||S.charCodeAt(N-7)!==112||S.charCodeAt(N-8)!==95||S.charCodeAt(N-9)!==95)return!1;for(let P=N-10;P>=0;P--)if(S.charCodeAt(P)!==36)return!1;return!0}function w(S,N,P){let L=T(S.source,N.source);return L!==0||(L=S.originalLine-N.originalLine,L!==0)||(L=S.originalColumn-N.originalColumn,L!==0||P)||(L=S.generatedColumn-N.generatedColumn,L!==0)||(L=S.generatedLine-N.generatedLine,L!==0)?L:T(S.name,N.name)}e.compareByOriginalPositions=w;function E(S,N,P){let L=S.generatedLine-N.generatedLine;return L!==0||(L=S.generatedColumn-N.generatedColumn,L!==0||P)||(L=T(S.source,N.source),L!==0)||(L=S.originalLine-N.originalLine,L!==0)||(L=S.originalColumn-N.originalColumn,L!==0)?L:T(S.name,N.name)}e.compareByGeneratedPositionsDeflated=E;function T(S,N){return S===N?0:S===null?1:N===null?-1:S>N?1:-1}function v(S,N){let P=S.generatedLine-N.generatedLine;return P!==0||(P=S.generatedColumn-N.generatedColumn,P!==0)||(P=T(S.source,N.source),P!==0)||(P=S.originalLine-N.originalLine,P!==0)||(P=S.originalColumn-N.originalColumn,P!==0)?P:T(S.name,N.name)}e.compareByGeneratedPositionsInflated=v;function I(S){return JSON.parse(S.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=I;function U(S,N,P){if(N=N||"",S&&(S[S.length-1]!=="/"&&N[0]!=="/"&&(S+="/"),N=S+N),P){const L=i(P);if(!L)throw new Error("sourceMapURL could not be parsed");if(L.path){const V=L.path.lastIndexOf("/");V>=0&&(L.path=L.path.substring(0,V+1))}N=u(s(L),N)}return c(N)}e.computeSourceURL=U})(ba);var Hf={};let j4=class cb{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new cb;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};Hf.ArraySet=j4;var x1={};const k1=ba;function z4(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||k1.compareByGeneratedPositionsInflated(e,t)<=0}let W4=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){z4(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(k1.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};x1.MappingList=W4;const Ea=y1,Pe=ba,Al=Hf.ArraySet,K4=x1.MappingList;let T1=class lb{constructor(t){t||(t={}),this._file=Pe.getArg(t,"file",null),this._sourceRoot=Pe.getArg(t,"sourceRoot",null),this._skipValidation=Pe.getArg(t,"skipValidation",!1),this._sources=new Al,this._names=new Al,this._mappings=new K4,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new lb({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Pe.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=Pe.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=Pe.getArg(t,"generated"),r=Pe.getArg(t,"original",null);let i=Pe.getArg(t,"source",null),s=Pe.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=Pe.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Pe.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Pe.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=Pe.relative(s,i));const o=this._mappings.toArray().length>0?new Al:this._sources,a=new Al;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=Pe.join(r,c.source)),s!=null&&(c.source=Pe.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const u=c.source;u!=null&&!o.has(u)&&o.add(u);const l=c.name;l!=null&&!a.has(l)&&a.add(l)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const u=t.sourceContentFor(c);u!=null&&(r!=null&&(c=Pe.join(r,c)),s!=null&&(c=Pe.relative(s,c)),this.setSourceContent(c,u))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,u,l,h;const f=this._mappings.toArray();for(let d=0,p=f.length;d<p;d++){if(u=f[d],c="",u.generatedLine!==n)for(t=0;u.generatedLine!==n;)c+=";",n++;else if(d>0){if(!Pe.compareByGeneratedPositionsInflated(u,f[d-1]))continue;c+=","}c+=Ea.encode(u.generatedColumn-t),t=u.generatedColumn,u.source!=null&&(h=this._sources.indexOf(u.source),c+=Ea.encode(h-o),o=h,c+=Ea.encode(u.originalLine-1-i),i=u.originalLine-1,c+=Ea.encode(u.originalColumn-r),r=u.originalColumn,u.name!=null&&(l=this._names.indexOf(u.name),c+=Ea.encode(l-s),s=l)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Pe.relative(n,r));const i=Pe.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};T1.prototype._version=3,g1.SourceMapGenerator=T1;var A1={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,u=o(i,s[c],!0);return u===0?c:u>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(A1);var wa={exports:{}},G4={},H4=Object.freeze({__proto__:null,default:G4}),v1=ub(H4);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;wa.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},wa.exports.initialize=t=>e=t}else{const e=v1,t=v1;wa.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},wa.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var S1=wa.exports;const Y4=S1;function V4(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let xa=null;var X4=function(){if(xa)return xa;const t=[];return xa=Y4().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,u,l,h,f){const d=new V4;d.generatedLine=r+1,d.generatedColumn=i,s&&(d.lastGeneratedColumn=o-1),a&&(d.source=c,d.originalLine=u+1,d.originalColumn=l,h&&(d.name=f)),t[t.length-1](d)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw xa=null,n}),xa};const Tt=ba,Yf=A1,vl=Hf.ArraySet,q4=S1,J4=X4,Vf=Symbol("smcInternal");class Fe{constructor(t,n){return t==Vf?Promise.resolve(this):Q4(t,n)}static initialize(t){q4.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return tL(t,n)}static async with(t,n,r){const i=await new Fe(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Fe.prototype._version=3,Fe.GENERATED_ORDER=1,Fe.ORIGINAL_ORDER=2,Fe.GREATEST_LOWER_BOUND=1,Fe.LEAST_UPPER_BOUND=2;class ka extends Fe{constructor(t,n){return super(Vf).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version");let o=Tt.getArg(i,"sources");const a=Tt.getArg(i,"names",[]);let c=Tt.getArg(i,"sourceRoot",null);const u=Tt.getArg(i,"sourcesContent",null),l=Tt.getArg(i,"mappings"),h=Tt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Tt.normalize(c)),o=o.map(String).map(Tt.normalize).map(function(f){return c&&Tt.isAbsolute(c)&&Tt.isAbsolute(f)?Tt.relative(c,f):f}),r._names=vl.fromArray(a.map(String),!0),r._sources=vl.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(f){return Tt.computeSourceURL(c,f,n)}),r.sourceRoot=c,r.sourcesContent=u,r._mappings=l,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,J4().then(f=>(r._wasm=f,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=Tt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new ka(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||Fe.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Tt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case Fe.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Fe.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=Tt.getArg(t,"source");const r=Tt.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Tt.getArg(t,"bias",Fe.GREATEST_LOWER_BOUND);r==null&&(r=Fe.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Tt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Tt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Tt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Tt.getArg(i,"originalLine",null),column:Tt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=Tt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Tt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=Tt.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Tt.getArg(t,"line"),originalColumn:Tt.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Tt.getArg(t,"bias",Fe.GREATEST_LOWER_BOUND);i==null&&(i=Fe.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Tt.getArg(s,"generatedLine",null),column:Tt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}ka.prototype.consumer=Fe;class Z4 extends Fe{constructor(t,n){return super(Vf).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version"),o=Tt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new vl,r._names=new vl,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const u=Tt.getArg(c,"offset"),l=Tt.getArg(u,"line"),h=Tt.getArg(u,"column");if(l<a.line||l===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=u,new Fe(Tt.getArg(c,"map"),n).then(d=>({generatedOffset:{generatedLine:l+1,generatedColumn:h+1},consumer:d}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(Tt.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(Tt.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")},r=Yf.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Tt.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const u=a[c];let l=Tt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(l),l=this._sources.indexOf(l);let h=null;u.name&&(this._names.add(u.name),h=this._names.indexOf(u.name));const f={source:l,generatedLine:u.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:u.generatedColumn+(o.generatedOffset.generatedLine===u.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:u.originalLine,originalColumn:u.originalColumn,name:h};r.push(f),typeof f.originalLine=="number"&&i.push(f)}}}eachMapping(t,n,r){const i=n||null,s=r||Fe.GENERATED_ORDER;let o;switch(s){case Fe.GENERATED_ORDER:o=this._generatedMappings;break;case Fe.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let u=null;return c.source!==null&&(u=this._sources.at(c.source),u=Tt.computeSourceURL(a,u,this._sourceMapURL)),{source:u,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return Yf.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=Tt.getArg(t,"line"),r={source:Tt.getArg(t,"source"),originalLine:n,originalColumn:Tt.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Tt.compareByOriginalPositions,Yf.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function Q4(e,t){let n=e;typeof e=="string"&&(n=Tt.parseSourceMapInput(e));const r=n.sections!=null?new Z4(n,t):new ka(n,t);return Promise.resolve(r)}function tL(e,t){return ka.fromSourceMap(e,t)}var R1={};const eL=g1.SourceMapGenerator,Sl=ba,nL=/(\r?\n)/,rL=10,uo="$$$isSourceNode$$$";let iL=class md{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[uo]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new md,s=t.split(nL);let o=0;const a=function(){const d=m(),p=m()||"";return d+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,u=0,l=null,h;return n.eachMapping(function(d){if(l!==null)if(c<d.generatedLine)f(l,a()),c++,u=0;else{h=s[o]||"";const p=h.substr(0,d.generatedColumn-u);s[o]=h.substr(d.generatedColumn-u),u=d.generatedColumn,f(l,p),l=d;return}for(;c<d.generatedLine;)i.add(a()),c++;u<d.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,d.generatedColumn)),s[o]=h.substr(d.generatedColumn),u=d.generatedColumn),l=d},this),o<s.length&&(l&&f(l,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(d){const p=n.sourceContentFor(d);p!=null&&(r!=null&&(d=Sl.join(r,d)),i.setSourceContent(d,p))}),i;function f(d,p){if(d===null||d.source===void 0)i.add(p);else{const m=r?Sl.join(r,d.source):d.source;i.add(new md(d.originalLine,d.originalColumn,m,p,d.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[uo]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[uo]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[uo]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[uo]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Sl.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][uo]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(Sl.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new eL(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(u,l){n.code+=u,l.source!==null&&l.line!==null&&l.column!==null?((s!==l.source||o!==l.line||a!==l.column||c!==l.name)&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name}),s=l.source,o=l.line,a=l.column,c=l.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,f=u.length;h<f;h++)u.charCodeAt(h)===rL?(n.line++,n.column=0,h+1===f?(s=null,i=!1):i&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name})):n.column++}),this.walkSourceContents(function(u,l){r.setSourceContent(u,l)}),{code:n.code,map:r}}};R1.SourceNode=iL;var sL=R1.SourceNode;let I1=0;const N1=Mr,oL=["Command","lines"];class aL extends nC{constructor(){super(L_,{traceInitPerf:Mr,skipValidations:!Mr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Ot(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Ot(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(da)}])}));Ot(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Ot(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Ot(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Ot(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(o_)}));Ot(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(cf)}));Ot(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(lf)}])}));Ot(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(s_)}));Ot(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(a_),this.SUBRULE(this.words),this.CONSUME(c_)}));Ot(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(so),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Ot(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Ot(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Ot(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Ot(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(mf),this.SUBRULE(this.words)}));Ot(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(w_),this.SUBRULE(this.words)}));Ot(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(gf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Ot(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(yl),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(da)),this.CONSUME4(so),this.CONSUME4(yf)}}])}));Ot(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(yl),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(so),this.CONSUME(yf)}}])}));Ot(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(yl),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Ot(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(so),this.CONSUME(_f),this.CONSUME(gf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ot(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(so),this.CONSUME(_f),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ot(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(v_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(S_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(R_),this.SUBRULE(this.words)}));Ot(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(I_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(N_)}));Ot(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(O_)}));Ot(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(T_)}));Ot(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(A_)}));Ot(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(uf),this.SUBRULE2(this.and_test)})}));Ot(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(ff),this.SUBRULE2(this.not_test)})}));Ot(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(hf),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Ot(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Ot(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(h_)},{ALT:()=>this.CONSUME(f_)},{ALT:()=>this.CONSUME(d_)},{ALT:()=>this.CONSUME(p_)},{ALT:()=>this.CONSUME(m_)},{ALT:()=>this.CONSUME(g_)}])}));Ot(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(uf),this.SUBRULE2(this.and_test_value)})}));Ot(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(ff),this.SUBRULE2(this.not_test_value)})}));Ot(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(hf),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Ot(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Ot(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(df)},{ALT:()=>this.CONSUME(pf)}]),this.SUBRULE(this.term)}));Ot(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Ot(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(__)},{ALT:()=>this.CONSUME(mf)},{ALT:()=>this.CONSUME(b_)},{ALT:()=>this.CONSUME(E_)}]),this.SUBRULE(this.factor)}));Ot(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(df)},{ALT:()=>this.CONSUME(pf)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Ot(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(y_),this.SUBRULE(this.factor)})}));Ot(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Ot(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(l_)},{ALT:()=>this.CONSUME(sn)},{ALT:()=>this.CONSUME(u_)},{ALT:()=>{this.CONSUME(x_),this.SUBRULE(this.expr),this.CONSUME(k_)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=oL.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(I1++).toString().padStart(3),c=s?"font-weight: bold;":"";if(N1&&!this.RECORDING_PHASE){const u=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${u.join(" ")}`,c)}r(),N1&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),I1--},i)}}const ho=new aL;if(rT){const e=ho.getGAstProductions(),t=pC(e);console.info(t)}const cL=ho.getBaseCstVisitorConstructor();var gt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(gt||{}),_s=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(_s||{}),qr=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(qr||{}),Rl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Rl||{});function lL(e){return!!(e!=null&&e.tokenType)}function ar(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class uL extends cL{constructor(){super();Ot(this,"unique",0);Mr&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&lL(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():x(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:ar(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:ar(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:ar(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:ar(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:ar(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,ar(n.token_if,"if"),"",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Ce(),i=Ce();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Ce(),i=Ce();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,ar(n.token_if,"if"),r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Ce(),i=Ce();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Ce(),i=Ce(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Ce(),i=Ce(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Ce();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=ar(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}command_toast(n){const i=ar(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,"toast"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=ar(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=ar(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(ar(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const hL=new uL,Cn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Il="zss.js";function Qt(e,t){return new sL(e.startLine??1,e.startColumn??1,Il,t)}function Xf(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function qf(e){return`'${Xf(e)}'`}function Nl(e){if(e.startsWith('"'))return Nl(e.replaceAll(/(^"|"$)/g,""));const t=Df(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===Bf?`', api.get('${Xf(r.image.substring(1))}'), '`:Xf(r.image)).join("")}'].join('')`}function fo(e){return e.filter(t=>t!==void 0).map(ie)}function O1(e){return Qt(e,"")}function fL(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function He(e,t,n){return Qt(e,[`api.${t}(`,...fL(n,", "),")"])}function dL(e){if(e.type===gt.COMPARE&&e.compare.type===gt.COMPARE_ITEM)switch(e.compare.method){case _s.IS_EQ:return He(e,"isEq",[ie(e.lhs),ie(e.rhs)]);case _s.IS_NOT_EQ:return He(e,"isNotEq",[ie(e.lhs),ie(e.rhs)]);case _s.IS_LESS_THAN:return He(e,"isLessThan",[ie(e.lhs),ie(e.rhs)]);case _s.IS_GREATER_THAN:return He(e,"isGreaterThan",[ie(e.lhs),ie(e.rhs)]);case _s.IS_LESS_THAN_OR_EQ:return He(e,"isLessThanOrEq",[ie(e.lhs),ie(e.rhs)]);case _s.IS_GREATER_THAN_OR_EQ:return He(e,"isGreaterThanOrEq",[ie(e.lhs),ie(e.rhs)])}return Qt(e,"")}function bs(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",ie(n),")"])}function C1(e,t,n){return e.prepend(`api.${t}(`),e.add([ie(n),")"])}function pL(e,t){if(e.type===gt.OPERATOR_ITEM)switch(e.operator){case qr.PLUS:return bs(t,"opPlus",e.rhs);case qr.MINUS:return bs(t,"opMinus",e.rhs);case qr.POWER:return bs(t,"opPower",e.rhs);case qr.MULTIPLY:return bs(t,"opMultiply",e.rhs);case qr.DIVIDE:return bs(t,"opDivide",e.rhs);case qr.MOD_DIVIDE:return bs(t,"opModDivide",e.rhs);case qr.FLOOR_DIVIDE:return bs(t,"opFloorDivide",e.rhs);case qr.UNI_PLUS:return C1(t,"opUniPlus",e.rhs);case qr.UNI_MINUS:return C1(t,"opUniMinus",e.rhs)}return Qt(e,"")}function mL(e){if(e.type===gt.OPERATOR){const t=e.lhs?ie(e.lhs):Qt(e,"");return e.items.forEach(n=>pL(n,t)),t}return Qt(e,"")}function Ol(e,t){return Qt(e,[He(e,"jump",[`${t}`]),"; continue;"])}function ki(e){return Cn.linelookup[e??""]??-1}function Jf(e,t){Cn.linelookup[e]=t}function po(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&(i.done=n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&(i.skip=n);break;case gt.LINE:po(i.stmts,t,n);break}}}function L1(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&Jf(i.done,n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&Jf(i.skip,n);break;case gt.LINE:L1(i.stmts,t,n);break}}}function ie(e){var t;switch(e.type){case gt.PROGRAM:return Qt(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(ie).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Il}`]);case gt.API:return Qt(e,["  ",He(e,e.method,fo(e.words)),`;
`]);case gt.LINE:return Qt(e,[`case ${e.lineindex}:
`,...e.stmts.map(ie).flat(),`  break;
`]);case gt.MARK:return Qt(e,`  // ${e.comment}
`);case gt.GOTO:{const n=ki(e.id);return Qt(e,["  ",Ol(e,n),`
`])}case gt.COUNT:return Qt(e,`${e.index}`);case gt.LITERAL:switch(e.literal){case Rl.NUMBER:return Qt(e,`${e.value}`);case Rl.STRING:return Qt(e,qf(e.value));case Rl.TEMPLATE:return Qt(e,Nl(e.value))}return O1(e);case gt.TEXT:return Qt(e,["  ",He(e,"text",[Nl(e.value)]),`;
`]);case gt.STAT:if(Cn.isfirststat){Cn.isfirststat=!1;const n=e.value.trim().split(" ").map(qf);return Qt(e,["  ",He(e,"stat",n),`;
`])}return Qt(e,`  // skipped ${e.value}
`);case gt.LABEL:{const n=Mt(e.name),r=e.active?"label":"comment";Cn.labels[n]||(Cn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Cn.labels[n].push(i),Qt(e,`  // ${i} '${n}' ${r}
`)}case gt.HYPERLINK:return Qt(e,["  ",He(e,"hyperlink",[Nl(e.text),...fo(e.link)]),`;
`]);case gt.MOVE:{const n=He(e,"command",[qf("go"),fo(e.words)].flat());return e.wait?Qt(e,["  if (",n,`) { continue; };
`]):Qt(e,["  ",n,`;
`])}case gt.COMMAND:return Qt(e,["  if (",He(e,"command",fo(e.words)),`) { continue; };
`]);case gt.IF:{const n=((t=e.block)==null?void 0:t.type)===gt.IF_BLOCK?e.block:void 0;if(x(n)){po([e.check],gt.IF_CHECK,n.skip);const r=Qt(e,ie(e.check));return n.lines.forEach(i=>r.add(ie(i))),L1(n.altlines,gt.ELSE_IF,ki(n.done)),n.altlines.forEach(i=>r.add(ie(i))),r}return Qt(e,ie(e.check))}case gt.IF_CHECK:{const n=ki(e.skip);return n===-1?Qt(e,["  ",He(e,e.method,fo(e.words)),`;
`]):Qt(e,["  if (!",He(e,e.method,fo(e.words)),") { ",Ol(e,n),` }
`])}case gt.ELSE_IF:case gt.ELSE:{const n=Qt(e,"");return e.lines.forEach(r=>n.add(ie(r))),n}case gt.WHILE:{const n=ki(e.loop),r=ki(e.done),i=Qt(e,"");return po(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case gt.REPEAT:{const n=ki(e.loop),r=ki(e.done),i=Qt(e,"");return po(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case gt.WAITFOR:{const n=Qt(e,"");return po(e.lines,gt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(ie(r))}),n}case gt.FOREACH:{const n=ki(e.loop),r=ki(e.done),i=Qt(e,"");return po(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case gt.BREAK:return Qt(e,["  ",Ol(e,e.goto),`
`]);case gt.CONTINUE:return Qt(e,["  ",Ol(e,e.goto),`
`]);case gt.OR:return He(e,"or",e.items.map(ie));case gt.AND:return He(e,"and",e.items.map(ie));case gt.NOT:return He(e,"not",e.items.map(ie));case gt.COMPARE:return dL(e);case gt.OPERATOR:return mL(e);case gt.EXPR:return He(e,"expr",e.words.map(ie));default:return console.error("<unsupported node>",e.type,e),O1(e)}}function Jr(e){if(x(e))switch(e.type===gt.LINE&&++Cn.lineindex,e.lineindex=Cn.lineindex,e.type){case gt.PROGRAM:e.lines.forEach(Jr);break;case gt.LINE:e.stmts.forEach(Jr);break;case gt.MARK:Jf(e.id,e.lineindex);break;case gt.IF:Jr(e.check),Jr(e.block);break;case gt.IF_BLOCK:e.lines.forEach(Jr),e.altlines.forEach(Jr);break;case gt.ELSE_IF:e.lines.forEach(Jr);break;case gt.ELSE:case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.WAITFOR:e.lines.forEach(Jr);break;case gt.MOVE:case gt.COMMAND:case gt.IF_CHECK:e.words.forEach(Jr);break}}function gL(e){return Cn.labels={},Cn.internal=1,Cn.lineindex=0,Cn.isfirststat=!0,Jr(e),{...ie(e).toStringWithSourceMap({file:`${Il}.map`}),...Cn}}function M1(e){return ne(e)?e.length>0?1:0:e??0}function yL(e){return`${e}_chip`}function U1(e=""){return`vm:${e??""}`}function _L(e,t,n){var u,l;const r=yL(e),i=Es(r);let s;const o=Xe(Object.entries(n.labels??{}));(!ne(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((u=n.errors)==null?void 0:u.length)??0)!==0?1:0);function a(h,f){k.words=f;const d=L4(t,h);return x(d)?d(c,f):h!=="send"?a("send",[h,...f]):0}const c={halt(){ML(r)},id(){return e},set(h,f){const[d,p]=U4(t,c,h,f);if(d)return p},get(h){const[f,d]=M4(t,c,h);if(f)return d},tick(h){const f=Ct(i.ps)?i.ps:0,d=f%h===0;if(i.ps=f+1,d===!1)return!1;if(c.shouldtick()===!1)return m1(t,c),!1;i.lc=0,i.ys=0,k.get=c.get,F4(t,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){le(j,"crash",p.message),i.es=1}return m1(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Ct(i.lc)?++i.lc>li.HALT_AT_COUNT:!0},hm(){if(ne(i.mg)&&ne(i.lb)){const[h]=i.mg;if(x(h))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)return p.find(m=>Ct(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(h){i.ec=h},sy(){return!!i.ys||c.shouldhalt()},send(h,f,d,p){j.emit(`${U1(h)}:${f}`,d,p)},lock(h){i.lk=h},unlock(){i.lk=""},message(h){i.lk&&h.sender!==i.lk||(i.mg=[h.target,h.data,h.sender,h.player])},zap(h){if(ne(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h){const m=p.findIndex(w=>w>0);m>=0&&(p[m]*=-1)}}},restore(h){if(ne(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)for(let m=0;m<p.length;m++)p[f]=Math.abs(p[f])}},getcase(){i.ec=Ct(i.ec)?i.ec:1;const h=c.hm();if(h&&ne(i.mg)){const[,f,d,p]=i.mg;c.set("sender",d),x(f)&&c.set("arg",f),St(p)&&(c.set("player",p),k.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=h}return i.ec},nextcase(){const h=Ct(i.ec)?i.ec:1;return i.ec=h+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(h){const f=Gk.parse(h),[d]=f.filter(p=>p.fileName===Il);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(h){return a("text",[h])},stat(...h){return a("stat",h)},hyperlink(...h){return a("hyperlink",h)},command(...h){if(h.length===0)return 0;const[f,...d]=h;return a(Mt(xe(f)),d)},if(...h){const[f,d]=it(h,0,[Y.ANY]),p=M1(f);return p&&d<h.length&&c.command(...h.slice(d)),p?1:0},try(...h){const[,f]=it(h,0,[Y.DIR]),d=c.command("go",...h);return d&&f<h.length&&c.command(...h.slice(f)),d?1:0},take(...h){const[f,d,p]=it(h,0,[Y.NAME,Y.ANY]),m=Ct(d),w=m?p:1,E=c.get(f),T=m?d:1;if(!Ct(E))return w<h.length&&c.command(...h.slice(w)),1;const v=E-T;return v<0?(w<h.length&&c.command(...h.slice(w)),1):(c.set(f,v),0)},give(...h){const[f,d,p]=it(h,0,[Y.NAME,Y.ANY]),m=Ct(d),w=m?p:1,E=c.get(f),T=m?d:1,v=E===void 0?1:0;return v&&w<h.length&&c.command(...h.slice(w)),c.set(f,jo(E,0)+T),v},repeatstart(h,...f){const[d,p]=it(f,0,[Y.NUMBER]),m=`repeatcount${h}`,w=`repeatwords${h}`;i[m]=d,i[w]=p<f.length?f.slice(p):void 0},repeat(h){const f=`repeatcount${h}`,d=`repeatwords${h}`;if(!Ct(i[f]))return 0;const p=i[f];i[f]=p-1;const m=p>0,w=i[d];return m&&ne(w)&&c.command(...w),m?1:0},foreachstart(h,...f){const[d,p,m,w]=it(f,0,[Y.NAME,Y.NUMBER,Y.NUMBER,Y.MAYBE_NUMBER]);let E=Math.min(p,m),T=Math.max(p,m);const v=(w??0)||1;if(v<0){const I=E;E=T,T=I}return c.set(d,E-v),0},foreach(h,...f){const[d,p,m,w,E]=it(f,0,[Y.NAME,Y.NUMBER,Y.NUMBER,Y.MAYBE_NUMBER]);let T=Math.min(p,m),v=Math.max(p,m);const I=(w??0)||1;if(I<0){const N=T;T=v,v=N}let U=c.get(d);!Ct(U)||U<T||U>v?U=T:U+=I;const S=U<=v?1:0;return S&&(c.set(d,U),E<f.length&&c.command(...f.slice(E))),S},waitfor(...h){const[f]=it(h,0,[Y.ANY]),d=M1(f);return d||c.yield(),d?1:0},or(...h){let f=0;for(let d=0;d<h.length;){const[p,m]=it(h,d,[Y.ANY]);if(f=p,f)break;d=m}return f},and(...h){let f=0;for(let d=0;d<h.length;){const[p,m]=it(h,d,[Y.ANY]);if(f=p,!f)break;d=m}return f},not(...h){const[f]=it(h,0,[Y.ANY]);return f?0:1},expr(...h){const[f]=it(h,0,[Y.ANY]);return f},isEq(h,f){const[d]=it([h],0,[Y.ANY]),[p]=it([f],0,[Y.ANY]);return typeof d=="object"||typeof p=="object"?Wb(d,p)?1:0:d===p?1:0},isNotEq(h,f){return this.isEq(h,f)?0:1},isLessThan(h,f){const[d]=it([h],0,[Y.NUMBER]),[p]=it([f],0,[Y.NUMBER]);return d<p?1:0},isGreaterThan(h,f){const[d]=it([h],0,[Y.NUMBER]),[p]=it([f],0,[Y.NUMBER]);return d>p?1:0},isLessThanOrEq(h,f){const[d]=it([h],0,[Y.NUMBER]),[p]=it([f],0,[Y.NUMBER]);return d<=p?1:0},isGreaterThanOrEq(h,f){const[d]=it([h],0,[Y.NUMBER]),[p]=it([f],0,[Y.NUMBER]);return d>=p?1:0},opPlus(h,f){const[d]=it([h],0,[Y.ANY]),[p]=it([f],0,[Y.ANY]);return d+p},opMinus(h,f){const[d]=it([h],0,[Y.ANY]),[p]=it([f],0,[Y.ANY]);return d-p},opPower(h,f){const[d]=it([h],0,[Y.NUMBER]),[p]=it([f],0,[Y.NUMBER]);return Math.pow(d,p)},opMultiply(h,f){const[d]=it([h],0,[Y.NUMBER]),[p]=it([f],0,[Y.NUMBER]);return d*p},opDivide(h,f){const[d]=it([h],0,[Y.NUMBER]),[p]=it([f],0,[Y.NUMBER]);return d/p},opModDivide(h,f){const[d]=it([h],0,[Y.NUMBER]),[p]=it([f],0,[Y.NUMBER]);return d%p},opFloorDivide(h,f){const[d]=it([h],0,[Y.NUMBER]),[p]=it([f],0,[Y.NUMBER]);return Math.floor(d/p)},opUniPlus(h){const[f]=it([h],0,[Y.NUMBER]);return+f},opUniMinus(h){const[f]=it([h],0,[Y.NUMBER]);return-f}};return s=(l=n.code)==null?void 0:l.call(n,c),c}function Zf(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];ne(r)?r.forEach(i=>{t.push(Zf(i))}):t.push(Zf(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function bL(e){const t=bf(`${e}
`);if(t.errors.length>0)return t;ho.input=t.tokens;const n=ho.program();if(ho.errors.length>0)return{tokens:t.tokens,errors:ho.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=hL.go(n);return r?(Zf(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const Qf=Object.getPrototypeOf(function*(){}).constructor;function EL(e,t){const n=`compile-${e}`;console.time(n);const r=bL(t);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=gL(r.ast);if(i.code){iT&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Qf("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Qf("api"," ")}}}return{...r,...i,source:"",code:new Qf("api"," ")}}function wL(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=EL(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return x(s)?s.isended():!0},halt(i){const s=t[i];return x(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];x(o)&&o.set("arg",s)},tick(i,s,o,a,c){var l;let u=t[i];if(!x(t[i])){const h=n(a,c);if(u=t[i]=_L(i,s,h),(l=h.errors)!=null&&l.length){const[f]=h.errors,d=((f==null?void 0:f.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((E,T)=>[E,T]);p.slice(d-5,d).forEach(([E,T])=>{le(j,"build",`$grey${T+1} $grey${E}`)});const[m,w]=p[d]??[];if(St(m)&&x(w)){const E=(f.column??1)-1,T=E+f.length,v=E<m.length?m:`${m}*`,I=v.substring(0,E),U=v.substring(E,T),S=v.substring(T);le(j,"build",`$red${w+1} $grey${I}$red${U}$grey${S}`)}return f.message.split(`
`).forEach(E=>{le(j,"build",E)}),!1}}return!!(u!=null&&u.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Tr(i.target),a=t[s];if(x(a)){const c={...i,target:o};a.message(c)}}};return r}let F1=0;function xL(){switch(F1++){case 0:return Wt.BLUE;case 1:return Wt.GREEN;case 2:return Wt.CYAN;case 3:return Wt.RED;case 4:return Wt.PURPLE;case 5:return Wt.YELLOW;default:return F1=0,Wt.WHITE}}const De=new Do,En={},Cl={};function B1(e,t,n,r,i=0){const s=`tiles:${e}:${t}`;return x(En[s])||(En[s]=Vk(e,t,n,r,i)),En[s]}function kL(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return x(Cl[s])||(Cl[s]=Xk(e,t,n)),Cl[s].id=i,Cl[s]}function TL(e,t){const n=`sprites:${e}:${t}`;return x(En[n])||(En[n]=qk(e,t)),En[n]}function AL(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return x(En[s])||(En[s]=Jk(e,t,n,r,i)),En[s]}function P1(e,t,n,r){const i=`media:${e}:${t}`;x(En[i])||(En[i]=Zk(e,t,n,r));const s=En[i];return s.mime=n,s.media=r,s}function vL(e,t){const n=`control:${e}:${t}`;return x(En[n])||(En[n]=Qk(e,t)),En[n]}const Yi=.4;function D1(e,t){const n=[];De.x=e-Yi,De.y=t-Yi,n.push(De.angle()),De.x=e+Yi,De.y=t-Yi,n.push(De.angle()),De.x=e-Yi,De.y=t+Yi,n.push(De.angle()),De.x=e+Yi,De.y=t+Yi,n.push(De.angle());const r=Math.round(Qu(Math.min(...n))),i=Math.round(Qu(Math.max(...n)));return Math.abs(r-i)>180?[i,r]:[r,i]}function SL(e,t,n,r,i){var S;if(!x(r)||!x(r.terrain)||!x(r.objects))return[];const s=[];let o=t;const a=o===0,c=Vt,u=Se,l=a?Wt.BLACK:Wt.ONCLEAR,h=B1(e,o++,c,u,l);s.push(h);const f=o++,d=TL(e,f);d.sprites=[],s.push(d);const p=r.isdark?1:0,m=AL(e,o++,c,u,p);s.push(m),m.alphas.fill(p);const w=B1(e,o++,c,u,Wt.ONCLEAR);s.push(w),w.char.fill(0);const E={...$f(Vt,Se,xL(),Wt.ONCLEAR),...w},T=vL(e,o++);i&&s.push(T);for(let N=0;N<r.terrain.length;++N){const P=r.terrain[N],L=K_(n,P,0,Wt.BLACK,Wt.ONCLEAR);h.char[N]=L.char,h.color[N]=L.color,h.bg[N]=L.bg}const v=Object.values(r.objects??{});for(let N=0;N<v.length;++N){const P=v[N];if(x(P.removed))continue;const L=P.id??"",V=K_(n,P,1,Wt.WHITE,Wt.BLACK),Z=kL(e,f,L,N);if(Z.x=P.x??0,Z.y=P.y??0,Z.char=V.char,Z.color=V.color,Z.bg=V.bg,d.sprites.push(Z),p){if(V.light>0){const C=[],R=Pn(Math.round(V.light),1,10),_=R*.5,B=Zr(r,Z),X=1/_;if(m.alphas[B]=0,R>1)for(let D=1;D<=R;++D)for(let lt=Z.y-D;lt<=Z.y+D;++lt)for(let et=Z.x-D;et<=Z.x+D;++et){if(et===Z.x&&lt===Z.y)continue;De.x=et-Z.x,De.y=lt-Z.y;const ft=De.length();if(ft>R)continue;const G=Zr(r,{x:et,y:lt});if(G===-1)continue;const W=Math.round(Qu(De.angle()));let bt=0;for(let At=0;At<C.length;++At){const kt=C[At];W>=kt[0]&&W<=kt[1]&&(bt=Math.max(bt,kt[2]))}m.alphas[G]=Math.min(m.alphas[G],bt+(ft<_?0:(ft-_)*X)),m.alphas[G]=Pn(m.alphas[G],0,1);const ot=Mn(r,((S=r.lookup)==null?void 0:S[G])??"");if(x(ot)){const At=[...D1(De.x,De.y),.25];C.push(At)}const ct=r.terrain[G],Lt=Ei(n,ct),ee=(ct==null?void 0:ct.collision)??(Lt==null?void 0:Lt.collision);if(rh(Ht.ISBULLET,ee)){const At=[...D1(De.x,De.y),1];let kt=0;for(kt=0;kt<C.length;++kt){const zt=C[kt];if(zt[1]>zt[0]&&At[1]>=zt[0]&&At[0]<=zt[1]&&At[2]>=1&&zt[2]>=1){C[kt]=[Math.min(At[0],zt[0]),Math.max(At[1],zt[1]),1];break}}kt===C.length&&C.push(At)}}}else if(As(L)){const C=Zr(r,Z);m.alphas[C]=0}}if(St(P.tickertext)&&Ct(P.tickertime)&&P.tickertext.length){const C=Vt,R=r1(P.tickertext,C,Se-1),_=(R==null?void 0:R.measuredwidth)??1,B=P.x??0,X=P.y??0,D=X<Se*.5;E.x=B-Math.floor(_*.5),E.y=X+(D?1:-1),E.x+_>Vt&&(E.x=Vt-_),E.x<0&&(E.x=0),n1(P.tickertext,E,!0)}L===e&&(T.focusx=Z.x,T.focusy=Z.y,T.focusid=L)}const I=he(Ft.MAIN),U=wi(I,Ft.MAIN);if(St(U.palette)){const N=On(I,Et.PALETTE,U.palette),P=un(N);x(P==null?void 0:P.bits)&&s.push(P1(e,o++,"image/palette",Array.from(P.bits)))}if(St(U.charset)){const N=On(I,Et.CHARSET,U.charset),P=un(N);x(P==null?void 0:P.bits)&&s.push(P1(e,o++,"image/charset",Array.from(P.bits)))}return s}const Wn=wL();var Ft=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.CONTENT="content",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Ft||{});const Ae={halt:!1,session:Ce(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function RL(){return Ae.session}function cr(){return Ae.operator}function IL(e){Ae.operator=e}function NL(e){Ae.halt=e}function OL(){return Ae.halt}function mo(){return[...Ae.books.values()]}function CL(){const[e]=Ae.books.values();return e}function wr(e){const t=Mt(e);return Ae.books.get(e)??mo().find(n=>n.name===t)}function Ll(e,t){x(wr(t))&&(Ae.software[e]=t)}function he(e){return wr(Ae.software[e])}function $1(e){const t=D_([]);return St(e)&&(t.name=e),td(t),ei(j,`created [book] ${t.name}`),t}function LL(e){let t=wr(e);return x(t)||(t=D_([]),t.name=e),td(t),ei(j,`created [book] ${t.name}`),t}function Ln(e,t){let n=x(t)?LL(t):he(e);return x(n)||(x(n)||(n=CL()),x(n)||(n=$1(t)),x(n)&&ei(j,`opened [book] ${n.name} for ${e}`)),Ll(e,n.id),n}function Vi(e,t,n){return Tf(Ln(e),n,t)}function Es(e){const t=Ln("main");return wi(t,e)}function j1(){const e=Ln("main");return wi(e,"main")}function ML(e){const t=Ln("main");return G_(t,e)}function UL(e,t){Ae.books.clear(),e.forEach(r=>{Ae.books.set(r.id,r),r.name==="main"&&(Ae.software.main=r.id)});const n=wr(t);if(x(n)&&Ll("main",n.id),!Ae.software.main){const r=Ae.books.values().next();r.value&&(Ae.software.main=r.value.id)}}function td(e){return Ae.books.set(e.id,e),e.id}function FL(e){const t=wr(e);t&&Ae.books.delete(t.id)}function BL(e){if(!St(e)||!e)return le(j,"login",`failed for playerid ==>${e}<==`,e);const t=he("main");if(!x(t))return le(j,"login:main","login failed to find book 'main'",e);const n=ys(t,e);if(x(n))return!0;const r=Hr(t,Et.BOARD,"title");if(r.length===0)return le(j,"login:title","login failed to find board with 'title' stat",e);const i=ma(t,"player");if(!x(i))return le(j,"login:player","login failed to find object type 'player'",e);const s=z0(e,r),o=un(s);if(x(o)){const a=P_(s,"startx"),c=P_(s,"starty"),u=Ct(a)?a:Math.round(Vt*.5),l=Ct(c)?c:Math.round(Se*.5),h=i.name??"player",f=cd(o,{x:u,y:l},h,e);if(x(f==null?void 0:f.id))return f.player=e,bl(t,e,o.id),!0}return!1}function PL(e){const t=he("main"),n=ys(t,e);bl(t,e,""),Nf(t,n,Mn(n,e)),V1(n,e),Wn.halt(e),G_(t,e)}function lr(e){const t=he("main");return ys(t,e)}function DL(e){const t=he("main"),n=IC(t,e),r=ys(t,e),i=Mn(r,e);return n&&x(i)}function $L(e){const t=he("main"),n=Sf(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;As(c)&&x(e[c])===!1&&(e[c]=0,bl(t,c,i.id))}}}function z1(e){Wn.message(e)}function Ta(e,t,n,r){const i=Fr(e);St(t.id)&&j.emit("vm:touched",[t.id,i,n],r)}function ed(e,t,n,r){if(!x(n))return!1;const i=Y_(e,t,n,r);if(x(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const o=Hr(e,Et.BOARD,(t==null?void 0:t.exitwest)??"");if(o.length){const a=ln(o);ga(e,n.id??"",a.id,{x:Vt-1,y:r.y})}}else if(r.x>=Vt){const o=Hr(e,Et.BOARD,(t==null?void 0:t.exiteast)??"");if(o.length){const a=ln(o);ga(e,n.id??"",a.id,{x:0,y:r.y})}}else if(r.y<0){const o=Hr(e,Et.BOARD,(t==null?void 0:t.exitnorth)??"");if(o.length){const a=ln(o);ga(e,n.id??"",a.id,{x:r.x,y:Se-1})}}else if(r.y>=Se){const o=Hr(e,Et.BOARD,(t==null?void 0:t.exitsouth)??"");if(o.length){const a=ln(o);ga(e,n.id??"",a.id,{x:r.x,y:0})}}}else Ta(i,n,"thud",void 0);if(n.kind==="player")Ta(n,i,"touch",n.id);else if(n.collision===Ht.ISBULLET){const o=As(n.party),a=As(i.id);o!==a?Ta(n,i,"shot",n.party):Ta(i,n,"thud",void 0)}else Ta(n,i,"bump",void 0);const s=Ei(e,i);return i.destructible??(s==null?void 0:s.destructible)?(x(i==null?void 0:i.id)?Yr(k.book,k.board,i,k.timestamp):kr(t,{x:r.x,y:r.y}),!0):!1}return!0}function W1(e,t,n,r,i=SE){var h;if(!x(e)||!x(t)||!x(n))return;const s={...k};k.book=e,k.board=t,k.element=n,k.elementid=n.id??"",k.elementisplayer=As(k.elementid);const o=k.element.player??Ae.operator;k.elementfocus=k.elementisplayer?k.elementid:o;const a=Ei(e,n),c=n.cycle??(a==null?void 0:a.cycle)??i,u=n.id??"",l=Mt(n.name??((h=n.kinddata)==null?void 0:h.name)??"");if(Wn.tick(u,Hi.RUNTIME,Ct(c)?c:i,l,r),Ct(n==null?void 0:n.tickertime)&&k.timestamp-n.tickertime>Ca*5&&(n.tickertime=0,n.tickertext=""),k.elementisplayer){const f=Es(k.elementid);Ct(f.inputcurrent)&&(f.inputcurrent=0)}Gn(s).forEach(f=>{k[f]=s[f]})}function jL(e,t){Ae.loaders.set(e,t)}function zL(e){Wn.halt(e)}function WL(){const e=Wn.ids();for(let n=0;n<e.length;++n)Wn.halt(e[n]);const t=he("main");x(t)&&(t.flags={})}function KL(){const e=he("main");if(!x(e))return;const t=e.timestamp+1,n=li.HALT_AT_COUNT;li.HALT_AT_COUNT=n*2,Ae.loaders.forEach((i,s)=>{const o={...k};k.timestamp=e.timestamp,k.book=e,k.board=void 0,k.element=void 0,k.elementid=s,k.elementisplayer=!1,k.elementfocus=Ae.operator;const a=l4(s);x(a)&&Wn.arg(s,a),Wn.tick(s,Hi.LOADER,1,"loader",i),Wn.isended(s)&&(Wn.halt(s),Ae.loaders.delete(s)),Gn(o).forEach(c=>{k[c]=o[c]})}),li.HALT_AT_COUNT=n,e.timestamp=t,k.timestamp=t;const r=Sf(e);for(let i=0;i<r.length;++i){const s=r[i],o=UC(e,s,t);for(let a=0;a<o.length;++a){const{id:c,type:u,code:l,object:h}=o[a];u===Et.ERROR?Wn.halt(c):W1(e,s,h,l)}}}function nd(e,t){const n=he("main");if(!x(n))return;function r(a,c){for(let u=0;u<a.length;++u){const l=a[u];if(x(l.id)){const h=`${U1(l.id)}:${c}`;j.emit(h,t)}}}const{target:i,path:s}=Tr(e),o=Sf(n);for(let a=0;a<o.length;++a){const c=o[a];switch(Mt(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(sm(c,[i]),s);break}}}}function GL(e,t=""){var s;const n=Ln("main");if(!x(n))return;const r=`${e}_cli`;k.timestamp=n.timestamp,k.book=n,k.board=ys(n,e),k.element=Mn(k.board,e),k.elementid=((s=k.element)==null?void 0:s.id)??"",k.elementisplayer=!0,k.elementfocus=k.elementid||e;const i=li.HALT_AT_COUNT;li.HALT_AT_COUNT=i*8,Nd(j,"running",n.timestamp,r,t),Wn.once(r,Hi.CLI,"cli",t),li.HALT_AT_COUNT=i}function Ml(e){var o;const t=Ln("main"),n=bi(t,e);if(!x(t)||!x(n)||!x(k.element))return;const r=`${e}_run`,i=Mt(k.element.name??((o=k.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";Wn.once(r,Hi.RUNTIME,i,s)}function HL(e){const t=he("main"),n=ys(t,e),r=[];if(!x(t)||!x(n))return r;const i=oo(t,n.over??""),s=oo(t,n.under??""),o=[i,n,s];let a=0;for(let c=0;c<o.length;++c){const u=o[c],l=SL(e,a,t,u,u===n);a+=l.length,r.push(...l)}return r}function fn(e){var r,i,s,o,a;const t=k.words[e],n=e+1;if(a1(t)){const[c,u]=wl(e);if(x(c))return[c,u]}if(n4(t)){const[c,u]=l1(e);if(x(c))return[c,u]}if(Z0(t)){const[c,u]=gc(e);if(x(c))return[c,u]}if(St(t)&&Mt(t)==="rnd"){const[c,u]=fn(n),[l,h]=fn(u);return Ct(c)&&Ct(l)?[Mi(c,l),h]:Ct(c)?[Mi(0,c),u]:[Mi(0,1),n]}if(G1(t)){const[c,u]=id(e);if(x(c))return[c,u]}if(!x(t))return[void 0,e];if(Ct(t)||ne(t))return[t,n];if(St(t)){const c=Mt(t),u=(r=k.get)==null?void 0:r.call(k,t);if(x(u))return[u,n];switch(c){case"aligned":case"alligned":{const l=_c(k.board,k.element,k.elementfocus);return!x(k.element)||!x(l)?[0,n]:[k.element.x===l.x||k.element.y===l.y?1:0,n]}case"contact":{const l=_c(k.board,k.element,k.elementfocus);if(!x(k.element)||!x(l))return[0,n];const h=(l.x??0)-(((i=k.element)==null?void 0:i.x)??0),f=(l.y??0)-(((s=k.element)==null?void 0:s.y)??0);return[h===0&&Math.abs(f)<2||f===0&&Math.abs(h)<2?1:0,n]}case"blocked":{const[l,h]=it(k.words,n,[Y.DIR]);return[OC(k.book,k.board,k.element,l)?1:0,h]}case"any":{const[l,h]=it(k.words,n,[Y.KIND]),f=yc(l)??"",d=Xs(k.board,f);return[im(d,l).length?1:0,h]}case"rnd":return[Mi(0,1),n];case"abs":{const[l,h]=it(k.words,n,[Y.NUMBER]);return[Math.abs(l),h]}case"ceil":{const[l,h]=it(k.words,n,[Y.NUMBER]);return[Math.ceil(l),h]}case"floor":{const[l,h]=it(k.words,n,[Y.NUMBER]);return[Math.floor(l),h]}case"round":{const[l,h]=it(k.words,n,[Y.NUMBER]);return[Math.round(l),h]}case"clamp":{const[l,h,f,d]=it(k.words,n,[Y.NUMBER,Y.NUMBER,Y.NUMBER]);return[Pn(l,h,f),d]}case"min":{const l=[];for(let h=n;h<k.words.length;){const[f,d]=fn(h);ne(f)&&!xr(f)&&!Xr(f)&&!xi(f)&&!Dn(f)&&l.push(...f),h=d,l.push(f)}return[Math.min(...l),k.words.length]}case"max":{const l=[];for(let h=n;h<k.words.length;){const[f,d]=fn(h);ne(f)&&!xr(f)&&!Xr(f)&&!xi(f)&&!Dn(f)&&l.push(...f),h=d,l.push(f)}return[Math.max(...l),k.words.length]}case"pick":{const l=[];for(let h=n;h<k.words.length;){const[f,d]=fn(h);ne(f)&&!xr(f)&&!Xr(f)&&!xi(f)&&!Dn(f)&&l.push(...f),h=d,l.push(f)}return[ln(l),k.words.length]}case"pickwith":{const l=[],[h,f]=it(k.words,n,[Y.NUMBER_OR_STRING]);for(let d=f;d<k.words.length;){const[p,m]=fn(d);ne(p)&&!xr(p)&&!Xr(p)&&!xi(p)&&!Dn(p)&&l.push(...p),d=m,l.push(p)}return[z0(`${h}`,l),k.words.length]}case"random":{const[l,h,f]=it(k.words,n,[Y.NUMBER,Y.MAYBE_NUMBER]);return[Mi(l,h??0),f]}case"randomwith":{const[l,h,f,d]=it(k.words,n,[Y.NUMBER_OR_STRING,Y.NUMBER,Y.MAYBE_NUMBER]);return[$0(`${l}`,h,f??0),d]}case"run":{const[l,h]=it(k.words,n,[Y.NAME]);return Ml(l),[(o=k.get)==null?void 0:o.call(k,"arg"),h]}case"runwith":{const[l,h,f]=it(k.words,n,[Y.ANY,Y.NAME]);return x(k.element)&&(k.element.arg=l),Ml(h),[(a=k.get)==null?void 0:a.call(k,"arg"),f]}}}return[t,n]}function go(e){return x(e)&&x(e.x)&&x(e.y)}function Ye(e,t){switch(t){case yt.NORTH:--e.y;break;case yt.SOUTH:++e.y;break;case yt.WEST:--e.x;break;case yt.EAST:++e.x;break}return e}function Xi(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return yt.WEST;if(n>0)return yt.EAST;if(r<0)return yt.NORTH;if(r>0)return yt.SOUTH}const rd={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST"};function xr(e){return ne(e)&&K1(e[0])}function K1(e){return x(yt[e])&&St(e)}function YL(e){const t=yt[e];return x(t)?t:yt.IDLE}function G1(e){if(St(e))return rd[Mt(e)]}function H1(e){if(xr(e))return e;if(K1(e))return[e];const t=G1(e);if(x(t))return[t]}function Y1(e){const t=k.words[e],n=H1(t);if(xr(n))return[n,e+1];const[r,i]=fn(e),s=H1(r);return xr(s)?[s,i]:[void 0,e]}function id(e){const t=[];let[n,r]=Y1(e);for(;xr(n);){if(t.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=it(k.words,r,[Y.NUMBER,Y.NUMBER]);t.push(o,a),r=c}const[i,s]=Y1(r);n=i,r=s}return t.length?[t,r]:[void 0,e]}function VL(){return new Array(Vt*Se).map(()=>{})}function XL(e=Vl){const t={terrain:VL(),objects:{},id:""};return e(t)}var sd=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e))(sd||{});function qL(e){return Js(e,sd,{terrain:t=>t.map(Ac),objects:t=>Object.values(t).filter(n=>!n.removed).map(Ac),id:Ue,named:Ue,lookup:Ue,codepage:Ue})}function JL(e){return Ho(e,sd,{terrain:t=>t.map(vc),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=vc(t[r]);x(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Zr(e,t){return!x(e)||!x(t==null?void 0:t.x)||!x(t==null?void 0:t.y)||t.x<0||t.x>=Vt||t.y<0||t.y>=Se?-1:t.x+t.y*Vt}function Kn(e,t){const n=Zr(e,t);if(n<0||!x(e==null?void 0:e.lookup))return;const r=Mn(e,e.lookup[n]??"");return x(r)?r:e.terrain[n]}function ZL(e,t){const n=Mn(e,t);if(x(n))return n;const r=parseFloat(t),i=R0(isNaN(r)?-1:r,Vt);return od(e,i.x,i.y)}function od(e,t,n){return(t>=0&&t<Vt)??(n>=0&&n<Se)?e==null?void 0:e.terrain[t+n*Vt]:void 0}function kr(e,t){if(!x(e)||!x(t)||!x(t.x)||!x(t.y)||t.x<0||t.x>=Vt||t.y<0||t.y>=Se)return;const n=Xe(t),r=t.x+t.y*Vt;return e.terrain[r]=n,e.terrain[r]}function ad(e,t){if(!x(e)||!x(t))return;const n=Xe(t);return n.id=n.id??Ce(),e.objects[n.id]=n,e.objects[n.id]}function QL(e,t,n){return kr(e,{...t,kind:n})}function cd(e,t,n,r){return ad(e,{...t,kind:n,id:r})}function Mn(e,t){if(e)return e.objects[t]}function ld(e,t,n,r,i){if(!x(e)||!x(t))return{x:0,y:0};const s={x:t.x??0,y:t.y??0},o={x:t.lx??s.x,y:t.ly??s.y},a=Xi(o,s),c=Vt-1,u=Se-1;for(let l=0;l<r.length;++l){const h=YL(r[l]);switch(h){case yt.IDLE:break;case yt.NORTH:case yt.SOUTH:case yt.WEST:case yt.EAST:Ye(s,h);break;case yt.BY:{const[f,d]=r.slice(l+1);Ct(f)&&Ct(d)&&(s.x=Pn(s.x+f,0,c),s.y=Pn(s.y+d,0,u)),l+=2;break}case yt.AT:{const[f,d]=r.slice(l+1);Ct(f)&&Ct(d)&&(s.x=Pn(f,0,c),s.y=Pn(d,0,u)),l+=2;break}case yt.FLOW:Ye(s,a);break;case yt.SEEK:{const f=tM(e,t,n);go(f)&&Ye(s,Xi(i,f));break}case yt.RNDNS:Ye(s,ln(yt.NORTH,yt.SOUTH));break;case yt.RNDNE:Ye(s,ln(yt.NORTH,yt.EAST));break;case yt.RND:Ye(s,ln(yt.NORTH,yt.SOUTH,yt.WEST,yt.EAST));break;case yt.CW:case yt.CCW:case yt.OPP:case yt.RNDP:{const f=ld(e,t,n,r.slice(l+1),i);switch(s.x=i.x,s.y=i.y,h){case yt.CW:switch(Xi(i,f)){case yt.NORTH:Ye(s,yt.EAST);break;case yt.SOUTH:Ye(s,yt.WEST);break;case yt.EAST:Ye(s,yt.SOUTH);break;case yt.WEST:Ye(s,yt.NORTH);break}break;case yt.CCW:switch(Xi(i,f)){case yt.NORTH:Ye(s,yt.WEST);break;case yt.SOUTH:Ye(s,yt.EAST);break;case yt.EAST:Ye(s,yt.NORTH);break;case yt.WEST:Ye(s,yt.SOUTH);break}break;case yt.OPP:switch(Xi(i,f)){case yt.NORTH:Ye(s,yt.SOUTH);break;case yt.SOUTH:Ye(s,yt.NORTH);break;case yt.EAST:Ye(s,yt.WEST);break;case yt.WEST:Ye(s,yt.EAST);break}break;case yt.RNDP:switch(Xi(i,f)){case yt.NORTH:case yt.SOUTH:s.x+=ln(-1,1);break;case yt.WEST:case yt.EAST:s.y+=ln(-1,1);break}break}break}}}return s}function V1(e,t){return x(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function tM(e,t,n){if(!x(e)||!x(t))return;const r=e.objects[n];if(x(r))return r;if(go(t))return om(t,Xs(e,"player"))}const k={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var Y=(e=>(e[e.CATEGORY=0]="CATEGORY",e[e.COLLISION=1]="COLLISION",e[e.COLOR=2]="COLOR",e[e.KIND=3]="KIND",e[e.DIR=4]="DIR",e[e.NAME=5]="NAME",e[e.NUMBER=6]="NUMBER",e[e.STRING=7]="STRING",e[e.NUMBER_OR_STRING=8]="NUMBER_OR_STRING",e[e.MAYBE_CATEGORY=9]="MAYBE_CATEGORY",e[e.MAYBE_COLLISION=10]="MAYBE_COLLISION",e[e.MAYBE_COLOR=11]="MAYBE_COLOR",e[e.MAYBE_KIND=12]="MAYBE_KIND",e[e.MAYBE_DIR=13]="MAYBE_DIR",e[e.MAYBE_NAME=14]="MAYBE_NAME",e[e.MAYBE_NUMBER=15]="MAYBE_NUMBER",e[e.MAYBE_STRING=16]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=17]="MAYBE_NUMBER_OR_STRING",e[e.ANY=18]="ANY",e))(Y||{});function $e(e,t,n){throw console.info(n,k.element,k.elementid,k.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function it(e,t,n){var o,a,c,u;const r=k.words;k.words=e;const i=[];let s=t;for(let l=0;l<n.length;++l)switch(n[l]){case 0:{const[h,f]=wl(s);Xr(h)||$e("terrain or object",h,e),s=f,i.push(h);break}case 1:{const[h,f]=l1(s);xi(h)||$e("solid, walk, swim, bullet, walkable or swimmable",h,e),s=f,i.push(h);break}case 2:{const[h,f]=gc(s);Dn(h)||$e("color",h,e),s=f,i.push(h);break}case 3:{const[h,f]=em(s);Vs(h)?(s=f,i.push(h)):$e("kind",h,e);break}case 4:{const[h,f]=id(s);if(xr(h)){const d={x:((o=k.element)==null?void 0:o.x)??0,y:((a=k.element)==null?void 0:a.y)??0},p=x(k.board)&&x(k.element)?ld(k.board,k.element,k.elementfocus,h,d):d;s=f,i.push(p)}else $e("direction",h,e);break}case 5:{const h=k.words[s];St(h)||$e("string",h,e),++s,i.push(h);break}case 6:{const[h,f]=fn(s);if(St(h)){const d=parseFloat(h);Ct(d)?i.push(d):$e("number",h,e)}else Ct(h)?i.push(h):$e("number",h,e);s=f;break}case 7:{const[h,f]=fn(s);St(h)||$e("string",h,e),s=f,i.push(h);break}case 8:{const[h,f]=fn(s);let d=h;if(St(d)){const p=parseFloat(d);Ct(p)&&(d=p)}else Ct(d)||$e("number or string",d,e);s=f,i.push(d);break}case 9:{const[h,f]=wl(s);h!==void 0&&!Xr(h)&&$e("optional terrain or object",h,e),s=f,i.push(h);break}case 10:{const[h,f]=wl(s);h!==void 0&&!xi(h)&&$e("optional solid, walk, swim, bullet, walkable or swimmable",h,e),s=f,i.push(h);break}case 11:{const[h,f]=gc(s);h!==void 0&&!Dn(h)&&$e("optional color",h,e),s=f,i.push(h);break}case 12:{const[h,f]=em(s);h!==void 0&&!Vs(h)&&$e("optional kind",h,e),s=f,i.push(h);break}case 13:{const[h,f]=id(s);if(xr(h)){const d=((c=k.element)==null?void 0:c.x)??0,p=((u=k.element)==null?void 0:u.y)??0,m={x:d,y:p},w=k.board?ld(k.board,k.element,k.elementfocus,h,m):m;s=f,i.push(w)}else h===void 0?(s=f,i.push(void 0)):$e("optional direction",h,e);break}case 14:{const h=k.words[s];h!==void 0&&!St(h)&&$e("optional string",h,e),++s,i.push(h);break}case 15:{const[h,f]=fn(s);if(St(h)){const d=parseFloat(h);Ct(d)?i.push(d):$e("optional number",h,e)}else Ct(h)||h===void 0?i.push(h):$e("optional number",h,e);s=f;break}case 16:{const[h,f]=fn(s);h!==void 0&&!St(h)&&$e("optional string",h,e),s=f,i.push(h);break}case 17:{const[h,f]=fn(s);let d=h;if(St(d)){const p=parseFloat(d);Ct(p)&&(d=p)}else d!==void 0&&!Ct(d)&&$e("number or string",d,e);s=f,i.push(d);break}case 18:{const[h,f]=fn(s);s=f,i.push(h);break}}return k.words=r,[...i,s]}const Ul={},yo={};function ud(){return{id:Ce(),layers:[],scroll:[],sidebar:[]}}const eM=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),nM=new Set(["tx","text"]),rM={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},X1={};let q1=e=>{let t=X1[e];return x(t)||(X1[e]=t=ud()),t};function iM(e){q1=e}function wn(e){return q1(e)}function hd(e){return x(Ul[e])||(Ul[e]=[]),Ul[e]}function sM(e){const t=wn(e);t.scroll=[]}function oM(e,t,n){Object.values(yo).forEach(r=>{if(r[t]!==void 0){const i=G0(e.id(),t);Ct(n)&&Nk(i,n),St(n)&&Ok(i,n)}})}function Qr(e){const t=hd(e);return Ul[e]=[],t}function oe(e,t){hd(e).push(t)}function Bt(e,t,n,r,i=()=>0,s=Vl){const o=[t,n,...r],a=Mt(`${o[3]}`),c={...k};function u(l,h){x(h)&&h!==i(l)&&(k.board=c.board,k.element=c.element,k.elementfocus=c.elementfocus,s(l,h))}if(eM.has(a)){const l=`${o[2]}`;yo[t]=yo[t]??{};const h=i(l)??rM[a];if(yo[t][l]===void 0){const f=G0(t,l);Ct(h)&&Ik(f,h),St(h)&&Yu(f,h),nM.has(a)?yo[t][l]=v0(f,d=>{u(l,d)}):yo[t][l]=Ck(f,d=>{u(l,d)})}}hd(e).push(o)}iM(e=>{if(As(e)){const t=he(Ft.MAIN),n=wi(t,Ft.GADGETSTORE);let r=n[e];return x(r)||(n[e]=r=ud()),r}return ud()});const fd=Ss("gadgetserver",["tock"],e=>{if(!fd.session(e))return;const t=he(Ft.MAIN),n=(t==null?void 0:t.activelist)??[],r=wi(t,Ft.GADGETSYNC);switch(e.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=wn(s);o.layers=HL(s);const a=r[s]??{},c=Sd(a,o);c.length&&(r[s]=Xe(o),Zb(fd,c,s))}break;case"desync":e.player&&Jb(fd,wn(e.player),e.player);break;case"clearscroll":e.player&&sM(e.player);break;case"clearplayer":if(e.player){const i=he(Ft.MAIN),s=wi(i,Ft.GADGETSTORE);delete s[e.player];const o=wi(i,Ft.GADGETSYNC);delete o[e.player]}break}});function Fl(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var J1={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(u,l){if(!i[u]){if(!r[u]){var h=typeof Fl=="function"&&Fl;if(!l&&h)return h(u,!0);if(a)return a(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var d=i[u]={exports:{}};r[u][0].call(d.exports,function(p){var m=r[u][1][p];return o(m||p)},d,d.exports,n,r,i,s)}return i[u].exports}for(var a=typeof Fl=="function"&&Fl,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var u,l,h,f,d,p,m,w=[],E=0,T=c.length,v=T,I=s.getTypeOf(c)!=="string";E<c.length;)v=T-E,h=I?(u=c[E++],l=E<T?c[E++]:0,E<T?c[E++]:0):(u=c.charCodeAt(E++),l=E<T?c.charCodeAt(E++):0,E<T?c.charCodeAt(E++):0),f=u>>2,d=(3&u)<<4|l>>4,p=1<v?(15&l)<<2|h>>6:64,m=2<v?63&h:64,w.push(a.charAt(f)+a.charAt(d)+a.charAt(p)+a.charAt(m));return w.join("")},i.decode=function(c){var u,l,h,f,d,p,m=0,w=0,E="data:";if(c.substr(0,E.length)===E)throw new Error("Invalid base64 input, it looks like a data url.");var T,v=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&v--,c.charAt(c.length-2)===a.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=o.uint8array?new Uint8Array(0|v):new Array(0|v);m<c.length;)u=a.indexOf(c.charAt(m++))<<2|(f=a.indexOf(c.charAt(m++)))>>4,l=(15&f)<<4|(d=a.indexOf(c.charAt(m++)))>>2,h=(3&d)<<6|(p=a.indexOf(c.charAt(m++))),T[w++]=u,d!==64&&(T[w++]=l),p!==64&&(T[w++]=h);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function u(l,h,f,d,p){this.compressedSize=l,this.uncompressedSize=h,this.crc32=f,this.compression=d,this.compressedContent=p}u.prototype={getContentWorker:function(){var l=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return l.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(l,h,f){return l.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(f)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],u=0;u<256;u++){a=u;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;c[u]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var m=f;m<p;m++)u=u>>>8^d[255&(u^l[m])];return-1^u}(0|c,a,a.length,0):function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var m=f;m<p;m++)u=u>>>8^d[255&(u^l.charCodeAt(m))];return-1^u}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),u=s?"uint8array":"array";function l(h,f){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=f,this.meta={}}i.magic="\b\0",a.inherits(l,c),l.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,h.data),!1)},l.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(f){h.push({data:f,meta:h.meta})}},i.compressWorker=function(h){return new l("Deflate",h)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(d,p){var m,w="";for(m=0;m<p;m++)w+=String.fromCharCode(255&d),d>>>=8;return w}function o(d,p,m,w,E,T){var v,I,U=d.file,S=d.compression,N=T!==u.utf8encode,P=a.transformTo("string",T(U.name)),L=a.transformTo("string",u.utf8encode(U.name)),V=U.comment,Z=a.transformTo("string",T(V)),C=a.transformTo("string",u.utf8encode(V)),R=L.length!==U.name.length,_=C.length!==V.length,B="",X="",D="",lt=U.dir,et=U.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(ft.crc32=d.crc32,ft.compressedSize=d.compressedSize,ft.uncompressedSize=d.uncompressedSize);var G=0;p&&(G|=8),N||!R&&!_||(G|=2048);var W=0,bt=0;lt&&(W|=16),E==="UNIX"?(bt=798,W|=function(ct,Lt){var ee=ct;return ct||(ee=Lt?16893:33204),(65535&ee)<<16}(U.unixPermissions,lt)):(bt=20,W|=function(ct){return 63&(ct||0)}(U.dosPermissions)),v=et.getUTCHours(),v<<=6,v|=et.getUTCMinutes(),v<<=5,v|=et.getUTCSeconds()/2,I=et.getUTCFullYear()-1980,I<<=4,I|=et.getUTCMonth()+1,I<<=5,I|=et.getUTCDate(),R&&(X=s(1,1)+s(l(P),4)+L,B+="up"+s(X.length,2)+X),_&&(D=s(1,1)+s(l(Z),4)+C,B+="uc"+s(D.length,2)+D);var ot="";return ot+=`
\0`,ot+=s(G,2),ot+=S.magic,ot+=s(v,2),ot+=s(I,2),ot+=s(ft.crc32,4),ot+=s(ft.compressedSize,4),ot+=s(ft.uncompressedSize,4),ot+=s(P.length,2),ot+=s(B.length,2),{fileRecord:h.LOCAL_FILE_HEADER+ot+P+B,dirRecord:h.CENTRAL_FILE_HEADER+s(bt,2)+ot+s(Z.length,2)+"\0\0\0\0"+s(W,4)+s(w,4)+P+B+Z}}var a=n("../utils"),c=n("../stream/GenericWorker"),u=n("../utf8"),l=n("../crc32"),h=n("../signature");function f(d,p,m,w){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=w,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,c),f.prototype.push=function(d){var p=d.meta.percent||0,m=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,c.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-w-1))/m:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var p=this.streamFiles&&!d.file.dir;if(p){var m=o(d,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var p=this.streamFiles&&!d.file.dir,m=o(d,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(w){return h.DATA_DESCRIPTOR+s(w.crc32,4)+s(w.compressedSize,4)+s(w.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-d,w=function(E,T,v,I,U){var S=a.transformTo("string",U(I));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(E,2)+s(E,2)+s(T,4)+s(v,4)+s(S.length,2)+S}(this.dirRecords.length,m,d,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var p=this;return d.on("data",function(m){p.processChunk(m)}),d.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),d.on("error",function(m){p.error(m)}),this},f.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var p=this._sources;if(!c.prototype.error.call(this,d))return!1;for(var m=0;m<p.length;m++)try{p[m].error(d)}catch{}return!0},f.prototype.lock=function(){c.prototype.lock.call(this);for(var d=this._sources,p=0;p<d.length;p++)d[p].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,u){var l=new o(c.streamFiles,u,c.platform,c.encodeFileName),h=0;try{a.forEach(function(f,d){h++;var p=function(T,v){var I=T||v,U=s[I];if(!U)throw new Error(I+" is not a valid compression method !");return U}(d.options.compression,c.compression),m=d.options.compressionOptions||c.compressionOptions||{},w=d.dir,E=d.date;d._compressWorker(p,m).withStreamInfo("file",{name:f,dir:w,date:E,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(l)}),l.entriesCount=h}catch(f){l.error(f)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),u=n("./stream/Crc32Probe"),l=n("./nodejsUtils");function h(f){return new o.Promise(function(d,p){var m=f.decompressed.getContentWorker().pipe(new u);m.on("error",function(w){p(w)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}r.exports=function(f,d){var p=this;return d=s.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(m){var w=new c(d);return w.load(m),w}).then(function(m){var w=[o.Promise.resolve(m)],E=m.files;if(d.checkCRC32)for(var T=0;T<E.length;T++)w.push(h(E[T]));return o.Promise.all(w)}).then(function(m){for(var w=m.shift(),E=w.files,T=0;T<E.length;T++){var v=E[T],I=v.fileNameStr,U=s.resolve(v.fileNameStr);p.file(U,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:d.createFolders}),v.dir||(p.file(U).unsafeOriginalName=I)}return w.zipComment.length&&(p.comment=w.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,u){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(u)}s.inherits(a,o),a.prototype._bindStream=function(c){var u=this;(this._stream=c).pause(),c.on("data",function(l){u.push({data:l,meta:{percent:0}})}).on("error",function(l){u.isPaused?this.generatedError=l:u.error(l)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,u){s.call(this,c),this._helper=a;var l=this;a.on("data",function(h,f){l.push(h)||l._helper.pause(),u&&u(f)}).on("error",function(h){l.emit("error",h)}).on("end",function(){l.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof tn<"u",newBufferFrom:function(s,o){if(tn.from&&tn.from!==Uint8Array.from)return tn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new tn(s,o)},allocBuffer:function(s){if(tn.alloc)return tn.alloc(s);var o=new tn(s);return o.fill(0),o},isBuffer:function(s){return tn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(U,S,N){var P,L=a.getTypeOf(S),V=a.extend(N||{},l);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(U=E(U)),V.createFolders&&(P=w(U))&&T.call(this,P,!0);var Z=L==="string"&&V.binary===!1&&V.base64===!1;N&&N.binary!==void 0||(V.binary=!Z),(S instanceof h&&S.uncompressedSize===0||V.dir||!S||S.length===0)&&(V.base64=!1,V.binary=!0,S="",V.compression="STORE",L="string");var C=null;C=S instanceof h||S instanceof c?S:p.isNode&&p.isStream(S)?new m(U,S):a.prepareContent(U,S,V.binary,V.optimizedBinaryString,V.base64);var R=new f(U,C,V);this.files[U]=R}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),u=n("./stream/StreamHelper"),l=n("./defaults"),h=n("./compressedObject"),f=n("./zipObject"),d=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),w=function(U){U.slice(-1)==="/"&&(U=U.substring(0,U.length-1));var S=U.lastIndexOf("/");return 0<S?U.substring(0,S):""},E=function(U){return U.slice(-1)!=="/"&&(U+="/"),U},T=function(U,S){return S=S!==void 0?S:l.createFolders,U=E(U),this.files[U]||s.call(this,U,null,{dir:!0,createFolders:S}),this.files[U]};function v(U){return Object.prototype.toString.call(U)==="[object RegExp]"}var I={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(U){var S,N,P;for(S in this.files)P=this.files[S],(N=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&U(N,P)},filter:function(U){var S=[];return this.forEach(function(N,P){U(N,P)&&S.push(P)}),S},file:function(U,S,N){if(arguments.length!==1)return U=this.root+U,s.call(this,U,S,N),this;if(v(U)){var P=U;return this.filter(function(V,Z){return!Z.dir&&P.test(V)})}var L=this.files[this.root+U];return L&&!L.dir?L:null},folder:function(U){if(!U)return this;if(v(U))return this.filter(function(L,V){return V.dir&&U.test(L)});var S=this.root+U,N=T.call(this,S),P=this.clone();return P.root=N.name,P},remove:function(U){U=this.root+U;var S=this.files[U];if(S||(U.slice(-1)!=="/"&&(U+="/"),S=this.files[U]),S&&!S.dir)delete this.files[U];else for(var N=this.filter(function(L,V){return V.name.slice(0,U.length)===U}),P=0;P<N.length;P++)delete this.files[N[P].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(U){var S,N={};try{if((N=a.extend(U||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=N.type.toLowerCase(),N.compression=N.compression.toUpperCase(),N.type==="binarystring"&&(N.type="string"),!N.type)throw new Error("No output type specified.");a.checkSupport(N.type),N.platform!=="darwin"&&N.platform!=="freebsd"&&N.platform!=="linux"&&N.platform!=="sunos"||(N.platform="UNIX"),N.platform==="win32"&&(N.platform="DOS");var P=N.comment||this.comment||"";S=d.generateWorker(this,N,P)}catch(L){(S=new c("error")).error(L)}return new u(S,N.type||"string",N.mimeType)},generateAsync:function(U,S){return this.generateInternalStream(U).accumulate(S)},generateNodeStream:function(U,S){return(U=U||{}).type||(U.type="nodebuffer"),this.generateInternalStream(U).toNodejsStream(S)}};r.exports=I},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===u&&this.data[f+2]===l&&this.data[f+3]===h)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.readData(4);return c===f[0]&&u===f[1]&&l===f[2]&&h===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,u=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)u=(u<<8)+this.byteAt(c);return this.index+=a,u},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),u=n("./NodeBufferReader"),l=n("./Uint8ArrayReader");r.exports=function(h){var f=s.getTypeOf(h);return s.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new u(h):o.uint8array?new l(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(l){u.dataIsReady=!0,u.data=l,u.max=l&&l.length||0,u.type=s.getTypeOf(l),u.isPaused||u._tickAndRepeat()},function(l){u.error(l)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,u);break;case"uint8array":c=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":c=this.data.slice(this.index,u)}return this.index=u,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),u=n("../support"),l=n("../external"),h=null;if(u.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(p,m){return new l.Promise(function(w,E){var T=[],v=p._internalType,I=p._outputType,U=p._mimeType;p.on("data",function(S,N){T.push(S),m&&m(N)}).on("error",function(S){T=[],E(S)}).on("end",function(){try{var S=function(N,P,L){switch(N){case"blob":return s.newBlob(s.transformTo("arraybuffer",P),L);case"base64":return c.encode(P);default:return s.transformTo(N,P)}}(I,function(N,P){var L,V=0,Z=null,C=0;for(L=0;L<P.length;L++)C+=P[L].length;switch(N){case"string":return P.join("");case"array":return Array.prototype.concat.apply([],P);case"uint8array":for(Z=new Uint8Array(C),L=0;L<P.length;L++)Z.set(P[L],V),V+=P[L].length;return Z;case"nodebuffer":return tn.concat(P);default:throw new Error("concat : unsupported type '"+N+"'")}}(v,T),U);w(S)}catch(N){E(N)}T=[]}).resume()})}function d(p,m,w){var E=m;switch(m){case"blob":case"arraybuffer":E="uint8array";break;case"base64":E="string"}try{this._internalType=E,this._outputType=m,this._mimeType=w,s.checkSupport(E),this._worker=p.pipe(new o(E)),p.lock()}catch(T){this._worker=new a("error"),this._worker.error(T)}}d.prototype={accumulate:function(p){return f(this,p)},on:function(p,m){var w=this;return p==="data"?this._worker.on(p,function(E){m.call(w,E.data,E.meta)}):this._worker.on(p,function(){s.delay(m,arguments,w)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof tn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),u=new Array(256),l=0;l<256;l++)u[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;u[254]=u[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function f(){c.call(this,"utf-8 encode")}i.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):function(p){var m,w,E,T,v,I=p.length,U=0;for(T=0;T<I;T++)(64512&(w=p.charCodeAt(T)))==55296&&T+1<I&&(64512&(E=p.charCodeAt(T+1)))==56320&&(w=65536+(w-55296<<10)+(E-56320),T++),U+=w<128?1:w<2048?2:w<65536?3:4;for(m=o.uint8array?new Uint8Array(U):new Array(U),T=v=0;v<U;T++)(64512&(w=p.charCodeAt(T)))==55296&&T+1<I&&(64512&(E=p.charCodeAt(T+1)))==56320&&(w=65536+(w-55296<<10)+(E-56320),T++),w<128?m[v++]=w:(w<2048?m[v++]=192|w>>>6:(w<65536?m[v++]=224|w>>>12:(m[v++]=240|w>>>18,m[v++]=128|w>>>12&63),m[v++]=128|w>>>6&63),m[v++]=128|63&w);return m}(d)},i.utf8decode=function(d){return o.nodebuffer?s.transformTo("nodebuffer",d).toString("utf-8"):function(p){var m,w,E,T,v=p.length,I=new Array(2*v);for(m=w=0;m<v;)if((E=p[m++])<128)I[w++]=E;else if(4<(T=u[E]))I[w++]=65533,m+=T-1;else{for(E&=T===2?31:T===3?15:7;1<T&&m<v;)E=E<<6|63&p[m++],T--;1<T?I[w++]=65533:E<65536?I[w++]=E:(E-=65536,I[w++]=55296|E>>10&1023,I[w++]=56320|1023&E)}return I.length!==w&&(I.subarray?I=I.subarray(0,w):I.length=w),s.applyFromCharCode(I)}(d=s.transformTo(o.uint8array?"uint8array":"array",d))},s.inherits(h,c),h.prototype.processChunk=function(d){var p=s.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var w=function(T,v){var I;for((v=v||T.length)>T.length&&(v=T.length),I=v-1;0<=I&&(192&T[I])==128;)I--;return I<0||I===0?v:I+u[T[I]]>v?I:v}(p),E=p;w!==p.length&&(o.uint8array?(E=p.subarray(0,w),this.leftOver=p.subarray(w,p.length)):(E=p.slice(0,w),this.leftOver=p.slice(w,p.length))),this.push({data:i.utf8decode(E),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(f,c),f.prototype.processChunk=function(d){this.push({data:i.utf8encode(d.data),meta:d.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function u(m){return m}function l(m,w){for(var E=0;E<m.length;++E)w[E]=255&m.charCodeAt(E);return w}n("setimmediate"),i.newBlob=function(m,w){i.checkSupport("blob");try{return new Blob([m],{type:w})}catch{try{var E=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return E.append(m),E.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,w,E){var T=[],v=0,I=m.length;if(I<=E)return String.fromCharCode.apply(null,m);for(;v<I;)w==="array"||w==="nodebuffer"?T.push(String.fromCharCode.apply(null,m.slice(v,Math.min(v+E,I)))):T.push(String.fromCharCode.apply(null,m.subarray(v,Math.min(v+E,I)))),v+=E;return T.join("")},stringifyByChar:function(m){for(var w="",E=0;E<m.length;E++)w+=String.fromCharCode(m[E]);return w},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function f(m){var w=65536,E=i.getTypeOf(m),T=!0;if(E==="uint8array"?T=h.applyCanBeUsed.uint8array:E==="nodebuffer"&&(T=h.applyCanBeUsed.nodebuffer),T)for(;1<w;)try{return h.stringifyByChunk(m,E,w)}catch{w=Math.floor(w/2)}return h.stringifyByChar(m)}function d(m,w){for(var E=0;E<m.length;E++)w[E]=m[E];return w}i.applyFromCharCode=f;var p={};p.string={string:u,array:function(m){return l(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return l(m,new Uint8Array(m.length))},nodebuffer:function(m){return l(m,a.allocBuffer(m.length))}},p.array={string:f,array:u,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return f(new Uint8Array(m))},array:function(m){return d(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:u,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:u,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:u},i.transformTo=function(m,w){if(w=w||"",!m)return w;i.checkSupport(m);var E=i.getTypeOf(w);return p[E][m](w)},i.resolve=function(m){for(var w=m.split("/"),E=[],T=0;T<w.length;T++){var v=w[T];v==="."||v===""&&T!==0&&T!==w.length-1||(v===".."?E.pop():E.push(v))}return E.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var w,E,T="";for(E=0;E<(m||"").length;E++)T+="\\x"+((w=m.charCodeAt(E))<16?"0":"")+w.toString(16).toUpperCase();return T},i.delay=function(m,w,E){setImmediate(function(){m.apply(E||null,w||[])})},i.inherits=function(m,w){function E(){}E.prototype=w.prototype,m.prototype=new E},i.extend=function(){var m,w,E={};for(m=0;m<arguments.length;m++)for(w in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],w)&&E[w]===void 0&&(E[w]=arguments[m][w]);return E},i.prepareContent=function(m,w,E,T,v){return c.Promise.resolve(w).then(function(I){return s.blob&&(I instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(I))!==-1)&&typeof FileReader<"u"?new c.Promise(function(U,S){var N=new FileReader;N.onload=function(P){U(P.target.result)},N.onerror=function(P){S(P.target.error)},N.readAsArrayBuffer(I)}):I}).then(function(I){var U=i.getTypeOf(I);return U?(U==="arraybuffer"?I=i.transformTo("uint8array",I):U==="string"&&(v?I=o.decode(I):E&&T!==!0&&(I=function(S){return l(S,s.uint8array?new Uint8Array(S.length):new Array(S.length))}(I))),I):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),u=n("./support");function l(h){this.files=[],this.loadOptions=h}l.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(h)+")")}},isSignature:function(h,f){var d=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===f;return this.reader.setIndex(d),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),f=u.uint8array?"uint8array":"array",d=o.transformTo(f,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,f,d,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[h]={id:h,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,f;for(h=0;h<this.files.length;h++)f=this.files[h],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var f=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var p=f-d;if(0<p)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),u=n("./utf8"),l=n("./compressions"),h=n("./support");function f(d,p){this.options=d,this.loadOptions=p}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var p,m;if(d.skip(22),this.fileNameLength=d.readInt(2),m=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(w){for(var E in l)if(Object.prototype.hasOwnProperty.call(l,E)&&l[E].magic===w)return l[E];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var p=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(p),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var p,m,w,E=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<E;)p=d.readInt(2),m=d.readInt(2),w=d.readData(m),this.extraFields[p]={id:p,length:m,value:w};d.setIndex(E)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var E=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(E)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,w){this.name=p,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=m,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),u=n("./compressedObject"),l=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,w="string";try{if(!p)throw new Error("No output type specified.");var E=(w=p.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),m=this._decompressWorker();var T=!this._dataBinary;T&&!E&&(m=m.pipe(new c.Utf8EncodeWorker)),!T&&E&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(v){(m=new l("error")).error(v)}return new o(m,w,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof u&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new c.Utf8EncodeWorker)),u.createWorkerFrom(w,p,m)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)s.prototype[h[d]]=f;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var u=0,l=new c(p),h=s.document.createTextNode("");l.observe(h,{characterData:!0}),o=function(){h.data=u=++u%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var f=new s.MessageChannel;f.port1.onmessage=p,o=function(){f.port2.postMessage(0)}}var d=[];function p(){var m,w;a=!0;for(var E=d.length;E;){for(w=d,d=[],m=-1;++m<E;)w[m]();E=d.length}a=!1}r.exports=function(m){d.push(m)!==1||a||o()}}).call(this,typeof xn<"u"?xn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],u=["FULFILLED"],l=["PENDING"];function h(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,E!==o&&m(this,E)}function f(E,T,v){this.promise=E,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function d(E,T,v){s(function(){var I;try{I=T(v)}catch(U){return a.reject(E,U)}I===E?a.reject(E,new TypeError("Cannot resolve promise with itself")):a.resolve(E,I)})}function p(E){var T=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof T=="function")return function(){T.apply(E,arguments)}}function m(E,T){var v=!1;function I(N){v||(v=!0,a.reject(E,N))}function U(N){v||(v=!0,a.resolve(E,N))}var S=w(function(){T(U,I)});S.status==="error"&&I(S.value)}function w(E,T){var v={};try{v.value=E(T),v.status="success"}catch(I){v.status="error",v.value=I}return v}(r.exports=h).prototype.finally=function(E){if(typeof E!="function")return this;var T=this.constructor;return this.then(function(v){return T.resolve(E()).then(function(){return v})},function(v){return T.resolve(E()).then(function(){throw v})})},h.prototype.catch=function(E){return this.then(null,E)},h.prototype.then=function(E,T){if(typeof E!="function"&&this.state===u||typeof T!="function"&&this.state===c)return this;var v=new this.constructor(o);return this.state!==l?d(v,this.state===u?E:T,this.outcome):this.queue.push(new f(v,E,T)),v},f.prototype.callFulfilled=function(E){a.resolve(this.promise,E)},f.prototype.otherCallFulfilled=function(E){d(this.promise,this.onFulfilled,E)},f.prototype.callRejected=function(E){a.reject(this.promise,E)},f.prototype.otherCallRejected=function(E){d(this.promise,this.onRejected,E)},a.resolve=function(E,T){var v=w(p,T);if(v.status==="error")return a.reject(E,v.value);var I=v.value;if(I)m(E,I);else{E.state=u,E.outcome=T;for(var U=-1,S=E.queue.length;++U<S;)E.queue[U].callFulfilled(T)}return E},a.reject=function(E,T){E.state=c,E.outcome=T;for(var v=-1,I=E.queue.length;++v<I;)E.queue[v].callRejected(T);return E},h.resolve=function(E){return E instanceof this?E:a.resolve(new this(o),E)},h.reject=function(E){var T=new this(o);return a.reject(T,E)},h.all=function(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=E.length,I=!1;if(!v)return this.resolve([]);for(var U=new Array(v),S=0,N=-1,P=new this(o);++N<v;)L(E[N],N);return P;function L(V,Z){T.resolve(V).then(function(C){U[Z]=C,++S!==v||I||(I=!0,a.resolve(P,U))},function(C){I||(I=!0,a.reject(P,C))})}},h.race=function(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=E.length,I=!1;if(!v)return this.resolve([]);for(var U=-1,S=new this(o);++U<v;)N=E[U],T.resolve(N).then(function(P){I||(I=!0,a.resolve(S,P))},function(P){I||(I=!0,a.reject(S,P))});var N;return S}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),u=n("./zlib/zstream"),l=Object.prototype.toString,h=0,f=-1,d=0,p=8;function m(E){if(!(this instanceof m))return new m(E);this.options=o.assign({level:f,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},E||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var v=s.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(v!==h)throw new Error(c[v]);if(T.header&&s.deflateSetHeader(this.strm,T.header),T.dictionary){var I;if(I=typeof T.dictionary=="string"?a.string2buf(T.dictionary):l.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(v=s.deflateSetDictionary(this.strm,I))!==h)throw new Error(c[v]);this._dict_set=!0}}function w(E,T){var v=new m(T);if(v.push(E,!0),v.err)throw v.msg||c[v.err];return v.result}m.prototype.push=function(E,T){var v,I,U=this.strm,S=this.options.chunkSize;if(this.ended)return!1;I=T===~~T?T:T===!0?4:0,typeof E=="string"?U.input=a.string2buf(E):l.call(E)==="[object ArrayBuffer]"?U.input=new Uint8Array(E):U.input=E,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new o.Buf8(S),U.next_out=0,U.avail_out=S),(v=s.deflate(U,I))!==1&&v!==h)return this.onEnd(v),!(this.ended=!0);U.avail_out!==0&&(U.avail_in!==0||I!==4&&I!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(U.output,U.next_out))):this.onData(o.shrinkBuf(U.output,U.next_out)))}while((0<U.avail_in||U.avail_out===0)&&v!==1);return I===4?(v=s.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===h):I!==2||(this.onEnd(h),!(U.avail_out=0))},m.prototype.onData=function(E){this.chunks.push(E)},m.prototype.onEnd=function(E){E===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},i.Deflate=m,i.deflate=w,i.deflateRaw=function(E,T){return(T=T||{}).raw=!0,w(E,T)},i.gzip=function(E,T){return(T=T||{}).gzip=!0,w(E,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),u=n("./zlib/messages"),l=n("./zlib/zstream"),h=n("./zlib/gzheader"),f=Object.prototype.toString;function d(m){if(!(this instanceof d))return new d(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||m&&m.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&!(15&w.windowBits)&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var E=s.inflateInit2(this.strm,w.windowBits);if(E!==c.Z_OK)throw new Error(u[E]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(m,w){var E=new d(w);if(E.push(m,!0),E.err)throw E.msg||u[E.err];return E.result}d.prototype.push=function(m,w){var E,T,v,I,U,S,N=this.strm,P=this.options.chunkSize,L=this.options.dictionary,V=!1;if(this.ended)return!1;T=w===~~w?w:w===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?N.input=a.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?N.input=new Uint8Array(m):N.input=m,N.next_in=0,N.avail_in=N.input.length;do{if(N.avail_out===0&&(N.output=new o.Buf8(P),N.next_out=0,N.avail_out=P),(E=s.inflate(N,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&L&&(S=typeof L=="string"?a.string2buf(L):f.call(L)==="[object ArrayBuffer]"?new Uint8Array(L):L,E=s.inflateSetDictionary(this.strm,S)),E===c.Z_BUF_ERROR&&V===!0&&(E=c.Z_OK,V=!1),E!==c.Z_STREAM_END&&E!==c.Z_OK)return this.onEnd(E),!(this.ended=!0);N.next_out&&(N.avail_out!==0&&E!==c.Z_STREAM_END&&(N.avail_in!==0||T!==c.Z_FINISH&&T!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=a.utf8border(N.output,N.next_out),I=N.next_out-v,U=a.buf2string(N.output,v),N.next_out=I,N.avail_out=P-I,I&&o.arraySet(N.output,N.output,v,I,0),this.onData(U)):this.onData(o.shrinkBuf(N.output,N.next_out)))),N.avail_in===0&&N.avail_out===0&&(V=!0)}while((0<N.avail_in||N.avail_out===0)&&E!==c.Z_STREAM_END);return E===c.Z_STREAM_END&&(T=c.Z_FINISH),T===c.Z_FINISH?(E=s.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===c.Z_OK):T!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(N.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=d,i.inflate=p,i.inflateRaw=function(m,w){return(w=w||{}).raw=!0,p(m,w)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var l=u.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)l.hasOwnProperty(h)&&(c[h]=l[h])}}return c},i.shrinkBuf=function(c,u){return c.length===u?c:c.subarray?c.subarray(0,u):(c.length=u,c)};var o={arraySet:function(c,u,l,h,f){if(u.subarray&&c.subarray)c.set(u.subarray(l,l+h),f);else for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){var u,l,h,f,d,p;for(u=h=0,l=c.length;u<l;u++)h+=c[u].length;for(p=new Uint8Array(h),u=f=0,l=c.length;u<l;u++)d=c[u],p.set(d,f),f+=d.length;return p}},a={arraySet:function(c,u,l,h,f){for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function l(h,f){if(f<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,f));for(var d="",p=0;p<f;p++)d+=String.fromCharCode(h[p]);return d}c[254]=c[254]=1,i.string2buf=function(h){var f,d,p,m,w,E=h.length,T=0;for(m=0;m<E;m++)(64512&(d=h.charCodeAt(m)))==55296&&m+1<E&&(64512&(p=h.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),m++),T+=d<128?1:d<2048?2:d<65536?3:4;for(f=new s.Buf8(T),m=w=0;w<T;m++)(64512&(d=h.charCodeAt(m)))==55296&&m+1<E&&(64512&(p=h.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),m++),d<128?f[w++]=d:(d<2048?f[w++]=192|d>>>6:(d<65536?f[w++]=224|d>>>12:(f[w++]=240|d>>>18,f[w++]=128|d>>>12&63),f[w++]=128|d>>>6&63),f[w++]=128|63&d);return f},i.buf2binstring=function(h){return l(h,h.length)},i.binstring2buf=function(h){for(var f=new s.Buf8(h.length),d=0,p=f.length;d<p;d++)f[d]=h.charCodeAt(d);return f},i.buf2string=function(h,f){var d,p,m,w,E=f||h.length,T=new Array(2*E);for(d=p=0;d<E;)if((m=h[d++])<128)T[p++]=m;else if(4<(w=c[m]))T[p++]=65533,d+=w-1;else{for(m&=w===2?31:w===3?15:7;1<w&&d<E;)m=m<<6|63&h[d++],w--;1<w?T[p++]=65533:m<65536?T[p++]=m:(m-=65536,T[p++]=55296|m>>10&1023,T[p++]=56320|1023&m)}return l(T,p)},i.utf8border=function(h,f){var d;for((f=f||h.length)>h.length&&(f=h.length),d=f-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?f:d+c[h[d]]>f?d:f}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var u=65535&s|0,l=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;l=l+(u=u+o[c++]|0)|0,--h;);u%=65521,l%=65521}return u|l<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,u){var l=s,h=u+c;o^=-1;for(var f=u;f<h;f++)o=o>>>8^l[255&(o^a[f])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),u=n("./crc32"),l=n("./messages"),h=0,f=4,d=0,p=-2,m=-1,w=4,E=2,T=8,v=9,I=286,U=30,S=19,N=2*I+1,P=15,L=3,V=258,Z=V+L+1,C=42,R=113,_=1,B=2,X=3,D=4;function lt(b,st){return b.msg=l[st],st}function et(b){return(b<<1)-(4<b?9:0)}function ft(b){for(var st=b.length;0<=--st;)b[st]=0}function G(b){var st=b.state,nt=st.pending;nt>b.avail_out&&(nt=b.avail_out),nt!==0&&(o.arraySet(b.output,st.pending_buf,st.pending_out,nt,b.next_out),b.next_out+=nt,st.pending_out+=nt,b.total_out+=nt,b.avail_out-=nt,st.pending-=nt,st.pending===0&&(st.pending_out=0))}function W(b,st){a._tr_flush_block(b,0<=b.block_start?b.block_start:-1,b.strstart-b.block_start,st),b.block_start=b.strstart,G(b.strm)}function bt(b,st){b.pending_buf[b.pending++]=st}function ot(b,st){b.pending_buf[b.pending++]=st>>>8&255,b.pending_buf[b.pending++]=255&st}function ct(b,st){var nt,F,M=b.max_chain_length,H=b.strstart,at=b.prev_length,ht=b.nice_match,Q=b.strstart>b.w_size-Z?b.strstart-(b.w_size-Z):0,pt=b.window,_t=b.w_mask,dt=b.prev,vt=b.strstart+V,ue=pt[H+at-1],Ut=pt[H+at];b.prev_length>=b.good_match&&(M>>=2),ht>b.lookahead&&(ht=b.lookahead);do if(pt[(nt=st)+at]===Ut&&pt[nt+at-1]===ue&&pt[nt]===pt[H]&&pt[++nt]===pt[H+1]){H+=2,nt++;do;while(pt[++H]===pt[++nt]&&pt[++H]===pt[++nt]&&pt[++H]===pt[++nt]&&pt[++H]===pt[++nt]&&pt[++H]===pt[++nt]&&pt[++H]===pt[++nt]&&pt[++H]===pt[++nt]&&pt[++H]===pt[++nt]&&H<vt);if(F=V-(vt-H),H=vt-V,at<F){if(b.match_start=st,ht<=(at=F))break;ue=pt[H+at-1],Ut=pt[H+at]}}while((st=dt[st&_t])>Q&&--M!=0);return at<=b.lookahead?at:b.lookahead}function Lt(b){var st,nt,F,M,H,at,ht,Q,pt,_t,dt=b.w_size;do{if(M=b.window_size-b.lookahead-b.strstart,b.strstart>=dt+(dt-Z)){for(o.arraySet(b.window,b.window,dt,dt,0),b.match_start-=dt,b.strstart-=dt,b.block_start-=dt,st=nt=b.hash_size;F=b.head[--st],b.head[st]=dt<=F?F-dt:0,--nt;);for(st=nt=dt;F=b.prev[--st],b.prev[st]=dt<=F?F-dt:0,--nt;);M+=dt}if(b.strm.avail_in===0)break;if(at=b.strm,ht=b.window,Q=b.strstart+b.lookahead,pt=M,_t=void 0,_t=at.avail_in,pt<_t&&(_t=pt),nt=_t===0?0:(at.avail_in-=_t,o.arraySet(ht,at.input,at.next_in,_t,Q),at.state.wrap===1?at.adler=c(at.adler,ht,_t,Q):at.state.wrap===2&&(at.adler=u(at.adler,ht,_t,Q)),at.next_in+=_t,at.total_in+=_t,_t),b.lookahead+=nt,b.lookahead+b.insert>=L)for(H=b.strstart-b.insert,b.ins_h=b.window[H],b.ins_h=(b.ins_h<<b.hash_shift^b.window[H+1])&b.hash_mask;b.insert&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[H+L-1])&b.hash_mask,b.prev[H&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=H,H++,b.insert--,!(b.lookahead+b.insert<L)););}while(b.lookahead<Z&&b.strm.avail_in!==0)}function ee(b,st){for(var nt,F;;){if(b.lookahead<Z){if(Lt(b),b.lookahead<Z&&st===h)return _;if(b.lookahead===0)break}if(nt=0,b.lookahead>=L&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+L-1])&b.hash_mask,nt=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),nt!==0&&b.strstart-nt<=b.w_size-Z&&(b.match_length=ct(b,nt)),b.match_length>=L)if(F=a._tr_tally(b,b.strstart-b.match_start,b.match_length-L),b.lookahead-=b.match_length,b.match_length<=b.max_lazy_match&&b.lookahead>=L){for(b.match_length--;b.strstart++,b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+L-1])&b.hash_mask,nt=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart,--b.match_length!=0;);b.strstart++}else b.strstart+=b.match_length,b.match_length=0,b.ins_h=b.window[b.strstart],b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+1])&b.hash_mask;else F=a._tr_tally(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++;if(F&&(W(b,!1),b.strm.avail_out===0))return _}return b.insert=b.strstart<L-1?b.strstart:L-1,st===f?(W(b,!0),b.strm.avail_out===0?X:D):b.last_lit&&(W(b,!1),b.strm.avail_out===0)?_:B}function At(b,st){for(var nt,F,M;;){if(b.lookahead<Z){if(Lt(b),b.lookahead<Z&&st===h)return _;if(b.lookahead===0)break}if(nt=0,b.lookahead>=L&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+L-1])&b.hash_mask,nt=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),b.prev_length=b.match_length,b.prev_match=b.match_start,b.match_length=L-1,nt!==0&&b.prev_length<b.max_lazy_match&&b.strstart-nt<=b.w_size-Z&&(b.match_length=ct(b,nt),b.match_length<=5&&(b.strategy===1||b.match_length===L&&4096<b.strstart-b.match_start)&&(b.match_length=L-1)),b.prev_length>=L&&b.match_length<=b.prev_length){for(M=b.strstart+b.lookahead-L,F=a._tr_tally(b,b.strstart-1-b.prev_match,b.prev_length-L),b.lookahead-=b.prev_length-1,b.prev_length-=2;++b.strstart<=M&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+L-1])&b.hash_mask,nt=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),--b.prev_length!=0;);if(b.match_available=0,b.match_length=L-1,b.strstart++,F&&(W(b,!1),b.strm.avail_out===0))return _}else if(b.match_available){if((F=a._tr_tally(b,0,b.window[b.strstart-1]))&&W(b,!1),b.strstart++,b.lookahead--,b.strm.avail_out===0)return _}else b.match_available=1,b.strstart++,b.lookahead--}return b.match_available&&(F=a._tr_tally(b,0,b.window[b.strstart-1]),b.match_available=0),b.insert=b.strstart<L-1?b.strstart:L-1,st===f?(W(b,!0),b.strm.avail_out===0?X:D):b.last_lit&&(W(b,!1),b.strm.avail_out===0)?_:B}function kt(b,st,nt,F,M){this.good_length=b,this.max_lazy=st,this.nice_length=nt,this.max_chain=F,this.func=M}function zt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*N),this.dyn_dtree=new o.Buf16(2*(2*U+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(P+1),this.heap=new o.Buf16(2*I+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*I+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Gt(b){var st;return b&&b.state?(b.total_in=b.total_out=0,b.data_type=E,(st=b.state).pending=0,st.pending_out=0,st.wrap<0&&(st.wrap=-st.wrap),st.status=st.wrap?C:R,b.adler=st.wrap===2?0:1,st.last_flush=h,a._tr_init(st),d):lt(b,p)}function be(b){var st=Gt(b);return st===d&&function(nt){nt.window_size=2*nt.w_size,ft(nt.head),nt.max_lazy_match=s[nt.level].max_lazy,nt.good_match=s[nt.level].good_length,nt.nice_match=s[nt.level].nice_length,nt.max_chain_length=s[nt.level].max_chain,nt.strstart=0,nt.block_start=0,nt.lookahead=0,nt.insert=0,nt.match_length=nt.prev_length=L-1,nt.match_available=0,nt.ins_h=0}(b.state),st}function Oe(b,st,nt,F,M,H){if(!b)return p;var at=1;if(st===m&&(st=6),F<0?(at=0,F=-F):15<F&&(at=2,F-=16),M<1||v<M||nt!==T||F<8||15<F||st<0||9<st||H<0||w<H)return lt(b,p);F===8&&(F=9);var ht=new zt;return(b.state=ht).strm=b,ht.wrap=at,ht.gzhead=null,ht.w_bits=F,ht.w_size=1<<ht.w_bits,ht.w_mask=ht.w_size-1,ht.hash_bits=M+7,ht.hash_size=1<<ht.hash_bits,ht.hash_mask=ht.hash_size-1,ht.hash_shift=~~((ht.hash_bits+L-1)/L),ht.window=new o.Buf8(2*ht.w_size),ht.head=new o.Buf16(ht.hash_size),ht.prev=new o.Buf16(ht.w_size),ht.lit_bufsize=1<<M+6,ht.pending_buf_size=4*ht.lit_bufsize,ht.pending_buf=new o.Buf8(ht.pending_buf_size),ht.d_buf=1*ht.lit_bufsize,ht.l_buf=3*ht.lit_bufsize,ht.level=st,ht.strategy=H,ht.method=nt,be(b)}s=[new kt(0,0,0,0,function(b,st){var nt=65535;for(nt>b.pending_buf_size-5&&(nt=b.pending_buf_size-5);;){if(b.lookahead<=1){if(Lt(b),b.lookahead===0&&st===h)return _;if(b.lookahead===0)break}b.strstart+=b.lookahead,b.lookahead=0;var F=b.block_start+nt;if((b.strstart===0||b.strstart>=F)&&(b.lookahead=b.strstart-F,b.strstart=F,W(b,!1),b.strm.avail_out===0)||b.strstart-b.block_start>=b.w_size-Z&&(W(b,!1),b.strm.avail_out===0))return _}return b.insert=0,st===f?(W(b,!0),b.strm.avail_out===0?X:D):(b.strstart>b.block_start&&(W(b,!1),b.strm.avail_out),_)}),new kt(4,4,8,4,ee),new kt(4,5,16,8,ee),new kt(4,6,32,32,ee),new kt(4,4,16,16,At),new kt(8,16,32,32,At),new kt(8,16,128,128,At),new kt(8,32,128,256,At),new kt(32,128,258,1024,At),new kt(32,258,258,4096,At)],i.deflateInit=function(b,st){return Oe(b,st,T,15,8,0)},i.deflateInit2=Oe,i.deflateReset=be,i.deflateResetKeep=Gt,i.deflateSetHeader=function(b,st){return b&&b.state?b.state.wrap!==2?p:(b.state.gzhead=st,d):p},i.deflate=function(b,st){var nt,F,M,H;if(!b||!b.state||5<st||st<0)return b?lt(b,p):p;if(F=b.state,!b.output||!b.input&&b.avail_in!==0||F.status===666&&st!==f)return lt(b,b.avail_out===0?-5:p);if(F.strm=b,nt=F.last_flush,F.last_flush=st,F.status===C)if(F.wrap===2)b.adler=0,bt(F,31),bt(F,139),bt(F,8),F.gzhead?(bt(F,(F.gzhead.text?1:0)+(F.gzhead.hcrc?2:0)+(F.gzhead.extra?4:0)+(F.gzhead.name?8:0)+(F.gzhead.comment?16:0)),bt(F,255&F.gzhead.time),bt(F,F.gzhead.time>>8&255),bt(F,F.gzhead.time>>16&255),bt(F,F.gzhead.time>>24&255),bt(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),bt(F,255&F.gzhead.os),F.gzhead.extra&&F.gzhead.extra.length&&(bt(F,255&F.gzhead.extra.length),bt(F,F.gzhead.extra.length>>8&255)),F.gzhead.hcrc&&(b.adler=u(b.adler,F.pending_buf,F.pending,0)),F.gzindex=0,F.status=69):(bt(F,0),bt(F,0),bt(F,0),bt(F,0),bt(F,0),bt(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),bt(F,3),F.status=R);else{var at=T+(F.w_bits-8<<4)<<8;at|=(2<=F.strategy||F.level<2?0:F.level<6?1:F.level===6?2:3)<<6,F.strstart!==0&&(at|=32),at+=31-at%31,F.status=R,ot(F,at),F.strstart!==0&&(ot(F,b.adler>>>16),ot(F,65535&b.adler)),b.adler=1}if(F.status===69)if(F.gzhead.extra){for(M=F.pending;F.gzindex<(65535&F.gzhead.extra.length)&&(F.pending!==F.pending_buf_size||(F.gzhead.hcrc&&F.pending>M&&(b.adler=u(b.adler,F.pending_buf,F.pending-M,M)),G(b),M=F.pending,F.pending!==F.pending_buf_size));)bt(F,255&F.gzhead.extra[F.gzindex]),F.gzindex++;F.gzhead.hcrc&&F.pending>M&&(b.adler=u(b.adler,F.pending_buf,F.pending-M,M)),F.gzindex===F.gzhead.extra.length&&(F.gzindex=0,F.status=73)}else F.status=73;if(F.status===73)if(F.gzhead.name){M=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>M&&(b.adler=u(b.adler,F.pending_buf,F.pending-M,M)),G(b),M=F.pending,F.pending===F.pending_buf_size)){H=1;break}H=F.gzindex<F.gzhead.name.length?255&F.gzhead.name.charCodeAt(F.gzindex++):0,bt(F,H)}while(H!==0);F.gzhead.hcrc&&F.pending>M&&(b.adler=u(b.adler,F.pending_buf,F.pending-M,M)),H===0&&(F.gzindex=0,F.status=91)}else F.status=91;if(F.status===91)if(F.gzhead.comment){M=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>M&&(b.adler=u(b.adler,F.pending_buf,F.pending-M,M)),G(b),M=F.pending,F.pending===F.pending_buf_size)){H=1;break}H=F.gzindex<F.gzhead.comment.length?255&F.gzhead.comment.charCodeAt(F.gzindex++):0,bt(F,H)}while(H!==0);F.gzhead.hcrc&&F.pending>M&&(b.adler=u(b.adler,F.pending_buf,F.pending-M,M)),H===0&&(F.status=103)}else F.status=103;if(F.status===103&&(F.gzhead.hcrc?(F.pending+2>F.pending_buf_size&&G(b),F.pending+2<=F.pending_buf_size&&(bt(F,255&b.adler),bt(F,b.adler>>8&255),b.adler=0,F.status=R)):F.status=R),F.pending!==0){if(G(b),b.avail_out===0)return F.last_flush=-1,d}else if(b.avail_in===0&&et(st)<=et(nt)&&st!==f)return lt(b,-5);if(F.status===666&&b.avail_in!==0)return lt(b,-5);if(b.avail_in!==0||F.lookahead!==0||st!==h&&F.status!==666){var ht=F.strategy===2?function(Q,pt){for(var _t;;){if(Q.lookahead===0&&(Lt(Q),Q.lookahead===0)){if(pt===h)return _;break}if(Q.match_length=0,_t=a._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++,_t&&(W(Q,!1),Q.strm.avail_out===0))return _}return Q.insert=0,pt===f?(W(Q,!0),Q.strm.avail_out===0?X:D):Q.last_lit&&(W(Q,!1),Q.strm.avail_out===0)?_:B}(F,st):F.strategy===3?function(Q,pt){for(var _t,dt,vt,ue,Ut=Q.window;;){if(Q.lookahead<=V){if(Lt(Q),Q.lookahead<=V&&pt===h)return _;if(Q.lookahead===0)break}if(Q.match_length=0,Q.lookahead>=L&&0<Q.strstart&&(dt=Ut[vt=Q.strstart-1])===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]){ue=Q.strstart+V;do;while(dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&vt<ue);Q.match_length=V-(ue-vt),Q.match_length>Q.lookahead&&(Q.match_length=Q.lookahead)}if(Q.match_length>=L?(_t=a._tr_tally(Q,1,Q.match_length-L),Q.lookahead-=Q.match_length,Q.strstart+=Q.match_length,Q.match_length=0):(_t=a._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++),_t&&(W(Q,!1),Q.strm.avail_out===0))return _}return Q.insert=0,pt===f?(W(Q,!0),Q.strm.avail_out===0?X:D):Q.last_lit&&(W(Q,!1),Q.strm.avail_out===0)?_:B}(F,st):s[F.level].func(F,st);if(ht!==X&&ht!==D||(F.status=666),ht===_||ht===X)return b.avail_out===0&&(F.last_flush=-1),d;if(ht===B&&(st===1?a._tr_align(F):st!==5&&(a._tr_stored_block(F,0,0,!1),st===3&&(ft(F.head),F.lookahead===0&&(F.strstart=0,F.block_start=0,F.insert=0))),G(b),b.avail_out===0))return F.last_flush=-1,d}return st!==f?d:F.wrap<=0?1:(F.wrap===2?(bt(F,255&b.adler),bt(F,b.adler>>8&255),bt(F,b.adler>>16&255),bt(F,b.adler>>24&255),bt(F,255&b.total_in),bt(F,b.total_in>>8&255),bt(F,b.total_in>>16&255),bt(F,b.total_in>>24&255)):(ot(F,b.adler>>>16),ot(F,65535&b.adler)),G(b),0<F.wrap&&(F.wrap=-F.wrap),F.pending!==0?d:1)},i.deflateEnd=function(b){var st;return b&&b.state?(st=b.state.status)!==C&&st!==69&&st!==73&&st!==91&&st!==103&&st!==R&&st!==666?lt(b,p):(b.state=null,st===R?lt(b,-3):d):p},i.deflateSetDictionary=function(b,st){var nt,F,M,H,at,ht,Q,pt,_t=st.length;if(!b||!b.state||(H=(nt=b.state).wrap)===2||H===1&&nt.status!==C||nt.lookahead)return p;for(H===1&&(b.adler=c(b.adler,st,_t,0)),nt.wrap=0,_t>=nt.w_size&&(H===0&&(ft(nt.head),nt.strstart=0,nt.block_start=0,nt.insert=0),pt=new o.Buf8(nt.w_size),o.arraySet(pt,st,_t-nt.w_size,nt.w_size,0),st=pt,_t=nt.w_size),at=b.avail_in,ht=b.next_in,Q=b.input,b.avail_in=_t,b.next_in=0,b.input=st,Lt(nt);nt.lookahead>=L;){for(F=nt.strstart,M=nt.lookahead-(L-1);nt.ins_h=(nt.ins_h<<nt.hash_shift^nt.window[F+L-1])&nt.hash_mask,nt.prev[F&nt.w_mask]=nt.head[nt.ins_h],nt.head[nt.ins_h]=F,F++,--M;);nt.strstart=F,nt.lookahead=L-1,Lt(nt)}return nt.strstart+=nt.lookahead,nt.block_start=nt.strstart,nt.insert=nt.lookahead,nt.lookahead=0,nt.match_length=nt.prev_length=L-1,nt.match_available=0,b.next_in=ht,b.input=Q,b.avail_in=at,nt.wrap=H,d},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,u,l,h,f,d,p,m,w,E,T,v,I,U,S,N,P,L,V,Z,C,R,_,B;a=s.state,c=s.next_in,_=s.input,u=c+(s.avail_in-5),l=s.next_out,B=s.output,h=l-(o-s.avail_out),f=l+(s.avail_out-257),d=a.dmax,p=a.wsize,m=a.whave,w=a.wnext,E=a.window,T=a.hold,v=a.bits,I=a.lencode,U=a.distcode,S=(1<<a.lenbits)-1,N=(1<<a.distbits)-1;t:do{v<15&&(T+=_[c++]<<v,v+=8,T+=_[c++]<<v,v+=8),P=I[T&S];e:for(;;){if(T>>>=L=P>>>24,v-=L,(L=P>>>16&255)===0)B[l++]=65535&P;else{if(!(16&L)){if(!(64&L)){P=I[(65535&P)+(T&(1<<L)-1)];continue e}if(32&L){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}V=65535&P,(L&=15)&&(v<L&&(T+=_[c++]<<v,v+=8),V+=T&(1<<L)-1,T>>>=L,v-=L),v<15&&(T+=_[c++]<<v,v+=8,T+=_[c++]<<v,v+=8),P=U[T&N];n:for(;;){if(T>>>=L=P>>>24,v-=L,!(16&(L=P>>>16&255))){if(!(64&L)){P=U[(65535&P)+(T&(1<<L)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(Z=65535&P,v<(L&=15)&&(T+=_[c++]<<v,(v+=8)<L&&(T+=_[c++]<<v,v+=8)),d<(Z+=T&(1<<L)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(T>>>=L,v-=L,(L=l-h)<Z){if(m<(L=Z-L)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(R=E,(C=0)===w){if(C+=p-L,L<V){for(V-=L;B[l++]=E[C++],--L;);C=l-Z,R=B}}else if(w<L){if(C+=p+w-L,(L-=w)<V){for(V-=L;B[l++]=E[C++],--L;);if(C=0,w<V){for(V-=L=w;B[l++]=E[C++],--L;);C=l-Z,R=B}}}else if(C+=w-L,L<V){for(V-=L;B[l++]=E[C++],--L;);C=l-Z,R=B}for(;2<V;)B[l++]=R[C++],B[l++]=R[C++],B[l++]=R[C++],V-=3;V&&(B[l++]=R[C++],1<V&&(B[l++]=R[C++]))}else{for(C=l-Z;B[l++]=B[C++],B[l++]=B[C++],B[l++]=B[C++],2<(V-=3););V&&(B[l++]=B[C++],1<V&&(B[l++]=B[C++]))}break}}break}}while(c<u&&l<f);c-=V=v>>3,T&=(1<<(v-=V<<3))-1,s.next_in=c,s.next_out=l,s.avail_in=c<u?u-c+5:5-(c-u),s.avail_out=l<f?f-l+257:257-(l-f),a.hold=T,a.bits=v}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),u=n("./inftrees"),l=1,h=2,f=0,d=-2,p=1,m=852,w=592;function E(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(C){var R;return C&&C.state?(R=C.state,C.total_in=C.total_out=R.total=0,C.msg="",R.wrap&&(C.adler=1&R.wrap),R.mode=p,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new s.Buf32(m),R.distcode=R.distdyn=new s.Buf32(w),R.sane=1,R.back=-1,f):d}function I(C){var R;return C&&C.state?((R=C.state).wsize=0,R.whave=0,R.wnext=0,v(C)):d}function U(C,R){var _,B;return C&&C.state?(B=C.state,R<0?(_=0,R=-R):(_=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?d:(B.window!==null&&B.wbits!==R&&(B.window=null),B.wrap=_,B.wbits=R,I(C))):d}function S(C,R){var _,B;return C?(B=new T,(C.state=B).window=null,(_=U(C,R))!==f&&(C.state=null),_):d}var N,P,L=!0;function V(C){if(L){var R;for(N=new s.Buf32(512),P=new s.Buf32(32),R=0;R<144;)C.lens[R++]=8;for(;R<256;)C.lens[R++]=9;for(;R<280;)C.lens[R++]=7;for(;R<288;)C.lens[R++]=8;for(u(l,C.lens,0,288,N,0,C.work,{bits:9}),R=0;R<32;)C.lens[R++]=5;u(h,C.lens,0,32,P,0,C.work,{bits:5}),L=!1}C.lencode=N,C.lenbits=9,C.distcode=P,C.distbits=5}function Z(C,R,_,B){var X,D=C.state;return D.window===null&&(D.wsize=1<<D.wbits,D.wnext=0,D.whave=0,D.window=new s.Buf8(D.wsize)),B>=D.wsize?(s.arraySet(D.window,R,_-D.wsize,D.wsize,0),D.wnext=0,D.whave=D.wsize):(B<(X=D.wsize-D.wnext)&&(X=B),s.arraySet(D.window,R,_-B,X,D.wnext),(B-=X)?(s.arraySet(D.window,R,_-B,B,0),D.wnext=B,D.whave=D.wsize):(D.wnext+=X,D.wnext===D.wsize&&(D.wnext=0),D.whave<D.wsize&&(D.whave+=X))),0}i.inflateReset=I,i.inflateReset2=U,i.inflateResetKeep=v,i.inflateInit=function(C){return S(C,15)},i.inflateInit2=S,i.inflate=function(C,R){var _,B,X,D,lt,et,ft,G,W,bt,ot,ct,Lt,ee,At,kt,zt,Gt,be,Oe,b,st,nt,F,M=0,H=new s.Buf8(4),at=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return d;(_=C.state).mode===12&&(_.mode=13),lt=C.next_out,X=C.output,ft=C.avail_out,D=C.next_in,B=C.input,et=C.avail_in,G=_.hold,W=_.bits,bt=et,ot=ft,st=f;t:for(;;)switch(_.mode){case p:if(_.wrap===0){_.mode=13;break}for(;W<16;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}if(2&_.wrap&&G===35615){H[_.check=0]=255&G,H[1]=G>>>8&255,_.check=a(_.check,H,2,0),W=G=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&G)<<8)+(G>>8))%31){C.msg="incorrect header check",_.mode=30;break}if((15&G)!=8){C.msg="unknown compression method",_.mode=30;break}if(W-=4,b=8+(15&(G>>>=4)),_.wbits===0)_.wbits=b;else if(b>_.wbits){C.msg="invalid window size",_.mode=30;break}_.dmax=1<<b,C.adler=_.check=1,_.mode=512&G?10:12,W=G=0;break;case 2:for(;W<16;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}if(_.flags=G,(255&_.flags)!=8){C.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){C.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=G>>8&1),512&_.flags&&(H[0]=255&G,H[1]=G>>>8&255,_.check=a(_.check,H,2,0)),W=G=0,_.mode=3;case 3:for(;W<32;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}_.head&&(_.head.time=G),512&_.flags&&(H[0]=255&G,H[1]=G>>>8&255,H[2]=G>>>16&255,H[3]=G>>>24&255,_.check=a(_.check,H,4,0)),W=G=0,_.mode=4;case 4:for(;W<16;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}_.head&&(_.head.xflags=255&G,_.head.os=G>>8),512&_.flags&&(H[0]=255&G,H[1]=G>>>8&255,_.check=a(_.check,H,2,0)),W=G=0,_.mode=5;case 5:if(1024&_.flags){for(;W<16;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}_.length=G,_.head&&(_.head.extra_len=G),512&_.flags&&(H[0]=255&G,H[1]=G>>>8&255,_.check=a(_.check,H,2,0)),W=G=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(et<(ct=_.length)&&(ct=et),ct&&(_.head&&(b=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),s.arraySet(_.head.extra,B,D,ct,b)),512&_.flags&&(_.check=a(_.check,B,ct,D)),et-=ct,D+=ct,_.length-=ct),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(et===0)break t;for(ct=0;b=B[D+ct++],_.head&&b&&_.length<65536&&(_.head.name+=String.fromCharCode(b)),b&&ct<et;);if(512&_.flags&&(_.check=a(_.check,B,ct,D)),et-=ct,D+=ct,b)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(et===0)break t;for(ct=0;b=B[D+ct++],_.head&&b&&_.length<65536&&(_.head.comment+=String.fromCharCode(b)),b&&ct<et;);if(512&_.flags&&(_.check=a(_.check,B,ct,D)),et-=ct,D+=ct,b)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;W<16;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}if(G!==(65535&_.check)){C.msg="header crc mismatch",_.mode=30;break}W=G=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),C.adler=_.check=0,_.mode=12;break;case 10:for(;W<32;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}C.adler=_.check=E(G),W=G=0,_.mode=11;case 11:if(_.havedict===0)return C.next_out=lt,C.avail_out=ft,C.next_in=D,C.avail_in=et,_.hold=G,_.bits=W,2;C.adler=_.check=1,_.mode=12;case 12:if(R===5||R===6)break t;case 13:if(_.last){G>>>=7&W,W-=7&W,_.mode=27;break}for(;W<3;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}switch(_.last=1&G,W-=1,3&(G>>>=1)){case 0:_.mode=14;break;case 1:if(V(_),_.mode=20,R!==6)break;G>>>=2,W-=2;break t;case 2:_.mode=17;break;case 3:C.msg="invalid block type",_.mode=30}G>>>=2,W-=2;break;case 14:for(G>>>=7&W,W-=7&W;W<32;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}if((65535&G)!=(G>>>16^65535)){C.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&G,W=G=0,_.mode=15,R===6)break t;case 15:_.mode=16;case 16:if(ct=_.length){if(et<ct&&(ct=et),ft<ct&&(ct=ft),ct===0)break t;s.arraySet(X,B,D,ct,lt),et-=ct,D+=ct,ft-=ct,lt+=ct,_.length-=ct;break}_.mode=12;break;case 17:for(;W<14;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}if(_.nlen=257+(31&G),G>>>=5,W-=5,_.ndist=1+(31&G),G>>>=5,W-=5,_.ncode=4+(15&G),G>>>=4,W-=4,286<_.nlen||30<_.ndist){C.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;W<3;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}_.lens[at[_.have++]]=7&G,G>>>=3,W-=3}for(;_.have<19;)_.lens[at[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,nt={bits:_.lenbits},st=u(0,_.lens,0,19,_.lencode,0,_.work,nt),_.lenbits=nt.bits,st){C.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;kt=(M=_.lencode[G&(1<<_.lenbits)-1])>>>16&255,zt=65535&M,!((At=M>>>24)<=W);){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}if(zt<16)G>>>=At,W-=At,_.lens[_.have++]=zt;else{if(zt===16){for(F=At+2;W<F;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}if(G>>>=At,W-=At,_.have===0){C.msg="invalid bit length repeat",_.mode=30;break}b=_.lens[_.have-1],ct=3+(3&G),G>>>=2,W-=2}else if(zt===17){for(F=At+3;W<F;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}W-=At,b=0,ct=3+(7&(G>>>=At)),G>>>=3,W-=3}else{for(F=At+7;W<F;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}W-=At,b=0,ct=11+(127&(G>>>=At)),G>>>=7,W-=7}if(_.have+ct>_.nlen+_.ndist){C.msg="invalid bit length repeat",_.mode=30;break}for(;ct--;)_.lens[_.have++]=b}}if(_.mode===30)break;if(_.lens[256]===0){C.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,nt={bits:_.lenbits},st=u(l,_.lens,0,_.nlen,_.lencode,0,_.work,nt),_.lenbits=nt.bits,st){C.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,nt={bits:_.distbits},st=u(h,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,nt),_.distbits=nt.bits,st){C.msg="invalid distances set",_.mode=30;break}if(_.mode=20,R===6)break t;case 20:_.mode=21;case 21:if(6<=et&&258<=ft){C.next_out=lt,C.avail_out=ft,C.next_in=D,C.avail_in=et,_.hold=G,_.bits=W,c(C,ot),lt=C.next_out,X=C.output,ft=C.avail_out,D=C.next_in,B=C.input,et=C.avail_in,G=_.hold,W=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;kt=(M=_.lencode[G&(1<<_.lenbits)-1])>>>16&255,zt=65535&M,!((At=M>>>24)<=W);){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}if(kt&&!(240&kt)){for(Gt=At,be=kt,Oe=zt;kt=(M=_.lencode[Oe+((G&(1<<Gt+be)-1)>>Gt)])>>>16&255,zt=65535&M,!(Gt+(At=M>>>24)<=W);){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}G>>>=Gt,W-=Gt,_.back+=Gt}if(G>>>=At,W-=At,_.back+=At,_.length=zt,kt===0){_.mode=26;break}if(32&kt){_.back=-1,_.mode=12;break}if(64&kt){C.msg="invalid literal/length code",_.mode=30;break}_.extra=15&kt,_.mode=22;case 22:if(_.extra){for(F=_.extra;W<F;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}_.length+=G&(1<<_.extra)-1,G>>>=_.extra,W-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;kt=(M=_.distcode[G&(1<<_.distbits)-1])>>>16&255,zt=65535&M,!((At=M>>>24)<=W);){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}if(!(240&kt)){for(Gt=At,be=kt,Oe=zt;kt=(M=_.distcode[Oe+((G&(1<<Gt+be)-1)>>Gt)])>>>16&255,zt=65535&M,!(Gt+(At=M>>>24)<=W);){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}G>>>=Gt,W-=Gt,_.back+=Gt}if(G>>>=At,W-=At,_.back+=At,64&kt){C.msg="invalid distance code",_.mode=30;break}_.offset=zt,_.extra=15&kt,_.mode=24;case 24:if(_.extra){for(F=_.extra;W<F;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}_.offset+=G&(1<<_.extra)-1,G>>>=_.extra,W-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){C.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(ft===0)break t;if(ct=ot-ft,_.offset>ct){if((ct=_.offset-ct)>_.whave&&_.sane){C.msg="invalid distance too far back",_.mode=30;break}Lt=ct>_.wnext?(ct-=_.wnext,_.wsize-ct):_.wnext-ct,ct>_.length&&(ct=_.length),ee=_.window}else ee=X,Lt=lt-_.offset,ct=_.length;for(ft<ct&&(ct=ft),ft-=ct,_.length-=ct;X[lt++]=ee[Lt++],--ct;);_.length===0&&(_.mode=21);break;case 26:if(ft===0)break t;X[lt++]=_.length,ft--,_.mode=21;break;case 27:if(_.wrap){for(;W<32;){if(et===0)break t;et--,G|=B[D++]<<W,W+=8}if(ot-=ft,C.total_out+=ot,_.total+=ot,ot&&(C.adler=_.check=_.flags?a(_.check,X,ot,lt-ot):o(_.check,X,ot,lt-ot)),ot=ft,(_.flags?G:E(G))!==_.check){C.msg="incorrect data check",_.mode=30;break}W=G=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;W<32;){if(et===0)break t;et--,G+=B[D++]<<W,W+=8}if(G!==(4294967295&_.total)){C.msg="incorrect length check",_.mode=30;break}W=G=0}_.mode=29;case 29:st=1;break t;case 30:st=-3;break t;case 31:return-4;case 32:default:return d}return C.next_out=lt,C.avail_out=ft,C.next_in=D,C.avail_in=et,_.hold=G,_.bits=W,(_.wsize||ot!==C.avail_out&&_.mode<30&&(_.mode<27||R!==4))&&Z(C,C.output,C.next_out,ot-C.avail_out)?(_.mode=31,-4):(bt-=C.avail_in,ot-=C.avail_out,C.total_in+=bt,C.total_out+=ot,_.total+=ot,_.wrap&&ot&&(C.adler=_.check=_.flags?a(_.check,X,ot,C.next_out-ot):o(_.check,X,ot,C.next_out-ot)),C.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(bt==0&&ot===0||R===4)&&st===f&&(st=-5),st)},i.inflateEnd=function(C){if(!C||!C.state)return d;var R=C.state;return R.window&&(R.window=null),C.state=null,f},i.inflateGetHeader=function(C,R){var _;return C&&C.state&&2&(_=C.state).wrap?((_.head=R).done=!1,f):d},i.inflateSetDictionary=function(C,R){var _,B=R.length;return C&&C.state?(_=C.state).wrap!==0&&_.mode!==11?d:_.mode===11&&o(1,R,B,0)!==_.check?-3:Z(C,R,B,B)?(_.mode=31,-4):(_.havedict=1,f):d},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(l,h,f,d,p,m,w,E){var T,v,I,U,S,N,P,L,V,Z=E.bits,C=0,R=0,_=0,B=0,X=0,D=0,lt=0,et=0,ft=0,G=0,W=null,bt=0,ot=new s.Buf16(16),ct=new s.Buf16(16),Lt=null,ee=0;for(C=0;C<=15;C++)ot[C]=0;for(R=0;R<d;R++)ot[h[f+R]]++;for(X=Z,B=15;1<=B&&ot[B]===0;B--);if(B<X&&(X=B),B===0)return p[m++]=20971520,p[m++]=20971520,E.bits=1,0;for(_=1;_<B&&ot[_]===0;_++);for(X<_&&(X=_),C=et=1;C<=15;C++)if(et<<=1,(et-=ot[C])<0)return-1;if(0<et&&(l===0||B!==1))return-1;for(ct[1]=0,C=1;C<15;C++)ct[C+1]=ct[C]+ot[C];for(R=0;R<d;R++)h[f+R]!==0&&(w[ct[h[f+R]]++]=R);if(N=l===0?(W=Lt=w,19):l===1?(W=o,bt-=257,Lt=a,ee-=257,256):(W=c,Lt=u,-1),C=_,S=m,lt=R=G=0,I=-1,U=(ft=1<<(D=X))-1,l===1&&852<ft||l===2&&592<ft)return 1;for(;;){for(P=C-lt,V=w[R]<N?(L=0,w[R]):w[R]>N?(L=Lt[ee+w[R]],W[bt+w[R]]):(L=96,0),T=1<<C-lt,_=v=1<<D;p[S+(G>>lt)+(v-=T)]=P<<24|L<<16|V|0,v!==0;);for(T=1<<C-1;G&T;)T>>=1;if(T!==0?(G&=T-1,G+=T):G=0,R++,--ot[C]==0){if(C===B)break;C=h[f+w[R]]}if(X<C&&(G&U)!==I){for(lt===0&&(lt=X),S+=_,et=1<<(D=C-lt);D+lt<B&&!((et-=ot[D+lt])<=0);)D++,et<<=1;if(ft+=1<<D,l===1&&852<ft||l===2&&592<ft)return 1;p[I=G&U]=X<<24|D<<16|S-m|0}}return G!==0&&(p[S+G]=C-lt<<24|64<<16|0),E.bits=X,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(M){for(var H=M.length;0<=--H;)M[H]=0}var u=0,l=29,h=256,f=h+1+l,d=30,p=19,m=2*f+1,w=15,E=16,T=7,v=256,I=16,U=17,S=18,N=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Z=new Array(2*(f+2));c(Z);var C=new Array(2*d);c(C);var R=new Array(512);c(R);var _=new Array(256);c(_);var B=new Array(l);c(B);var X,D,lt,et=new Array(d);function ft(M,H,at,ht,Q){this.static_tree=M,this.extra_bits=H,this.extra_base=at,this.elems=ht,this.max_length=Q,this.has_stree=M&&M.length}function G(M,H){this.dyn_tree=M,this.max_code=0,this.stat_desc=H}function W(M){return M<256?R[M]:R[256+(M>>>7)]}function bt(M,H){M.pending_buf[M.pending++]=255&H,M.pending_buf[M.pending++]=H>>>8&255}function ot(M,H,at){M.bi_valid>E-at?(M.bi_buf|=H<<M.bi_valid&65535,bt(M,M.bi_buf),M.bi_buf=H>>E-M.bi_valid,M.bi_valid+=at-E):(M.bi_buf|=H<<M.bi_valid&65535,M.bi_valid+=at)}function ct(M,H,at){ot(M,at[2*H],at[2*H+1])}function Lt(M,H){for(var at=0;at|=1&M,M>>>=1,at<<=1,0<--H;);return at>>>1}function ee(M,H,at){var ht,Q,pt=new Array(w+1),_t=0;for(ht=1;ht<=w;ht++)pt[ht]=_t=_t+at[ht-1]<<1;for(Q=0;Q<=H;Q++){var dt=M[2*Q+1];dt!==0&&(M[2*Q]=Lt(pt[dt]++,dt))}}function At(M){var H;for(H=0;H<f;H++)M.dyn_ltree[2*H]=0;for(H=0;H<d;H++)M.dyn_dtree[2*H]=0;for(H=0;H<p;H++)M.bl_tree[2*H]=0;M.dyn_ltree[2*v]=1,M.opt_len=M.static_len=0,M.last_lit=M.matches=0}function kt(M){8<M.bi_valid?bt(M,M.bi_buf):0<M.bi_valid&&(M.pending_buf[M.pending++]=M.bi_buf),M.bi_buf=0,M.bi_valid=0}function zt(M,H,at,ht){var Q=2*H,pt=2*at;return M[Q]<M[pt]||M[Q]===M[pt]&&ht[H]<=ht[at]}function Gt(M,H,at){for(var ht=M.heap[at],Q=at<<1;Q<=M.heap_len&&(Q<M.heap_len&&zt(H,M.heap[Q+1],M.heap[Q],M.depth)&&Q++,!zt(H,ht,M.heap[Q],M.depth));)M.heap[at]=M.heap[Q],at=Q,Q<<=1;M.heap[at]=ht}function be(M,H,at){var ht,Q,pt,_t,dt=0;if(M.last_lit!==0)for(;ht=M.pending_buf[M.d_buf+2*dt]<<8|M.pending_buf[M.d_buf+2*dt+1],Q=M.pending_buf[M.l_buf+dt],dt++,ht===0?ct(M,Q,H):(ct(M,(pt=_[Q])+h+1,H),(_t=N[pt])!==0&&ot(M,Q-=B[pt],_t),ct(M,pt=W(--ht),at),(_t=P[pt])!==0&&ot(M,ht-=et[pt],_t)),dt<M.last_lit;);ct(M,v,H)}function Oe(M,H){var at,ht,Q,pt=H.dyn_tree,_t=H.stat_desc.static_tree,dt=H.stat_desc.has_stree,vt=H.stat_desc.elems,ue=-1;for(M.heap_len=0,M.heap_max=m,at=0;at<vt;at++)pt[2*at]!==0?(M.heap[++M.heap_len]=ue=at,M.depth[at]=0):pt[2*at+1]=0;for(;M.heap_len<2;)pt[2*(Q=M.heap[++M.heap_len]=ue<2?++ue:0)]=1,M.depth[Q]=0,M.opt_len--,dt&&(M.static_len-=_t[2*Q+1]);for(H.max_code=ue,at=M.heap_len>>1;1<=at;at--)Gt(M,pt,at);for(Q=vt;at=M.heap[1],M.heap[1]=M.heap[M.heap_len--],Gt(M,pt,1),ht=M.heap[1],M.heap[--M.heap_max]=at,M.heap[--M.heap_max]=ht,pt[2*Q]=pt[2*at]+pt[2*ht],M.depth[Q]=(M.depth[at]>=M.depth[ht]?M.depth[at]:M.depth[ht])+1,pt[2*at+1]=pt[2*ht+1]=Q,M.heap[1]=Q++,Gt(M,pt,1),2<=M.heap_len;);M.heap[--M.heap_max]=M.heap[1],function(Ut,Un){var A,g,y,O,$,tt,rt=Un.dyn_tree,Dt=Un.max_code,Ee=Un.stat_desc.static_tree,ye=Un.stat_desc.has_stree,we=Un.stat_desc.extra_bits,ce=Un.stat_desc.extra_base,Sa=Un.stat_desc.max_length,Pl=0;for(O=0;O<=w;O++)Ut.bl_count[O]=0;for(rt[2*Ut.heap[Ut.heap_max]+1]=0,A=Ut.heap_max+1;A<m;A++)Sa<(O=rt[2*rt[2*(g=Ut.heap[A])+1]+1]+1)&&(O=Sa,Pl++),rt[2*g+1]=O,Dt<g||(Ut.bl_count[O]++,$=0,ce<=g&&($=we[g-ce]),tt=rt[2*g],Ut.opt_len+=tt*(O+$),ye&&(Ut.static_len+=tt*(Ee[2*g+1]+$)));if(Pl!==0){do{for(O=Sa-1;Ut.bl_count[O]===0;)O--;Ut.bl_count[O]--,Ut.bl_count[O+1]+=2,Ut.bl_count[Sa]--,Pl-=2}while(0<Pl);for(O=Sa;O!==0;O--)for(g=Ut.bl_count[O];g!==0;)Dt<(y=Ut.heap[--A])||(rt[2*y+1]!==O&&(Ut.opt_len+=(O-rt[2*y+1])*rt[2*y],rt[2*y+1]=O),g--)}}(M,H),ee(pt,ue,M.bl_count)}function b(M,H,at){var ht,Q,pt=-1,_t=H[1],dt=0,vt=7,ue=4;for(_t===0&&(vt=138,ue=3),H[2*(at+1)+1]=65535,ht=0;ht<=at;ht++)Q=_t,_t=H[2*(ht+1)+1],++dt<vt&&Q===_t||(dt<ue?M.bl_tree[2*Q]+=dt:Q!==0?(Q!==pt&&M.bl_tree[2*Q]++,M.bl_tree[2*I]++):dt<=10?M.bl_tree[2*U]++:M.bl_tree[2*S]++,pt=Q,ue=(dt=0)===_t?(vt=138,3):Q===_t?(vt=6,3):(vt=7,4))}function st(M,H,at){var ht,Q,pt=-1,_t=H[1],dt=0,vt=7,ue=4;for(_t===0&&(vt=138,ue=3),ht=0;ht<=at;ht++)if(Q=_t,_t=H[2*(ht+1)+1],!(++dt<vt&&Q===_t)){if(dt<ue)for(;ct(M,Q,M.bl_tree),--dt!=0;);else Q!==0?(Q!==pt&&(ct(M,Q,M.bl_tree),dt--),ct(M,I,M.bl_tree),ot(M,dt-3,2)):dt<=10?(ct(M,U,M.bl_tree),ot(M,dt-3,3)):(ct(M,S,M.bl_tree),ot(M,dt-11,7));pt=Q,ue=(dt=0)===_t?(vt=138,3):Q===_t?(vt=6,3):(vt=7,4)}}c(et);var nt=!1;function F(M,H,at,ht){ot(M,(u<<1)+(ht?1:0),3),function(Q,pt,_t,dt){kt(Q),bt(Q,_t),bt(Q,~_t),s.arraySet(Q.pending_buf,Q.window,pt,_t,Q.pending),Q.pending+=_t}(M,H,at)}i._tr_init=function(M){nt||(function(){var H,at,ht,Q,pt,_t=new Array(w+1);for(Q=ht=0;Q<l-1;Q++)for(B[Q]=ht,H=0;H<1<<N[Q];H++)_[ht++]=Q;for(_[ht-1]=Q,Q=pt=0;Q<16;Q++)for(et[Q]=pt,H=0;H<1<<P[Q];H++)R[pt++]=Q;for(pt>>=7;Q<d;Q++)for(et[Q]=pt<<7,H=0;H<1<<P[Q]-7;H++)R[256+pt++]=Q;for(at=0;at<=w;at++)_t[at]=0;for(H=0;H<=143;)Z[2*H+1]=8,H++,_t[8]++;for(;H<=255;)Z[2*H+1]=9,H++,_t[9]++;for(;H<=279;)Z[2*H+1]=7,H++,_t[7]++;for(;H<=287;)Z[2*H+1]=8,H++,_t[8]++;for(ee(Z,f+1,_t),H=0;H<d;H++)C[2*H+1]=5,C[2*H]=Lt(H,5);X=new ft(Z,N,h+1,f,w),D=new ft(C,P,0,d,w),lt=new ft(new Array(0),L,0,p,T)}(),nt=!0),M.l_desc=new G(M.dyn_ltree,X),M.d_desc=new G(M.dyn_dtree,D),M.bl_desc=new G(M.bl_tree,lt),M.bi_buf=0,M.bi_valid=0,At(M)},i._tr_stored_block=F,i._tr_flush_block=function(M,H,at,ht){var Q,pt,_t=0;0<M.level?(M.strm.data_type===2&&(M.strm.data_type=function(dt){var vt,ue=4093624447;for(vt=0;vt<=31;vt++,ue>>>=1)if(1&ue&&dt.dyn_ltree[2*vt]!==0)return o;if(dt.dyn_ltree[18]!==0||dt.dyn_ltree[20]!==0||dt.dyn_ltree[26]!==0)return a;for(vt=32;vt<h;vt++)if(dt.dyn_ltree[2*vt]!==0)return a;return o}(M)),Oe(M,M.l_desc),Oe(M,M.d_desc),_t=function(dt){var vt;for(b(dt,dt.dyn_ltree,dt.l_desc.max_code),b(dt,dt.dyn_dtree,dt.d_desc.max_code),Oe(dt,dt.bl_desc),vt=p-1;3<=vt&&dt.bl_tree[2*V[vt]+1]===0;vt--);return dt.opt_len+=3*(vt+1)+5+5+4,vt}(M),Q=M.opt_len+3+7>>>3,(pt=M.static_len+3+7>>>3)<=Q&&(Q=pt)):Q=pt=at+5,at+4<=Q&&H!==-1?F(M,H,at,ht):M.strategy===4||pt===Q?(ot(M,2+(ht?1:0),3),be(M,Z,C)):(ot(M,4+(ht?1:0),3),function(dt,vt,ue,Ut){var Un;for(ot(dt,vt-257,5),ot(dt,ue-1,5),ot(dt,Ut-4,4),Un=0;Un<Ut;Un++)ot(dt,dt.bl_tree[2*V[Un]+1],3);st(dt,dt.dyn_ltree,vt-1),st(dt,dt.dyn_dtree,ue-1)}(M,M.l_desc.max_code+1,M.d_desc.max_code+1,_t+1),be(M,M.dyn_ltree,M.dyn_dtree)),At(M),ht&&kt(M)},i._tr_tally=function(M,H,at){return M.pending_buf[M.d_buf+2*M.last_lit]=H>>>8&255,M.pending_buf[M.d_buf+2*M.last_lit+1]=255&H,M.pending_buf[M.l_buf+M.last_lit]=255&at,M.last_lit++,H===0?M.dyn_ltree[2*at]++:(M.matches++,H--,M.dyn_ltree[2*(_[at]+h+1)]++,M.dyn_dtree[2*W(H)]++),M.last_lit===M.lit_bufsize-1},i._tr_align=function(M){ot(M,2,3),ct(M,v,Z),function(H){H.bi_valid===16?(bt(H,H.bi_buf),H.bi_buf=0,H.bi_valid=0):8<=H.bi_valid&&(H.pending_buf[H.pending++]=255&H.bi_buf,H.bi_buf>>=8,H.bi_valid-=8)}(M)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,u,l,h,f=1,d={},p=!1,m=o.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(o);w=w&&w.setTimeout?w:o,c={}.toString.call(o.process)==="[object process]"?function(I){Ii.nextTick(function(){T(I)})}:function(){if(o.postMessage&&!o.importScripts){var I=!0,U=o.onmessage;return o.onmessage=function(){I=!1},o.postMessage("","*"),o.onmessage=U,I}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",v,!1):o.attachEvent("onmessage",v),function(I){o.postMessage(h+I,"*")}):o.MessageChannel?((l=new MessageChannel).port1.onmessage=function(I){T(I.data)},function(I){l.port2.postMessage(I)}):m&&"onreadystatechange"in m.createElement("script")?(u=m.documentElement,function(I){var U=m.createElement("script");U.onreadystatechange=function(){T(I),U.onreadystatechange=null,u.removeChild(U),U=null},u.appendChild(U)}):function(I){setTimeout(T,0,I)},w.setImmediate=function(I){typeof I!="function"&&(I=new Function(""+I));for(var U=new Array(arguments.length-1),S=0;S<U.length;S++)U[S]=arguments[S+1];var N={callback:I,args:U};return d[f]=N,c(f),f++},w.clearImmediate=E}function E(I){delete d[I]}function T(I){if(p)setTimeout(T,0,I);else{var U=d[I];if(U){p=!0;try{(function(S){var N=S.callback,P=S.args;switch(P.length){case 0:N();break;case 1:N(P[0]);break;case 2:N(P[0],P[1]);break;case 3:N(P[0],P[1],P[2]);break;default:N.apply(a,P)}})(U)}finally{E(I),p=!1}}}}function v(I){I.source===o&&typeof I.data=="string"&&I.data.indexOf(h)===0&&T(+I.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof xn<"u"?xn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(J1);var aM=J1.exports,dd=Ts(aM);const Z1={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Z1);var ur=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},_o,Aa,ws;class cM{constructor(...t){_o.set(this,new Map),Aa.set(this,new Map),ws.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),ur(this,ws,"f").has(r)||ur(this,ws,"f").set(r,new Set);const s=ur(this,ws,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&ur(this,Aa,"f").set(r,a),o=!1,c)continue;const u=ur(this,_o,"f").get(a);if(u&&u!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${u} -> ${a}". Pass \`force=true\` to override this definition.`);ur(this,_o,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:ur(this,_o,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&ur(this,Aa,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:ur(this,ws,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of ur(this,ws,"f").values())Object.freeze(t);return this}_getTestState(){return{types:ur(this,_o,"f"),extensions:ur(this,Aa,"f")}}}_o=new WeakMap,Aa=new WeakMap,ws=new WeakMap;var lM=new cM(Z1)._freeze();function Q1(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return lM.getType(e)??"application/octet-stream"}async function uM(e,t){try{ei(j,e.name);const n=await e.arrayBuffer();(await new dd().loadAsync(n)).forEach((s,o)=>{o.async("uint8array").then(a=>{const c=Q1(s,a),u=new File([a],o.name,{type:c});t(u)}).catch(a=>{le(j,"crash",a.message)})})}catch(n){le(j,"crash",n.message)}}async function hM(e,t){try{ei(j,e.name);const n=await e.arrayBuffer();t(new Uint8Array(n))}catch(n){le(j,"crash",n.message)}}function tb(e,t){function n(r){if(x(t))switch(r){case"text/plain":t.text().then(i=>Zl(j,void 0,"text",`file:${t.name}`,i,e)).catch(i=>le(j,"crash",i.message));break;case"application/json":t.text().then(i=>Zl(j,void 0,"json",`file:${t.name}`,i,e)).catch(i=>le(j,"crash",i.message));break;case"application/zip":uM(t,i=>tb(e,i)).catch(i=>le(j,"crash",i.message));break;case"application/octet-stream":hM(t,i=>Zl(j,void 0,"binary",`file:${t.name}`,i,e)).catch(i=>le(j,"crash",i.message));break;default:t.arrayBuffer().then(i=>{const s=Q1(t.name,new Uint8Array(i));if(s)n(s);else return le(j,"parsewebfile",`unsupported file ${t.name}`)}).catch(i=>le(j,"crash",i.message));return}}n((t==null?void 0:t.type)??"")}function bo(e,t){function n(r){le(e,"crash",r.message)}t().catch(n)}function fM(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function dM(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const pM=new Date("1980/09/02");async function eb(e){return console.info("saved",e),new Promise((t,n)=>{const r=new dd;for(let i=0;i<e.length;++i){const s=e[i],o=vC(s);if(o){const a=jT(o);x(a)&&r.file(s.id,a,{date:pM})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(dM(i))}).catch(n)})}async function mM(e){return new Promise((t,n)=>{const r=new dd;r.loadAsync(fM(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),u=SC(zT(c));x(u)&&i.push(u)}t(i)}).catch(n)})}const nb="$yellow$205$205$205$196";function rb(e,t){return`${e.x},${e.y},${t.x},${t.y}`}let Ve;function gM(){return!!Ve}function yM(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,u=[],l=[];for(let h=i;h<=o;++h)for(let f=r;f<=s;++f){const d={x:f-r,y:h-i},p=Kn(e,{x:f,y:h});(p==null?void 0:p.category)===Hn.ISOBJECT?(u.push(Xe(od(e,f,h))),Fr(p)!=="player"&&l.push({...Xe(p),...d,id:"blank"})):u.push({...Xe(p),...d})}return{board:e.id,width:a,height:c,terrain:u,objects:l}}function _M(e,t,n,r){const i=lr(e);if(x(i))switch(Ve=yM(i,t,n),r){case"copyobjects":Ve.terrain=[];break;case"copyterrain":Ve.objects=[];break}}function bM(e,t,n){const r=rb(t,n);oe(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),oe(e,nb),Bt(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Bt(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Bt(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=wn(e);i.scroll=Qr(e)}function EM(e,t,n,r){const i=lr(e);if(!x(i)||!x(Ve))return;const s=Math.min(t.x,n.x),o=Math.min(t.y,n.y),a=Math.max(t.x,n.x),c=Math.max(t.y,n.y),u=a-s+1,l=c-o+1,h=Math.min(Ve.width,u),f=Math.min(Ve.height,l);switch(r){case"pasteall":{for(let d=0;d<f;++d)for(let p=0;p<h;++p){const m=lc({x:p,y:d},Ve.width);kr(i,{...Ve.terrain[m],x:s+p,y:o+d})}for(let d=0;d<Ve.objects.length;++d){const p=Ve.objects[d];x(p.x)&&x(p.y)&&I0(p.x,p.y,0,u-1,l-1,0)&&ad(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let d=0;d<Ve.objects.length;++d){const p=Ve.objects[d];x(p.x)&&x(p.y)&&I0(p.x,p.y,0,u-1,l-1,0)&&ad(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let d=0;d<f;++d)for(let p=0;p<h;++p){const m=lc({x:p,y:d},Ve.width);kr(i,{...Ve.terrain[m],x:s+p,y:o+d})}break;case"pasteterraintiled":for(let d=o;d<=c;++d)for(let p=s;p<=a;++p){const m=(p-s)%Ve.width,w=(d-o)%Ve.height,E=lc({x:m,y:w},Ve.width);kr(i,{...Ve.terrain[E],x:p,y:d})}break}}function wM(e,t,n){const r=rb(t,n);oe(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),oe(e,nb),Bt(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Bt(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Bt(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Bt(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=wn(e);i.scroll=Qr(e)}const xs="$yellow$205$205$205$196";function Bl(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function xM(e,t,n,r){const i=lr(e);if(!x(i))return;let s=0;function o(){return s}function a(u,l){Ct(l)&&(s=l,N0(t.x,t.y,n.x,n.y).forEach(h=>{const f=Kn(i,h);x(f)&&(f[u]=l)}))}oe(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),oe(e,xs),Bt(e,`batch:${Bl(t,n)}`,"char",[r,"charedit"],o,a);const c=wn(e);c.scroll=Qr(e)}function kM(e,t,n,r){const i=lr(e);if(!x(i))return;let s=0;function o(){return s}function a(u,l){if(console.info("memoryinspectcolorarea",u,l),Ct(l)){s=l;for(let h=t.y;h<=n.y;++h)for(let f=t.x;f<=n.x;++f){const d=Kn(i,{x:f,y:h});x(d)&&(d[u]=l)}}}oe(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),oe(e,xs),Bt(e,`batch:${Bl(t,n)}`,"color",[r,"coloredit"],o,a);const c=wn(e);c.scroll=Qr(e)}function TM(e,t,n,r){const i=lr(e);if(!x(i))return;let s=0;function o(){return s}function a(u,l){Ct(l)&&(s=l,N0(t.x,t.y,n.x,n.y).forEach(h=>{const f=Kn(i,h);x(f)&&(f[u]=l)}))}oe(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),oe(e,xs),Bt(e,`batch:${Bl(t,n)}`,"color",[r,"coloredit"],o,a);const c=wn(e);c.scroll=Qr(e)}const va={stat:"",patternsize:2,mirror:1};function AM(e,t,n){const r=Ln(Ft.MAIN);if(!x(r))return;const i=lr(e);if(!x(i))return;const s=Bl(t,n);oe(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),oe(e,xs),Bt(e,"batch","copy elements",[`copy:${s}`,"hk","1"," 1 ","next"]),gM()&&Bt(e,"batch","paste elements",[`paste:${s}`,"hk","2"," 2 ","next"]),Bt(e,"batch","copy coords",[`copycoords:${s}`,"hk","5"," 5 "]);function o(d){const{target:p}=Tr(d);return va[p]}function a(d,p){if(Ct(p)||St(p)){const{target:m}=Tr(d);va[m]=p}}Bt(e,"batch","remix",[`stat:${s}`,"text"],o,a),Bt(e,"batch","patternsize",[`patternsize:${s}`,"number","1","5"],o,a),Bt(e,"batch","mirror",[`mirror:${s}`,"number","1","8"],o,a),Bt(e,"batch","run",[`remixrun:${s}`,"hk","r"," R "]),oe(e,xs),Bt(e,"batch","set chars:",[`chars:${s}`,"hk","a"," A ","next"]),Bt(e,"batch","set colors:",[`colors:${s}`,"hk","c"," C ","next"]),Bt(e,"batch","set bgs:",[`bgs:${s}`,"hk","b"," B ","next"]),oe(e,xs),Bt(e,"batch","make empty",[`empty:${s}`,"hk","0"," 0 ","next"]),oe(e,xs),oe(e,"codepages:");const c=Math.min(t.x,n.x),u=Math.min(t.y,n.y),l=Math.max(t.x,n.x),h=Math.max(t.y,n.y),f=new Set;for(let d=u;d<=h;++d)for(let p=c;p<=l;++p){const m=Kn(i,{x:p,y:d}),w=$_(r,m);x(w)&&!f.has(w.id)&&(f.add(w.id),Bt(e,"batch",`edit @${Ne(w)}`,[`pageopen:${w.id}`]))}}const Eo="$yellow$205$205$205$196";function pd(e,t){return`inspect:${t!=null&&t.id?t.id:Zr(e,t)}`}function vM(e,t,n){const r=Ln(Ft.MAIN);if(!x(r))return;const i=lr(e);if(!x(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){x(t)&&(t[f]=d)}const a=t.category===Hn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=pd(i,t);oe(e,`${a}: ${c} ${u}`),oe(e,Eo),Bt(e,l,"color",[n,"coloredit"],s,o);const h=wn(e);h.scroll=Qr(e)}function SM(e,t,n){const r=Ln(Ft.MAIN);if(!x(r))return;const i=lr(e);if(!x(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){x(t)&&(t[f]=d)}const a=t.category===Hn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=pd(i,t);oe(e,`${a}: ${c} ${u}`),oe(e,Eo),Bt(e,l,"char",[n,"charedit"],s,o);const h=wn(e);h.scroll=Qr(e)}function RM(e,t,n,r,i,s){var h,f,d;function o(p){var w;const m=(r==null?void 0:r[p])??((w=r==null?void 0:r.kinddata)==null?void 0:w[p]);if(!x(m))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Ht.ISWALK;case"pushable":return 0;case"destructible":return 0}return m}function a(p,m){x(r)&&(r[p]=m)}s?oe(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):oe(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),oe(e,Eo);const c=pd(t,r);s?(Bt(e,c,"cycle",["cycle","number","1","255"],o,a),Bt(e,c,"collision",["collision","select","iswalking",`${Ht.ISWALK}`,"isswimming",`${Ht.ISSWIM}`],o,a)):Bt(e,c,"collision",["collision","select","iswalkable",`${Ht.ISWALK}`,"isswimable",`${Ht.ISSWIM}`,"issolid",`${Ht.ISSOLID}`],o,a),s&&Bt(e,c,"pushable",["pushable","select","no","0","yes","1"],o,a),Bt(e,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const u=pa(n),l=Gn(u);for(let p=0;p<l.length;++p){const m=l[p];switch(m){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(ne(u[m])){const[w,E,...T]=u[m];St(E)&&Bt(e,c,E||m,[m,w,...T],o,a)}break}}Bt(e,c,"copy coords",["copycoords","hk","5"," 5 "]),oe(e,Eo),Bt(e,c,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],o,a),Bt(e,c,`color: ${r.color??((f=r.kinddata)==null?void 0:f.color)??15}`,["color","hk","c"," C ","next"],o,a),Bt(e,c,`bg: ${r.bg??((d=r.kinddata)==null?void 0:d.bg)??0}`,["bg","hk","b"," B ","next"],o,a),oe(e,Eo),Bt(e,c,"make empty",["empty","hk","0"],o,a),oe(e,Eo),Bt(e,"batch",`edit @${Ne(n)}`,[`pageopen:${n.id}`])}const ib="$yellow$205$205$205$196";function IM(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function NM(e,t,n,r){const i=Ln(Ft.MAIN);if(!x(i))return;const s=lr(e);if(x(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=Kn(s,{x:a,y:o});(c==null?void 0:c.category)===Hn.ISOBJECT&&Yr(i,s,c,i.timestamp),kr(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=Kn(s,{x:a,y:o});(c==null?void 0:c.category)===Hn.ISOBJECT&&Yr(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)kr(s,{x:a,y:o});break}}}function OM(e,t,n){const r=IM(t,n);oe(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),oe(e,ib),Bt(e,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),Bt(e,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),Bt(e,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=wn(e);i.scroll=Qr(e)}function CM(e,t,n){const r=Ln(Ft.MAIN);if(!x(r))return;const i=lr(e);if(!x(i))return;if(Er(r,i),t.x===n.x&&t.y===n.y){const o=Kn(i,t),a=$_(r,o);x(o)&&x(a)&&RM(e,i,a,o,t,Yo(o)),o!=null&&o.kind||(oe(e,`empty: ${t.x}, ${t.y}`),oe(e,ib),Bt(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]))}else AM(e,t,n);const s=wn(e);s.scroll=Qr(e)}function LM(e,t){const n=he(Ft.MAIN);if(!x(n))return;const r=lr(t);if(!x(r))return;const i=Tr(e),s=ZL(r,i.target);if(x(s))switch(i.path){case"copycoords":ql(j,[s.x??0,s.y??0].join(" "),cr());break;case"bg":case"color":vM(t,s,i.path);break;case"char":SM(t,s,i.path);break;case"empty":Yr(n,r,s,n.timestamp);break;case"code":bo(j,async()=>{if(!x(t))return;const o=Fr(s),a="object";se(j,`opened [${a}] ${o}`);const c=[r.id,s.id];Yu(Oa(n.id,c),s.code??""),Qb(j,t),await Md(800),Od(j,n.id,c,a,`${o} - ${n.name}`,[],t)});break;default:console.info("unknown inspect",i);break}}function MM(e,t){const n=lr(t);if(!x(n))return;const r=Tr(e),[i,s,o,a]=r.path.split(",").map(l=>parseFloat(l)),c={x:i,y:s},u={x:o,y:a};switch(r.target){case"copy":bM(t,c,u);break;case"copyall":case"copyobjects":case"copyterrain":_M(t,c,u,r.target);break;case"paste":wM(t,c,u);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":EM(t,c,u,r.target);break;case"empty":OM(t,c,u);break;case"emptyall":case"emptyobjects":case"emptyterrain":NM(t,c,u,r.target);break;case"chars":xM(t,c,u,"char");break;case"colors":kM(t,c,u,"color");break;case"bgs":TM(t,c,u,"bg");break;case"copycoords":ql(j,[i,s,o,a].join(" "),cr());break;case"remixrun":Lf(n.id,va.stat,va.patternsize,va.mirror,c,u);break;case"pageopen":bo(j,async()=>{await Md(800),EE(j,`#pageopen ${r.path}`,cr())});break;default:console.info("unknown batch",r);break}}const UM=16,ks={},FM=15*60*5;let sb=0;const wo={},xo={};async function ob(e){const t=mo(),n=he(Ft.MAIN);if(t.length&&x(n)){const r=await eb(t),i=e?"autosave":`${new Date().toISOString()} ${n.name} ${r.length} chars`;iE(ae,i,r,cr())}}async function BM(){const e=mo(),t=he(Ft.MAIN);if(e.length&&x(t)){const n=await eb(e);sE(ae,n,cr())}}const ae=Ss("vm",["tick","second"],e=>{var t;if(ae.session(e))switch(e.target){case"operator":x(e.player)&&(IL(e.player),Pt(ae,`operator set to ${e.player}`),ae.replynext(e,"ackoperator",!0,e.player));break;case"zsswords":if(e.player===cr()){const n=he(Ft.MAIN);ae.replynext(e,"ackzsswords",{cli:Gf(Hi.CLI),loader:Gf(Hi.LOADER),runtime:Gf(Hi.RUNTIME),flags:[...Gn(Es(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"],kinds:[...gs(n,Et.OBJECT).map(r=>Ne(r)),...Gn(jf)],altkinds:[...gs(n,Et.TERRAIN),...gs(n,Et.BOARD),...gs(n,Et.PALETTE),...gs(n,Et.CHARSET),...gs(n,Et.LOADER)].map(r=>Ne(r)),colors:[...Gn(zo)],dirs:[...Gn(rd).filter(r=>["cw","ccw","oop","rndp"].includes(r)===!1)],dirmods:["cw","ccw","oop","rndp",...Gn(zf)]},e.player)}break;case"books":e.player===cr()&&bo(ae,async()=>{if(e.player&&ne(e.data)){const[n,r]=e.data,i=await mM(n),s=i.map(o=>o.name);UL(i,r),Pt(ae,`loading ${s.join(", ")}`),Xl(ae,e.player)}});break;case"joinack":x(e.player)&&!DL(e.player)&&Xl(ae,e.player);break;case"logout":x(e.player)&&(PL(e.player),delete ks[e.player],Pt(ae,`player ${e.player} logout`),Xl(ae,e.player));break;case"login":x(e.player)&&BL(e.player)&&(ks[e.player]=0,Pt(ae,`login from ${e.player}`),ae.replynext(e,"acklogin",!0,e.player));break;case"doot":x(e.player)&&(ks[e.player]=0,Nd(ae,"active",e.player));break;case"input":if(x(e.player)){const n=Es(e.player),[r=mn.NONE,i=0]=e.data??[mn.NONE,0];ne(n.inputqueue)||(n.inputqueue=[]),r!==mn.NONE&&n.inputqueue.push([r,i])}break;case"codewatch":if(x(e.player)&&ne(e.data)){const[n,r]=e.data,i=Oa(n,r);x(xo[i])||(xo[i]=v0(i,s=>{const[o,a]=r,c=wr(n),u=bi(c,o);if(x(u))if(zi(u)===Et.BOARD&&x(a)){const l=un(u),h=Mn(l,a);x(h)&&(h.code=s,xf(F_(s),h))}else u.code=s,AC(u)})),wo[i]=wo[i]??new Set,wo[i].add(e.player)}break;case"coderelease":if(e.player&&ne(e.data)){const[n,r]=e.data,[,i]=r,s=Oa(n,r);x(wo[s])&&(wo[s].delete(e.player),wo[s].size===0&&((t=xo[s])==null||t.call(xo),xo[s]=void 0,St(i)&&zL(i)))}break;case"halt":e.player===cr()&&Kb(e.data)&&NL(e.data);break;case"tick":OL()||KL();break;case"synthsend":St(e.data)&&nd(e.data,void 0);break;case"second":{$L(ks);const n=Object.keys(ks);for(let r=0;r<n.length;++r)++ks[n[r]];for(let r=0;r<n.length;++r){const i=n[r];ks[i]>=UM&&Cd(ae,i)}++sb>=FM&&(sb=0,bo(ae,async()=>{await ob(!0)}));break}case"copyjsonfile":{const n=he(Ft.MAIN);if(x(n)&&ne(e.data)){const[r]=e.data,i=bi(n,r);x(i)&&oE(ae,i,`${Ne(i)}.${Wi(i)}.json`,cr())}break}case"refsheet":{const n=he(Ft.MAIN),r=Af(n);x(n)&&ne(e.data)&&x(e.player)&&(bE(ae,e.player),Gi(ae,"use as refsheet"),r.forEach(i=>{const s=Ne(i),o=Wi(i);Pt(ae,`!pageopenwith ${i.id} ${e.data.join(" ")};$blue[${o}]$white ${s}`)}));break}case"fork":bo(ae,async()=>{await BM()});break;case"flush":bo(ae,async()=>{await ob()});break;case"cli":x(e.player)&&GL(e.player,e.data);break;case"restart":e.player===cr()&&(WL(),Ld(ae,e.player));break;case"inspect":if(x(e.player)&&ne(e.data)){const[n,r]=e.data;CM(e.player,n,r)}break;case"loader":if(x(e.player)&&ne(e.data)){const[n,r,i,s]=e.data;if(r==="file")tb(e.player,s);else if(r==="json"&&/file:.*\.book.json/.test(i)){Pt(ae,`loading ${i}`);const o=JSON.parse(s.json),a=he(Ft.MAIN);x(a)&&x(o.data)&&St(o.exported)&&(td(o.data),Pt(ae,`loaded ${o.exported}`))}else if(r==="json"&&/file:.*\..*\.json/.test(i)){Pt(ae,`loading ${i}`);const o=JSON.parse(s.json),a=he(Ft.MAIN);x(a)&&x(o.data)&&St(o.exported)&&(j_(a,o.data),Pt(ae,`loaded ${o.exported}`))}else h4(n,r,i,s,e.player)}break;default:{const{target:n,path:r}=Tr(e.target);switch(Mt(n)){case"batch":x(e.player)&&MM(r,e.player);break;case"empty":if(x(e.player)){const i=Tr(r);switch(i.target){case"copycoords":ql(ae,i.path.split(",").join(" "),cr());break}}break;case"inspect":x(e.player)&&LM(r,e.player);break;case"touched":if(ne(e.data)){const[i,s,o]=e.data;z1({...e,target:`${i}:${o}`,data:void 0,sender:s})}break;default:z1(e);break}break}}},RL());function PM(){rE(ae)}const{forward:DM}=vE(e=>postMessage(e));onmessage=function(t){DM(t.data)},setTimeout(PM,100)})();
